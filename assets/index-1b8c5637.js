(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();function nXe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var pD={},sXe={get exports(){return pD},set exports(t){pD=t}},JV={},xs={},oXe={get exports(){return xs},set exports(t){xs=t}},yn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uN=Symbol.for("react.element"),aXe=Symbol.for("react.portal"),lXe=Symbol.for("react.fragment"),cXe=Symbol.for("react.strict_mode"),uXe=Symbol.for("react.profiler"),hXe=Symbol.for("react.provider"),dXe=Symbol.for("react.context"),pXe=Symbol.for("react.forward_ref"),fXe=Symbol.for("react.suspense"),mXe=Symbol.for("react.memo"),gXe=Symbol.for("react.lazy"),r0e=Symbol.iterator;function AXe(t){return t===null||typeof t!="object"?null:(t=r0e&&t[r0e]||t["@@iterator"],typeof t=="function"?t:null)}var C3e={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M3e=Object.assign,R3e={};function jO(t,e,r){this.props=t,this.context=e,this.refs=R3e,this.updater=r||C3e}jO.prototype.isReactComponent={};jO.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};jO.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function O3e(){}O3e.prototype=jO.prototype;function Goe(t,e,r){this.props=t,this.context=e,this.refs=R3e,this.updater=r||C3e}var joe=Goe.prototype=new O3e;joe.constructor=Goe;M3e(joe,jO.prototype);joe.isPureReactComponent=!0;var i0e=Array.isArray,P3e=Object.prototype.hasOwnProperty,Hoe={current:null},I3e={key:!0,ref:!0,__self:!0,__source:!0};function $3e(t,e,r){var i,n={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)P3e.call(e,i)&&!I3e.hasOwnProperty(i)&&(n[i]=e[i]);var a=arguments.length-2;if(a===1)n.children=r;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];n.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)n[i]===void 0&&(n[i]=a[i]);return{$$typeof:uN,type:t,key:s,ref:o,props:n,_owner:Hoe.current}}function yXe(t,e){return{$$typeof:uN,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function qoe(t){return typeof t=="object"&&t!==null&&t.$$typeof===uN}function _Xe(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var n0e=/\/+/g;function Mq(t,e){return typeof t=="object"&&t!==null&&t.key!=null?_Xe(""+t.key):e.toString(36)}function A7(t,e,r,i,n){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case uN:case aXe:o=!0}}if(o)return o=t,n=n(o),t=i===""?"."+Mq(o,0):i,i0e(n)?(r="",t!=null&&(r=t.replace(n0e,"$&/")+"/"),A7(n,e,r,"",function(c){return c})):n!=null&&(qoe(n)&&(n=yXe(n,r+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(n0e,"$&/")+"/")+t)),e.push(n)),1;if(o=0,i=i===""?".":i+":",i0e(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+Mq(s,a);o+=A7(s,e,r,l,n)}else if(l=AXe(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+Mq(s,a++),o+=A7(s,e,r,l,n);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function zF(t,e,r){if(t==null)return t;var i=[],n=0;return A7(t,i,"","",function(s){return e.call(r,s,n++)}),i}function vXe(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var vh={current:null},y7={transition:null},bXe={ReactCurrentDispatcher:vh,ReactCurrentBatchConfig:y7,ReactCurrentOwner:Hoe};yn.Children={map:zF,forEach:function(t,e,r){zF(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return zF(t,function(){e++}),e},toArray:function(t){return zF(t,function(e){return e})||[]},only:function(t){if(!qoe(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};yn.Component=jO;yn.Fragment=lXe;yn.Profiler=uXe;yn.PureComponent=Goe;yn.StrictMode=cXe;yn.Suspense=fXe;yn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bXe;yn.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=M3e({},t.props),n=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Hoe.current),e.key!==void 0&&(n=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)P3e.call(e,l)&&!I3e.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:uN,type:t.type,key:n,ref:s,props:i,_owner:o}};yn.createContext=function(t){return t={$$typeof:dXe,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:hXe,_context:t},t.Consumer=t};yn.createElement=$3e;yn.createFactory=function(t){var e=$3e.bind(null,t);return e.type=t,e};yn.createRef=function(){return{current:null}};yn.forwardRef=function(t){return{$$typeof:pXe,render:t}};yn.isValidElement=qoe;yn.lazy=function(t){return{$$typeof:gXe,_payload:{_status:-1,_result:t},_init:vXe}};yn.memo=function(t,e){return{$$typeof:mXe,type:t,compare:e===void 0?null:e}};yn.startTransition=function(t){var e=y7.transition;y7.transition={};try{t()}finally{y7.transition=e}};yn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};yn.useCallback=function(t,e){return vh.current.useCallback(t,e)};yn.useContext=function(t){return vh.current.useContext(t)};yn.useDebugValue=function(){};yn.useDeferredValue=function(t){return vh.current.useDeferredValue(t)};yn.useEffect=function(t,e){return vh.current.useEffect(t,e)};yn.useId=function(){return vh.current.useId()};yn.useImperativeHandle=function(t,e,r){return vh.current.useImperativeHandle(t,e,r)};yn.useInsertionEffect=function(t,e){return vh.current.useInsertionEffect(t,e)};yn.useLayoutEffect=function(t,e){return vh.current.useLayoutEffect(t,e)};yn.useMemo=function(t,e){return vh.current.useMemo(t,e)};yn.useReducer=function(t,e,r){return vh.current.useReducer(t,e,r)};yn.useRef=function(t){return vh.current.useRef(t)};yn.useState=function(t){return vh.current.useState(t)};yn.useSyncExternalStore=function(t,e,r){return vh.current.useSyncExternalStore(t,e,r)};yn.useTransition=function(){return vh.current.useTransition()};yn.version="18.2.0";(function(t){t.exports=yn})(oXe);const wXe=nXe(xs);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xXe=xs,TXe=Symbol.for("react.element"),SXe=Symbol.for("react.fragment"),EXe=Object.prototype.hasOwnProperty,CXe=xXe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,MXe={key:!0,ref:!0,__self:!0,__source:!0};function D3e(t,e,r){var i,n={},s=null,o=null;r!==void 0&&(s=""+r),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)EXe.call(e,i)&&!MXe.hasOwnProperty(i)&&(n[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)n[i]===void 0&&(n[i]=e[i]);return{$$typeof:TXe,type:t,key:s,ref:o,props:n,_owner:CXe.current}}JV.Fragment=SXe;JV.jsx=D3e;JV.jsxs=D3e;(function(t){t.exports=JV})(sXe);const hN=pD.Fragment,qr=pD.jsx,Po=pD.jsxs;var HZ={},qZ={},RXe={get exports(){return qZ},set exports(t){qZ=t}},Mp={},WZ={},OXe={get exports(){return WZ},set exports(t){WZ=t}},L3e={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(H,W){var oe=H.length;H.push(W);e:for(;0<oe;){var le=oe-1>>>1,fe=H[le];if(0<n(fe,W))H[le]=W,H[oe]=fe,oe=le;else break e}}function r(H){return H.length===0?null:H[0]}function i(H){if(H.length===0)return null;var W=H[0],oe=H.pop();if(oe!==W){H[0]=oe;e:for(var le=0,fe=H.length,de=fe>>>1;le<de;){var Ee=2*(le+1)-1,Ie=H[Ee],Ge=Ee+1,Ke=H[Ge];if(0>n(Ie,oe))Ge<fe&&0>n(Ke,Ie)?(H[le]=Ke,H[Ge]=oe,le=Ge):(H[le]=Ie,H[Ee]=oe,le=Ee);else if(Ge<fe&&0>n(Ke,oe))H[le]=Ke,H[Ge]=oe,le=Ge;else break e}}return W}function n(H,W){var oe=H.sortIndex-W.sortIndex;return oe!==0?oe:H.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,p=3,A=!1,v=!1,b=!1,S=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function O(H){for(var W=r(c);W!==null;){if(W.callback===null)i(c);else if(W.startTime<=H)i(c),W.sortIndex=W.expirationTime,e(l,W);else break;W=r(c)}}function I(H){if(b=!1,O(H),!v)if(r(l)!==null)v=!0,te(N);else{var W=r(c);W!==null&&j(I,W.startTime-H)}}function N(H,W){v=!1,b&&(b=!1,E(U),U=-1),A=!0;var oe=p;try{for(O(W),d=r(l);d!==null&&(!(d.expirationTime>W)||H&&!X());){var le=d.callback;if(typeof le=="function"){d.callback=null,p=d.priorityLevel;var fe=le(d.expirationTime<=W);W=t.unstable_now(),typeof fe=="function"?d.callback=fe:d===r(l)&&i(l),O(W)}else i(l);d=r(l)}if(d!==null)var de=!0;else{var Ee=r(c);Ee!==null&&j(I,Ee.startTime-W),de=!1}return de}finally{d=null,p=oe,A=!1}}var L=!1,B=null,U=-1,q=5,Z=-1;function X(){return!(t.unstable_now()-Z<q)}function ee(){if(B!==null){var H=t.unstable_now();Z=H;var W=!0;try{W=B(!0,H)}finally{W?se():(L=!1,B=null)}}else L=!1}var se;if(typeof R=="function")se=function(){R(ee)};else if(typeof MessageChannel<"u"){var ue=new MessageChannel,re=ue.port2;ue.port1.onmessage=ee,se=function(){re.postMessage(null)}}else se=function(){S(ee,0)};function te(H){B=H,L||(L=!0,se())}function j(H,W){U=S(function(){H(t.unstable_now())},W)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(H){H.callback=null},t.unstable_continueExecution=function(){v||A||(v=!0,te(N))},t.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<H?Math.floor(1e3/H):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(H){switch(p){case 1:case 2:case 3:var W=3;break;default:W=p}var oe=p;p=W;try{return H()}finally{p=oe}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(H,W){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var oe=p;p=H;try{return W()}finally{p=oe}},t.unstable_scheduleCallback=function(H,W,oe){var le=t.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?le+oe:le):oe=le,H){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=oe+fe,H={id:u++,callback:W,priorityLevel:H,startTime:oe,expirationTime:fe,sortIndex:-1},oe>le?(H.sortIndex=oe,e(c,H),r(l)===null&&H===r(c)&&(b?(E(U),U=-1):b=!0,j(I,oe-le))):(H.sortIndex=fe,e(l,H),v||A||(v=!0,te(N))),H},t.unstable_shouldYield=X,t.unstable_wrapCallback=function(H){var W=p;return function(){var oe=p;p=W;try{return H.apply(this,arguments)}finally{p=oe}}}})(L3e);(function(t){t.exports=L3e})(OXe);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N3e=xs,vp=WZ;function At(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var F3e=new Set,fD={};function dE(t,e){CR(t,e),CR(t+"Capture",e)}function CR(t,e){for(fD[t]=e,t=0;t<e.length;t++)F3e.add(e[t])}var Q_=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),QZ=Object.prototype.hasOwnProperty,PXe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,s0e={},o0e={};function IXe(t){return QZ.call(o0e,t)?!0:QZ.call(s0e,t)?!1:PXe.test(t)?o0e[t]=!0:(s0e[t]=!0,!1)}function $Xe(t,e,r,i){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function DXe(t,e,r,i){if(e===null||typeof e>"u"||$Xe(t,e,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function bh(t,e,r,i,n,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Mc={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Mc[t]=new bh(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Mc[e]=new bh(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Mc[t]=new bh(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Mc[t]=new bh(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Mc[t]=new bh(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Mc[t]=new bh(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Mc[t]=new bh(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Mc[t]=new bh(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Mc[t]=new bh(t,5,!1,t.toLowerCase(),null,!1,!1)});var Woe=/[\-:]([a-z])/g;function Qoe(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Woe,Qoe);Mc[e]=new bh(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Woe,Qoe);Mc[e]=new bh(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Woe,Qoe);Mc[e]=new bh(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Mc[t]=new bh(t,1,!1,t.toLowerCase(),null,!1,!1)});Mc.xlinkHref=new bh("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Mc[t]=new bh(t,1,!1,t.toLowerCase(),null,!0,!0)});function Yoe(t,e,r,i){var n=Mc.hasOwnProperty(e)?Mc[e]:null;(n!==null?n.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(DXe(e,r,n,i)&&(r=null),i||n===null?IXe(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):n.mustUseProperty?t[n.propertyName]=r===null?n.type===3?!1:"":r:(e=n.attributeName,i=n.attributeNamespace,r===null?t.removeAttribute(e):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,i?t.setAttributeNS(i,e,r):t.setAttribute(e,r))))}var A1=N3e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,VF=Symbol.for("react.element"),rM=Symbol.for("react.portal"),iM=Symbol.for("react.fragment"),Xoe=Symbol.for("react.strict_mode"),YZ=Symbol.for("react.profiler"),k3e=Symbol.for("react.provider"),U3e=Symbol.for("react.context"),Zoe=Symbol.for("react.forward_ref"),XZ=Symbol.for("react.suspense"),ZZ=Symbol.for("react.suspense_list"),Joe=Symbol.for("react.memo"),cb=Symbol.for("react.lazy"),B3e=Symbol.for("react.offscreen"),a0e=Symbol.iterator;function HP(t){return t===null||typeof t!="object"?null:(t=a0e&&t[a0e]||t["@@iterator"],typeof t=="function"?t:null)}var Vo=Object.assign,Rq;function _$(t){if(Rq===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);Rq=e&&e[1]||""}return`
`+Rq+t}var Oq=!1;function Pq(t,e){if(!t||Oq)return"";Oq=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=i.stack.split(`
`),o=n.length-1,a=s.length-1;1<=o&&0<=a&&n[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||n[o]!==s[a]){var l=`
`+n[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{Oq=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?_$(t):""}function LXe(t){switch(t.tag){case 5:return _$(t.type);case 16:return _$("Lazy");case 13:return _$("Suspense");case 19:return _$("SuspenseList");case 0:case 2:case 15:return t=Pq(t.type,!1),t;case 11:return t=Pq(t.type.render,!1),t;case 1:return t=Pq(t.type,!0),t;default:return""}}function JZ(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case iM:return"Fragment";case rM:return"Portal";case YZ:return"Profiler";case Xoe:return"StrictMode";case XZ:return"Suspense";case ZZ:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case U3e:return(t.displayName||"Context")+".Consumer";case k3e:return(t._context.displayName||"Context")+".Provider";case Zoe:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Joe:return e=t.displayName||null,e!==null?e:JZ(t.type)||"Memo";case cb:e=t._payload,t=t._init;try{return JZ(t(e))}catch{}}return null}function NXe(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return JZ(e);case 8:return e===Xoe?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function b2(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function z3e(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function FXe(t){var e=z3e(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,s=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return n.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function GF(t){t._valueTracker||(t._valueTracker=FXe(t))}function V3e(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),i="";return t&&(i=z3e(t)?t.checked?"true":"false":t.value),t=i,t!==r?(e.setValue(t),!0):!1}function OU(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function KZ(t,e){var r=e.checked;return Vo({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function l0e(t,e){var r=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;r=b2(e.value!=null?e.value:r),t._wrapperState={initialChecked:i,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function G3e(t,e){e=e.checked,e!=null&&Yoe(t,"checked",e,!1)}function eJ(t,e){G3e(t,e);var r=b2(e.value),i=e.type;if(r!=null)i==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?tJ(t,e.type,r):e.hasOwnProperty("defaultValue")&&tJ(t,e.type,b2(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function c0e(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function tJ(t,e,r){(e!=="number"||OU(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var v$=Array.isArray;function kM(t,e,r,i){if(t=t.options,e){e={};for(var n=0;n<r.length;n++)e["$"+r[n]]=!0;for(r=0;r<t.length;r++)n=e.hasOwnProperty("$"+t[r].value),t[r].selected!==n&&(t[r].selected=n),n&&i&&(t[r].defaultSelected=!0)}else{for(r=""+b2(r),e=null,n=0;n<t.length;n++){if(t[n].value===r){t[n].selected=!0,i&&(t[n].defaultSelected=!0);return}e!==null||t[n].disabled||(e=t[n])}e!==null&&(e.selected=!0)}}function rJ(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(At(91));return Vo({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function u0e(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(At(92));if(v$(r)){if(1<r.length)throw Error(At(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:b2(r)}}function j3e(t,e){var r=b2(e.value),i=b2(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),i!=null&&(t.defaultValue=""+i)}function h0e(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function H3e(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function iJ(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?H3e(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var jF,q3e=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,i,n){MSApp.execUnsafeLocalFunction(function(){return t(e,r,i,n)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(jF=jF||document.createElement("div"),jF.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=jF.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function mD(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var i5={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},kXe=["Webkit","ms","Moz","O"];Object.keys(i5).forEach(function(t){kXe.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),i5[e]=i5[t]})});function W3e(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||i5.hasOwnProperty(t)&&i5[t]?(""+e).trim():e+"px"}function Q3e(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var i=r.indexOf("--")===0,n=W3e(r,e[r],i);r==="float"&&(r="cssFloat"),i?t.setProperty(r,n):t[r]=n}}var UXe=Vo({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function nJ(t,e){if(e){if(UXe[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(At(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(At(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(At(61))}if(e.style!=null&&typeof e.style!="object")throw Error(At(62))}}function sJ(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oJ=null;function Koe(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var aJ=null,UM=null,BM=null;function d0e(t){if(t=fN(t)){if(typeof aJ!="function")throw Error(At(280));var e=t.stateNode;e&&(e=iG(e),aJ(t.stateNode,t.type,e))}}function Y3e(t){UM?BM?BM.push(t):BM=[t]:UM=t}function X3e(){if(UM){var t=UM,e=BM;if(BM=UM=null,d0e(t),e)for(t=0;t<e.length;t++)d0e(e[t])}}function Z3e(t,e){return t(e)}function J3e(){}var Iq=!1;function K3e(t,e,r){if(Iq)return t(e,r);Iq=!0;try{return Z3e(t,e,r)}finally{Iq=!1,(UM!==null||BM!==null)&&(J3e(),X3e())}}function gD(t,e){var r=t.stateNode;if(r===null)return null;var i=iG(r);if(i===null)return null;r=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(At(231,e,typeof r));return r}var lJ=!1;if(Q_)try{var qP={};Object.defineProperty(qP,"passive",{get:function(){lJ=!0}}),window.addEventListener("test",qP,qP),window.removeEventListener("test",qP,qP)}catch{lJ=!1}function BXe(t,e,r,i,n,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(r,c)}catch(u){this.onError(u)}}var n5=!1,PU=null,IU=!1,cJ=null,zXe={onError:function(t){n5=!0,PU=t}};function VXe(t,e,r,i,n,s,o,a,l){n5=!1,PU=null,BXe.apply(zXe,arguments)}function GXe(t,e,r,i,n,s,o,a,l){if(VXe.apply(this,arguments),n5){if(n5){var c=PU;n5=!1,PU=null}else throw Error(At(198));IU||(IU=!0,cJ=c)}}function pE(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function eCe(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function p0e(t){if(pE(t)!==t)throw Error(At(188))}function jXe(t){var e=t.alternate;if(!e){if(e=pE(t),e===null)throw Error(At(188));return e!==t?null:t}for(var r=t,i=e;;){var n=r.return;if(n===null)break;var s=n.alternate;if(s===null){if(i=n.return,i!==null){r=i;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===r)return p0e(n),t;if(s===i)return p0e(n),e;s=s.sibling}throw Error(At(188))}if(r.return!==i.return)r=n,i=s;else{for(var o=!1,a=n.child;a;){if(a===r){o=!0,r=n,i=s;break}if(a===i){o=!0,i=n,r=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===r){o=!0,r=s,i=n;break}if(a===i){o=!0,i=s,r=n;break}a=a.sibling}if(!o)throw Error(At(189))}}if(r.alternate!==i)throw Error(At(190))}if(r.tag!==3)throw Error(At(188));return r.stateNode.current===r?t:e}function tCe(t){return t=jXe(t),t!==null?rCe(t):null}function rCe(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=rCe(t);if(e!==null)return e;t=t.sibling}return null}var iCe=vp.unstable_scheduleCallback,f0e=vp.unstable_cancelCallback,HXe=vp.unstable_shouldYield,qXe=vp.unstable_requestPaint,Ca=vp.unstable_now,WXe=vp.unstable_getCurrentPriorityLevel,eae=vp.unstable_ImmediatePriority,nCe=vp.unstable_UserBlockingPriority,$U=vp.unstable_NormalPriority,QXe=vp.unstable_LowPriority,sCe=vp.unstable_IdlePriority,KV=null,gA=null;function YXe(t){if(gA&&typeof gA.onCommitFiberRoot=="function")try{gA.onCommitFiberRoot(KV,t,void 0,(t.current.flags&128)===128)}catch{}}var vm=Math.clz32?Math.clz32:JXe,XXe=Math.log,ZXe=Math.LN2;function JXe(t){return t>>>=0,t===0?32:31-(XXe(t)/ZXe|0)|0}var HF=64,qF=4194304;function b$(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function DU(t,e){var r=t.pendingLanes;if(r===0)return 0;var i=0,n=t.suspendedLanes,s=t.pingedLanes,o=r&268435455;if(o!==0){var a=o&~n;a!==0?i=b$(a):(s&=o,s!==0&&(i=b$(s)))}else o=r&~n,o!==0?i=b$(o):s!==0&&(i=b$(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&n)&&(n=i&-i,s=e&-e,n>=s||n===16&&(s&4194240)!==0))return e;if(i&4&&(i|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)r=31-vm(e),n=1<<r,i|=t[r],e&=~n;return i}function KXe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eZe(t,e){for(var r=t.suspendedLanes,i=t.pingedLanes,n=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-vm(s),a=1<<o,l=n[o];l===-1?(!(a&r)||a&i)&&(n[o]=KXe(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function uJ(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function oCe(){var t=HF;return HF<<=1,!(HF&4194240)&&(HF=64),t}function $q(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function dN(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-vm(e),t[e]=r}function tZe(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<r;){var n=31-vm(r),s=1<<n;e[n]=0,i[n]=-1,t[n]=-1,r&=~s}}function tae(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var i=31-vm(r),n=1<<i;n&e|t[i]&e&&(t[i]|=e),r&=~n}}var Ss=0;function aCe(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var lCe,rae,cCe,uCe,hCe,hJ=!1,WF=[],t2=null,r2=null,i2=null,AD=new Map,yD=new Map,xb=[],rZe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function m0e(t,e){switch(t){case"focusin":case"focusout":t2=null;break;case"dragenter":case"dragleave":r2=null;break;case"mouseover":case"mouseout":i2=null;break;case"pointerover":case"pointerout":AD.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":yD.delete(e.pointerId)}}function WP(t,e,r,i,n,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:r,eventSystemFlags:i,nativeEvent:s,targetContainers:[n]},e!==null&&(e=fN(e),e!==null&&rae(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,n!==null&&e.indexOf(n)===-1&&e.push(n),t)}function iZe(t,e,r,i,n){switch(e){case"focusin":return t2=WP(t2,t,e,r,i,n),!0;case"dragenter":return r2=WP(r2,t,e,r,i,n),!0;case"mouseover":return i2=WP(i2,t,e,r,i,n),!0;case"pointerover":var s=n.pointerId;return AD.set(s,WP(AD.get(s)||null,t,e,r,i,n)),!0;case"gotpointercapture":return s=n.pointerId,yD.set(s,WP(yD.get(s)||null,t,e,r,i,n)),!0}return!1}function dCe(t){var e=MT(t.target);if(e!==null){var r=pE(e);if(r!==null){if(e=r.tag,e===13){if(e=eCe(r),e!==null){t.blockedOn=e,hCe(t.priority,function(){cCe(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function _7(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=dJ(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var i=new r.constructor(r.type,r);oJ=i,r.target.dispatchEvent(i),oJ=null}else return e=fN(r),e!==null&&rae(e),t.blockedOn=r,!1;e.shift()}return!0}function g0e(t,e,r){_7(t)&&r.delete(e)}function nZe(){hJ=!1,t2!==null&&_7(t2)&&(t2=null),r2!==null&&_7(r2)&&(r2=null),i2!==null&&_7(i2)&&(i2=null),AD.forEach(g0e),yD.forEach(g0e)}function QP(t,e){t.blockedOn===e&&(t.blockedOn=null,hJ||(hJ=!0,vp.unstable_scheduleCallback(vp.unstable_NormalPriority,nZe)))}function _D(t){function e(n){return QP(n,t)}if(0<WF.length){QP(WF[0],t);for(var r=1;r<WF.length;r++){var i=WF[r];i.blockedOn===t&&(i.blockedOn=null)}}for(t2!==null&&QP(t2,t),r2!==null&&QP(r2,t),i2!==null&&QP(i2,t),AD.forEach(e),yD.forEach(e),r=0;r<xb.length;r++)i=xb[r],i.blockedOn===t&&(i.blockedOn=null);for(;0<xb.length&&(r=xb[0],r.blockedOn===null);)dCe(r),r.blockedOn===null&&xb.shift()}var zM=A1.ReactCurrentBatchConfig,LU=!0;function sZe(t,e,r,i){var n=Ss,s=zM.transition;zM.transition=null;try{Ss=1,iae(t,e,r,i)}finally{Ss=n,zM.transition=s}}function oZe(t,e,r,i){var n=Ss,s=zM.transition;zM.transition=null;try{Ss=4,iae(t,e,r,i)}finally{Ss=n,zM.transition=s}}function iae(t,e,r,i){if(LU){var n=dJ(t,e,r,i);if(n===null)Gq(t,e,i,NU,r),m0e(t,i);else if(iZe(n,t,e,r,i))i.stopPropagation();else if(m0e(t,i),e&4&&-1<rZe.indexOf(t)){for(;n!==null;){var s=fN(n);if(s!==null&&lCe(s),s=dJ(t,e,r,i),s===null&&Gq(t,e,i,NU,r),s===n)break;n=s}n!==null&&i.stopPropagation()}else Gq(t,e,i,null,r)}}var NU=null;function dJ(t,e,r,i){if(NU=null,t=Koe(i),t=MT(t),t!==null)if(e=pE(t),e===null)t=null;else if(r=e.tag,r===13){if(t=eCe(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return NU=t,null}function pCe(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(WXe()){case eae:return 1;case nCe:return 4;case $U:case QXe:return 16;case sCe:return 536870912;default:return 16}default:return 16}}var Lb=null,nae=null,v7=null;function fCe(){if(v7)return v7;var t,e=nae,r=e.length,i,n="value"in Lb?Lb.value:Lb.textContent,s=n.length;for(t=0;t<r&&e[t]===n[t];t++);var o=r-t;for(i=1;i<=o&&e[r-i]===n[s-i];i++);return v7=n.slice(t,1<i?1-i:void 0)}function b7(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function QF(){return!0}function A0e(){return!1}function Rp(t){function e(r,i,n,s,o){this._reactName=r,this._targetInst=n,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?QF:A0e,this.isPropagationStopped=A0e,this}return Vo(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=QF)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=QF)},persist:function(){},isPersistent:QF}),e}var HO={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},sae=Rp(HO),pN=Vo({},HO,{view:0,detail:0}),aZe=Rp(pN),Dq,Lq,YP,eG=Vo({},pN,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:oae,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==YP&&(YP&&t.type==="mousemove"?(Dq=t.screenX-YP.screenX,Lq=t.screenY-YP.screenY):Lq=Dq=0,YP=t),Dq)},movementY:function(t){return"movementY"in t?t.movementY:Lq}}),y0e=Rp(eG),lZe=Vo({},eG,{dataTransfer:0}),cZe=Rp(lZe),uZe=Vo({},pN,{relatedTarget:0}),Nq=Rp(uZe),hZe=Vo({},HO,{animationName:0,elapsedTime:0,pseudoElement:0}),dZe=Rp(hZe),pZe=Vo({},HO,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),fZe=Rp(pZe),mZe=Vo({},HO,{data:0}),_0e=Rp(mZe),gZe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},AZe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yZe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _Ze(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=yZe[t])?!!e[t]:!1}function oae(){return _Ze}var vZe=Vo({},pN,{key:function(t){if(t.key){var e=gZe[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=b7(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?AZe[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:oae,charCode:function(t){return t.type==="keypress"?b7(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?b7(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),bZe=Rp(vZe),wZe=Vo({},eG,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),v0e=Rp(wZe),xZe=Vo({},pN,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:oae}),TZe=Rp(xZe),SZe=Vo({},HO,{propertyName:0,elapsedTime:0,pseudoElement:0}),EZe=Rp(SZe),CZe=Vo({},eG,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),MZe=Rp(CZe),RZe=[9,13,27,32],aae=Q_&&"CompositionEvent"in window,s5=null;Q_&&"documentMode"in document&&(s5=document.documentMode);var OZe=Q_&&"TextEvent"in window&&!s5,mCe=Q_&&(!aae||s5&&8<s5&&11>=s5),b0e=String.fromCharCode(32),w0e=!1;function gCe(t,e){switch(t){case"keyup":return RZe.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ACe(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var nM=!1;function PZe(t,e){switch(t){case"compositionend":return ACe(e);case"keypress":return e.which!==32?null:(w0e=!0,b0e);case"textInput":return t=e.data,t===b0e&&w0e?null:t;default:return null}}function IZe(t,e){if(nM)return t==="compositionend"||!aae&&gCe(t,e)?(t=fCe(),v7=nae=Lb=null,nM=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return mCe&&e.locale!=="ko"?null:e.data;default:return null}}var $Ze={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function x0e(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!$Ze[t.type]:e==="textarea"}function yCe(t,e,r,i){Y3e(i),e=FU(e,"onChange"),0<e.length&&(r=new sae("onChange","change",null,r,i),t.push({event:r,listeners:e}))}var o5=null,vD=null;function DZe(t){RCe(t,0)}function tG(t){var e=aM(t);if(V3e(e))return t}function LZe(t,e){if(t==="change")return e}var _Ce=!1;if(Q_){var Fq;if(Q_){var kq="oninput"in document;if(!kq){var T0e=document.createElement("div");T0e.setAttribute("oninput","return;"),kq=typeof T0e.oninput=="function"}Fq=kq}else Fq=!1;_Ce=Fq&&(!document.documentMode||9<document.documentMode)}function S0e(){o5&&(o5.detachEvent("onpropertychange",vCe),vD=o5=null)}function vCe(t){if(t.propertyName==="value"&&tG(vD)){var e=[];yCe(e,vD,t,Koe(t)),K3e(DZe,e)}}function NZe(t,e,r){t==="focusin"?(S0e(),o5=e,vD=r,o5.attachEvent("onpropertychange",vCe)):t==="focusout"&&S0e()}function FZe(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return tG(vD)}function kZe(t,e){if(t==="click")return tG(e)}function UZe(t,e){if(t==="input"||t==="change")return tG(e)}function BZe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Mm=typeof Object.is=="function"?Object.is:BZe;function bD(t,e){if(Mm(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!QZ.call(e,n)||!Mm(t[n],e[n]))return!1}return!0}function E0e(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function C0e(t,e){var r=E0e(t);t=0;for(var i;r;){if(r.nodeType===3){if(i=t+r.textContent.length,t<=e&&i>=e)return{node:r,offset:e-t};t=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=E0e(r)}}function bCe(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?bCe(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function wCe(){for(var t=window,e=OU();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=OU(t.document)}return e}function lae(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function zZe(t){var e=wCe(),r=t.focusedElem,i=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&bCe(r.ownerDocument.documentElement,r)){if(i!==null&&lae(r)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var n=r.textContent.length,s=Math.min(i.start,n);i=i.end===void 0?s:Math.min(i.end,n),!t.extend&&s>i&&(n=i,i=s,s=n),n=C0e(r,s);var o=C0e(r,i);n&&o&&(t.rangeCount!==1||t.anchorNode!==n.node||t.anchorOffset!==n.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(n.node,n.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var VZe=Q_&&"documentMode"in document&&11>=document.documentMode,sM=null,pJ=null,a5=null,fJ=!1;function M0e(t,e,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;fJ||sM==null||sM!==OU(i)||(i=sM,"selectionStart"in i&&lae(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),a5&&bD(a5,i)||(a5=i,i=FU(pJ,"onSelect"),0<i.length&&(e=new sae("onSelect","select",null,e,r),t.push({event:e,listeners:i}),e.target=sM)))}function YF(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var oM={animationend:YF("Animation","AnimationEnd"),animationiteration:YF("Animation","AnimationIteration"),animationstart:YF("Animation","AnimationStart"),transitionend:YF("Transition","TransitionEnd")},Uq={},xCe={};Q_&&(xCe=document.createElement("div").style,"AnimationEvent"in window||(delete oM.animationend.animation,delete oM.animationiteration.animation,delete oM.animationstart.animation),"TransitionEvent"in window||delete oM.transitionend.transition);function rG(t){if(Uq[t])return Uq[t];if(!oM[t])return t;var e=oM[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in xCe)return Uq[t]=e[r];return t}var TCe=rG("animationend"),SCe=rG("animationiteration"),ECe=rG("animationstart"),CCe=rG("transitionend"),MCe=new Map,R0e="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Y2(t,e){MCe.set(t,e),dE(e,[t])}for(var Bq=0;Bq<R0e.length;Bq++){var zq=R0e[Bq],GZe=zq.toLowerCase(),jZe=zq[0].toUpperCase()+zq.slice(1);Y2(GZe,"on"+jZe)}Y2(TCe,"onAnimationEnd");Y2(SCe,"onAnimationIteration");Y2(ECe,"onAnimationStart");Y2("dblclick","onDoubleClick");Y2("focusin","onFocus");Y2("focusout","onBlur");Y2(CCe,"onTransitionEnd");CR("onMouseEnter",["mouseout","mouseover"]);CR("onMouseLeave",["mouseout","mouseover"]);CR("onPointerEnter",["pointerout","pointerover"]);CR("onPointerLeave",["pointerout","pointerover"]);dE("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));dE("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));dE("onBeforeInput",["compositionend","keypress","textInput","paste"]);dE("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));dE("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));dE("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var w$="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),HZe=new Set("cancel close invalid load scroll toggle".split(" ").concat(w$));function O0e(t,e,r){var i=t.type||"unknown-event";t.currentTarget=r,GXe(i,e,void 0,t),t.currentTarget=null}function RCe(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var i=t[r],n=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&n.isPropagationStopped())break e;O0e(n,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&n.isPropagationStopped())break e;O0e(n,a,c),s=l}}}if(IU)throw t=cJ,IU=!1,cJ=null,t}function po(t,e){var r=e[_J];r===void 0&&(r=e[_J]=new Set);var i=t+"__bubble";r.has(i)||(OCe(e,t,2,!1),r.add(i))}function Vq(t,e,r){var i=0;e&&(i|=4),OCe(r,t,i,e)}var XF="_reactListening"+Math.random().toString(36).slice(2);function wD(t){if(!t[XF]){t[XF]=!0,F3e.forEach(function(r){r!=="selectionchange"&&(HZe.has(r)||Vq(r,!1,t),Vq(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[XF]||(e[XF]=!0,Vq("selectionchange",!1,e))}}function OCe(t,e,r,i){switch(pCe(e)){case 1:var n=sZe;break;case 4:n=oZe;break;default:n=iae}r=n.bind(null,e,r,t),n=void 0,!lJ||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(n=!0),i?n!==void 0?t.addEventListener(e,r,{capture:!0,passive:n}):t.addEventListener(e,r,!0):n!==void 0?t.addEventListener(e,r,{passive:n}):t.addEventListener(e,r,!1)}function Gq(t,e,r,i,n){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===n||a.nodeType===8&&a.parentNode===n)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;o=o.return}for(;a!==null;){if(o=MT(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}K3e(function(){var c=s,u=Koe(r),d=[];e:{var p=MCe.get(t);if(p!==void 0){var A=sae,v=t;switch(t){case"keypress":if(b7(r)===0)break e;case"keydown":case"keyup":A=bZe;break;case"focusin":v="focus",A=Nq;break;case"focusout":v="blur",A=Nq;break;case"beforeblur":case"afterblur":A=Nq;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=y0e;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=cZe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=TZe;break;case TCe:case SCe:case ECe:A=dZe;break;case CCe:A=EZe;break;case"scroll":A=aZe;break;case"wheel":A=MZe;break;case"copy":case"cut":case"paste":A=fZe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=v0e}var b=(e&4)!==0,S=!b&&t==="scroll",E=b?p!==null?p+"Capture":null:p;b=[];for(var R=c,O;R!==null;){O=R;var I=O.stateNode;if(O.tag===5&&I!==null&&(O=I,E!==null&&(I=gD(R,E),I!=null&&b.push(xD(R,I,O)))),S)break;R=R.return}0<b.length&&(p=new A(p,v,null,r,u),d.push({event:p,listeners:b}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",A=t==="mouseout"||t==="pointerout",p&&r!==oJ&&(v=r.relatedTarget||r.fromElement)&&(MT(v)||v[Y_]))break e;if((A||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,A?(v=r.relatedTarget||r.toElement,A=c,v=v?MT(v):null,v!==null&&(S=pE(v),v!==S||v.tag!==5&&v.tag!==6)&&(v=null)):(A=null,v=c),A!==v)){if(b=y0e,I="onMouseLeave",E="onMouseEnter",R="mouse",(t==="pointerout"||t==="pointerover")&&(b=v0e,I="onPointerLeave",E="onPointerEnter",R="pointer"),S=A==null?p:aM(A),O=v==null?p:aM(v),p=new b(I,R+"leave",A,r,u),p.target=S,p.relatedTarget=O,I=null,MT(u)===c&&(b=new b(E,R+"enter",v,r,u),b.target=O,b.relatedTarget=S,I=b),S=I,A&&v)t:{for(b=A,E=v,R=0,O=b;O;O=BE(O))R++;for(O=0,I=E;I;I=BE(I))O++;for(;0<R-O;)b=BE(b),R--;for(;0<O-R;)E=BE(E),O--;for(;R--;){if(b===E||E!==null&&b===E.alternate)break t;b=BE(b),E=BE(E)}b=null}else b=null;A!==null&&P0e(d,p,A,b,!1),v!==null&&S!==null&&P0e(d,S,v,b,!0)}}e:{if(p=c?aM(c):window,A=p.nodeName&&p.nodeName.toLowerCase(),A==="select"||A==="input"&&p.type==="file")var N=LZe;else if(x0e(p))if(_Ce)N=UZe;else{N=FZe;var L=NZe}else(A=p.nodeName)&&A.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(N=kZe);if(N&&(N=N(t,c))){yCe(d,N,r,u);break e}L&&L(t,p,c),t==="focusout"&&(L=p._wrapperState)&&L.controlled&&p.type==="number"&&tJ(p,"number",p.value)}switch(L=c?aM(c):window,t){case"focusin":(x0e(L)||L.contentEditable==="true")&&(sM=L,pJ=c,a5=null);break;case"focusout":a5=pJ=sM=null;break;case"mousedown":fJ=!0;break;case"contextmenu":case"mouseup":case"dragend":fJ=!1,M0e(d,r,u);break;case"selectionchange":if(VZe)break;case"keydown":case"keyup":M0e(d,r,u)}var B;if(aae)e:{switch(t){case"compositionstart":var U="onCompositionStart";break e;case"compositionend":U="onCompositionEnd";break e;case"compositionupdate":U="onCompositionUpdate";break e}U=void 0}else nM?gCe(t,r)&&(U="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(U="onCompositionStart");U&&(mCe&&r.locale!=="ko"&&(nM||U!=="onCompositionStart"?U==="onCompositionEnd"&&nM&&(B=fCe()):(Lb=u,nae="value"in Lb?Lb.value:Lb.textContent,nM=!0)),L=FU(c,U),0<L.length&&(U=new _0e(U,t,null,r,u),d.push({event:U,listeners:L}),B?U.data=B:(B=ACe(r),B!==null&&(U.data=B)))),(B=OZe?PZe(t,r):IZe(t,r))&&(c=FU(c,"onBeforeInput"),0<c.length&&(u=new _0e("onBeforeInput","beforeinput",null,r,u),d.push({event:u,listeners:c}),u.data=B))}RCe(d,e)})}function xD(t,e,r){return{instance:t,listener:e,currentTarget:r}}function FU(t,e){for(var r=e+"Capture",i=[];t!==null;){var n=t,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=gD(t,r),s!=null&&i.unshift(xD(t,s,n)),s=gD(t,e),s!=null&&i.push(xD(t,s,n))),t=t.return}return i}function BE(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function P0e(t,e,r,i,n){for(var s=e._reactName,o=[];r!==null&&r!==i;){var a=r,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,n?(l=gD(r,s),l!=null&&o.unshift(xD(r,l,a))):n||(l=gD(r,s),l!=null&&o.push(xD(r,l,a)))),r=r.return}o.length!==0&&t.push({event:e,listeners:o})}var qZe=/\r\n?/g,WZe=/\u0000|\uFFFD/g;function I0e(t){return(typeof t=="string"?t:""+t).replace(qZe,`
`).replace(WZe,"")}function ZF(t,e,r){if(e=I0e(e),I0e(t)!==e&&r)throw Error(At(425))}function kU(){}var mJ=null,gJ=null;function AJ(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var yJ=typeof setTimeout=="function"?setTimeout:void 0,QZe=typeof clearTimeout=="function"?clearTimeout:void 0,$0e=typeof Promise=="function"?Promise:void 0,YZe=typeof queueMicrotask=="function"?queueMicrotask:typeof $0e<"u"?function(t){return $0e.resolve(null).then(t).catch(XZe)}:yJ;function XZe(t){setTimeout(function(){throw t})}function jq(t,e){var r=e,i=0;do{var n=r.nextSibling;if(t.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(i===0){t.removeChild(n),_D(e);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=n}while(r);_D(e)}function n2(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function D0e(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var qO=Math.random().toString(36).slice(2),eA="__reactFiber$"+qO,TD="__reactProps$"+qO,Y_="__reactContainer$"+qO,_J="__reactEvents$"+qO,ZZe="__reactListeners$"+qO,JZe="__reactHandles$"+qO;function MT(t){var e=t[eA];if(e)return e;for(var r=t.parentNode;r;){if(e=r[Y_]||r[eA]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=D0e(t);t!==null;){if(r=t[eA])return r;t=D0e(t)}return e}t=r,r=t.parentNode}return null}function fN(t){return t=t[eA]||t[Y_],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function aM(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(At(33))}function iG(t){return t[TD]||null}var vJ=[],lM=-1;function X2(t){return{current:t}}function So(t){0>lM||(t.current=vJ[lM],vJ[lM]=null,lM--)}function ao(t,e){lM++,vJ[lM]=t.current,t.current=e}var w2={},vu=X2(w2),ld=X2(!1),dS=w2;function MR(t,e){var r=t.type.contextTypes;if(!r)return w2;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in r)n[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=n),n}function cd(t){return t=t.childContextTypes,t!=null}function UU(){So(ld),So(vu)}function L0e(t,e,r){if(vu.current!==w2)throw Error(At(168));ao(vu,e),ao(ld,r)}function PCe(t,e,r){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var n in i)if(!(n in e))throw Error(At(108,NXe(t)||"Unknown",n));return Vo({},r,i)}function BU(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||w2,dS=vu.current,ao(vu,t),ao(ld,ld.current),!0}function N0e(t,e,r){var i=t.stateNode;if(!i)throw Error(At(169));r?(t=PCe(t,e,dS),i.__reactInternalMemoizedMergedChildContext=t,So(ld),So(vu),ao(vu,t)):So(ld),ao(ld,r)}var f_=null,nG=!1,Hq=!1;function ICe(t){f_===null?f_=[t]:f_.push(t)}function KZe(t){nG=!0,ICe(t)}function Z2(){if(!Hq&&f_!==null){Hq=!0;var t=0,e=Ss;try{var r=f_;for(Ss=1;t<r.length;t++){var i=r[t];do i=i(!0);while(i!==null)}f_=null,nG=!1}catch(n){throw f_!==null&&(f_=f_.slice(t+1)),iCe(eae,Z2),n}finally{Ss=e,Hq=!1}}return null}var cM=[],uM=0,zU=null,VU=0,gf=[],Af=0,pS=null,T_=1,S_="";function ox(t,e){cM[uM++]=VU,cM[uM++]=zU,zU=t,VU=e}function $Ce(t,e,r){gf[Af++]=T_,gf[Af++]=S_,gf[Af++]=pS,pS=t;var i=T_;t=S_;var n=32-vm(i)-1;i&=~(1<<n),r+=1;var s=32-vm(e)+n;if(30<s){var o=n-n%5;s=(i&(1<<o)-1).toString(32),i>>=o,n-=o,T_=1<<32-vm(e)+n|r<<n|i,S_=s+t}else T_=1<<s|r<<n|i,S_=t}function cae(t){t.return!==null&&(ox(t,1),$Ce(t,1,0))}function uae(t){for(;t===zU;)zU=cM[--uM],cM[uM]=null,VU=cM[--uM],cM[uM]=null;for(;t===pS;)pS=gf[--Af],gf[Af]=null,S_=gf[--Af],gf[Af]=null,T_=gf[--Af],gf[Af]=null}var pp=null,lp=null,Io=!1,K0=null;function DCe(t,e){var r=Mf(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function F0e(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,pp=t,lp=n2(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,pp=t,lp=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=pS!==null?{id:T_,overflow:S_}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=Mf(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,pp=t,lp=null,!0):!1;default:return!1}}function bJ(t){return(t.mode&1)!==0&&(t.flags&128)===0}function wJ(t){if(Io){var e=lp;if(e){var r=e;if(!F0e(t,e)){if(bJ(t))throw Error(At(418));e=n2(r.nextSibling);var i=pp;e&&F0e(t,e)?DCe(i,r):(t.flags=t.flags&-4097|2,Io=!1,pp=t)}}else{if(bJ(t))throw Error(At(418));t.flags=t.flags&-4097|2,Io=!1,pp=t}}}function k0e(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;pp=t}function JF(t){if(t!==pp)return!1;if(!Io)return k0e(t),Io=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!AJ(t.type,t.memoizedProps)),e&&(e=lp)){if(bJ(t))throw LCe(),Error(At(418));for(;e;)DCe(t,e),e=n2(e.nextSibling)}if(k0e(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(At(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){lp=n2(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}lp=null}}else lp=pp?n2(t.stateNode.nextSibling):null;return!0}function LCe(){for(var t=lp;t;)t=n2(t.nextSibling)}function RR(){lp=pp=null,Io=!1}function hae(t){K0===null?K0=[t]:K0.push(t)}var eJe=A1.ReactCurrentBatchConfig;function j0(t,e){if(t&&t.defaultProps){e=Vo({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}var GU=X2(null),jU=null,hM=null,dae=null;function pae(){dae=hM=jU=null}function fae(t){var e=GU.current;So(GU),t._currentValue=e}function xJ(t,e,r){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===r)break;t=t.return}}function VM(t,e){jU=t,dae=hM=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(id=!0),t.firstContext=null)}function zf(t){var e=t._currentValue;if(dae!==t)if(t={context:t,memoizedValue:e,next:null},hM===null){if(jU===null)throw Error(At(308));hM=t,jU.dependencies={lanes:0,firstContext:t}}else hM=hM.next=t;return e}var RT=null;function mae(t){RT===null?RT=[t]:RT.push(t)}function NCe(t,e,r,i){var n=e.interleaved;return n===null?(r.next=r,mae(e)):(r.next=n.next,n.next=r),e.interleaved=r,X_(t,i)}function X_(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var ub=!1;function gae(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function FCe(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function D_(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function s2(t,e,r){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Bn&2){var n=i.pending;return n===null?e.next=e:(e.next=n.next,n.next=e),i.pending=e,X_(t,r)}return n=i.interleaved,n===null?(e.next=e,mae(i)):(e.next=n.next,n.next=e),i.interleaved=e,X_(t,r)}function w7(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,tae(t,r)}}function U0e(t,e){var r=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var n=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?n=s=o:s=s.next=o,r=r.next}while(r!==null);s===null?n=s=e:s=s.next=e}else n=s=e;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function HU(t,e,r,i){var n=t.updateQueue;ub=!1;var s=n.firstBaseUpdate,o=n.lastBaseUpdate,a=n.shared.pending;if(a!==null){n.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=n.baseState;o=0,u=c=l=null,a=s;do{var p=a.lane,A=a.eventTime;if((i&p)===p){u!==null&&(u=u.next={eventTime:A,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var v=t,b=a;switch(p=e,A=r,b.tag){case 1:if(v=b.payload,typeof v=="function"){d=v.call(A,d,p);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=b.payload,p=typeof v=="function"?v.call(A,d,p):v,p==null)break e;d=Vo({},d,p);break e;case 2:ub=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,p=n.effects,p===null?n.effects=[a]:p.push(a))}else A={eventTime:A,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=A,l=d):u=u.next=A,o|=p;if(a=a.next,a===null){if(a=n.shared.pending,a===null)break;p=a,a=p.next,p.next=null,n.lastBaseUpdate=p,n.shared.pending=null}}while(1);if(u===null&&(l=d),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,e=n.shared.interleaved,e!==null){n=e;do o|=n.lane,n=n.next;while(n!==e)}else s===null&&(n.shared.lanes=0);mS|=o,t.lanes=o,t.memoizedState=d}}function B0e(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],n=i.callback;if(n!==null){if(i.callback=null,i=r,typeof n!="function")throw Error(At(191,n));n.call(i)}}}var kCe=new N3e.Component().refs;function TJ(t,e,r,i){e=t.memoizedState,r=r(i,e),r=r==null?e:Vo({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var sG={isMounted:function(t){return(t=t._reactInternals)?pE(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var i=hh(),n=a2(t),s=D_(i,n);s.payload=e,r!=null&&(s.callback=r),e=s2(t,s,n),e!==null&&(bm(e,t,n,i),w7(e,t,n))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var i=hh(),n=a2(t),s=D_(i,n);s.tag=1,s.payload=e,r!=null&&(s.callback=r),e=s2(t,s,n),e!==null&&(bm(e,t,n,i),w7(e,t,n))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=hh(),i=a2(t),n=D_(r,i);n.tag=2,e!=null&&(n.callback=e),e=s2(t,n,i),e!==null&&(bm(e,t,i,r),w7(e,t,i))}};function z0e(t,e,r,i,n,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!bD(r,i)||!bD(n,s):!0}function UCe(t,e,r){var i=!1,n=w2,s=e.contextType;return typeof s=="object"&&s!==null?s=zf(s):(n=cd(e)?dS:vu.current,i=e.contextTypes,s=(i=i!=null)?MR(t,n):w2),e=new e(r,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=sG,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=s),e}function V0e(t,e,r,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,i),e.state!==t&&sG.enqueueReplaceState(e,e.state,null)}function SJ(t,e,r,i){var n=t.stateNode;n.props=r,n.state=t.memoizedState,n.refs=kCe,gae(t);var s=e.contextType;typeof s=="object"&&s!==null?n.context=zf(s):(s=cd(e)?dS:vu.current,n.context=MR(t,s)),n.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(TJ(t,e,s,r),n.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(e=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),e!==n.state&&sG.enqueueReplaceState(n,n.state,null),HU(t,r,n,i),n.state=t.memoizedState),typeof n.componentDidMount=="function"&&(t.flags|=4194308)}function XP(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(At(309));var i=r.stateNode}if(!i)throw Error(At(147,t));var n=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=n.refs;a===kCe&&(a=n.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(At(284));if(!r._owner)throw Error(At(290,t))}return t}function KF(t,e){throw t=Object.prototype.toString.call(e),Error(At(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function G0e(t){var e=t._init;return e(t._payload)}function BCe(t){function e(E,R){if(t){var O=E.deletions;O===null?(E.deletions=[R],E.flags|=16):O.push(R)}}function r(E,R){if(!t)return null;for(;R!==null;)e(E,R),R=R.sibling;return null}function i(E,R){for(E=new Map;R!==null;)R.key!==null?E.set(R.key,R):E.set(R.index,R),R=R.sibling;return E}function n(E,R){return E=l2(E,R),E.index=0,E.sibling=null,E}function s(E,R,O){return E.index=O,t?(O=E.alternate,O!==null?(O=O.index,O<R?(E.flags|=2,R):O):(E.flags|=2,R)):(E.flags|=1048576,R)}function o(E){return t&&E.alternate===null&&(E.flags|=2),E}function a(E,R,O,I){return R===null||R.tag!==6?(R=Jq(O,E.mode,I),R.return=E,R):(R=n(R,O),R.return=E,R)}function l(E,R,O,I){var N=O.type;return N===iM?u(E,R,O.props.children,I,O.key):R!==null&&(R.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===cb&&G0e(N)===R.type)?(I=n(R,O.props),I.ref=XP(E,R,O),I.return=E,I):(I=M7(O.type,O.key,O.props,null,E.mode,I),I.ref=XP(E,R,O),I.return=E,I)}function c(E,R,O,I){return R===null||R.tag!==4||R.stateNode.containerInfo!==O.containerInfo||R.stateNode.implementation!==O.implementation?(R=Kq(O,E.mode,I),R.return=E,R):(R=n(R,O.children||[]),R.return=E,R)}function u(E,R,O,I,N){return R===null||R.tag!==7?(R=WT(O,E.mode,I,N),R.return=E,R):(R=n(R,O),R.return=E,R)}function d(E,R,O){if(typeof R=="string"&&R!==""||typeof R=="number")return R=Jq(""+R,E.mode,O),R.return=E,R;if(typeof R=="object"&&R!==null){switch(R.$$typeof){case VF:return O=M7(R.type,R.key,R.props,null,E.mode,O),O.ref=XP(E,null,R),O.return=E,O;case rM:return R=Kq(R,E.mode,O),R.return=E,R;case cb:var I=R._init;return d(E,I(R._payload),O)}if(v$(R)||HP(R))return R=WT(R,E.mode,O,null),R.return=E,R;KF(E,R)}return null}function p(E,R,O,I){var N=R!==null?R.key:null;if(typeof O=="string"&&O!==""||typeof O=="number")return N!==null?null:a(E,R,""+O,I);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case VF:return O.key===N?l(E,R,O,I):null;case rM:return O.key===N?c(E,R,O,I):null;case cb:return N=O._init,p(E,R,N(O._payload),I)}if(v$(O)||HP(O))return N!==null?null:u(E,R,O,I,null);KF(E,O)}return null}function A(E,R,O,I,N){if(typeof I=="string"&&I!==""||typeof I=="number")return E=E.get(O)||null,a(R,E,""+I,N);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case VF:return E=E.get(I.key===null?O:I.key)||null,l(R,E,I,N);case rM:return E=E.get(I.key===null?O:I.key)||null,c(R,E,I,N);case cb:var L=I._init;return A(E,R,O,L(I._payload),N)}if(v$(I)||HP(I))return E=E.get(O)||null,u(R,E,I,N,null);KF(R,I)}return null}function v(E,R,O,I){for(var N=null,L=null,B=R,U=R=0,q=null;B!==null&&U<O.length;U++){B.index>U?(q=B,B=null):q=B.sibling;var Z=p(E,B,O[U],I);if(Z===null){B===null&&(B=q);break}t&&B&&Z.alternate===null&&e(E,B),R=s(Z,R,U),L===null?N=Z:L.sibling=Z,L=Z,B=q}if(U===O.length)return r(E,B),Io&&ox(E,U),N;if(B===null){for(;U<O.length;U++)B=d(E,O[U],I),B!==null&&(R=s(B,R,U),L===null?N=B:L.sibling=B,L=B);return Io&&ox(E,U),N}for(B=i(E,B);U<O.length;U++)q=A(B,E,U,O[U],I),q!==null&&(t&&q.alternate!==null&&B.delete(q.key===null?U:q.key),R=s(q,R,U),L===null?N=q:L.sibling=q,L=q);return t&&B.forEach(function(X){return e(E,X)}),Io&&ox(E,U),N}function b(E,R,O,I){var N=HP(O);if(typeof N!="function")throw Error(At(150));if(O=N.call(O),O==null)throw Error(At(151));for(var L=N=null,B=R,U=R=0,q=null,Z=O.next();B!==null&&!Z.done;U++,Z=O.next()){B.index>U?(q=B,B=null):q=B.sibling;var X=p(E,B,Z.value,I);if(X===null){B===null&&(B=q);break}t&&B&&X.alternate===null&&e(E,B),R=s(X,R,U),L===null?N=X:L.sibling=X,L=X,B=q}if(Z.done)return r(E,B),Io&&ox(E,U),N;if(B===null){for(;!Z.done;U++,Z=O.next())Z=d(E,Z.value,I),Z!==null&&(R=s(Z,R,U),L===null?N=Z:L.sibling=Z,L=Z);return Io&&ox(E,U),N}for(B=i(E,B);!Z.done;U++,Z=O.next())Z=A(B,E,U,Z.value,I),Z!==null&&(t&&Z.alternate!==null&&B.delete(Z.key===null?U:Z.key),R=s(Z,R,U),L===null?N=Z:L.sibling=Z,L=Z);return t&&B.forEach(function(ee){return e(E,ee)}),Io&&ox(E,U),N}function S(E,R,O,I){if(typeof O=="object"&&O!==null&&O.type===iM&&O.key===null&&(O=O.props.children),typeof O=="object"&&O!==null){switch(O.$$typeof){case VF:e:{for(var N=O.key,L=R;L!==null;){if(L.key===N){if(N=O.type,N===iM){if(L.tag===7){r(E,L.sibling),R=n(L,O.props.children),R.return=E,E=R;break e}}else if(L.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===cb&&G0e(N)===L.type){r(E,L.sibling),R=n(L,O.props),R.ref=XP(E,L,O),R.return=E,E=R;break e}r(E,L);break}else e(E,L);L=L.sibling}O.type===iM?(R=WT(O.props.children,E.mode,I,O.key),R.return=E,E=R):(I=M7(O.type,O.key,O.props,null,E.mode,I),I.ref=XP(E,R,O),I.return=E,E=I)}return o(E);case rM:e:{for(L=O.key;R!==null;){if(R.key===L)if(R.tag===4&&R.stateNode.containerInfo===O.containerInfo&&R.stateNode.implementation===O.implementation){r(E,R.sibling),R=n(R,O.children||[]),R.return=E,E=R;break e}else{r(E,R);break}else e(E,R);R=R.sibling}R=Kq(O,E.mode,I),R.return=E,E=R}return o(E);case cb:return L=O._init,S(E,R,L(O._payload),I)}if(v$(O))return v(E,R,O,I);if(HP(O))return b(E,R,O,I);KF(E,O)}return typeof O=="string"&&O!==""||typeof O=="number"?(O=""+O,R!==null&&R.tag===6?(r(E,R.sibling),R=n(R,O),R.return=E,E=R):(r(E,R),R=Jq(O,E.mode,I),R.return=E,E=R),o(E)):r(E,R)}return S}var OR=BCe(!0),zCe=BCe(!1),mN={},AA=X2(mN),SD=X2(mN),ED=X2(mN);function OT(t){if(t===mN)throw Error(At(174));return t}function Aae(t,e){switch(ao(ED,e),ao(SD,t),ao(AA,mN),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:iJ(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=iJ(e,t)}So(AA),ao(AA,e)}function PR(){So(AA),So(SD),So(ED)}function VCe(t){OT(ED.current);var e=OT(AA.current),r=iJ(e,t.type);e!==r&&(ao(SD,t),ao(AA,r))}function yae(t){SD.current===t&&(So(AA),So(SD))}var ko=X2(0);function qU(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var qq=[];function _ae(){for(var t=0;t<qq.length;t++)qq[t]._workInProgressVersionPrimary=null;qq.length=0}var x7=A1.ReactCurrentDispatcher,Wq=A1.ReactCurrentBatchConfig,fS=0,Uo=null,_l=null,ql=null,WU=!1,l5=!1,CD=0,tJe=0;function Gc(){throw Error(At(321))}function vae(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!Mm(t[r],e[r]))return!1;return!0}function bae(t,e,r,i,n,s){if(fS=s,Uo=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,x7.current=t===null||t.memoizedState===null?sJe:oJe,t=r(i,n),l5){s=0;do{if(l5=!1,CD=0,25<=s)throw Error(At(301));s+=1,ql=_l=null,e.updateQueue=null,x7.current=aJe,t=r(i,n)}while(l5)}if(x7.current=QU,e=_l!==null&&_l.next!==null,fS=0,ql=_l=Uo=null,WU=!1,e)throw Error(At(300));return t}function wae(){var t=CD!==0;return CD=0,t}function qg(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ql===null?Uo.memoizedState=ql=t:ql=ql.next=t,ql}function Vf(){if(_l===null){var t=Uo.alternate;t=t!==null?t.memoizedState:null}else t=_l.next;var e=ql===null?Uo.memoizedState:ql.next;if(e!==null)ql=e,_l=t;else{if(t===null)throw Error(At(310));_l=t,t={memoizedState:_l.memoizedState,baseState:_l.baseState,baseQueue:_l.baseQueue,queue:_l.queue,next:null},ql===null?Uo.memoizedState=ql=t:ql=ql.next=t}return ql}function MD(t,e){return typeof e=="function"?e(t):e}function Qq(t){var e=Vf(),r=e.queue;if(r===null)throw Error(At(311));r.lastRenderedReducer=t;var i=_l,n=i.baseQueue,s=r.pending;if(s!==null){if(n!==null){var o=n.next;n.next=s.next,s.next=o}i.baseQueue=n=s,r.pending=null}if(n!==null){s=n.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((fS&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=i):l=l.next=d,Uo.lanes|=u,mS|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,Mm(i,e.memoizedState)||(id=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,r.lastRenderedState=i}if(t=r.interleaved,t!==null){n=t;do s=n.lane,Uo.lanes|=s,mS|=s,n=n.next;while(n!==t)}else n===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function Yq(t){var e=Vf(),r=e.queue;if(r===null)throw Error(At(311));r.lastRenderedReducer=t;var i=r.dispatch,n=r.pending,s=e.memoizedState;if(n!==null){r.pending=null;var o=n=n.next;do s=t(s,o.action),o=o.next;while(o!==n);Mm(s,e.memoizedState)||(id=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),r.lastRenderedState=s}return[s,i]}function GCe(){}function jCe(t,e){var r=Uo,i=Vf(),n=e(),s=!Mm(i.memoizedState,n);if(s&&(i.memoizedState=n,id=!0),i=i.queue,xae(WCe.bind(null,r,i,t),[t]),i.getSnapshot!==e||s||ql!==null&&ql.memoizedState.tag&1){if(r.flags|=2048,RD(9,qCe.bind(null,r,i,n,e),void 0,null),ec===null)throw Error(At(349));fS&30||HCe(r,e,n)}return n}function HCe(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Uo.updateQueue,e===null?(e={lastEffect:null,stores:null},Uo.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function qCe(t,e,r,i){e.value=r,e.getSnapshot=i,QCe(e)&&YCe(t)}function WCe(t,e,r){return r(function(){QCe(e)&&YCe(t)})}function QCe(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Mm(t,r)}catch{return!0}}function YCe(t){var e=X_(t,1);e!==null&&bm(e,t,1,-1)}function j0e(t){var e=qg();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:MD,lastRenderedState:t},e.queue=t,t=t.dispatch=nJe.bind(null,Uo,t),[e.memoizedState,t]}function RD(t,e,r,i){return t={tag:t,create:e,destroy:r,deps:i,next:null},e=Uo.updateQueue,e===null?(e={lastEffect:null,stores:null},Uo.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(i=r.next,r.next=t,t.next=i,e.lastEffect=t)),t}function XCe(){return Vf().memoizedState}function T7(t,e,r,i){var n=qg();Uo.flags|=t,n.memoizedState=RD(1|e,r,void 0,i===void 0?null:i)}function oG(t,e,r,i){var n=Vf();i=i===void 0?null:i;var s=void 0;if(_l!==null){var o=_l.memoizedState;if(s=o.destroy,i!==null&&vae(i,o.deps)){n.memoizedState=RD(e,r,s,i);return}}Uo.flags|=t,n.memoizedState=RD(1|e,r,s,i)}function H0e(t,e){return T7(8390656,8,t,e)}function xae(t,e){return oG(2048,8,t,e)}function ZCe(t,e){return oG(4,2,t,e)}function JCe(t,e){return oG(4,4,t,e)}function KCe(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function eMe(t,e,r){return r=r!=null?r.concat([t]):null,oG(4,4,KCe.bind(null,e,t),r)}function Tae(){}function tMe(t,e){var r=Vf();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&vae(e,i[1])?i[0]:(r.memoizedState=[t,e],t)}function rMe(t,e){var r=Vf();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&vae(e,i[1])?i[0]:(t=t(),r.memoizedState=[t,e],t)}function iMe(t,e,r){return fS&21?(Mm(r,e)||(r=oCe(),Uo.lanes|=r,mS|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,id=!0),t.memoizedState=r)}function rJe(t,e){var r=Ss;Ss=r!==0&&4>r?r:4,t(!0);var i=Wq.transition;Wq.transition={};try{t(!1),e()}finally{Ss=r,Wq.transition=i}}function nMe(){return Vf().memoizedState}function iJe(t,e,r){var i=a2(t);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},sMe(t))oMe(e,r);else if(r=NCe(t,e,r,i),r!==null){var n=hh();bm(r,t,i,n),aMe(r,e,i)}}function nJe(t,e,r){var i=a2(t),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(sMe(t))oMe(e,n);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,r);if(n.hasEagerState=!0,n.eagerState=a,Mm(a,o)){var l=e.interleaved;l===null?(n.next=n,mae(e)):(n.next=l.next,l.next=n),e.interleaved=n;return}}catch{}finally{}r=NCe(t,e,n,i),r!==null&&(n=hh(),bm(r,t,i,n),aMe(r,e,i))}}function sMe(t){var e=t.alternate;return t===Uo||e!==null&&e===Uo}function oMe(t,e){l5=WU=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function aMe(t,e,r){if(r&4194240){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,tae(t,r)}}var QU={readContext:zf,useCallback:Gc,useContext:Gc,useEffect:Gc,useImperativeHandle:Gc,useInsertionEffect:Gc,useLayoutEffect:Gc,useMemo:Gc,useReducer:Gc,useRef:Gc,useState:Gc,useDebugValue:Gc,useDeferredValue:Gc,useTransition:Gc,useMutableSource:Gc,useSyncExternalStore:Gc,useId:Gc,unstable_isNewReconciler:!1},sJe={readContext:zf,useCallback:function(t,e){return qg().memoizedState=[t,e===void 0?null:e],t},useContext:zf,useEffect:H0e,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,T7(4194308,4,KCe.bind(null,e,t),r)},useLayoutEffect:function(t,e){return T7(4194308,4,t,e)},useInsertionEffect:function(t,e){return T7(4,2,t,e)},useMemo:function(t,e){var r=qg();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var i=qg();return e=r!==void 0?r(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=iJe.bind(null,Uo,t),[i.memoizedState,t]},useRef:function(t){var e=qg();return t={current:t},e.memoizedState=t},useState:j0e,useDebugValue:Tae,useDeferredValue:function(t){return qg().memoizedState=t},useTransition:function(){var t=j0e(!1),e=t[0];return t=rJe.bind(null,t[1]),qg().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var i=Uo,n=qg();if(Io){if(r===void 0)throw Error(At(407));r=r()}else{if(r=e(),ec===null)throw Error(At(349));fS&30||HCe(i,e,r)}n.memoizedState=r;var s={value:r,getSnapshot:e};return n.queue=s,H0e(WCe.bind(null,i,s,t),[t]),i.flags|=2048,RD(9,qCe.bind(null,i,s,r,e),void 0,null),r},useId:function(){var t=qg(),e=ec.identifierPrefix;if(Io){var r=S_,i=T_;r=(i&~(1<<32-vm(i)-1)).toString(32)+r,e=":"+e+"R"+r,r=CD++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=tJe++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},oJe={readContext:zf,useCallback:tMe,useContext:zf,useEffect:xae,useImperativeHandle:eMe,useInsertionEffect:ZCe,useLayoutEffect:JCe,useMemo:rMe,useReducer:Qq,useRef:XCe,useState:function(){return Qq(MD)},useDebugValue:Tae,useDeferredValue:function(t){var e=Vf();return iMe(e,_l.memoizedState,t)},useTransition:function(){var t=Qq(MD)[0],e=Vf().memoizedState;return[t,e]},useMutableSource:GCe,useSyncExternalStore:jCe,useId:nMe,unstable_isNewReconciler:!1},aJe={readContext:zf,useCallback:tMe,useContext:zf,useEffect:xae,useImperativeHandle:eMe,useInsertionEffect:ZCe,useLayoutEffect:JCe,useMemo:rMe,useReducer:Yq,useRef:XCe,useState:function(){return Yq(MD)},useDebugValue:Tae,useDeferredValue:function(t){var e=Vf();return _l===null?e.memoizedState=t:iMe(e,_l.memoizedState,t)},useTransition:function(){var t=Yq(MD)[0],e=Vf().memoizedState;return[t,e]},useMutableSource:GCe,useSyncExternalStore:jCe,useId:nMe,unstable_isNewReconciler:!1};function IR(t,e){try{var r="",i=e;do r+=LXe(i),i=i.return;while(i);var n=r}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:n,digest:null}}function Xq(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function EJ(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var lJe=typeof WeakMap=="function"?WeakMap:Map;function lMe(t,e,r){r=D_(-1,r),r.tag=3,r.payload={element:null};var i=e.value;return r.callback=function(){XU||(XU=!0,NJ=i),EJ(t,e)},r}function cMe(t,e,r){r=D_(-1,r),r.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var n=e.value;r.payload=function(){return i(n)},r.callback=function(){EJ(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){EJ(t,e),typeof i!="function"&&(o2===null?o2=new Set([this]):o2.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),r}function q0e(t,e,r){var i=t.pingCache;if(i===null){i=t.pingCache=new lJe;var n=new Set;i.set(e,n)}else n=i.get(e),n===void 0&&(n=new Set,i.set(e,n));n.has(r)||(n.add(r),t=wJe.bind(null,t,e,r),e.then(t,t))}function W0e(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Q0e(t,e,r,i,n){return t.mode&1?(t.flags|=65536,t.lanes=n,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=D_(-1,1),e.tag=2,s2(r,e,1))),r.lanes|=1),t)}var cJe=A1.ReactCurrentOwner,id=!1;function th(t,e,r,i){e.child=t===null?zCe(e,null,r,i):OR(e,t.child,r,i)}function Y0e(t,e,r,i,n){r=r.render;var s=e.ref;return VM(e,n),i=bae(t,e,r,i,s,n),r=wae(),t!==null&&!id?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,Z_(t,e,n)):(Io&&r&&cae(e),e.flags|=1,th(t,e,i,n),e.child)}function X0e(t,e,r,i,n){if(t===null){var s=r.type;return typeof s=="function"&&!Iae(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=s,uMe(t,e,s,i,n)):(t=M7(r.type,null,i,e,e.mode,n),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&n)){var o=s.memoizedProps;if(r=r.compare,r=r!==null?r:bD,r(o,i)&&t.ref===e.ref)return Z_(t,e,n)}return e.flags|=1,t=l2(s,i),t.ref=e.ref,t.return=e,e.child=t}function uMe(t,e,r,i,n){if(t!==null){var s=t.memoizedProps;if(bD(s,i)&&t.ref===e.ref)if(id=!1,e.pendingProps=i=s,(t.lanes&n)!==0)t.flags&131072&&(id=!0);else return e.lanes=t.lanes,Z_(t,e,n)}return CJ(t,e,r,i,n)}function hMe(t,e,r){var i=e.pendingProps,n=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ao(pM,Wd),Wd|=r;else{if(!(r&1073741824))return t=s!==null?s.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ao(pM,Wd),Wd|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:r,ao(pM,Wd),Wd|=i}else s!==null?(i=s.baseLanes|r,e.memoizedState=null):i=r,ao(pM,Wd),Wd|=i;return th(t,e,n,r),e.child}function dMe(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function CJ(t,e,r,i,n){var s=cd(r)?dS:vu.current;return s=MR(e,s),VM(e,n),r=bae(t,e,r,i,s,n),i=wae(),t!==null&&!id?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,Z_(t,e,n)):(Io&&i&&cae(e),e.flags|=1,th(t,e,r,n),e.child)}function Z0e(t,e,r,i,n){if(cd(r)){var s=!0;BU(e)}else s=!1;if(VM(e,n),e.stateNode===null)S7(t,e),UCe(e,r,i),SJ(e,r,i,n),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=r.contextType;typeof c=="object"&&c!==null?c=zf(c):(c=cd(r)?dS:vu.current,c=MR(e,c));var u=r.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&V0e(e,o,i,c),ub=!1;var p=e.memoizedState;o.state=p,HU(e,i,o,n),l=e.memoizedState,a!==i||p!==l||ld.current||ub?(typeof u=="function"&&(TJ(e,r,u,i),l=e.memoizedState),(a=ub||z0e(e,r,a,i,p,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,FCe(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:j0(e.type,a),o.props=c,d=e.pendingProps,p=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=zf(l):(l=cd(r)?dS:vu.current,l=MR(e,l));var A=r.getDerivedStateFromProps;(u=typeof A=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||p!==l)&&V0e(e,o,i,l),ub=!1,p=e.memoizedState,o.state=p,HU(e,i,o,n);var v=e.memoizedState;a!==d||p!==v||ld.current||ub?(typeof A=="function"&&(TJ(e,r,A,i),v=e.memoizedState),(c=ub||z0e(e,r,c,i,p,v,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,v,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,v,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=v),o.props=i,o.state=v,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),i=!1)}return MJ(t,e,r,i,s,n)}function MJ(t,e,r,i,n,s){dMe(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return n&&N0e(e,r,!1),Z_(t,e,s);i=e.stateNode,cJe.current=e;var a=o&&typeof r.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=OR(e,t.child,null,s),e.child=OR(e,null,a,s)):th(t,e,a,s),e.memoizedState=i.state,n&&N0e(e,r,!0),e.child}function pMe(t){var e=t.stateNode;e.pendingContext?L0e(t,e.pendingContext,e.pendingContext!==e.context):e.context&&L0e(t,e.context,!1),Aae(t,e.containerInfo)}function J0e(t,e,r,i,n){return RR(),hae(n),e.flags|=256,th(t,e,r,i),e.child}var RJ={dehydrated:null,treeContext:null,retryLane:0};function OJ(t){return{baseLanes:t,cachePool:null,transitions:null}}function fMe(t,e,r){var i=e.pendingProps,n=ko.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(n&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(n|=1),ao(ko,n&1),t===null)return wJ(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=cG(o,i,0,null),t=WT(t,i,r,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=OJ(r),e.memoizedState=RJ,t):Sae(e,o));if(n=t.memoizedState,n!==null&&(a=n.dehydrated,a!==null))return uJe(t,e,o,i,a,n,r);if(s){s=i.fallback,o=e.mode,n=t.child,a=n.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==n?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=l2(n,l),i.subtreeFlags=n.subtreeFlags&14680064),a!==null?s=l2(a,s):(s=WT(s,o,r,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?OJ(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~r,e.memoizedState=RJ,i}return s=t.child,t=s.sibling,i=l2(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=r),i.return=e,i.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=i,e.memoizedState=null,i}function Sae(t,e){return e=cG({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function e6(t,e,r,i){return i!==null&&hae(i),OR(e,t.child,null,r),t=Sae(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function uJe(t,e,r,i,n,s,o){if(r)return e.flags&256?(e.flags&=-257,i=Xq(Error(At(422))),e6(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,n=e.mode,i=cG({mode:"visible",children:i.children},n,0,null),s=WT(s,n,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&OR(e,t.child,null,o),e.child.memoizedState=OJ(o),e.memoizedState=RJ,s);if(!(e.mode&1))return e6(t,e,o,null);if(n.data==="$!"){if(i=n.nextSibling&&n.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(At(419)),i=Xq(s,i,void 0),e6(t,e,o,i)}if(a=(o&t.childLanes)!==0,id||a){if(i=ec,i!==null){switch(o&-o){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(i.suspendedLanes|o)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,X_(t,n),bm(i,t,n,-1))}return Pae(),i=Xq(Error(At(421))),e6(t,e,o,i)}return n.data==="$?"?(e.flags|=128,e.child=t.child,e=xJe.bind(null,t),n._reactRetry=e,null):(t=s.treeContext,lp=n2(n.nextSibling),pp=e,Io=!0,K0=null,t!==null&&(gf[Af++]=T_,gf[Af++]=S_,gf[Af++]=pS,T_=t.id,S_=t.overflow,pS=e),e=Sae(e,i.children),e.flags|=4096,e)}function K0e(t,e,r){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),xJ(t.return,e,r)}function Zq(t,e,r,i,n){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=r,s.tailMode=n)}function mMe(t,e,r){var i=e.pendingProps,n=i.revealOrder,s=i.tail;if(th(t,e,i.children,r),i=ko.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&K0e(t,r,e);else if(t.tag===19)K0e(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(ao(ko,i),!(e.mode&1))e.memoizedState=null;else switch(n){case"forwards":for(r=e.child,n=null;r!==null;)t=r.alternate,t!==null&&qU(t)===null&&(n=r),r=r.sibling;r=n,r===null?(n=e.child,e.child=null):(n=r.sibling,r.sibling=null),Zq(e,!1,n,r,s);break;case"backwards":for(r=null,n=e.child,e.child=null;n!==null;){if(t=n.alternate,t!==null&&qU(t)===null){e.child=n;break}t=n.sibling,n.sibling=r,r=n,n=t}Zq(e,!0,r,null,s);break;case"together":Zq(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function S7(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Z_(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),mS|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(At(153));if(e.child!==null){for(t=e.child,r=l2(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=l2(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function hJe(t,e,r){switch(e.tag){case 3:pMe(e),RR();break;case 5:VCe(e);break;case 1:cd(e.type)&&BU(e);break;case 4:Aae(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,n=e.memoizedProps.value;ao(GU,i._currentValue),i._currentValue=n;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(ao(ko,ko.current&1),e.flags|=128,null):r&e.child.childLanes?fMe(t,e,r):(ao(ko,ko.current&1),t=Z_(t,e,r),t!==null?t.sibling:null);ao(ko,ko.current&1);break;case 19:if(i=(r&e.childLanes)!==0,t.flags&128){if(i)return mMe(t,e,r);e.flags|=128}if(n=e.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),ao(ko,ko.current),i)break;return null;case 22:case 23:return e.lanes=0,hMe(t,e,r)}return Z_(t,e,r)}var gMe,PJ,AMe,yMe;gMe=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};PJ=function(){};AMe=function(t,e,r,i){var n=t.memoizedProps;if(n!==i){t=e.stateNode,OT(AA.current);var s=null;switch(r){case"input":n=KZ(t,n),i=KZ(t,i),s=[];break;case"select":n=Vo({},n,{value:void 0}),i=Vo({},i,{value:void 0}),s=[];break;case"textarea":n=rJ(t,n),i=rJ(t,i),s=[];break;default:typeof n.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=kU)}nJ(r,i);var o;r=null;for(c in n)if(!i.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var a=n[c];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(fD.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=n!=null?n[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(s||(s=[]),s.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(fD.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&po("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}r&&(s=s||[]).push("style",r);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};yMe=function(t,e,r,i){r!==i&&(e.flags|=4)};function ZP(t,e){if(!Io)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function jc(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,i=0;if(e)for(var n=t.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags&14680064,i|=n.flags&14680064,n.return=t,n=n.sibling;else for(n=t.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=t,n=n.sibling;return t.subtreeFlags|=i,t.childLanes=r,e}function dJe(t,e,r){var i=e.pendingProps;switch(uae(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return jc(e),null;case 1:return cd(e.type)&&UU(),jc(e),null;case 3:return i=e.stateNode,PR(),So(ld),So(vu),_ae(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(JF(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,K0!==null&&(UJ(K0),K0=null))),PJ(t,e),jc(e),null;case 5:yae(e);var n=OT(ED.current);if(r=e.type,t!==null&&e.stateNode!=null)AMe(t,e,r,i,n),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(At(166));return jc(e),null}if(t=OT(AA.current),JF(e)){i=e.stateNode,r=e.type;var s=e.memoizedProps;switch(i[eA]=e,i[TD]=s,t=(e.mode&1)!==0,r){case"dialog":po("cancel",i),po("close",i);break;case"iframe":case"object":case"embed":po("load",i);break;case"video":case"audio":for(n=0;n<w$.length;n++)po(w$[n],i);break;case"source":po("error",i);break;case"img":case"image":case"link":po("error",i),po("load",i);break;case"details":po("toggle",i);break;case"input":l0e(i,s),po("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},po("invalid",i);break;case"textarea":u0e(i,s),po("invalid",i)}nJ(r,s),n=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&ZF(i.textContent,a,t),n=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&ZF(i.textContent,a,t),n=["children",""+a]):fD.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&po("scroll",i)}switch(r){case"input":GF(i),c0e(i,s,!0);break;case"textarea":GF(i),h0e(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=kU)}i=n,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=n.nodeType===9?n:n.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=H3e(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(r,{is:i.is}):(t=o.createElement(r),r==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,r),t[eA]=e,t[TD]=i,gMe(t,e,!1,!1),e.stateNode=t;e:{switch(o=sJ(r,i),r){case"dialog":po("cancel",t),po("close",t),n=i;break;case"iframe":case"object":case"embed":po("load",t),n=i;break;case"video":case"audio":for(n=0;n<w$.length;n++)po(w$[n],t);n=i;break;case"source":po("error",t),n=i;break;case"img":case"image":case"link":po("error",t),po("load",t),n=i;break;case"details":po("toggle",t),n=i;break;case"input":l0e(t,i),n=KZ(t,i),po("invalid",t);break;case"option":n=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},n=Vo({},i,{value:void 0}),po("invalid",t);break;case"textarea":u0e(t,i),n=rJ(t,i),po("invalid",t);break;default:n=i}nJ(r,n),a=n;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Q3e(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&q3e(t,l)):s==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&mD(t,l):typeof l=="number"&&mD(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(fD.hasOwnProperty(s)?l!=null&&s==="onScroll"&&po("scroll",t):l!=null&&Yoe(t,s,l,o))}switch(r){case"input":GF(t),c0e(t,i,!1);break;case"textarea":GF(t),h0e(t);break;case"option":i.value!=null&&t.setAttribute("value",""+b2(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?kM(t,!!i.multiple,s,!1):i.defaultValue!=null&&kM(t,!!i.multiple,i.defaultValue,!0);break;default:typeof n.onClick=="function"&&(t.onclick=kU)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return jc(e),null;case 6:if(t&&e.stateNode!=null)yMe(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(At(166));if(r=OT(ED.current),OT(AA.current),JF(e)){if(i=e.stateNode,r=e.memoizedProps,i[eA]=e,(s=i.nodeValue!==r)&&(t=pp,t!==null))switch(t.tag){case 3:ZF(i.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ZF(i.nodeValue,r,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[eA]=e,e.stateNode=i}return jc(e),null;case 13:if(So(ko),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Io&&lp!==null&&e.mode&1&&!(e.flags&128))LCe(),RR(),e.flags|=98560,s=!1;else if(s=JF(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(At(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(At(317));s[eA]=e}else RR(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;jc(e),s=!1}else K0!==null&&(UJ(K0),K0=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||ko.current&1?Tl===0&&(Tl=3):Pae())),e.updateQueue!==null&&(e.flags|=4),jc(e),null);case 4:return PR(),PJ(t,e),t===null&&wD(e.stateNode.containerInfo),jc(e),null;case 10:return fae(e.type._context),jc(e),null;case 17:return cd(e.type)&&UU(),jc(e),null;case 19:if(So(ko),s=e.memoizedState,s===null)return jc(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)ZP(s,!1);else{if(Tl!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=qU(t),o!==null){for(e.flags|=128,ZP(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=r,r=e.child;r!==null;)s=r,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return ao(ko,ko.current&1|2),e.child}t=t.sibling}s.tail!==null&&Ca()>$R&&(e.flags|=128,i=!0,ZP(s,!1),e.lanes=4194304)}else{if(!i)if(t=qU(o),t!==null){if(e.flags|=128,i=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),ZP(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Io)return jc(e),null}else 2*Ca()-s.renderingStartTime>$R&&r!==1073741824&&(e.flags|=128,i=!0,ZP(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(r=s.last,r!==null?r.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ca(),e.sibling=null,r=ko.current,ao(ko,i?r&1|2:r&1),e):(jc(e),null);case 22:case 23:return Oae(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Wd&1073741824&&(jc(e),e.subtreeFlags&6&&(e.flags|=8192)):jc(e),null;case 24:return null;case 25:return null}throw Error(At(156,e.tag))}function pJe(t,e){switch(uae(e),e.tag){case 1:return cd(e.type)&&UU(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return PR(),So(ld),So(vu),_ae(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return yae(e),null;case 13:if(So(ko),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(At(340));RR()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return So(ko),null;case 4:return PR(),null;case 10:return fae(e.type._context),null;case 22:case 23:return Oae(),null;case 24:return null;default:return null}}var t6=!1,cu=!1,fJe=typeof WeakSet=="function"?WeakSet:Set,ir=null;function dM(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){ia(t,e,i)}else r.current=null}function IJ(t,e,r){try{r()}catch(i){ia(t,e,i)}}var eme=!1;function mJe(t,e){if(mJ=LU,t=wCe(),lae(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var n=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=t,p=null;t:for(;;){for(var A;d!==r||n!==0&&d.nodeType!==3||(a=o+n),d!==s||i!==0&&d.nodeType!==3||(l=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(A=d.firstChild)!==null;)p=d,d=A;for(;;){if(d===t)break t;if(p===r&&++c===n&&(a=o),p===s&&++u===i&&(l=o),(A=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=A}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(gJ={focusedElem:t,selectionRange:r},LU=!1,ir=e;ir!==null;)if(e=ir,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ir=t;else for(;ir!==null;){e=ir;try{var v=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var b=v.memoizedProps,S=v.memoizedState,E=e.stateNode,R=E.getSnapshotBeforeUpdate(e.elementType===e.type?b:j0(e.type,b),S);E.__reactInternalSnapshotBeforeUpdate=R}break;case 3:var O=e.stateNode.containerInfo;O.nodeType===1?O.textContent="":O.nodeType===9&&O.documentElement&&O.removeChild(O.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(At(163))}}catch(I){ia(e,e.return,I)}if(t=e.sibling,t!==null){t.return=e.return,ir=t;break}ir=e.return}return v=eme,eme=!1,v}function c5(t,e,r){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var n=i=i.next;do{if((n.tag&t)===t){var s=n.destroy;n.destroy=void 0,s!==void 0&&IJ(e,r,s)}n=n.next}while(n!==i)}}function aG(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var i=r.create;r.destroy=i()}r=r.next}while(r!==e)}}function $J(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function _Me(t){var e=t.alternate;e!==null&&(t.alternate=null,_Me(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[eA],delete e[TD],delete e[_J],delete e[ZZe],delete e[JZe])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function vMe(t){return t.tag===5||t.tag===3||t.tag===4}function tme(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||vMe(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function DJ(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=kU));else if(i!==4&&(t=t.child,t!==null))for(DJ(t,e,r),t=t.sibling;t!==null;)DJ(t,e,r),t=t.sibling}function LJ(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(LJ(t,e,r),t=t.sibling;t!==null;)LJ(t,e,r),t=t.sibling}var mc=null,W0=!1;function G1(t,e,r){for(r=r.child;r!==null;)bMe(t,e,r),r=r.sibling}function bMe(t,e,r){if(gA&&typeof gA.onCommitFiberUnmount=="function")try{gA.onCommitFiberUnmount(KV,r)}catch{}switch(r.tag){case 5:cu||dM(r,e);case 6:var i=mc,n=W0;mc=null,G1(t,e,r),mc=i,W0=n,mc!==null&&(W0?(t=mc,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):mc.removeChild(r.stateNode));break;case 18:mc!==null&&(W0?(t=mc,r=r.stateNode,t.nodeType===8?jq(t.parentNode,r):t.nodeType===1&&jq(t,r),_D(t)):jq(mc,r.stateNode));break;case 4:i=mc,n=W0,mc=r.stateNode.containerInfo,W0=!0,G1(t,e,r),mc=i,W0=n;break;case 0:case 11:case 14:case 15:if(!cu&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){n=i=i.next;do{var s=n,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&IJ(r,e,o),n=n.next}while(n!==i)}G1(t,e,r);break;case 1:if(!cu&&(dM(r,e),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(a){ia(r,e,a)}G1(t,e,r);break;case 21:G1(t,e,r);break;case 22:r.mode&1?(cu=(i=cu)||r.memoizedState!==null,G1(t,e,r),cu=i):G1(t,e,r);break;default:G1(t,e,r)}}function rme(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new fJe),e.forEach(function(i){var n=TJe.bind(null,t,i);r.has(i)||(r.add(i),i.then(n,n))})}}function l0(t,e){var r=e.deletions;if(r!==null)for(var i=0;i<r.length;i++){var n=r[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:mc=a.stateNode,W0=!1;break e;case 3:mc=a.stateNode.containerInfo,W0=!0;break e;case 4:mc=a.stateNode.containerInfo,W0=!0;break e}a=a.return}if(mc===null)throw Error(At(160));bMe(s,o,n),mc=null,W0=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){ia(n,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)wMe(e,t),e=e.sibling}function wMe(t,e){var r=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(l0(e,t),Km(t),i&4){try{c5(3,t,t.return),aG(3,t)}catch(b){ia(t,t.return,b)}try{c5(5,t,t.return)}catch(b){ia(t,t.return,b)}}break;case 1:l0(e,t),Km(t),i&512&&r!==null&&dM(r,r.return);break;case 5:if(l0(e,t),Km(t),i&512&&r!==null&&dM(r,r.return),t.flags&32){var n=t.stateNode;try{mD(n,"")}catch(b){ia(t,t.return,b)}}if(i&4&&(n=t.stateNode,n!=null)){var s=t.memoizedProps,o=r!==null?r.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&G3e(n,s),sJ(a,o);var c=sJ(a,s);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?Q3e(n,d):u==="dangerouslySetInnerHTML"?q3e(n,d):u==="children"?mD(n,d):Yoe(n,u,d,c)}switch(a){case"input":eJ(n,s);break;case"textarea":j3e(n,s);break;case"select":var p=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var A=s.value;A!=null?kM(n,!!s.multiple,A,!1):p!==!!s.multiple&&(s.defaultValue!=null?kM(n,!!s.multiple,s.defaultValue,!0):kM(n,!!s.multiple,s.multiple?[]:"",!1))}n[TD]=s}catch(b){ia(t,t.return,b)}}break;case 6:if(l0(e,t),Km(t),i&4){if(t.stateNode===null)throw Error(At(162));n=t.stateNode,s=t.memoizedProps;try{n.nodeValue=s}catch(b){ia(t,t.return,b)}}break;case 3:if(l0(e,t),Km(t),i&4&&r!==null&&r.memoizedState.isDehydrated)try{_D(e.containerInfo)}catch(b){ia(t,t.return,b)}break;case 4:l0(e,t),Km(t);break;case 13:l0(e,t),Km(t),n=t.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(Mae=Ca())),i&4&&rme(t);break;case 22:if(u=r!==null&&r.memoizedState!==null,t.mode&1?(cu=(c=cu)||u,l0(e,t),cu=c):l0(e,t),Km(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(ir=t,u=t.child;u!==null;){for(d=ir=u;ir!==null;){switch(p=ir,A=p.child,p.tag){case 0:case 11:case 14:case 15:c5(4,p,p.return);break;case 1:dM(p,p.return);var v=p.stateNode;if(typeof v.componentWillUnmount=="function"){i=p,r=p.return;try{e=i,v.props=e.memoizedProps,v.state=e.memoizedState,v.componentWillUnmount()}catch(b){ia(i,r,b)}}break;case 5:dM(p,p.return);break;case 22:if(p.memoizedState!==null){nme(d);continue}}A!==null?(A.return=p,ir=A):nme(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{n=d.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=W3e("display",o))}catch(b){ia(t,t.return,b)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(b){ia(t,t.return,b)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:l0(e,t),Km(t),i&4&&rme(t);break;case 21:break;default:l0(e,t),Km(t)}}function Km(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(vMe(r)){var i=r;break e}r=r.return}throw Error(At(160))}switch(i.tag){case 5:var n=i.stateNode;i.flags&32&&(mD(n,""),i.flags&=-33);var s=tme(t);LJ(t,s,n);break;case 3:case 4:var o=i.stateNode.containerInfo,a=tme(t);DJ(t,a,o);break;default:throw Error(At(161))}}catch(l){ia(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function gJe(t,e,r){ir=t,xMe(t)}function xMe(t,e,r){for(var i=(t.mode&1)!==0;ir!==null;){var n=ir,s=n.child;if(n.tag===22&&i){var o=n.memoizedState!==null||t6;if(!o){var a=n.alternate,l=a!==null&&a.memoizedState!==null||cu;a=t6;var c=cu;if(t6=o,(cu=l)&&!c)for(ir=n;ir!==null;)o=ir,l=o.child,o.tag===22&&o.memoizedState!==null?sme(n):l!==null?(l.return=o,ir=l):sme(n);for(;s!==null;)ir=s,xMe(s),s=s.sibling;ir=n,t6=a,cu=c}ime(t)}else n.subtreeFlags&8772&&s!==null?(s.return=n,ir=s):ime(t)}}function ime(t){for(;ir!==null;){var e=ir;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:cu||aG(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!cu)if(r===null)i.componentDidMount();else{var n=e.elementType===e.type?r.memoizedProps:j0(e.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&B0e(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}B0e(e,o,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&_D(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(At(163))}cu||e.flags&512&&$J(e)}catch(p){ia(e,e.return,p)}}if(e===t){ir=null;break}if(r=e.sibling,r!==null){r.return=e.return,ir=r;break}ir=e.return}}function nme(t){for(;ir!==null;){var e=ir;if(e===t){ir=null;break}var r=e.sibling;if(r!==null){r.return=e.return,ir=r;break}ir=e.return}}function sme(t){for(;ir!==null;){var e=ir;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{aG(4,e)}catch(l){ia(e,r,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var n=e.return;try{i.componentDidMount()}catch(l){ia(e,n,l)}}var s=e.return;try{$J(e)}catch(l){ia(e,s,l)}break;case 5:var o=e.return;try{$J(e)}catch(l){ia(e,o,l)}}}catch(l){ia(e,e.return,l)}if(e===t){ir=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ir=a;break}ir=e.return}}var AJe=Math.ceil,YU=A1.ReactCurrentDispatcher,Eae=A1.ReactCurrentOwner,Lf=A1.ReactCurrentBatchConfig,Bn=0,ec=null,Ja=null,Tc=0,Wd=0,pM=X2(0),Tl=0,OD=null,mS=0,lG=0,Cae=0,u5=null,Xh=null,Mae=0,$R=1/0,c_=null,XU=!1,NJ=null,o2=null,r6=!1,Nb=null,ZU=0,h5=0,FJ=null,E7=-1,C7=0;function hh(){return Bn&6?Ca():E7!==-1?E7:E7=Ca()}function a2(t){return t.mode&1?Bn&2&&Tc!==0?Tc&-Tc:eJe.transition!==null?(C7===0&&(C7=oCe()),C7):(t=Ss,t!==0||(t=window.event,t=t===void 0?16:pCe(t.type)),t):1}function bm(t,e,r,i){if(50<h5)throw h5=0,FJ=null,Error(At(185));dN(t,r,i),(!(Bn&2)||t!==ec)&&(t===ec&&(!(Bn&2)&&(lG|=r),Tl===4&&Tb(t,Tc)),ud(t,i),r===1&&Bn===0&&!(e.mode&1)&&($R=Ca()+500,nG&&Z2()))}function ud(t,e){var r=t.callbackNode;eZe(t,e);var i=DU(t,t===ec?Tc:0);if(i===0)r!==null&&f0e(r),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(r!=null&&f0e(r),e===1)t.tag===0?KZe(ome.bind(null,t)):ICe(ome.bind(null,t)),YZe(function(){!(Bn&6)&&Z2()}),r=null;else{switch(aCe(i)){case 1:r=eae;break;case 4:r=nCe;break;case 16:r=$U;break;case 536870912:r=sCe;break;default:r=$U}r=PMe(r,TMe.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function TMe(t,e){if(E7=-1,C7=0,Bn&6)throw Error(At(327));var r=t.callbackNode;if(GM()&&t.callbackNode!==r)return null;var i=DU(t,t===ec?Tc:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=JU(t,i);else{e=i;var n=Bn;Bn|=2;var s=EMe();(ec!==t||Tc!==e)&&(c_=null,$R=Ca()+500,qT(t,e));do try{vJe();break}catch(a){SMe(t,a)}while(1);pae(),YU.current=s,Bn=n,Ja!==null?e=0:(ec=null,Tc=0,e=Tl)}if(e!==0){if(e===2&&(n=uJ(t),n!==0&&(i=n,e=kJ(t,n))),e===1)throw r=OD,qT(t,0),Tb(t,i),ud(t,Ca()),r;if(e===6)Tb(t,i);else{if(n=t.current.alternate,!(i&30)&&!yJe(n)&&(e=JU(t,i),e===2&&(s=uJ(t),s!==0&&(i=s,e=kJ(t,s))),e===1))throw r=OD,qT(t,0),Tb(t,i),ud(t,Ca()),r;switch(t.finishedWork=n,t.finishedLanes=i,e){case 0:case 1:throw Error(At(345));case 2:ax(t,Xh,c_);break;case 3:if(Tb(t,i),(i&130023424)===i&&(e=Mae+500-Ca(),10<e)){if(DU(t,0)!==0)break;if(n=t.suspendedLanes,(n&i)!==i){hh(),t.pingedLanes|=t.suspendedLanes&n;break}t.timeoutHandle=yJ(ax.bind(null,t,Xh,c_),e);break}ax(t,Xh,c_);break;case 4:if(Tb(t,i),(i&4194240)===i)break;for(e=t.eventTimes,n=-1;0<i;){var o=31-vm(i);s=1<<o,o=e[o],o>n&&(n=o),i&=~s}if(i=n,i=Ca()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*AJe(i/1960))-i,10<i){t.timeoutHandle=yJ(ax.bind(null,t,Xh,c_),i);break}ax(t,Xh,c_);break;case 5:ax(t,Xh,c_);break;default:throw Error(At(329))}}}return ud(t,Ca()),t.callbackNode===r?TMe.bind(null,t):null}function kJ(t,e){var r=u5;return t.current.memoizedState.isDehydrated&&(qT(t,e).flags|=256),t=JU(t,e),t!==2&&(e=Xh,Xh=r,e!==null&&UJ(e)),t}function UJ(t){Xh===null?Xh=t:Xh.push.apply(Xh,t)}function yJe(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var n=r[i],s=n.getSnapshot;n=n.value;try{if(!Mm(s(),n))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Tb(t,e){for(e&=~Cae,e&=~lG,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-vm(e),i=1<<r;t[r]=-1,e&=~i}}function ome(t){if(Bn&6)throw Error(At(327));GM();var e=DU(t,0);if(!(e&1))return ud(t,Ca()),null;var r=JU(t,e);if(t.tag!==0&&r===2){var i=uJ(t);i!==0&&(e=i,r=kJ(t,i))}if(r===1)throw r=OD,qT(t,0),Tb(t,e),ud(t,Ca()),r;if(r===6)throw Error(At(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ax(t,Xh,c_),ud(t,Ca()),null}function Rae(t,e){var r=Bn;Bn|=1;try{return t(e)}finally{Bn=r,Bn===0&&($R=Ca()+500,nG&&Z2())}}function gS(t){Nb!==null&&Nb.tag===0&&!(Bn&6)&&GM();var e=Bn;Bn|=1;var r=Lf.transition,i=Ss;try{if(Lf.transition=null,Ss=1,t)return t()}finally{Ss=i,Lf.transition=r,Bn=e,!(Bn&6)&&Z2()}}function Oae(){Wd=pM.current,So(pM)}function qT(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,QZe(r)),Ja!==null)for(r=Ja.return;r!==null;){var i=r;switch(uae(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&UU();break;case 3:PR(),So(ld),So(vu),_ae();break;case 5:yae(i);break;case 4:PR();break;case 13:So(ko);break;case 19:So(ko);break;case 10:fae(i.type._context);break;case 22:case 23:Oae()}r=r.return}if(ec=t,Ja=t=l2(t.current,null),Tc=Wd=e,Tl=0,OD=null,Cae=lG=mS=0,Xh=u5=null,RT!==null){for(e=0;e<RT.length;e++)if(r=RT[e],i=r.interleaved,i!==null){r.interleaved=null;var n=i.next,s=r.pending;if(s!==null){var o=s.next;s.next=n,i.next=o}r.pending=i}RT=null}return t}function SMe(t,e){do{var r=Ja;try{if(pae(),x7.current=QU,WU){for(var i=Uo.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}WU=!1}if(fS=0,ql=_l=Uo=null,l5=!1,CD=0,Eae.current=null,r===null||r.return===null){Tl=1,OD=e,Ja=null;break}e:{var s=t,o=r.return,a=r,l=e;if(e=Tc,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var A=W0e(o);if(A!==null){A.flags&=-257,Q0e(A,o,a,s,e),A.mode&1&&q0e(s,c,e),e=A,l=c;var v=e.updateQueue;if(v===null){var b=new Set;b.add(l),e.updateQueue=b}else v.add(l);break e}else{if(!(e&1)){q0e(s,c,e),Pae();break e}l=Error(At(426))}}else if(Io&&a.mode&1){var S=W0e(o);if(S!==null){!(S.flags&65536)&&(S.flags|=256),Q0e(S,o,a,s,e),hae(IR(l,a));break e}}s=l=IR(l,a),Tl!==4&&(Tl=2),u5===null?u5=[s]:u5.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var E=lMe(s,l,e);U0e(s,E);break e;case 1:a=l;var R=s.type,O=s.stateNode;if(!(s.flags&128)&&(typeof R.getDerivedStateFromError=="function"||O!==null&&typeof O.componentDidCatch=="function"&&(o2===null||!o2.has(O)))){s.flags|=65536,e&=-e,s.lanes|=e;var I=cMe(s,a,e);U0e(s,I);break e}}s=s.return}while(s!==null)}MMe(r)}catch(N){e=N,Ja===r&&r!==null&&(Ja=r=r.return);continue}break}while(1)}function EMe(){var t=YU.current;return YU.current=QU,t===null?QU:t}function Pae(){(Tl===0||Tl===3||Tl===2)&&(Tl=4),ec===null||!(mS&268435455)&&!(lG&268435455)||Tb(ec,Tc)}function JU(t,e){var r=Bn;Bn|=2;var i=EMe();(ec!==t||Tc!==e)&&(c_=null,qT(t,e));do try{_Je();break}catch(n){SMe(t,n)}while(1);if(pae(),Bn=r,YU.current=i,Ja!==null)throw Error(At(261));return ec=null,Tc=0,Tl}function _Je(){for(;Ja!==null;)CMe(Ja)}function vJe(){for(;Ja!==null&&!HXe();)CMe(Ja)}function CMe(t){var e=OMe(t.alternate,t,Wd);t.memoizedProps=t.pendingProps,e===null?MMe(t):Ja=e,Eae.current=null}function MMe(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=pJe(r,e),r!==null){r.flags&=32767,Ja=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Tl=6,Ja=null;return}}else if(r=dJe(r,e,Wd),r!==null){Ja=r;return}if(e=e.sibling,e!==null){Ja=e;return}Ja=e=t}while(e!==null);Tl===0&&(Tl=5)}function ax(t,e,r){var i=Ss,n=Lf.transition;try{Lf.transition=null,Ss=1,bJe(t,e,r,i)}finally{Lf.transition=n,Ss=i}return null}function bJe(t,e,r,i){do GM();while(Nb!==null);if(Bn&6)throw Error(At(327));r=t.finishedWork;var n=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(At(177));t.callbackNode=null,t.callbackPriority=0;var s=r.lanes|r.childLanes;if(tZe(t,s),t===ec&&(Ja=ec=null,Tc=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||r6||(r6=!0,PMe($U,function(){return GM(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=Lf.transition,Lf.transition=null;var o=Ss;Ss=1;var a=Bn;Bn|=4,Eae.current=null,mJe(t,r),wMe(r,t),zZe(gJ),LU=!!mJ,gJ=mJ=null,t.current=r,gJe(r),qXe(),Bn=a,Ss=o,Lf.transition=s}else t.current=r;if(r6&&(r6=!1,Nb=t,ZU=n),s=t.pendingLanes,s===0&&(o2=null),YXe(r.stateNode),ud(t,Ca()),e!==null)for(i=t.onRecoverableError,r=0;r<e.length;r++)n=e[r],i(n.value,{componentStack:n.stack,digest:n.digest});if(XU)throw XU=!1,t=NJ,NJ=null,t;return ZU&1&&t.tag!==0&&GM(),s=t.pendingLanes,s&1?t===FJ?h5++:(h5=0,FJ=t):h5=0,Z2(),null}function GM(){if(Nb!==null){var t=aCe(ZU),e=Lf.transition,r=Ss;try{if(Lf.transition=null,Ss=16>t?16:t,Nb===null)var i=!1;else{if(t=Nb,Nb=null,ZU=0,Bn&6)throw Error(At(331));var n=Bn;for(Bn|=4,ir=t.current;ir!==null;){var s=ir,o=s.child;if(ir.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(ir=c;ir!==null;){var u=ir;switch(u.tag){case 0:case 11:case 15:c5(8,u,s)}var d=u.child;if(d!==null)d.return=u,ir=d;else for(;ir!==null;){u=ir;var p=u.sibling,A=u.return;if(_Me(u),u===c){ir=null;break}if(p!==null){p.return=A,ir=p;break}ir=A}}}var v=s.alternate;if(v!==null){var b=v.child;if(b!==null){v.child=null;do{var S=b.sibling;b.sibling=null,b=S}while(b!==null)}}ir=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,ir=o;else e:for(;ir!==null;){if(s=ir,s.flags&2048)switch(s.tag){case 0:case 11:case 15:c5(9,s,s.return)}var E=s.sibling;if(E!==null){E.return=s.return,ir=E;break e}ir=s.return}}var R=t.current;for(ir=R;ir!==null;){o=ir;var O=o.child;if(o.subtreeFlags&2064&&O!==null)O.return=o,ir=O;else e:for(o=R;ir!==null;){if(a=ir,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:aG(9,a)}}catch(N){ia(a,a.return,N)}if(a===o){ir=null;break e}var I=a.sibling;if(I!==null){I.return=a.return,ir=I;break e}ir=a.return}}if(Bn=n,Z2(),gA&&typeof gA.onPostCommitFiberRoot=="function")try{gA.onPostCommitFiberRoot(KV,t)}catch{}i=!0}return i}finally{Ss=r,Lf.transition=e}}return!1}function ame(t,e,r){e=IR(r,e),e=lMe(t,e,1),t=s2(t,e,1),e=hh(),t!==null&&(dN(t,1,e),ud(t,e))}function ia(t,e,r){if(t.tag===3)ame(t,t,r);else for(;e!==null;){if(e.tag===3){ame(e,t,r);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(o2===null||!o2.has(i))){t=IR(r,t),t=cMe(e,t,1),e=s2(e,t,1),t=hh(),e!==null&&(dN(e,1,t),ud(e,t));break}}e=e.return}}function wJe(t,e,r){var i=t.pingCache;i!==null&&i.delete(e),e=hh(),t.pingedLanes|=t.suspendedLanes&r,ec===t&&(Tc&r)===r&&(Tl===4||Tl===3&&(Tc&130023424)===Tc&&500>Ca()-Mae?qT(t,0):Cae|=r),ud(t,e)}function RMe(t,e){e===0&&(t.mode&1?(e=qF,qF<<=1,!(qF&130023424)&&(qF=4194304)):e=1);var r=hh();t=X_(t,e),t!==null&&(dN(t,e,r),ud(t,r))}function xJe(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),RMe(t,r)}function TJe(t,e){var r=0;switch(t.tag){case 13:var i=t.stateNode,n=t.memoizedState;n!==null&&(r=n.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(At(314))}i!==null&&i.delete(e),RMe(t,r)}var OMe;OMe=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||ld.current)id=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return id=!1,hJe(t,e,r);id=!!(t.flags&131072)}else id=!1,Io&&e.flags&1048576&&$Ce(e,VU,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;S7(t,e),t=e.pendingProps;var n=MR(e,vu.current);VM(e,r),n=bae(null,e,i,t,n,r);var s=wae();return e.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,cd(i)?(s=!0,BU(e)):s=!1,e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,gae(e),n.updater=sG,e.stateNode=n,n._reactInternals=e,SJ(e,i,t,r),e=MJ(null,e,i,!0,s,r)):(e.tag=0,Io&&s&&cae(e),th(null,e,n,r),e=e.child),e;case 16:i=e.elementType;e:{switch(S7(t,e),t=e.pendingProps,n=i._init,i=n(i._payload),e.type=i,n=e.tag=EJe(i),t=j0(i,t),n){case 0:e=CJ(null,e,i,t,r);break e;case 1:e=Z0e(null,e,i,t,r);break e;case 11:e=Y0e(null,e,i,t,r);break e;case 14:e=X0e(null,e,i,j0(i.type,t),r);break e}throw Error(At(306,i,""))}return e;case 0:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:j0(i,n),CJ(t,e,i,n,r);case 1:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:j0(i,n),Z0e(t,e,i,n,r);case 3:e:{if(pMe(e),t===null)throw Error(At(387));i=e.pendingProps,s=e.memoizedState,n=s.element,FCe(t,e),HU(e,i,null,r);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){n=IR(Error(At(423)),e),e=J0e(t,e,i,r,n);break e}else if(i!==n){n=IR(Error(At(424)),e),e=J0e(t,e,i,r,n);break e}else for(lp=n2(e.stateNode.containerInfo.firstChild),pp=e,Io=!0,K0=null,r=zCe(e,null,i,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(RR(),i===n){e=Z_(t,e,r);break e}th(t,e,i,r)}e=e.child}return e;case 5:return VCe(e),t===null&&wJ(e),i=e.type,n=e.pendingProps,s=t!==null?t.memoizedProps:null,o=n.children,AJ(i,n)?o=null:s!==null&&AJ(i,s)&&(e.flags|=32),dMe(t,e),th(t,e,o,r),e.child;case 6:return t===null&&wJ(e),null;case 13:return fMe(t,e,r);case 4:return Aae(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=OR(e,null,i,r):th(t,e,i,r),e.child;case 11:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:j0(i,n),Y0e(t,e,i,n,r);case 7:return th(t,e,e.pendingProps,r),e.child;case 8:return th(t,e,e.pendingProps.children,r),e.child;case 12:return th(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(i=e.type._context,n=e.pendingProps,s=e.memoizedProps,o=n.value,ao(GU,i._currentValue),i._currentValue=o,s!==null)if(Mm(s.value,o)){if(s.children===n.children&&!ld.current){e=Z_(t,e,r);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=D_(-1,r&-r),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=r,l=s.alternate,l!==null&&(l.lanes|=r),xJ(s.return,r,e),a.lanes|=r;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(At(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),xJ(o,r,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}th(t,e,n.children,r),e=e.child}return e;case 9:return n=e.type,i=e.pendingProps.children,VM(e,r),n=zf(n),i=i(n),e.flags|=1,th(t,e,i,r),e.child;case 14:return i=e.type,n=j0(i,e.pendingProps),n=j0(i.type,n),X0e(t,e,i,n,r);case 15:return uMe(t,e,e.type,e.pendingProps,r);case 17:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:j0(i,n),S7(t,e),e.tag=1,cd(i)?(t=!0,BU(e)):t=!1,VM(e,r),UCe(e,i,n),SJ(e,i,n,r),MJ(null,e,i,!0,t,r);case 19:return mMe(t,e,r);case 22:return hMe(t,e,r)}throw Error(At(156,e.tag))};function PMe(t,e){return iCe(t,e)}function SJe(t,e,r,i){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mf(t,e,r,i){return new SJe(t,e,r,i)}function Iae(t){return t=t.prototype,!(!t||!t.isReactComponent)}function EJe(t){if(typeof t=="function")return Iae(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Zoe)return 11;if(t===Joe)return 14}return 2}function l2(t,e){var r=t.alternate;return r===null?(r=Mf(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function M7(t,e,r,i,n,s){var o=2;if(i=t,typeof t=="function")Iae(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case iM:return WT(r.children,n,s,e);case Xoe:o=8,n|=8;break;case YZ:return t=Mf(12,r,e,n|2),t.elementType=YZ,t.lanes=s,t;case XZ:return t=Mf(13,r,e,n),t.elementType=XZ,t.lanes=s,t;case ZZ:return t=Mf(19,r,e,n),t.elementType=ZZ,t.lanes=s,t;case B3e:return cG(r,n,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case k3e:o=10;break e;case U3e:o=9;break e;case Zoe:o=11;break e;case Joe:o=14;break e;case cb:o=16,i=null;break e}throw Error(At(130,t==null?t:typeof t,""))}return e=Mf(o,r,e,n),e.elementType=t,e.type=i,e.lanes=s,e}function WT(t,e,r,i){return t=Mf(7,t,i,e),t.lanes=r,t}function cG(t,e,r,i){return t=Mf(22,t,i,e),t.elementType=B3e,t.lanes=r,t.stateNode={isHidden:!1},t}function Jq(t,e,r){return t=Mf(6,t,null,e),t.lanes=r,t}function Kq(t,e,r){return e=Mf(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function CJe(t,e,r,i,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$q(0),this.expirationTimes=$q(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$q(0),this.identifierPrefix=i,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function $ae(t,e,r,i,n,s,o,a,l){return t=new CJe(t,e,r,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Mf(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},gae(s),t}function MJe(t,e,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:rM,key:i==null?null:""+i,children:t,containerInfo:e,implementation:r}}function IMe(t){if(!t)return w2;t=t._reactInternals;e:{if(pE(t)!==t||t.tag!==1)throw Error(At(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(cd(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(At(171))}if(t.tag===1){var r=t.type;if(cd(r))return PCe(t,r,e)}return e}function $Me(t,e,r,i,n,s,o,a,l){return t=$ae(r,i,!0,t,n,s,o,a,l),t.context=IMe(null),r=t.current,i=hh(),n=a2(r),s=D_(i,n),s.callback=e??null,s2(r,s,n),t.current.lanes=n,dN(t,n,i),ud(t,i),t}function uG(t,e,r,i){var n=e.current,s=hh(),o=a2(n);return r=IMe(r),e.context===null?e.context=r:e.pendingContext=r,e=D_(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=s2(n,e,o),t!==null&&(bm(t,n,o,s),w7(t,n,o)),o}function KU(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function lme(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function Dae(t,e){lme(t,e),(t=t.alternate)&&lme(t,e)}function RJe(){return null}var DMe=typeof reportError=="function"?reportError:function(t){console.error(t)};function Lae(t){this._internalRoot=t}hG.prototype.render=Lae.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(At(409));uG(t,e,null,null)};hG.prototype.unmount=Lae.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;gS(function(){uG(null,t,null,null)}),e[Y_]=null}};function hG(t){this._internalRoot=t}hG.prototype.unstable_scheduleHydration=function(t){if(t){var e=uCe();t={blockedOn:null,target:t,priority:e};for(var r=0;r<xb.length&&e!==0&&e<xb[r].priority;r++);xb.splice(r,0,t),r===0&&dCe(t)}};function Nae(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function dG(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function cme(){}function OJe(t,e,r,i,n){if(n){if(typeof i=="function"){var s=i;i=function(){var c=KU(o);s.call(c)}}var o=$Me(e,i,t,0,null,!1,!1,"",cme);return t._reactRootContainer=o,t[Y_]=o.current,wD(t.nodeType===8?t.parentNode:t),gS(),o}for(;n=t.lastChild;)t.removeChild(n);if(typeof i=="function"){var a=i;i=function(){var c=KU(l);a.call(c)}}var l=$ae(t,0,!1,null,null,!1,!1,"",cme);return t._reactRootContainer=l,t[Y_]=l.current,wD(t.nodeType===8?t.parentNode:t),gS(function(){uG(e,l,r,i)}),l}function pG(t,e,r,i,n){var s=r._reactRootContainer;if(s){var o=s;if(typeof n=="function"){var a=n;n=function(){var l=KU(o);a.call(l)}}uG(e,o,t,n)}else o=OJe(r,e,t,n,i);return KU(o)}lCe=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=b$(e.pendingLanes);r!==0&&(tae(e,r|1),ud(e,Ca()),!(Bn&6)&&($R=Ca()+500,Z2()))}break;case 13:gS(function(){var i=X_(t,1);if(i!==null){var n=hh();bm(i,t,1,n)}}),Dae(t,1)}};rae=function(t){if(t.tag===13){var e=X_(t,134217728);if(e!==null){var r=hh();bm(e,t,134217728,r)}Dae(t,134217728)}};cCe=function(t){if(t.tag===13){var e=a2(t),r=X_(t,e);if(r!==null){var i=hh();bm(r,t,e,i)}Dae(t,e)}};uCe=function(){return Ss};hCe=function(t,e){var r=Ss;try{return Ss=t,e()}finally{Ss=r}};aJ=function(t,e,r){switch(e){case"input":if(eJ(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var i=r[e];if(i!==t&&i.form===t.form){var n=iG(i);if(!n)throw Error(At(90));V3e(i),eJ(i,n)}}}break;case"textarea":j3e(t,r);break;case"select":e=r.value,e!=null&&kM(t,!!r.multiple,e,!1)}};Z3e=Rae;J3e=gS;var PJe={usingClientEntryPoint:!1,Events:[fN,aM,iG,Y3e,X3e,Rae]},JP={findFiberByHostInstance:MT,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},IJe={bundleType:JP.bundleType,version:JP.version,rendererPackageName:JP.rendererPackageName,rendererConfig:JP.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:A1.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=tCe(t),t===null?null:t.stateNode},findFiberByHostInstance:JP.findFiberByHostInstance||RJe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var i6=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!i6.isDisabled&&i6.supportsFiber)try{KV=i6.inject(IJe),gA=i6}catch{}}Mp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=PJe;Mp.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Nae(e))throw Error(At(200));return MJe(t,e,null,r)};Mp.createRoot=function(t,e){if(!Nae(t))throw Error(At(299));var r=!1,i="",n=DMe;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(n=e.onRecoverableError)),e=$ae(t,1,!1,null,null,r,!1,i,n),t[Y_]=e.current,wD(t.nodeType===8?t.parentNode:t),new Lae(e)};Mp.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(At(188)):(t=Object.keys(t).join(","),Error(At(268,t)));return t=tCe(e),t=t===null?null:t.stateNode,t};Mp.flushSync=function(t){return gS(t)};Mp.hydrate=function(t,e,r){if(!dG(e))throw Error(At(200));return pG(null,t,e,!0,r)};Mp.hydrateRoot=function(t,e,r){if(!Nae(t))throw Error(At(405));var i=r!=null&&r.hydratedSources||null,n=!1,s="",o=DMe;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),e=$Me(e,null,t,1,r??null,n,!1,s,o),t[Y_]=e.current,wD(t),i)for(t=0;t<i.length;t++)r=i[t],n=r._getVersion,n=n(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,n]:e.mutableSourceEagerHydrationData.push(r,n);return new hG(e)};Mp.render=function(t,e,r){if(!dG(e))throw Error(At(200));return pG(null,t,e,!1,r)};Mp.unmountComponentAtNode=function(t){if(!dG(t))throw Error(At(40));return t._reactRootContainer?(gS(function(){pG(null,null,t,!1,function(){t._reactRootContainer=null,t[Y_]=null})}),!0):!1};Mp.unstable_batchedUpdates=Rae;Mp.unstable_renderSubtreeIntoContainer=function(t,e,r,i){if(!dG(r))throw Error(At(200));if(t==null||t._reactInternals===void 0)throw Error(At(38));return pG(t,e,r,!1,i)};Mp.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(r){console.error(r)}}e(),t.exports=Mp})(RXe);var ume=qZ;HZ.createRoot=ume.createRoot,HZ.hydrateRoot=ume.hydrateRoot;function h(t,e,r,i){var n,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o}const $Je="modulepreload",DJe=function(t){return"/csb-dashboard/"+t},hme={},be=function(e,r,i){if(!r||r.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(r.map(s=>{if(s=DJe(s),s in hme)return;hme[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let u=n.length-1;u>=0;u--){const d=n[u];if(d.href===s&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":$Je,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};function LJe(t){return t&&t.release&&typeof t.release=="function"}function NJe(t){return t&&t.acquire&&typeof t.acquire=="function"}let Sl=class BJ{constructor(e,r,i,n=1,s=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s,this._ctor)for(let o=0;o<s;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...e){let r;if(BJ.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let n=0;n<i;n++)this._pool[n]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):NJe(r)&&r.acquire(...e),r}release(e){e&&!BJ.test.disabled&&(this._releaseFunction?this._releaseFunction(e):LJe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};Sl.test={disabled:!1};function FJe(t){t.length=0}let Zh=class{constructor(e=50,r=50){this._pool=new Sl(Array,void 0,FJe,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return eW.acquire()}static release(e){return eW.release(e)}static prune(){eW.prune()}};const eW=new Zh(100);function Eir(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function kJe(t,e){for(const r of t)if(r!=null&&e(r))return r}function zJ(t){return t!=null&&typeof t[Symbol.iterator]=="function"}const lx=null;function M(t){return t!=null}function k(t){return t==null}function rl(t,e){return M(t)?e(t):lx}function Cir(t){return t}function Mir(t){return t}function nh(t,e){return fG(t,e),t}function fG(t,e){if(k(t))throw new Error(e??"value is None")}function br(t,e){return M(t)?t:typeof e=="function"?e():e}function dme(t,e){return M(t)?t:e}function yt(t){return M(t)&&t.destroy(),null}function kt(t){return M(t)&&t.dispose(),null}function ps(t){return M(t)&&t.remove(),null}function Gf(t){return M(t)&&t.abort(),null}function us(t){return M(t)&&t.release(),null}function UJe(t,e,r){return M(t)&&M(e)?M(r)?r(t,e):t.equals(e):t===e}function AS(t){return null}function Rir(t,e){const r=new Array;return t.forEach(i=>{const n=e(i);M(n)&&r.push(n)}),r}function Oir(t,e){const r=new Array;for(const i of t)r.push(tp(i,null,e));return r}function Pir(t,e){for(const r of t)rl(r,e)}function tp(t,e,r){return M(t)?r(t):e}function Iir(t){return t.filter(e=>M(e))}function Oa(t,...e){let r=t;for(let i=0;i<e.length&&r;++i)r=r[e[i]];return r}function $ir(t){return t}let cn=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(zJ(e)){const i=this._getOrCreateGroup(r);for(const n of e)this._isHandle(n)&&i.push(n)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&zJ(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){e.forEach(r=>r.remove())}};const LMe=Symbol("Accessor-beforeDestroy");function DR(t){return Rm(()=>t.forEach(e=>M(e)&&e.remove()))}function Rm(t){return{remove:()=>{t&&(t(),t=void 0)}}}function Lir(t){return Rm(M(t)?()=>t.destroy():void 0)}let d5=class cx{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*cx._m}getInt(){return this._seed=(cx._a*this._seed+cx._c)%cx._m,this._seed}getFloat(){return this.getInt()/(cx._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/cx._m*i}};d5._m=2147483647,d5._a=48271,d5._c=0;function gN(t,e){return e?t.filter((r,i,n)=>n.findIndex(e.bind(null,r))===i):t.filter((r,i,n)=>n.indexOf(r)===i)}function J_(t,e,r){if(k(t)&&k(e))return!0;if(k(t)||k(e)||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Fae(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function BJe(t,e,r){let i,n;return r?(i=e.filter(s=>!t.some(o=>r(o,s))),n=t.filter(s=>!e.some(o=>r(o,s)))):(i=e.filter(s=>!t.includes(s)),n=t.filter(s=>!e.includes(s))),{added:i,removed:n}}function zJe(t){return t&&typeof t.length=="number"}function Nir(t,e){const r=t.length;if(r===0)return[];const i=[];for(let n=0;n<r;n+=e)i.push(t.slice(n,n+e));return i}const VJe=!!Array.prototype.fill;function Fir(t,e){if(VJe)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function GJe(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function jJe(t,e,r){const i=t.length;let n=0,s=i-1;for(;n<s;){const a=n+Math.floor((s-n)/2);e>t[a]?n=a+1:s=a}const o=t[n];return r?e>=t[i-1]?-1:o===e?n:n-1:o===e?n:-1}let NMe=class{constructor(){this.last=0}};const FMe=new NMe;function VJ(t,e,r,i){i=i||FMe;const n=Math.max(0,i.last-10);for(let o=n;o<r;++o)if(t[o]===e)return i.last=o,o;const s=Math.min(n,r);for(let o=0;o<s;++o)if(t[o]===e)return i.last=o,o;return-1}function PD(t,e,r,i){const n=r??t.length,s=VJ(t,e,n,i);if(s!==-1)return t[s]=t[n-1],r==null&&t.pop(),e}const c0=new Set;function HJe(t,e,r=t.length,i=e.length,n,s){if(i===0||r===0)return r;c0.clear();for(let a=0;a<i;++a)c0.add(e[a]);n=n||FMe;const o=Math.max(0,n.last-10);for(let a=o;a<r;++a)if(c0.has(t[a])&&(s&&s.push(t[a]),c0.delete(t[a]),t[a]=t[r-1],--r,--a,c0.size===0||r===0))return c0.clear(),r;for(let a=0;a<o;++a)if(c0.has(t[a])&&(s&&s.push(t[a]),c0.delete(t[a]),t[a]=t[r-1],--r,--a,c0.size===0||r===0))return c0.clear(),r;return c0.clear(),r}function qJe(t,e){let r=0;for(let i=0;i<t.length;++i){const n=t[i];e(n,i)&&(t[r]=n,r++)}t.length=r}function WJe(t){return t?(pme.seed=t,()=>pme.getFloat()):Math.random}function Uir(t,e){const r=WJe(e);for(let i=t.length-1;i>0;i--){const n=Math.floor(r()*(i+1)),s=t[i];t[i]=t[n],t[n]=s}return t}const pme=new d5;function kae(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function Bir(t,e){const r=new Map,i=t.length;for(let n=0;n<i;n++){const s=t[n],o=e(s,n,t),a=r.get(o);a?a.push(s):r.set(o,[s])}return r}function KP(t){return t instanceof ArrayBuffer}function QJe(t){return t&&t.constructor&&t.constructor.name==="Int8Array"}function hT(t){return t&&t.constructor&&t.constructor.name==="Uint8Array"}function YJe(t){return t&&t.constructor&&t.constructor.name==="Uint8ClampedArray"}function XJe(t){return t&&t.constructor&&t.constructor.name==="Int16Array"}function Uae(t){return t&&t.constructor&&t.constructor.name==="Uint16Array"}function ZJe(t){return t&&t.constructor&&t.constructor.name==="Int32Array"}function Bae(t){return t&&t.constructor&&t.constructor.name==="Uint32Array"}function zae(t){return t&&t.constructor&&t.constructor.name==="Float32Array"}function Vae(t){return t&&t.constructor&&t.constructor.name==="Float64Array"}function n6(t){return M(t)?128+t.buffer.byteLength+64:0}const OA=1024;function kMe(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&kMe(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function Te(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=VMe(t);if(M(e))return e;if(UMe(t))return t.clone();if(BMe(t))return t.map(Te);if(zMe(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=Te(t[i]);return r}function GJ(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=VMe(t);if(M(e))return e;if(BMe(t)){let r=!0;const i=t.map(n=>{const s=GJ(n);return n!=null&&s==null&&(r=!1),s});return r?i:null}if(UMe(t))return t.clone();if(!zMe(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const n=t[i],s=GJ(n);if(n!=null&&s==null)return null;r[i]=s}return r}return null}function UMe(t){return typeof t.clone=="function"}function BMe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function zMe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function fme(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function VMe(t){if(QJe(t)||hT(t)||YJe(t)||XJe(t)||Uae(t)||ZJe(t)||Bae(t)||zae(t)||Vae(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,Te(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(Te(r));return e}return null}function Gae(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function JJe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&J_(t,e):t instanceof Set?e instanceof Set&&eKe(t,e):t instanceof Map?e instanceof Map&&tKe(t,e):!!fme(t)&&fme(e)&&KJe(t,e))}function KJe(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function eKe(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function tKe(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const n=e.get(r);if(n!==i||n===void 0&&!e.has(r))return!1}return!0}function bu(t){return t?t.__accessor__?t.__accessor__:t.propertyInvalidated?t:null:null}function rKe(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function R7(t,e,r){return r?eB(t,e,{policy:r,path:""}):eB(t,e,null)}function eB(t,e,r){return e?Object.keys(e).reduce((i,n)=>{let s=null,o="merge";if(r&&(s=r.path?`${r.path}.${n}`:n,o=r.policy(s)),o==="replace"||o==="replace-arrays"&&Array.isArray(i[n]))return i[n]=e[n],i;if(i[n]===void 0)return i[n]=Te(e[n]),i;let a=i[n],l=e[n];if(a===l)return i;if(Array.isArray(l)||Array.isArray(i))a=a?Array.isArray(a)?i[n]=a.concat():i[n]=[a]:i[n]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(r){const c=r.path;r.path=s,i[n]=eB(a,l,r),r.path=c}else i[n]=eB(a,l,null);else i.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(i[n]=l);return i},t||{}):t}function GMe(t){return Array.isArray(t)?t:t.split(".")}function mme(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function iKe(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...mme(r));return e}return mme(t)}function jMe(t,e,r,i){const n=iKe(e);if(n.length!==1){const s=n.map(o=>i(t,o,r));return DR(s)}return i(t,n[0],r)}function jae(t){let e=!1;return()=>{e||(e=!0,t())}}function HMe(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.getItemAt(n)}const i=bu(e);return rKe(i,r)?i.get(r):e[r]}function qMe(t,e,r){if(t==null)return t;const i=HMe(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:qMe(i,e,r+1)}function AN(t,e,r=0){return typeof e!="string"||e.includes(".")?qMe(t,GMe(e),r):HMe(e,t)}function tB(t,e){return AN(t,e)}function gme(t,e){return AN(e,t)!==void 0}function yN(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=Te(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function mG(t,e){const r=yN(t);let i=r[e];return i||(i=r[e]={}),i}function nKe(t,e){return R7(t,e,oKe)}const sKe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function oKe(t){return sKe.test(t)?"replace":"merge"}let Fb;function Fe(t){return typeof Fb[t]=="function"?Fb[t]=Fb[t](globalThis):Fb[t]}var _3e,v3e,b3e,w3e;Fb=(_3e=globalThis.dojoConfig)!=null&&_3e.has||(v3e=globalThis.esriConfig)!=null&&v3e.has?{...(b3e=globalThis.dojoConfig)==null?void 0:b3e.has,...(w3e=globalThis.esriConfig)==null?void 0:w3e.has}:{},Fe.add=(t,e,r,i)=>((i||Fb[t]===void 0)&&(Fb[t]=e),r&&Fe(t)),Fe.cache=Fb,Fe.add("esri-deprecation-warnings",!0),(()=>{var e;Fe.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(Fe.add("host-browser",t),Fe.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),Fe.add("dom",t),Fe("host-browser")){const r=navigator,i=r.userAgent,n=r.appVersion,s=parseFloat(n);if(Fe.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),Fe.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),Fe.add("khtml",n.includes("Konqueror")?s:void 0),Fe.add("edge",parseFloat(i.split("Edge/")[1])||void 0),Fe.add("opr",parseFloat(i.split("OPR/")[1])||void 0),Fe.add("webkit",!Fe("wp")&&!Fe("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),Fe.add("chrome",!Fe("edge")&&!Fe("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),Fe.add("android",!Fe("wp")&&parseFloat(i.split("Android ")[1])||void 0),Fe.add("safari",!n.includes("Safari")||Fe("wp")||Fe("chrome")||Fe("android")||Fe("edge")||Fe("opr")?void 0:parseFloat(n.split("Version/")[1])),Fe.add("mac",n.includes("Macintosh")),!Fe("wp")&&i.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=i.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));Fe.add(o,l),Fe.add("ios",l)}Fe("webkit")||(!i.includes("Gecko")||Fe("wp")||Fe("khtml")||Fe("edge")||Fe.add("mozilla",s),Fe("mozilla")&&Fe.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&Fe.add("esri-mobile",e),r&&Fe.add("esri-iPhone",r),Fe.add("esri-geolocation",!!navigator.geolocation)}Fe.add("esri-wasm","WebAssembly"in globalThis),Fe.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),Fe.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),Fe.add("esri-atomics","Atomics"in globalThis),Fe.add("esri-workers","Worker"in globalThis),Fe.add("web-feat:cache","caches"in globalThis),Fe.add("esri-workers-arraybuffer-transfer",!Fe("safari")||Number(Fe("safari"))>=12),Fe.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),Fe.add("featurelayer-simplify-payload-size-factors",[1,1,4]),Fe.add("featurelayer-snapshot-enabled",!0),Fe.add("featurelayer-snapshot-point-min-threshold",8e4),Fe.add("featurelayer-snapshot-point-max-threshold",4e5),Fe.add("featurelayer-snapshot-point-coverage",.1),Fe.add("featurelayer-advanced-symbols",!1),Fe.add("featurelayer-pbf",!0),Fe.add("featurelayer-pbf-statistics",!1),Fe.add("feature-layers-workers",!0),Fe.add("feature-polyline-generalization-factor",1),Fe.add("mapview-transitions-duration",200),Fe.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),Fe.add("mapserver-pbf-version-support",10.81),Fe.add("mapservice-popup-identify-max-tolerance",20),Fe.add("heatmap-allow-raster-fallback",!0),Fe.add("heatmap-force-raster",!1),Fe("host-webworker")||Fe("host-browser")&&(Fe.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),Fe.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{Fe.add("esri-image-decode",!0,!0,!0)}).catch(()=>{Fe.add("esri-image-decode",!1,!0,!0)})}return!1}),Fe.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function WMe(t,e,r=!1){return YMe(t,e,r)}function _N(t,e){if(e!=null)return e[t]||QMe(t.split("."),!1,e)}function wu(t,e,r){const i=t.split("."),n=i.pop(),s=QMe(i,!0,r);s&&n&&(s[n]=e)}function QMe(t,e,r){let i=r;for(const n of t){if(i==null)return;if(!(n in i)){if(!e)return;i[n]={}}i=i[n]}return i}function YMe(t,e,r){return e?Object.keys(e).reduce((i,n)=>{let s=i[n],o=e[n];return s===o?i:s===void 0?(i[n]=Te(o),i):(Array.isArray(o)||Array.isArray(i)?(s=s?Array.isArray(s)?i[n]=s.concat():i[n]=[s]:i[n]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{s.includes(a)||s.push(a)}):i[n]=o.concat())):o&&typeof o=="object"?i[n]=YMe(s,o,r):i.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(i[n]=o),i)},t||{}):t}var x3e;const gn={analysisTheme:{accentColor:[255,128,0],textColor:"white"},apiKey:void 0,applicationUrl:(x3e=globalThis.location)==null?void 0:x3e.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(WMe(gn,globalThis.esriConfig,!0),delete gn.has),!gn.assetsPath){{const t="4.26.5";gn.assetsPath=`https://js.arcgis.com/${t.slice(0,-2)}/@arcgis/core/assets`}gn.defaultAssetsPath=gn.assetsPath}const aKe=/\{([^\}]+)\}/g;function Ame(t){return t??""}function PA(t,e){return t.replace(aKe,typeof e=="object"?(r,i)=>Ame(_N(i,e)):(r,i)=>Ame(e(i)))}function XMe(t,e){return t.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function Hae(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function zir(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}const yme={info:0,warn:1,error:2,none:3};let we=class Jc{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Jc._loggers[this.module]=this;const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=Jc.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(e={}){const r=Jc._loggers;return Jc._loggers=e,r},set throttlingDisabled(e){Jc._throttlingDisabled=e}}}static getLogger(e){let r=Jc._loggers[e];return r||(r=new Jc({module:e})),r}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!Jc._throttlingDisabled){const n=this._argsToKey(i),s=this._loggedMessages[e].get(n);if(r==="once"&&s!=null||r==="oncePerTick"&&s&&s>=Jc._tickCounter)return;this._loggedMessages[e].set(n,Jc._tickCounter),Jc._scheduleTickCounterIncrement()}for(const n of gn.log.interceptors)if(n(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;M(i);){const n=i[e];if(M(n))return n;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=gn.log.level?gn.log.level:"warn";return yme[this._parentWithMember("level",r)]<=yme[e]}_argsToKey(...e){return Hae(JSON.stringify(e,(i,n)=>typeof n!="object"||Array.isArray(n)?n:"[Object]"))}static _scheduleTickCounterIncrement(){Jc._tickCounterScheduled||(Jc._tickCounterScheduled=!0,Promise.resolve().then(()=>{Jc._tickCounter++,Jc._tickCounterScheduled=!1}))}};we._loggers={},we._tickCounter=0,we._tickCounterScheduled=!1,we._throttlingDisabled=!1;var __;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(__||(__={}));let lKe=class{constructor(e,r){this._observers=e,this._observer=r}remove(){kae(this._observers,this._observer)}},ZMe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return cKe;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,n=!1;const s=r.length;for(let o=0;o<s;++o){const a=r[o];if(a.destroyed)n=!0;else if(a===e){i=!0;break}}return i||(r.push(e),n&&this._removeDestroyedObservers()),new lKe(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let n=0;n<r;++n){for(;n+i<r&&e[n+i].destroyed;)++i;if(i>0){if(!(n+i<r))break;e[n]=e[n+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const cKe={remove:()=>{}};var Zi;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.USER=6]="USER"})(Zi||(Zi={}));const jJ=Zi.USER+1;function kb(t){switch(t){case"defaults":return Zi.DEFAULTS;case"service":return Zi.SERVICE;case"portal-item":return Zi.PORTAL_ITEM;case"web-scene":return Zi.WEB_SCENE;case"web-map":return Zi.WEB_MAP;case"user":return Zi.USER;default:return null}}function rB(t){switch(t){case Zi.DEFAULTS:return"defaults";case Zi.SERVICE:return"service";case Zi.PORTAL_ITEM:return"portal-item";case Zi.WEB_SCENE:return"web-scene";case Zi.WEB_MAP:return"web-map";case Zi.USER:return"user"}return void 0}function uKe(t){return rB(t)}var ts;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(ts||(ts={}));const iB={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},x$=[];let p5=iB;function Ai(t){p5.onObservableAccessed(t)}let O7=!1,P7=!1;function K_(t,e,r){if(O7)return qae(t,e,r);JMe(t);const i=e.call(r);return KMe(),i}function hKe(t,e){return K_(iB,t,e)}function qae(t,e,r){const i=O7;O7=!0,JMe(t);let n=null;try{n=e.call(r)}catch(s){P7&&we.getLogger("esri.core.accessorSupport.tracking").error(s)}return KMe(),O7=i,n}function JMe(t){p5=t,x$.push(t)}function KMe(){const t=x$.length;if(t>1){const e=x$.pop();p5=x$[t-2],e.onTrackingEnd()}else if(t===1){const e=x$.pop();p5=iB,e.onTrackingEnd()}else p5=iB}function eRe(t,e){const r=e.observerObject;if(r.flags&ts.DepTrackingInitialized)return;const i=P7;P7=!1,r.flags&ts.AutoTracked?qae(e,e.metadata.get,t):tRe(t,e),P7=i}const dKe=[];function tRe(t,e){const r=e.observerObject;r.flags&ts.ExplicitlyTracking||(r.flags|=ts.ExplicitlyTracking,qae(e,()=>{const i=e.metadata.dependsOn||dKe;for(const n of i)if(typeof n!="string"||n.includes(".")){const s=GMe(n);for(let o=0,a=t;o<s.length&&a!=null&&typeof a=="object";++o)a=_me(a,s[o],o!==s.length-1)}else _me(t,n,!1)}),r.flags&=~ts.ExplicitlyTracking)}function _me(t,e,r){var s;const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const o=parseInt(i,10);if(!isNaN(o))return Array.isArray(t)?t[o]:t.getItemAt(o)}const n=(s=bu(t))==null?void 0:s.properties.get(i);return n&&(Ai(n.observerObject),eRe(t,n)),r?t[i]:void 0}let vme=class{constructor(e,r,i){this.properties=e,this.propertyName=r,this.metadata=i,this.observerObject=new pKe,this._accessed=null,this._handles=null,this.observerObject.flags=ts.Dirty|(i.nonNullable?ts.NonNullable:0)|(i.hasOwnProperty("value")?ts.HasDefaultValue:0)|(i.get===void 0?ts.DepTrackingInitialized:0)|(i.dependsOn===void 0?ts.AutoTracked:0),bme.register(this,this.observerObject)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles(),bme.unregister(this)}getComputed(){const e=this.observerObject;Ai(e);const r=this.properties.store,i=this.propertyName,n=e.flags,s=r.get(i);if(n&ts.Computing||~n&ts.Dirty&&r.has(i))return s;e.flags|=ts.Computing;const o=this.properties.host;let a;n&ts.AutoTracked?a=K_(this,this.metadata.get,o):(tRe(o,this),a=this.metadata.get.call(o)),r.set(i,a,Zi.COMPUTED);const l=r.get(i);return l===s?e.flags&=~ts.Dirty:hKe(this.commit,this),e.flags&=~ts.Computing,l}onObservableAccessed(e){e!==this.observerObject&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(e)||this._accessed.push(e))}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=ts.DepTrackingInitialized;const r=this._accessed;if(r===null)return;let i=this._handles;i===null&&(i=this._handles=[]);for(let n=0;n<r.length;++n)i.push(r[n].observe(e));r.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~ts.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}},pKe=class extends ZMe{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&ts.Overriden&&(this.flags|=ts.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&ts.Dirty&&this.onCommitted(),super.destroy()}};const bme=new FinalizationRegistry(t=>{t.destroy()});let fKe=class rRe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new rRe;return this._values.forEach((i,n)=>{e&&e.has(n)||r.set(n,Te(i))}),r}get(e){return this._values.get(e)}originOf(){return Zi.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function s6(t,e,r){return t!==void 0}function wme(t,e,r,i){return t!==void 0&&(!(r==null&&t.observerObject.flags&ts.NonNullable)||(i.lifecycle,__.INITIALIZING,!1))}function mKe(t){return t&&typeof t.destroy=="function"}we.getLogger("esri.core.accessorSupport.Properties");let gKe=class{constructor(e){this.host=e,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=__.INITIALIZING,this.store=new fKe,this._origin=Zi.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const n=new vme(this,i,r[i]);this.properties.set(i,n)}this.metadatas=r}initialize(){this.lifecycle=__.CONSTRUCTING}constructed(){this.lifecycle=__.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,r]of this.properties){if(r.metadata.autoDestroy){const i=this.internalGet(e);i&&mKe(i)&&(i.destroy(),~r.observerObject.flags&ts.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==__.INITIALIZING}get(e){const r=this.properties.get(e);if(r.metadata.get)return r.getComputed();Ai(r.observerObject);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.properties.get(e);if(i!==void 0&&i.observerObject.flags&ts.HasDefaultValue)return"defaults"}return rB(r)}has(e){return!!this.properties.has(e)&&this.store.has(e)}keys(){return[...this.properties.keys()]}internalGet(e){const r=this.properties.get(e);if(s6(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.properties.get(e);s6(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const n=this.properties.get(r);if(!s6(n))return"";const s=new Set,o=K_({onObservableAccessed:l=>s.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=n.metadata.get)==null?void 0:l.call(e)});let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(s.size===0)return a;i+="  ";for(const l of s){if(!(l instanceof vme))continue;const c=l.properties.host,u=l.propertyName,d=bu(c);a+=d?d.getDependsInfo(c,u,i):`${i}${u}: undefined
`}return a}setAtOrigin(e,r,i){const n=this.properties.get(e);if(s6(n))return this._setAtOrigin(n,r,i)}isOverridden(e){const r=this.properties.get(e);return r!==void 0&&!!(r.observerObject.flags&ts.Overriden)}clearOverride(e){const r=this.properties.get(e),i=r==null?void 0:r.observerObject;i&&i.flags&ts.Overriden&&(i.flags&=~ts.Overriden,r.notifyChange())}override(e,r){const i=this.properties.get(e);if(!wme(i,e,r,this))return;const n=i.metadata.cast;if(n){const s=this._cast(n,r),{valid:o,value:a}=s;if(tW.release(s),!o)return;r=a}i.observerObject.flags|=ts.Overriden,this._internalSet(i,r)}set(e,r){const i=this.properties.get(e);if(!wme(i,e,r,this))return;const n=i.metadata.cast;if(n){const o=this._cast(n,r),{valid:a,value:l}=o;if(tW.release(o),!a)return;r=l}const s=i.metadata.set;s?s.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=kb(e)}getDefaultOrigin(){return rB(this._origin)}notifyChange(e){const r=this.properties.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.properties.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.properties.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==__.INITIALIZING?this._origin:Zi.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const n=this.store,s=e.propertyName;n.has(s,i)&&Gae(r,n.get(s))&&~e.observerObject.flags&ts.Overriden&&i===n.originOf(s)||(e.invalidate(),n.set(s,r,i),e.commit(),eRe(this.host,e))}_cast(e,r){const i=tW.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},AKe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const tW=new Sl(AKe);function yKe(t,e){return t.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>{if(i==="")return"$";const n=_N(i,e),s=n??"";if(s===void 0)throw new Error(`could not find key "${i}" in template`);return s.toString()})}let iRe=class nRe{constructor(e,r,i){this.name=e,this.details=i,this instanceof nRe&&(this.message=(r&&yKe(r,i))??"")}toString(){return"["+this.name+"]: "+this.message}},pe=class I7 extends iRe{constructor(e,r,i){if(super(e,r,i),!(this instanceof I7))return new I7(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return Te(r)}catch{return"[object]"}}))}}catch(e){throw we.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new I7(e.name,e.message,e.details)}};pe.prototype.type="error";function nB(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))nB(t,i,e[i]);else{if(e.includes(".")){const n=e.split("."),s=n.splice(n.length-1,1)[0];return void nB(tB(t,n),s,r)}const i=t.__accessor__;i!=null&&_Ke(e,i),t[e]=r}}function _Ke(t,e){if(Fe("esri-unknown-property-errors")&&!vKe(t,e))throw new pe("set:unknown-property",bKe(t,e))}function vKe(t,e){return e.metadatas[t]!=null}function bKe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let sRe=class extends Sl{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=AS(this._set)}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const o6=[];function LR(t){o6.push(t),o6.length===1&&queueMicrotask(()=>{const e=o6.slice();o6.length=0;for(const r of e)r()})}let E_=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){M(e)&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var HJ;(function(t){const e=(s,o,a,l)=>{let c=o,u=o;const d=a>>>1,p=s[c-1];for(;u<=d;){u=c<<1,u<a&&l(s[u-1],s[u])<0&&++u;const A=s[u-1];if(l(A,p)<=0)break;s[c-1]=A,c=u}s[c-1]=p},r=(s,o)=>s<o?-1:s>o?1:0;function i(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(s,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const d=s[o];s[o]=s[u],s[u]=d,e(s,c,u,l)}}function*n(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(s,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const d=s[o];s[o]=s[u],s[u]=d,e(s,c,u,l),yield}}t.sort=i,t.iterableSort=n})(HJ||(HJ={}));const xme=HJ,wKe=1.5,xKe=1.1;let Vr=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new NMe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>Tme(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const n=this.data[i];e(n)&&r.push(n)}return r}getItemAt(e){if(!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,Tme(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=VJ(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(VJ(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=HJe(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){xme.sort(this.data,0,this.length,e)}iterableSort(e){return xme.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const n=this.data[i];if(e.call(r,n,i))return n}}filterInPlace(e,r){let i=0;for(let n=0;n<this._length;++n){const s=this.data[n];e.call(r,s,n,this.data)&&(this.data[n]=this.data[i],this.data[i]=s,i++)}if(this._deallocator)for(let n=i;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=i,this._shrink(),this}forAll(e,r){const i=this.length,n=this.data;for(let s=0;s<i;++s)e.call(r,n[s],s,n)}forEach(e,r){for(let i=0;i<this.length;++i)e.call(r,this.data[i],i,this.data)}map(e,r){const i=new Array(this.length);for(let n=0;n<this.length;++n)i[n]=e.call(r,this.data[n],n,this.data);return i}reduce(e,r){let i=r;for(let n=0;n<this.length;++n)i=e(i,this.data[n],n,this.data);return i}has(e){const r=this.length,i=this.data;for(let n=0;n<r;++n)if(i[n]===e)return!0;return!1}};function Tme(t){t.data.length>wKe*t.length&&(t.data.length=Math.floor(t.length*xKe))}function TKe(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return{remove:()=>t.clearTimeout(i)}}}}const gG=TKe(globalThis),Sme=new Set;function SKe(t,e,r=!1){r&&Sme.has(e)||(r&&Sme.add(e),t.warn(` DEPRECATED - ${e}`))}function qJ(t,e,r={}){if(Fe("esri-deprecation-warnings")){const{moduleName:i}=r;oRe(t,`Property: ${(i?i+"::":"")+e}`,r)}}function oRe(t,e,r={}){if(Fe("esri-deprecation-warnings")){const{replacement:i,version:n,see:s,warnOnce:o}=r;let a=e;i&&(a+=`
	 Replacement: ${i}`),n&&(a+=`
	 Version: ${n}`),s&&(a+=`
	 See ${s} for more details.`),SKe(t,a,o)}}function AG(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function vN(t,e,r){if(!AG(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,r);if(Array.isArray(e)){const i=e.slice();for(const n of i)t.addEventListener(n,r);return{remove(){for(const n of i)t.removeEventListener(n,r)}}}return t.addEventListener(e,r),{remove(){t.removeEventListener(e,r)}}}function aRe(t,e,r){if(!AG(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=vN(t,e,n=>{i.remove(),r.call(t,n)});return{remove(){i.remove()}}}const EKe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function Sb({key:t}){return EKe[t]||t}function en(t="Aborted"){return new pe("AbortError",t)}function fi(t,e="Aborted"){if(Ra(t))throw en(e)}function yG(t){return M(t)?"aborted"in t?t:t.signal:t}function Ra(t){const e=yG(t);return M(e)&&e.aborted}function Jh(t){if($o(t))throw t}function WJ(t){if(!$o(t))throw t}function Sc(t,e){const r=yG(t);if(!k(r)){if(!r.aborted)return aRe(r,"abort",()=>e());e()}}function Wae(t,e){const r=yG(t);if(!k(r))return fi(r),aRe(r,"abort",()=>e(en()))}function Qae(t,e){const r=yG(e);return k(r)?t:new Promise((i,n)=>{let s=Sc(e,()=>n(en()));const o=()=>s=ps(s);t.then(o,o),t.then(i,n)})}function $o(t){return(t==null?void 0:t.name)==="AbortError"}async function jM(t){try{return await t}catch(e){if(!$o(e))throw e;return}}async function Zir(t,e=we.getLogger("esri")){try{return await t}catch(r){$o(r)||e.error(r)}}function x2(){let t=null;const e=new Promise((r,i)=>{t={promise:void 0,resolve:r,reject:i}});return t.promise=e,t}async function fh(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),n=await fh(i),s={};return r.map((o,a)=>s[o]=n[a]),s}const e=t;return new Promise(r=>{const i=[];let n=e.length;n===0&&r(i),e.forEach(s=>{const o={promise:s||Promise.resolve(s)};i.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--n,n===0&&r(i)})})})}async function QJ(t){return(await fh(t)).filter(e=>!!e.value).map(e=>e.value)}function yS(t,e,r){const i=new AbortController;return Sc(r,()=>i.abort()),new Promise((n,s)=>{let o=setTimeout(()=>{o=0,n(e)},t);Sc(i,()=>{o&&(clearTimeout(o),s(en()))})})}function Op(t){return t&&typeof t.then=="function"}function YJ(t){return Op(t)?t:Promise.resolve(t)}function lRe(t,e=-1){let r,i,n,s,o=null;const a=(...l)=>{if(r){i=l,s&&s.reject(en()),s=x2();const p=s.promise;if(o){const A=o;o=null,A.abort()}return p}if(n=s||x2(),s=null,e>0){const p=new AbortController;r=YJ(t(...l,p.signal));const A=r;yS(e).then(()=>{r===A&&(s?p.abort():o=p)})}else r=1,r=YJ(t(...l));const c=()=>{const p=i;i=n=r=o=null,p!=null&&a(...p)},u=r,d=n;return u.then(c,c),u.then(d.resolve,d.reject),d.promise};return a}function T2(){let t,e;const r=new Promise((n,s)=>{t=n,e=s}),i=n=>{t(n)};return i.resolve=n=>t(n),i.reject=n=>e(n),i.timeout=(n,s)=>gG.setTimeout(()=>i.reject(s),n),i.promise=r,i}function Jir(t,e){return t.then(e,e)}async function Eme(t){await Promise.resolve(),fi(t)}function Kir(t){return t}function cRe(t){return 1e3*t}function Yae(t){return .001*t}let CKe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},MKe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},XJ=0,ZJ=0;const eI={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},JJ=["prepare","preRender","render","postRender","update","finish"],KJ=[],_S=new Vr;let RKe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const sB={frameTasks:_S,willDispatch:!1,clearFrameTasks:OKe,dispatch:dRe,executeFrameTasks:IKe};function WO(t){const e=new MKe(t);return KJ.push(e),sB.willDispatch||(sB.willDispatch=!0,LR(dRe)),e}function NR(t){const e=new CKe(t);return _S.push(e),oB==null&&(XJ=performance.now(),oB=requestAnimationFrame(uRe)),new RKe(e)}let oB=null;function OKe(t=!1){_S.forAll(e=>{e.removed=!0}),t&&hRe()}function PKe(t){ZJ=Math.max(0,t)}function uRe(){const t=performance.now();oB=null,oB=_S.length>0?requestAnimationFrame(uRe):null,sB.executeFrameTasks(t)}function IKe(t){const e=t-XJ;XJ=t;const r=ZJ>0?ZJ:1e3/60,i=Math.max(0,e-r);eI.time=t,eI.frameDuration=r-i;for(let n=0;n<JJ.length;n++){const s=performance.now(),o=JJ[n];_S.forAll(a=>{var l;a.paused||a.removed||(n===0&&a.ticks++,a.phases[o]&&(eI.elapsedFrameTime=performance.now()-t,eI.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,eI)))}),$Ke[n].record(performance.now()-s)}hRe(),DKe.record(performance.now()-t)}const a6=new Vr;function hRe(){_S.forAll(t=>{t.removed&&a6.push(t)}),_S.removeUnorderedMany(a6.data,a6.length),a6.clear()}function dRe(){for(;KJ.length;){const t=KJ.shift();t.isActive&&t.callback()}sB.willDispatch=!1}function inr(t=1,e){const r=T2(),i=()=>{Ra(e)?r.reject(en()):t===0?r():(--t,LR(()=>i()))};return i(),r.promise}const $Ke=JJ.map(t=>new E_(t)),DKe=new E_("total");function $7(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}let LKe=0;const NKe=0;function hd(){return++LKe}let _G=class{constructor(e){this._notify=e,this._accessed=[],this._handles=[],this._observerObject=new FKe(this._notify),Cme.register(this,this._observerObject)}destroy(){var e;this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear(),Cme.unregister(this)}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let n=0;n<r.length;++n)e.push(r[n].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},FKe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=kKe}};const Cme=new FinalizationRegistry(t=>{t.destroy()});function kKe(){}let HM=!1;const aB=[];function pRe(t,e){let r=new _G(s),i=null,n=!1;function s(){if(!r||n)return;if(HM)return void gRe(s);const a=i;r.clear(),HM=!0,n=!0,i=K_(r,t),n=!1,HM=!1,e(i,a),ARe()}function o(){r&&(r.destroy(),r=null,i=null)}return n=!0,i=K_(r,t),n=!1,{remove:o}}function fRe(t,e){let r=new _G(n),i=null;function n(){e(i,o)}function s(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=K_(r,t),i):null}return o(),{remove:s}}function mRe(t){let e=new _G(i),r=!1;function i(){e&&!r&&(HM?gRe(i):(e.clear(),HM=!0,r=!0,K_(e,t),r=!1,HM=!1,ARe()))}function n(){e&&(e.destroy(),e=null)}return r=!0,K_(e,t),r=!1,{remove:n}}function gRe(t){aB.includes(t)||aB.unshift(t)}function ARe(){for(;aB.length;)aB.pop()()}var f5;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(f5||(f5={}));let ID=class{constructor(){this.uid=hd(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,n,s){return this.pool.acquire(f5.Untracked,e,r,i,n,s,Gae)}static acquireTracked(e,r,i,n){return this.pool.acquire(f5.Tracked,e,r,i,null,null,n)}notify(e,r){this.type===f5.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r)}acquire(e,r,i,n,s,o,a){this.uid=hd(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=n,this.target=s,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=hd(),this.removed=!0}};ID.pool=new sRe(ID);const D7=new Zh,L_=new Set;let lB;function cB(t){L_.delete(t),L_.add(t),lB||(lB=WO(zKe))}function UKe(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function BKe(t){for(const e of L_.values())e.target===t&&(e.removed=!0)}function zKe(){let t=10;for(;lB&&t--;){lB=null;const e=VKe(),r=D7.acquire();for(const i of e){const n=i.uid;UKe(i),n===i.uid&&i.removed&&r.push(i)}for(const i of L_)i.removed&&(r.push(i),L_.delete(i));for(const i of r)ID.pool.release(i);D7.release(r),D7.release(e),eK.forEach(i=>i())}}function VKe(){const t=D7.acquire();t.length=L_.size;let e=0;for(const r of L_)t[e]=r,++e;return L_.clear(),t}const eK=new Set;function yRe(t){return eK.add(t),{remove(){eK.delete(t)}}}function GKe(t,e,r){let i=jMe(t,e,r,(n,s,o)=>{let a,l,c=fRe(()=>AN(n,s),(u,d)=>{n.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=ID.acquireUntracked(u,o,d,n,s),l=a.uid),cB(a))});return{remove:jae(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,cB(a)),a=null),i=c=null})}});return i}function jKe(t,e,r){const i=jMe(t,e,r,(n,s,o)=>{let a=!1;return pRe(()=>AN(n,s),(l,c)=>{n.__accessor__.destroyed?i.remove():a||(a=!0,Gae(c,l)||o.call(n,l,c,s,n),a=!1)})});return i}function HKe(t,e,r,i=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:i?jKe(t,e,r):GKe(t,e,r)}function qKe(t,e,r){let i,n,s=fRe(t,(o,a)=>{i&&i.uid!==n?s.remove():(i||(i=ID.acquireTracked(o,e,a,r),n=i.uid),cB(i))});return{remove:jae(()=>{s.remove(),i&&(i.uid!==n||i.removed||(i.removed=!0,cB(i)),i=null),s=null})}}function WKe(t,e,r){let i=!1;return pRe(t,(n,s)=>{i||(i=!0,r(s,n)||e(n,s),i=!1)})}function QKe(t,e,r=!1,i=JJe){return r?WKe(t,e,i):qKe(t,e,i)}function Mme(t){return $7(L_,e=>e.oldValue===t)}function Ql(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function anr(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function Xae(t,e,r){const i=t.get(e);if(i!==void 0)return i;const n=r();return t.set(e,n),n}const qM=we.getLogger("esri.core.accessorSupport.ensureTypes");function YKe(t){return t==null?t:new Date(t)}function XKe(t){return t==null?t:!!t}function bN(t){return t==null?t:t.toString()}function yf(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function Zae(t){return t==null?t:Math.round(parseFloat(t))}function _Re(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function uB(t,e){return e!=null&&t&&!(e instanceof t)}function vRe(t){return t&&"isCollection"in t}function Rme(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function ZKe(t,e){if(!e||!e.constructor||!vRe(e.constructor))return tK(t,e)?e:new t(e);const r=Rme(t.prototype.itemType),i=Rme(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(tK(t,e),e):new t(e):e}function tK(t,e){return!!_Re(e)&&(qM.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+vG(t)+"'"),!0)}function FR(t,e){return e==null?e:vRe(t)?ZKe(t,e):uB(t,e)?tK(t,e)?e:new t(e):e}function vG(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const JKe=new WeakMap;function KKe(t){switch(t){case Number:return yf;case ds:return Zae;case Boolean:return XKe;case String:return bN;case Date:return YKe;default:return Xae(JKe,t,()=>FR.bind(null,t))}}function Go(t,e){const r=KKe(t);return arguments.length===1?r:r(e)}function $D(t,e,r){return arguments.length===1?$D.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function eet(t,e){return arguments.length===1?$D(Go.bind(null,t)):$D(Go.bind(null,t),e)}function bRe(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>bRe(t,e-1,i)):t(r)}function hB(t,e,r){if(arguments.length===2)return hB.bind(null,t,e);if(!r)return r;let i=e,n=r=bRe(t,e,r);for(;i>0&&Array.isArray(n);)i--,n=n[0];if(n!==void 0)for(let s=0;s<i;s++)r=[r];return r}function tet(t,e,r){return arguments.length===2?hB(Go.bind(null,t),e):hB(Go.bind(null,t),e,r)}function wRe(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function rK(t,e){if(arguments.length===2)return rK(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),n=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let s=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(r.has(a)||n.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&n.some(d=>!uB(a,d))?a:(u&&i.length?(s||(s=i.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),qM.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof a=="object"&&n.length?(o||(o=n.map(d=>vG(d)).join(", ")),qM.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):qM.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Om(t,e){if(arguments.length===2)return Om(t).call(null,e);const r={},i=[],n=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=Go(c),i.push(vG(c)),n.push(l)}const s=()=>`'${i.join("', '")}'`,o=()=>`'${n.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!uB(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=r[c];if(!u)return qM.error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!uB(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!_Re(l)){const d={};for(const p in l)p!==t.key&&(d[p]=l[p]);return u(d)}return u(l)}}let ds=class{};const cnr={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function ret(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function xRe(t){switch(t.type){case"native":return Go(t.value);case"array":return $D(xRe(t.value));case"one-of":return iet(t);default:return null}}function iet(t){let e=null;return(r,i)=>nK(r,t)?r:(e==null&&(e=iK(t)),qM.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function iK(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case ds:return"integer";case Date:return"date";default:return vG(t.value)}case"array":return`array of ${iK(t.value)}`;case"one-of":{const e=t.values.map(r=>iK(r));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function nK(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case ds:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!nK(r,e.value));case"one-of":return e.values.some(r=>nK(t,r))}}function f(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),n=mG(e,r);i&&(i.get||i.set?(n.get=i.get||n.get,n.set=i.set||n.set):"value"in i&&("value"in t&&we.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),n.value=t.value=i.value)),t.readOnly!=null&&(n.readOnly=t.readOnly);const s=t.aliasOf;if(s){const l=typeof s=="string"?s:s.source,c=typeof s=="string"?null:s.overridable===!0;let u;n.dependsOn=[l],n.get=function(){let d=tB(this,l);if(typeof d=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=tB(this,u);p&&(d=d.bind(p))}return d},n.readOnly||(n.set=c?function(d){this._override(r,d)}:function(d){nB(this,l,d)})}const o=t.type,a=t.types;n.cast||(o?n.cast=net(o):a&&(Array.isArray(a)?n.cast=$D(Om(a[0])):n.cast=Om(a))),nKe(n,t),t.range&&(n.cast=set(n.cast,t.range))}}function TRe(t,e,r){const i=mG(t,r);i.json||(i.json={});let n=i.json;return e!==void 0&&(n.origins||(n.origins={}),n.origins[e]||(n.origins[e]={}),n=n.origins[e]),n}function net(t){let e=0,r=t;if(ret(t))return xRe(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(wRe(i))return e===0?rK(i):hB(rK(i),e);if(e===1)return eet(i);if(e>1)return tet(i,e);const n=t;return n.from?n.from:Go(n)}function set(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function oet(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const n=e[i];r[i].forEach(s=>{e[s]=n}),delete e[i]}}}let IA=class sK extends iRe{constructor(e,r,i){if(super(e,r,i),!(this instanceof sK))return new sK(e,r,i)}};IA.prototype.type="warning";function SRe(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const oK=we.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function Ome(t,e,r){var i,n;t&&(!r&&!e.read||(i=e.read)!=null&&i.reader||((n=e.read)==null?void 0:n.enabled)===!1||uet(t)&&wu("read.reader",J2(t),e))}function J2(t){var r,i;const e=t.ndimArray??0;if(e>1)return cet(t);if(e===1)return Pme(t);if("type"in t&&CRe(t.type)){const n=(i=(r=t.type.prototype)==null?void 0:r.itemType)==null?void 0:i.Type,s=Pme(typeof n=="function"?{type:n}:{types:n});return(o,a,l)=>{const c=s(o,a,l);return c&&new t.type(c)}}return Jae(t)}function Jae(t){return"type"in t?aet(t.type):het(t.types)}function aet(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const n=typeof e;if(n!=="object")return void oK.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${n}'`);const s=new t;return s.read(e,i),s}:t.fromJSON}function ERe(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(n=>ERe(t,n,r,i-1)):t(e,void 0,r)}function cet(t){const e=Jae(t),r=ERe.bind(null,e),i=t.ndimArray??0;return(n,s,o)=>{if(n==null)return n;n=r(n,o,i);let a=i,l=n;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)n=[n];return n}}function Pme(t){const e=Jae(t);return(r,i,n)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,n);l!==void 0&&o.push(l)}return o}const s=e(r,void 0,n);return s!==void 0?[s]:void 0}}function CRe(t){if(!SRe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?Kae(e.Type):MRe(e.Type))}function uet(t){return"types"in t?MRe(t.types):Kae(t.type)}function Kae(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||CRe(t))}function MRe(t){for(const e in t.typeMap)if(!Kae(t.typeMap[e]))return!1;return!0}function het(t){let e=null;const r=t.errorContext??"type";return(i,n,s)=>{if(i==null)return i;const o=typeof i;if(o!=="object")return void oK.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=det(t));const a=t.key;if(typeof a!="string")return;const l=i[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const d=`Type '${l||"unknown"}' is not supported`;return s&&s.messages&&i&&s.messages.push(new IA(`${r}:unsupported`,d,{definition:i,context:s})),void oK.error(d)}const u=new c;return u.read(i,s),u}}function det(t){var r,i;const e={};for(const n in t.typeMap){const s=t.typeMap[n],o=yN(s.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(r=a.json)!=null&&r.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=s);const l=(i=a.json)==null?void 0:i.write;if(!l||!l.writer){e[n]=s;continue}const c=l.target,u=typeof c=="string"?c:t.key,d={};l.writer(n,d,u),d[u]&&(e[d[u]]=s)}return e}function pet(t){if(t.json||(t.json={}),$me(t.json),Dme(t.json),Ime(t.json),t.json.origins)for(const e in t.json.origins)$me(t.json.origins[e]),Dme(t.json.origins[e]),Ime(t.json.origins[e]);return!0}function Ime(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function $me(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Dme(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Lme(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=(t==null?void 0:t.ndimArray)??0;t&&(r===1||"type"in t&&SRe(t.type))?e.write.writer=get:r>1?e.write.writer=Aet(r):e.types?Array.isArray(e.types)?e.write.writer=met(e.types[0]):e.write.writer=fet(e.types):e.write.writer=DD}function fet(t){return(e,r,i,n)=>e?RRe(e,t,n)?DD(e,r,i,n):void 0:DD(e,r,i,n)}function RRe(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r!=null&&r.messages){const i=e.errorContext??"type",n=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new pe(`${i}:unsupported`,n,{definition:t,context:r})),we.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(n)}return!1}function met(t){return(e,r,i,n)=>!e||!Array.isArray(e)?DD(e,r,i,n):DD(e.filter(s=>RRe(s,t,n)),r,i,n)}function DD(t,e,r,i){wu(r,dB(t,i),e)}function dB(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?pB(t):t}function pB(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function get(t,e,r,i){let n;t===null?n=null:t&&typeof t.map=="function"?(n=t.map(s=>dB(s,i)),typeof n.toArray=="function"&&(n=n.toArray())):n=[dB(t,i)],wu(r,n,e)}function ORe(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>ORe(i,e,r-1)):dB(t,e)}function Aet(t){return(e,r,i,n)=>{let s;if(e===null)s=null;else{s=ORe(e,n,t);let o=t,a=s;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)s=[s]}wu(i,s,r)}}function aK(t,e){return ele(t,"read",e)}function PRe(t,e){return ele(t,"write",e)}function ele(t,e,r){let i=t&&t.json;if(t&&t.json&&t.json.origins&&r){const n=r.origin&&t.json.origins[r.origin];n&&(e==="any"||e in n)&&(i=n)}return i}function yet(t){const e=_et(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],n=i.types?vet(i):e;Ome(n,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),Lme(n,i)}Ome(e,t.json,!0),Lme(e,t.json)}function _et(t){return t.json.types?lK(t.json):t.type?IRe(t):lK(t)}function vet(t){return t.type?IRe(t):lK(t)}function IRe(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!wRe(r);)r=r[0],e++;return{type:r,ndimArray:e}}function lK(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function bet(t){pet(t)&&(oet(t),yet(t))}const rW=new Set,iW=new Set;function Q(t){return e=>{e.prototype.declaredClass=t,xet(e);const r=[],i=[];let n=e.prototype;for(;n;)n.hasOwnProperty("initialize")&&!rW.has(n.initialize)&&(rW.add(n.initialize),r.push(n.initialize)),n.hasOwnProperty("destroy")&&!iW.has(n.destroy)&&(iW.add(n.destroy),i.push(n.destroy)),n=Object.getPrototypeOf(n);rW.clear(),iW.clear();class s extends e{constructor(...a){if(super(...a),this.constructor===s&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[LMe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<i.length;u++)i[u].call(this)}}})}this.postscript(...a)}}}return s.__accessorMetadata__=yN(e.prototype),s.prototype.declaredClass=t,s}}function wet(t,e){return e.get==null?function(){const r=this.__accessor__.properties.get(t);if(r===void 0)return;Ai(r.observerObject);const i=this.__accessor__.store;return i.has(t)?i.get(t):r.metadata.value}:function(){const r=this.__accessor__.properties.get(t);if(r!==void 0)return r.getComputed()}}function xet(t){const e=t.prototype,r=yN(e),i={};for(const n of Object.getOwnPropertyNames(r)){const s=r[n];bet(s),i[n]={enumerable:!0,configurable:!0,get:wet(n,s),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&s.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(a.lifecycle===__.CONSTRUCTED&&s.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);a.set(n,o)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var $Re,DRe;function Tet(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const ux=Symbol("Accessor-Handles"),cK=Symbol("Accessor-Initialized");let rt=class LRe{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class o extends s{constructor(...l){super(...l),this.inherited=null,n&&n.apply(this,l)}}yN(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let d;this.inherited=function(...p){if(s.prototype[a])return s.prototype[a].apply(this,p)};try{d=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,d}:e[a]}for(const a in r){const l=Tet(r[a]);f(l)(o.prototype,a)}return Q(i)(o)}constructor(...e){if(this[$Re]=null,this[DRe]=!1,this.constructor===LRe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new gKe(this)}),e.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[cK]=!0}initialize(){}[LMe](){this[ux]=yt(this[ux])}destroy(){this.destroyed||(BKe(this),this.__accessor__.destroy())}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[cK]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return tB(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return nB(this,e,r),this}watch(e,r,i){return HKe(this,e,r,i)}own(e){this.addHandles(e)}addHandles(e,r){let i=this[ux];k(i)&&(i=this[ux]=new cn),i.add(e,r)}removeHandles(e){const r=this[ux];k(r)||r.remove(e)}hasHandles(e){const r=this[ux];return!!M(r)&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};$Re=ux,DRe=cK;let L7=class NRe{constructor(){this._emitter=new NRe.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(n=null){this._target=n,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(n,s){const o=this._listenersMap&&this._listenersMap.get(n);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,s)}),o.length>0}on(n,s){if(Array.isArray(n)){const a=n.map(l=>this.on(l,s));return DR(a)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(n)||[];return o.push(s),this._listenersMap.set(n,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(n)||[],l=a.indexOf(s);l>=0&&a.splice(l,1)}}}once(n,s){const o=this.on(n,a=>{o.remove(),s.call(null,a)});return o}hasEventListener(n){const s=this._listenersMap&&this._listenersMap.get(n);return s!=null&&s.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let n=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(s,o){return this._emitter.emit(s,o)}on(s,o){return this._emitter.on(s,o)}once(s,o){return this._emitter.once(s,o)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=h([Q("esri.core.Evented")],n),n};let r=class extends rt{constructor(){super(...arguments),this._emitter=new L7.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,n){return this._emitter.emit(i,n)}on(i,n){return this._emitter.on(i,n)}once(i,n){return this._emitter.once(i,n)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=h([Q("esri.core.Evented")],r),t.EventedAccessor=r})(L7||(L7={}));const Ws=L7;var Pn;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Pn||(Pn={}));function tle(t){return(e,r)=>{e[r]=t}}let rle=class extends ZMe{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var m_;let Eet=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const $p=new Sl(Eet,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),Cet=()=>{};function nW(t){return t?t instanceof dT?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function sW(t){if(t&&t.length)return t[0]}function Met(t,e,r,i){const n=Math.min(t.length-r,e.length-i);let s=0;for(;s<n&&t[r+s]===e[i+s];)s++;return s}function FRe(t,e,r,i){e&&e.forEach((n,s,o)=>{t.push(n),FRe(t,r.call(i,n,s,o),r,i)})}const j1=new Set,H1=new Set,q1=new Set,oW=new Map;let Ret=0,dT=m_=class extends Ws.EventedAccessor{static isCollection(t){return t!=null&&t instanceof m_}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new rle,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:Ret++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof m_?{items:t}:t:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return Ai(this._observable),this._items}set items(t){this._emitBeforeChanges(Pn.ADD)||(this._splice(0,this.length,nW(t)),this._emitAfterChanges(Pn.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=Cet,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const r=this.on(t,e);return{remove(){r.remove()}}}add(t,e){if(Ai(this._observable),this._emitBeforeChanges(Pn.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(Pn.ADD),this}addMany(t,e=this._items.length){if(Ai(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(Pn.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,nW(t)),this._emitAfterChanges(Pn.ADD),this}at(t){if(Ai(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Ai(this._observable),!this.length||this._emitBeforeChanges(Pn.REMOVE))return[];const t=this._splice(0,this.length)||[];return this._emitAfterChanges(Pn.REMOVE),t}clone(){return Ai(this._observable),this._createNewInstance({items:this._items.map(Te)})}concat(...t){Ai(this._observable);const e=t.map(nW);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Ai(this._observable),!this.length||this._emitBeforeChanges(Pn.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let n=0;n<i;n++)t.call(e,r[n],n,r);this._emitAfterChanges(Pn.REMOVE)}every(t,e){return Ai(this._observable),this._items.every(t,e)}filter(t,e){let r;return Ai(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return Ai(this._observable),this._items.find(t,e)}findIndex(t,e){return Ai(this._observable),this._items.findIndex(t,e)}flatten(t,e){Ai(this._observable);const r=[];return FRe(r,this,t,e),new m_(r)}forEach(t,e){return Ai(this._observable),this._items.forEach(t,e)}getItemAt(t){return Ai(this._observable),this._items[t]}getNextIndex(t){Ai(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Ai(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Ai(this._observable),this._items.indexOf(t,e)}join(t=","){return Ai(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Ai(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Ai(this._observable);const r=this._items.map(t,e);return new m_({items:r})}reorder(t,e=this.length-1){Ai(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(Pn.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(Pn.MOVE)}return t}}pop(){if(Ai(this._observable),!this.length||this._emitBeforeChanges(Pn.REMOVE))return;const t=sW(this._splice(this.length-1,1));return this._emitAfterChanges(Pn.REMOVE),t}push(...t){return Ai(this._observable),this._emitBeforeChanges(Pn.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Pn.ADD)),this.length}reduce(t,e){Ai(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){Ai(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return Ai(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Ai(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Pn.REMOVE))return;const e=sW(this._splice(t,1));return this._emitAfterChanges(Pn.REMOVE),e}removeMany(t){if(Ai(this._observable),!t||!t.length||this._emitBeforeChanges(Pn.REMOVE))return[];const e=t instanceof m_?t.toArray():t,r=this._items,i=[],n=e.length;for(let s=0;s<n;s++){const o=e[s],a=r.indexOf(o);if(a>-1){const l=1+Met(e,r,s+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),s+=l-1}}return this._emitAfterChanges(Pn.REMOVE),i}reverse(){if(Ai(this._observable),this._emitBeforeChanges(Pn.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Pn.MOVE),this}shift(){if(Ai(this._observable),!this.length||this._emitBeforeChanges(Pn.REMOVE))return;const t=sW(this._splice(0,1));return this._emitAfterChanges(Pn.REMOVE),t}slice(t=0,e=this.length){return Ai(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Ai(this._observable),this._items.some(t,e)}sort(t){if(Ai(this._observable),!this.length||this._emitBeforeChanges(Pn.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Pn.MOVE),this}splice(t,e,...r){Ai(this._observable);const i=(e?Pn.REMOVE:0)|(r.length?Pn.ADD:0);if(this._emitBeforeChanges(i))return[];const n=this._splice(t,e,r)||[];return this._emitAfterChanges(i),n}toArray(){return Ai(this._observable),this._items.slice()}toJSON(){return Ai(this._observable),this.toArray()}toLocaleString(){return Ai(this._observable),this._items.toLocaleString()}toString(){return Ai(this._observable),this._items.toString()}unshift(...t){return Ai(this._observable),!t.length||this._emitBeforeChanges(Pn.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Pn.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=WO(()=>this._dispatchChange())),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=$p.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)s=o[l],a.reset(s),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,s),t+=1,l-=1,c-=1);$p.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=$p.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);$p.release(a)}}if(r&&r.length){if(n){const u=[];for(const d of r){const p=n.ensureType(d);p==null&&d!=null||u.push(p)}r=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=$p.acquire();u.target=this,u.cancellable=!0;const d=$p.acquire();d.target=this,d.cancellable=!1;for(const p of r)a?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),l&&(d.reset(p),this.emit("after-add",d)))):(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),d.reset(p),this.emit("after-add",d));$p.release(d),$p.release(u)}else{if(c)for(const u of r)i.push(u);else i.splice(t,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=$p.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,$p.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=$p.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),$p.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;j1.clear(),H1.clear(),q1.clear();for(const{added:l,removed:c}of r){if(l)if(q1.size===0&&H1.size===0)for(const u of l)j1.add(u);else for(const u of l)H1.has(u)?(q1.add(u),H1.delete(u)):q1.has(u)||j1.add(u);if(c)if(q1.size===0&&j1.size===0)for(const u of c)H1.add(u);else for(const u of c)j1.has(u)?j1.delete(u):(q1.delete(u),H1.add(u))}const i=Zh.acquire();j1.forEach(l=>{i.push(l)});const n=Zh.acquire();H1.forEach(l=>{n.push(l)});const s=this._items,o=e.items,a=Zh.acquire();if(q1.forEach(l=>{o.indexOf(l)!==s.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||n.length||a.length)){const l={target:this,added:i,removed:n,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const d=e.listeners[u];d.removed||d.callback.call(this,l)}}Zh.release(i),Zh.release(n),Zh.release(a)}j1.clear(),H1.clear(),q1.clear()}};dT.ofType=t=>{if(!t)return m_;if(oW.has(t))return oW.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const n=t.typeMap[i].prototype.declaredClass;e?e+=` | ${n}`:e=n}let r=class extends m_{};return h([tle({Type:t,ensureType:typeof t=="function"?Go(t):Om(t)})],r.prototype,"itemType",void 0),r=h([Q(`esri.core.Collection<${e}>`)],r),oW.set(t,r),r},h([f()],dT.prototype,"length",void 0),h([f()],dT.prototype,"items",null),dT=m_=h([Q("esri.core.Collection")],dT);const ur=dT;function vS(t,e,r=ur){return e||(e=new r),e===t||(e.removeAll(),Oet(t)?e.addMany(t):t&&e.add(t)),e}function kRe(t){return t}function Oet(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}let Pet=class URe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new URe;return this._values.forEach((i,n)=>{e&&e.has(n)||r.set(n,Te(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(e){var r;return((r=this._values.get(e))==null?void 0:r.origin)??Zi.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>{var n;return((n=this._values.get(i))==null?void 0:n.origin)===e})}set(e,r,i){if((i=this._normalizeOrigin(i))===Zi.DEFAULTS){const n=this._values.get(e);if(n&&n.origin!=null&&n.origin>i)return}this._values.set(e,new Iet(r,i))}delete(e,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(e))==null?void 0:i.origin)!==r||this._values.delete(e)}has(e,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(e))==null?void 0:i.origin)===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===Zi.DEFAULTS?e:Zi.USER}},Iet=class{constructor(e,r){this.value=e,this.origin=r}};function BRe(t,e,r){e.keys().forEach(n=>{r.set(n,e.get(n),Zi.DEFAULTS)});const i=t.metadatas;Object.keys(i).forEach(n=>{t.internalGet(n)&&r.set(n,t.internalGet(n),Zi.DEFAULTS)})}function $et(t,e,r){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&gme(i,r))return!0}else for(const n of i)if(n===e||n.includes(".")&&n.indexOf(e)===0&&gme(n,r))return!0;return!1}function Det(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function Let(t,e,r,i,n){let s=aK(e[r],n);Det(s)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))s=aK(e[o],n),$et(s,r,i)&&(t[o]=!0)}function Net(t,e,r,i){const n=r.metadatas,s=ele(n[e],"any",i),o=s&&s.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const zRe={origin:"service"};function VRe(t,e,r=zRe){if(!e||typeof e!="object")return;const i=bu(t),n=i.metadatas,s={};for(const o of Object.getOwnPropertyNames(e))Let(s,n,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(s)){const a=aK(n[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?AN(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(n))s[o]||Net(t,o,i,r)}i.setDefaultOrigin("user")}function Fet(t,e,r,i=zRe){var s;const n={...i,messages:[]};r(n),(s=n.messages)==null||s.forEach(o=>{o.type!=="warning"||t.loaded?i&&i.messages&&i.messages.push(o):t.loadWarnings.push(o)})}function ket(t,e,r,i,n){var o,a;const s={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,i,s,r,n),s}function GRe(t,e,r,i,n,s){if(!i||!i.write)return!1;const o=t.get(r);if(!n&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,s);a!==void 0&&(n=a)}if(n||(n=i.write),!n||n.enabled===!1)return!1;if((o===null&&!n.allowNull&&!n.writerEnsuresNonNull||o===void 0)&&n.isRequired){const a=new pe("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&s&&s.messages?s.messages.push(a):a&&!s&&we.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!n.allowNull&&!n.writerEnsuresNonNull||(!e.store.multipleOriginsSupported||e.store.originOf(r)===Zi.DEFAULTS)&&Uet(t,r,s,i,o)||!n.ignoreOrigin&&s&&s.origin&&e.store.multipleOriginsSupported&&e.store.originOf(r)<kb(s.origin))}function Uet(t,e,r,i,n){const s=i.default;if(s===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const o=s.call(t,e,r);return J_(o,n)}return!1}return s===n}function Bet(t,e,r,i){const n=bu(t),s=n.metadatas,o=PRe(s[e],i);return!!o&&GRe(t,n,e,o,r,i)}function jRe(t,e,r){var s,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return R7(e,t.toJSON(r));const i=bu(t),n=i.metadatas;for(const a in n){const l=PRe(n[a],r);if(!GRe(t,i,a,l,void 0,r))continue;const c=t.get(a),u=ket(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(u).length>0&&(e=R7(e,u),(o=(s=r==null?void 0:r.resources)==null?void 0:s.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>R7(e,u,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:a,oldOrigin:uKe(i.store.originOf(a)),newOrigin:r.origin}))}return e}const wN=t=>{let e=class extends t{constructor(...r){super(...r);const i=bu(this),n=i.store,s=new Pet;i.store=s,BRe(i,n,s)}read(r,i){VRe(this,r,i)}write(r={},i){return jRe(this,r,i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return zet.call(this,r,i)}};return e=h([Q("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function zet(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}let Je=class extends wN(rt){};Je=h([Q("esri.core.JSONSupport")],Je);var hb;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(hb||(hb={}));let Vet=class{constructor(e){this.instance=e,this._resolver=x2(),this._status=hb.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=hb.RESOLVED,this._cleanUp()},()=>{this._status=hb.REJECTED,this._cleanUp()})}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===hb.RESOLVED}isRejected(){return this._status===hb.REJECTED}isFulfilled(){return this._status!==hb.PENDING}abort(){this._resolver.reject(en())}when(e,r){return this._resolver.promise.then(e,r)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const e=x2(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve(this.instance)},n=>{this.isFulfilled()||this._allPromise!==i||$o(n)||this._resolver.reject(n)}),e.resolve()}};const bG=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new Vet(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return new Promise((n,s)=>{this._promiseProps.when(n,s)}).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=h([Q("esri.core.Promise")],e),e};let fB=class extends bG(rt){};fB=h([Q("esri.core.Promise")],fB);const Get="not-loaded",jet="loading",Het="failed",Nme="loaded",HRe=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const n=this.load.bind(this);this.load=s=>{const o=new Promise((a,l)=>{const c=Wae(s,l);this.destroyed&&l(new pe("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===Get){this._set("loadStatus",jet);const a=this._loadController=new AbortController;n({signal:a.signal}),Sc(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",Nme),this._loadController=null},i=>{this._set("loadStatus",Het),this._set("loadError",i),this._loadController=null})}get loaded(){return this.loadStatus===Nme}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new pe("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort()),this}};return h([f({readOnly:!0})],e.prototype,"loaded",null),h([f({readOnly:!0})],e.prototype,"loadError",void 0),h([f({clonable:!1})],e.prototype,"loadStatus",void 0),h([f({type:[IA],readOnly:!0})],e.prototype,"loadWarnings",null),e=h([Q("esri.core.Loadable")],e),e};let T$=class extends HRe(fB){};T$=h([Q("esri.core.Loadable")],T$),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=HRe,t.isLoadable=e}(T$||(T$={}));const e1=T$;function wG(t,e,r){return fh(t.map((i,n)=>e.apply(r,[i,n])))}async function qet(t,e,r){return(await fh(t.map((i,n)=>e.apply(r,[i,n])))).map(i=>i.value)}function ile(t){return{ok:!0,value:t}}function nle(t){return{ok:!1,error:t}}function Wet(t){return M(t)&&t.ok===!0?t.value:null}function Qet(t){return M(t)&&t.ok===!1?t.error:null}async function Pm(t){if(k(t))return{ok:!1,error:new Error("no promise provided")};try{return ile(await t)}catch(e){return nle(e)}}async function Anr(t){try{return ile(await t)}catch(e){return Jh(e),nle(e)}}function ynr(t){if(t.ok===!0)return t.value;throw t.error}function xN(t,e){return new Pv(t,e)}let Pv=class extends rt{get value(){return Wet(this._result)}get error(){return Qet(this._result)}get finished(){return M(this._result)}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Gf(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(n=>{this._result=ile(n),this._cleanup()},n=>{this._result=nle(n),this._cleanup()}),this._abortHandle=Sc(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=ps(this._abortHandle),this._abortController=null}};h([f()],Pv.prototype,"value",null),h([f()],Pv.prototype,"error",null),h([f()],Pv.prototype,"finished",null),h([f()],Pv.prototype,"promise",void 0),h([f()],Pv.prototype,"_result",void 0),Pv=h([Q("esri.core.asyncUtils.ReactiveTask")],Pv);async function qRe(t,e){return await t.load(),Yet(t,e)}async function Yet(t,e){const r=[],i=(...s)=>{for(const o of s)k(o)||(Array.isArray(o)?i(...o):ur.isCollection(o)?o.forEach(a=>i(a)):e1.isLoadable(o)&&r.push(o))};e(i);let n=null;if(await qet(r,async s=>{const o=await Pm(Xet(s)?s.loadAll():s.load());o.ok!==!1||n||(n=o)}),n)throw n.error;return t}function Xet(t){return"loadAll"in t&&typeof t.loadAll=="function"}const Zet=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,Jet={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function Fme(t){const e=t==null?void 0:t.match(Zet);if(!e)return null;const[,r,i,n]=e;if(!r)return null;let s=null,o=null,a=null;const{devext:l,qaext:c,www:u}=Jet;if(i)if(s=r,n)switch(n.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:s}}function Ket(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}const ett=we.getLogger("esri.core.urlUtils"),QO=gn.request,kme="esri/config: esriConfig.request.proxyUrl is not set.",WRe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,QRe=/^\s*http:/i,ttt=/^\s*https:/i,rtt=/^\s*file:/i,itt=/:\d+$/,ntt=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,stt=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),ott=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let WM=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(stt);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(ott),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const l6={},att=new WM(gn.applicationUrl);let hu=att;const ltt=ctt();let sle=ltt;const ole=()=>hu,bnr=()=>sle;function ctt(){const t=hu.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${hu.scheme}://${hu.host}${hu.port!=null?`:${hu.port}`:""}`}${e}`}function Su(t){if(!t)return null;const e={path:null,query:null},r=new WM(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=YRe(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function YRe(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const n=i.indexOf("=");let s,o;n<0?(s=decodeURIComponent(i),o=""):(s=decodeURIComponent(i.slice(0,n)),o=decodeURIComponent(i.slice(n+1)));let a=r[s];typeof a=="string"&&(a=r[s]=[a]),Array.isArray(a)?a.push(o):r[s]=o}return r}function Ume(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function LD(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const n=encodeURIComponent(r)+"=",s=e&&e[r];return s?n+encodeURIComponent(s(i)):Array.isArray(i)?i.map(o=>Ume(o)?n+encodeURIComponent(JSON.stringify(o)):n+encodeURIComponent(o)).join("&"):Ume(i)?n+encodeURIComponent(JSON.stringify(i)):n+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function utt(t=!1){let e,r=QO.proxyUrl;if(typeof t=="string"){e=Att(t);const i=xG(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw ett.warn(kme),new pe("urlutils:proxy-not-set",kme);return e&&uK()&&(r=dle(r)),Su(r)}function wnr(t){const e=xG(t);let r,i;if(e){const n=ale(e.proxyUrl);r=n.path,i=n.query?YRe(n.query):null}if(r){const n=Su(t);t=r+"?"+n.path;const s=LD({...i,...n.query});s&&(t=`${t}?${s}`)}return t}const tI={path:"",query:""};function ale(t){const e=t.indexOf("?");return e!==-1?(tI.path=t.slice(0,e),tI.query=t.slice(e+1)):(tI.path=t,tI.query=null),tI}function XRe(t){return t=(t=gB(t=xtt(t=ale(t).path),!0)).toLowerCase()}function htt(t){const e={proxyUrl:t.proxyUrl,urlPrefix:XRe(t.urlPrefix)},r=QO.proxyRules,i=e.urlPrefix;let n=r.length;for(let s=0;s<r.length;s++){const o=r[s].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;n=s;break}o.indexOf(i)===0&&(n=s+1)}return r.splice(n,0,e),n}function xG(t){const e=QO.proxyRules,r=XRe(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function dtt(t,e){if(!t||!e)return!1;t=mB(t),e=mB(e);const r=Fme(t),i=Fme(e);return M(r)&&M(i)?r.portalHostname===i.portalHostname:!M(r)&&!M(i)&&kR(t,e,!0)}function ZRe(t,e){return t=mB(t),e=mB(e),gB(t)===gB(e)}function mB(t){const e=(t=wm(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function JRe(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=QO.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function kR(t,e,r=!1){if(!t||!e)return!1;const i=dK(t),n=dK(e);return!(!r&&i.scheme!==n.scheme)&&i.host!=null&&n.host!=null&&i.host.toLowerCase()===n.host.toLowerCase()&&i.port===n.port}function lle(t){if(typeof t=="string"){if(!fp(t))return!0;t=dK(t)}if(kR(t,hu))return!0;const e=QO.trustedServers||[];for(let r=0;r<e.length;r++){const i=ptt(e[r]);for(let n=0;n<i.length;n++)if(kR(t,i[n]))return!0}return!1}function ptt(t){return l6[t]||(hle(t)||$A(t)?l6[t]=[new WM(np(t))]:l6[t]=[new WM(`http://${t}`),new WM(`https://${t}`)]),l6[t]}function np(t,e=sle,r){return $A(t)?r&&r.preserveProtocolRelative?t:hu.scheme==="http"&&hu.authority===xm(t).slice(2)?`http:${t}`:`https:${t}`:hle(t)?t:bS(t[0]==="/"?btt(e):e,t)}function cle(t,e=sle,r){if(t==null||!fp(t))return t;const i=wm(t),n=i.toLowerCase(),s=wm(e).toLowerCase().replace(/\/+$/,""),o=r?wm(r).toLowerCase().replace(/\/+$/,""):null;if(o&&s.indexOf(o)!==0)return t;const a=(d,p,A)=>(A=d.indexOf(p,A))===-1?d.length:A;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const u=s.slice(c-1).replace(/[^/]+/g,"").length;if(u>0)for(let d=0;d<u;d++)t=`../${t}`;else t=`./${t}`;return t}function wm(t){return t=Ett(t=Stt(t=Ttt(t=np(t=t.trim()))))}function bS(...t){const e=t.filter(M);if(!e||!e.length)return;const r=[];if(fp(e[0])){const n=e[0],s=n.indexOf("//");s!==-1&&(r.push(n.slice(0,s+1)),_tt(e[0])&&(r[0]+="/"),e[0]=n.slice(s+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<i.length;n++){const s=i[n];s===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!s&&n===i.length-1||s&&(s!=="."||r.length===0))&&r.push(s)}return r.join("/")}function xm(t,e=!1){if(t==null||UR(t)||YA(t))return null;let r=t.indexOf("://");if(r===-1&&$A(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=gB(t,!0)),t}function fp(t){return $A(t)||hle(t)}function UR(t){return t!=null&&t.slice(0,5)==="blob:"}function YA(t){return t!=null&&t.slice(0,5)==="data:"}function ule(t){const e=TN(t);if(!e||!e.isBase64)return null;const r=atob(e.data),i=new Uint8Array(r.length);for(let n=0;n<r.length;n++)i[n]=r.charCodeAt(n);return i.buffer}function xnr(t){return btoa(String.fromCharCode.apply(null,t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const ftt=/^data:(.*?)(;base64)?,(.*)$/;function TN(t){const e=t.match(ftt);if(!e)return null;const[,r,i,n]=e;return{mediaType:r,isBase64:!!i,data:n}}function KRe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function Tnr(t){const e=ule(t);if(!e)return null;const r=TN(t);return new Blob([e],{type:r.mediaType})}function Snr(t,e){mtt(t,e)||gtt(t,e)}function mtt(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function gtt(t,e){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(t,e)}function $A(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function hle(t){return t!=null&&WRe.test(t)}function Att(t){return t!=null&&ttt.test(t)||hu.scheme==="https"&&$A(t)}function ytt(t){return t!=null&&QRe.test(t)||hu.scheme==="http"&&$A(t)}function _tt(t){return t!=null&&rtt.test(t)}function dle(t){return $A(t)?`https:${t}`:t.replace(QRe,"https:")}function vtt(){return hu.scheme==="http"}function uK(){return hu.scheme==="https"}function gB(t,e=!1){return $A(t)?t.slice(2):(t=t.replace(WRe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function btt(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function wtt(t){let e=0;if(fp(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function Enr(t,e){if(!t)return"";const r=Su(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(e!=null&&e.length))return i;const n=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(n,"")}function xtt(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function eOe(t){return t.replace(/\/+$/,"")}function Ttt(t){if(/^https?:\/\//i.test(t)){const e=ale(t);t=(t=e.path.replace(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function Stt(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function Ett(t){const e=QO.httpsDomains;if(!ytt(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),itt.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return vtt()&&i===hu.authority&&!ntt.test(t)||(uK()&&i===hu.authority||e&&e.some(n=>i===n||i.endsWith(`.${n}`))||uK()&&!xG(t))&&(t=dle(t)),t}function hK(t,e,r){if(!(e&&r&&t&&fp(t)))return t;const i=t.indexOf("//"),n=t.indexOf("/",i+2),s=t.indexOf(":",i+2),o=Math.min(n<0?t.length:n,s<0?t.length:s);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function dK(t){return typeof t=="string"?new WM(np(t)):(t.scheme||(t.scheme=hu.scheme),t)}function tOe(t){return Ctt.test(t)}function rOe(t,e){const r=Su(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function iOe(t,e,r){const i=Su(t),n=i.query||{};return n[e]=String(r),`${i.path}?${LD(n)}`}function aW(t,e){const r=Su(t),i=r.query||{};for(const s in e)i[s]=e[s];const n=LD(i);return n?`${r.path}?${n}`:r.path}function Cnr(t){if(k(t))return null;const e=t.match(nOe);return e?e[2]:null}function Bme(t){if(k(t))return null;const e=t.match(nOe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}const nOe=/([^.]*)\.([^\/]*)$/,Ctt=/(^data:image\/svg|\.svg$)/i;function Ct(t,e,r){let i,n;return e===void 0?(n=t,i=[void 0]):typeof e!="string"?(n=t,i=[void 0],r=e):(n=e,i=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;for(const l of i){const c=TRe(s,l,n);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let Hi=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,n,s)=>{const o=this.toJSON(i);o!==void 0&&wu(s,o,n)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function $c(){return function(t,e){return new Hi(t,{ignoreUnknown:!0,...e})}}let ple=class{constructor(e,r,i,n){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=n||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const yi=new ple(6378137,1/298.257223563,3e5,.006694379990137799),yA=new ple(3396190,1/169.8944472236118,23e4),t1=new ple(1737400,0,0);var Sf;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(Sf||(Sf={}));let x;const K={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(x=2e3;x<=2045;x++)K[x]=0;for(x=2056;x<=2065;x++)K[x]=0;for(x=2067;x<=2135;x++)K[x]=0;for(x=2137;x<=2154;x++)K[x]=0;for(x=2161;x<=2170;x++)K[x]=0;for(x=2172;x<=2193;x++)K[x]=0;for(x=2195;x<=2198;x++)K[x]=0;for(x=2200;x<=2203;x++)K[x]=0;for(x=2205;x<=2217;x++)K[x]=0;for(x=2222;x<=2224;x++)K[x]=1;for(x=2225;x<=2250;x++)K[x]=2;for(x=2251;x<=2253;x++)K[x]=1;for(x=2257;x<=2264;x++)K[x]=2;for(x=2274;x<=2279;x++)K[x]=2;for(x=2280;x<=2282;x++)K[x]=1;for(x=2283;x<=2289;x++)K[x]=2;for(x=2290;x<=2292;x++)K[x]=0;for(x=2308;x<=2313;x++)K[x]=0;for(x=2315;x<=2491;x++)K[x]=0;for(x=2494;x<=2866;x++)K[x]=0;for(x=2867;x<=2869;x++)K[x]=1;for(x=2870;x<=2888;x++)K[x]=2;for(x=2891;x<=2895;x++)K[x]=2;for(x=2896;x<=2898;x++)K[x]=1;for(x=2902;x<=2908;x++)K[x]=2;for(x=2915;x<=2920;x++)K[x]=2;for(x=2921;x<=2923;x++)K[x]=1;for(x=2924;x<=2930;x++)K[x]=2;for(x=2931;x<=2962;x++)K[x]=0;for(x=2964;x<=2968;x++)K[x]=2;for(x=2969;x<=2973;x++)K[x]=0;for(x=2975;x<=2991;x++)K[x]=0;for(x=2995;x<=3051;x++)K[x]=0;for(x=3054;x<=3079;x++)K[x]=0;for(x=3081;x<=3088;x++)K[x]=0;for(x=3092;x<=3101;x++)K[x]=0;for(x=3106;x<=3138;x++)K[x]=0;for(x=3146;x<=3151;x++)K[x]=0;for(x=3153;x<=3166;x++)K[x]=0;for(x=3168;x<=3172;x++)K[x]=0;for(x=3174;x<=3203;x++)K[x]=0;for(x=3294;x<=3358;x++)K[x]=0;for(x=3367;x<=3403;x++)K[x]=0;for(x=3408;x<=3416;x++)K[x]=0;for(x=3417;x<=3438;x++)K[x]=2;for(x=3441;x<=3446;x++)K[x]=2;for(x=3447;x<=3450;x++)K[x]=0;for(x=3451;x<=3459;x++)K[x]=2;for(x=3460;x<=3478;x++)K[x]=0;for(x=3554;x<=3559;x++)K[x]=0;for(x=3560;x<=3570;x++)K[x]=2;for(x=3571;x<=3581;x++)K[x]=0;for(x=3594;x<=3597;x++)K[x]=0;for(x=3601;x<=3604;x++)K[x]=0;for(x=3637;x<=3639;x++)K[x]=0;for(x=3665;x<=3667;x++)K[x]=0;for(x=3693;x<=3695;x++)K[x]=0;for(x=3701;x<=3727;x++)K[x]=0;for(x=3728;x<=3739;x++)K[x]=2;for(x=3740;x<=3751;x++)K[x]=0;for(x=3753;x<=3760;x++)K[x]=2;for(x=3761;x<=3773;x++)K[x]=0;for(x=3775;x<=3777;x++)K[x]=0;for(x=3779;x<=3781;x++)K[x]=0;for(x=3783;x<=3785;x++)K[x]=0;for(x=3788;x<=3791;x++)K[x]=0;for(x=3797;x<=3802;x++)K[x]=0;for(x=3814;x<=3816;x++)K[x]=0;for(x=3825;x<=3829;x++)K[x]=0;for(x=3832;x<=3841;x++)K[x]=0;for(x=3844;x<=3852;x++)K[x]=0;for(x=3873;x<=3885;x++)K[x]=0;for(x=3890;x<=3893;x++)K[x]=0;for(x=3907;x<=3912;x++)K[x]=0;for(x=3942;x<=3950;x++)K[x]=0;for(x=3968;x<=3970;x++)K[x]=0;for(x=3973;x<=3976;x++)K[x]=0;for(x=3986;x<=3989;x++)K[x]=0;for(x=3994;x<=3997;x++)K[x]=0;for(x=4048;x<=4051;x++)K[x]=0;for(x=4056;x<=4063;x++)K[x]=0;for(x=4093;x<=4096;x++)K[x]=0;for(x=4390;x<=4398;x++)K[x]=0;for(x=4399;x<=4413;x++)K[x]=2;for(x=4418;x<=4433;x++)K[x]=2;for(x=4455;x<=4457;x++)K[x]=2;for(x=4484;x<=4489;x++)K[x]=0;for(x=4491;x<=4554;x++)K[x]=0;for(x=4568;x<=4589;x++)K[x]=0;for(x=4652;x<=4656;x++)K[x]=0;for(x=4766;x<=4800;x++)K[x]=0;for(x=5014;x<=5016;x++)K[x]=0;for(x=5069;x<=5072;x++)K[x]=0;for(x=5105;x<=5130;x++)K[x]=0;for(x=5173;x<=5188;x++)K[x]=0;for(x=5253;x<=5259;x++)K[x]=0;for(x=5269;x<=5275;x++)K[x]=0;for(x=5292;x<=5311;x++)K[x]=0;for(x=5329;x<=5331;x++)K[x]=0;for(x=5343;x<=5349;x++)K[x]=0;for(x=5355;x<=5357;x++)K[x]=0;for(x=5387;x<=5389;x++)K[x]=0;for(x=5459;x<=5463;x++)K[x]=0;for(x=5479;x<=5482;x++)K[x]=0;for(x=5518;x<=5520;x++)K[x]=0;for(x=5530;x<=5539;x++)K[x]=0;for(x=5550;x<=5552;x++)K[x]=0;for(x=5562;x<=5583;x++)K[x]=0;for(x=5623;x<=5625;x++)K[x]=2;for(x=5631;x<=5639;x++)K[x]=0;for(x=5649;x<=5653;x++)K[x]=0;for(x=5663;x<=5680;x++)K[x]=0;for(x=5682;x<=5685;x++)K[x]=0;for(x=5875;x<=5877;x++)K[x]=0;for(x=5896;x<=5899;x++)K[x]=0;for(x=5921;x<=5940;x++)K[x]=0;for(x=6050;x<=6125;x++)K[x]=0;for(x=6244;x<=6275;x++)K[x]=0;for(x=6328;x<=6348;x++)K[x]=0;for(x=6350;x<=6356;x++)K[x]=0;for(x=6366;x<=6372;x++)K[x]=0;for(x=6381;x<=6387;x++)K[x]=0;for(x=6393;x<=6404;x++)K[x]=0;for(x=6480;x<=6483;x++)K[x]=0;for(x=6511;x<=6514;x++)K[x]=0;for(x=6579;x<=6581;x++)K[x]=0;for(x=6619;x<=6624;x++)K[x]=0;for(x=6625;x<=6627;x++)K[x]=2;for(x=6628;x<=6632;x++)K[x]=0;for(x=6634;x<=6637;x++)K[x]=0;for(x=6669;x<=6692;x++)K[x]=0;for(x=6707;x<=6709;x++)K[x]=0;for(x=6720;x<=6723;x++)K[x]=0;for(x=6732;x<=6738;x++)K[x]=0;for(x=6931;x<=6933;x++)K[x]=0;for(x=6956;x<=6959;x++)K[x]=0;for(x=7005;x<=7007;x++)K[x]=0;for(x=7057;x<=7070;x++)K[x]=2;for(x=7074;x<=7082;x++)K[x]=0;for(x=7109;x<=7118;x++)K[x]=0;for(x=7119;x<=7127;x++)K[x]=1;for(x=7374;x<=7376;x++)K[x]=0;for(x=7528;x<=7586;x++)K[x]=0;for(x=7587;x<=7645;x++)K[x]=2;for(x=7692;x<=7696;x++)K[x]=0;for(x=7755;x<=7787;x++)K[x]=0;for(x=7791;x<=7795;x++)K[x]=0;for(x=7799;x<=7801;x++)K[x]=0;for(x=7803;x<=7805;x++)K[x]=0;for(x=7825;x<=7831;x++)K[x]=0;for(x=7845;x<=7859;x++)K[x]=0;for(x=8013;x<=8032;x++)K[x]=0;for(x=8065;x<=8068;x++)K[x]=1;for(x=8518;x<=8529;x++)K[x]=2;for(x=8533;x<=8536;x++)K[x]=2;for(x=8538;x<=8540;x++)K[x]=2;for(x=8677;x<=8679;x++)K[x]=0;for(x=8836;x<=8840;x++)K[x]=0;for(x=8857;x<=8859;x++)K[x]=0;for(x=8908;x<=8910;x++)K[x]=0;for(x=9154;x<=9159;x++)K[x]=0;for(x=9205;x<=9218;x++)K[x]=0;for(x=9271;x<=9273;x++)K[x]=0;for(x=9295;x<=9297;x++)K[x]=0;for(x=9356;x<=9360;x++)K[x]=0;for(x=9404;x<=9407;x++)K[x]=0;for(x=9476;x<=9482;x++)K[x]=0;for(x=9487;x<=9494;x++)K[x]=0;for(x=9697;x<=9699;x++)K[x]=0;for(x=9821;x<=9865;x++)K[x]=0;for(x=20002;x<=20032;x++)K[x]=0;for(x=20047;x<=20049;x++)K[x]=0;for(x=20062;x<=20092;x++)K[x]=0;for(x=20135;x<=20138;x++)K[x]=0;for(x=20248;x<=20258;x++)K[x]=0;for(x=20348;x<=20358;x++)K[x]=0;for(x=20436;x<=20440;x++)K[x]=0;for(x=20822;x<=20824;x++)K[x]=0;for(x=20904;x<=20932;x++)K[x]=0;for(x=20934;x<=20936;x++)K[x]=0;for(x=21004;x<=21032;x++)K[x]=0;for(x=21035;x<=21037;x++)K[x]=0;for(x=21095;x<=21097;x++)K[x]=0;for(x=21148;x<=21150;x++)K[x]=0;for(x=21207;x<=21264;x++)K[x]=0;for(x=21307;x<=21364;x++)K[x]=0;for(x=21413;x<=21423;x++)K[x]=0;for(x=21453;x<=21463;x++)K[x]=0;for(x=21473;x<=21483;x++)K[x]=0;for(x=21780;x<=21782;x++)K[x]=0;for(x=21891;x<=21894;x++)K[x]=0;for(x=21896;x<=21899;x++)K[x]=0;for(x=22171;x<=22177;x++)K[x]=0;for(x=22181;x<=22187;x++)K[x]=0;for(x=22191;x<=22197;x++)K[x]=0;for(x=22207;x<=22222;x++)K[x]=0;for(x=22234;x<=22236;x++)K[x]=0;for(x=22243;x<=22250;x++)K[x]=0;for(x=22262;x<=22265;x++)K[x]=0;for(x=22307;x<=22322;x++)K[x]=0;for(x=22348;x<=22357;x++)K[x]=0;for(x=22407;x<=22422;x++)K[x]=0;for(x=22462;x<=22465;x++)K[x]=0;for(x=22521;x<=22525;x++)K[x]=0;for(x=22607;x<=22622;x++)K[x]=0;for(x=22641;x<=22646;x++)K[x]=0;for(x=22648;x<=22657;x++)K[x]=0;for(x=22707;x<=22722;x++)K[x]=0;for(x=22762;x<=22765;x++)K[x]=0;for(x=22991;x<=22994;x++)K[x]=0;for(x=23028;x<=23038;x++)K[x]=0;for(x=23830;x<=23853;x++)K[x]=0;for(x=23866;x<=23872;x++)K[x]=0;for(x=23877;x<=23884;x++)K[x]=0;for(x=23886;x<=23894;x++)K[x]=0;for(x=23946;x<=23948;x++)K[x]=0;for(x=24311;x<=24313;x++)K[x]=0;for(x=24342;x<=24347;x++)K[x]=0;for(x=24370;x<=24374;x++)K[x]=10;for(x=24375;x<=24381;x++)K[x]=0;for(x=24718;x<=24721;x++)K[x]=0;for(x=24817;x<=24821;x++)K[x]=0;for(x=24877;x<=24882;x++)K[x]=0;for(x=24891;x<=24893;x++)K[x]=0;for(x=25391;x<=25395;x++)K[x]=0;for(x=25828;x<=25838;x++)K[x]=0;for(x=26191;x<=26195;x++)K[x]=0;for(x=26391;x<=26393;x++)K[x]=0;for(x=26701;x<=26722;x++)K[x]=0;for(x=26729;x<=26799;x++)K[x]=2;for(x=26801;x<=26803;x++)K[x]=2;for(x=26811;x<=26813;x++)K[x]=2;for(x=26847;x<=26870;x++)K[x]=2;for(x=26891;x<=26899;x++)K[x]=0;for(x=26901;x<=26923;x++)K[x]=0;for(x=26929;x<=26946;x++)K[x]=0;for(x=26948;x<=26998;x++)K[x]=0;for(x=27037;x<=27040;x++)K[x]=0;for(x=27205;x<=27232;x++)K[x]=0;for(x=27258;x<=27260;x++)K[x]=0;for(x=27391;x<=27398;x++)K[x]=0;for(x=27561;x<=27564;x++)K[x]=0;for(x=27571;x<=27574;x++)K[x]=0;for(x=27581;x<=27584;x++)K[x]=0;for(x=27591;x<=27594;x++)K[x]=0;for(x=28191;x<=28193;x++)K[x]=0;for(x=28348;x<=28358;x++)K[x]=0;for(x=28402;x<=28432;x++)K[x]=0;for(x=28462;x<=28492;x++)K[x]=0;for(x=29118;x<=29122;x++)K[x]=0;for(x=29168;x<=29172;x++)K[x]=0;for(x=29177;x<=29185;x++)K[x]=0;for(x=29187;x<=29195;x++)K[x]=0;for(x=29900;x<=29903;x++)K[x]=0;for(x=30161;x<=30179;x++)K[x]=0;for(x=30491;x<=30494;x++)K[x]=0;for(x=30729;x<=30732;x++)K[x]=0;for(x=31251;x<=31259;x++)K[x]=0;for(x=31265;x<=31268;x++)K[x]=0;for(x=31275;x<=31279;x++)K[x]=0;for(x=31281;x<=31297;x++)K[x]=0;for(x=31461;x<=31469;x++)K[x]=0;for(x=31491;x<=31495;x++)K[x]=0;for(x=31917;x<=31922;x++)K[x]=0;for(x=31965;x<=32e3;x++)K[x]=0;for(x=32001;x<=32003;x++)K[x]=2;for(x=32005;x<=32031;x++)K[x]=2;for(x=32033;x<=32060;x++)K[x]=2;for(x=32064;x<=32067;x++)K[x]=2;for(x=32074;x<=32077;x++)K[x]=2;for(x=32081;x<=32086;x++)K[x]=0;for(x=32107;x<=32130;x++)K[x]=0;for(x=32133;x<=32159;x++)K[x]=0;for(x=32164;x<=32167;x++)K[x]=2;for(x=32180;x<=32199;x++)K[x]=0;for(x=32201;x<=32260;x++)K[x]=0;for(x=32301;x<=32360;x++)K[x]=0;for(x=32601;x<=32662;x++)K[x]=0;for(x=32664;x<=32667;x++)K[x]=2;for(x=32701;x<=32761;x++)K[x]=0;for(x=53001;x<=53004;x++)K[x]=0;for(x=53008;x<=53019;x++)K[x]=0;for(x=53021;x<=53032;x++)K[x]=0;for(x=53034;x<=53037;x++)K[x]=0;for(x=53042;x<=53046;x++)K[x]=0;for(x=53074;x<=53080;x++)K[x]=0;for(x=54001;x<=54004;x++)K[x]=0;for(x=54008;x<=54019;x++)K[x]=0;for(x=54021;x<=54032;x++)K[x]=0;for(x=54034;x<=54037;x++)K[x]=0;for(x=54042;x<=54046;x++)K[x]=0;for(x=54048;x<=54053;x++)K[x]=0;for(x=54074;x<=54080;x++)K[x]=0;for(x=54098;x<=54101;x++)K[x]=0;for(x=102001;x<=102040;x++)K[x]=0;for(x=102042;x<=102063;x++)K[x]=0;for(x=102065;x<=102067;x++)K[x]=0;for(x=102070;x<=102117;x++)K[x]=0;for(x=102122;x<=102216;x++)K[x]=0;for(x=102221;x<=102377;x++)K[x]=0;for(x=102382;x<=102388;x++)K[x]=0;for(x=102389;x<=102398;x++)K[x]=2;for(x=102399;x<=102444;x++)K[x]=0;for(x=102445;x<=102447;x++)K[x]=2;for(x=102448;x<=102458;x++)K[x]=0;for(x=102459;x<=102468;x++)K[x]=2;for(x=102469;x<=102499;x++)K[x]=0;for(x=102500;x<=102519;x++)K[x]=1;for(x=102520;x<=102524;x++)K[x]=0;for(x=102525;x<=102529;x++)K[x]=2;for(x=102530;x<=102588;x++)K[x]=0;for(x=102590;x<=102598;x++)K[x]=0;for(x=102601;x<=102603;x++)K[x]=0;for(x=102605;x<=102628;x++)K[x]=0;for(x=102629;x<=102646;x++)K[x]=2;for(x=102648;x<=102700;x++)K[x]=2;for(x=102701;x<=102703;x++)K[x]=0;for(x=102707;x<=102730;x++)K[x]=2;for(x=102733;x<=102758;x++)K[x]=2;for(x=102767;x<=102900;x++)K[x]=0;for(x=102901;x<=102933;x++)K[x]=2;for(x=102934;x<=102950;x++)K[x]=13;for(x=102951;x<=102955;x++)K[x]=0;for(x=102961;x<=102963;x++)K[x]=0;for(x=102965;x<=102969;x++)K[x]=0;for(x=102971;x<=102973;x++)K[x]=0;for(x=102975;x<=102989;x++)K[x]=0;for(x=102990;x<=102992;x++)K[x]=1;for(x=102997;x<=103002;x++)K[x]=0;for(x=103003;x<=103008;x++)K[x]=2;for(x=103009;x<=103011;x++)K[x]=0;for(x=103012;x<=103014;x++)K[x]=2;for(x=103019;x<=103021;x++)K[x]=0;for(x=103022;x<=103024;x++)K[x]=2;for(x=103029;x<=103031;x++)K[x]=0;for(x=103032;x<=103034;x++)K[x]=2;for(x=103065;x<=103068;x++)K[x]=0;for(x=103074;x<=103076;x++)K[x]=0;for(x=103077;x<=103079;x++)K[x]=1;for(x=103080;x<=103082;x++)K[x]=0;for(x=103083;x<=103085;x++)K[x]=2;for(x=103090;x<=103093;x++)K[x]=0;for(x=103097;x<=103099;x++)K[x]=0;for(x=103100;x<=103102;x++)K[x]=2;for(x=103107;x<=103109;x++)K[x]=0;for(x=103110;x<=103112;x++)K[x]=2;for(x=103113;x<=103116;x++)K[x]=0;for(x=103117;x<=103120;x++)K[x]=2;for(x=103153;x<=103157;x++)K[x]=0;for(x=103158;x<=103162;x++)K[x]=2;for(x=103163;x<=103165;x++)K[x]=0;for(x=103166;x<=103168;x++)K[x]=1;for(x=103169;x<=103171;x++)K[x]=2;for(x=103186;x<=103188;x++)K[x]=0;for(x=103189;x<=103191;x++)K[x]=2;for(x=103192;x<=103195;x++)K[x]=0;for(x=103196;x<=103199;x++)K[x]=2;for(x=103200;x<=103224;x++)K[x]=0;for(x=103225;x<=103227;x++)K[x]=1;for(x=103232;x<=103237;x++)K[x]=0;for(x=103238;x<=103243;x++)K[x]=2;for(x=103244;x<=103246;x++)K[x]=0;for(x=103247;x<=103249;x++)K[x]=2;for(x=103254;x<=103256;x++)K[x]=0;for(x=103257;x<=103259;x++)K[x]=2;for(x=103264;x<=103266;x++)K[x]=0;for(x=103267;x<=103269;x++)K[x]=2;for(x=103300;x<=103375;x++)K[x]=0;for(x=103381;x<=103383;x++)K[x]=0;for(x=103384;x<=103386;x++)K[x]=1;for(x=103387;x<=103389;x++)K[x]=0;for(x=103390;x<=103392;x++)K[x]=2;for(x=103397;x<=103399;x++)K[x]=0;for(x=103400;x<=103471;x++)K[x]=2;for(x=103476;x<=103478;x++)K[x]=0;for(x=103479;x<=103481;x++)K[x]=2;for(x=103486;x<=103488;x++)K[x]=0;for(x=103489;x<=103491;x++)K[x]=2;for(x=103492;x<=103495;x++)K[x]=0;for(x=103496;x<=103499;x++)K[x]=2;for(x=103528;x<=103543;x++)K[x]=0;for(x=103544;x<=103548;x++)K[x]=2;for(x=103549;x<=103551;x++)K[x]=0;for(x=103552;x<=103554;x++)K[x]=1;for(x=103555;x<=103557;x++)K[x]=2;for(x=103558;x<=103560;x++)K[x]=0;for(x=103571;x<=103573;x++)K[x]=0;for(x=103574;x<=103576;x++)K[x]=2;for(x=103577;x<=103580;x++)K[x]=0;for(x=103581;x<=103583;x++)K[x]=2;for(x=103595;x<=103694;x++)K[x]=0;for(x=103696;x<=103699;x++)K[x]=0;for(x=103700;x<=103793;x++)K[x]=2;for(x=103794;x<=103890;x++)K[x]=0;for(x=103891;x<=103896;x++)K[x]=2;for(x=103900;x<=103971;x++)K[x]=2;for(x=103972;x<=103977;x++)K[x]=0;for(x=112e3;x<=112101;x++)K[x]=0;const Mtt={102113:!0,102100:!0,3857:!0,3785:!0},Rtt={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},zme='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',c6=[-20037508342788905e-9,20037508342788905e-9],u6=[-20037508342787e-6,20037508342787e-6],sOe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:c6,origin:u6,dx:1e-5},102100:{wkTemplate:zme,valid:c6,origin:u6,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:c6,origin:u6,dx:1e-5},3857:{wkTemplate:zme,valid:c6,origin:u6,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function jo(t,e){return t===e||!k(t)&&!k(e)&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||wS(t)&&wS(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function c2(t){return xc(t)&&t.wkid&&sOe[t.wkid]||null}function oOe(t){return!!xc(t)&&(t.wkid?K[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function ND(t){return!(XA(t)||ZA(t))}function FD(t){return xc(t)&&t.wkid===4326}function aOe(t){return xc(t)&&t.wkid===Sf.CGCS2000}function wS(t){return xc(t)&&t.wkid!=null&&Mtt[t.wkid]===!0}function fle(t){return xc(t)&&t.wkid===32662}function mle(t){return t===Sf.GCSMARS2000||t===Sf.GCSMARS2000_SPHERE}function XA(t){return xc(t)&&t.wkid!=null&&mle(t.wkid)}function gle(t){return t===Sf.GCSMOON2000}function ZA(t){return xc(t)&&t.wkid!=null&&gle(t.wkid)}function Ott(t){return xc(t)&&t.wkid!=null&&Rtt[t.wkid]===!0}function xc(t){return M(t)&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const Ptt={wkid:4326,wkt:PA(sOe[4326].wkTemplate,{Central_Meridian:"0.0"})},Itt={wkid:102100,latestWkid:3857},$tt={wkid:32662};function Ale(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const lOe=Ale(yi),yle=Ale(yA),_le=Ale(t1),cOe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${yi.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function ln(t){return M(t)&&(XA(t)||jo(t,yle))?yA:M(t)&&(ZA(t)||jo(t,_le))?t1:yi}function Onr(t){return mle(t)?yA:gle(t)?t1:yi}const vle=39.37,Dtt=yi.radius*Math.PI/200,uOe=/UNIT\[([^\]]+)\]\]$/i,QT=K,hOe=/UNIT\[([^\]]+)\]/i,Ltt=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),Ntt=$c()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),eg=t=>t*t,W1=t=>t*t*t,kD={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:eg(.001)},"square-centimeters":{inBaseUnits:eg(.01)},"square-decimeters":{inBaseUnits:eg(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:eg(1e3)},"square-inches":{inBaseUnits:eg(.0254)},"square-feet":{inBaseUnits:eg(.3048)},"square-yards":{inBaseUnits:eg(.9144)},"square-miles":{inBaseUnits:eg(1609.344)},"square-us-feet":{inBaseUnits:eg(1200/3937)},acres:{inBaseUnits:.0015625*eg(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*W1(.001)},"cubic-centimeters":{inBaseUnits:1e3*W1(.01)},"cubic-decimeters":{inBaseUnits:1e3*W1(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*W1(1e3)},"cubic-inches":{inBaseUnits:1e3*W1(.0254)},"cubic-feet":{inBaseUnits:1e3*W1(.3048)},"cubic-yards":{inBaseUnits:1e3*W1(.9144)},"cubic-miles":{inBaseUnits:1e3*W1(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},Ftt=(()=>{const t={};for(const e in kD)for(const r in kD[e].units)t[r]=e;return t})();function ktt(t,e,r){return t*kD[r].units[e].inBaseUnits}function Utt(t,e,r){return t/kD[r].units[e].inBaseUnits}const Btt=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function pK(t){const e=Ftt[t];if(!e)throw new Error("unknown type");return e}function Vme(t,e=null){return e=e||pK(t),kD[e].baseUnit===t}function ra(t,e,r){if(e===r)return t;const i=pK(e);if(i!==pK(r))throw new Error("incompatible units");const n=Vme(e,i)?t:ktt(t,e,i);return Vme(r,i)?n:Utt(n,r,i)}function Pnr(t,e,r){switch(r){case"metric":return dOe(t,e);case"imperial":return fOe(t,e);default:return r}}function Inr(t,e,r){switch(r){case"metric":return pOe(t,e);case"imperial":return mOe(t,e);default:return r}}function dOe(t,e){const r=ra(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function pOe(t,e){const r=ra(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function fOe(t,e){const r=ra(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function mOe(t,e){const r=ra(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function $nr(t,e){const r=ra(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function Dnr(t,e){const r=ra(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function ztt(t,e,r){return ra(t,e,"meters")/(r*Math.PI/180)}function gOe(t){return Ntt.fromJSON(t.toLowerCase())||null}function xS(t){if(M(t)&&!ND(t))return 1;const e=Eu(t);return e>1e5?1:e}function Vtt(t){return Eu(t)>=ln(t).metersPerDegree?"meters":TG(t)}function Eu(t,e=yi.metersPerDegree){return br(Gtt(t,!0),e)}function Gtt(t,e=!1){const r=M(t)?t.wkid:null,i=M(t)?t.wkt:null;let n=null;if(r){if(mle(r))return yA.metersPerDegree;if(gle(r))return t1.metersPerDegree;n=QT.values[QT[r]],!n&&e&&Ltt.has(r)&&(n=Dtt)}else i&&(_Oe(i)?n=Gme(uOe.exec(i),n):yOe(i)&&(n=Gme(hOe.exec(i),n)));return n}function Gme(t,e){return t&&t[1]?AOe(t[1]):e}function AOe(t){return parseFloat(t.split(",")[1])}function TG(t){const e=M(t)?t.wkid:null,r=M(t)?t.wkt:null;let i=null;if(e)i=QT.units[QT[e]];else if(r){const n=_Oe(r)?uOe:yOe(r)?hOe:null;if(n){const s=n.exec(r);s&&s[1]&&(i=Htt(s[1]))}}return M(i)?gOe(i):null}function Lnr(t){const e=TG(t);return k(e)||!Btt.includes(e)?null:e}function yOe(t){return/^GEOCCS/i.test(t)}function _Oe(t){return/^PROJCS/i.test(t)}const jtt=1e-7;function Htt(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let r=e&&e[1];if(!r||!QT.units.includes(r)){const i=AOe(t);r=null;const n=QT.values;for(let s=0;s<n.length;++s)if(Math.abs(i-n[s])<jtt){r=QT.units[s];break}}return r}function Nnr(t){const e=TG(t);if(k(e))return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const qtt={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},Wtt={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},Qtt={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},Ytt=$c()(qtt),Xtt=$c()(Wtt),Fnr=$c()(Qtt);var vg;let jn=vg=class extends Je{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return vg.WebMercator;if(t.wkid===4326)return vg.WGS84}const e=new vg;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return FD(this)}get isWebMercator(){return wS(this)}get isGeographic(){return oOe(this)}get isWrappable(){return Ott(this)}get metersPerUnit(){return Eu(this)}get unit(){return TG(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===vg.WGS84)return vg.WGS84;if(this===vg.WebMercator)return vg.WebMercator;const t=new vg;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=Te(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,n=this.imageCoordinateSystem;return e==null||i?JSON.stringify(n)===JSON.stringify(t.imageCoordinateSystem):r?n.id===e&&n.referenceServiceName===r:n.id===e}return jo(this,t)}toJSON(t){return this.write(void 0,t)}};jn.GCS_NAD_1927=null,jn.WGS84=null,jn.WebMercator=null,jn.PlateCarree=null,h([f({readOnly:!0})],jn.prototype,"isWGS84",null),h([f({readOnly:!0})],jn.prototype,"isWebMercator",null),h([f({readOnly:!0})],jn.prototype,"isGeographic",null),h([f({readOnly:!0})],jn.prototype,"isWrappable",null),h([f({type:ds,json:{write:!0}})],jn.prototype,"latestWkid",void 0),h([f({readOnly:!0})],jn.prototype,"metersPerUnit",null),h([f({readOnly:!0})],jn.prototype,"unit",null),h([f({type:ds,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],jn.prototype,"wkid",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],jn.prototype,"wkt",void 0),h([Ct("wkt"),Ct("web-scene","wkt")],jn.prototype,"writeWkt",null),h([f({type:ds,json:{write:!0}})],jn.prototype,"vcsWkid",void 0),h([f({type:ds,json:{write:!0}})],jn.prototype,"latestVcsWkid",void 0),h([f()],jn.prototype,"imageCoordinateSystem",void 0),jn=vg=h([Q("esri.geometry.SpatialReference")],jn),jn.prototype.toJSON.isDefaultToJSON=!0,jn.GCS_NAD_1927=new jn({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),jn.WGS84=new jn(Ptt),jn.WebMercator=new jn(Itt),jn.PlateCarree=new jn($tt),Object.freeze&&(Object.freeze(jn.GCS_NAD_1927),Object.freeze(jn.WGS84),Object.freeze(jn.WebMercator));const St=jn,vOe="20230301",bOe="2657e728c1857e6d94c324181c0788310bb0958a",wOe="4.26",Ztt={async request(t,e){var a,l;const{default:r}=await be(()=>Promise.resolve().then(()=>prt),void 0),i=t.options,n=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=n==="native"||n==="native-request-init"?"native-request-init":n&&["blob","json","text"].includes(n)&&((a=JRe(t.url))!=null&&a.after)?n:"array-buffer";const s=await r(t.url,i),o={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((l=s.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Un;function knr(t){Un=t}function Unr(t){const e=Un&&Un.findCredential(t);return e&&e.token?iOe(t,"token",e.token):t}Fe("host-webworker");const Jtt=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function xOe(t){const e=xm(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!Jtt.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function TOe(t,e,r=!1,i){return new Promise((n,s)=>{if(Ra(i))return void s(jme());let o=()=>{c(),s(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),n(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",s(jme())};const c=()=>{Fe("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,M(i)&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};M(i)&&i.addEventListener("abort",l),Fe("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function jme(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}function Ktt(t){gn.request.crossOriginNoCorsDomains||(gn.request.crossOriginNoCorsDomains={});const e=gn.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[xm(r)??""]=0:(e[xm("http://"+r)??""]=0,e[xm("https://"+r)??""]=0)}function ert(t){const e=gn.request.crossOriginNoCorsDomains;if(e){let r=xm(t);if(r)return r=r.toLowerCase(),!kR(r,ole())&&e[r]<Date.now()-36e5}return!1}async function trt(t){var n;const e=gn.request.crossOriginNoCorsDomains,r=xm(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=Su(t);t=i.path,((n=i.query)==null?void 0:n.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function ns(t,e){var c;const r=YA(t),i=UR(t);i||r||(t=wm(t));const n={url:t,requestOptions:{...e}};let s=JRe(t);if(s){const u=await crt(s,n);if(u!=null)return{data:u,getHeader:ble,httpStatus:200,requestOptions:n.requestOptions,url:n.url};s.after||s.error||(s=null)}if(t=n.url,(e=n.requestOptions).responseType==="image"){if(Fe("host-webworker")||Fe("host-node"))throw am("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n)}else if(r)throw am("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+e.responseType),n);if(e.method==="head"){if(e.body)throw am("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(r||i)throw am("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await ort(),AB)return AB.execute(t,e);const o=new AbortController;Sc(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:s,params:n,redoRequest:!1,useIdentity:Q0.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await hrt(a);return(c=s==null?void 0:s.after)==null||c.call(s,l),l}let AB;const Q0=gn.request,SOe="FormData"in globalThis,rrt=[499,498,403,401],irt=["COM_0056","COM_0057","SB_0008"],nrt=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],ble=()=>null,yB=Symbol();function srt(t){const e=xm(t);e&&!ns._corsServers.includes(e)&&ns._corsServers.push(e)}function Hme(t){const e=xm(t);return!e||e.endsWith(".arcgis.com")||ns._corsServers.includes(e)||lle(e)}function am(t,e,r,i){let n="Error";const s={url:r.url,requestOptions:r.requestOptions,getHeader:ble,ssl:!1};if(e instanceof pe)return e.details?(e.details=Te(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=s,e;if(e){const o=i&&(c=>i.headers.get(c)),a=i&&i.status,l=e.message;l&&(n=l),o&&(s.getHeader=o),s.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,s.subCode=e.subcode,s.messageCode=e.messageCode,typeof e.details=="string"?s.messages=[e.details]:s.messages=e.details,s.raw=yB in e?e[yB]:e}return $o(e)?en():new pe(t,n,s)}async function ort(){Fe("host-webworker")?AB||(AB=await be(()=>import("./request-7fca71fb.js"),[])):ns._abortableFetch||(ns._abortableFetch=globalThis.fetch.bind(globalThis))}async function fK(){Un||await be(()=>import("./IdentityManager-17faf80c.js"),[])}async function art(t){var a;const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,n=r.body;let s=null,o=null;if(SOe&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(o=n),t.fetchOptions={cache:r.cacheBust&&!ns._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Q0.priority,redirect:"follow",signal:i},(s||o)&&(t.fetchOptions.body=s||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=r.query)!=null&&a.token||s!=null&&s.get("token")),!t.hasToken&&gn.apiKey&&xOe(e)&&(r.query||(r.query={}),r.query.token=gn.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!EOe(e)&&!Ra(i)){let l;r.authMode==="immediate"?(await fK(),l=await Un.getCredential(e,{signal:i}),t.credential=l):r.authMode==="no-prompt"?(await fK(),l=await Un.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=l):Un&&(l=Un.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function EOe(t){return nrt.some(e=>e.test(t))}async function lrt(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},n=UR(e)||YA(e),s=r.responseType||"json",o=n?0:r.timeout!=null?r.timeout:Q0.timeout;let a=!1;if(!n){t.useSSL&&(e=dle(e)),r.cacheBust&&i.cache==="default"&&(e=iOe(e,"request.preventCache",Date.now()));let p={...r.query};t.credentialToken&&(p.token=t.credentialToken);let A=LD(p);Fe("esri-url-encodes-apostrophe")&&(A=A.replace(/'/g,"%27"));const v=e.length+1+A.length;let b;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||v>Q0.maxUrlLength;const S=r.useProxy||!!xG(e);if(S){const E=utt(e);b=E.path,!a&&b.length+1+v>Q0.maxUrlLength&&(a=!0),E.query&&(p={...E.query,...p})}if(i.method==="HEAD"&&(a||S)){if(a)throw v>Q0.maxUrlLength?am("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):am("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(S)throw am("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=aW(e,p):(i.body=LD(p),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=aW(e,p),S&&(t.useProxy=!0,e=`${b}?${e}`),p.token&&SOe&&i.body instanceof FormData&&!Ket(e)&&i.body.set("token",p.token),r.hasOwnProperty("withCredentials"))t.withCredentials=r.withCredentials;else if(!kR(e,ole())){if(lle(e))t.withCredentials=!0;else if(Un){const E=Un.findServerInfo(e);E&&E.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(i.credentials="include",ert(e)&&await trt(a?aW(e,p):e))}let l,c,u=0,d=!1;o>0&&(u=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||urt(r.headers)||!n&&!t.useProxy&&Q0.proxyUrl&&!Hme(e)){if(l=await ns._abortableFetch(e,i),t.useProxy||srt(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),s==="json"||s==="xml"||s==="document")if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=qme(c,"application/xml");break;case"document":c=qme(c,"text/html")}else c=null;if(c){if(s==="array-buffer"||s==="blob"){const p=l.headers.get("Content-Type");if(p&&/application\/json|text\/plain/i.test(p)&&c[s==="blob"?"size":"byteLength"]<=750)try{const A=await new Response(c).json();A.error&&(c=A)}catch{}}s==="image"&&c instanceof Blob&&(c=await Wme(URL.createObjectURL(c),t,!0))}}else c=await l.text()}else c=await Wme(e,t)}catch(p){if(p.name==="AbortError")throw d?new Error("Timeout exceeded"):en("Request canceled");if(!(!l&&p instanceof TypeError&&Q0.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||Hme(e))throw p;t.redoRequest=!0,htt({proxyUrl:Q0.proxyUrl,urlPrefix:xm(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function crt(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(n){r=am("request:interceptor",n,e)}if((i instanceof Error||i instanceof pe)&&(r=am("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function urt(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function qme(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function hrt(t){var s;let e,r;await art(t);try{do[e,r]=await lrt(t);while(!await drt(t,e,r))}catch(o){const a=am("request:server",o,t.params,e);throw a.details.ssl=t.useSSL,t.interceptor&&t.interceptor.error&&t.interceptor.error(a),a}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&((s=r.user)!=null&&s.username)&&!lle(i)){const o=xm(i,!0);o&&Q0.trustedServers.push(o)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&Ktt(r.authorizedCrossOriginNoCorsDomains)}const n=t.credential;if(n&&Un){const o=Un.findServerInfo(n.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=Un.findCredential(a,n.userId);l&&Un._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:r,getHeader:e?o=>e==null?void 0:e.headers.get(o):ble,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function drt(t,e,r){if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let n,s;if(!e.ok)throw n=new Error(`Unable to load ${e.url} status: ${e.status}`),n[yB]=r,n;r&&(r.error?n=r.error:r.status==="error"&&Array.isArray(r.messages)&&(n={...r},n[yB]=r,n.details=r.messages));let o,a=null;n&&(s=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o&&o.toUpperCase());const l=i.authMode;if(s===403&&(a===4||n.message&&n.message.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||s===498)&&s!==void 0&&rrt.includes(s)&&!EOe(t.params.url)&&(s!==403||o&&!irt.includes(o)&&(a==null||a===2&&t.credentialToken))){await fK();try{const c=await Un.getCredential(t.params.url,{error:am("request:server",n,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;n=c}}if(n)throw n;return!0}function Wme(t,e,r=!1){const i=e.controller.signal,n=new Image;return e.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=Q0.priority,n.src=t,TOe(n,t,r,i)}ns._abortableFetch=null,ns._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const prt=Object.freeze(Object.defineProperty({__proto__:null,default:ns},Symbol.toStringTag,{value:"Module"}));function gt(t,e,r){let i,n;return e===void 0||Array.isArray(e)?(n=t,r=e,i=[void 0]):(n=e,i=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;i.forEach(l=>{const c=TRe(s,l,n);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let bg=class extends Je{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=St.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof St)return e;if(e!=null){const i=new St;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};h([f()],bg.prototype,"type",void 0),h([f({readOnly:!0})],bg.prototype,"cache",null),h([f({readOnly:!0})],bg.prototype,"extent",null),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],bg.prototype,"hasM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],bg.prototype,"hasZ",void 0),h([f({type:St,json:{write:!0},value:St.WGS84})],bg.prototype,"spatialReference",void 0),h([gt("spatialReference")],bg.prototype,"readSpatialReference",null),bg=h([Q("esri.geometry.Geometry")],bg);const K2=bg,frt=Object.prototype.toString;function mrt(t){const e="__accessorMetadata__"in t?Go(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return grt.apply(this,r)}}function grt(t,e,r,i){mG(t,e).cast=i}function Art(t){return(e,r)=>{mG(e,t).cast=e[r]}}function Wr(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&frt.call(t[0])==="[object Function]"?mrt(t[0]):t.length===1&&typeof t[0]=="string"?Art(t[0]):void 0}function yrt(t,e){const r=t.x-e.x,i=t.y-e.y,n=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+n*n)}const _rt=57.29577951308232,vrt=.017453292519943;function Qme(t){return t*_rt}function Yme(t){return t*vrt}function Xme(t){return t/yi.radius}function _B(t){return Math.PI/2-2*Math.atan(Math.exp(-t/yi.radius))}function mK(t){return t.wkid!=null||t.wkt!=null}const lW=[0,0];function vB(t,e,r,i,n){const s=t,o=n;if(o.spatialReference=r,"x"in s&&"x"in o)[o.x,o.y]=e(s.x,s.y,lW,i);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=e(s.xmin,s.ymin,lW,i),[o.xmax,o.ymax]=e(s.xmax,s.ymax,lW,i);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const a="paths"in s?s.paths:s.rings,l=[];let c;for(let u=0;u<a.length;u++){const d=a[u];c=[],l.push(c);for(let p=0;p<d.length;p++)c.push(e(d[p][0],d[p][1],[0,0],i)),d[p].length>2&&c[p].push(d[p][2]),d[p].length>3&&c[p].push(d[p][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in s&&"points"in o){const a=s.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return n}function u2(t,e){const r=t&&(mK(t)?t:t.spatialReference),i=e&&(mK(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!jo(i,r)||wS(i)&&FD(r)||wS(r)&&FD(i))}function ew(t,e){if(k(t))return null;const r=t.spatialReference,i=e&&(mK(e)?e:e.spatialReference);return u2(r,i)?jo(r,i)?Te(t):wS(i)?vB(t,fM,St.WebMercator,!1,Te(t)):FD(i)?vB(t,m5,St.WGS84,!1,Te(t)):null:null}function fM(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=Yme(e);return r[0]=Yme(t)*yi.radius,r[1]=yi.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function m5(t,e,r=[0,0],i=!1){const n=Qme(t/yi.radius);return r[0]=i?n:n-360*Math.floor((n+180)/360),r[1]=Qme(Math.PI/2-2*Math.atan(Math.exp(-e/yi.radius))),r}function N_(t,e=!1,r=Te(t)){return vB(t,fM,St.WebMercator,e,r)}function mM(t,e=!1,r=Te(t)){return vB(t,m5,St.WGS84,e,r)}var N7;const rI=[0,0];function Zme(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Bu=N7=class extends K2{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,n){let s;if(Array.isArray(t))s=t,n=e,t=s[0],e=s[1],r=s[2],i=s[3];else if(t&&typeof t=="object"){if(s=t,t=s.x!=null?s.x:s.longitude,e=s.y!=null?s.y:s.latitude,r=s.z,i=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new St(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)we.getLogger(this.declaredClass).warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)we.getLogger(this.declaredClass).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const a=fM(s.longitude,s.latitude,rI);t=a[0],e=a[1]}}}else Zme(r)?(n=r,r=null):Zme(i)&&(n=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?we.getLogger(this.declaredClass).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&we.getLogger(this.declaredClass).warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(o.spatialReference=n),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return m5(e,r,rI)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",fM(r,t,rI)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return m5(t,e,rI)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",fM(t,e,rI)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new N7;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return N7.copy(t,this),this}equals(t){if(k(t))return!1;const{x:e,y:r,z:i,m:n,spatialReference:s}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!s.equals(u))if(s.isWebMercator&&u.isWGS84)[l,c]=fM(l,c),u=s;else{if(!s.isWGS84||!u.isWebMercator)return!1;[l,c]=m5(l,c),u=s}return e===l&&r===c&&i===o&&n===a&&s.wkid===u.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=c2(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,n=2*i;let s;return e>i?(s=Math.ceil(Math.abs(e-i)/n),e-=s*n):e<r&&(s=Math.ceil(Math.abs(e-r)/n),e+=s*n),this._set("x",e),this}distance(t){return yrt(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],Bu.prototype,"cache",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Bu.prototype,"hasM",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Bu.prototype,"hasZ",null),h([f({type:Number})],Bu.prototype,"latitude",null),h([f({type:Number})],Bu.prototype,"longitude",null),h([f({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Wr(t=>isNaN(t)?t:yf(t))],Bu.prototype,"x",void 0),h([Ct("x")],Bu.prototype,"writeX",null),h([gt("x")],Bu.prototype,"readX",null),h([f({type:Number,json:{write:!0}})],Bu.prototype,"y",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Bu.prototype,"z",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Bu.prototype,"m",void 0),Bu=N7=h([Q("esri.geometry.Point")],Bu),Bu.prototype.toJSON.isDefaultToJSON=!0;const Ht=Bu,cW=[0,0];function wle(t,e){return!!M(e)&&au(t,e.x,e.y,e.z)}function znr(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!BR(t,r))return!1;return!0}function brt(t,e){const{xmin:r,ymin:i,zmin:n,xmax:s,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?au(t,r,i,n)&&au(t,r,o,n)&&au(t,s,o,n)&&au(t,s,i,n)&&au(t,r,i,a)&&au(t,r,o,a)&&au(t,s,o,a)&&au(t,s,i,a):au(t,r,i)&&au(t,r,o)&&au(t,s,o)&&au(t,s,i)}function BR(t,e){return au(t,e[0],e[1])}function wrt(t,e){return au(t,e[0],e[1],e[2])}function au(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function xrt(t,e){return cW[1]=e.y,cW[0]=e.x,Trt(t,cW)}function Trt(t,e){return COe(t.rings,e)}function COe(t,e){if(!t)return!1;if(Srt(t))return Jme(!1,t,e);let r=!1;for(let i=0,n=t.length;i<n;i++)r=Jme(r,t[i],e);return r}function Srt(t){return!Array.isArray(t[0][0])}function Jme(t,e,r){const[i,n]=r;let s=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[d,p]=e[o];(u<n&&p>=n||p<n&&u>=n)&&c+(n-u)/(p-u)*(d-c)<i&&(s=!s)}return s}function Ert(t,e){return wle(t,e)}function Crt(t,e){const r=t.hasZ&&e.hasZ;let i,n,s;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(n=e.ymin,t.ymax<n)return!1}else if(n=t.ymin,e.ymax<n)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(s=e.zmin,t.zmax<s)return!1}else if(s=t.zmin,e.zmax<s)return!1}return!0}function Mrt(t,e){const{points:r,hasZ:i}=e,n=i?wrt:BR;for(const s of r)if(n(t,s))return!0;return!1}const TS=[0,0],SS=[0,0],ES=[0,0],CS=[0,0],Rrt=[TS,SS,ES,CS],MOe=[[ES,TS],[TS,SS],[SS,CS],[CS,ES]];function Ort(t,e){return Prt(t,e.rings)}function Prt(t,e){TS[0]=t.xmin,TS[1]=t.ymax,SS[0]=t.xmax,SS[1]=t.ymax,ES[0]=t.xmin,ES[1]=t.ymin,CS[0]=t.xmax,CS[1]=t.ymin;for(const r of Rrt)if(COe(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(BR(t,i))return!0;for(let n=1;n<r.length;n++){const s=r[n];if(BR(t,s)||ROe(i,s,MOe))return!0;i=s}}return!1}function Irt(t,e){TS[0]=t.xmin,TS[1]=t.ymax,SS[0]=t.xmax,SS[1]=t.ymax,ES[0]=t.xmin,ES[1]=t.ymin,CS[0]=t.xmax,CS[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let n=i[0];if(BR(t,n))return!0;for(let s=1;s<i.length;s++){const o=i[s];if(BR(t,o)||ROe(n,o,MOe))return!0;n=o}}return!1}const Fl=[0,0];function $rt(t){for(let e=0;e<t.length;e++){const r=t[e];for(let n=0;n<r.length-1;n++){const s=r[n],o=r[n+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(gK(s,o,c,u,Fl)&&!(Fl[0]===s[0]&&Fl[1]===s[1]||Fl[0]===c[0]&&Fl[1]===c[1]||Fl[0]===o[0]&&Fl[1]===o[1]||Fl[0]===u[0]&&Fl[1]===u[1]))return!0}}const i=r.length;if(!(i<=4))for(let n=0;n<i-3;n++){let s=i-1;n===0&&(s=i-2);const o=r[n],a=r[n+1];for(let l=n+2;l<s;l++){const c=r[l],u=r[l+1];if(gK(o,a,c,u,Fl)&&!(Fl[0]===o[0]&&Fl[1]===o[1]||Fl[0]===c[0]&&Fl[1]===c[1]||Fl[0]===a[0]&&Fl[1]===a[1]||Fl[0]===u[0]&&Fl[1]===u[1]))return!0}}}return!1}function ROe(t,e,r){for(let i=0;i<r.length;i++)if(gK(t,e,r[i][0],r[i][1]))return!0;return!1}function gK(t,e,r,i,n){const[s,o]=t,[a,l]=e,[c,u]=r,[d,p]=i,A=d-c,v=s-c,b=a-s,S=p-u,E=o-u,R=l-o,O=S*b-A*R;if(O===0)return!1;const I=(A*E-S*v)/O,N=(b*E-R*v)/O;return I>=0&&I<=1&&N>=0&&N<=1&&(n&&(n[0]=s+I*(a-s),n[1]=o+I*(l-o)),!0)}function Drt(t){switch(t){case"esriGeometryEnvelope":case"extent":return Crt;case"esriGeometryMultipoint":case"multipoint":return Mrt;case"esriGeometryPoint":case"point":return Ert;case"esriGeometryPolygon":case"polygon":return Ort;case"esriGeometryPolyline":case"polyline":return Irt}}var Qp;function Lrt(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function Q1(t,e,r){return e==null?r:r==null?e:t(e,r)}let al=Qp=class extends K2{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,n){return Lrt(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?St.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:n??St.WGS84}}static fromBounds(t,e){return new Qp({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Qp({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Ht({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Qp;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&u2(e,r)&&(t=e.isWebMercator?N_(t):mM(t,!0)),t.type==="point"?wle(this,t):t.type==="extent"&&brt(this,t)}equals(t){if(this===t)return!0;if(k(t))return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&u2(e,r)&&(t=e.isWebMercator?N_(t):mM(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const n=(this.zmax-this.zmin)*e;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*e;this.mmin+=n,this.mmax-=n}return this}intersects(t){if(k(t))return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!jo(e,r)&&u2(e,r)&&(t=e.isWebMercator?N_(t):mM(t,!0)),Drt(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Q1(Math.min,this.zmin,t.zmin),this.zmax=Q1(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Q1(Math.min,this.mmin,t.mmin),this.mmax=Q1(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:k(t)||!this.intersects(t)?null:(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Q1(Math.max,this.zmin,t.zmin),this.zmax=Q1(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Q1(Math.max,this.mmin,t.mmin),this.mmax=Q1(Math.min,this.mmax,t.mmax)),this)}toJSON(t){return this.write({},t)}_shiftCM(t=c2(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?mM(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new St(PA((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,n=this.xmin,s=this.xmax;return n>=r&&n<=i&&s>=r&&s<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const n=r??c2(i);if(n==null)return this;const s=this._getParts(n).map(l=>l.extent);if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(t)return this._shiftCM(n);if(e)return s;let o=!0,a=!0;return s.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:s.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:n,ymax:s,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||c2(o);const[d,p]=t.valid;u=this._normalizeX(this.xmin,t);const A=u.x,v=u.frameId;u=this._normalizeX(this.xmax,t);const b=u.x,S=u.frameId,E=A===b&&a>0;if(a>2*p){const R=new Qp(l<c?A:b,n,p,s,o),O=new Qp(d,n,l<c?b:A,s,o),I=new Qp(0,n,p,s,o),N=new Qp(d,n,0,s,o),L=[],B=[];R.contains(I)&&L.push(v),R.contains(N)&&B.push(v),O.contains(I)&&L.push(S),O.contains(N)&&B.push(S);for(let U=v+1;U<S;U++)L.push(U),B.push(U);e.push({extent:R,frameIds:[v]},{extent:O,frameIds:[S]},{extent:I,frameIds:L},{extent:N,frameIds:B})}else A>b||E?e.push({extent:new Qp(A,n,p,s,o),frameIds:[v]},{extent:new Qp(d,n,b,s,o),frameIds:[S]}):e.push({extent:new Qp(A,n,b,s,o),frameIds:[v]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const n={};r&&(n.zmin=this.zmin,n.zmax=this.zmax),i&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<e.length;s++)e[s].extent.set(n)}return e}_normalizeX(t,e){const[r,i]=e.valid,n=2*i;let s,o=0;return t>i?(s=Math.ceil(Math.abs(t-i)/n),t-=s*n,o=s):t<r&&(s=Math.ceil(Math.abs(t-r)/n),t+=s*n,o=-s),{x:t,frameId:o}}};h([f({readOnly:!0})],al.prototype,"cache",null),h([f({readOnly:!0})],al.prototype,"center",null),h([f({readOnly:!0})],al.prototype,"extent",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],al.prototype,"hasM",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],al.prototype,"hasZ",null),h([f({readOnly:!0})],al.prototype,"height",null),h([f({readOnly:!0})],al.prototype,"width",null),h([f({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],al.prototype,"xmin",void 0),h([f({type:Number,json:{write:!0}})],al.prototype,"ymin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],al.prototype,"mmin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],al.prototype,"zmin",void 0),h([f({type:Number,json:{write:!0}})],al.prototype,"xmax",void 0),h([f({type:Number,json:{write:!0}})],al.prototype,"ymax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],al.prototype,"mmax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],al.prototype,"zmax",void 0),al=Qp=h([Q("esri.geometry.Extent")],al),al.prototype.toJSON.isDefaultToJSON=!0;const an=al;let g5;var T3e,S3e;const Nrt=((T3e=globalThis.esriConfig)==null?void 0:T3e.locale)??((S3e=globalThis.dojoConfig)==null?void 0:S3e.locale);function OOe(){var t;return Nrt??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function yu(){return g5===void 0&&(g5=OOe()),g5}const A5=[];function xle(t){return A5.push(t),{remove(){A5.splice(A5.indexOf(t),1)}}}const AK=[];function Tle(t){return AK.push(t),{remove(){A5.splice(AK.indexOf(t),1)}}}function Frt(){const t=OOe();g5!==t&&(g5=t,[...AK].forEach(e=>{e.call(null,t)}),[...A5].forEach(e=>{e.call(null,t)}))}var E3e;(E3e=globalThis.addEventListener)==null||E3e.call(globalThis,"languagechange",Frt);var yK;const krt=new Hi({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Yp=yK=class extends rt{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new yK({categories:this.categories?Te(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=ew(this.extent,St.WGS84);M(o)&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let n=this.query;!this.disableExtraQuery&&t.extraQuery&&(n="("+n+")"+t.extraQuery);const s={categories:r,bbox:i,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(o=>krt.toJSON(o.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...e,...s}}}};h([f()],Yp.prototype,"categories",void 0),h([f()],Yp.prototype,"disableExtraQuery",void 0),h([f({type:an})],Yp.prototype,"extent",void 0),h([f()],Yp.prototype,"filter",void 0),h([f()],Yp.prototype,"num",void 0),h([f()],Yp.prototype,"query",void 0),h([f()],Yp.prototype,"sortField",void 0),h([f()],Yp.prototype,"sortOrder",null),h([f()],Yp.prototype,"start",void 0),Yp=yK=h([Q("esri.portal.PortalQueryParams")],Yp);const v_=Yp;let hx=class extends rt{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};h([f()],hx.prototype,"nextQueryParams",void 0),h([f()],hx.prototype,"queryParams",void 0),h([f()],hx.prototype,"results",void 0),h([f()],hx.prototype,"total",void 0),hx=h([Q("esri.portal.PortalQueryResult")],hx);const Urt=hx;let Fy=class extends Je{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new pe("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};h([f({type:Date})],Fy.prototype,"created",void 0),h([f()],Fy.prototype,"id",void 0),h([f()],Fy.prototype,"portal",void 0),h([f()],Fy.prototype,"title",void 0),h([f({readOnly:!0})],Fy.prototype,"url",null),h([f()],Fy.prototype,"username",void 0),Fy=h([Q("esri.portal.PortalFolder")],Fy);const Brt=Fy;let ll=class extends Je{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const e=this.url,r=this.thumbnail;return e&&r&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${e}/info/${r}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return nh(this.portal).request(this.url+"/categorySchema",e).then(r=>{const i=r.categorySchema||[];return i.some(n=>n.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return nh(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let r=this.thumbnailUrl;return r&&e&&(r+=`&w=${e}`),r}toJSON(){throw new pe("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,r){let i=Go(v_,e);const n=nh(this.portal);return parseFloat(n.currentVersion)>5?(i=i||new v_,n.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",r)):(i=i?i.clone():new v_,i.query="group:"+this.id+(i.query?" "+i.query:""),n.queryItems(i,r))}_fetchCategorySchemaSet(e,r){const i=nh(this.portal);return i.fetchSelf(i.authMode,!0,r).then(n=>{const s=n.contentCategorySetsGroupQuery;if(s){const o=new v_;return o.disableExtraQuery=!0,o.num=1,o.query=s,i.queryGroups(o,r)}throw new pe("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(n=>{if(n.total){const s=n.results[0],o=new v_;return o.num=1,o.query=`typekeywords:"${e}"`,s.queryItems(o,r)}throw new pe("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(n=>n.total?n.results[0].fetchData("json",r).then(s=>{const o=s&&s.categorySchema;return o&&o.length?o:[]}):[])}};h([f()],ll.prototype,"access",void 0),h([f({type:Date})],ll.prototype,"created",void 0),h([f()],ll.prototype,"description",void 0),h([f()],ll.prototype,"id",void 0),h([f()],ll.prototype,"isInvitationOnly",void 0),h([f({type:Date})],ll.prototype,"modified",void 0),h([f()],ll.prototype,"owner",void 0),h([f()],ll.prototype,"portal",void 0),h([f()],ll.prototype,"snippet",void 0),h([f()],ll.prototype,"sortField",void 0),h([f()],ll.prototype,"sortOrder",void 0),h([f()],ll.prototype,"tags",void 0),h([f()],ll.prototype,"thumbnail",void 0),h([f({readOnly:!0})],ll.prototype,"thumbnailUrl",null),h([f()],ll.prototype,"title",void 0),h([f({readOnly:!0})],ll.prototype,"url",null),ll=h([Q("esri.portal.PortalGroup")],ll);const _K=ll,zrt=Object.freeze(Object.defineProperty({__proto__:null,default:_K},Symbol.toStringTag,{value:"Module"}));var vK;let Ks=vK=class extends Je{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t&&t.data,i=t&&t.folder,n={method:"post"};e&&(n.query=e.createPostQuery(),r!=null&&(typeof r=="string"?n.query.text=r:typeof r=="object"&&(n.query.text=JSON.stringify(r))));let s=this.userContentUrl;return i&&(s+="/"+(typeof i=="string"?i:i.id)),this.portal.request(s+"/addItem",n).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(n=>{n.id=null,n.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const n=Brt.fromJSON(i);return n.portal=this.portal,n}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=_K.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),be(()=>Promise.resolve().then(()=>POe),void 0).then(({default:n})=>{r=n;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:s})}).then(n=>{let s;return n&&n.items?(s=n.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(s.map(o=>o.load())).catch(o=>o).then(()=>({items:s,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new _K({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new pe("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new pe("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new vK;return e.sourceJSON=t,e.read(t),e}};h([f()],Ks.prototype,"access",void 0),h([f({type:Date})],Ks.prototype,"created",void 0),h([f()],Ks.prototype,"culture",void 0),h([f()],Ks.prototype,"description",void 0),h([f()],Ks.prototype,"email",void 0),h([f()],Ks.prototype,"favGroupId",void 0),h([f()],Ks.prototype,"fullName",void 0),h([f({type:Date})],Ks.prototype,"modified",void 0),h([f()],Ks.prototype,"orgId",void 0),h([f()],Ks.prototype,"portal",void 0),h([f()],Ks.prototype,"preferredView",void 0),h([f()],Ks.prototype,"privileges",void 0),h([f()],Ks.prototype,"region",void 0),h([f()],Ks.prototype,"role",void 0),h([f()],Ks.prototype,"roleId",void 0),h([f()],Ks.prototype,"sourceJSON",void 0),h([f()],Ks.prototype,"thumbnail",void 0),h([f({readOnly:!0})],Ks.prototype,"thumbnailUrl",null),h([f()],Ks.prototype,"units",void 0),h([f({readOnly:!0})],Ks.prototype,"userContentUrl",null),h([f({readOnly:!0})],Ks.prototype,"url",null),h([f()],Ks.prototype,"username",void 0),h([f()],Ks.prototype,"userType",void 0),Ks=vK=h([Q("esri.portal.PortalUser")],Ks);const Sle=Ks,Vrt=Object.freeze(Object.defineProperty({__proto__:null,default:Sle},Symbol.toStringTag,{value:"Module"}));var Dd;let uW;const Kme={PortalGroup:()=>be(()=>Promise.resolve().then(()=>zrt),void 0),PortalItem:()=>be(()=>Promise.resolve().then(()=>POe),void 0),PortalUser:()=>be(()=>Promise.resolve().then(()=>Vrt),void 0)};let xt=Dd=class extends wN(e1){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=gn.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){this._esriIdCredentialCreateHandle=ps(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)gn.request.trustedServers.includes(e)||gn.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=Sle.fromJSON(t),e.portal=this),e}load(t){const e=be(()=>Promise.resolve().then(()=>hit),void 0).then(({default:r})=>{fi(t),uW=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{if(Un){const i=Un;this.credential=i.findCredential(this.restUrl),this.credential||this.authMode!==Dd.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle=i.on("credential-create",()=>{i.findCredential(this.restUrl)&&this.signIn().catch(()=>{})}))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await be(()=>import("./ElevationLayer-6cf02107.js"),["assets/ElevationLayer-6cf02107.js","assets/ArcGISCachedService-5a33385c.js","assets/TilemapCache-918ac228.js"])).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}fetchBasemaps(t,e){const r=new v_;return r.query=t||(gn.apiKey&&xOe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0,this.queryGroups(r,e).then(i=>{if(r.num=100,r.query='type:"Web Map" -type:"Web Application"',i.total){const n=i.results[0];return r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc",n.queryItems(r,e)}return null}).then(i=>{let n;return n=i&&i.total?i.results.filter(s=>s.type==="Web Map").map(s=>new uW({portalItem:s})):[],n})}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):Ra(t)?Promise.reject(en()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new v_;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const n of e)i.push(`(title:"${n.title}" AND owner:${n.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(n=>n.results)}return Ra(t)?Promise.reject(en()):Promise.resolve([])}fetchRegions(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||yu();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||yu();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return Dd._default&&!Dd._default.destroyed||(Dd._default=new Dd),Dd._default}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",n={authMode:t,query:{culture:yu().toLowerCase()},...r};return n.authMode==="auto"&&(n.authMode="no-prompt"),e&&(n.query.default=!0),this.request(i,n)}queryPortal(t,e,r,i){const n=Go(v_,e),s=o=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...i}).then(a=>{const l=n.clone();return l.start=a.nextStart,new Urt({nextQueryParams:l,queryParams:n,total:a.total,results:Dd._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Jh(l),a)));return r&&Kme[r]?Kme[r]().then(({default:o})=>(fi(i),s(o))):s()}signIn(){if(this.authMode===Dd.AUTH_MODE_ANONYMOUS)return Promise.reject(new pe("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Un?Un.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const n=Dd._resultsToTypedArray(r,{portal:this},i);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():i)).then(()=>n,()=>n)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===Dd.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:n=null,cacheBust:s=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:n,cacheBust:s,method:o,query:r,responseType:a,timeout:0,signal:l};return ns(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new pe("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Dd({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new pe("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=uW.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let n=[];if(r){const s=M(i)?i.signal:null;n=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(n=n.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(s),a}))}else n=[];return n}};xt.AUTH_MODE_ANONYMOUS="anonymous",xt.AUTH_MODE_AUTO="auto",xt.AUTH_MODE_IMMEDIATE="immediate",h([f()],xt.prototype,"access",void 0),h([f()],xt.prototype,"allSSL",void 0),h([f()],xt.prototype,"authMode",void 0),h([f()],xt.prototype,"authorizedCrossOriginDomains",void 0),h([gt("authorizedCrossOriginDomains")],xt.prototype,"readAuthorizedCrossOriginDomains",null),h([f()],xt.prototype,"basemapGalleryGroupQuery",void 0),h([f()],xt.prototype,"bingKey",void 0),h([f()],xt.prototype,"canListApps",void 0),h([f()],xt.prototype,"canListData",void 0),h([f()],xt.prototype,"canListPreProvisionedItems",void 0),h([f()],xt.prototype,"canProvisionDirectPurchase",void 0),h([f()],xt.prototype,"canSearchPublic",void 0),h([f()],xt.prototype,"canShareBingPublic",void 0),h([f()],xt.prototype,"canSharePublic",void 0),h([f()],xt.prototype,"canSignInArcGIS",void 0),h([f()],xt.prototype,"canSignInIDP",void 0),h([f()],xt.prototype,"colorSetsGroupQuery",void 0),h([f()],xt.prototype,"commentsEnabled",void 0),h([f({type:Date})],xt.prototype,"created",void 0),h([f()],xt.prototype,"credential",void 0),h([f()],xt.prototype,"culture",void 0),h([f()],xt.prototype,"currentVersion",void 0),h([f()],xt.prototype,"customBaseUrl",void 0),h([f()],xt.prototype,"defaultBasemap",void 0),h([gt("defaultBasemap")],xt.prototype,"readDefaultBasemap",null),h([f()],xt.prototype,"defaultDevBasemap",void 0),h([gt("defaultDevBasemap")],xt.prototype,"readDefaultDevBasemap",null),h([f({type:an})],xt.prototype,"defaultExtent",void 0),h([f()],xt.prototype,"defaultVectorBasemap",void 0),h([gt("defaultVectorBasemap")],xt.prototype,"readDefaultVectorBasemap",null),h([f()],xt.prototype,"description",void 0),h([f()],xt.prototype,"devBasemapGalleryGroupQuery",void 0),h([f()],xt.prototype,"eueiEnabled",void 0),h([f({readOnly:!0})],xt.prototype,"extraQuery",null),h([f()],xt.prototype,"featuredGroups",void 0),h([f()],xt.prototype,"featuredItemsGroupQuery",void 0),h([f()],xt.prototype,"galleryTemplatesGroupQuery",void 0),h([f()],xt.prototype,"livingAtlasGroupQuery",void 0),h([f()],xt.prototype,"hasCategorySchema",void 0),h([f()],xt.prototype,"helpBase",void 0),h([f()],xt.prototype,"helperServices",void 0),h([f()],xt.prototype,"helpMap",void 0),h([f()],xt.prototype,"homePageFeaturedContent",void 0),h([f()],xt.prototype,"homePageFeaturedContentCount",void 0),h([f()],xt.prototype,"httpPort",void 0),h([f()],xt.prototype,"httpsPort",void 0),h([f()],xt.prototype,"id",void 0),h([f()],xt.prototype,"ipCntryCode",void 0),h([f({readOnly:!0})],xt.prototype,"isOrganization",null),h([f()],xt.prototype,"isPortal",void 0),h([f()],xt.prototype,"isReadOnly",void 0),h([f({readOnly:!0})],xt.prototype,"itemPageUrl",null),h([f()],xt.prototype,"layerTemplatesGroupQuery",void 0),h([f()],xt.prototype,"maxTokenExpirationMinutes",void 0),h([f({type:Date})],xt.prototype,"modified",void 0),h([f()],xt.prototype,"name",void 0),h([f()],xt.prototype,"portalHostname",void 0),h([f()],xt.prototype,"portalMode",void 0),h([f()],xt.prototype,"portalProperties",void 0),h([f()],xt.prototype,"region",void 0),h([f({readOnly:!0})],xt.prototype,"restUrl",null),h([f()],xt.prototype,"rotatorPanels",void 0),h([f()],xt.prototype,"showHomePageDescription",void 0),h([f()],xt.prototype,"sourceJSON",void 0),h([f()],xt.prototype,"staticImagesUrl",void 0),h([f({json:{name:"2DStylesGroupQuery"}})],xt.prototype,"stylesGroupQuery2d",void 0),h([f({json:{name:"stylesGroupQuery"}})],xt.prototype,"stylesGroupQuery3d",void 0),h([f()],xt.prototype,"supportsHostedServices",void 0),h([f()],xt.prototype,"symbolSetsGroupQuery",void 0),h([f()],xt.prototype,"templatesGroupQuery",void 0),h([f()],xt.prototype,"thumbnail",void 0),h([f({readOnly:!0})],xt.prototype,"thumbnailUrl",null),h([f()],xt.prototype,"units",void 0),h([f()],xt.prototype,"url",void 0),h([f()],xt.prototype,"urlKey",void 0),h([gt("urlKey")],xt.prototype,"readUrlKey",null),h([f()],xt.prototype,"user",void 0),h([gt("user")],xt.prototype,"readUser",null),h([f()],xt.prototype,"useStandardizedQuery",void 0),h([f()],xt.prototype,"useVectorBasemaps",void 0),h([f()],xt.prototype,"vectorBasemapGalleryGroupQuery",void 0),xt=Dd=h([Q("esri.portal.Portal")],xt);const mh=xt,Grt=we.getLogger("esri.assets");function jrt(t,e){return ns(nn(t),e)}function nn(t){if(!gn.assetsPath)throw Grt.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new pe("assets:path-not-set","config.assetsPath is not set");return bS(gn.assetsPath,t)}let Iv=class extends rt{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){M(e)&&fp(e)?we.getLogger(this.declaredClass).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.url;if(k(i))throw new pe("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:Oa(r,"signal")})}async update(e,r){return(await be(()=>import("./resourceUtils-99b23d46.js"),[])).addOrUpdateResource(this,"update",e,r)}hasPath(){return M(this.path)}_normalizePath(e,r){return k(e)?e:(e=e.replace(/^\/+/,""),M(r)&&fp(e)&&(e=cle(e,r.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};h([f()],Iv.prototype,"portalItem",void 0),h([f({type:String,value:null})],Iv.prototype,"path",null),h([Wr("path")],Iv.prototype,"_castPath",null),h([f({type:String,readOnly:!0})],Iv.prototype,"url",null),h([f({type:String,readOnly:!0})],Iv.prototype,"itemRelativeUrl",null),Iv=h([Q("esri.portal.PortalItemResource")],Iv);const Hrt=Iv;let S$=class extends rt{constructor(e){super(e),this.created=null,this.rating=null}};h([f()],S$.prototype,"created",void 0),h([f()],S$.prototype,"rating",void 0),S$=h([Q("esri.portal.PortalRating")],S$);const hW=S$;var dx;const qrt=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),Wrt=new Set(["KML","GeoJson","CSV"]);let mi=dx=class extends wN(e1){static from(t){return FR(dx,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?r="Locator":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replace(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"&&(r="Insights Report"),r}readExtent(t){return t&&t.length?new an(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let n,s=!1,o=!1,a=!1,l=!1,c=!1,u=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(s=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),n=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":s?"featureshosted":u?"utilitynetwork":"features"):n=t==="map service"||t==="wms"||t==="wmts"?s||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?"mediaservice":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):n=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="360 vr experience"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":"maps",n?nn(r+n+i+".png"):null}get isLayer(){return this.type!=null&&qrt.has(this.type)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var r;const t=this.itemUrl,e=this.thumbnail;return t&&e?((r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=mh.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:M(t)?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof hW&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new hW({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:Te(this.applicationProxies),avgRating:this.avgRating,categories:Te(this.categories),created:Te(this.created),culture:this.culture,description:this.description,extent:Te(this.extent),groupCategories:Te(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:Te(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:Te(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Te(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Te(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new dx({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const r of["tags","typeKeywords","categories"])t[r]&&(t[r]=t[r].join(", "));const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await nh(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return nh(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await nh(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new hW(e)):null}fetchRelatedItems(t,e){return nh(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},dx)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return nh(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>nh(this.portal).signIn()).then(()=>{const e=t&&t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new pe("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new pe("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await nh(e).signIn();const{copyResources:i,folder:n,tags:s,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof n=="string"?n:n==null?void 0:n.id,includeResources:!!i,tags:s==null?void 0:s.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new dx({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")YA(e)?i.query={data:e}:i.query={url:np(e)},M(r)&&(i.query.filename=r);else{const n=new FormData;M(r)?n.append("file",e,r):n.append("file",e),i.body=n}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new pe("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){return(await be(()=>import("./resourceUtils-99b23d46.js"),[])).fetchResources(this,t,e)}async addResource(t,e,r){const i=await be(()=>import("./resourceUtils-99b23d46.js"),[]);return t.portalItem=this,i.addOrUpdateResource(t,"add",e,r)}async removeResource(t,e){const r=await be(()=>import("./resourceUtils-99b23d46.js"),[]);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new pe("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r.removeResource(this,t,e)}async removeAllResources(t){return(await be(()=>import("./resourceUtils-99b23d46.js"),[])).removeAllResources(this,t)}resourceFromPath(t){return new Hrt({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:Te(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Te(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Te(this.typeKeywords),url:this.url};return kMe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new dx({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};h([f({type:["private","shared","org","public"]})],mi.prototype,"access",void 0),h([f()],mi.prototype,"accessInformation",void 0),h([f({type:String})],mi.prototype,"apiKey",void 0),h([f({json:{read:{source:"appProxies"}}})],mi.prototype,"applicationProxies",void 0),h([f()],mi.prototype,"avgRating",void 0),h([f()],mi.prototype,"categories",void 0),h([f({type:Date})],mi.prototype,"created",void 0),h([f()],mi.prototype,"culture",void 0),h([f()],mi.prototype,"description",void 0),h([f({readOnly:!0})],mi.prototype,"displayName",null),h([f({type:an})],mi.prototype,"extent",void 0),h([gt("extent")],mi.prototype,"readExtent",null),h([f()],mi.prototype,"groupCategories",void 0),h([f({readOnly:!0})],mi.prototype,"iconUrl",null),h([f()],mi.prototype,"id",void 0),h([f({readOnly:!0})],mi.prototype,"isLayer",null),h([f({type:Boolean,readOnly:!0})],mi.prototype,"isOrgItem",void 0),h([f()],mi.prototype,"itemControl",void 0),h([f({readOnly:!0})],mi.prototype,"itemPageUrl",null),h([f({readOnly:!0})],mi.prototype,"itemUrl",null),h([f()],mi.prototype,"licenseInfo",void 0),h([f({type:Date})],mi.prototype,"modified",void 0),h([f()],mi.prototype,"name",void 0),h([f()],mi.prototype,"numComments",void 0),h([f()],mi.prototype,"numRatings",void 0),h([f()],mi.prototype,"numViews",void 0),h([f()],mi.prototype,"owner",void 0),h([f()],mi.prototype,"ownerFolder",void 0),h([f({type:mh})],mi.prototype,"portal",void 0),h([f()],mi.prototype,"screenshots",void 0),h([f()],mi.prototype,"size",void 0),h([f()],mi.prototype,"snippet",void 0),h([f()],mi.prototype,"sourceJSON",void 0),h([f({type:String})],mi.prototype,"sourceUrl",void 0),h([f({type:String})],mi.prototype,"spatialReference",void 0),h([f()],mi.prototype,"tags",void 0),h([f()],mi.prototype,"thumbnail",void 0),h([f({readOnly:!0})],mi.prototype,"thumbnailUrl",null),h([f()],mi.prototype,"title",void 0),h([f()],mi.prototype,"type",void 0),h([f()],mi.prototype,"typeKeywords",void 0),h([f({type:String,json:{read(t,e){var r;if(Wrt.has(e.type)){const i=(r=this.portal)==null?void 0:r.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],mi.prototype,"url",void 0),h([f({readOnly:!0})],mi.prototype,"userItemUrl",null),mi=dx=h([Q("esri.portal.PortalItem")],mi);const y5=mi,POe=Object.freeze(Object.defineProperty({__proto__:null,default:y5},Symbol.toStringTag,{value:"Module"})),ege=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,Qrt={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function tge(t){return Qrt[t]??!1}const E$=[],QM=new Map;function rge(t){for(const e of QM.keys())IOe(t.pattern,e)&&QM.delete(e)}function Yrt(t){return E$.includes(t)||(rge(t),E$.unshift(t)),{remove(){const e=E$.indexOf(t);e>-1&&(E$.splice(e,1),rge(t))}}}async function Ele(t){const e=yu();QM.has(t)||QM.set(t,Zrt(t,e));const r=QM.get(t);return r&&await Jrt.add(r),r}function Xrt(t){if(!ege.test(t))return null;const e=ege.exec(t);if(e===null)return null;const[,r,i]=e,n=r+(i?"-"+i.toUpperCase():"");return tge(n)?n:tge(r)?r:null}async function Zrt(t,e){const r=[];for(const i of E$)if(IOe(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(n){r.push(n)}throw r.length?new pe("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new pe("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function IOe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}Tle(()=>{QM.clear()});const Jrt=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=x2())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function Krt(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,r=await Ele("esri/t9n/basemaps");return r[t]||r[e]}const bK={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return nn("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return nn("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return nn("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return nn("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return nn("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return nn("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return nn("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return nn("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return nn("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return nn("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return nn("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return nn("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return nn("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return nn("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return nn("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return nn("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return nn("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return nn("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return nn("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return nn("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return nn("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return nn("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return nn("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return nn("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return nn("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return nn("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return nn("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};function _5(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function zR(t){return t!=null&&"type"in t&&t.type==="group"}const Wnr={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function $Oe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function ige(t){return(t==null?void 0:t.type)==="voxel"}function nge(t){return(t==null?void 0:t.type)==="imagery-tile"}function DOe(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function Cle(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function Qnr(t){var e;return(t==null?void 0:t.type)==="feature"&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function eit(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function LOe(t,e){const r=Un==null?void 0:Un.findServerInfo(t);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const n=`${t.substring(0,i)}/rest/info`,s=M(e)?e.signal:null,{data:o}=await ns(n,{query:{f:"json"},responseType:"json",signal:s});return(o==null?void 0:o.owningSystemUrl)||null}function tit(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function NOe(t){return tit(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function rit(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function iit(t){return!!rit(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const nit=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),sit=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function oit(t){return t.layerContainerType==="basemap"?nit:t.layerContainerType==="operational-layers"?sit:null}function ait(t,e){if(e.restrictedWebMapWriting){const r=oit(e);return!M(r)||r.has(t.type)&&!Cle(t)}return!0}function lit(t,e){if(e)if(Cle(t)){const r=_N("featureCollection.layers",e),i=r&&r[0]&&r[0].layerDefinition;i&&dW(t,i)}else t.type==="stream"?dW(t,e.layerDefinition=e.layerDefinition||{}):t.type!=="group"&&dW(t,e)}function dW(t,e){"maxScale"in t&&(e.maxScale=pB(t.maxScale)??void 0),"minScale"in t&&(e.minScale=pB(t.minScale)??void 0)}function cit(t,e){if(lit(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=pB(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(Cle(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function sge(t,e,r){if(!("write"in t)||!t.write)return r&&r.messages&&r.messages.push(new pe("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(ait(t,r)){const i={};return t.write(i,r)?i:null}return M(e)&&cit(t,e=Te(e)),e}var F7;let uit=0;const FOe="esri.Basemap";let Xp=F7=class extends wN(e1){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+uit++,this.baseLayers=new ur,this.referenceLayers=new ur;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&we.getLogger(this.declaredClass).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(t=>{we.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var r;const t=this.baseLayers.removeAll();for(const i of t)i.destroy();const e=this.referenceLayers.removeAll();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(r=this.portalItem)==null||r.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",vS(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=sge(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);M(s)&&i.push(s)}),this.referenceLayers.forEach(n=>{const s=sge(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);M(s)&&(n.type!=="scene"&&(s.isReference=!0),i.push(s))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",vS(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return qRe(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(t.loadStatus="loaded"),new F7({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=Te(r);return i.url&&$A(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&$A(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r}=this;fi(t);const i=[];if(e){const n=e.context?e.context.url:null;if(i.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const s=e.data.id;i.push(Krt(s).then(o=>{o&&this.read({title:o},e.context)}))}}else r&&i.push(this._loadFromItem(r,t));await Promise.all(i)}async _loadLayersFromJSON(t,e,r){const i=this.resourceInfo&&this.resourceInfo.context,n=this.portalItem&&this.portalItem.portal||i&&i.portal||null,s=i&&i.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await be(()=>import("./layersCreator-4cd9d9ae.js"),["assets/layersCreator-4cd9d9ae.js","assets/lazyLayerLoader-765d674b.js","assets/portalLayers-0cb49466.js","assets/layersLoader-dae6ab5f.js","assets/fetchService-c1a8c74f.js","assets/jsonContext-7b58d0bd.js"]),a=[];if(fi(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:s,url:e,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=p=>s==="web-scene"&&p.layerType==="ArcGISSceneServiceLayer"||p.isReference,u=o(this.baseLayers,t.baseMapLayers.filter(p=>!c(p)),l);a.push(u);const d=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(d)}await fh(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),n=Su(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:t.type==="Web Scene"?"web-scene":"web-map",portal:t.portal||mh.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||mh.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}static fromId(t){const e=bK[t];if(e){if(e.deprecated){let r=null;t==="dark-gray"?r="dark-gray-vector":t==="gray"?r="gray-vector":t==="streets"?r="streets-vector":t==="topo"&&(r="topo-vector"),oRe(we.getLogger(FOe),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return F7.fromJSON(e)}return null}};h([f({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:ur}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],Xp.prototype,"baseLayers",null),h([f({type:String,json:{origins:{"web-scene":{write:!0}}}})],Xp.prototype,"id",void 0),h([f({type:y5})],Xp.prototype,"portalItem",void 0),h([f()],Xp.prototype,"referenceLayers",null),h([f({readOnly:!0})],Xp.prototype,"resourceInfo",void 0),h([f({type:St})],Xp.prototype,"spatialReference",void 0),h([f()],Xp.prototype,"thumbnailUrl",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Xp.prototype,"title",void 0),h([Ct("title")],Xp.prototype,"writeTitle",null),Xp=F7=h([Q(FOe)],Xp);const bB=Xp,hit=Object.freeze(Object.defineProperty({__proto__:null,default:bB},Symbol.toStringTag,{value:"Module"})),wB={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function kOe(t){return wB[t]||wB[t.toLowerCase()]}function Mle(t){return wB[t]??wB[t.toLowerCase()]}function dit(t){return[...Mle(t)]}function pW(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function UOe(t,e,r,i=1){const n=(t%360+360)%360/360,s=r<=.5?r*(e+1):r+e-r*e,o=2*r-s;return[Math.round(255*pW(o,s,n+1/3)),Math.round(255*pW(o,s,n)),Math.round(255*pW(o,s,n-1/3)),i]}function pit(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,n=e?1:17,s=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&i,o>>=r,a[3]=n*l/255),l=o&i,o>>=r,a[2]=n*l,l=o&i,o>>=r,a[1]=n*l,l=o&i,o>>=r,a[0]=n*l,a}function G(){return[0,0,0]}function Gs(t){return[t[0],t[1],t[2]]}function pt(t,e,r){return[t,e,r]}function sh(t){const e=G(),r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Rle(t,e){return new Float64Array(t,e,3)}function BOe(){return G()}function zOe(){return pt(1,1,1)}function VOe(){return pt(1,0,0)}function GOe(){return pt(0,1,0)}function Ole(){return pt(0,0,1)}const Ec=BOe(),cA=zOe(),fit=VOe(),mit=GOe(),jOe=Ole();Object.freeze(Object.defineProperty({__proto__:null,ONES:cA,UNIT_X:fit,UNIT_Y:mit,UNIT_Z:jOe,ZEROS:Ec,clone:Gs,create:G,createView:Rle,fromArray:sh,fromValues:pt,ones:zOe,unitX:VOe,unitY:GOe,unitZ:Ole,zeros:BOe},Symbol.toStringTag,{value:"Module"}));let Ple=1e-6;function Dc(){return Ple}function git(t){Ple=t}const SN=Math.random,Ait=Math.PI/180,yit=180/Math.PI;function SG(t){return t*Ait}function _it(t){return t*yit}function vit(t,e){return Math.abs(t-e)<=Ple*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:SN,equals:vit,getEpsilon:Dc,setEpsilon:git,toDegree:_it,toRadian:SG},Symbol.toStringTag,{value:"Module"}));function ct(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function Pe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Le(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function ze(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Ve(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function EG(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function xB(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function bit(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function HOe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function wK(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function qOe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function WOe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function wit(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function xit(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Oe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function PT(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function zn(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}function Cl(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function vc(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function Cc(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Tit(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ye(t,e){const r=e[0],i=e[1],n=e[2];let s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function Qe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Kt(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2];return t[0]=n*l-s*a,t[1]=s*o-i*l,t[2]=i*a-n*o,t}function Eo(t,e,r,i){const n=e[0],s=e[1],o=e[2];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t}function Sit(t,e,r,i,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return t[0]=e[0]*a+r[0]*l+i[0]*c+n[0]*u,t[1]=e[1]*a+r[1]*l+i[1]*c+n[1]*u,t[2]=e[2]*a+r[2]*l+i[2]*c+n[2]*u,t}function Eit(t,e,r,i,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,d=3*l*o,p=l*s;return t[0]=e[0]*c+r[0]*u+i[0]*d+n[0]*p,t[1]=e[1]*c+r[1]*u+i[1]*d+n[1]*p,t[2]=e[2]*c+r[2]*u+i[2]*d+n[2]*p,t}function Cit(t,e){e=e||1;const r=SN,i=2*r()*Math.PI,n=2*r()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*s,t[1]=Math.sin(i)*s,t[2]=n*e,t}function Ot(t,e,r){const i=e[0],n=e[1],s=e[2];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12],t[1]=r[1]*i+r[5]*n+r[9]*s+r[13],t[2]=r[2]*i+r[6]*n+r[10]*s+r[14],t}function nd(t,e,r){const i=e[0],n=e[1],s=e[2];return t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8],t}function Tm(t,e,r){const i=r[0],n=r[1],s=r[2],o=r[3],a=e[0],l=e[1],c=e[2];let u=n*c-s*l,d=s*a-i*c,p=i*l-n*a,A=n*p-s*d,v=s*u-i*p,b=i*d-n*u;const S=2*o;return u*=S,d*=S,p*=S,A*=2,v*=2,b*=2,t[0]=a+u+A,t[1]=l+d+v,t[2]=c+p+b,t}function Mit(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function Rit(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function Oit(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function QOe(t,e){Pe(h6,t),Pe(d6,e),Ye(h6,h6),Ye(d6,d6);const r=Qe(h6,d6);return r>1?0:r<-1?Math.PI:Math.acos(r)}const h6=G(),d6=G();function Pit(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function fu(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function S2(t,e){if(t===e)return!0;const r=t[0],i=t[1],n=t[2],s=e[0],o=e[1],a=e[2],l=Dc();return Math.abs(r-s)<=l*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))}function y1(t,e,r){const i=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2];let o=i*i+n*n+s*s;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=n*o,t[2]=s*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Ka=Ve,Iit=EG,$it=xB,EN=zn,Ile=Cl,Gh=ct,xK=vc,oge=Object.freeze(Object.defineProperty({__proto__:null,abs:wK,add:ze,angle:QOe,bezier:Eit,ceil:bit,copy:Pe,cross:Kt,direction:y1,dist:EN,distance:zn,div:$it,divide:xB,dot:Qe,equals:S2,exactEquals:fu,floor:HOe,hermite:Sit,inverse:Tit,len:Gh,length:ct,lerp:Eo,max:wit,min:WOe,mul:Iit,multiply:EG,negate:Cc,normalize:Ye,random:Cit,rotateX:Mit,rotateY:Rit,rotateZ:Oit,round:xit,scale:Oe,scaleAndAdd:PT,set:Le,sign:qOe,sqrDist:Ile,sqrLen:xK,squaredDistance:Cl,squaredLength:vc,str:Pit,sub:Ka,subtract:Ve,transformMat3:nd,transformMat4:Ot,transformQuat:Tm},Symbol.toStringTag,{value:"Module"}));function lm(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function pn(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function $le(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function YOe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function XOe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function ZOe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Dit(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Lit(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Nit(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function Fit(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function kit(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function YO(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Uit(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function JOe(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function TB(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return r*r+i*i+n*n+s*s}function Dle(t){const e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}function Lle(t){const e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function Bit(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function zit(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function KOe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3];let o=r*r+i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=n*o,t[3]=s*o),t}function ePe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function CG(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function Vit(t,e){const r=SN;let i,n,s,o,a,l;e=e||1;do i=2*r()-1,n=2*r()-1,a=i*i+n*n;while(a>=1);do s=2*r()-1,o=2*r()-1,l=s*s+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*n,t[2]=e*s*c,t[3]=e*o*c,t}function cp(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*o,t}function Git(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2],c=r[3],u=c*i+a*s-l*n,d=c*n+l*i-o*s,p=c*s+o*n-a*i,A=-o*i-a*n-l*s;return t[0]=u*c+A*-o+d*-l-p*-a,t[1]=d*c+A*-a+p*-o-u*-l,t[2]=p*c+A*-l+u*-a-d*-o,t[3]=e[3],t}function jit(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function YM(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Nle(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Dc();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}const Hit=YOe,qit=XOe,Wit=ZOe,Qit=JOe,Yit=TB,Xit=Dle,Zit=Lle,tPe=Object.freeze(Object.defineProperty({__proto__:null,add:$le,ceil:Dit,copy:lm,dist:Qit,distance:JOe,div:Wit,divide:ZOe,dot:ePe,equals:Nle,exactEquals:YM,floor:Lit,inverse:zit,len:Xit,length:Dle,lerp:CG,max:Fit,min:Nit,mul:qit,multiply:XOe,negate:Bit,normalize:KOe,random:Vit,round:kit,scale:YO,scaleAndAdd:Uit,set:pn,sqrDist:Yit,sqrLen:Zit,squaredDistance:TB,squaredLength:Lle,str:jit,sub:Hit,subtract:YOe,transformMat4:cp,transformQuat:Git},Symbol.toStringTag,{value:"Module"})),age=new Float32Array(1);function VR(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function He(t,e,r){return Math.min(Math.max(t,e),r)}function Im(t){return(t&t-1)==0}function Ynr(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function Xnr(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Mr(t,e,r){return t+(e-t)*r}function Dr(t){return t*Math.PI/180}function xu(t){return 180*t/Math.PI}function fW(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function pa(t){return Math.acos(He(t,-1,1))}function jf(t){return Math.asin(He(t,-1,1))}function XM(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const SB=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function Jit(t){return SB.setFloat64(0,t),SB.getBigInt64(0)}function Kit(t){return SB.setBigInt64(0,t),SB.getFloat64(0)}const mW=BigInt("1000000");ent(1);function ent(t){const e=Jit(t=Math.abs(t)),r=Kit(e<=mW?mW:e-mW);return Math.abs(t-r)}function tnt(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),n=Math.abs(t),s=Math.abs(e);if(t===0||e===0||n<1e-12&&s<1e-12){if(i>.01*r)return!1}else if(i/(n+s)>r)return!1;return!0}function rnt(t){return rPe(Math.max(-TK,Math.min(t,TK)))}function rPe(t){return age[0]=t,age[0]}function GR(t,e,r){const i=He((r-t)/(e-t),0,1);return i*i*(3-2*i)}function lge(t,e){const r=ct(t),i=jf(t[2]/r),n=Math.atan2(t[1]/r,t[0]/r);return Le(e,r,i,n),e}function Znr(t,e,r){return pn(t,e[0],e[1],e[2],e[3]*r)}function Jnr(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(XM(e,1)&&XM(r,1)&&XM(i,1))}const TK=rPe(34028234663852886e22);function p6(t){return He(Zae(t),0,255)}function f6(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}let k7=class dc{static blendColors(e,r,i,n=new dc){return n.r=Math.round(e.r+(r.r-e.r)*i),n.g=Math.round(e.g+(r.g-e.g)*i),n.b=Math.round(e.b+(r.b-e.b)*i),n.a=e.a+(r.a-e.a)*i,n._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const n=i[2].split(/\s*,\s*/),s=i[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const o=n[0];if(o.charAt(o.length-1)==="%"){const a=n.map(l=>2.56*parseFloat(l));return n.length===4&&(a[3]=parseFloat(n[3])),dc.fromArray(a,r)}return dc.fromArray(n.map(a=>parseFloat(a)),r)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return dc.fromArray(UOe(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),r)}return null}static fromHex(e,r=new dc){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const i=e.length===4?4:8,n=(1<<i)-1;let s=+("0x"+e.substr(1));return isNaN(s)?null:(["b","g","r"].forEach(o=>{const a=s&n;s>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(e,r=new dc){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=kOe(e)?Mle(e):null;return i&&dc.fromArray(i,r)||dc.fromRgb(e,r)||dc.fromHex(e,r)}static fromJSON(e){return e&&new dc([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return M(e)?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return M(e)?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?dc.fromString(e,this):Array.isArray(e)?dc.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof dc||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=dc.AlphaMode.ALWAYS){const r=p6(this.r),i=p6(this.g),n=p6(this.b);return e===dc.AlphaMode.ALWAYS||this.a!==1?[r,i,n,p6(255*this.a)]:[r,i,n]}clone(){return new dc(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return M(e)&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(f6(this.r,0,255)),this.g=Math.round(f6(this.g,0,255)),this.b=Math.round(f6(this.b,0,255)),this.a=f6(this.a,0,1),this}_set(e,r,i,n){this.r=e,this.g=r,this.b=i,this.a=n}};k7.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(k7||(k7={}));const $t=k7;function Knr(t){}function int(t){return()=>t}function nr(t,e={}){const r=t instanceof Hi?t:new Hi(t,e),i={type:(e==null?void 0:e.ignoreUnknown)??1?r.apiValues:String,json:{type:r.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(i.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(i.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(i.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(i.nonNullable=e.nonNullable),f(i)}var SK;let U7=SK=class extends Je{constructor(t){super(t),this.type="none"}clone(){return new SK({type:this.type})}};h([nr({none:"none",stayAbove:"stay-above"})],U7.prototype,"type",void 0),U7=SK=h([Q("esri.ground.NavigationConstraint")],U7);let eo=class extends rt{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};h([f()],eo.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),h([f()],eo.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),h([f()],eo.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),h([f()],eo.prototype,"DECONFLICTOR_SHOW_GRID",void 0),h([f()],eo.prototype,"LABELS_SHOW_BORDER",void 0),h([f()],eo.prototype,"TEXT_SHOW_BASELINE",void 0),h([f()],eo.prototype,"TEXT_SHOW_BORDER",void 0),h([f()],eo.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),h([f()],eo.prototype,"OVERLAY_SHOW_CENTER",void 0),h([f()],eo.prototype,"SHOW_POI",void 0),h([f()],eo.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),h([f()],eo.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),h([f()],eo.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),h([f()],eo.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),h([f()],eo.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),h([f()],eo.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),h([f()],eo.prototype,"I3S_TREE_SHOW_TILES",void 0),h([f()],eo.prototype,"I3S_SHOW_MODIFICATIONS",void 0),h([f()],eo.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),h([f()],eo.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),h([f()],eo.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),h([f()],eo.prototype,"LINE_WIREFRAMES",void 0),h([f()],eo.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),eo=h([Q("esri.views.3d.support.DebugFlags")],eo);const tn=new eo;function MG(t){const e=Zae(100*(1-t));return Math.max(0,Math.min(e,100))}function UD(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var EK;let wg=EK=class extends wN(e1){constructor(t){super(t),this.opacity=1,this.shading=!tn.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new ur;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&we.getLogger(this.declaredClass).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(t=>{we.getLogger(this.declaredClass).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",vS(t,this._get("layers")))}writeLayers(t,e,r,i){const n=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(s=>{if("write"in s){const o={};int(s)().write(o,i)&&n.push(o)}else i&&i.messages&&i.messages.push(new pe("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return qRe(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await be(()=>import("./ElevationQuery-ea1ff24e.js"),[]);fi(e);const i=new r,n=this.layers.filter(cge).toArray();return i.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await be(()=>import("./ElevationQuery-ea1ff24e.js"),[]);fi(e);const i=new r,n=this.layers.filter(cge).toArray();return i.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:Te(this.surfaceColor),navigationConstraint:Te(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new EK({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,r){const i=e&&e.origin||"web-scene",n=e&&e.portal||null,s=e&&e.url||null;return be(()=>import("./layersCreator-4cd9d9ae.js"),["assets/layersCreator-4cd9d9ae.js","assets/lazyLayerLoader-765d674b.js","assets/portalLayers-0cb49466.js","assets/layersLoader-dae6ab5f.js","assets/fetchService-c1a8c74f.js","assets/jsonContext-7b58d0bd.js"]).then(({populateOperationalLayers:o})=>{fi(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return fh(a)}).then(()=>{})}};function nnt(t){return t&&"createElevationSampler"in t}function cge(t){return t.type==="elevation"||nnt(t)}h([f({json:{read:!1}})],wg.prototype,"layers",null),h([Ct("layers")],wg.prototype,"writeLayers",null),h([f({readOnly:!0})],wg.prototype,"resourceInfo",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:ds,read:{reader:UD,source:"transparency"},write:{writer:(t,e)=>{e.transparency=MG(t)},target:"transparency"}}})],wg.prototype,"opacity",void 0),h([f({type:Boolean,nonNullable:!0,json:{read:!1}})],wg.prototype,"shading",void 0),h([f({type:$t,json:{type:[ds],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],wg.prototype,"surfaceColor",void 0),h([f({type:U7,json:{write:!0}})],wg.prototype,"navigationConstraint",void 0),wg=EK=h([Q("esri.Ground")],wg);const EB=wg;let eC=class extends ur{constructor(e){super(e),this.getCollections=null}initialize(){this.own(mRe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=M(this.getCollections)?this.getCollections():null;if(k(e))return void this.removeAll();let r=0;for(const i of e)M(i)&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new ur(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction?this.itemFilterFunction:n=>!!n;for(const n of r)if(n){if(i(n)){const s=this.indexOf(n,e);s>=0?s!==e&&this.reorder(n,e):this.add(n,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(n);if(Array.isArray(s))for(const o of s)e=this._processCollection(e,o);else e=this._processCollection(e,s)}}return e}};h([f()],eC.prototype,"getCollections",void 0),h([f()],eC.prototype,"getChildrenFunction",void 0),h([f()],eC.prototype,"itemFilterFunction",void 0),eC=h([Q("esri.core.CollectionFlattener")],eC);const BD=eC;function snt(t){var e,r;return!(!(t!=null&&t.loaded)||!((r=(e=NOe(t))==null?void 0:e.operations)!=null&&r.supportsEditing)||"editingEnabled"in t&&!iit(t))}const uge=we.getLogger("esri.support.basemapUtils");function ont(){return{}}function ant(t){for(const e in t){const r=t[e];(r==null?void 0:r.destroyed)===!1&&r.destroy(),delete t[e]}}function lnt(t,e){let r;if(typeof t=="string"){if(!(t in bK)){const i=Object.entries(bK).filter(([n,s])=>gn.apiKey&&!s.classic||!gn.apiKey&&s.classic&&!s.deprecated).map(([n])=>`"${n}"`).join(", ");return uge.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${i}`),null}e&&(r=e[t]),r||(r=bB.fromId(t),e&&(e[t]=r))}else r=Go(bB,t);return r!=null&&r.destroyed&&(uge.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function cnt(t){return new BD({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}const hge={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function unt(t){let e=null;if(typeof t=="string")if(t in hge){const r=hge[t];e=new EB({resourceInfo:{data:{layers:[r]}}})}else we.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Go(EB,t);return e}function jR(t,e,r=!1){let{hasM:i,hasZ:n}=t;Array.isArray(e)?e.length!==4||i||n?e.length===3&&r&&!i?(n=!0,i=!1):e.length===3&&i&&n&&(i=!1,n=!1):(i=!0,n=!0):(n=!n&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!n||e.hasZ)),t.hasZ=n,t.hasM=i}var CK;function dge(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function hnt(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let $v=CK=class extends K2{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):hnt(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new an,r=this.hasZ,i=this.hasM,n=r?3:2,s=t[0],o=dge(Math.min),a=dge(Math.max);let l,c,u,d,[p,A]=s,[v,b]=s;for(let S=0,E=t.length;S<E;S++){const R=t[S],[O,I]=R;if(p=o(p,O),A=o(A,I),v=a(v,O),b=a(b,I),r&&R.length>2){const N=R[2];l=o(l,N),u=a(u,N)}if(i&&R.length>n){const N=R[n];c=o(c,N),d=a(d,N)}}return e.xmin=p,e.ymin=A,e.xmax=v,e.ymax=b,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=Te(this.points)}addPoint(t){return jR(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:Te(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new CK(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new Ht(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Ht(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(jR(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};h([f({readOnly:!0})],$v.prototype,"cache",null),h([f()],$v.prototype,"extent",null),h([f({type:[[Number]],json:{write:{isRequired:!0}}})],$v.prototype,"points",void 0),h([Ct("points")],$v.prototype,"writePoints",null),$v=CK=h([Q("esri.geometry.Multipoint")],$v),$v.prototype.toJSON.isDefaultToJSON=!0;const CN=$v;function Fle(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}return Math.sqrt(r*r+i*i)}function iPe(t,e,r){const i=t[0]+r*(e[0]-t[0]),n=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,n,t[2]+r*(e[2]-t[2])]:[i,n]}function rsr(t,e,r,i){const[n,s]=e,[o,a]=r[i],[l,c]=r[i+1],u=l-o,d=c-a,p=u*u+d*d,A=(n-o)*u+(s-a)*d,v=Math.min(1,Math.max(0,A/p));return t[0]=o+u*v,t[1]=a+d*v,t}function isr(t,e,r){const i=r.rings;let n,s,o=!1,a=1/0;for(let l=0;l<i.length;l++){const c=i[l];for(let u=0,d=c.length-1;u<c.length;d=u++)n=c[u],s=c[d],n[1]>e!=s[1]>e&&t<(s[0]-n[0])*(e-n[1])/(s[1]-n[1])+n[0]&&(o=!o),a=Math.min(a,dnt(t,e,n,s))}return a===0?0:(o?1:-1)*Math.sqrt(a)}function dnt(t,e,r,i){let n=r[0],s=r[1],o=i[0]-n,a=i[1]-s;if(o!==0||a!==0){const l=((t-n)*o+(e-s)*a)/(o*o+a*a);l>1?(n=i[0],s=i[1]):l>0&&(n+=o*l,s+=a*l)}return o=t-n,a=e-s,o*o+a*a}function pnt(t,e){return iPe(t,e,.5)}function nPe(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=Fle(t[i],t[i+1]);return r}function sPe(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let n=0;n<r-1;++n){const s=Fle(t[n],t[n+1]);if(e-i<s){const o=(e-i)/s;return iPe(t[n],t[n+1],o)}i+=s}return t[r-1]}function oPe(t,e,r){const i=t.length;let n=0,s=0,o=0;for(let a=0;a<i;a++){const l=t[a],c=t[(a+1)%i];let u=2;n+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(s+=l[0]*c[2]-c[0]*l[2],u=3),l.length>u&&c.length>u&&e&&(o+=l[0]*c[u]-c[0]*l[u])}return n<=0&&s<=0&&o<=0}function fnt(t){const e=t.length;return e>2&&J_(t[0],t[e-1])}function nsr(t){if("rings"in t)for(const e of t.rings)fnt(e)||e.push(e[0].slice())}function aPe(t){if(!t||t.length<3)return 0;let e=0;const r=t.length-1;for(let i=0;i<r;i++)e+=(t[i][0]-t[i+1][0])*(t[i][1]+t[i+1][1]);return e+=(t[r][0]-t[0][0])*(t[r][1]+t[0][1]),-.5*e}function ssr(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function mnt(t){return t?kle(t.rings,t.hasZ??!1):null}function kle(t,e){if(!t||!t.length)return null;const r=[],i=[],n=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,o=t.length;s<o;s++){const a=gnt(t[s],e,n);a&&i.push(a)}if(i.sort((s,o)=>{let a=s[2]-o[2];return a===0&&e&&(a=s[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){const s=t[0]&&t[0].length?Ant(t[0],e):null;if(!s)return null;r[0]=s[0],r[1]=s[1],e&&s.length>2&&(r[2]=s[2])}return r}function gnt(t,e,r){let i=0,n=0,s=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let p=0;p<t.length;p++){const A=t[p],v=t[(p+1)%t.length],[b,S,E]=A,R=b-l,O=S-c,[I,N,L]=v,B=I-l,U=N-c,q=R*U-B*O;if(o+=q,i+=(R+B)*q,n+=(O+U)*q,e&&A.length>2&&v.length>2){const Z=E-u,X=L-u,ee=R*X-B*Z;s+=(Z+X)*ee,a+=ee}b<r[0]&&(r[0]=b),b>r[1]&&(r[1]=b),S<r[2]&&(r[2]=S),S>r[3]&&(r[3]=S),e&&(E<r[4]&&(r[4]=E),E>r[5]&&(r[5]=E))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[i/(6*o)+l,n/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(d[3]=(r[4]+r[5])/2,d[4]=0):(d[3]=s/(6*a)+u,d[4]=a)),d}function Ant(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],d=t[l+1];if(u&&d){r[0]=u[0],r[1]=u[1],i[0]=d[0],i[1]=d[1],e&&u.length>2&&d.length>2&&(r[2]=u[2],i[2]=d[2]);const p=Fle(r,i);if(p){n+=p;const A=pnt(u,d);s+=p*A[0],o+=p*A[1],e&&A.length>2&&(a+=p*A[2])}}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.length?t[0]:null}const ynt=1e-6;function osr(t){if(!t||!t.rings)return null;const{rings:e}=t;let r=0;for(let s=0;s<e.length;s++)r+=aPe(e[s]);if(r<ynt)return kle(e,!1);const i=[0,0],n=e[0][0];for(let s=0;s<e.length;s++)vnt(i,n,e[s]);return i[0]*=1/r,i[1]*=1/r,i[0]+=n[0],i[1]+=n[1],i}const _nt=1/3;function vnt(t,e,r){if(!t||!r||r.length<3)return null;const i=r[0],n=[0,0],s=[r[1][0]-i[0],r[1][1]-i[1]];let o;for(let c=2;c<r.length;c++)n[0]=r[c][0]-i[0],n[1]=r[c][1]-i[1],o=.5*_nt*(n[0]*s[1]-n[1]*s[0]),t[0]+=o*(s[0]+n[0]),t[1]+=o*(s[1]+n[1]),s[0]=n[0],s[1]=n[1];const a=aPe(r),l=[i[0],i[1]];return l[0]-=e[0],l[1]-=e[1],l[0]*=a,l[1]*=a,t[0]+=l[0],t[1]+=l[1],t}function lPe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function cPe(t){return t.points!==void 0}function uPe(t){return t.x!==void 0&&t.y!==void 0}function hPe(t){return t.paths!==void 0}function dPe(t){return t.rings!==void 0}function pPe(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const Ub=pPe(Math.min),Bb=pPe(Math.max);function asr(t,e){return hPe(e)?HR(t,e.paths,!1,!1):dPe(e)?HR(t,e.rings,!1,!1):cPe(e)?Ule(t,e.points,!1,!1,!1,!1):lPe(e)?fPe(t,e):(uPe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function lsr(t,e){return hPe(e)?HR(t,e.paths,!0,!1):dPe(e)?HR(t,e.rings,!0,!1):cPe(e)?Ule(t,e.points,!0,!1,!0,!1):lPe(e)?fPe(t,e,!0,!1,!0,!1):(uPe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function HR(t,e,r,i){const n=r?3:2;if(!e.length||!e[0].length)return null;let s,o,a,l,[c,u]=e[0][0],[d,p]=e[0][0];for(let A=0;A<e.length;A++){const v=e[A];for(let b=0;b<v.length;b++){const S=v[b],[E,R]=S;if(c=Ub(c,E),u=Ub(u,R),d=Bb(d,E),p=Bb(p,R),r&&S.length>2){const O=S[2];s=Ub(s,O),o=Bb(o,O)}if(i&&S.length>n){const O=S[n];a=Ub(s,O),l=Bb(o,O)}}}return r?i?(t[0]=c,t[1]=u,t[2]=s,t[3]=a,t[4]=d,t[5]=p,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=s,t[3]=d,t[4]=p,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=u,t[2]=a,t[3]=d,t[4]=p,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=d,t[3]=p,t.length=4,t)}function fPe(t,e,r,i,n,s){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,d=e.zmax,p=e.mmin,A=e.mmax;return n?(u=u||0,d=d||0,s?(p=p||0,A=A||0,t[0]=o,t[1]=l,t[2]=u,t[3]=p,t[4]=a,t[5]=c,t[6]=d,t[7]=A,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=d,t)):s?(p=p||0,A=A||0,t[0]=o,t[1]=l,t[2]=p,t[3]=a,t[4]=c,t[5]=A,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function Ule(t,e,r,i,n,s){const o=r?3:2,a=i&&s,l=r&&n;if(!e.length||!e[0].length)return null;let c,u,d,p,[A,v]=e[0],[b,S]=e[0];for(let E=0;E<e.length;E++){const R=e[E],[O,I]=R;if(A=Ub(A,O),v=Ub(v,I),b=Bb(b,O),S=Bb(S,I),l&&R.length>2){const N=R[2];c=Ub(c,N),u=Bb(u,N)}if(a&&R.length>o){const N=R[o];d=Ub(c,N),p=Bb(u,N)}}return n?(c=c||0,u=u||0,s?(d=d||0,p=p||0,t[0]=A,t[1]=v,t[2]=c,t[3]=d,t[4]=b,t[5]=S,t[6]=u,t[7]=p,t):(t[0]=A,t[1]=v,t[2]=c,t[3]=b,t[4]=S,t[5]=u,t)):s?(d=d||0,p=p||0,t[0]=A,t[1]=v,t[2]=d,t[3]=b,t[4]=S,t[5]=p,t):(t[0]=A,t[1]=v,t[2]=b,t[3]=S,t)}function bnt(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function wnt(t){return t.points!==void 0}function xnt(t){return t.x!==void 0&&t.y!==void 0}function Tnt(t){return t.paths!==void 0}function Snt(t){return t.rings!==void 0}const Ble=[];function mPe(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function gPe(t,e,r,i,n,s){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:n,zmax:s}}function APe(t,e,r,i,n,s){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:n,mmax:s}}function yPe(t,e,r,i,n,s,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:n,ymax:s,zmax:o,mmax:a}}function zle(t,e=!1,r=!1){return e?r?yPe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):gPe(t[0],t[1],t[2],t[3],t[4],t[5]):r?APe(t[0],t[1],t[2],t[3],t[4],t[5]):mPe(t[0],t[1],t[2],t[3])}function csr(t){return t?bnt(t)?t:xnt(t)?Cnt(t):Snt(t)?_Pe(t):Tnt(t)?vPe(t):wnt(t)?Ent(t):null:null}function Ent(t){const{hasZ:e,hasM:r,points:i}=t;return zle(Ule(Ble,i,e??!1,r??!1),e,r)}function Cnt(t){const{x:e,y:r,z:i,m:n}=t,s=n!=null;return i!=null?s?yPe(e,r,i,n,e,r,i,n):gPe(e,r,i,e,r,i):s?APe(e,r,n,e,r,n):mPe(e,r,e,r)}function _Pe(t){const{hasZ:e,hasM:r,rings:i}=t,n=HR(Ble,i,e??!1,r??!1);return n?zle(n,e,r):null}function vPe(t){const{hasZ:e,hasM:r,paths:i}=t,n=HR(Ble,i,e??!1,r??!1);return n?zle(n,e,r):null}var B7;function pge(t){return!Array.isArray(t[0])}let xg=B7=class extends K2{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,n=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(n=!0);const s={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(s.hasZ=!0),n&&(s.hasM=!0),new B7(s)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let r,i,n=null,s=null;return t&&!Array.isArray(t)?(n=t.rings?t.rings:null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):n=t,n=n||[],e=e||St.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=s.length>3):r===void 0?r=i?s.length>3:s.length>2:i===void 0&&(i=r?s.length>3:s.length>2)),{rings:n,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=mnt(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new Ht;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=_Pe(this);if(!e)return null;const r=new an(e);return r.spatialReference=t,r}get isSelfIntersecting(){return $rt(this.rings)}writeRings(t,e){e.rings=Te(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(pge(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=t[n].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new B7;return t.spatialReference=this.spatialReference,t.rings=Te(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(k(t))return!1;const e=this.spatialReference,r=t.spatialReference;if(M(e)!==M(r)||M(e)&&M(r)&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([n,s,o,a],[l,c,u,d])=>n===l&&s===c&&(o==null&&u==null||o===u)&&(a==null&&d==null||a===d);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],o=t.rings[n];if(!J_(s,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=ew(t,this.spatialReference);return xrt(this,M(e)?e:t)}isClockwise(t){let e;return e=pge(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,oPe(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,n=this.hasM;return i&&!n?new Ht(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new Ht(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new Ht(r[0],r[1],r[2],r[3],this.spatialReference):new Ht(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(jR(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new Ht(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(n=>new Ht(n,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(jR(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],xg.prototype,"cache",null),h([f({readOnly:!0})],xg.prototype,"centroid",null),h([f({readOnly:!0})],xg.prototype,"extent",null),h([f({readOnly:!0})],xg.prototype,"isSelfIntersecting",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],xg.prototype,"rings",void 0),h([Ct("rings")],xg.prototype,"writeRings",null),xg=B7=h([Q("esri.geometry.Polygon")],xg),xg.prototype.toJSON.isDefaultToJSON=!0;const Hf=xg;var MK;function Mnt(t){return!Array.isArray(t[0])}let Dv=MK=class extends K2{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let r,i,n=null,s=null;return t&&!Array.isArray(t)?(n=t.paths?t.paths:null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):n=t,n=n||[],e=e||St.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=!1):r===void 0?r=!i&&s.length>3:i===void 0&&(i=!r&&s.length>3)),{paths:n,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=vPe(this);if(!e)return null;const r=new an(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=Te(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(Mnt(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=t[n].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new MK;return t.spatialReference=this.spatialReference,t.paths=Te(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,n=this.hasM;return i&&!n?new Ht(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new Ht(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new Ht(r[0],r[1],r[2],r[3],this.spatialReference):new Ht(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(jR(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(n=>new Ht(n,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new Ht(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(jR(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],Dv.prototype,"cache",null),h([f({readOnly:!0})],Dv.prototype,"extent",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],Dv.prototype,"paths",void 0),h([Ct("paths")],Dv.prototype,"writePaths",null),Dv=MK=h([Q("esri.geometry.Polyline")],Dv),Dv.prototype.toJSON.isDefaultToJSON=!0;const cm=Dv,bPe=$c()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),fge=$c()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function wPe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Vle(t){return t.points!==void 0}function Gle(t){return t.x!==void 0&&t.y!==void 0}function jle(t){return t.paths!==void 0}function YT(t){return t.rings!==void 0}function r1(t){return k(t)?null:t instanceof K2?t:Gle(t)?Ht.fromJSON(t):jle(t)?cm.fromJSON(t):YT(t)?Hf.fromJSON(t):Vle(t)?CN.fromJSON(t):wPe(t)?an.fromJSON(t):null}function XO(t){return t?Gle(t)?"esriGeometryPoint":jle(t)?"esriGeometryPolyline":YT(t)?"esriGeometryPolygon":wPe(t)?"esriGeometryEnvelope":Vle(t)?"esriGeometryMultipoint":null:null}const Rnt={esriGeometryPoint:Ht,esriGeometryPolyline:cm,esriGeometryPolygon:Hf,esriGeometryEnvelope:an,esriGeometryMultipoint:CN};function Ont(t){return t&&Rnt[t]||null}const fE={base:K2,key:"type",typeMap:{extent:an,multipoint:CN,point:Ht,polyline:cm,polygon:Hf}};Om(fE);let xPe=0;const MN=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+xPe++})}};return e=h([Q("esri.core.Identifiable")],e),e},usr=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:xPe++})}};return e=h([Q("esri.core.NumericIdentifiable")],e),e};let mge=class extends MN(class{}){};mge=h([Q("esri.core.Identifiable")],mge);async function Pnt(t){const e="portalItem"in t?t:{portalItem:t},r=await be(()=>import("./portalLayers-0cb49466.js"),["assets/portalLayers-0cb49466.js","assets/lazyLayerLoader-765d674b.js","assets/layersLoader-dae6ab5f.js","assets/fetchService-c1a8c74f.js","assets/jsonContext-7b58d0bd.js"]);try{return await r.fromItem(e)}catch(i){const n=e&&e.portalItem,s=n&&n.id||"unset",o=n&&n.portal&&n.portal.url||gn.portalUrl;throw we.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+s+"')",i),i}}let Int=0,cl=class extends Ws.EventedMixin(MN(e1)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new an(-180,-90,180,90,St.WGS84),this.id=Date.now().toString(16)+"-layer-"+Int++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=St.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await be(()=>import("./arcgisLayers-e5d211b2.js"),["assets/arcgisLayers-e5d211b2.js","assets/fetchService-c1a8c74f.js","assets/lazyLayerLoader-765d674b.js"])).fromUrl(r)}static fromPortalItem(e){return Pnt(e)}initialize(){this.when().catch(e=>{$o(e)||we.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,r=this.parent;"layers"in r&&r.layers.includes(e)?r.layers.remove(e):"tables"in r&&r.tables.includes(e)?r.tables.remove(e):"baseLayers"in r&&r.baseLayers.includes(e)?r.baseLayers.remove(e):"baseLayers"in r&&r.referenceLayers.includes(e)&&r.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Su(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await ns(e,{query:{f:"json"},responseType:"json"})).data;throw new pe("layer:no-attribution-data","Layer does not have attribution data")}};h([f({type:String})],cl.prototype,"attributionDataUrl",void 0),h([f({type:an})],cl.prototype,"fullExtent",void 0),h([f({readOnly:!0})],cl.prototype,"hasAttributionData",null),h([f({type:String,clonable:!1})],cl.prototype,"id",void 0),h([f({type:Boolean,nonNullable:!0})],cl.prototype,"legendEnabled",void 0),h([f({type:["show","hide","hide-children"]})],cl.prototype,"listMode",void 0),h([f({type:Number,range:{min:0,max:1},nonNullable:!0})],cl.prototype,"opacity",void 0),h([f({clonable:!1})],cl.prototype,"parent",void 0),h([f({readOnly:!0})],cl.prototype,"parsedUrl",null),h([f({type:Boolean})],cl.prototype,"popupEnabled",void 0),h([f({type:Boolean})],cl.prototype,"attributionVisible",void 0),h([f({type:St})],cl.prototype,"spatialReference",void 0),h([f({type:String})],cl.prototype,"title",void 0),h([f({readOnly:!0,json:{read:!1}})],cl.prototype,"type",void 0),h([f()],cl.prototype,"url",void 0),h([f({type:Boolean,nonNullable:!0})],cl.prototype,"visible",void 0),cl=h([Q("esri.layers.Layer")],cl);const zD=cl;function RK(t,e,r){let i,n;if(t)for(let s=0,o=t.length;s<o;s++){if(i=t.getItemAt(s),i[e]===r)return i;if((i==null?void 0:i.type)==="group"&&(n=RK(i.layers,e,r),n))return n}}const $nt=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new ur;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||we.getLogger(this.declaredClass).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},s=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>s(o.item))}destroy(){const r=this.layers.removeAll();for(const i of r)this.layerRemoved(i),i.destroy();this.layers.destroy()}set layers(r){this._set("layers",vS(r,this._get("layers")))}add(r,i){const n=this.layers;if(i=n.getNextIndex(i),r instanceof zD){const s=r;s.parent===this?this.reorder(s,i):n.add(s,i)}else Op(r)?r.then(s=>{this.destroyed||this.add(s,i)}):we.getLogger(this.declaredClass).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const n=this.layers;let s=n.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(n.add(o,s),s+=1):this.reorder(o,s)})}findLayerById(r){return RK(this.layers,"id",r)}findLayerByUid(r){return RK(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return h([f()],e.prototype,"layers",null),e=h([Q("esri.support.LayersMixin")],e),e};function OK(t,e,r){if(t)for(let i=0,n=t.length;i<n;i++){const s=t.getItemAt(i);if(s[e]===r)return s;if((s==null?void 0:s.type)==="group"){const o=OK(s.tables,e,r);if(o)return o}}}const Dnt=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new ur,this.tables.on("after-add",i=>{const n=i.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&we.getLogger(this.declaredClass).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",vS(r,this._get("tables")))}findTableById(r){return OK(this.tables,"id",r)}findTableByUid(r){return OK(this.tables,"uid",r)}};return h([f()],e.prototype,"tables",null),e=h([Q("esri.support.TablesMixin")],e),e};let Tg=class extends Dnt($nt(Ws.EventedMixin(rt))){constructor(e){super(e),this.allLayers=new BD({getCollections:()=>{var r,i,n;return[(r=this.basemap)==null?void 0:r.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(n=this.basemap)==null?void 0:n.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=cnt(this),this.basemap=null,this.editableLayers=new BD({getCollections:()=>[this.allLayers],itemFilterFunction:snt}),this.ground=new EB,this._basemapCache=ont()}destroy(){var e,r;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(r=this.basemap)==null||r.destroy(),ant(this._basemapCache),this._basemapCache=null}castBasemap(e){return lnt(e,this._basemapCache)}castGround(e){const r=unt(e);return k(r)?this._get("ground"):r}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};h([f({readOnly:!0,dependsOn:[]})],Tg.prototype,"allLayers",void 0),h([f({readOnly:!0})],Tg.prototype,"allTables",void 0),h([f({type:bB})],Tg.prototype,"basemap",void 0),h([Wr("basemap")],Tg.prototype,"castBasemap",null),h([f({readOnly:!0})],Tg.prototype,"editableLayers",void 0),h([f({type:EB,nonNullable:!0})],Tg.prototype,"ground",void 0),h([Wr("ground")],Tg.prototype,"castGround",null),Tg=h([Q("esri.Map")],Tg);const TPe=Tg,Qs=t=>{let e=class extends t{clone(){var l;const r=nh(bu(this),"unable to clone instance of non-accessor class"),i=r.metadatas,n=r.store,s={},o=new Map;for(const c in i){const u=i[c],d=n==null?void 0:n.originOf(c),p=u.clonable;if(u.readOnly||p===!1||d!==Zi.USER&&d!==Zi.DEFAULTS&&d!==Zi.WEB_MAP&&d!==Zi.WEB_SCENE)continue;const A=this[c];let v=null;v=typeof p=="function"?p(A):p==="reference"?A:GJ(A),A!=null&&v==null||(d===Zi.DEFAULTS?o.set(c,v):s[c]=v)}const a=new(Object.getPrototypeOf(this)).constructor(s);if(o.size){const c=(l=bu(a))==null?void 0:l.store;if(c)for(const[u,d]of o)c.set(u,d,Zi.DEFAULTS)}return a}};return e=h([Q("esri.core.Clonable")],e),e};let gge=class extends Qs(rt){};gge=h([Q("esri.core.Clonable")],gge);let E2=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,n=0,s=!1){return(i-=n)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),s&&i===r&&(i=e),i+n}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return He(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,n=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(n)?i:n}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function Hle(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const Lnt=Hle(new E2(0,2*Math.PI)),C2=Hle(new E2(-Math.PI,Math.PI)),qle=Hle(new E2(0,360));let ky=class extends Qs(Je){constructor(...e){super(...e),this.position=new Ht([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,r,i,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return r!=null&&(s.heading=r),i!=null&&(s.tilt=i),n!=null&&(s.fov=n),s}return e}writePosition(e,r,i,n){const s=e.clone();s.x=yf(e.x||0),s.y=yf(e.y||0),s.z=e.hasZ?yf(e.z||0):e.z,r[i]=s.write({},n)}readPosition(e,r){const i=new Ht;return i.read(e,r),i.x=yf(i.x||0),i.y=yf(i.y||0),i.z=i.hasZ?yf(i.z||0):i.z,i}equals(e){return!k(e)&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};h([f({type:Ht,json:{write:{isRequired:!0}}})],ky.prototype,"position",void 0),h([Ct("position")],ky.prototype,"writePosition",null),h([gt("position")],ky.prototype,"readPosition",null),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Wr(t=>qle.normalize(yf(t)))],ky.prototype,"heading",void 0),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Wr(t=>He(yf(t),-180,180))],ky.prototype,"tilt",void 0),h([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],ky.prototype,"fov",void 0),ky=h([Q("esri.Camera")],ky);const qf=ky;var qR;function Nnt(t,e){switch(t.type){case"range":{const r="range"in t?t.range[0]:t.minValue,i="range"in t?t.range[1]:t.maxValue;if(r!=null&&+e<r||i!=null&&+e>i)return qR.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==e))return qR.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(qR||(qR={}));const Fnt=we.getLogger("esri.support.arcadeOnDemand");let gW;function DA(){return gW||(gW=(async()=>{const t=await be(()=>import("./arcadeUtils-12b7d488.js").then(e=>e.ax),["assets/arcadeUtils-12b7d488.js","assets/arcadeTimeUtils-80a905aa.js","assets/executionError-fb3f283a.js","assets/hash-0ddfbf4b.js"]);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),gW}const knt=(t,e,r)=>Wle.create(t,e,r,null,["$feature"]),Unt=(t,e,r)=>Wle.create(t,e,r,null,["$feature","$view"]),Bnt=(t,e,r,i)=>Wle.create(t,e,r,i,["$feature","$view"]);let Wle=class SPe{constructor(e,r,i,n,s,o,a){this.script=e,this.evaluate=n;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=s,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,n,s,o){const{arcade:a,Feature:l,Dictionary:c}=await DA(),u=St.fromJSON(r);let d;try{d=a.parseScript(e,o)}catch(U){return Fnt.error(new pe("arcade-bad-expression","Failed to parse arcade script",{script:e,error:U})),null}const p=s.reduce((U,q)=>({...U,[q]:null}),{});let A=null;M(n)&&(A=new c(n),A.immutable=!0,p.$config=null);const v=a.scriptUsesGeometryEngine(d),b=v&&a.enableGeometrySupport(),S=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),E=a.scriptIsAsync(d),R=E&&a.enableAsyncSupport(),O={vars:p,spatialReference:u,useAsync:!!R};await Promise.all([b,S,R]);const I=new Set;await a.loadDependentModules(I,d,null,E,v);const N=new c;N.immutable=!1,N.setField("scale",0);const L=a.compileScript(d,O),B=U=>("$view"in U&&U.$view&&(N.setField("scale",typeof U.$view=="object"?U.$view.scale:void 0),U.$view=N),A&&(U.$config=A),L({vars:U,spatialReference:u}));return new SPe(e,a,d,B,new l,i,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const znt=/^([0-9])/,Vnt=/[^a-z0-9_\u0080-\uffff]/gi,Gnt=/_{2,}/g,jnt=/^_/,Hnt=/_$/;function qnt(t){return t==null?null:t.trim().replace(Vnt,"_").replace(Gnt,"_").replace(jnt,"").replace(Hnt,"").replace(znt,"F$1")||null}const Wnt=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],Qnt=["field","normalizationField"];function Age(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(yge(Wnt,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)yge(Qnt,i,e)}}function yge(t,e,r){if(t)for(const i of t){const n=_N(i,e),s=n&&typeof n!="function"&&r.get(n);s&&wu(i,s.name,e)}}function EPe(t,e){var r;if(t!=null&&((r=e==null?void 0:e.fields)!=null&&r.length))if("startField"in t){const i=e.get(t.startField),n=e.get(t.endField);t.startField=(i==null?void 0:i.name)??null,t.endField=(n==null?void 0:n.name)??null}else{const i=e.get(t.startTimeField),n=e.get(t.endTimeField);t.startTimeField=(i==null?void 0:i.name)??null,t.endTimeField=(n==null?void 0:n.name)??null}}const AW=new Set;function CPe(t,e){return t&&e?(AW.clear(),VD(AW,t,e),Array.from(AW).sort()):[]}function VD(t,e,r){var i;if(r)if((i=e==null?void 0:e.fields)!=null&&i.length)if(r.includes("*"))for(const{name:n}of e.fields)t.add(n);else for(const n of r)mp(t,e,n);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const n of r)n!=null&&t.add(n)}}function mp(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function Asr(t,e){return k(e)||k(t)?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function gh(t,e,r){var s;if(!r)return;const{arcadeUtils:i}=await DA(),n=i.extractFieldNames(r,(s=e==null?void 0:e.fields)==null?void 0:s.map(o=>o.name));for(const o of n)mp(t,e,o)}async function MPe(t,e,r){if(r&&r!=="1=1"){const i=(await be(()=>import("./WhereClause-3b5a65ae.js").then(n=>n.W),["assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js"])).WhereClause.create(r,e);if(!i.isStandardized)throw new pe("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});VD(t,e,i.fieldNames)}}function Ynt({displayField:t,fields:e}){return t||(e&&e.length?yW(e,"name-or-title")||yW(e,"unique-identifier")||yW(e,"type-or-category")||Xnt(e):null)}function Xnt(t){for(const e of t){if(!e||!e.name)continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function yW(t,e){for(const r of t)if(r&&r.valueType&&r.valueType===e)return r.name;return null}async function ysr(t,e){var i;if(!e)return;const r=(i=e.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function Znt(t,e,r){r.onStatisticExpression?gh(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function _sr(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],n=r.popupTemplate;i.push(Jnt(t,e,n)),r.fields&&i.push(...r.fields.map(async s=>Znt(t,e.fieldsIndex,s))),await Promise.all(i)}async function Jnt(t,e,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(s=>gh(t,e.fieldsIndex,s.expression)));const n=r==null?void 0:r.content;if(Array.isArray(n))for(const s of n)s.type==="expression"&&s.expressionInfo&&i.push(gh(t,e.fieldsIndex,s.expressionInfo.expression));await Promise.all(i)}async function vsr(t,e,r){e&&(e.timeInfo&&M(r)&&r.timeExtent&&VD(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&VD(t,e.fieldsIndex,[e.floorInfo.floorField]),M(r)&&M(r.where)&&await MPe(t,e.fieldsIndex,r.where))}async function bsr(t,e,r){e&&r&&await Promise.all(r.map(i=>Knt(t,e,i)))}async function Knt(t,e,r){e&&r&&(r.valueExpression?await gh(t,e.fieldsIndex,r.valueExpression):r.field&&mp(t,e.fieldsIndex,r.field))}function wsr(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;return e?CPe(t.fieldsIndex,[e&&e.creatorField,e&&e.creationDateField,e&&e.editorField,e&&e.editDateField]):[]}async function xsr(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r&&r.length&&await Promise.all(r.map(n=>est(t,i,n)))}async function est(t,e,r){if(!r)return;const i=r.getLabelExpression(),n=r.where;if(i.type==="arcade")await gh(t,e,i.expression);else{const s=i.expression.match(/{[^}]*}/g);s&&s.forEach(o=>{mp(t,e,o.slice(1,-1))})}await MPe(t,e,n)}function tst(t){const e=t.defaultValue;return e!==void 0&&PPe(t,e)?e:t.nullable?null:void 0}function RPe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function rst(t){return t===null||RPe(t)}const Qle="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function ist(t){return t===null||Qle(t)}function OPe(t){return t!=null&&typeof t=="string"}function nst(t){return t===null||OPe(t)}function sst(){return!0}function PPe(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=t.nullable?ist:Qle;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?rst:RPe;break;case"string":case"esriFieldTypeString":r=t.nullable?nst:OPe;break;default:r=sst}return arguments.length===1?r:r(e)}const ost=["integer","small-integer","single","double"],ast=new Set([...ost,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function RG(t){return t!=null&&ast.has(t.type)}function Tsr(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}var CB,MB;function Ssr(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function Esr(t,e){return t==null||t.nullable&&e===null?null:RG(t)&&!lst(t.type,Number(e))?CB.OUT_OF_RANGE:PPe(t,e)?t.domain?Nnt(t.domain,e):null:MB.INVALID_TYPE}function lst(t,e){const r=typeof t=="string"?IPe(t):t;if(!r)return!1;const i=r.min,n=r.max;return r.isInteger?Qle(e)&&e>=i&&e<=n:e>=i&&e<=n}function IPe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return cst;case"esriFieldTypeInteger":case"integer":return ust;case"esriFieldTypeSingle":case"single":return hst;case"esriFieldTypeDouble":case"double":return dst}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(CB||(CB={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(MB||(MB={}));const cst={min:-32768,max:32767,isInteger:!0},ust={min:-2147483648,max:2147483647,isInteger:!0},hst={min:-34e37,max:12e37,isInteger:!1},dst={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function Csr(t,e,r){switch(t){case qR.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case qR.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case MB.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case CB.OUT_OF_RANGE:{const{min:i,max:n}=IPe(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${n}`}}}function pst(t,e){return!fst(t,e,null)}function fst(t,e,r){if(!e||!e.attributes||!t){if(M(r))for(const s of t??[])r.add(s);return!0}const i=e.attributes;let n=!1;for(const s of t)if(!(s in i)){if(n=!0,!M(r))break;r.add(s)}return n}function $Pe(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let z7=class extends Je{constructor(e){super(e),this.type=null}};h([f({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],z7.prototype,"type",void 0),z7=h([Q("esri.popup.content.Content")],z7);const tw=z7;var PK;let px=PK=class extends tw{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new PK({description:this.description,displayType:this.displayType,title:this.title})}};h([f({type:String,json:{write:!0}})],px.prototype,"description",void 0),h([f({type:["auto","preview","list"],json:{write:!0}})],px.prototype,"displayType",void 0),h([f({type:String,json:{write:!0}})],px.prototype,"title",void 0),h([f({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],px.prototype,"type",void 0),px=PK=h([Q("esri.popup.content.AttachmentsContent")],px);const GD=px;var IK;let fx=IK=class extends tw{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new IK({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?Te(this.outFields):null})}};h([f()],fx.prototype,"creator",void 0),h([f()],fx.prototype,"destroyer",void 0),h([f()],fx.prototype,"outFields",void 0),h([f({type:["custom"],readOnly:!0})],fx.prototype,"type",void 0),fx=IK=h([Q("esri.popup.content.CustomContent")],fx);const mst=fx;var $K;let tC=$K=class extends Je{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new $K({title:this.title,expression:this.expression})}};h([f({type:String,json:{write:!0}})],tC.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],tC.prototype,"expression",void 0),h([f({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],tC.prototype,"returnType",void 0),tC=$K=h([Q("esri.popup.ElementExpressionInfo")],tC);const DPe=tC;var DK;let C$=DK=class extends tw{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new DK({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};h([f({type:DPe,json:{write:!0}})],C$.prototype,"expressionInfo",void 0),h([f({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],C$.prototype,"type",void 0),C$=DK=h([Q("esri.popup.content.ExpressionContent")],C$);const Yle=C$,jD=$c()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});jD.toJSON.bind(jD);jD.fromJSON.bind(jD);const tg={year:"numeric",month:"numeric",day:"numeric"},iI={year:"numeric",month:"long",day:"numeric"},nI={year:"numeric",month:"short",day:"numeric"},sI={year:"numeric",month:"long",weekday:"long",day:"numeric"},Zp={hour:"numeric",minute:"numeric"},u0={...Zp,second:"numeric"},Xle={"short-date":tg,"short-date-short-time":{...tg,...Zp},"short-date-short-time-24":{...tg,...Zp,hour12:!1},"short-date-long-time":{...tg,...u0},"short-date-long-time-24":{...tg,...u0,hour12:!1},"short-date-le":tg,"short-date-le-short-time":{...tg,...Zp},"short-date-le-short-time-24":{...tg,...Zp,hour12:!1},"short-date-le-long-time":{...tg,...u0},"short-date-le-long-time-24":{...tg,...u0,hour12:!1},"long-month-day-year":iI,"long-month-day-year-short-time":{...iI,...Zp},"long-month-day-year-short-time-24":{...iI,...Zp,hour12:!1},"long-month-day-year-long-time":{...iI,...u0},"long-month-day-year-long-time-24":{...iI,...u0,hour12:!1},"day-short-month-year":nI,"day-short-month-year-short-time":{...nI,...Zp},"day-short-month-year-short-time-24":{...nI,...Zp,hour12:!1},"day-short-month-year-long-time":{...nI,...u0},"day-short-month-year-long-time-24":{...nI,...u0,hour12:!1},"long-date":sI,"long-date-short-time":{...sI,...Zp},"long-date-short-time-24":{...sI,...Zp,hour12:!1},"long-date-long-time":{...sI,...u0},"long-date-long-time-24":{...sI,...u0,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Zp,"long-time":u0},HD=$c()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});HD.apiValues;HD.toJSON.bind(HD);HD.fromJSON.bind(HD);const gst={ar:"ar-u-nu-latn-ca-gregory"};let LK=new WeakMap,LPe=Xle["short-date-short-time"];function Ast(t){const e=t||LPe;let r=LK.get(e);if(!r){const i=yu(),n=gst[yu()]||i;r=new Intl.DateTimeFormat(n,e),LK.set(e,r)}return r}function OG(t){return t?Xle[t]:null}function LA(t,e){return Ast(e).format(t)}Tle(()=>{LK=new WeakMap,LPe=Xle["short-date-short-time"]});const yst={ar:"ar-u-nu-latn"};let V7=new WeakMap,NPe={};function _st(t){const e=t||NPe;if(!V7.has(e)){const r=yu(),i=yst[yu()]||r;V7.set(e,new Intl.NumberFormat(i,t))}return V7.get(e)}function FPe(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function NA(t,e){return t===-0&&(t=0),_st(e).format(t)}Tle(()=>{V7=new WeakMap,NPe={}});var NK;let mx=NK=class extends Je{constructor(t){super(t),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new NK({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(t){return this.dateFormat?LA(t,{...OG(this.dateFormat),...this.dateTimeFormatOptions}):NA(t,FPe(this))}formatRasterPixelValue(t){if(t.includes("-"))return t;let e,r;return t.trim().includes(",")?(e=",",r=e+" ",this._formatDelimitedString(t,e,r,this)):t.trim().includes(";")?(e=";",r=e+" ",this._formatDelimitedString(t,e,r,this)):t.trim().includes(" ")?(e=r=" ",this._formatDelimitedString(t,e,r,this)):this.format(Number(t))}_formatDelimitedString(t,e,r,i){return t&&e&&r&&i?t.trim().split(e).map(n=>this.format(Number(n))).join(r):t}};h([nr(jD)],mx.prototype,"dateFormat",void 0),h([f({type:Object,json:{read:!1}})],mx.prototype,"dateTimeFormatOptions",void 0),h([f({type:Boolean,json:{write:!0}})],mx.prototype,"digitSeparator",void 0),h([f({type:ds,json:{write:!0}})],mx.prototype,"places",void 0),mx=NK=h([Q("esri.popup.support.FieldInfoFormat")],mx);const gM=mx;var FK;let b0=FK=class extends Je{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new FK({fieldName:this.fieldName,format:this.format?Te(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};h([f({type:String,json:{write:!0}})],b0.prototype,"fieldName",void 0),h([f({type:gM,json:{write:!0}})],b0.prototype,"format",void 0),h([f({type:Boolean,json:{write:!0,default:!1}})],b0.prototype,"isEditable",void 0),h([f({type:String,json:{write:!0}})],b0.prototype,"label",void 0),h([nr(new Hi({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],b0.prototype,"stringFieldOption",void 0),h([f({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],b0.prototype,"statisticType",void 0),h([f({type:String,json:{write:!0}})],b0.prototype,"tooltip",void 0),h([f({type:Boolean,json:{write:!0}})],b0.prototype,"visible",void 0),b0=FK=h([Q("esri.popup.FieldInfo")],b0);const RN=b0;var kK;let Uy=kK=class extends tw{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new kK(Te({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};h([f({type:Object,json:{write:!0}})],Uy.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],Uy.prototype,"description",void 0),h([f({type:[RN]})],Uy.prototype,"fieldInfos",void 0),h([Ct("fieldInfos")],Uy.prototype,"writeFieldInfos",null),h([f({type:String,json:{write:!0}})],Uy.prototype,"title",void 0),h([f({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Uy.prototype,"type",void 0),Uy=kK=h([Q("esri.popup.content.FieldsContent")],Uy);const WR=Uy;let gx=class extends Je{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};h([f({type:String,json:{write:!0}})],gx.prototype,"altText",void 0),h([f({type:String,json:{write:!0}})],gx.prototype,"caption",void 0),h([f({type:String,json:{write:!0}})],gx.prototype,"title",void 0),h([f({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],gx.prototype,"type",void 0),gx=h([Q("esri.popup.content.mixins.MediaInfo")],gx);const Zle=gx;var UK;let rC=UK=class extends rt{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new UK({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};h([f()],rC.prototype,"fieldName",void 0),h([f()],rC.prototype,"tooltip",void 0),h([f()],rC.prototype,"value",void 0),rC=UK=h([Q("esri.popup.content.support.ChartMediaInfoValueSeries")],rC);const kPe=rC;var BK;let Ax=BK=class extends Je{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new BK({fields:Te(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};h([f({type:[String],json:{write:!0}})],Ax.prototype,"fields",void 0),h([f({type:String,json:{write:!0}})],Ax.prototype,"normalizeField",void 0),h([f({type:[kPe],json:{read:!1}})],Ax.prototype,"series",void 0),h([f({type:String,json:{write:!0}})],Ax.prototype,"tooltipField",void 0),Ax=BK=h([Q("esri.popup.content.support.ChartMediaInfoValue")],Ax);const vst=Ax;let M$=class extends Zle{constructor(e){super(e),this.type=null,this.value=null}};h([f({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],M$.prototype,"type",void 0),h([f({type:vst,json:{write:!0}})],M$.prototype,"value",void 0),M$=h([Q("esri.popup.content.mixins.ChartMediaInfo")],M$);const PG=M$,IG=$c()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var zK;let G7=zK=class extends PG{constructor(t){super(t),this.type="bar-chart"}clone(){return new zK({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:IG.write}})],G7.prototype,"type",void 0),G7=zK=h([Q("esri.popup.content.BarChartMediaInfo")],G7);const UPe=G7;var VK;let j7=VK=class extends PG{constructor(t){super(t),this.type="column-chart"}clone(){return new VK({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:IG.write}})],j7.prototype,"type",void 0),j7=VK=h([Q("esri.popup.content.ColumnChartMediaInfo")],j7);const BPe=j7;var GK;let R$=GK=class extends Je{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new GK({linkURL:this.linkURL,sourceURL:this.sourceURL})}};h([f({type:String,json:{write:!0}})],R$.prototype,"linkURL",void 0),h([f({type:String,json:{write:!0}})],R$.prototype,"sourceURL",void 0),R$=GK=h([Q("esri.popup.content.support.ImageMediaInfoValue")],R$);const bst=R$;var jK;let iC=jK=class extends Zle{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new jK({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};h([f({type:Number,json:{write:!0}})],iC.prototype,"refreshInterval",void 0),h([f({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],iC.prototype,"type",void 0),h([f({type:bst,json:{write:!0}})],iC.prototype,"value",void 0),iC=jK=h([Q("esri.popup.content.ImageMediaInfo")],iC);const zPe=iC;var HK;let H7=HK=class extends PG{constructor(t){super(t),this.type="line-chart"}clone(){return new HK({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:IG.write}})],H7.prototype,"type",void 0),H7=HK=h([Q("esri.popup.content.LineChartMediaInfo")],H7);const VPe=H7;var qK;let q7=qK=class extends PG{constructor(t){super(t),this.type="pie-chart"}clone(){return new qK({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:IG.write}})],q7.prototype,"type",void 0),q7=qK=h([Q("esri.popup.content.PieChartMediaInfo")],q7);const GPe=q7,jPe={base:Zle,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":UPe,"column-chart":BPe,"line-chart":VPe,"pie-chart":GPe,image:zPe}};var WK;let w0=WK=class extends tw{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?zPe.fromJSON(e):e.type==="barchart"?UPe.fromJSON(e):e.type==="columnchart"?BPe.fromJSON(e):e.type==="linechart"?VPe.fromJSON(e):e.type==="piechart"?GPe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new WK(Te({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};h([f()],w0.prototype,"activeMediaInfoIndex",void 0),h([f({type:Object,json:{write:!0}})],w0.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],w0.prototype,"description",void 0),h([f({types:[jPe]})],w0.prototype,"mediaInfos",void 0),h([gt("mediaInfos")],w0.prototype,"readMediaInfos",null),h([Ct("mediaInfos")],w0.prototype,"writeMediaInfos",null),h([f({type:String,json:{write:!0}})],w0.prototype,"title",void 0),h([f({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],w0.prototype,"type",void 0),w0=WK=h([Q("esri.popup.content.MediaContent")],w0);const qD=w0;var QK;let O$=QK=class extends Je{constructor(t){super(t),this.field=null,this.order=null}clone(){return new QK({field:this.field,order:this.order})}};h([f({type:String,json:{write:!0}})],O$.prototype,"field",void 0),h([f({type:["asc","desc"],json:{write:!0}})],O$.prototype,"order",void 0),O$=QK=h([Q("esri.popup.support.RelatedRecordsInfoFieldOrder")],O$);const Jle=O$;let Sg=class extends Qs(tw){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};h([f({type:String,json:{write:!0}})],Sg.prototype,"description",void 0),h([f({type:Number,json:{type:ds,write:!0}})],Sg.prototype,"displayCount",void 0),h([f({type:["list"],json:{write:!0}})],Sg.prototype,"displayType",void 0),h([f({type:[Jle],json:{write:!0}})],Sg.prototype,"orderByFields",void 0),h([f({type:Number,json:{type:ds,write:!0}})],Sg.prototype,"relationshipId",void 0),h([f({type:String,json:{write:!0}})],Sg.prototype,"title",void 0),h([f({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Sg.prototype,"type",void 0),Sg=h([Q("esri.popup.content.RelationshipContent")],Sg);const RB=Sg;var YK;let P$=YK=class extends tw{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new YK({text:this.text})}};h([f({type:String,json:{write:!0}})],P$.prototype,"text",void 0),h([f({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],P$.prototype,"type",void 0),P$=YK=h([Q("esri.popup.content.TextContent")],P$);const QR=P$,wst={base:null,key:"type",typeMap:{attachment:GD,media:qD,text:QR,expression:Yle,field:WR,relationship:RB}};var XK;let yx=XK=class extends Je{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new XK({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([f({type:String,json:{write:!0}})],yx.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],yx.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],yx.prototype,"expression",void 0),h([f({type:["string","number"],json:{write:!0}})],yx.prototype,"returnType",void 0),yx=XK=h([Q("esri.popup.ExpressionInfo")],yx);const HPe=yx;var ZK;let I$=ZK=class extends Je{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new ZK({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};h([f({type:Boolean,json:{write:!0}})],I$.prototype,"returnTopmostRaster",void 0),h([f({type:Boolean,json:{write:!0}})],I$.prototype,"showNoDataRecords",void 0),I$=ZK=h([Q("esri.popup.LayerOptions")],I$);const xst=I$;var JK;let $$=JK=class extends Je{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new JK({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?Te(this.orderByFields):null})}};h([f({type:Boolean,json:{write:!0}})],$$.prototype,"showRelatedRecords",void 0),h([f({type:[Jle],json:{write:!0}})],$$.prototype,"orderByFields",void 0),$$=JK=h([Q("esri.popup.RelatedRecordsInfo")],$$);const Tst=$$;var KK;let x0=KK=class extends MN(rt){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new KK({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};h([f()],x0.prototype,"active",void 0),h([f()],x0.prototype,"className",void 0),h([f()],x0.prototype,"disabled",void 0),h([f()],x0.prototype,"id",void 0),h([f()],x0.prototype,"indicator",void 0),h([f()],x0.prototype,"title",void 0),h([f()],x0.prototype,"type",void 0),h([f()],x0.prototype,"visible",void 0),x0=KK=h([Q("esri.support.actions.ActionBase")],x0);const $G=x0;var eee;let W7=eee=class extends $G{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new eee({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};h([f()],W7.prototype,"image",void 0),W7=eee=h([Q("esri.support.Action.ActionButton")],W7);const ZO=W7;var tee;let D$=tee=class extends $G{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new tee({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};h([f()],D$.prototype,"image",void 0),h([f()],D$.prototype,"value",void 0),D$=tee=h([Q("esri.support.Action.ActionToggle")],D$);const qPe=D$,Sst="esri.PopupTemplate",Est=we.getLogger(Sst),oI="relationships/",_ge="expression/",Cst=ur.ofType({key:"type",defaultKeyValue:"button",base:$G,typeMap:{button:ZO,toggle:qPe}}),Mst={base:tw,key:"type",typeMap:{media:qD,custom:mst,text:QR,attachments:GD,fields:WR,expression:Yle,relationship:RB}},Rst=["attachments","fields","media","text","expression","relationship"];let ul=class extends Qs(Je){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>Om(Mst,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Op(e)?e:(Est.error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,n){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(s=>Rst.includes(s.type)).map(s=>s&&s.toJSON(n)),r.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(r):s.type==="media"?this._writeMediaContent(s,r):s.type==="text"?this._writeTextContent(s,r):s.type==="relationship"&&this._writeRelationshipContent(s,r)})):r.description=e}writeFieldInfos(e,r,i,n){const{content:s}=this,o=Array.isArray(s)?s:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var u;return(u=c.fieldInfos)==null?void 0:u.length});r.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(n);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,n){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(n)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),VD(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=Te(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(n=>{const s=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===n.fieldName.toLowerCase());s?s.visible=!0:r.fieldInfos.push(n)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){var s,o;const i=((s=e.orderByFields)==null?void 0:s.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],n=[...((o=r.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...(n==null?void 0:n.length)&&{orderByFields:n}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=Te(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const n={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!r||n.mediaInfos||(s.mediaInfos=r,n.mediaInfos=!0),qD.fromJSON(s)):s.type==="text"?(s.text||!e||n.description||(s.text=e,n.description=!0),QR.fromJSON(s)):s.type==="attachments"?GD.fromJSON(s):s.type==="fields"?WR.fromJSON(s):s.type==="expression"?Yle.fromJSON(s):s.type==="relationship"?RB.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!(r!=null&&r.startsWith(oI)))return null;const n=r.replace(oI,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),o=n[1];return typeof s=="number"&&o?RB.fromJSON({relationshipId:s,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:n}=e;return{field:`${oI}${r}/${n}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];e?s.push(new QR({text:e})):s.push(new WR),Array.isArray(r)&&r.length&&s.push(qD.fromJSON({mediaInfos:r})),i&&s.push(GD.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=n;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&s.push(c)}),s.length?s:e}_getContentElementFields(e){const r=e==null?void 0:e.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:n}=e,s=n||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=s,d=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,n)=>[...i,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(n=>gh(e,r,n.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(oI)&&!r.startsWith(_ge)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:n}=e,s=n==="button"||n==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const n=/\{(\w+):.+\}/,s=i.filter(o=>!(o.indexOf(`{${oI}`)===0||o.indexOf(`{${_ge}`)===0)).map(o=>o.replace(n,"{$1}"));return s?s.map(o=>o.slice(1,-1)):[]}};h([f({type:Cst})],ul.prototype,"actions",void 0),h([f()],ul.prototype,"content",void 0),h([Wr("content")],ul.prototype,"castContent",null),h([gt("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],ul.prototype,"readContent",null),h([Ct("content",{popupElements:{type:ur.ofType(wst)},showAttachments:{type:Boolean},mediaInfos:{type:ur.ofType(jPe)},description:{type:String},relatedRecordsInfo:{type:Tst}})],ul.prototype,"writeContent",null),h([f({type:[HPe],json:{write:!0}})],ul.prototype,"expressionInfos",void 0),h([f({type:[RN]})],ul.prototype,"fieldInfos",void 0),h([Ct("fieldInfos")],ul.prototype,"writeFieldInfos",null),h([f({type:xst})],ul.prototype,"layerOptions",void 0),h([Ct("layerOptions")],ul.prototype,"writeLayerOptions",null),h([f({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],ul.prototype,"lastEditInfoEnabled",void 0),h([f()],ul.prototype,"outFields",void 0),h([f()],ul.prototype,"overwriteActions",void 0),h([f()],ul.prototype,"returnGeometry",void 0),h([f({json:{type:String}})],ul.prototype,"title",void 0),h([Ct("title")],ul.prototype,"writeTitle",null),ul=h([Q("esri.PopupTemplate")],ul);const JO=ul,vge=new Hi({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let Ost=0,nC=class extends Je{constructor(e){super(e),this.id="sym"+Ost++,this.type=null,this.color=new $t([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};h([f({type:vge.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:vge.write}}})],nC.prototype,"type",void 0),h([f({type:$t,json:{write:{allowNull:!0}}})],nC.prototype,"color",void 0),h([gt("color")],nC.prototype,"readColor",null),nC=h([Q("esri.symbols.Symbol")],nC);const vd=nC;var ree;let Lv=ree=class extends vd{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){if(t)for(const r in t)e[r]=t[r]}async collectRequiredFields(t,e){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const n=i.map(s=>{const o=s.valueExpressionInfo;return gh(t,e,o.expression)});await Promise.all(n)}}}clone(){return new ree({data:Te(this.data)})}hash(){return Hae(JSON.stringify(this.data)).toString()}};h([f({json:{write:!1}})],Lv.prototype,"color",void 0),h([f({json:{write:!0}})],Lv.prototype,"data",void 0),h([gt("data",["symbol"])],Lv.prototype,"readData",null),h([Ct("data",{})],Lv.prototype,"writeData",null),h([nr({CIMSymbolReference:"cim"},{readOnly:!0})],Lv.prototype,"type",void 0),Lv=ree=h([Q("esri.symbols.CIMSymbol")],Lv);const KO=Lv;let sC=class extends Je{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,r,i){e||(r[i]=e)}};h([f({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],sC.prototype,"enabled",void 0),h([Ct("enabled")],sC.prototype,"writeEnabled",null),h([f({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],sC.prototype,"type",void 0),sC=h([Q("esri.symbols.Symbol3DLayer")],sC);const JA=sC,Pst=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,Ist="screenUtils.toPt: input not recognized!",WPe=96;function El(t){return t?t/72*WPe:0}function Wf(t){return t?72*t/WPe:0}function Tn(t){if(typeof t=="string"){const e=t.match(Pst);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),n=t.charAt(0)==="-",s=i==="px"?Wf(r):r;return n?-s:s}return console.warn(Ist),null}return t}function Qf(t=0,e=0){return{x:t,y:e}}function Ns(t=0,e=0){return[t,e]}function QPe(t=0,e=0){return[t,e]}function Yl(t=0,e=0,r=0){return[t,e,r]}function Lsr(t){return t}function Nsr(t){return t}function Fsr(t){return t}function tA(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function $st(t,e){const r=e.transparency!=null?UD(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new $t([i[0]||0,i[1]||0,i[2]||0,r]):null}function Dst(t,e){e.color=t.toJSON().slice(0,3);const r=MG(t.a);r!==0&&(e.transparency=r)}const _1={type:$t,json:{type:[ds],default:null,read:{source:["color","transparency"],reader:$st},write:{target:{color:{type:[ds]},transparency:{type:ds}},writer:Dst}}},FA={type:Number,cast:Tn,json:{write:!0}};let _x=class extends Je{constructor(e){super(e),this.color=new $t([0,0,0,1]),this.extensionLength=0,this.size=Wf(1)}clone(){}cloneProperties(){return{color:Te(this.color),size:this.size,extensionLength:this.extensionLength}}};h([f({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],_x.prototype,"type",void 0),h([f(_1)],_x.prototype,"color",void 0),h([f({...FA,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],_x.prototype,"extensionLength",void 0),h([f(FA)],_x.prototype,"size",void 0),_x=h([Q("esri.symbols.edges.Edges3D")],_x);const Kle=_x;var iee;let Q7=iee=class extends Kle{constructor(t){super(t),this.type="sketch"}clone(){return new iee(this.cloneProperties())}};h([nr({sketch:"sketch"},{readOnly:!0})],Q7.prototype,"type",void 0),Q7=iee=h([Q("esri.symbols.edges.SketchEdges3D")],Q7);const Lst=Q7;var nee;let Y7=nee=class extends Kle{constructor(t){super(t),this.type="solid"}clone(){return new nee(this.cloneProperties())}};h([nr({solid:"solid"},{readOnly:!0})],Y7.prototype,"type",void 0),Y7=nee=h([Q("esri.symbols.support.SolidEdges3D")],Y7);const Nst=Y7,YPe={types:{key:"type",base:Kle,typeMap:{solid:Nst,sketch:Lst}},json:{write:!0}};var see;let gp=see=class extends Je{constructor(t){super(t),this.color=null}clone(){const t={color:M(this.color)?this.color.clone():null};return new see(t)}};h([f(_1)],gp.prototype,"color",void 0),gp=see=h([Q("esri.symbols.support.Symbol3DMaterial")],gp);var oee;let Nv=oee=class extends JA{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new oee({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:M(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};h([nr({Extrude:"extrude"},{readOnly:!0})],Nv.prototype,"type",void 0),h([f({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Nv.prototype,"size",void 0),h([f({type:gp,json:{write:!0}})],Nv.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Nv.prototype,"castShadows",void 0),h([f(YPe)],Nv.prototype,"edges",void 0),Nv=oee=h([Q("esri.symbols.ExtrudeSymbol3DLayer")],Nv);const XPe=Nv;let L$=class extends vd{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};h([nr({esriSLS:"simple-line"},{readOnly:!0})],L$.prototype,"type",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],L$.prototype,"width",void 0),L$=h([Q("esri.symbols.LineSymbol")],L$);const Fst=L$,kst=["begin","end","begin-end"],ZPe=["arrow","circle","square","diamond","cross","x"];var aee;let Eg=aee=class extends Je{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){(i==null?void 0:i.origin)==="web-map"||(e[r]=t)}clone(){return new aee({color:Te(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};h([f({type:["begin","end","begin-end"],json:{write:!0}})],Eg.prototype,"placement",void 0),h([nr({"line-marker":"line-marker"},{readOnly:!0}),f({json:{origins:{"web-map":{write:!1}}}})],Eg.prototype,"type",void 0),h([f({type:ZPe})],Eg.prototype,"style",void 0),h([Ct("style")],Eg.prototype,"writeStyle",null),h([f({type:$t,value:null,json:{write:{allowNull:!0}}})],Eg.prototype,"color",null),h([gt("color")],Eg.prototype,"readColor",null),h([Ct("color")],Eg.prototype,"writeColor",null),Eg=aee=h([Q("esri.symbols.LineSymbolMarker")],Eg);const Ust=Eg;var lee;const _W=new Hi({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let By=lee=class extends Fst{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,n,s){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=Tn(r)),i!=null&&(o.cap=i),n!=null&&(o.join=n),s!=null&&(o.miterLimit=Tn(s)),o}clone(){var t;return new lee({color:Te(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};h([nr({esriSLS:"simple-line"},{readOnly:!0})],By.prototype,"type",void 0),h([f({type:_W.apiValues,json:{read:_W.read,write:_W.write}})],By.prototype,"style",void 0),h([f({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],By.prototype,"cap",void 0),h([f({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],By.prototype,"join",void 0),h([f({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":Ust}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],By.prototype,"marker",void 0),h([f({type:Number,json:{read:!1,write:!1}})],By.prototype,"miterLimit",void 0),By=lee=h([Q("esri.symbols.SimpleLineSymbol")],By);const i0=By;let N$=class extends vd{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":i0}},json:{default:null,write:!0}})],N$.prototype,"outline",void 0),h([f({type:["simple-fill","picture-fill"],readOnly:!0})],N$.prototype,"type",void 0),N$=h([Q("esri.symbols.FillSymbol")],N$);const JPe=N$;let X7=class extends Je{constructor(e){super(e)}clone(){}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],X7.prototype,"type",void 0),X7=h([Q("esri.symbols.patterns.LinePattern3D")],X7);const KPe=X7,Bst=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var cee;const zst=$c()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let F$=cee=class extends KPe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new cee(t)}};h([f({type:["style"]})],F$.prototype,"type",void 0),h([nr(zst),f({type:Bst})],F$.prototype,"style",void 0),F$=cee=h([Q("esri.symbols.patterns.LineStylePattern3D")],F$);const ece=F$;let Z7=class extends Je{constructor(e){super(e)}clone(){}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Z7.prototype,"type",void 0),Z7=h([Q("esri.symbols.patterns.Pattern3D")],Z7);const eIe=Z7,Vst=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var uee;let k$=uee=class extends eIe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new uee(t)}};h([f({type:["style"]})],k$.prototype,"type",void 0),h([f({type:Vst,json:{read:!0,write:!0}})],k$.prototype,"style",void 0),k$=uee=h([Q("esri.symbols.patterns.StylePattern3D")],k$);const tIe=k$,Gst={types:{key:"type",base:eIe,typeMap:{style:tIe}},json:{write:!0}},rIe={types:{key:"type",base:KPe,typeMap:{style:ece}},json:{write:!0}},v5=new $t("white");new $t("black");const jst=new $t([255,255,255,0]);function Hst(t){return t.r===0&&t.g===0&&t.b===0}var hee;let b5=hee=class extends gp{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:M(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new hee(t)}};h([nr({multiply:"multiply",replace:"replace",tint:"tint"})],b5.prototype,"colorMixMode",void 0),b5=hee=h([Q("esri.symbols.support.Symbol3DFillMaterial")],b5);function oi(t=Yst){return[t[0],t[1],t[2],t[3]]}function Gsr(t){return[t[0],t[1],t[2],t[3]]}function i1(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function tce(t,e,r,i,n=oi()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function iIe(t,e=oi()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function DG(t,e){return new an({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function rce(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function h2(t,e,r){if(k(e))i1(r,t);else if("length"in e)fee(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}}function vW(t,e,r=t){const i=e.length;let n=t[0],s=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];n=Math.min(n,c[0]),s=Math.min(s,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=n,r[1]=s,r[2]=o,r[3]=a,r}function dee(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function sp(t){return k(t)||t[0]>=t[2]?0:t[2]-t[0]}function $m(t){return t[1]>=t[3]?0:t[3]-t[1]}function nIe(t){return sp(t)*$m(t)}function ice(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function sIe(t,e){return LG(t,e[0],e[1])}function bge(t,e){const r=e[3],i=.5*(t[0]+t[2]),n=Math.abs(e[0]-i),s=.5*(t[2]-t[0]);if(n>r+s)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(n<s||l<a)return!0;const c=n-s,u=l-a;return c*c+u*u<=r*r}function jsr(t,e,r){const i=t[0],n=t[1],s=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=r,d=(S,E)=>(u-l)*S+(a-c)*E+(c*l-a*u)<0,p=d(i,o),A=d(s,o),v=d(s,n),b=d(i,n);return!(p===A&&A===v&&v===b&&b===p||a<i&&c<i||a>s&&c>s||l>o&&u>o||l<n&&u<n)}function Hsr(t,e){return LG(t,e.x,e.y)}function LG(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function qst(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function NG(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function wge(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function pee(t,e,r){if(k(e))return i1(r,t);const i=e[0],n=e[1],s=e[2],o=e[3];return r[0]=He(t[0],i,s),r[1]=He(t[1],n,o),r[2]=He(t[2],i,s),r[3]=He(t[3],n,o),r}function Wst(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,n=Math.max(Math.abs(e[0]-r)-sp(t)/2,0),s=Math.max(Math.abs(e[1]-i)-$m(t)/2,0);return Math.sqrt(n*n+s*s)}function OB(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function Yf(t){return t?i1(t,mee):oi(mee)}function fee(t){return t!=null&&t.length===4}function Qst(t){return!(sp(t)!==0&&isFinite(t[0])||$m(t)!==0&&isFinite(t[1]))}function XT(t,e){return fee(t)&&fee(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const qsr=[-1/0,-1/0,1/0,1/0],mee=[1/0,1/0,-1/0,-1/0],Yst=[0,0,0,0];function fa(t=uIe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function MS(t,e,r,i,n,s,o=fa()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function Wsr(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new an(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function YR(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function Xst(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function kA(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function up(t,e,r=0,i=e.length/3){let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<i;u++)n=Math.min(n,e[r+3*u]),s=Math.min(s,e[r+3*u+1]),o=Math.min(o,e[r+3*u+2]),a=Math.max(a,e[r+3*u]),l=Math.max(l,e[r+3*u+1]),c=Math.max(c,e[r+3*u+2]);t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function bW(t,e,r){const i=e.length;let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let u=0;u<i;u++){const d=e[u];n=Math.min(n,d[0]),s=Math.min(s,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let u=0;u<i;u++){const d=e[u];n=Math.min(n,d[0]),s=Math.min(s,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function Zst(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function mE(t){return t[0]>=t[3]?0:t[3]-t[0]}function gE(t){return t[1]>=t[4]?0:t[4]-t[1]}function rw(t){return t[2]>=t[5]?0:t[5]-t[2]}function oIe(t){const e=mE(t),r=rw(t),i=gE(t);return Math.sqrt(e*e+r*r+i*i)}function um(t,e=[0,0,0]){return e[0]=t[0]+mE(t)/2,e[1]=t[1]+gE(t)/2,e[2]=t[2]+rw(t)/2,e}function m6(t,e=[0,0,0]){return e[0]=mE(t),e[1]=gE(t),e[2]=rw(t),e}function nce(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function Qsr(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function Jst(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function hm(t,e){return!!k(e)||Jst(t,e)}function aIe(t,e,r,i,n=t){return n[0]=t[0]+e,n[1]=t[1]+r,n[2]=t[2]+i,n[3]=t[3]+e,n[4]=t[4]+r,n[5]=t[5]+i,n}function Ysr(t,e,r=t){const i=t[0]+mE(t)/2,n=t[1]+gE(t)/2,s=t[2]+rw(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=n+(t[1]-n)*e,r[2]=s+(t[2]-s)*e,r[3]=i+(t[3]-i)*e,r[4]=n+(t[4]-n)*e,r[5]=s+(t[5]-s)*e,r}function lIe(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function cIe(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function FG(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function qn(t){return t?FG(t,xge):fa(xge)}function sce(t,e){return e||(e=oi()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function Xsr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function Kst(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=n,t[5]=Number.POSITIVE_INFINITY,t}function gee(t){return t.length===6}function oce(t){return mE(t)===0&&gE(t)===0&&rw(t)===0}function Zsr(t,e,r){if(k(t)||k(e))return t===e;if(!gee(t)||!gee(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function eot(t,e,r,i,n,s){return MS(t,e,r,i,n,s,tot)}const Jsr=[-1/0,-1/0,-1/0,1/0,1/0,1/0],xge=[1/0,1/0,1/0,-1/0,-1/0,-1/0],uIe=[0,0,0,0,0,0],tot=fa();function wW(t,{isPrimitive:e,width:r,depth:i,height:n}){const s=e?10:1;if(r==null&&n==null&&i==null)return[s*t[0],s*t[1],s*t[2]];const o=pt(r,i,n);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const rot=MS(-.5,-.5,-.5,.5,.5,.5),iot=MS(-.5,-.5,0,.5,.5,1),not=MS(-.5,-.5,0,.5,.5,.5);function sot(t){switch(t){case"sphere":case"cube":case"diamond":return rot;case"cylinder":case"cone":case"inverted-cone":return iot;case"tetrahedron":return not;default:return}}const ace=["butt","square","round"],oot=[...ace,"none"],hIe=["miter","bevel","round"];var Aee;let vx=Aee=class extends Je{constructor(t){super(t),this.color=new $t([0,0,0,1]),this.size=Wf(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:M(this.color)?this.color.clone():null,size:this.size,pattern:M(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new Aee(t)}};h([f(_1)],vx.prototype,"color",void 0),h([f(FA)],vx.prototype,"size",void 0),h([f(rIe)],vx.prototype,"pattern",void 0),h([f({type:ace,json:{default:"butt",write:{overridePolicy(){return{enabled:M(this.pattern)}}}}})],vx.prototype,"patternCap",void 0),vx=Aee=h([Q("esri.symbols.support.Symbol3DOutline")],vx);var J7;let zy=J7=class extends JA{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:M(this.edges)?this.edges.clone():null,enabled:this.enabled,material:M(this.material)?this.material.clone():null,pattern:M(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:M(this.outline)?this.outline.clone():null};return new J7(t)}static fromSimpleFillSymbol(t){var i,n,s;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new ece({style:t.outline.style}):null,r={size:((i=t.outline)==null?void 0:i.width)??0,color:(((n=t.outline)==null?void 0:n.color)??v5).clone(),pattern:e};return e&&((s=t.outline)!=null&&s.cap)&&(r.patternCap=t.outline.cap),new J7({material:new b5({color:(t.color??jst).clone()}),pattern:t.style&&t.style!=="solid"?new tIe({style:t.style}):null,outline:r})}};h([nr({Fill:"fill"},{readOnly:!0})],zy.prototype,"type",void 0),h([f({type:b5,json:{write:!0}})],zy.prototype,"material",void 0),h([f(Gst)],zy.prototype,"pattern",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],zy.prototype,"castShadows",void 0),h([f({type:vx,json:{write:!0}})],zy.prototype,"outline",void 0),h([f(YPe)],zy.prototype,"edges",void 0),zy=J7=h([Q("esri.symbols.FillSymbol3DLayer")],zy);const ON=zy,aot=["none","underline","line-through"],lot=["normal","italic","oblique"],cot=["normal","lighter","bold","bolder"],dIe={type:Number,cast:t=>{const e=yf(t);return e===0?1:He(e,.1,4)},nonNullable:!0},uot=["left","right","center"],hot=["baseline","top","middle","bottom"],pIe={type:uot,nonNullable:!0},fIe={type:hot,nonNullable:!0};var yee;let Vy=yee=class extends Je{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return Tn(t)}clone(){return new yee({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};h([f({type:aot,json:{default:"none",write:!0}})],Vy.prototype,"decoration",void 0),h([f({type:String,json:{write:!0}})],Vy.prototype,"family",void 0),h([f({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],Vy.prototype,"size",void 0),h([Wr("size")],Vy.prototype,"castSize",null),h([f({type:lot,json:{default:"normal",write:!0}})],Vy.prototype,"style",void 0),h([f({type:cot,json:{default:"normal",write:!0}})],Vy.prototype,"weight",void 0),Vy=yee=h([Q("esri.symbols.Font")],Vy);const kG=Vy;function eP(t,e){const r=e&&e.url&&e.url.path;if(t&&r&&(t=np(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const i=cle(t,e.portalItem.itemUrl);i!=null&&dot.test(i)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(i).path)}return _ee(t,e&&e.portal)}function RS(t,e,r=WD.YES){if(t==null)return t;!fp(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let i=np(t);if(e){const n=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(n){const s=_ee(n,e.portal),o=_ee(i,e.portal);i=cle(o,s,s),i!=null&&i!==o&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=gIe(i,e==null?void 0:e.portal),fp(i)&&(i=wm(i)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!fp(i)&&!YA(i)&&r===WD.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function lce(t,e,r){return eP(t,r)}function M2(t,e,r,i){const n=RS(t,i);n!==void 0&&(e[r]=n)}const mIe=/\/items\/([^\/]+)\/resources\/(.*)/,dot=/^\.\/resources\//;function pot(t){var e;return((e=(t==null?void 0:t.match(mIe))??null)==null?void 0:e[1])??null}function fot(t){const e=(t==null?void 0:t.match(mIe))??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=Bme(r);return{prefix:null,filename:o,extension:a}}const{path:n,extension:s}=Bme(r.slice(i+1));return{prefix:r.slice(0,i),filename:n,extension:s}}function gIe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?hK(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function _ee(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=ole();return kR(i,`${i.scheme}://${r}`)?hK(t,e.portalHostname,r):hK(t,r,e.portalHostname)}var WD;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(WD||(WD={}));const Ksr=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return WD},ensureMainOnlineDomain:gIe,fromJSON:eP,itemIdFromResourceUrl:pot,prefixAndFilenameFromResourceUrl:fot,read:lce,toJSON:RS,write:M2},Symbol.toStringTag,{value:"Module"}));var vee;const mot=$c()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let bx=vee=class extends Je{constructor(t){super(t)}readHref(t,e,r){return t?eP(t,r):e.dataURI}writeHref(t,e,r,i){t&&(YA(t)?e.dataURI=t:(e.href=RS(t,i),fp(e.href)&&(e.href=wm(e.href))))}clone(){return new vee({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],bx.prototype,"href",void 0),h([gt("href")],bx.prototype,"readHref",null),h([Ct("href",{href:{type:String},dataURI:{type:String}})],bx.prototype,"writeHref",null),h([nr(mot)],bx.prototype,"primitive",void 0),bx=vee=h([Q("esri.symbols.support.IconSymbol3DLayerResource")],bx);const got="circle";var bee;let AM=bee=class extends rt{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new bee({x:this.x,y:this.y})}};h([f({type:Number})],AM.prototype,"x",void 0),h([f({type:Number})],AM.prototype,"y",void 0),AM=bee=h([Q("esri.symbols.support.Symbol3DAnchorPosition2D")],AM);var wee;let U$=wee=class extends Je{constructor(t){super(t),this.color=new $t([0,0,0,1]),this.size=Wf(1)}clone(){const t={color:M(this.color)?this.color.clone():null,size:this.size};return new wee(t)}};h([f(_1)],U$.prototype,"color",void 0),h([f(FA)],U$.prototype,"size",void 0),U$=wee=h([Q("esri.symbols.support.Symbol3DIconOutline")],U$);var oC;const AIe="esri.symbols.IconSymbol3DLayer";let Cg=oC=class extends JA{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new oC({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:M(this.material)?this.material.clone():null,outline:M(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||v5,r=Tge(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||v5).clone()}:null;return new oC({size:t.size,resource:{primitive:yot(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||Hst(t.color)?v5:t.color,r=Tge(t);return new oC({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new oC({resource:{href:KRe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function Tge(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=Sge(t.xoffset),n=Sge(t.yoffset);return(i||n)&&e&&r?{x:-i/e,y:n/r}:null}function Sge(t){return isFinite(t)?t:0}h([f({type:gp,json:{write:!0}})],Cg.prototype,"material",void 0),h([f({type:bx,json:{write:!0}})],Cg.prototype,"resource",void 0),h([nr({Icon:"icon"},{readOnly:!0})],Cg.prototype,"type",void 0),h([f(FA)],Cg.prototype,"size",void 0),h([nr({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),f({json:{default:"center"}})],Cg.prototype,"anchor",void 0),h([f({type:AM,json:{type:[Number],read:{reader:t=>new AM({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Cg.prototype,"anchorPosition",void 0),h([f({type:U$,json:{write:!0}})],Cg.prototype,"outline",void 0),Cg=oC=h([Q(AIe)],Cg);const Aot={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function yot(t){return Aot[t]||(we.getLogger(AIe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const zb=Cg;let wx=class extends Qs(Je){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return M(e)&&e.placement===this.placement&&e.style===this.style&&(k(this.color)&&k(e.color)||M(this.color)&&M(e.color)&&this.color.toJSON()===e.color.toJSON())}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],wx.prototype,"type",void 0),h([f({type:kst,json:{default:"begin-end",write:!0}})],wx.prototype,"placement",void 0),h([f({type:ZPe,json:{default:"arrow",write:!0}})],wx.prototype,"style",void 0),h([f({type:$t,json:{type:[ds],default:null,write:!0}})],wx.prototype,"color",void 0),wx=h([Q("esri.symbols.LineStyleMarker3D")],wx);const xee=wx;var K7;let Mg=K7=class extends JA{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Wf(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:M(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:M(this.pattern)?this.pattern.clone():null,marker:M(this.marker)?this.marker.clone():null};return new K7(t)}static fromSimpleLineSymbol(t){var r;const e={enabled:!0,size:t.width??Wf(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new ece({style:t.style}):null,material:new gp({color:(t.color||v5).clone()}),marker:t.marker?new xee({placement:t.marker.placement,style:t.marker.style,color:((r=t.marker.color)==null?void 0:r.clone())??null}):null};return new K7(e)}};h([f({type:gp,json:{write:!0}})],Mg.prototype,"material",void 0),h([nr({Line:"line"},{readOnly:!0})],Mg.prototype,"type",void 0),h([f({type:hIe,json:{write:!0,default:"miter"}})],Mg.prototype,"join",void 0),h([f({type:ace,json:{write:!0,default:"butt"}})],Mg.prototype,"cap",void 0),h([f(FA)],Mg.prototype,"size",void 0),h([f(rIe)],Mg.prototype,"pattern",void 0),h([f({types:{key:"type",base:xee,typeMap:{style:xee}},json:{write:!0}})],Mg.prototype,"marker",void 0),Mg=K7=h([Q("esri.symbols.LineSymbol3DLayer")],Mg);const PN=Mg;var Tee;const _ot=$c()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let B$=Tee=class extends Je{clone(){return new Tee({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{read:lce,write:M2}})],B$.prototype,"href",void 0),h([nr(_ot)],B$.prototype,"primitive",void 0),B$=Tee=h([Q("esri.symbols.support.ObjectSymbol3DLayerResource")],B$);const yIe="sphere";var See;let pT=See=class extends rt{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new See({x:this.x,y:this.y,z:this.z})}};h([f({type:Number})],pT.prototype,"x",void 0),h([f({type:Number})],pT.prototype,"y",void 0),h([f({type:Number})],pT.prototype,"z",void 0),pT=See=h([Q("esri.symbols.support.Symbol3DAnchorPosition3D")],pT);var Eee;let Kc=Eee=class extends JA{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new Eee({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:M(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};h([f({type:gp,json:{write:!0}})],Kc.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Kc.prototype,"castShadows",void 0),h([f({type:B$,json:{write:!0}})],Kc.prototype,"resource",void 0),h([nr({Object:"object"},{readOnly:!0})],Kc.prototype,"type",void 0),h([f({type:Number,json:{write:!0}})],Kc.prototype,"width",void 0),h([f({type:Number,json:{write:!0}})],Kc.prototype,"height",void 0),h([f({type:Number,json:{write:!0}})],Kc.prototype,"depth",void 0),h([nr({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),f({json:{default:"origin"}})],Kc.prototype,"anchor",void 0),h([f({type:pT,json:{type:[Number],read:{reader:t=>new pT({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Kc.prototype,"anchorPosition",void 0),h([f({type:Number,json:{write:!0}})],Kc.prototype,"heading",void 0),h([f({type:Number,json:{write:!0}})],Kc.prototype,"tilt",void 0),h([f({type:Number,json:{write:!0}})],Kc.prototype,"roll",void 0),h([f({readOnly:!0})],Kc.prototype,"isPrimitive",null),Kc=Eee=h([Q("esri.symbols.ObjectSymbol3DLayer")],Kc);const cce=Kc;var Cee;let zu=Cee=class extends JA{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new Cee({enabled:this.enabled,material:M(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};h([f({type:gp,json:{write:!0}})],zu.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],zu.prototype,"castShadows",void 0),h([nr({Path:"path"},{readOnly:!0})],zu.prototype,"type",void 0),h([f({type:["circle","quad"],json:{write:!0,default:"circle"}})],zu.prototype,"profile",void 0),h([f({type:hIe,json:{write:!0,default:"miter"}})],zu.prototype,"join",void 0),h([f({type:oot,json:{write:!0,default:"butt"}})],zu.prototype,"cap",void 0),h([f({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],zu.prototype,"width",void 0),h([gt("width",["width","size","height"])],zu.prototype,"readWidth",null),h([f({type:Number,json:{write:!0}})],zu.prototype,"height",void 0),h([gt("height",["height","size","width"])],zu.prototype,"readHeight",null),h([f({type:["center","bottom","top"],json:{write:!0,default:"center"}})],zu.prototype,"anchor",void 0),h([f({type:["heading","all"],json:{write:!0,default:"all"}})],zu.prototype,"profileRotation",void 0),zu=Cee=h([Q("esri.symbols.PathSymbol3DLayer")],zu);const uce=zu;var Mee;let yM=Mee=class extends Je{constructor(){super(...arguments),this.color=new $t([0,0,0,1]),this.size=0}clone(){const t={color:Te(this.color),size:this.size};return new Mee(t)}};h([f(_1)],yM.prototype,"color",void 0),h([f(FA)],yM.prototype,"size",void 0),yM=Mee=h([Q("esri.symbols.support.Symbol3DHalo")],yM);let w5=class extends Qs(Je){constructor(e){super(e),this.color=null}};h([f(_1)],w5.prototype,"color",void 0),w5=h([Q("esri.symbols.support.Symbol3DTextBackground")],w5);var ek;let Rh=ek=class extends JA{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){M(t)&&M(this._userSize)&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const n={...i,textSymbol3D:!0};e.font=t.write({},n),delete e.font.size}get size(){return M(this._userSize)?this._userSize:M(this.font)&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,M(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new ek({enabled:this.enabled,font:this.font&&Te(this.font),halo:this.halo&&Te(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:M(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:Te(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new ek({font:M(t.font)?t.font.clone():new kG,halo:vot(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new gp({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new w5({color:t.backgroundColor.clone()}):null})}};function vot(t,e){return t&&e!=null&&e>0?new yM({color:Te(t),size:e}):null}h([f({type:kG,json:{write:!0}})],Rh.prototype,"font",null),h([Ct("font")],Rh.prototype,"writeFont",null),h([f({type:yM,json:{write:!0}})],Rh.prototype,"halo",void 0),h([f({...pIe,json:{default:"center",write:!0}})],Rh.prototype,"horizontalAlignment",void 0),h([f({...dIe,json:{default:1,write:!0}})],Rh.prototype,"lineHeight",void 0),h([f({type:gp,json:{write:!0}})],Rh.prototype,"material",void 0),h([f({type:w5,json:{write:!0}})],Rh.prototype,"background",void 0),h([f(FA)],Rh.prototype,"size",null),h([f({type:String,json:{write:!0}})],Rh.prototype,"text",void 0),h([nr({Text:"text"},{readOnly:!0})],Rh.prototype,"type",void 0),h([f({...fIe,json:{default:"baseline",write:!0}})],Rh.prototype,"verticalAlignment",void 0),Rh=ek=h([Q("esri.symbols.TextSymbol3DLayer")],Rh);const AE=Rh;var Ree;let Fv=Ree=class extends JA{constructor(t){super(t),this.color=Oee.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new Ree({color:Te(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};h([f({type:$t,nonNullable:!0,json:{type:[ds],write:(t,e,r)=>e[r]=t.toArray($t.AlphaMode.UNLESS_OPAQUE),default:()=>Oee.clone(),defaultEquals:t=>t.toCss(!0)===Oee.toCss(!0)}})],Fv.prototype,"color",void 0),h([nr({Water:"water"},{readOnly:!0})],Fv.prototype,"type",void 0),h([f({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Fv.prototype,"waterbodySize",void 0),h([f({type:Number,json:{write:!0,default:null}})],Fv.prototype,"waveDirection",void 0),h([f({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Fv.prototype,"waveStrength",void 0),Fv=Ree=h([Q("esri.symbols.WaterSymbol3DLayer")],Fv);const Oee=new $t([0,119,190]),_Ie=Fv;var Pee;let xx=Pee=class extends rt{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new Pee({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};h([f({type:String})],xx.prototype,"name",void 0),h([f({type:String})],xx.prototype,"styleUrl",void 0),h([f({type:String})],xx.prototype,"styleName",void 0),h([f({type:mh})],xx.prototype,"portal",void 0),xx=Pee=h([Q("esri.symbols.support.StyleOrigin")],xx);const Iee=xx;var $ee;let x5=$ee=class extends rt{constructor(){super(...arguments),this.url=""}clone(){return new $ee({url:this.url})}};h([f({type:String})],x5.prototype,"url",void 0),x5=$ee=h([Q("esri.symbols.support.Thumbnail")],x5);const vIe={icon:zb,object:cce,line:PN,path:uce,fill:ON,extrude:XPe,text:AE,water:_Ie},bot=ur.ofType({base:JA,key:"type",typeMap:vIe,errorContext:"symbol-layer"});let Rg=class extends vd{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=r&&r.type||ur;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&we.getLogger(this.declaredClass).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){vS(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const n=eP(e.styleUrl,i);return new Iee({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new Iee({portal:i&&i.portal||mh.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new IA("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,n){if(e.styleUrl&&e.name){let s=RS(e.styleUrl,n);fp(s)&&(s=wm(s)),r.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&n&&n.portal&&!ZRe(e.portal.restUrl,n.portal.restUrl)?n&&n.messages&&n.messages.push(new IA("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof JA||e&&vIe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};h([f({json:{read:!1,write:!1}})],Rg.prototype,"color",null),h([f({type:bot,nonNullable:!0,json:{write:!0}}),Wr(kRe)],Rg.prototype,"symbolLayers",null),h([f({type:Iee})],Rg.prototype,"styleOrigin",void 0),h([gt("styleOrigin")],Rg.prototype,"readStyleOrigin",null),h([Ct("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Rg.prototype,"writeStyleOrigin",null),h([f({type:x5,json:{read:!1}})],Rg.prototype,"thumbnail",void 0),h([f({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Rg.prototype,"type",void 0),Rg=h([Q("esri.symbols.Symbol3D")],Rg);const tP=Rg;let z$=class extends Je{constructor(e){super(e),this.visible=!0}clone(){}};h([f({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],z$.prototype,"type",void 0),h([f({readOnly:!0})],z$.prototype,"visible",void 0),z$=h([Q("esri.symbols.callouts.Callout3D")],z$);const bIe=z$;var Dee;let tk=Dee=class extends Je{constructor(){super(...arguments),this.color=new $t("white")}clone(){return new Dee({color:Te(this.color)})}};h([f(_1)],tk.prototype,"color",void 0),tk=Dee=h([Q("esri.symbols.callouts.LineCallout3DBorder")],tk);const wIe=tk;Object.freeze(Object.defineProperty({__proto__:null,default:wIe},Symbol.toStringTag,{value:"Module"}));var Lee;let kv=Lee=class extends bIe{constructor(t){super(t),this.type="line",this.color=new $t([0,0,0,1]),this.size=Wf(1),this.border=null}get visible(){return this.size>0&&M(this.color)&&this.color.a>0}clone(){return new Lee({color:Te(this.color),size:this.size,border:Te(this.border)})}};h([nr({line:"line"},{readOnly:!0})],kv.prototype,"type",void 0),h([f(_1)],kv.prototype,"color",void 0),h([f(FA)],kv.prototype,"size",void 0),h([f({type:wIe,json:{write:!0}})],kv.prototype,"border",void 0),h([f({readOnly:!0})],kv.prototype,"visible",null),kv=Lee=h([Q("esri.symbols.callouts.LineCallout3D")],kv);const wot=kv;function hce(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||M(e.maxWorldLength)&&e.maxWorldLength<=0)}function xIe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!hce(t)}function dce(t){return t.type==="point-3d"||t.type==="label-3d"}function TIe(t){return t.horizontalAlignment==="center"}const SIe={types:{key:"type",base:bIe,typeMap:{line:wot}},json:{write:!0}};var Nee;let aC=Nee=class extends Je{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new Nee({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};h([f(FA)],aC.prototype,"screenLength",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0,default:0}})],aC.prototype,"minWorldLength",void 0),h([f({type:Number,json:{write:!0}})],aC.prototype,"maxWorldLength",void 0),aC=Nee=h([Q("esri.symbols.support.Symbol3DVerticalOffset")],aC);const EIe=aC;var rk;const CIe=ur.ofType({base:null,key:"type",typeMap:{text:AE}});let Uv=rk=class extends tP{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new CIe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return xIe(this)}hasVisibleVerticalOffset(){return hce(this)}clone(){return new rk({styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail),callout:Te(this.callout),verticalOffset:Te(this.verticalOffset)})}static fromTextSymbol(t){return new rk({symbolLayers:[AE.fromTextSymbol(t)]})}};h([f({type:EIe,json:{write:!0}})],Uv.prototype,"verticalOffset",void 0),h([f(SIe)],Uv.prototype,"callout",void 0),h([f({json:{read:!1,write:!1}})],Uv.prototype,"styleOrigin",void 0),h([f({type:CIe})],Uv.prototype,"symbolLayers",void 0),h([nr({LabelSymbol3D:"label-3d"},{readOnly:!0})],Uv.prototype,"type",void 0),Uv=rk=h([Q("esri.symbols.LabelSymbol3D")],Uv);const UG=Uv;var ik;const MIe=ur.ofType({base:null,key:"type",typeMap:{line:PN,path:uce}}),xot=ur.ofType({base:null,key:"type",typeMap:{line:PN,path:uce}});let V$=ik=class extends tP{constructor(t){super(t),this.symbolLayers=new MIe,this.type="line-3d"}clone(){return new ik({styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail)})}static fromSimpleLineSymbol(t){return new ik({symbolLayers:[PN.fromSimpleLineSymbol(t)]})}};h([f({type:MIe,json:{type:xot}})],V$.prototype,"symbolLayers",void 0),h([nr({LineSymbol3D:"line-3d"},{readOnly:!0})],V$.prototype,"type",void 0),V$=ik=h([Q("esri.symbols.LineSymbol3D")],V$);const BG=V$;let Bv=class extends vd{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};h([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Bv.prototype,"angle",void 0),h([f({type:["simple-marker","picture-marker"],readOnly:!0})],Bv.prototype,"type",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],Bv.prototype,"xoffset",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],Bv.prototype,"yoffset",void 0),h([f({type:Number,cast:t=>t==="auto"?t:Tn(t),json:{write:!0}})],Bv.prototype,"size",void 0),Bv=h([Q("esri.symbols.MarkerSymbol")],Bv);const RIe=Bv;var nk;const OIe=ur.ofType({base:null,key:"type",typeMap:{fill:ON}});let G$=nk=class extends tP{constructor(t){super(t),this.symbolLayers=new OIe,this.type="mesh-3d"}clone(){return new nk({styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail)})}static fromSimpleFillSymbol(t){return new nk({symbolLayers:[ON.fromSimpleFillSymbol(t)]})}};h([f({type:OIe})],G$.prototype,"symbolLayers",void 0),h([nr({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],G$.prototype,"type",void 0),G$=nk=h([Q("esri.symbols.MeshSymbol3D")],G$);const zG=G$;function Tot(t,e,r){return e.imageData?KRe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):PIe(e.url,r)}function PIe(t,e){var r;return Eot(e)&&!fp(t)&&((r=e==null?void 0:e.layer)!=null&&r.parsedUrl)?bS(e.layer.parsedUrl.path,"images",t):eP(t,e)}function Sot(t,e,r,i){if(YA(t)){const n=TN(t);if(!n)return;e.contentType=n.mediaType,e.imageData=n.data,r&&r.imageData===e.imageData&&r.url&&M2(r.url,e,"url",i)}else M2(t,e,"url",i)}const IIe={json:{read:{source:["imageData","url"],reader:Tot},write:{writer(t,e,r,i){Sot(t,e,this.source,i)}}}},$Ie={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=PIe(e.url,r)),i}}}};function Eot(t){var e,r;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((r=t.layer)==null?void 0:r.type)!=="stream")}var Fee;let Jp=Fee=class extends JPe{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const n={};return t&&(n.url=t),e&&(n.outline=e),r!=null&&(n.width=Tn(r)),i!=null&&(n.height=Tn(i)),n}clone(){const t=new Fee({color:Te(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",Te(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};h([nr({esriPFS:"picture-fill"},{readOnly:!0})],Jp.prototype,"type",void 0),h([f(IIe)],Jp.prototype,"url",void 0),h([f({type:Number,json:{write:!0}})],Jp.prototype,"xscale",void 0),h([f({type:Number,json:{write:!0}})],Jp.prototype,"yscale",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],Jp.prototype,"width",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],Jp.prototype,"height",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],Jp.prototype,"xoffset",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],Jp.prototype,"yoffset",void 0),h([f($Ie)],Jp.prototype,"source",void 0),Jp=Fee=h([Q("esri.symbols.PictureFillSymbol")],Jp);const DIe=Jp;var kee;let T0=kee=class extends RIe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=Tn(e)),r!=null&&(i.height=Tn(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new kee({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",Te(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};h([f({json:{write:!1}})],T0.prototype,"color",void 0),h([nr({esriPMS:"picture-marker"},{readOnly:!0})],T0.prototype,"type",void 0),h([f(IIe)],T0.prototype,"url",void 0),h([f($Ie)],T0.prototype,"source",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],T0.prototype,"height",void 0),h([gt("height",["height","size"])],T0.prototype,"readHeight",null),h([f({type:Number,cast:Tn,json:{write:!0}})],T0.prototype,"width",void 0),h([f({json:{write:!1}})],T0.prototype,"size",void 0),T0=kee=h([Q("esri.symbols.PictureMarkerSymbol")],T0);const IN=T0;var Tx;const LIe=ur.ofType({base:null,key:"type",typeMap:{icon:zb,object:cce,text:AE}});let Sx=Tx=class extends tP{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new LIe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return xIe(this)}hasVisibleVerticalOffset(){return hce(this)}clone(){return new Tx({verticalOffset:Te(this.verticalOffset),callout:Te(this.callout),styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Tx({symbolLayers:[zb.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new Tx({symbolLayers:[zb.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){var i,n;if(((n=(i=t.data)==null?void 0:i.symbol)==null?void 0:n.type)!=="CIMPointSymbol")return null;const r=t.data.symbol;return new Tx(r!=null&&r.callout?{symbolLayers:[zb.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[zb.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new Tx({symbolLayers:[AE.fromTextSymbol(t)]})}};h([f({type:EIe,json:{write:!0}})],Sx.prototype,"verticalOffset",void 0),h([f(SIe)],Sx.prototype,"callout",void 0),h([f({type:LIe,json:{origins:{"web-scene":{write:!0}}}})],Sx.prototype,"symbolLayers",void 0),h([nr({PointSymbol3D:"point-3d"},{readOnly:!0})],Sx.prototype,"type",void 0),Sx=Tx=h([Q("esri.symbols.PointSymbol3D")],Sx);const Vb=Sx;var j$;const NIe=ur.ofType({base:null,key:"type",typeMap:{extrude:XPe,fill:ON,icon:zb,line:PN,object:cce,text:AE,water:_Ie}});let H$=j$=class extends tP{constructor(t){super(t),this.symbolLayers=new NIe,this.type="polygon-3d"}clone(){return new j$({styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail)})}static fromJSON(t){const e=new j$;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.getItemAt(0).type==="fill"&&e.symbolLayers.getItemAt(1).type==="line"){const r=e.symbolLayers.getItemAt(0),i=e.symbolLayers.getItemAt(1);!i.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:M(i.material)?i.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new j$({symbolLayers:[ON.fromSimpleFillSymbol(t)]})}};h([f({type:NIe,json:{write:!0}})],H$.prototype,"symbolLayers",void 0),h([nr({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],H$.prototype,"type",void 0),H$=j$=h([Q("esri.symbols.PolygonSymbol3D")],H$);const $N=H$;var Uee;const xW=new Hi({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Ex=Uee=class extends JPe{constructor(...t){super(...t),this.color=new $t([0,0,0,.25]),this.outline=new i0,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new Uee({color:Te(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};h([f()],Ex.prototype,"color",void 0),h([f()],Ex.prototype,"outline",void 0),h([nr({esriSFS:"simple-fill"},{readOnly:!0})],Ex.prototype,"type",void 0),h([f({type:xW.apiValues,json:{read:xW.read,write:xW.write}})],Ex.prototype,"style",void 0),Ex=Uee=h([Q("esri.symbols.SimpleFillSymbol")],Ex);const iw=Ex;var Bee;const TW=new Hi({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Og=Bee=class extends RIe{constructor(...t){super(...t),this.color=new $t([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new i0}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const n={};return t&&(n.style=t),e!=null&&(n.size=Tn(e)),r&&(n.outline=r),i&&(n.color=i),n}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new Bee({angle:this.angle,color:Te(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};h([f()],Og.prototype,"color",void 0),h([Ct("color")],Og.prototype,"writeColor",null),h([nr({esriSMS:"simple-marker"},{readOnly:!0})],Og.prototype,"type",void 0),h([f()],Og.prototype,"size",void 0),h([f({type:TW.apiValues,json:{read:TW.read,write:TW.write}})],Og.prototype,"style",void 0),h([f({type:String,json:{write:!0}})],Og.prototype,"path",null),h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":i0}},json:{default:null,write:!0}})],Og.prototype,"outline",void 0),Og=Bee=h([Q("esri.symbols.SimpleMarkerSymbol")],Og);const nw=Og;var zee;let fo=zee=class extends vd{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new kG,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return Tn(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new zee({angle:this.angle,backgroundColor:Te(this.backgroundColor),borderLineColor:Te(this.borderLineColor),borderLineSize:this.borderLineSize,color:Te(this.color),font:this.font&&this.font.clone(),haloColor:Te(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};h([f({type:$t,json:{write:!0}})],fo.prototype,"backgroundColor",void 0),h([f({type:$t,json:{write:!0}})],fo.prototype,"borderLineColor",void 0),h([f({type:Number,json:{write:!0},cast:Tn})],fo.prototype,"borderLineSize",void 0),h([f({type:kG,json:{write:!0}})],fo.prototype,"font",void 0),h([f({...pIe,json:{write:!0}})],fo.prototype,"horizontalAlignment",void 0),h([f({type:Boolean,json:{write:!0}})],fo.prototype,"kerning",void 0),h([f({type:$t,json:{write:!0}})],fo.prototype,"haloColor",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],fo.prototype,"haloSize",void 0),h([f({type:Boolean,json:{write:!0}})],fo.prototype,"rightToLeft",void 0),h([f({type:Boolean,json:{write:!0}})],fo.prototype,"rotated",void 0),h([f({type:String,json:{write:!0}})],fo.prototype,"text",void 0),h([nr({esriTS:"text"},{readOnly:!0})],fo.prototype,"type",void 0),h([f({...fIe,json:{write:!0}})],fo.prototype,"verticalAlignment",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],fo.prototype,"xoffset",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],fo.prototype,"yoffset",void 0),h([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],fo.prototype,"angle",void 0),h([f({type:Number,json:{write:!0}})],fo.prototype,"width",void 0),h([f({type:Number})],fo.prototype,"lineWidth",void 0),h([Ct("lineWidth")],fo.prototype,"writeLineWidth",null),h([Wr("lineWidth")],fo.prototype,"castLineWidth",null),h([f(dIe)],fo.prototype,"lineHeight",void 0),h([Ct("lineHeight")],fo.prototype,"writeLineHeight",null),fo=zee=h([Q("esri.symbols.TextSymbol")],fo);const rP=fo;var Vee;let S0=Vee=class extends vd{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=M(this.portal)?this.portal:mh.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new Vee({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=M(e)?e.cache:null,i=r?this._fetchCacheKey:null;if(M(r)){const a=i&&r.get(i);if(a)return a.clone()}const n=await Cot();fi(e);const s=n.resolveWebStyleSymbol(this,{portal:this.portal},t,e);s.catch(a=>{we.getLogger(this.declaredClass).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await s;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(M(r)&&r.set(i,o.clone()),o):null}};function Cot(){return be(()=>import("./webStyleSymbolUtils-dce609b4.js"),[])}h([f({json:{write:!1}})],S0.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],S0.prototype,"styleName",void 0),h([f({type:mh,json:{write:!1}})],S0.prototype,"portal",void 0),h([f({type:String,json:{read:lce,write:M2}})],S0.prototype,"styleUrl",void 0),h([f({type:x5,json:{read:!1}})],S0.prototype,"thumbnail",void 0),h([f({type:String,json:{write:!0}})],S0.prototype,"name",void 0),h([nr({styleSymbolReference:"web-style"},{readOnly:!0})],S0.prototype,"type",void 0),h([f()],S0.prototype,"_fetchCacheKey",null),S0=Vee=h([Q("esri.symbols.WebStyleSymbol")],S0);const yE=S0;function VG(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function XR(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const ZT={base:vd,key:"type",typeMap:{"simple-fill":iw,"picture-fill":DIe,"picture-marker":IN,"simple-line":i0,"simple-marker":nw,text:rP,"label-3d":UG,"line-3d":BG,"mesh-3d":zG,"point-3d":Vb,"polygon-3d":$N,"web-style":yE,cim:KO},errorContext:"symbol"},Mot={base:vd,key:"type",typeMap:{"picture-marker":IN,"simple-marker":nw,text:rP,"web-style":yE,cim:KO},errorContext:"symbol"},Rot=J2({types:ZT}),GG={base:vd,key:"type",typeMap:{"simple-fill":iw,"picture-fill":DIe,"picture-marker":IN,"simple-line":i0,"simple-marker":nw,text:rP,"line-3d":BG,"mesh-3d":zG,"point-3d":Vb,"polygon-3d":$N,"web-style":yE,cim:KO},errorContext:"symbol"},Oot={base:vd,key:"type",typeMap:{text:rP,"label-3d":UG},errorContext:"symbol"},Ege={base:vd,key:"type",typeMap:{"line-3d":BG,"mesh-3d":zG,"point-3d":Vb,"polygon-3d":$N,"web-style":yE,cim:KO},errorContext:"symbol"},Pot={base:vd,key:"type",typeMap:{"label-3d":UG},errorContext:"symbol"},FIe=Om(ZT);function Iot(t){if(!t)return null;const e={};for(const r in t){const i=r1(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function $ot(t){if(!M(t))return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let Oh=class extends Qs(Je){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:hd(),configurable:!0})}normalizeCtorArgs(e,r,i,n){return e&&!e.declaredClass?e:{geometry:e,symbol:r,attributes:i,popupTemplate:n}}set aggregateGeometries(e){const r=this._get("aggregateGeometries");JSON.stringify(r)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const r=this._get("attributes");r!==e&&(this._set("attributes",e),this._notifyLayer("attributes",r,e))}set geometry(e){const r=this._get("geometry");r!==e&&(this._set("geometry",e),this._notifyLayer("geometry",r,e))}set symbol(e){const r=this._get("symbol");r!==e&&(this._set("symbol",e),this._notifyLayer("symbol",r,e))}set visible(e){const r=this._get("visible");r!==e&&(this._set("visible",e),this._notifyLayer("visible",r,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const r of[this.sourceLayer,this.layer])if(r){if("popupTemplate"in r&&r.popupTemplate)return r.popupTemplate;if(e&&"defaultPopupTemplate"in r&&M(r.defaultPopupTemplate))return r.defaultPopupTemplate}return null}getAttribute(e){var r;return(r=this.attributes)==null?void 0:r[e]}setAttribute(e,r){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=r,this._notifyLayer("attributes",i,r,e)}else this.attributes={[e]:r},this._notifyLayer("attributes",void 0,r,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:$ot(this.aggregateGeometries),geometry:M(this.geometry)?this.geometry.toJSON():null,symbol:M(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){M(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,r,i,n){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:r,newValue:i};e==="attributes"&&(s.attributeName=n),this.layer.graphicChanged(s)}};h([f({value:null,json:{read:Iot}})],Oh.prototype,"aggregateGeometries",null),h([f({value:null})],Oh.prototype,"attributes",null),h([f({value:null,types:fE,json:{read:r1}})],Oh.prototype,"geometry",null),h([f({type:Boolean})],Oh.prototype,"isAggregate",void 0),h([f({clonable:"reference"})],Oh.prototype,"layer",void 0),h([f({type:JO})],Oh.prototype,"popupTemplate",void 0),h([f({clonable:"reference"})],Oh.prototype,"sourceLayer",void 0),h([f({value:null,types:ZT})],Oh.prototype,"symbol",null),h([f({type:Boolean,value:!0})],Oh.prototype,"visible",null),Oh=h([Q("esri.Graphic")],Oh),function(t){t.generateUID=hd}(Oh||(Oh={}));const Pl=Oh;var Gee;let zv=Gee=class extends Je{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new Gee({rotation:this.rotation,scale:this.scale,targetGeometry:M(this.targetGeometry)?this.targetGeometry.clone():null,camera:M(this.camera)?this.camera.clone():null})}};function SW(){return{enabled:!this.camera}}h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:SW}}}}})],zv.prototype,"rotation",void 0),h([Wr("rotation")],zv.prototype,"castRotation",null),h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:SW}}}}})],zv.prototype,"scale",void 0),h([f({types:fE,json:{read:r1,write:!0,origins:{"web-scene":{read:r1,write:{overridePolicy:SW}}}}})],zv.prototype,"targetGeometry",void 0),h([f({type:qf,json:{write:!0}})],zv.prototype,"camera",void 0),zv=Gee=h([Q("esri.Viewpoint")],zv);const Dm=zv;function jG(t){return typeof t=="string"?document.getElementById(t):t??null}function kIe(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function Cge(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function Mge(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}function xe(t,e,r={}){return pce(t,e,r,UIe)}function ic(t,e,r={}){return pce(t,e,r,BIe)}function pce(t,e,r={},i){let n=null;const s=r.once?(o,a)=>{i(o)&&(ps(n),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(n=QKe(t,s,r.sync,r.equals),r.initial){const o=t();s(o,o)}return n}function Bo(t,e,r,i={}){let n=null,s=null,o=null;function a(){var u;n&&s&&(s.remove(),(u=i.onListenerRemove)==null||u.call(i,n),n=null,s=null)}function l(u){i.once&&i.once&&ps(o),r(u)}const c=xe(t,(u,d)=>{var p;a(),AG(u)&&(n=u,s=vN(u,e,l),(p=i.onListenerAdd)==null||p.call(i,u))},{sync:i.sync,initial:!0});return o=Rm(()=>{c.remove(),a()}),o}function QD(t,e){return Dot(t,BIe,e)}function Dot(t,e,r){if(Ra(r))return Promise.reject(en());const i=t();if(e!=null&&e(i))return Promise.resolve(i);let n=null;function s(){n=ps(n)}return new Promise((o,a)=>{n=DR([Sc(r,()=>{s(),a(en())}),pce(t,l=>{s(),o(l)},{sync:!1,once:!0},e??UIe)])})}function UIe(t){return!0}function BIe(t){return!!t}const fn={sync:!0},Rr={initial:!0},vo={sync:!0,initial:!0};let jee=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let e;for(e of this._items);return e}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach(r=>{e(r)||this._items.delete(r)}),this}};var Wl;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Wl||(Wl={}));let Lot=0;function zIe(){return Lot++}function Not(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function YD(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function fce(t,e,r,i){if(e.type===Wl.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Wl.INVOKE&&e.type!==Wl.RESPONSE)return void t.postMessage(e);let n;if(Not(r)?(n=Rge(r.transferList),e.data=r.result):(n=Rge(i),e.data=r),n){if(Fe("ff")){for(const s of n)if("byteLength"in s&&s.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Wl.INVOKE:throw o;case Wl.RESPONSE:return void fce(t,{type:Wl.RESPONSE,jobId:e.jobId,error:YD(o)})}}}t.postMessage(e,n)}else t.postMessage(e)}function XD(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Rge(t){if(!t||!t.length)return null;if(Fe("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!Fot(r));return e.length?e:null}function Fot(t){return t instanceof ArrayBuffer||t&&t.constructor&&t.constructor.name==="ArrayBuffer"}const kot={statsWorker:()=>be(()=>import("./statsWorker-9c40b235.js"),["assets/statsWorker-9c40b235.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js"]),geometryEngineWorker:()=>be(()=>import("./geometryEngineWorker-8a57eda3.js"),["assets/geometryEngineWorker-8a57eda3.js","assets/geometryEngineJSON-3f330436.js","assets/geometryEngineBase-e1a33b0a.js","assets/json-48e3ea08.js"]),CSVSourceWorker:()=>be(()=>import("./CSVSourceWorker-ef454c27.js"),["assets/CSVSourceWorker-ef454c27.js","assets/json-48e3ea08.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/QueryEngine-e9956441.js","assets/QueryEngineCapabilities-42e44ded.js","assets/clientSideDefaults-c1df0f48.js"]),EdgeProcessingWorker:()=>be(()=>import("./EdgeProcessingWorker-38e39908.js"),[]),ElevationSamplerWorker:()=>be(()=>import("./ElevationSamplerWorker-a44264ef.js"),["assets/ElevationSamplerWorker-a44264ef.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/georeference-0ed21318.js"]),FeatureServiceSnappingSourceWorker:()=>be(()=>import("./FeatureServiceSnappingSourceWorker-e042be90.js"),["assets/FeatureServiceSnappingSourceWorker-e042be90.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngine-e9956441.js","assets/QueryEngineCapabilities-42e44ded.js","assets/symbologySnappingCandidates-82607815.js"]),GeoJSONSourceWorker:()=>be(()=>import("./GeoJSONSourceWorker-81004a38.js"),["assets/GeoJSONSourceWorker-81004a38.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngine-e9956441.js","assets/QueryEngineCapabilities-42e44ded.js","assets/geojson-aa8b19ff.js","assets/clientSideDefaults-c1df0f48.js","assets/sourceUtils-7df50464.js"]),LercWorker:()=>be(()=>import("./LercWorker-4f6e1619.js"),[]),MemorySourceWorker:()=>be(()=>import("./MemorySourceWorker-ac10f585.js"),["assets/MemorySourceWorker-ac10f585.js","assets/objectIdUtils-789e911a.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngine-e9956441.js","assets/QueryEngineCapabilities-42e44ded.js","assets/clientSideDefaults-c1df0f48.js","assets/sourceUtils-7df50464.js"]),PBFDecoderWorker:()=>be(()=>import("./PBFDecoderWorker-ce3cfaac.js"),[]),Pipeline:()=>be(()=>import("./Pipeline-3af80eca.js").then(t=>t.P),["assets/Pipeline-3af80eca.js","assets/QueryEngine-e9956441.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/StreamFeatureManager-68ffd9c5.js","assets/quickselect-56c5966e.js","assets/arcadeTimeUtils-80a905aa.js","assets/centroid-07d28d00.js","assets/ogcFeatureUtils-43aeb6d3.js","assets/geojson-aa8b19ff.js","assets/clientSideDefaults-c1df0f48.js","assets/createConnection-fb6d6a7b.js","assets/enums-c655c737.js","assets/TileInfoView-8d1457e7.js","assets/number-b10bd8f5.js"]),PointCloudWorker:()=>be(()=>import("./PointCloudWorker-baabca6e.js"),["assets/PointCloudWorker-baabca6e.js","assets/PointCloudWorkerUtil-f3885e65.js","assets/PointCloudUniqueValueRenderer-544c99fa.js","assets/I3SBinaryReader-24647ffa.js"]),RasterWorker:()=>be(()=>import("./RasterWorker-530a1c36.js"),["assets/RasterWorker-530a1c36.js","assets/dataUtils-e10f6ac8.js","assets/colorUtils-c0f43caf.js","assets/utils-36a6bf0e.js","assets/rasterProjectionHelper-49608d5b.js"]),SceneLayerSnappingSourceWorker:()=>be(()=>import("./SceneLayerSnappingSourceWorker-10167fc9.js"),["assets/SceneLayerSnappingSourceWorker-10167fc9.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js"]),SceneLayerWorker:()=>be(()=>import("./SceneLayerWorker-e0b63c5e.js").then(t=>t.S),["assets/SceneLayerWorker-e0b63c5e.js","assets/I3SNode-bb3ecd90.js"]),WFSSourceWorker:()=>be(()=>import("./WFSSourceWorker-89ae8bf9.js"),["assets/WFSSourceWorker-89ae8bf9.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngine-e9956441.js","assets/QueryEngineCapabilities-42e44ded.js","assets/geojson-aa8b19ff.js","assets/sourceUtils-7df50464.js","assets/wfsUtils-61496ed5.js","assets/xmlUtils-444cb4c0.js"]),WorkerTileHandler:()=>be(()=>import("./WorkerTileHandler-08ee39d2.js"),["assets/WorkerTileHandler-08ee39d2.js","assets/TileClipper-ae6eca9e.js","assets/StyleRepository-99278a90.js","assets/enums-c655c737.js","assets/colorUtils-c0f43caf.js","assets/Rect-98da58d6.js","assets/TurboLine-b4df0b41.js","assets/BidiEngine-836b7ef6.js"])},{CLOSE:Oge,ABORT:Pge,INVOKE:Ige,RESPONSE:aI,OPEN_PORT:$ge,ON:Uot}=Wl,Bot=2;let zot=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Wl.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},R2=class lC{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new lC(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=n),lC.clients.set(n,i),r.port2}static loadWorker(e){const r=kot[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new zot(n=>this._onInvokeMessage(n)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:Oge}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){const n=i&&i.signal,s=i&&i.transferList;if(!this._port)return Promise.reject(new pe("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=zIe();return new Promise((a,l)=>{if(Ra(n))return this._processWork(),void l(en());const c=Sc(n,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),ps(d.abortHandle),this._post({type:Pge,jobId:o}),l(en()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:Ige,jobId:o,methodName:e,abortable:n!=null},r,s)})}on(e,r){const i=new MessageChannel;function n(s){r(s.data)}return this._port.postMessage({type:Wl.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",n),i.port1.start(),{remove(){i.port1.postMessage({type:Wl.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",n)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:$ge,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=Bot)return;const e=this._getNextJob();if(!e)return;const{methodName:r,data:i,invokeOptions:n,deferred:s}=e;this.invoke(r,i,n).then(o=>s.resolve(o)).catch(o=>s.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{ps(e.abortHandle),e.reject(en(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(e){M(this._schedule)?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=XD(e);if(r)switch(r.type){case aI:this._onResponseMessage(r);break;case Ige:this._invokeQueue.push(r);break;case Pge:this._onAbortMessage(r);break;case Oge:this._onCloseMessage();break;case $ge:this._onOpenPortMessage(r);break;case Uot:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,n=r.get(i);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&lC.clients.get(this)===e&&e.destroy(),lC.clients.delete(this),e&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[r];try{if(!u&&r&&r.includes(".")){const d=r.split(".");for(let p=0;p<d.length-1;p++)c=c[d[p]],u=c[d[p+1]]}if(typeof u!="function")throw new TypeError(`${r} is not a function`);l=u.call(c,n,{client:this,signal:o?o.signal:null})}catch(d){return void this._post({type:aI,jobId:i,error:YD(d)})}Op(l)?(a.set(i,{controller:o,promise:l}),l.then(d=>{a.has(i)&&(a.delete(i),this._post({type:aI,jobId:i},d))},d=>{a.has(i)&&(a.delete(i),$o(d)||this._post({type:aI,jobId:i,error:YD(d||{message:`Error encountered at method ${r}`})}))})):this._post({type:aI,jobId:i},l)}_onOpenPortMessage(e){new lC(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,s=>{r.postMessage(s)}),n=vN(e.port,"message",s=>{var o;((o=XD(s))==null?void 0:o.type)===Wl.CLOSE&&(n.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:n}=e,s=this._outJobs;if(!s.has(r))return;const o=s.get(r);s.delete(r),this._processWork(),ps(o.abortHandle),i?o.reject(pe.fromJSON(JSON.parse(i))):o.resolve(n)}_post(e,r,i){return fce(this._port,e,r,i)}};R2.kernelInfo={revision:bOe,version:wOe,buildDate:vOe},R2.clients=new Map;let Vot=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new jee}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,r){return new Promise((i,n)=>{let s=!0;const o=a=>{fi(r.signal),s&&(s=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Op(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new R2(c,r,()=>this._ongoingJobsQueue.pop()??null),o(i),this._clients[a]),()=>(o(n),null)):(this._clients[a]=new R2(l,r,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const o=this._clientPromises[s];n[s]=o.then(a=>a==null?void 0:a.invoke(e,r,i))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.deferred.reject(en(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0}invoke(e,r,i){let n;Array.isArray(i)?(we.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:i}):n=i;const s=x2();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:n,deferred:s});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return s.promise}on(e,r){return Promise.all(this._clientPromises).then(()=>DR(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{s&&(r[n]=s.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const VIe=we.getLogger("esri.intl.substitute");function Wg(t,e,r={}){const{format:i={}}=r;return PA(t,n=>Got(n,e,i))}function Got(t,e,r){let i,n;const s=t.indexOf(":");if(s===-1?i=t.trim():(i=t.slice(0,s).trim(),n=t.slice(s+1).trim()),!i)return"";const o=_N(i,e);if(o==null)return"";const a=(n?r==null?void 0:r[n]:null)??(r==null?void 0:r[i]);return a?jot(o,a):n?Hot(o,n):mce(o)}function jot(t,e){switch(e.type){case"date":return LA(t,e.intlOptions);case"number":return NA(t,e.intlOptions);default:return VIe.warn("missing format descriptor for key {key}"),mce(t)}}function Hot(t,e){switch(e.toLowerCase()){case"dateformat":return LA(t);case"numberformat":return NA(t);default:return VIe.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?LA(t):/^numberformat/i.test(e)?NA(t):mce(t)}}function mce(t){switch(typeof t){case"string":return t;case"number":return NA(t);case"boolean":return""+t;default:return t instanceof Date?LA(t):""}}async function qot(t,e,r,i){const n=e.exec(r);if(!n)throw new pe("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const s=n[1]?`${n[1]}/`:"",o=n[2],a=Xrt(i),l=`${s}${o}.json`,c=a?`${s}${o}_${a}.json`:l;let u;try{u=await Dge(t(c))}catch(d){if(c===l)throw new pe("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:d});try{u=await Dge(t(l))}catch(p){throw new pe("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p})}}return u}async function Dge(t){if(M(Lge.fetchBundleAsset))return Lge.fetchBundleAsset(t);const e=await ns(t,{responseType:"text"});return JSON.parse(e.data)}let Wot=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let n;n=typeof i=="string"?s=>new URL(s,new URL(i,window.location.href)).href:i instanceof URL?s=>new URL(s,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return qot(this.getAssetUrl,this.matcher,e,r)}};function Qot(t){return new Wot(t)}const Lge={};Yrt(Qot({pattern:"esri/",location:nn}));const Yot={};function Xot(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=Yot.baseUrl),e}let Zot=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},sk=class{constructor(){this._dispatcher=new Zot,this._workerPostMessage({type:Wl.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){LR(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){LR(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=XD(e);if(r&&r.type===Wl.OPEN){const{modulePath:i,jobId:n}=r;let s=await R2.loadWorker(i);s||(s=await be(()=>import(i),[]));const o=R2.connect(s);this._workerPostMessage({type:Wl.OPENED,jobId:n,data:o})}}};const Hee=we.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:Jot}=Wl,Kot='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,version:r}=configuration.kernelInfo,{revision:t,version:n}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS API for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const i=outgoing.get(r);outgoing.delete(r),o.error?i.reject(JSON.parse(o.error)):i.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let g6,A6;const Nge="Failed to create Worker. Fallback to execute module in main thread";async function eat(){if(!Fe("esri-workers")||(Fe("mozilla"),0))return Fge(new sk);if(!g6&&!A6)try{const e=Kot.split('"{CONFIGURATION}"').join(`'${tat()}'`);g6=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){A6=e||{}}let t;if(g6)try{t=new Worker(g6,{name:"esri-worker-"+rat++})}catch{Hee.warn(Nge,A6),t=new sk}else Hee.warn(Nge,A6),t=new sk;return Fge(t)}async function Fge(t){return new Promise(e=>{function r(n){const s=XD(n);s&&s.type===Jot&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(n){n.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),Hee.warn("Failed to create Worker. Fallback to execute module in main thread",n),(t=new sk).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function tat(){let t;if(gn.default!=null){const n={...gn};delete n.default,t=JSON.parse(JSON.stringify(n))}else t=JSON.parse(JSON.stringify(gn));t.assetsPath=np(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?np(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=yu(),t.has={"esri-csp-restrictions":Fe("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":Fe("esri-2d-update-debug"),"featurelayer-pbf":Fe("featurelayer-pbf"),"featurelayer-simplify-thresholds":Fe("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":Fe("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":Fe("featurelayer-simplify-mobile-factor"),"esri-atomics":Fe("esri-atomics"),"esri-shared-array-buffer":Fe("esri-shared-array-buffer"),"esri-tiles-debug":Fe("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":Fe("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":Fe("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":Fe("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=np(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=np(t.workers.workerPath):t.workers.workerPath=np(nn("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=gn.workers.loaderConfig,r=Xot({baseUrl:e==null?void 0:e.baseUrl,locale:yu(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{version:wOe,buildDate:vOe,revision:bOe}})}let rat=0;const{ABORT:kge,INVOKE:iat,OPEN:nat,OPENED:sat,RESPONSE:lI}=Wl;let oat=class GIe{static async create(e){const r=await eat();return new GIe(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),we.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,n=zIe();return new Promise((s,o)=>{const a={resolve:s,reject:o,abortHandle:Wae(i,()=>{this._outJobs.delete(n),this._post({type:kge,jobId:n})})};this._outJobs.set(n,a),this._post({type:nat,jobId:n,modulePath:e})})}_onMessage(e){const r=XD(e);if(r)switch(r.type){case sat:this._onOpenedMessage(r);break;case lI:this._onResponseMessage(r);break;case kge:this._onAbortMessage(r);break;case iat:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,n=r.get(i);n&&(n.controller&&n.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,l=Ztt[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,n,{signal:o?o.signal:null})}catch(u){return void this._post({type:lI,jobId:i,error:YD(u)})}Op(c)?(a.set(i,{controller:o,promise:c}),c.then(u=>{a.has(i)&&(a.delete(i),this._post({type:lI,jobId:i},u))},u=>{a.has(i)&&(a.delete(i),u||(u={message:"Error encountered at method"+r}),$o(u)||this._post({type:lI,jobId:i,error:YD(u||{message:`Error encountered at method ${r}`})}))})):this._post({type:lI,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),ps(n.abortHandle),n.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:n}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),ps(s.abortHandle),i?s.reject(pe.fromJSON(JSON.parse(i))):s.resolve(n))}_post(e,r,i){return fce(this.worker,e,r,i)}},IT=Fe("esri-workers-debug")?1:Fe("esri-mobile")?Math.min(navigator.hardwareConcurrency-1,3):Fe("host-browser")?navigator.hardwareConcurrency-1:0;IT||(IT=Fe("safari")&&Fe("mac")?7:2);let Uge=0;const ok=[];function aat(){HIe()}async function y6(t,e){const r=new Vot;return await r.open(t,e),r}async function jIe(t,e={}){if(typeof t!="string")throw new pe("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(Fe("host-webworker")&&!Fe("esri-workers")&&(r="local"),r==="local"){let i=await R2.loadWorker(t);i||(i=await be(()=>import(t),[])),fi(e.signal);const n=e.client||i;return y6([R2.connect(i)],{...e,client:n})}if(await HIe(),fi(e.signal),r==="dedicated"){const i=Uge++%IT;return y6([await ok[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,IT);if(i<IT){const n=new Array(i);for(let s=0;s<i;++s){const o=Uge++%IT;n[s]=ok[o].open(t,e)}return y6(n,e)}}return y6(ok.map(i=>i.open(t,e)),e)}let _6=null;async function HIe(){if(_6)return _6;new AbortController;const t=[];for(let e=0;e<IT;e++){const r=oat.create(e).then(i=>(ok[e]=i,i));t.push(r)}return _6=Promise.all(t),_6}let _A=class extends rt{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new cn,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,r,i={}){return this._installWatch(e,r,i,xe)}addWhen(e,r,i={}){return this._installWatch(e,r,i,ic)}addOnCollectionChange(e,r,{initial:i=!1,final:n=!1}={}){const s=++this._handleId;return this._handles.add([Bo(e,"after-changes",this._createSyncUpdatingCallback(),fn),Bo(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:n?o=>r({added:[],removed:o.toArray()}):void 0})],s),{remove:()=>this._handles.remove(s)}}addPromise(e){if(k(e))return e;const r=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(v6)||this._set("updating",!1))}},r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this._handles.remove(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,r,i={},n){const s=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,s);const o=n(e,r,i);return this._handles.add(o,s),{remove:()=>this._handles.remove(s)}}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),n=xe(e,i,{sync:!0,equals:()=>!1});return this._handles.add(n,r),n}_createSyncUpdatingCallback(){return()=>{this._handles.remove(v6),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(WO(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(v6))}),v6)}}};h([f({readOnly:!0})],_A.prototype,"updating",void 0),_A=h([Q("esri.core.support.WatchUpdatingTracking")],_A);const v6=-42,_E=t=>{let e=class extends t{destroy(){var r,i;this.destroyed||((r=this._get("handles"))==null||r.destroy(),(i=this._get("updatingHandles"))==null||i.destroy())}get handles(){return this._get("handles")||new cn}get updatingHandles(){return this._get("updatingHandles")||new _A}};return h([f({readOnly:!0})],e.prototype,"handles",null),h([f({readOnly:!0})],e.prototype,"updatingHandles",null),e=h([Q("esri.core.HandleOwner")],e),e};let ZD=class extends _E(rt){};ZD=h([Q("esri.core.HandleOwner")],ZD);let T5=class extends _E(ur){constructor(e){super(e),this.handles.add([this.on("before-add",r=>{k(r.item)&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(ur.ofType(this.itemType.Type))(e):new ur(e)}};function PB(t,e){return{type:t,cast:kRe,set(r){const i=vS(r,this._get(e),t);i.owner=this,this._set(e,i)}}}h([f()],T5.prototype,"owner",null),T5=h([Q("esri.core.support.OwningCollection")],T5);var q$;const IB=$c()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),qIe=IB.jsonValues.slice();PD(qIe,"orthometric");const S5=$c()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let E0=q$=class extends Je{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return IB.write(t,e,r)}readHeightModel(t,e,r){return IB.read(t)||(r&&r.messages&&r.messages.push(lat(t,{context:r})),null)}readHeightUnit(t,e,r){return S5.read(t)||(r&&r.messages&&r.messages.push(Bge(t,{context:r})),null)}readHeightUnitService(t,e,r){return gOe(t)||S5.read(t)||(r&&r.messages&&r.messages.push(Bge(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new q$({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=Vtt(e);return new q$({heightModel:t.heightModel,heightUnit:r,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new q$;return e.read(t,{origin:"web-scene"}),e}};function Bge(t,e){return new IA("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function lat(t,e){return new IA("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}h([f({type:IB.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:qIe,default:"ellipsoidal"}}}})],E0.prototype,"heightModel",void 0),h([Ct("web-scene","heightModel")],E0.prototype,"writeHeightModel",null),h([gt(["web-scene","service"],"heightModel")],E0.prototype,"readHeightModel",null),h([f({type:S5.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:S5.jsonValues,write:S5.write}}}})],E0.prototype,"heightUnit",void 0),h([gt("web-scene","heightUnit")],E0.prototype,"readHeightUnit",null),h([gt("service","heightUnit")],E0.prototype,"readHeightUnitService",null),h([f({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],E0.prototype,"vertCRS",void 0),h([gt("service","vertCRS",["vertCRS","ellipsoid","geoid"])],E0.prototype,"readVertCRS",null),E0=q$=h([Q("esri.geometry.HeightModelInfo")],E0);const iP=E0;function Ia(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function KA(t,e,r,i,n,s,o,a,l,c,u,d,p,A,v,b,S){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=d,t[11]=p,t[12]=A,t[13]=v,t[14]=b,t[15]=S,t}function Xf(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function gd(t,e){if(t===e){const r=e[1],i=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function nP(t,e){return Ml(t,e)||Xf(t),t}function Ml(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],A=e[11],v=e[12],b=e[13],S=e[14],E=e[15],R=r*a-i*o,O=r*l-n*o,I=r*c-s*o,N=i*l-n*a,L=i*c-s*a,B=n*c-s*l,U=u*b-d*v,q=u*S-p*v,Z=u*E-A*v,X=d*S-p*b,ee=d*E-A*b,se=p*E-A*S;let ue=R*se-O*ee+I*X+N*Z-L*q+B*U;return ue?(ue=1/ue,t[0]=(a*se-l*ee+c*X)*ue,t[1]=(n*ee-i*se-s*X)*ue,t[2]=(b*B-S*L+E*N)*ue,t[3]=(p*L-d*B-A*N)*ue,t[4]=(l*Z-o*se-c*q)*ue,t[5]=(r*se-n*Z+s*q)*ue,t[6]=(S*I-v*B-E*O)*ue,t[7]=(u*B-p*I+A*O)*ue,t[8]=(o*ee-a*Z+c*U)*ue,t[9]=(i*Z-r*ee-s*U)*ue,t[10]=(v*L-b*I+E*R)*ue,t[11]=(d*I-u*L-A*R)*ue,t[12]=(a*q-o*X-l*U)*ue,t[13]=(r*X-i*q+n*U)*ue,t[14]=(b*O-v*N-S*R)*ue,t[15]=(u*N-d*O+p*R)*ue,t):null}function cat(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],A=e[11],v=e[12],b=e[13],S=e[14],E=e[15];return t[0]=a*(p*E-A*S)-d*(l*E-c*S)+b*(l*A-c*p),t[1]=-(i*(p*E-A*S)-d*(n*E-s*S)+b*(n*A-s*p)),t[2]=i*(l*E-c*S)-a*(n*E-s*S)+b*(n*c-s*l),t[3]=-(i*(l*A-c*p)-a*(n*A-s*p)+d*(n*c-s*l)),t[4]=-(o*(p*E-A*S)-u*(l*E-c*S)+v*(l*A-c*p)),t[5]=r*(p*E-A*S)-u*(n*E-s*S)+v*(n*A-s*p),t[6]=-(r*(l*E-c*S)-o*(n*E-s*S)+v*(n*c-s*l)),t[7]=r*(l*A-c*p)-o*(n*A-s*p)+u*(n*c-s*l),t[8]=o*(d*E-A*b)-u*(a*E-c*b)+v*(a*A-c*d),t[9]=-(r*(d*E-A*b)-u*(i*E-s*b)+v*(i*A-s*d)),t[10]=r*(a*E-c*b)-o*(i*E-s*b)+v*(i*c-s*a),t[11]=-(r*(a*A-c*d)-o*(i*A-s*d)+u*(i*c-s*a)),t[12]=-(o*(d*S-p*b)-u*(a*S-l*b)+v*(a*p-l*d)),t[13]=r*(d*S-p*b)-u*(i*S-n*b)+v*(i*p-n*d),t[14]=-(r*(a*S-l*b)-o*(i*S-n*b)+v*(i*l-n*a)),t[15]=r*(a*p-l*d)-o*(i*p-n*d)+u*(i*l-n*a),t}function uat(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],p=t[11],A=t[12],v=t[13],b=t[14],S=t[15];return(e*o-r*s)*(d*S-p*b)-(e*a-i*s)*(u*S-p*v)+(e*l-n*s)*(u*b-d*v)+(r*a-i*o)*(c*S-p*A)-(r*l-n*o)*(c*b-d*A)+(i*l-n*a)*(c*v-u*A)}function js(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=e[9],A=e[10],v=e[11],b=e[12],S=e[13],E=e[14],R=e[15];let O=r[0],I=r[1],N=r[2],L=r[3];return t[0]=O*i+I*a+N*d+L*b,t[1]=O*n+I*l+N*p+L*S,t[2]=O*s+I*c+N*A+L*E,t[3]=O*o+I*u+N*v+L*R,O=r[4],I=r[5],N=r[6],L=r[7],t[4]=O*i+I*a+N*d+L*b,t[5]=O*n+I*l+N*p+L*S,t[6]=O*s+I*c+N*A+L*E,t[7]=O*o+I*u+N*v+L*R,O=r[8],I=r[9],N=r[10],L=r[11],t[8]=O*i+I*a+N*d+L*b,t[9]=O*n+I*l+N*p+L*S,t[10]=O*s+I*c+N*A+L*E,t[11]=O*o+I*u+N*v+L*R,O=r[12],I=r[13],N=r[14],L=r[15],t[12]=O*i+I*a+N*d+L*b,t[13]=O*n+I*l+N*p+L*S,t[14]=O*s+I*c+N*A+L*E,t[15]=O*o+I*u+N*v+L*R,t}function Ah(t,e,r){const i=r[0],n=r[1],s=r[2];if(e===t)t[12]=e[0]*i+e[4]*n+e[8]*s+e[12],t[13]=e[1]*i+e[5]*n+e[9]*s+e[13],t[14]=e[2]*i+e[6]*n+e[10]*s+e[14],t[15]=e[3]*i+e[7]*n+e[11]*s+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],d=e[5],p=e[6],A=e[7],v=e[8],b=e[9],S=e[10],E=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=d,t[6]=p,t[7]=A,t[8]=v,t[9]=b,t[10]=S,t[11]=E,t[12]=o*i+u*n+v*s+e[12],t[13]=a*i+d*n+b*s+e[13],t[14]=l*i+p*n+S*s+e[14],t[15]=c*i+A*n+E*s+e[15]}return t}function HG(t,e,r){const i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function sd(t,e,r,i){let n,s,o,a,l,c,u,d,p,A,v,b,S,E,R,O,I,N,L,B,U,q,Z,X,ee=i[0],se=i[1],ue=i[2],re=Math.sqrt(ee*ee+se*se+ue*ue);return re<Dc()?null:(re=1/re,ee*=re,se*=re,ue*=re,n=Math.sin(r),s=Math.cos(r),o=1-s,a=e[0],l=e[1],c=e[2],u=e[3],d=e[4],p=e[5],A=e[6],v=e[7],b=e[8],S=e[9],E=e[10],R=e[11],O=ee*ee*o+s,I=se*ee*o+ue*n,N=ue*ee*o-se*n,L=ee*se*o-ue*n,B=se*se*o+s,U=ue*se*o+ee*n,q=ee*ue*o+se*n,Z=se*ue*o-ee*n,X=ue*ue*o+s,t[0]=a*O+d*I+b*N,t[1]=l*O+p*I+S*N,t[2]=c*O+A*I+E*N,t[3]=u*O+v*I+R*N,t[4]=a*L+d*B+b*U,t[5]=l*L+p*B+S*U,t[6]=c*L+A*B+E*U,t[7]=u*L+v*B+R*U,t[8]=a*q+d*Z+b*X,t[9]=l*q+p*Z+S*X,t[10]=c*q+A*Z+E*X,t[11]=u*q+v*Z+R*X,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ZR(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+c*i,t[5]=o*n+u*i,t[6]=a*n+d*i,t[7]=l*n+p*i,t[8]=c*n-s*i,t[9]=u*n-o*i,t[10]=d*n-a*i,t[11]=p*n-l*i,t}function qG(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],d=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-c*i,t[1]=o*n-u*i,t[2]=a*n-d*i,t[3]=l*n-p*i,t[8]=s*i+c*n,t[9]=o*i+u*n,t[10]=a*i+d*n,t[11]=l*i+p*n,t}function JR(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],d=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+c*i,t[1]=o*n+u*i,t[2]=a*n+d*i,t[3]=l*n+p*i,t[4]=c*n-s*i,t[5]=u*n-o*i,t[6]=d*n-a*i,t[7]=p*n-l*i,t}function WG(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function hat(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function bp(t,e,r){if(e===0)return Xf(t);let i,n,s,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<Dc()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),n=Math.cos(e),s=1-n,t[0]=o*o*s+n,t[1]=a*o*s+l*i,t[2]=l*o*s-a*i,t[3]=0,t[4]=o*a*s-l*i,t[5]=a*a*s+n,t[6]=l*a*s+o*i,t[7]=0,t[8]=o*l*s+a*i,t[9]=a*l*s-o*i,t[10]=l*l*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function WIe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dat(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function QIe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function YIe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=i+i,l=n+n,c=s+s,u=i*a,d=i*l,p=i*c,A=n*l,v=n*c,b=s*c,S=o*a,E=o*l,R=o*c;return t[0]=1-(A+b),t[1]=d+R,t[2]=p-E,t[3]=0,t[4]=d-R,t[5]=1-(u+b),t[6]=v+S,t[7]=0,t[8]=p+E,t[9]=v-S,t[10]=1-(u+A),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function pat(t,e){const r=fat,i=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=i*i+n*n+s*s+o*o;return d>0?(r[0]=2*(a*o+u*i+l*s-c*n)/d,r[1]=2*(l*o+u*n+c*i-a*s)/d,r[2]=2*(c*o+u*s+a*n-l*i)/d):(r[0]=2*(a*o+u*i+l*s-c*n),r[1]=2*(l*o+u*n+c*i-a*s),r[2]=2*(c*o+u*s+a*n-l*i)),YIe(t,e,r),t}const fat=G();function mat(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function XIe(t,e){const r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function gat(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function Aat(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3],l=n+n,c=s+s,u=o+o,d=n*l,p=n*c,A=n*u,v=s*c,b=s*u,S=o*u,E=a*l,R=a*c,O=a*u,I=i[0],N=i[1],L=i[2];return t[0]=(1-(v+S))*I,t[1]=(p+O)*I,t[2]=(A-R)*I,t[3]=0,t[4]=(p-O)*N,t[5]=(1-(d+S))*N,t[6]=(b+E)*N,t[7]=0,t[8]=(A+R)*L,t[9]=(b-E)*L,t[10]=(1-(d+v))*L,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function yat(t,e,r,i,n){const s=e[0],o=e[1],a=e[2],l=e[3],c=s+s,u=o+o,d=a+a,p=s*c,A=s*u,v=s*d,b=o*u,S=o*d,E=a*d,R=l*c,O=l*u,I=l*d,N=i[0],L=i[1],B=i[2],U=n[0],q=n[1],Z=n[2],X=(1-(b+E))*N,ee=(A+I)*N,se=(v-O)*N,ue=(A-I)*L,re=(1-(p+E))*L,te=(S+R)*L,j=(v+O)*B,H=(S-R)*B,W=(1-(p+b))*B;return t[0]=X,t[1]=ee,t[2]=se,t[3]=0,t[4]=ue,t[5]=re,t[6]=te,t[7]=0,t[8]=j,t[9]=H,t[10]=W,t[11]=0,t[12]=r[0]+U-(X*U+ue*q+j*Z),t[13]=r[1]+q-(ee*U+re*q+H*Z),t[14]=r[2]+Z-(se*U+te*q+W*Z),t[15]=1,t}function _at(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,d=i*a,p=n*o,A=n*a,v=n*l,b=s*o,S=s*a,E=s*l;return t[0]=1-d-v,t[1]=u+E,t[2]=p-S,t[3]=0,t[4]=u-E,t[5]=1-c-v,t[6]=A+b,t[7]=0,t[8]=p+S,t[9]=A-b,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ZIe(t,e,r,i,n,s,o){const a=1/(r-e),l=1/(n-i),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(n+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function vat(t,e,r,i,n){const s=1/Math.tan(e/2);let o;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(o=1/(i-n),t[10]=(n+i)*o,t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i),t}function bat(t,e,r,i){const n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(n-s)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function JIe(t,e,r,i,n,s,o){const a=1/(e-r),l=1/(i-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(n+i)*l,t[14]=(o+s)*c,t[15]=1,t}function QG(t,e,r,i){let n,s,o,a,l,c,u,d,p,A;const v=e[0],b=e[1],S=e[2],E=i[0],R=i[1],O=i[2],I=r[0],N=r[1],L=r[2],B=Dc();return Math.abs(v-I)<B&&Math.abs(b-N)<B&&Math.abs(S-L)<B?Xf(t):(u=v-I,d=b-N,p=S-L,A=1/Math.sqrt(u*u+d*d+p*p),u*=A,d*=A,p*=A,n=R*p-O*d,s=O*u-E*p,o=E*d-R*u,A=Math.sqrt(n*n+s*s+o*o),A?(A=1/A,n*=A,s*=A,o*=A):(n=0,s=0,o=0),a=d*o-p*s,l=p*n-u*o,c=u*s-d*n,A=Math.sqrt(a*a+l*l+c*c),A?(A=1/A,a*=A,l*=A,c*=A):(a=0,l=0,c=0),t[0]=n,t[1]=a,t[2]=u,t[3]=0,t[4]=s,t[5]=l,t[6]=d,t[7]=0,t[8]=o,t[9]=c,t[10]=p,t[11]=0,t[12]=-(n*v+s*b+o*S),t[13]=-(a*v+l*b+c*S),t[14]=-(u*v+d*b+p*S),t[15]=1,t)}function KIe(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let u=n-r[0],d=s-r[1],p=o-r[2],A=u*u+d*d+p*p;A>0&&(A=1/Math.sqrt(A),u*=A,d*=A,p*=A);let v=l*p-c*d,b=c*u-a*p,S=a*d-l*u;return A=v*v+b*b+S*S,A>0&&(A=1/Math.sqrt(A),v*=A,b*=A,S*=A),t[0]=v,t[1]=b,t[2]=S,t[3]=0,t[4]=d*S-p*b,t[5]=p*v-u*S,t[6]=u*b-d*v,t[7]=0,t[8]=u,t[9]=d,t[10]=p,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function wat(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function xat(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function Tat(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function e$e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Sat(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Eat(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function t$e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function gce(t,e){if(t===e)return!0;const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],A=t[11],v=t[12],b=t[13],S=t[14],E=t[15],R=e[0],O=e[1],I=e[2],N=e[3],L=e[4],B=e[5],U=e[6],q=e[7],Z=e[8],X=e[9],ee=e[10],se=e[11],ue=e[12],re=e[13],te=e[14],j=e[15],H=Dc();return Math.abs(r-R)<=H*Math.max(1,Math.abs(r),Math.abs(R))&&Math.abs(i-O)<=H*Math.max(1,Math.abs(i),Math.abs(O))&&Math.abs(n-I)<=H*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(s-N)<=H*Math.max(1,Math.abs(s),Math.abs(N))&&Math.abs(o-L)<=H*Math.max(1,Math.abs(o),Math.abs(L))&&Math.abs(a-B)<=H*Math.max(1,Math.abs(a),Math.abs(B))&&Math.abs(l-U)<=H*Math.max(1,Math.abs(l),Math.abs(U))&&Math.abs(c-q)<=H*Math.max(1,Math.abs(c),Math.abs(q))&&Math.abs(u-Z)<=H*Math.max(1,Math.abs(u),Math.abs(Z))&&Math.abs(d-X)<=H*Math.max(1,Math.abs(d),Math.abs(X))&&Math.abs(p-ee)<=H*Math.max(1,Math.abs(p),Math.abs(ee))&&Math.abs(A-se)<=H*Math.max(1,Math.abs(A),Math.abs(se))&&Math.abs(v-ue)<=H*Math.max(1,Math.abs(v),Math.abs(ue))&&Math.abs(b-re)<=H*Math.max(1,Math.abs(b),Math.abs(re))&&Math.abs(S-te)<=H*Math.max(1,Math.abs(S),Math.abs(te))&&Math.abs(E-j)<=H*Math.max(1,Math.abs(E),Math.abs(j))}function Ace(t){const e=Dc(),r=t[0],i=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(r*r+s*s+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}function YG(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const Cat=js,Mat=e$e;Object.freeze(Object.defineProperty({__proto__:null,add:Tat,adjoint:cat,copy:Ia,determinant:uat,equals:gce,exactEquals:t$e,frob:xat,fromQuat:_at,fromQuat2:pat,fromRotation:bp,fromRotationTranslation:YIe,fromRotationTranslationScale:Aat,fromRotationTranslationScaleOrigin:yat,fromScaling:hat,fromTranslation:WG,fromXRotation:WIe,fromYRotation:dat,fromZRotation:QIe,frustum:ZIe,getRotation:gat,getScaling:XIe,getTranslation:mat,hasIdentityRotation:YG,identity:Xf,invert:Ml,invertOrIdentity:nP,isOrthoNormal:Ace,lookAt:QG,mul:Cat,multiply:js,multiplyScalar:Sat,multiplyScalarAndAdd:Eat,ortho:JIe,perspective:vat,perspectiveFromFieldOfView:bat,rotate:sd,rotateX:ZR,rotateY:qG,rotateZ:JR,scale:HG,set:KA,str:wat,sub:Mat,subtract:e$e,targetTo:KIe,translate:Ah,transpose:gd},Symbol.toStringTag,{value:"Module"}));let EW,Ce=null;function r$e(){return!!Ce}function Rat(){return!!Fe("esri-wasm")}function i$e(){return EW||(EW=be(()=>import("./pe-wasm-67793c2f.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>nn(`esri/geometry/support/${e}`)})).then(t=>{s$e(t)}),EW)}var qee,no,JD;(function(t){function e(s,o,a){Ce.ensureCache.prepare();const l=fT(a),c=a===l,u=Ce.ensureFloat64(l),d=Ce._pe_geog_to_proj(Ce.getPointer(s),o,u);return d&&Eb(a,o,u,c),d}function r(s,o,a,l){switch(l){case no.PE_TRANSFORM_P_TO_G:return i(s,o,a);case no.PE_TRANSFORM_G_TO_P:return e(s,o,a)}return 0}function i(s,o,a){return n(s,o,a,0)}function n(s,o,a,l){Ce.ensureCache.prepare();const c=fT(a),u=a===c,d=Ce.ensureFloat64(c),p=Ce._pe_proj_to_geog_center(Ce.getPointer(s),o,d,l);return p&&Eb(a,o,d,u),p}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=n})(qee||(qee={})),function(t){function e(){t.PE_BUFFER_MAX=Ce.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=Ce.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=Ce.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=Ce.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=Ce.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=Ce.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=Ce.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=Ce.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=Ce.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=Ce.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=Ce.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=Ce.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=Ce.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=Ce.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=Ce.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=Ce.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=Ce.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=Ce.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=Ce.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=Ce.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=Ce.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=Ce.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=Ce.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=Ce.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=Ce.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=Ce.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=Ce.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=Ce.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=Ce.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=Ce.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(no||(no={})),function(t){const e={},r={},i=A=>{if(A){const v=A.getType();switch(v){case no.PE_TYPE_GEOGCS:A=Ce.castObject(A,Ce.PeGeogcs);break;case no.PE_TYPE_PROJCS:A=Ce.castObject(A,Ce.PeProjcs);break;case no.PE_TYPE_GEOGTRAN:A=Ce.castObject(A,Ce.PeGeogtran);break;default:v&no.PE_TYPE_UNIT&&(A=Ce.castObject(A,Ce.PeUnit))}}return A};function n(){Ce.PeFactory.prototype.initialize(null)}function s(A){return o(no.PE_TYPE_COORDSYS,A)}function o(A,v){let b=null,S=e[A];if(S||(S={},e[A]=S),S.hasOwnProperty(String(v)))b=S[v];else{const E=Ce.PeFactory.prototype.factoryByType(A,v);Ce.compare(E,Ce.NULL)||(b=E,S[v]=b)}return b=i(b),b}function a(A,v){let b=null,S=r[A];if(S||(S={},r[A]=S),S.hasOwnProperty(v))b=S[v];else{const E=Ce.PeFactory.prototype.fromString(A,v);Ce.compare(E,Ce.NULL)||(b=E,S[v]=b)}return b=i(b),b}function l(A){return o(no.PE_TYPE_GEOGCS,A)}function c(A){return o(no.PE_TYPE_GEOGTRAN,A)}function u(A){return Ce.PeFactory.prototype.getCode(A)}function d(A){return o(no.PE_TYPE_PROJCS,A)}function p(A){return o(no.PE_TYPE_UNIT,A)}t.initialize=n,t.coordsys=s,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=d,t.unit=p}(JD||(JD={}));let n$e=null;var $B,Wee,Qee,JT,qh,KD,n1,DB,Yee;function s$e(t){function e(s,o,a){s[o]=a(s[o])}Ce=t,no.init(),$B.init(),qh.init(),n1.init(),DB.init(),n$e=class extends Ce.PeGCSExtent{destroy(){Ce.destroy(this)}};const r=[Ce.PeDatum,Ce.PeGeogcs,Ce.PeGeogtran,Ce.PeObject,Ce.PeParameter,Ce.PePrimem,Ce.PeProjcs,Ce.PeSpheroid,Ce.PeUnit];for(const s of r)e(s.prototype,"getName",o=>function(){return o.call(this,new Array(no.PE_NAME_MAX))});for(const s of[Ce.PeGeogtran,Ce.PeProjcs])e(s.prototype,"getParameters",o=>function(){const a=new Array(no.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=Ce.getValue(l,"*");a[c]=u?Ce.wrapPointer(u,Ce.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(Ce.PeHorizon.prototype,"getCoord",s=>function(){const o=this.getSize();if(!o)return null;const a=[];return Eb(a,o,s.call(this)),a}),e(Ce.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const o=Ce._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=s.call(this);if(!Ce.compare(l,Ce.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=Ce.getPointer(l);for(let d=1;d<c;d++)a.push(Ce.wrapPointer(u+o*d,Ce.PeGTlistExtendedGTs))}}return a}});const i=Ce._pe_getPeHorizonSize(),n=s=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(s))return o.get(s);let a=null;const l=s.call(this);if(!Ce.compare(l,Ce.NULL)){a=[l];const c=l.getNump();if(c>1){const u=Ce.getPointer(l);for(let d=1;d<c;d++)a.push(Ce.wrapPointer(u+i*d,Ce.PeHorizon))}}return o.set(s,a),a};e(Ce.PeProjcs.prototype,"horizonGcsGenerate",n),e(Ce.PeProjcs.prototype,"horizonPcsGenerate",n),Ce.PeObject.prototype.toString=function(s=no.PE_STR_OPTS_NONE){Ce.ensureCache.prepare();const o=Ce.getPointer(this),a=Ce.ensureInt8(new Array(no.PE_BUFFER_MAX));return Ce.UTF8ToString(Ce._pe_object_to_string_ext(o,s,a))}}function dy(t){if(!t)return;const e=Ce.getClass(t);if(!e)return;const r=Ce.getCache(e);if(!r)return;const i=Ce.getPointer(t);i&&delete r[i]}function b6(t,e){const r=[],i=new Array(e);for(let n=0;n<t;n++)r.push(Ce.ensureInt8(i));return r}function fT(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function Eb(t,e,r,i=!1){if(i)for(let n=0;n<2*e;n++)t[n]=Ce.getValue(r+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=t.length===0;for(let s=0;s<e;s++)n&&(t[s]=new Array(2)),t[s][0]=Ce.getValue(r,"double"),t[s][1]=Ce.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=Ce.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=Ce._pe_getPeGTlistExtendedEntrySize()}function i(n,s,o,a,l,c){let u=null;const d=new Ce.PeInteger(c);try{const p=Ce.PeGTlistExtended.prototype.getGTlist(n,s,o,a,l,d);if((c=d.val)&&(u=[p],c>1)){const A=Ce.getPointer(p);for(let v=1;v<c;v++)u.push(Ce.wrapPointer(A+e*v,Ce.PeGTlistExtendedEntry))}}finally{Ce.destroy(d)}return u}t.init=r,t.getGTlist=i})($B||($B={})),function(t){function e(r){if(r&&r.length){for(const i of r)dy(i),i.getEntries().forEach(n=>{dy(n);const s=n.getGeogtran();dy(s),s.getParameters().forEach(dy),[s.getGeogcs1(),s.getGeogcs2()].forEach(o=>{dy(o);const a=o.getDatum();dy(a),dy(a.getSpheroid()),dy(o.getPrimem()),dy(o.getUnit())})});Ce.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(Wee||(Wee={})),function(t){function e(r,i,n,s,o){Ce.ensureCache.prepare();const a=fT(n),l=n===a,c=Ce.ensureFloat64(a);let u=0;s&&(u=Ce.ensureFloat64(s));const d=Ce._pe_geog_to_geog(Ce.getPointer(r),i,c,u,o);return d&&Eb(n,i,c,l),d}t.geogToGeog=e}(Qee||(Qee={})),function(t){const e=(c,u,d,p,A,v)=>{let b,S;switch(Ce.ensureCache.prepare(),c){case"dd":b=Ce._pe_geog_to_dd,S=no.PE_DD_MAX;break;case"ddm":b=Ce._pe_geog_to_ddm,S=no.PE_DDM_MAX;break;case"dms":b=Ce._pe_geog_to_dms,S=no.PE_DMS_MAX}let E=0;u&&(E=Ce.getPointer(u));const R=fT(p),O=Ce.ensureFloat64(R),I=b6(d,S),N=b(E,d,O,A,Ce.ensureInt32(I));if(N)for(let L=0;L<d;L++)v[L]=Ce.UTF8ToString(I[L]);return N},r=(c,u,d,p,A)=>{let v;switch(Ce.ensureCache.prepare(),c){case"dd":v=Ce._pe_dd_to_geog;break;case"ddm":v=Ce._pe_ddm_to_geog;break;case"dms":v=Ce._pe_dms_to_geog}let b=0;u&&(b=Ce.getPointer(u));const S=p.map(I=>Ce.ensureString(I)),E=Ce.ensureInt32(S),R=Ce.ensureFloat64(new Array(2*d)),O=v(b,d,E,R);return O&&Eb(A,d,R),O};function i(c,u,d,p,A){return e("dms",c,u,d,p,A)}function n(c,u,d,p){return r("dms",c,u,d,p)}function s(c,u,d,p,A){return e("ddm",c,u,d,p,A)}function o(c,u,d,p){return r("ddm",c,u,d,p)}function a(c,u,d,p,A){return e("dd",c,u,d,p,A)}function l(c,u,d,p){return r("dd",c,u,d,p)}t.geogToDms=i,t.dmsToGeog=n,t.geogToDdm=s,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(JT||(JT={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=Ce.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=Ce.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=Ce.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=Ce.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=Ce.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(n,s,o,a,l,c,u){Ce.ensureCache.prepare();let d=0;n&&(d=Ce.getPointer(n));const p=fT(o),A=Ce.ensureFloat64(p),v=b6(s,no.PE_MGRS_MAX),b=Ce.ensureInt32(v),S=Ce._pe_geog_to_mgrs_extended(d,s,A,a,l,c,b);if(S)for(let E=0;E<s;E++)u[E]=Ce.UTF8ToString(v[E]);return S}function i(n,s,o,a,l){Ce.ensureCache.prepare();let c=0;n&&(c=Ce.getPointer(n));const u=o.map(v=>Ce.ensureString(v)),d=Ce.ensureInt32(u),p=Ce.ensureFloat64(new Array(2*s)),A=Ce._pe_mgrs_to_geog_extended(c,s,d,a,p);return A&&Eb(l,s,p),A}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(qh||(qh={})),function(t){function e(i,n,s,o,a,l,c){Ce.ensureCache.prepare();let u=0;i&&(u=Ce.getPointer(i));const d=fT(s),p=Ce.ensureFloat64(d),A=b6(n,no.PE_MGRS_MAX),v=Ce.ensureInt32(A),b=Ce._pe_geog_to_usng(u,n,p,o,a,l,v);if(b)for(let S=0;S<n;S++)c[S]=Ce.UTF8ToString(A[S]);return b}function r(i,n,s,o){Ce.ensureCache.prepare();let a=0;i&&(a=Ce.getPointer(i));const l=s.map(p=>Ce.ensureString(p)),c=Ce.ensureInt32(l),u=Ce.ensureFloat64(new Array(2*n)),d=Ce._pe_usng_to_geog(a,n,c,u);return d&&Eb(o,n,u),d}t.geogToUsng=e,t.usngToGeog=r}(KD||(KD={})),function(t){function e(){t.PE_UTM_OPTS_NONE=Ce.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=Ce.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=Ce.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(n,s,o,a,l){Ce.ensureCache.prepare();let c=0;n&&(c=Ce.getPointer(n));const u=fT(o),d=Ce.ensureFloat64(u),p=b6(s,no.PE_UTM_MAX),A=Ce.ensureInt32(p),v=Ce._pe_geog_to_utm(c,s,d,a,A);if(v)for(let b=0;b<s;b++)l[b]=Ce.UTF8ToString(p[b]);return v}function i(n,s,o,a,l){Ce.ensureCache.prepare();let c=0;n&&(c=Ce.getPointer(n));const u=o.map(v=>Ce.ensureString(v)),d=Ce.ensureInt32(u),p=Ce.ensureFloat64(new Array(2*s)),A=Ce._pe_utm_to_geog(c,s,d,a,p);return A&&Eb(l,s,p),A}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(n1||(n1={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=Ce.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=Ce.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=Ce.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=Ce.PePCSInfo.prototype.PE_POLE_POINT}function i(n,s=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(n)&&(a=e.get(n),a[s]&&(o=a[s])),o||(o=Ce.PePCSInfo.prototype.generate(n,s),a||(a=[],e.set(n,a)),a[s]=o),o}t.init=r,t.generate=i}(DB||(DB={})),function(t){function e(){return Ce.PeVersion.prototype.version_string()}t.versionString=e}(Yee||(Yee={}));const Oat=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return qee},get PeDefs(){return no},get PeFactory(){return JD},get PeGCSExtent(){return n$e},get PeGTTransformations(){return Qee},get PeGTlistExtended(){return $B},get PeGTlistExtendedEntry(){return Wee},get PeNotationDms(){return JT},get PeNotationMgrs(){return qh},get PeNotationUsng(){return KD},get PeNotationUtm(){return n1},get PePCSInfo(){return DB},get PeVersion(){return Yee},_init:s$e,get _pe(){return Ce},isLoaded:r$e,isSupported:Rat,load:i$e},Symbol.toStringTag,{value:"Module"})),gor=Math.PI/180,Aor=/SPHEROID\[([^\]]+)]/i,Y1=yi.radius,h0=yi.eccentricitySquared,Pat={a1:Y1*h0,a2:Y1*h0*Y1*h0,a3:Y1*h0*h0/2,a4:Y1*h0*Y1*h0*2.5,a5:Y1*h0+Y1*h0*h0/2,a6:1-h0},yor={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:yi.radius,f:yi.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:t1.radius,f:t1.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:yA.radius,f:yA.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:yA.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let w6=0,CW=class Xee{static fromGE(e){const r=new Xee;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=w6++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=w6++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=w6++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=w6++}getInverse(){const e=new Xee;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},Zee=class W${static cacheKey(e,r){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(e){const r=new W$;let i="";for(const n of e.steps){const s=CW.fromGE(n);r.steps.push(s),i+=s.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const r of e.steps)r instanceof CW?this.steps.push(r):this.steps.push(new CW({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new W$;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[W$.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const s of this.steps)i+=s.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const n=this._cachedProjection[W$.cacheKey(e,r)];return n===void 0?null:n}};function o$e(t,e,r){if(k(e)||k(r)||r.vcsWkid||jo(e,r))return null;const i=xS(e)/xS(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return n=>Iat(n,i);case"polyline":case"esriGeometryPolyline":return n=>Dat(n,i);case"polygon":case"esriGeometryPolygon":return n=>$at(n,i);case"multipoint":case"esriGeometryMultipoint":return n=>Lat(n,i);case"extent":case"esriGeometryExtent":return n=>Nat(n,i);default:return null}}function Iat(t,e){t&&t.z!=null&&(t.z*=e)}function $at(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function Dat(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function Lat(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function Nat(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let d2=null,eL=null,MW=null,RW={};const a$e=new rle;function XG(){return!!d2&&r$e()}function tL(t){return k(MW)&&(MW=Promise.all([i$e(),be(()=>import("./geometryEngineBase-e1a33b0a.js"),[]).then(e=>e.g),be(()=>import("./hydrated-e58e5b2c.js"),[])])),MW.then(([,e,{hydratedAdapter:r}])=>{fi(t),eL=r,d2=e.default,d2._enableProjection(Oat),a$e.notify()})}function vE(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:zge(eL,t,t[0].spatialReference,e,r,i):zge(eL,[t],t.spatialReference,e,r,i)[0]}function zge(t,e,r,i,n=null,s=null){if(k(r)||k(i))return e;if(OS(r,i,n))return e.map(o=>l$e(o,r,i));if(k(n)){const o=Zee.cacheKey(r,i);RW[o]!==void 0?n=RW[o]:(n=kat(r,i,void 0),k(n)&&(n=new Zee),RW[o]=n)}if(k(d2)||k(t))throw new yce;return M(s)?d2._project(t,e,r,i,n,s):d2._project(t,e,r,i,n)}function _or(t,e){const r=Fat([t],e);return M(r.pending)?{pending:r.pending,geometry:null}:M(r.geometries)?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function Fat(t,e){if(!XG()){for(const r of t)if(M(r)&&!jo(r.spatialReference,e)&&xc(r.spatialReference)&&xc(e)&&!OS(r.spatialReference,e))return Ai(a$e),{pending:tL(),geometries:null}}return{pending:null,geometries:t.map(r=>k(r)?null:jo(r.spatialReference,e)?r:xc(r.spatialReference)&&xc(e)?Uat(r,e):null)}}function kat(t,e,r=null){if(k(t)||k(e))return null;if(k(d2)||k(eL))throw new yce;const i=d2._getTransformation(eL,t,e,r,r==null?void 0:r.spatialReference);return i!==null?Zee.fromGE(i):null}class yce extends pe{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var ye;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(ye||(ye={}));function Uat(t,e){try{const r=vE(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=o$e(r.type,t.spatialReference,e);return M(i)&&i(r),r}catch(r){if(!(r instanceof yce))throw r;return null}}function OS(t,e,r){return!r&&(!!jo(t,e)||xc(t)&&xc(e)&&!!wce(t,e,Tce))}async function Bat(t,e,r,i){if(XG())return Eme(i);if(Array.isArray(t)){for(const{source:n,dest:s,geographicTransformation:o}of t)if(!OS(n,s,o))return tL(i)}else if(!OS(t,e,r))return tL(i);return Eme(i)}function vor(t,e){switch(wce(t,e,Tce)){case es:return"copy3";case jb:return"wgs84ToSphericalECEF";case PS:return"wgs84ToWebMercator";case Gb:return"wgs84ToPlateCarree";case qb:return"wgs84ToWGS84ECEF";case KT:return"webMercatorToWGS84";case f$e:return"webMercatorToSphericalECEF";case m$e:return"webMercatorToWGS84ECEF";case g$e:return"webMercatorToPlateCarree";case Wb:return"wgs84ECEFToWGS84";case _$e:return"wgs84ECEFToSphericalECEF";case v$e:return"wgs84ECEFToWebMercator";case Hb:return"sphericalECEFToWGS84";case A$e:return"sphericalECEFToWebMercator";case tte:return"sphericalMarsPCPFToMars2000";case ete:return"sphericalMoonPCPFToMoon2000";case y$e:return"sphericalECEFToWGS84ECEF";case Kee:return"mars2000ToSphericalPCPF";case Jee:return"moon2000ToSphericalPCPF";default:return null}}function l$e(t,e,r){return t?"x"in t?c$e(t,e,new Ht,r,0):"xmin"in t?jat(t,e,new an,r,0):"rings"in t?u$e(t,e,new Hf,r,0):"paths"in t?Gat(t,e,new cm,r,0):"points"in t?Vat(t,e,new CN,r,0):null:null}function zat(t,e,r=e.spatialReference,i=0){return M(r)&&M(t.spatialReference)&&M(c$e(t,t.spatialReference,e,r,i))}function c$e(t,e,r,i,n){mn[0]=t.x,mn[1]=t.y;const s=t.z;return mn[2]=s!==void 0?s:n,qs(mn,e,0,mn,i,0,1)?(r.x=mn[0],r.y=mn[1],r.spatialReference=i,s===void 0?(r.z=void 0,r.hasZ=!1):(r.z=mn[2],r.hasZ=!0),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function Vat(t,e,r,i,n){const{points:s,hasZ:o,hasM:a}=t,l=[],c=s.length,u=[];for(const d of s)u.push(d[0],d[1],o?d[2]:n);if(!qs(u,e,0,u,i,0,c))return null;for(let d=0;d<c;++d){const p=3*d,A=u[p],v=u[p+1];o&&a?l.push([A,v,u[p+2],s[d][3]]):o?l.push([A,v,u[p+2]]):a?l.push([A,v,s[d][2]]):l.push([A,v])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function Gat(t,e,r,i,n){const{paths:s,hasZ:o,hasM:a}=t,l=[];return d$e(s,o??!1,a??!1,e,l,i,n)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function bor(t,e,r=e.spatialReference,i=0){return M(t.spatialReference)&&M(r)&&M(u$e(t,t.spatialReference,e,r,i))}function u$e(t,e,r,i,n){const{rings:s,hasZ:o,hasM:a}=t,l=[];return d$e(s,o??!1,a??!1,e,l,i,n)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function jat(t,e,r,i,n){const{xmin:s,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t;return Vge(s,o,c?t.zmin:n,e,mn,i)?(r.xmin=mn[0],r.ymin=mn[1],c&&(r.zmin=mn[2]),Vge(a,l,c?t.zmax:n,e,mn,i)?(r.xmax=mn[0],r.ymax=mn[1],c&&(r.zmax=mn[2]),u&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null):null}function O2(t,e,r){if(k(e)||k(r))return null;const i=new Ht({spatialReference:r});return qs(t,e,0,mn,r,0,1)?(i.x=mn[0],i.y=mn[1],i.z=mn[2],i):null}function h$e(t,e,r){return qs(t,e,0,mn,r.spatialReference,0,1)?(r.x=mn[0],r.y=mn[1],r.z=mn[2],r):null}function nc(t,e,r,i=0){mn[0]=t.x,mn[1]=t.y;const n=t.z;return mn[2]=n!==void 0?n:i,qs(mn,t.spatialReference,0,e,r,0,1)}function Vge(t,e,r,i,n,s){return zs[0]=t,zs[1]=e,zs[2]=r,qs(zs,i,0,n,s,0,1)}function il(t,e,r,i){return!(k(e)||k(i)||t.length<2)&&(t.length===2&&(zs[0]=t[0],zs[1]=t[1],zs[2]=0,t=zs),qs(t,e,0,r,i,0,1))}function Hat(t,e){mn[0]=t.x,mn[1]=t.y;const r=t.z;return mn[2]=r!==void 0?r:0,qat(mn,t.spatialReference,e)}function qat(t,e,r){return Wat(t,e,r)}function Wat(t,e,r){if(k(e))return!1;const i=P2(e,JG),n=uA[i][ye.WGS84_COMPARABLE_LON_LAT];return!k(n)&&(n(t,0,zs,0),r!==zs&&(r[0]=zs[0],r[1]=zs[1],r.length>2&&(r[2]=zs[2])),!0)}function qs(t,e,r,i,n,s,o=1){const a=wce(e,n,Tce);if(k(a))return!1;if(a===es){if(t===i&&r===s)return!0;const c=r+3*o;for(let u=r,d=s;u<c;u++,d++)i[d]=t[u];return!0}const l=r+3*o;for(let c=r,u=s;c<l;c+=3,u+=3)a(t,c,i,u);return!0}function wor(t,e,r,i,n){Pe(mn,t),ze(x6,t,e),il(mn,r,mn,n),il(x6,r,x6,n),Ve(i,x6,mn),Ye(i,i)}function d$e(t,e,r,i,n,s,o=0){const a=new Array;for(const c of t)for(const u of c)a.push(u[0],u[1],e?u[2]:o);if(!qs(a,i,0,a,s,0,a.length/3))return!1;let l=0;n.length=0;for(const c of t){const u=new Array;for(const d of c)e&&r?u.push([a[l++],a[l++],a[l++],d[3]]):e?u.push([a[l++],a[l++],a[l++]]):r?(u.push([a[l++],a[l++],d[2]]),l++):(u.push([a[l++],a[l++]]),l++);n.push(u)}return!0}function xor(t,e,r,i){if(k(e)||k(i))return!1;const n=b$e(e,i,rlt);if(n.projector===es)return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],!0;if(k(n.projector))return!1;const{source:s,dest:o}=n;if(o.spatialReferenceId===ye.WEB_MERCATOR){const a=uA[s.spatialReferenceId][ye.WGS84];return!k(a)&&(a(t,0,H0,0),PS(H0,0,r,0),r[3]=Gge(H0[1],t[2],t[3],yi.radius),!0)}if(s.spatialReferenceId!==ye.WGS84&&s.spatialReferenceId!==ye.CGCS2000||o.spatialReferenceId!==ye.PLATE_CARREE){n.projector(t,0,r,0);const a=s.metersPerUnit??1,l=o.metersPerUnit??1;r[3]=t[3]*a/l}else{const a=uA[s.spatialReferenceId][ye.SPHERICAL_ECEF],l=uA[ye.SPHERICAL_ECEF][ye.PLATE_CARREE];let c=t[3];M(a)&&M(l)&&(c=Gge(t[1],t[2],t[3],yi.radius)),n.projector(t,0,r,0),r[3]=c}return!0}function Gge(t,e,r,i){const n=i+e;if(n<i/2||r>n)return Number.MAX_VALUE;const s=Math.abs(dm*t)+Math.asin(r/n);return s>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(s)}function ZG(t,e,r,i){return t!=null&&(jo(e,i)?(i1(r,t),!0):(zs[0]=t[0],zs[1]=t[1],zs[2]=0,!!qs(zs,e,0,zs,i,0,1)&&(r[0]=zs[0],r[1]=zs[1],zs[0]=t[2],zs[1]=t[3],zs[2]=0,!!qs(zs,e,0,zs,i,0,1)&&(r[2]=zs[0],r[3]=zs[1],!0))))}function Tor(t,e,r,i){if(k(e)||k(i))return!1;const n=P2(e,JG),s=P2(i,w$e);if(n===s&&n!==ye.UNKNOWN||jo(e,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(n===ye.SPHERICAL_ECEF){const o=ct(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/yi.radius;if(s===ye.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(s===ye.WGS84||s===ye.CGCS2000){const c=E5;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(n===ye.PLATE_CARREE){if(s===ye.WGS84||s===ye.CGCS2000)return r[0]=E5,r[1]=E5,r[2]=1,!0;if(s===ye.WEB_MERCATOR){const o=t[1]/yi.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function Lm(t,e,r,i){if(k(t)||k(i))return!1;const n=P2(t,JG),s=P2(i,w$e);if(n===s&&!jge(s)&&(n!==ye.UNKNOWN||jo(t,i)))return WG(r,e),!0;if(jge(s)){const o=uA[n][ye.LON_LAT],a=uA[ye.LON_LAT][s];return!k(o)&&!k(a)&&(o(e,0,H0,0),a(H0,0,X1,0),p$e(dm*H0[0],dm*H0[1],r),r[12]=X1[0],r[13]=X1[1],r[14]=X1[2],!0)}if((s===ye.WEB_MERCATOR||s===ye.PLATE_CARREE)&&(n===ye.WGS84||n===ye.CGCS2000&&s===ye.PLATE_CARREE||n===ye.SPHERICAL_ECEF||n===ye.WEB_MERCATOR)){const o=uA[n][ye.LON_LAT],a=uA[ye.LON_LAT][s];return!k(o)&&!k(a)&&(o(e,0,H0,0),a(H0,0,X1,0),n===ye.SPHERICAL_ECEF?Qat(dm*H0[0],dm*H0[1],r):Xf(r),r[12]=X1[0],r[13]=X1[1],r[14]=X1[2],!0)}return!1}function jge(t){return t===ye.SPHERICAL_ECEF||t===ye.SPHERICAL_MARS_PCPF||t===ye.SPHERICAL_MOON_PCPF}function p$e(t,e,r){const i=Math.sin(t),n=Math.cos(t),s=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function Qat(t,e,r){return p$e(t,e,r),gd(r,r),r}function P2(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Eu(t,1)),t.wkt===lOe.wkt?e.spatialReferenceId=ye.SPHERICAL_ECEF:FD(t)?e.spatialReferenceId=ye.WGS84:wS(t)?e.spatialReferenceId=ye.WEB_MERCATOR:fle(t)?e.spatialReferenceId=ye.PLATE_CARREE:t.wkt===cOe.wkt?e.spatialReferenceId=ye.WGS84_ECEF:t.wkid===Sf.CGCS2000?e.spatialReferenceId=ye.CGCS2000:t.wkt===yle.wkt?e.spatialReferenceId=ye.SPHERICAL_MARS_PCPF:t.wkt===_le.wkt?e.spatialReferenceId=ye.SPHERICAL_MOON_PCPF:XA(t)?e.spatialReferenceId=ye.GCSMARS2000:ZA(t)?e.spatialReferenceId=ye.GCSMOON2000:e.spatialReferenceId=ye.UNKNOWN):ye.UNKNOWN}function es(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function KT(t,e,r,i){r[i++]=KR*(t[e++]/yi.radius),r[i++]=KR*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/yi.radius))),r[i]=t[e]}function f$e(t,e,r,i){KT(t,e,r,i),jb(r,i,r,i)}function m$e(t,e,r,i){KT(t,e,r,i),qb(r,i,r,i)}function _ce(t,e,r,i,n){const s=.4999999*Math.PI,o=He(dm*t[e+1],-s,s),a=Math.sin(o);r[i++]=dm*t[e]*n.radius,r[i++]=n.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function PS(t,e,r,i){_ce(t,e,r,i,yi)}const Hge=yi.radius*Math.PI/180,E5=180/(yi.radius*Math.PI);function Gb(t,e,r,i){r[i]=t[e]*Hge,r[i+1]=t[e+1]*Hge,r[i+2]=t[e+2]}function $T(t,e,r,i){r[i]=t[e]*E5,r[i+1]=t[e+1]*E5,r[i+2]=t[e+2]}function g$e(t,e,r,i){KT(t,e,r,i),Gb(r,i,r,i)}function Yat(t,e,r,i){Wb(t,e,r,i),Gb(r,i,r,i)}function Xat(t,e,r,i){Hb(t,e,r,i),Gb(r,i,r,i)}function Zat(t,e,r,i){$T(t,e,r,i),jb(r,i,r,i)}function Jat(t,e,r,i){$T(t,e,r,i),PS(r,i,r,i)}function Kat(t,e,r,i){$T(t,e,r,i),qb(r,i,r,i)}function IS(t){if(k(t))return!1;const e=P2(t,JG);return!!uA[e][ye.WGS84_COMPARABLE_LON_LAT]}function elt(t,e,r,i){const n=Math.cos(r);t[0]=Math.cos(e)*n*i,t[1]=Math.sin(e)*n*i,t[2]=Math.sin(r)*i}function vce(t,e,r,i,n){const s=n+t[e+2],o=dm*t[e+1],a=dm*t[e],l=Math.cos(o);r[i++]=Math.cos(a)*l*s,r[i++]=Math.sin(a)*l*s,r[i]=Math.sin(o)*s}function Jee(t,e,r,i){vce(t,e,r,i,t1.radius)}function Kee(t,e,r,i){vce(t,e,r,i,yA.radius)}function jb(t,e,r,i){vce(t,e,r,i,yi.radius)}function bce(t,e,r,i,n){const s=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(s*s+o*o+a*a),c=jf(a/(l===0?1:l)),u=Math.atan2(o,s);r[i++]=KR*u,r[i++]=KR*c,r[i]=l-n}function ete(t,e,r,i){bce(t,e,r,i,t1.radius)}function tte(t,e,r,i){bce(t,e,r,i,yA.radius)}function Hb(t,e,r,i){bce(t,e,r,i,yi.radius)}function A$e(t,e,r,i){Hb(t,e,r,i),PS(r,i,r,i)}function y$e(t,e,r,i){Hb(t,e,r,i),qb(r,i,r,i)}function tlt(t,e,r,i,n){const s=dm*t[e],o=dm*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);r[i++]=(u+a)*c*Math.cos(s),r[i++]=(u+a)*c*Math.sin(s),r[i++]=(u*(1-n.eccentricitySquared)+a)*l}function qb(t,e,r,i){tlt(t,e,r,i,yi)}function Wb(t,e,r,i){const n=Pat,s=t[e],o=t[e+1],a=t[e+2];let l,c,u,d,p,A,v,b,S,E,R,O,I,N,L,B,U,q,Z,X,ee;l=Math.abs(a),c=s*s+o*o,u=Math.sqrt(c),d=c+a*a,p=Math.sqrt(d),X=Math.atan2(o,s),A=a*a/d,v=c/d,N=n.a2/p,L=n.a3-n.a4/p,v>.3?(b=l/p*(1+v*(n.a1+N+A*L)/p),Z=Math.asin(b),E=b*b,S=Math.sqrt(1-E)):(S=u/p*(1-A*(n.a5-N-v*L)/p),Z=Math.acos(S),E=1-S*S,b=Math.sqrt(E)),R=1-yi.eccentricitySquared*E,O=yi.radius/Math.sqrt(R),I=n.a6*O,N=u-O*S,L=l-I*b,U=S*N+b*L,B=S*L-b*N,q=B/(I/R+U),Z+=q,ee=U+B*q/2,a<0&&(Z=-Z),r[i++]=KR*X,r[i++]=KR*Z,r[i]=ee}function _$e(t,e,r,i){Wb(t,e,r,i),jb(r,i,r,i)}function v$e(t,e,r,i){Wb(t,e,r,i),PS(r,i,r,i)}const uA={[ye.WGS84]:{[ye.CGCS2000]:null,[ye.GCSMARS2000]:null,[ye.GCSMOON2000]:null,[ye.LON_LAT]:es,[ye.WGS84_COMPARABLE_LON_LAT]:es,[ye.SPHERICAL_ECEF]:jb,[ye.SPHERICAL_MARS_PCPF]:null,[ye.SPHERICAL_MOON_PCPF]:null,[ye.UNKNOWN]:null,[ye.WEB_MERCATOR]:PS,[ye.PLATE_CARREE]:Gb,[ye.WGS84]:es,[ye.WGS84_ECEF]:qb},[ye.CGCS2000]:{[ye.CGCS2000]:es,[ye.GCSMARS2000]:null,[ye.GCSMOON2000]:null,[ye.LON_LAT]:es,[ye.WGS84_COMPARABLE_LON_LAT]:es,[ye.SPHERICAL_ECEF]:jb,[ye.SPHERICAL_MARS_PCPF]:null,[ye.SPHERICAL_MOON_PCPF]:null,[ye.UNKNOWN]:null,[ye.WEB_MERCATOR]:null,[ye.PLATE_CARREE]:Gb,[ye.WGS84]:null,[ye.WGS84_ECEF]:qb},[ye.GCSMARS2000]:{[ye.CGCS2000]:null,[ye.GCSMARS2000]:es,[ye.GCSMOON2000]:null,[ye.LON_LAT]:es,[ye.WGS84_COMPARABLE_LON_LAT]:null,[ye.SPHERICAL_ECEF]:null,[ye.SPHERICAL_MARS_PCPF]:Kee,[ye.SPHERICAL_MOON_PCPF]:null,[ye.UNKNOWN]:null,[ye.WEB_MERCATOR]:null,[ye.PLATE_CARREE]:null,[ye.WGS84]:null,[ye.WGS84_ECEF]:null},[ye.GCSMOON2000]:{[ye.CGCS2000]:null,[ye.GCSMARS2000]:null,[ye.GCSMOON2000]:es,[ye.LON_LAT]:es,[ye.WGS84_COMPARABLE_LON_LAT]:null,[ye.SPHERICAL_ECEF]:null,[ye.SPHERICAL_MARS_PCPF]:null,[ye.SPHERICAL_MOON_PCPF]:Jee,[ye.UNKNOWN]:null,[ye.WEB_MERCATOR]:null,[ye.PLATE_CARREE]:null,[ye.WGS84]:null,[ye.WGS84_ECEF]:null},[ye.WEB_MERCATOR]:{[ye.CGCS2000]:null,[ye.GCSMARS2000]:null,[ye.GCSMOON2000]:null,[ye.LON_LAT]:KT,[ye.WGS84_COMPARABLE_LON_LAT]:KT,[ye.SPHERICAL_ECEF]:f$e,[ye.SPHERICAL_MARS_PCPF]:null,[ye.SPHERICAL_MOON_PCPF]:null,[ye.UNKNOWN]:null,[ye.WEB_MERCATOR]:es,[ye.PLATE_CARREE]:g$e,[ye.WGS84]:KT,[ye.WGS84_ECEF]:m$e},[ye.WGS84_ECEF]:{[ye.CGCS2000]:Wb,[ye.GCSMARS2000]:null,[ye.GCSMOON2000]:null,[ye.LON_LAT]:Wb,[ye.WGS84_COMPARABLE_LON_LAT]:Wb,[ye.SPHERICAL_ECEF]:_$e,[ye.SPHERICAL_MARS_PCPF]:null,[ye.SPHERICAL_MOON_PCPF]:null,[ye.UNKNOWN]:null,[ye.WEB_MERCATOR]:v$e,[ye.PLATE_CARREE]:Yat,[ye.WGS84]:Wb,[ye.WGS84_ECEF]:es},[ye.SPHERICAL_ECEF]:{[ye.CGCS2000]:Hb,[ye.GCSMARS2000]:null,[ye.GCSMOON2000]:null,[ye.LON_LAT]:Hb,[ye.WGS84_COMPARABLE_LON_LAT]:Hb,[ye.SPHERICAL_ECEF]:es,[ye.SPHERICAL_MARS_PCPF]:null,[ye.SPHERICAL_MOON_PCPF]:null,[ye.UNKNOWN]:null,[ye.WEB_MERCATOR]:A$e,[ye.PLATE_CARREE]:Xat,[ye.WGS84]:Hb,[ye.WGS84_ECEF]:y$e},[ye.SPHERICAL_MARS_PCPF]:{[ye.CGCS2000]:null,[ye.GCSMARS2000]:tte,[ye.GCSMOON2000]:null,[ye.LON_LAT]:tte,[ye.WGS84_COMPARABLE_LON_LAT]:null,[ye.SPHERICAL_ECEF]:null,[ye.SPHERICAL_MARS_PCPF]:es,[ye.SPHERICAL_MOON_PCPF]:null,[ye.UNKNOWN]:null,[ye.WEB_MERCATOR]:null,[ye.PLATE_CARREE]:null,[ye.WGS84]:null,[ye.WGS84_ECEF]:null},[ye.SPHERICAL_MOON_PCPF]:{[ye.CGCS2000]:null,[ye.GCSMARS2000]:null,[ye.GCSMOON2000]:ete,[ye.LON_LAT]:ete,[ye.WGS84_COMPARABLE_LON_LAT]:null,[ye.SPHERICAL_ECEF]:null,[ye.SPHERICAL_MARS_PCPF]:null,[ye.SPHERICAL_MOON_PCPF]:es,[ye.UNKNOWN]:null,[ye.WEB_MERCATOR]:null,[ye.PLATE_CARREE]:null,[ye.WGS84]:null,[ye.WGS84_ECEF]:null},[ye.UNKNOWN]:{[ye.CGCS2000]:null,[ye.GCSMARS2000]:null,[ye.GCSMOON2000]:null,[ye.LON_LAT]:null,[ye.WGS84_COMPARABLE_LON_LAT]:null,[ye.SPHERICAL_ECEF]:null,[ye.SPHERICAL_MARS_PCPF]:null,[ye.SPHERICAL_MOON_PCPF]:null,[ye.UNKNOWN]:es,[ye.WEB_MERCATOR]:null,[ye.PLATE_CARREE]:null,[ye.WGS84]:null,[ye.WGS84_ECEF]:null},[ye.LON_LAT]:{[ye.CGCS2000]:es,[ye.GCSMARS2000]:es,[ye.GCSMOON2000]:es,[ye.LON_LAT]:es,[ye.WGS84_COMPARABLE_LON_LAT]:es,[ye.SPHERICAL_ECEF]:jb,[ye.SPHERICAL_MARS_PCPF]:Kee,[ye.SPHERICAL_MOON_PCPF]:Jee,[ye.UNKNOWN]:null,[ye.WEB_MERCATOR]:PS,[ye.PLATE_CARREE]:Gb,[ye.WGS84]:es,[ye.WGS84_ECEF]:qb},[ye.WGS84_COMPARABLE_LON_LAT]:{[ye.CGCS2000]:null,[ye.GCSMARS2000]:null,[ye.GCSMOON2000]:null,[ye.LON_LAT]:es,[ye.WGS84_COMPARABLE_LON_LAT]:es,[ye.SPHERICAL_ECEF]:jb,[ye.SPHERICAL_MARS_PCPF]:null,[ye.SPHERICAL_MOON_PCPF]:null,[ye.UNKNOWN]:null,[ye.WEB_MERCATOR]:null,[ye.PLATE_CARREE]:Gb,[ye.WGS84]:es,[ye.WGS84_ECEF]:qb},[ye.PLATE_CARREE]:{[ye.CGCS2000]:$T,[ye.GCSMARS2000]:null,[ye.GCSMOON2000]:null,[ye.LON_LAT]:$T,[ye.WGS84_COMPARABLE_LON_LAT]:$T,[ye.SPHERICAL_ECEF]:Zat,[ye.SPHERICAL_MARS_PCPF]:null,[ye.SPHERICAL_MOON_PCPF]:null,[ye.UNKNOWN]:null,[ye.WEB_MERCATOR]:Jat,[ye.PLATE_CARREE]:es,[ye.WGS84]:$T,[ye.WGS84_ECEF]:Kat}};function wce(t,e,r=xce()){return k(t)||k(e)?null:b$e(t,e,r).projector}function b$e(t,e,r){if(k(t)||k(e)||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=P2(t,r.source),n=P2(e,r.dest);return i===ye.UNKNOWN&&n===ye.UNKNOWN?jo(t,e)?r.projector=es:r.projector=null:r.projector=uA[i][n],r}function xce(){return{source:{spatialReference:null,spatialReferenceId:ye.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:ye.UNKNOWN,metersPerUnit:1},projector:es}}const JG={spatialReference:null,spatialReferenceId:ye.UNKNOWN},w$e={spatialReference:null,spatialReferenceId:ye.UNKNOWN},Tce=xce(),rlt=xce(),dm=Dr(1),KR=xu(1),zs=G(),H0=G(),X1=G(),mn=G(),x6=G();let v1=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&LR(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*qge);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,qge));e++)this._items.push(this._allocator())}};const qge=1024;function ht(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function eO(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function Sce(t,e,r,i,n,s,o,a,l,c,u,d,p,A,v,b){return[t,e,r,i,n,s,o,a,l,c,u,d,p,A,v,b]}function x$e(t,e){return new Float64Array(t,e,16)}const wp=ht();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:wp,clone:eO,create:ht,createView:x$e,fromValues:Sce},Symbol.toStringTag,{value:"Module"}));var od;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(od||(od={}));function T$e(t){return 32+t.length}function S$e(t){return 16}function E$e(t){if(!t)return 0;let e=R$e;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=T$e(i);break;case"number":e+=S$e();break;case"boolean":e+=4}}return e}function C$e(t){if(!t)return 0;if(Array.isArray(t))return ilt(t);let e=R$e;for(const r in t)t.hasOwnProperty(r)&&(e+=M$e(t[r]));return e}function ilt(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=O$e;for(let i=0;i<e;i++)r+=M$e(t[i]);return r}function M$e(t){switch(typeof t){case"object":return C$e(t);case"string":return T$e(t);case"number":return S$e();case"boolean":return 4;default:return 8}}function Eor(t,e){return O$e+t.length*e}const R$e=32,O$e=32;var tO;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(tO||(tO={}));function Es(){return[1,0,0,0,1,0,0,0,1]}function nlt(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function slt(t,e,r,i,n,s,o,a,l){return[t,e,r,i,n,s,o,a,l]}function P$e(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:nlt,create:Es,createView:P$e,fromValues:slt},Symbol.toStringTag,{value:"Module"}));function n0(){return[0,0,0,1]}function olt(t){return[t[0],t[1],t[2],t[3]]}function alt(t,e,r,i){return[t,e,r,i]}function I$e(t,e){return new Float64Array(t,e,4)}const llt=n0();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:llt,clone:olt,create:n0,createView:I$e,fromValues:alt},Symbol.toStringTag,{value:"Module"}));function Ft(){return[0,0]}function Q$(t){return[t[0],t[1]]}function Gi(t,e){return[t,e]}function $$e(t){const e=Ft(),r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function D$e(t,e){return new Float64Array(t,e,2)}function L$e(){return Ft()}function N$e(){return Gi(1,1)}function F$e(){return Gi(1,0)}function k$e(){return Gi(0,1)}const yh=L$e(),U$e=N$e(),clt=F$e(),ult=k$e();Object.freeze(Object.defineProperty({__proto__:null,ONES:U$e,UNIT_X:clt,UNIT_Y:ult,ZEROS:yh,clone:Q$,create:Ft,createView:D$e,fromArray:$$e,fromValues:Gi,ones:N$e,unitX:F$e,unitY:k$e,zeros:L$e},Symbol.toStringTag,{value:"Module"}));function Kr(){return[0,0,0,0]}function DN(t){return[t[0],t[1],t[2],t[3]]}function Fr(t,e,r,i){return[t,e,r,i]}function Ece(t){const e=Kr(),r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function B$e(t,e){return new Float64Array(t,e,4)}function z$e(){return Kr()}function V$e(){return Fr(1,1,1,1)}function G$e(){return Fr(1,0,0,0)}function j$e(){return Fr(0,1,0,0)}function H$e(){return Fr(0,0,1,0)}function q$e(){return Fr(0,0,0,1)}const vA=z$e(),Ef=V$e(),hlt=G$e(),dlt=j$e(),plt=H$e(),flt=q$e();Object.freeze(Object.defineProperty({__proto__:null,ONES:Ef,UNIT_W:flt,UNIT_X:hlt,UNIT_Y:dlt,UNIT_Z:plt,ZEROS:vA,clone:DN,create:Kr,createView:B$e,fromArray:Ece,fromValues:Fr,ones:V$e,unitW:q$e,unitX:G$e,unitY:j$e,unitZ:H$e,zeros:z$e},Symbol.toStringTag,{value:"Module"}));let sP=class Cx{constructor(e,r,i){this._itemByteSize=e,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&LR(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=zE){return new Cx(16,D$e,e)}static createVec3f64(e=zE){return new Cx(24,Rle,e)}static createVec4f64(e=zE){return new Cx(32,B$e,e)}static createMat3f64(e=zE){return new Cx(72,P$e,e)}static createMat4f64(e=zE){return new Cx(128,x$e,e)}static createQuatf64(e=zE){return new Cx(32,I$e,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const zE=4*tO.KILOBYTES,Cor=sP.createVec2f64(),Et=sP.createVec3f64(),Cce=sP.createVec4f64();sP.createMat3f64();const Mce=sP.createMat4f64(),Mor=sP.createQuatf64();function Gm(t){return t?{origin:Gs(t.origin),vector:Gs(t.vector)}:{origin:G(),vector:G()}}function mlt(t,e){const r=Alt.get();return r.origin=t,r.vector=e,r}function Ror(t,e=Gm()){return glt(t.origin,t.vector,e)}function glt(t,e,r=Gm()){return Pe(r.origin,t),Pe(r.vector,e),r}function eS(t,e,r=Gm()){return Pe(r.origin,t),Ve(r.vector,e,t),r}function Rce(t,e){const r=Ve(Et.get(),e,t.origin),i=Qe(t.vector,r),n=Qe(t.vector,t.vector),s=He(i/n,0,1),o=Ve(Et.get(),Oe(Et.get(),t.vector,s),r);return Qe(o,o)}function Oor(t,e,r){return rte(t,e,0,1,r)}function Por(t,e,r){return ze(r,t.origin,Oe(r,t.vector,e))}function rte(t,e,r,i,n){const{vector:s,origin:o}=t,a=Ve(Et.get(),e,o),l=Qe(s,a)/vc(s);return Oe(n,s,He(l,r,i)),ze(n,n,t.origin)}function Ior(t,e){if(Q$e(t,mlt(e.origin,e.direction),!1,LB)){const{tA:r,pB:i,distance2:n}=LB;if(r>=0&&r<=1)return n;if(r<0)return Cl(t.origin,i);if(r>1)return Cl(ze(Et.get(),t.origin,t.vector),i)}return null}function W$e(t,e,r){return!!Q$e(t,e,!0,LB)&&(Pe(r,LB.pA),!0)}function Q$e(t,e,r,i){const s=t.origin,o=ze(Et.get(),s,t.vector),a=e.origin,l=ze(Et.get(),a,e.vector),c=Et.get(),u=Et.get();if(c[0]=s[0]-a[0],c[1]=s[1]-a[1],c[2]=s[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const d=Et.get();if(d[0]=o[0]-s[0],d[1]=o[1]-s[1],d[2]=o[2]-s[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],A=u[0]*d[0]+u[1]*d[1]+u[2]*d[2],v=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],b=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],S=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*b-A*A;if(Math.abs(S)<1e-6)return!1;let E=(p*A-v*b)/S,R=(p+A*E)/b;r&&(E=He(E,0,1),R=He(R,0,1));const O=Et.get(),I=Et.get();return O[0]=s[0]+E*d[0],O[1]=s[1]+E*d[1],O[2]=s[2]+E*d[2],I[0]=a[0]+R*u[0],I[1]=a[1]+R*u[1],I[2]=a[2]+R*u[2],i.tA=E,i.tB=R,i.pA=O,i.pB=I,i.distance2=Cl(O,I),!0}const LB={tA:0,tB:0,pA:G(),pB:G(),distance2:0},Alt=new v1(()=>Gm());function el(t){return t?Wge(Gs(t.origin),Gs(t.direction)):Wge(G(),G())}function Wge(t,e){return{origin:t,direction:e}}function $or(t,e){return J_(t.origin,e.origin)&&J_(t.direction,e.direction)}function xp(t,e){const r=blt.get();return r.origin=t,r.direction=e,r}function NB(t,e=el()){return Y$e(t.origin,t.direction,e)}function ylt(t,e,r=el()){return Pe(r.origin,t),Ve(r.direction,e,t),r}function Y$e(t,e,r=el()){return Pe(r.origin,t),Pe(r.direction,e),r}function _lt(t,e){const r=Kt(Et.get(),Ye(Et.get(),t.direction),Ve(Et.get(),e,t.origin));return Qe(r,r)}function vlt(t,e,r){const i=Qe(t.direction,Ve(r,e,t.origin));return ze(r,t.origin,Oe(r,t.direction,i)),r}const blt=new v1(()=>el());function C5(t,e){return Qe(t,e)/ct(t)}function Oce(t,e){const r=Qe(t,e)/(ct(t)*ct(e));return-pa(r)}function X$e(t,e,r){Ye(T6,t),Ye(OW,e);const i=Qe(T6,OW),n=pa(i),s=Kt(T6,T6,OW);return Qe(s,r)<0?2*Math.PI-n:n}const T6=G(),OW=G();function Ho(){return Kr()}function rO(t,e=Ho()){return lm(e,t)}function Z$e(t,e){return Fr(t[0],t[1],t[2],e)}function wlt(t){return t}function J$e(t){t[0]=t[1]=t[2]=t[3]=0}function KG(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function F_(t){return t[3]}function xlt(t){return t}function K$e(t,e,r,i){return Fr(t,e,r,i)}function Tlt(t,e,r){return t!==r&&Pe(r,t),r[3]=t[3]+e,r}function Slt(t,e,r){return we.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:rO(t,r)}function sw(t,e,r){if(k(e))return!1;const{origin:i,direction:n}=e,s=Elt;s[0]=i[0]-t[0],s[1]=i[1]-t[1],s[2]=i[2]-t[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(o===0)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let u=(-a-c)/(2*o);const d=(-a+c)/(2*o);return(u<0||d<u&&d>0)&&(u=d),!(u<0)&&(r&&(r[0]=i[0]+n[0]*u,r[1]=i[1]+n[1]*u,r[2]=i[2]+n[2]*u),!0)}const Elt=G();function ite(t,e){return sw(t,e,null)}function Clt(t,e,r){if(sw(t,e,r))return r;const i=oP(t,e,Et.get());return ze(r,e.origin,Oe(Et.get(),e.direction,zn(e.origin,i)/ct(e.direction))),r}function oP(t,e,r){const i=Et.get(),n=Mce.get();Kt(i,e.origin,e.direction);const s=F_(t);Kt(r,i,e.origin),Oe(r,r,1/ct(r)*s);const o=r4e(t,e.origin),a=Oce(e.origin,r);return bp(n,a+o,i),Ot(r,r,n),r}function Mlt(t,e,r){return sw(t,e,r)?r:(vlt(e,t,r),e4e(t,r,r))}function e4e(t,e,r){const i=Ve(Et.get(),e,t),n=Oe(Et.get(),i,t[3]/ct(i));return ze(r,n,t)}function t4e(t,e){const r=Ve(Et.get(),e,t),i=vc(r),n=t[3]*t[3];return Math.sqrt(Math.abs(i-n))}function r4e(t,e){const r=Ve(Et.get(),e,t),i=ct(r),n=F_(t),s=n+Math.abs(n-i);return pa(n/s)}const PW=G();function i4e(t,e,r,i){const n=Ve(PW,e,t);switch(r){case od.X:{const s=lge(n,PW)[2];return Le(i,-Math.sin(s),Math.cos(s),0)}case od.Y:{const s=lge(n,PW),o=s[1],a=s[2],l=Math.sin(o);return Le(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case od.Z:return Ye(i,n);default:return}}function n4e(t,e){const r=Ve(nte,e,t);return ct(r)-t[3]}function Rlt(t,e,r,i){const n=n4e(t,e),s=i4e(t,e,od.Z,nte),o=Oe(nte,s,r-n);return ze(i,e,o)}function Olt(t,e){const r=Cl(t,e),i=F_(t);return r<=i*i}const nte=G(),ej=Ho(),Plt=Object.freeze(Object.defineProperty({__proto__:null,altitudeAt:n4e,angleToSilhouette:r4e,axisAt:i4e,clear:J$e,closestPoint:Mlt,closestPointOnSilhouette:oP,containsPoint:Olt,copy:rO,create:Ho,distanceToSilhouette:t4e,elevate:Tlt,fromCenterAndRadius:Z$e,fromRadius:KG,fromValues:K$e,getCenter:xlt,getRadius:F_,intersectRay:sw,intersectRayClosestSilhouette:Clt,intersectsRay:ite,projectPoint:e4e,setAltitudeAt:Rlt,setExtent:Slt,tmpSphere:ej,wrap:wlt},Symbol.toStringTag,{value:"Module"}));function $S(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function Ilt(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),n=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return Le(t,r,i,n),t}function Dor(t,e,r){r=r||t;const i=Qe(t,e);Le(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),Ye(r,r)}function Lor(t,e,r){Math.abs(t[0])>Math.abs(t[1])?Le(e,0,1,0):Le(e,1,0,0),Kt(r,t,e),Ye(e,e),Kt(e,r,t),Ye(r,r)}function S6(t,e,r,i,n,s){const o=t+(e-t)*n;return o+(r+(i-r)*n-o)*s}function $lt(t,e,r,i=G()){const n=ct(t),s=ct(e),o=Qe(t,e)/(n*s);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*n+r*s)/Math.sin(a),c=l/n*Math.sin((1-r)*a),u=l/s*Math.sin(r*a);return Oe(DT,t,c),Oe(LT,e,u),ze(i,DT,LT)}return Eo(i,t,e,r)}function Nor(t,e,r,i=G(),n=G()){const s=ct(t),o=ct(e),a=Qe(t,e)/(s*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(r*l),d=Math.sin((1-r)*l),p=(1-r)*s+r*o;{const A=p/c,v=A/o*u;Oe(DT,t,A/s*d),Oe(LT,e,v),ze(i,DT,LT)}{const A=1/s*(-Math.cos((1-r)*l)*l*p+d*(-s+o));Oe(DT,t,A);const v=1/o*(Math.cos(r*l)*l*p+u*(-s+o));Oe(LT,e,v),ze(n,DT,LT),Oe(n,n,1/c)}return n}return Eo(i,t,e,r),Ve(n,e,t),Ye(n,n),n}function ak(t,e,r){t=Ye(DT,t),e=Ye(LT,e);const i=pa(Qe(t,e));if(r){const n=Kt(Dlt,t,e);if(Qe(n,r)<0)return-i}return i}function lk(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const n=t[i-1][0],s=t[i][0],o=(s-r)/(s-n);return o*t[i-1][1]+(1-o)*t[i][1]}}function For(t,e,r,i){Ve(Qge,e,t),Ve(Yge,r,t),Kt(i,Qge,Yge),Ye(i,i),i[3]=-Qe(t,i)}const Qge=G(),Yge=G(),Dlt=G(),DT=G(),LT=G();function Xi(t=Y$){return[t[0],t[1],t[2],t[3]]}function Llt(t=Y$[0],e=Y$[1],r=Y$[2],i=Y$[3]){return Pce(t,e,r,i,Cce.get())}function tj(t,e){return Pce(e[0],e[1],e[2],e[3],t)}function Pce(t,e,r,i,n=Xi()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function s4e(t,e,r){return Pe(r,t),r[3]=e,r}function LN(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function yc(t,e,r,i=Xi()){const n=r[0]-e[0],s=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=s*c-o*l,d=o*a-n*c,p=n*l-s*a,A=u*u+d*d+p*p,v=Math.abs(A-1)>1e-5&&A>1e-12?1/Math.sqrt(A):1;return i[0]=u*v,i[1]=d*v,i[2]=p*v,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function o4e(t,e,r,i,n){const s=t.length/3;if(s<3)return!1;Le(cI,t[3*r],t[3*r+1],t[3*r+2]);let o=i,a=!1;for(;o<s-1&&!a;){const l=3*o;Le(VE,t[l],t[l+1],t[l+2]),o++,a=!fu(cI,VE)}if(!a)return!1;for(o=Math.max(o,n),a=!1;o<s&&!a;){const l=3*o;Le(mT,t[l],t[l+1],t[l+2]),o++,Ve(E6,cI,VE),Ye(E6,E6),Ve(C6,VE,mT),Ye(C6,C6),a=!fu(cI,mT)&&!fu(VE,mT)&&Math.abs(Qe(E6,C6))<Nlt}return a?(yc(cI,VE,mT,e),!0):(r!==0||i!==1||n!==2)&&o4e(t,e,0,1,2)}const Nlt=.99619469809,cI=G(),VE=G(),mT=G(),E6=G(),C6=G();function ste(t,e,r){return e!==t&&tj(t,e),t[3]=-Qe(t,r),t}function ote(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function rL(t,e,r,i){return Kt(mT,e,t),LN(r,mT,i)}function kor(t,e,r,i){return rj(t,e,Ve(Et.get(),r,e),Vlt,i)}function bE(t,e,r){return!!M(e)&&rj(t,e.origin,e.direction,Glt,r)}function Flt(t,e,r){return rj(t,e.origin,e.vector,bA.NONE,r)}function klt(t,e,r){return rj(t,e.origin,e.vector,bA.CLAMP,r)}function a4e(t,e){return kn(t,e)>=0}function Ult(t,e){const r=Qe(t,e.ray.direction),i=-kn(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const n=i/r;return r>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function Blt(t,e){const r=Qe(t,e.ray.direction),i=-kn(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const n=i/r;return r>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function zlt(t,e,r){const i=Oe(Et.get(),t,-t[3]),n=ate(t,Ve(Et.get(),e,i),Et.get());return ze(r,n,i),r}function ate(t,e,r){const i=Oe(Et.get(),t,Qe(t,e));return Ve(r,e,i),r}function kn(t,e){return Qe(t,e)+t[3]}function rj(t,e,r,i,n){const s=Qe(t,r);if(s===0)return!1;let o=-(Qe(t,e)+t[3])/s;return i&bA.CLAMP&&(o=He(o,0,1)),!(!(i&bA.INFINITE_MIN)&&o<0||!(i&bA.INFINITE_MAX)&&o>1)&&(ze(n,e,Oe(n,r,o)),!0)}function Uor(t){return t}const Y$=[0,0,1,0];var bA;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(bA||(bA={}));const Vlt=bA.INFINITE_MIN|bA.INFINITE_MAX,Glt=bA.INFINITE_MAX,IW=we.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let jlt=class{constructor(){this.plane=Xi(),this.origin=G(),this.basis1=G(),this.basis2=G()}};const l4e=jlt;function b1(t=_4e){return{plane:Xi(t.plane),origin:Gs(t.origin),basis1:Gs(t.basis1),basis2:Gs(t.basis2)}}function Hlt(t,e,r){const i=ict.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=Llt(0,0,0,0),ij(i),i}function wE(t,e=b1()){return Ice(t.origin,t.basis1,t.basis2,e)}function qlt(t,e){Pe(e.origin,t.origin),Pe(e.basis1,t.basis1),Pe(e.basis2,t.basis2),tj(e.plane,t.plane)}function Ice(t,e,r,i=b1()){return Pe(i.origin,t),Pe(i.basis1,e),Pe(i.basis2,r),ij(i),tct(i,"fromValues()"),i}function ij(t){rL(t.basis2,t.basis1,t.origin,t.plane)}function c4e(t,e,r){t!==r&&wE(t,r);const i=Oe(Et.get(),s1(t),e);return ze(r.origin,r.origin,i),r.plane[3]-=e,r}function Wlt(t,e,r){return u4e(e,r),c4e(r,Nce(t,t.origin),r),r}function u4e(t,e=b1()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return Le(e.origin,t[0]+r,t[1]+i,0),Le(e.basis1,r,0,0),Le(e.basis2,0,i,0),Pce(0,0,1,0,e.plane),e}function $ce(t,e,r){return!!bE(t.plane,e,r)&&A4e(t,r)}function Qlt(t,e,r){if($ce(t,e,r))return r;const i=h4e(t,e,Et.get());return ze(r,e.origin,Oe(Et.get(),e.direction,zn(e.origin,i)/ct(e.direction))),r}function h4e(t,e,r){const i=FB.get();y4e(t,e,i,FB.get());let n=Number.POSITIVE_INFINITY;for(const s of kce){const o=Fce(t,s,nj.get()),a=Et.get();if(Flt(i,o,a)){const l=y1(Et.get(),e.origin,a),c=Math.abs(pa(Qe(e.direction,l)));c<n&&(n=c,Pe(r,a))}}return n===Number.POSITIVE_INFINITY?d4e(t,e,r):r}function d4e(t,e,r){if($ce(t,e,r))return r;const i=FB.get(),n=FB.get();y4e(t,e,i,n);let s=Number.POSITIVE_INFINITY;for(const o of kce){const a=Fce(t,o,nj.get()),l=Et.get();if(klt(i,a,l)){const c=_lt(e,l);if(!a4e(n,l))continue;c<s&&(s=c,Pe(r,l))}}return Dce(t,e.origin)<s&&p4e(t,e.origin,r),r}function p4e(t,e,r){const i=zlt(t.plane,e,Et.get()),n=rte(Xge(t,t.basis1),i,-1,1,Et.get()),s=rte(Xge(t,t.basis2),i,-1,1,Et.get());return Ve(r,ze(Et.get(),n,s),t.origin),r}function f4e(t,e,r){const{origin:i,basis1:n,basis2:s}=t,o=Ve(Et.get(),e,i),a=C5(n,o),l=C5(s,o),c=C5(s1(t),o);return Le(r,a,l,c)}function Dce(t,e){const r=f4e(t,e,Et.get()),{basis1:i,basis2:n}=t,s=ct(i),o=ct(n),a=Math.max(Math.abs(r[0])-s,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function Ylt(t,e){return Math.sqrt(Dce(t,e))}function Xlt(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of kce){const n=Fce(t,i,nj.get()),s=Rce(n,e);s>r&&(r=s)}return Math.sqrt(r)}function Lce(t,e){return a4e(t.plane,e)&&A4e(t,e)}function Zlt(t,e,r,i){return ect(t,r,i)}function Nce(t,e){const r=-t.plane[3];return C5(s1(t),e)-r}function Jlt(t,e,r,i){const n=Nce(t,e),s=Oe(rct,s1(t),r-n);return ze(i,e,s),i}function m4e(t,e){return fu(t.basis1,e.basis1)&&fu(t.basis2,e.basis2)&&fu(t.origin,e.origin)}function g4e(t,e,r){return t!==r&&wE(t,r),Ml(GE,e),gd(GE,GE),Ot(r.basis1,t.basis1,GE),Ot(r.basis2,t.basis2,GE),Ot(r.plane,t.plane,GE),Ot(r.origin,t.origin,e),ste(r.plane,r.plane,r.origin),r}function Klt(t,e,r,i){return t!==i&&wE(t,i),bp($W,e,r),Ot(i.basis1,t.basis1,$W),Ot(i.basis2,t.basis2,$W),ij(i),i}function s1(t){return t.plane}function ect(t,e,r){switch(e){case od.X:Pe(r,t.basis1),Ye(r,r);break;case od.Y:Pe(r,t.basis2),Ye(r,r);break;case od.Z:Pe(r,s1(t))}return r}function A4e(t,e){const r=Ve(Et.get(),e,t.origin),i=vc(t.basis1),n=vc(t.basis2),s=Qe(t.basis1,r),o=Qe(t.basis2,r);return-s-i<0&&s-i<0&&-o-n<0&&o-n<0}function Xge(t,e){const r=nj.get();return Pe(r.origin,t.origin),Pe(r.vector,e),r}function Fce(t,e,r){const{basis1:i,basis2:n,origin:s}=t,o=Oe(Et.get(),i,e.origin[0]),a=Oe(Et.get(),n,e.origin[1]);ze(r.origin,o,a),ze(r.origin,r.origin,s);const l=Oe(Et.get(),i,e.direction[0]),c=Oe(Et.get(),n,e.direction[1]);return Oe(r.vector,ze(l,l,c),2),r}function tct(t,e){Math.abs(Qe(t.basis1,t.basis2)/(ct(t.basis1)*ct(t.basis2)))>1e-6&&IW.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(Qe(t.basis1,s1(t)))>1e-6&&IW.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Qe(s1(t),t.origin)-t.plane[3])>1e-6&&IW.warn(e,"Plane offset is not consistent with plane origin")}function y4e(t,e,r,i){const n=s1(t);rL(n,e.direction,e.origin,r),rL(r,n,e.origin,i)}const _4e={plane:Xi(),origin:pt(0,0,0),basis1:pt(1,0,0),basis2:pt(0,1,0)},FB=new v1(Xi),nj=new v1(Gm),rct=G(),ict=new v1(()=>b1()),kce=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],GE=ht(),$W=ht(),nct=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:l4e,UP:_4e,altitudeAt:Nce,axisAt:Zlt,closestPoint:d4e,closestPointOnSilhouette:h4e,copy:wE,copyWithoutVerify:qlt,create:b1,distance:Ylt,distance2:Dce,distanceToSilhouette:Xlt,elevate:c4e,equals:m4e,extrusionContainsPoint:Lce,fromAABoundingRect:u4e,fromValues:Ice,intersectRay:$ce,intersectRayClosestSilhouette:Qlt,normal:s1,projectPoint:p4e,projectPointLocal:f4e,rotate:Klt,setAltitudeAt:Jlt,setExtent:Wlt,transform:g4e,updateUnboundedPlane:ij,wrap:Hlt},Symbol.toStringTag,{value:"Module"})),sct=new St(lOe),Zge=new St(yle),Jge=new St(_le),zor=new St(cOe);function sj(t){return t&&(XA(t)||jo(t,Zge))?Zge:t&&(ZA(t)||jo(t,Jge))?Jge:sct}function oct(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function act(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function lct(t){return{operations:t,value:t.create()}}function v4e(t,e,r=lct(t)){return r.operations=t,t.copy(e,r.value),r}function cct(t){return v4e(Plt,K$e(0,0,0,ln(t).radius))}const Kge=2**50;function uct(){return v4e(nct,Ice([0,0,0],[Kge,0,0],[0,Kge,0]))}function hct(t,e,r){return t.operations.axisAt(t.value,e,od.Z,r)}function dct(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function pct(t,e,r){return t.operations.intersectRay(t.value,e,r)}function fct(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function mct(t,e){return t.operations.altitudeAt(t.value,e)}function b4e(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function gct(t,e,r,i){return e!==i&&Ia(i,e),Le(jE,i[12],i[13],i[14]),b4e(t,jE,r,jE),i[12]=jE[0],i[13]=jE[1],i[14]=jE[2],i}function DW(t,e,r){return t.operations.elevate(t.value,e,r.value)}const jE=G();function eAe(t,e,r,i,n){return n[0]=Qe(t,e),n[1]=Qe(t,r),n[2]=Qe(t,i),n}function lte(t,e,r,i,n){Pe(r,t),Pe(M6,e),Ye(M6,M6),Kt(i,M6,r),Kt(n,i,r)}function w4e(t,e){return t?sj(e):e.isGeographic?St.PlateCarree:e}const M6=G(),Uce=96;function Vor(t,e){const r=e||t.extent,i=t.width,n=Eu(r&&r.spatialReference);return r&&i?r.width/i*n*vle*Uce:0}function Act(t,e){return t/(Eu(e)*vle*Uce)}function yct(t){return t/(vle*Uce)}const x4e="OBJECTID";let iO=class extends T5{constructor(e){super(e),this.handles.add(this.on("before-add",r=>{k(r.item)||r.item.parent===this.owner&&(we.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};iO=h([Q("esri.support.AnalysesCollection")],iO);const ck={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],n=this.values;return i>=r?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},LW={xsmall:544,small:768,medium:992,large:1200};function _ct(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function NW(t,e){return e?ck[t].valueToClassName[e].split(" "):[]}const vct=t=>{let e=class extends t{constructor(...r){super(...r),this._breakpointsHandles=new cn,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=LW}initialize(){this._breakpointsHandles.add(xe(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Rr))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=yt(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=_ct(r);if(!i){const n=JSON.stringify(LW,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}r=i?r:LW,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=Zh.acquire(),i=Zh.acquire();let n,s=!1;for(n in ck){const o=this[n],a=ck[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(s=!0,this[n]=a,NW(n,o).forEach(l=>i.push(l)),NW(n,a).forEach(l=>r.push(l)))}s&&(this._applyClassNameChanges(r,i),Zh.release(r),Zh.release(i))}_applyClassNameChanges(r,i){const n=this.container;n&&(i.forEach(s=>n.classList.remove(s)),r.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in ck)NW(i,this[i]).forEach(n=>r.classList.remove(n))}};return h([f()],e.prototype,"breakpoints",null),h([f()],e.prototype,"orientation",void 0),h([f()],e.prototype,"widthBreakpoint",void 0),h([f()],e.prototype,"heightBreakpoint",void 0),e=h([Q("esri.views.BreakpointsOwner")],e),e};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var bct=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},gT={exports:{}},qo={},iL={exports:{}},xE={};function T4e(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function wct(t,e,r){}function xct(t,e,r){}var Tct=/javascript\s*\:/img;function Sct(t,e){return Tct.test(e)?"":e}xE.whiteList=T4e();xE.getDefaultWhiteList=T4e;xE.onAttr=wct;xE.onIgnoreAttr=xct;xE.safeAttrValue=Sct;var Ect={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,n;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,n=t.length;i<n;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},uI=Ect;function Cct(t,e){t=uI.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,n=0,s=0,o="";function a(){if(!i){var u=uI.trim(t.slice(n,s)),d=u.indexOf(":");if(d!==-1){var p=uI.trim(u.slice(0,d)),A=uI.trim(u.slice(d+1));if(p){var v=e(n,o.length,p,A,u);v&&(o+=v+"; ")}}}n=s+1}for(;s<r;s++){var l=t[s];if(l==="/"&&t[s+1]==="*"){var c=t.indexOf("*/",s+2);if(c===-1)break;s=c+1,n=s+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return uI.trim(o)}var Mct=Cct,R6=xE,Rct=Mct;function tAe(t){return t==null}function Oct(t){var e={};for(var r in t)e[r]=t[r];return e}function S4e(t){t=Oct(t||{}),t.whiteList=t.whiteList||R6.whiteList,t.onAttr=t.onAttr||R6.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||R6.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||R6.safeAttrValue,this.options=t}S4e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,n=r.onAttr,s=r.onIgnoreAttr,o=r.safeAttrValue,a=Rct(t,function(l,c,u,d,p){var A=i[u],v=!1;if(A===!0?v=A:typeof A=="function"?v=A(d):A instanceof RegExp&&(v=A.test(d)),v!==!0&&(v=!1),d=o(u,d),!!d){var b={position:c,sourcePosition:l,source:p,isWhite:v};if(v){var S=n(u,d,b);return tAe(S)?u+":"+d:S}else{var S=s(u,d,b);if(!tAe(S))return S}}});return a};var Pct=S4e;(function(t,e){var r=xE,i=Pct;function n(o,a){var l=new i(a);return l.process(o)}e=t.exports=n,e.FilterCSS=i;for(var s in r)e[s]=r[s]})(iL,iL.exports);var Bce={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,n;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,n=t.length;i<n;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},Ict=iL.exports.FilterCSS,$ct=iL.exports.getDefaultWhiteList,kB=Bce;function E4e(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var C4e=new Ict;function Dct(t,e,r){}function Lct(t,e,r){}function Nct(t,e,r){}function Fct(t,e,r){}function M4e(t){return t.replace(Uct,"&lt;").replace(Bct,"&gt;")}function kct(t,e,r,i){if(r=D4e(r),e==="href"||e==="src"){if(r=kB.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(O6.lastIndex=0,O6.test(r))return""}else if(e==="style"){if(rAe.lastIndex=0,rAe.test(r)||(iAe.lastIndex=0,iAe.test(r)&&(O6.lastIndex=0,O6.test(r))))return"";i!==!1&&(i=i||C4e,r=i.process(r))}return r=L4e(r),r}var Uct=/</g,Bct=/>/g,zct=/"/g,Vct=/&quot;/g,Gct=/&#([a-zA-Z0-9]*);?/gim,jct=/&colon;?/gim,Hct=/&newline;?/gim,O6=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,rAe=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,iAe=/u\s*r\s*l\s*\(.*/gi;function R4e(t){return t.replace(zct,"&quot;")}function O4e(t){return t.replace(Vct,'"')}function P4e(t){return t.replace(Gct,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function I4e(t){return t.replace(jct,":").replace(Hct," ")}function $4e(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return kB.trim(e)}function D4e(t){return t=O4e(t),t=P4e(t),t=I4e(t),t=$4e(t),t}function L4e(t){return t=R4e(t),t=M4e(t),t}function qct(){return""}function Wct(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:kB.indexOf(t,o)!==-1}var n=[],s=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return n.push([s!==!1?s:l.position,u]),s=!1,c}else return s||(s=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return kB.forEach(n,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function Qct(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var n=t.indexOf("-->",i);if(n===-1)break;r=n+3}return e}function Yct(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}qo.whiteList=E4e();qo.getDefaultWhiteList=E4e;qo.onTag=Dct;qo.onIgnoreTag=Lct;qo.onTagAttr=Nct;qo.onIgnoreTagAttr=Fct;qo.safeAttrValue=kct;qo.escapeHtml=M4e;qo.escapeQuote=R4e;qo.unescapeQuote=O4e;qo.escapeHtmlEntities=P4e;qo.escapeDangerHtml5Entities=I4e;qo.clearNonPrintableCharacter=$4e;qo.friendlyAttrValue=D4e;qo.escapeAttrValue=L4e;qo.onIgnoreTagStripAll=qct;qo.StripTagBody=Wct;qo.stripCommentTag=Qct;qo.stripBlankChar=Yct;qo.cssFilter=C4e;qo.getDefaultCSSWhiteList=$ct;var oj={},db=Bce;function Xct(t){var e=db.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=db.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function Zct(t){return t.slice(0,2)==="</"}function Jct(t,e,r){var i="",n=0,s=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(s===!1){if(d==="<"){s=a;continue}}else if(o===!1){if(d==="<"){i+=r(t.slice(n,a)),s=a,n=a;continue}if(d===">"){i+=r(t.slice(n,s)),u=t.slice(s,a+1),c=Xct(u),i+=e(s,i.length,c,u,Zct(u)),n=a+1,s=!1;continue}if(d==='"'||d==="'")for(var p=1,A=t.charAt(a-p);A.trim()===""||A==="=";){if(A==="="){o=d;continue e}A=t.charAt(a-++p)}}else if(d===o){o=!1;continue}}return n<t.length&&(i+=r(t.substr(n))),i}var Kct=/[^a-zA-Z0-9\\_:.-]/gim;function eut(t,e){var r=0,i=0,n=[],s=!1,o=t.length;function a(p,A){if(p=db.trim(p),p=p.replace(Kct,"").toLowerCase(),!(p.length<1)){var v=e(p,A||"");v&&n.push(v)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,d;if(s===!1&&c==="="){s=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:rut(t,l+1);continue}if(s!==!1&&l===i){if(d=t.indexOf(c,l+1),d===-1)break;u=db.trim(t.slice(i+1,d)),a(s,u),s=!1,l=d,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),s===!1)if(d=tut(t,l),d===-1){u=db.trim(t.slice(r,l)),a(u),s=!1,r=l+1;continue}else{l=d-1;continue}else if(d=iut(t,l-1),d===-1){u=db.trim(t.slice(r,l)),u=nAe(u),a(s,u),s=!1,r=l+1;continue}else continue}return r<t.length&&(s===!1?a(t.slice(r)):a(s,nAe(db.trim(t.slice(r))))),db.trim(n.join(" "))}function tut(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function rut(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function iut(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function nut(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function nAe(t){return nut(t)?t.substr(1,t.length-2):t}oj.parseTag=Jct;oj.parseAttr=eut;var sut=iL.exports.FilterCSS,q0=qo,N4e=oj,out=N4e.parseTag,aut=N4e.parseAttr,uk=Bce;function P6(t){return t==null}function lut(t){var e=uk.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=uk.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=uk.trim(t.slice(0,-1))),{html:t,closing:r}}function cut(t){var e={};for(var r in t)e[r]=t[r];return e}function uut(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function F4e(t){t=cut(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=q0.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=uut(t.whiteList||t.allowList):t.whiteList=q0.whiteList,t.onTag=t.onTag||q0.onTag,t.onTagAttr=t.onTagAttr||q0.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||q0.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||q0.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||q0.safeAttrValue,t.escapeHtml=t.escapeHtml||q0.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new sut(t.css))}F4e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,n=r.onTag,s=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,u=e.cssFilter;r.stripBlankChar&&(t=q0.stripBlankChar(t)),r.allowCommentTag||(t=q0.stripCommentTag(t));var d=!1;r.stripIgnoreTagBody&&(d=q0.StripTagBody(r.stripIgnoreTagBody,s),s=d.onIgnoreTag);var p=out(t,function(A,v,b,S,E){var R={sourcePosition:A,position:v,isClosing:E,isWhite:Object.prototype.hasOwnProperty.call(i,b)},O=n(b,S,R);if(!P6(O))return O;if(R.isWhite){if(R.isClosing)return"</"+b+">";var I=lut(S),N=i[b],L=aut(I.html,function(B,U){var q=uk.indexOf(N,B)!==-1,Z=o(b,B,U,q);return P6(Z)?q?(U=l(b,B,U,u),U?B+'="'+U+'"':B):(Z=a(b,B,U,q),P6(Z)?void 0:Z):Z});return S="<"+b,L&&(S+=" "+L),I.closing&&(S+=" /"),S+=">",S}else return O=s(b,S,R),P6(O)?c(S):O},c);return d&&(p=d.remove(p)),p};var hut=F4e;(function(t,e){var r=qo,i=oj,n=hut;function s(a,l){var c=new n(l);return c.process(a)}e=t.exports=s,e.filterXSS=s,e.FilterXSS=n,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(gT,gT.exports);var dut=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,o,a,l){return s==="a"&&o==="href"||(s==="img"||s==="source")&&o==="src"?i.sanitizeUrl(a):gT.exports.safeAttrValue(s,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var n;e&&!r?n=e:e&&r?(n=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(s){s==="whiteList"?n.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):n[s]=e[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList),this.xssFilterOptions=n,this._xssFilter=new gT.exports.FilterXSS(n)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,n=i===void 0?!0:i,s=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return o||a||l?gT.exports.escapeAttrValue(e):!s&&!n?gT.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,n):gT.exports.safeAttrValue(e,r,i,n)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,n){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(n){Array.isArray(i[n])&&Array.isArray(r[n])?r[n]=r[n].concat(i[n]):r[n]=i[n]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var n=!1,s=void 0;if(Array.isArray(e))s=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(n=!0,a.concat([c.sanitized]))},[]);else if(bct(e)){var o=Object.keys(e);s=o.reduce(function(a,l){var c=e[l],u=i.validate(c,r);return u.isValid?a[l]=c:(n=!0,a[l]=u.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return n?s:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const aj=new Map;function k4e(){aj.clear()}function put(t){return aj.get(t)}function fut(t,e){aj.set(t,e)}function FW(t){aj.delete(t)}var DS,nO,mut=function(t){if("WebkitTransition"in t.style)DS="webkitTransitionEnd",nO="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");DS="transitionend",nO="animationend"}},U4e=function(t){DS||mut(t)},gut=function(t,e){return e===void 0&&(e=t+"-active"),function(r){U4e(r);var i=!1,n=function(s){i||(i=!0,r.removeEventListener(DS,n),r.removeEventListener(nO,n),r.classList.remove(t),r.classList.remove(e))};r.classList.add(t),r.addEventListener(DS,n),r.addEventListener(nO,n),requestAnimationFrame(function(){r.classList.add(e)})}},Aut=function(t,e){return e===void 0&&(e=t+"-active"),function(r,i){U4e(r);var n=!1,s=function(o){n||(n=!0,r.removeEventListener(DS,s),r.removeEventListener(nO,s),i())};r.classList.add(t),r.addEventListener(DS,s),r.addEventListener(nO,s),requestAnimationFrame(function(){r.classList.add(e)})}};const yut=we.getLogger("esri.widgets.support.widgetUtils");function B4e(t){const e=Zh.acquire();for(let i=0;i<arguments.length;i++){const n=arguments[i],s=typeof n;if(s==="string")e.push(n);else if(Array.isArray(n))e.push.apply(e,n);else if(s==="object")for(const o in n)n[o]&&e.push(o)}const r=e.join(" ");return Zh.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(r=>{var i;k4e();for(const n of r)(i=t.get(n.target))==null||i(n)});return(r,i,n)=>(t.has(r)&&yut.error("Already observing element",r),t.set(r,i),e.observe(r,n),Rm(()=>{e.unobserve(r),t.delete(r)}))})();function pm(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function sAe(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function nL(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function _ut(t,e){return(t==="enter"?gut:Aut)(e)}const vut=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],but=vut.reduce((t,e)=>(t[e]=[],t),{}),wut=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],z4e=new dut({whiteList:but,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(wut.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function xut(t){return t==="Enter"||t===" "}const V4e="http://www.w3.org/",lj=`${V4e}2000/svg`,G4e=`${V4e}1999/xlink`;let oAe=[],zce=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},Vce=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),j4e=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},Tut=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(Vce(t[i],e))return i}return-1},kW=(t,e,r,i)=>{let n=t[e];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(Vce(a,n))throw new Error(`${r.vnodeSelector} had a ${n.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},Sut=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},cte=[],ute=!1,H4e=t=>{(t.children||[]).forEach(H4e),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},aAe=()=>{ute=!1,cte.forEach(H4e),cte.length=0},lAe=t=>{cte.push(t),ute||(ute=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(aAe,{timeout:16}):setTimeout(aAe,16))},cAe=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),lAe(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),lAe(t))},Eut=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let a=n[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")hte(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d];l[p]&&t.classList.add(p)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d],A=l[p];A&&(j4e(A),r.styleApplyer(t,p,A))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(d){u.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):r.namespace===lj?a==="href"?t.setAttributeNS(G4e,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=z4e.sanitize(l):q4e(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function q4e(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let UB,Cut=(t,e,r)=>{if(e)for(let i of e)_M(i,t,void 0,r)},W4e=(t,e,r)=>{Cut(t,e.children,r),e.text&&(t.textContent=e.text),Eut(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},_M=(t,e,r,i)=>{let n,s=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")n=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(n,r):e.appendChild(n);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(s-1),d=o.slice(s,l);u==="."?n.classList.add(d):u==="#"?n.id=d:(d==="svg"&&(i=zce(i,{namespace:lj})),i.namespace!==void 0?n=t.domNode=a.createElementNS(i.namespace,d):(n=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&n.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(n,r):n.parentNode!==e&&e.appendChild(n)),s=l+1}}W4e(n,t,i)}},hte=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},Mut=(t,e,r,i)=>{if(!r)return;let n=!1,s=Object.keys(r),o=s.length;for(let a=0;a<o;a++){let l=s[a],c=r[l],u=e[l];if(l==="class")u!==c&&(hte(t,u,!1),hte(t,c,!0));else if(l==="classes"){let d=t.classList,p=Object.keys(c),A=p.length;for(let v=0;v<A;v++){let b=p[v],S=!!c[b];S!==!!u[b]&&(n=!0,S?d.add(b):d.remove(b))}}else if(l==="styles"){let d=Object.keys(c),p=d.length;for(let A=0;A<p;A++){let v=d[A],b=c[v];b!==u[v]&&(n=!0,b?(j4e(b),i.styleApplyer(t,v,b)):i.styleApplyer(t,v,""))}}else if(c||typeof u!="string"||(c=""),l==="value"){let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(n=!0)}else if(c!==u){let d=typeof c;d==="function"&&i.eventHandlerInterceptor||(i.namespace===lj?l==="href"?t.setAttributeNS(G4e,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=z4e.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):q4e(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),n=!0)}}return n},Rut=(t,e,r,i,n)=>{if(r===i)return!1;i=i||oAe;let s,o=(r=r||oAe).length,a=i.length,l=0,c=0,u=!1;for(;c<a;){let d=l<o?r[l]:void 0,p=i[c];if(d!==void 0&&Vce(d,p))u=UB(d,p,n)||u,l++;else{let A=Tut(r,p,l+1);if(A>=0){for(s=l;s<A;s++)cAe(r[s]),kW(r,s,t,"removed");u=UB(r[A],p,n)||u,l=A+1}else _M(p,e,l<o?r[l].domNode:void 0,n),Sut(p),kW(i,c,t,"added")}c++}if(o>l)for(s=l;s<o;s++)cAe(r[s]),kW(r,s,t,"removed");return u};UB=(t,e,r)=>{let i=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,n=!0,n}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=zce(r,{namespace:lj})),t.text!==e.text&&(s=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,s=Rut(e,i,t.children,e.children,r)||s,s=Mut(i,t.properties,e.properties,r)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),n};let hI=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,UB(i,r,e)},domNode:t.domNode});const Out={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let cC=t=>zce(Out,t),Qb={create:(t,e)=>(e=cC(e),_M(t,document.createElement("div"),void 0,e),hI(t,e)),append:(t,e,r)=>(r=cC(r),_M(e,t,void 0,r),hI(e,r)),insertBefore:(t,e,r)=>(r=cC(r),_M(e,t.parentNode,t,r),hI(e,r)),merge:(t,e,r)=>(r=cC(r),e.domNode=t,W4e(t,e,r),hI(e,r)),replace:(t,e,r)=>(r=cC(r),_M(e,t.parentNode,t,r),t.parentNode.removeChild(t),hI(e,r))},Q4e,Put=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};Q4e=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let Iut=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?Q4e(r.children,n=>n.domNode===i):void 0}),r},$ut=(t,e,r)=>{let i=function(n){r("domEvent",n);let s=e(),o=Put(n.currentTarget,s.domNode);o.reverse();let a,l=Iut(s.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${n.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",n),a};return(n,s,o,a)=>i},dte=t=>{let e,r,i=cC(t),n=i.performanceLogger,s=!0,o=!1,a=[],l=[],c=(d,p,A)=>{let v,b=()=>v;i.eventHandlerInterceptor=$ut(e,b,n),v=d(p,A(),i),a.push(v),l.push(A)},u=()=>{if(r=void 0,s){s=!1,n("renderStart",void 0);for(let d=0;d<a.length;d++){let p=l[d]();n("rendered",void 0),a[d].update(p),n("patched",void 0)}n("renderDone",void 0),s=!0}};return e={renderNow:u,scheduleRender:()=>{r||o||(r=requestAnimationFrame(u))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,s=!0,e.scheduleRender()},append:(d,p)=>{c(Qb.append,d,p)},insertBefore:(d,p)=>{c(Qb.insertBefore,d,p)},merge:(d,p)=>{c(Qb.merge,d,p)},replace:(d,p)=>{c(Qb.replace,d,p)},detach:d=>{for(let p=0;p<l.length;p++)if(l[p]===d)return l.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e},Vv=class extends rt{constructor(){super(...arguments),this.items=new ur,this._watchUpdatingTracking=new _A,this._callbacks=new Map,this._projector=dte(),this._hiddenProjector=dte()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const n=()=>i.render();this._callbacks.set(i,n),this._projector.append(this.surface,n)}for(const i of r.removed){const n=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(n.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);i.append(r,s),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n&&n.domNode){const a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(s);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),n=this.computeBoundingRect(r);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(i=>{r.save(),i.renderCanvas(r),r.restore()}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};h([f({readOnly:!0})],Vv.prototype,"surface",void 0),h([f({readOnly:!0})],Vv.prototype,"items",void 0),h([f({readOnly:!0})],Vv.prototype,"needsRender",null),h([f({readOnly:!0})],Vv.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],Vv.prototype,"updating",null),Vv=h([Q("esri.views.overlay.ViewOverlay")],Vv);const uAe=Vv;function ZM(t,e,r,i){let n=null,s=1e3;typeof e=="number"?(s=e,i=r):(n=e??null,s=r);let o,a=0;const l=()=>{a=0,t.apply(i,o)},c=(...u)=>{n&&n.apply(i,u),o=u,s?a||(a=setTimeout(l,s)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}const Dut="randomUUID"in crypto;function Lut(){if(Dut)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}const Nut={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},Fut={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{t.style[e]=r}},kut=t=>({...Fut,...t}),Uut=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},But=(t,e)=>t.find(e),hAe=(t,e,r=!1)=>{let i=t;return e.forEach((n,s)=>{const o=i!=null&&i.children?But(i.children,a=>a.domNode===n):void 0;r&&!o&&s!==e.length-1||(i=o)}),i},zut=t=>{let e;const r={...Nut,...t},i=kut(r),n=i.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],u=(p,A,v)=>{var E;let b;i.eventHandlerInterceptor=(R,O,I,N)=>function(L){let B;n("domEvent",L);const U=Uut(L.currentTarget,b.domNode),q=U.some(X=>{var ee;return customElements.get((ee=X==null?void 0:X.tagName)==null?void 0:ee.toLowerCase())});if(L.eventPhase===Event.CAPTURING_PHASE||!q)U.reverse(),B=hAe(b.getLastRender(),U);else{const X=L.composedPath(),ee=X.slice(X.indexOf(L.currentTarget),X.indexOf(b.domNode)).filter(se=>se.getRootNode()===se.ownerDocument).reverse();B=hAe(b.getLastRender(),ee,!0)}let Z;return B&&(Z=r.handleInterceptedEvent(e,B,this,L)),n("domEventProcessed",L),Z},(E=r.postProcessProjectionOptions)==null||E.call(r,i);const S=v();b=p(A,S,i),l.push(b),c.push(v),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(b,S)};let d=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let p=0;p<l.length;p++){const A=c[p]();n("rendered",void 0),l[p].update(A),n("patched",void 0)}n("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(d=r.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{s||a||(s=requestAnimationFrame(d))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(p,A)=>{u(Qb.append,p,A)},insertBefore:(p,A)=>{u(Qb.insertBefore,p,A)},merge:(p,A)=>{u(Qb.merge,p,A)},replace:(p,A)=>{u(Qb.replace,p,A)},detach:p=>{for(let A=0;A<c.length;A++)if(c[A]===p)return c.splice(A,1),l.splice(A,1)[0];throw new Error("renderFunction was not found")}},e},uC={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let hC,Y4e,cj,X4e=!1,BB=!1,Gce=!1,Qd=!1,dAe=null,pte=!1;const Hor=t=>{const e=new URL(t,Rc.$resourcesUrl$);return e.origin!==kN.location.origin?e.href:e.pathname},Vut=t=>Rc.$resourcesUrl$=t,LS=(t,e="")=>()=>{},pAe="http://www.w3.org/1999/xlink",fAe={},Gut="http://www.w3.org/2000/svg",jut="http://www.w3.org/1999/xhtml",Hut=t=>t!=null,jce=t=>(t=typeof t,t==="object"||t==="function"),Z4e=(t,e,...r)=>{let i=null,n=null,s=null,o=!1,a=!1;const l=[],c=d=>{for(let p=0;p<d.length;p++)i=d[p],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!jce(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?zB(null,i):i),a=o)};if(c(r),e){e.key&&(n=e.key),e.name&&(s=e.name);{const d=e.className||e.class;d&&(e.class=typeof d!="object"?d:Object.keys(d).filter(p=>d[p]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,Qut);const u=zB(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=n,u.$name$=s,u},zB=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},qut={},Wut=t=>t&&t.$tag$===qut,Qut={forEach:(t,e)=>t.map(mAe).forEach(e),map:(t,e)=>t.map(mAe).map(e).map(Yut)},mAe=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),Yut=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),Z4e(t.vtag,r,...t.vchildren||[])}const e=zB(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},Xut=t=>xht.map(e=>e(t)).find(e=>!!e),Zut=(t,e)=>t!=null&&!jce(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,Jut=t=>t,qor=(t,e,r)=>{const i=Jut(t);return{emit:n=>Kut(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:n})}},Kut=(t,e,r)=>{const i=Rc.ce(e,r);return t.dispatchEvent(i),i},gAe=new WeakMap,eht=(t,e,r)=>{let i=GB.get(t);Eht&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,GB.set(t,i)},tht=(t,e,r,i)=>{let n=J4e(e,r);const s=GB.get(n);if(t=t.nodeType===11?t:wA,s)if(typeof s=="string"){t=t.head||t;let o=gAe.get(t),a;o||gAe.set(t,o=new Set),o.has(n)||(a=wA.createElement("style"),a.innerHTML=s,t.insertBefore(a,t.querySelector("link")),o&&o.add(n))}else t.adoptedStyleSheets.includes(s)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,s]);return n},rht=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,n=LS("attachStyles",e.$tagName$),s=tht(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=s,r.classList.add(s+"-h"),i&2&&r.classList.add(s+"-s")),n()},J4e=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),AAe=(t,e,r,i,n,s)=>{if(r!==i){let o=bAe(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=yAe(r),u=yAe(i);l.remove(...c.filter(d=>d&&!u.includes(d))),l.add(...u.filter(d=>d&&!c.includes(d)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):bAe(kN,a)?e=a.slice(2):e=a[2]+e.slice(3),r&&Rc.rel(t,e,r,!1),i&&Rc.ael(t,e,i,!1);else{const l=jce(i);if((o||l&&i!==null)&&!n)try{if(t.tagName.includes("-"))t[e]=i;else{const u=i??"";e==="list"?o=!1:(r==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(pAe,e):t.removeAttribute(e)):(!o||s&4||n)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(pAe,e,i):t.setAttribute(e,i))}}},iht=/\s/,yAe=t=>t?t.split(iht):[],K4e=(t,e,r,i)=>{const n=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||fAe,o=e.$attrs$||fAe;for(i in s)i in o||AAe(n,i,s[i],void 0,r,e.$flags$);for(i in o)AAe(n,i,s[i],o[i],r,e.$flags$)},VB=(t,e,r,i)=>{const n=e.$children$[r];let s=0,o,a,l;if(X4e||(Gce=!0,n.$tag$==="slot"&&(hC&&i.classList.add(hC+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)o=n.$elm$=wA.createTextNode(n.$text$);else if(n.$flags$&1)o=n.$elm$=wA.createTextNode("");else{if(Qd||(Qd=n.$tag$==="svg"),o=n.$elm$=wA.createElementNS(Qd?Gut:jut,n.$flags$&2?"slot-fb":n.$tag$),Qd&&n.$tag$==="foreignObject"&&(Qd=!1),K4e(null,n,Qd),Hut(hC)&&o["s-si"]!==hC&&o.classList.add(o["s-si"]=hC),n.$children$)for(s=0;s<n.$children$.length;++s)a=VB(t,n,s,o),a&&o.appendChild(a);n.$tag$==="svg"?Qd=!1:o.tagName==="foreignObject"&&(Qd=!0)}return o["s-hn"]=cj,n.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=Y4e,o["s-sn"]=n.$name$||"",l=t&&t.$children$&&t.$children$[r],l&&l.$tag$===n.$tag$&&t.$elm$&&sL(t.$elm$,!1)),o},sL=(t,e)=>{Rc.$flags$|=1;const r=t.childNodes;for(let i=r.length-1;i>=0;i--){const n=r[i];n["s-hn"]!==cj&&n["s-ol"]&&(r5e(n).insertBefore(n,Hce(n)),n["s-ol"].remove(),n["s-ol"]=void 0,Gce=!0),e&&sL(n,e)}Rc.$flags$&=-2},e5e=(t,e,r,i,n,s)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===cj&&(o=o.shadowRoot);n<=s;++n)i[n]&&(a=VB(null,r,n,t),a&&(i[n].$elm$=a,o.insertBefore(a,Hce(e))))},t5e=(t,e,r,i,n)=>{for(;e<=r;++e)(i=t[e])&&(n=i.$elm$,s5e(i),BB=!0,n["s-ol"]?n["s-ol"].remove():sL(n,!0),n.remove())},nht=(t,e,r,i)=>{let n=0,s=0,o=0,a=0,l=e.length-1,c=e[0],u=e[l],d=i.length-1,p=i[0],A=i[d],v,b;for(;n<=l&&s<=d;)if(c==null)c=e[++n];else if(u==null)u=e[--l];else if(p==null)p=i[++s];else if(A==null)A=i[--d];else if(I6(c,p))dC(c,p),c=e[++n],p=i[++s];else if(I6(u,A))dC(u,A),u=e[--l],A=i[--d];else if(I6(c,A))(c.$tag$==="slot"||A.$tag$==="slot")&&sL(c.$elm$.parentNode,!1),dC(c,A),t.insertBefore(c.$elm$,u.$elm$.nextSibling),c=e[++n],A=i[--d];else if(I6(u,p))(c.$tag$==="slot"||A.$tag$==="slot")&&sL(u.$elm$.parentNode,!1),dC(u,p),t.insertBefore(u.$elm$,c.$elm$),u=e[--l],p=i[++s];else{for(o=-1,a=n;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===p.$key$){o=a;break}o>=0?(b=e[o],b.$tag$!==p.$tag$?v=VB(e&&e[s],r,o,t):(dC(b,p),e[o]=void 0,v=b.$elm$),p=i[++s]):(v=VB(e&&e[s],r,s,t),p=i[++s]),v&&r5e(c.$elm$).insertBefore(v,Hce(c.$elm$))}n>l?e5e(t,i[d+1]==null?null:i[d+1].$elm$,r,i,s,d):s>d&&t5e(e,n,l)},I6=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,Hce=t=>t&&t["s-ol"]||t,r5e=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,dC=(t,e)=>{const r=e.$elm$=t.$elm$,i=t.$children$,n=e.$children$,s=e.$tag$,o=e.$text$;let a;o===null?(Qd=s==="svg"?!0:s==="foreignObject"?!1:Qd,s==="slot"||K4e(t,e,Qd),i!==null&&n!==null?nht(r,i,e,n):n!==null?(t.$text$!==null&&(r.textContent=""),e5e(r,null,e,n,0,n.length-1)):i!==null&&t5e(i,0,i.length-1),Qd&&s==="svg"&&(Qd=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(r.data=o)},i5e=t=>{const e=t.childNodes;let r,i,n,s,o,a;for(i=0,n=e.length;i<n;i++)if(r=e[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,s=0;s<n;s++)if(a=e[s].nodeType,e[s]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===e[s].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&e[s].textContent.trim()!==""){r.hidden=!0;break}}i5e(r)}},em=[],n5e=t=>{let e,r,i,n,s,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(r=e["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,n=e["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==e["s-hn"]&&(_Ae(r,n)?(s=em.find(u=>u.$nodeToRelocate$===r),BB=!0,r["s-sn"]=r["s-sn"]||n,s?s.$slotRefNode$=e:em.push({$slotRefNode$:e,$nodeToRelocate$:r}),r["s-sr"]&&em.map(u=>{_Ae(u.$nodeToRelocate$,r["s-sn"])&&(s=em.find(d=>d.$nodeToRelocate$===r),s&&!u.$slotRefNode$&&(u.$slotRefNode$=s.$slotRefNode$))})):em.some(u=>u.$nodeToRelocate$===r)||em.push({$nodeToRelocate$:r}));e.nodeType===1&&n5e(e)}},_Ae=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",s5e=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(s5e)},sht=(t,e)=>{const r=t.$hostElement$,i=t.$cmpMeta$,n=t.$vnode$||zB(null,null),s=Wut(e)?e:Z4e(null,null,e);cj=r.tagName,i.$attrsToReflect$&&(s.$attrs$=s.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>s.$attrs$[a]=r[o])),s.$tag$=null,s.$flags$|=4,t.$vnode$=s,s.$elm$=n.$elm$=r.shadowRoot||r,hC=r["s-sc"],Y4e=r["s-cr"],X4e=(i.$flags$&1)!==0,BB=!1,dC(n,s);{if(Rc.$flags$|=1,Gce){n5e(s.$elm$);let o,a,l,c,u,d,p=0;for(;p<em.length;p++)o=em[p],a=o.$nodeToRelocate$,a["s-ol"]||(l=wA.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(p=0;p<em.length;p++)if(o=em[p],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,u=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(d=l["s-nr"],d&&d["s-sn"]===a["s-sn"]&&c===d.parentNode&&(d=d.nextSibling,!d||!d["s-nr"])){u=d;break}(!u&&c!==a.parentNode||a.nextSibling!==u)&&a!==u&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,u))}else a.nodeType===1&&(a.hidden=!0)}BB&&i5e(s.$elm$),Rc.$flags$&=-2,em.length=0}},oht=(t,e)=>{},qce=(t,e)=>(t.$flags$|=16,oht(t,t.$ancestorComponent$),Rht(()=>aht(t,e))),aht=(t,e)=>{const r=t.$hostElement$,i=LS("scheduleUpdate",t.$cmpMeta$.$tagName$),n=r;let s;return e?s=JM(n,"componentWillLoad"):s=JM(n,"componentWillUpdate"),s=vAe(s,()=>JM(n,"componentWillRender")),i(),vAe(s,()=>lht(t,n,e))},lht=async(t,e,r)=>{const i=t.$hostElement$,n=LS("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&rht(t);const s=LS("render",t.$cmpMeta$.$tagName$);cht(t,e,i),s(),n(),uht(t)},cht=(t,e,r)=>{try{dAe=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(uC.hasRenderFn||uC.reflect)&&(uC.vdomRender||uC.reflect)&&(uC.hydrateServerSide||sht(t,e))}catch(a){FN(a,t.$hostElement$)}return dAe=null,null},uht=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=LS("postUpdate",e),n=r;t.$ancestorComponent$,JM(n,"componentDidRender"),t.$flags$&64?(JM(n,"componentDidUpdate"),i()):(t.$flags$|=64,JM(n,"componentDidLoad"),i())},Wor=t=>{{const e=NN(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&qce(e,!1),r}},JM=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){FN(i)}},vAe=(t,e)=>t&&t.then?t.then(e):e(),hht=(t,e)=>NN(t).$instanceValues$.get(e),dht=(t,e,r,i)=>{const n=NN(t),s=t,o=n.$instanceValues$.get(e),a=n.$flags$,l=s;r=Zut(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){n.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const d=i.$watchers$[e];d&&d.map(p=>{try{l[p](r,o,e)}catch(A){FN(A,s)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;qce(n,!1)}}}},pht=(t,e,r)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),n=t.prototype;i.map(([s,[o]])=>{(o&31||o&32)&&Object.defineProperty(n,s,{get(){return hht(this,s)},set(a){dht(this,s,a,e)},configurable:!0,enumerable:!0})});{const s=new Map;n.attributeChangedCallback=function(o,a,l){Rc.jmp(()=>{const c=s.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(n.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return s.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},fht=async(t,e,r,i,n)=>{if(!(e.$flags$&32)&&(n=t.constructor,e.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),n.style)){let o=n.style;typeof o!="string"&&(o=o[e.$modeName$=Xut(t)]);const a=J4e(r,e.$modeName$);if(!GB.has(a)){const l=LS("registerStyles",r.$tagName$);eht(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,(()=>qce(e,!0))()},mht=t=>{},ght=t=>{if(!(Rc.$flags$&1)){const e=NN(t),r=e.$cmpMeta$,i=LS("connectedCallback",r.$tagName$);e.$flags$&1?(o5e(t,e,r.$listeners$),mht(e.$lazyInstance$)):(e.$flags$|=1,r.$flags$&12&&Aht(t),r.$members$&&Object.entries(r.$members$).map(([n,[s]])=>{if(s&31&&t.hasOwnProperty(n)){const o=t[n];delete t[n],t[n]=o}}),fht(t,e,r)),i()}},Aht=t=>{const e=t["s-cr"]=wA.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},yht=t=>{if(!(Rc.$flags$&1)){const e=NN(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},Qor=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[],!wAe&&r.$flags$&1&&(r.$flags$|=8);const i=t.prototype.connectedCallback,n=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){wht(this,r)},connectedCallback(){ght(this),i&&i.call(this)},disconnectedCallback(){yht(this),n&&n.call(this)},__attachShadow(){wAe?this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)}):this.shadowRoot=this}}),t.is=r.$tagName$,pht(t,r)},Yor=(t,e)=>e,o5e=(t,e,r,i)=>{r&&r.map(([n,s,o])=>{const a=vht(t,n),l=_ht(e,o),c=bht(n);Rc.ael(a,s,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>Rc.rel(a,s,l,c))})},_ht=(t,e)=>r=>{try{uC.lazyLoad||t.$hostElement$[e](r)}catch(i){FN(i)}},vht=(t,e)=>e&4?wA:e&8?kN:e&16?wA.body:t,bht=t=>Tht?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,a5e=new WeakMap,NN=t=>a5e.get(t),wht=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return o5e(t,r,e.$listeners$),a5e.set(t,r)},bAe=(t,e)=>e in t,FN=(t,e)=>(0,console.error)(t,e),GB=new Map,xht=[],kN=typeof window<"u"?window:{},wA=kN.document||{head:{}},Xor=kN.HTMLElement||class{},Rc={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},wAe=!0,Tht=(()=>{let t=!1;try{wA.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),Sht=t=>Promise.resolve(t),Eht=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),xAe=[],l5e=[],Cht=(t,e)=>r=>{t.push(r),pte||(pte=!0,e&&Rc.$flags$&4?Mht(fte):Rc.raf(fte))},TAe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){FN(r)}t.length=0},fte=()=>{TAe(xAe),TAe(l5e),(pte=xAe.length>0)&&Rc.raf(fte)},Mht=t=>Sht().then(t),Rht=Cht(l5e,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */const c5e="calcite-mode-auto",u5e="calcite-mode-dark",Oht="calcite-mode-light",Zor={autoMode:c5e,darkMode:u5e,lightMode:Oht,rtl:"calcite--rtl"};/*!
* tabbable 6.0.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var h5e=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],jB=h5e.join(","),d5e=typeof Element>"u",NS=d5e?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,HB=!d5e&&Element.prototype.getRootNode?function(t){return t.getRootNode()}:function(t){return t.ownerDocument},p5e=function(e,r,i){var n=Array.prototype.slice.apply(e.querySelectorAll(jB));return r&&NS.call(e,jB)&&n.unshift(e),n=n.filter(i),n},f5e=function t(e,r,i){for(var n=[],s=Array.from(e);s.length;){var o=s.shift();if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?n.push.apply(n,c):n.push({scopeParent:o,candidates:c})}else{var u=NS.call(o,jB);u&&i.filter(o)&&(r||!e.includes(o))&&n.push(o);var d=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),p=!i.shadowRootFilter||i.shadowRootFilter(o);if(d&&p){var A=t(d===!0?o.children:d.children,!0,i);i.flatten?n.push.apply(n,A):n.push({scopeParent:o,candidates:A})}else s.unshift.apply(s,o.children)}}return n},m5e=function(e,r){return e.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||e.isContentEditable)&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},Pht=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},g5e=function(e){return e.tagName==="INPUT"},Iht=function(e){return g5e(e)&&e.type==="hidden"},$ht=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},Dht=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},Lht=function(e){if(!e.name)return!0;var r=e.form||HB(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=i(window.CSS.escape(e.name));else try{n=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=Dht(n,e.form);return!s||s===e},Nht=function(e){return g5e(e)&&e.type==="radio"},Fht=function(e){return Nht(e)&&!Lht(e)},kht=function(e){for(var r,i=HB(e).host,n=!!((r=i)!==null&&r!==void 0&&r.ownerDocument.contains(i)||e.ownerDocument.contains(e));!n&&i;){var s;i=HB(i).host,n=!!((s=i)!==null&&s!==void 0&&s.ownerDocument.contains(i))}return n},SAe=function(e){var r=e.getBoundingClientRect(),i=r.width,n=r.height;return i===0&&n===0},Uht=function(e,r){var i=r.displayCheck,n=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=NS.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(NS.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof n=="function"){for(var a=e;e;){var l=e.parentElement,c=HB(e);if(l&&!l.shadowRoot&&n(l)===!0)return SAe(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(kht(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return SAe(e);return!1},Bht=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var n=r.children.item(i);if(n.tagName==="LEGEND")return NS.call(r,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}r=r.parentElement}return!1},qB=function(e,r){return!(r.disabled||Iht(r)||Uht(r,e)||$ht(r)||Bht(r))},mte=function(e,r){return!(Fht(r)||m5e(r)<0||!qB(e,r))},zht=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},Vht=function t(e){var r=[],i=[];return e.forEach(function(n,s){var o=!!n.scopeParent,a=o?n.scopeParent:n,l=m5e(a,o),c=o?t(n.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:s,tabIndex:l,item:n,isScope:o,content:c})}),i.sort(Pht).reduce(function(n,s){return s.isScope?n.push.apply(n,s.content):n.push(s.content),n},[]).concat(r)},Ght=function(e,r){r=r||{};var i;return r.getShadowRoot?i=f5e([e],r.includeContainer,{filter:mte.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:zht}):i=p5e(e,r.includeContainer,mte.bind(null,r)),Vht(i)},Jor=function(e,r){r=r||{};var i;return r.getShadowRoot?i=f5e([e],r.includeContainer,{filter:qB.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=p5e(e,r.includeContainer,qB.bind(null,r)),i},Kor=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return NS.call(e,jB)===!1?!1:mte(r,e)},jht=h5e.concat("iframe").join(","),ear=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return NS.call(e,jht)===!1?!1:qB(r,e)};const Hht={getShadowRoot:!0};function tar(t){const e="dir",r=`[${e}]`,i=qht(t,r);return i?i.getAttribute(e):"ltr"}function rar(t,e,r){const i=`[${e}]`,n=t.closest(i);return n?n.getAttribute(e):r}function A5e(t){return t.getRootNode()}function y5e(t){return t.host||null}function iar(t,{selector:e,id:r}){function i(n){if(!n)return null;n.assignedSlot&&(n=n.assignedSlot);const s=A5e(n),o=r?"getElementById"in s?s.getElementById(r):null:e?s.querySelector(e):null,a=y5e(s);return o||(a?i(a):null)}return i(t)}function qht(t,e){function r(i){return i?i.closest(e)||r(y5e(A5e(i))):null}return r(t)}function Wht(t,e){return _5e(t,e)}function _5e(t,e){if(!t)return;const r=e(t);if(r!==void 0)return r;const{parentNode:i}=t;return _5e(i instanceof ShadowRoot?i.host:i,e)}function nar(t,e){return!!Wht(e,r=>r===t?!0:void 0)}function Qht(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function sar(t){if(t)return Qht(t)?t.setFocus():t.focus()}function oar(t){(Ght(t,Hht)[0]||t).focus()}const oL=":not([slot])";function aar(t,e,r){e&&!Array.isArray(e)&&typeof e!="string"&&(r=e,e=null);const i=e?Array.isArray(e)?e.map(n=>`[slot="${n}"]`).join(","):`[slot="${e}"]`:oL;return r!=null&&r.all?Yht(t,i,r):Xht(t,i,r)}function v5e(t,e){return t?Array.from(t.children||[]).filter(r=>r==null?void 0:r.matches(e)):[]}function Yht(t,e,r){let i=e===oL?v5e(t,oL):Array.from(t.querySelectorAll(e));i=r&&r.direct===!1?i:i.filter(s=>s.parentElement===t),i=r!=null&&r.matches?i.filter(s=>s==null?void 0:s.matches(r.matches)):i;const n=r==null?void 0:r.selector;return n?i.map(s=>Array.from(s.querySelectorAll(n))).reduce((s,o)=>[...s,...o],[]).filter(s=>!!s):i}function Xht(t,e,r){let i=e===oL?v5e(t,oL)[0]||null:t.querySelector(e);i=r&&r.direct===!1||(i==null?void 0:i.parentElement)===t?i:null,i=r!=null&&r.matches?i!=null&&i.matches(r.matches)?i:null:i;const n=r==null?void 0:r.selector;return n?i==null?void 0:i.querySelector(n):i}function lar(t,e,r){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[r]}function car(t){return(!!t).toString()}function uar(t){return!!Zht(t).length}function Zht(t){return t.target.assignedElements({flatten:!0})}function har(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */function EAe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(u5e)||t.contains(c5e)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),n=o=>{s!==o&&i(o),s=o};let s=r();i(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>n(o.matches?"dark":"light")),new MutationObserver(()=>n(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function Jht(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?EAe():document.addEventListener("DOMContentLoaded",()=>EAe(),{once:!0}))}const Kht=Jht;Kht();let b5e;function edt(){Vut(np(nn(b5e)))}b5e="components/assets";const w5e=Symbol("widget"),tdt=Symbol("widget-test-data"),rdt=[],idt={},WB=new WeakMap;function x5e(t,e){let r=e.children;if(r&&r.length)for(let n=0;n<r.length;++n)r[n]=x5e(t,r[n]);else r=rdt;const i=e.vnodeSelector;if(Wce(i)){const n=e.properties||idt,s=n.key||i;return{vnodeSelector:"div",properties:{key:s,afterCreate:ndt,afterUpdate:sdt,afterRemoved:T5e,parentWidget:t,widgetConstructor:i,widgetProperties:{...n,key:s,children:r}},children:void 0,text:void 0,domNode:null}}return e}function ndt(t,e,r,{parentWidget:i,widgetConstructor:n,widgetProperties:s}){var a;const o=new n(s);o.container=t,WB.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),i._internalHandles.add(Rm(()=>T5e(t)))}function sdt(t,e,r,{widgetProperties:i}){var s;const n=WB.get(t);n&&(n.set(i),(s=n.afterUpdate)==null||s.call(n,n,t))}function T5e(t){var r;const e=WB.get(t);e&&((r=e.afterRemoved)==null||r.call(e,e,t),e.destroy(),WB.delete(t))}function Wce(t){return typeof t=="function"&&t[w5e]}const CAe=new Set;function odt(t){CAe.add(t),t.finally(()=>CAe.delete(t))}var S5e;const adt="esri.widgets.Widget";let ldt=0;const cdt={widgetIcon:"esri-icon-checkbox-unchecked"};function E5e(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?E5e(t[r],e==null?void 0:e[r]):t[r]=e[r]);return t}const udt=zut({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,n,s,o)=>{const a=e==null?void 0:e(i,n,s,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in s)||l){const c=i[2].toLowerCase()+i.slice(3),u=A=>a==null?void 0:a.call(s,A);s.addEventListener(c,u,l);const d=()=>s.removeEventListener(c,u,l),p=o.afterRemoved;o.afterRemoved=A=>{p==null||p(A),d()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:n,type:s}=i,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&(k4e(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let UW=!1,hl=class extends bG(Ws.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._internalHandles=new cn,this._projector=udt,this._readyForTrueRender=!1,this.iconClass=cdt.widgetIcon,this.key=this,this._loadLocale=lRe(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await fh(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{let c=await Ele(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=E5e(Te(c),this.uiStrings)),this[l]=c}));for(const a of o)a.error&&we.getLogger(this.declaredClass).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),edt();const i="esri-widget-uid-"+Lut(),n=this.render.bind(this);this._trackingTarget=new _G(()=>this.scheduleRender());const s=()=>{var d;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0};const o=n();let{properties:a}=o;a||(o.properties=a={});let{key:l,styles:c}=a;l||(a.key=i),c||(a.styles=c={}),c.display||(c.display="");let u=0;return(d=o.children)==null||d.forEach(p=>{if(Wce(p.vnodeSelector))return;let{properties:A}=p;A||(p.properties=A={}),A.key||(A.key=`${this.id}--${u++}`)}),x5e(this,o)};this.render=()=>{if(UW)return s();let o=put(this)??null;if(o)return o;this._trackingTarget.clear(),UW=!0;try{o=K_(this._trackingTarget,s)}catch(a){throw console.error(a),a}finally{UW=!1}return o&&fut(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),odt(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(WJ)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(yt(this._trackingTarget),yt(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,FW(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return jG(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+ldt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(S5e=w5e,tdt)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(FW(this),this._projector.scheduleRender())}classes(...e){return B4e.apply(this,e)}renderNow(){FW(this),this._projector.renderNow()}_postInitialize(){var r;if(this.destroyed)return;this.scheduleRender(),(r=this._delegatedEventNames)!=null&&r.length&&this._internalHandles.add(xe(()=>this.viewModel,(i,n)=>{n&&this._internalHandles.remove("delegated-events"),i&&AG(i)&&this._internalHandles.add(this._delegatedEventNames.map(s=>vN(i,s,o=>{this.emit(s,o)})),"delegated-events")},Rr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(WJ),this.scheduleRender()};this._internalHandles.add([xle(e),xe(()=>this.uiStrings,e),ic(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var r;this._attached&&(this._projector.detach(this.render),this._attached=!1),(r=e==null?void 0:e.parentNode)==null||r.removeChild(e)}};hl[S5e]=!0,h([f()],hl.prototype,"_readyForTrueRender",void 0),h([f({value:null})],hl.prototype,"container",null),h([Wr("container")],hl.prototype,"castContainer",null),h([f()],hl.prototype,"iconClass",void 0),h([f()],hl.prototype,"id",null),h([f()],hl.prototype,"label",null),h([f()],hl.prototype,"renderable",null),h([f()],hl.prototype,"uiStrings",void 0),h([f()],hl.prototype,"viewModel",void 0),h([f({value:!0})],hl.prototype,"visible",null),h([f()],hl.prototype,"key",void 0),h([f()],hl.prototype,"children",void 0),h([f()],hl.prototype,"afterCreate",void 0),h([f()],hl.prototype,"afterUpdate",void 0),h([f()],hl.prototype,"afterRemoved",void 0),hl=h([Q(adt)],hl);const Lc=hl;function hdt(t,e,r){return t.units[e][r]}function uj(t,e,r,i=2,n="abbr"){return`${NA(e,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:e>0?"never":"exceptZero"})} ${hdt(t,r,n)}`}function par(t,e,r,i=2,n="abbr"){const s=dOe(e,r);return uj(t,ra(e,r,s),s,i,n)}function far(t,e,r,i=2,n="abbr"){const s=pOe(e,r);return uj(t,ra(e,r,s),s,i,n)}function mar(t,e,r,i=2,n="abbr"){const s=fOe(e,r);return uj(t,ra(e,r,s),s,i,n)}function gar(t,e,r,i=2,n="abbr"){const s=mOe(e,r);return uj(t,ra(e,r,s),s,i,n)}const MAe=["B","kB","MB","GB","TB"];function ddt(t,e){let r=e===0?0:Math.floor(Math.log(e)/Math.log(tO.KILOBYTES));r=He(r,0,MAe.length-1);const i=NA(e/tO.KILOBYTES**r,{maximumFractionDigits:2});return PA(t.units.bytes[MAe[r]],{fileSize:i})}function pdt(t){const{exifInfo:e,exifName:r,tagName:i}=t;if(!e||!r||!i)return null;const n=e.find(s=>s.name===r);return n?fdt({tagName:i,tags:n.tags}):null}function fdt(t){const{tagName:e,tags:r}=t;if(!r||!e)return null;const i=r.find(n=>n.name===e);return i&&i.value||null}var gte;const mdt={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let Ph=gte=class extends Je{constructor(t){super(t),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:t}=this,e=pdt({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:t});return mdt[e]||null}clone(){return new gte({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};h([f({type:String})],Ph.prototype,"contentType",void 0),h([f()],Ph.prototype,"exifInfo",void 0),h([f({readOnly:!0})],Ph.prototype,"orientationInfo",null),h([f({type:ds})],Ph.prototype,"id",void 0),h([f({type:String})],Ph.prototype,"globalId",void 0),h([f({type:String})],Ph.prototype,"keywords",void 0),h([f({type:String})],Ph.prototype,"name",void 0),h([f({json:{read:!1}})],Ph.prototype,"parentGlobalId",void 0),h([f({json:{read:!1}})],Ph.prototype,"parentObjectId",void 0),h([f({type:ds})],Ph.prototype,"size",void 0),h([f({json:{read:!1}})],Ph.prototype,"url",void 0),Ph=gte=h([Q("esri.layers.support.AttachmentInfo")],Ph);const gdt=Ph;var Ate;let zl=Ate=class extends Je{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new Ate(Te({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};h([f({type:[String],json:{write:!0}})],zl.prototype,"attachmentTypes",void 0),h([f({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],zl.prototype,"attachmentsWhere",void 0),h([f({type:Boolean,json:{write:!0}})],zl.prototype,"cacheHint",void 0),h([f({type:[String],json:{write:!0}})],zl.prototype,"keywords",void 0),h([f({type:[Number],json:{write:!0}})],zl.prototype,"globalIds",void 0),h([f({json:{write:!0}})],zl.prototype,"name",void 0),h([f({type:Number,json:{read:{source:"resultRecordCount"}}})],zl.prototype,"num",void 0),h([f({type:[Number],json:{write:!0}})],zl.prototype,"objectIds",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],zl.prototype,"returnMetadata",void 0),h([f({type:[Number],json:{write:!0}})],zl.prototype,"size",void 0),h([f({type:Number,json:{read:{source:"resultOffset"}}})],zl.prototype,"start",void 0),h([Ct("start"),Ct("num")],zl.prototype,"writeStart",null),h([f({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],zl.prototype,"where",void 0),zl=Ate=h([Q("esri.rest.support.AttachmentQuery")],zl),zl.from=Go(zl);const yte=zl,Adt="esri.widgets.Feature.support.featureUtils",RAe=we.getLogger(Adt),ydt=/href=(""|'')/gi,_dt=/(\{([^\{\r\n]+)\})/g,vdt=/\'/g,C5e=/^\s*expression\//i,bdt=/(\n)/gi,wdt=/[\u00A0-\u9999<>\&]/gim,xdt=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,Tdt=/^(?:mailto:|tel:)/,M5e="relationships/",_te=OG("short-date-short-time");function R5e(t){if(!k(t))return t.get("sourceLayer")||t.get("layer")}async function QB(t,e){return typeof t=="function"?t.call(null,e):t}function O5e(t=""){if(t)return!Tdt.test(t.trim().toLowerCase())}function Qce(t){return!!t&&C5e.test(t)}function Sdt(t,e){if(!Qce(e)||!t)return null;const r=e.replace(C5e,"").toLowerCase();let i=null;return t.some(n=>n.name.toLowerCase()===r&&(i=n,!0)),i}function P5e(t,e){const r=Sdt(e,t==null?void 0:t.fieldName);return r?r.title||null:t?t.label||t.fieldName:null}function Edt(t,e){const r=e.get(t.toLowerCase());return`{${r&&r.fieldName||t}}`}function Cdt(t){return t.replace(ydt,"")}function aL(t,e){const r=Yce(e,t);return r?r.name:t}function Mdt(t,e){return t&&t.map(r=>aL(r,e))}function Yce(t,e){return t&&typeof t.getField=="function"&&e?t.getField(e)??null:null}function I5e(t){return`${t}`.trim()}function NT({attributes:t,globalAttributes:e,layer:r,text:i,expressionAttributes:n,fieldInfoMap:s}){return i?vte({formattedAttributes:e,template:Idt(i,{...e,...n,...t},r),fieldInfoMap:s}):""}function vte({formattedAttributes:t,template:e,fieldInfoMap:r}){return I5e(Cdt(PA(PA(e,i=>Edt(i,r)),t)))}function Rdt(t,e,r=!1){const i=e[t];if(typeof i=="string"){const n="%27",s=(r?encodeURIComponent(i):i).replace(vdt,n);e[t]=s}}function Odt(t,e=!1){const r={...t};return Object.keys(r).forEach(i=>Rdt(i,r,e)),r}function Pdt(t,e,r){const i=(e=I5e(e))&&e[0]!=="{";return PA(t,Odt(r,i||!1))}function bte(t,e){return t.replace(_dt,(r,i,n)=>{const s=Yce(e,n);return s?`{${s.name}}`:i})}function Idt(t,e,r){const i=bte(t,r);return i&&i.replace(xdt,(n,s,o)=>Pdt(n,s||o,e))}function $dt(t,e){if(typeof t=="string"&&e&&e.dateFormat==null&&(e.places!=null||e.digitSeparator!=null)){const r=Number(t);if(!isNaN(r))return r}return t}function Ddt(t){return(t==null?void 0:t.type)==="feature"}function OAe(t){return!!(t!=null&&t.layer)}function Ldt(t){return(t==null?void 0:t.type)==="map-image"}function Ndt(t,e){var c;const r=e.fieldInfos,i=e.fieldName,n=(c=$5e(r,i))==null?void 0:c.clone(),s=e.preventPlacesFormatting,o=e.layer,a=Yce(o,i);if(n&&(a==null?void 0:a.type)==="date"){const u=n.format||new gM;u.dateFormat=u.dateFormat||"short-date-short-time",u.dateTimeFormatOptions=!OAe(o)&&Ddt(o)&&o.datesInUnknownTimezone||OAe(o)&&Ldt(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,n.format=u}const l=n&&n.format;return typeof t=="string"&&$Pe(i)&&l?l.formatRasterPixelValue(t):typeof(t=$dt(t,l))=="string"||t==null||l==null?UN(t):s?NA(t,{...FPe(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(t)}function $5e(t,e){if(!t||!t.length||!e)return;const r=e.toLowerCase();let i;return t.some(n=>!(!n.fieldName||n.fieldName.toLowerCase()!==r)&&(i=n,!0)),i}function Fdt({fieldName:t,graphic:e,layer:r}){if(C_(t)||!r||typeof r.getFeatureType!="function")return null;const{typeIdField:i}=r;if(!i||t!==i)return null;const n=r.getFeatureType(e);return n?n.name:null}function kdt({fieldName:t,value:e,graphic:r,layer:i}){if(C_(t)||!i||typeof i.getFieldDomain!="function")return null;const n=r&&i.getFieldDomain(t,{feature:r});return n&&n.type==="coded-value"?n.getName(e):null}function Udt(t,e){const{creatorField:r,creationDateField:i,editorField:n,editDateField:s}=t;if(!e)return;const o=e[s];if(typeof o=="number"){const l=e[n];return{type:"edit",date:LA(o,_te),user:l}}const a=e[i];if(typeof a=="number"){const l=e[r];return{type:"create",date:LA(a,_te),user:l}}return null}function Bdt(t,e){const r=new Map;return t&&t.forEach(i=>{const n=aL(i.fieldName,e);i.fieldName=n,r.set(n.toLowerCase(),i)}),r}function PAe(t){const e=[];if(!t)return e;const{fieldInfos:r,content:i}=t;return r&&e.push(...r),i&&Array.isArray(i)&&i.forEach(n=>{if(n.type==="fields"){const s=n&&n.fieldInfos;s&&e.push(...s)}}),e}function Xce(t){return t.replace(wdt,e=>`&#${e.charCodeAt(0)};`)}function UN(t){return typeof t=="string"?t.replace(bdt,'<br class="esri-text-new-line" />'):t}function D5e(t){const{value:e,fieldName:r,fieldInfos:i,fieldInfoMap:n,layer:s,graphic:o}=t;if(e==null)return"";const a=kdt({fieldName:r,value:e,graphic:o,layer:s});if(a)return a;const l=Fdt({fieldName:r,graphic:o,layer:s});if(l)return l;if(n.get(r.toLowerCase()))return Ndt(e,{fieldInfos:i||Array.from(n.values()),fieldName:r,layer:s});const c=s&&s.fieldsIndex;return c&&c.isDateField(r)?LA(e,_te):UN(e)}function BW({fieldInfos:t,attributes:e,layer:r,graphic:i,fieldInfoMap:n,relatedInfos:s}){const o={};return s==null||s.forEach(a=>jdt({attributes:o,relatedInfo:a,fieldInfoMap:n,fieldInfos:t,layer:r})),e&&Object.keys(e).forEach(a=>{const l=e[a];o[a]=D5e({fieldName:a,fieldInfos:t,fieldInfoMap:n,layer:r,value:l,graphic:i})}),o}async function L5e(t,e){var u,d;const{layer:r,graphic:i,outFields:n,objectIds:s,returnGeometry:o,spatialReference:a}=t,l=s[0];if(typeof l!="number"&&typeof l!="string"){const p="Could not query required fields for the specified feature. The feature's ID is invalid.",A={layer:r,graphic:i,objectId:l,requiredFields:n};return RAe.warn(p,A),null}if(!((d=(u=NOe(r))==null?void 0:u.operations)!=null&&d.supportsQuery)){const p="The specified layer cannot be queried. The following fields will not be available.",A={layer:r,graphic:i,requiredFields:n,returnGeometry:o};return RAe.warn(p,A),null}const c=r.createQuery();return c.objectIds=s,c.outFields=n!=null&&n.length?n:[r.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await r.queryFeatures(c,e)).features[0]}async function zdt(t){var i;if(!((i=t.expressionInfos)!=null&&i.length))return!1;const e=await DA(),{arcadeUtils:{hasGeometryFunctions:r}}=e;return r(t)}async function Vdt({graphic:t,popupTemplate:e,layer:r,spatialReference:i},n){if(!r||!e||(typeof r.load=="function"&&await r.load(n),!t.attributes))return;const s=t.attributes[r.objectIdField];if(s==null)return;const o=[s],a=await e.getRequiredFields(r.fieldsIndex),l=pst(a,t),c=l?[]:a,u=e.returnGeometry||await zdt(e);if(l&&!u)return;const d=await L5e({layer:r,graphic:t,outFields:c,objectIds:o,returnGeometry:u,spatialReference:i},n);d&&(d.geometry&&(t.geometry=d.geometry),d.attributes&&(t.attributes={...t.attributes,...d.attributes}))}function C_(t=""){return!!t&&t.includes(M5e)}function Gdt(t){return t?`${M5e}${t.layerId}/${t.fieldName}`:""}function IAe({attributes:t,graphic:e,relatedInfo:r,fieldInfos:i,fieldInfoMap:n,layer:s}){t&&e&&r&&Object.keys(e.attributes).forEach(o=>{const a=Gdt({layerId:r.relation.id.toString(),fieldName:o}),l=e.attributes[o];t[a]=D5e({fieldName:a,fieldInfos:i,fieldInfoMap:n,layer:s,value:l,graphic:e})})}function jdt({attributes:t,relatedInfo:e,fieldInfoMap:r,fieldInfos:i,layer:n}){t&&e&&(e.relatedFeatures&&e.relatedFeatures&&e.relatedFeatures.forEach(s=>IAe({attributes:t,graphic:s,relatedInfo:e,fieldInfoMap:r,fieldInfos:i,layer:n})),e.relatedStatsFeatures&&e.relatedStatsFeatures&&e.relatedStatsFeatures.forEach(s=>IAe({attributes:t,graphic:s,relatedInfo:e,fieldInfoMap:r,fieldInfos:i,layer:n})))}const $Ae=t=>{if(!t)return!1;const e=t.toUpperCase();return e.includes("CURRENT_TIMESTAMP")||e.includes("CURRENT_DATE")||e.includes("CURRENT_TIME")},N5e=({layer:t,method:e,query:r,definitionExpression:i})=>{var o,a;if(!((a=(o=t.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||e==="attachments")return;const n=M(r.where)?r.where:null,s=M(r.geometry)?r.geometry:null;$Ae(i)||$Ae(n)||(s==null?void 0:s.type)==="extent"||r.resultType==="tile"||(r.cacheHint=!0)},Hdt=({query:t,layer:e,method:r})=>{N5e({layer:e,method:r,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})},qdt=({queryPayload:t,layer:e,method:r})=>{N5e({layer:e,method:r,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})};function Wdt(t,e,r){return t&&e&&r?DAe(t.allLayers,e,r)||DAe(t.allTables,e,r):null}function DAe(t,e,r){return t.find(i=>i!==e&&i.type==="feature"&&i.url===e.url&&i.layerId===r.relatedTableId)}const LAe={editing:!1,operations:{add:!0,update:!0,delete:!0}},F5e=ur.ofType(gdt);let Ih=class extends rt{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...LAe},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new F5e,this.fileInfos=new ur,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(xe(()=>this.graphic,()=>this._graphicChanged(),Rr))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...LAe,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const r=e.layer||e.sourceLayer;return(r==null?void 0:r.loaded)&&"capabilities"in r&&r.capabilities&&"operations"in r.capabilities&&"supportsResizeAttachments"in r.capabilities.operations&&r.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:r}=this;if(!e||typeof e.queryAttachments!="function")throw new pe("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getObjectId(),n=new yte({objectIds:[i],returnMetadata:!0}),s=[],o=e.queryAttachments(n).then(l=>l[i]||s).catch(()=>s);this._getAttachmentsPromise=o,this.notifyChange("state");const a=await o;return r.removeAll(),a.length&&r.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(e,r=this.graphic){var l;const{_attachmentLayer:i,attachmentInfos:n,abilities:s}=this;if(!r)throw new pe("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:r});if(!e)throw new pe("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((l=s.operations)!=null&&l.add))throw new pe("invalid-abilities","addAttachment(): add abilities are required.");if(!i||typeof i.addAttachment!="function")throw new pe("invalid-layer","addAttachment(): A valid layer is required.");const o=i.addAttachment(r,e).then(c=>this._queryAttachment(c.objectId,r)),a=await o;return n.add(a),a}async deleteAttachment(e){var l;const{_attachmentLayer:r,attachmentInfos:i,graphic:n,abilities:s}=this;if(!e)throw new pe("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((l=s.operations)!=null&&l.delete))throw new pe("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!r||typeof r.deleteAttachments!="function")throw new pe("invalid-layer","deleteAttachment(): A valid layer is required.");if(!n)throw new pe("invalid-graphic","deleteAttachment(): A graphic is required.");const o=r.deleteAttachments(n,[e.id]).then(()=>e),a=await o;return i.remove(a),a}async updateAttachment(e,r=this.activeAttachmentInfo){var u;const{_attachmentLayer:i,attachmentInfos:n,graphic:s,abilities:o}=this;if(!e)throw new pe("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!r)throw new pe("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:r});if(!((u=o.operations)!=null&&u.update))throw new pe("invalid-abilities","updateAttachment(): Update abilities are required.");const a=n.findIndex(d=>d===r);if(!i||typeof i.updateAttachment!="function")throw new pe("invalid-layer","updateAttachment(): A valid layer is required.");if(!s)throw new pe("invalid-graphic","updateAttachment(): A graphic is required.");const l=i.updateAttachment(s,r.id,e).then(d=>this._queryAttachment(d.objectId)),c=await l;return n.splice(a,1,c),c}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,r){if(!e||!r)return null;const i={file:e,form:r};return this.fileInfos.add(i),i}updateFile(e,r,i=this.activeFileInfo){if(!e||!r||!i)return null;const n=this.fileInfos.findIndex(s=>i===s);return n>-1&&this.fileInfos.splice(n,1,{file:e,form:r}),this.fileInfos.items[n]}deleteFile(e){const r=this.fileInfos.find(i=>i.file===e);return r?(this.fileInfos.remove(r),r):null}async _queryAttachment(e,r){const{_attachmentLayer:i}=this;if(!e||!(i!=null&&i.queryAttachments))throw new pe("invalid-attachment-id","Could not query attachment.");const n=this._getObjectId(r),s=new yte({objectIds:[n],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return i.queryAttachments(s).then(o=>o[n][0])}_getObjectId(e=this.graphic){return(e==null?void 0:e.getObjectId())??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,r=R5e(e);this._attachmentLayer=r?r.type==="scene"&&M(r.associatedLayer)?r.associatedLayer:r:null}};h([f()],Ih.prototype,"abilities",void 0),h([Wr("abilities")],Ih.prototype,"castAbilities",null),h([f()],Ih.prototype,"activeAttachmentInfo",void 0),h([f()],Ih.prototype,"activeFileInfo",void 0),h([f({readOnly:!0,type:F5e})],Ih.prototype,"attachmentInfos",void 0),h([f()],Ih.prototype,"fileInfos",void 0),h([f({type:Pl})],Ih.prototype,"graphic",void 0),h([f()],Ih.prototype,"mode",void 0),h([f({readOnly:!0})],Ih.prototype,"state",null),h([f()],Ih.prototype,"filesEnabled",void 0),h([f({readOnly:!0})],Ih.prototype,"supportsResizeAttachments",null),Ih=h([Q("esri.widgets.Attachments.AttachmentsViewModel")],Ih);const Zce=Ih;function NAe(t){const e=t.toLowerCase();return e==="image/bmp"||e==="image/emf"||e==="image/exif"||e==="image/gif"||e==="image/x-icon"||e==="image/jpeg"||e==="image/png"||e==="image/tiff"||e==="image/x-wmf"}function Qdt(t){const e=nn("esri/themes/base/images/files/");return t?t==="text/plain"?`${e}text-32.svg`:t==="application/pdf"?`${e}pdf-32.svg`:t==="text/csv"?`${e}csv-32.svg`:t==="application/gpx+xml"?`${e}gpx-32.svg`:t==="application/x-dwf"?`${e}cad-32.svg`:t==="application/postscript"||t==="application/json"||t==="text/xml"||t==="model/vrml"?`${e}code-32.svg`:t==="application/x-zip-compressed"||t==="application/x-7z-compressed"||t==="application/x-gzip"||t==="application/x-tar"||t==="application/x-gtar"||t==="application/x-bzip2"||t==="application/gzip"||t==="application/x-compress"||t==="application/x-apple-diskimage"||t==="application/x-rar-compressed"||t==="application/zip"?`${e}zip-32.svg`:t.includes("image/")?`${e}image-32.svg`:t.includes("audio/")?`${e}sound-32.svg`:t.includes("video/")?`${e}video-32.svg`:t.includes("msexcel")||t.includes("ms-excel")||t.includes("spreadsheetml")?`${e}excel-32.svg`:t.includes("msword")||t.includes("ms-word")||t.includes("wordprocessingml")?`${e}word-32.svg`:t.includes("powerpoint")||t.includes("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}function tc(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var Ydt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},k5e=function(t,e){for(var r=0,i=t.length;r<i;r++){var n=t[r];Array.isArray(n)?k5e(n,e):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=Ydt(n)),e.push(n))}},Xdt=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var n=[];return k5e(r,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function Ae(t,e,...r){return typeof t!="function"||Wce(t)?Xdt(t,e,...r):t(e,...r)}const FAe={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},bn="esri-attachments",xw="esri-button",Rt={base:bn,loaderContainer:`${bn}__loader-container`,loader:`${bn}__loader`,fadeIn:`${bn}--fade-in`,container:`${bn}__container`,containerList:`${bn}__container--list`,containerPreview:`${bn}__container--preview`,actions:`${bn}__actions`,deleteButton:`${bn}__delete-button`,addAttachmentButton:`${bn}__add-attachment-button`,errorMessage:`${bn}__error-message`,items:`${bn}__items`,item:`${bn}__item`,itemButton:`${bn}__item-button`,itemMask:`${bn}__item-mask`,itemMaskIcon:`${bn}__item-mask--icon`,itemImage:`${bn}__image`,itemImageResizable:`${bn}__image--resizable`,itemLabel:`${bn}__label`,itemFilename:`${bn}__filename`,itemChevronIcon:`${bn}__item-chevron-icon`,itemLink:`${bn}__item-link`,itemLinkOverlay:`${bn}__item-link-overlay`,itemLinkOverlayIcon:`${bn}__item-link-overlay-icon`,itemEditIcon:`${bn}__item-edit-icon`,itemAddIcon:`${bn}__item-add-icon`,itemAddButton:`${bn}__item-add-button`,formNode:`${bn}__form-node`,fileFieldset:`${bn}__file-fieldset`,fileLabel:`${bn}__file-label`,fileName:`${bn}__file-name`,fileInput:`${bn}__file-input`,metadata:`${bn}__metadata`,metadataFieldset:`${bn}__metadata-fieldset`,progressBar:`${bn}__progress-bar`,esriWidget:"esri-widget",esriButton:xw,buttonDisabled:`${xw}--disabled`,esriButtonSecondary:`${xw}--secondary`,esriButtonTertiary:`${xw}--tertiary`,esriButtonThird:`${xw}--third`,esriButtonSmall:`${xw}--small`,esriButtonHalf:`${xw}--half`,empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},zW=window.CSS;let eu=class extends Lc{constructor(e,r){super(e,r),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...FAe},this._supportsImageOrientation=zW&&zW.supports&&zW.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.viewModel||(this.viewModel=new Zce),this.addHandles([Bo(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),Bo(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),xe(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),Rr)])}loadDependencies(){return Promise.all([be(()=>import("./calcite-icon-2d1b5c98.js"),["assets/calcite-icon-2d1b5c98.js","assets/icon-3af55b58.js","assets/observers-4f67f1fb.js"])])}get abilities(){return this.viewModel.abilities}set abilities(e){this.viewModel.abilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...FAe,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:r}=this;return this._set("submitting",!0),this._set("error",null),r.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),r.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new pe("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){const{viewModel:r}=this;return this._set("submitting",!0),this._set("error",null),r.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),r.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new pe("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:r}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(r).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new pe("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,r=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",r}deleteFile(e){var i;const r=this.viewModel.deleteFile(e||((i=this.viewModel.activeFileInfo)==null?void 0:i.file));return this.viewModel.mode="view",r}render(){const{submitting:e,viewModel:r}=this,{state:i}=r;return Ae("div",{class:this.classes(Rt.base,Rt.esriWidget)},e?this.renderProgressBar():null,i==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:r}=this;return e&&r.errorMessage?Ae("div",{key:"error-message",class:Rt.errorMessage},e.message):null}renderAttachments(){const{activeFileInfo:e,mode:r,activeAttachmentInfo:i}=this.viewModel;return r==="add"?this.renderAddForm():r==="edit"?this.renderDetailsForm(i||e):this.renderAttachmentContainer()}renderLoading(){return Ae("div",{class:Rt.loaderContainer,key:"loader"},Ae("div",{class:Rt.loader}))}renderProgressBar(){return this.visibleElements.progressBar?Ae("div",{class:Rt.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:r}=this,i=e||!r,n=this.visibleElements.cancelAddButton?Ae("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Rt.esriButton,Rt.esriButtonTertiary,Rt.esriButtonSmall,Rt.esriButtonHalf,e&&Rt.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?Ae("button",{type:"submit",disabled:i,class:this.classes(Rt.esriButton,Rt.esriButtonSecondary,Rt.esriButtonSmall,Rt.esriButtonHalf,{[Rt.buttonDisabled]:i})},this.messages.add):null,o=r?Ae("span",{key:"file-name",class:Rt.fileName},r.name):null,a=Ae("form",{bind:this,afterCreate:nL,afterRemoved:sAe,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},Ae("fieldset",{class:Rt.fileFieldset},o,Ae("label",{class:this.classes(Rt.fileLabel,Rt.esriButton,Rt.esriButtonSecondary)},r?this.messages.changeFile:this.messages.selectFile,Ae("input",{class:Rt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,n);return Ae("div",{key:"add-form-container",class:Rt.formNode},a)}renderDetailsForm(e){var I,N,L;const{visibleElements:r,viewModel:i,selectedFile:n,submitting:s}=this,{abilities:o}=i,a=s||!n;let l,c,u,d;n?(l=n.type,c=n.name,u=n.size):e&&"file"in e?(l=e.file.type,c=e.file.name,u=e.file.size):e&&"contentType"in e&&(l=e.contentType,c=e.name,u=e.size,d=e.url);const p=o.editing&&((I=o.operations)!=null&&I.delete)&&r.deleteButton?Ae("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:B=>this._submitDeleteAttachment(B,e),class:this.classes(Rt.esriButton,Rt.esriButtonSmall,Rt.esriButtonTertiary,Rt.deleteButton,{[Rt.buttonDisabled]:s})},this.messages.delete):void 0,A=o.editing&&((N=o.operations)!=null&&N.update)&&r.updateButton?Ae("button",{disabled:a,key:"update-button",type:"submit",class:this.classes(Rt.esriButton,Rt.esriButtonSmall,Rt.esriButtonThird,{[Rt.buttonDisabled]:a})},this.messages.update):void 0,v=this.visibleElements.cancelUpdateButton?Ae("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Rt.esriButton,Rt.esriButtonSmall,Rt.esriButtonTertiary,Rt.esriButtonThird,{[Rt.buttonDisabled]:s})},this.messages.cancel):void 0,b=o.editing&&((L=o.operations)!=null&&L.update)?Ae("fieldset",{key:"file",class:Rt.fileFieldset},Ae("span",{key:"file-name",class:Rt.fileName},c),Ae("label",{class:this.classes(Rt.fileLabel,Rt.esriButton,Rt.esriButtonSecondary)},this.messages.changeFile,Ae("input",{class:Rt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,S=Ae("fieldset",{key:"size",class:Rt.metadataFieldset},Ae("label",null,ddt(this.messagesUnits,u??0))),E=Ae("fieldset",{key:"content-type",class:Rt.metadataFieldset},Ae("label",null,l)),R=M(d)?Ae("a",{class:Rt.itemLink,href:d,rel:"noreferrer",target:"_blank"},this.renderImageMask(e,400),Ae("div",{class:Rt.itemLinkOverlay},Ae("span",{class:Rt.itemLinkOverlayIcon},Ae("calcite-icon",{icon:"launch"})))):this.renderImageMask(e,400),O=Ae("form",{bind:this,afterCreate:nL,afterRemoved:sAe,"data-node-ref":"_updateAttachmentForm",onsubmit:B=>this._submitUpdateAttachment(B,e)},Ae("div",{class:Rt.metadata},S,E),b,Ae("div",{class:Rt.actions},p,v,A));return Ae("div",{key:"edit-form-container",class:Rt.formNode},R,O)}renderImageMask(e,r){return e?"file"in e?this.renderGenericImageMask(e.file.name,e.file.type):this.renderImageMaskForAttachment(e,r):null}renderGenericImageMask(e,r){const{supportsResizeAttachments:i}=this.viewModel,n=Qdt(r),s={[Rt.itemImageResizable]:i};return Ae("div",{class:this.classes(Rt.itemMaskIcon,Rt.itemMask)},Ae("img",{title:e,alt:e,src:n,class:this.classes(s,Rt.itemImage)}))}renderImageMaskForAttachment(e,r){const{supportsResizeAttachments:i}=this.viewModel;if(!e)return null;const{contentType:n,name:s,url:o}=e;if(!i||!NAe(n))return this.renderGenericImageMask(s,n);const a=this._getCSSTransform(e),l=a?{transform:a,"image-orientation":"none"}:{},c=`${o}${o!=null&&o.includes("?")?"&":"?"}w=${r}`,u={[Rt.itemImageResizable]:i};return Ae("div",{class:this.classes(Rt.itemMask)},Ae("img",{styles:l,alt:s,title:s,src:c,class:this.classes(u,Rt.itemImage)}))}renderFile(e){const{file:r}=e;return Ae("li",{class:Rt.item,key:r},Ae("button",{key:"details-button",bind:this,class:Rt.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(e),type:"button"},this.renderImageMask(e),Ae("label",{class:Rt.itemLabel},Ae("span",{class:Rt.itemFilename},r.name||this.messages.noTitle),Ae("span",{"aria-hidden":"true",class:this.classes(Rt.itemChevronIcon,pm(this.container)?Rt.iconLeft:Rt.iconRight)}))))}renderAttachmentInfo({attachmentInfo:e,displayType:r}){const{viewModel:i,effectiveDisplayType:n}=this,{abilities:s,supportsResizeAttachments:o}=i,{contentType:a,name:l,url:c}=e,u=this.renderImageMask(e,r==="list"?48:400),d=s.editing?Ae("span",{"aria-hidden":"true",class:this.classes(Rt.itemChevronIcon,pm(this.container)?Rt.iconLeft:Rt.iconRight)}):null,p=[u,n==="preview"&&o&&NAe(a)?null:Ae("label",{class:Rt.itemLabel},Ae("span",{class:Rt.itemFilename},l||this.messages.noTitle),d)],A=s.editing?Ae("button",{key:"details-button",bind:this,class:Rt.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},p):Ae("a",{key:"details-link",class:Rt.itemButton,href:c??void 0,target:"_blank"},p);return Ae("li",{class:Rt.item,key:e},A)}renderAttachmentContainer(){var v;const{effectiveDisplayType:e,viewModel:r,visibleElements:i}=this,{attachmentInfos:n,abilities:s,fileInfos:o}=r,a=!!(n!=null&&n.length),l=!!(o!=null&&o.length),c={[Rt.containerList]:e!=="preview",[Rt.containerPreview]:e==="preview"},u=s.editing&&((v=s.operations)!=null&&v.add)&&i.addButton?Ae("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Rt.esriButton,Rt.esriButtonTertiary,Rt.addAttachmentButton),type:"button"},Ae("span",{"aria-hidden":"true",class:this.classes(Rt.itemAddIcon,Rt.iconPlus)}),this.messages.add):void 0,d=a?Ae("ul",{key:"attachments-list",class:Rt.items},n.toArray().map(b=>this.renderAttachmentInfo({attachmentInfo:b,displayType:e}))):void 0,p=l?Ae("ul",{key:"file-list",class:Rt.items},o.toArray().map(b=>this.renderFile(b))):void 0,A=l||a?void 0:Ae("div",{class:Rt.empty},this.messages.noAttachments);return Ae("div",{key:"attachments-container",class:this.classes(Rt.container,c)},d,p,A,u)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const r=e.target,i=r&&r.files&&r.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,r){e.preventDefault(),r&&("file"in r?this.deleteFile(r.file):r&&this.deleteAttachment(r))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,r){e.preventDefault(),r&&"file"in r?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:r}=this;r.activeFileInfo=null,r.activeAttachmentInfo=e,r.mode="edit"}_startEditFile(e){const{viewModel:r}=this;r.activeAttachmentInfo=null,r.activeFileInfo=e,r.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:r}=e;return!this._supportsImageOrientation&&r?[r.rotation?`rotate(${r.rotation}deg)`:"",r.mirrored?"scaleX(-1)":""].join(" "):""}};h([f()],eu.prototype,"abilities",null),h([f()],eu.prototype,"displayType",void 0),h([f({readOnly:!0})],eu.prototype,"effectiveDisplayType",null),h([f()],eu.prototype,"graphic",null),h([f()],eu.prototype,"label",null),h([f(),tc("esri/widgets/Attachments/t9n/Attachments")],eu.prototype,"messages",void 0),h([f(),tc("esri/core/t9n/Units")],eu.prototype,"messagesUnits",void 0),h([f({readOnly:!0})],eu.prototype,"selectedFile",void 0),h([f({readOnly:!0})],eu.prototype,"submitting",void 0),h([f({readOnly:!0})],eu.prototype,"error",void 0),h([f({type:Zce})],eu.prototype,"viewModel",void 0),h([f()],eu.prototype,"visibleElements",void 0),h([Wr("visibleElements")],eu.prototype,"castVisibleElements",null),eu=h([Q("esri.widgets.Attachments")],eu);const Zdt=eu;let X$=class extends Zce{constructor(e){super(e),this.description=null,this.title=null}};h([f()],X$.prototype,"description",void 0),h([f()],X$.prototype,"title",void 0),X$=h([Q("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],X$);const Jce=X$,Jdt={heading:"esri-widget__heading"};function lL({level:t,class:e,...r},i){const n=Kdt(t);return Ae(`h${n}`,{...r,class:B4e(Jdt.heading,e),role:"heading","aria-level":String(n)},i)}function Kdt(t){return He(Math.ceil(t),1,6)}const VW="esri-feature-element-info",GW={base:VW,title:`${VW}__title`,description:`${VW}__description`};let pC=class extends Lc{constructor(e,r){super(e,r),this.description=null,this.headingLevel=2,this.title=null}render(){return Ae("div",{class:GW.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?Ae(lL,{level:this.headingLevel,class:GW.title},e):null}renderDescription(){const{description:e}=this;return e?Ae("div",{key:"description",class:GW.description},e):null}};h([f()],pC.prototype,"description",void 0),h([f()],pC.prototype,"headingLevel",void 0),h([f()],pC.prototype,"title",void 0),pC=h([Q("esri.widgets.Feature.support.FeatureElementInfo")],pC);const hj=pC,ept={base:"esri-feature-attachments"};let Pg=class extends Lc{constructor(e,r){super(e,r),this._featureElementInfo=null,this.attachmentsWidget=new Zdt,this.headingLevel=2,this.viewModel=new Jce}initialize(){this._featureElementInfo=new hj,this.addHandles([xe(()=>{var e,r;return[(e=this.viewModel)==null?void 0:e.description,(r=this.viewModel)==null?void 0:r.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),Rr),xe(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,Rr)])}destroy(){var e;this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var r;const{attachmentsWidget:e}=this;return Ae("div",{class:ept.base},(r=this._featureElementInfo)==null?void 0:r.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var n;const{description:e,title:r,headingLevel:i}=this;(n=this._featureElementInfo)==null||n.set({description:e,title:r,headingLevel:i})}};h([f({readOnly:!0})],Pg.prototype,"attachmentsWidget",void 0),h([f()],Pg.prototype,"description",null),h([f()],Pg.prototype,"displayType",null),h([f()],Pg.prototype,"graphic",null),h([f()],Pg.prototype,"headingLevel",void 0),h([f()],Pg.prototype,"title",null),h([f({type:Jce})],Pg.prototype,"viewModel",void 0),Pg=h([Q("esri.widgets.Feature.FeatureAttachments")],Pg);const tpt=Pg;let Gv=class extends _E(rt){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(xe(()=>this.creator,r=>{this._destroyContent(),this._createContent(r)},Rr))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:r,destroyer:i}=this;e&&r&&(QB(i,{graphic:r}).catch(()=>null),this._set("created",null))}async _createContent(e){const r=this.graphic;if(!r||!e)return;const i=QB(e,{graphic:r}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const n=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",n))}};h([f({readOnly:!0})],Gv.prototype,"created",void 0),h([f()],Gv.prototype,"creator",void 0),h([f()],Gv.prototype,"destroyer",void 0),h([f({type:Pl})],Gv.prototype,"graphic",void 0),h([f({readOnly:!0})],Gv.prototype,"state",null),Gv=h([Q("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Gv);const YB=Gv;function vl(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${e}'`);return{value:ipt(t[e])}}}function rpt(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function ipt(t){return function(e,...r){rpt(e)?xut(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function npt(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const r=e._delegatedEventNames,i=Array.isArray(t)?t:spt(t);r.push(...i)}}function spt(t){return t.split(",").map(e=>e.trim())}const U5e="calcite-mode-";function opt(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replace(/\s|'|"/g,"")}function XB(){return opt().startsWith("dark")}function apt(){return`${U5e}${XB()?"dark":"light"}`}function lpt(t){cpt(t),t.classList.add(apt())}function cpt(t){Array.from(t.classList).forEach(e=>{e.startsWith(U5e)&&t.classList.remove(e)})}function B5e(t){return t&&typeof t.render=="function"}function upt(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}const jW="esri-feature-content",HW={base:jW,loaderContainer:`${jW}__loader-container`,loader:`${jW}__loader`};let fC=class extends Lc{constructor(e,r){super(e,r),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(n=>{O5e(n.href)&&!n.hasAttribute("target")&&n.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}renderLoading(){return Ae("div",{class:HW.loaderContainer,key:"loader"},Ae("div",{class:HW.loader}))}renderCreated(){var r;const e=(r=this.viewModel)==null?void 0:r.created;return e?e instanceof HTMLElement?Ae("div",{key:e,bind:e,afterCreate:this._attachToNode}):B5e(e)?Ae("div",{key:e},!e.destroyed&&e.render()):Ae("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var r;const e=(r=this.viewModel)==null?void 0:r.state;return Ae("div",{class:HW.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const r=this;e.appendChild(r)}};h([f()],fC.prototype,"creator",null),h([f()],fC.prototype,"graphic",null),h([f({type:YB})],fC.prototype,"viewModel",void 0),fC=h([Q("esri.widgets.Feature.FeatureContent")],fC);const hk=fC;let Gy=class extends rt{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:r}=this,i=[];return r==null||r.forEach(n=>{if(!(!n.hasOwnProperty("visible")||n.visible))return;const s=n.clone();s.label=P5e(s,e),i.push(s)}),i}};h([f()],Gy.prototype,"attributes",void 0),h([f({type:[HPe]})],Gy.prototype,"expressionInfos",void 0),h([f()],Gy.prototype,"description",void 0),h([f({type:[RN]})],Gy.prototype,"fieldInfos",void 0),h([f({readOnly:!0})],Gy.prototype,"formattedFieldInfos",null),h([f()],Gy.prototype,"title",void 0),Gy=h([Q("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Gy);const dj=Gy,hpt=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function dpt(t){let e=null;return hpt.some(r=>(r.pattern.test(t)&&(e=r),!!e)),e}function ppt(t,e){if(typeof e!="string"||!e)return e;const r=dpt(e);if(!r)return e;const i=e.match(r.pattern),n=i&&i[2],s=PA(PA(r.label,{messages:t,hierPart:n}),{appName:r.appName}),o=r.target?` target="${r.target}"`:"",a=r.target==="_blank"?' rel="noreferrer"':"";return e.replace(r.pattern,`<a${o} href="$1"${a}>${s}</a>`)}const $6="esri-feature-fields",dI={base:$6,fieldHeader:`${$6}__field-header`,fieldData:`${$6}__field-data`,fieldDataDate:`${$6}__field-data--date`,esriTable:"esri-widget__table"};let C0=class extends Lc{constructor(e,r){super(e,r),this._featureElementInfo=null,this.viewModel=new dj,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new hj,this.addHandles(xe(()=>{var e,r;return[(e=this.viewModel)==null?void 0:e.description,(r=this.viewModel)==null?void 0:r.title]},()=>this._setupFeatureElementInfo(),Rr))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}renderFieldInfo(e,r){const{attributes:i}=this.viewModel,n=e.fieldName,s=e.label||n,o=i?i[n]==null?"":i[n]:"",a=!(!e.format||!e.format.dateFormat),l=typeof o=="number"&&!a?this._forceLTR(o):ppt(this.messagesURIUtils,o),c={[dI.fieldDataDate]:a};return Ae("tr",{key:`fields-element-info-row-${n}-${r}`},Ae("th",{key:`fields-element-info-row-header-${n}-${r}`,class:dI.fieldHeader,innerHTML:s}),Ae("td",{key:`fields-element-info-row-data-${n}-${r}`,class:this.classes(dI.fieldData,c),innerHTML:l}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?Ae("table",{class:dI.esriTable,summary:this.messages.fieldsSummary},Ae("tbody",null,e.map((r,i)=>this.renderFieldInfo(r,i)))):null}render(){var e;return Ae("div",{class:dI.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){var i;const{description:e,title:r}=this;(i=this._featureElementInfo)==null||i.set({description:e,title:r})}_forceLTR(e){return`&lrm;${e}`}};h([f()],C0.prototype,"attributes",null),h([f()],C0.prototype,"description",null),h([f()],C0.prototype,"expressionInfos",null),h([f()],C0.prototype,"fieldInfos",null),h([f()],C0.prototype,"title",null),h([f({type:dj,nonNullable:!0})],C0.prototype,"viewModel",void 0),h([f(),tc("esri/widgets/Feature/t9n/Feature")],C0.prototype,"messages",void 0),h([f(),tc("esri/widgets/support/t9n/uriUtils")],C0.prototype,"messagesURIUtils",void 0),C0=h([Q("esri.widgets.Feature.FeatureFields")],C0);const z5e=C0,fpt={maximumFractionDigits:20};function mpt(t){return NA(t,fpt)}var wte;let Mx=wte=class extends Je{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,r){e[r]=t??0}clone(){return new wte({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};h([f({type:$t,json:{type:[ds],write:!0}})],Mx.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],Mx.prototype,"label",void 0),h([f({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],Mx.prototype,"value",void 0),h([Ct("value")],Mx.prototype,"writeValue",null),Mx=wte=h([Q("esri.renderers.visualVariables.support.ColorStop")],Mx);const gpt=Mx;function BN(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Apt(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ypt(t,e,r,i,n,s,o,a,l,c,u,d,p,A,v,b){const S=new Float32Array(16);return S[0]=t,S[1]=e,S[2]=r,S[3]=i,S[4]=n,S[5]=s,S[6]=o,S[7]=a,S[8]=l,S[9]=c,S[10]=u,S[11]=d,S[12]=p,S[13]=A,S[14]=v,S[15]=b,S}function _pt(t,e){return new Float32Array(t,e,16)}const vpt=BN();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:vpt,clone:Apt,create:BN,createView:_pt,fromValues:ypt},Symbol.toStringTag,{value:"Module"}));const bpt=(t,e)=>{const r=KA(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return gd(r,r)},wpt=(t,e)=>{const r=KA(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return gd(r,r)},xpt=(t,e)=>{const r=1-e,i=KA(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return gd(i,i)},Tpt=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),n=KA(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return gd(n,n)},Spt=(t,e)=>{const r=1-2*e,i=KA(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return gd(i,i)},Ept=(t,e)=>{const r=KA(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return gd(r,r)},Cpt=(t,e)=>{const r=1-e,i=KA(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return gd(i,i)};let V5e=class G5e{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=Wh(e.strength,r.strength,i),this.radius=Wh(e.radius,r.radius,i),this.threshold=Wh(e.threshold,r.threshold,i)}clone(){return new G5e(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:M5(this.radius),strength:this.strength,threshold:this.threshold}}},j5e=class H5e{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(Wh(e.radius,r.radius,i))}clone(){return new H5e(this.radius)}toJSON(){return{type:"blur",radius:M5(this.radius)}}},xte=class q5e{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=Wh(e.amount,r.amount,i),this._updateMatrix()}clone(){return new q5e(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||BN();switch(this.type){case"brightness":this._colorMatrix=bpt(e,this.amount);break;case"contrast":this._colorMatrix=wpt(e,this.amount);break;case"grayscale":this._colorMatrix=xpt(e,this.amount);break;case"invert":this._colorMatrix=Spt(e,this.amount);break;case"saturate":this._colorMatrix=Ept(e,this.amount);break;case"sepia":this._colorMatrix=Cpt(e,this.amount)}}},W5e=class Q5e{constructor(e,r,i,n){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=n,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=Wh(e.offsetX,r.offsetX,i),this.offsetY=Wh(e.offsetY,r.offsetY,i),this.blurRadius=Wh(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(Wh(e.color[0],r.color[0],i)),this.color[1]=Math.round(Wh(e.color[1],r.color[1],i)),this.color[2]=Math.round(Wh(e.color[2],r.color[2],i)),this.color[3]=Wh(e.color[3],r.color[3],i)}clone(){return new Q5e(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:M5(this.offsetX),yoffset:M5(this.offsetY),blurRadius:M5(this.blurRadius),color:e}}},Y5e=class X5e{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=Wh(e.angle,r.angle,i),this._updateMatrix()}clone(){return new X5e(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||BN();this._colorMatrix=Tpt(e,this.angle)}},Z5e=class J5e{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=Wh(e.amount,r.amount,i)}clone(){return new J5e(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Wh(t,e,r){return t+(e-t)*r}function M5(t){return Math.round(1e3*Wf(t))/1e3}function Mpt(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new xte(t.type,0);case"saturate":case"brightness":case"contrast":return new xte(t.type,1);case"opacity":return new Z5e(1);case"hue-rotate":return new Y5e(0);case"blur":return new j5e(0);case"drop-shadow":return new W5e(0,0,0,[...Mle("transparent")]);case"bloom":return new V5e(0,0,1)}}function Rpt(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,n)=>i.type===r[n].type)}function Opt(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let n=i.length;n<r.length;n++)i.push(Mpt(r[n]))}function Ppt(t){const e=t[0];return!!e&&"type"in e}var kAe,UAe,Tte={};function K5e(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=BAe(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new pe("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:BAe(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!Rpt(e[r].effects,e[r+1].effects))throw new pe("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});Opt(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function BAe(t){let e;if(!t)return[];try{e=Tte.parse(t)}catch(r){throw new pe("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>Ipt(r))}function Ipt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return $pt(t);case"opacity":return Dpt(t);case"hue-rotate":return Lpt(t);case"blur":return Npt(t);case"drop-shadow":return Fpt(t);case"bloom":return kpt(t)}}catch(e){throw e.details.filter=t,e}throw new pe("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function $pt(t){let e=1;return aP(t.parameters,1),t.parameters.length===1&&(e=Y0(t.parameters[0])),new xte(t.name,e)}function Dpt(t){let e=1;return aP(t.parameters,1),t.parameters.length===1&&(e=Y0(t.parameters[0])),new Z5e(e)}function Lpt(t){let e=0;return aP(t.parameters,1),t.parameters.length===1&&(e=jpt(t.parameters[0])),new Y5e(e)}function Npt(t){let e=0;return aP(t.parameters,1),t.parameters.length===1&&(e=tue(t.parameters[0]),zN(e,t.parameters[0])),new j5e(e)}function Fpt(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new pe("effect:type-error","Accepts only one color",{});r=Hpt(i)}else{const n=tue(i);if(Object.isFrozen(e))throw new pe("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(n),e.length===3&&zN(n,i)}if(e.length<2||e.length>3)throw new pe("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new W5e(e[0],e[1],e[2]||0,r||eDe("black"))}function kpt(t){let e=1,r=0,i=0;return aP(t.parameters,3),t.parameters[0]&&(e=Y0(t.parameters[0])),t.parameters[1]&&(r=tue(t.parameters[1]),zN(r,t.parameters[1])),t.parameters[2]&&(i=Y0(t.parameters[2])),new V5e(e,r,i)}function aP(t,e){if(t.length>e)throw new pe("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function pj(t){if(t.type==="color")return"<color>";if(t.unit){if(eue[t.unit])return"<length>";if(Kce[t.unit])return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function zN(t,e){if(t<0)throw new pe("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function Upt(t){if(t.type!=="quantity"||t.unit!==null)throw new pe("effect:type-error",`Expected <double>, Actual: ${pj(t)}`,{term:t})}function Bpt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new pe("effect:type-error",`Expected <double> or <percentage>, Actual: ${pj(t)}`,{term:t})}UAe=function(){function t(n,s){function o(){this.constructor=n}o.prototype=s.prototype,n.prototype=new o}function e(n,s,o,a){var l=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=s,l.found=o,l.location=a,l.name="SyntaxError",l}function r(n,s,o){return o=o||" ",n.length>s?n:(s-=n.length,n+(o+=o.repeat(s)).slice(0,s))}function i(n,s){var o,a={},l=(s=s!==void 0?s:{}).grammarSource,c={start:Nr},u=Nr,d="none",p=")",A=",",v="(",b="%",S="px",E="cm",R="mm",O="in",I="pt",N="pc",L="deg",B="rad",U="grad",q="turn",Z="#",X=".",ee="e",se=/^[ \t\n\r]/,ue=/^[a-z\-]/,re=/^[0-9a-fA-F]/,te=/^[+\-]/,j=/^[0-9]/,H=Rn("none"),W=ie("none",!1),oe=ie(")",!1),le=ie(",",!1),fe=Rn("whitespace"),de=Ri([" ","	",`
`,"\r"],!1,!1),Ee=Rn("function"),Ie=ie("(",!1),Ge=Rn("identifier"),Ke=Ri([["a","z"],"-"],!1,!1),vt=Rn("percentage"),ke=ie("%",!1),Ne=Rn("length"),Xe=ie("px",!1),Se=ie("cm",!1),It=ie("mm",!1),lt=ie("in",!1),qt=ie("pt",!1),er=ie("pc",!1),rr=Rn("angle"),vr=ie("deg",!1),ri=ie("rad",!1),Wi=ie("grad",!1),Lr=ie("turn",!1),ii=Rn("number"),Ut=Rn("color"),bt=ie("#",!1),Bt=Ri([["0","9"],["a","f"],["A","F"]],!1,!1),Wt=Ri(["+","-"],!1,!1),sr=Ri([["0","9"]],!1,!1),Ir=ie(".",!1),vi=ie("e",!1),xi=function(){return[]},Ti=function(me,We){return{type:"function",name:me,parameters:We||[]}},bi=function(me,We){return We.length>0?gw(me,We,3):[me]},Cn=function(me){return{type:"quantity",value:me.value,unit:me.unit}},Ur=function(me){return{type:"color",colorType:me.type,value:me.value}},ai=function(me){return me},Qr=function(){return y()},Ms=function(me){return{value:me,unit:"%"}},un=function(me){return{value:me,unit:"px"}},Xn=function(me){return{value:me,unit:"cm"}},dn=function(me){return{value:me,unit:"mm"}},Gn=function(me){return{value:me,unit:"in"}},ms=function(me){return{value:me,unit:"pt"}},tt=function(me){return{value:me,unit:"pc"}},ma=function(me){return{value:me,unit:"deg"}},Do=function(me){return{value:me,unit:"rad"}},Rs=function(me){return{value:me,unit:"grad"}},Zn=function(me){return{value:me,unit:"turn"}},Dn=function(me){return{value:me,unit:null}},gs=function(){return{type:"hex",value:y()}},rn=function(me){return{type:"function",value:me}},ga=function(){return{type:"named",value:y()}},La=function(){return parseFloat(y())},De=0,Li=0,$e=[{line:1,column:1}],qe=0,ft=[],et=0;if("startRule"in s){if(!(s.startRule in c))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');u=c[s.startRule]}function y(){return n.substring(Li,De)}function ie(me,We){return{type:"literal",text:me,ignoreCase:We}}function Ri(me,We,Y){return{type:"class",parts:me,inverted:We,ignoreCase:Y}}function Mn(){return{type:"end"}}function Rn(me){return{type:"other",description:me}}function Yr(me){var We,Y=$e[me];if(Y)return Y;for(We=me-1;!$e[We];)We--;for(Y={line:(Y=$e[We]).line,column:Y.column};We<me;)n.charCodeAt(We)===10?(Y.line++,Y.column=1):Y.column++,We++;return $e[me]=Y,Y}function wi(me,We){var Y=Yr(me),Zr=Yr(We);return{source:l,start:{offset:me,line:Y.line,column:Y.column},end:{offset:We,line:Zr.line,column:Zr.column}}}function Tr(me){De<qe||(De>qe&&(qe=De,ft=[]),ft.push(me))}function _n(me,We,Y){return new e(e.buildMessage(me,We),me,We,Y)}function Nr(){var me;return(me=Aa())===a&&(me=xd()),me}function Aa(){var me,We;return et++,me=De,Oi(),n.substr(De,4)===d?(We=d,De+=4):(We=a,et===0&&Tr(W)),We!==a?(Oi(),Li=me,me=xi()):(De=me,me=a),et--,me===a&&et===0&&Tr(H),me}function xd(){var me,We;if(me=[],(We=Na())!==a)for(;We!==a;)me.push(We),We=Na();else me=a;return me}function Na(){var me,We,Y,Zr;return me=De,Oi(),(We=ya())!==a?(Oi(),(Y=Uc())===a&&(Y=null),Oi(),n.charCodeAt(De)===41?(Zr=p,De++):(Zr=a,et===0&&Tr(oe)),Zr!==a?(Oi(),Li=me,me=Ti(We,Y)):(De=me,me=a)):(De=me,me=a),me}function Uc(){var me,We,Y,Zr,Wo,Os,oc,Xm;if(me=De,(We=ho())!==a){for(Y=[],Zr=De,Wo=Oi(),n.charCodeAt(De)===44?(Os=A,De++):(Os=a,et===0&&Tr(le)),Os===a&&(Os=null),oc=Oi(),(Xm=ho())!==a?Zr=Wo=[Wo,Os,oc,Xm]:(De=Zr,Zr=a);Zr!==a;)Y.push(Zr),Zr=De,Wo=Oi(),n.charCodeAt(De)===44?(Os=A,De++):(Os=a,et===0&&Tr(le)),Os===a&&(Os=null),oc=Oi(),(Xm=ho())!==a?Zr=Wo=[Wo,Os,oc,Xm]:(De=Zr,Zr=a);Li=me,me=bi(We,Y)}else De=me,me=a;return me}function ho(){var me,We;return me=De,(We=k1())===a&&(We=Cu())===a&&(We=Xr())===a&&(We=he()),We!==a&&(Li=me,We=Cn(We)),(me=We)===a&&(me=De,(We=Sr())!==a&&(Li=me,We=Ur(We)),me=We),me}function Oi(){var me,We;for(et++,me=[],se.test(n.charAt(De))?(We=n.charAt(De),De++):(We=a,et===0&&Tr(de));We!==a;)me.push(We),se.test(n.charAt(De))?(We=n.charAt(De),De++):(We=a,et===0&&Tr(de));return et--,We=a,et===0&&Tr(fe),me}function ya(){var me,We,Y;return et++,me=De,(We=Td())!==a?(n.charCodeAt(De)===40?(Y=v,De++):(Y=a,et===0&&Tr(Ie)),Y!==a?(Li=me,me=ai(We)):(De=me,me=a)):(De=me,me=a),et--,me===a&&(We=a,et===0&&Tr(Ee)),me}function Td(){var me,We,Y;if(et++,me=De,We=[],ue.test(n.charAt(De))?(Y=n.charAt(De),De++):(Y=a,et===0&&Tr(Ke)),Y!==a)for(;Y!==a;)We.push(Y),ue.test(n.charAt(De))?(Y=n.charAt(De),De++):(Y=a,et===0&&Tr(Ke));else We=a;return We!==a&&(Li=me,We=Qr()),et--,(me=We)===a&&(We=a,et===0&&Tr(Ge)),me}function k1(){var me,We,Y;return et++,me=De,Oi(),(We=Ll())!==a?(n.charCodeAt(De)===37?(Y=b,De++):(Y=a,et===0&&Tr(ke)),Y!==a?(Li=me,me=Ms(We)):(De=me,me=a)):(De=me,me=a),et--,me===a&&et===0&&Tr(vt),me}function Cu(){var me,We,Y;return et++,me=De,Oi(),(We=Ll())!==a?(n.substr(De,2)===S?(Y=S,De+=2):(Y=a,et===0&&Tr(Xe)),Y!==a?(Li=me,me=un(We)):(De=me,me=a)):(De=me,me=a),me===a&&(me=De,Oi(),(We=Ll())!==a?(n.substr(De,2)===E?(Y=E,De+=2):(Y=a,et===0&&Tr(Se)),Y!==a?(Li=me,me=Xn(We)):(De=me,me=a)):(De=me,me=a),me===a&&(me=De,Oi(),(We=Ll())!==a?(n.substr(De,2)===R?(Y=R,De+=2):(Y=a,et===0&&Tr(It)),Y!==a?(Li=me,me=dn(We)):(De=me,me=a)):(De=me,me=a),me===a&&(me=De,Oi(),(We=Ll())!==a?(n.substr(De,2)===O?(Y=O,De+=2):(Y=a,et===0&&Tr(lt)),Y!==a?(Li=me,me=Gn(We)):(De=me,me=a)):(De=me,me=a),me===a&&(me=De,Oi(),(We=Ll())!==a?(n.substr(De,2)===I?(Y=I,De+=2):(Y=a,et===0&&Tr(qt)),Y!==a?(Li=me,me=ms(We)):(De=me,me=a)):(De=me,me=a),me===a&&(me=De,Oi(),(We=Ll())!==a?(n.substr(De,2)===N?(Y=N,De+=2):(Y=a,et===0&&Tr(er)),Y!==a?(Li=me,me=tt(We)):(De=me,me=a)):(De=me,me=a)))))),et--,me===a&&et===0&&Tr(Ne),me}function Xr(){var me,We,Y;return et++,me=De,(We=Ll())!==a?(n.substr(De,3)===L?(Y=L,De+=3):(Y=a,et===0&&Tr(vr)),Y!==a?(Li=me,me=ma(We)):(De=me,me=a)):(De=me,me=a),me===a&&(me=De,(We=Ll())!==a?(n.substr(De,3)===B?(Y=B,De+=3):(Y=a,et===0&&Tr(ri)),Y!==a?(Li=me,me=Do(We)):(De=me,me=a)):(De=me,me=a),me===a&&(me=De,(We=Ll())!==a?(n.substr(De,4)===U?(Y=U,De+=4):(Y=a,et===0&&Tr(Wi)),Y!==a?(Li=me,me=Rs(We)):(De=me,me=a)):(De=me,me=a),me===a&&(me=De,(We=Ll())!==a?(n.substr(De,4)===q?(Y=q,De+=4):(Y=a,et===0&&Tr(Lr)),Y!==a?(Li=me,me=Zn(We)):(De=me,me=a)):(De=me,me=a)))),et--,me===a&&(We=a,et===0&&Tr(rr)),me}function he(){var me,We;return et++,me=De,Oi(),(We=Ll())!==a?(Li=me,me=Dn(We)):(De=me,me=a),et--,me===a&&et===0&&Tr(ii),me}function Sr(){var me,We,Y,Zr;if(et++,me=De,n.charCodeAt(De)===35?(We=Z,De++):(We=a,et===0&&Tr(bt)),We!==a){if(Y=[],re.test(n.charAt(De))?(Zr=n.charAt(De),De++):(Zr=a,et===0&&Tr(Bt)),Zr!==a)for(;Zr!==a;)Y.push(Zr),re.test(n.charAt(De))?(Zr=n.charAt(De),De++):(Zr=a,et===0&&Tr(Bt));else Y=a;Y!==a?(Li=me,me=gs()):(De=me,me=a)}else De=me,me=a;return me===a&&(me=De,(We=Na())!==a&&(Li=me,We=rn(We)),(me=We)===a&&(me=De,(We=Td())!==a&&(Li=me,We=ga()),me=We)),et--,me===a&&(We=a,et===0&&Tr(Ut)),me}function Ll(){var me,We,Y,Zr,Wo,Os,oc;for(me=De,te.test(n.charAt(De))?(n.charAt(De),De++):et===0&&Tr(Wt),We=De,Y=[],j.test(n.charAt(De))?(Zr=n.charAt(De),De++):(Zr=a,et===0&&Tr(sr));Zr!==a;)Y.push(Zr),j.test(n.charAt(De))?(Zr=n.charAt(De),De++):(Zr=a,et===0&&Tr(sr));if(n.charCodeAt(De)===46?(Zr=X,De++):(Zr=a,et===0&&Tr(Ir)),Zr!==a){if(Wo=[],j.test(n.charAt(De))?(Os=n.charAt(De),De++):(Os=a,et===0&&Tr(sr)),Os!==a)for(;Os!==a;)Wo.push(Os),j.test(n.charAt(De))?(Os=n.charAt(De),De++):(Os=a,et===0&&Tr(sr));else Wo=a;Wo!==a?We=Y=[Y,Zr,Wo]:(De=We,We=a)}else De=We,We=a;if(We===a)if(We=[],j.test(n.charAt(De))?(Y=n.charAt(De),De++):(Y=a,et===0&&Tr(sr)),Y!==a)for(;Y!==a;)We.push(Y),j.test(n.charAt(De))?(Y=n.charAt(De),De++):(Y=a,et===0&&Tr(sr));else We=a;if(We!==a){if(Y=De,n.charCodeAt(De)===101?(Zr=ee,De++):(Zr=a,et===0&&Tr(vi)),Zr!==a){if(te.test(n.charAt(De))?(Wo=n.charAt(De),De++):(Wo=a,et===0&&Tr(Wt)),Wo===a&&(Wo=null),Os=[],j.test(n.charAt(De))?(oc=n.charAt(De),De++):(oc=a,et===0&&Tr(sr)),oc!==a)for(;oc!==a;)Os.push(oc),j.test(n.charAt(De))?(oc=n.charAt(De),De++):(oc=a,et===0&&Tr(sr));else Os=a;Os!==a?Y=Zr=[Zr,Wo,Os]:(De=Y,Y=a)}else De=Y,Y=a;Y===a&&(Y=null),Li=me,me=La()}else De=me,me=a;return me}function DE(me,We){return me.map(function(Y){return Y[We]})}function gw(me,We,Y){return[me].concat(DE(We,Y))}if((o=u())!==a&&De===n.length)return o;throw o!==a&&De<n.length&&Tr(Mn()),_n(ft,qe<n.length?n.charAt(qe):null,qe<n.length?wi(qe,qe+1):wi(qe,qe))}return t(e,Error),e.prototype.format=function(n){var s="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<n.length;o++)if(n[o].source===this.location.source){a=n[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var u=this.location.end,d=r("",l.line.toString().length," "),p=a[l.line-1],A=(l.line===u.line?u.column:p.length+1)-l.column||1;s+=`
 --> `+c+`
`+d+` |
`+l.line+" | "+p+`
`+d+" | "+r("",l.column-1," ")+r("",A,"^")}else s+=`
 at `+c}return s},e.buildMessage=function(n,s){var o={literal:function(A){return'"'+l(A.text)+'"'},class:function(A){var v=A.parts.map(function(b){return Array.isArray(b)?c(b[0])+"-"+c(b[1]):c(b)});return"["+(A.inverted?"^":"")+v.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(A){return A.description}};function a(A){return A.charCodeAt(0).toString(16).toUpperCase()}function l(A){return A.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+a(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+a(v)})}function c(A){return A.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+a(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+a(v)})}function u(A){return o[A.type](A)}function d(A){var v,b,S=A.map(u);if(S.sort(),S.length>0){for(v=1,b=1;v<S.length;v++)S[v-1]!==S[v]&&(S[b]=S[v],b++);S.length=b}switch(S.length){case 1:return S[0];case 2:return S[0]+" or "+S[1];default:return S.slice(0,-1).join(", ")+", or "+S[S.length-1]}}function p(A){return A?'"'+l(A)+'"':"end of input"}return"Expected "+d(n)+" but "+p(s)+" found."},{SyntaxError:e,parse:i}},(kAe={get exports(){return Tte},set exports(t){Tte=t}}).exports&&(kAe.exports=UAe());const Kce={deg:1,grad:.9,rad:180/Math.PI,turn:360};function zpt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Kce[t.unit]!=null))throw new pe("effect:type-error",`Expected <angle>, Actual: ${pj(t)}`,{term:t})}const eue={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Vpt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&eue[t.unit]!=null))throw new pe("effect:type-error",`Expected <length>, Actual: ${pj(t)}`,{term:t})}function Y0(t){Bpt(t);const e=t.value;return zN(e,t),t.unit==="%"?.01*e:e}function Gpt(t){return Upt(t),zN(t.value,t),t.value}function jpt(t){return zpt(t),t.value*Kce[t.unit]||0}function tue(t){return Vpt(t),t.value*eue[t.unit]||0}function Hpt(t){switch(t.colorType){case"hex":return pit(t.value);case"named":return eDe(t.value);case"function":return Qpt(t.value)}}function eDe(t){if(!kOe(t))throw new pe("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return dit(t)}const qpt=/^rgba?/i,Wpt=/^hsla?/i;function Qpt(t){if(aP(t.parameters,4),qpt.test(t.name))return[Y0(t.parameters[0]),Y0(t.parameters[1]),Y0(t.parameters[2]),t.parameters[3]?Y0(t.parameters[3]):1];if(Wpt.test(t.name))return UOe(Gpt(t.parameters[0]),Y0(t.parameters[1]),Y0(t.parameters[2]),t.parameters[3]?Y0(t.parameters[3]):1);throw new pe("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function rue(t,e,r){var i;try{return Xpt(t)}catch(n){(i=r==null?void 0:r.messages)==null||i.push(n)}return null}function iue(t,e,r,i){try{const n=Ypt(t);wu(r,n,e)}catch(n){i.messages&&i.messages.push(n)}}function Ypt(t){const e=K5e(t);return e?Ppt(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(n=>n.toJSON())})):null}function Xpt(t){if(!t||t.length===0)return null;if(Zpt(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:zAe(r.value)});return e}return zAe(t)}function Zpt(t){const e=t[0];return!!e&&"scale"in e}function zAe(t){if(!t||!t.length)return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[py(r,"amount")];break;case"blur":i=[py(r,"radius","pt")];break;case"hue-rotate":i=[py(r,"angle","deg")];break;case"drop-shadow":i=[py(r,"xoffset","pt"),py(r,"yoffset","pt"),py(r,"blurRadius","pt"),Jpt(r,"color")];break;case"bloom":i=[py(r,"strength"),py(r,"radius","pt"),py(r,"threshold")]}const n=`${r.type}(${i.filter(Boolean).join(" ")})`;K5e(n),e.push(n)}return e.join(" ")}function py(t,e,r){if(t[e]==null)throw new pe("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function Jpt(t,e){if(t[e]==null)throw new pe("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}const dk=-3;var g_;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(g_||(g_={}));let Kpt=class{constructor(e,r,i){this._namespace=e,this._storage=r,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(e,r,i,n=0){this._storage.put(this._namespace+e,r,i,n)}get(e){const r=this._storage.get(this._namespace+e);return r===void 0?++this._miss:++this._hit,r}pop(e){const r=this._storage.pop(this._namespace+e);return r===void 0?++this._miss:++this._hit,r}updateSize(e,r,i){this._storage.updateSize(this._namespace+e,r,i)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}},nue=class{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Vr,this._users=new Vr}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,r,i,n){const s=this._db.get(e);if(s&&(this._size-=s.size,this._db.delete(e),s.entry!==r&&this._notifyRemove(e,s.entry,g_.ALL)),i>this._maxSize)return void this._notifyRemove(e,r,g_.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return void console.warn("Refusing to cache entry with invalid size "+i);const o=1+Math.max(n,dk)-dk;this._db.set(e,{entry:r,size:i,lifetime:o,lives:o}),this._size+=i,this._checkSizeLimit()}updateSize(e,r,i){const n=this._db.get(e);if(n&&n.entry===r){for(this._size-=n.size;i>this._maxSize;){const s=this._notifyRemove(e,r,g_.SOME);if(!(M(s)&&s>0))return void this._db.delete(e);i=s}n.size=i,this._size+=i,this._checkSizeLimit()}}pop(e){const r=this._db.get(e);if(r)return this._size-=r.size,this._db.delete(e),++this._hit,r.entry;++this._miss}get(e){const r=this._db.get(e);if(r!==void 0)return this._db.delete(e),r.lives=r.lifetime,this._db.set(e,r),++this._hit,r.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const u=c.namespace;if(a.startsWith(u)){const d=r[u]||0;r[u]=d+o.size}})});const n={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,n[a]=Math.round(100*o.hitRate)+"%"}else n[a]="0%"});const s=Object.keys(r);s.sort((o,a)=>r[a]-r[o]),s.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+n[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+dk-1)]=Math.round(a/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){this._db.forEach((r,i)=>{i.startsWith(e)&&(this._size-=r.size,this._db.delete(i),this._notifyRemove(i,r.entry,g_.ALL))})}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,g_.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i){let n;return this._removeFuncs.some(s=>{if(e.startsWith(s[0])){const o=s[1](r,i);return typeof o=="number"&&(n=o),!0}return!1}),n}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,r]of this._db){if(this._db.delete(e),r.lives<=1){this._size-=r.size;const i=this._notifyRemove(e,r.entry,g_.SOME);M(i)&&i>0&&(this._size+=i,r.lives=r.lifetime,r.size=i,this._db.set(e,r))}else--r.lives,this._db.set(e,r);if(this._size<=.9*this.maxSize)return}}},eft=class{constructor(e,r){this._storage=new nue,this._storage.maxSize=e,r&&this._storage.registerRemoveFunc("",r)}put(e,r){this._storage.put(e,r,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}};new eft(1e3);new $t([128,128,128]);const tft=new $t("white");function rft(t){return nh(t.resource).href}function HE(t,e){if(!t)return null;let r=null;return XR(t)?r=ift(t):VG(t)&&(r=t.color?new $t(t.color):null),r?cL(r,e):null}function ift(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{var n;i.type==="object"&&((n=i.resource)==null?void 0:n.href)!=null||(r=i.type==="water"?i.color:M(i.material)?i.material.color:null)}),r?new $t(r):null}function cL(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new $t(r)}function nft(t,e,r){const i=t.symbolLayers;if(!i)return;const n=s=>{const o=M(s)?s:null;return cL(e=e??o??(r!=null?tft:null),r)};i.forEach(s=>{var o;if(s.type!=="object"||((o=s.resource)==null?void 0:o.href)==null||e)if(s.type==="water")s.color=n(s.color);else{const a=M(s.material)?s.material.color:null,l=n(a);k(s.material)?s.material=new gp({color:l}):s.material.color=l,r!=null&&"outline"in s&&M(s.outline)&&M(s.outline.color)&&(s.outline.color=cL(s.outline.color,r))}})}function sft(t,e,r){(e=e??t.color)&&(t.color=cL(e,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=cL(t.outline.color,r))}function qW(t,e,r){t&&(e||r!=null)&&(e&&(e=new $t(e)),XR(t)?nft(t,e,r):VG(t)&&sft(t,e,r))}async function oft(t,e){const r=t.symbolLayers;r&&await wG(r,async i=>aft(i,e))}async function aft(t,e){switch(t.type){case"extrude":cft(t,e);break;case"icon":case"line":case"text":lft(t,e);break;case"path":hft(t,e);break;case"object":await uft(t,e)}}function lft(t,e){const r=tDe(e);M(r)&&(t.size=r)}function tDe(t){for(const e of t)if(typeof e=="number")return e;return null}function cft(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function uft(t,e){const{resourceSize:r,symbolSize:i}=await dft(t),n=rDe(e,r,i);t.width=R5(e[0],i[0],r[0],n),t.depth=R5(e[1],i[1],r[1],n),t.height=R5(e[2],i[2],r[2],n)}function hft(t,e){const r=rDe(e,cA,[t.width,void 0,t.height]);t.width=R5(e[0],t.width,1,r),t.height=R5(e[2],t.height,1,r)}function rDe(t,e,r){for(let i=0;i<3;i++){const n=t[i];switch(n){case"symbol-value":{const s=r[i];return s!=null?s/e[i]:1}case"proportional":break;default:if(n&&e[i])return n/e[i]}}return 1}async function dft(t){const e=await be(()=>import("./symbolLayerUtils-6dcdcf75.js"),[]),r=await e.computeObjectLayerResourceSize(t,10),{width:i,height:n,depth:s}=t,o=[i,s,n];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function R5(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function pft(t,e){const r=tDe(e);if(!k(r))switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function fft(t,e){if(t&&e)return XR(t)?oft(t,e):void(VG(t)&&pft(t,e))}function mft(t,e,r){if(t&&e!=null)if(XR(t)){const i=t.symbolLayers;i&&i.forEach(n=>{if(n&&n.type==="object")switch(r){case"tilt":n.tilt=e;break;case"roll":n.roll=e;break;default:n.heading=e}})}else VG(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function Oar(t){return M(t)&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function gft(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const Aft="<",yft=">",_ft=OG("short-date");function vft(t,e,r,i){let n="";e===0?n=`${Aft} `:e===r&&(n=`${yft} `);let s=null;return s=i?LA(t,_ft):mpt(t),n+s}const bft=new $t([64,64,64]);function wft(t,e){const r=[],i=t.length-1;return t.length===5?r.push(0,2,4):r.push(0,i),t.map((n,s)=>r.includes(s)?vft(n,s,i,e):null)}async function xft(t,e,r){let i=!1,n=[],s=[];if(t.stops){const c=t.stops;n=c.map(u=>u.value),i=c.some(u=>!!u.label),i&&(s=c.map(u=>u.label))}const o=n[0],a=n[n.length-1];if(o==null&&a==null)return null;const l=i?null:wft(n,r??!1);return(await Promise.all(n.map(async(c,u)=>({value:c,color:t.type==="opacity"?await Tft(c,t,e):(await be(()=>Promise.resolve().then(()=>_ue),void 0)).getColor(t,c),label:i?s[u]:(l==null?void 0:l[u])??""})))).reverse()}async function Tft(t,e,r=bft){const i=new $t(r),n=(await be(()=>Promise.resolve().then(()=>_ue),void 0)).getOpacity(e,t);return n!=null&&(i.a=n),i}var Ste;let Z$=Ste=class extends Je{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new Ste({color:this.color,ratio:this.ratio})}};h([f({type:$t,json:{type:[ds],default:null,write:!0}})],Z$.prototype,"color",void 0),h([f({type:Number,json:{write:!0}})],Z$.prototype,"ratio",void 0),Z$=Ste=h([Q("esri.renderers.support.HeatmapColorStop")],Z$);const O5=Z$;function Sft(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(i=>{var n;return((n=i.color)==null?void 0:n.a)>0});let r=e.length-1;if(e&&e[0]){const i=e[r];i&&i.ratio!==1&&(e.push(new O5({ratio:1,color:i.color})),r++)}return e.map((i,n)=>{var o,a;let s="";return n===0?s=((o=t.legendOptions)==null?void 0:o.minLabel)||"low":n===r&&(s=((a=t.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:i.color,label:s,ratio:i.ratio}}).reverse()}we.getLogger("esri.renderers.support.utils");async function Sd(t,e,r){Xae(t,e,()=>[]).push(...r)}async function Eft(t){var r,i;const e=new Map;if(!t)return e;if("visualVariables"in t&&t.visualVariables){const n=t.visualVariables.filter(s=>s.type==="color");for(const s of n){const o=(await xft(s)??[]).map(a=>a.color);await Sd(e,s.field||s.valueExpression,o)}}if(t.type==="heatmap"){const n=Sft(t).map(s=>s.color);await Sd(e,t.field||t.valueExpression,n)}else if(t.type==="pie-chart"){for(const n of t.attributes)await Sd(e,n.field||n.valueExpression,[n.color]);await Sd(e,"default",[(r=t==null?void 0:t.othersCategory)==null?void 0:r.color,HE(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const n of t.attributes)await Sd(e,n.field||n.valueExpression,[n.color]);await Sd(e,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(((i=t.authoringInfo)==null?void 0:i.type)==="predominance")for(const n of t.uniqueValueInfos??[])await Sd(e,n.value.toString(),[HE(n.symbol,null)]);else{const n=(t.uniqueValueInfos??[]).map(c=>HE(c.symbol,null)),{field:s,field2:o,field3:a,valueExpression:l}=t;(s||l)&&await Sd(e,s||l,n),o&&await Sd(e,o,n),a&&await Sd(e,a,n)}else if(t.type==="class-breaks"){const n=t.classBreakInfos.map(a=>HE(a.symbol,null)),{field:s,valueExpression:o}=t;await Sd(e,s??o,n)}else t.type==="simple"&&await Sd(e,"default",[HE(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await Sd(e,"default",[HE(t.defaultSymbol,null)]),e.forEach((n,s)=>{const o=gN(n.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));e.set(s,o)}),e}var Ete;let J$=Ete=class extends Je{constructor(t){super(t),this.name=null,this.code=null}clone(){return new Ete({name:this.name,code:this.code})}};h([f({type:String,json:{write:!0}})],J$.prototype,"name",void 0),h([f({type:[String,Number],json:{write:!0}})],J$.prototype,"code",void 0),J$=Ete=h([Q("esri.layers.support.CodedValue")],J$);const Cft=new Hi({inherited:"inherited",codedValue:"coded-value",range:"range"});let K$=class extends Je{constructor(e){super(e),this.name=null,this.type=null}};h([f({type:String,json:{write:!0}})],K$.prototype,"name",void 0),h([nr(Cft)],K$.prototype,"type",void 0),K$=h([Q("esri.layers.support.Domain")],K$);const fj=K$;var Cte;let e4=Cte=class extends fj{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new Cte({codedValues:Te(this.codedValues),name:this.name})}};h([f({type:[J$],json:{write:!0}})],e4.prototype,"codedValues",void 0),h([nr({codedValue:"coded-value"})],e4.prototype,"type",void 0),e4=Cte=h([Q("esri.layers.support.CodedValueDomain")],e4);const iDe=e4;var Mte;let pk=Mte=class extends fj{constructor(t){super(t),this.type="inherited"}clone(){return new Mte}};h([nr({inherited:"inherited"})],pk.prototype,"type",void 0),pk=Mte=h([Q("esri.layers.support.InheritedDomain")],pk);const nDe=pk;var Rte;let mC=Rte=class extends fj{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new Rte({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};h([f({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],mC.prototype,"maxValue",void 0),h([f({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],mC.prototype,"minValue",void 0),h([nr({range:"range"})],mC.prototype,"type",void 0),mC=Rte=h([Q("esri.layers.support.RangeDomain")],mC);const sDe=mC,oDe={key:"type",base:fj,typeMap:{range:sDe,"coded-value":iDe,inherited:nDe}};function sue(t){if(!t||!t.type)return null;switch(t.type){case"range":return sDe.fromJSON(t);case"codedValue":return iDe.fromJSON(t);case"inherited":return nDe.fromJSON(t)}return null}const Mft=new Hi({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var Ote;const Rft=new Hi({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let tu=Ote=class extends Je{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return(r==null?void 0:r.value)??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?Rft.fromJSON(r.fieldValueType):null}clone(){return new Ote({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};h([f({type:String,json:{write:!0}})],tu.prototype,"alias",void 0),h([f({type:[String,Number],json:{write:{allowNull:!0}}})],tu.prototype,"defaultValue",void 0),h([f()],tu.prototype,"description",void 0),h([gt("description")],tu.prototype,"readDescription",null),h([f({types:oDe,json:{read:{reader:sue},write:!0}})],tu.prototype,"domain",void 0),h([f({type:Boolean,json:{write:!0}})],tu.prototype,"editable",void 0),h([f({type:ds,json:{write:!0}})],tu.prototype,"length",void 0),h([f({type:String,json:{write:!0}})],tu.prototype,"name",void 0),h([f({type:Boolean,json:{write:!0}})],tu.prototype,"nullable",void 0),h([nr(Mft)],tu.prototype,"type",void 0),h([f()],tu.prototype,"valueType",void 0),h([gt("valueType",["description"])],tu.prototype,"readValueType",null),h([f({type:Boolean,json:{read:!1}})],tu.prototype,"visible",void 0),tu=Ote=h([Q("esri.layers.support.Field")],tu);const mj=tu;var Pte;let gC=Pte=class extends Je{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new Pte({mapLayerId:t,gdbVersion:e})}};h([nr({mapLayer:"map-layer"})],gC.prototype,"type",void 0),h([f({type:ds,json:{write:!0}})],gC.prototype,"mapLayerId",void 0),h([f({type:String,json:{write:!0}})],gC.prototype,"gdbVersion",void 0),gC=Pte=h([Q("esri.layers.support.source.MapLayerSource")],gC);var Ite;let jy=Ite=class extends Je{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:r,spatialReference:i,geometryType:n}=this,s={workspaceId:t,query:e,oidFields:r,spatialReference:(i==null?void 0:i.clone())??void 0,geometryType:n};return new Ite(s)}};h([nr({queryTable:"query-table"})],jy.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],jy.prototype,"workspaceId",void 0),h([f({type:String,json:{write:!0}})],jy.prototype,"query",void 0),h([f({type:String,json:{write:!0}})],jy.prototype,"oidFields",void 0),h([f({type:St,json:{write:!0}})],jy.prototype,"spatialReference",void 0),h([nr(bPe)],jy.prototype,"geometryType",void 0),jy=Ite=h([Q("esri.layers.support.source.QueryTableDataSource")],jy);var $te;let AC=$te=class extends Je{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new $te({workspaceId:t,dataSourceName:e})}};h([nr({raster:"raster"})],AC.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],AC.prototype,"dataSourceName",void 0),h([f({type:String,json:{write:!0}})],AC.prototype,"workspaceId",void 0),AC=$te=h([Q("esri.layers.support.source.RasterDataSource")],AC);var Dte;let Rx=Dte=class extends Je{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:r}=this;return new Dte({workspaceId:t,gdbVersion:e,dataSourceName:r})}};h([nr({table:"table"})],Rx.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],Rx.prototype,"workspaceId",void 0),h([f({type:String,json:{write:!0}})],Rx.prototype,"gdbVersion",void 0),h([f({type:String,json:{write:!0}})],Rx.prototype,"dataSourceName",void 0),Rx=Dte=h([Q("esri.layers.support.source.TableDataSource")],Rx);var Lte,Nte;const Oft=$c()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Ld=Lte=class extends Je{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,r){return VAe()(t,e,r)}castLeftTableSource(t){return Om(Fte(),t)}readRightTableSource(t,e,r){return VAe()(t,e,r)}castRightTableSource(t){return Om(Fte(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:r,rightTableSource:i,joinType:n}=this,s={leftTableKey:t,rightTableKey:e,leftTableSource:(r==null?void 0:r.clone())??void 0,rightTableSource:(i==null?void 0:i.clone())??void 0,joinType:n};return new Lte(s)}};h([nr({joinTable:"join-table"})],Ld.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],Ld.prototype,"leftTableKey",void 0),h([f({type:String,json:{write:!0}})],Ld.prototype,"rightTableKey",void 0),h([f({json:{write:!0}})],Ld.prototype,"leftTableSource",void 0),h([gt("leftTableSource")],Ld.prototype,"readLeftTableSource",null),h([Wr("leftTableSource")],Ld.prototype,"castLeftTableSource",null),h([f({json:{write:!0}})],Ld.prototype,"rightTableSource",void 0),h([gt("rightTableSource")],Ld.prototype,"readRightTableSource",null),h([Wr("rightTableSource")],Ld.prototype,"castRightTableSource",null),h([nr(Oft)],Ld.prototype,"joinType",void 0),Ld=Lte=h([Q("esri.layers.support.source.JoinTableDataSource")],Ld);let WW=null;function VAe(){return WW||(WW=J2({types:Fte()})),WW}let QW=null;function Fte(){return QW||(QW={key:"type",base:null,typeMap:{"data-layer":X0,"map-layer":gC}}),QW}const Pft={key:"type",base:null,typeMap:{"join-table":Ld,"query-table":jy,raster:AC,table:Rx}};let X0=Nte=class extends Je{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new Nte({fields:t,dataSource:e})}};h([nr({dataLayer:"data-layer"})],X0.prototype,"type",void 0),h([f({type:[mj],json:{write:!0}})],X0.prototype,"fields",void 0),h([f({types:Pft,json:{write:!0}})],X0.prototype,"dataSource",void 0),X0=Nte=h([Q("esri.layers.support.source.DataLayerSource")],X0),X0.from=Go(X0);function Ift(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function oue(t){return typeof t=="string"?Su(t):Te(t)}function $ft(t,e,r){const i={};for(const n in t){if(n==="declaredClass")continue;const s=t[n];if(s!=null&&typeof s!="function")if(Array.isArray(s)){i[n]=[];for(let o=0;o<s.length;o++)i[n][o]=$ft(s[o])}else if(typeof s=="object")if(s.toJSON){const o=s.toJSON(r&&r[n]);i[n]=e?o:JSON.stringify(o)}else i[n]=e?s:JSON.stringify(s);else i[n]=s}return i}const D6={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new cm({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:St.WebMercator}),minus180Line:new cm({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:St.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new cm({paths:[[[180,-180],[180,180]]],spatialReference:St.WGS84}),minus180Line:new cm({paths:[[[-180,-180],[-180,180]]],spatialReference:St.WGS84})}};function FT(t,e){return Math.ceil((t-e)/(2*e))}function aDe(t,e){const r=P5(t);for(const i of r)for(const n of i)n[0]+=e;return t}function P5(t){return YT(t)?t.rings:t.paths}async function Dft(t,e,r,i){const n=oue(t),s=e[0].spatialReference,o={...i,query:{...n.query,f:"json",sr:JSON.stringify(s),target:JSON.stringify({geometryType:XO(e[0]),geometries:e}),cutter:JSON.stringify(r)}},a=await ns(n.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(u=>{const d=r1(u);return d.spatialReference=s,d})}}function Lft(t){return{geometryType:XO(t[0]),geometries:t.map(e=>e.toJSON())}}function lDe(t,e,r){const i=Ont(e);return t.map(n=>{const s=i.fromJSON(n);return s.spatialReference=r,s})}async function Nft(t,e,r){const i=typeof t=="string"?Su(t):t,n=e[0].spatialReference,s=XO(e[0]),o={...r,query:{...i.query,f:"json",sr:n.wkid?n.wkid:JSON.stringify(n),geometries:JSON.stringify(Lft(e))}},{data:a}=await ns(i.path+"/simplify",o);return lDe(a.geometries,s,n)}const cDe=we.getLogger("esri.geometry.support.normalizeUtils");function Fft(t){return t.type==="polygon"}function kft(t){return t[0].type==="polygon"}function Uft(t){return t[0].type==="polyline"}function Bft(t,e){if(!(t instanceof cm||t instanceof Hf)){const n="straightLineDensify: the input geometry is neither polyline nor polygon";throw cDe.error(n),new pe(n)}const r=P5(t),i=[];for(const n of r){const s=[];i.push(s),s.push([n[0][0],n[0][1]]);for(let o=0;o<n.length-1;o++){const a=n[o][0],l=n[o][1],c=n[o+1][0],u=n[o+1][1],d=Math.sqrt((c-a)*(c-a)+(u-l)*(u-l)),p=(u-l)/d,A=(c-a)/d,v=d/e;if(v>1){for(let R=1;R<=v-1;R++){const O=R*e,I=A*O+a,N=p*O+l;s.push([I,N])}const b=(d+Math.floor(v-1)*e)/2,S=A*b+a,E=p*b+l;s.push([S,E])}s.push([c,u])}}return Fft(t)?new Hf({rings:i,spatialReference:t.spatialReference}):new cm({paths:i,spatialReference:t.spatialReference})}function GAe(t,e,r){if(e){const i=Bft(t,1e6);t=mM(i,!0)}return r&&(t=aDe(t,r)),t}function jAe(t,e,r){if(Array.isArray(t)){const i=t[0];if(i>e){const n=FT(i,e);t[0]=i+n*(-2*e)}else if(i<r){const n=FT(i,r);t[0]=i+n*(-2*r)}}else{const i=t.x;if(i>e){const n=FT(i,e);t=t.clone().offset(n*(-2*e),0)}else if(i<r){const n=FT(i,r);t=t.clone().offset(n*(-2*r),0)}}return t}function zft(t,e){let r=-1;for(let i=0;i<e.cutIndexes.length;i++){const n=e.cutIndexes[i],s=e.geometries[i],o=P5(s);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let u=0;for(let p=0;p<l.length;p++){const A=l[p][0];u=A>u?A:u}u=Number(u.toFixed(9));const d=-360*FT(u,180);for(let p=0;p<l.length;p++){const A=s.getPoint(a,p);s.setPoint(a,p,A.clone().offset(d,0))}return!0}})}if(n===r){if(kft(t))for(const a of P5(s))t[n]=t[n].addRing(a);else if(Uft(t))for(const a of P5(s))t[n]=t[n].addPath(a)}else r=n,t[n]=s}return t}async function uDe(t,e,r){if(!Array.isArray(t))return uDe([t],e);e&&typeof e!="string"&&cDe.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i=typeof e=="string"?e:(e==null?void 0:e.url)??gn.geometryServiceUrl;let n,s,o,a,l,c,u,d,p=0;const A=[],v=[];for(const I of t)if(k(I))v.push(I);else if(n||(n=I.spatialReference,s=c2(n),o=n.isWebMercator,c=o?102100:4326,a=D6[c].maxX,l=D6[c].minX,u=D6[c].plus180Line,d=D6[c].minus180Line),s)if(I.type==="mesh")v.push(I);else if(I.type==="point")v.push(jAe(I.clone(),a,l));else if(I.type==="multipoint"){const N=I.clone();N.points=N.points.map(L=>jAe(L,a,l)),v.push(N)}else if(I.type==="extent"){const N=I.clone()._normalize(!1,!1,s);v.push(N.rings?new Hf(N):N)}else if(I.extent){const N=I.extent,L=FT(N.xmin,l)*(2*a);let B=L===0?I.clone():aDe(I.clone(),L);N.offset(L,0),N.intersects(u)&&N.xmax!==a?(p=N.xmax>p?N.xmax:p,B=GAe(B,o),A.push(B),v.push("cut")):N.intersects(d)&&N.xmin!==l?(p=N.xmax*(2*a)>p?N.xmax*(2*a):p,B=GAe(B,o,360),A.push(B),v.push("cut")):v.push(B)}else v.push(I.clone());else v.push(I);let b=FT(p,a),S=-90;const E=b,R=new cm;for(;b>0;){const I=360*b-180;R.addPath([[I,S],[I,-1*S]]),S*=-1,b--}if(A.length>0&&E>0){const I=zft(A,await Dft(i,A,R,r)),N=[],L=[];for(let q=0;q<v.length;q++){const Z=v[q];if(Z!=="cut")L.push(Z);else{const X=I.shift(),ee=t[q];M(ee)&&ee.type==="polygon"&&ee.rings&&ee.rings.length>1&&X.rings.length>=ee.rings.length?(N.push(X),L.push("simplify")):L.push(o?N_(X):X)}}if(!N.length)return L;const B=await Nft(i,N,r),U=[];for(let q=0;q<L.length;q++){const Z=L[q];Z!=="simplify"?U.push(Z):U.push(o?N_(B.shift()):B.shift())}return U}const O=[];for(let I=0;I<v.length;I++){const N=v[I];if(N!=="cut")O.push(N);else{const L=A.shift();O.push(o===!0?N_(L):L)}}return O}function hDe(t){const e={};for(const r in t){if(r==="declaredClass")continue;const i=t[r];if(i!=null&&typeof i!="function")if(Array.isArray(i)){e[r]=[];for(let n=0;n<i.length;n++)e[r][n]=hDe(i[n])}else typeof i=="object"?i.toJSON&&(e[r]=JSON.stringify(i)):e[r]=i}return e}var pb;(function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"})(pb||(pb={}));const HAe=4294967296,Vft=new TextDecoder("utf-8"),Gft=Fe("safari")||Fe("ios")?6:Fe("ff")?12:32;let kte=class fk{constructor(e,r,i=0,n=e?e.byteLength:0){this._tag=0,this._dataType=pb.unknown,this._init(e,r,i,n)}_init(e,r,i,n){this._data=e,this._dataView=r,this._pos=i,this._end=n}asUnsafe(){return this}clone(){return new fk(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const r=this._decodeVarint();if(this._tag=r>>3,this._dataType=7&r,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();if(e!==void 0)return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=this._data[this._pos]!==0;return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,r=this._pos,i=e.getUint32(r,!0)+e.getUint32(r+4,!0)*HAe;return this._skip(8),i}getSFixed64(){const e=this._dataView,r=this._pos,i=e.getUint32(r,!0)+e.getInt32(r+4,!0)*HAe;return this._skip(8),i}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),r=this._pos,i=this._toString(this._data,r,r+e);return this._skip(e),i}getBytes(){const e=this._getLength(),r=this._pos,i=this._toBytes(this._data,r,r+e);return this._skip(e),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,r,i,n){const s=this.getMessage(),o=e(s,r,i,n);return s.release(),o}processMessage(e){const r=this.getMessage(),i=e(r);return r.release(),i}getMessage(){const e=this._getLength(),r=fk.pool.acquire();return r._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),r}release(){fk.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case pb.varint:this._decodeVarint();break;case pb.fixed64:this._skip(8);break;case pb.delimited:this._skip(this._getLength());break;case pb.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let r=this._pos,i=0,n=0;if(this._end-r>=10)do{if(n=e[r++],i|=127&n,(128&n)==0||(n=e[r++],i|=(127&n)<<7,(128&n)==0)||(n=e[r++],i|=(127&n)<<14,(128&n)==0)||(n=e[r++],i|=(127&n)<<21,(128&n)==0)||(n=e[r++],i+=268435456*(127&n),(128&n)==0)||(n=e[r++],i+=34359738368*(127&n),(128&n)==0)||(n=e[r++],i+=4398046511104*(127&n),(128&n)==0)||(n=e[r++],i+=562949953421312*(127&n),(128&n)==0)||(n=e[r++],i+=72057594037927940*(127&n),(128&n)==0)||(n=e[r++],i+=9223372036854776e3*(127&n),(128&n)==0))break;throw new Error("Varint too long!")}while(0);else{let s=1;for(;r!==this._end&&(n=e[r],(128&n)!=0);)++r,i+=(127&n)*s,s*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=n*s}return this._pos=r,i}_decodeSVarint(){const e=this._data;let r=this._pos,i=0,n=0;const s=1&e[r];if(this._end-r>=10)do{if(n=e[r++],i|=127&n,(128&n)==0||(n=e[r++],i|=(127&n)<<7,(128&n)==0)||(n=e[r++],i|=(127&n)<<14,(128&n)==0)||(n=e[r++],i|=(127&n)<<21,(128&n)==0)||(n=e[r++],i+=268435456*(127&n),(128&n)==0)||(n=e[r++],i+=34359738368*(127&n),(128&n)==0)||(n=e[r++],i+=4398046511104*(127&n),(128&n)==0)||(n=e[r++],i+=562949953421312*(127&n),(128&n)==0)||(n=e[r++],i+=72057594037927940*(127&n),(128&n)==0)||(n=e[r++],i+=9223372036854776e3*(127&n),(128&n)==0))break;throw new Error("Varint too long!")}while(0);else{let o=1;for(;r!==this._end&&(n=e[r],(128&n)!=0);)++r,i+=(127&n)*o,o*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=n*o}return this._pos=r,s?-(i+1)/2:i/2}_getLength(){if(this._dataType!==pb.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,r,i){if((i=Math.min(this._end,i))-r>Gft){const o=e.subarray(r,i);return Vft.decode(o)}let n="",s="";for(let o=r;o<i;++o){const a=e[o];128&a?s+="%"+a.toString(16):(n+=decodeURIComponent(s)+String.fromCharCode(a),s="")}return s.length&&(n+=decodeURIComponent(s)),n}_toBytes(e,r,i){return i=Math.min(this._end,i),new Uint8Array(e.buffer,r,i-r)}};kte.pool=new Sl(kte,void 0,t=>{t._data=null,t._dataView=null});let Nm=class mk{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,n,s]=e,o=n-r,a=s-i;return new mk([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const n=this.lengths[i];for(let s=0;s<n;s++)e(this.coords[2*(s+r)],this.coords[2*(s+r)+1]);r+=n}}clone(e){return e?(e.set(this.coords),new mk(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new mk(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}},I2=class dDe{constructor(e=null,r={},i,n){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new dDe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function jft(t){return!(k(t.geometry)||!t.geometry.coords||!t.geometry.coords.length)}let Iar=class extends I2{},pDe=class fDe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new fDe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};const mDe=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];let Dar=class{constructor(e){this._options=e,this.geometryTypes=mDe,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new pDe}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e||!e.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||jo(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const r=xS(this._options.sourceSpatialReference)/xS(e.spatialReference);if(r!==1)for(const i of e.features){if(!jft(i))continue;const n=i.geometry.coords;for(let s=2;s<n.length;s+=3)n[s]*=r}}addFeature(e,r){e.features.push(r)}createFeature(){return new I2}createSpatialReference(){return{wkid:0}}createGeometry(){return new Nm}addField(e,r){e.fields.push(r)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((r,i)=>r+i,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,r){e.coords[this._coordinatePtr++]=r}addCoordinatePoint(e,r){e.coords.push(r)}addLength(e,r){e.lengths.push(r)}addQueryGeometry(e,r){e.queryGeometry=r.queryGeometry,e.queryGeometryType=r.queryGeometryType}createPointGeometry(){return new Nm}};const qAe=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],WAe=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],QAe=["upperLeft","lowerLeft"];function YAe(t){return t>=qAe.length?null:qAe[t]}function Hft(t){return t>=WAe.length?null:WAe[t]}function XAe(t){return t>=QAe.length?null:QAe[t]}function ZAe(t,e){return e>=t.geometryTypes.length?null:t.geometryTypes[e]}function qft(t,e,r){const n=t.asUnsafe(),s=e.createPointGeometry(r);for(;n.next();)switch(n.tag()){case 3:{const o=n.getUInt32(),a=n.pos()+o;let l=0;for(;n.pos()<a;)e.addCoordinatePoint(s,n.getSInt64(),l++);break}default:n.skip()}return s}function Wft(t,e,r){const s=t.asUnsafe(),o=e.createGeometry(r),a=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;s.next();)switch(s.tag()){case 2:{const l=s.getUInt32(),c=s.pos()+l;let u=0;for(;s.pos()<c;)e.addLength(o,s.getUInt32(),u++);break}case 3:{const l=s.getUInt32(),c=s.pos()+l;let u=0;for(e.allocateCoordinates(o);s.pos()<c;)e.addCoordinate(o,s.getSInt64(),u),u++,u===a&&(u=0);break}default:s.skip()}return o}function Qft(t){const n=t.asUnsafe(),s=new Nm;let o="esriGeometryPoint";for(;n.next();)switch(n.tag()){case 2:{const a=n.getUInt32(),l=n.pos()+a;for(;n.pos()<l;)s.lengths.push(n.getUInt32());break}case 3:{const a=n.getUInt32(),l=n.pos()+a;for(;n.pos()<l;)s.coords.push(n.getSInt64());break}case 1:o=mDe[n.getEnum()];break;default:n.skip()}return{queryGeometry:s,queryGeometryType:o}}function Yft(t){const u=t.asUnsafe();for(;u.next();)switch(u.tag()){case 1:return u.getString();case 2:return u.getFloat();case 3:return u.getDouble();case 4:return u.getSInt32();case 5:return u.getUInt32();case 6:return u.getInt64();case 7:return u.getUInt64();case 8:return u.getSInt64();case 9:return u.getBool();default:return u.skip(),null}return null}function Xft(t){const a=t.asUnsafe(),l={type:YAe(0)};for(;a.next();)switch(a.tag()){case 1:l.name=a.getString();break;case 2:l.type=YAe(a.getEnum());break;case 3:l.alias=a.getString();break;case 4:l.sqlType=Hft(a.getEnum());break;case 5:a.skip();break;case 6:l.defaultValue=a.getString();break;default:a.skip()}return l}function Zft(t){const i={},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:i.name=n.getString();break;case 2:i.isSystemMaintained=n.getBool();break;default:n.skip()}return i}function Jft(t,e,r,i){const a=e.createFeature(r);let l=0;for(;t.next();)switch(t.tag()){case 1:{const c=i[l++].name;a.attributes[c]=t.processMessage(Yft);break}case 2:a.geometry=t.processMessageWithArgs(Wft,e,r);break;case 4:a.centroid=t.processMessageWithArgs(qft,e,r);break;default:t.skip()}return a}function Kft(t){const s=[1,1,1,1],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:s[0]=o.getDouble();break;case 2:s[1]=o.getDouble();break;case 4:s[2]=o.getDouble();break;case 3:s[3]=o.getDouble();break;default:o.skip()}return s}function e0t(t){const s=[0,0,0,0],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:s[0]=o.getDouble();break;case 2:s[1]=o.getDouble();break;case 4:s[2]=o.getDouble();break;case 3:s[3]=o.getDouble();break;default:o.skip()}return s}function t0t(t){const n={originPosition:XAe(0)},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:n.originPosition=XAe(s.getEnum());break;case 2:n.scale=s.processMessage(Kft);break;case 3:n.translate=s.processMessage(e0t);break;default:s.skip()}return n}function r0t(t){const n={},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:n.shapeAreaFieldName=s.getString();break;case 2:n.shapeLengthFieldName=s.getString();break;case 3:n.units=s.getString();break;default:s.skip()}return n}function i0t(t,e){const a=e.createSpatialReference();for(;t.next();)switch(t.tag()){case 1:a.wkid=t.getUInt32();break;case 5:a.wkt=t.getString();break;case 2:a.latestWkid=t.getUInt32();break;case 3:a.vcsWkid=t.getUInt32();break;case 4:a.latestVcsWkid=t.getUInt32();break;default:t.skip()}return a}function n0t(t,e){const b=e.createFeatureResult(),S=t.asUnsafe();b.geometryType=ZAe(e,0);let E=!1;for(;S.next();)switch(S.tag()){case 1:b.objectIdFieldName=S.getString();break;case 3:b.globalIdFieldName=S.getString();break;case 4:b.geohashFieldName=S.getString();break;case 5:b.geometryProperties=S.processMessage(r0t);break;case 7:b.geometryType=ZAe(e,S.getEnum());break;case 8:b.spatialReference=S.processMessageWithArgs(i0t,e);break;case 10:b.hasZ=S.getBool();break;case 11:b.hasM=S.getBool();break;case 12:b.transform=S.processMessage(t0t);break;case 9:{const R=S.getBool();b.exceededTransferLimit=R;break}case 13:e.addField(b,S.processMessage(Xft));break;case 15:E||(e.prepareFeatures(b),E=!0),e.addFeature(b,S.processMessageWithArgs(Jft,e,b,b.fields));break;case 2:b.uniqueIdField=S.processMessage(Zft);break;default:S.skip()}return e.finishFeatureResult(b),b}function s0t(t,e){const n={};let s=null;for(;t.next();)switch(t.tag()){case 4:s=t.processMessageWithArgs(Qft);break;case 1:n.featureResult=t.processMessageWithArgs(n0t,e);break;default:t.skip()}return M(s)&&n.featureResult&&e.addQueryGeometry(n,s),n}function o0t(t,e){try{const i=new kte(new Uint8Array(t),new DataView(t)),n={};for(;i.next();)i.tag()===2?n.queryResult=i.processMessageWithArgs(s0t,e):i.skip();return n}catch(r){throw new pe("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:r})}}function a0t(t,e){const r=o0t(t,e),i=r.queryResult.featureResult,n=r.queryResult.queryGeometry,s=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const o=i.objectIdFieldName;for(const a of i.features)a.attributes&&(a.objectId=a.attributes[o])}return i&&(i.queryGeometry=n,i.queryGeometryType=s),i}function Ute(t,e,r){if(!r||!r.features||!r.hasZ)return;const i=o$e(r.geometryType,e,t.outSpatialReference);if(!k(i))for(const n of r.features)i(n.geometry)}const JAe="Layer does not support extent calculation.";function l0t(t,e){if(e&&t.type==="extent")return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&t.type==="point")return`${t.x},${t.y}`;const r=t.toJSON();return delete r.spatialReference,JSON.stringify(r)}function c0t(t,e){const r=t.geometry,i=t.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const n=i;let s,o,a;if(M(r)&&(o=r.spatialReference,a=r.spatialReference.wkid||JSON.stringify(r.spatialReference),n.geometryType=XO(r),n.geometry=l0t(r,t.compactGeometryEnabled),n.inSR=a),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||!i.returnDistinctValues&&(e!=null&&e.returnCountOnly||e!=null&&e.returnExtentOnly||e!=null&&e.returnIdsOnly)?delete n.outFields:i.outFields.includes("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?(n.outSR=i.outSR.wkid||JSON.stringify(i.outSR),s=t.outSpatialReference):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR,s=o),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(n.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&M(o)&&M(t.quantizationParameters)&&M(t.quantizationParameters.extent)&&o.equals(t.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(n.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(n.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(n.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const l=i.timeExtent,{start:c,end:u}=l;c==null&&u==null||(n.time=c===u?c:`${c??"null"},${u??"null"}`),delete i.timeExtent}return t.defaultSpatialReferenceEnabled&&M(o)&&M(s)&&o.equals(s)&&(n.defaultSR=n.inSR,delete n.inSR,delete n.outSR),n}async function u0t(t,e,r,i){const n=M(e.timeExtent)&&e.timeExtent.isEmpty?{data:{features:[]}}:await VN(t,e,"json",i);return Ute(e,r,n.data),n}async function Nar(t,e,r,i){if(M(e.timeExtent)&&e.timeExtent.isEmpty)return{data:r.createFeatureResult()};const n=await h0t(t,e,i),s=n;return s.data=a0t(n.data,r),s}function h0t(t,e,r){return VN(t,e,"pbf",r)}function Far(t,e,r){return M(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):VN(t,e,"json",r,{returnIdsOnly:!0})}function kar(t,e,r){return M(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):VN(t,e,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function Uar(t,e,r){return M(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):VN(t,e,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(i=>{const n=i.data;if(n.hasOwnProperty("extent"))return i;if(n.features)throw new Error(JAe);if(n.hasOwnProperty("count"))throw new Error(JAe);return i})}function VN(t,e,r,i={},n={}){const s=typeof t=="string"?Su(t):t,o=e.geometry?[e.geometry]:[];return i.responseType=r==="pbf"?"array-buffer":"json",uDe(o,null,i).then(a=>{const l=a&&a[0];M(l)&&((e=e.clone()).geometry=l);const c=hDe({...s.query,f:r,...n,...c0t(e,n)});return ns(bS(s.path,"query"),{...i,query:{...c,...i.query}})})}var Bte;const zte=new Hi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Vl=Bte=class extends Je{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){var n;const r=St.fromJSON(e.spatialReference),i=[];for(let s=0;s<t.length;s++){const o=t[s],a=Pl.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;M(a.geometry)&&!l&&(a.geometry.spatialReference=r);const c=o.aggregateGeometries,u=a.aggregateGeometries;if(c&&M(u))for(const d in u){const p=u[d],A=(n=c[d])==null?void 0:n.spatialReference;M(p)&&!A&&(p.spatialReference=r)}i.push(a)}return i}writeGeometryType(t,e,r,i){if(t)return void zte.write(t,e,r,i);const{features:n}=this;if(n){for(const s of n)if(s&&M(s.geometry))return void zte.write(s.geometry.type,e,r,i)}}readQueryGeometry(t,e){if(!t)return null;const r=!!t.spatialReference,i=r1(t);return i&&!r&&e.spatialReference&&(i.spatialReference=St.fromJSON(e.spatialReference)),i}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&M(i.geometry)&&i.geometry.spatialReference)return void(e.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new Bte(this.cloneProperties())}cloneProperties(){return Te({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let r=0;r<e.features.length;r++){const i=e.features[r];if(i.geometry){const n=t&&t[r];i.geometry=n&&n.toJSON()||i.geometry}}return e}quantize(t){const{scale:[e,r],translate:[i,n]}=t,s=c=>Math.round((c-i)/e),o=c=>Math.round((n-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,s,o);for(let c=0,u=a.length;c<u;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,u--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:r}=this;if(!r)return this;const{translate:[i,n],scale:[s,o]}=r,a=u=>u*s+i,l=u=>n-u*o,c=this._getHydrationFunction(t,a,l);for(const{geometry:u}of e)M(u)&&c&&c(u);return this.transform=null,this}_quantizePoints(t,e,r){let i,n;const s=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),u=r(l[1]);c===i&&u===n||(s.push([c-i,u-n]),i=c,n=u)}else i=e(l[0]),n=r(l[1]),s.push([i,n])}return s.length>0?s:null}_getQuantizationFunction(t,e,r){return t==="point"?i=>(i.x=e(i.x),i.y=r(i.y),i):t==="polyline"||t==="polygon"?i=>{const n=YT(i)?i.rings:i.paths,s=[];for(let o=0,a=n.length;o<a;o++){const l=n[o],c=this._quantizePoints(l,e,r);c&&s.push(c)}return s.length>0?(YT(i)?i.rings=s:i.paths=s,i):null}:t==="multipoint"?i=>{const n=this._quantizePoints(i.points,e,r);return n&&n.length>0?(i.points=n,i):null}:t==="extent"?i=>i:null}_getHydrationFunction(t,e,r){return t==="point"?i=>{i.x=e(i.x),i.y=r(i.y)}:t==="polyline"||t==="polygon"?i=>{const n=YT(i)?i.rings:i.paths;let s,o;for(let a=0,l=n.length;a<l;a++){const c=n[a];for(let u=0,d=c.length;u<d;u++){const p=c[u];u>0?(s+=p[0],o+=p[1]):(s=p[0],o=p[1]),p[0]=e(s),p[1]=r(o)}}}:t==="extent"?i=>{i.xmin=e(i.xmin),i.ymin=r(i.ymin),i.xmax=e(i.xmax),i.ymax=r(i.ymax)}:t==="multipoint"?i=>{const n=i.points;let s,o;for(let a=0,l=n.length;a<l;a++){const c=n[a];a>0?(s+=c[0],o+=c[1]):(s=c[0],o=c[1]),c[0]=e(s),c[1]=r(o)}}:null}};h([f({type:String,json:{write:!0}})],Vl.prototype,"displayFieldName",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Vl.prototype,"exceededTransferLimit",void 0),h([f({type:[Pl],json:{write:!0}})],Vl.prototype,"features",void 0),h([gt("features")],Vl.prototype,"readFeatures",null),h([f({type:[mj],json:{write:!0}})],Vl.prototype,"fields",void 0),h([f({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:zte.read}}})],Vl.prototype,"geometryType",void 0),h([Ct("geometryType")],Vl.prototype,"writeGeometryType",null),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Vl.prototype,"hasM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Vl.prototype,"hasZ",void 0),h([f({types:fE,json:{write:!0}})],Vl.prototype,"queryGeometry",void 0),h([gt("queryGeometry")],Vl.prototype,"readQueryGeometry",null),h([f({type:St,json:{write:!0}})],Vl.prototype,"spatialReference",void 0),h([Ct("spatialReference")],Vl.prototype,"writeSpatialReference",null),h([f({json:{write:!0}})],Vl.prototype,"transform",void 0),Vl=Bte=h([Q("esri.rest.support.FeatureSet")],Vl),Vl.prototype.toJSON.isDefaultToJSON=!0;const aue=Vl,KAe={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},d0t={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function p0t(t,e){const r=new Date(t,e+1,1);return r.setDate(0),r.getDate()}function tS(t,e,r){const i=new Date(t.getTime());if(e&&r){const n=d0t[r],{getter:s,setter:o,multiplier:a}=n;if(r==="months"){const l=p0t(i.getFullYear(),i.getMonth()+e);i.getDate()>l&&i.setDate(l)}i[o](i[s]()+e*a)}return i}function eye(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function f0t(t,e,r){return t===0?0:t*KAe[e]/KAe[r]}var M0;let jd=M0=class extends Je{static get allTime(){return tye}static get empty(){return m0t}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(M0.allTime)}get isEmpty(){return this.equals(M0.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new M0({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=M(this.start)?this.start.getTime():this.start,r=M(this.end)?this.end.getTime():this.end,i=M(t.start)?t.start.getTime():t.start,n=M(t.end)?t.end.getTime():t.end;return e===i&&r===n}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=rl(this.start,i=>eye(i,t)),r=rl(this.end,i=>{const n=eye(i,t);return i.getTime()===n.getTime()?n:tS(n,1,t)});return new M0({start:e,end:r})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return M0.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=tp(this.start,-1/0,a=>a.getTime()),r=tp(this.end,1/0,a=>a.getTime()),i=tp(t.start,-1/0,a=>a.getTime()),n=tp(t.end,1/0,a=>a.getTime());let s,o;if(i>=e&&i<=r?s=i:e>=i&&e<=n&&(s=e),r>=i&&r<=n?o=r:n>=e&&n<=r&&(o=n),s!=null&&o!=null&&!isNaN(s)&&!isNaN(o)){const a=new M0;return a.start=s===-1/0?null:new Date(s),a.end=o===1/0?null:new Date(o),a}return M0.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const r=new M0,{start:i,end:n}=this;return M(i)&&(r.start=tS(i,t,e)),M(n)&&(r.end=tS(n,t,e)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return tye.clone();const e=M(this.start)&&M(t.start)?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=M(this.end)&&M(t.end)?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new M0({start:e,end:r})}};h([f({type:Date,json:{write:{allowNull:!0}}})],jd.prototype,"end",void 0),h([gt("end")],jd.prototype,"readEnd",null),h([Ct("end")],jd.prototype,"writeEnd",null),h([f({readOnly:!0,json:{read:!1}})],jd.prototype,"isAllTime",null),h([f({readOnly:!0,json:{read:!1}})],jd.prototype,"isEmpty",null),h([f({type:Date,json:{write:{allowNull:!0}}})],jd.prototype,"start",void 0),h([gt("start")],jd.prototype,"readStart",null),h([Ct("start")],jd.prototype,"writeStart",null),jd=M0=h([Q("esri.TimeExtent")],jd);const tye=new jd,m0t=new jd({start:void 0,end:void 0}),ey=jd;let Ox=class extends Qs(Je){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};h([f({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:M(this.onFields)&&this.onFields.length>0}}}}})],Ox.prototype,"onFields",void 0),h([f({type:String,json:{write:!0}})],Ox.prototype,"operator",void 0),h([f({type:String,json:{write:!0}})],Ox.prototype,"searchTerm",void 0),h([f({type:String,json:{write:!0}})],Ox.prototype,"searchType",void 0),Ox=h([Q("esri.rest.support.FullTextSearch")],Ox);const g0t=Ox;var Vte;const rye=new Hi({upperLeft:"upper-left",lowerLeft:"lower-left"});let Px=Vte=class extends Je{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new Vte(Te({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};h([f({type:an,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Px.prototype,"extent",void 0),h([f({type:["view","edit"],json:{write:!0}})],Px.prototype,"mode",void 0),h([f({type:String,json:{read:rye.read,write:rye.write}})],Px.prototype,"originPosition",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Px.prototype,"tolerance",void 0),Px=Vte=h([Q("esri.rest.support.QuantizationParameters")],Px);const A0t=Px;var Gte;const iye=new Hi({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let R0=Gte=class extends Je{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=Te(t))}clone(){return new Gte({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:Te(this.statisticParameters)})}};h([f({type:Number,json:{write:!0}})],R0.prototype,"maxPointCount",void 0),h([f({type:Number,json:{write:!0}})],R0.prototype,"maxRecordCount",void 0),h([f({type:Number,json:{write:!0}})],R0.prototype,"maxVertexCount",void 0),h([f({type:String,json:{write:!0}})],R0.prototype,"onStatisticField",void 0),h([f({type:String,json:{write:!0}})],R0.prototype,"outStatisticFieldName",void 0),h([f({type:String,json:{read:{source:"statisticType",reader:iye.read},write:{target:"statisticType",writer:iye.write}}})],R0.prototype,"statisticType",void 0),h([f({type:Object})],R0.prototype,"statisticParameters",void 0),h([Ct("statisticParameters")],R0.prototype,"writeStatisticParameters",null),R0=Gte=h([Q("esri.rest.support.StatisticDefinition")],R0);const gDe=R0;var KM;const y0t=new Hi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),_0t=new Hi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let $r=KM=class extends Je{static from(t){return FR(KM,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const r={};for(const i in t){const n=t[i];Array.isArray(n)?r[i]=n.map(s=>s instanceof Date?s.getTime():s):n instanceof Date?r[i]=n.getTime():r[i]=n}e.parameterValues=r}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new KM(Te({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:M(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};$r.MAX_MAX_RECORD_COUNT_FACTOR=5,h([f({json:{write:!0}})],$r.prototype,"aggregateIds",void 0),h([f({type:Boolean,json:{write:!0}})],$r.prototype,"cacheHint",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],$r.prototype,"compactGeometryEnabled",void 0),h([f({json:{write:!0}})],$r.prototype,"datumTransformation",void 0),h([Wr("datumTransformation")],$r.prototype,"castDatumTransformation",null),h([f({type:Boolean,json:{default:!1,write:!0}})],$r.prototype,"defaultSpatialReferenceEnabled",void 0),h([f({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],$r.prototype,"distance",void 0),h([f({type:X0,json:{write:!0}})],$r.prototype,"dynamicDataSource",void 0),h([f({type:String,json:{write:!0}})],$r.prototype,"formatOf3DObjects",void 0),h([f({type:[g0t],json:{write:{enabled:!0,overridePolicy(){return{enabled:M(this.fullText)&&this.fullText.length>0}}}}})],$r.prototype,"fullText",void 0),h([f({type:String,json:{write:!0}})],$r.prototype,"gdbVersion",void 0),h([f({types:fE,json:{read:r1,write:!0}})],$r.prototype,"geometry",void 0),h([f({type:Number,json:{write:!0}})],$r.prototype,"geometryPrecision",void 0),h([f({type:[String],json:{write:!0}})],$r.prototype,"groupByFieldsForStatistics",void 0),h([f({type:String,json:{write:!0}})],$r.prototype,"having",void 0),h([f({type:Date})],$r.prototype,"historicMoment",void 0),h([Ct("historicMoment")],$r.prototype,"writeHistoricMoment",null),h([f({type:Number,json:{write:!0}})],$r.prototype,"maxAllowableOffset",void 0),h([f({type:Number,cast:t=>t<1?1:t>KM.MAX_MAX_RECORD_COUNT_FACTOR?KM.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],$r.prototype,"maxRecordCountFactor",void 0),h([f({type:["xyFootprint"],json:{write:!0}})],$r.prototype,"multipatchOption",void 0),h([f({type:Number,json:{read:{source:"resultRecordCount"}}})],$r.prototype,"num",void 0),h([f({json:{write:!0}})],$r.prototype,"objectIds",void 0),h([f({type:[String],json:{write:!0}})],$r.prototype,"orderByFields",void 0),h([f({type:[String],json:{write:!0}})],$r.prototype,"outFields",void 0),h([f({type:St,json:{name:"outSR",write:!0}})],$r.prototype,"outSpatialReference",void 0),h([f({type:[gDe],json:{write:{enabled:!0,overridePolicy(){return{enabled:M(this.outStatistics)&&this.outStatistics.length>0}}}}})],$r.prototype,"outStatistics",void 0),h([f({json:{write:!0}})],$r.prototype,"parameterValues",void 0),h([Ct("parameterValues")],$r.prototype,"writeParameterValues",null),h([f({type:Ht,json:{write:!0}})],$r.prototype,"pixelSize",void 0),h([f({type:A0t,json:{write:!0}})],$r.prototype,"quantizationParameters",void 0),h([f({type:[Object],json:{write:!0}})],$r.prototype,"rangeValues",void 0),h([f({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],$r.prototype,"relationParameter",void 0),h([f({type:String,json:{write:!0}})],$r.prototype,"resultType",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],$r.prototype,"returnCentroid",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],$r.prototype,"returnDistinctValues",void 0),h([f({type:Boolean,json:{default:!0,write:!0}})],$r.prototype,"returnExceededLimitFeatures",void 0),h([f({type:Boolean,json:{write:!0}})],$r.prototype,"returnGeometry",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],$r.prototype,"returnQueryGeometry",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],$r.prototype,"returnM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],$r.prototype,"returnZ",void 0),h([f({type:St,json:{write:!0}})],$r.prototype,"sourceSpatialReference",void 0),h([nr(y0t,{ignoreUnknown:!1,name:"spatialRel"})],$r.prototype,"spatialRelationship",void 0),h([f({type:Number,json:{read:{source:"resultOffset"}}})],$r.prototype,"start",void 0),h([Ct("start"),Ct("num")],$r.prototype,"writeStart",null),h([f({type:String,json:{write:!0}})],$r.prototype,"sqlFormat",void 0),h([f({type:String,json:{write:!0}})],$r.prototype,"text",void 0),h([f({type:ey,json:{write:!0}})],$r.prototype,"timeExtent",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],$r.prototype,"timeReferenceUnknownClient",void 0),h([nr(_0t,{ignoreUnknown:!1}),f({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],$r.prototype,"units",void 0),h([f({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],$r.prototype,"where",void 0),h([Ct("where")],$r.prototype,"writeWhere",null),$r=KM=h([Q("esri.rest.support.Query")],$r);const xA=$r;async function YW(t,e,r){const i=await v0t(t,e,r);return aue.fromJSON(i)}async function v0t(t,e,r){const i=oue(t),n={...r},s=xA.from(e),{data:o}=await u0t(i,s,s.sourceSpatialReference,n);return o}function Oc(t,e){return t?e?4:3:e?3:2}const GN=we.getLogger("esri.layers.graphics.featureConversionUtils"),ADe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},b0t=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s},nye=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+2]},w0t=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+3]},x0t=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+2],t[r+3]=e[i+3]};function lue(t,e,r,i){if(t){if(r)return e&&i?x0t:nye;if(e&&i)return w0t}else if(e&&i)return nye;return b0t}function XW({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function ZW({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function JW({scale:t,translate:e},r,i){return r*t[i]+e[i]}function zar(t,e,r){return t?e?r?hue(t):cue(t):r?uue(t):gj(t):null}function gj(t){const e=t.coords;return{x:e[0],y:e[1]}}function yDe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function cue(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function T0t(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function uue(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function S0t(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function hue(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function E0t(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function C0t(t,e,r,i){let n=gj;r&&i?n=hue:r?n=cue:i&&(n=uue);for(const s of e){const{geometry:o,attributes:a}=s,l=M(o)?n(o):null;t.push({attributes:a,geometry:l})}return t}function due(t,e){return t&&e?E0t:t?T0t:e?S0t:yDe}function M0t(t,e,r,i,n){const s=due(r,i);for(const{geometry:o,attributes:a}of e){const l=M(o)?s(new Nm,o):null;t.push(new I2(l,a,null,n?a[n]:void 0))}return t}function Var(t,e,r=due(e.z!=null,e.m!=null)){return r(t,e)}function R0t(t,e,r,i){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:M(n)?_De(n,r,i):null});return t}function _De(t,e,r){if(k(t))return null;const i=Oc(e,r),n=[];for(let s=0;s<t.coords.length;s+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[s+a]);n.push(o)}return e?r?{points:n,hasZ:e,hasM:r}:{points:n,hasZ:e}:r?{points:n,hasM:r}:{points:n}}function O0t(t,e,r,i,n){const s=Oc(r,i);for(const{geometry:o,attributes:a}of e){const l=M(o)?vDe(new Nm,o,s):null;t.push(new I2(l,a,null,n?a[n]:void 0))}return t}function vDe(t,e,r=Oc(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let n=0;for(const s of e.points)for(let o=0;o<r;o++)i[n++]=s[o];return t}function P0t(t,e,r,i){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:M(n)?bDe(n,r,i):null});return t}function bDe(t,e,r){if(!t)return null;const i=Oc(e,r),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<i;p++)d.push(n[a++]);c.push(d)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function I0t(t,e,r,i,n){const s=Oc(r,i);for(const{geometry:o,attributes:a}of e){const l=M(o)?wDe(new Nm,o,s):null;t.push(new I2(l,a,null,n?a[n]:void 0))}return t}function wDe(t,e,r=Oc(e.hasZ,e.hasM)){const{lengths:i,coords:n}=t;let s=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)n[s++]=a[l];i.push(o.length)}return t}function $0t(t,e,r,i){for(const{geometry:n,attributes:s,centroid:o}of e){const a=M(n)?xDe(n,r,i):null;if(M(o)){const l=gj(o);t.push({attributes:s,centroid:l,geometry:a})}else t.push({attributes:s,geometry:a})}return t}function xDe(t,e,r){if(!t)return null;const i=Oc(e,r),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<i;p++)d.push(n[a++]);c.push(d)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function D0t(t,e,r,i,n){for(const{geometry:s,centroid:o,attributes:a}of e){const l=M(s)?TDe(new Nm,s,r,i):null,c=n?a[n]:void 0;M(o)?t.push(new I2(l,a,yDe(new Nm,o),c)):t.push(new I2(l,a,null,c))}return t}function TDe(t,e,r=e.hasZ,i=e.hasM){return L0t(t,e.rings,r,i),t}function L0t(t,e,r,i){const n=Oc(r,i),{lengths:s,coords:o}=t;let a=0;k_(t);for(const l of e){for(const c of l)for(let u=0;u<n;u++)o[a++]=c[u];s.push(l.length)}return t}const eR=[],I5=[];function Gar(t,e,r,i,n){eR[0]=t;const[s]=SDe(I5,eR,e,r,i,n);return Fm(eR),Fm(I5),s}function SDe(t,e,r,i,n,s){if(Fm(t),!r){for(const o of e){const a=s?o.attributes[s]:void 0;t.push(new I2(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return M0t(t,e,i,n,s);case"esriGeometryMultipoint":return O0t(t,e,i,n,s);case"esriGeometryPolyline":return I0t(t,e,i,n,s);case"esriGeometryPolygon":return D0t(t,e,i,n,s);default:GN.error("convertToFeatureSet:unknown-geometry",new pe(`Unable to parse unknown geometry type '${r}'`)),Fm(t)}return t}function jar(t,e,r,i){I5[0]=t,EDe(eR,I5,e,r,i);const n=eR[0];return Fm(eR),Fm(I5),n}function N0t(t,e,r){if(k(t))return null;const i=new Nm;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),Gle(t)?due(e??t.z!=null,r??t.m!=null)(i,t):YT(t)?TDe(i,t,e,r):jle(t)?wDe(i,t,Oc(e,r)):Vle(t)?vDe(i,t,Oc(e,r)):void GN.error("convertFromGeometry:unknown-geometry",new pe(`Unable to parse unknown geometry type '${t}'`))}function F0t(t,e,r,i){const n=t&&("coords"in t?t:t.geometry);if(k(n))return null;switch(e){case"esriGeometryPoint":{let s=gj;return r&&i?s=hue:r?s=cue:i&&(s=uue),s(n)}case"esriGeometryMultipoint":return _De(n,r,i);case"esriGeometryPolyline":return bDe(n,r,i);case"esriGeometryPolygon":return xDe(n,r,i);default:return GN.error("convertToGeometry:unknown-geometry",new pe(`Unable to parse unknown geometry type '${e}'`)),null}}function k0t(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function EDe(t,e,r,i,n){if(Fm(t),k(r))return k0t(t,e);switch(r){case"esriGeometryPoint":return C0t(t,e,i,n);case"esriGeometryMultipoint":return R0t(t,e,i,n);case"esriGeometryPolyline":return P0t(t,e,i,n);case"esriGeometryPolygon":return $0t(t,e,i,n);default:GN.error("convertToFeatureSet:unknown-geometry",new pe(`Unable to parse unknown geometry type '${r}'`))}return t}function Har(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:d,queryGeometryType:p}=t,A={features:EDe([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:u,queryGeometry:F0t(d,p,!1,!1)};return i&&(A.transform=i),c&&(A.exceededTransferLimit=c),s&&(A.hasM=s),o&&(A.hasZ=o),A}function qar(t,e){const r=new pDe,{hasM:i,hasZ:n,features:s,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:d}=t;return d&&(r.fields=d),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(s&&SDe(r.features,s,l,n,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),n&&(r.hasZ=n),u&&(r.transform=u),r):(GN.error(new pe("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function War(t){const{transform:e,features:r,hasM:i,hasZ:n}=t;if(!e)return t;for(const s of r)M(s.geometry)&&oye(s.geometry,s.geometry,i,n,e),M(s.centroid)&&oye(s.centroid,s.centroid,i,n,e);return t.transform=null,t}function Qar(t,e){const{geometryType:r,features:i,hasM:n,hasZ:s}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new Nm,sye(l.geometry,a.geometry,n,s,r,t),a.centroid&&(l.centroid=new Nm,sye(l.centroid,a.centroid,n,s,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function sye(t,e,r,i,n,s,o=r,a=i){if(k_(t),k(e)||!e.coords.length)return null;const l=ADe[n],{coords:c,lengths:u}=e,d=Oc(r,i),p=Oc(r&&o,i&&a),A=lue(r,i,o,a);if(!u.length)return A(t.coords,c,0,0,XW(s,c[0]),ZW(s,c[1])),k_(t,d,0),t;let v,b,S,E,R=0,O=0,I=O;for(const N of u){if(N<l)continue;let L=0;O=I,S=v=XW(s,c[R]),E=b=ZW(s,c[R+1]),A(t.coords,c,O,R,S,E),L++,R+=d,O+=p;for(let B=1;B<N;B++,R+=d)S=XW(s,c[R]),E=ZW(s,c[R+1]),S===v&&E===b||(A(t.coords,c,O,R,S-v,E-b),O+=p,L++,v=S,b=E);L>=l&&(t.lengths.push(L),I=O)}return Fm(t.coords,I),t.coords.length?t:null}function Yar(t,e,r,i,n,s,o=r,a=i){if(k_(t),!e||!e.coords.length)return null;const l=ADe[n],{coords:c,lengths:u}=e,d=Oc(r,i),p=Oc(r&&o,i&&a),A=lue(r,i,o,a);if(!u.length)return A(t.coords,c,0,0,c[0],c[1]),k_(t,d,0),t;let v=0;const b=s*s;for(const S of u){if(S<l){v+=S*d;continue}const E=t.coords.length/p,R=v,O=v+(S-1)*d;A(t.coords,c,t.coords.length,R,c[R],c[R+1]),jte(t.coords,c,d,b,A,R,O),A(t.coords,c,t.coords.length,O,c[O],c[O+1]);const I=t.coords.length/p-E;I>=l?t.lengths.push(I):Fm(t.coords,E*p),v+=S*d}return t.coords.length?t:null}function U0t(t,e,r,i){const n=t[e],s=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let u=o,d=a,p=l-u,A=c-d;if(p!==0||A!==0){const v=((n-u)*p+(s-d)*A)/(p*p+A*A);v>1?(u=l,d=c):v>0&&(u+=p*v,d+=A*v)}return p=n-u,A=s-d,p*p+A*A}function jte(t,e,r,i,n,s,o){let a,l=i,c=0;for(let u=s+r;u<o;u+=r)a=U0t(e,u,s,o),a>l&&(c=u,l=a);l>i&&(c-s>r&&jte(t,e,r,i,n,s,c),n(t,e,t.length,c,e[c],e[c+1]),o-c>r&&jte(t,e,r,i,n,c,o))}function Xar(t,e,r,i){if(k(e)||!e.coords||!e.coords.length)return null;const n=Oc(r,i);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let u=0;u<c.length;u+=n){const d=c[u],p=c[u+1];s=Math.min(s,d),a=Math.max(a,d),o=Math.min(o,p),l=Math.max(l,p)}}return gee(t)?Kst(t,s,o,a,l):tce(s,o,a,l,t),t}function oye(t,e,r,i,n){const{coords:s,lengths:o}=e,a=Oc(r,i);if(!s.length)return t!==e&&k_(t),t;fG(n);const{originPosition:l,scale:c,translate:u}=n,d=z0t;d.originPosition=l;const p=d.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const A=d.translate;if(A[0]=u[0]??0,A[1]=u[1]??0,A[2]=u[2]??0,A[3]=u[3]??0,!o.length){for(let b=0;b<a;++b)t.coords[b]=JW(d,s[b],b);return t!==e&&k_(t,a,0),t}let v=0;for(let b=0;b<o.length;b++){const S=o[b];t.lengths[b]=S;for(let O=0;O<a;++O)t.coords[v+O]=JW(d,s[v+O],O);let E=t.coords[v],R=t.coords[v+1];v+=a;for(let O=1;O<S;O++,v+=a){E+=s[v]*p[0],R+=s[v+1]*p[1],t.coords[v]=E,t.coords[v+1]=R;for(let I=2;I<a;++I)t.coords[v+I]=JW(d,s[v+I],I)}}return t!==e&&k_(t,s.length,o.length),t}function Zar(t,e,r,i,n,s){if(k_(t),t.lengths.push(...e.lengths),r===n&&i===s)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=Oc(r,i),a=lue(r,i,n,s),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function B0t(t,e,r,i){let n=0,s=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=s+t[i*(e+a)],c=o+t[i*(e+a)+1],u=(l-s)*(c+o);s=l,o=c,n+=u}return .5*n}function Jar(t,e){const{coords:r,lengths:i}=t;let n=0,s=0;for(let o=0;o<i.length;o++){const a=i[o];s+=B0t(r,n,a,e),n+=a}return Math.abs(s)}function Kar(t,e){if(k(t))return null;const r=t.clone(),i=t.coords,n=t.lengths;let s=0;for(let o=0;o<n.length;o++){const a=n[o];let l=i[e*s],c=i[e*s+1];for(let u=1;u<a;u++){const d=l+i[e*(s+u)],p=c+i[e*(s+u)+1];r.coords[e*(s+u)]=d,r.coords[e*(s+u)+1]=p,l=d,c=p}s+=a}return r}function k_(t,e=0,r=0){Fm(t.lengths,r),Fm(t.coords,e)}function Fm(t,e=0){t.length!==e&&(t.length=e)}const z0t={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};var Hte;let Co=Hte=class extends Je{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new Hte(Te({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};h([f({type:Boolean,json:{write:!0}})],Co.prototype,"cacheHint",void 0),h([f({type:X0,json:{write:!0}})],Co.prototype,"dynamicDataSource",void 0),h([f({type:String,json:{write:!0}})],Co.prototype,"gdbVersion",void 0),h([f({type:Number,json:{write:!0}})],Co.prototype,"geometryPrecision",void 0),h([f({type:Date})],Co.prototype,"historicMoment",void 0),h([Ct("historicMoment")],Co.prototype,"_writeHistoricMoment",null),h([f({type:Number,json:{write:!0}})],Co.prototype,"maxAllowableOffset",void 0),h([f({type:[Number],json:{write:!0}})],Co.prototype,"objectIds",void 0),h([f({type:[String],json:{write:!0}})],Co.prototype,"orderByFields",void 0),h([f({type:[String],json:{write:!0}})],Co.prototype,"outFields",void 0),h([f({type:St,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Co.prototype,"outSpatialReference",void 0),h([f({json:{write:!0}})],Co.prototype,"relationshipId",void 0),h([f({type:Number,json:{read:{source:"resultOffset"}}})],Co.prototype,"start",void 0),h([Ct("start"),Ct("num")],Co.prototype,"writeStart",null),h([f({type:Number,json:{read:{source:"resultRecordCount"}}})],Co.prototype,"num",void 0),h([f({json:{write:!0}})],Co.prototype,"returnGeometry",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Co.prototype,"returnM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Co.prototype,"returnZ",void 0),h([f({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Co.prototype,"where",void 0),Co=Hte=h([Q("esri.rest.support.RelationshipQuery")],Co),Co.from=Go(Co);const sO=Co,elr=Object.freeze(Object.defineProperty({__proto__:null,default:sO},Symbol.toStringTag,{value:"Module"}));var qte;let yC=qte=class extends Je{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new qte({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};h([f({type:[String],json:{write:!0}})],yC.prototype,"groupByFields",void 0),h([f({type:Number,json:{write:!0}})],yC.prototype,"topCount",void 0),h([f({type:[String],json:{write:!0}})],yC.prototype,"orderByFields",void 0),yC=qte=h([Q("esri.rest.support.TopFilter")],yC);const V0t=yC;var Wte;const aye=new Hi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),lye=new Hi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let to=Wte=class extends Je{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new Wte(Te({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};h([f({type:Boolean,json:{write:!0}})],to.prototype,"cacheHint",void 0),h([f({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],to.prototype,"distance",void 0),h([f({types:fE,json:{read:r1,write:!0}})],to.prototype,"geometry",void 0),h([f({type:Number,json:{write:!0}})],to.prototype,"geometryPrecision",void 0),h([f({type:Number,json:{write:!0}})],to.prototype,"maxAllowableOffset",void 0),h([f({type:Number,json:{read:{source:"resultRecordCount"}}})],to.prototype,"num",void 0),h([f({json:{write:!0}})],to.prototype,"objectIds",void 0),h([f({type:[String],json:{write:!0}})],to.prototype,"orderByFields",void 0),h([f({type:[String],json:{write:!0}})],to.prototype,"outFields",void 0),h([f({type:St,json:{read:{source:"outSR"},write:{target:"outSR"}}})],to.prototype,"outSpatialReference",void 0),h([f({type:String,json:{write:!0}})],to.prototype,"resultType",void 0),h([f({json:{write:!0}})],to.prototype,"returnGeometry",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],to.prototype,"returnM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],to.prototype,"returnZ",void 0),h([f({type:Number,json:{read:{source:"resultOffset"}}})],to.prototype,"start",void 0),h([Ct("start"),Ct("num")],to.prototype,"writeStart",null),h([f({type:String,json:{read:{source:"spatialRel",reader:aye.read},write:{target:"spatialRel",writer:aye.write}}})],to.prototype,"spatialRelationship",void 0),h([f({type:ey,json:{write:!0}})],to.prototype,"timeExtent",void 0),h([f({type:V0t,json:{write:!0}})],to.prototype,"topFilter",void 0),h([f({type:String,json:{read:lye.read,write:{writer:lye.write,overridePolicy(t){return{enabled:M(t)&&M(this.distance)&&this.distance>0}}}}})],to.prototype,"units",void 0),h([f({type:String,json:{write:!0}})],to.prototype,"where",void 0),to=Wte=h([Q("esri.rest.support.TopFeaturesQuery")],to),to.from=Go(to);const L6=to,G0t="esri.widgets.Feature.support.relatedFeatureUtils",cye=we.getLogger(G0t),uye=new Map;function gk(t){if(!C_(t))return null;const[e,r]=t.split("/").slice(1);return{layerId:e,fieldName:r}}function j0t(t,e){if(!e.relationships)return null;let r=null;const{relationships:i}=e;return i.some(n=>n.id===parseInt(t,10)&&(r=n,!0)),r}function H0t({originRelationship:t,relationships:e,layerId:r}){let i=null;return e&&e.some(n=>(`${n.relatedTableId}`===r&&n.id===(t==null?void 0:t.id)&&(i=n),!!i)),i}function q0t(t,e){const r=e.toLowerCase();for(const i in t)if(i.toLowerCase()===r)return t[i];return null}function W0t(t,e){const r=j0t(t,e);if(r)return{url:`${e.url}/${r.relatedTableId}`,sourceSpatialReference:e.spatialReference,relation:r,relatedFields:[],outStatistics:[]}}function Q0t(t,e){if(!e||!t)return;const{features:r,statsFeatures:i}=t,n=r&&r.value;e.relatedFeatures=n?n.features:[];const s=i&&i.value;e.relatedStatsFeatures=s?s.features:[]}function Y0t(t,e,r,i){var s;const n=new sO;return n.outFields=["*"],n.relationshipId=typeof e.id=="number"?e.id:parseInt(e.id,10),n.objectIds=[t.attributes[r.objectIdField]],((s=r.queryRelatedFeatures)==null?void 0:s.call(r,n,i))??Promise.resolve({})}function X0t(t,e,r){let i=0;const n=[];for(;i<e.length;)n.push(`${t} IN (${e.slice(i,r+i)})`),i+=r;return n.join(" OR ")}async function Z0t(t,e,r,i){const n=r.layerId.toString(),{layerInfo:s,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:u}=e;if(!s||!o)return null;const d=H0t({originRelationship:o,relationships:s.relationships,layerId:n});if(d!=null&&d.relationshipTableId&&d.keyFieldInRelationshipTable){const A=(await Y0t(t,d,r,i))[t.attributes[r.objectIdField]];if(!A)return null;const v=A.features.map(b=>b.attributes[s.objectIdField]);if(l!=null&&l.length&&s.supportsStatistics){const b=new xA;b.where=X0t(s.objectIdField,v,1e3),b.outFields=a,b.outStatistics=l,b.sourceSpatialReference=u;const S={features:Promise.resolve(A),statsFeatures:YW(c,b)};return fh(S)}}const p=d==null?void 0:d.keyField;if(p){const A=RG(rmt(s.fields,p)),v=q0t(t.attributes,o.keyField),b=A?`${p}=${v}`:`${p}='${v}'`,S=YW(c,new xA({where:b,outFields:e.relatedFields,sourceSpatialReference:u}),i),E=e.outStatistics&&e.outStatistics.length>0&&s.supportsStatistics?YW(c,new xA({where:b,outFields:e.relatedFields,outStatistics:e.outStatistics,sourceSpatialReference:u}),i):null,R={features:S};return E&&(R.statsFeatures=E),fh(R)}return null}function J0t(t,e){return ns(t,{query:{f:"json"},signal:e&&e.signal})}function K0t({relatedInfos:t,layer:e},r){const i={};return t.forEach((n,s)=>{const{relation:o}=n;if(!o){const d=new pe("relation-required","A relation is required on a layer to retrieve related records.");throw cye.error(d),d}const{relatedTableId:a}=o;if(typeof a!="number"){const d=new pe("A related table ID is required on a layer to retrieve related records.");throw cye.error(d),d}const l=`${e.url}/${a}`,c=uye.get(l),u=c||J0t(l);c||uye.set(l,u),i[s]=u}),Qae(fh(i),r)}function emt({graphic:t,relatedInfos:e,layer:r},i){const n={};return e.forEach((s,o)=>{s.layerInfo&&(n[o]=Z0t(t,s,r,i))}),fh(n)}function tmt({relatedInfo:t,fieldName:e,fieldInfo:r}){var i,n;if((i=t.relatedFields)==null||i.push(e),r.statisticType){const s=new gDe({statisticType:r.statisticType,onStatisticField:e,outStatisticFieldName:e});(n=t.outStatistics)==null||n.push(s)}}function rmt(t,e){if(t!=null){e=e.toLowerCase();for(const r of t)if(r&&r.name.toLowerCase()===e)return r}return null}const hye={chartAnimation:!0};let ka=class extends rt{constructor(e){super(e),this.abilities={...hye},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...hye,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:r}=this,i=(e+r)%r;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:r}=this,i=r+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{mediaInfos:e,layer:r}=this,i=this.attributes??{},n=this.formattedAttributes??{},s=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return(e==null?void 0:e.map(a=>{const l=a==null?void 0:a.clone();if(!l)return null;if(l.title=NT({attributes:i,fieldInfoMap:o,globalAttributes:n,expressionAttributes:s,layer:r,text:l.title}),l.caption=NT({attributes:i,fieldInfoMap:o,globalAttributes:n,expressionAttributes:s,layer:r,text:l.caption}),l.altText=NT({attributes:i,fieldInfoMap:o,globalAttributes:n,expressionAttributes:s,layer:r,text:l.altText}),l.type==="image"){const{value:c}=l;return this._setImageValue({value:c,formattedAttributes:n,layer:r}),l.value.sourceURL?l:void 0}if(l.type==="pie-chart"||l.type==="line-chart"||l.type==="column-chart"||l.type==="bar-chart"){const{value:c}=l;return this._setChartValue({value:c,chartType:l.type,attributes:i,formattedAttributes:n,layer:r,expressionAttributes:s}),l}return null}).filter(M))??[]}_setImageValue(e){const r=this.fieldInfoMap??new Map,{value:i,formattedAttributes:n,layer:s}=e,{linkURL:o,sourceURL:a}=i;if(a){const l=bte(a,s);i.sourceURL=vte({formattedAttributes:n,template:l,fieldInfoMap:r})}if(o){const l=bte(o,s);i.linkURL=vte({formattedAttributes:n,template:l,fieldInfoMap:r})}}_setChartValue(e){const{value:r,attributes:i,formattedAttributes:n,chartType:s,layer:o,expressionAttributes:a}=e,{popupTemplate:l,relatedInfos:c}=this,{fields:u,normalizeField:d}=r,p=o;if(r.fields=Mdt(u,p),d&&(r.normalizeField=aL(d,p)),!u.some(v=>!!(n[v]!=null||C_(v)&&(c!=null&&c.size))))return;const A=(l==null?void 0:l.fieldInfos)??[];u.forEach(v=>{if(C_(v))return void(r.series=[...r.series,...this._getRelatedChartInfos({fieldInfos:A,fieldName:v,formattedAttributes:n,chartType:s,value:r})]);const b=this._getChartOption({value:r,attributes:i,chartType:s,formattedAttributes:n,expressionAttributes:a,fieldName:v,fieldInfos:A});r.series.push(b)})}_getRelatedChartInfos(e){var A;const{fieldInfos:r,fieldName:i,formattedAttributes:n,chartType:s,value:o}=e,a=[],l=gk(i),c=l&&((A=this.relatedInfos)==null?void 0:A.get(l.layerId.toString()));if(!c)return a;const{relatedFeatures:u,relation:d}=c;if(!d||!u)return a;const{cardinality:p}=d;return u.forEach(v=>{const{attributes:b}=v;b&&Object.keys(b).forEach(S=>{S===l.fieldName&&a.push(this._getChartOption({value:o,attributes:b,formattedAttributes:n,fieldName:i,chartType:s,relatedFieldName:S,hasMultipleRelatedFeatures:(u==null?void 0:u.length)>1,fieldInfos:r}))})}),p==="one-to-many"||p==="many-to-many"?a:[a[0]]}_getTooltip({label:e,value:r,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${r}`}_getChartOption(e){var L;const{value:r,attributes:i,formattedAttributes:n,expressionAttributes:s,fieldName:o,relatedFieldName:a,fieldInfos:l,chartType:c,hasMultipleRelatedFeatures:u}=e,d=this.layer,p=this.fieldInfoMap??new Map,{normalizeField:A,tooltipField:v}=r,b=A?C_(A)?i[gk(A).fieldName]:i[A]:null,S=Qce(o)&&s&&s[o]!==void 0?s[o]:a&&i[a]!==void 0?i[a]:i[o]!==void 0?i[o]:n[o],E=new kPe({fieldName:o,value:S===void 0?null:S&&b?S/b:S});if(C_(o)){const B=p.get(o.toLowerCase()),U=v&&p.get(v.toLowerCase()),q=(B==null?void 0:B.fieldName)??o,Z=u&&v?gk(v).fieldName:(U==null?void 0:U.fieldName)??v,X=u&&Z?i[Z]:n[Z]??(B==null?void 0:B.label)??(B==null?void 0:B.fieldName)??a,ee=u&&a?i[a]:n[q];return E.tooltip=this._getTooltip({label:X,value:ee,chartType:c}),E}const R=$5e(l,o),O=aL(o,d),I=v&&n[v]!==void 0?n[v]:P5e(R||new RN({fieldName:O}),(L=this.popupTemplate)==null?void 0:L.expressionInfos),N=n[O];return E.tooltip=this._getTooltip({label:I,value:N,chartType:c}),E}};h([f()],ka.prototype,"abilities",void 0),h([Wr("abilities")],ka.prototype,"castAbilities",null),h([f()],ka.prototype,"activeMediaInfoIndex",void 0),h([f({readOnly:!0})],ka.prototype,"activeMediaInfo",null),h([f()],ka.prototype,"attributes",void 0),h([f()],ka.prototype,"description",void 0),h([f()],ka.prototype,"fieldInfoMap",void 0),h([f()],ka.prototype,"formattedAttributes",void 0),h([f()],ka.prototype,"expressionAttributes",void 0),h([f({readOnly:!0})],ka.prototype,"formattedMediaInfos",null),h([f()],ka.prototype,"isAggregate",void 0),h([f()],ka.prototype,"layer",void 0),h([f({readOnly:!0})],ka.prototype,"formattedMediaInfoCount",null),h([f()],ka.prototype,"mediaInfos",void 0),h([f()],ka.prototype,"popupTemplate",void 0),h([f()],ka.prototype,"relatedInfos",void 0),h([f()],ka.prototype,"title",void 0),ka=h([Q("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],ka);const kT=ka;var dye=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],imt=[].concat(dye.slice(30,39),dye.slice(28,30).reverse()),nmt=[{name:"default",colors:imt},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const pye="en-us",pue=new Map([["ar",()=>be(()=>import("./ar-bb1fe5ab.js"),["assets/ar-bb1fe5ab.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.a)],["bg-bg",()=>be(()=>import("./bg_BG-184a2bfa.js"),["assets/bg_BG-184a2bfa.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.b)],["bs-ba",()=>be(()=>import("./bs_BA-f32cc344.js"),["assets/bs_BA-f32cc344.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.b)],["ca-es",()=>be(()=>import("./ca_ES-d17ee95b.js"),["assets/ca_ES-d17ee95b.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.c)],["cs-cz",()=>be(()=>import("./cs_CZ-bcd1e782.js"),["assets/cs_CZ-bcd1e782.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.c)],["da-dk",()=>be(()=>import("./da_DK-27b1b06e.js"),["assets/da_DK-27b1b06e.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["de-de",()=>be(()=>import("./de_DE-c0a1d8dd.js"),["assets/de_DE-c0a1d8dd.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["de-ch",()=>be(()=>import("./de_CH-be7b4255.js"),["assets/de_CH-be7b4255.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["el-gr",()=>be(()=>import("./el_GR-05fb9ec0.js"),["assets/el_GR-05fb9ec0.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["en-us",()=>be(()=>import("./en_US-170979d8.js"),["assets/en_US-170979d8.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["en-ca",()=>be(()=>import("./en_CA-170979d8.js"),["assets/en_CA-170979d8.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["es-es",()=>be(()=>import("./es_ES-d0b66640.js"),["assets/es_ES-d0b66640.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["et-ee",()=>be(()=>import("./et_EE-56dd74d3.js"),["assets/et_EE-56dd74d3.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["fi-fi",()=>be(()=>import("./fi_FI-91d58cb9.js"),["assets/fi_FI-91d58cb9.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.f)],["fr-fr",()=>be(()=>import("./fr_FR-a11503e0.js"),["assets/fr_FR-a11503e0.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.f)],["he-il",()=>be(()=>import("./he_IL-90db98c4.js"),["assets/he_IL-90db98c4.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["hr-hr",()=>be(()=>import("./hr_HR-fac8bb29.js"),["assets/hr_HR-fac8bb29.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["hu-hu",()=>be(()=>import("./hu_HU-e8803856.js"),["assets/hu_HU-e8803856.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["id-id",()=>be(()=>import("./id_ID-86e57d06.js"),["assets/id_ID-86e57d06.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.i)],["it-it",()=>be(()=>import("./it_IT-2d4485ba.js"),["assets/it_IT-2d4485ba.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.i)],["ja-jp",()=>be(()=>import("./ja_JP-77c6c16d.js"),["assets/ja_JP-77c6c16d.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.j)],["ko-kr",()=>be(()=>import("./ko_KR-e155b9ab.js"),["assets/ko_KR-e155b9ab.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.k)],["lt-lt",()=>be(()=>import("./lt_LT-fde47ae9.js"),["assets/lt_LT-fde47ae9.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.l)],["lv-lv",()=>be(()=>import("./lv_LV-359be050.js"),["assets/lv_LV-359be050.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.l)],["nb-no",()=>be(()=>import("./nb_NO-30d57c1a.js"),["assets/nb_NO-30d57c1a.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.n)],["nl-nl",()=>be(()=>import("./nl_NL-cb904b48.js"),["assets/nl_NL-cb904b48.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.n)],["pl-pl",()=>be(()=>import("./pl_PL-58c54c9f.js"),["assets/pl_PL-58c54c9f.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["pt-br",()=>be(()=>import("./pt_BR-d2e10248.js"),["assets/pt_BR-d2e10248.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["pt-pt",()=>be(()=>import("./pt_PT-65a41842.js"),["assets/pt_PT-65a41842.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["ro-ro",()=>be(()=>import("./ro_RO-15e90e9f.js"),["assets/ro_RO-15e90e9f.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.r)],["ru-ru",()=>be(()=>import("./ru_RU-a74d21e5.js"),["assets/ru_RU-a74d21e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.r)],["sk-sk",()=>be(()=>import("./sk_SK-a928dbd1.js"),["assets/sk_SK-a928dbd1.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sl-sl",()=>be(()=>import("./sl_SL-1a3c3078.js"),["assets/sl_SL-1a3c3078.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sr-rs",()=>be(()=>import("./sr_RS-0b18b911.js"),["assets/sr_RS-0b18b911.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sv-se",()=>be(()=>import("./sv_SE-ce7e3f84.js"),["assets/sv_SE-ce7e3f84.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["th-th",()=>be(()=>import("./th_TH-1448f333.js"),["assets/th_TH-1448f333.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.t)],["tr-tr",()=>be(()=>import("./tr_TR-dd92f630.js"),["assets/tr_TR-dd92f630.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.t)],["uk-ua",()=>be(()=>import("./uk_UA-fe4434ed.js"),["assets/uk_UA-fe4434ed.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.u)],["vi-vn",()=>be(()=>import("./vi_VN-41938633.js"),["assets/vi_VN-41938633.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.v)],["zh-cn",()=>be(()=>import("./zh_Hans-524a1291.js"),["assets/zh_Hans-524a1291.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)],["zh-hk",()=>be(()=>import("./zh_Hant-0e1f08e5.js"),["assets/zh_Hant-0e1f08e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)],["zh-tw",()=>be(()=>import("./zh_Hant-0e1f08e5.js"),["assets/zh_Hant-0e1f08e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)]]);function smt(t){const e=t.split("-")[0].toLowerCase();let r=null;for(const i of pue.keys())if(i.startsWith(e)){r=i;break}return r}function omt(t){return t?pue.has(t.toLowerCase())?t.toLowerCase():smt(t)||pye:pye}let qE=null,pI=null;async function amt(t=yu()){if(t=omt(t),qE&&t===pI)return qE;qE=be(()=>import("./index-a1a574a3.js"),["assets/index-a1a574a3.js","assets/_commonjsHelpers-2f3e7994.js"]).then(e=>e.i),pI=t;try{const[e,r]=await Promise.all([qE,pue.get(pI)()]);pI===t&&(e.am4core.options.defaultLocale=r.default),e.am4core.options.suppressWarnings=!0,e.am4core.options.autoDispose=!0}catch{return qE=null,pI=null,null}return qE}function lmt(t,e="default"){const r=nmt.find(i=>i.name===e);return r?r.colors.map(i=>t.color(i)):null}const Ou="esri-feature-media",Lo={base:Ou,mediaContainer:`${Ou}__container`,mediaItemContainer:`${Ou}__item-container`,mediaItem:`${Ou}__item`,mediaItemTitle:`${Ou}__item-title`,mediaItemCaption:`${Ou}__item-caption`,mediaPrevious:`${Ou}__previous`,mediaPreviousIconLTR:`${Ou}__previous-icon`,mediaPreviousIconRTL:`${Ou}__previous-icon--rtl`,mediaNext:`${Ou}__next`,mediaNextIconLTR:`${Ou}__next-icon`,mediaNextIconRTL:`${Ou}__next-icon--rtl`,mediaChart:`${Ou}__chart`,mediaButton:`${Ou}__button`,mediaIcon:`${Ou}__icon`,iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},KW=.05,eQ=.95,tQ=15,fy="color",Z1="tooltip",fI="value",fye="default-line-value";let $h=class extends Lc{constructor(e,r){super(e,r),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.viewModel=new kT,this.messages=null,this._getChartDependencies=async i=>{const n=await amt(),{destroyed:s,viewModel:o}=this;if(s||!o||!i)return;const{activeMediaInfo:a}=o,l=await this._getRendererColors(n);this._renderChart({chartDiv:i,mediaInfo:a,chartsModule:n,colorMap:l})}}initialize(){this._featureElementInfo=new hj,this.addHandles([xe(()=>{var e,r;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(r=this.viewModel)==null?void 0:r.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),Rr),xe(()=>{var e,r;return[(e=this.viewModel)==null?void 0:e.description,(r=this.viewModel)==null?void 0:r.title]},()=>this._setupFeatureElementInfo(),Rr)])}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return Ae("div",{bind:this,class:Lo.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?Ae("div",{key:"media-element-container",class:Lo.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:r}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:n}=this.viewModel,{value:s,refreshInterval:o,altText:a,title:l,type:c}=e,{sourceURL:u,linkURL:d}=s,p=O5e(d??void 0)?"_blank":"_self",A=p==="_blank"?"noreferrer":"",v=o?r:null,b=v?v.timestamp:0,S=v?v.sourceURL:u,E=Ae("img",{alt:a||l,key:`media-${c}-${i}-${n}-${b}`,src:S??void 0});return(d?Ae("a",{title:l,href:d,rel:A,target:p},E):null)||E}renderChartMediaInfo(e){const{activeMediaInfoIndex:r,formattedMediaInfoCount:i}=this.viewModel;return Ae("div",{key:`media-${e.type}-${r}-${i}`,bind:this,class:Lo.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const r=e.title?Ae("div",{key:"media-title",class:Lo.mediaItemTitle,innerHTML:e.title}):null,i=e.caption?Ae("div",{key:"media-caption",class:Lo.mediaItemCaption,innerHTML:e.caption}):null;return Ae("div",{key:"media-container",class:Lo.mediaItemContainer},Ae("div",{key:"media-item-container",class:Lo.mediaItem},this.renderMediaInfoType()),r,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const r=e==="previous",i=r?this.messages.previous:this.messages.next,n=r?this.classes(Lo.mediaButton,Lo.mediaPrevious):this.classes(Lo.mediaButton,Lo.mediaNext),s=r?this.classes(Lo.mediaIcon,Lo.mediaPreviousIconLTR,Lo.iconLeftTriangleArrow):this.classes(Lo.mediaIcon,Lo.mediaNextIconLTR,Lo.iconRightTriangleArrow),o=r?this.classes(Lo.mediaIcon,Lo.mediaPreviousIconRTL,Lo.iconRightTriangleArrow):this.classes(Lo.mediaIcon,Lo.mediaNextIconRTL,Lo.iconLeftTriangleArrow),a=r?"media-previous":"media-next",l=r?this._previous:this._next;return Ae("button",{type:"button",key:a,title:i,"aria-label":i,tabIndex:0,class:n,bind:this,onclick:l},Ae("span",{"aria-hidden":"true",class:s}),Ae("span",{"aria-hidden":"true",class:o}))}_setupFeatureElementInfo(){var i;const{description:e,title:r}=this;(i=this._featureElementInfo)==null||i.set({description:e,title:r})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){const{isAggregate:e,layer:r}=this.viewModel;return e&&(r!=null&&r.featureReduction)&&"renderer"in r.featureReduction?r.featureReduction.renderer:r==null?void 0:r.renderer}async _getRendererColors(e){const{am4core:r}=e,i=new Map,n=this._getRenderer(),s="default";if(!n)return i;const o=await Eft(n);return o.delete(s),Array.from(o.values()).every(a=>(a==null?void 0:a.length)===1)&&(i.set(fye,r.color({r:50,g:50,b:50,a:1})),Array.from(o.keys()).forEach(a=>{var l;a&&i.set(a,r.color((l=o.get(a))==null?void 0:l[0].toCss(!0)))})),i}_handleMediaKeyup(e){const r=Sb(e);r==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),r==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:r}=this.viewModel,{chartsModule:i,chartDiv:n,mediaInfo:s,colorMap:o}=e,{value:a,type:l}=s,{am4core:c}=i,u=lmt(c);function d(v){v instanceof c.ColorSet&&u&&(v.list=u)}XB()&&c.useTheme(i.am4themes_dark);const p=window.matchMedia("(prefers-reduced-motion: reduce)");r.chartAnimation&&!p.matches?c.useTheme(i.am4themes_animated):c.unuseTheme(i.am4themes_animated),c.useTheme(d);const A=l==="pie-chart"?this._createPieChart(e):this._createXYChart(e);n.setAttribute("aria-label",s.altText||s.title),A.data=a.series.map(v=>({[Z1]:v.tooltip,[fI]:v.value,[fy]:o.get(v.fieldName)})).filter(v=>l!=="pie-chart"||v.value!=null&&v.value>0)}_customizeChartTooltip(e,r){e&&(e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=r.color("#ffffff"),e.background.fill=r.color({r:0,g:0,b:0,a:.7}))}_createPieChart(e){const{chartDiv:r,chartsModule:i}=e,{am4core:n,am4charts:s}=i,o=n.create(r,s.PieChart);o.rtl=pm(this.container);const a=o.series.push(new s.PieSeries);return a.labels.template.disabled=!0,a.ticks.template.disabled=!0,a.dataFields.value=fI,a.dataFields.category=Z1,this._customizeChartTooltip(a.tooltip,n),a.slices.template.propertyFields.fill=fy,a.slices.template.propertyFields.stroke=fy,o}_getMinSeriesValue(e){let r=0;return e.forEach(i=>r=Math.min(i.value,r)),r}_createColumnChart(e,r){const{chartsModule:i,mediaInfo:n}=r,{value:s}=n,{am4core:o,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=Z1,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dy=-c.contentHeight});const u=e.yAxes.push(new a.ValueAxis),d=u.renderer.labels.template;u.renderer.minLabelPosition=KW,u.renderer.maxLabelPosition=eQ,u.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(u.tooltip,o),d.wrap=!0;const p=e.series.push(new a.ColumnSeries);p.dataFields.valueY=fI,p.dataFields.categoryX=Z1,p.columns.template.propertyFields.fill=fy,p.columns.template.propertyFields.stroke=fy,e.cursor=new a.XYCursor,s.series.length>tQ&&(e.scrollbarX=new o.Scrollbar)}_createBarChart(e,r){const{chartsModule:i,mediaInfo:n}=r,{value:s}=n,{am4core:o,am4charts:a}=i,l=e.yAxes.push(new a.CategoryAxis);l.dataFields.category=Z1,l.renderer.inversed=!0,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dx=c.contentWidth});const u=e.xAxes.push(new a.ValueAxis),d=u.renderer.labels.template;u.renderer.minLabelPosition=KW,u.renderer.maxLabelPosition=eQ,u.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(u.tooltip,o),d.wrap=!0;const p=e.series.push(new a.ColumnSeries);p.dataFields.valueX=fI,p.dataFields.categoryY=Z1,p.columns.template.propertyFields.fill=fy,p.columns.template.propertyFields.stroke=fy,e.cursor=new a.XYCursor,s.series.length>tQ&&(e.scrollbarY=new o.Scrollbar)}_createLineChart(e,r){const{chartsModule:i,mediaInfo:n,colorMap:s}=r,{value:o}=n,{am4core:a,am4charts:l}=i,c=e.xAxes.push(new l.CategoryAxis);c.dataFields.category=Z1,c.renderer.labels.template.disabled=!0;const u=c.tooltip;this._customizeChartTooltip(u,a),u.events.on("sizechanged",()=>{u.dy=-u.contentHeight});const d=e.yAxes.push(new l.ValueAxis),p=d.renderer.labels.template;d.renderer.minLabelPosition=KW,d.renderer.maxLabelPosition=eQ,d.min=this._getMinSeriesValue(o.series),this._customizeChartTooltip(d.tooltip,a),p.wrap=!0;const A=e.series.push(new l.LineSeries);A.dataFields.categoryX=Z1,A.dataFields.valueY=fI,A.strokeWidth=1;const v=s.get(fye);v&&(A.stroke=v);const b=A.bullets.push(new l.CircleBullet);b.propertyFields.fill=fy,b.propertyFields.stroke=fy,e.cursor=new l.XYCursor,o.series.length>tQ&&(e.scrollbarX=new a.Scrollbar)}_createXYChart(e){const{chartDiv:r,chartsModule:i,mediaInfo:n}=e,{type:s}=n,{am4core:o,am4charts:a}=i,l=o.create(r,a.XYChart);return l.rtl=pm(this.container),s==="column-chart"&&this._createColumnChart(l,e),s==="bar-chart"&&this._createBarChart(l,e),s==="line-chart"&&this._createLineChart(l,e),l}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const r=Date.now();this._refreshIntervalInfo={timestamp:r,sourceURL:e&&this._getImageSource(e,r)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:r,value:i}=e;if(!r)return;const n=6e4*r;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},n);this._refreshTimer=s}_getImageSource(e,r){const i=e.includes("?")?"&":"?",[n,s=""]=e.split("#");return`${n}${i}timestamp=${r}${s?"#":""}${s}`}};h([f()],$h.prototype,"attributes",null),h([f()],$h.prototype,"activeMediaInfoIndex",null),h([f()],$h.prototype,"description",null),h([f()],$h.prototype,"fieldInfoMap",null),h([f()],$h.prototype,"layer",null),h([f()],$h.prototype,"mediaInfos",null),h([f()],$h.prototype,"popupTemplate",null),h([f()],$h.prototype,"relatedInfos",null),h([f()],$h.prototype,"title",null),h([f({type:kT})],$h.prototype,"viewModel",void 0),h([f(),tc("esri/widgets/Feature/t9n/Feature")],$h.prototype,"messages",void 0),$h=h([Q("esri.widgets.Feature.FeatureMedia")],$h);const CDe=$h;var Qte;let t4=Qte=class extends Je{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new Qte({minValue:this.minValue,maxValue:this.maxValue})}};h([f({type:Number,json:{write:!0}})],t4.prototype,"minValue",void 0),h([f({type:Number,json:{write:!0}})],t4.prototype,"maxValue",void 0),t4=Qte=h([Q("esri.renderer.support.AuthoringInfoClassBreakInfo")],t4);var Yte;let fb=Yte=class extends Je{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new Yte({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:Te(this.classBreakInfos)})}};h([f({type:String,json:{write:!0}})],fb.prototype,"field",void 0),h([f({type:String,json:{write:!0}})],fb.prototype,"normalizationField",void 0),h([f({type:String,json:{write:!0}})],fb.prototype,"label",void 0),h([f({type:[t4],json:{write:!0}})],fb.prototype,"classBreakInfos",void 0),fb=Yte=h([Q("esri.renderers.support.AuthoringInfoFieldInfo")],fb);var Xte;const N6=new Hi({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),F6=new Hi({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),mye={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},gye=["high-to-low","above-and-below","centered-on","extremes"],Aye=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],yye=["seconds","minutes","hours","days","months","years"];let Dh=Xte=class extends Je{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new Xte({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};h([f({types:mye,json:{write:!0}})],Dh.prototype,"endTime",void 0),h([Wr("endTime")],Dh.prototype,"castEndTime",null),h([f({type:String,json:{write:!0}})],Dh.prototype,"field",void 0),h([f({type:Number,json:{write:!0}})],Dh.prototype,"maxSliderValue",void 0),h([f({type:Number,json:{write:!0}})],Dh.prototype,"minSliderValue",void 0),h([f({types:mye,json:{write:!0}})],Dh.prototype,"startTime",void 0),h([Wr("startTime")],Dh.prototype,"castStartTime",null),h([f({type:N6.apiValues,value:null,json:{type:N6.jsonValues,read:N6.read,write:N6.write}})],Dh.prototype,"style",null),h([f({type:Aye,value:null,json:{type:Aye,origins:{"web-scene":{type:gye,write:{writer:(t,e)=>{gye.includes(t)&&(e.theme=t)}}}},write:!0}})],Dh.prototype,"theme",null),h([f({type:F6.apiValues,json:{type:F6.jsonValues,read:F6.read,write:F6.write}})],Dh.prototype,"type",void 0),h([f({type:yye,json:{type:yye,write:!0}})],Dh.prototype,"units",void 0),Dh=Xte=h([Q("esri.renderers.support.AuthoringInfoVisualVariable")],Dh);const cmt=Dh;let Ak=class extends Je{constructor(e){super(e),this.type=null}};h([f({readOnly:!0,json:{read:!1,write:!0}})],Ak.prototype,"type",void 0),Ak=h([Q("esri.rest.support.ColorRamp")],Ak);const fue=Ak;var Zte;let Ix=Zte=class extends fue{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new Zte({fromColor:Te(this.fromColor),toColor:Te(this.toColor),algorithm:this.algorithm})}};h([nr({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],Ix.prototype,"algorithm",void 0),h([f({type:$t,json:{type:[ds],write:!0}})],Ix.prototype,"fromColor",void 0),h([f({type:$t,json:{type:[ds],write:!0}})],Ix.prototype,"toColor",void 0),h([f({type:["algorithmic"]})],Ix.prototype,"type",void 0),Ix=Zte=h([Q("esri.rest.support.AlgorithmicColorRamp")],Ix);const mue=Ix;var Jte;let r4=Jte=class extends fue{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new Jte({colorRamps:Te(this.colorRamps)})}};h([f({type:[mue],json:{write:!0}})],r4.prototype,"colorRamps",void 0),h([f({type:["multipart"]})],r4.prototype,"type",void 0),r4=Jte=h([Q("esri.rest.support.MultipartColorRamp")],r4);const MDe=r4,umt={key:"type",base:fue,typeMap:{algorithmic:mue,multipart:MDe}};function hmt(t){return t&&t.type?t.type==="algorithmic"?mue.fromJSON(t):t.type==="multipart"?MDe.fromJSON(t):null:null}var Kte;const Tw=new Hi({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),k6=new Hi({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),_ye=new Hi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),vye=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],dmt=["high-to-low","above-and-below","above","below","90-10"],pmt=["flow-line","wave-front"],fmt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let No=Kte=class extends Je{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?hmt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new Kte({classificationMethod:this.classificationMethod,colorRamp:Te(this.colorRamp),fadeRatio:Te(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:Te(this.field1),field2:Te(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};h([f({type:Tw.apiValues,value:null,json:{type:Tw.jsonValues,read:Tw.read,write:Tw.write,origins:{"web-document":{default:"manual",type:Tw.jsonValues,read:Tw.read,write:Tw.write}}}})],No.prototype,"classificationMethod",null),h([f({types:umt,json:{write:!0}})],No.prototype,"colorRamp",void 0),h([gt("colorRamp")],No.prototype,"readColorRamp",null),h([f({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],No.prototype,"fadeRatio",void 0),h([f({type:[String],value:null,json:{write:!0}})],No.prototype,"fields",null),h([f({type:fb,value:null,json:{write:!0}})],No.prototype,"field1",null),h([f({type:fb,value:null,json:{write:!0}})],No.prototype,"field2",null),h([f({type:pmt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],No.prototype,"flowTheme",null),h([f({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],No.prototype,"focus",null),h([f({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],No.prototype,"isAutoGenerated",void 0),h([f({type:Number,value:null,json:{type:ds,write:!0}})],No.prototype,"numClasses",null),h([f({type:vye,json:{type:vye,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],No.prototype,"lengthUnit",void 0),h([f({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],No.prototype,"maxSliderValue",void 0),h([f({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],No.prototype,"minSliderValue",void 0),h([f({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],No.prototype,"statistics",null),h([f({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],No.prototype,"standardDeviationInterval",null),h([f({type:k6.apiValues,value:null,json:{type:k6.jsonValues,read:k6.read,write:k6.write,origins:{"web-scene":{type:_ye.jsonValues,write:{writer:_ye.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],No.prototype,"type",null),h([f({type:[cmt],json:{write:!0}})],No.prototype,"visualVariables",void 0),h([f({type:fmt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],No.prototype,"univariateSymbolStyle",null),h([f({type:dmt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],No.prototype,"univariateTheme",null),No=Kte=h([Q("esri.renderers.support.AuthoringInfo")],No);const gue=No,rQ=new Hi({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let i4=class extends Je{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const r=new Set;return await this.collectRequiredFields(r,e),Array.from(r).sort()}getSymbol(e,r){}async getSymbolAsync(e,r){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};h([f({type:gue,json:{write:!0}})],i4.prototype,"authoringInfo",void 0),h([f({type:rQ.apiValues,readOnly:!0,json:{type:rQ.jsonValues,read:!1,write:{writer:rQ.write,ignoreOrigin:!0}}})],i4.prototype,"type",void 0),i4=h([Q("esri.renderers.Renderer")],i4);const w1=i4;function mmt(t){var e,r;return((r=(e=t.match(gmt))==null?void 0:e[1])==null?void 0:r.replace(/\\'/g,"'"))??null}const gmt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var ere;let tR=ere=class extends Je{constructor(){super(...arguments),this.title=null}clone(){return new ere({title:this.title})}};h([f({type:String,json:{write:!0}})],tR.prototype,"title",void 0),tR=ere=h([Q("esri.renderers.support.LegendOptions")],tR);var tre;let yk=tre=class extends tR{constructor(){super(...arguments),this.showLegend=null}clone(){return new tre({title:this.title,showLegend:this.showLegend})}};h([f({type:Boolean,json:{write:!0}})],yk.prototype,"showLegend",void 0),yk=tre=h([Q("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],yk);const RDe=yk,iQ=new Hi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let O0=class extends Je{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(we.getLogger(this.declaredClass).error(".field: field must be a string value"),null):bN(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};h([f()],O0.prototype,"index",void 0),h([f({type:iQ.apiValues,readOnly:!0,json:{read:iQ.read,write:iQ.write}})],O0.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],O0.prototype,"field",void 0),h([Wr("field")],O0.prototype,"castField",null),h([f({type:String,json:{write:!0}})],O0.prototype,"valueExpression",void 0),h([f({type:String,json:{write:!0}})],O0.prototype,"valueExpressionTitle",void 0),h([f({readOnly:!0})],O0.prototype,"arcadeRequired",null),h([f({type:RDe,json:{write:!0}})],O0.prototype,"legendOptions",void 0),O0=h([Q("esri.renderers.visualVariables.VisualVariable")],O0);const jN=O0;var rre;let $x=rre=class extends jN{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new rre({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};h([f({readOnly:!0})],$x.prototype,"cache",null),h([f({type:["color"],json:{type:["colorInfo"]}})],$x.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],$x.prototype,"normalizationField",void 0),h([f({type:[gpt],json:{write:!0}})],$x.prototype,"stops",null),$x=rre=h([Q("esri.renderers.visualVariables.ColorVariable")],$x);const ODe=$x;var ire;let jv=ire=class extends Je{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return UD(e.transparency)}writeOpacity(t,e,r){e[r]=MG(t)}clone(){return new ire({label:this.label,opacity:this.opacity,value:this.value})}};h([f({type:String,json:{write:!0}})],jv.prototype,"label",void 0),h([f({type:Number,json:{type:ds,write:{target:"transparency"}}})],jv.prototype,"opacity",void 0),h([gt("opacity",["transparency"])],jv.prototype,"readOpacity",null),h([Ct("opacity")],jv.prototype,"writeOpacity",null),h([f({type:Number,json:{write:!0}})],jv.prototype,"value",void 0),jv=ire=h([Q("esri.renderers.visualVariables.support.OpacityStop")],jv);const Amt=jv;var nre;let Dx=nre=class extends jN{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new nre({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};h([f({readOnly:!0})],Dx.prototype,"cache",null),h([f({type:["opacity"],json:{type:["transparencyInfo"]}})],Dx.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],Dx.prototype,"normalizationField",void 0),h([f({type:[Amt],json:{write:!0}})],Dx.prototype,"stops",null),Dx=nre=h([Q("esri.renderers.visualVariables.OpacityVariable")],Dx);const PDe=Dx;var sre;let Hy=sre=class extends jN{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,r,i){if(i&&i.messages){const n=`visualVariables[${this.index}]`;i.messages.push(new pe("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpressionTitle",context:i}))}}clone(){return new sre({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};h([f({readOnly:!0})],Hy.prototype,"cache",null),h([f({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Hy.prototype,"axis",void 0),h([f({type:["rotation"],json:{type:["rotationInfo"]}})],Hy.prototype,"type",void 0),h([f({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Hy.prototype,"rotationType",void 0),h([f({type:String,json:{write:!0}})],Hy.prototype,"valueExpressionTitle",void 0),h([Ct("web-scene","valueExpressionTitle")],Hy.prototype,"writeValueExpressionTitleWebScene",null),Hy=sre=h([Q("esri.renderers.visualVariables.RotationVariable")],Hy);const IDe=Hy;var ore;let _C=ore=class extends Je{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new ore({label:this.label,size:this.size,value:this.value})}};h([f({type:String,json:{write:!0}})],_C.prototype,"label",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],_C.prototype,"size",void 0),h([f({type:Number,json:{write:!0}})],_C.prototype,"value",void 0),_C=ore=h([Q("esri.renderers.visualVariables.support.SizeStop")],_C);const vC=_C;var are;let _k=are=class extends RDe{constructor(){super(...arguments),this.customValues=null}clone(){return new are({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};h([f({type:[Number],json:{write:!0}})],_k.prototype,"customValues",void 0),_k=are=h([Q("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],_k);const ymt=_k;var U_,bl;function Yb(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function uL(t){return t!=null&&!isNaN(t)&&isFinite(t)}function $De(t){return t.valueExpression?U_.Expression:t.field&&typeof t.field=="string"?U_.Field:U_.Unknown}function _mt(t,e){const r=e||$De(t),i=t.valueUnit||"unknown";return r===U_.Unknown?bl.Constant:t.stops?bl.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?bl.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?bl.Proportional:bl.Additive:bl.Identity:bl.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(U_||(U_={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(bl||(bl={}));const oO={inches:ra(1,"meters","inches"),feet:ra(1,"meters","feet"),"us-feet":ra(1,"meters","us-feet"),yards:ra(1,"meters","yards"),miles:ra(1,"meters","miles"),"nautical-miles":ra(1,"meters","nautical-miles"),millimeters:ra(1,"meters","millimeters"),centimeters:ra(1,"meters","centimeters"),decimeters:ra(1,"meters","decimeters"),meters:ra(1,"meters","meters"),kilometers:ra(1,"meters","kilometers"),"decimal-degrees":1/ztt(1,"meters",yi.radius)},$2=we.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),bye=new Pl,vk=Math.PI,DDe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function LDe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(v=>v.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void $2.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n=typeof e=="number",s=n?null:e,o=s&&s.attributes;let a=n?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let d=i.cache.compiledFunc;if(!l&&!u){const v=i.stops;return v&&v[0]&&v[0].color}if(typeof a!="number")if(u){if(k(r)||k(r.arcade))return void $2.error("Use of arcade expressions requires an arcade context");const v={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},b=r.arcade.arcadeUtils,S=b.getViewInfo(v),E=b.createExecContext(s,S);if(!d){const R=b.createSyntaxTree(i.valueExpression);d=b.createFunction(R),i.cache.compiledFunc=d}a=b.executeFunction(d,E)}else o&&(a=o[l]);const p=i.normalizationField,A=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||n||!isNaN(A)&&A!==0)){isNaN(A)||n||(a/=A);const v=yue(a,c);if(v){const b=v[0],S=v[1],E=b===S?i.stops[b].color:$t.blendColors(i.stops[b].color,i.stops[S].color,v[2],M(r)?r.color:void 0);return new $t(E)}}}function NDe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(v=>v.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void $2.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n=typeof e=="number",s=n?null:e,o=s&&s.attributes;let a=n?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let d=i.cache.compiledFunc;if(!l&&!u){const v=i.stops;return v&&v[0]&&v[0].opacity}if(typeof a!="number")if(u){if(k(r)||k(r.arcade))return void $2.error("Use of arcade expressions requires an arcade context");const v={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},b=r.arcade.arcadeUtils,S=b.getViewInfo(v),E=b.createExecContext(s,S);if(!d){const R=b.createSyntaxTree(i.valueExpression);d=b.createFunction(R),i.cache.compiledFunc=d}a=b.executeFunction(d,E)}else o&&(a=o[l]);const p=i.normalizationField,A=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||n||!isNaN(A)&&A!==0)){isNaN(A)||n||(a/=A);const v=yue(a,c);if(v){const b=v[0],S=v[1];if(b===S)return i.stops[b].opacity;{const E=i.stops[b].opacity;return E+(i.stops[S].opacity-E)*v[2]}}}}function FDe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(A=>A.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void $2.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=i.axis||"heading",s=n==="heading"&&i.rotationType==="arithmetic"?90:0,o=n==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=i.field,{hasExpression:u}=i.cache;let d=i.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if(k(r)||k(r.arcade))return void $2.error("Use of arcade expressions requires an arcade context");const A={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},v=r.arcade.arcadeUtils,b=v.getViewInfo(A),S=v.createExecContext(a,b);if(!d){const E=v.createSyntaxTree(i.valueExpression);d=v.createFunction(E),i.cache.compiledFunc=d}p=v.executeFunction(d,S)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:s+o*p,p}function vmt(t,e,r){const i=typeof e=="number",n=i?null:e,s=n&&n.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=M(r)?r.scale:void 0,d=M(r)?r.view:void 0;o=u==null||d==="3d"?bmt(t):u}else if(!i)switch(t.inputValueType){case U_.Expression:{if(k(r)||k(r.arcade))return void $2.error("Use of arcade expressions requires an arcade context");const u={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},d=r.arcade.arcadeUtils,p=d.getViewInfo(u),A=d.createExecContext(n,p);if(!l){const v=d.createSyntaxTree(t.valueExpression);l=d.createFunction(v),t.cache.compiledFunc=l}o=d.executeFunction(l,A);break}case U_.Field:s&&(o=s[t.field]);break;case U_.Unknown:o=null}if(!uL(o))return null;if(i||!t.normalizationField)return o;const c=s?parseFloat(s[t.normalizationField]):null;return uL(c)&&c!==0?o/c:null}function bmt(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function Aj(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(s=>s.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void $2.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=UDe(vmt(i,e,r),i,e,r,i.cache.ipData);return n==null||isNaN(n)?0:n}function dd(t,e,r){return t==null?null:Yb(t)?Aj(t,e,r):uL(t)?t:null}function kDe(t,e,r){return uL(r)&&t>r?r:uL(e)&&t<e?e:t}function wmt(t,e,r,i){return t+((dd(e.minSize,r,i)||e.minDataValue)??0)}function xmt(t,e,r){const i=t.stops;let n=i&&i.length&&i[0].size;return n==null&&(n=t.minSize),dd(n,e,r)}function Tmt(t,e,r,i){const n=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=dd(e.minSize,r,i),o=dd(e.maxSize,r,i),a=M(i)?i.shape:void 0;if(t<=e.minDataValue)return s;if(t>=e.maxDataValue)return o;if(s==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?vk*(s/2)**2:s*s,u=c+n*((l?vk*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/vk):Math.sqrt(u)}return s+n*(o-s)}function Smt(t,e,r,i){const n=M(i)?i.shape:void 0,s=t/e.minDataValue,o=dd(e.minSize,r,i),a=dd(e.maxSize,r,i);let l=null;return l=n==="circle"?2*Math.sqrt(s*(o/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*o**2):s*o,kDe(l,o,a)}function Emt(t,e,r,i,n){var l,c,u;const[s,o,a]=yue(t,n);if(s===o)return dd((l=e.stops)==null?void 0:l[s].size,r,i);{const d=dd((c=e.stops)==null?void 0:c[s].size,r,i);return d+(dd((u=e.stops)==null?void 0:u[o].size,r,i)-d)*a}}function Cmt(t,e,r,i){const n=(M(i)&&i.resolution?i.resolution:1)*oO[e.valueUnit],s=dd(e.minSize,r,i),o=dd(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/vk)/n:a==="radius"||a==="distance"?2*t/n:t/n,kDe(l,s,o)}function UDe(t,e,r,i,n){switch(e.transformationType){case bl.Additive:return wmt(t,e,r,i);case bl.Constant:return xmt(e,r,i);case bl.ClampedLinear:return Tmt(t,e,r,i);case bl.Proportional:return Smt(t,e,r,i);case bl.Stops:return Emt(t,e,r,i,n);case bl.RealWorldSize:return Cmt(t,e,r,i);case bl.Identity:return t;case bl.Unknown:return null}}function Mmt(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const n={scale:e,view:r};let s=dd(t.minSize,bye,n),o=dd(t.maxSize,bye,n);if(s!=null||o!=null){if(s>o){const a=o;o=s,s=a}return{minSize:s,maxSize:o}}}function Aue(t,e,r){if(!t.visualVariables)return;const i=[],n=[],s=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return n.forEach(l=>{const c=LDe(l,e,r);i.push({variable:l,value:c})}),s.forEach(l=>{const c=NDe(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=FDe(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=Aj(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function yue(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((n,s)=>t<n?(i=s,!0):(r=s,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function Rmt(t,e,r){const i=["proportional","proportional","proportional"];for(const n of t){const s=n.useSymbolValue?"symbol-value":Aj(n,e,r);switch(n.axis){case"width":i[0]=s;break;case"depth":i[1]=s;break;case"height":i[2]=s;break;case"width-and-depth":i[0]=s,i[1]=s;break;case"all":case void 0:case null:i[0]=s,i[1]=s,i[2]=s;break;default:n.axis}}return i}const _ue=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Rmt,getColor:LDe,getOpacity:NDe,getRotationAngle:FDe,getSize:Aj,getSizeForValue:UDe,getSizeFromNumberOrVariable:dd,getSizeRangeAtScale:Mmt,getVisualVariableValues:Aue,viewScaleRE:DDe},Symbol.toStringTag,{value:"Module"}));var lre;const U6=new Hi({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),cre=new Hi({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function wye(t){if(t!=null)return typeof t=="string"||typeof t=="number"?Tn(t):t.type==="size"?Yb(t)?t:(delete(t={...t}).type,new Ln(t)):void 0}function xye(t,e,r){if(typeof t!="object")return t;const i=new Ln;return i.read(t,r),i}let Ln=lre=class extends jN{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&DDe.test(this.valueExpression)}}set expression(t){we.getLogger(this.declaredClass).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){Yb(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),Yb(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return $De(this)}set maxDataValue(t){t&&this.stops&&(we.getLogger(this.declaredClass).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(we.getLogger(this.declaredClass).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return wye(t)}readMaxSize(t,e,r){return xye(t,e,r)}set minDataValue(t){t&&this.stops&&(we.getLogger(this.declaredClass).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(we.getLogger(this.declaredClass).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return wye(t)}readMinSize(t,e,r){return xye(t,e,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value):t&&(we.getLogger(this.declaredClass).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return _mt(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,r,i){if(t==="$view.scale"){if(i&&i.messages){const n=this.index,s=typeof n=="string"?n:`visualVariables[${n}]`;i.messages.push(new pe("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpression",context:i}))}}else e[r]=t}readValueUnit(t){return t?cre.read(t):null}clone(){return new lre({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Yb(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Yb(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===bl.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===bl.Stops){const t=this.stops;if(!t)return this;const e=t.map(i=>i.size).reverse(),r=t.length;for(let i=0;i<r;i++)t[i].size=e[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};h([f({readOnly:!0})],Ln.prototype,"cache",null),h([f({type:U6.apiValues,json:{type:U6.jsonValues,origins:{"web-map":{read:!1}},read:U6.read,write:U6.write}})],Ln.prototype,"axis",void 0),h([f({type:String,value:null,json:{read:!1}})],Ln.prototype,"expression",null),h([f()],Ln.prototype,"index",null),h([f({type:String,readOnly:!0})],Ln.prototype,"inputValueType",null),h([f({type:ymt,json:{write:!0}})],Ln.prototype,"legendOptions",void 0),h([f({type:Number,value:null,json:{write:!0}})],Ln.prototype,"maxDataValue",null),h([f({type:Number,value:null,json:{write:!0}})],Ln.prototype,"maxSize",null),h([Wr("maxSize")],Ln.prototype,"castMaxSize",null),h([gt("maxSize")],Ln.prototype,"readMaxSize",null),h([f({type:Number,value:null,json:{write:!0}})],Ln.prototype,"minDataValue",null),h([f({type:Number,value:null,json:{write:!0}})],Ln.prototype,"minSize",null),h([Wr("minSize")],Ln.prototype,"castMinSize",null),h([gt("minSize")],Ln.prototype,"readMinSize",null),h([f({type:String,json:{write:!0}})],Ln.prototype,"normalizationField",void 0),h([f({readOnly:!0})],Ln.prototype,"arcadeRequired",null),h([f({type:String})],Ln.prototype,"scaleBy",void 0),h([f({type:[vC],value:null,json:{write:!0}})],Ln.prototype,"stops",null),h([f({type:["outline"],json:{write:!0}})],Ln.prototype,"target",void 0),h([f({type:String,readOnly:!0})],Ln.prototype,"transformationType",null),h([f({type:["size"],json:{type:["sizeInfo"]}})],Ln.prototype,"type",void 0),h([f({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Ln.prototype,"useSymbolValue",void 0),h([f({type:String,json:{write:!0}})],Ln.prototype,"valueExpression",void 0),h([gt("valueExpression",["valueExpression","expression"])],Ln.prototype,"readValueExpression",null),h([Ct("web-scene","valueExpression")],Ln.prototype,"writeValueExpressionWebScene",null),h([f({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Ln.prototype,"valueRepresentation",void 0),h([f({type:cre.apiValues,json:{write:cre.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Ln.prototype,"valueUnit",void 0),h([gt("valueUnit")],Ln.prototype,"readValueUnit",null),Ln=lre=h([Q("esri.renderers.visualVariables.SizeVariable")],Ln);const yj=Ln,Omt={color:ODe,size:yj,opacity:PDe,rotation:IDe},Pmt=new Hi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),Imt=/^\[([^\]]+)\]$/i;let bk=class extends rt{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(r=>!!r))&&e.length){for(const r of e)switch(r.type){case"color":this.colorVariables.push(r);break;case"opacity":this.opacityVariables.push(r);break;case"rotation":this.rotationVariables.push(r);break;case"size":this.sizeVariables.push(r)}this.sizeVariables.length&&this.sizeVariables.some(r=>!!r.target)&&e.sort((r,i)=>{let n=null;return n=r.target===i.target?0:r.target?1:-1,n});for(let r=0;r<e.length;r++)e[r].index=r;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,r,i){const{rotationExpression:n,rotationType:s}=r,o=n&&n.match(Imt),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:a})),e)return e.map(l=>{const c=Pmt.read(l.type),u=Omt[c];u||(we.getLogger(this.declaredClass).warn(`Unknown variable type: ${c}`),i&&i.messages&&i.messages.push(new IA("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:i})));const d=new u;return d.read(l,i),d})}writeVariables(e,r){const i=[];for(const n of e){const s=n.toJSON(r);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};h([f()],bk.prototype,"visualVariables",null),bk=h([Q("esri.renderers.visualVariables.VisualVariableFactory")],bk);const $mt=bk,Dmt={base:jN,key:"type",typeMap:{opacity:PDe,color:ODe,rotation:IDe,size:yj}},lP=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new $mt}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,n){return this._vvFactory.readVariables(r,i,n)}writeVisualVariables(r,i,n,s){i[n]=this._vvFactory.writeVariables(r,s)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const n=this.visualVariables;return n?n.filter(s=>s.type===r&&(typeof i=="string"?s.target===i:i!==!1||!s.target)):[]}async collectVVRequiredFields(r,i){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const s of n)s&&(s.field&&mp(r,i,s.field),s.normalizationField&&mp(r,i,s.normalizationField),s.valueExpression&&(Lmt(s.valueExpression,r,i)||await gh(r,i,s.valueExpression)))}};return h([f({types:[Dmt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),h([gt("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),h([Ct("visualVariables")],e.prototype,"writeVisualVariables",null),e=h([Q("esri.renderers.mixins.VisualVariablesMixin")],e),e};function Lmt(t,e,r){const i=mmt(t);return!!M(i)&&(mp(e,r,i),!0)}const mI={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function Nmt(t,e=mI){var a,l;if(!t)return{symbol:null};const{retainId:r=mI.retainId,ignoreDrivers:i=mI.ignoreDrivers,hasLabelingContext:n=mI.hasLabelingContext,retainCIM:s=mI.retainCIM}=e;let o=null;if(XR(t)||t instanceof yE)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new pe("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=s?t.clone():Vb.fromCIMSymbol(t)}else if(t instanceof i0)o=BG.fromSimpleLineSymbol(t);else if(t instanceof nw)o=Vb.fromSimpleMarkerSymbol(t);else if(t instanceof IN)o=Vb.fromPictureMarkerSymbol(t);else if(t instanceof iw)o=e.geometryType&&e.geometryType==="mesh"?zG.fromSimpleFillSymbol(t):$N.fromSimpleFillSymbol(t);else{if(!(t instanceof rP))return{error:new pe("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=n?UG.fromTextSymbol(t):Vb.fromTextSymbol(t)}if(r&&o&&o.type!=="cim"&&(o.id=t.id),i&&XR(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}function ZB(t,e,r,i){const n=BDe(t,{},{context:i,isLabelSymbol:!1});M(n)&&(e[r]=n)}function Tye(t,e,r,i){const n=BDe(t,{},{context:i,isLabelSymbol:!0});M(n)&&(e[r]=n)}function Sye(t){return t instanceof tP||t instanceof yE}function BDe(t,e,r){if(k(t))return null;const{context:i,isLabelSymbol:n}=r,s=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(s==="web-scene"&&!Sye(t)){const a=Nmt(t,{retainCIM:!0,hasLabelingContext:n});return M(a.symbol)?a.symbol.write(e,i):(o==null||o.push(new pe("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(s==="web-map"||s==="portal-item"&&!$Oe(i==null?void 0:i.layer))&&Sye(t)?(o==null||o.push(new pe("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function alr(t,e){return Rot(t,null,e)}const cP={types:GG,json:{write:{writer:ZB},origins:{"web-scene":{types:Ege,write:{writer:ZB},read:{reader:J2({types:Ege})}}}}},zDe={types:{base:vd,key:"type",typeMap:{"simple-fill":ZT.typeMap["simple-fill"],"picture-fill":ZT.typeMap["picture-fill"],"polygon-3d":ZT.typeMap["polygon-3d"]}},json:{write:{writer:ZB},origins:{"web-scene":{type:$N,write:{writer:ZB}}}}},wk={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var ure;let Hv=ure=class extends Je{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new ure({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};h([f({type:String,json:{write:!0}})],Hv.prototype,"description",void 0),h([f({type:String,json:{write:!0}})],Hv.prototype,"label",void 0),h([f({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],Hv.prototype,"minValue",void 0),h([f({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],Hv.prototype,"maxValue",void 0),h([f(cP)],Hv.prototype,"symbol",void 0),Hv=ure=h([Q("esri.renderers.support.ClassBreakInfo")],Hv);const JB=Hv;var hre;const VDe="log",xk="percent-of-total",Tk="field",B6=new Hi({esriNormalizeByLog:VDe,esriNormalizeByPercentOfTotal:xk,esriNormalizeByField:Tk}),Fmt=Go(JB);let Ua=hre=class extends lP(w1){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,r){if(!Array.isArray(t))return;let i=e.minValue;return t.map(n=>{const s=new JB;return s.read(n,r),s.minValue==null&&(s.minValue=i),s.maxValue==null&&(s.maxValue=s.minValue),i=s.maxValue,s})}writeClassBreakInfos(t,e,r,i){const n=t.map(s=>s.write({},i));this._areClassBreaksConsecutive()&&n.forEach(s=>delete s.classMinValue),e[r]=n}castField(t){return t==null?t:typeof t=="function"?(we.getLogger(this.declaredClass).error(".field: field must be a string value"),null):bN(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,r=this.normalizationTotal!=null;return e||r?(t=e&&Tk||r&&xk||null,e&&r&&we.getLogger(this.declaredClass).warn("warning: both normalizationField and normalizationTotal are set!")):t!==Tk&&t!==xk||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,r){let i=null;i=typeof t=="number"?new JB({minValue:t,maxValue:e,symbol:FIe(r)}):Fmt(Te(t)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const n=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(n[0]===t&&n[1]===e){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(t,e){return this.valueExpression&&(k(e)||k(e.arcade))&&we.getLogger(this.declaredClass).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let r=e;this.valueExpression&&(k(e)||k(e.arcade))&&(r={...r,arcade:await DA()});const i=this.getBreakIndex(t,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(t,e){if(this.valueExpression&&(k(e)||k(e.arcade)))return void we.getLogger(this.declaredClass).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(t,e);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(k(e)||k(e.arcade))){const n=await DA(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),r={...r,arcade:n}}const i=this.getBreakIndex(t,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((i,n)=>i+n.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new hre({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:Te(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:Te(this.visualVariables),legendOptions:Te(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),gh(t,e,this.valueExpression)];mp(t,e,this.field),mp(t,e,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:n,arcade:s}=br(e,{}),{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=s.arcadeUtils;if(!a){const u=l.createSyntaxTree(o);a=l.createFunction(u),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:r,scale:i,spatialReference:n})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(t){const e=this.field,r=t.attributes,i=this.normalizationType;let n=parseFloat(r[e]);if(i){const s=this.normalizationTotal,o=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if(i===VDe)n=Math.log(n)*Math.LOG10E;else if(i!==xk||s==null||isNaN(s)){if(i===Tk&&!isNaN(o)){if(isNaN(n)||isNaN(o))return-1;n/=o}}else n=n/s*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=t&&(e?t<=i[1]:t<i[1]))return r}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let r=1;r<e;r++)if(t[r-1].maxValue!==t[r].minValue)return!1;return!0}};h([f(zDe)],Ua.prototype,"backgroundFillSymbol",void 0),h([f({type:[JB]})],Ua.prototype,"classBreakInfos",void 0),h([gt("classBreakInfos")],Ua.prototype,"readClassBreakInfos",null),h([Ct("classBreakInfos")],Ua.prototype,"writeClassBreakInfos",null),h([f({type:String,json:{write:!0}})],Ua.prototype,"defaultLabel",void 0),h([f(cP)],Ua.prototype,"defaultSymbol",void 0),h([f({type:String,json:{write:!0}})],Ua.prototype,"field",void 0),h([Wr("field")],Ua.prototype,"castField",null),h([f({type:Boolean})],Ua.prototype,"isMaxInclusive",void 0),h([f({type:tR,json:{write:!0}})],Ua.prototype,"legendOptions",void 0),h([f({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Ua.prototype,"minValue",null),h([f({type:String,json:{write:!0}})],Ua.prototype,"normalizationField",void 0),h([f({type:Number,cast:t=>yf(t),json:{write:!0}})],Ua.prototype,"normalizationTotal",void 0),h([f({type:B6.apiValues,value:null,json:{type:B6.jsonValues,read:B6.read,write:B6.write}})],Ua.prototype,"normalizationType",null),h([nr({classBreaks:"class-breaks"})],Ua.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],Ua.prototype,"valueExpression",void 0),h([f({type:String,json:{write:!0}})],Ua.prototype,"valueExpressionTitle",void 0),Ua=hre=h([Q("esri.renderers.ClassBreaksRenderer")],Ua);const GDe=Ua;let kmt=class{constructor(e,r){this._storage=new nue,this._storage.maxSize=e,r&&this._storage.registerRemoveFunc("",r)}put(e,r,i){this._storage.put(e,r,i,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}};const Eye="esri.renderers.support.DictionaryLoader",Umt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let vue=class{constructor(e,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new kmt(100),this._dictionaryPromise=null,this.url=e,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(A){if($o(A))return this._dictionaryPromise=null,null}const n={};if(this.fieldMap)for(const A of this._symbolFields){const v=this.fieldMap[A];if(v&&e.attributes[v]!=null){const b=""+e.attributes[v];n[A]=b}else n[A]=""}const s=i==null?void 0:i(n,r);if(!s||typeof s!="string")return null;const o=Hae(s).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=s.split(";"),c=[],u=[];for(const A of l)if(A)if(A.includes("po:")){const v=A.substr(3).split("|");if(v.length===3){const b=v[0],S=v[1];let E=v[2];if(S==="DashTemplate")E=E.split(" ").map(R=>Number(R));else if(S==="Color"){const R=new $t(E).toRgba();E=[R[0],R[1],R[2],255*R[3]]}else E=Number(E);u.push({primitiveName:b,propertyName:S,value:E})}}else if(A.includes("|")){for(const v of A.split("|"))if(this._itemNames.has(v)){c.push(v);break}}else this._itemNames.has(A)&&c.push(A);const d=!M(e.geometry)||!e.geometry.hasZ&&e.geometry.type==="point",p=this._cimPartsToCIMSymbol(c,u,d,r);return this._symbolCache.put(o,p,1),p}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void we.getLogger(Eye).error("no valid URL!");const r=ns(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:M(e)?e.signal:null}),[{data:i}]=await Promise.all([r,DA()]);if(!i)throw this._dictionaryPromise=null,new pe("esri.renderers.DictionaryRenderer","Bad dictionary data!");const n=i.expression,s=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=s.symbol;const o={};if(this.config){const c=this.config;for(const u in c)o[u]=c[u]}if(s.configuration)for(const c of s.configuration)o.hasOwnProperty(c.name)||(o[c.name]=c.value);const a=[];if(M(e)&&e.fields&&this.fieldMap)for(const c of this._symbolFields){const u=this.fieldMap[c],d=e.fields.filter(p=>p.name===u);d.length>0&&a.push({...d[0],name:c})}const l=Bnt(n,M(e)?e.spatialReference:null,a,o).then(c=>{const u={scale:0};return(d,p)=>{if(k(c))return null;const A=c.repurposeFeature({geometry:null,attributes:d});return u.scale=M(p)?p.scale??void 0:void 0,c.evaluate({$feature:A,$view:u})}}).catch(c=>(we.getLogger(Eye).error("Creating dictinoary expression failed:",c),null));return this._dictionaryPromise=l,l}async _cimPartsToCIMSymbol(e,r,i,n){const s=new Array(e.length);for(let l=0;l<e.length;l++)s[l]=this._getSymbolPart(e[l],n);const o=await Promise.all(s),a=this.fieldMap;if(a)for(const l of o)jDe(l,a);return new KO({data:this._combineSymbolParts(o,r,i)})}async _getSymbolPart(e,r){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(s=>s.data);const i=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),n=ns(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(e,n);try{return(await n).data}catch(s){throw this._ongoingRequests.delete(e),s}}_combineSymbolParts(e,r,i){if(!e||e.length===0)return null;const n={...e[0]};if(e.length>1){n.symbolLayers=[];for(const s of e){const o=s;n.symbolLayers.unshift(...o.symbolLayers)}}return i&&(n.callout=Umt),{type:"CIMSymbolReference",symbol:n,primitiveOverrides:r}}};function jDe(t,e){if(!t)return;const r=t.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const n=r[i];n&&n.enable!==!1&&n.type==="CIMVectorMarker"&&Bmt(n,e)}}function Bmt(t,e){const r=t.markerGraphics;if(r)for(const i of r){if(!i)continue;const n=i.symbol;if(n)switch(n.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":jDe(n,e);break;case"CIMTextSymbol":n.fieldMap=e}}}const ulr=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:vue},Symbol.toStringTag,{value:"Module"}));var dre;let P0=dre=class extends lP(w1){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new vue(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,r,i){i!=null&&i.origin||super.writeVisualVariables(t,e,r,i)}clone(){return new dre({config:Te(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:Te(this.fieldMap),url:Te(this.url),visualVariables:Te(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await gh(t,e,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];e.has(i)&&t.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};h([f({type:vue})],P0.prototype,"_loader",null),h([f({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],P0.prototype,"config",void 0),h([f({type:Object,json:{write:!0}})],P0.prototype,"fieldMap",void 0),h([f({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],P0.prototype,"scaleExpression",void 0),h([Ct("scaleExpression")],P0.prototype,"writeData",null),h([f({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],P0.prototype,"scaleExpressionTitle",void 0),h([f({type:String,json:{write:!0}})],P0.prototype,"url",void 0),h([Ct("visualVariables")],P0.prototype,"writeVisualVariables",null),P0=dre=h([Q("esri.renderers.DictionaryRenderer")],P0);const zmt=P0;var pre;let qy=pre=class extends Je{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(we.getLogger(this.declaredClass).error(".field: field must be a string value"),null):bN(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new pre({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};h([f({type:$t,json:{type:[Number],write:!0}})],qy.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],qy.prototype,"field",void 0),h([Wr("field")],qy.prototype,"castField",null),h([f({type:String,json:{write:!0}})],qy.prototype,"label",void 0),h([f({type:String,json:{write:!0}})],qy.prototype,"valueExpression",void 0),h([f({type:String,json:{write:!0}})],qy.prototype,"valueExpressionTitle",void 0),qy=pre=h([Q("esri.renderers.support.AttributeColorInfo")],qy);const HDe=qy;var fre;let Sk=fre=class extends Je{constructor(){super(...arguments),this.unit=null}clone(){return new fre({unit:this.unit})}};h([f({type:String,json:{write:!0}})],Sk.prototype,"unit",void 0),Sk=fre=h([Q("esri.renderers.support.DotDensityLegendOptions")],Sk);const Vmt=Sk;var mre;let Lh=mre=class extends lP(w1){constructor(t){super(t),this.attributes=null,this.backgroundColor=new $t([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new i0,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new iw({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,r)=>e+r.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new mre({attributes:Te(this.attributes),backgroundColor:Te(this.backgroundColor),dotBlendingEnabled:Te(this.dotBlendingEnabled),dotShape:Te(this.dotShape),dotSize:Te(this.dotSize),dotValue:Te(this.dotValue),legendOptions:Te(this.legendOptions),outline:Te(this.outline),referenceScale:Te(this.referenceScale),visualVariables:Te(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(r=>r.field||r.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const r of this.attributes??[])r.valueExpression&&await gh(t,e,r.valueExpression),r.field&&t.add(r.field)}};h([f({type:[HDe],json:{write:!0}})],Lh.prototype,"attributes",void 0),h([f({type:$t,json:{write:!0}})],Lh.prototype,"backgroundColor",void 0),h([f({type:Boolean,json:{write:!0}})],Lh.prototype,"dotBlendingEnabled",void 0),h([f({type:String,json:{write:!1}})],Lh.prototype,"dotShape",void 0),h([f({type:Number,json:{write:!0}})],Lh.prototype,"dotSize",void 0),h([f({type:Vmt,json:{write:!0}})],Lh.prototype,"legendOptions",void 0),h([f({type:i0,json:{default:null,write:!0}})],Lh.prototype,"outline",void 0),h([f({type:Number,json:{write:!0}})],Lh.prototype,"dotValue",void 0),h([f({type:Number,json:{write:!0}})],Lh.prototype,"referenceScale",void 0),h([f({type:Number,json:{write:!0}})],Lh.prototype,"seed",void 0),h([nr({dotDensity:"dot-density"})],Lh.prototype,"type",void 0),Lh=mre=h([Q("esri.renderers.DotDensityRenderer")],Lh);const Gmt=Lh;let bC=class extends Qs(Je){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};h([f({type:String,json:{write:!0}})],bC.prototype,"minLabel",void 0),h([f({type:String,json:{write:!0}})],bC.prototype,"maxLabel",void 0),h([f({type:String,json:{write:!0}})],bC.prototype,"title",void 0),bC=h([Q("esri.renderers.support.HeatmapLegendOptions")],bC);const bue=2.4;function jmt(t){return Wf(t*bue)}function Hmt(t){return El(t)/bue}function qmt(t,e,r,i){let{color:n,ratio:s}=e,{color:o,ratio:a}=r;a===s&&(a===1?s-=1e-6:a+=1e-6);const l=He((i-s)/(a-s),0,1);CG(t,n.toArray(),o.toArray(),l)}function dlr(t){const r=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return r;let i=t[0],n=t[0],s=1;const o=Kr();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>n.ratio&&s<t.length;)i=n,n=t[s++];qmt(o,i,n,l),r.set(o,4*a)}return r}function plr(t,e,r,i){const{radius:n,fieldOffset:s,field:o}=e,a=Math.round(El(n)),l=new Float64Array(r*i);let c,u=Number.NEGATIVE_INFINITY;const d=Qmt(o,s),p=new Set;for(const A of t){const v=A.getCursor();for(;v.next();){const b=v.getObjectId();if(p.has(b))continue;p.add(b);const S=v.readLegacyPointGeometry(),E=128;if(S.x<-E||S.x>=r+E||S.y<-E||S.y>i+E)continue;const R=+d(v),O=Math.max(0,Math.round(S.x)-a),I=Math.max(0,Math.round(S.y)-a),N=Math.min(i,Math.round(S.y)+a),L=Math.min(r,Math.round(S.x)+a);for(let B=I;B<N;B++)for(let U=O;U<L;U++){const q=B*r+U,Z=Wmt(S.x-U,S.y-B,a);c=l[q]+=Z*R,c>u&&(u=c)}}}return{matrix:l.buffer,max:u}}function Wmt(t,e,r){const i=Math.sqrt(t**2+e**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function flr(t,e){return typeof t=="function"?t:t?typeof e=="string"?r=>-1*+r[t]:r=>+r[t]+e:()=>1}function Qmt(t,e){return t!=null?typeof e=="string"?r=>-1*+r.readAttribute(t):r=>+r.readAttribute(t)+e:r=>1}var gre;const qDe="esri.renderers.HeatmapRenderer",Ymt=we.getLogger(qDe);function Cye(t){if(t!=null){const{maxDensity:e,minDensity:r,radius:i}=t;if(e!=null||r!=null||i!=null){const{blurRadius:n,maxPixelIntensity:s,minPixelIntensity:o,...a}=t;return a}}return t}let dl=gre=class extends w1{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new O5({ratio:0,color:new $t("rgba(255, 140, 0, 0)")}),new O5({ratio:.75,color:new $t("rgba(255, 140, 0, 1)")}),new O5({ratio:.9,color:new $t("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return Cye(t)}get blurRadius(){return Hmt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",jmt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(bue**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||bu(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,WO(()=>{qJ(Ymt,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=Cye(t),super.read(t,e)}getSymbol(){return new nw}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await mp(t,e,r),i&&typeof i=="string"&&await gh(t,e,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new gre({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:Te(this.colorStops),field:this.field,legendOptions:Te(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};h([f({type:gue,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],dl.prototype,"authoringInfo",void 0),h([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],dl.prototype,"blurRadius",null),h([f({type:[O5],json:{write:!0}})],dl.prototype,"colorStops",void 0),h([f({type:String,json:{write:!0}})],dl.prototype,"field",void 0),h([f({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],dl.prototype,"fieldOffset",void 0),h([f({type:bC,json:{write:!0}})],dl.prototype,"legendOptions",void 0),h([f({type:Number,json:{write:!0}})],dl.prototype,"maxDensity",void 0),h([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],dl.prototype,"maxPixelIntensity",null),h([f({type:Number,json:{write:!0}})],dl.prototype,"minDensity",void 0),h([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],dl.prototype,"minPixelIntensity",null),h([f({type:Number,cast:Tn,json:{write:!0}})],dl.prototype,"radius",void 0),h([f({type:Number,range:{min:0},json:{default:0,write:!0}})],dl.prototype,"referenceScale",void 0),h([nr({heatmap:"heatmap"})],dl.prototype,"type",void 0),h([f({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],dl.prototype,"valueExpression",void 0),h([f({type:String})],dl.prototype,"valueExpressionTitle",void 0),h([f({readOnly:!0})],dl.prototype,"_pixelIntensityToDensity",null),dl=gre=h([Q(qDe)],dl);const WDe=dl;let AT=class extends Qs(Je){constructor(){super(...arguments),this.color=new $t([0,0,0,0]),this.label=null,this.threshold=0}};h([f({type:$t,json:{write:!0}})],AT.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],AT.prototype,"label",void 0),h([f({type:Number,range:{min:0,max:1},json:{write:!0}})],AT.prototype,"threshold",void 0),AT=h([Q("esri.renderers.support.OthersCategory")],AT);let Ek=class extends Qs(Je){constructor(){super(...arguments),this.title=null}};h([f({type:String,json:{write:!0}})],Ek.prototype,"title",void 0),Ek=h([Q("esri.renderers.support.PieChartLegendOptions")],Ek);let Nd=class extends lP(Qs(w1)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new $t([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new AT,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new nw({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(M)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,r)=>e+r.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,r)=>e+JSON.stringify(r),"")}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r);for(const i of this.attributes)i.valueExpression&&await gh(e,r,i.valueExpression),i.field&&e.add(i.field)}};h([f({type:[HDe],json:{write:!0}})],Nd.prototype,"attributes",void 0),h([f({type:iw,json:{default:null,write:!0}})],Nd.prototype,"backgroundFillSymbol",void 0),h([f({type:$t,json:{write:!0}})],Nd.prototype,"defaultColor",void 0),h([f({type:String,json:{write:!0}})],Nd.prototype,"defaultLabel",void 0),h([f({type:Number,range:{min:0,max:1},json:{write:!0}})],Nd.prototype,"holePercentage",void 0),h([f({type:AT,json:{write:!0}})],Nd.prototype,"othersCategory",void 0),h([f({type:Ek,json:{write:!0}})],Nd.prototype,"legendOptions",void 0),h([f({type:i0,json:{default:null,write:!0}})],Nd.prototype,"outline",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],Nd.prototype,"size",void 0),h([nr({pieChart:"pie-chart"})],Nd.prototype,"type",void 0),Nd=h([Q("esri.renderers.PieChartRenderer")],Nd);const Xmt=Nd;var Are;let Lx=Are=class extends lP(w1){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new Are({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:Te(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};h([f({type:String,json:{write:!0}})],Lx.prototype,"description",void 0),h([f({type:String,json:{write:!0}})],Lx.prototype,"label",void 0),h([f(cP)],Lx.prototype,"symbol",void 0),h([nr({simple:"simple"})],Lx.prototype,"type",void 0),Lx=Are=h([Q("esri.renderers.SimpleRenderer")],Lx);const aO=Lx,Zmt=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function yre(t){return t instanceof rt}function Mye(t){return t instanceof ur?Object.keys(t.items):yre(t)?bu(t).keys():t?Object.keys(t):[]}function z6(t,e){return t instanceof ur?t.items[e]:t[e]}function Jmt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function $5(t){return t?t.declaredClass:null}function QDe(t,e){const r=t.diff;if(r&&typeof r=="function")return r(t,e);const i=Mye(t),n=Mye(e);if(i.length===0&&n.length===0)return;if(!i.length||!n.length||Jmt(t,e))return{type:"complete",oldValue:t,newValue:e};const s=n.filter(d=>!i.includes(d)),o=i.filter(d=>!n.includes(d)),a=i.filter(d=>n.includes(d)&&z6(t,d)!==z6(e,d)).concat(s,o).sort(),l=$5(t);if(l&&Zmt.includes(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const u=yre(t)&&yre(e);for(const d of a){const p=z6(t,d),A=z6(e,d);let v;if((u||typeof p!="function"&&typeof A!="function")&&p!==A&&(p!=null||A!=null)){if(r&&r[d]&&typeof r[d]=="function")v=r[d](p,A);else if(p instanceof Date&&A instanceof Date){if(p.getTime()===A.getTime())continue;v={type:"complete",oldValue:p,newValue:A}}else v=typeof p=="object"&&typeof A=="object"&&$5(p)===$5(A)?QDe(p,A):{type:"complete",oldValue:p,newValue:A};M(v)&&(M(c)?c.diff[d]=v:c={type:"partial",diff:{[d]:v}})}}return c}function Kmt(t,e){if(k(t))return!1;const r=e.split(".");let i=t;for(const n of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const s=i.diff[n];if(!s)return!1;i=s}}return!0}function ylr(t,e){for(const r of e)if(Kmt(t,r))return!0;return!1}function egt(t,e){if(!(typeof t=="function"||typeof e=="function"||k(t)&&k(e)))return k(t)||k(e)||typeof t=="object"&&typeof e=="object"&&$5(t)!==$5(e)?{type:"complete",oldValue:t,newValue:e}:QDe(t,e)}function V6(t){if(k(t))return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const r of e.added)if(!V6(r))return!1;for(const r of e.removed)if(!V6(r))return!1;for(const r of e.changed)if(!V6(r))return!1;return!0}case"partial":for(const e in t.diff)if(!V6(t.diff[e]))return!1;return!0}}let wC=class extends Qs(Je){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};h([f(wk)],wC.prototype,"value",void 0),h([f(wk)],wC.prototype,"value2",void 0),h([f(wk)],wC.prototype,"value3",void 0),wC=h([Q("esri.renderers.support.UniqueValue")],wC);const rR=wC;let qv=class extends Qs(Je){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const r=typeof(e=Array.isArray(e)?e:[e])[0];return r==="string"||r==="number"?e.map(i=>new rR({value:i})):r==="object"?e[0]instanceof rR?e:e.map(i=>new rR(i)):null}};h([f({type:String,json:{write:!0}})],qv.prototype,"description",void 0),h([f({type:String,json:{write:!0}})],qv.prototype,"label",void 0),h([f(cP)],qv.prototype,"symbol",void 0),h([f({type:[rR],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new rR({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const r=[];for(const i of t){const n=[i.value,i.value2,i.value3].filter(M).map(s=>s.toString());r.push(n)}e.values=r}}}})],qv.prototype,"values",void 0),h([Wr("values")],qv.prototype,"castValues",null),qv=h([Q("esri.renderers.support.UniqueValueClass")],qv);const YDe=qv;let n4=class extends Qs(Je){constructor(e){super(e),this.heading=null,this.classes=null}};h([f({type:String,json:{write:!0}})],n4.prototype,"heading",void 0),h([f({type:[YDe],json:{write:!0}})],n4.prototype,"classes",void 0),n4=h([Q("esri.renderers.support.UniqueValueGroup")],n4);const _re=n4;var vre;let Nx=vre=class extends Je{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new vre({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${t}`}};h([f({type:String,json:{write:!0}})],Nx.prototype,"description",void 0),h([f({type:String,json:{write:!0}})],Nx.prototype,"label",void 0),h([f(cP)],Nx.prototype,"symbol",void 0),h([f(wk)],Nx.prototype,"value",void 0),Nx=vre=h([Q("esri.renderers.support.UniqueValueInfo")],Nx);const D5=Nx,tgt=()=>!!Fe("enable-feature:force-wosr"),wlr=()=>!!Fe("enable-feature:direct-3d-object-feature-layer-display"),xlr=()=>!!Fe("enable-feature:SceneLayer-editing");let nQ={};async function rgt(t,e){try{return{data:(await ogt(t,e)).data,baseUrl:wtt(t),styleUrl:t}}catch(r){return Jh(r),null}}function igt(t,e,r){const i=M(e.portal)?e.portal:mh.getDefault();let n;const s=`${i.url} - ${i.user&&i.user.username} - ${t}`;return nQ[s]||(nQ[s]=ngt(t,i,r).then(o=>(n=o,o.fetchData())).then(o=>({data:o,baseUrl:n.itemUrl??"",styleName:t}))),nQ[s]}function ngt(t,e,r){return e.load(r).then(()=>{const i=new v_({disableExtraQuery:!0,query:`owner:${Rye} AND type:${Oye} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{var o;let n=null;const s=t.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===s))&&a.type===Oye&&a.owner===Rye){n=a;break}}if(!n)throw new pe("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(r)})}function sgt(t,e,r){return t&&M(t.styleUrl)?rgt(t.styleUrl,r):t&&M(t.styleName)?igt(t.styleName,e,r):Promise.reject(new pe("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function Tlr(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function Slr(t,e){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!tgt()){for(const r of t.formatInfos)if(r.type==="gltf")return r.href}return t.webRef}function ogt(t,e){const r={responseType:"json",query:{f:"json"},...e};return ns(wm(t),r)}const Rye="esri_en",Oye="Style",Elr="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var s4;const XDe="esri.renderers.UniqueValueRenderer",J1=we.getLogger(XDe),Pye="uvInfos-watcher",Iye="uvGroups-watcher",agt=",",lgt=Go(D5);function cgt(t){const{field1:e,field2:r,field3:i,fieldDelimiter:n,uniqueValueInfos:s,valueExpression:o}=t,a=!(!e||!r);return[{classes:(s??[]).map(l=>{var E;const{symbol:c,label:u,value:d,description:p}=l,[A,v,b]=a?((E=d==null?void 0:d.toString())==null?void 0:E.split(n||""))||[]:[d],S=[];return(e||o)&&S.push(A),r&&S.push(v),i&&S.push(b),{symbol:c,label:u,values:[S],description:p}})}]}let mo=s4=class extends lP(w1){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,r){if(!e&&!r)return;if(!e||!r)return{type:"complete",oldValue:e,newValue:r};let i=!1;const n={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let s=0;s<r.length;s++){const o=e.find(a=>a.value===r[s].value);o?egt(o,r[s])?(n.changed.push({type:"complete",oldValue:o,newValue:r[s]}),i=!0):n.unchanged.push({oldValue:o,newValue:r[s]}):(n.added.push(r[s]),i=!0)}for(let s=0;s<e.length;s++)r.find(o=>o.value===e[s].value)||(n.removed.push(e[s]),i=!0);return i?n:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:bN(t)}writeField(t,e,r,i){typeof t=="string"?e[r]=t:i&&i.messages?i.messages.push(new pe("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):J1.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,r){return r.portal||mh.getDefault()}readStyleOrigin(t,e,r){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const i=eP(e.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(t,e,r,i){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=RS(t.styleUrl,i))}set uniqueValueGroups(t){this.styleOrigin?J1.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?J1.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var i;if(this.styleOrigin)return void J1.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof t=="object"?lgt(t):new D5({value:t,symbol:FIe(e)}),(i=this.uniqueValueInfos)==null||i.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void J1.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e){for(let r=0;r<e.length;r++)if(e[r].value===t+""){delete this._valueInfoMap[t],e.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let r=e;return this.valueExpression&&(k(e)||k(e.arcade))&&(r={...r,arcade:await DA()}),this._getUniqueValueInfo(t,r)}getSymbol(t,e){if(this.valueExpression&&(k(e)||k(e.arcade)))return void J1.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(t,e);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(k(r)||k(r.arcade))){const n=await DA(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),r={...r,arcade:n}}const i=this._getUniqueValueInfo(t,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var i;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=(i=this.uniqueValueInfos)==null?void 0:i.reduce((n,s)=>n+s.getMeshHash(),"");return`${t}.${e}.${r}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new s4({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:Te(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:Te(this.visualVariables),legendOptions:Te(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:Te(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=Te(this.uniqueValueInfos),r=Te(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(Te(this.styleOrigin))),Object.freeze(e),Object.freeze(r)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",r),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),gh(t,e,this.valueExpression)];mp(t,e,this.field),mp(t,e,this.field2),mp(t,e,this.field3),await Promise.all(r)}populateFromStyle(){return sgt(this.styleOrigin,{portal:this.portal}).then(t=>{var r;const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(i=>{const n=new yE({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==t.data.defaultItem||(this.defaultSymbol=n,this._isDefaultSymbolDerived=!0);const s=new D5({value:i.name,symbol:n});e.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((r=this.uniqueValueInfos)!=null&&r.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",agt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Pye);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const r of t)e.push(xe(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(i,n)=>{i!==n&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,Pye)}}_watchUniqueValueGroups(){this.removeHandles(Iye);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const r of t){e.push(xe(()=>({classes:r.classes}),(i,n)=>{i!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const i of r.classes??[])e.push(xe(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(n,s)=>{n!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,Iye)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:r,field3:i,fieldDelimiter:n,uniqueValueGroups:s,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!r);for(const l of s)for(const c of l.classes??[]){const{symbol:u,label:d,values:p,description:A}=c;for(const v of p??[]){const{value:b,value2:S,value3:E}=v,R=[b];r&&R.push(S),i&&R.push(E);const O=a?R.join(n||""):R[0];t.push(new D5({symbol:u,label:d,value:O,description:A}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:r,valueExpression:i,fieldDelimiter:n,uniqueValueInfos:s}=this;if(!e&&!i||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!r),a=s.map(c=>{var E;const{symbol:u,label:d,value:p,description:A}=c,[v,b,S]=o?((E=p==null?void 0:p.toString())==null?void 0:E.split(n||""))||[]:[p];return new YDe({symbol:u,label:d,description:A,values:[new rR({value:v,value2:b,value3:S})]})}),l=[new _re({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:n,arcade:s}=br(e,{});let o=this._cache.compiledFunc;const a=s.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(t,a.getViewInfo({viewingMode:r,scale:i,spatialReference:n})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(t){const e=this.field,r=t.attributes;let i;if(typeof e!="function"&&this.field2){const n=this.field2,s=this.field3,o=[];e&&o.push(r[e]),n&&o.push(r[n]),s&&o.push(r[s]),i=o.join(this.fieldDelimiter||"")}else typeof e=="function"?i=e(t):e&&(i=r[e]);return this._valueInfoMap[i+""]}static fromPortalStyle(t,e){const r=new s4(e&&e.properties);r._set("styleOrigin",Object.freeze({styleName:t})),r._set("portal",e&&e.portal||mh.getDefault());const i=r.populateFromStyle();return i.catch(n=>{J1.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",n)}),i}static fromStyleUrl(t,e){const r=new s4(e&&e.properties);r._set("styleOrigin",Object.freeze({styleUrl:t}));const i=r.populateFromStyle();return i.catch(n=>{J1.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",n)}),i}};h([f({readOnly:!0})],mo.prototype,"_cache",null),h([nr({uniqueValue:"unique-value"})],mo.prototype,"type",void 0),h([f(zDe)],mo.prototype,"backgroundFillSymbol",void 0),h([f({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],mo.prototype,"field",null),h([Wr("field")],mo.prototype,"castField",null),h([Ct("field")],mo.prototype,"writeField",null),h([f({type:String,value:null,json:{write:!0}})],mo.prototype,"field2",null),h([f({type:String,value:null,json:{write:!0}})],mo.prototype,"field3",null),h([f({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],mo.prototype,"orderByClassesEnabled",void 0),h([f({type:String,value:null,json:{write:!0}})],mo.prototype,"valueExpression",null),h([f({type:String,json:{write:!0}})],mo.prototype,"valueExpressionTitle",void 0),h([f({type:tR,json:{write:!0}})],mo.prototype,"legendOptions",void 0),h([f({type:String,json:{write:!0}})],mo.prototype,"defaultLabel",void 0),h([f(WMe({...cP},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],mo.prototype,"defaultSymbol",null),h([f({type:String,value:null,json:{write:!0}})],mo.prototype,"fieldDelimiter",null),h([f({type:mh,readOnly:!0})],mo.prototype,"portal",void 0),h([gt("portal",["styleName"])],mo.prototype,"readPortal",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],mo.prototype,"styleOrigin",void 0),h([gt("styleOrigin",["styleName","styleUrl"])],mo.prototype,"readStyleOrigin",null),h([Ct("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],mo.prototype,"writeStyleOrigin",null),h([f({type:[_re],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,r)=>(e.uniqueValueGroups||cgt(e)).map(i=>_re.fromJSON(i,r))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],mo.prototype,"uniqueValueGroups",null),h([f({type:[D5],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],mo.prototype,"uniqueValueInfos",null),mo=s4=h([Q(XDe)],mo);const HN=mo,_j={key:"type",base:w1,typeMap:{heatmap:WDe,simple:aO,"unique-value":HN,"class-breaks":GDe,"dot-density":Gmt,dictionary:zmt,"pie-chart":Xmt},errorContext:"renderer"},ugt={key:"type",base:w1,typeMap:{simple:aO,"unique-value":HN,"class-breaks":GDe,heatmap:WDe},errorContext:"renderer"},hgt=J2({types:_j});function KB(t,e,r){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new IA("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:r})),null):hgt(t,e,r):null}let dgt=class ZDe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(jJ),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const r=new ZDe,i=this._originStores[Zi.DEFAULTS];i&&i.forEach((n,s)=>{r.set(s,Te(n),Zi.DEFAULTS)});for(let n=Zi.SERVICE;n<jJ;n++){const s=this._originStores[n];s&&s.forEach((o,a)=>{e&&e.has(a)||r.set(a,Te(o),n)})}return r}get(e,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(e):void 0}keys(e){const r=e==null?this._values:this._originStores[e];return r?[...r.keys()]:[]}set(e,r,i=Zi.USER){let n=this._originStores[i];if(n||(n=new Map,this._originStores[i]=n),n.set(e,r),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const s=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,i),s!==r}return!1}delete(e,r=Zi.USER){const i=this._originStores[r];if(!i)return;const n=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===r){this._values.delete(e);for(let s=r-1;s>=0;s--){const o=this._originStores[s];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,s);break}}}return n}has(e,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(e)}revert(e,r){for(;r>0&&!this.has(e,r);)--r;const i=this._originStores[r],n=i&&i.get(e),s=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,r),s!==n}originOf(e){return this._propertyOriginMap.get(e)||Zi.DEFAULTS}forEach(e){this._values.forEach(e)}};const JDe=t=>{let e=class extends t{constructor(...r){super(...r);const i=bu(this),n=i.store,s=new dgt;i.store=s,BRe(i,n,s)}read(r,i){VRe(this,r,i)}getAtOrigin(r,i){const n=sQ(this),s=kb(i);if(typeof r=="string")return n.get(r,s);const o={};return r.forEach(a=>{o[a]=n.get(a,s)}),o}originOf(r){return rB(this.originIdOf(r))}originIdOf(r){return sQ(this).originOf(r)}revert(r,i){const n=sQ(this),s=kb(i),o=bu(this);let a;a=typeof r=="string"?r==="*"?n.keys(s):[r]:r,a.forEach(l=>{o.invalidate(l),n.revert(l,s),o.commit(l)})}};return e=h([Q("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function sQ(t){return bu(t).store}let $ye=class extends JDe(rt){};$ye=h([Q("esri.core.ReadOnlyMultiOriginJSONSupport")],$ye);const pgt=t=>{let e=class extends t{constructor(...r){super(...r)}clear(r,i="user"){return oQ(this).delete(r,kb(i))}write(r={},i){return jRe(this,r=r||{},i),r}setAtOrigin(r,i,n){bu(this).setAtOrigin(r,i,kb(n))}removeOrigin(r){const i=oQ(this),n=kb(r),s=i.keys(n);for(const o of s)i.originOf(o)===n&&i.set(o,i.get(o,n),Zi.USER)}updateOrigin(r,i){const n=oQ(this),s=kb(i),o=this.get(r);for(let a=s+1;a<jJ;++a)n.delete(r,a);n.set(r,o,s)}toJSON(r){return this.write({},r)}};return e=h([Q("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function oQ(t){return bu(t).store}const KDe=t=>{let e=class extends pgt(JDe(t)){constructor(...r){super(...r)}};return e=h([Q("esri.core.MultiOriginJSONSupport")],e),e};let Dye=class extends KDe(rt){};Dye=h([Q("esri.core.MultiOriginJSONSupport")],Dye);async function fgt(t,e){const{WhereClause:r}=await be(()=>import("./WhereClause-3b5a65ae.js").then(i=>i.W),["assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js"]);return r.create(t,e)}function mgt(t,e){return M(t)?M(e)?`(${t}) AND (${e})`:t:e}var bre;let Fx=bre=class extends Je{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new bre({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([f({type:String,json:{write:!0}})],Fx.prototype,"expression",void 0),h([f({type:String,json:{write:!0}})],Fx.prototype,"name",void 0),h([f({type:["boolean","date","number","string"],json:{write:!0}})],Fx.prototype,"returnType",void 0),h([f({type:String,json:{write:!0}})],Fx.prototype,"title",void 0),Fx=bre=h([Q("esri.form.ExpressionInfo")],Fx);const ggt=Fx;let kx=class extends Je{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};h([f({type:String,json:{write:!0}})],kx.prototype,"description",void 0),h([f({type:String,json:{write:!0}})],kx.prototype,"label",void 0),h([f()],kx.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],kx.prototype,"visibilityExpression",void 0),kx=h([Q("esri.form.elements.Element")],kx);const lO=kx;var wre;let Ck=wre=class extends Je{constructor(t){super(t),this.type=null}clone(){return new wre({type:this.type})}};h([f({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],Ck.prototype,"type",void 0),Ck=wre=h([Q("esri.form.elements.inputs.AttachmentInput")],Ck);const Agt=Ck;var xre;let Ux=xre=class extends lO{constructor(t){super(t),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new xre({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};h([f({type:String,json:{write:!0}})],Ux.prototype,"attachmentKeyword",void 0),h([f({type:Boolean,json:{write:!0}})],Ux.prototype,"editable",void 0),h([f({type:Agt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Ux.prototype,"input",void 0),h([f({type:["attachment"],json:{read:!1,write:!0}})],Ux.prototype,"type",void 0),Ux=xre=h([Q("esri.form.elements.AttachmentElement")],Ux);const Lye=Ux;let Mk=class extends Je{constructor(e){super(e),this.type=null}};h([f()],Mk.prototype,"type",void 0),Mk=h([Q("esri.form.elements.inputs.Input")],Mk);const uP=Mk;let o4=class extends uP{constructor(e){super(e),this.maxLength=null,this.minLength=0}};h([f({type:Number,json:{write:!0}})],o4.prototype,"maxLength",void 0),h([f({type:Number,json:{write:!0}})],o4.prototype,"minLength",void 0),o4=h([Q("esri.form.elements.inputs.TextInput")],o4);const wue=o4;var Tre;let Rk=Tre=class extends wue{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new Tre({maxLength:this.maxLength,minLength:this.minLength})}};h([f({type:["barcode-scanner"],json:{read:!1,write:!0}})],Rk.prototype,"type",void 0),Rk=Tre=h([Q("esri.form.elements.inputs.BarcodeScannerInput")],Rk);const ygt=Rk;var Sre;let xC=Sre=class extends uP{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new Sre({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};h([f({type:String,json:{write:!0}})],xC.prototype,"noValueOptionLabel",void 0),h([f({type:Boolean,json:{write:!0}})],xC.prototype,"showNoValueOption",void 0),h([f({type:["combo-box"],json:{read:!1,write:!0}})],xC.prototype,"type",void 0),xC=Sre=h([Q("esri.form.elements.inputs.ComboBoxInput")],xC);const _gt=xC;var Ere;function Nye(t){return t!=null?new Date(t):null}function Fye(t){return t?t.getTime():null}let I0=Ere=class extends uP{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return Nye(e.max)}writeMax(t,e){e.max=Fye(t)}readMin(t,e){return Nye(e.min)}writeMin(t,e){e.min=Fye(t)}clone(){return new Ere({includeTime:this.includeTime,max:this.max,min:this.min})}};h([f({type:Boolean,json:{write:!0}})],I0.prototype,"includeTime",void 0),h([f({type:Date,json:{type:Number,write:!0}})],I0.prototype,"max",void 0),h([gt("max")],I0.prototype,"readMax",null),h([Ct("max")],I0.prototype,"writeMax",null),h([f({type:Date,json:{type:Number,write:!0}})],I0.prototype,"min",void 0),h([gt("min")],I0.prototype,"readMin",null),h([Ct("min")],I0.prototype,"writeMin",null),h([f({type:["datetime-picker"],json:{read:!1,write:!0}})],I0.prototype,"type",void 0),I0=Ere=h([Q("esri.form.elements.inputs.DateTimePickerInput")],I0);const vgt=I0;var Cre;let TC=Cre=class extends uP{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new Cre({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};h([f({type:String,json:{write:!0}})],TC.prototype,"noValueOptionLabel",void 0),h([f({type:Boolean,json:{write:!0}})],TC.prototype,"showNoValueOption",void 0),h([f({type:["radio-buttons"],json:{read:!1,write:!0}})],TC.prototype,"type",void 0),TC=Cre=h([Q("esri.form.elements.inputs.RadioButtonsInput")],TC);const bgt=TC;var Mre;let SC=Mre=class extends uP{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new Mre({offValue:this.offValue,onValue:this.onValue})}};h([f({type:[String,Number],json:{write:!0}})],SC.prototype,"offValue",void 0),h([f({type:[String,Number],json:{write:!0}})],SC.prototype,"onValue",void 0),h([f({type:["switch"],json:{read:!1,write:!0}})],SC.prototype,"type",void 0),SC=Mre=h([Q("esri.form.elements.inputs.SwitchInput")],SC);const wgt=SC;var Rre;let Ok=Rre=class extends wue{constructor(t){super(t),this.type="text-area"}clone(){return new Rre({maxLength:this.maxLength,minLength:this.minLength})}};h([f({type:["text-area"],json:{read:!1,write:!0}})],Ok.prototype,"type",void 0),Ok=Rre=h([Q("esri.form.elements.inputs.TextAreaInput")],Ok);const xgt=Ok;var Ore;let Pk=Ore=class extends wue{constructor(t){super(t),this.type="text-box"}clone(){return new Ore({maxLength:this.maxLength,minLength:this.minLength})}};h([f({type:["text-box"],json:{read:!1,write:!0}})],Pk.prototype,"type",void 0),Pk=Ore=h([Q("esri.form.elements.inputs.TextBoxInput")],Pk);const Tgt=Pk,Sgt={base:uP,key:"type",typeMap:{"barcode-scanner":ygt,"combo-box":_gt,"datetime-picker":vgt,"radio-buttons":bgt,switch:wgt,"text-area":xgt,"text-box":Tgt}};var Pre;const eLe="esri.form.elements.FieldElement",kye=we.getLogger(eLe);let Kp=Pre=class extends lO{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return qJ(kye,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){qJ(kye,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new Pre({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};h([f({types:oDe,json:{read:{reader:sue},write:!0}})],Kp.prototype,"domain",void 0),h([f({type:Boolean,json:{write:!0}})],Kp.prototype,"editable",null),h([f({type:String,json:{write:!0}})],Kp.prototype,"editableExpression",void 0),h([f({type:String,json:{write:!0}})],Kp.prototype,"fieldName",void 0),h([f({type:String,json:{write:!0}})],Kp.prototype,"hint",void 0),h([f({types:Sgt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Kp.prototype,"input",void 0),h([f({type:String,json:{write:!0}})],Kp.prototype,"requiredExpression",void 0),h([f({type:String,json:{read:!1,write:!0}})],Kp.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],Kp.prototype,"valueExpression",void 0),Kp=Pre=h([Q(eLe)],Kp);const Uye=Kp;var Ire;let Wy=Ire=class extends lO{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new Ire({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:Te(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};h([f({type:Number,json:{write:!0}})],Wy.prototype,"displayCount",void 0),h([f({type:["list"],json:{write:!0}})],Wy.prototype,"displayType",void 0),h([f({type:Boolean,json:{write:!0}})],Wy.prototype,"editable",void 0),h([f({type:[Jle],json:{write:!0}})],Wy.prototype,"orderByFields",void 0),h([f({type:Number,json:{write:!0}})],Wy.prototype,"relationshipId",void 0),h([f({type:["relationship"],json:{read:!1,write:!0}})],Wy.prototype,"type",void 0),Wy=Ire=h([Q("esri.form.elements.RelationshipElement")],Wy);const Bye=Wy;function tLe(t){return{typesWithGroup:{base:lO,key:"type",typeMap:{attachment:Lye,field:Uye,group:t,relationship:Bye}},typesWithoutGroup:{base:lO,key:"type",typeMap:{attachment:Lye,field:Uye,relationship:Bye}}}}function rLe(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>i[n.type]).map(n=>i[n.type].fromJSON(n))}function iLe(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>i[n.type]).map(n=>n.toJSON())}function nLe(t,e,r=!0){return t?t.map(i=>Om(r?e.typesWithGroup:e.typesWithoutGroup,i)):null}var $re;let Qg=$re=class extends lO{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return nLe(t,aQ,!1)}readElements(t,e){return rLe(e.formElements,aQ,!1)}writeElements(t,e){e.formElements=iLe(t,aQ,!1)}clone(){return new $re({description:this.description,elements:Te(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};h([f({json:{write:!0}})],Qg.prototype,"elements",void 0),h([Wr("elements")],Qg.prototype,"castElements",null),h([gt("elements",["formElements"])],Qg.prototype,"readElements",null),h([Ct("elements")],Qg.prototype,"writeElements",null),h([f({type:["collapsed","expanded"],json:{write:!0}})],Qg.prototype,"initialState",void 0),h([f({type:String,json:{read:!1,write:!0}})],Qg.prototype,"type",void 0),Qg=$re=h([Q("esri.form.elements.GroupElement")],Qg);const aQ=tLe(Qg),Egt=Qg;var Dre;const lQ=tLe(Egt);let $0=Dre=class extends Je{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return nLe(t,lQ)}readElements(t,e){return rLe(e.formElements,lQ)}writeElements(t,e){e.formElements=iLe(t,lQ)}clone(){return new Dre({description:this.description,expressionInfos:Te(this.expressionInfos),elements:Te(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};h([f({type:String,json:{write:!0}})],$0.prototype,"description",void 0),h([f({json:{write:!0}})],$0.prototype,"elements",void 0),h([Wr("elements")],$0.prototype,"castElements",null),h([gt("elements",["formElements"])],$0.prototype,"readElements",null),h([Ct("elements")],$0.prototype,"writeElements",null),h([f({type:[ggt],json:{write:!0}})],$0.prototype,"expressionInfos",void 0),h([f({type:Boolean,json:{default:!1,write:!0}})],$0.prototype,"preserveFieldValuesWhenHidden",void 0),h([f({type:String,json:{write:!0}})],$0.prototype,"title",void 0),$0=Dre=h([Q("esri.form.FormTemplate")],$0);const Cgt=$0;function zye(t,e,r){if(t.hasM==null||t.hasZ)for(const i of e)for(const n of i)n.length>2&&(n[2]*=r)}function Mgt(t,e,r){if(!t&&!e||!r)return;const i=xS(r);Vye(t,r,i),Vye(e,r,i)}function Vye(t,e,r){if(t)for(const i of t)Rgt(i.geometry,e,r)}function Rgt(t,e,r){if(k(t)||!t.spatialReference||jo(t.spatialReference,e))return;const i=xS(t.spatialReference)/r;if(i!==1){if("x"in t)t.z!=null&&(t.z*=i);else if("rings"in t)zye(t,t.rings,i);else if("paths"in t)zye(t,t.paths,i);else if("points"in t&&(t.hasM==null||t.hasZ))for(const n of t.points)n.length>2&&(n[2]*=i)}}let Ogt=0;const sLe="esri.layers.graphics.sources.MemorySource",cQ=we.getLogger(sLe);let u_=class extends e1.LoadableMixin(bG(_E(ur))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const r=M(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(r)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var r;const e=(r=this.layer)==null?void 0:r.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,r={}){await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);Ute(e,this.layer.spatialReference,i);const n=aue.fromJSON(i);if(!this._requiresClientGraphicMapping())return n;const s=this.layer.objectIdField;for(const o of n.features){const a=o.attributes[s],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return n.geometryType=this.layer.geometryType,n}async queryFeaturesJSON(e,r={}){if(this._requiresClientGraphicMapping())throw new pe("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);return Ute(e,this.layer.spatialReference,i),i}queryFeatureCount(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,r))}queryObjectIds(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,r))}queryExtent(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,r)).then(i=>({count:i.count,extent:an.fromJSON(i.extent)}))}querySnapping(e,r={}){return this.load(r).then(()=>this._connection.invoke("querySnapping",e,r))}async _applyEdits(e){if(!this._connection)throw new pe("feature-layer-source:edit-failure","Memory source not loaded");const r=this.layer.objectIdField;let i=null;const n=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=u=>"objectId"in u&&u.objectId!=null?u.objectId:"attributes"in u&&u.attributes[r]!=null?u.attributes[r]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const u of e.deleteFeatures){const d=o(u);d!=null&&n.push(d)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const u of e.updateFeatures)if(s.push(this._serializeFeature(u)),a){const d=o(u);d!=null&&a.set(d,u)}}Mgt(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:n});return this.fullExtent=l,i&&i.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,r){if(this._layerOrSourceGeometryType!=="mesh"||k(e))return;const i=[];for(const{geometry:n}of e)!M(n)||n.type!=="mesh"||n.hasExtent||n.loaded||i.push(n.load({signal:r}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,r){if(this._idToClientGraphic){if(e)for(const i of r.updateResults){if(!i.success)continue;const n=e.get(i.objectId);n!=null&&this._addIdToClientGraphic(n)}for(const i of r.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const r=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:r?new pe("feature-layer-source:edit-failure",r.description,{code:r.code}):null}}_prepareAddFeatures(e){const r=new Map,i=new Array(e.length);let n=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);!n&&M(a.geometry)&&(n=a.geometry.type),i[o]=l,r.set(`${l.uid}`,a)}const s=this;return{features:i,inferredGeometryType:n,finish(o){const a=s.sourceJSON.objectIdField;for(const l in o){const c=o[l],u=r.get(l);u&&(u.attributes||(u.attributes={}),c===-1?delete u.attributes[a]:u.attributes[a]=c,s._addIdToClientGraphic(u))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const r=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[r];i!=null&&this._idToClientGraphic.set(i,e)}get _layerOrSourceGeometryType(){var e,r;return((e=this.layer)==null?void 0:e.geometryType)??((r=this.sourceJSON)==null?void 0:r.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:r}=e,i=this._geometryForSerialization(e),n=(Ogt++).toString();return i?{uid:n,geometry:i.toJSON(),attributes:r}:{uid:n,attributes:r}}_geometryForSerialization(e){const{geometry:r}=e;return k(r)?null:this._geometryRequiresClientGraphicMapping(r)?r.extent?Hf.fromExtent(r.extent):null:r}async _startWorker(e){this._connection=await jIe("MemorySourceWorker",{strategy:Fe("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:r,spatialReference:i,objectIdField:n,hasM:s,hasZ:o,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",A=>{cQ.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),A.preventDefault()}));const u={features:c.features,fields:r&&r.map(A=>A.toJSON()),geometryType:fge.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&s,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:n,spatialReference:l?null:i&&i.toJSON(),timeInfo:a?a.toJSON():null},d=await this._connection.invoke("load",u,{signal:e});for(const A of d.warnings)cQ.warn(A.message,{layer:this.layer,warning:A});d.featureErrors.length&&cQ.warn(`Encountered ${d.featureErrors.length} validation errors while loading features`,d.featureErrors);const p=d.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(p.geometryType=fge.toJSON(c.inferredGeometryType)),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(d.assignedObjectIds)}};h([tle({Type:Pl,ensureType:Go(Pl)})],u_.prototype,"itemType",void 0),h([f()],u_.prototype,"type",void 0),h([f({constructOnly:!0})],u_.prototype,"layer",void 0),h([f({readOnly:!0})],u_.prototype,"_workerGeometryType",null),h([f()],u_.prototype,"sourceJSON",void 0),u_=h([Q(sLe)],u_);function Pgt(t){return"portalItem"in t}const Igt=t=>{let e=class extends t{get apiKey(){var r;return this._isOverridden("apiKey")?this._get("apiKey"):Pgt(this)?(r=this.portalItem)==null?void 0:r.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return h([f({type:String})],e.prototype,"apiKey",null),e=h([Q("esri.layers.mixins.APIKeyMixin")],e),e},oLe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},aLe=Object.values(oLe),lLe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${aLe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),$gt=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${aLe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Dgt=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function $lr(t){return!!lLe.test(t)}function hP(t){if(k(t))return null;const e=Su(t),r=e.path.match(lLe)||e.path.match($gt);if(!r)return null;const[,i,n,s,o]=r,a=n.indexOf("/");return{title:xue(a!==-1?n.slice(a+1):n),serverType:oLe[s.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function Lgt(t){const e=Su(t).path.match(Dgt);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function xue(t){return(t=t.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function Ngt(t,e){const r=[];if(t){const i=hP(t);M(i)&&i.title&&r.push(i.title)}if(e){const i=xue(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function cLe(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",n="//features",s=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(n);return s&&o}function Fgt(t,e){return t&&eOe(rOe(t,e))}function kgt(t){let{url:e}=t;if(!e)return{url:e};e=rOe(e,t.logger);const r=Su(e),i=hP(r.path);let n;if(M(i))i.sublayer!=null&&t.layer.layerId==null&&(n=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const s=Lgt(r.path);M(s)&&(e=s.serviceUrl,n=s.sublayerId)}return{url:eOe(e),layerId:n}}function Ugt(t,e,r,i,n){M2(e,i,"url",n),i.url&&t.layerId!=null&&(i.url=bS(i.url,r,t.layerId.toString()))}function Dlr(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),n=e.includes("/imageserver/wmsserver"),s=e.includes("/wmsserver");return r&&(i||n||s)}const Bgt=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=hP(this.url);if(M(r)&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",Fgt(r,we.getLogger(this.declaredClass)))}};return h([f()],e.prototype,"title",null),h([f({type:String})],e.prototype,"url",null),e=h([Q("esri.layers.mixins.ArcGISService")],e),e},Gye={read:{reader:rue},write:{allowNull:!0,writer:iue}},uLe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return h([f({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),h([f({json:{read:!1,write:!1,origins:{"web-map":Gye,"portal-item":Gye}}})],e.prototype,"effect",void 0),e=h([Q("esri.layers.mixins.BlendLayer")],e),e},zgt=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return h([f({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],e.prototype,"customParameters",void 0),e=h([Q("esri.layers.mixins.CustomParametersMixin")],e),e},Vgt=new Ws.EventEmitter,hLe="esri.layers.mixins.EditBusLayer",dLe=Symbol(hLe);function Llr(t){return t!=null&&typeof t=="object"&&dLe in t}const Ggt=t=>{var e;let r=class extends t{constructor(...i){super(...i),this[e]=!0,this.when().then(()=>{this.own([Vgt.on("edits",n=>{var u,d,p;const s="layer"in n?n.layer:null,o="layer"in n?(u=n.layer)==null?void 0:u.url:n.serviceUrl,a="layer"in n?(d=n.layer)==null?void 0:d.layerId:n.layerId,l=n.event;if(s===this||o!==this.url)return;if(a!=null&&this.layerId!=null&&a===this.layerId)return void this.emit("edits",Te(l));const c=(p=l.editedFeatures)==null?void 0:p.find(({layerId:A})=>A===this.layerId);if(c){const{adds:A,updates:v,deletes:b}=c.editedFeatures,S={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:A?A.map(({attributes:E})=>({objectId:this.objectIdField&&E[this.objectIdField],globalId:this.globalIdField&&E[this.globalIdField]})):[],deletedFeatures:b?b.map(({attributes:E})=>({objectId:this.objectIdField&&E[this.objectIdField],globalId:this.globalIdField&&E[this.globalIdField]})):[],updatedFeatures:v?v.map(({current:{attributes:E}})=>({objectId:this.objectIdField&&E[this.objectIdField],globalId:this.globalIdField&&E[this.globalIdField]})):[],editedFeatures:Te(l.editedFeatures),exceededTransferLimit:!1};this.emit("edits",S)}})])},()=>{})}};return e=dLe,r=h([Q(hLe)],r),r};var Lre;const uQ=new Hi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),hQ=new Hi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Ig=Lre=class extends Je{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:r,spatialRelationship:i,timeExtent:n,objectIds:s,units:o,distance:a}=this;return new xA({geometry:Te(r),objectIds:Te(s),spatialRelationship:i,timeExtent:Te(n),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:r,timeExtent:i,objectIds:n,units:s,distance:o}=this;return new Lre({geometry:Te(e),objectIds:Te(n),spatialRelationship:r,timeExtent:Te(i),where:t,units:s,distance:o})}};h([f({type:String,json:{write:!0}})],Ig.prototype,"where",void 0),h([f({types:fE,json:{write:!0}})],Ig.prototype,"geometry",void 0),h([f({type:uQ.apiValues,json:{name:"spatialRel",read:{reader:uQ.read},write:{allowNull:!1,writer:uQ.write,overridePolicy(){return{enabled:M(this.geometry)}}}}})],Ig.prototype,"spatialRelationship",void 0),h([f({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Ig.prototype,"distance",void 0),h([f({type:[Number],json:{write:!0}})],Ig.prototype,"objectIds",void 0),h([f({type:hQ.apiValues,json:{read:hQ.read,write:{writer:hQ.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Ig.prototype,"units",void 0),h([f({type:ey,json:{write:!0}})],Ig.prototype,"timeExtent",void 0),Ig=Lre=h([Q("esri.layers.support.FeatureFilter")],Ig);const jgt=Ig;var Nre;const jye={read:{reader:rue},write:{writer:iue,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Hye={read:{reader:rue},write:{writer:iue,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},qye={name:"showExcludedLabels",default:!0};let Bx=Nre=class extends Je{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var i,n;const r=super.write(t,e);if(e!=null&&e.origin){if(r.filter){const s=Object.keys(r.filter);if(s.length>1||s[0]!=="where")return(i=e.messages)==null||i.push(new pe("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in r)return(n=e.messages)==null||n.push(new pe("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return r}clone(){return new Nre({filter:M(this.filter)?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};h([f({type:jgt,json:{write:{allowNull:!0,writer(t,e,r,i){const n=t==null?void 0:t.write({},i);n&&Object.keys(n).length!==0?wu(r,n,e):wu(r,null,e)}}}})],Bx.prototype,"filter",void 0),h([f({json:{write:!0,origins:{"web-map":jye,"portal-item":jye}}})],Bx.prototype,"includedEffect",void 0),h([f({json:{write:!0,origins:{"web-map":Hye,"portal-item":Hye}}})],Bx.prototype,"excludedEffect",void 0),h([f({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":qye,"portal-item":qye}}})],Bx.prototype,"excludedLabelsVisible",void 0),Bx=Nre=h([Q("esri.layers.support.FeatureEffect")],Bx);const Hgt=Bx,Wye={write:{allowNull:!0}},qgt=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return h([f({type:Hgt,json:{origins:{"web-map":Wye,"portal-item":Wye}}})],e.prototype,"featureEffect",void 0),e=h([Q("esri.layers.mixins.FeatureEffectLayer")],e),e};function Wgt(t){if(!t)return t;const{start:e,end:r}=t;return new ey({start:M(e)?tS(e,-e.getTimezoneOffset(),"minutes"):e,end:M(r)?tS(r,-r.getTimezoneOffset(),"minutes"):r})}function Qgt(t){if(!t)return t;const{start:e,end:r}=t;return new ey({start:M(e)?tS(e,e.getTimezoneOffset(),"minutes"):e,end:M(r)?tS(r,r.getTimezoneOffset(),"minutes"):r})}var Fre;let a4=Fre=class extends Je{constructor(t){super(t)}async collectRequiredFields(t,e){return gh(t,e,this.expression)}clone(){return new Fre({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};h([f({type:String,json:{write:!0}})],a4.prototype,"expression",void 0),h([f({type:String,json:{write:!0}})],a4.prototype,"title",void 0),a4=Fre=h([Q("esri.layers.support.FeatureExpressionInfo")],a4);const Qye=a4;function Ygt(t){return!!t&&oO[t]!=null}function Xgt(t){return 1/(oO[t]||1)}function Zgt(){const t=Object.keys(oO);return t.sort(),t}const Jgt=Zgt();var kre;const G6=$c()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Yye=new Hi({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Qy=kre=class extends Je{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):M(t)||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new kre({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&UJe(this.featureExpressionInfo,t.featureExpressionInfo)}};h([f({type:Qye,json:{write:!0}})],Qy.prototype,"featureExpressionInfo",void 0),h([gt("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Qy.prototype,"readFeatureExpressionInfo",null),h([Ct("featureExpressionInfo",{featureExpressionInfo:{type:Qye},"featureExpression.value":{type:[0]}})],Qy.prototype,"writeFeatureExpressionInfo",null),h([f({type:G6.apiValues,nonNullable:!0,json:{type:G6.jsonValues,read:G6.read,write:{writer:G6.write,isRequired:!0}}})],Qy.prototype,"mode",null),h([f({type:Number,json:{write:!0}})],Qy.prototype,"offset",void 0),h([f({type:Jgt,json:{type:String,read:Yye.read,write:Yye.write}})],Qy.prototype,"unit",null),Qy=kre=h([Q("esri.layers.support.ElevationInfo")],Qy);const pLe=Qy,Kgt={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},Tue={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,r){e[r]=!t}}}},Sue={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},eAt={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:M2}}},tAt={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},rAt={value:null,type:pLe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function Nlr(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const fLe={write:!0,read:!0},Ure={type:Number,json:{origins:{"web-document":fLe,"portal-item":{write:!0}}}},iAt={...Ure,json:{...Ure.json,origins:{"web-document":{...fLe,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,r)=>r&&r.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?UD(e.layerDefinition.drawingInfo.transparency):void 0:UD(e.drawingInfo.transparency)}}},Flr={type:ey,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:r}=this.layer,i=(l=this.view)==null?void 0:l.timeExtent;let n=this.layer.timeExtent;t&&(n=Qgt(n));let s=r?i&&n?i.intersection(n):i||n:n;if(!s||s.isEmpty||s.isAllTime)return s;e&&(s=s.offset(-e.value,e.unit)),t&&(s=Wgt(s));const o=this._get("timeExtent");return s.equals(o)?o:s}},klr={type:an,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const r=an.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(r.spatialReference=St.fromJSON(e.spatialReference)),r}}}},read:!1}},nAt={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},sAt={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},oAt={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},mLe={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},Xye=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Chihuahua"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class TE extends Error{}class aAt extends TE{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class lAt extends TE{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class cAt extends TE{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class l4 extends TE{}class gLe extends TE{constructor(e){super(`Invalid unit ${e}`)}}class _f extends TE{}class K1 extends TE{constructor(){super("Zone is an abstract class")}}const Vt="numeric",km="short",Ap="long",ez={year:Vt,month:Vt,day:Vt},ALe={year:Vt,month:km,day:Vt},uAt={year:Vt,month:km,day:Vt,weekday:km},yLe={year:Vt,month:Ap,day:Vt},_Le={year:Vt,month:Ap,day:Vt,weekday:Ap},vLe={hour:Vt,minute:Vt},bLe={hour:Vt,minute:Vt,second:Vt},wLe={hour:Vt,minute:Vt,second:Vt,timeZoneName:km},xLe={hour:Vt,minute:Vt,second:Vt,timeZoneName:Ap},TLe={hour:Vt,minute:Vt,hourCycle:"h23"},SLe={hour:Vt,minute:Vt,second:Vt,hourCycle:"h23"},ELe={hour:Vt,minute:Vt,second:Vt,hourCycle:"h23",timeZoneName:km},CLe={hour:Vt,minute:Vt,second:Vt,hourCycle:"h23",timeZoneName:Ap},MLe={year:Vt,month:Vt,day:Vt,hour:Vt,minute:Vt},RLe={year:Vt,month:Vt,day:Vt,hour:Vt,minute:Vt,second:Vt},OLe={year:Vt,month:km,day:Vt,hour:Vt,minute:Vt},PLe={year:Vt,month:km,day:Vt,hour:Vt,minute:Vt,second:Vt},hAt={year:Vt,month:km,day:Vt,weekday:km,hour:Vt,minute:Vt},ILe={year:Vt,month:Ap,day:Vt,hour:Vt,minute:Vt,timeZoneName:km},$Le={year:Vt,month:Ap,day:Vt,hour:Vt,minute:Vt,second:Vt,timeZoneName:km},DLe={year:Vt,month:Ap,day:Vt,weekday:Ap,hour:Vt,minute:Vt,timeZoneName:Ap},LLe={year:Vt,month:Ap,day:Vt,weekday:Ap,hour:Vt,minute:Vt,second:Vt,timeZoneName:Ap};class qN{get type(){throw new K1}get name(){throw new K1}get ianaName(){return this.name}get isUniversal(){throw new K1}offsetName(e,r){throw new K1}formatOffset(e,r){throw new K1}offset(e){throw new K1}equals(e){throw new K1}get isValid(){throw new K1}}let dQ=null;class vj extends qN{static get instance(){return dQ===null&&(dQ=new vj),dQ}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return FLe(e,r,i)}formatOffset(e,r){return N5(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let Ik={};function dAt(t){return Ik[t]||(Ik[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),Ik[t]}const pAt={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function fAt(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,n,s,o,a,l,c,u]=i;return[o,n,s,a,l,c,u]}function mAt(t,e){const r=t.formatToParts(e),i=[];for(let n=0;n<r.length;n++){const{type:s,value:o}=r[n],a=pAt[s];s==="era"?i[a]=o:In(a)||(i[a]=parseInt(o,10))}return i}let j6={};class o1 extends qN{static create(e){return j6[e]||(j6[e]=new o1(e)),j6[e]}static resetCache(){j6={},Ik={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=o1.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return FLe(e,r,i,this.name)}formatOffset(e,r){return N5(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=dAt(this.name);let[n,s,o,a,l,c,u]=i.formatToParts?mAt(i,r):fAt(i,r);a==="BC"&&(n=-Math.abs(n)+1);const p=Mue({year:n,month:s,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let A=+r;const v=A%1e3;return A-=v>=0?v:1e3+v,(p-A)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Zye={};function gAt(t,e={}){const r=JSON.stringify([t,e]);let i=Zye[r];return i||(i=new Intl.ListFormat(t,e),Zye[r]=i),i}let Bre={};function zre(t,e={}){const r=JSON.stringify([t,e]);let i=Bre[r];return i||(i=new Intl.DateTimeFormat(t,e),Bre[r]=i),i}let Vre={};function AAt(t,e={}){const r=JSON.stringify([t,e]);let i=Vre[r];return i||(i=new Intl.NumberFormat(t,e),Vre[r]=i),i}let Gre={};function yAt(t,e={}){const{base:r,...i}=e,n=JSON.stringify([t,i]);let s=Gre[n];return s||(s=new Intl.RelativeTimeFormat(t,e),Gre[n]=s),s}let c4=null;function _At(){return c4||(c4=new Intl.DateTimeFormat().resolvedOptions().locale,c4)}function vAt(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,n;try{i=zre(t).resolvedOptions(),n=t}catch{const l=t.substring(0,r);i=zre(l).resolvedOptions(),n=l}const{numberingSystem:s,calendar:o}=i;return[n,s,o]}}function bAt(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function wAt(t){const e=[];for(let r=1;r<=12;r++){const i=Ii.utc(2016,r,1);e.push(t(i))}return e}function xAt(t){const e=[];for(let r=1;r<=7;r++){const i=Ii.utc(2016,11,13+r);e.push(t(i))}return e}function H6(t,e,r,i,n){const s=t.listingMode(r);return s==="error"?null:s==="en"?i(e):n(e)}function TAt(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class SAt{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:n,floor:s,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=AAt(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):Cue(e,3);return Ya(r,this.padTo)}}}class EAt{constructor(e,r,i){this.opts=i;let n;if(e.zone.isUniversal){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&o1.create(a).valid?(n=a,this.dt=e):(n="UTC",i.timeZoneName?this.dt=e:this.dt=e.offset===0?e:Ii.fromMillis(e.ts+e.offset*60*1e3))}else e.zone.type==="system"?this.dt=e:(this.dt=e,n=e.zone.name);const s={...this.opts};s.timeZone=s.timeZone||n,this.dtf=zre(r,s)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class CAt{constructor(e,r,i){this.opts={style:"long",...i},!r&&NLe()&&(this.rtf=yAt(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):jAt(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class yo{static fromOpts(e){return yo.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,n=!1){const s=e||Wa.defaultLocale,o=s||(n?"en-US":_At()),a=r||Wa.defaultNumberingSystem,l=i||Wa.defaultOutputCalendar;return new yo(o,a,l,s)}static resetCache(){c4=null,Bre={},Vre={},Gre={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return yo.create(e,r,i)}constructor(e,r,i,n){const[s,o,a]=vAt(e);this.locale=s,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=bAt(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=TAt(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:yo.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1,i=!0){return H6(this,e,i,BLe,()=>{const n=r?{month:e,day:"numeric"}:{month:e},s=r?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=wAt(o=>this.extract(o,n,"month"))),this.monthsCache[s][e]})}weekdays(e,r=!1,i=!0){return H6(this,e,i,GLe,()=>{const n=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=r?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=xAt(o=>this.extract(o,n,"weekday"))),this.weekdaysCache[s][e]})}meridiems(e=!0){return H6(this,void 0,e,()=>jLe,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ii.utc(2016,11,13,9),Ii.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(e,r=!0){return H6(this,e,r,HLe,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[Ii.utc(-40,1,1),Ii.utc(2017,1,1)].map(n=>this.extract(n,i,"era"))),this.eraCache[e]})}extract(e,r,i){const n=this.dtFormatter(e,r),s=n.formatToParts(),o=s.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new SAt(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new EAt(e,this.intl,r)}relFormatter(e={}){return new CAt(this.intl,this.isEnglish(),e)}listFormatter(e={}){return gAt(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let pQ=null;class mu extends qN{static get utcInstance(){return pQ===null&&(pQ=new mu(0)),pQ}static instance(e){return e===0?mu.utcInstance:new mu(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new mu(wj(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${N5(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${N5(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return N5(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class MAt extends qN{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Cb(t,e){if(In(t)||t===null)return e;if(t instanceof qN)return t;if(RAt(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?vj.instance:r==="utc"||r==="gmt"?mu.utcInstance:mu.parseSpecifier(r)||o1.create(t)}else return rS(t)?mu.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new MAt(t)}let Jye=()=>Date.now(),Kye="system",e_e=null,t_e=null,r_e=null,i_e=60,n_e;class Wa{static get now(){return Jye}static set now(e){Jye=e}static set defaultZone(e){Kye=e}static get defaultZone(){return Cb(Kye,vj.instance)}static get defaultLocale(){return e_e}static set defaultLocale(e){e_e=e}static get defaultNumberingSystem(){return t_e}static set defaultNumberingSystem(e){t_e=e}static get defaultOutputCalendar(){return r_e}static set defaultOutputCalendar(e){r_e=e}static get twoDigitCutoffYear(){return i_e}static set twoDigitCutoffYear(e){i_e=e%100}static get throwOnInvalid(){return n_e}static set throwOnInvalid(e){n_e=e}static resetCaches(){yo.resetCache(),o1.resetCache()}}function In(t){return typeof t>"u"}function rS(t){return typeof t=="number"}function bj(t){return typeof t=="number"&&t%1===0}function RAt(t){return typeof t=="string"}function OAt(t){return Object.prototype.toString.call(t)==="[object Date]"}function NLe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function PAt(t){return Array.isArray(t)?t:[t]}function s_e(t,e,r){if(t.length!==0)return t.reduce((i,n)=>{const s=[e(n),n];return i&&r(i[0],s[0])===i[0]?i:s},null)[1]}function IAt(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function cO(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function M_(t,e,r){return bj(t)&&t>=e&&t<=r}function $At(t,e){return t-e*Math.floor(t/e)}function Ya(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function mb(t){if(!(In(t)||t===null||t===""))return parseInt(t,10)}function Sw(t){if(!(In(t)||t===null||t===""))return parseFloat(t)}function Eue(t){if(!(In(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function Cue(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function WN(t){return t%4===0&&(t%100!==0||t%400===0)}function L5(t){return WN(t)?366:365}function tz(t,e){const r=$At(e-1,12)+1,i=t+(e-r)/12;return r===2?WN(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function Mue(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(e.getUTCFullYear()-1900)),+e}function rz(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function jre(t){return t>99?t:t>Wa.twoDigitCutoffYear?1900+t:2e3+t}function FLe(t,e,r,i=null){const n=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(s.timeZone=i);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(r,o).formatToParts(n).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function wj(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,n=r<0||Object.is(r,-0)?-i:i;return r*60+n}function kLe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new _f(`Invalid unit value ${t}`);return e}function iz(t,e){const r={};for(const i in t)if(cO(t,i)){const n=t[i];if(n==null)continue;r[e(i)]=kLe(n)}return r}function N5(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),n=t>=0?"+":"-";switch(e){case"short":return`${n}${Ya(r,2)}:${Ya(i,2)}`;case"narrow":return`${n}${r}${i>0?`:${i}`:""}`;case"techie":return`${n}${Ya(r,2)}${Ya(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function xj(t){return IAt(t,["hour","minute","second","millisecond"])}const DAt=["January","February","March","April","May","June","July","August","September","October","November","December"],ULe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],LAt=["J","F","M","A","M","J","J","A","S","O","N","D"];function BLe(t){switch(t){case"narrow":return[...LAt];case"short":return[...ULe];case"long":return[...DAt];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const zLe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],VLe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],NAt=["M","T","W","T","F","S","S"];function GLe(t){switch(t){case"narrow":return[...NAt];case"short":return[...VLe];case"long":return[...zLe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const jLe=["AM","PM"],FAt=["Before Christ","Anno Domini"],kAt=["BC","AD"],UAt=["B","A"];function HLe(t){switch(t){case"narrow":return[...UAt];case"short":return[...kAt];case"long":return[...FAt];default:return null}}function BAt(t){return jLe[t.hour<12?0:1]}function zAt(t,e){return GLe(e)[t.weekday-1]}function VAt(t,e){return BLe(e)[t.month-1]}function GAt(t,e){return HLe(e)[t.year<0?0:1]}function jAt(t,e,r="always",i=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&s){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${n[t][0]}`;case-1:return d?"yesterday":`last ${n[t][0]}`;case 0:return d?"today":`this ${n[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=n[t],u=i?l?c[1]:c[2]||c[1]:l?n[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function o_e(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const HAt={D:ez,DD:ALe,DDD:yLe,DDDD:_Le,t:vLe,tt:bLe,ttt:wLe,tttt:xLe,T:TLe,TT:SLe,TTT:ELe,TTTT:CLe,f:MLe,ff:OLe,fff:ILe,ffff:DLe,F:RLe,FF:PLe,FFF:$Le,FFFF:LLe};class du{static create(e,r={}){return new du(e,r)}static parseFormat(e){let r=null,i="",n=!1;const s=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&s.push({literal:n,val:i}),r=null,i="",n=!n):n||a===r?i+=a:(i.length>0&&s.push({literal:!1,val:i}),i=a,r=a)}return i.length>0&&s.push({literal:n,val:i}),s}static macroTokenToFormatOpts(e){return HAt[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTime(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTimeParts(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).formatToParts()}formatInterval(e,r={}){return this.loc.dtFormatter(e.start,{...this.opts,...r}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return Ya(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(A,v)=>this.loc.extract(e,A,v),o=A=>e.isOffsetFixed&&e.offset===0&&A.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,A.format):"",a=()=>i?BAt(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(A,v)=>i?VAt(e,A):s(v?{month:A}:{month:A,day:"numeric"},"month"),c=(A,v)=>i?zAt(e,A):s(v?{weekday:A}:{weekday:A,month:"long",day:"numeric"},"weekday"),u=A=>{const v=du.macroTokenToFormatOpts(A);return v?this.formatWithSystemDefault(e,v):A},d=A=>i?GAt(e,A):s({era:A},"era"),p=A=>{switch(A){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return n?s({day:"numeric"},"day"):this.num(e.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(e.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(e.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(A)}};return o_e(du.parseFormat(r),p)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=l=>c=>{const u=i(c);return u?this.num(l.get(u),c.length):c},s=du.parseFormat(r),o=s.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return o_e(s,n(a))}}class fm{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const qLe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function dP(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function pP(...t){return e=>t.reduce(([r,i,n],s)=>{const[o,a,l]=s(e,n);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function fP(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const n=r.exec(t);if(n)return i(n)}return[null,null]}function WLe(...t){return(e,r)=>{const i={};let n;for(n=0;n<t.length;n++)i[t[n]]=mb(e[r+n]);return[i,null,r+n]}}const QLe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,qAt=`(?:${QLe.source}?(?:\\[(${qLe.source})\\])?)?`,Rue=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,YLe=RegExp(`${Rue.source}${qAt}`),Oue=RegExp(`(?:T${YLe.source})?`),WAt=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,QAt=/(\d{4})-?W(\d\d)(?:-?(\d))?/,YAt=/(\d{4})-?(\d{3})/,XAt=WLe("weekYear","weekNumber","weekDay"),ZAt=WLe("year","ordinal"),JAt=/(\d{4})-(\d\d)-(\d\d)/,XLe=RegExp(`${Rue.source} ?(?:${QLe.source}|(${qLe.source}))?`),KAt=RegExp(`(?: ${XLe.source})?`);function iR(t,e,r){const i=t[e];return In(i)?r:mb(i)}function eyt(t,e){return[{year:iR(t,e),month:iR(t,e+1,1),day:iR(t,e+2,1)},null,e+3]}function mP(t,e){return[{hours:iR(t,e,0),minutes:iR(t,e+1,0),seconds:iR(t,e+2,0),milliseconds:Eue(t[e+3])},null,e+4]}function QN(t,e){const r=!t[e]&&!t[e+1],i=wj(t[e+1],t[e+2]),n=r?null:mu.instance(i);return[{},n,e+3]}function YN(t,e){const r=t[e]?o1.create(t[e]):null;return[{},r,e+1]}const tyt=RegExp(`^T?${Rue.source}$`),ryt=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function iyt(t){const[e,r,i,n,s,o,a,l,c]=t,u=e[0]==="-",d=l&&l[0]==="-",p=(A,v=!1)=>A!==void 0&&(v||A&&u)?-A:A;return[{years:p(Sw(r)),months:p(Sw(i)),weeks:p(Sw(n)),days:p(Sw(s)),hours:p(Sw(o)),minutes:p(Sw(a)),seconds:p(Sw(l),l==="-0"),milliseconds:p(Eue(c),d)}]}const nyt={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Pue(t,e,r,i,n,s,o){const a={year:e.length===2?jre(mb(e)):mb(e),month:ULe.indexOf(r)+1,day:mb(i),hour:mb(n),minute:mb(s)};return o&&(a.second=mb(o)),t&&(a.weekday=t.length>3?zLe.indexOf(t)+1:VLe.indexOf(t)+1),a}const syt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function oyt(t){const[,e,r,i,n,s,o,a,l,c,u,d]=t,p=Pue(e,n,i,r,s,o,a);let A;return l?A=nyt[l]:c?A=0:A=wj(u,d),[p,new mu(A)]}function ayt(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const lyt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,cyt=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,uyt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function a_e(t){const[,e,r,i,n,s,o,a]=t;return[Pue(e,n,i,r,s,o,a),mu.utcInstance]}function hyt(t){const[,e,r,i,n,s,o,a]=t;return[Pue(e,a,r,i,n,s,o),mu.utcInstance]}const dyt=dP(WAt,Oue),pyt=dP(QAt,Oue),fyt=dP(YAt,Oue),myt=dP(YLe),ZLe=pP(eyt,mP,QN,YN),gyt=pP(XAt,mP,QN,YN),Ayt=pP(ZAt,mP,QN,YN),yyt=pP(mP,QN,YN);function _yt(t){return fP(t,[dyt,ZLe],[pyt,gyt],[fyt,Ayt],[myt,yyt])}function vyt(t){return fP(ayt(t),[syt,oyt])}function byt(t){return fP(t,[lyt,a_e],[cyt,a_e],[uyt,hyt])}function wyt(t){return fP(t,[ryt,iyt])}const xyt=pP(mP);function Tyt(t){return fP(t,[tyt,xyt])}const Syt=dP(JAt,KAt),Eyt=dP(XLe),Cyt=pP(mP,QN,YN);function Myt(t){return fP(t,[Syt,ZLe],[Eyt,Cyt])}const Ryt="Invalid Duration",JLe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Oyt={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...JLe},Dp=146097/400,WE=146097/4800,Pyt={years:{quarters:4,months:12,weeks:Dp/7,days:Dp,hours:Dp*24,minutes:Dp*24*60,seconds:Dp*24*60*60,milliseconds:Dp*24*60*60*1e3},quarters:{months:3,weeks:Dp/28,days:Dp/4,hours:Dp*24/4,minutes:Dp*24*60/4,seconds:Dp*24*60*60/4,milliseconds:Dp*24*60*60*1e3/4},months:{weeks:WE/7,days:WE,hours:WE*24,minutes:WE*24*60,seconds:WE*24*60*60,milliseconds:WE*24*60*60*1e3},...JLe},zx=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Iyt=zx.slice(0).reverse();function ev(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Nn(i)}function $yt(t){return t<0?Math.floor(t):Math.ceil(t)}function KLe(t,e,r,i,n){const s=t[n][r],o=e[r]/s,a=Math.sign(o)===Math.sign(i[n]),l=!a&&i[n]!==0&&Math.abs(o)<=1?$yt(o):Math.trunc(o);i[n]+=l,e[r]-=l*s}function Dyt(t,e){Iyt.reduce((r,i)=>In(e[i])?r:(r&&KLe(t,e,r,e,i),i),null)}function Lyt(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class Nn{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?Pyt:Oyt;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||yo.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return Nn.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new _f(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Nn({values:iz(e,Nn.normalizeUnit),loc:yo.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(rS(e))return Nn.fromMillis(e);if(Nn.isDuration(e))return e;if(typeof e=="object")return Nn.fromObject(e);throw new _f(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=wyt(e);return i?Nn.fromObject(i,r):Nn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=Tyt(e);return i?Nn.fromObject(i,r):Nn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new _f("need to specify a reason the Duration is invalid");const i=e instanceof fm?e:new fm(e,r);if(Wa.throwOnInvalid)throw new cAt(i);return new Nn({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new gLe(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?du.create(this.loc,i).formatDurationFromString(this,e):Ryt}toHuman(e={}){const r=zx.map(i=>{const n=this.values[i];return In(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(n)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Cue(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let n=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(n+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(n+=".SSS"));let s=i.toFormat(n);return e.includePrefix&&(s="T"+s),s}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=Nn.fromDurationLike(e),i={};for(const n of zx)(cO(r.values,n)||cO(this.values,n))&&(i[n]=r.get(n)+this.get(n));return ev(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=Nn.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=kLe(e(this.values[i],i));return ev(this,{values:r},!0)}get(e){return this[Nn.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...iz(e,Nn.normalizeUnit)};return ev(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:n}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:n,conversionAccuracy:i};return ev(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Dyt(this.matrix,e),ev(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=Lyt(this.normalize().shiftToAll().toObject());return ev(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Nn.normalizeUnit(o));const r={},i={},n=this.toObject();let s;for(const o of zx)if(e.indexOf(o)>=0){s=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;rS(n[o])&&(a+=n[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in n)zx.indexOf(c)>zx.indexOf(o)&&KLe(this.matrix,n,c,r,o)}else rS(n[o])&&(i[o]=n[o]);for(const o in i)i[o]!==0&&(r[s]+=o===s?i[o]:i[o]/this.matrix[s][o]);return ev(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return ev(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,n){return i===void 0||i===0?n===void 0||n===0:i===n}for(const i of zx)if(!r(this.values[i],e.values[i]))return!1;return!0}}const QE="Invalid Interval";function Nyt(t,e){return!t||!t.isValid?Jo.invalid("missing or invalid start"):!e||!e.isValid?Jo.invalid("missing or invalid end"):e<t?Jo.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Jo{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new _f("need to specify a reason the Interval is invalid");const i=e instanceof fm?e:new fm(e,r);if(Wa.throwOnInvalid)throw new lAt(i);return new Jo({invalid:i})}static fromDateTimes(e,r){const i=yI(e),n=yI(r),s=Nyt(i,n);return s??new Jo({start:i,end:n})}static after(e,r){const i=Nn.fromDurationLike(r),n=yI(e);return Jo.fromDateTimes(n,n.plus(i))}static before(e,r){const i=Nn.fromDurationLike(r),n=yI(e);return Jo.fromDateTimes(n.minus(i),n)}static fromISO(e,r){const[i,n]=(e||"").split("/",2);if(i&&n){let s,o;try{s=Ii.fromISO(i,r),o=s.isValid}catch{o=!1}let a,l;try{a=Ii.fromISO(n,r),l=a.isValid}catch{l=!1}if(o&&l)return Jo.fromDateTimes(s,a);if(o){const c=Nn.fromISO(n,r);if(c.isValid)return Jo.after(s,c)}else if(l){const c=Nn.fromISO(i,r);if(c.isValid)return Jo.before(a,c)}}return Jo.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+1}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?Jo.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(yI).filter(o=>this.contains(o)).sort(),i=[];let{s:n}=this,s=0;for(;n<this.e;){const o=r[s]||this.e,a=+o>+this.e?this.e:o;i.push(Jo.fromDateTimes(n,a)),n=a,s+=1}return i}splitBy(e){const r=Nn.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,n=1,s;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*n));s=+a>+this.e?this.e:a,o.push(Jo.fromDateTimes(i,s)),i=s,n+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:Jo.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return Jo.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((n,s)=>n.s-s.s).reduce(([n,s],o)=>s?s.overlaps(o)||s.abutsStart(o)?[n,s.union(o)]:[n.concat([s]),o]:[n,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const n=[],s=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...s),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&n.push(Jo.fromDateTimes(r,l.time)),r=null);return Jo.merge(n)}difference(...e){return Jo.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:QE}toLocaleString(e=ez,r={}){return this.isValid?du.create(this.s.loc.clone(r),e).formatInterval(this):QE}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:QE}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:QE}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:QE}toFormat(e,{separator:r="  "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:QE}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):Nn.invalid(this.invalidReason)}mapEndpoints(e){return Jo.fromDateTimes(e(this.s),e(this.e))}}class q6{static hasDST(e=Wa.defaultZone){const r=Ii.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return o1.isValidZone(e)}static normalizeZone(e){return Cb(e,Wa.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||yo.create(r,i,s)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||yo.create(r,i,s)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||yo.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||yo.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return yo.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return yo.create(r,null,"gregory").eras(e)}static features(){return{relative:NLe()}}}function l_e(t,e){const r=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(Nn.fromMillis(i).as("days"))}function Fyt(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=l_e(l,c);return(u-u%7)/7}],["days",l_e]],n={},s=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,n[l]=c(t,e),a=s.plus(n),a>e?(n[l]--,t=s.plus(n)):t=a);return[t,n,a,o]}function kyt(t,e,r,i){let[n,s,o,a]=Fyt(t,e,r);const l=e-n,c=r.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const u=Nn.fromObject(s,i);return c.length>0?Nn.fromMillis(l,i).shiftTo(...c).plus(u):u}const Iue={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},c_e={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Uyt=Iue.hanidec.replace(/[\[|\]]/g,"").split("");function Byt(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(Iue.hanidec)!==-1)e+=Uyt.indexOf(t[r]);else for(const n in c_e){const[s,o]=c_e[n];i>=s&&i<=o&&(e+=i-s)}}return parseInt(e,10)}else return e}function d0({numberingSystem:t},e=""){return new RegExp(`${Iue[t||"latn"]}${e}`)}const zyt="missing Intl.DateTimeFormat.formatToParts support";function Kn(t,e=r=>r){return{regex:t,deser:([r])=>e(Byt(r))}}const Vyt=String.fromCharCode(160),eNe=`[ ${Vyt}]`,tNe=new RegExp(eNe,"g");function Gyt(t){return t.replace(/\./g,"\\.?").replace(tNe,eNe)}function u_e(t){return t.replace(/\./g,"").replace(tNe," ").toLowerCase()}function p0(t,e){return t===null?null:{regex:RegExp(t.map(Gyt).join("|")),deser:([r])=>t.findIndex(i=>u_e(r)===u_e(i))+e}}function h_e(t,e){return{regex:t,deser:([,r,i])=>wj(r,i),groups:e}}function fQ(t){return{regex:t,deser:([e])=>e}}function jyt(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Hyt(t,e){const r=d0(e),i=d0(e,"{2}"),n=d0(e,"{3}"),s=d0(e,"{4}"),o=d0(e,"{6}"),a=d0(e,"{1,2}"),l=d0(e,"{1,3}"),c=d0(e,"{1,6}"),u=d0(e,"{1,9}"),d=d0(e,"{2,4}"),p=d0(e,"{4,6}"),A=S=>({regex:RegExp(jyt(S.val)),deser:([E])=>E,literal:!0}),b=(S=>{if(t.literal)return A(S);switch(S.val){case"G":return p0(e.eras("short",!1),0);case"GG":return p0(e.eras("long",!1),0);case"y":return Kn(c);case"yy":return Kn(d,jre);case"yyyy":return Kn(s);case"yyyyy":return Kn(p);case"yyyyyy":return Kn(o);case"M":return Kn(a);case"MM":return Kn(i);case"MMM":return p0(e.months("short",!0,!1),1);case"MMMM":return p0(e.months("long",!0,!1),1);case"L":return Kn(a);case"LL":return Kn(i);case"LLL":return p0(e.months("short",!1,!1),1);case"LLLL":return p0(e.months("long",!1,!1),1);case"d":return Kn(a);case"dd":return Kn(i);case"o":return Kn(l);case"ooo":return Kn(n);case"HH":return Kn(i);case"H":return Kn(a);case"hh":return Kn(i);case"h":return Kn(a);case"mm":return Kn(i);case"m":return Kn(a);case"q":return Kn(a);case"qq":return Kn(i);case"s":return Kn(a);case"ss":return Kn(i);case"S":return Kn(l);case"SSS":return Kn(n);case"u":return fQ(u);case"uu":return fQ(a);case"uuu":return Kn(r);case"a":return p0(e.meridiems(),0);case"kkkk":return Kn(s);case"kk":return Kn(d,jre);case"W":return Kn(a);case"WW":return Kn(i);case"E":case"c":return Kn(r);case"EEE":return p0(e.weekdays("short",!1,!1),1);case"EEEE":return p0(e.weekdays("long",!1,!1),1);case"ccc":return p0(e.weekdays("short",!0,!1),1);case"cccc":return p0(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return h_e(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return h_e(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return fQ(/[a-z_+-/]{1,256}?/i);default:return A(S)}})(t)||{invalidReason:zyt};return b.token=t,b}const qyt={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function Wyt(t,e){const{type:r,value:i}=t;if(r==="literal")return{literal:!0,val:i};const n=e[r];let s=qyt[r];if(typeof s=="object"&&(s=s[n]),s)return{literal:!1,val:s}}function Qyt(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function Yyt(t,e,r){const i=t.match(e);if(i){const n={};let s=1;for(const o in r)if(cO(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(n[a.token.val[0]]=a.deser(i.slice(s,s+l))),s+=l}return[i,n]}else return[i,{}]}function Xyt(t){const e=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return In(t.z)||(r=o1.create(t.z)),In(t.Z)||(r||(r=new mu(t.Z)),i=t.Z),In(t.q)||(t.M=(t.q-1)*3+1),In(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),In(t.u)||(t.S=Eue(t.u)),[Object.keys(t).reduce((s,o)=>{const a=e(o);return a&&(s[a]=t[o]),s},{}),r,i]}let mQ=null;function Zyt(){return mQ||(mQ=Ii.fromMillis(1555555555555)),mQ}function Jyt(t,e){if(t.literal)return t;const r=du.macroTokenToFormatOpts(t.val),i=nNe(r,e);return i==null||i.includes(void 0)?t:i}function rNe(t,e){return Array.prototype.concat(...t.map(r=>Jyt(r,e)))}function iNe(t,e,r){const i=rNe(du.parseFormat(r),t),n=i.map(o=>Hyt(o,t)),s=n.find(o=>o.invalidReason);if(s)return{input:e,tokens:i,invalidReason:s.invalidReason};{const[o,a]=Qyt(n),l=RegExp(o,"i"),[c,u]=Yyt(e,l,a),[d,p,A]=u?Xyt(u):[null,null,void 0];if(cO(u,"a")&&cO(u,"H"))throw new l4("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:u,result:d,zone:p,specificOffset:A}}}function Kyt(t,e,r){const{result:i,zone:n,specificOffset:s,invalidReason:o}=iNe(t,e,r);return[i,n,s,o]}function nNe(t,e){return t?du.create(e,t).formatDateTimeParts(Zyt()).map(n=>Wyt(n,t)):null}const sNe=[0,31,59,90,120,151,181,212,243,273,304,334],oNe=[0,31,60,91,121,152,182,213,244,274,305,335];function Rf(t,e){return new fm("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function aNe(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const n=i.getUTCDay();return n===0?7:n}function lNe(t,e,r){return r+(WN(t)?oNe:sNe)[e-1]}function cNe(t,e){const r=WN(t)?oNe:sNe,i=r.findIndex(s=>s<e),n=e-r[i];return{month:i+1,day:n}}function Hre(t){const{year:e,month:r,day:i}=t,n=lNe(e,r,i),s=aNe(e,r,i);let o=Math.floor((n-s+10)/7),a;return o<1?(a=e-1,o=rz(a)):o>rz(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:s,...xj(t)}}function d_e(t){const{weekYear:e,weekNumber:r,weekday:i}=t,n=aNe(e,1,4),s=L5(e);let o=r*7+i-n-3,a;o<1?(a=e-1,o+=L5(a)):o>s?(a=e+1,o-=L5(e)):a=e;const{month:l,day:c}=cNe(a,o);return{year:a,month:l,day:c,...xj(t)}}function gQ(t){const{year:e,month:r,day:i}=t,n=lNe(e,r,i);return{year:e,ordinal:n,...xj(t)}}function p_e(t){const{year:e,ordinal:r}=t,{month:i,day:n}=cNe(e,r);return{year:e,month:i,day:n,...xj(t)}}function e_t(t){const e=bj(t.weekYear),r=M_(t.weekNumber,1,rz(t.weekYear)),i=M_(t.weekday,1,7);return e?r?i?!1:Rf("weekday",t.weekday):Rf("week",t.week):Rf("weekYear",t.weekYear)}function t_t(t){const e=bj(t.year),r=M_(t.ordinal,1,L5(t.year));return e?r?!1:Rf("ordinal",t.ordinal):Rf("year",t.year)}function uNe(t){const e=bj(t.year),r=M_(t.month,1,12),i=M_(t.day,1,tz(t.year,t.month));return e?r?i?!1:Rf("day",t.day):Rf("month",t.month):Rf("year",t.year)}function hNe(t){const{hour:e,minute:r,second:i,millisecond:n}=t,s=M_(e,0,23)||e===24&&r===0&&i===0&&n===0,o=M_(r,0,59),a=M_(i,0,59),l=M_(n,0,999);return s?o?a?l?!1:Rf("millisecond",n):Rf("second",i):Rf("minute",r):Rf("hour",e)}const AQ="Invalid DateTime",f_e=864e13;function W6(t){return new fm("unsupported zone",`the zone "${t.name}" is not supported`)}function yQ(t){return t.weekData===null&&(t.weekData=Hre(t.c)),t.weekData}function gI(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Ii({...r,...e,old:r})}function dNe(t,e,r){let i=t-e*60*1e3;const n=r.offset(i);if(e===n)return[i,e];i-=(n-e)*60*1e3;const s=r.offset(i);return n===s?[i,n]:[t-Math.min(n,s)*60*1e3,Math.max(n,s)]}function m_e(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function $k(t,e,r){return dNe(Mue(t),e,r)}function g_e(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),n=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,s={...t.c,year:i,month:n,day:Math.min(t.c.day,tz(i,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Nn.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=Mue(s);let[l,c]=dNe(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function AI(t,e,r,i,n,s){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0){const l=e||a,c=Ii.fromObject(t,{...r,zone:l,specificOffset:s});return o?c:c.setZone(a)}else return Ii.invalid(new fm("unparsable",`the input "${n}" can't be parsed as ${i}`))}function Q6(t,e,r=!0){return t.isValid?du.create(yo.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function _Q(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=Ya(t.c.year,r?6:4),e?(i+="-",i+=Ya(t.c.month),i+="-",i+=Ya(t.c.day)):(i+=Ya(t.c.month),i+=Ya(t.c.day)),i}function A_e(t,e,r,i,n,s){let o=Ya(t.c.hour);return e?(o+=":",o+=Ya(t.c.minute),(t.c.second!==0||!r)&&(o+=":")):o+=Ya(t.c.minute),(t.c.second!==0||!r)&&(o+=Ya(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=Ya(t.c.millisecond,3))),n&&(t.isOffsetFixed&&t.offset===0&&!s?o+="Z":t.o<0?(o+="-",o+=Ya(Math.trunc(-t.o/60)),o+=":",o+=Ya(Math.trunc(-t.o%60))):(o+="+",o+=Ya(Math.trunc(t.o/60)),o+=":",o+=Ya(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const pNe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},r_t={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},i_t={ordinal:1,hour:0,minute:0,second:0,millisecond:0},fNe=["year","month","day","hour","minute","second","millisecond"],n_t=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],s_t=["year","ordinal","hour","minute","second","millisecond"];function y_e(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new gLe(t);return e}function __e(t,e){const r=Cb(e.zone,Wa.defaultZone),i=yo.fromObject(e),n=Wa.now();let s,o;if(In(t.year))s=n;else{for(const c of fNe)In(t[c])&&(t[c]=pNe[c]);const a=uNe(t)||hNe(t);if(a)return Ii.invalid(a);const l=r.offset(n);[s,o]=$k(t,l,r)}return new Ii({ts:s,zone:r,loc:i,o})}function v_e(t,e,r){const i=In(r.round)?!0:r.round,n=(o,a)=>(o=Cue(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),s=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return n(s(r.unit),r.unit);for(const o of r.units){const a=s(o);if(Math.abs(a)>=1)return n(a,o)}return n(t>e?-0:0,r.units[r.units.length-1])}function b_e(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class Ii{constructor(e){const r=e.zone||Wa.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new fm("invalid input"):null)||(r.isValid?null:W6(r));this.ts=In(e.ts)?Wa.now():e.ts;let n=null,s=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[n,s]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);n=m_e(this.ts,a),i=Number.isNaN(n.year)?new fm("invalid input"):null,n=i?null:n,s=i?null:a}this._zone=r,this.loc=e.loc||yo.create(),this.invalid=i,this.weekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new Ii({})}static local(){const[e,r]=b_e(arguments),[i,n,s,o,a,l,c]=r;return __e({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=b_e(arguments),[i,n,s,o,a,l,c]=r;return e.zone=mu.utcInstance,__e({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=OAt(e)?e.valueOf():NaN;if(Number.isNaN(i))return Ii.invalid("invalid input");const n=Cb(r.zone,Wa.defaultZone);return n.isValid?new Ii({ts:i,zone:n,loc:yo.fromObject(r)}):Ii.invalid(W6(n))}static fromMillis(e,r={}){if(rS(e))return e<-f_e||e>f_e?Ii.invalid("Timestamp out of range"):new Ii({ts:e,zone:Cb(r.zone,Wa.defaultZone),loc:yo.fromObject(r)});throw new _f(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(rS(e))return new Ii({ts:e*1e3,zone:Cb(r.zone,Wa.defaultZone),loc:yo.fromObject(r)});throw new _f("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=Cb(r.zone,Wa.defaultZone);if(!i.isValid)return Ii.invalid(W6(i));const n=Wa.now(),s=In(r.specificOffset)?i.offset(n):r.specificOffset,o=iz(e,y_e),a=!In(o.ordinal),l=!In(o.year),c=!In(o.month)||!In(o.day),u=l||c,d=o.weekYear||o.weekNumber,p=yo.fromObject(r);if((u||a)&&d)throw new l4("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new l4("Can't mix ordinal dates with month/day");const A=d||o.weekday&&!u;let v,b,S=m_e(n,s);A?(v=n_t,b=r_t,S=Hre(S)):a?(v=s_t,b=i_t,S=gQ(S)):(v=fNe,b=pNe);let E=!1;for(const U of v){const q=o[U];In(q)?E?o[U]=b[U]:o[U]=S[U]:E=!0}const R=A?e_t(o):a?t_t(o):uNe(o),O=R||hNe(o);if(O)return Ii.invalid(O);const I=A?d_e(o):a?p_e(o):o,[N,L]=$k(I,s,i),B=new Ii({ts:N,zone:i,o:L,loc:p});return o.weekday&&u&&e.weekday!==B.weekday?Ii.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${B.toISO()}`):B}static fromISO(e,r={}){const[i,n]=_yt(e);return AI(i,n,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,n]=vyt(e);return AI(i,n,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,n]=byt(e);return AI(i,n,r,"HTTP",r)}static fromFormat(e,r,i={}){if(In(e)||In(r))throw new _f("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=i,o=yo.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[a,l,c,u]=Kyt(o,e,r);return u?Ii.invalid(u):AI(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return Ii.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,n]=Myt(e);return AI(i,n,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new _f("need to specify a reason the DateTime is invalid");const i=e instanceof fm?e:new fm(e,r);if(Wa.throwOnInvalid)throw new aAt(i);return new Ii({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=nNe(e,yo.fromObject(r));return i?i.map(n=>n?n.val:null).join(""):null}static expandFormat(e,r={}){return rNe(du.parseFormat(e),yo.fromObject(r)).map(n=>n.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?yQ(this).weekYear:NaN}get weekNumber(){return this.isValid?yQ(this).weekNumber:NaN}get weekday(){return this.isValid?yQ(this).weekday:NaN}get ordinal(){return this.isValid?gQ(this.c).ordinal:NaN}get monthShort(){return this.isValid?q6.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?q6.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?q6.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?q6.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return WN(this.year)}get daysInMonth(){return tz(this.year,this.month)}get daysInYear(){return this.isValid?L5(this.year):NaN}get weeksInWeekYear(){return this.isValid?rz(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:n}=du.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:n}}toUTC(e=0,r={}){return this.setZone(mu.instance(e),r)}toLocal(){return this.setZone(Wa.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=Cb(e,Wa.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(r||i){const s=e.offset(this.ts),o=this.toObject();[n]=$k(o,s,e)}return gI(this,{ts:n,zone:e})}else return Ii.invalid(W6(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const n=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return gI(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=iz(e,y_e),i=!In(r.weekYear)||!In(r.weekNumber)||!In(r.weekday),n=!In(r.ordinal),s=!In(r.year),o=!In(r.month)||!In(r.day),a=s||o,l=r.weekYear||r.weekNumber;if((a||n)&&l)throw new l4("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&n)throw new l4("Can't mix ordinal dates with month/day");let c;i?c=d_e({...Hre(this.c),...r}):In(r.ordinal)?(c={...this.toObject(),...r},In(r.day)&&(c.day=Math.min(tz(c.year,c.month),c.day))):c=p_e({...gQ(this.c),...r});const[u,d]=$k(c,this.o,this.zone);return gI(this,{ts:u,o:d})}plus(e){if(!this.isValid)return this;const r=Nn.fromDurationLike(e);return gI(this,g_e(this,r))}minus(e){if(!this.isValid)return this;const r=Nn.fromDurationLike(e).negate();return gI(this,g_e(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=Nn.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?du.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):AQ}toLocaleString(e=ez,r={}){return this.isValid?du.create(this.loc.clone(r),e).formatDateTime(this):AQ}toLocaleParts(e={}){return this.isValid?du.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=_Q(this,o);return a+="T",a+=A_e(this,o,r,i,n,s),a}toISODate({format:e="extended"}={}){return this.isValid?_Q(this,e==="extended"):null}toISOWeekDate(){return Q6(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:n=!1,extendedZone:s=!1,format:o="extended"}={}){return this.isValid?(n?"T":"")+A_e(this,o==="extended",r,e,i,s):null}toRFC2822(){return Q6(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return Q6(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?_Q(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let n="HH:mm:ss.SSS";return(r||e)&&(i&&(n+=" "),r?n+="z":e&&(n+="ZZ")),Q6(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():AQ}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return Nn.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...i},s=PAt(r).map(Nn.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=kyt(a,l,s,n);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(Ii.now(),e,r)}until(e){return this.isValid?Jo.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(r)<=i&&i<=n.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||Ii.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(n=e.unit,s=void 0),v_e(r,this.plus(i),{...e,numeric:"always",units:n,unit:s})}toRelativeCalendar(e={}){return this.isValid?v_e(e.base||Ii.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(Ii.isDateTime))throw new _f("min requires all arguments be DateTimes");return s_e(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(Ii.isDateTime))throw new _f("max requires all arguments be DateTimes");return s_e(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:n=null,numberingSystem:s=null}=i,o=yo.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return iNe(o,e,r)}static fromStringExplain(e,r,i={}){return Ii.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return ez}static get DATE_MED(){return ALe}static get DATE_MED_WITH_WEEKDAY(){return uAt}static get DATE_FULL(){return yLe}static get DATE_HUGE(){return _Le}static get TIME_SIMPLE(){return vLe}static get TIME_WITH_SECONDS(){return bLe}static get TIME_WITH_SHORT_OFFSET(){return wLe}static get TIME_WITH_LONG_OFFSET(){return xLe}static get TIME_24_SIMPLE(){return TLe}static get TIME_24_WITH_SECONDS(){return SLe}static get TIME_24_WITH_SHORT_OFFSET(){return ELe}static get TIME_24_WITH_LONG_OFFSET(){return CLe}static get DATETIME_SHORT(){return MLe}static get DATETIME_SHORT_WITH_SECONDS(){return RLe}static get DATETIME_MED(){return OLe}static get DATETIME_MED_WITH_SECONDS(){return PLe}static get DATETIME_MED_WITH_WEEKDAY(){return hAt}static get DATETIME_FULL(){return ILe}static get DATETIME_FULL_WITH_SECONDS(){return $Le}static get DATETIME_HUGE(){return DLe}static get DATETIME_HUGE_WITH_SECONDS(){return LLe}}function yI(t){if(Ii.isDateTime(t))return t;if(t&&t.valueOf&&rS(t.valueOf()))return Ii.fromJSDate(t);if(t&&typeof t=="object")return Ii.fromObject(t);throw new _f(`Unknown datetime argument: ${t}, of type ${typeof t}`)}function o_t(t,e="system"){if(!t||!Xye.has(t.timeZone))return e;const r=Xye.get(t.timeZone);return l_t(t.timeZone)||t.respectsDaylightSaving?r:a_t(r)}function a_t(t){const e=Ii.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${mu.instance(-r).formatOffset(0,"narrow")}`}function l_t(t){return t.startsWith("UTC")}let Wv=class extends Qs(Je){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,r){const{timeZone:i,respectsDaylightSaving:n}=r;return{timeZone:i,respectsDaylightSaving:n}}readTimeZone(e,r){return"timeZoneIANA"in r?r.timeZoneIANA:o_t(r)}writeTimeZone(e,r){r.timeZoneIANA=e}equals(e){return!(k(e)||k(this.timeZone)||k(e.timeZone))&&this.timeZone===e.timeZone}};h([f()],Wv.prototype,"legacy",void 0),h([gt("legacy",["timeZone"])],Wv.prototype,"readLegacy",null),h([f({type:String,nonNullable:!0})],Wv.prototype,"timeZone",void 0),h([gt("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],Wv.prototype,"readTimeZone",null),h([Ct("timeZone")],Wv.prototype,"writeTimeZone",null),Wv=h([Q("esri.time.TimeReference")],Wv);const uO=Wv;let Yy=class extends Qs(Je){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};h([f()],Yy.prototype,"creatorField",void 0),h([f()],Yy.prototype,"creationDateField",void 0),h([f()],Yy.prototype,"editorField",void 0),h([f()],Yy.prototype,"editDateField",void 0),h([f()],Yy.prototype,"realm",void 0),h([f({type:uO})],Yy.prototype,"dateFieldsTimeReference",void 0),Yy=h([Q("esri.layers.support.EditFieldsInfo")],Yy);const c_t=Yy;let Yg=class extends Qs(Je){constructor(e){super(e)}};h([f({constructOnly:!0,json:{write:!0}})],Yg.prototype,"name",void 0),h([f({constructOnly:!0,json:{write:!0}})],Yg.prototype,"fields",void 0),h([f({constructOnly:!0,json:{write:!0}})],Yg.prototype,"isAscending",void 0),h([f({constructOnly:!0,json:{write:!0}})],Yg.prototype,"indexType",void 0),h([f({constructOnly:!0,json:{write:!0}})],Yg.prototype,"isUnique",void 0),h([f({constructOnly:!0,json:{write:!0}})],Yg.prototype,"description",void 0),Yg=h([Q("esri.layers.support.FeatureIndex")],Yg);const qre=new Hi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function u_t(t,e,r,i){const n=await ow(t);if(await $ue(t,e,i),!n.addAttachment)throw new pe(i,"Layer source does not support addAttachment capability");return n.addAttachment(e,r)}function $ue(t,e,r){const{attributes:i}=e,{objectIdField:n}=t;return t.get("capabilities.data.supportsAttachment")?e?i?n&&i[n]?Promise.resolve():Promise.reject(new pe(r,`feature is missing the identifying attribute ${n}`)):Promise.reject(new pe(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new pe(r,"A feature is required to add/delete/update attachments")):Promise.reject(new pe(r,"this layer doesn't support attachments"))}async function h_t(t,e,r,i,n){const s=await ow(t);if(await $ue(t,e,n),!s.updateAttachment)throw new pe(n,"Layer source does not support updateAttachment capability");return s.updateAttachment(e,r,i)}async function d_t(t,e,r){const i=await be(()=>import("./editingSupport-bcf3d3af.js"),["assets/editingSupport-bcf3d3af.js","assets/assetEditingSupport-2cebf928.js"]),n=await t.load();return i.applyEdits(n,n.source,e,r)}async function p_t(t,e,r,i){const n=await ow(t);if(await $ue(t,e,i),!n.deleteAttachments)throw new pe(i,"Layer source does not support deleteAttachments capability");return n.deleteAttachments(e,r)}async function f_t(t,e,r){const i=(await t.load({signal:e==null?void 0:e.signal})).source;if(!i.fetchRecomputedExtents)throw new pe(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(e)}async function m_t(t,e,r,i){var A,v;e=yte.from(e),await t.load();const n=t.source,s=t.capabilities;if(!((A=s==null?void 0:s.data)!=null&&A.supportsAttachment))throw new pe(i,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:u,start:d,where:p}=e;if(!((v=s==null?void 0:s.operations)!=null&&v.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(u==null?void 0:u.length)>0||c||d||p))throw new pe(i,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||p))throw new pe(i,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!n.queryAttachments)throw new pe(i,"Layer source does not support queryAttachments capability",e);return n.queryAttachments(e)}async function g_t(t,e,r,i){const n=await ow(t);if(!n.queryObjectIds)throw new pe(i,"Layer source does not support queryObjectIds capability");return n.queryObjectIds(xA.from(e)??t.createQuery(),r)}async function A_t(t,e,r,i){const n=await ow(t);if(!n.queryFeatureCount)throw new pe(i,"Layer source does not support queryFeatureCount capability");return n.queryFeatureCount(xA.from(e)??t.createQuery(),r)}async function y_t(t,e,r,i){const n=await ow(t);if(!n.queryExtent)throw new pe(i,"Layer source does not support queryExtent capability");return n.queryExtent(xA.from(e)??t.createQuery(),r)}async function __t(t,e,r,i){const n=await ow(t);if(!n.queryRelatedFeatures)throw new pe(i,"Layer source does not support queryRelatedFeatures capability");return n.queryRelatedFeatures(sO.from(e),r)}async function v_t(t,e,r,i){const n=await ow(t);if(!n.queryRelatedFeaturesCount)throw new pe(i,"Layer source does not support queryRelatedFeaturesCount capability");return n.queryRelatedFeaturesCount(sO.from(e),r)}async function b_t(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:r,updates:i}=await e.refresh();if(M(i)&&(t.sourceJSON={...t.sourceJSON,...i},t.read(i,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await fgt(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function w_t(t){const e=new xA,r=t.get("capabilities.data"),i=t.get("capabilities.query");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:n,timeExtent:s}=t;return e.timeExtent=n!=null&&s!=null?s.offset(-n.value,n.unit):s||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function mNe(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeGlobalID")return i.name}}function gNe(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeOID")return i.name}}function x_t(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function ow(t){return(await t.load()).source}async function T_t(t,e){if(!Un||Un.findCredential(t))return;let r;try{const i=await LOe(t,e);i&&(r=await Un.checkSignInStatus(`${i}/sharing`))}catch{}if(r)try{const i=M(e)?e.signal:null;await Un.getCredential(t,{signal:i})}catch{}}async function S_t(t,e){var n;const r=(n=t.parsedUrl)==null?void 0:n.path;if(!r)return;const i=t.editFieldsInfo;(t.userHasUpdateItemPrivileges||t.userHasFullEditingPrivileges&&t.capabilities.operations.supportsEditing||i!=null&&i.creatorField||i!=null&&i.editorField)&&await T_t(r,e)}function E_t(t){var e;return!((e=t.sourceJSON)!=null&&e.isMultiServicesView)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}let EC=class extends Qs(Je){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};h([f({type:String,json:{read:{source:"shapeAreaFieldName"}}})],EC.prototype,"shapeAreaField",void 0),h([f({type:String,json:{read:{source:"shapeLengthFieldName"}}})],EC.prototype,"shapeLengthField",void 0),h([f({type:String,json:{read:t=>Ytt.read(t)||Xtt.read(t)}})],EC.prototype,"units",void 0),EC=h([Q("esri.layers.support.GeometryFieldsInfo")],EC);const C_t=EC;var Wre;let CC=Wre=class extends Je{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new ur}clone(){return new Wre({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};h([f({type:String,json:{write:!0}})],CC.prototype,"floorField",void 0),h([f({json:{read:!1,write:!1}})],CC.prototype,"viewAllMode",void 0),h([f({json:{read:!1,write:!1}})],CC.prototype,"viewAllLevelIds",void 0),CC=Wre=h([Q("esri.layers.support.LayerFloorInfo")],CC);const M_t=CC,w_e=new Hi({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),x_e=new Hi({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let ef=class extends Qs(Je){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};h([f({json:{read:w_e.read,write:w_e.write}})],ef.prototype,"cardinality",void 0),h([f({json:{read:!0,write:!0}})],ef.prototype,"composite",void 0),h([f({json:{read:!0,write:!0}})],ef.prototype,"id",void 0),h([f({json:{read:!0,write:!0}})],ef.prototype,"keyField",void 0),h([f({json:{read:!0,write:!0}})],ef.prototype,"keyFieldInRelationshipTable",void 0),h([f({json:{read:!0,write:!0}})],ef.prototype,"name",void 0),h([f({json:{read:!0,write:!0}})],ef.prototype,"relatedTableId",void 0),h([f({json:{read:!0,write:!0}})],ef.prototype,"relationshipTableId",void 0),h([f({json:{read:x_e.read,write:x_e.write}})],ef.prototype,"role",void 0),ef=h([Q("esri.layers.support.Relationship")],ef);const R_t=ef,O_t={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function zr(t,e,r){return!!(t&&t.hasOwnProperty(e)?t[e]:r)}function Y6(t,e,r){return t&&t.hasOwnProperty(e)?t[e]:r}function P_t(t){var r;const e=(r=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:r.map(i=>i.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function XN(t,e){var i;const r=(i=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:i.map(n=>n.toLowerCase());return!!(r!=null&&r.includes(e.toLowerCase()))}function ANe(t,e){return{analytics:I_t(t),attachment:$_t(t),data:D_t(t),metadata:L_t(t),operations:N_t(t.capabilities,t,e),query:F_t(t,e),queryRelated:k_t(t),queryTopFeatures:U_t(t),editing:B_t(t)}}function I_t(t){return{supportsCacheHint:XN(t.advancedQueryCapabilities,"queryAnalytics")}}function $_t(t){const e=t.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:XN(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:zr(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(i=>{const n=O_t[i.name];n&&(r[n]=!!i.isEnabled)}),r}function D_t(t){return{isVersioned:zr(t,"isDataVersioned",!1),supportsAttachment:zr(t,"hasAttachments",!1),supportsM:zr(t,"hasM",!1),supportsZ:zr(t,"hasZ",!1)}}function L_t(t){return{supportsAdvancedFieldProperties:zr(t,"supportsFieldDescriptionProperty",!1)}}function N_t(t,e,r){const i=t?t.toLowerCase().split(",").map(p=>p.trim()):[],n=r?hP(r):null,s=i.includes(M(n)&&n.serverType==="MapServer"?"data":"query"),o=i.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&i.includes("create"),l=o&&i.includes("delete"),c=o&&i.includes("update");const u=i.includes("changetracking"),d=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:zr(e,"supportsCalculate",!1),supportsTruncate:zr(e,"supportsTruncate",!1),supportsValidateSql:zr(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:u,supportsQuery:s,supportsQueryAnalytics:zr(d,"supportsQueryAnalytic",!1),supportsQueryAttachments:zr(d,"supportsQueryAttachments",!1),supportsQueryTopFeatures:zr(d,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:zr(e,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:zr(e,"supportsExceedsLimitStatistics",!1)}}function F_t(t,e){const r=t.advancedQueryCapabilities,i=t.ownershipBasedAccessControlForFeatures,n=t.archivingInfo,s=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||s>=Fe("mapserver-pbf-version-support"),l=cLe(e),c=new Set((t.supportedQueryFormats??"").split(",").map(u=>u.toLowerCase().trim()));return{supportsStatistics:zr(r,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:zr(r,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:zr(r,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:P_t(r),supportsCentroid:zr(r,"supportsReturningGeometryCentroid",!1),supportsDistance:zr(r,"supportsQueryWithDistance",!1),supportsDistinct:zr(r,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:zr(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:zr(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:zr(r,"supportsHavingClause",!1),supportsOrderBy:zr(r,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:zr(r,"supportsPagination",!1),supportsQuantization:zr(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:zr(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:zr(t,"supportsReturningQueryGeometry",!1),supportsResultType:zr(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:zr(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:zr(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:zr(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:zr(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:zr(i,"allowOthersToQuery",!0),supportsHistoricMoment:zr(n,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:zr(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:zr(r,"supportsQueryWithCacheHint",!1)||XN(r,"query"),supportsDefaultSpatialReference:zr(r,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:zr(r,"supportsFullTextSearch",!1),maxRecordCountFactor:Y6(t,"maxRecordCountFactor",void 0),maxRecordCount:Y6(t,"maxRecordCount",void 0),standardMaxRecordCount:Y6(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:Y6(t,"tileMaxRecordCount",void 0)}}function k_t(t){const e=t.advancedQueryCapabilities,r=zr(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:zr(e,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:XN(e,"queryRelated")}}function U_t(t){return{supportsCacheHint:XN(t.advancedQueryCapabilities,"queryTopFilter")}}function B_t(t){const e=t.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:zr(t,"allowGeometryUpdates",!0),supportsGlobalId:zr(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:zr(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:zr(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:zr(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:zr(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:zr(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:zr(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:zr(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:zr(e,"allowOthersToUpdate",!0)}}const z_t=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=St.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(ur.ofType(Yg)),this.version=void 0}readCapabilitiesFromService(r,i){return ANe(i,this.url)}get effectiveCapabilities(){var o;const r=this.capabilities;if(!r)return null;const i=Te(r),{operations:n,editing:s}=i;return(o=this.sourceJSON)!=null&&o.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(n.supportsQuery=!0),i):this.userHasUpdateItemPrivileges?(n.supportsAdd=n.supportsDelete=n.supportsEditing=n.supportsQuery=n.supportsUpdate=s.supportsDeleteByOthers=s.supportsGeometryUpdate=s.supportsUpdateByOthers=!0,i):(this.userHasFullEditingPrivileges&&n.supportsEditing&&(n.supportsAdd=n.supportsDelete=n.supportsUpdate=s.supportsGeometryUpdate=!0),i)}readEditingInfo(r,i){const{editingInfo:n}=i;return n?{lastEditDate:n.lastEditDate!=null?new Date(n.lastEditDate):null}:null}readIsTableFromService(r,i){return i.type==="Table"}readMinScale(r,i){return i.effectiveMinScale||r||0}readMaxScale(r,i){return i.effectiveMaxScale||r||0}readGlobalIdFieldFromService(r,i){return mNe(i)}readObjectIdFieldFromService(r,i){return gNe(i)}readServiceDefinitionExpression(r,i){return i.definitionQuery||i.definitionExpression}set url(r){const i=kgt({layer:this,url:r,nonStandardUrlAllowed:!0,logger:we.getLogger(this.declaredClass)});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,n,s){Ugt(this,r,null,i,s)}readVersion(r,i){return x_t(i)}};return h([f({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),h([gt("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),h([f({readOnly:!0})],e.prototype,"effectiveCapabilities",null),h([f({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),h([f({type:uO})],e.prototype,"dateFieldsTimeReference",void 0),h([f({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),h([f({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),h([f({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),h([f({readOnly:!0,type:c_t})],e.prototype,"editFieldsInfo",void 0),h([f({readOnly:!0})],e.prototype,"editingInfo",void 0),h([gt("editingInfo")],e.prototype,"readEditingInfo",null),h([f((()=>{const r=Te(rAt),i=r.json.origins;return i["web-map"]={read:!1,write:!1},i["portal-item"]={read:!1,write:!1},r})())],e.prototype,"elevationInfo",void 0),h([f({type:M_t,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],e.prototype,"floorInfo",void 0),h([f({type:an,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),h([f()],e.prototype,"gdbVersion",void 0),h([f({readOnly:!0,type:C_t,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),h([f({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:qre.read}}}})],e.prototype,"geometryType",void 0),h([f({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),h([f({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),h([f({readOnly:!0,type:iP})],e.prototype,"heightModelInfo",void 0),h([f({type:Date})],e.prototype,"historicMoment",void 0),h([f({readOnly:!0})],e.prototype,"isTable",void 0),h([gt("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),h([f({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),h([f(sAt)],e.prototype,"minScale",void 0),h([gt("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),h([f(oAt)],e.prototype,"maxScale",void 0),h([gt("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),h([f({type:String})],e.prototype,"globalIdField",void 0),h([gt("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),h([f({type:String})],e.prototype,"objectIdField",void 0),h([gt("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),h([f({type:uO})],e.prototype,"preferredTimeReference",void 0),h([f({type:[R_t],readOnly:!0})],e.prototype,"relationships",void 0),h([f()],e.prototype,"sourceJSON",void 0),h([f({type:Boolean})],e.prototype,"returnM",void 0),h([f({type:Boolean})],e.prototype,"returnZ",void 0),h([f({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),h([gt("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),h([f({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),h([f({type:St,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),h([f({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),h([f({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),h([f({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),h([f({type:ur.ofType(Yg),readOnly:!0})],e.prototype,"indexes",void 0),h([f(eAt)],e.prototype,"url",null),h([Ct("url")],e.prototype,"writeUrl",null),h([f({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),h([gt("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=h([Q("esri.layers.mixins.FeatureLayerBase")],e),e};let MC=class extends Qs(Je){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};h([f({type:String,json:{write:!0}})],MC.prototype,"expression",void 0),h([f({type:String,json:{write:!0}})],MC.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],MC.prototype,"returnType",void 0),MC=h([Q("esri.layers.support.ExpressionInfo")],MC);const Due=MC;var Qre;let Xy=Qre=class extends Je{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new Qre({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:Te(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};h([f({type:Boolean,json:{write:!0}})],Xy.prototype,"isAutoGenerated",void 0),h([f({type:String,json:{write:!0}})],Xy.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],Xy.prototype,"alias",void 0),h([f({type:String,json:{write:!0}})],Xy.prototype,"onStatisticField",void 0),h([f({type:Due,json:{write:!0}})],Xy.prototype,"onStatisticExpression",void 0),h([f({type:String,json:{write:!0}})],Xy.prototype,"statisticType",void 0),Xy=Qre=h([Q("esri.layers.support.AggregateField")],Xy);const FS=Xy;let p2=class extends Je{constructor(){super(...arguments),this.type=null}};h([f({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],p2.prototype,"type",void 0),p2=h([Q("esri.layers.support.FeatureReduction")],p2);const Lue="__begin__",Nue="__end__",V_t=new RegExp(Lue,"ig"),G_t=new RegExp(Nue,"ig"),T_e=new RegExp("^"+Lue,"i"),S_e=new RegExp(Nue+"$","i"),nz='"',j_t=nz+" + ",H_t=" + "+nz;function q_t(t){return t.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function W_t(t){return t.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function Tj(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=q_t(t.labelExpression),e.type="conventional"),e}function Q_t(t){const e=Tj(t);if(!e)return null;switch(e.type){case"conventional":return Yre(e.expression);case"arcade":return e.expression}return null}function Y_t(t){const e=Tj(t);if(!e)return null;switch(e.type){case"conventional":return Z_t(e.expression);case"arcade":return Fue(e.expression)}return null}function Yre(t){let e;return t?(e=PA(t,r=>Lue+'$feature["'+r+'"]'+Nue),e=T_e.test(e)?e.replace(T_e,""):nz+e,e=S_e.test(e)?e.replace(S_e,""):e+nz,e=e.replace(V_t,j_t).replace(G_t,H_t)):e='""',e}const X_t=/^\s*\{([^}]+)\}\s*$/i;function Z_t(t){const e=t==null?void 0:t.match(X_t);return e&&e[1].trim()||null}const J_t=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,K_t=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,e1t=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function Fue(t){if(!t)return null;let e=J_t.exec(t)||K_t.exec(t);return e?e[1]||e[3]:(e=e1t.exec(t),e?e[2]:null)}var Xre;let Qv=Xre=class extends Je{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?Yre(e.value):t}writeExpression(t,e,r){this.value!=null&&(t=Yre(this.value)),t!=null&&(e[r]=t)}clone(){return new Xre({expression:this.expression,title:this.title,value:this.value})}};h([f({type:String,json:{write:{writerEnsuresNonNull:!0}}})],Qv.prototype,"expression",void 0),h([gt("expression",["expression","value"])],Qv.prototype,"readExpression",null),h([Ct("expression")],Qv.prototype,"writeExpression",null),h([f({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Qv.prototype,"title",void 0),h([f({json:{read:!1,write:!1}})],Qv.prototype,"value",void 0),Qv=Xre=h([Q("esri.layers.support.LabelExpressionInfo")],Qv);const yNe=Qv,_Ne=[252,146,31,255],qlr=[153,153,153,255],t1t={type:"esriSMS",style:"esriSMSCircle",size:6,color:_Ne,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},r1t={type:"esriSLS",style:"esriSLSSolid",width:.75,color:_Ne},i1t={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},n1t={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},s1t={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},o1t={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},a1t={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},Wlr=nw.fromJSON(t1t),Qlr=i0.fromJSON(r1t),Ylr=iw.fromJSON(i1t),l1t=rP.fromJSON(n1t);nw.fromJSON(s1t);i0.fromJSON(o1t);iw.fromJSON(a1t);var Zre;const X6=new Hi({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function Z6(t,e,r){return{enabled:!$Oe(r==null?void 0:r.layer)}}function vNe(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function c1t(t){return(t==null?void 0:t.type)==="map-image"}function bNe(t){var e,r;return!!c1t(t)&&!!((r=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&r.supportsArcadeExpressionForLabeling)}function u1t(t){return vNe(t)||bNe(t==null?void 0:t.layer)}let Qo=Zre=class extends Je{static evaluateWhere(t,e){const r=(i,n,s)=>{switch(n){case"=":return i==s;case"<>":return i!=s;case">":return i>s;case">=":return i>=s;case"<":return i<s;case"<=":return i<=s}return!1};try{if(t==null)return!0;const i=t.split(" ");if(i.length===3)return r(e[i[0]],i[1],i[2]);if(i.length===7){const n=r(e[i[0]],i[1],i[2]),s=i[3],o=r(e[i[4]],i[5],i[6]);switch(s){case"AND":return n&&o;case"OR":return n||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=l1t,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const r=e.labelExpressionInfo;if(!r||!r.value&&!r.expression)return t}writeLabelExpression(t,e,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=W_t(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=Fue(this.labelExpressionInfo.expression);i&&(t="["+i+"]")}}t!=null&&(e[r]=t)}writeLabelExpressionInfo(t,e,r,i){if(t==null&&this.labelExpression!=null&&vNe(i))t=new yNe({expression:this.getLabelExpressionArcade()});else if(!t)return;const n=t.toJSON(i);n.expression&&(e[r]=n)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return Tj(this)}getLabelExpressionArcade(){return Q_t(this)}getLabelExpressionSingleField(){return Y_t(this)}hash(){return JSON.stringify(this)}clone(){return new Zre({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:Te(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:Te(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};h([f({type:String,json:{write:!0}})],Qo.prototype,"name",void 0),h([f({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:Z6}}}}})],Qo.prototype,"allowOverrun",void 0),h([f({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:Z6}}}}})],Qo.prototype,"deconflictionStrategy",void 0),h([f({type:String,json:{write:{overridePolicy(t,e,r){return this.labelExpressionInfo&&(r==null?void 0:r.origin)==="service"&&bNe(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],Qo.prototype,"labelExpression",void 0),h([gt("labelExpression")],Qo.prototype,"readLabelExpression",null),h([Ct("labelExpression")],Qo.prototype,"writeLabelExpression",null),h([f({type:yNe,json:{write:{overridePolicy:(t,e,r)=>u1t(r)?{allowNull:!0}:{enabled:!1}}}})],Qo.prototype,"labelExpressionInfo",void 0),h([Ct("labelExpressionInfo")],Qo.prototype,"writeLabelExpressionInfo",null),h([f({type:X6.apiValues,json:{type:X6.jsonValues,read:X6.read,write:X6.write}})],Qo.prototype,"labelPlacement",void 0),h([f({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Qo.prototype,"labelPosition",void 0),h([f({type:Number})],Qo.prototype,"maxScale",void 0),h([Ct("maxScale")],Qo.prototype,"writeMaxScale",null),h([f({type:Number})],Qo.prototype,"minScale",void 0),h([Ct("minScale")],Qo.prototype,"writeMinScale",null),h([f({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:Z6}}}}})],Qo.prototype,"repeatLabel",void 0),h([f({type:Number,cast:Tn,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:Z6}}}}})],Qo.prototype,"repeatLabelDistance",void 0),h([f({types:Oot,json:{origins:{"web-scene":{types:Pot,write:Tye,default:null}},write:Tye,default:null}})],Qo.prototype,"symbol",void 0),h([f({type:Boolean,json:{write:!0}})],Qo.prototype,"useCodedValues",void 0),h([f({type:String,json:{write:!0}})],Qo.prototype,"where",void 0),Qo=Zre=h([Q("esri.layers.support.LabelClass")],Qo);const Sj=Qo;var Jre;const vQ=J2({types:GG}),h1t="esri.layers.support.FeatureReductionBinning";let Vu=Jre=class extends p2{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,r){const i=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());wu(r,i,e)}readRenderer(t,e,r){var n;const i=(n=e.drawingInfo)==null?void 0:n.renderer;return i?KB(i,e,r)??void 0:e.defaultSymbol?e.types&&e.types.length?new HN({defaultSymbol:vQ(e.defaultSymbol,e,r),field:e.typeIdField,uniqueValueInfos:e.types.map(s=>({id:s.id,symbol:vQ(s.symbol,s,r)}))}):new aO({symbol:vQ(e.defaultSymbol,e,r)}):null}clone(){return new Jre({fields:Te(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:Te(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:Te(this.popupTemplate),renderer:Te(this.renderer)})}};h([nr({binning:"binning"})],Vu.prototype,"type",void 0),h([nr({geohash:"geohash"})],Vu.prototype,"binType",void 0),h([f({type:Number,range:{min:1,max:9},json:{write:!0}})],Vu.prototype,"fixedBinLevel",void 0),h([f({type:[Sj],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Vu.prototype,"labelingInfo",void 0),h([f(Sue)],Vu.prototype,"labelsVisible",void 0),h([f({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Vu.prototype,"maxScale",void 0),h([f(Tue)],Vu.prototype,"popupEnabled",void 0),h([f({type:JO,json:{name:"popupInfo",write:!0}})],Vu.prototype,"popupTemplate",void 0),h([f({type:[FS],json:{write:!0}})],Vu.prototype,"fields",void 0),h([Ct("fields")],Vu.prototype,"writeFields",null),h([f({types:_j,json:{write:{target:"drawingInfo.renderer"}}})],Vu.prototype,"renderer",void 0),h([gt("renderer",["drawingInfo.renderer"])],Vu.prototype,"readRenderer",null),Vu=Jre=h([Q(h1t)],Vu);const wNe=Vu;var Kre;const bQ=J2({types:GG}),d1t="esri.layers.support.FeatureReductionCluster";function E_e(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let Ba=Kre=class extends Je{constructor(t){super(t),this.type="cluster",this.clusterRadius=Tn("80px"),this.clusterMinSize=Tn("12px"),this.clusterMaxSize=Tn("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,r){var n,s;const i=(n=e.drawingInfo)==null?void 0:n.renderer;return(s=i==null?void 0:i.authoringInfo)!=null&&s.isAutoGenerated?null:i?E_e(i)?null:KB(i,e,r)??void 0:e.defaultSymbol?e.types&&e.types.length?new HN({defaultSymbol:bQ(e.defaultSymbol,e,r),field:e.typeIdField,uniqueValueInfos:e.types.map(o=>({id:o.id,symbol:bQ(o.symbol,o,r)}))}):new aO({symbol:bQ(e.defaultSymbol,e,r)}):null}readSymbol(t,e,r){var n,s,o;const i=(n=e.drawingInfo)==null?void 0:n.renderer;return(s=i==null?void 0:i.authoringInfo)!=null&&s.isAutoGenerated?null:i&&E_e(i)?(o=KB(i,e,r))==null?void 0:o.symbol:null}writeSymbol(t,e,r,i){var s,o;const n=(o=(s=this.renderer)==null?void 0:s.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||n){const a=new aO({symbol:t});e.drawingInfo={renderer:a.write({},i)}}}writeFields(t,e,r){const i=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());wu(r,i,e)}readFields(t,e,r){return t.filter(i=>!i.isAutoGenerated).map(i=>FS.fromJSON(i))}clone(){return new Kre({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:Te(this.labelingInfo),labelsVisible:this.labelsVisible,fields:Te(this.fields),maxScale:this.maxScale,renderer:Te(this.renderer),symbol:Te(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:Te(this.popupTemplate)})}};h([f({type:["cluster"],readOnly:!0,json:{write:!0}})],Ba.prototype,"type",void 0),h([f({type:Number,cast:t=>t==="auto"?t:Tn(t),json:{write:!0}})],Ba.prototype,"clusterRadius",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],Ba.prototype,"clusterMinSize",void 0),h([f({type:Number,cast:Tn,json:{write:!0}})],Ba.prototype,"clusterMaxSize",void 0),h([f({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Ba.prototype,"maxScale",void 0),h([f(Tue)],Ba.prototype,"popupEnabled",void 0),h([f({type:JO,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Ba.prototype,"popupTemplate",void 0),h([f({types:_j,json:{write:{target:"drawingInfo.renderer"}}})],Ba.prototype,"renderer",void 0),h([gt("renderer",["drawingInfo.renderer"])],Ba.prototype,"readRenderer",null),h([f({types:Mot})],Ba.prototype,"symbol",void 0),h([gt("symbol",["drawingInfo.renderer"])],Ba.prototype,"readSymbol",null),h([Ct("symbol")],Ba.prototype,"writeSymbol",null),h([f({type:[Sj],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ba.prototype,"labelingInfo",void 0),h([f(Sue)],Ba.prototype,"labelsVisible",void 0),h([f({type:[FS],json:{write:!0}})],Ba.prototype,"fields",void 0),h([Ct("fields")],Ba.prototype,"writeFields",null),h([gt("fields")],Ba.prototype,"readFields",null),Ba=Kre=h([Q(d1t)],Ba);const xNe=Ba;var eie;let Dk=eie=class extends p2{constructor(t){super(t),this.type="selection"}clone(){return new eie}};h([f({type:["selection"]})],Dk.prototype,"type",void 0),Dk=eie=h([Q("esri.layers.support.FeatureReductionSelection")],Dk);const C_e=Dk,M_e={key:"type",base:p2,typeMap:{cluster:xNe,binning:wNe}},p1t={types:{key:"type",base:p2,typeMap:{selection:C_e,cluster:xNe,binning:wNe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:M_e},"portal-item":{types:M_e},"web-scene":{types:{key:"type",base:p2,typeMap:{selection:C_e}}}}}},YE={Base64:0,Hex:1,String:2,Raw:3},nR=8,TNe=(1<<nR)-1;function Xb(t,e){const r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function f1t(t){const e=[];for(let r=0,i=t.length*nR;r<i;r+=nR)e[r>>5]|=(t.charCodeAt(r/nR)&TNe)<<r%32;return e}function m1t(t){const e=[];for(let r=0,i=32*t.length;r<i;r+=nR)e.push(String.fromCharCode(t[r>>5]>>>r%32&TNe));return e.join("")}function g1t(t){const e="0123456789abcdef",r=[];for(let i=0,n=4*t.length;i<n;i++)r.push(e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15));return r.join("")}function A1t(t){const e="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(let n=0,s=4*t.length;n<s;n+=3){const o=(t[n>>2]>>n%4*8&255)<<16|(t[n+1>>2]>>(n+1)%4*8&255)<<8|t[n+2>>2]>>(n+2)%4*8&255;for(let a=0;a<4;a++)8*n+6*a>32*t.length?i.push(e):i.push(r.charAt(o>>6*(3-a)&63))}return i.join("")}function y1t(t,e){return t<<e|t>>>32-e}function Ej(t,e,r,i,n,s){return Xb(y1t(Xb(Xb(e,t),Xb(i,s)),n),r)}function Hc(t,e,r,i,n,s,o){return Ej(e&r|~e&i,t,e,n,s,o)}function qc(t,e,r,i,n,s,o){return Ej(e&i|r&~i,t,e,n,s,o)}function Wc(t,e,r,i,n,s,o){return Ej(e^r^i,t,e,n,s,o)}function Qc(t,e,r,i,n,s,o){return Ej(r^(e|~i),t,e,n,s,o)}function _1t(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let r=1732584193,i=-271733879,n=-1732584194,s=271733878;for(let o=0;o<t.length;o+=16){const a=r,l=i,c=n,u=s;r=Hc(r,i,n,s,t[o+0],7,-680876936),s=Hc(s,r,i,n,t[o+1],12,-389564586),n=Hc(n,s,r,i,t[o+2],17,606105819),i=Hc(i,n,s,r,t[o+3],22,-1044525330),r=Hc(r,i,n,s,t[o+4],7,-176418897),s=Hc(s,r,i,n,t[o+5],12,1200080426),n=Hc(n,s,r,i,t[o+6],17,-1473231341),i=Hc(i,n,s,r,t[o+7],22,-45705983),r=Hc(r,i,n,s,t[o+8],7,1770035416),s=Hc(s,r,i,n,t[o+9],12,-1958414417),n=Hc(n,s,r,i,t[o+10],17,-42063),i=Hc(i,n,s,r,t[o+11],22,-1990404162),r=Hc(r,i,n,s,t[o+12],7,1804603682),s=Hc(s,r,i,n,t[o+13],12,-40341101),n=Hc(n,s,r,i,t[o+14],17,-1502002290),i=Hc(i,n,s,r,t[o+15],22,1236535329),r=qc(r,i,n,s,t[o+1],5,-165796510),s=qc(s,r,i,n,t[o+6],9,-1069501632),n=qc(n,s,r,i,t[o+11],14,643717713),i=qc(i,n,s,r,t[o+0],20,-373897302),r=qc(r,i,n,s,t[o+5],5,-701558691),s=qc(s,r,i,n,t[o+10],9,38016083),n=qc(n,s,r,i,t[o+15],14,-660478335),i=qc(i,n,s,r,t[o+4],20,-405537848),r=qc(r,i,n,s,t[o+9],5,568446438),s=qc(s,r,i,n,t[o+14],9,-1019803690),n=qc(n,s,r,i,t[o+3],14,-187363961),i=qc(i,n,s,r,t[o+8],20,1163531501),r=qc(r,i,n,s,t[o+13],5,-1444681467),s=qc(s,r,i,n,t[o+2],9,-51403784),n=qc(n,s,r,i,t[o+7],14,1735328473),i=qc(i,n,s,r,t[o+12],20,-1926607734),r=Wc(r,i,n,s,t[o+5],4,-378558),s=Wc(s,r,i,n,t[o+8],11,-2022574463),n=Wc(n,s,r,i,t[o+11],16,1839030562),i=Wc(i,n,s,r,t[o+14],23,-35309556),r=Wc(r,i,n,s,t[o+1],4,-1530992060),s=Wc(s,r,i,n,t[o+4],11,1272893353),n=Wc(n,s,r,i,t[o+7],16,-155497632),i=Wc(i,n,s,r,t[o+10],23,-1094730640),r=Wc(r,i,n,s,t[o+13],4,681279174),s=Wc(s,r,i,n,t[o+0],11,-358537222),n=Wc(n,s,r,i,t[o+3],16,-722521979),i=Wc(i,n,s,r,t[o+6],23,76029189),r=Wc(r,i,n,s,t[o+9],4,-640364487),s=Wc(s,r,i,n,t[o+12],11,-421815835),n=Wc(n,s,r,i,t[o+15],16,530742520),i=Wc(i,n,s,r,t[o+2],23,-995338651),r=Qc(r,i,n,s,t[o+0],6,-198630844),s=Qc(s,r,i,n,t[o+7],10,1126891415),n=Qc(n,s,r,i,t[o+14],15,-1416354905),i=Qc(i,n,s,r,t[o+5],21,-57434055),r=Qc(r,i,n,s,t[o+12],6,1700485571),s=Qc(s,r,i,n,t[o+3],10,-1894986606),n=Qc(n,s,r,i,t[o+10],15,-1051523),i=Qc(i,n,s,r,t[o+1],21,-2054922799),r=Qc(r,i,n,s,t[o+8],6,1873313359),s=Qc(s,r,i,n,t[o+15],10,-30611744),n=Qc(n,s,r,i,t[o+6],15,-1560198380),i=Qc(i,n,s,r,t[o+13],21,1309151649),r=Qc(r,i,n,s,t[o+4],6,-145523070),s=Qc(s,r,i,n,t[o+11],10,-1120210379),n=Qc(n,s,r,i,t[o+2],15,718787259),i=Qc(i,n,s,r,t[o+9],21,-343485551),r=Xb(r,a),i=Xb(i,l),n=Xb(n,c),s=Xb(s,u)}return[r,i,n,s]}function SNe(t,e=YE.Hex){const r=e||YE.Base64,i=_1t(f1t(t),t.length*nR);switch(r){case YE.Raw:return i;case YE.Hex:return g1t(i);case YE.String:return m1t(i);case YE.Base64:return A1t(i)}}var tie;let u4=tie=class extends yj{writeLevels(t,e,r){for(const i in t){const n=this.levels[i];return void(e.stops=n)}}clone(){return new tie({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Yb(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Yb(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:Te(this.levels)})}};h([f()],u4.prototype,"levels",void 0),h([Ct("levels")],u4.prototype,"writeLevels",null),u4=tie=h([Q("esri.views.2d.engine.LevelDependentSizeVariable")],u4);const v1t=we.getLogger("esri.views.2d.layers.support.clusterUtils");Fe.add("esri-cluster-arcade-enabled",!0);const b1t=Fe("esri-cluster-arcade-enabled"),w1t=(t,e,r,i,n)=>{const s=e.clone();if(!E1t(s))return s;if(s.authoringInfo||(s.authoringInfo=new gue),s.authoringInfo.isAutoGenerated=!0,"visualVariables"in s){const o=(s.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=x1t(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=Ew(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=_I(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=Ew(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=Ew(t,l.field,"avg","number"):l.valueExpression&&(l.field=_I(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),k(a)&&!T1t(o)&&n&&(o.push(S1t(r,i)),s.dynamicClusterSize=!0),s.visualVariables=o}switch(s.type){case"simple":break;case"pie-chart":for(const o of s.attributes)o.field?o.field=Ew(t,o.field,"sum","number"):o.valueExpression&&(o.field=_I(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":s.field?s.field=Ew(t,s.field,"mode","string"):s.valueExpression&&(s.field=_I(t,s.valueExpression,"mode","string"),s.valueExpression=null);break;case"class-breaks":s.normalizationField?(s.field=Ew(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=Ew(t,s.field,"avg","number"):s.valueExpression&&(s.field=_I(t,s.valueExpression,"avg","number"),s.valueExpression=null)}return s},x1t=t=>{for(const e of t)if(e.type==="size")return e;return null},T1t=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},S1t=(t,e)=>{const r=[new vC({value:0,size:0}),new vC({value:1})];if(k(e))return new yj({field:"cluster_count",stops:[...r,new vC({value:2,size:0})]});const i=Object.keys(e).reduce((n,s)=>({...n,[s]:[...r,new vC({value:Math.max(2,e[s].minValue),size:t.clusterMinSize}),new vC({value:Math.max(3,e[s].maxValue),size:t.clusterMaxSize})]}),{});return new u4({field:"cluster_count",levels:i})},E1t=t=>{const e=r=>v1t.error(new pe("Unsupported-renderer",r,{renderer:t}));switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const r=t.normalizationType;if(r!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!b1t){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(r=>!(!("valueExpression"in r)||!r.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function C1t(t,e,r){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const i=r,n="field",s=e.toLowerCase()+",norm:"+n+","+i.toLowerCase();return"cluster_avg_"+SNe(s)}}}function _I(t,e,r,i){const n=SNe(e),s=r==="mode"?`cluster_type_${n}`:r==="sum"?`cluster_sum_${n}`:`cluster_avg_${n}`;return t.some(o=>o.name===s)||t.push(new FS({name:s,isAutoGenerated:!0,onStatisticExpression:new Due({expression:e,returnType:i}),statisticType:r})),s}function Ew(t,e,r,i,n){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const s=C1t(r,e,n);return t.some(o=>o.name===s)||(r==="avg_norm"?t.push(new FS({name:s,isAutoGenerated:!0,onStatisticExpression:new Due({expression:`$feature.${e} / $feature.${n}`,returnType:i}),statisticType:"avg"})):t.push(new FS({name:s,isAutoGenerated:!0,onStatisticField:e,statisticType:r}))),s}const M1t=t=>{let e=class extends t{constructor(...r){super(...r),this.own(this.watch("renderer",()=>{if(this.featureReduction){const i=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",i)}},!0))}set featureReduction(r){const i=this._normalizeFeatureReduction(r);this._set("featureReduction",i)}set renderer(r){}_normalizeFeatureReduction(r){var a;if((r==null?void 0:r.type)!=="cluster")return r;const i=r.clone(),n=[new FS({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],s=(i.fields??[]).filter(l=>!l.isAutoGenerated);if(r.renderer&&!((a=r.renderer.authoringInfo)!=null&&a.isAutoGenerated))return i.fields=[...n,...s],i;if(r.symbol)return i.fields=[...n,...s],i.renderer=null,i;if(!this.renderer)return r;const o=w1t(n,this.renderer,r,null,!1);return i.fields=[...n,...s],i.renderer=o,i}};return h([f(p1t)],e.prototype,"featureReduction",null),e=h([Q("esri.layers.mixins.FeatureReductionLayer")],e),e},R1t={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}},O1t=t=>{let e=class extends t{constructor(){super(...arguments),this.title=null}writeListMode(r,i,n,s){(s&&s.layerContainerType==="ground"||r&&Bet(this,n,{},s))&&(i[n]=r)}writeOperationalLayerType(r,i,n,s){!r||s&&s.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r??"Layer"}read(r,i){i&&(i.layer=this),Fet(this,r,n=>super.read(r,n),i)}write(r,i){var o,a;if(i!=null&&i.origin){const l=`${i.origin}/${i.layerContainerType||"operational-layers"}`,c=R1t[l];let u=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(u=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(u=!1),!u)return(o=i.messages)==null||o.push(new pe("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const n=super.write(r,{...i,layer:this}),s=!!i&&!!i.messages&&!!i.messages.filter(l=>l instanceof pe&&l.name==="web-document-write:property-required").length;return UR(n==null?void 0:n.url)?((a=i==null?void 0:i.messages)==null||a.push(new pe("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&s?null:n}beforeSave(){}};return h([f({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),h([f(mLe)],e.prototype,"listMode",void 0),h([Ct("listMode")],e.prototype,"writeListMode",null),h([f({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],e.prototype,"operationalLayerType",void 0),h([Ct("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),h([f(Ure)],e.prototype,"opacity",void 0),h([f({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),h([Ct("title"),Ct(["web-scene"],"title")],e.prototype,"writeTitle",null),h([f({type:Boolean,json:{name:"visibility"}})],e.prototype,"visible",void 0),e=h([Q("esri.layers.mixins.OperationalLayer")],e),e};var rie;const wQ=new Hi({asc:"ascending",desc:"descending"});let RC=rie=class extends Je{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new rie({field:this.field,valueExpression:this.valueExpression,order:this.order})}};h([f({type:String,json:{write:!0}})],RC.prototype,"field",void 0),h([f({type:String,json:{write:!0}})],RC.prototype,"valueExpression",void 0),h([f({type:wQ.apiValues,json:{read:wQ.read,write:wQ.write}})],RC.prototype,"order",void 0),RC=rie=h([Q("esri.layers.support.OrderByInfo")],RC);const ENe=RC;function P1t(t,e,r){if(!t)return null;const i=t.find(s=>!!s.field);if(!i)return null;const n=new ENe;return n.read(i,r),[n]}function I1t(t,e,r,i){const n=t.find(s=>!!s.field);n&&wu(r,[n.toJSON()],e)}const $1t=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return h([f({type:[ENe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:P1t},write:{target:"layerDefinition.orderBy",writer:I1t}}})],e.prototype,"orderBy",void 0),e=h([Q("esri.layers.mixins.OrderedLayer")],e),e};async function D1t(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return mM(t);const r=St.WGS84;return await Bat(e,r),vE(t,r)}function Xlr(t,e){if(!L1t(t,e)){const r=t.typeKeywords;r?r.push(e):t.typeKeywords=[e]}}function L1t(t,e){var r;return!!((r=t.typeKeywords)!=null&&r.includes(e))}function Zlr(t,e){const r=t.typeKeywords;if(r){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}async function Jlr(t){const e=t.clone().normalize();let r;if(e.length>1)for(const i of e)r?i.width>r.width&&(r=i):r=i;else r=e[0];return D1t(r)}const Klr={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"};function R_e(t){var l;const{portal:e,isOrgItem:r,itemControl:i}=t,n=(l=e.user)==null?void 0:l.privileges;let s=!n||n.includes("features:user:edit"),o=!!r&&!!(n!=null&&n.includes("features:user:fullEdit"));const a=i==="update"||i==="admin";return a?o=s=!0:o&&(s=!0),{features:{edit:s,fullEdit:o},content:{updateItem:a}}}const N1t=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=yt(this.portalItem)}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,n){if(i.itemId)return new y5({id:i.itemId,portal:n&&n.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const n=await be(()=>import("./layersLoader-dae6ab5f.js"),["assets/layersLoader-dae6ab5f.js","assets/fetchService-c1a8c74f.js","assets/jsonContext-7b58d0bd.js"]);return fi(i),await n.load({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(n){throw $o(n)||we.getLogger(this.declaredClass).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(Jh(i),!0)))}async _setUserPrivileges(r,i){if(!gn.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(i);if(this.url)try{const{features:{edit:n,fullEdit:s},content:{updateItem:o}}=await this._fetchUserPrivileges(r,i);this._set("userHasEditingPrivileges",n),this._set("userHasFullEditingPrivileges",s),this._set("userHasUpdateItemPrivileges",o)}catch(n){Jh(n)}}async _fetchUserPrivileges(r,i){let n=this.portalItem;if(!r||!n||!n.loaded||n.sourceUrl)return this._fetchFallbackUserPrivileges(i);const s=r===n.id;if(s&&n.portal.user)return R_e(n);let o,a;if(s)o=n.portal.url;else try{o=await LOe(this.url,i)}catch(d){Jh(d)}if(!o||!dtt(o,n.portal.url))return this._fetchFallbackUserPrivileges(i);try{const d=M(i)?i.signal:null;a=await(Un==null?void 0:Un.getCredential(`${o}/sharing`,{prompt:!1,signal:d}))}catch(d){Jh(d)}const l=!0,c=!1,u=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:u}};try{if(s?await n.reload():(n=new y5({id:r,portal:{url:o}}),await n.load(i)),n.portal.user)return R_e(n)}catch(d){Jh(d)}return{features:{edit:l,fullEdit:c},content:{updateItem:u}}}async _fetchFallbackUserPrivileges(r){let i=!0;try{i=await this._fetchUserHasEditingPrivileges(r)}catch(n){Jh(n)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const i=this.url?Un==null?void 0:Un.findCredential(this.url):null;if(!i)return!0;const n=J6.credential===i?J6.user:await this._fetchEditingUser(r);return J6.credential=i,J6.user=n,k(n)||n.privileges==null||n.privileges.includes("features:user:edit")}async _fetchEditingUser(r){var u,d;const i=(d=(u=this.portalItem)==null?void 0:u.portal)==null?void 0:d.user;if(i)return i;const n=Un.findServerInfo(this.url??"");if(!(n!=null&&n.owningSystemUrl))return null;const s=`${n.owningSystemUrl}/sharing/rest`,o=mh.getDefault();if(o&&o.loaded&&wm(o.restUrl)===wm(s))return o.user;const a=`${s}/community/self`,l=M(r)?r.signal:null,c=await Pm(ns(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?Sle.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const n=i&&i.portal,s=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||mh.getDefault());return n&&s&&!ZRe(s.restUrl,n.restUrl)?(i.messages&&i.messages.push(new pe("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return h([f({type:y5})],e.prototype,"portalItem",null),h([gt("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),h([Ct("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),h([f({clonable:!1})],e.prototype,"resourceReferences",void 0),h([f({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),h([f({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),h([f({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=h([Q("esri.layers.mixins.PortalLayer")],e),e},J6={credential:null,user:null};let h4=class extends rt{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};h([f()],h4.prototype,"updating",void 0),h([f()],h4.prototype,"status",void 0),h4=h([Q("esri.layers.support.PublishingInfo")],h4);const F1t=h4,CNe="esri.layers.mixins.PublishableLayer",k1t=Symbol(CNe),U1t=t=>{var e;let r=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const i=this._get("publishingInfo");if(i)return i;const n=new F1t;return this._checkPublishingStatus(n),n}_checkPublishingStatus(i){let o=0;const a=async c=>{let u;i.updating=!0;try{u=await this.fetchPublishingStatus()}catch{u="unavailable"}u!=="published"&&u!=="unavailable"||(i.status==="publishing"&&this.refresh(),l.remove()),i.status=u,i.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return e=k1t,h([f({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=h([Q(CNe)],r),r},hL=new ur,F5=new WeakMap;function B1t(t){MNe(t)&&hL.push(t)}function z1t(t){MNe(t)&&hL.includes(t)&&hL.remove(t)}function MNe(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function RNe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:RNe(e,t%e):0}let xQ=0,K6=0;function V1t(){const t=Date.now();for(const e of hL)e.refreshInterval&&t-(F5.get(e)??0)+5>=6e4*e.refreshInterval&&(F5.set(e,t),e.refresh(t))}mRe(()=>{const t=Date.now();let e=0;for(const r of hL)e=RNe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?F5.get(r)||F5.set(r,t):F5.delete(r);if(e!==K6){if(K6=e,clearInterval(xQ),K6===0)return void(xQ=0);xQ=setInterval(V1t,K6)}});function G1t(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const j1t=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=lRe(()=>this.hasDataChanged()),this.when().then(()=>{B1t(this)},()=>{})}destroy(){z1t(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){jM(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{we.getLogger(this.declaredClass).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return h([f({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),h([f({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),h([f()],e.prototype,"refreshParameters",null),e=h([Q("esri.layers.mixins.RefreshableLayer")],e),e},ONe=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&H1t(r,i.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===r.minScale&&n.maxScale===r.maxScale?n:r}};return h([f({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),h([f({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=h([Q("esri.layers.mixins.ScaleRangeLayer")],e),e};function H1t(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}const PNe=$c()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let d4=class extends Qs(Je){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return f0t(this.value,this.unit,"milliseconds")}};h([nr(PNe,{nonNullable:!0})],d4.prototype,"unit",void 0),h([f({type:Number,json:{write:!0},nonNullable:!0})],d4.prototype,"value",void 0),d4=h([Q("esri.TimeInterval")],d4);const sz=d4;function O_e(t,e){return sz.fromJSON({value:t,unit:e})}let ru=class extends Qs(Je){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,r){if(!r.timeExtent||!Array.isArray(r.timeExtent)||r.timeExtent.length!==2)return null;const i=new Date(r.timeExtent[0]),n=new Date(r.timeExtent[1]);return new ey({start:i,end:n})}writeFullTimeExtent(e,r){e&&M(e.start)&&M(e.end)?r.timeExtent=[e.start.getTime(),e.end.getTime()]:r.timeExtent=null}readInterval(e,r){return r.timeInterval&&r.timeIntervalUnits?O_e(r.timeInterval,r.timeIntervalUnits):r.defaultTimeInterval&&r.defaultTimeIntervalUnits?O_e(r.defaultTimeInterval,r.defaultTimeIntervalUnits):null}writeInterval(e,r){r.timeInterval=(e==null?void 0:e.toJSON().value)??null,r.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};h([f({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],ru.prototype,"cumulative",void 0),h([f({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],ru.prototype,"endField",void 0),h([f({type:ey,json:{write:{enabled:!0,allowNull:!0}}})],ru.prototype,"fullTimeExtent",void 0),h([gt("fullTimeExtent",["timeExtent"])],ru.prototype,"readFullTimeExtent",null),h([Ct("fullTimeExtent")],ru.prototype,"writeFullTimeExtent",null),h([f({type:Boolean,json:{write:!0}})],ru.prototype,"hasLiveData",void 0),h([f({type:sz,json:{write:{enabled:!0,allowNull:!0}}})],ru.prototype,"interval",void 0),h([gt("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],ru.prototype,"readInterval",null),h([Ct("interval")],ru.prototype,"writeInterval",null),h([f({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],ru.prototype,"startField",void 0),h([f({type:uO,json:{write:{enabled:!0,allowNull:!0}}})],ru.prototype,"timeReference",void 0),h([f({type:String,json:{write:{enabled:!0,allowNull:!0}}})],ru.prototype,"trackIdField",void 0),h([f({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],ru.prototype,"useTime",void 0),ru=h([Q("esri.layers.support.TimeInfo")],ru);const INe=ru,q1t=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const n=i.timeInfo.exportOptions;if(!n)return null;const s=n.timeOffset,o=PNe.fromJSON(n.timeOffsetUnits);return s&&o?new sz({value:s,unit:o}):null}set timeInfo(r){EPe(r,this.fieldsIndex),this._set("timeInfo",r)}};return h([f({type:ey,json:{write:!1}})],e.prototype,"timeExtent",void 0),h([f({type:sz})],e.prototype,"timeOffset",void 0),h([gt("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),h([f({value:null,type:INe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),h([f({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=h([Q("esri.layers.mixins.TemporalLayer")],e),e},P_e=new Hi({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let Yv=class extends Qs(Je){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};h([f({json:{write:!0}})],Yv.prototype,"name",void 0),h([f({json:{write:!0}})],Yv.prototype,"description",void 0),h([f({json:{read:P_e.read,write:P_e.write}})],Yv.prototype,"drawingTool",void 0),h([f({json:{write:!0}})],Yv.prototype,"prototype",void 0),h([f({json:{write:!0}})],Yv.prototype,"thumbnail",void 0),Yv=h([Q("esri.layers.support.FeatureTemplate")],Yv);const kue=Yv;let Zy=class extends Qs(Je){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const r={};for(const i of Object.keys(e))r[i]=sue(e[i]);return r}writeDomains(e,r){var n;const i={};for(const s of Object.keys(e))e[s]&&(i[s]=(n=e[s])==null?void 0:n.toJSON());r.domains=i}};h([f({json:{write:!0}})],Zy.prototype,"id",void 0),h([f({json:{write:!0}})],Zy.prototype,"name",void 0),h([f({json:{write:!0}})],Zy.prototype,"domains",void 0),h([gt("domains")],Zy.prototype,"readDomains",null),h([Ct("domains")],Zy.prototype,"writeDomains",null),h([f({type:[kue],json:{write:!0}})],Zy.prototype,"templates",void 0),Zy=h([Q("esri.layers.support.FeatureType")],Zy);const $Ne=Zy;function W1t(t){return t.type==="date"||t.type==="esriFieldTypeDate"}function I_e(t){return t.type==="oid"||t.type==="esriFieldTypeOID"}function $_e(t){return t.type==="global-id"||t.type==="esriFieldTypeGlobalID"}let Q1t=class{constructor(e=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;this.fields=e;const r=[];for(const i of e){const n=i==null?void 0:i.name,s=L_e(i==null?void 0:i.name);if(n&&s){const o=D_e(n);this._fieldsMap.set(n,i),this._fieldsMap.set(o,i),this._normalizedFieldsMap.set(s,i),r.push(o),W1t(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):RG(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),I_e(i)||$_e(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)I_e(e)||$_e(e)||e.nullable||tst(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}has(e){return this.get(e)!=null}get(e){if(!e)return;let r=this._fieldsMap.get(e);return r||(r=this._fieldsMap.get(D_e(e))??this._normalizedFieldsMap.get(L_e(e)),r&&this._fieldsMap.set(e,r),r)}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const r=this.get(e);if(r)return r.name??void 0}};function D_e(t){return t.trim().toLowerCase()}function L_e(t){var e;return((e=qnt(t))==null?void 0:e.toLowerCase())??""}function Y1t(){return{fields:{type:[mj],value:null},fieldsIndex:{readOnly:!0,get(){return new Q1t(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!t||!t.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const r of t)((e=this.fieldsIndex)==null?void 0:e.has(r))||we.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${r} found in outFields`,{layer:this,outFields:t});return CPe(this.fieldsIndex,t)}}}}const TQ=we.getLogger("esri.layers.support.labelingInfo"),X1t=/\[([^\[\]]+)\]/gi;function N_e(t,e,r){return t?t.map(i=>{const n=new Sj;if(n.read(i,r),n.labelExpression){const s=e.fields||e.layerDefinition&&e.layerDefinition.fields||this.fields;n.labelExpression=n.labelExpression.replace(X1t,(o,a)=>`[${Z1t(a,s)}]`)}return n}):null}function Z1t(t,e){if(!e)return t;const r=t.toLowerCase();for(let i=0;i<e.length;i++){const n=e[i].name;if(n.toLowerCase()===r)return n}return t}const J1t={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function ocr(t,e){const r=Te(t);return r.some(i=>K1t(i,e))?[]:r}function K1t(t,e){const r=t.labelPlacement,i=J1t[e];if(!t.symbol)return TQ.warn("No ILabelClass symbol specified."),!0;if(!i)return TQ.error(new pe("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!i.includes(r)){const n=i[0];r&&TQ.warn(`Found invalid label placement type ${r} for ${e}. Defaulting to ${n}`),t.labelPlacement=n}return!1}const D0=[];function evt(t,e){if(cLe(t.url??""))return!0;const{wkid:r}=e;for(const i of D0){if((t.version??0)>=i[0])return!0;if(typeof i[1]=="function"&&(i[1]=i[1]()),i[1].has(r))return!1}return!0}D0.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102901;e<=102955;e++)t.add(e);return t}]),D0.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),D0.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),D0.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),D0.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),D0.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),D0.push([10.61,()=>new Set([102497])]),D0.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]),D0.push([10.51,()=>{const t=new Set([7683,7881,7886,7899,8888,9e3]);for(let e=8013;e<=8032;e++)t.add(e);for(let e=9053;e<=9057;e++)t.add(e);for(let e=104017;e<=104018;e++)t.add(e);for(let e=104971;e<=104974;e++)t.add(e);return t}]),D0.push([10.5,()=>{const t=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let e=4087;e<=4088;e++)t.add(e);for(let e=5896;e<=5899;e++)t.add(e);for(let e=7005;e<=7007;e++)t.add(e);for(let e=7057;e<=7070;e++)t.add(e);for(let e=7073;e<=7082;e++)t.add(e);for(let e=7109;e<=7128;e++)t.add(e);for(let e=7844;e<=7859;e++)t.add(e);return t}]);async function tvt(t,e,r){const i=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const n=await Pm(i.populateFromStyle());if(fi(r),n.ok===!1){const s=n.error;e&&e.messages&&e.messages.push(new IA("renderer:style-reference",`Failed to create unique value renderer from style reference: ${s.message}`,{error:s,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}const rvt=["oid","global-id"],ivt=["oid","global-id","guid"];function nvt({displayField:t,editFieldsInfo:e,fields:r,objectIdField:i,title:n},s){if(!r)return null;const o=uvt({editFieldsInfo:e,fields:r,objectIdField:i},s);if(!o.length)return null;const a=pvt({titleBase:n,fields:r,displayField:t}),l=dvt();return new JO({title:a,content:l,fieldInfos:o})}const svt=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],ovt=(t,{editFieldsInfo:e,objectIdField:r,visibleFieldNames:i})=>i?i.has(t.name):!DNe(t.name,e)&&(!r||t.name!==r)&&!rvt.includes(t.type)&&!svt.some(n=>n.test(t.name));function avt(t,e){const r=t;return e&&(t=t.filter(i=>!e.includes(i.type))),t===r&&(t=t.slice()),t.sort(lvt),t}function lvt(t,e){return t.type==="oid"?-1:e.type==="oid"?1:F_e(t)?-1:F_e(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function DNe(t,e){if(!t||!e)return!1;const{creationDateField:r,creatorField:i,editDateField:n,editorField:s}=e;return[r&&r.toLowerCase(),i&&i.toLowerCase(),n&&n.toLowerCase(),s&&s.toLowerCase()].includes(t.toLowerCase())}function cvt(t,e){return t.editable&&!ivt.includes(t.type)&&!DNe(t.name,e)}function uvt({editFieldsInfo:t,fields:e,objectIdField:r},i){return avt(e??[],(i==null?void 0:i.ignoreFieldTypes)||fvt).map(n=>new RN({fieldName:n.name,isEditable:cvt(n,t),label:n.alias,format:hvt(n),visible:ovt(n,{editFieldsInfo:t,objectIdField:r,visibleFieldNames:i==null?void 0:i.visibleFieldNames})}))}function hvt(t){switch(t.type){case"small-integer":case"integer":case"single":return new gM({digitSeparator:!0,places:0});case"double":return new gM({digitSeparator:!0,places:2});case"date":return new gM({dateFormat:"long-month-day-year"});default:return t.type==="string"&&$Pe(t.name)?new gM({digitSeparator:!0,places:0}):null}}function dvt(){return[new WR,new GD]}function pvt(t){const e=Ynt(t),{titleBase:r}=t;return e?`${r}: {${e.trim()}}`:r??""}function F_e(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const fvt=["geometry","blob","raster","guid","xml"],Pu="FeatureLayer",LNe="esri.layers.FeatureLayer",mvt=we.getLogger(LNe);function e8(t,e){return new pe("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function k_e(t){return t&&t instanceof ur}const SQ=Y1t();function EQ(t,e,r){const i=!!(r!=null&&r.writeLayerSchema);return{enabled:i,ignoreOrigin:i}}let or=class extends z_t(M1t(qgt(U1t(Ggt(uLe($1t(q1t(ONe(j1t(Bgt(O1t(N1t(KDe(zgt(Igt(Qs(zD))))))))))))))))){constructor(...e){super(...e),this._handles=new cn,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=St.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=yt(this._handles)}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}load(e){var n;const r=M(e)?e.signal:null;if((n=this.portalItem)!=null&&n.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(r).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(Jh).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstLayerId(r);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new pe("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(r))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>S_t(this,e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,r){return r=r.layerDefinition||r,ANe(r,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var e;return!(this.loaded&&!((e=this.capabilities)!=null&&e.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,r){return this._readEditingEnabled(r,!1)}readEditingEnabledFromWebMap(e,r,i){return this._readEditingEnabled(r,!0,i)}writeEditingEnabled(e,r){this._writeEditingEnabled(e,r,!1)}writeEditingEnabledToWebMap(e,r,i,n){this._writeEditingEnabled(e,r,!0,n)}get effectiveEditingEnabled(){return E_t(this)}readIsTable(e,r){return(r=(r==null?void 0:r.layerDefinition)??r).type==="Table"||!r.geometryType}writeIsTable(e,r,i,n){n!=null&&n.writeLayerSchema&&wu(i,e?"Table":"Feature Layer",r)}readGlobalIdField(e,r){return mNe(r.layerDefinition||r)}readObjectIdField(e,r){return gNe(r.layerDefinition||r)}get parsedUrl(){const e=Su(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=bS(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=bS(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){Age(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,r,i){var s;const n=(s=(r=r.layerDefinition||r).drawingInfo)==null?void 0:s.renderer;if(n){const o=KB(n,r,i)??void 0;return o||mvt.error("Failed to create renderer",{rendererDefinition:r.drawingInfo.renderer,layer:this,context:i}),o}if(r.defaultSymbol)return r.types&&r.types.length?new HN({defaultSymbol:CQ(r.defaultSymbol,r,i),field:r.typeIdField,uniqueValueInfos:r.types.map(o=>({id:o.id,symbol:CQ(o.symbol,o,i)}))}):new aO({symbol:CQ(r.defaultSymbol,r,i)})}set source(e){const r=this._get("source");r!==e&&(k_e(r)&&this._resetMemorySource(r),k_e(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof ur?new u_({layer:this,items:e}):e:null}readSource(e,r){const i=aue.fromJSON(r.featureSet);return new u_({layer:this,items:(i==null?void 0:i.features)??[]})}readTemplates(e,r){const i=r.editFieldsInfo,n=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map(o=>kue.fromJSON(o)),this._fixTemplates(e,n),this._fixTemplates(e,s),e}readTitle(e,r){var s;const i=((s=r.layerDefinition)==null?void 0:s.name)??r.name,n=r.title||r.layerDefinition&&r.layerDefinition.title;if(i){const o=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?Ngt(this.url,i):i;let a=i;if(!a&&this.url){const l=hP(this.url);M(l)&&(a=l.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&o&&o!==a&&(a=o+" - "+a),xue(a)):void 0}if(this.sublayerTitleMode==="item-title"&&n)return n}readTitleFromWebMap(e,r){return r.title||r.layerDefinition&&r.layerDefinition.name}readTypeIdField(e,r){let i=(r=r.layerDefinition||r).typeIdField;if(i&&r.fields){i=i.toLowerCase();const n=r.fields.find(s=>s.name.toLowerCase()===i);n&&(i=n.name)}return i}readTypes(e,r){e=(r=r.layerDefinition||r).types;const i=r.editFieldsInfo,n=i&&i.creatorField,s=i&&i.editorField;return e&&e.map(o=>(o=$Ne.fromJSON(o),this._fixTemplates(o.templates,n),this._fixTemplates(o.templates,s),o))}readVisible(e,r){return r.layerDefinition&&r.layerDefinition.defaultVisibility!=null?!!r.layerDefinition.defaultVisibility:r.visibility!=null?!!r.visibility:void 0}async addAttachment(e,r){return u_t(this,e,r,Pu)}async updateAttachment(e,r,i){return h_t(this,e,r,i,Pu)}async applyEdits(e,r){return d_t(this,e,r)}on(e,r){return super.on(e,r)}createPopupTemplate(e){return nvt(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:r}=await Qae(be(()=>import("./FeatureLayerSource-a84fe9fc.js"),["assets/FeatureLayerSource-a84fe9fc.js","assets/assetEditingSupport-2cebf928.js","assets/clientSideDefaults-c1df0f48.js","assets/QueryEngineCapabilities-42e44ded.js","assets/QueryTask-70b2bf38.js","assets/executeForIds-718b3472.js"]),e);return new r({layer:this}).load({signal:e})}createQuery(){const e=w_t(this);e.dynamicDataSource=this.dynamicDataSource;const r=M(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,i=mgt(this.definitionExpression,r);return e.where=i||"1=1",e}async deleteAttachments(e,r){return p_t(this,e,r,Pu)}async fetchRecomputedExtents(e){return f_t(this,e,Pu)}getFeatureType(e){const{typeIdField:r,types:i}=this;if(!r||!e)return null;const n=e.attributes?e.attributes[r]:void 0;if(n==null)return null;let s=null;return i==null||i.some(o=>{const{id:a}=o;return a!=null&&(a.toString()===n.toString()&&(s=o),!!s)}),s}getFieldDomain(e,r){const i=r&&r.feature,n=this.getFeatureType(i);if(n){const s=n.domains&&n.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,r){return m_t(this,e,r,Pu)}async queryFeatures(e,r){const i=await this.load(),n=await i.source.queryFeatures(xA.from(e)??i.createQuery(),r);if(n!=null&&n.features)for(const s of n.features)s.layer=s.sourceLayer=i;return n}async queryObjectIds(e,r){return g_t(this,e,r,Pu)}async queryFeatureCount(e,r){return A_t(this,e,r,Pu)}async queryExtent(e,r){return y_t(this,e,r,Pu)}async queryRelatedFeatures(e,r){return __t(this,e,r,Pu)}async queryRelatedFeaturesCount(e,r){return v_t(this,e,r,Pu)}async queryTopFeatures(e,r){var o;const{source:i,capabilities:n}=await this.load();if(!i.queryTopFeatures||!((o=n==null?void 0:n.query)!=null&&o.supportsTopFeaturesQuery))throw new pe(Pu,"Layer source does not support queryTopFeatures capability");const s=await i.queryTopFeatures(L6.from(e),r);if(s!=null&&s.features)for(const a of s.features)a.layer=a.sourceLayer=this;return s}async queryTopObjectIds(e,r){const{source:i,capabilities:n}=await this.load();if(!i.queryTopObjectIds||!(n!=null&&n.query.supportsTopFeaturesQuery))throw new pe(Pu,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(L6.from(e),r)}async queryTopFeaturesExtent(e,r){var s;const{source:i,capabilities:n}=await this.load();if(!i.queryTopExtents||!((s=n==null?void 0:n.query)!=null&&s.supportsTopFeaturesQuery))throw new pe(Pu,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(L6.from(e),r)}async queryTopFeatureCount(e,r){var s;const{source:i,capabilities:n}=await this.load();if(!i.queryTopCount||!((s=n==null?void 0:n.query)!=null&&s.supportsTopFeaturesQuery))throw new pe(Pu,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(L6.from(e),r)}read(e,r){const i=e.featureCollection;if(i){const n=i.layers;n&&n.length===1&&(super.read(n[0],r),i.showLegend!=null&&super.read({showLegend:i.showLegend},r))}super.read(e,r),r&&r.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,r){r={...r,origin:(r==null?void 0:r.origin)??void 0,writeLayerSchema:(r==null?void 0:r.writeLayerSchema)??this._hasMemorySource()};const{origin:i,layerContainerType:n,messages:s}=r;if(this.dynamicDataSource)return s==null||s.push(e8(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&n!=="tables")return s==null||s.push(e8(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(e8(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&n==="tables")return s==null||s.push(e8(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,r)}clone(){if(this._hasMemorySource())throw new pe(Pu,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){var r;return!!this.loaded&&(((r=this.source)==null?void 0:r.type)==="memory"||evt(this,e))}async save(e){return(await be(()=>import("./featureLayerUtils-d2306e21.js"),["assets/featureLayerUtils-d2306e21.js","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/fetchService-c1a8c74f.js","assets/jsonContext-7b58d0bd.js"])).save(this,e)}async saveAs(e,r){return(await be(()=>import("./featureLayerUtils-d2306e21.js"),["assets/featureLayerUtils-d2306e21.js","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/fetchService-c1a8c74f.js","assets/jsonContext-7b58d0bd.js"])).saveAs(this,e,r)}_readEditingEnabled(e,r,i){var s;let n=(s=e.layerDefinition)==null?void 0:s.capabilities;return n?this._hasEditingCapability(n):(n=e.capabilities,r&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&n?this._hasEditingCapability(n):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(r=>r.trim()).includes("editing")}_writeEditingEnabled(e,r,i,n){var s,o;if(!e){const a=(o=(s=this.capabilities)==null?void 0:s.operations)!=null&&o.supportsSync?"Query,Sync":"Query";wu("layerDefinition.capabilities",a,r),i&&!(n!=null&&n.writeLayerSchema)&&(r.capabilities=a)}}_getLayerDomain(e){const r=this.fieldsIndex.get(e);return r?r.domain:null}_fetchFirstLayerId(e){return ns(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(r=>{const i=r.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async initLayerProperties(e){var r;return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(r=this.portalItem)==null?void 0:r.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Age(this.renderer,this.fieldsIndex),EPe(this.timeInfo,this.fieldsIndex),tvt(this,{origin:"service"})}async hasDataChanged(){return b_t(this)}async fetchPublishingStatus(){const e=this.source;return e!=null&&e.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){var r,i;const e=((r=this.parsedUrl)==null?void 0:r.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||(i=this.fields)!=null&&i.some(n=>n.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,r){e&&e.forEach(i=>{const n=i.prototype&&i.prototype.attributes;n&&r&&delete n[r]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new pe("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new pe("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(r=>{r.layer=this,r.sourceLayer=this}),this._handles.add([e.on("after-add",r=>{r.item.layer=this,r.item.sourceLayer=this}),e.on("after-remove",r=>{r.item.layer=null,r.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(r=>{r.layer=null,r.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};h([gt("service","capabilities")],or.prototype,"readCapabilities",null),h([f({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],or.prototype,"charts",void 0),h([f({readOnly:!0})],or.prototype,"createQueryVersion",null),h([f({json:{read:{source:"layerDefinition.copyrightText"}}})],or.prototype,"copyright",void 0),h([f({json:{read:{source:"layerDefinition.displayField"}}})],or.prototype,"displayField",void 0),h([f({types:ZT,readOnly:!0})],or.prototype,"defaultSymbol",void 0),h([f({type:X0})],or.prototype,"dynamicDataSource",void 0),h([f({type:Boolean})],or.prototype,"editingEnabled",null),h([gt(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],or.prototype,"readEditingEnabled",null),h([gt("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],or.prototype,"readEditingEnabledFromWebMap",null),h([Ct(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],or.prototype,"writeEditingEnabled",null),h([Ct("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],or.prototype,"writeEditingEnabledToWebMap",null),h([f({readOnly:!0})],or.prototype,"effectiveEditingEnabled",null),h([f({...SQ.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:EQ}}}}})],or.prototype,"fields",void 0),h([f(SQ.fieldsIndex)],or.prototype,"fieldsIndex",void 0),h([f({type:Cgt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],or.prototype,"formTemplate",void 0),h([f({json:{read:{source:"layerDefinition.extent"}}})],or.prototype,"fullExtent",void 0),h([f({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:EQ,writer(t,e,r){const i=t?qre.toJSON(t):null;i&&wu(r,i,e)}}}},read:{source:"layerDefinition.geometryType",reader:qre.read}}})],or.prototype,"geometryType",void 0),h([f({json:{read:{source:"layerDefinition.hasM"}}})],or.prototype,"hasM",void 0),h([f({json:{read:{source:"layerDefinition.hasZ"}}})],or.prototype,"hasZ",void 0),h([f(nAt)],or.prototype,"id",void 0),h([f({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],or.prototype,"infoFor3D",void 0),h([f({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],or.prototype,"isTable",void 0),h([gt("service","isTable",["type","geometryType"]),gt("isTable",["layerDefinition.type","layerDefinition.geometryType"])],or.prototype,"readIsTable",null),h([Ct("web-map","isTable")],or.prototype,"writeIsTable",null),h([f(Sue)],or.prototype,"labelsVisible",void 0),h([f({type:[Sj],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:N_e},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:N_e},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],or.prototype,"labelingInfo",void 0),h([f((()=>{const t=Te(iAt);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,r,i){wu(i,MG(e),r)}}},t})())],or.prototype,"opacity",void 0),h([f(tAt)],or.prototype,"legendEnabled",void 0),h([f({type:["show","hide"],json:(()=>{const t=Te(mLe.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],or.prototype,"listMode",void 0),h([gt("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],or.prototype,"readGlobalIdField",null),h([f({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:EQ}}}}})],or.prototype,"objectIdField",void 0),h([gt("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],or.prototype,"readObjectIdField",null),h([f({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],or.prototype,"operationalLayerType",void 0),h([f(SQ.outFields)],or.prototype,"outFields",void 0),h([f({readOnly:!0})],or.prototype,"parsedUrl",null),h([f({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],or.prototype,"path",void 0),h([f(Tue)],or.prototype,"popupEnabled",void 0),h([f({type:JO,json:{name:"popupInfo",write:!0}})],or.prototype,"popupTemplate",void 0),h([f({readOnly:!0})],or.prototype,"defaultPopupTemplate",null),h([f({types:_j,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:ugt,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(t,e,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}})],or.prototype,"renderer",null),h([gt("service","renderer",["drawingInfo.renderer","defaultSymbol"]),gt("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],or.prototype,"readRenderer",null),h([f((()=>{const t=Te(Kgt);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],or.prototype,"screenSizePerspectiveEnabled",void 0),h([f({clonable:!1})],or.prototype,"source",null),h([Wr("source")],or.prototype,"castSource",null),h([gt("portal-item","source",["featureSet"]),gt("web-map","source",["featureSet"])],or.prototype,"readSource",null),h([f({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],or.prototype,"spatialReference",void 0),h([f({type:Number})],or.prototype,"subtypeCode",void 0),h([f({type:[kue]})],or.prototype,"templates",void 0),h([gt("templates",["editFieldsInfo","creatorField","editorField","templates"])],or.prototype,"readTemplates",null),h([f({type:INe})],or.prototype,"timeInfo",void 0),h([f()],or.prototype,"title",void 0),h([gt("service","title",["name"]),gt("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],or.prototype,"readTitle",null),h([gt("web-map","title",["layerDefinition.name","title"])],or.prototype,"readTitleFromWebMap",null),h([f({type:String})],or.prototype,"sublayerTitleMode",void 0),h([f({json:{read:!1}})],or.prototype,"type",void 0),h([f({type:String})],or.prototype,"typeIdField",void 0),h([gt("service","typeIdField"),gt("typeIdField",["layerDefinition.typeIdField"])],or.prototype,"readTypeIdField",null),h([f({type:[$Ne]})],or.prototype,"types",void 0),h([gt("service","types",["types"]),gt("types",["layerDefinition.types"])],or.prototype,"readTypes",null),h([f({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],or.prototype,"visible",void 0),h([gt("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],or.prototype,"readVisible",null),or=h([Q(LNe)],or);const CQ=J2({types:GG}),NNe=or,lcr=Object.freeze(Object.defineProperty({__proto__:null,default:NNe},Symbol.toStringTag,{value:"Module"})),gvt=["$datastore","$map","$layer","$aggregatedfeatures"],Avt="esri.widgets.Feature.support.arcadeFeatureUtils",yvt=we.getLogger(Avt);function _vt(t){return typeof t=="string"?UN(Xce(t)):Array.isArray(t)?vvt(t):(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?bvt(t):t}function vvt(t){return`<ul class="esri-widget__list">${t.map(e=>`<li>${typeof e=="string"?UN(Xce(e)):e}</li>`).join("")}</ul>`}function bvt(t){return`<table class="esri-widget__table">${t.keys().map(e=>{const r=t.field(e);return`<tr><th>${e}</th><td>${typeof r=="string"?UN(Xce(r)):r}</td></tr>`}).join("")}</table>`}function wvt({aggregatedFeatures:t,arcadeUtils:e,featureSetVars:r,context:i,viewInfo:n,map:s,graphic:o,interceptor:a}){r.forEach(l=>{const c=l.toLowerCase(),u=n.sr,d={map:s,spatialReference:u,interceptor:a};if(c==="$map"&&(i.vars[c]=e.convertMapToFeatureSetCollection(d)),c==="$layer"&&(i.vars[c]=e.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:u,interceptor:a})),c==="$datastore"&&(i.vars[c]=e.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:u,interceptor:a})),c==="$aggregatedfeatures"){const p=o.layer,{fields:A,objectIdField:v,geometryType:b,spatialReference:S,displayField:E}=p,R=new NNe({fields:A,objectIdField:v,geometryType:b,spatialReference:S,displayField:E,...p.type==="feature"?{templates:p.templates,typeIdField:p.typeIdField,types:p.types}:null,source:t});i.vars[c]=e.convertFeatureLayerToFeatureSet({layer:R,spatialReference:S,interceptor:a})}})}function FNe(){return be(()=>import("./arcadeUtils-12b7d488.js").then(t=>t.ax),["assets/arcadeUtils-12b7d488.js","assets/arcadeTimeUtils-80a905aa.js","assets/executionError-fb3f283a.js","assets/hash-0ddfbf4b.js"])}function xvt(t){return"createQuery"in t&&"queryFeatures"in t}async function Tvt({graphic:t,view:e}){const{isAggregate:r,layer:i}=t;if(!r||!i||(e==null?void 0:e.type)!=="2d")return[];const n=await e.whenLayerView(i);if(!xvt(n))return[];const s=n.createQuery(),o=t.getObjectId();s.aggregateIds=o!=null?[o]:[];const{features:a}=await n.queryFeatures(s);return a}async function kNe({expressionInfo:t,arcadeUtils:e,interceptor:r,spatialReference:i,map:n,graphic:s,view:o}){if(!t||!t.expression)return null;const a=e.createSyntaxTree(t.expression),l=gvt.filter(A=>e.hasVariable(a,A)),[c]=await Promise.all([Tvt({graphic:s,view:o}),e.loadScriptDependencies(a,!0,l)]),u=e.getViewInfo({spatialReference:i}),d=e.createExecContext(s,u);d.interceptor=r,d.useAsync=!0,wvt({aggregatedFeatures:c,arcadeUtils:e,featureSetVars:l,context:d,viewInfo:u,map:n,graphic:s,interceptor:r});const p=e.createFunction(a,d);return e.executeAsyncFunction(p,d).catch(A=>yvt.error("arcade-execution-error",{error:A,graphic:s,expressionInfo:t}))}async function Svt({expressionInfos:t,spatialReference:e,graphic:r,interceptor:i,map:n,view:s}){if(!t||!t.length)return{};const o=await FNe(),a={};for(const u of t)a[`expression/${u.name}`]=kNe({expressionInfo:u,arcadeUtils:o,interceptor:i,spatialReference:e,map:n,graphic:r,view:s});const l=await fh(a),c={};for(const u in l)c[u]=_vt(l[u].value);return c}const Evt=1;let Fd=class extends _E(rt){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:r}=this;r&&r.abort(),this._abortController=null},this._createVM=()=>{var n,s;const r=(n=this.contentElement)==null?void 0:n.type;(s=this.contentElementViewModel)==null||s.destroy();const i=r==="fields"?new dj:r==="media"?new kT:r==="text"?new YB:null;this._set("contentElementViewModel",i)},this._compile=async()=>{this._cancelQuery();const r=new AbortController;this._abortController=r,await this._compileExpression(),this._abortController===r&&(this._abortController=null)},this._compileThrottled=ZM(this._compile,Evt,this),this._compileExpression=async()=>{const{expressionInfo:r,graphic:i,interceptor:n,spatialReference:s,map:o,view:a,_abortController:l}=this;if(!(r&&i&&s&&o))return void this._set("contentElement",null);const c=await FNe();if(l!==this._abortController)return;const u=await kNe({arcadeUtils:c,expressionInfo:r,graphic:i,interceptor:n,map:o,spatialReference:s,view:a});if(!u||u.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const d=await u.castAsJsonAsync(l==null?void 0:l.signal),p=d==null?void 0:d.type,A=p==="media"?qD.fromJSON(d):p==="text"?QR.fromJSON(d):p==="fields"?WR.fromJSON(d):null;this._set("contentElement",A)},this.handles.add([xe(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),Rr),xe(()=>[this.contentElement],()=>this._createVM(),Rr)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:r,contentElementViewModel:i}=this;return e?"loading":r||i?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}};h([f()],Fd.prototype,"_abortController",void 0),h([f({type:DPe})],Fd.prototype,"expressionInfo",void 0),h([f({type:Pl})],Fd.prototype,"graphic",void 0),h([f({readOnly:!0})],Fd.prototype,"contentElement",void 0),h([f({readOnly:!0})],Fd.prototype,"contentElementViewModel",void 0),h([f()],Fd.prototype,"interceptor",void 0),h([f()],Fd.prototype,"spatialReference",null),h([f({readOnly:!0})],Fd.prototype,"state",null),h([f()],Fd.prototype,"map",null),h([f()],Fd.prototype,"view",void 0),Fd=h([Q("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],Fd);const Uue=Fd,t8={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let Lk=class extends Lc{constructor(e,r){super(e,r),this._contentWidget=null,this.viewModel=new Uue}initialize(){this.addHandles(xe(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),Rr))}destroy(){this._destroyContentWidget()}renderLoading(){return Ae("div",{key:"loading-container",class:t8.loadingSpinnerContainer},Ae("span",{class:this.classes(t8.iconLoading,t8.spinner)}))}render(){var r;const{state:e}=this.viewModel;return Ae("div",{class:t8.base},e==="loading"?this.renderLoading():e==="disabled"?null:(r=this._contentWidget)==null?void 0:r.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:r}=this.viewModel,i=r==null?void 0:r.type;this._destroyContentWidget();const n=e?i==="fields"?new z5e({viewModel:e}):i==="media"?new CDe({viewModel:e}):i==="text"?new hk({viewModel:e}):null:null;this._contentWidget=n,this.scheduleRender()}};h([f({type:Uue})],Lk.prototype,"viewModel",void 0),Lk=h([Q("esri.widgets.Feature.FeatureExpression")],Lk);const Cvt=Lk,MQ=100;let ys=class extends Qs(MN(_E(rt))){constructor(e){super(e),this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:r}=this;r&&r.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:r}=this;r&&r.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:r}=this;r&&r.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const r=new AbortController;this._queryAbortController=r,await jM(this._query()),this._queryAbortController===r&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._cancelQueryFeatureCount();const r=new AbortController;this._queryFeatureCountAbortController=r,await jM(this._queryFeatureCount()),this._queryFeatureCountAbortController===r&&(this._queryFeatureCountAbortController=null)},this._queryPageController=async()=>{const r=new AbortController;this._queryPageAbortController=r,await jM(this._queryPage()),this._queryPageAbortController===r&&(this._queryPageAbortController=null)},this._queryThrottled=ZM(this._queryController,MQ,this),this._queryFeatureCountThrottled=ZM(this._queryFeatureCountController,MQ,this),this._queryPageThrottled=ZM(this._queryPageController,MQ,this),this._query=async()=>{const{_queryAbortController:r,relatedFeatures:i}=this;this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.removeAll(),i.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:r==null?void 0:r.signal})))},this.handles.add([xe(()=>[this.displayCount,this.graphic,this.layer,this.map,this.orderByFieldsFixedCasing,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryThrottled(),Rr),xe(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageThrottled()),xe(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountThrottled())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:r,featureCount:i}=this,n=1,s=Math.ceil(i/r)||1;this._set("featurePage",Math.min(Math.max(e,n),s))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:r}=this;return e&&(r!=null&&r.loaded)?e.map(i=>{const n=i.clone(),s=aL(i.field,r);return n.field=s,n}):e??[]}get supportsCacheHint(){var e,r,i;return!!((i=(r=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:r.queryRelated)!=null&&i.supportsCacheHint)}get canQuery(){var r,i;const e=(i=(r=this.layer)==null?void 0:r.capabilities)==null?void 0:i.queryRelated;return!!(this.relatedLayer&&this.relationship&&typeof this.relationshipId=="number"&&typeof this.objectId=="number"&&(e!=null&&e.supportsCount)&&(e!=null&&e.supportsPagination))}get itemDescriptionFieldName(){var e,r;return((r=(e=this.orderByFieldsFixedCasing)==null?void 0:e[0])==null?void 0:r.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,r;return(this.objectIdField&&((r=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:r[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new ur}get relatedLayer(){const{layer:e,map:r,relationship:i}=this;return e!=null&&e.loaded&&r&&i?Wdt(r,e,i)??null:null}get relationship(){var i;const{relationshipId:e,layer:r}=this;return typeof e=="number"?((i=r==null?void 0:r.relationships)==null?void 0:i.find(({id:n})=>n===e))??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new ur}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:r,_queryPageAbortController:i,canQuery:n}=this;return r?"loading":e||i?"querying":n?"ready":"disabled"}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.forEach(r=>!r.destroyed&&r.destroy()),this.relatedFeatureViewModels.removeAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:r,relationshipId:i,objectId:n,_queryFeatureCountAbortController:s,canQuery:o,supportsCacheHint:a}=this;if(await(e==null?void 0:e.load()),await(r==null?void 0:r.load()),!o||!e||!r)return void this._set("featureCount",0);const l=r.createQuery(),c=new sO({cacheHint:a,relationshipId:i,returnGeometry:!1,objectIds:[n],where:dme(l.where,void 0)}),u=await e.queryRelatedFeaturesCount(c,{signal:s==null?void 0:s.signal});this._set("featureCount",u[n]||0)}_sliceFeatures(e){const{showAllEnabled:r,displayCount:i}=this;return r?e:i?e.slice(0,i):[]}async _queryPage(){const{relatedFeatures:e,featurePage:r,showAllEnabled:i,_queryPageAbortController:n}=this;!i||r<2||e.addMany(await this._queryRelatedFeatures({signal:n==null?void 0:n.signal}))}async _queryRelatedFeatures(e){var L;const{orderByFieldsFixedCasing:r,showAllEnabled:i,featuresPerPage:n,displayCount:s,layer:o,relationshipId:a,featurePage:l,featureCount:c,relatedLayer:u,supportsCacheHint:d}=this,{canQuery:p,objectId:A}=this;if(!p||!o||!u)return[];const v=i?((l-1)*n+c)%c:0,b=i?n:s,S=u.objectIdField,E=[...r==null?void 0:r.map(B=>B.field),S].filter(M),R=r==null?void 0:r.map(B=>`${B.field} ${B.order}`),O=u.createQuery(),I=new sO({orderByFields:R,start:v,num:b,outFields:E,cacheHint:d,relationshipId:a,returnGeometry:!1,objectIds:[A],where:dme(O.where,void 0)}),N=((L=(await o.queryRelatedFeatures(I,{signal:e==null?void 0:e.signal}))[A])==null?void 0:L.features)||[];return N.forEach(B=>{B.sourceLayer=u,B.layer=u}),N}};h([f()],ys.prototype,"_queryAbortController",void 0),h([f()],ys.prototype,"_queryPageAbortController",void 0),h([f()],ys.prototype,"_queryFeatureCountAbortController",void 0),h([f({value:1})],ys.prototype,"featurePage",null),h([f()],ys.prototype,"featuresPerPage",void 0),h([f({readOnly:!0})],ys.prototype,"orderByFieldsFixedCasing",null),h([f({readOnly:!0})],ys.prototype,"supportsCacheHint",null),h([f({readOnly:!0})],ys.prototype,"canQuery",null),h([f()],ys.prototype,"description",void 0),h([f({readOnly:!0})],ys.prototype,"itemDescriptionFieldName",null),h([f({value:3})],ys.prototype,"displayCount",null),h([f({type:Pl})],ys.prototype,"graphic",void 0),h([f()],ys.prototype,"layer",void 0),h([f()],ys.prototype,"map",void 0),h([f({readOnly:!0})],ys.prototype,"objectId",null),h([f({readOnly:!0})],ys.prototype,"objectIdField",null),h([f()],ys.prototype,"orderByFields",void 0),h([f({readOnly:!0})],ys.prototype,"relatedFeatures",null),h([f({readOnly:!0})],ys.prototype,"relatedLayer",null),h([f({readOnly:!0})],ys.prototype,"relationship",null),h([f()],ys.prototype,"featureCount",void 0),h([f({readOnly:!0})],ys.prototype,"relatedFeatureViewModels",null),h([f()],ys.prototype,"relationshipId",void 0),h([f()],ys.prototype,"showAllEnabled",void 0),h([f()],ys.prototype,"state",null),h([f()],ys.prototype,"title",void 0),ys=h([Q("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],ys);const Bue=ys,p4="esri-feature",RQ=`${p4}-relationship`,my={base:RQ,esriWidget:"esri-widget",listContainer:`${RQ}__list`,listContainerQuerying:`${RQ}__list--querying`,featureObserver:`${p4}__feature-observer`,stickySpinnerContainer:`${p4}__sticky-loading-container`,loadingSpinnerContainer:`${p4}__loading-container`,spinner:`${p4}__loading-spinner`,iconLoading:"esri-icon-loading-indicator esri-rotating"},U_e={title:!0,description:!0};let Gu=class extends Lc{constructor(e,r){super(e,r),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i!=null&&i.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Bue,this.messages=null,this.messagesCommon=null,this.visibleElements={...U_e},this._increaseFeaturePage=()=>{const{state:i,showAllEnabled:n,relatedFeatures:s,featuresPerPage:o,featurePage:a}=this.viewModel;i==="ready"&&n&&s.length>=o*a&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new hj,this.addHandles([xe(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),Rr),xe(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),Bo(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Promise.all([be(()=>import("./calcite-list-6dccee3c.js"),["assets/calcite-list-6dccee3c.js","assets/interactive-573cbe88.js","assets/observers-4f67f1fb.js","assets/utils3-1ce076c1.js","assets/loadable-25ad9e4e.js","assets/debounce-31e0cfcc.js","assets/t9n-5b86961d.js","assets/icon-3af55b58.js","assets/loader-a392da00.js","assets/guid-9426053f.js","assets/scrim-acdddd6b.js"]),be(()=>import("./calcite-list-item-127fdd5a.js"),["assets/calcite-list-item-127fdd5a.js","assets/interactive-573cbe88.js","assets/utils3-1ce076c1.js","assets/loadable-25ad9e4e.js","assets/icon-3af55b58.js","assets/observers-4f67f1fb.js"]),be(()=>import("./calcite-icon-2d1b5c98.js"),["assets/calcite-icon-2d1b5c98.js","assets/icon-3af55b58.js","assets/observers-4f67f1fb.js"]),be(()=>import("./calcite-notice-1f9400ce.js"),["assets/calcite-notice-1f9400ce.js","assets/observers-4f67f1fb.js","assets/loadable-25ad9e4e.js","assets/t9n-5b86961d.js","assets/icon-3af55b58.js"])])}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=yt(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:r,displayCount:i}=this.viewModel;return!e&&!!r&&(r>i||i===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:r}=this.viewModel;return Wg(r===1?e==null?void 0:e.numberRecord:e==null?void 0:e.numberRecords,{number:r})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...U_e,...e}}renderStickyLoading(){return this.viewModel.state==="querying"?Ae("div",{key:"sticky-loader",class:my.stickySpinnerContainer},this.renderLoadingIcon()):null}renderLoadingIcon(){return Ae("span",{class:this.classes(my.iconLoading,my.spinner)})}renderLoading(){return Ae("div",{key:"loading-container",class:my.loadingSpinnerContainer},this.renderLoadingIcon())}renderShowAllIconNode(){return Ae("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}renderChevronIconNode(){const e=pm(this.container)?"chevron-left":"chevron-right";return Ae("calcite-icon",{scale:"s",icon:e,slot:"content-end"})}renderRelatedFeature(e){var s,o;const{itemDescriptionFieldName:r}=this.viewModel,i=e.title;e.description=r&&((s=e.formattedAttributes)==null?void 0:s.global[r]);const n=e.state==="loading";return Ae("calcite-list-item",{key:e.uid,label:n?`${(o=this.messagesCommon)==null?void 0:o.loading}`:i,description:n?"":e.description??"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this.renderChevronIconNode())}renderShowAllListItem(){var e;return this.displayShowAllButton?Ae("calcite-list-item",{key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,description:this.featureCountDescription,onCalciteListItemSelect:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null}renderNoRelatedFeaturesMessage(){var e;return Ae("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},Ae("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}renderFeatureObserver(){return Ae("div",{key:"feature-observer",class:my.featureObserver,bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return Ae("calcite-list",null,e.toArray().map(r=>this.renderRelatedFeature(r)),this.renderShowAllListItem())}renderRelatedFeatures(){const{displayListItems:e}=this,{state:r}=this.viewModel;return Ae("div",{key:"list-container",class:this.classes(my.listContainer,{[my.listContainerQuerying]:r==="querying"})},e?this.renderList():r==="ready"?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}renderRelationshipNotFound(){var e;return Ae("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},Ae("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}render(){var r;const{state:e}=this.viewModel;return Ae("div",{class:this.classes(my.base,my.esriWidget)},(r=this._featureElementInfo)==null?void 0:r.render(),e==="loading"?this.renderLoading():e==="disabled"?this.renderRelationshipNotFound():this.renderRelatedFeatures())}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,r="related-feature-viewmodels";this.removeHandles(r),e==null||e.forEach(i=>{this.addHandles(xe(()=>[i.title,i.state],()=>this.scheduleRender(),Rr),r)}),this.scheduleRender()}_setupFeatureElementInfo(){var s;const{headingLevel:e,visibleElements:r}=this,i=r.description&&this.description,n=r.title&&this.title;(s=this._featureElementInfo)==null||s.set({description:i,title:n,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:r}=this.viewModel;await yS(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&r&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};h([f()],Gu.prototype,"_relatedFeatureIntersectionObserverNode",void 0),h([f({readOnly:!0})],Gu.prototype,"displayShowAllButton",null),h([f({readOnly:!0})],Gu.prototype,"displayListItems",null),h([f()],Gu.prototype,"description",null),h([f({readOnly:!0})],Gu.prototype,"featureCountDescription",null),h([f()],Gu.prototype,"headingLevel",void 0),h([f()],Gu.prototype,"title",null),h([f({type:Bue})],Gu.prototype,"viewModel",void 0),h([f(),tc("esri/widgets/Feature/t9n/Feature")],Gu.prototype,"messages",void 0),h([f(),tc("esri/t9n/common")],Gu.prototype,"messagesCommon",void 0),h([f()],Gu.prototype,"visibleElements",void 0),h([Wr("visibleElements")],Gu.prototype,"castVisibleElements",null),Gu=h([Q("esri.widgets.Feature.FeatureRelationship")],Gu);const B_e=Gu;let Mvt=class{constructor(e,r){this.preLayerQueryCallback=e,this.preRequestCallback=r,this.preLayerQueryCallback||(this.preLayerQueryCallback=i=>{}),this.preRequestCallback||(this.preLayerQueryCallback=i=>{})}};var f4;const Rvt=1,z_e="content-view-models",V_e="relationship-view-models",G_e={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let ro=f4=class extends MN(rt){constructor(t){super(t),this._handles=new cn,this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=ZM(this._graphicChanged,Rvt,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...G_e},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:r}=this;return e.type==="attachments"&&!!r.attachmentsContent||e.type==="custom"&&!!r.customContent||e.type==="fields"&&!!r.fieldsContent||e.type==="media"&&!!r.mediaContent||e.type==="text"&&!!r.textContent||e.type==="expression"&&!!r.expressionContent||e.type==="relationship"&&!!r.relationshipContent},this._handles.add(xe(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),Rr))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return M(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return Bdt(PAe(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return R5e(this.graphic)}castAbilities(t){return{...G_e,...t}}get isTable(){var t;return((t=this._sourceLayer)==null?void 0:t.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._set("graphic",t?t.clone():null)}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get map(){var t;return((t=this.view)==null?void 0:t.map)||null}set map(t){this._override("map",t)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(t,e){const r=this.contentViewModels[t];r instanceof kT&&r.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof kT&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof kT&&e.previous()}async updateGeometry(){var o,a;const{graphic:t,spatialReference:e,_sourceLayer:r}=this;await(r==null?void 0:r.load());const i=r==null?void 0:r.objectIdField;if(!i||!t||!r)return;const n=(o=t==null?void 0:t.attributes)==null?void 0:o[i];if(n==null)return;const s=[n];if(!t.geometry){const l=(a=await L5e({layer:r,graphic:t,outFields:[],objectIds:s,returnGeometry:!0,spatialReference:e}))==null?void 0:a.geometry;l&&(t.geometry=l)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:t}=this;if(!t)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(r){$o(r)||(this._error=r,we.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:r,graphic:t,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:t}=this;t&&t.abort(),this._featureAbortController=null}_compileContentElement(t,e){return t.type==="attachments"?this._compileAttachments(t,e):t.type==="custom"?this._compileCustom(t,e):t.type==="fields"?this._compileFields(t,e):t.type==="media"?this._compileMedia(t,e):t.type==="text"?this._compileText(t,e):t.type==="expression"?this._compileExpression(t,e):t.type==="relationship"?this._compileRelationship(t,e):void 0}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map((e,r)=>this._compileContentElement(e,r)).filter(M):typeof t=="string"?this._compileText(new QR({text:t}),0).text:t}_destroyContentViewModels(){var t,e;(t=this._handles)==null||t.remove(V_e),(e=this._handles)==null||e.remove(z_e),this.contentViewModels.forEach(r=>r&&!r.destroyed&&r.destroy()),this._set("contentViewModels",[])}_matchesFeature(t,e){var n;const r=(n=t==null?void 0:t.graphic)==null?void 0:n.getObjectId(),i=e==null?void 0:e.getObjectId();return M(r)&&M(i)&&r===i}_setRelatedFeaturesViewModels({relatedFeatureViewModels:t,relatedFeatures:e,map:r}){const{view:i,spatialReference:n}=this;e==null||e.filter(Boolean).forEach(s=>{t.find(o=>this._matchesFeature(o,s))||t.add(new f4({abilities:{relationshipContent:!1},map:r,view:i,spatialReference:n,graphic:s}))}),t.forEach(s=>{(e==null?void 0:e.find(a=>this._matchesFeature(s,a)))||t.remove(s)})}_setExpressionContentVM(t,e){const r=this.formattedAttributes,{contentElement:i,contentElementViewModel:n}=t,s=i==null?void 0:i.type;n&&s&&(s==="fields"&&(this._createFieldsFormattedAttributes({contentElement:i,contentElementIndex:e,formattedAttributes:r}),n.set(this._createFieldsVMParams(i,e))),s==="media"&&(this._createMediaFormattedAttributes({contentElement:i,contentElementIndex:e,formattedAttributes:r}),n.set(this._createMediaVMParams(i,e))),s==="text"&&n.set(this._createTextVMParams(i)))}_compileRelationship(t,e){const{displayCount:r,orderByFields:i,relationshipId:n,title:s,description:o}=t,{_sourceLayer:a,graphic:l,map:c}=this,u=new Bue({displayCount:r,graphic:l,orderByFields:i,relationshipId:n,layer:a,map:c,...this._compileTitleAndDesc({title:s,description:o})});return this.contentViewModels[e]=u,this._handles.add(Bo(()=>u.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(u)),V_e),t}_compileExpression(t,e){const{expressionInfo:r}=t,{graphic:i,map:n,spatialReference:s,view:o}=this,a=new Uue({expressionInfo:r,graphic:i,interceptor:f4.interceptor,map:n,spatialReference:s,view:o});return this.contentViewModels[e]=a,this._handles.add(xe(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,e),Rr),z_e),t}_compileAttachments(t,e){const{graphic:r}=this,{description:i,title:n}=t;return this.contentViewModels[e]=new Jce({graphic:r,...this._compileTitleAndDesc({title:n,description:i})}),t}_compileCustom(t,e){const{graphic:r}=this,{creator:i,destroyer:n}=t;return this.contentViewModels[e]=new YB({graphic:r,creator:i,destroyer:n}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:r,_sourceLayer:i,graphic:n,formattedAttributes:s}=this,o=n==null?void 0:n.attributes,a=this._expressionAttributes,l=s.global;return{title:NT({attributes:o,fieldInfoMap:r,globalAttributes:l,expressionAttributes:a,layer:i,text:t}),description:NT({attributes:o,fieldInfoMap:r,globalAttributes:l,expressionAttributes:a,layer:i,text:e})}}_createFieldsVMParams(t,e){var c;const r=this._effectivePopupTemplate,i=this.formattedAttributes,n={...i==null?void 0:i.global,...i==null?void 0:i.content[e]},s=(c=(t==null?void 0:t.fieldInfos)||(r==null?void 0:r.fieldInfos))==null?void 0:c.filter(({fieldName:u})=>Qce(u)||C_(u)||n.hasOwnProperty(u)),o=r==null?void 0:r.expressionInfos,{description:a,title:l}=t;return{attributes:n,expressionInfos:o,fieldInfos:s,...this._compileTitleAndDesc({title:l,description:a})}}_compileFields(t,e){const r=t.clone(),i=new dj(this._createFieldsVMParams(t,e));return this.contentViewModels[e]=i,r.fieldInfos=i.formattedFieldInfos.slice(0),r}_createMediaVMParams(t,e){const{abilities:r,graphic:i,_fieldInfoMap:n,_effectivePopupTemplate:s,relatedInfos:o,_sourceLayer:a,_expressionAttributes:l}=this,c=this.formattedAttributes,u=(i==null?void 0:i.attributes)??{},{description:d,mediaInfos:p,title:A}=t;return{abilities:{chartAnimation:r.chartAnimation},activeMediaInfoIndex:t.activeMediaInfoIndex||0,attributes:u,isAggregate:i==null?void 0:i.isAggregate,layer:a,fieldInfoMap:n,formattedAttributes:{...c==null?void 0:c.global,...c==null?void 0:c.content[e]},expressionAttributes:l,mediaInfos:p,popupTemplate:s,relatedInfos:o,...this._compileTitleAndDesc({title:A,description:d})}}_compileMedia(t,e){const r=t.clone(),i=new kT(this._createMediaVMParams(t,e));return r.mediaInfos=i.formattedMediaInfos.slice(0),this.contentViewModels[e]=i,r}_createTextVMParams(t){var s;const{graphic:e,_fieldInfoMap:r,_sourceLayer:i,_expressionAttributes:n}=this;if(t&&t.text){const o=(e==null?void 0:e.attributes)??{},a=((s=this.formattedAttributes)==null?void 0:s.global)??{};t.text=NT({attributes:o,fieldInfoMap:r,globalAttributes:a,expressionAttributes:n,layer:i,text:t.text})}return{graphic:e,creator:t.text}}_compileText(t,e){const r=t.clone();return this.contentViewModels[e]=new YB(this._createTextVMParams(r)),r}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:r}=this;if(!t)return;const{lastEditInfoEnabled:i}=t,n=e==null?void 0:e.editFieldsInfo;return i&&n?Udt(n,r==null?void 0:r.attributes):void 0}_compileTitle(t){var a;const{_fieldInfoMap:e,_sourceLayer:r,graphic:i,_expressionAttributes:n}=this,s=(i==null?void 0:i.attributes)??{},o=((a=this.formattedAttributes)==null?void 0:a.global)??{};return NT({attributes:s,fieldInfoMap:e,globalAttributes:o,expressionAttributes:n,layer:r,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const r=t==null?void 0:t.title;return QB(r,{graphic:e})}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const r=t==null?void 0:t.content;return QB(r,{graphic:e})}async _queryFeature(t){const{_featureAbortController:e,_sourceLayer:r,graphic:i,_effectivePopupTemplate:n}=this,s=this.map,o=this.view,a=this.spatialReference;if(e!==this._featureAbortController||!i)return;await Vdt({graphic:i,popupTemplate:n,layer:r,spatialReference:a},t);const{content:{value:l},title:{value:c}}=await fh({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:u}}=await fh({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:Svt({expressionInfos:n==null?void 0:n.expressionInfos,spatialReference:a,graphic:i,map:s,interceptor:f4.interceptor,view:o})});e===this._featureAbortController&&i&&(this._expressionAttributes=u,this._graphicExpressionAttributes={...i.attributes,...u},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:r}){const{_effectivePopupTemplate:i,graphic:n,relatedInfos:s,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;r.content[e]=BW({fieldInfos:i==null?void 0:i.fieldInfos,graphic:n,attributes:{...l,...t.attributes},layer:o,fieldInfoMap:a,relatedInfos:s})}_createFieldsFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:r}){if(t.fieldInfos){const{graphic:i,relatedInfos:n,_sourceLayer:s,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;r.content[e]=BW({fieldInfos:t.fieldInfos,graphic:i,attributes:{...a,...t.attributes},layer:s,fieldInfoMap:o,relatedInfos:n})}}_createFormattedAttributes(t){const{_effectivePopupTemplate:e,graphic:r,relatedInfos:i,_sourceLayer:n,_fieldInfoMap:s,_graphicExpressionAttributes:o}=this,a=e==null?void 0:e.fieldInfos,l={global:BW({fieldInfos:a,graphic:r,attributes:o,layer:n,fieldInfoMap:s,relatedInfos:i}),content:[]};return Array.isArray(t)&&t.forEach((c,u)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:u,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:u,formattedAttributes:l})}),l}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:r}=this;return this._queryRelatedInfos(e,PAe(r),t)}async _queryRelatedInfos(t,e,r){const{relatedInfos:i,_sourceLayer:n}=this;i.clear();const s=M(n==null?void 0:n.associatedLayer)?await(n==null?void 0:n.associatedLayer.load(r)):n;if(!s||!t)return;const o=e.filter(c=>c&&C_(c.fieldName));if(!o||!o.length)return;e.forEach(c=>this._configureRelatedInfo(c,s));const a=await K0t({relatedInfos:i,layer:s},r);Object.keys(a).forEach(c=>{var p;const u=i.get(c.toString()),d=(p=a[c])==null?void 0:p.value;u&&d&&(u.layerInfo=d.data)});const l=await emt({graphic:t,relatedInfos:i,layer:s},r);Object.keys(l).forEach(c=>{var u;Q0t((u=l[c])==null?void 0:u.value,i.get(c.toString()))})}_configureRelatedInfo(t,e){const{relatedInfos:r}=this,i=gk(t.fieldName);if(!i)return;const{layerId:n,fieldName:s}=i;if(!n)return;const o=r.get(n.toString())||W0t(n,e);o&&(tmt({relatedInfo:o,fieldName:s,fieldInfo:t}),this.relatedInfos.set(n,o))}};ro.interceptor=new Mvt(Hdt,qdt),h([f()],ro.prototype,"_error",void 0),h([f()],ro.prototype,"_featureAbortController",void 0),h([f({readOnly:!0})],ro.prototype,"_effectivePopupTemplate",null),h([f({readOnly:!0})],ro.prototype,"_fieldInfoMap",null),h([f({readOnly:!0})],ro.prototype,"_sourceLayer",null),h([f()],ro.prototype,"abilities",void 0),h([Wr("abilities")],ro.prototype,"castAbilities",null),h([f({readOnly:!0})],ro.prototype,"content",void 0),h([f({readOnly:!0})],ro.prototype,"contentViewModels",void 0),h([f()],ro.prototype,"description",void 0),h([f({type:Boolean})],ro.prototype,"defaultPopupTemplateEnabled",void 0),h([f({readOnly:!0})],ro.prototype,"isTable",null),h([f({readOnly:!0})],ro.prototype,"state",null),h([f({readOnly:!0})],ro.prototype,"formattedAttributes",void 0),h([f({type:Pl,value:null})],ro.prototype,"graphic",null),h([f({readOnly:!0})],ro.prototype,"lastEditInfo",void 0),h([f({readOnly:!0})],ro.prototype,"relatedInfos",void 0),h([f()],ro.prototype,"spatialReference",null),h([f({readOnly:!0})],ro.prototype,"title",void 0),h([f()],ro.prototype,"map",null),h([f({readOnly:!0})],ro.prototype,"waitingForContent",null),h([f()],ro.prototype,"view",void 0),ro=f4=h([Q("esri.widgets.FeatureViewModel")],ro);const zue=ro,ac="esri-feature",Mo={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:ac,container:`${ac}__size-container`,title:`${ac}__title`,main:`${ac}__main-container`,btn:`${ac}__button`,icon:`${ac}__icon`,content:`${ac}__content`,contentNode:`${ac}__content-node`,contentElement:`${ac}__content-element`,text:`${ac}__text`,lastEditedInfo:`${ac}__last-edited-info`,fields:`${ac}__fields`,fieldHeader:`${ac}__field-header`,fieldData:`${ac}__field-data`,fieldDataDate:`${ac}__field-data--date`,loadingSpinnerContainer:`${ac}__loading-container`,spinner:`${ac}__loading-spinner`},UNe=t=>{let e=class extends t{constructor(){super(...arguments),this.renderNodeContent=r=>B5e(r)&&!r.destroyed?Ae("div",{class:Mo.contentNode,key:r},r.render()):r instanceof HTMLElement?Ae("div",{class:Mo.contentNode,key:r,bind:r,afterCreate:this._attachToNode}):upt(r)?Ae("div",{class:Mo.contentNode,key:r,bind:r.domNode,afterCreate:this._attachToNode}):null}_attachToNode(r){const i=this;r.appendChild(i)}};return e=h([Q("esri.widgets.Feature.ContentMixin")],e),e};var iie;const j_e={title:!0,content:!0,lastEditedInfo:!0},H_e="relationship-handles";let pl=iie=class extends UNe(Lc){constructor(t,e){super(t,e),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...j_e},this.viewModel=new zue}initialize(){this.addHandles(xe(()=>{var t;return(t=this.viewModel)==null?void 0:t.contentViewModels},()=>this._setupContentWidgets(),Rr))}loadDependencies(){return be(()=>import("./calcite-notice-1f9400ce.js"),["assets/calcite-notice-1f9400ce.js","assets/observers-4f67f1fb.js","assets/loadable-25ad9e4e.js","assets/t9n-5b86961d.js","assets/icon-3af55b58.js"])}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get isTable(){return this.viewModel.isTable}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get title(){return this.viewModel.title}castVisibleElements(t){return{...j_e,...t}}get map(){return this.viewModel.map}set map(t){this.viewModel.map=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{state:t}=this.viewModel,e=Ae("div",{class:Mo.container,key:"container"},this.renderTitle(),t==="error"?this.renderError():t==="loading"?this.renderLoading():this.renderContentContainer());return Ae("div",{class:this.classes(Mo.base,Mo.esriWidget)},e)}setActiveMedia(t,e){return this.viewModel.setActiveMedia(t,e)}nextMedia(t){return this.viewModel.nextMedia(t)}previousMedia(t){return this.viewModel.previousMedia(t)}renderError(){const{messagesCommon:t,messages:e,visibleElements:r}=this;return Ae("calcite-notice",{open:!0,kind:"danger",icon:"exclamation-mark-circle",scale:"s"},r.title?Ae("div",{key:"error-title",slot:"title"},t.errorMessage):null,Ae("div",{key:"error-message",slot:"message"},e.loadingError))}renderLoading(){return Ae("div",{key:"loading-container",class:Mo.loadingSpinnerContainer},Ae("span",{class:this.classes(Mo.iconLoading,Mo.spinner)}))}renderContentContainer(){const{visibleElements:t}=this;return t.content?Ae("div",{class:Mo.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:t,title:e}=this;return t.title?Ae(lL,{level:this.headingLevel,class:Mo.title,innerHTML:e}):null}renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?Ae("div",{class:Mo.contentNode,key:`${e}-content-elements`},t.map(this.renderContentElement,this)):null;if(typeof t=="string"){const r=this._contentWidgets[0];return!r||r.destroyed?null:Ae("div",{class:Mo.contentNode,key:`${e}-content`},r.render())}return this.renderNodeContent(t)}renderContentElement(t,e){var i;const{visibleElements:r}=this;if(typeof r.content!="boolean"&&!((i=r.content)!=null&&i[t.type]))return null;switch(t.type){case"attachments":return this.renderAttachments(e);case"custom":return this.renderCustom(t,e);case"fields":return this.renderFields(e);case"media":return this.renderMedia(e);case"text":return this.renderText(t,e);case"expression":return this.renderExpression(e);case"relationship":return this.renderRelationship(e);default:return null}}renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:r,attachmentInfos:i}=e.viewModel;return r==="loading"||i.length>0?Ae("div",{key:this._buildKey("attachments-element",t),class:this.classes(Mo.contentElement)},e.render()):null}renderRelationship(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?Ae("div",{key:this._buildKey("relationship-element",t),class:Mo.contentElement},e.render()):null}renderExpression(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:Ae("div",{key:this._buildKey("expression-element",t),class:Mo.contentElement},e.render())}renderCustom(t,e){const{creator:r}=t,i=this._contentWidgets[e];return!i||i.destroyed?null:r?Ae("div",{key:this._buildKey("custom-element",e),class:Mo.contentElement},i.render()):null}renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:Ae("div",{key:this._buildKey("fields-element",t),class:Mo.contentElement},e.render())}renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:Ae("div",{key:this._buildKey("media-element",t),class:Mo.contentElement},e.render())}renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:r}=this.viewModel;if(!r||!t.lastEditedInfo)return null;const{date:i,user:n}=r,s=r.type==="edit"?n?e.lastEditedByUser:e.lastEdited:n?e.lastCreatedByUser:e.lastCreated,o=Wg(s,{date:i,user:n});return Ae("div",{key:"edit-info-element",class:this.classes(Mo.lastEditedInfo,Mo.contentElement)},o)}renderText(t,e){const r=t.text,i=this._contentWidgets[e];return!i||i.destroyed?null:r?Ae("div",{key:this._buildKey("text-element",e),class:this.classes(Mo.contentElement,Mo.text)},i.render()):null}_buildKey(t,...e){return`${t}__${this.get("viewModel.graphic.uid")||"0"}-${e.join("-")}`}_destroyContentWidget(t){t&&(t.viewModel=null,!t.destroyed&&t.destroy())}_destroyContentWidgets(){this.removeHandles(H_e),this._contentWidgets.forEach(t=>this._destroyContentWidget(t)),this._contentWidgets=[]}_addFeatureRelationshipHandles(t){const{flowItems:e,visibleElements:r}=this;this.addHandles([Bo(()=>t,"select-record",({featureViewModel:i})=>{e&&(i.abilities={relationshipContent:!0},e.push(new iie({flowItems:e,viewModel:i,visibleElements:r})))}),Bo(()=>t,"show-all-records",()=>{if(!e)return;const{viewModel:i}=t;i.showAllEnabled=!0;const n=new B_e({visibleElements:{title:!1,description:!1},viewModel:i});this._addFeatureRelationshipHandles(n),e.push(n)})],H_e)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:t,visibleElements:e}=this,r=this.get("viewModel.content"),{contentViewModels:i}=this.viewModel;if(Array.isArray(r))r.forEach((n,s)=>{if(n.type==="attachments"&&(this._contentWidgets[s]=new tpt({displayType:n.displayType,headingLevel:e.title?t+1:t,viewModel:i[s]})),n.type==="fields"&&(this._contentWidgets[s]=new z5e({viewModel:i[s]})),n.type==="media"&&(this._contentWidgets[s]=new CDe({viewModel:i[s]})),n.type==="text"&&(this._contentWidgets[s]=new hk({viewModel:i[s]})),n.type==="custom"&&(this._contentWidgets[s]=new hk({viewModel:i[s]})),n.type==="expression"&&(this._contentWidgets[s]=new Cvt({viewModel:i[s]})),n.type==="relationship"){const o=new B_e({viewModel:i[s]});this._addFeatureRelationshipHandles(o),this._contentWidgets[s]=o}},this);else{const n=i[0];n&&!n.destroyed&&(this._contentWidgets[0]=new hk({viewModel:n}))}this.scheduleRender()}};h([f()],pl.prototype,"graphic",null),h([f()],pl.prototype,"defaultPopupTemplateEnabled",null),h([f()],pl.prototype,"flowItems",void 0),h([f()],pl.prototype,"headingLevel",void 0),h([f({readOnly:!0})],pl.prototype,"isTable",null),h([f()],pl.prototype,"label",null),h([f(),tc("esri/widgets/Feature/t9n/Feature")],pl.prototype,"messages",void 0),h([f(),tc("esri/t9n/common")],pl.prototype,"messagesCommon",void 0),h([f(),tc("esri/widgets/support/t9n/uriUtils")],pl.prototype,"messagesURIUtils",void 0),h([f()],pl.prototype,"spatialReference",null),h([f({readOnly:!0})],pl.prototype,"title",null),h([f()],pl.prototype,"visibleElements",void 0),h([Wr("visibleElements")],pl.prototype,"castVisibleElements",null),h([f()],pl.prototype,"map",null),h([f()],pl.prototype,"view",null),h([f({type:zue})],pl.prototype,"viewModel",void 0),pl=iie=h([Q("esri.widgets.Feature")],pl);const Ovt=pl;var BNe;const Nk=Symbol("anchorHandles");let Vx=class extends Ws.EventedAccessor{constructor(e){super(e),this[BNe]=new cn,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[Nk].add([ic(()=>rl(this.screenLocationEnabled?this.view:null,r=>[r.size,r.type==="3d"?r.camera:r.viewpoint]),()=>this.notifyChange("screenLocation")),xe(()=>this.screenLocation,(r,i)=>{M(r)&&M(i)&&this.emit("view-change")})])}destroy(){this.view=null,this[Nk]=yt(this[Nk])}get screenLocation(){var n;const{location:e,view:r,screenLocationEnabled:i}=this;return i&&M(e)&&M(r)&&r.ready?(n=r.toScreen)==null?void 0:n.call(r,e):null}};BNe=Nk,h([f()],Vx.prototype,"location",void 0),h([f()],Vx.prototype,"screenLocation",null),h([f()],Vx.prototype,"screenLocationEnabled",void 0),h([f()],Vx.prototype,"view",void 0),Vx=h([Q("esri.widgets.support.AnchorElementViewModel")],Vx);const zNe=Vx,Pvt="esri.widgets.CompassViewModel";let Fk=class extends zNe{constructor(e){super(e),this.visible=!1}};h([f()],Fk.prototype,"visible",void 0),Fk=h([Q(Pvt)],Fk);const VNe=Fk,OQ="esri-spinner",PQ={base:OQ,spinnerStart:`${OQ}--start`,spinnerFinish:`${OQ}--finish`};let Gx=class extends Lc{constructor(e,r){super(e,r),this._animationDelay=500,this._animationPromise=null,this.viewModel=new VNe}initialize(){this.addHandles(xe(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:r,promise:i}=e??{};r&&(this.viewModel.location=r),this.visible=!0;const n=()=>this.hide();i&&i.catch(()=>{}).then(n)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:r}=this.viewModel,i=!!r,n=e&&i,s=!e&&i,o={[PQ.spinnerStart]:n,[PQ.spinnerFinish]:s},a=this._getPositionStyles();return Ae("div",{class:this.classes(PQ.base,o),styles:a})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const r=yS(this._animationDelay);this._animationPromise=r,r.catch(()=>{}).then(()=>{this._animationPromise===r&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:r}=this.viewModel;if(k(r)||k(e))return{};const{padding:i}=r;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};h([f()],Gx.prototype,"location",null),h([f()],Gx.prototype,"view",null),h([f({type:VNe})],Gx.prototype,"viewModel",void 0),h([f()],Gx.prototype,"visible",null),Gx=h([Q("esri.widgets.Spinner")],Gx);const Ivt=Gx,Cj={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},UT=new ZO({id:"zoom-to-feature",title:"{messages.zoom}",className:Cj.iconZoom}),q_e=new ZO({id:"remove-selected-feature",title:"{messages.remove}",className:Cj.iconTrash}),vM=new ZO({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Cj.iconZoom}),bM=new ZO({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Cj.iconBrowseClusteredFeatures}),$vt="esri.widgets.Popup.PopupViewModel",oz=we.getLogger($vt),Dvt=t=>{const{event:e,view:r}=t,{action:i}=e,n=r&&r.popup;if(!i)return Promise.reject(new pe("trigger-action:missing-arguments","Event has no action"));if(!n)return Promise.reject(new pe("trigger-action:missing-arguments","view.popup is missing"));const{disabled:s,id:o}=i;if(!o)return Promise.reject(new pe("trigger-action:invalid-action","action.id is missing"));if(s)return Promise.reject(new pe("trigger-action:invalid-action","Action is disabled"));if(o===UT.id)return Nvt(n.viewModel).catch(WJ);if(o===vM.id)return Fvt(n.viewModel);if(o===bM.id)return n.featureMenuOpen=!n.featureMenuOpen,n.viewModel.browseClusterEnabled=!n.viewModel.browseClusterEnabled,Promise.resolve();if(n.viewModel.browseClusterEnabled=!1,o===q_e.id){n.close();const{selectedFeature:a}=n;if(!a)return Promise.reject(new pe(`trigger-action:${q_e.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):r.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function GNe(t){const{selectedFeature:e,location:r,view:i}=t;return i?i.type==="3d"?e??r??null:t.get("selectedFeature.geometry")||r:null}function yT(t){var e,r;return!!t&&t.isAggregate&&((r=(e=t.sourceLayer)==null?void 0:e.featureReduction)==null?void 0:r.type)==="cluster"}async function Lvt(t,e){if((e==null?void 0:e.type)!=="3d"||!t||t.declaredClass!=="esri.Graphic")return!0;const r=e.getViewForGraphic(t);if(r&&"whenGraphicBounds"in r){let i;try{i=await r.whenGraphicBounds(t,{useViewElevation:!0})}catch{}return!i||!i.boundingBox||i.boundingBox[0]===i.boundingBox[3]&&i.boundingBox[1]===i.boundingBox[4]&&i.boundingBox[2]===i.boundingBox[5]}return!0}async function Nvt(t){var u;const{location:e,selectedFeature:r,view:i,zoomFactor:n}=t,s=GNe(t);if(!i||!s){const d=new pe("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:s,view:i});throw oz.error(d),d}const o=i.scale/n,a=(u=t.selectedFeature)==null?void 0:u.geometry,l=a??e,c=M(l)&&l.type==="point"&&await Lvt(r,i);UT.active=!0,UT.disabled=!0;try{await t.zoomTo({target:{target:s,scale:c?o:void 0}})}catch{const p=new pe("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:r});oz.error(p)}finally{UT.active=!1,UT.disabled=!1,t.zoomToLocation=null,c&&(t.location=l)}}async function Fvt(t){const{selectedFeature:e,view:r}=t;if((r==null?void 0:r.type)!=="2d"){const o=new pe("zoomToCluster:invalid-view","View must be 2d MapView.",{view:r});throw oz.error(o),o}if(!e||!yT(e)){const o=new pe("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw oz.error(o),o}const[i,n]=await Vue(r,e);vM.active=!0,vM.disabled=!0;const{extent:s}=await i.queryExtent(n);await t.zoomTo({target:s}),vM.active=!1,vM.disabled=!1}async function kvt(t){const{view:e,selectedFeature:r}=t;if(!e||!r)return;const[i,n]=await Vue(e,r),{extent:s}=await i.queryExtent(n);t.selectedClusterBoundaryFeature.geometry=s,e.graphics.add(t.selectedClusterBoundaryFeature)}async function Uvt(t){var o;const{selectedFeature:e,view:r}=t;if(!r||!e)return;const[i,n]=await Vue(r,e);bM.active=!0,bM.disabled=!0;const{features:s}=await i.queryFeatures(n);bM.active=!1,bM.disabled=!1,(o=r.popup)==null||o.open({features:[e].concat(s),featureMenuOpen:!0})}async function Vue(t,e){const r=await t.whenLayerView(e.sourceLayer),i=r.createQuery(),n=e.getObjectId();return i.aggregateIds=n!=null?[n]:[],[r,i]}function Bvt(t){const e=t.features.filter(r=>yT(r));e.length&&(t.features=e)}function jNe(t){var e;if(k(t))return null;switch(t.type){case"point":return t;case"extent":return t.center;case"polygon":return t.centroid;case"multipoint":case"polyline":return(e=t.extent)==null?void 0:e.center;default:return null}}const Cr="esri-popup",vI=`${Cr}__header`,Cw=`${Cr}--is-docked`,ot={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:Cr,widget:"esri-widget",main:`${Cr}__main-container`,loadingContainer:`${Cr}__loading-container`,isCollapsible:`${Cr}--is-collapsible`,isCollapsed:`${Cr}--is-collapsed`,shadow:`${Cr}--shadow`,isDocked:Cw,isDockedTopLeft:`${Cw}-top-left`,isDockedTopCenter:`${Cw}-top-center`,isDockedTopRight:`${Cw}-top-right`,isDockedBottomLeft:`${Cw}-bottom-left`,isDockedBottomCenter:`${Cw}-bottom-center`,isDockedBottomRight:`${Cw}-bottom-right`,alignTopCenter:`${Cr}--aligned-top-center`,alignBottomCenter:`${Cr}--aligned-bottom-center`,alignTopLeft:`${Cr}--aligned-top-left`,alignBottomLeft:`${Cr}--aligned-bottom-left`,alignTopRight:`${Cr}--aligned-top-right`,alignBottomRight:`${Cr}--aligned-bottom-right`,isFeatureMenuOpen:`${Cr}--feature-menu-open`,isActionsMenuOpen:`${Cr}--actions-menu-open`,hasFeatureUpdated:`${Cr}--feature-updated`,header:vI,headerButtons:`${vI}-buttons`,headerContainer:`${vI}-container`,headerContainerButton:`${vI}-container--button`,headerTitle:`${vI}-title`,content:`${Cr}__content`,contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:`${Cr}__footer`,footerHasPagination:`${Cr}__footer--has-pagination`,footerHasActions:`${Cr}__footer--has-actions`,footerHasActionsMenu:`${Cr}__footer--has-actions-menu`,button:`${Cr}__button`,buttonDisabled:`${Cr}__button--disabled`,buttonDock:`${Cr}__button--dock`,icon:`${Cr}__icon`,iconDock:`${Cr}__icon--dock-icon`,inlineActionsContainer:`${Cr}__inline-actions-container`,actionsMenuButton:`${Cr}__actions-menu-button`,actions:`${Cr}__actions`,action:`${Cr}__action`,actionImage:`${Cr}__action-image`,actionText:`${Cr}__action-text`,actionToggle:`${Cr}__action-toggle`,actionToggleOn:`${Cr}__action-toggle--on`,actionExit:`${Cr}__action--exit`,actionSelectFeature:`${Cr}__action--select-feature`,pointer:`${Cr}__pointer`,pointerDirection:`${Cr}__pointer-direction`,navigation:`${Cr}__navigation`,paginationPrevious:`${Cr}__pagination-previous`,paginationNext:`${Cr}__pagination-next`,paginationPreviousIconLTR:`${Cr}__pagination-previous-icon`,paginationPreviousIconRTL:`${Cr}__pagination-previous-icon--rtl`,paginationNextIconLTR:`${Cr}__pagination-next-icon`,paginationNextIconRTL:`${Cr}__pagination-next-icon--rtl`,featureMenu:`${Cr}__feature-menu`,featureMenuList:`${Cr}__feature-menu-list`,featureMenuItem:`${Cr}__feature-menu-item`,featureMenuViewport:`${Cr}__feature-menu-viewport`,featureMenuHeader:`${Cr}__feature-menu-header`,featureMenuNote:`${Cr}__feature-menu-note`,featureMenuSelected:`${Cr}__feature-menu-item--selected`,featureMenuButton:`${Cr}__feature-menu-button`,featureMenuTitle:`${Cr}__feature-menu-title`,featureMenuObserver:`${Cr}__feature-menu-observer`,featureMenuLoader:`${Cr}__feature-menu-loader`,collapseButton:`${Cr}__collapse-button`,collapseIcon:`${Cr}__collapse-icon`};var kS;(function(t){t[t.size=22]="size",t[t.lineWidth=50]="lineWidth",t[t.maxSize=120]="maxSize",t[t.maxOutlineSize=80]="maxOutlineSize",t[t.tallSymbolWidth=20]="tallSymbolWidth"})(kS||(kS={}));function HNe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function zvt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Vvt(t,e,r,i,n,s){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function Gvt(t,e){return new Float32Array(t,e,6)}function qNe(t,e,r,i){const n=e[i],s=e[i+1];t[i]=r[0]*n+r[2]*s+r[4],t[i+1]=r[1]*n+r[3]*s+r[5]}function jvt(t,e,r,i=0,n=0,s=2){const o=n||e.length/s;for(let a=i;a<o;a++)qNe(t,e,r,a*s)}Object.freeze(Object.defineProperty({__proto__:null,clone:zvt,create:HNe,createView:Gvt,fromValues:Vvt,transform:qNe,transformMany:jvt},Symbol.toStringTag,{value:"Module"}));function Hvt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function qvt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Wvt(t,e,r,i,n,s,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t}function WNe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5];let l=r*s-i*n;return l?(l=1/l,t[0]=s*l,t[1]=-i*l,t[2]=-n*l,t[3]=r*l,t[4]=(n*a-s*o)*l,t[5]=(i*o-r*a)*l,t):null}function Qvt(t){return t[0]*t[3]-t[1]*t[2]}function QNe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1],d=r[2],p=r[3],A=r[4],v=r[5];return t[0]=i*c+s*u,t[1]=n*c+o*u,t[2]=i*d+s*p,t[3]=n*d+o*p,t[4]=i*A+s*v+a,t[5]=n*A+o*v+l,t}function Gue(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),u=Math.cos(r);return t[0]=i*u+s*c,t[1]=n*u+o*c,t[2]=i*-c+s*u,t[3]=n*-c+o*u,t[4]=a,t[5]=l,t}function YNe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i*c,t[1]=n*c,t[2]=s*u,t[3]=o*u,t[4]=a,t[5]=l,t}function jue(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=i*c+s*u+a,t[5]=n*c+o*u+l,t}function Yvt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function Xvt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Hue(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Zvt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Jvt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function Kvt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function XNe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function ebt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function tbt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function rbt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function ibt(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],d=e[3],p=e[4],A=e[5],v=Dc();return Math.abs(r-l)<=v*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=v*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-u)<=v*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-d)<=v*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-p)<=v*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-A)<=v*Math.max(1,Math.abs(a),Math.abs(A))}const nbt=QNe,sbt=XNe;Object.freeze(Object.defineProperty({__proto__:null,add:Kvt,copy:Hvt,determinant:Qvt,equals:ibt,exactEquals:rbt,frob:Jvt,fromRotation:Yvt,fromScaling:Xvt,fromTranslation:Hue,identity:qvt,invert:WNe,mul:nbt,multiply:QNe,multiplyScalar:ebt,multiplyScalarAndAdd:tbt,rotate:Gue,scale:YNe,set:Wvt,str:Zvt,sub:sbt,subtract:XNe,translate:jue},Symbol.toStringTag,{value:"Module"}));const W_e=Fe("android");Fe("chrome")||W_e&&W_e>=4;dte();function Acr(t){return t=t||globalThis.location.hostname,abt.some(e=>(t==null?void 0:t.match(e))!=null)}function obt(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(ZNe)!=null||e.match(KNe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(JNe)!=null||e.match(eFe)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const ZNe=/^devext.arcgis.com$/,JNe=/^qaext.arcgis.com$/,KNe=/^[\w-]*\.mapsdevext.arcgis.com$/,eFe=/^[\w-]*\.mapsqa.arcgis.com$/,abt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,ZNe,JNe,/^jsapps.esri.com$/,KNe,eFe];kS.size;kS.maxSize;kS.maxOutlineSize;kS.lineWidth;kS.tallSymbolWidth;function tFe(t){return t&&"opacity"in t?t.opacity*tFe(t.parent):1}async function lbt(t,e){if(!t)return;const r=t.sourceLayer,i=(M(e)&&e.useSourceLayer?r:t.layer)??r,n=tFe(i);if(M(t.symbol)&&(!M(e)||e.ignoreGraphicSymbol!==!0)){const S=t.symbol.type==="web-style"?await gft(t.symbol,{...e,cache:M(e)?e.webStyleCache:null}):t.symbol.clone();return qW(S,null,n),S}const s=(M(e)?e.renderer:null)??(i&&"renderer"in i?i.renderer:null);let o=s&&"getSymbolAsync"in s?await s.getSymbolAsync(t,e):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...e,cache:M(e)?e.webStyleCache:null}):o.clone(),!(s&&"visualVariables"in s&&s.visualVariables&&s.visualVariables.length))return qW(o,null,n),o;if("arcadeRequiredForVisualVariables"in s&&s.arcadeRequiredForVisualVariables&&(k(e)||k(e.arcade))){const S={...e};S.arcade=await DA(),e=S}const a=await be(()=>Promise.resolve().then(()=>_ue),void 0),l=[],c=[],u=[],d=[];for(const S of s.visualVariables)switch(S.type){case"color":l.push(S);break;case"opacity":c.push(S);break;case"rotation":d.push(S);break;case"size":S.target||u.push(S)}const p=!!l.length&&l[l.length-1],A=p?a.getColor(p,t,e):null,v=!!c.length&&c[c.length-1];let b=v?a.getOpacity(v,t,e):null;if(n!=null&&(b=b!=null?b*n:n),qW(o,A,b),u.length){const S=a.getAllSizes(u,t,e);await fft(o,S)}for(const S of d)mft(o,a.getRotationAngle(S,t,e),S.axis);return o}let a1=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const n=e[i],s=new sRe(n,void 0,void 0,2,2);this._properties[i]={pool:s,acquired:[]}}this._afterDispatchHandle=yRe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)Mme(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let n=i.pool.acquire();for(i.acquired.push(n);n===r;)i.acquired.push(n),n=i.pool.acquire();return n}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const n of r.acquired)Mme(n)?r.acquired[i++]=n:r.pool.release(n);r.acquired.length=i}}};const cbt=Fe("mac")?"Meta":"Ctrl",Mj={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)Mj[t]=String.fromCharCode(t);for(let t=1;t<25;t++)Mj[111+t]=`F${t}`;for(let t=65;t<91;t++)Mj[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function ubt(t){if(t.key!==void 0)return Sb(t);const e=Mj[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function hbt(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let dbt=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const Q_e=we.getLogger("esri.views.input.InputHandler");let Il=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?Q_e.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let n;typeof r=="function"?(i=r,n=[]):n=r||[];const s=typeof e=="string"?new dbt(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const d=this._incoming[u.match.eventType];if(d){const p=d.indexOf(u);d.splice(p,1),o(),this._manager&&this._manager.updateDependencies()}},l=new pbt(s,i,{onPause:a,onRemove:a,onResume:u=>{const d=this._incoming[u.match.eventType];d&&!d.includes(u)&&(d.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new fbt(e,{onEmit:(i,n,s,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,n,s,o)},onRemove:i=>{var n;delete this._outgoing[i.eventType],(n=this._manager)==null||n.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!0)}stopCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Q_e.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var i;const r=this._incoming[e.type];if(r){for(const n of r)if(n.match.matches(e)&&((i=n.callback)==null||i.call(n,e),e.shouldStopPropagation()))break}}},pbt=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},fbt=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},mbt=class extends Il{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:n}=e;r===this._value&&this._x===i&&this._y===n||(this._value=r,this._x=i,this._y=n,this._onChange(r,i,n))}},az=class{constructor(e){this._observable=new rle,this._value=e}get(){return Ai(this._observable),this._value}set(e){e!==this._value&&(this._value=e,this._observable.notify())}},gbt=class extends Il{get multiTouchActive(){return this._multiTouchActive.get()}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=new az(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.set(this._activeTouchPointerIds.size>1)}},$g=class extends rt{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=cbt,this._latestPointerType="mouse",this._propertiesPool=new a1({latestPointerLocation:_bt},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}installHandlers(e,r,i=f2.INTERNAL){if(this._nameToGroup[e])return void we.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void we.getLogger(this.declaredClass).error("Can't register a group of zero handlers");const n={name:e,handlers:r.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const o=n.handlers[s];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(n,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{var n;i.removed=!0,(n=i.uninstallCallback)==null||n.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):we.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const n=this._handlers[i];n.priorityIndex=i,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s){for(const o of n.handler.outgoingEventTypes)if(e.has(o)){s=!0;break}}if(s)for(const o of n.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)hbt(a)||r.add(a)}n.active=s}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(k(n)||n.x!==r||n.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=r,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const s=r;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,n=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,n)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const n=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},s=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(n(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(n(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const o=r.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new mbt((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new gbt,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],f2.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,f2.INTERNAL)}_setPointerCapture(e,r,i,n){const s=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),n?(o.add(s),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(s)&&(o.delete(s),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,n){this._emitInputEvent(0,e,r,i,n)}_emitInputEvent(e,r,i,n,s,o){const a=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=s!==void 0&&s,c={event:new Abt(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new jee,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var r,i;const e=nh(this._currentPropagation);for(;e.events.length>0;){const{event:n,priorityIndex:s}=e.events.pop(),o=n.data&&n.data.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[s];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!n.shouldStopPropagation()&&((i=(r=e.currentHandler).eventCallback)==null||i.call(r,n)),n.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(n.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:n,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}_pausePropagation(e){const r=new jee;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const n of r.handler.incomingEventMatches){if(i.eventType!==n.eventType)continue;const s=i.keyModifiers.filter(o=>n.keyModifiers.includes(o));if(s.length===i.keyModifiers.length!=(s.length===n.keyModifiers.length))return i.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let n=0;for(;n<r.length&&this._compareHandlerPriority(i,r[n])>=0;)n++;r.splice(n,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};h([f({readOnly:!0})],$g.prototype,"hasPendingInputs",null),h([f({constructOnly:!0})],$g.prototype,"eventSource",void 0),h([f({constructOnly:!0})],$g.prototype,"recognizers",void 0),h([f()],$g.prototype,"_latestPointerType",void 0),h([f()],$g.prototype,"latestPointerType",null),h([f()],$g.prototype,"multiTouchActive",null),h([f({readOnly:!0})],$g.prototype,"latestPointerLocation",void 0),$g=h([Q("esri.views.input.InputManager")],$g);let Abt=class{constructor(e,r,i,n,s){this.type=e,this.data=r,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=gb.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=gb.STOPPED}shouldStopPropagation(){return(this._propagationState&gb.STOPPED)!=0}async(e){this._propagationState|=gb.PAUSED;const r=(i,n)=>{this._propagationState&=~gb.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&gb.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var gb;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(gb||(gb={}));const f2={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let ybt=class{};const _bt=ybt;function Y_e(t){return t&&typeof t.highlight=="function"}function vbt(t){return t&&typeof t.maskOccludee=="function"}function Rcr(t,e,r){return k(t)||t>r&&(e===0||t<e)}function Ocr(t,e){return M(t)&&t>0||M(e)&&e>0}function Pcr(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}const que=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return fG(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return h([f()],e.prototype,"goToOverride",void 0),h([f()],e.prototype,"view",void 0),e=h([Q("esri.widgets.support.GoTo")],e),e},k5=ur.ofType({key:"type",defaultKeyValue:"button",base:$G,typeMap:{button:ZO,toggle:qPe}}),bbt=()=>[UT.clone()],wbt=()=>[vM.clone(),bM.clone()];let Yi=class extends que(zNe){get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}constructor(e){super(e),this._handles=new cn,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new k5,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Pl({symbol:new iw({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this._handles.add([xe(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),xe(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),xe(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),xe(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.animation)==null?void 0:r.state},e=>this._animationStateChange(e)),xe(()=>this.location,e=>this._locationChange(e)),xe(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),xe(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),xe(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),xe(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>Dvt({event:e,view:this.view})),ic(()=>!this.waitingForResult,()=>this._waitingForResultChange(),fn),xe(()=>{var e,r;return[this.features,(e=this.view)==null?void 0:e.map,(r=this.view)==null?void 0:r.spatialReference]},()=>this._updateFeatureVMs()),xe(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),ic(()=>!this.visible,()=>this.browseClusterEnabled=!1),xe(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new k5;e.removeAll();const{actions:r,defaultActions:i,defaultPopupTemplateEnabled:n,includeDefaultActions:s,selectedFeature:o}=this,a=s?i.concat(r):r,l=o&&(typeof o.getEffectivePopupTemplate=="function"&&o.getEffectivePopupTemplate(n)||o.popupTemplate),c=l&&l.actions,u=l&&l.overwriteActions?c:c?c.concat(a):a;return u&&u.filter(Boolean).forEach(d=>e.add(d)),e}get defaultActions(){const e=this._get("defaultActions")||new k5;return e.removeAll(),e.addMany(yT(this.selectedFeature)?wbt():bbt()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const r=e||[];this._set("features",r);const{pendingPromisesCount:i,promiseCount:n,selectedFeatureIndex:s}=this,o=n&&r.length;o&&i&&s===-1?this.selectedFeatureIndex=0:o&&s!==-1||(this.selectedFeatureIndex=r.length?0:-1)}get location(){return this._get("location")||null}set location(e){var n,s,o;let r=e;const i=(s=(n=this.view)==null?void 0:n.spatialReference)==null?void 0:s.isWebMercator;e&&((o=e==null?void 0:e.spatialReference)!=null&&o.isWGS84)&&i&&(r=N_(e)),this._set("location",r)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(r=>{this._pendingPromises.add(r);const i=s=>{this._pendingPromises.has(r)&&this._updateFeatures(s),this._updatePendingPromises(r)},n=()=>this._updatePendingPromises(r);r.then(i,n)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:r}=this;return r===-1?null:e[r]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:r}=this;e=isNaN(e)||e<-1||!r?-1:(e+r)%r,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,r=GNe(this);return r&&e?this.callGoTo({target:{target:r,scale:e.scale}}):Promise.reject(new pe("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:r,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,r){const{view:i}=this;if(!i||!e)throw new pe("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return i.fetchPopupFeatures(e,{event:r&&r.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:r&&r.signal})}open(e){const r={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=r;delete r.fetchFeatures,i&&this._setFetchFeaturesPromises(r.location);const n=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of n)delete r[s];this.set(r)}triggerAction(e){const r=this.allActions.getItemAt(e);r&&!r.disabled&&this.emit("trigger-action",{action:r})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){Bvt(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:r}=this;(e==null?void 0:e.type)==="2d"?yT(r)?(await kvt(this),await Uvt(this)):we.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",r):we.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",r)}_animationStateChange(e){this.zoomToLocation||(UT.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var r;const e=(r=this.view)==null?void 0:r.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),this._selectedClusterFeature&&e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(yT(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:r,updateLocationEnabled:i}=this;i&&e&&(!r||r.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:r,featurePage:i,featuresPerPage:n,featureViewModels:s}=this;if(i===null)return;const o=((i-1)*n+r)%r,a=o+n;s.slice(o,a).forEach((l,c)=>{l&&!l.graphic&&(l.graphic=e[o+c])})}async _selectedFeatureChange(e){const{location:r,updateLocationEnabled:i,view:n}=this;if(e&&n){if(this.browseClusterEnabled)return this._selectedClusterFeature&&(n.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),yT(e)?void 0:(e.symbol=await lbt(e),this._selectedClusterFeature=e,void n.graphics.add(this._selectedClusterFeature));!i&&r||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{var o;const s=(o=n.center)==null?void 0:o.clone();s&&(this.location=s)}):this.location=jNe(e.geometry)}}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(r=>{const{clientOnlyGraphics:i,promisesPerLayerView:n}=r,s=Promise.resolve(i),o=n.map(a=>a.promise);this.promises=[s,...o]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:r,featureViewModels:i}=this;if(yT(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!r||!r.length)return;const n=i.slice(0),s=[];r.forEach((o,a)=>{var c,u;if(!o)return;let l=null;if(n.some((d,p)=>(d&&d.graphic===o&&(l=d,n.splice(p,1)),!!l)),l)s[a]=l;else{const d=new zue({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(c=this.view)==null?void 0:c.spatialReference,graphic:o===e?o:null,map:(u=this.view)==null?void 0:u.map,view:this.view});s[a]=d}}),n.forEach(o=>o&&!o.destroyed&&o.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:r}=this;return r&&e&&typeof r.toScreen=="function"?r.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:r,autoOpenEnabled:i}=this;if(r.remove(e),i&&this.view){const n=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},f2.WIDGET);r.add(n,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,r){this._cancelFetchingFeatures();const i=new AbortController,{signal:n}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:n,event:r});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:r,mapPoint:i}=e,{view:n}=this;this._fetchFeaturesWithController(r,e).then(s=>{var u;const{clientOnlyGraphics:o,promisesPerLayerView:a,location:l}=s,c=[Promise.resolve(o),...a.map(d=>d.promise)];return(u=n==null?void 0:n.popup)==null||u.open({location:l||i,promises:c}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,r){return await e.when(),e.whenLayerView(r)}_getHighlightLayer(e){const{layer:r,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:r}_getHighlightTarget(e,r){const i=r.type==="imagery"?void 0:"objectIdField"in r?r.objectIdField||x4e:null,n=e.attributes;return n&&i&&n[i]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:r,view:i,activeFeature:n,visible:s}=this;if(!(n&&i&&r&&s))return;const o=this._getHighlightLayer(n);if(!(o&&o instanceof zD))return;const a=this._getLayerView(i,o);this._highlightActiveFeaturePromise=a;const l=await a;if(!(l&&Y_e(l)&&this._highlightActiveFeaturePromise===a&&this.activeFeature&&this.highlightEnabled))return;const c=l.highlight(this._getHighlightTarget(n,o));this._handles.add(c,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:r,highlightEnabled:i,view:n,visible:s}=this;if(!(r&&n&&i&&s))return;const o=this._getHighlightLayer(r);if(!(o&&o instanceof zD))return;const a=this._getLayerView(n,o);this._highlightSelectedFeaturePromise=a;const l=await a;if(!(l&&Y_e(l)&&this._highlightSelectedFeaturePromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const c=l.highlight(this._getHighlightTarget(r,o));this._handles.add(c,e)}_updateFeatures(e){const{features:r}=this;if(!e||!e.length)return;if(!r.length)return void(this.features=e);const i=e.filter(n=>!r.includes(n));this.features=r.concat(i)}};h([f()],Yi.prototype,"featurePage",void 0),h([f()],Yi.prototype,"isLoadingFeature",null),h([f({type:k5})],Yi.prototype,"actions",void 0),h([f({readOnly:!0})],Yi.prototype,"active",null),h([f()],Yi.prototype,"activeFeature",void 0),h([f({readOnly:!0})],Yi.prototype,"allActions",null),h([f({type:Boolean})],Yi.prototype,"defaultPopupTemplateEnabled",void 0),h([f()],Yi.prototype,"autoCloseEnabled",void 0),h([f()],Yi.prototype,"autoOpenEnabled",void 0),h([f()],Yi.prototype,"browseClusterEnabled",void 0),h([f()],Yi.prototype,"content",void 0),h([f({type:k5,readOnly:!0})],Yi.prototype,"defaultActions",null),h([f({readOnly:!0})],Yi.prototype,"featureCount",null),h([f()],Yi.prototype,"features",null),h([f()],Yi.prototype,"featuresPerPage",void 0),h([f()],Yi.prototype,"featureViewModelAbilities",void 0),h([f({readOnly:!0})],Yi.prototype,"featureViewModels",void 0),h([f()],Yi.prototype,"highlightEnabled",void 0),h([f()],Yi.prototype,"includeDefaultActions",void 0),h([f({type:Ht})],Yi.prototype,"location",null),h([f({readOnly:!0})],Yi.prototype,"pendingPromisesCount",null),h([f({readOnly:!0})],Yi.prototype,"selectedClusterBoundaryFeature",void 0),h([f({readOnly:!0})],Yi.prototype,"waitingForResult",null),h([f({readOnly:!0})],Yi.prototype,"promiseCount",null),h([f()],Yi.prototype,"promises",null),h([f({value:null,readOnly:!0})],Yi.prototype,"selectedFeature",null),h([f({value:-1})],Yi.prototype,"selectedFeatureIndex",null),h([f({readOnly:!0})],Yi.prototype,"selectedFeatureViewModel",null),h([f({readOnly:!0})],Yi.prototype,"state",null),h([f()],Yi.prototype,"title",void 0),h([f()],Yi.prototype,"updateLocationEnabled",void 0),h([f()],Yi.prototype,"view",void 0),h([f()],Yi.prototype,"visible",void 0),h([f()],Yi.prototype,"zoomFactor",void 0),h([f()],Yi.prototype,"zoomToLocation",void 0),h([f()],Yi.prototype,"centerAtLocation",null),Yi=h([Q("esri.widgets.Popup.PopupViewModel")],Yi);const rFe=Yi,X_e="selected-index",xbt=0,Z_e="popup-spinner",J_e={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},K_e="esri-popup";function gy(t,e){return e===void 0?`${K_e}__${t}`:`${K_e}__${t}-${e}`}const e1e={closeButton:!0,featureNavigation:!0};let Er=class extends UNe(Lc){constructor(e,r){super(e,r),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new cn,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverNode=null,this._featureMenuViewportNode=null,this._rootFlowItemNode=null,this._featureMenuIntersectionObserverCallback=([i])=>{i!=null&&i.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=ZM(()=>this._displaySpinner(),xbt),this._exitRelatedRecordsActions=new WeakMap,this._featureSelectionActions=new WeakMap,this._flowItems=new ur,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureMenuOpen=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new rFe,this.visibleElements={...e1e},this._handleOpenRelatedFeature=i=>{this._openRelatedFeature(i)},this._addSelectedFeatureIndexHandle(),this.addHandles([xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},()=>this._positionContainer()),xe(()=>{var i;return[(i=this.viewModel)==null?void 0:i.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},(i,n)=>{!!i!=!!n&&this.reposition()}),xe(()=>{var i,n,s,o,a,l;return[(n=(i=this.viewModel)==null?void 0:i.view)==null?void 0:n.padding,(o=(s=this.viewModel)==null?void 0:s.view)==null?void 0:o.size,(a=this.viewModel)==null?void 0:a.active,(l=this.viewModel)==null?void 0:l.location,this.alignment]},()=>this.reposition()),xe(()=>this.spinnerEnabled,i=>this._spinnerEnabledChange(i)),xe(()=>{var i,n;return(n=(i=this.viewModel)==null?void 0:i.view)==null?void 0:n.size},(i,n)=>this._updateDockEnabledForViewSize(i,n)),xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.view},(i,n)=>this._viewChange(i,n)),xe(()=>{var i,n;return(n=(i=this.viewModel)==null?void 0:i.view)==null?void 0:n.ready},(i,n)=>this._viewReadyChange(i??!1,n??!1)),xe(()=>{var i,n;return[(i=this.viewModel)==null?void 0:i.waitingForResult,(n=this.viewModel)==null?void 0:n.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),xe(()=>this.selectedFeatureWidget,()=>this._destroyFlowItemWidgets()),xe(()=>{var i,n,s,o;return[(n=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:n.title,(o=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:o.state]},()=>this._setTitleFromFeatureWidget()),xe(()=>{var i,n,s,o;return[(n=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:n.content,(o=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:o.state]},()=>this._setContentFromFeatureWidget()),ic(()=>!this.collapsed,()=>{var i,n;((n=(i=this.viewModel)==null?void 0:i.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),Bo(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},"change",()=>this._watchActions()),xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},()=>this._watchActions(),Rr),xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.featureViewModels},()=>this._featureMenuViewportScrollTop()),Bo(()=>this._flowItems,"change",()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()}),xe(()=>{var i,n,s,o;return[(n=(i=this._activeFlowItemWidget)==null?void 0:i.viewModel)==null?void 0:n.state,(o=(s=this._activeFlowItemWidget)==null?void 0:s.viewModel)==null?void 0:o.title]},()=>this.scheduleRender())])}loadDependencies(){return Promise.all([be(()=>import("./calcite-flow-9fb717b8.js"),["assets/calcite-flow-9fb717b8.js","assets/observers-4f67f1fb.js"]),be(()=>import("./calcite-flow-item-a0d2c12f.js"),["assets/calcite-flow-item-a0d2c12f.js","assets/interactive-573cbe88.js","assets/loadable-25ad9e4e.js","assets/t9n-5b86961d.js","assets/observers-4f67f1fb.js","assets/guid-9426053f.js","assets/action-14c0481c.js","assets/icon-3af55b58.js","assets/loader-a392da00.js","assets/tooltip-b0c23f7f.js","assets/debounce-31e0cfcc.js","assets/scrim-acdddd6b.js"]),be(()=>import("./calcite-action-d408c5c5.js"),["assets/calcite-action-d408c5c5.js","assets/action-14c0481c.js","assets/guid-9426053f.js","assets/interactive-573cbe88.js","assets/loadable-25ad9e4e.js","assets/t9n-5b86961d.js","assets/observers-4f67f1fb.js","assets/icon-3af55b58.js","assets/loader-a392da00.js"]),be(()=>import("./calcite-tooltip-41f5694a.js"),["assets/calcite-tooltip-41f5694a.js","assets/tooltip-b0c23f7f.js","assets/debounce-31e0cfcc.js","assets/guid-9426053f.js"]),be(()=>import("./calcite-icon-2d1b5c98.js"),["assets/calcite-icon-2d1b5c98.js","assets/icon-3af55b58.js","assets/observers-4f67f1fb.js"])])}destroy(){var e,r;this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(r=this._featureMenuIntersectionObserver)==null||r.disconnect()}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:e,viewModel:r}=this;if(!e)return!!(r!=null&&r.content);const i=e.viewModel;if(i!=null&&i.waitingForContent||(i==null?void 0:i.state)==="error")return!0;const n=i==null?void 0:i.content;return Array.isArray(n)?!!n.length:!!n}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation!=null}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:e}=this;return e.getItemAt(e.length-1)||null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get autoOpenEnabled(){return this.viewModel.autoOpenEnabled}set autoOpenEnabled(e){this.viewModel.autoOpenEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||J_e}set dockOptions(e){var l,c;const r={...J_e},i=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.breakpoints,n={};i&&(n.width=i.xsmall,n.height=i.xsmall);const s={...r,...e},o={...r.breakpoint,...n},{breakpoint:a}=s;typeof a=="object"?s.breakpoint={...o,...a}:a&&(s.breakpoint=o),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,visibleElements:r,headingLevel:i,_flowItems:n}=this,{selectedFeatureViewModel:s}=this.viewModel,o={...r,title:!1};return s?(e?(e.viewModel=s,e.visibleElements=o):this._feature=new Ovt({flowItems:n,headingLevel:i+1,viewModel:s,visibleElements:o}),this._feature):null}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}castVisibleElements(e){return{...e1e,...e}}blur(){const{active:e}=this.viewModel;e||we.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,r){return this.viewModel.fetchFeatures(e,r)}focus(){const{active:e}=this.viewModel;e||we.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,o;this._handles.remove(X_e);const r=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,n={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:r};((o=(s=this.viewModel)==null?void 0:s.view)==null?void 0:o.widthBreakpoint)==="xsmall"&&(n.collapsed=!0),this.set(n),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var b,S,E,R;const{actionsMenuOpen:e,dockEnabled:r,featureMenuVisible:i,dividedActions:n,currentAlignment:s,currentDockPosition:o}=this,{active:a}=this.viewModel,{menuActions:l}=n,c=a&&l.length>1&&e,u=a&&r,d=a&&!r,p=(S=(b=this.selectedFeature)==null?void 0:b.layer)==null?void 0:S.title,A=(R=(E=this.selectedFeature)==null?void 0:E.layer)==null?void 0:R.id,v={[ot.alignTopCenter]:s==="top-center",[ot.alignBottomCenter]:s==="bottom-center",[ot.alignTopLeft]:s==="top-left",[ot.alignBottomLeft]:s==="bottom-left",[ot.alignTopRight]:s==="top-right",[ot.alignBottomRight]:s==="bottom-right",[ot.isDocked]:u,[ot.shadow]:d,[ot.isDockedTopLeft]:o==="top-left",[ot.isDockedTopCenter]:o==="top-center",[ot.isDockedTopRight]:o==="top-right",[ot.isDockedBottomLeft]:o==="bottom-left",[ot.isDockedBottomCenter]:o==="bottom-center",[ot.isDockedBottomRight]:o==="bottom-right",[ot.isFeatureMenuOpen]:i,[ot.isActionsMenuOpen]:c};return Ae("div",{class:this.classes(ot.base,v),role:"presentation","data-layer-title":p,"data-layer-id":A,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},a?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return Ae("span",{"aria-hidden":"true",class:this.classes(ot.icon,ot.iconLoading,ot.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?Ae("div",{key:gy("loading-container"),role:"presentation",class:ot.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=pm(this.container),r={[ot.iconRightTriangleArrow]:e,[ot.paginationPreviousIconRTL]:e,[ot.iconLeftTriangleArrow]:!e,[ot.paginationPreviousIconLTR]:!e};return Ae("span",{"aria-hidden":"true",class:this.classes(ot.icon,r)})}renderPreviousButton(){const{messages:e}=this;return Ae("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(ot.button,ot.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=pm(this.container),r={[ot.iconLeftTriangleArrow]:e,[ot.paginationNextIconRTL]:e,[ot.iconRightTriangleArrow]:!e,[ot.paginationNextIconLTR]:!e};return Ae("span",{"aria-hidden":"true",class:this.classes(ot.icon,r)})}renderNextButton(){const{messages:e}=this;return Ae("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(ot.button,ot.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:r,messagesCommon:i}=this,{featureCount:n,selectedFeatureIndex:s}=this.viewModel;return Ae("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(ot.button,ot.featureMenuButton),"aria-haspopup":"true","aria-controls":r,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(n,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:[]}renderDockIcon(){const{dockEnabled:e}=this,r=this._wouldDockTo(),i={[ot.iconUndock]:e,[ot.iconDock]:!e,[ot.iconDockToRight]:!e&&(r==="top-right"||r==="bottom-right"),[ot.iconDockToLeft]:!e&&(r==="top-left"||r==="bottom-left"),[ot.iconDockToTop]:!e&&r==="top-center",[ot.iconDockToBottom]:!e&&r==="bottom-center"};return Ae("span",{"aria-hidden":"true",class:this.classes(i,ot.icon)})}renderDockButton(){var s,o,a;const{dockEnabled:e,messages:r}=this,i=(o=(s=this.viewModel)==null?void 0:s.view)==null?void 0:o.widthBreakpoint,n=e?r.undock:r.dock;return i!=="xsmall"&&((a=this.dockOptions)!=null&&a.buttonEnabled)?Ae("div",{role:"button","aria-label":n,title:n,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(ot.button,ot.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:r,collapsible:i,contentCollapsed:n,messagesCommon:s}=this,o={[ot.headerContainerButton]:i},a=Ae(lL,{level:this.headingLevel,class:ot.headerTitle,innerHTML:e??""}),l=i?Ae("button",{key:`${e}--collapsible`,id:r,title:n?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(ot.headerContainer,o),"aria-expanded":n?"false":"true",onclick:this._toggleCollapsed,type:"button"},a,Ae("calcite-icon",{class:ot.collapseIcon,key:"collapse-icon",icon:n?"chevron-down":"chevron-up",scale:"m"})):Ae("div",{key:e??"title",id:r,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(ot.headerContainer,o)},a);return e?l:null}renderCloseIcon(){return Ae("span",{"aria-hidden":"true",class:this.classes(ot.icon,ot.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:r}=this;return e.closeButton?Ae("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:ot.button,"aria-label":r.close,title:r.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return Ae("header",{class:ot.header},this.renderTitle(),Ae("div",{class:ot.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:r,contentCollapsed:i,_flowItems:n}=this,{content:s}=this.viewModel,o=n.toArray(),a={[ot.contentHasFlows]:!!o.length};return r&&!i?Ae("div",{key:s??"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:this.classes(ot.content,a)},Ae("calcite-flow",{bind:this},Ae("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:nL,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),o.map(l=>this.renderFlowItem(l))),o.map(l=>this.renderFlowItemTooltips(l))):null}renderFlowItem(e){const{messages:r}=this,i=XB(),n="graphic"in e&&!e.isTable;return Ae("calcite-flow-item",{bind:this,class:this.classes({[ot.calciteThemeDark]:!i,[ot.calciteThemeLight]:i}),heading:e.title??"",description:this._getFlowItemDescription(e),onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${e.viewModel.uid}`},Ae("calcite-action",{class:ot.actionExit,icon:"move-up",label:r==null?void 0:r.exitRelatedRecords,text:r==null?void 0:r.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:s=>this._storeExitRelatedRecordsAction(e,s),onclick:this._destroyFlowItemWidgets}),n?Ae("calcite-action",{class:ot.actionSelectFeature,icon:"zoom-to-object",label:r==null?void 0:r.selectFeature,text:r==null?void 0:r.selectFeature,slot:"header-actions-end",bind:this,afterCreate:s=>this._storeFeatureSelectionAction(e,s),onclick:()=>this._handleOpenRelatedFeature(e)}):null,Ae("div",{class:this.classes(ot.contentFlowItem,{[ot.calciteThemeDark]:i,[ot.calciteThemeLight]:!i})},e.render()))}renderFlowItemTooltips(e){const{messages:r,_exitRelatedRecordsActions:i,_featureSelectionActions:n}=this,s=XB(),o=n.get(e);return[Ae("calcite-tooltip",{class:this.classes({[ot.calciteThemeDark]:!s,[ot.calciteThemeLight]:s}),key:`exit-related-records-tooltip-${e.viewModel.uid}`,label:r==null?void 0:r.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:i.get(e),placement:"top"},r==null?void 0:r.exitRelatedRecords),o?Ae("calcite-tooltip",{class:this.classes({[ot.calciteThemeDark]:!s,[ot.calciteThemeLight]:s}),key:`select-related-record-tooltip-${e.viewModel.uid}`,label:r==null?void 0:r.selectFeature,overlayPositioning:"fixed",referenceElement:o,placement:"top"},r==null?void 0:r.selectFeature):null]}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:r,actionsMenuOpen:i,dividedActions:n,messagesCommon:s}=this,o=i?s.close:s.open,{menuActions:a}=n;return a.length?Ae("div",{key:gy("actions-menu-button"),class:this.classes(ot.button,ot.actionsMenuButton),role:"button",id:r,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},Ae("span",{"aria-hidden":"true",class:ot.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:r,actionsMenuOpen:i,dividedActions:n}=this,{menuActions:s}=n;return s.length&&i?Ae("ul",{id:e,role:"menu","aria-labelledby":r,key:gy("actions"),class:ot.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(o=>this.renderAction({action:o,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return e.length?e.toArray().map(r=>this.renderAction({action:r,type:"inline"})):[]}renderInlineActionsContainer(){const{inlineActions:e,menuActions:r}=this.dividedActions,i=!!e.length,n=!!r.length;return i||n?Ae("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":n.toString(),class:ot.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?Ae("section",{key:gy("navigation"),class:this.classes(ot.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:r}=this,{inlineActions:i,menuActions:n}=r,s=!!i.length,o=!!n.length,a={[ot.footerHasPagination]:e,[ot.footerHasActions]:s,[ot.footerHasActionsMenu]:o};return e||s?Ae("div",{key:gy("feature-buttons"),class:this.classes(ot.footer,a)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:r,isLoadingFeature:i}=this.viewModel,n=Wg(e.selectedFeatures,{total:r.length});return Ae("section",{key:gy("menu"),class:ot.featureMenu},Ae("strong",{class:ot.featureMenuHeader},n),Ae("nav",{bind:this,class:ot.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:nL},this.renderFeatureMenu(),Ae("div",{class:ot.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?Ae("div",{class:ot.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:Ae("div",{key:gy("pointer"),class:ot.pointer,role:"presentation"},Ae("div",{class:this.classes(ot.pointerDirection,ot.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:r,currentDockPosition:i,titleId:n,contentId:s,collapsible:o,hasContent:a,contentCollapsed:l,visibleElements:c}=this,{title:u}=this.viewModel,d=r==="bottom-left"||r==="bottom-center"||r==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",p=r==="top-left"||r==="top-center"||r==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",A={[ot.shadow]:e,[ot.isCollapsible]:o,[ot.isCollapsed]:l};return Ae("div",{class:this.classes(ot.main,ot.widget,A),tabIndex:c.closeButton?void 0:-1,role:"dialog","aria-labelledby":u?n:"","aria-describedby":a&&!l?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},d?this.renderFooter():null,d?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){var r;const e=(r=this.viewModel)==null?void 0:r.content;return e?typeof e=="string"?Ae("div",{class:Mo.contentNode,key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return Ae("span",{key:"text",class:ot.actionText},e)}renderActionIcon(e){const r=this._getActionClass(e),i=this._getActionImage(e),n={[ot.iconLoading]:e.active,[ot.rotating]:e.active,[ot.icon]:!!r,[ot.actionImage]:!e.active&&!!i};return r&&(n[r]=!e.active),Ae("span",{key:"icon","aria-hidden":"true",class:this.classes(ot.icon,n),styles:this._getIconStyles(i)})}renderAction(e){const{action:r,type:i}=e,n=this._getActionTitle(r),s={[ot.action]:r.type!=="toggle",[ot.actionToggle]:r.type==="toggle",[ot.actionToggleOn]:r.type==="toggle"&&r.value,[ot.buttonDisabled]:r.disabled},o=[this.renderActionIcon(r),this.renderActionText(n)],a=i==="menu-item"?Ae("li",{key:r.uid,role:"menuitem",tabIndex:0,title:n,"aria-label":n,class:this.classes(ot.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":r.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o):Ae("div",{key:r.uid,role:"button",tabIndex:0,title:n,"aria-label":n,class:this.classes(ot.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":r.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return r.visible?a:null}renderFeatureMenuItem(e,r){const{messages:i,messagesCommon:n}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:o}=this.viewModel,a=e===o,l={[ot.featureMenuSelected]:a},c=a?Ae("span",{key:gy(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:ot.iconCheckMark}):null,u=Ae("span",{innerHTML:e.title||n.untitled});return Ae("li",{role:"menuitem",tabIndex:-1,key:gy(`feature-menu-feature-${s}`),class:this.classes(l,ot.featureMenuItem),bind:this,"data-feature-index":r,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},Ae("span",{class:ot.featureMenuTitle},u,c))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:r}=this.viewModel;return r.length>1?Ae("ol",{class:ot.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},r.filter(i=>!!i.graphic).map((i,n)=>this.renderFeatureMenuItem(i,n))):null}_storeFeatureSelectionAction(e,r){this._featureSelectionActions.set(e,r),this.scheduleRender()}_storeExitRelatedRecordsAction(e,r){this._exitRelatedRecordsActions.set(e,r),this.scheduleRender()}_getFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const r=e.graphic,i=r==null?void 0:r.geometry;if(k(i)||k(r))return;this._destroyFlowItemWidgets(),await this.viewModel.zoomTo({target:i});const n=jNe(i);this.open({features:[r],location:M(n)?n:void 0})}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_handleBackClick(){const e=this._flowItems.pop();e&&(this._exitRelatedRecordsActions.delete(e),this._featureSelectionActions.delete(e),"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_getActionTitle(e){const{messages:r,selectedFeature:i,messagesCommon:n}=this,{id:s}=e,o=i==null?void 0:i.attributes,a=e.title??"",l=s==="zoom-to-feature"?Wg(a,{messages:r}):s==="remove-selected-feature"?Wg(a,{messages:n}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?Wg(a,{messages:r}):e.title;return l&&o?Wg(l,o):l??""}_getActionClass(e){const{selectedFeature:r}=this,i=r==null?void 0:r.attributes,{className:n,image:s}=e,o=s||n?n:ot.iconDefaultAction;return o&&i?Wg(o,i):o??""}_getActionImage(e){const{selectedFeature:r}=this,i=r==null?void 0:r.attributes,{image:n}=e;return n&&i?Wg(n,i):n??""}_createFeatureUpdatedAnimation(){return _ut("enter",ot.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:r}=this;if(typeof e!="number")return null;const i=Math.round(e);return Math.max(r?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const r="actions";this._handles.remove(r),e&&e.forEach(i=>{this._handles.add(xe(()=>[i.uid,i.active,i.className,i.disabled,i.id,i.title,i.image,i.visible],()=>this.scheduleRender()),r)})}_divideActions(){const{allActions:e}=this.viewModel,r=e.filter(o=>o.visible),i=this._getInlineActionCount(),n=i===null,s=i===0;return{inlineActions:n?r.slice(0):s?new ur:r.slice(0,i),menuActions:n?new ur:s?r.slice(0):r.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var i,n;const{selectedFeatureWidget:e,messagesCommon:r}=this;e&&(this.viewModel.title=((i=e.viewModel)==null?void 0:i.state)==="error"?r.errorMessage:((n=e.viewModel)==null?void 0:n.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){Sb(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){Sb(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:r}=this,i=e.currentTarget["data-feature-index"];r.activeFeature=r.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const r=Sb(e),{_featureMenuNode:i}=this,n=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),o=s.length;r!=="ArrowUp"?r!=="ArrowDown"?r!=="Home"?r!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(n+1+o)%o].focus()):(e.stopPropagation(),s[(n-1+o)%o].focus())}_handleActionMenuItemKeyup(e){const r=Sb(e),{_actionsMenuNode:i}=this,n=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,o=s.findIndex(c=>c.uid===n);if(!i)return;const a=i.querySelectorAll("li"),l=a.length;r!=="ArrowUp"?r!=="ArrowDown"?r!=="Home"?r!=="End"||(e.stopPropagation(),a[a.length-1].focus()):(e.stopPropagation(),a[0].focus()):(e.stopPropagation(),a[(o+1+l)%l].focus()):(e.stopPropagation(),a[(o-1+l)%l].focus())}_handleMainKeyup(e){const r=Sb(e);r==="ArrowLeft"&&(e.stopPropagation(),this.previous()),r==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const r=this.get("viewModel.view");this._createSpinner(r)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:r,waitingForResult:i}=this.viewModel;i&&r?e.show({location:r}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e!=null&&e.shouldFocus&&(await QD(()=>{var r;return((r=this.viewModel)==null?void 0:r.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=xe(()=>{var r;return(r=this.viewModel)==null?void 0:r.selectedFeatureIndex},(r,i)=>this._selectedFeatureIndexUpdated(r,i));this._handles.add(e,X_e)}_selectedFeatureIndexUpdated(e,r){const{featureCount:i}=this;i&&e!==r&&e!==-1&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,r){return e.x>-1&&e.y>-1&&e.x<=r.width&&e.y<=r.height}_isOutsideView(e){const{popupHeight:r,popupWidth:i,screenLocation:n,side:s,view:o}=e;if(isNaN(i)||isNaN(r)||!o||!n)return!1;const a=o.padding;return s==="right"&&n.x+i/2>o.width-a.right||s==="left"&&n.x-i/2<a.left||s==="top"&&n.y-r<a.top||s==="bottom"&&n.y+r>o.height-a.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:r,_containerNode:i,_mainContainerNode:n,viewModel:s}=this,{screenLocation:o,view:a}=s;if(k(o)||!a||!i)return"top-center";if(!this._isScreenLocationWithinView(o,a))return this._get("currentAlignment")||"top-center";function l(I){return parseInt(I.replace(/[^-\d\.]/g,""),10)}const c=n?window.getComputedStyle(n,null):null,u=c?l(c.getPropertyValue("max-height")):0,d=c?l(c.getPropertyValue("height")):0,{height:p,width:A}=i.getBoundingClientRect(),v=A+r,b=Math.max(p,u,d)+r,S=this._isOutsideView({popupHeight:b,popupWidth:v,screenLocation:o,side:"right",view:a}),E=this._isOutsideView({popupHeight:b,popupWidth:v,screenLocation:o,side:"left",view:a}),R=this._isOutsideView({popupHeight:b,popupWidth:v,screenLocation:o,side:"top",view:a}),O=this._isOutsideView({popupHeight:b,popupWidth:v,screenLocation:o,side:"bottom",view:a});return E?R?"bottom-right":"top-right":S?R?"bottom-left":"top-left":R?O?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:r}=this;return r||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const r=["left","right"];return pm(this.container)&&r.reverse(),e.replace(/leading/gi,r[0]).replace(/trailing/gi,r[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var a;if(e!=="auto")return e;const r=(a=this.viewModel)==null?void 0:a.view,i=pm(this.container)?"top-left":"top-right";if(!r)return i;const n=r.padding||{left:0,right:0,top:0,bottom:0},s=r.width-n.left-n.right,{breakpoints:o}=r;return o&&s<=o.xsmall?"bottom-center":i}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:r}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),n=this._calculatePositionStyle(r,i);n&&Object.assign(this._containerNode.style,n)}_calculateFullWidth(e){const{currentAlignment:r,_pointerOffsetInPx:i}=this;return r==="top-left"||r==="bottom-left"||r==="top-right"||r==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,r,i,n){const{currentAlignment:s,_pointerOffsetInPx:o}=this;if(!i)return;const{padding:a}=i,l=n/2,c=i.height-r,u=i.width-e;return s==="bottom-center"?{top:r+o-a.top,left:e-l-a.left}:s==="top-left"?{bottom:c+o-a.bottom,right:u+o-a.right}:s==="bottom-left"?{top:r+o-a.top,right:u+o-a.right}:s==="top-right"?{bottom:c+o-a.bottom,left:e+o-a.left}:s==="bottom-right"?{top:r+o-a.top,left:e+o-a.left}:s==="top-center"?{bottom:c+o-a.bottom,left:e-l-a.left}:void 0}_calculatePositionStyle(e,r){const{dockEnabled:i,view:n}=this;if(!n)return;if(i)return{left:"",top:"",right:"",bottom:""};if(k(e)||!r)return;const s=this._calculateFullWidth(r),o=this._calculateAlignmentPosition(e.x,e.y,n,s);return o?{top:o.top!==void 0?`${o.top}px`:"auto",left:o.left!==void 0?`${o.left}px`:"auto",bottom:o.bottom!==void 0?`${o.bottom}px`:"auto",right:o.right!==void 0?`${o.right}px`:"auto"}:void 0}_viewChange(e,r){e&&r&&(this.close(),this.clear())}_viewReadyChange(e,r){if(e){const i=this.get("viewModel.view");this._wireUpView(i)}else r&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:r}=this;r&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,r,i){const[n,s]=e,[o,a]=r,{width:l=0,height:c=0}=i??{};return n<=l&&o>l||n>l&&o<=l||s<=c&&a>c||s>c&&a<=c}_updateDockEnabledForViewSize(e,r){if(!e||!r)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},n=i.left+i.right,s=i.top+i.bottom,o=[],a=[];o[0]=e[0]-n,o[1]=e[1]-s,a[0]=r[0]-n,a[1]=r[1]-s;const{dockOptions:l}=this,c=l.breakpoint;this._dockingThresholdCrossed(o,a,c)&&this._setDockEnabledForViewSize(l),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const r=e.querySelectorAll("li");r.length&&r[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const r=e.querySelectorAll("li");r.length&&r[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:r}=this;if(!r)return;const i=r.active&&!e;r.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var l,c;const r=e.breakpoint,i=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.ui;if(!i)return!1;const{width:n,height:s}=i;if(isNaN(n)||isNaN(s)||!r)return!1;const o=r.hasOwnProperty("width")&&n<=(r.width??0),a=r.hasOwnProperty("height")&&s<=(r.height??0);return o||a}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,r){return this.featureNavigationVisible?Wg(this.messages.pageText,{index:r+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:r}=this;e&&(r&&r.ui&&r.ui.remove(e,Z_e),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new Ivt({view:e}),e.ui.add(this._spinner,{key:Z_e,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const r=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,n=i.findIndex(o=>o.uid===r),s=i.getItemAt(n);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(n)}_selectFeature(e){const r=e.currentTarget["data-feature-index"];isNaN(r)||(this.viewModel.selectedFeatureIndex=r),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};h([f({readOnly:!0})],Er.prototype,"actionsMenuId",null),h([f({readOnly:!0})],Er.prototype,"actionsMenuButtonId",null),h([f({readOnly:!0})],Er.prototype,"featureMenuId",null),h([f({readOnly:!0})],Er.prototype,"titleId",null),h([f({readOnly:!0})],Er.prototype,"contentId",null),h([f({readOnly:!0})],Er.prototype,"hasContent",null),h([f({readOnly:!0})],Er.prototype,"featureNavigationVisible",null),h([f({readOnly:!0})],Er.prototype,"collapsible",null),h([f({readOnly:!0})],Er.prototype,"featureMenuVisible",null),h([f({readOnly:!0})],Er.prototype,"contentCollapsed",null),h([f({readOnly:!0})],Er.prototype,"dividedActions",null),h([f({readOnly:!0,dependsOn:["_flowItems.length"]})],Er.prototype,"_activeFlowItemWidget",null),h([f()],Er.prototype,"actions",null),h([f()],Er.prototype,"actionsMenuOpen",null),h([f()],Er.prototype,"alignment",void 0),h([f()],Er.prototype,"autoCloseEnabled",null),h([f()],Er.prototype,"autoOpenEnabled",null),h([f()],Er.prototype,"defaultPopupTemplateEnabled",null),h([f()],Er.prototype,"content",null),h([f()],Er.prototype,"collapsed",void 0),h([f()],Er.prototype,"collapseEnabled",void 0),h([f({readOnly:!0})],Er.prototype,"currentAlignment",null),h([f({readOnly:!0})],Er.prototype,"currentDockPosition",null),h([f()],Er.prototype,"dockOptions",null),h([f()],Er.prototype,"dockEnabled",void 0),h([f({readOnly:!0})],Er.prototype,"featureCount",null),h([f()],Er.prototype,"featureMenuOpen",void 0),h([f()],Er.prototype,"features",null),h([f()],Er.prototype,"goToOverride",null),h([f()],Er.prototype,"headingLevel",void 0),h([f()],Er.prototype,"highlightEnabled",null),h([f()],Er.prototype,"location",null),h([f()],Er.prototype,"label",null),h([f()],Er.prototype,"maxInlineActions",void 0),h([f(),tc("esri/widgets/Popup/t9n/Popup")],Er.prototype,"messages",void 0),h([f(),tc("esri/t9n/common")],Er.prototype,"messagesCommon",void 0),h([f()],Er.prototype,"promises",null),h([f({readOnly:!0})],Er.prototype,"selectedFeature",null),h([f()],Er.prototype,"selectedFeatureIndex",null),h([f({readOnly:!0})],Er.prototype,"selectedFeatureWidget",null),h([f()],Er.prototype,"spinnerEnabled",void 0),h([f()],Er.prototype,"title",null),h([f()],Er.prototype,"updateLocationEnabled",null),h([f()],Er.prototype,"view",null),h([f({type:rFe}),npt(["triggerAction","trigger-action"])],Er.prototype,"viewModel",void 0),h([f()],Er.prototype,"visible",null),h([f()],Er.prototype,"visibleElements",void 0),h([Wr("visibleElements")],Er.prototype,"castVisibleElements",null),h([vl()],Er.prototype,"_close",null),h([vl()],Er.prototype,"_toggleDockEnabled",null),h([vl()],Er.prototype,"_toggleFeatureMenu",null),h([vl()],Er.prototype,"_toggleActionsMenu",null),h([vl()],Er.prototype,"_triggerAction",null),h([vl()],Er.prototype,"_selectFeature",null),h([vl()],Er.prototype,"_next",null),h([vl()],Er.prototype,"_previous",null),Er=h([Q("esri.widgets.Popup")],Er);const t1e=Er,IQ=[0,0];function Tbt(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return IQ[0]=r.left+((e==null?void 0:e.pageXOffset)??0),IQ[1]=r.top+((e==null?void 0:e.pageYOffset)??0),IQ}function r1e(t){t&&(kIe(t),t.parentNode&&t.parentNode.removeChild(t))}function Sbt(t){const e=document.createElement("div");return t.appendChild(e),e}const bI=16,r8=750,Ebt=512,Cbt=2,Mbt=t=>{let e=class extends t{constructor(...r){var i;super(...r),this._freqInfo={freq:bI,time:r8},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,r.length!==0&&((i=r[0])==null?void 0:i.popup)!==void 0||(this.popup=new t1e({view:this})),this.handles.add([xe(()=>this.cursor,n=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",n)}),xe(()=>this.interacting,n=>{const{surface:s}=this;s&&s.setAttribute("data-interacting",n.toString())})])}initialize(){this.handles.add(xe(()=>this.ui,(r,i)=>this._handleUIChange(r,i))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=yt(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),n=jG(r);if(n||typeof r!="string"||we.getLogger(this.declaredClass).error("#container",`element with id '${r}' not found`),i===n)return;const s="dom-size";if(this.handles.remove(s),this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(r1e(this.root),this._set("root",null)),this.userContent&&(Mge(this.userContent,i),r1e(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",Mge(n,o),n.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",n.insertBefore(a,n.firstChild),this._set("root",a);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,a.appendChild(l),this._set("surface",l);const c=new uAe;a.appendChild(c.surface),this._set("overlay",c),xe(()=>c.needsRender,u=>{u&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=NR({render:()=>{var d;return(d=this.overlay)==null?void 0:d.render()}}):this._overlayRenderTaskHandle=ps(this._overlayRenderTaskHandle)}),this.forceDOMReadyCycle(),this.handles.add(xe(()=>this.size,u=>{const[d,p]=u,A="esri-view-surface--inset-outline";d>=document.body.clientWidth||p>=document.body.clientHeight?l.classList.add(A):l.classList.remove(A)},Rr),s),this._set("container",n),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}set popup(r){const i=this._get("popup");i&&i!==r&&i.destroy(),this._set("popup",r)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(r,i,n){const s=this.position;return r-=s?s[0]:0,i-=s?s[1]:0,n?(n[0]=r,n[1]=i):n=[r,i],n}containerToPage(r,i,n){const s=this.position;return r+=s?s[0]:0,i+=s?s[1]:0,n?(n[0]=r,n[1]=i):n=[r,i],n}_handleUIChange(r,i){i&&(this.handles.remove("ui"),i.destroy()),r&&this._wireUI(r),this._set("ui",r)}_wireUI(r){this.handles.remove("ui"),r&&(r.view=this,this.handles.add([xe(()=>this.root,i=>{r.container=i?Sbt(i):null},Rr),xe(()=>this.popup,(i,n)=>{const s="popup",o="manual";n&&r.remove(n,s),i&&(i.view=r.view,r.add(i,{key:s,position:o}))},Rr)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=bI,r.time=r8,this.handles.add([(()=>{const i=()=>{r.freq=bI,r.time=r8};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),NR({prepare:i=>{const n=this._measure(),s=this._freqInfo;if(s.time+=i.deltaTime,n&&(s.freq=bI,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const o=this._position();s.freq=o||n?bI:Math.min(r8,s.freq*Cbt),!n&&s.freq>=Ebt&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,n=r?r.clientHeight:0;if(i===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,o=this.height;return i===s&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:o,width:i,height:n}),!0)}_position(){const r=this.container,i=this.position,n=r&&Tbt(r);return!!n&&(!i||n[0]!==i[0]||n[1]!==i[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return h([f()],e.prototype,"container",null),h([f({readOnly:!0})],e.prototype,"focused",null),h([f({readOnly:!0})],e.prototype,"height",void 0),h([f({type:t1e})],e.prototype,"popup",null),h([f({type:uAe})],e.prototype,"overlay",void 0),h([f({readOnly:!0})],e.prototype,"position",void 0),h([f({readOnly:!0})],e.prototype,"resizing",void 0),h([f({readOnly:!0})],e.prototype,"root",void 0),h([f({value:null,readOnly:!0})],e.prototype,"size",null),h([f({readOnly:!0})],e.prototype,"surface",void 0),h([f({readOnly:!0})],e.prototype,"suspended",void 0),h([f()],e.prototype,"ui",void 0),h([f({readOnly:!0})],e.prototype,"userContent",void 0),h([f({readOnly:!0})],e.prototype,"width",void 0),h([f()],e.prototype,"widthBreakpoint",void 0),e=h([Q("esri.views.DOMContainer")],e),e},Wue=we.getLogger("esri.layers.support.ElevationSampler");let iFe=class{queryElevation(e){return nFe(e.clone(),this)}on(){return $bt}projectIfRequired(e,r){return sFe(e,r)}},Rbt=class extends iFe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const n=e.tile.extent;this.extent=DG(n,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=n;const s=Eu(r.spatialReference),o=r.lodAt(e.tile.level).resolution*s;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return!k(r)&&this.containsAt(r.x,r.y)}containsAt(e,r){return LG(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,n=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return Wue.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return br(this.tile.sample(e,r),this.noDataValue)}},Ncr=class extends iFe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let n;super(),typeof r=="number"?(this.noDataValue=r,n=null):(n=r,this.noDataValue=i),this.samplers=n?e.map(o=>new Rbt(o,n,this.noDataValue)):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:o,max:a}=s.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=DG(oi(),n.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){for(const i of this.samplers)if(i.containsAt(e,r))return i.elevationAt(e,r);return Wue.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue}};function nFe(t,e){const r=sFe(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":Obt(t,r,e);break;case"polyline":Pbt(t,r,e);break;case"multipoint":Ibt(t,r,e)}return t}function sFe(t,e){if(k(t))return null;const r=t.spatialReference;if(r.equals(e))return t;const i=ew(t,e);return i||Wue.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function Obt(t,e,r){t.z=r.elevationAt(e.x,e.y)}function Pbt(t,e,r){rA.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n],o=e.paths[n];for(let a=0;a<s.length;a++){const l=s[a],c=o[a];rA.x=c[0],rA.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(rA.x,rA.y)}}t.hasZ=!0}function Ibt(t,e,r){rA.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const s=t.points[n],o=e.points[n];rA.x=o[0],rA.y=o[1],i&&(s[3]=s[2]),s[2]=r.elevationAt(rA.x,rA.y)}t.hasZ=!0}const rA=new Ht,$bt={remove(){}};var nie;let Dg=nie=class extends Je{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new nie({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Dg.prototype,"cols",void 0),h([f({type:ds,json:{write:!0}})],Dg.prototype,"level",void 0),h([f({type:String,json:{write:!0}})],Dg.prototype,"levelValue",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Dg.prototype,"origin",void 0),h([f({type:Number,json:{write:!0}})],Dg.prototype,"resolution",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Dg.prototype,"rows",void 0),h([f({type:Number,json:{write:!0}})],Dg.prototype,"scale",void 0),Dg=nie=h([Q("esri.layers.support.LOD")],Dg);const tm=Dg;let Dbt=class{constructor(e,r,i,n,s){this.id=e,this.level=r,this.row=i,this.col=n,this.extent=s}};var Xv;const i1e=new Hi({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let fl=Xv=class extends Je{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:n=St.WebMercator,numLODs:s=24}=t;if(!xc(n)){const d=[];if(r)for(let p=0;p<r.length;p++){const A=r[p];d.push(new tm({level:p,scale:A,resolution:A}))}else{let p=5e-4;for(let A=s-1;A>=0;A--)d.unshift(new tm({level:A,scale:p,resolution:p})),p*=2}return new Xv({dpi:96,lods:d,origin:new Ht(0,0,n),size:[i,i],spatialReference:n})}const o=c2(n),a=t.origin?new Ht({x:t.origin.x,y:t.origin.y,spatialReference:n}):new Ht(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),l=96,c=1/(Eu(n)*39.37*l),u=[];if(r)for(let d=0;d<r.length;d++){const p=r[d],A=p*c;u.push(new tm({level:d,scale:p,resolution:A}))}else{let d=oOe(n)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const p=Math.ceil(s/e);u.push(new tm({level:0,scale:d,resolution:d*c}));for(let A=1;A<p;A++){const v=d/2**e,b=v*c;u.push(new tm({level:A,scale:v,resolution:b})),d=v}}return new Xv({dpi:l,lods:u,origin:a,size:[i,i],spatialReference:n})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=c2(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return Ht.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],n=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(s=>{i.push(s.scale),e=s.scale>e?s.scale:e,r=s.scale<r?s.scale:r,n[s.level]=s})),this._set("scales",i),this._set("minScale",e),this._set("maxScale",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const n=e[i],s=e[i+1];if(n<=t)return i;if(s===t)return i+1;if(n>t&&s<t)return i+Math.log(n/t)/Math.log(n/s)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const n=this.lodAt(t);if(!n)return null;let s,o;if(typeof e=="number")s=e,o=r;else if(jo(e.spatialReference,this.spatialReference))s=e.x,o=e.y,i=r;else{const c=ew(e,this.spatialReference);if(k(c))return null;s=c.x,o=c.y,i=r}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return i||(i=new Dbt(null,0,0,0,oi())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=Xv.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===Xv.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,n=r.resolution*this.size[0]/2**i,s=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=oi()),t.extent[0]=this.origin.x+t.col*n,t.extent[1]=this.origin.y-(t.row+1)*s,t.extent[2]=t.extent[0]+n,t.extent[3]=t.extent[1]+s}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,n=i*this.size[0],s=i*this.size[1];return t[0]=this.origin.x+e.col*n,t[1]=this.origin.y-(e.row+1)*s,t[2]=t[0]+n,t[3]=t[1]+s,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return Xv.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let n=0;n<i;n++){const s=this.lods[n],o=s.resolution*e;r.push(new tm({level:s.level,scale:s.scale,resolution:o}))}return new Xv({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};h([f({type:Number,json:{write:!0}})],fl.prototype,"compressionQuality",void 0),h([f({type:Number,json:{write:!0}})],fl.prototype,"dpi",void 0),h([f({type:String,json:{read:i1e.read,write:i1e.write,origins:{"web-scene":{read:!1,write:!1}}}})],fl.prototype,"format",void 0),h([f({readOnly:!0})],fl.prototype,"isWrappable",null),h([f({type:Ht,json:{write:!0}})],fl.prototype,"origin",void 0),h([gt("origin")],fl.prototype,"readOrigin",null),h([f({type:[tm],value:null,json:{write:!0}})],fl.prototype,"lods",null),h([f({readOnly:!0})],fl.prototype,"minScale",void 0),h([f({readOnly:!0})],fl.prototype,"maxScale",void 0),h([f({readOnly:!0})],fl.prototype,"scales",void 0),h([f({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],fl.prototype,"size",void 0),h([gt("size",["rows","cols"])],fl.prototype,"readSize",null),h([Ct("size",{cols:{type:ds},rows:{type:ds}})],fl.prototype,"writeSize",null),h([f({type:St,json:{write:!0}})],fl.prototype,"spatialReference",void 0),fl=Xv=h([Q("esri.layers.support.TileInfo")],fl),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(fl||(fl={}));const kk=fl,Lbt=12;let Kh=class ju{constructor(e){const r=ju.checkUnsupported(e);if(M(r))throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=IS(this.spatialReference)||XA(this.spatialReference)||ZA(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const n=i.lods.reduce((c,u,d)=>(u.level<c.min&&(c.min=u.level,c.minIndex=d),c.max=Math.max(c.max,u.level),c),{min:1/0,minIndex:0,max:-1/0}),s=i.lods[n.minIndex],o=2**s.level;let a=s.resolution*o,l=s.scale*o;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new ju(this.toTileInfo())}toTileInfo(){return new kk({dpi:this.dpi,origin:new Ht({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new tm({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,n){const s=this.levels[e],o=s.tileSize[0],a=s.tileSize[1];n[0]=this.origin[0]+i*o,n[2]=this.origin[0]+(i+1)*o,n[3]=this.origin[1]-r*a,n[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=Xme(e[0]),r[1]=_B(e[1]),r[2]=Xme(e[2]),r[3]=_B(e[3])):this._isGCS&&(r[0]=Dr(e[0]),r[1]=Dr(e[1]),r[2]=Dr(e[2]),r[3]=Dr(e[3]))}getExtentGeometry(e,r,i,n=new an){return this.getExtent(e,r,i,rg),n.spatialReference=this.spatialReference,n.xmin=rg[0],n.ymin=rg[1],n.xmax=rg[2],n.ymax=rg[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],n=i.resolution/2;this.levels.push({resolution:n,scale:i.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof ju)){if(ju.checkUnsupported(e))return!1;e=new ju(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let n=.5*i;return!XM(e.origin[0],this.origin[0],n)||!XM(e.origin[1],this.origin[1],n)?!1:(n=.5*i/2**r/this.pixelSize*Lbt,XM(i,e.levels[r].resolution,n))}rootTilesInExtent(e,r=null,i=1/0){const n=new Array,s=this.levels[0].tileSize;if(k(e)||s[0]===0||s[1]===0)return n;ju.computeRowColExtent(e,s,this.origin,rg);let o=rg[1],a=rg[3],l=rg[0],c=rg[2];const u=c-l,d=a-o;if(u*d>i){const p=Math.floor(Math.sqrt(i));d>p&&(o=o+Math.floor(.5*d)-Math.floor(.5*p),a=o+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=o;p<a;p++)for(let A=l;A<c;A++)n.push([0,p,A]);return M(r)&&(r[0]=this.origin[0]+l*s[0],r[1]=this.origin[1]-a*s[1],r[2]=this.origin[0]+c*s[0],r[3]=this.origin[1]-o*s[1]),n}static computeRowColExtent(e,r,i,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-i[0])/r[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-i[0])/r[0])),n[1]=Math.max(0,Math.floor((i[1]-e[3]+s)/r[1])),n[3]=Math.max(0,Math.ceil((i[1]-e[1]-s)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(n=>!tnt(n.resolution,i/2**n.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,n)=>i-n);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new pe("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return k(e)?Que():e.lods.length<1?new pe("tilingscheme:generic","Tiling scheme must have at least one level"):ju.isPowerOfTwo(e)?ju.hasGapInLevels(e)?new pe("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):ju.tileSizeSupported(e)?ju.hasOriginPerLODs(e)?new pe("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new pe("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new pe("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],n=e[3]-e[1],s=Eu(r),o=1.2*Math.max(i,n),a=256,l=96,c=.0254,u=new ju(new kk({size:[a,a],origin:new Ht({x:e[0]-.5*(o-i),y:e[3]+.5*(o-n)}),lods:[new tm({level:0,resolution:o/a,scale:1/(a/l*c/(o*s))})],spatialReference:r}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const r=new ju(ju.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const n=256/r,s=new ju(new kk({size:[r,r],origin:new Ht({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new tm({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return s.ensureMaxLod(i),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function Que(){return new pe("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Kh.WebMercatorAuxiliarySphereTileInfo=new kk({size:[256,256],origin:new Ht({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:St.WebMercator}),spatialReference:St.WebMercator,lods:[new tm({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Kh.WebMercatorAuxiliarySphere=Kh.makeWebMercatorAuxiliarySphere(19);const rg=oi(),wM=64,m4=512,Nbt=2.5,dL=rnt(TK/10),oFe=2,aFe=oi();Kh.WebMercatorAuxiliarySphere.getExtent(0,0,0,aFe);const Fbt=oi([-180,-90,180,90]),kbt="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Ubt="Surface extent is too large for tile resolution at level 0.",Bbt=3;let zbt=Bbt;function sie(t){return t<4?3:zbt}let Zv=class extends Ws.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=dL}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||k(e.extent)||k(e.spatialReference))return null;const r=DG(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){var e;return br((e=this.view.basemapTerrain)==null?void 0:e.spatialReference,St.WGS84)}elevationAt(e,r){var i;if(k(this.extent)||!au(this.extent,e,r)){const n=M(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return we.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return br((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,r,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return nFe(e.clone(),this)}};h([f({readOnly:!0})],Zv.prototype,"demResolution",void 0),h([f({readOnly:!0})],Zv.prototype,"extent",null),h([f({readOnly:!0})],Zv.prototype,"noDataValue",void 0),h([f()],Zv.prototype,"spatialReference",null),h([f({constructOnly:!0})],Zv.prototype,"view",void 0),Zv=h([Q("esri.views.support.GroundViewElevationSampler")],Zv);const Vbt=Zv;let Jv=class extends rt{constructor(e){super(e),this._handles=new cn,this.view=null,this.layerViews=new ur}initialize(){this._handles.add(ic(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground},e=>e.load())),this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Vbt({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this._handles.remove("updating"),this._handles.add(this.layerViews.map(e=>xe(()=>e.updating,()=>this._updateUpdating(),fn)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};h([f({readOnly:!0})],Jv.prototype,"elevationSampler",null),h([f({type:Boolean,readOnly:!0})],Jv.prototype,"updating",null),h([f({constructOnly:!0})],Jv.prototype,"view",void 0),h([f({type:ur,readOnly:!0})],Jv.prototype,"layerViews",void 0),h([f({readOnly:!0})],Jv.prototype,"suspended",null),Jv=h([Q("esri.views.GroundView")],Jv);const Gbt=Jv,jbt=t=>{let e=class extends t{async fetchPopupFeatures(r,i){await this.when();const{location:n,queryArea:s,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(s,o,i),u=c.map(d=>d.promise);return{location:n,clientOnlyGraphics:a,allGraphicsPromise:QJ([l,...u]).then(d=>Array.from(new Set(d.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(r,i,n){return i.map(({layerView:s,graphics:o})=>{const a={clientGraphics:o,event:M(n)?n.event:void 0,signal:M(n)?n.signal:void 0,defaultPopupTemplateEnabled:!!M(n)&&!!n.defaultPopupTemplateEnabled},l=s.fetchPopupFeatures(r,a);return{layerView:s,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(M(i)&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:n,queryArea:s,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(n,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:s,location:o}}async _popupHitTestGraphics(r,i){const n=await this.popupHitTest(r),s=n.results,o=n.mapPoint,a=s.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),M(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return M(r)&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const n=[],s=new Map,o=i.map(a=>{const l=[];return"layer"in a?s.set(a.layer,l):s.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=s.get(a.layer)||s.get(a.sourceLayer)||null;l?l.push(a):n.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:n}}};return e=h([Q("esri.views.PopupView")],e),e};let iS=class extends T5{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};h([tle({Type:Pl,ensureType:Go(Pl)})],iS.prototype,"itemType",void 0),iS=h([Q("esri.support.GraphicsCollection")],iS);let Kv=class extends rt{constructor(e){super(e),this.view=null,this.baseLayerViews=new ur,this.referenceLayerViews=new ur,this._loadingHandle=xe(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap},r=>{r&&r.load().catch(()=>{})},Rr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var r,i;if(this.view&&this.view.suspended)return!1;const e=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(n=>n.updating)||this.referenceLayerViews.some(n=>n.updating))}};h([f({constructOnly:!0})],Kv.prototype,"view",void 0),h([f({readOnly:!0})],Kv.prototype,"baseLayerViews",void 0),h([f({readOnly:!0})],Kv.prototype,"referenceLayerViews",void 0),h([f({readOnly:!0})],Kv.prototype,"suspended",null),h([f({type:Boolean,readOnly:!0})],Kv.prototype,"updating",null),Kv=h([Q("esri.views.BasemapView")],Kv);function Hbt(t){return"tryRecycleWith"in t}let qbt=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=x2(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Sc(this._controller.signal,()=>{const n=new pe("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!Hbt(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==r)continue;const o=this.layerView.tryRecycleWith(s,{signal:i});if(o){e.splice(n,1),this.layer=s;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(fi(this._controller.signal),s.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),s.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>Sc(this._controller.signal,()=>u(en())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var n,s,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let a,l;if(await r.load({signal:e}),"prefetchResources"in r&&await((n=r.prefetchResources)==null?void 0:n.call(r,{signal:e})),Qbt(r))a=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new pe("layer:view-not-supported","No layerview implementation was found");const d=await this.layerViewImporter.importLayerView(r);fi(e),a="default"in d?new d.default({layer:r,view:i}):new d({layer:r,view:i})}const c=()=>{l=ps(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=Sc(e,c),fi(e);try{await a.when()}catch(d){throw c(),d}if(!((o=(s=this._map)==null?void 0:s.allLayers)==null?void 0:o.includes(r)))return c(),void this._deferred.reject(new pe("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=a,r.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:r,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){r.emit("layerview-create-error",{view:i,error:a}),i.emit("layerview-create-error",{layer:r,error:a}),this.done=!0,this._deferred.reject(new pe("layerview:create-error","layerview creation failed",{layer:r,error:a}))}}},tf=class extends rt{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new _A,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const r=(i=this.view.map)==null?void 0:i.allLayers;if(r)for(const n of r)this.layerViewImporter.hasLayerViewModule(n)&&this.layerViewImporter.importLayerView(n)},this._reschedule=()=>(k(this._workPromise)&&(this._workPromise=x2(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(WO(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,u;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),k(this._workPromise))return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,n=[],s=this.view.ready,o=d=>{if(!k(d)){for(const p of d)if(p){i.add(p);const A=this._layerLayerViewInfoMap.get(p);A&&s?A.start():A||this._recyclingInfoMap.has(p)||n.push(p),"layers"in p&&p.layers&&o(p.layers)}}};for(const d of this._rootCollectionNames)o(this.get(d));for(const[d,p]of this._layerLayerViewInfoMap)if(!i.has(d)){this._layerLayerViewInfoMap.delete(p.layer);const A=p.tryRecycle(n);A?(this._recyclingInfoMap.set(p.layer,p),A.then(()=>{this._recyclingInfoMap.delete(p.layer),this._layerLayerViewInfoMap.set(p.layer,p),this._reschedule()}).catch(()=>{this._recyclingInfoMap.delete(p.layer),p.destroy(),this._reschedule()})):p.destroy()}for(const[d,p]of this._recyclingInfoMap)i.has(d)||(this._recyclingInfoMap.delete(p.layer),p.destroy());for(const d of n)this._createLayerView(d);this._refreshCollections();const a=[(l=r==null?void 0:r.ground)==null?void 0:l.layers,(c=r==null?void 0:r.basemap)==null?void 0:c.baseLayers,(u=r==null?void 0:r.basemap)==null?void 0:u.referenceLayers,r==null?void 0:r.layers].filter(d=>!!d);i.forEach(d=>"layers"in d&&a.push(d.layers)),this.addHandles(a.map(d=>this._watchUpdatingTracking.addOnCollectionChange(()=>d,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([Bo(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),xe(()=>{const e=this.view,r=e==null?void 0:e.map;return[r==null?void 0:r.basemap,r==null?void 0:r.ground,r==null?void 0:r.layers,e==null?void 0:e.ready]},()=>this._reschedule(),vo)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,M(this._workPromise)&&(this._workPromise.reject(en()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return M(this._workPromise)||this._watchUpdatingTracking.updating||Ql(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new pe("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let n=0;for(const s of e){const o=this._layerLayerViewInfoMap.get(s);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=s,a.parent=i,r.getItemAt(n)!==a&&r.splice(n,0,a),s.layers&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),n+=1}n<r.length&&r.splice(n,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new qbt(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&($o(i)||i.name==="cancelled:layerview-create")||we.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};h([f()],tf.prototype,"_workPromise",void 0),h([f({readOnly:!0})],tf.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],tf.prototype,"_layersToLayerViews",null),h([f({readOnly:!0})],tf.prototype,"_rootCollectionNames",null),h([f()],tf.prototype,"layerViewImporter",void 0),h([f()],tf.prototype,"supportsGround",void 0),h([f({readOnly:!0})],tf.prototype,"updating",null),h([f({readOnly:!0})],tf.prototype,"updatingRemaining",null),h([f({constructOnly:!0})],tf.prototype,"view",void 0),tf=h([Q("esri.views.LayerViewManager")],tf);const Wbt=tf;function Qbt(t){return"createLayerView"in t&&t.createLayerView!=null}let kd=class extends rt{constructor(e){super(e),this.factor=1.5,this.offset=Qf(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};h([f({type:Number})],kd.prototype,"factor",void 0),h([f({nonNullable:!0})],kd.prototype,"offset",void 0),h([f()],kd.prototype,"position",void 0),h([f({type:Number,range:{min:0}})],kd.prototype,"size",void 0),h([f()],kd.prototype,"maskUrl",void 0),h([f()],kd.prototype,"maskEnabled",void 0),h([f()],kd.prototype,"overlayUrl",void 0),h([f()],kd.prototype,"overlayEnabled",void 0),h([f({readOnly:!0})],kd.prototype,"version",null),h([f({type:Boolean})],kd.prototype,"visible",void 0),kd=h([Q("esri.views.Magnifier")],kd);const lFe=kd;let Ybt=class{constructor(){this._tasks=new Array,this._running=new az(!1)}get length(){return this._tasks.length}get running(){return this._running.get()}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return this._running.set(!0),new Promise((n,s)=>this._tasks.push(new n1e(n,s,e,r,i)))}unshift(e,r,i){return this._running.set(!0),new Promise((n,s)=>this._tasks.unshift(new n1e(n,s,e,r,i)))}_process(e){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const n=Ra(r.signal);if(n&&!r.abortCallback)r.reject(en());else{const s=n?(i=r.abortCallback)==null?void 0:i.call(r,en()):r.callback(e);Op(s)?s.then(r.resolve,r.reject):r.resolve(s)}}catch(n){r.reject(n)}return this._running.set(this._tasks.length>0),!0}cancelAll(){const e=en();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0,this._running.set(!1)}},n1e=class{constructor(e,r,i,n,s){this.resolve=e,this.reject=r,this.callback=i,this.signal=n,this.abortCallback=s}},g4=class extends rt{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};h([f()],g4.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),h([f()],g4.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),g4=h([Q("esri.views.support.DebugFlags")],g4);const Xbt=new g4;var Mi;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Mi||(Mi={}));function Zbt(){return new lz.Scheduler}var rc,ar;(function(t){t[t.YIELD=1]="YIELD"})(rc||(rc={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.TEST_PRIO=1]="TEST_PRIO"}(ar||(ar={}));const Zg=0,s1e=new Map([[ar.RESOURCE_CONTROLLER_IMMEDIATE,Zg],[ar.RESOURCE_CONTROLLER,4],[ar.SLIDE,Zg],[ar.STREAM_DATA_LOADER,Zg],[ar.ELEVATION_QUERY,Zg],[ar.TERRAIN_SURFACE,1],[ar.SURFACE_GEOMETRY_UPDATES,1],[ar.LOD_RENDERER,2],[ar.GRAPHICS_CORE,2],[ar.I3S_CONTROLLER,2],[ar.POINT_CLOUD_LAYER,2],[ar.FEATURE_TILE_FETCHER,2],[ar.OVERLAY,4],[ar.STAGE,4],[ar.GRAPHICS_DECONFLICTOR,4],[ar.FILTER_VISIBILITY,4],[ar.SCALE_VISIBILITY,4],[ar.FRUSTUM_VISIBILITY,4],[ar.CLOUDS_GENERATOR,4],[ar.POINT_OF_INTEREST_FREQUENT,6],[ar.POINT_OF_INTEREST_INFREQUENT,30],[ar.LABELER,8],[ar.FEATURE_QUERY_ENGINE,8],[ar.FEATURE_TILE_TREE,16],[ar.FEATURE_TILE_TREE_ACTIVE,Zg],[ar.ELEVATION_ALIGNMENT,12],[ar.TEXT_TEXTURE_ATLAS,12],[ar.TEXTURE_UNLOAD,12],[ar.LINE_OF_SIGHT_TOOL,16],[ar.LINE_OF_SIGHT_TOOL_INTERACTIVE,Zg],[ar.SNAPPING,Zg],[ar.SHADOW_ACCUMULATOR,30]]);function o1e(t){return s1e.has(t)?s1e.get(t):typeof t=="number"?t:1}const a1e=6.5,l1e=1,Jbt=30,c1e=1e3/30,u1e=100,h1e=.9;var lz,Mw;(function(t){class e{get updating(){return this._updating.get()}_updatingChanged(){this._updating.set(this._tasks.some(s=>s.needsUpdate))}constructor(){this._updating=new az(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new E_("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Mi.INTERACTING,this._tasks=new Vr,this._runQueue=new Vr,this._load=0,this._idleStateCallbacks=new Vr,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=xe(()=>Xbt.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Rr);for(const o of Object.keys(ar))this.performanceInfo.tasks.set(ar[o],new E_(ar[o]));const s=this;this._test={FRAME_SAFETY_BUDGET:a1e,INTERACTING_BUDGET:c1e,IDLE_BUDGET:u1e,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:()=>s._budget,setBudget:o=>s._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),ps(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(s){this._updatingChanged(),s&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(s,o){const a=o1e(s),l=new r(this,s,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new E_(s)),l}registerIdleStateCallbacks(s,o){const a={idleBegin:s,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Mi.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Mi.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Mi.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(s){this._test.usedBudget=0,++this._frameNumber;let o=a1e,a=s.frameDuration,l=l1e;switch(this.state){case Mi.IDLE:o=0,a=Math.max(u1e,s.frameDuration),l=Jbt;break;case Mi.INTERACTING:a=Math.max(c1e,s.frameDuration);case Mi.ANIMATING:}return a=a-s.elapsedFrameTime-o,this.state!==Mi.IDLE&&a<l1e&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Mi.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Mi.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s),this._updatingChanged()}_updateTask(s){this._tasks.forAll(o=>{o.name===s&&o.setPriority(s)})}_getState(s){if(this._runQueue.some(a=>a.name===s))return Mw.SCHEDULED;let o=Mw.IDLE;return this._tasks.forAll(a=>{a.name===s&&a.needsUpdate&&(a.schedulePriority<=1?o=Mw.READY:o!==Mw.READY&&(o=Mw.WAITING))}),o}_getRuntime(s){let o=0;return this._tasks.forAll(a=>{a.name===s&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&s.set(a.name,(s.get(a.name)||0)+1)}),s.size===0)return null;let o="";return s.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*h1e+s*(1-h1e)}_schedule(){for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===Zg&&s.needsUpdate&&!this._runQueue.includes(s)&&s.blockFrame!==this._frameNumber&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Zg&&a.blockFrame!==this._frameNumber&&(s=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!s)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===rc.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){we.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,ar.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(ar))this._frameTaskTimes.set(ar[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(s)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.get()}get updating(){return this._queue.running}constructor(s,o,a,l){this._scheduler=s,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new Ybt,this._handles=new cn,this.schedulePriority=this._basePriority,this._task=new az(M(a)?a:this._queue),this._handles.add(ic(()=>this.task.running,c=>s.taskRunningChanged(c)))}remove(){this.processQueue(pu),this._scheduler.removeTask(this),this.schedule=hO.schedule,this.reschedule=hO.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const o=o1e(s);this._basePriority!==Zg&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,o,a){return this._queue.push(s,o,a)}reschedule(s,o,a){return this._queue.unshift(s,o,a)}processQueue(s){this._queue.runTask(s)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Mi.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,o){this._begin=this.now(),this._budget=s,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(lz||(lz={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Mw||(Mw={}));const pu=(()=>{const t=new lz.Budget;return t.enabled=!1,t})();let Kbt=class{remove(){}processQueue(){}schedule(e,r,i){try{if(Ra(r)){const n=en();return i?Promise.resolve(i(n)):Promise.reject(n)}return YJ(e(pu))}catch(n){return Promise.reject(n)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const hO=new Kbt;let xM=class extends rt{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r==null?void 0:r.registerTask(ar.TEXTURE_UNLOAD))??hO}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,r,i){const n=this.makeUid(e);let s=this._textureRequests.get(n);if(!s){const o=r();s={referenceCount:0,texture:o,textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(o),this._stage.loadImmediate(o)),this._textureRequests.set(n,s)}return s.referenceCount++,{uid:n,texture:s.texture,release:()=>this._release(n)}}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||(this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){var r;e.onRemove&&e.onRemove(),e.texture?(r=this._stage)==null||r.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return M(r)?`${e}.${r}px`:e}};h([f()],xM.prototype,"_frameTask",void 0),h([f()],xM.prototype,"updating",null),xM=h([Q("esri.views.3d.support.TextureCollection")],xM);var d1e;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(d1e||(d1e={}));const cFe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],uFe={};function hFe(t){return!!uFe[t]}function e2t(t){for(const e of t)if(!hFe(e))return!1;return!0}cFe.forEach(t=>{uFe[t]=!0});let t2t=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},n)=>{var s;return(s=this.inputManager)==null?void 0:s.installHandlers(n,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,n){const s=Array.isArray(e)?e:e.split(",");if(!e2t(s))return s.some(hFe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:n=i,n=n??f2.DEFAULT;const l=this._createUniqueGroupName(),c=new r2t(this.view,s,a,o);this._handlers.set(l,{handler:c,priority:n});for(const u of s){const d=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],n),{remove:()=>this._removeHandler(l,s)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const n=this._handlerCounts.get(i);n===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):n===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,n-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},r2t=class extends Il{constructor(e,r,i,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of r)switch(s){case"click":this.registerIncoming("click",i,o=>n(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>n(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>n(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>n(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>n(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&n(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>n(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>n(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>n(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>n(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>n(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>n(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>n(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>n(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>n(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{n(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{n(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{n(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:u,screenPoint:Qf(s,o),mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:u,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(s,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(Qf(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:n}=r.center,{action:s,pointerType:o,button:a}=r;if(s==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:u,timestamp:d}=e,p={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:i,y:n,origin:p,pointerType:o,button:a,buttons:c,radius:r.radius,angle:xu(r.angle),native:l,timestamp:d,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:A=>e.async(A),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:r,native:i,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:n,button:s,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,u=a.pointerType,{cancelable:d,timestamp:p}=e;return{type:r,x:i,y:n,pointerId:c,pointerType:u,button:s,buttons:o,native:a,timestamp:p,eventId:l,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:A=>e.async(A),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:n,native:s,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,u=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:p,timestamp:A}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:n,action:u,origin:d,native:s,timestamp:A,eventId:o,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:v=>e.async(v),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:n}=e,{x:s,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:s,y:o,deltaY:a,native:l,timestamp:n,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:n}=e.data,{cancelable:s,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:n,timestamp:o,action:r,buttons:a,axes:l,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var pL,p1e,f1e;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(pL||(pL={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(p1e||(p1e={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(f1e||(f1e={}));function i2t(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return we.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function oie(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(pL.USER)&&t.getEditableFlag(pL.MANAGER)}function Lg(t){return Qf(t.x,t.y)}function Kcr(t){return Ns(t.x,t.y)}function dFe(t,e){var i;const r=(i=t instanceof HTMLElement?t:t.surface)==null?void 0:i.getBoundingClientRect();return r?Qf(e.clientX-r.left,e.clientY-r.top):Qf(0,0)}function m1e(t,e){return e instanceof Event?dFe(t,e):Lg(e)}function g1e(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let n2t=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":A1e(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!y1e(e))break;const n=Lg(e),s=this._intersect(n,e.pointerType,r.forEachTool);if(k(s))break;const o=s.manipulator,a=s.tool;!(M(o)&&M(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,r),M(o)&&M(a)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&k(r.activeTool)&&(this._revertToNullActiveTool=!0,r.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!y1e(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=rl(n,({manipulator:u})=>u),o=rl(n,({tool:u})=>u);if(k(s)||k(o))break;const a=Lg(e);a.x=He(a.x,0,r.view.width),a.y=He(a.y,0,r.view.height);const l=n.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:l,screenPoint:a}):s.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:l}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const n=Lg(e),s=this._intersect(n,e.pointerType,r.forEachTool);if(s2t(e)||r.forEachTool(c=>{if((!M(s)||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),k(s))break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const n=Lg(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=M(s)?s.manipulator:null;if(k(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const n=Lg(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=M(s)?s.manipulator:null;if(k(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const n=Lg(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=M(s)?s.manipulator:null;if(k(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:Lg(r)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,r){const i=rl(this._grabbedManipulators.get(e.pointerId),({manipulator:n})=>n);k(i)||i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Lg(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(e){let r=null;return Ql(e,({manipulator:i})=>!(k(i)||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:n})=>{r.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{i.add(n)}),e(n=>{n.hasGrabbedManipulators=r.has(n),n.hasHoveredManipulators=i.has(n);const s=this._grabbedManipulators.values(),o=kJe(s,({tool:a})=>a===n);n.firstGrabbedManipulator=M(o)?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},n=!0,s){const o=(a,l)=>a===e&&(k(s)||s===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(e,r,i){let n=null;return i(s=>{if(s.manipulators==null||!oie(s))return!1;const o=s.manipulators.intersect(e,r);return!k(o)&&(n={tool:s,manipulator:o},!0)}),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Qf(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!A1e(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Lg(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,n){let s=this._intersect(e,i,n);const o=rl(this._hoveredManipulators.get(r),({manipulator:a})=>a);M(s)&&!s.manipulator.interactive&&(s=null),M(s)&&o===s.manipulator||(M(o)&&(o.hovering=!1),M(s)?(s.manipulator.hovering=!0,this._hoveredManipulators.set(r,s)):this._hoveredManipulators.delete(r),this._onFocusChange(n))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function A1e(t){return t==="mouse"}function y1e(t){return t.pointerType!=="mouse"||t.button===0}function s2t(t){return!!t.native.shiftKey}const _1e="attached",$Q="tools";let Jy=class extends ZD{constructor(e){super(e),this._manipulatorState=new n2t,this.tools=new ur,this.cursor=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.handles.add([this.view.on(cFe,e=>{this._handleInputEvent(e)},f2.TOOL),...i2t(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(M(e)&&!this.view.ready)return void we.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),M(r)&&r.deactivate(),M(e)&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const n=oie(i);!k(this.activeTool)&&n||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(r=>r.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}attach(){var e;this.view.type==="3d"?(this._set("textures",new xM(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([xe(()=>{const{state:r}=this.view;return"camera"in r&&r.camera},()=>this._forEachManipulator(r=>r.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",r=>this._forEachManipulator(i=>i.onElevationChange(r))),Rm(()=>this._set("textures",yt(this.textures)))],_1e)):this.handles.add(xe(()=>this.view.extent,()=>this._forEachManipulator(r=>r.onViewChange())))}detach(){M(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(_1e)}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};M(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(n=>{!r&&n.visible&&n.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),!r&&M(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove($Q),this._forEachTool(e=>{if(e instanceof rt){const r=xe(()=>[e.cursor,e.visible,e.editable],()=>{oie(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(r,$Q)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],$Q)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var r;(r=e.setEditableFlag)==null||r.call(e,pL.MANAGER,k(this.activeTool)||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;k(e)&&this._forEachTool(r=>!(!M(r.cursor)||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(k(e)||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}};h([f({constructOnly:!0,nonNullable:!0})],Jy.prototype,"view",void 0),h([f({readOnly:!0,nonNullable:!0})],Jy.prototype,"textures",void 0),h([f({value:null})],Jy.prototype,"activeTool",null),h([f({readOnly:!0,type:ur})],Jy.prototype,"tools",void 0),h([f({readOnly:!0})],Jy.prototype,"cursor",void 0),h([f({readOnly:!0})],Jy.prototype,"updating",null),Jy=h([Q("esri.views.ToolViewManager")],Jy);const o2t=Jy;let OC=class extends rt{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":a2t.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return l2t[this.deviceType]}};h([f({nonNullable:!0,readOnly:!0})],OC.prototype,"nativeIndex",void 0),h([f({type:String,readOnly:!0})],OC.prototype,"deviceType",null),h([f({type:Number,readOnly:!0})],OC.prototype,"axisThreshold",null),OC=h([Q("esri.views.input.gamepad.GamepadInputDevice")],OC);const a2t=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),l2t={standard:.15,spacemouse:.025,unknown:0},Yue=OC;let A4=class extends rt{constructor(...e){super(...e),this.devices=new ur,this.enabledFocusMode="document"}};h([f({type:ur.ofType(Yue),readOnly:!0})],A4.prototype,"devices",void 0),h([f({type:["document","view","none"]})],A4.prototype,"enabledFocusMode",void 0),A4=h([Q("esri.views.input.gamepad.GamepadSettings")],A4);const c2t=A4;let Uk=class extends rt{constructor(){super(...arguments),this.gamepad=new c2t}};h([f({readOnly:!0})],Uk.prototype,"gamepad",void 0),Uk=h([Q("esri.views.input.Input")],Uk);const u2t=Uk;let eb=class extends rt{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};h([f({type:Boolean,nonNullable:!0})],eb.prototype,"enabled",void 0),h([f({type:Yue})],eb.prototype,"device",void 0),h([f({type:["pan","zoom"],nonNullable:!0})],eb.prototype,"mode",void 0),h([f({type:["forward-down","forward-up"],nonNullable:!0})],eb.prototype,"tiltDirection",void 0),h([f({type:Number,nonNullable:!0})],eb.prototype,"velocityFactor",void 0),eb=h([Q("esri.views.navigation.gamepad.GamepadSettings")],eb);const pFe=eb;let jx=class extends rt{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new pFe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};h([f({type:Boolean})],jx.prototype,"browserTouchPanEnabled",void 0),h([f({type:pFe,nonNullable:!0})],jx.prototype,"gamepad",void 0),h([f({type:Boolean})],jx.prototype,"momentumEnabled",void 0),h([f({type:Boolean})],jx.prototype,"mouseWheelZoomEnabled",void 0),jx=h([Q("esri.views.navigation.Navigation")],jx);const fFe=jx;function aur(t,e,r){const i=mFe(t),n=e,s=h2t(i,n,r);if(i){const o=iP.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new pe("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new pe("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!d2t(t)||s===jh.Unsupported)return new pe("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(s){case jh.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(n==null?void 0:n.heightUnit)||"unknown",l=new pe("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new pe("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case jh.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(n==null?void 0:n.heightModel)||"unknown",l=new pe("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new pe("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case jh.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(n==null?void 0:n.vertCRS)||"unknown",l=new pe("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new pe("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}}return null}function h2t(t,e,r){if(!v1e(t)||!v1e(e))return jh.Unsupported;if(t==null||e==null)return jh.Ok;if(!r&&t.heightUnit!==e.heightUnit)return jh.Units;if(t.heightModel!==e.heightModel)return jh.HeightModel;switch(t.heightModel){case"gravity-related-height":return jh.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?jh.Ok:jh.CRS;default:return jh.Unsupported}}var jh;function v1e(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function d2t(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!yFe(t)}function mFe(t){var i;const e=t.url?hP(t.url):void 0;return!(((i=t.spatialReference)==null?void 0:i.vcsWkid)==null&&M(e)&&e.serverType==="ImageServer")&&gFe(t)&&t.heightModelInfo?t.heightModelInfo:yFe(t)?iP.deriveUnitFromSR(f2t,t.spatialReference):null}function gFe(t){return"heightModelInfo"in t}function AFe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function yFe(t){return AFe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):_Fe(t)}function p2t(t){return t.layers!=null||_Fe(t)||AFe(t)||gFe(t)}function _Fe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(jh||(jh={}));const f2t=new iP({heightModel:"gravity-related-height"});var wt;function b1e(t){return t==="global"?wt.Global:wt.Local}function DQ(t){return t===wt.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(wt||(wt={}));let aie,LQ=null;async function m2t(t){LQ||(LQ=be(()=>Promise.resolve().then(()=>D6t),void 0).then(e=>aie=e)),await LQ,fi(t)}async function vFe(t,e,r,i){if(!t)return null;const n=t.spatialReference;return XG()||OS(n,e)?vE(t,e):aie?aie.projectGeometry(t,e,r,i):(await Promise.race([m2t(i),tL(i)]),vFe(t,e,r,i))}let _s=class extends rt{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Gf(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return M(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return k(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,n,s,o;const e=(i=this.map)==null?void 0:i.call(this),r=[];return M(this.priorityCollection)&&r.push(this.priorityCollection),r.push({parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const s of e){const o=this._getSupportedSpatialReferences(s);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);M(a)&&(i=a)}if(M(i)&&i.length===1)break}if(r&&(k(i)||i.length!==1))return{updating:!0};const n=this._pickSpatialReferenceCandidate(i);return{spatialReference:M(n)?n.spatialReference:null,viewingMode:M(n)?n.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,n,s,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:(n=(i=this.map)==null?void 0:i.call(this))==null?void 0:n.basemap,layers:(a=(o=(s=this.map)==null?void 0:s.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){var i,n,s;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))!=null&&i.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const o of e)if(p2t(o)){const a=mFe(o);if(a)return{heightModelInfo:a,vcsWkid:(n=o.spatialReference)==null?void 0:n.vcsWkid,latestVcsWkid:(s=o.spatialReference)==null?void 0:s.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const n of e.layers){const s="fullExtents"in n&&n.fullExtents||(M(n.fullExtent)?[n.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:s[0],a=s.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const l of s)i.push({extent:l,layer:n})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(k(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),n=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:M(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(M(this._projectExtentTask.task)&&(this._projectExtentTask.task=Gf(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:n.clone(),task:xN(async s=>{try{const o=await vFe(i.extent,n,i.layer.portalItem,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(Ra(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(k(e))return r;const i=[],n=(s,o)=>M(s)?M(o)?s===o&&s:s:o;for(const s of e)for(const o of r){if(!s.spatialReference.equals(o.spatialReference))continue;const a=n(s.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:s.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return k(e)||e.length<1?M(r)?{spatialReference:r,viewingMode:null}:null:(M(r)&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==wt.Local)&&(e=e.filter(({viewingMode:i})=>i!==wt.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const n of r){const s=this.getSpatialReferenceSupport({spatialReference:n,layer:e});if(M(s)){const o=M(s.constraints)?s.constraints:[{spatialReference:n,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)(!this.requiresExtentInSpatialReference||k(this.userSpatialReference)||a.equals(this.userSpatialReference))&&i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const r={layers:[],preloading:-1,updating:!1};for(const n of e)if(this._collectCollection(n,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(()=>{}),"loading"):e.loadStatus:"loaded"}};h([f()],_s.prototype,"required",void 0),h([f({constructOnly:!0})],_s.prototype,"map",void 0),h([f({constructOnly:!0})],_s.prototype,"getSpatialReferenceSupport",void 0),h([f()],_s.prototype,"defaultSpatialReference",void 0),h([f()],_s.prototype,"userSpatialReference",void 0),h([f()],_s.prototype,"sourcePreloadCount",void 0),h([f()],_s.prototype,"priorityCollection",void 0),h([f()],_s.prototype,"requiresExtentInSpatialReference",void 0),h([f()],_s.prototype,"suspended",void 0),h([f({readOnly:!0})],_s.prototype,"ready",null),h([f({readOnly:!0})],_s.prototype,"heightModelInfoReady",null),h([f({readOnly:!0})],_s.prototype,"spatialReference",null),h([f({readOnly:!0})],_s.prototype,"extent",null),h([f({readOnly:!0})],_s.prototype,"heightModelInfo",null),h([f({readOnly:!0})],_s.prototype,"vcsWkid",null),h([f({readOnly:!0})],_s.prototype,"latestVcsWkid",null),h([f({readOnly:!0})],_s.prototype,"viewingMode",null),h([f({readOnly:!0})],_s.prototype,"tileInfo",null),h([f({readOnly:!0})],_s.prototype,"mapCollections",null),h([f({readOnly:!0})],_s.prototype,"_allLayers",null),h([f({readOnly:!0})],_s.prototype,"_spatialReferenceTask",null),h([f({readOnly:!0})],_s.prototype,"_tileInfoTask",null),h([f({readOnly:!0})],_s.prototype,"_heightModelInfoTask",null),h([f({readOnly:!0})],_s.prototype,"_extentCandidatesTask",null),h([f()],_s.prototype,"_extentTask",null),h([f()],_s.prototype,"_projectExtentTask",void 0),_s=h([Q("esri.views.support.DefaultsFromMap")],_s);var Bk;let Or=Bk=class extends _E(Ws.EventedMixin(bG(rt))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new BD({getCollections:()=>{var e,r,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new iS,this.analyses=new iO,this.typeSpecificPreconditionsReady=!0,this.layerViews=new ur,this.magnifier=new lFe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new uO,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new u2t,this.navigation=new fFe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new t2t(this),this.persistableViewModels=new ur,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(xe(()=>this.preconditionsReady,e=>{var r,i;e?(this._currentSpatialReference=this.spatialReference,Bk.views.add(this)):(this._currentSpatialReference=null,Bk.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((r=this.toolViewManager)==null||r.detach(),M(this.analysisViewManager)&&this.analysisViewManager.detach(),(i=this.layerViewManager)==null||i.clear(),this._teardown()):e&&!this.ready&&(this._startup(),M(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},fn))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,QD(()=>this.ready)))),this.basemapView=new Kv({view:this}),this.layerViewManager=new Wbt({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new o2t({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([xe(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),xe(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),xe(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([xe(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(e&&!this.spatialReference&&r){if(M(t))return;const n=Rm(()=>t=Gf(t));t=xN(async s=>{try{await yS(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}we.getLogger(this.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(n,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=yt(this.graphics),this.analyses=yt(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),yt(this.analysisViewManager),this.toolViewManager=yt(this.toolViewManager),this.layerViewManager=yt(this.layerViewManager),this.basemapView=yt(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const t=this.map;this.map=null,t==null||t.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return we.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new _s({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||e1.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(we.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:t}),t=null),e1.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){var e,r;let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&((r=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&r.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!jo(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return M(t)?t:this._cursor||"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){return this.layerViewManager.whenLayerView(t)}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}importLayerView(t){throw new pe("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return M(this.getSpatialReferenceSupport({spatialReference:t}))}when(t,e){return this.isResolved()&&!this.ready&&we.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(ic(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Or.views=new ur,h([f()],Or.prototype,"_userSpatialReference",void 0),h([f()],Or.prototype,"activeTool",null),h([f({readOnly:!0})],Or.prototype,"allLayerViews",void 0),h([f()],Or.prototype,"groundView",void 0),h([f()],Or.prototype,"animation",null),h([f()],Or.prototype,"basemapView",void 0),h([f()],Or.prototype,"center",null),h([f({readOnly:!0})],Or.prototype,"_defaultsFromMapSettings",null),h([f()],Or.prototype,"defaultsFromMap",null),h([f()],Or.prototype,"fatalError",void 0),h([f({type:an})],Or.prototype,"extent",null),h([f(PB(iS,"graphics"))],Or.prototype,"graphics",void 0),h([f(PB(iO,"analyses"))],Or.prototype,"analyses",void 0),h([f({readOnly:!0,type:iP})],Or.prototype,"heightModelInfo",null),h([f({readOnly:!0})],Or.prototype,"interacting",null),h([f({readOnly:!0})],Or.prototype,"navigating",null),h([f({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Or.prototype,"preconditionsReady",null),h([f({readOnly:!0})],Or.prototype,"typeSpecificPreconditionsReady",void 0),h([f({type:ur,readOnly:!0})],Or.prototype,"layerViews",void 0),h([f()],Or.prototype,"resolution",null),h([f({type:lFe})],Or.prototype,"magnifier",void 0),h([f({value:null,type:TPe})],Or.prototype,"map",null),h([f()],Or.prototype,"padding",void 0),h([f({readOnly:!0})],Or.prototype,"ready",void 0),h([f({type:St})],Or.prototype,"spatialReference",null),h([f()],Or.prototype,"spatialReferenceWarningDelay",void 0),h([f()],Or.prototype,"stationary",null),h([f({readOnly:!0})],Or.prototype,"supportsGround",void 0),h([f({type:ey})],Or.prototype,"timeExtent",void 0),h([f({type:uO,nonNullable:!0})],Or.prototype,"timeReference",void 0),h([f()],Or.prototype,"tools",null),h([f()],Or.prototype,"toolViewManager",void 0),h([f({readOnly:!0})],Or.prototype,"type",void 0),h([f({type:Number})],Or.prototype,"scale",void 0),h([f({readOnly:!0})],Or.prototype,"updating",void 0),h([f({readOnly:!0})],Or.prototype,"initialExtentRequired",void 0),h([f({readOnly:!0})],Or.prototype,"initialExtent",null),h([f()],Or.prototype,"cursor",null),h([f({readOnly:!0})],Or.prototype,"input",void 0),h([f({type:fFe,nonNullable:!0})],Or.prototype,"navigation",void 0),h([f()],Or.prototype,"layerViewManager",void 0),h([f()],Or.prototype,"analysisViewManager",void 0),h([f()],Or.prototype,"width",void 0),h([f()],Or.prototype,"height",void 0),h([f({readOnly:!0})],Or.prototype,"resizing",void 0),h([f({value:null,readOnly:!0})],Or.prototype,"size",null),h([f({readOnly:!0})],Or.prototype,"suspended",void 0),h([f({readOnly:!0})],Or.prototype,"viewEvents",void 0),h([f({readOnly:!0})],Or.prototype,"persistableViewModels",void 0),h([f()],Or.prototype,"_isValid",void 0),h([f()],Or.prototype,"_readyCycleForced",void 0),h([f()],Or.prototype,"_currentSpatialReference",void 0),Or=Bk=h([Q("esri.views.View")],Or);const g2t=Or;let tb=class extends fB{constructor(e){super(e),this.state="running",this.target=null,this._dfd=null}initialize(){this.addResolvingPromise(new Promise((e,r)=>this._dfd={resolve:e,reject:r}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._dfd)==null||e.reject(new pe("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._dfd)==null||e.resolve())}update(e,r){r||(r=Op(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};h([f({readOnly:!0})],tb.prototype,"done",null),h([f({readOnly:!0,type:String})],tb.prototype,"state",void 0),h([f()],tb.prototype,"target",void 0),tb=h([Q("esri.views.ViewAnimation")],tb),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(tb||(tb={}));const dO=tb,wI=()=>be(()=>import("./TileLayerView3D-0b7f89bd.js"),["assets/TileLayerView3D-0b7f89bd.js","assets/LayerView3D-474f129a.js","assets/TiledLayerView3D-8e26de5e.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js","assets/MapServiceLayerViewHelper-3a69db22.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-b3127c30.js","assets/popupUtils-aa7f4b4b.js","assets/drapedUtils-8b2c7b4e.js"]),w1e=()=>be(()=>import("./ElevationLayerView3D-4296b0d2.js"),["assets/ElevationLayerView3D-4296b0d2.js","assets/LayerView3D-474f129a.js","assets/TiledLayerView3D-8e26de5e.js","assets/LayerView-16dcda92.js"]),x1e={"base-dynamic":()=>be(()=>import("./BaseDynamicLayerView3D-9e4be23e.js"),["assets/BaseDynamicLayerView3D-9e4be23e.js","assets/DynamicLayerView3D-c193fe2d.js","assets/LayerView3D-474f129a.js","assets/projectExtentUtils-3ff67c3c.js","assets/ImageMaterial-7ce82e3a.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js"]),"base-elevation":w1e,"base-tile":wI,"bing-maps":wI,"building-scene":()=>be(()=>import("./BuildingSceneLayerView3D-9d7eb7d7.js"),["assets/BuildingSceneLayerView3D-9d7eb7d7.js","assets/BuildingGroupSublayer-82b6de0e.js","assets/BuildingComponentSublayer-24fc4add.js","assets/capabilities-a18453f6.js","assets/I3SIndexInfo-9a4e506e.js","assets/I3SLayerDefinitions-94718f6f.js","assets/I3SUtil-efcb1101.js","assets/I3SBinaryReader-24647ffa.js","assets/popupUtils-aa7f4b4b.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/I3SMeshView3D-6513fc27.js","assets/I3SOverrides-9d47a918.js","assets/I3SNode-bb3ecd90.js","assets/RenderTexture-02704a42.js","assets/FeatureLayerView3D-340618fa.js","assets/FeatureLayerViewBase3D-655aaac7.js","assets/FeatureLikeLayerView3D-3569dad2.js","assets/dehydratedFeatureComparison-ba94cb88.js","assets/queryForSymbologySnapping-f6ac117f.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e9956441.js","assets/QueryEngineResult-a3e60b60.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/projectExtentUtils-3ff67c3c.js","assets/LayerView3D-474f129a.js","assets/EventedSet-d6443c8f.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js","assets/SceneModification-53ccfd37.js","assets/persistable-6c60b63f.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-f390a176.js","assets/SceneLayerWorker-e0b63c5e.js","assets/I3SQueryFeatureStore-3d1cf043.js","assets/DefinitionExpressionSceneLayerView-cbc4e1f6.js"]),csv:()=>be(()=>import("./CSVLayerView3D-4c294f4f.js"),["assets/CSVLayerView3D-4c294f4f.js","assets/FeatureLayerViewBase3D-655aaac7.js","assets/FeatureLikeLayerView3D-3569dad2.js","assets/dehydratedFeatureComparison-ba94cb88.js","assets/queryForSymbologySnapping-f6ac117f.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e9956441.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/projectExtentUtils-3ff67c3c.js","assets/LayerView3D-474f129a.js","assets/EventedSet-d6443c8f.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js"]),dimension:()=>be(()=>import("./DimensionLayerView3D-4c53836f.js"),["assets/DimensionLayerView3D-4c53836f.js","assets/LayerView3D-474f129a.js","assets/LayerView-16dcda92.js"]),elevation:w1e,feature:()=>be(()=>import("./FeatureLayerView3D-340618fa.js"),["assets/FeatureLayerView3D-340618fa.js","assets/FeatureLayerViewBase3D-655aaac7.js","assets/FeatureLikeLayerView3D-3569dad2.js","assets/dehydratedFeatureComparison-ba94cb88.js","assets/queryForSymbologySnapping-f6ac117f.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e9956441.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/projectExtentUtils-3ff67c3c.js","assets/LayerView3D-474f129a.js","assets/EventedSet-d6443c8f.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js"]),geojson:()=>be(()=>import("./GeoJSONLayerView3D-60c1f75b.js"),["assets/GeoJSONLayerView3D-60c1f75b.js","assets/FeatureLayerViewBase3D-655aaac7.js","assets/FeatureLikeLayerView3D-3569dad2.js","assets/dehydratedFeatureComparison-ba94cb88.js","assets/queryForSymbologySnapping-f6ac117f.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e9956441.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/projectExtentUtils-3ff67c3c.js","assets/LayerView3D-474f129a.js","assets/EventedSet-d6443c8f.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js"]),graphics:()=>be(()=>import("./GraphicsLayerView3D-eaf63399.js"),["assets/GraphicsLayerView3D-eaf63399.js","assets/LayerView3D-474f129a.js","assets/queryForSymbologySnapping-f6ac117f.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/GraphicsProcessor-8db9922e.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/projectExtentUtils-3ff67c3c.js","assets/LayerView-16dcda92.js"]),group:()=>be(()=>import("./GroupLayerView-d368109f.js"),["assets/GroupLayerView-d368109f.js","assets/LayerView-16dcda92.js"]),imagery:()=>be(()=>import("./ImageryLayerView3D-a615cb1e.js"),["assets/ImageryLayerView3D-a615cb1e.js","assets/DynamicLayerView3D-c193fe2d.js","assets/LayerView3D-474f129a.js","assets/projectExtentUtils-3ff67c3c.js","assets/ImageMaterial-7ce82e3a.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js","assets/popupUtils-aa7f4b4b.js"]),"integrated-mesh":()=>be(()=>import("./IntegratedMeshLayerView3D-c8b98a58.js"),["assets/IntegratedMeshLayerView3D-c8b98a58.js","assets/I3SMeshView3D-6513fc27.js","assets/I3SOverrides-9d47a918.js","assets/I3SNode-bb3ecd90.js","assets/I3SUtil-efcb1101.js","assets/I3SBinaryReader-24647ffa.js","assets/RenderTexture-02704a42.js","assets/FeatureLayerView3D-340618fa.js","assets/FeatureLayerViewBase3D-655aaac7.js","assets/FeatureLikeLayerView3D-3569dad2.js","assets/dehydratedFeatureComparison-ba94cb88.js","assets/queryForSymbologySnapping-f6ac117f.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e9956441.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/projectExtentUtils-3ff67c3c.js","assets/LayerView3D-474f129a.js","assets/EventedSet-d6443c8f.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js","assets/SceneModification-53ccfd37.js","assets/persistable-6c60b63f.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-f390a176.js","assets/SceneLayerWorker-e0b63c5e.js"]),"line-of-sight":()=>be(()=>import("./LineOfSightLayerView3D-57474df1.js"),["assets/LineOfSightLayerView3D-57474df1.js","assets/LayerView3D-474f129a.js","assets/LayerView-16dcda92.js"]),"map-image":()=>be(()=>import("./MapImageLayerView3D-3bbb38d7.js"),["assets/MapImageLayerView3D-3bbb38d7.js","assets/DynamicLayerView3D-c193fe2d.js","assets/LayerView3D-474f129a.js","assets/projectExtentUtils-3ff67c3c.js","assets/ImageMaterial-7ce82e3a.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js","assets/ExportImageParameters-a5fdcbe0.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-b3127c30.js","assets/MapServiceLayerViewHelper-3a69db22.js","assets/popupUtils-aa7f4b4b.js","assets/drapedUtils-8b2c7b4e.js"]),media:()=>be(()=>import("./MediaLayerView3D-78755890.js"),["assets/MediaLayerView3D-78755890.js","assets/MediaElementView-a5d51fbd.js","assets/normalizeUtilsSync-a000fbb8.js","assets/LayerView3D-474f129a.js","assets/ImageMaterial-7ce82e3a.js","assets/LayerView-16dcda92.js"]),"ogc-feature":()=>be(()=>import("./OGCFeatureLayerView3D-3ea22110.js"),["assets/OGCFeatureLayerView3D-3ea22110.js","assets/FeatureLayerViewBase3D-655aaac7.js","assets/FeatureLikeLayerView3D-3569dad2.js","assets/dehydratedFeatureComparison-ba94cb88.js","assets/queryForSymbologySnapping-f6ac117f.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e9956441.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/projectExtentUtils-3ff67c3c.js","assets/LayerView3D-474f129a.js","assets/EventedSet-d6443c8f.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js"]),"open-street-map":wI,"oriented-imagery":()=>be(()=>import("./FeatureLayerView3D-340618fa.js"),["assets/FeatureLayerView3D-340618fa.js","assets/FeatureLayerViewBase3D-655aaac7.js","assets/FeatureLikeLayerView3D-3569dad2.js","assets/dehydratedFeatureComparison-ba94cb88.js","assets/queryForSymbologySnapping-f6ac117f.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e9956441.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/projectExtentUtils-3ff67c3c.js","assets/LayerView3D-474f129a.js","assets/EventedSet-d6443c8f.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js"]),"point-cloud":()=>be(()=>import("./PointCloudLayerView3D-911c9a27.js").then(t=>t.P),["assets/PointCloudLayerView3D-911c9a27.js","assets/LayerView3D-474f129a.js","assets/I3SUtil-efcb1101.js","assets/I3SBinaryReader-24647ffa.js","assets/PointCloudWorkerUtil-f3885e65.js","assets/PointCloudUniqueValueRenderer-544c99fa.js","assets/PopupSceneLayerView-e7ca30b4.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js"]),voxel:()=>be(()=>import("./VoxelLayerView3D-45fc5fac.js"),["assets/VoxelLayerView3D-45fc5fac.js","assets/LayerView3D-474f129a.js","assets/PopupSceneLayerView-e7ca30b4.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js"]),route:()=>be(()=>import("./RouteLayerView3D-f93f4d88.js"),["assets/RouteLayerView3D-f93f4d88.js","assets/Stop-8e2be748.js","assets/LayerView3D-474f129a.js","assets/GraphicsProcessor-8db9922e.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/projectExtentUtils-3ff67c3c.js","assets/EventedSet-d6443c8f.js","assets/LayerView-16dcda92.js"]),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?be(()=>import("./SceneLayerView3D-08fe0c4b.js"),["assets/SceneLayerView3D-08fe0c4b.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/floorFilterUtils-080a7cd2.js","assets/I3SMeshView3D-6513fc27.js","assets/I3SOverrides-9d47a918.js","assets/I3SNode-bb3ecd90.js","assets/I3SUtil-efcb1101.js","assets/I3SBinaryReader-24647ffa.js","assets/RenderTexture-02704a42.js","assets/FeatureLayerView3D-340618fa.js","assets/FeatureLayerViewBase3D-655aaac7.js","assets/FeatureLikeLayerView3D-3569dad2.js","assets/dehydratedFeatureComparison-ba94cb88.js","assets/queryForSymbologySnapping-f6ac117f.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/QueryEngine-e9956441.js","assets/QueryEngineResult-a3e60b60.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/projectExtentUtils-3ff67c3c.js","assets/LayerView3D-474f129a.js","assets/EventedSet-d6443c8f.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js","assets/SceneModification-53ccfd37.js","assets/persistable-6c60b63f.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-f390a176.js","assets/SceneLayerWorker-e0b63c5e.js","assets/SceneLayerView-8bcec79d.js","assets/DefinitionExpressionSceneLayerView-cbc4e1f6.js","assets/I3SQueryFeatureStore-3d1cf043.js","assets/PopupSceneLayerView-e7ca30b4.js"]):be(()=>import("./SceneLayerGraphicsView3D-b70ed243.js"),["assets/SceneLayerGraphicsView3D-b70ed243.js","assets/I3SOverrides-9d47a918.js","assets/I3SNode-bb3ecd90.js","assets/I3SUtil-efcb1101.js","assets/I3SBinaryReader-24647ffa.js","assets/RenderTexture-02704a42.js","assets/FeatureLayerView3D-340618fa.js","assets/FeatureLayerViewBase3D-655aaac7.js","assets/FeatureLikeLayerView3D-3569dad2.js","assets/dehydratedFeatureComparison-ba94cb88.js","assets/queryForSymbologySnapping-f6ac117f.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e9956441.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/projectExtentUtils-3ff67c3c.js","assets/LayerView3D-474f129a.js","assets/EventedSet-d6443c8f.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js","assets/SceneLayerView-8bcec79d.js","assets/DefinitionExpressionSceneLayerView-cbc4e1f6.js","assets/PopupSceneLayerView-e7ca30b4.js"]),stream:()=>be(()=>import("./StreamLayerView3D-14a2a449.js"),["assets/StreamLayerView3D-14a2a449.js","assets/StreamFeatureManager-68ffd9c5.js","assets/createConnection-fb6d6a7b.js","assets/EventedSet-d6443c8f.js","assets/FeatureLikeLayerView3D-3569dad2.js","assets/dehydratedFeatureComparison-ba94cb88.js","assets/queryForSymbologySnapping-f6ac117f.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e9956441.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/projectExtentUtils-3ff67c3c.js","assets/LayerView3D-474f129a.js","assets/LayerView-16dcda92.js"]),tile:wI,"imagery-tile":()=>be(()=>import("./ImageryTileLayerView3D-b7f1455b.js"),["assets/ImageryTileLayerView3D-b7f1455b.js","assets/LayerView3D-474f129a.js","assets/TiledLayerView3D-8e26de5e.js","assets/rasterProjectionHelper-49608d5b.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js","assets/drapedUtils-8b2c7b4e.js"]),"vector-tile":()=>be(()=>import("./VectorTileLayerView3D-4e6a9707.js"),["assets/VectorTileLayerView3D-4e6a9707.js","assets/Rect-98da58d6.js","assets/rasterizingUtils-a339c8d2.js","assets/StyleRepository-99278a90.js","assets/enums-c655c737.js","assets/colorUtils-c0f43caf.js","assets/TileClipper-ae6eca9e.js","assets/TileInfoView-8d1457e7.js","assets/number-b10bd8f5.js","assets/GeometryUtils-0258f920.js","assets/LayerView3D-474f129a.js","assets/TiledLayerView3D-8e26de5e.js","assets/LayerView-16dcda92.js"]),wcs:()=>be(()=>import("./ImageryTileLayerView3D-b7f1455b.js"),["assets/ImageryTileLayerView3D-b7f1455b.js","assets/LayerView3D-474f129a.js","assets/TiledLayerView3D-8e26de5e.js","assets/rasterProjectionHelper-49608d5b.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js","assets/drapedUtils-8b2c7b4e.js"]),"web-tile":wI,wfs:()=>be(()=>import("./WFSLayerView3D-9c0cda6f.js"),["assets/WFSLayerView3D-9c0cda6f.js","assets/FeatureLayerViewBase3D-655aaac7.js","assets/FeatureLikeLayerView3D-3569dad2.js","assets/dehydratedFeatureComparison-ba94cb88.js","assets/queryForSymbologySnapping-f6ac117f.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-e9956441.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-19ba590b.js","assets/BoundsStore-93024c68.js","assets/projectExtentUtils-3ff67c3c.js","assets/LayerView3D-474f129a.js","assets/EventedSet-d6443c8f.js","assets/popupUtils-aa7f4b4b.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js"]),wms:()=>be(()=>import("./WMSLayerView3D-0628c8dc.js"),["assets/WMSLayerView3D-0628c8dc.js","assets/DynamicLayerView3D-c193fe2d.js","assets/LayerView3D-474f129a.js","assets/projectExtentUtils-3ff67c3c.js","assets/ImageMaterial-7ce82e3a.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js","assets/ExportWMSImageParameters-35888fba.js"]),wmts:()=>be(()=>import("./WMTSLayerView3D-27487503.js"),["assets/WMTSLayerView3D-27487503.js","assets/LayerView3D-474f129a.js","assets/TiledLayerView3D-8e26de5e.js","assets/LayerView-16dcda92.js","assets/RefreshableLayerView-1b4a0f6e.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function A2t(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new pe(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const T1e={hasLayerViewModule:t=>M(x1e[t.type]),importLayerView:t=>{const e=x1e[t.type];if(k(e))throw A2t(t);return e(t)}},S1e="analyses-owner-handles";var TM,_T;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(TM||(TM={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(_T||(_T={}));let Hx=class extends ZD{constructor(e){super(e),this._allAnalysisViews=new ur,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=E1e(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(en("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(en()),this._attachedToViewResolver=E1e()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(k(r)||r.state.list===_T.REMOVED)throw new pe("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),S1e)}_disconnectOwners(){this.handles.remove(S1e),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const n of e)this._addAnalysis(n);const r=e.on("after-add",n=>this._addAnalysis(n.item)),i=e.on("after-remove",n=>this._removeAnalysis(n.item));return{remove:()=>{r.remove(),i.remove();for(const n of e)this._removeAnalysis(n)}}}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:TM.PENDING,list:_T.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=xN(n=>this._createAnalysisViewPromise(i,n))}else r.state.list=_T.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=_T.REMOVED,this._scheduleUpdate()):we.getLogger(this.declaredClass).error("Trying to remove analysis which was not added")}_scheduleUpdate(){M(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=WO(()=>this._update()))}_update(){this._scheduledUpdateHandle=ps(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===_T.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case TM.PENDING:e.createAnalysisViewTask=Gf(e.createAnalysisViewTask);break;case TM.CREATED:M(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=yt(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,n=i.type,s=this._analysisModules[n];if(this._creatingViewCount+=1,k(s.module))try{s.module=await this._loadAnalysisModule(n)}catch(a){throw this._creatingViewCount-=1,a}if(Ra(r))throw this._creatingViewCount-=1,en("AnalysisView creation aborted");const o=new s.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(Ra(r))throw this._creatingViewCount-=1,o.destroy(),en("AnalysisView creation aborted");return e.view=o,e.state.view=TM.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return be(()=>import("./AreaMeasurementAnalysisView3D-c5152dec.js").then(r=>r.A),["assets/AreaMeasurementAnalysisView3D-c5152dec.js","assets/analysisThemeUtils-f2859686.js","assets/Segment-12480e2d.js","assets/LineVisualElement-7f027040.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/geometryEngine-646dd4a0.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-e58e5b2c.js","assets/EditGeometryOperations-f59fddde.js"]);case"dimension":return be(()=>import("./DimensionAnalysisView3D-3c53b5c2.js").then(r=>r.D),["assets/DimensionAnalysisView3D-3c53b5c2.js","assets/LineVisualElement-7f027040.js","assets/LengthDimension-1b7b3650.js","assets/Segment-12480e2d.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/analysisViewUtils-780d595f.js","assets/ImageMaterial-7ce82e3a.js","assets/Factory-0eff498c.js","assets/RightAngleQuadVisualElement-74f16dee.js","assets/VisualElementResources-c19d06c6.js","assets/PointVisualElement-c97491d1.js","assets/colorUtils-c0f43caf.js","assets/EditGeometryOperations-f59fddde.js","assets/QueryEngineResult-a3e60b60.js","assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js","assets/utils-81b4810e.js","assets/generateRendererUtils-4acfdc77.js","assets/json-48e3ea08.js","assets/dehydratedFeatureComparison-ba94cb88.js","assets/RenderTexture-02704a42.js"]);case"direct-line-measurement":return be(()=>import("./DirectLineMeasurementAnalysisView3D-bc0f463a.js").then(r=>r.D),["assets/DirectLineMeasurementAnalysisView3D-bc0f463a.js","assets/analysisThemeUtils-f2859686.js","assets/Segment-12480e2d.js","assets/LineVisualElement-7f027040.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/geometryEngine-646dd4a0.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-e58e5b2c.js","assets/RightAngleQuadVisualElement-74f16dee.js","assets/VisualElementResources-c19d06c6.js"]);case"line-of-sight":return be(()=>import("./LineOfSightAnalysisView3D-d4bc292e.js"),["assets/LineOfSightAnalysisView3D-d4bc292e.js","assets/LineVisualElement-7f027040.js","assets/LineOfSightAnalysisTarget-f2fbe6f9.js","assets/persistable-6c60b63f.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-f390a176.js","assets/elevationInfoUtils-c6fdc0e0.js","assets/analysisViewUtils-780d595f.js","assets/ImageMaterial-7ce82e3a.js","assets/PointVisualElement-c97491d1.js","assets/VisualElementResources-c19d06c6.js"]);case"slice":return be(()=>import("./SliceAnalysisView3D-d62eb633.js").then(r=>r.S),["assets/SliceAnalysisView3D-d62eb633.js","assets/LineVisualElement-7f027040.js","assets/persistable-6c60b63f.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-f390a176.js","assets/BuildingComponentSublayer-24fc4add.js","assets/capabilities-a18453f6.js","assets/I3SIndexInfo-9a4e506e.js","assets/I3SLayerDefinitions-94718f6f.js","assets/I3SUtil-efcb1101.js","assets/I3SBinaryReader-24647ffa.js","assets/popupUtils-aa7f4b4b.js","assets/analysisViewUtils-780d595f.js","assets/ImageMaterial-7ce82e3a.js","assets/Factory-0eff498c.js"])}}};function E1e(){const t=T2();return t.promise.catch(()=>{}),t}h([f()],Hx.prototype,"updating",null),h([f({constructOnly:!0})],Hx.prototype,"view",void 0),h([f()],Hx.prototype,"_allAnalysisViews",void 0),h([f()],Hx.prototype,"_creatingViewCount",void 0),Hx=h([Q("esri.views.3d.analysis.AnalysisViewManager3D")],Hx);const y2t=Hx;let Ky=class extends rt{constructor(e){super(e),this.collision=new y4,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===wt.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==wt.Local?this._set("altitude",e):we.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?He(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return He(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===wt.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=NQ)=>(i.min=Hl.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?lk([[4e3,Hl.max],[1e4,Dr(88)],[6e6,Dr(88)]]):()=>Hl.max;return(r,i=NQ)=>(i.min=Hl.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?lk([[4e3,Hl.max],[5e4,Dr(88)],[6e6,Dr(88)],[2e7,Hl.min]]):lk([[3e5,Hl.max],[3e6,Dr(88)],[6e6,Dr(88)],[2e7,Hl.min]]);return(r,i=NQ)=>(i.min=Hl.min,i.max=e(r),i)}};function _2t(t){return{min:-2e5,max:4*t.radius}}h([f()],Ky.prototype,"altitude",null),h([f({readOnly:!0})],Ky.prototype,"collision",void 0),h([f()],Ky.prototype,"distance",void 0),h([f({readOnly:!0})],Ky.prototype,"minimumPoiDistance",void 0),h([f()],Ky.prototype,"tilt",void 0),h([f({constructOnly:!0})],Ky.prototype,"mode",void 0),Ky=h([Q("esri.views.3d.state.Constraints")],Ky);const C1e=_2t(yi),Hl={min:Dr(.5),max:Dr(179.5)},NQ={min:0,max:0};let y4=class extends rt{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};h([f({type:Boolean})],y4.prototype,"enabled",void 0),h([f({type:Number})],y4.prototype,"elevationMargin",void 0),y4=h([Q("esri.views.3d.state.Constraints.CollisionConstraint")],y4);let SM=class extends rt{constructor(){super(...arguments),this.min=C1e.min,this.max=C1e.max}};h([f({type:Number})],SM.prototype,"min",void 0),h([f({type:Number})],SM.prototype,"max",void 0),SM=h([Q("esri.views.3d.constraints.AltitudeConstraint")],SM);let h_=class extends rt{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};h([f({type:Number,value:1e-8})],h_.prototype,"near",null),h([Wr("near")],h_.prototype,"castNear",null),h([f({type:Number,value:1e-8})],h_.prototype,"far",null),h([Wr("far")],h_.prototype,"castFar",null),h([f({type:["auto","manual"]})],h_.prototype,"mode",void 0),h_=h([Q("esri.views.3d.constraints.ClipDistanceConstraint")],h_);const lie={min:xu(Hl.min),max:xu(Hl.max)};let vT=class extends rt{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return He(e,lie.min,lie.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};h([f({type:["auto","manual"]})],vT.prototype,"mode",void 0),h([f({type:Number,value:lie.max})],vT.prototype,"max",null),h([Wr("max")],vT.prototype,"castMax",null),vT=h([Q("esri.views.3d.constraints.TiltConstraint")],vT);let bT=class extends rt{constructor(){super(...arguments),this.tilt=new vT,this.altitude=new SM,this.clipDistance=new h_}};h([f({type:vT})],bT.prototype,"tilt",void 0),h([f({type:SM})],bT.prototype,"altitude",void 0),h([f({type:h_})],bT.prototype,"clipDistance",void 0),bT=h([Q("esri.views.3d.constraints.Constraints")],bT);var cie;let rf=cie=class extends Je{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new cie(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};h([f({readOnly:!0,type:["sun"],json:{write:!0}})],rf.prototype,"type",void 0),h([f({type:Date,json:{type:Number,write:{target:"datetime"}}})],rf.prototype,"date",void 0),h([gt("date",["datetime"])],rf.prototype,"readDate",null),h([Ct("date")],rf.prototype,"writeDate",null),h([f({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],rf.prototype,"directShadowsEnabled",void 0),h([gt("directShadowsEnabled",["directShadows"])],rf.prototype,"readDirectShadowsEnabled",null),h([Ct("directShadowsEnabled")],rf.prototype,"writedirectShadowsEnabled",null),h([f({type:Number,json:{write:!0}})],rf.prototype,"displayUTCOffset",void 0),h([Ct("displayUTCOffset")],rf.prototype,"writeDisplayUTCOffset",null),rf=cie=h([Q("esri.webscene.SunLighting")],rf);const fL=rf;var PC;let Ng=PC=class extends Ws.EventedMixin(fL){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new PC(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=PC.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;M(t)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const n=PC.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==n&&(FQ.target=this,FQ.timezoneOffset=n,this.emit("timezone-will-change",FQ)),M(t))return!!isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new PC({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],Ng.prototype,"cameraTrackingEnabled",void 0),h([f({type:Boolean})],Ng.prototype,"ambientOcclusionEnabled",void 0),h([f({type:Boolean})],Ng.prototype,"waterReflectionEnabled",void 0),h([f({type:Date})],Ng.prototype,"defaultDate",null),h([f({type:Date})],Ng.prototype,"date",null),Ng=PC=h([Q("esri.views.3d.environment.SunLighting")],Ng),function(t){function e({hours:r,minutes:i,seconds:n}){return Math.round(r+i/60+n/3600)}t.calculateTimezoneOffset=e}(Ng||(Ng={}));const FQ={target:null,timezoneOffset:0},rb=Ng;var uie;let _4=uie=class extends Je{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new uie(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};h([f({readOnly:!0,type:["virtual"],json:{write:!0}})],_4.prototype,"type",void 0),h([f({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],_4.prototype,"directShadowsEnabled",void 0),_4=uie=h([Q("esri.webscene.VirtualLighting")],_4);const Rj=_4;var zk;let IC=zk=class extends Ws.EventedMixin(Rj){constructor(t){super(t),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.cameraTrackingEnabled=!0}clone(){return new zk({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new zk(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],IC.prototype,"ambientOcclusionEnabled",void 0),h([f({type:Boolean})],IC.prototype,"waterReflectionEnabled",void 0),h([f({type:Boolean})],IC.prototype,"cameraTrackingEnabled",void 0),IC=zk=h([Q("esri.views.3d.environment.VirtualLighting")],IC);const v4=IC,v2t={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:rb,virtual:v4}};var hie;let U5=hie=class extends rt{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new hie({quality:this.quality})}};h([f({type:["low","high"],value:"low"})],U5.prototype,"quality",null),U5=hie=h([Q("esri.views.3d.environment.SceneViewAtmosphere")],U5);var die;let b4=die=class extends Je{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new die({cloudCover:this.cloudCover})}};h([nr({sunny:"sunny"})],b4.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b4.prototype,"cloudCover",void 0),b4=die=h([Q("esri.views.3d.environment.SunnyWeather")],b4);const pie=b4;var fie;let w4=fie=class extends Je{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new fie({cloudCover:this.cloudCover})}};h([nr({cloudy:"cloudy"})],w4.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w4.prototype,"cloudCover",void 0),w4=fie=h([Q("esri.views.3d.environment.CloudyWeather")],w4);const b2t=w4;var mie;let x4=mie=class extends Je{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new mie({fogStrength:this.fogStrength})}};h([nr({foggy:"foggy"})],x4.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],x4.prototype,"fogStrength",void 0),x4=mie=h([Q("esri.views.3d.environment.FoggyWeather")],x4);const w2t=x4;var gie;let $C=gie=class extends Je{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new gie({cloudCover:this.cloudCover,precipitation:this.precipitation})}};h([nr({rainy:"rainy"})],$C.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],$C.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],$C.prototype,"precipitation",void 0),$C=gie=h([Q("esri.views.3d.environment.RainyWeather")],$C);const x2t=$C;var Aie;let qx=Aie=class extends Je{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Aie({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};h([nr({snowy:"snowy"})],qx.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qx.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qx.prototype,"precipitation",void 0),h([f({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],qx.prototype,"snowCover",void 0),qx=Aie=h([Q("esri.views.3d.environment.SnowyWeather")],qx);const T2t=qx,bFe={key:"type",base:pie,typeMap:{sunny:pie,cloudy:b2t,rainy:x2t,snowy:T2t,foggy:w2t}},S2t=Object.keys(bFe.typeMap);function E2t(t,e){return!!S2t.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const ff=1e4,C2t={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:fL,virtual:Rj}};let Vk=class extends Je{constructor(e){super(e)}clone(){}};h([f({readOnly:!0,json:{read:!1}})],Vk.prototype,"type",void 0),Vk=h([Q("esri.webscene.background.Background")],Vk);const wFe=Vk;var yie;const M2t={..._1,nonNullable:!0};let T4=yie=class extends wFe{constructor(t){super(t),this.type="color",this.color=new $t([0,0,0,1])}clone(){return new yie(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};h([nr({color:"color"},{readOnly:!0})],T4.prototype,"type",void 0),h([f(M2t)],T4.prototype,"color",void 0),T4=yie=h([Q("esri.webscene.background.ColorBackground")],T4);const xFe=T4,M1e={base:wFe,key:"type",typeMap:{color:xFe}};function R2t(t){return(e,r,i)=>{if(!e)return e;for(const n in t.typeMap)if(e.type===n){const s=new t.typeMap[n];return s.read(e,i),s}}}const O2t={types:M1e,json:{read:R2t(M1e),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var _ie;const TFe="esri.webscene.Environment",P2t=we.getLogger(TFe),R1e=(t,e,r)=>({enabled:!r||!r.isPresentation});let ib=_ie=class extends Je{constructor(t){super(t),this.lighting=new fL,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){E2t(t==null?void 0:t.type,P2t)&&this._set("weather",t)}clone(){return new _ie(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?Rj.prototype.clone.call(this.lighting):fL.prototype.clone.call(this.lighting),background:Te(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};h([f({types:C2t,nonNullable:!0,json:{write:!0}})],ib.prototype,"lighting",void 0),h([f(O2t)],ib.prototype,"background",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:R1e}}})],ib.prototype,"atmosphereEnabled",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:R1e}}})],ib.prototype,"starsEnabled",void 0),h([f({types:bFe,nonNullable:!0,json:{write:!0},value:new pie})],ib.prototype,"weather",null),ib=_ie=h([Q(TFe)],ib);const SFe=ib;var S4;let DC=S4=class extends SFe{constructor(t){super(t),this.atmosphere=new U5,this.lighting=new rb,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new S4({...e,lighting:e.lighting?e.lighting.type==="virtual"?v4.fromWebsceneLighting(e.lighting):rb.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){var e,r;return t?t instanceof rb||t instanceof v4?t:t instanceof fL?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new rb({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof Rj?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new v4({...t.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):Om(v2t,t):new rb}clone(){return new S4({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Te(this.background)})}cloneWithWebsceneEnvironment(t){return new S4({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Te(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):rb.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):v4.fromWebsceneLighting(t.lighting);default:return t.lighting,rb.fromWebsceneLighting(t.lighting)}}};h([f({type:U5,json:{read:!1},nonNullable:!0})],DC.prototype,"atmosphere",void 0),h([f({nonNullable:!0})],DC.prototype,"lighting",void 0),h([Wr("lighting")],DC.prototype,"castLighting",null),DC=S4=h([Q("esri.views.3d.environment.SceneViewEnvironment")],DC);const LC=DC;var va;(function(t){t[t.Simple=0]="Simple",t[t.Realistic=1]="Realistic",t[t.Panoramic=2]="Panoramic",t[t.None=3]="None"})(va||(va={}));function $a(t,e){return t[0]=e[0],t[1]=e[1],t}function ti(t,e,r){return t[0]=e,t[1]=r,t}function Z0(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function iA(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function EFe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function CFe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function I2t(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function $2t(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function D2t(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function L2t(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function N2t(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function ed(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function F2t(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function US(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function cz(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function Xue(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function MFe(t){const e=t[0],r=t[1];return e*e+r*r}function Zue(t,e){return t[0]=-e[0],t[1]=-e[1],t}function k2t(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function mL(t,e){const r=e[0],i=e[1];let n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}function Ko(t,e){return t[0]*e[0]+t[1]*e[1]}function U2t(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function NC(t,e,r,i){const n=e[0],s=e[1];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t}function B2t(t,e){e=e||1;const r=2*SN()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function vie(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function Wx(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function z2t(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function V2t(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}function G2t(t,e,r,i){const n=e[0]-r[0],s=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=n*a-s*o+r[0],t[1]=n*o+s*a+r[1],t}function j2t(t,e){const r=t[0],i=t[1],n=e[0],s=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(r*n+i*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function H2t(t){return"vec2("+t[0]+", "+t[1]+")"}function RFe(t,e){return t[0]===e[0]&&t[1]===e[1]}function OFe(t,e){const r=t[0],i=t[1],n=e[0],s=e[1],o=Dc();return Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))}function q2t(t,e,r,i,n){let s=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*s+i[1]*o)*(n-1);return s=i[0]*a,o=i[1]*a,t[0]=e[0]+s,t[1]=e[1]+o,t}const W2t=Xue,Q2t=iA,Y2t=EFe,X2t=CFe,PFe=US,Z2t=cz,J2t=MFe;Object.freeze(Object.defineProperty({__proto__:null,add:Z0,angle:j2t,ceil:I2t,copy:$a,cross:U2t,dist:PFe,distance:US,div:X2t,divide:CFe,dot:Ko,equals:OFe,exactEquals:RFe,floor:$2t,inverse:k2t,len:W2t,length:Xue,lerp:NC,max:L2t,min:D2t,mul:Y2t,multiply:EFe,negate:Zue,normalize:mL,projectAndScale:q2t,random:B2t,rotate:G2t,round:N2t,scale:ed,scaleAndAdd:F2t,set:ti,sqrDist:Z2t,sqrLen:J2t,squaredDistance:cz,squaredLength:MFe,str:H2t,sub:Q2t,subtract:iA,transformMat2:vie,transformMat2d:Wx,transformMat3:z2t,transformMat4:V2t},Symbol.toStringTag,{value:"Module"}));function Jue(t){return He((t-1e5)/(1e6-1e5),0,1)}const bie=1e4,K2t=.085,gL=1e5;let ewt=class{};const En=ewt;function D(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(D||(D={}));var z;(function(t){t.POSITION="position",t.NORMAL="normal",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.NORMALCOMPRESSED="normalCompressed",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced"})(z||(z={}));var wo;function TA(t,e){switch(e.textureCoordinateType){case wo.Default:return t.attributes.add(z.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(D`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case wo.Compressed:return t.attributes.add(z.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(D`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case wo.Atlas:return t.attributes.add(z.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(z.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(D`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case wo.None:return void t.vertex.code.add(D`void forwardTextureCoordinates() {}`);case wo.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(wo||(wo={}));function bd(t){t.code.add(D`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Tp(t){t.include(bd),t.code.add(D`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function Oj(t){t.fragment.code.add(D`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Sn;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Sn||(Sn={}));let Ys=class{constructor(e,r,i,n,s=null){this.name=e,this.type=r,this.arraySize=s,this.bind={[Sn.Pass]:null,[Sn.Draw]:null},M(i)&&M(n)&&(this.bind[i]=n)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},kr=class extends Ys{constructor(e,r){super(e,"vec3",Sn.Pass,(i,n,s)=>i.setUniform3fv(e,r(n,s)))}},ut=class extends Ys{constructor(e,r){super(e,"float",Sn.Pass,(i,n,s)=>i.setUniform1f(e,r(n,s)))}};function x1(t){t.uniforms.add(new kr("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function ty(t){t.uniforms.add(new kr("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function twt(t,e){e.useLegacyTerrainShading?t.uniforms.add(new ut("lightingFixedFactor",(r,i)=>i.lighting.noonFactor*(1-i.lighting.globalFactor))):t.constants.add("lightingFixedFactor","float",0)}function uz(t,e){const r=t.fragment;x1(r),ty(r),twt(r,e),r.code.add(D`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let ji=class extends Ys{constructor(e,r){super(e,"vec2",Sn.Pass,(i,n,s)=>i.setUniform2fv(e,r(n,s)))}},pi=class extends Ys{constructor(e,r){super(e,"vec4",Sn.Pass,(i,n,s)=>i.setUniform4fv(e,r(n,s)))}},fs=class extends Ys{constructor(e,r){super(e,"mat4",Sn.Pass,(i,n,s)=>i.setUniformMatrix4fv(e,r(n,s)))}};const IFe=we.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let $Fe=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){IFe.error("Trying to include shader module multiple times with different sets of options.");const n=new Set;for(const s of Object.keys(i))i[s]!==e[s]&&n.add(s);for(const s of Object.keys(e))i[s]!==e[s]&&n.add(s);n.forEach(s=>console.error(`  ${s}: current ${i[s]} new ${e[s]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},Ui=class extends $Fe{constructor(){super(...arguments),this.vertex=new O1e,this.fragment=new O1e,this.attributes=new nwt,this.varyings=new swt,this.extensions=new wie,this.constants=new DFe}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),n=this.varyings.generateSource(),s=e==="vertex"?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=e==="vertex"?awt:owt,c=this.constants.generateSource().concat(s.constants.generateSource());return`
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${n.join(`
`)}

${a.join(`
`)}`}generateBind(e,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];M(a)&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];M(a)&&i.set(o.name,a)});const n=Array.from(i.values()),s=n.length;return(o,a,l)=>{for(let c=0;c<s;++c)n[c](r,o,a,l)}}},rwt=class{constructor(){this._entries=new Map}add(e){if(!Array.isArray(e))return this._add(e);for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(k(e))IFe.error(`Trying to add null Uniform from ${new Error().stack}.`);else{if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new pe(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}}generateSource(){return Array.from(this._entries.values()).map(e=>M(e.arraySize)?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},iwt=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},O1e=class extends $Fe{constructor(){super(...arguments),this.uniforms=new rwt,this.code=new iwt,this.constants=new DFe}get builder(){return this}},nwt=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`attribute ${r[1]} ${r[0]};`)}},swt=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(){return this._entries.map(e=>`varying ${e[1]} ${e[0]};`)}},wie=class xie{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?xie.ALLOWLIST_VERTEX:xie.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};wie.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],wie.ALLOWLIST_VERTEX=[];let DFe=class Yo{constructor(){this._entries=new Set}add(e,r,i){let n="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":n=Yo._numberToFloatStr(i);break;case"int":n=Yo._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n=`vec2(${Yo._numberToFloatStr(i[0])},                            ${Yo._numberToFloatStr(i[1])})`;break;case"vec3":n=`vec3(${Yo._numberToFloatStr(i[0])},                            ${Yo._numberToFloatStr(i[1])},                            ${Yo._numberToFloatStr(i[2])})`;break;case"vec4":n=`vec4(${Yo._numberToFloatStr(i[0])},                            ${Yo._numberToFloatStr(i[1])},                            ${Yo._numberToFloatStr(i[2])},                            ${Yo._numberToFloatStr(i[3])})`;break;case"ivec2":n=`ivec2(${Yo._numberToIntStr(i[0])},                             ${Yo._numberToIntStr(i[1])})`;break;case"ivec3":n=`ivec3(${Yo._numberToIntStr(i[0])},                             ${Yo._numberToIntStr(i[1])},                             ${Yo._numberToIntStr(i[2])})`;break;case"ivec4":n=`ivec4(${Yo._numberToIntStr(i[0])},                             ${Yo._numberToIntStr(i[1])},                             ${Yo._numberToIntStr(i[2])},                             ${Yo._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${r}(${Array.prototype.map.call(i,s=>Yo._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${n};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const owt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,awt=`precision highp float;
precision highp sampler2D;`,Kue="Size",Pj="InvSize";function Nf(t,e,r=!1,i=0){if(t.hasWebGL2Context){const n=D`vec2(textureSize(${e}, ${D.int(i)}))`;return r?"(1.0 / "+n+")":n}return r?e+Pj:e+Kue}function gu(t,e,r,i=null,n=0){if(t.hasWebGL2Context)return D`texelFetch(${e}, ivec2(${r}), ${D.int(n)})`;let s=D`texture2D(${e}, ${r} * `;return s+=i?D`(${i}))`:D`${e+Pj})`,s}var hn;(function(t){t[t.None=0]="None",t[t.Size=1]="Size",t[t.InvSize=2]="InvSize"})(hn||(hn={}));let _r=class extends Ys{constructor(e,r){super(e,"sampler2D",Sn.Pass,(i,n,s)=>i.bindTexture(e,r(n,s)))}};function Sm(t,e,r=hn.None){const i=[new _r(t,e)];if(r&hn.Size){const n=t+Kue;i.push(new ji(n,(s,o)=>{const a=e(s,o);return M(a)?ti(P1e,a.descriptor.width,a.descriptor.height):yh}))}if(r&hn.InvSize){const n=t+Pj;i.push(new ji(n,(s,o)=>{const a=e(s,o);return M(a)?ti(P1e,1/a.descriptor.width,1/a.descriptor.height):yh}))}return i}const P1e=Ft(),B5=pt(parseFloat(5802e-9 .toFixed(6)),parseFloat(13558e-9 .toFixed(6)),parseFloat(331e-7 .toFixed(6))),kQ=3,UQ=pt(kQ*parseFloat(65e-8 .toFixed(6)),kQ*parseFloat(1881e-9 .toFixed(6)),kQ*parseFloat(85e-9 .toFixed(6))),lwt=3996e-9,cwt=pt(parseFloat(Number(B5[0]+UQ[0]).toFixed(6)),parseFloat(Number(B5[1]+UQ[1]).toFixed(6)),parseFloat(Number(B5[2]+UQ[2]).toFixed(6)));function uwt(t){const e=new Ui;e.attributes.add(z.POSITION,"vec2"),e.include(TA,{textureCoordinateType:wo.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add([new fs("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new fs("inverseViewMatrix",(n,s)=>nP(hwt,s.camera.viewMatrix))]),r.code.add(D`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add([new ji("radii",n=>n.radii),new kr("cameraPosition",(n,s)=>s.camera.eye),new pi("heightParameters",n=>n.heightParameters),new ut("innerFadeDistance",n=>n.innerFadeDistance),new ut("altitudeFade",n=>n.altitudeFade),new _r("depthTex",n=>n.depthTex),new ut("hazeStrength",n=>n.hazeStrength)]),i.constants.add("betaRayleigh","vec3",B5),i.constants.add("betaCombined","vec3",cwt),i.constants.add("betaMie","float",lwt),i.constants.add("scaleHeight","float",K2t*gL),x1(i),e.include(Oj),t.haze&&(i.include(Tp),i.uniforms.add(new ji("nearFar",(n,s)=>s.camera.nearFar))),i.code.add(D`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(D`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(D`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(D`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?D`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?D``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":D`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?D`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:D`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?D`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:D`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${t.haze?D`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:D`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":D`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `),e}const hwt=ht(),dwt=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:B5,build:uwt},Symbol.toStringTag,{value:"Module"}));let Bi=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var rs,wr,st,UA,yr,mm,pO,Yt,Qn,co,zt,Ar,cr,_t,pr,xr,lu,ki,rp,qa,Fs,Ni;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(rs||(rs={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(wr||(wr={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(st||(st={})),function(t){t[t.ADD=32774]="ADD",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(UA||(UA={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(yr||(yr={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(mm||(mm={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(pO||(pO={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(Yt||(Yt={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Qn||(Qn={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(co||(co={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(zt||(zt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Ar||(Ar={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(cr||(cr={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(_t||(_t={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(pr||(pr={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(xr||(xr={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(lu||(lu={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(ki||(ki={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(rp||(rp={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(qa||(qa={})),function(t){t[t.TEXTURE=0]="TEXTURE",t[t.RENDER_BUFFER=1]="RENDER_BUFFER",t[t.CUBEMAP=2]="CUBEMAP"}(Fs||(Fs={})),function(t){t[t.NONE=0]="NONE",t[t.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",t[t.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",t[t.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",t[t.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Ni||(Ni={}));const BQ=33984;var Pa,Hd;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(Pa||(Pa={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Hd||(Hd={}));const I1e=33306;var io,$1e,D1e,L1e,hz,Tie,N1e;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(io||(io={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}($1e||($1e={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(D1e||(D1e={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(L1e||(L1e={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(hz||(hz={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(Tie||(Tie={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(N1e||(N1e={}));let qi=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=kt(this._program),this._pipeline=this._configuration=null}reload(e){kt(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,r=null,i){e.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return wr.TRIANGLES}getPipelineState(e,r){return this._pipeline}initializeConfiguration(e,r){}};const Di=new Map([[z.POSITION,0],[z.NORMAL,1],[z.UV0,2],[z.COLOR,3],[z.SIZE,4],[z.TANGENT,4],[z.AUXPOS1,5],[z.SYMBOLCOLOR,5],[z.AUXPOS2,6],[z.FEATUREATTRIBUTE,6],[z.INSTANCEFEATUREATTRIBUTE,6],[z.INSTANCECOLOR,7],[z.OBJECTANDLAYERIDCOLOR,7],[z.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[z.MODEL,8],[z.MODELNORMAL,12],[z.MODELORIGINHI,11],[z.MODELORIGINLO,15]]),pwt=we.getLogger("esri.views.webgl.checkWebGLError");function fwt(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const LFe=!!Fe("enable-feature:webgl-debug");function Yd(){return LFe}function Sie(){return LFe}function Mb(t){if(Yd()){const e=t.getError();if(e){const r=fwt(t,e),i=new Error().stack;pwt.error(new pe("webgl-error","WebGL error occured",{message:r,stack:i}))}}}let zi=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Vr({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(Sn.Pass,this),this.bindDraw=r.generateBind(Sn.Draw,this),this._fragmentUniforms=Yd()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if(k(r)||r.glName==null){const n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,r)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(r,e.unit)}),M(this._fragmentUniforms)&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Vn,BS,so,B_,dh,l1,m2,fO,xn,zS,b_;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Vn||(Vn={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(BS||(BS={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(so||(so={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(B_||(B_={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(dh||(dh={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(l1||(l1={})),function(t){t[t.STRETCH=1]="STRETCH",t[t.PAD=2]="PAD"}(m2||(m2={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(fO||(fO={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(xn||(xn={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(zS||(zS={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(b_||(b_={}));function jm(t,e,r=UA.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function Da(t,e,r,i,n=UA.ADD,s=UA.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const ehe={face:mm.BACK,mode:pO.CCW},NFe={face:mm.FRONT,mode:pO.CCW},Ij=t=>t===Vn.Back?ehe:t===Vn.Front?NFe:null,_h={zNear:0,zFar:1},Gr={r:!0,g:!0,b:!0,a:!0};function mwt(t){return xwt.intern(t)}function gwt(t){return Twt.intern(t)}function Awt(t){return Swt.intern(t)}function ywt(t){return Ewt.intern(t)}function _wt(t){return Cwt.intern(t)}function vwt(t){return Mwt.intern(t)}function bwt(t){return Rwt.intern(t)}function wwt(t){return Owt.intern(t)}function Pr(t){return Pwt.intern(t)}let T1=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function S1(t){return"["+t.join(",")+"]"}const xwt=new T1(FFe,t=>({__tag:"Blending",...t}));function FFe(t){return t?S1([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const Twt=new T1(kFe,t=>({__tag:"Culling",...t}));function kFe(t){return t?S1([t.face,t.mode]):null}const Swt=new T1(UFe,t=>({__tag:"PolygonOffset",...t}));function UFe(t){return t?S1([t.factor,t.units]):null}const Ewt=new T1(BFe,t=>({__tag:"DepthTest",...t}));function BFe(t){return t?S1([t.func]):null}const Cwt=new T1(zFe,t=>({__tag:"StencilTest",...t}));function zFe(t){return t?S1([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const Mwt=new T1(VFe,t=>({__tag:"DepthWrite",...t}));function VFe(t){return t?S1([t.zNear,t.zFar]):null}const Rwt=new T1(GFe,t=>({__tag:"ColorWrite",...t}));function GFe(t){return t?S1([t.r,t.g,t.b,t.a]):null}const Owt=new T1(jFe,t=>({__tag:"StencilWrite",...t}));function jFe(t){return t?S1([t.mask]):null}const Pwt=new T1(Iwt,t=>({blending:mwt(t.blending),culling:gwt(t.culling),polygonOffset:Awt(t.polygonOffset),depthTest:ywt(t.depthTest),stencilTest:_wt(t.stencilTest),depthWrite:vwt(t.depthWrite),colorWrite:bwt(t.colorWrite),stencilWrite:wwt(t.stencilWrite)}));function Iwt(t){return t?S1([FFe(t.blending),kFe(t.culling),UFe(t.polygonOffset),BFe(t.depthTest),zFe(t.stencilTest),VFe(t.depthWrite),GFe(t.colorWrite),jFe(t.stencilWrite)]):null}let $wt=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,r,i,n){return(i||e!==r)&&(n(e),this._pipelineInvalid=!0),e}},Dwt=class extends En{constructor(){super(...arguments),this.heightParameters=Kr(),this.radii=Ft(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1}},Eie=class HFe extends qi{initializeProgram(e){return new zi(e.rctx,HFe.shader.get().build(this.configuration),Di)}initializePipeline(){return this.configuration.haze?Pr({blending:Da(st.ONE,st.ZERO,st.ONE_MINUS_SRC_COLOR,st.ONE),colorWrite:Gr}):Pr({blending:Da(st.SRC_ALPHA,st.ONE,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qn.LEQUAL},colorWrite:Gr})}};Eie.shader=new Bi(dwt,()=>be(()=>import("./ChapmanAtmosphere.glsl-23d42e5f.js"),[]));let Nc=class extends En{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function ae(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,n=t.count||2,s=Math.ceil(Math.log2(n)),o=e._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(e,r,{get(){return this[i]},set(u){if(this[i]!==u&&(this[i]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof u)}})}}}let qFe=class extends Nc{constructor(){super(...arguments),this.haze=!1}};h([ae()],qFe.prototype,"haze",void 0);let Rl=class{constructor(e,r,i,n,s,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=n,this.stride=s,this.normalized=o,this.divisor=a}};new Rl(z.POSITION,3,Yt.FLOAT,0,12);new Rl(z.POSITION,3,Yt.FLOAT,0,20),new Rl(z.UV0,2,Yt.FLOAT,12,20);new Rl(z.POSITION,3,Yt.FLOAT,0,32),new Rl(z.NORMAL,3,Yt.FLOAT,12,32),new Rl(z.UV0,2,Yt.FLOAT,24,32);new Rl(z.POSITION,3,Yt.FLOAT,0,16),new Rl(z.COLOR,4,Yt.UNSIGNED_BYTE,12,16);const the=[new Rl(z.POSITION,2,Yt.FLOAT,0,8)],gP=[new Rl(z.POSITION,2,Yt.FLOAT,0,16),new Rl(z.UV0,2,Yt.FLOAT,8,16)];function F1e(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Xl(t,e){return t.vertexBuffers[e].size/Lwt(t.layout[e])}function Lwt(t){return t[0].stride}function rhe(t,e,r,i,n=0){const s=t.gl,o=t.capabilities.instancing;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=n*a.stride;if(a.count<=4)s.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),s.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let u=0;u<3;u++)s.vertexAttribPointer(l+u,3,a.type,a.normalized,a.stride,a.offset+12*u+c),s.enableVertexAttribArray(l+u),a.divisor>0&&o&&o.vertexAttribDivisor(l+u,a.divisor);else if(a.count===16)for(let u=0;u<4;u++)s.vertexAttribPointer(l+u,4,a.type,a.normalized,a.stride,a.offset+16*u+c),s.enableVertexAttribArray(l+u),a.divisor>0&&o&&o.vertexAttribDivisor(l+u,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function ihe(t,e,r,i){const n=t.gl,s=t.capabilities.instancing;t.bindBuffer(r);for(const o of i){const a=e.get(o.name);if(o.count<=4)n.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)n.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)n.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(yr.ARRAY_BUFFER)}function WFe(t){switch(t){case _t.ALPHA:case _t.LUMINANCE:case _t.RED:case _t.RED_INTEGER:case pr.R8:case pr.R8I:case pr.R8UI:case pr.R8_SNORM:case lu.STENCIL_INDEX8:return 1;case _t.LUMINANCE_ALPHA:case _t.RG:case _t.RG_INTEGER:case pr.RGBA4:case pr.R16F:case pr.R16I:case pr.R16UI:case pr.RG8:case pr.RG8I:case pr.RG8UI:case pr.RG8_SNORM:case pr.RGB565:case pr.RGB5_A1:case lu.DEPTH_COMPONENT16:return 2;case _t.DEPTH_COMPONENT:case _t.RGB:case _t.RGB_INTEGER:case pr.RGB8:case pr.RGB8I:case pr.RGB8UI:case pr.RGB8_SNORM:case pr.SRGB8:case lu.DEPTH_COMPONENT24:return 3;case _t.DEPTH_STENCIL:case _t.RGBA:case _t.RGBA_INTEGER:case pr.RGBA8:case pr.R32F:case pr.R11F_G11F_B10F:case pr.RG16F:case pr.R32I:case pr.R32UI:case pr.RG16I:case pr.RG16UI:case pr.RGBA8I:case pr.RGBA8UI:case pr.RGBA8_SNORM:case pr.SRGB8_ALPHA8:case pr.RGB9_E5:case pr.RGB10_A2UI:case pr.RGB10_A2:case lu.DEPTH_STENCIL:case lu.DEPTH_COMPONENT32F:case lu.DEPTH24_STENCIL8:return 4;case lu.DEPTH32F_STENCIL8:return 5;case pr.RGB16F:case pr.RGB16I:case pr.RGB16UI:return 6;case pr.RG32F:case pr.RG32I:case pr.RG32UI:case pr.RGBA16F:case pr.RGBA16I:case pr.RGBA16UI:return 8;case pr.RGB32F:case pr.RGB32I:case pr.RGB32UI:return 12;case pr.RGBA32F:case pr.RGBA32I:case pr.RGBA32UI:return 16;case io.COMPRESSED_RGB_S3TC_DXT1_EXT:case io.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case io.COMPRESSED_RGBA_S3TC_DXT3_EXT:case io.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case io.COMPRESSED_R11_EAC:case io.COMPRESSED_SIGNED_R11_EAC:case io.COMPRESSED_RGB8_ETC2:case io.COMPRESSED_SRGB8_ETC2:case io.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case io.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case io.COMPRESSED_RG11_EAC:case io.COMPRESSED_SIGNED_RG11_EAC:case io.COMPRESSED_RGBA8_ETC2_EAC:case io.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function VS(t){if(k(t))return 0;if("descriptor"in t)return t.glName?VS(t.descriptor):0;const e=t.internalFormat||"pixelFormat"in t&&t.pixelFormat;if(!e)return 0;const r="hasMipmap"in t&&t.hasMipmap?1.3:1,i=t.width*t.height;return WFe(e)*i*r}const Rw=we.getLogger("esri.views.webgl.VertexArrayObject");let Zf=class{constructor(e,r,i,n,s=null){this._context=e,this._locations=r,this._layout=i,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1,e.instanceCounter.increment(Pa.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].size,M(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){var r,i,n;if(!this._context)return void((this._glName||e&&Object.getOwnPropertyNames(this._buffers).length>0)&&Rw.warn("Leaked WebGL VAO"));if(this._glName){const s=(i=(r=this._context)==null?void 0:r.capabilities)==null?void 0:i.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):Rw.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const s in this._buffers)(n=this._buffers[s])==null||n.dispose(),delete this._buffers[s];this._indexBuffer=kt(this._indexBuffer)}this._context.instanceCounter.decrement(Pa.VertexArrayObject,this),this._context=AS(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||Rw.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const s in e){const o=e[s];o||Rw.error("Vertex buffer is uninitialized!");const a=r[s];a||Rw.error("Vertex element descriptor is empty!"),rhe(this._context,this._locations,o,a)}M(i)&&(this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:r}=this;e||Rw.error("Vertex buffer dictionary is empty!");for(const i in e){const n=e[i];n||Rw.error("Vertex buffer is uninitialized!");const s=r[i];ihe(this._context,this._locations,n,s)}M(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},Hm=class extends Zf{};var lr;function Nwt(t,e,r={}){const i=QFe(t);for(;i.length>1;){const n=dz(e,i.shift(),r);if(M(n))return n}return Fwt(e,i.shift(),r)}function QFe(t){const e=Fe("esri-force-webgl");if(e===lr.WEBGL1||e===lr.WEBGL2)return[e];switch(t){case"2d":return Fe("mac")&&Fe("chrome")?[lr.WEBGL1,lr.WEBGL2]:[lr.WEBGL2,lr.WEBGL1];case"3d":return[lr.WEBGL2,lr.WEBGL1]}}function Fwt(t,e,r={}){if(!window.WebGLRenderingContext)return k1e(t,kwt),null;const i=dz(t,e,r);return k(i)&&k1e(t,Uwt),i}function dz(t,e,r={}){const i=e===lr.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let n=null;for(const s of i){try{n=t.getContext(s,r)}catch{}if(n)break}return n}function k1e(t,e){const r=t.parentNode;r&&(r.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>")}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(lr||(lr={}));const kwt='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',Uwt=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,ig=we.getLogger("esri.views.webgl.BufferObject");let Ji=class FC{static createIndex(e,r,i){return new FC(e,yr.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new FC(e,yr.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){if(e.type!==lr.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new FC(e,yr.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=ki.STREAM_READ,i){if(e.type!==lr.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const n=new FC(e,yr.PIXEL_PACK_BUFFER,r);return i&&n.setSize(i),n}static createPixelUnpack(e,r=ki.STREAM_DRAW,i){if(e.type!==lr.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new FC(e,yr.PIXEL_UNPACK_BUFFER,r,i)}constructor(e,r,i,n){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Pa.BufferObject,this),this._glName=this._context.gl.createBuffer(),Mb(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===yr.ELEMENT_ARRAY_BUFFER?this._indexType===Yt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===yr.ELEMENT_ARRAY_BUFFER||this.bufferType===yr.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Pa.BufferObject,this),this._context=AS(this._context)):this._glName&&ig.warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&ig.error("Buffer size needs to be positive!"),this.bufferType===yr.ELEMENT_ARRAY_BUFFER&&M(r))switch(this._indexType=r,r){case Yt.UNSIGNED_SHORT:e*=2;break;case Yt.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===yr.ELEMENT_ARRAY_BUFFER&&(Uae(e)&&(r/=2,this._indexType=Yt.UNSIGNED_SHORT),Bae(e)&&(r/=4,this._indexType=Yt.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;M(r)?n.bufferData(this.bufferType,r,this.usage):n.bufferData(this.bufferType,e,this.usage),Mb(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,n){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.byteSize)&&ig.error("offset is out of range!"),i>=n&&ig.error("end must be bigger than start!"),(r+(n-i))*e.BYTES_PER_ELEMENT>this.byteSize&&ig.error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===lr.WEBGL2)o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,n-i);else{const a=i===0&&n===e.length?e:e.subarray(i,n);o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,a)}Mb(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,r=0,i,n){if(this._context.type!==lr.WEBGL2)return void ig.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||n<0)return void ig.error("Problem getting subdata: offset and length were less than zero!");const s=Bwt(e)?e.BYTES_PER_ELEMENT:1;if(s*((i??0)+(n??0))>e.byteLength)return void ig.error("Problem getting subdata: offset and length exceeded destination size!");r+s*(n??0)>this.byteSize&&ig.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,yr.COPY_READ_BUFFER),o.getBufferSubData(yr.COPY_READ_BUFFER,r,e,i,n),this._context.unbindBuffer(yr.COPY_READ_BUFFER)}async getSubDataAsync(e,r=0,i,n){this._context.type===lr.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,r,i,n)):ig.error("Get buffer subdata is supported in WebGL2 only!")}};function Bwt(t){return zJe(t)}const zQ={target:cr.TEXTURE_2D,samplingMode:zt.LINEAR,wrapMode:Ar.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},U1e=4;let Xt=class{constructor(e,r,i=null){this._context=e,this.type="texture",this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,e.instanceCounter.increment(Pa.Texture,this),this._descriptor={...zQ,...r};for(const n in zQ)this._descriptor[n]===void 0&&(this._descriptor[n]=zQ[n]);if(e.type!==lr.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),Ow(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===cr.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(Pa.Texture,this))}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===cr.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=cr.TEXTURE_CUBE_MAP_POSITIVE_X;r<=cr.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){if(!this._context||!this._context.gl)return;const i=this._context.gl;this._glName||(this._glName=i.createTexture()),e===void 0&&(e=null);const n=this._descriptor,s=r??n.target,o=Ow(s);e===null&&(n.width=n.width||U1e,n.height=n.height||U1e,o&&(n.depth=n.depth??1));const a=this._context.bindTexture(this,Xt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(Xt.TEXTURE_UNIT_FOR_UPDATES),Xt._validateTexture(this._context,n),this._configurePixelStorage(),Mb(i);const l=n.pixelFormat;let c=n.internalFormat??this._deriveInternalFormat(l,n.dataType);if(VQ(e)){let u=e.width,d=e.height;const p=1;e instanceof HTMLVideoElement&&(u=e.videoWidth,d=e.videoHeight),n.width&&n.height,o&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,c,n.hasMipmap,u,d,p),this._texImage(s,0,c,u,d,p,e),Mb(i),n.hasMipmap&&this.generateMipmap(),n.width===void 0&&(n.width=u),n.height===void 0&&(n.height=d),o&&n.depth===void 0&&(n.depth=p)}else{const{width:u,height:d,depth:p}=n;if(u==null||d==null)throw new Error("Width and height must be specified!");if(o&&p==null)throw new Error("Depth must be specified!");if(n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,c,n.hasMipmap,u,d,p),i.DEPTH24_STENCIL8&&c===i.DEPTH_STENCIL&&(c=i.DEPTH24_STENCIL8),Gk(e)){const A=e.levels,v=B1e(s,u,d,p),b=Math.min(v-1,A.length-1);M(this._context.gl2)?i.texParameteri(n.target,this._context.gl2.TEXTURE_MAX_LEVEL,b):n.hasMipmap=n.hasMipmap&&v===A.length;const S=c;if(!Vwt(S))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((E,R,O,I)=>{const N=A[Math.min(E,A.length-1)];this._compressedTexImage(s,E,S,R,O,I,N)},b)}else M(e)?(this._texImage(s,0,c,u,d,p,e),Mb(i),n.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((A,v,b,S)=>{this._texImage(s,A,c,v,b,S,null),Mb(i)})}Xt._applySamplingMode(i,this._descriptor),Xt._applyWrapMode(i,this._descriptor),Xt._applyAnisotropicFilteringParameters(this._context,this._descriptor),Mb(i),this._context.bindTexture(a,Xt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,n,s,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._context.gl,c=this._descriptor,{pixelFormat:u,dataType:d,target:p,isImmutable:A}=c,v=c.internalFormat??this._deriveInternalFormat(u,d);if(A&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const b=this._context.bindTexture(this,Xt.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||n>c.width||s>c.height||r+n>c.width||i+s>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(k(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,a)}if(VQ(o)?M(this._context.gl2)?this._context.gl2.texSubImage2D(p,e,r,i,n,s,u,d,o):l.texSubImage2D(p,e,r,i,u,d,o):Gk(o)?l.compressedTexSubImage2D(p,e,r,i,n,s,v,o.levels[e]):l.texSubImage2D(p,e,r,i,n,s,u,d,o),a){if(k(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,0)}this._context.bindTexture(b,Xt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,n,s,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl2;if(k(c))throw new Error("3D textures are not supported in WebGL1");const u=this._descriptor,{pixelFormat:d,dataType:p,isImmutable:A,target:v}=u,b=u.internalFormat??this._deriveInternalFormat(d,p);if(A&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");Ow(v)||console.warn("Attempting to set 3D texture data on a non-3D texture");const S=this._context.bindTexture(this,Xt.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(Xt.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||n<0||s>u.width||o>u.height||a>u.depth||r+s>u.width||i+o>u.height||n+a>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),Gk(l))l=l.levels[e],c.compressedTexSubImage3D(v,e,r,i,n,s,o,a,b,l);else{const E=l;c.texSubImage3D(v,e,r,i,n,s,o,a,d,p,E)}this._context.bindTexture(S,Xt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,Xt._validateTexture(this._context,e)}e.samplingMode===zt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=zt.LINEAR_MIPMAP_NEAREST):e.samplingMode===zt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=zt.NEAREST_MIPMAP_NEAREST);const r=this._context.bindTexture(this,Xt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(Xt.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(e.target),this._context.bindTexture(r,Xt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,Xt._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,r=this._descriptor;this._samplingModeDirty&&(Xt._applySamplingMode(e,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(Xt._applyWrapMode(e,r),this._wrapModeDirty=!1)}_deriveInternalFormat(e,r){if(this._context.type===lr.WEBGL1)return e;switch(r){case xr.FLOAT:switch(e){case _t.RGBA:return pr.RGBA32F;case _t.RGB:return pr.RGB32F;default:throw new Error("Unable to derive format")}case xr.UNSIGNED_BYTE:switch(e){case _t.RGBA:return pr.RGBA8;case _t.RGB:return pr.RGB8}default:return e}}_configurePixelStorage(){const e=this._context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,r,i,n,s,o){const a=this._context.gl2;if(k(a))throw new Error("Immutable textures are not supported in WebGL1");if(!zwt(r))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?B1e(e,n,s,o):1;if(Ow(e)){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,n,s,o)}else a.texStorage2D(e,l,r,n,s);this._wasImmutablyAllocated=!0}_texImage(e,r,i,n,s,o,a){const l=this._context.gl;let c=null;const u=this._context.type===lr.WEBGL2,d=Ow(e),{isImmutable:p,pixelFormat:A,dataType:v}=this._descriptor;if(u&&(c=l),u||!VQ(a))if(p){if(M(a)){const b=a;if(d){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texSubImage3D(e,r,0,0,0,n,s,o,A,v,b)}else l.texSubImage2D(e,r,0,0,n,s,A,v,b)}}else{const b=a;if(d){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texImage3D(e,r,i,n,s,o,0,A,v,b)}else l.texImage2D(e,r,i,n,s,0,A,v,b)}else l.texImage2D(e,0,i,A,v,a)}_compressedTexImage(e,r,i,n,s,o,a){const l=this._context.gl;let c=null;const u=Ow(e),d=this._descriptor.isImmutable;if(u){if(this._context.type!==lr.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}if(d){if(M(a))if(u){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,n,s,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,n,s,i,a)}else if(u){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,n,s,o,0,a)}else l.compressedTexImage2D(e,r,i,n,s,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:n,depth:s,hasMipmap:o,target:a}=this._descriptor;const l=a===cr.TEXTURE_3D;if(i==null||n==null||l&&s==null)throw new Error("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,n,s),o&&(i!==1||n!==1||l&&s!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}static _validateTexture(e,r){(r.width!=null&&r.width<0||r.height!=null&&r.height<0||r.depth!=null&&r.depth<0)&&console.error("Negative dimension parameters are not allowed!");const i=e.type===lr.WEBGL2,n=r.width!=null&&Im(r.width)&&r.height!=null&&Im(r.height);i||!r.isImmutable&&!Ow(r.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),i||n||(typeof r.wrapMode=="number"?r.wrapMode!==Ar.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):r.wrapMode.s===Ar.CLAMP_TO_EDGE&&r.wrapMode.t===Ar.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),r.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,r){let i=r.samplingMode,n=r.samplingMode;i===zt.LINEAR_MIPMAP_NEAREST||i===zt.LINEAR_MIPMAP_LINEAR?(i=zt.LINEAR,r.hasMipmap||(n=zt.LINEAR)):i!==zt.NEAREST_MIPMAP_NEAREST&&i!==zt.NEAREST_MIPMAP_LINEAR||(i=zt.NEAREST,r.hasMipmap||(n=zt.NEAREST)),e.texParameteri(r.target,e.TEXTURE_MAG_FILTER,i),e.texParameteri(r.target,e.TEXTURE_MIN_FILTER,n)}static _applyWrapMode(e,r){typeof r.wrapMode=="number"?(e.texParameteri(r.target,e.TEXTURE_WRAP_S,r.wrapMode),e.texParameteri(r.target,e.TEXTURE_WRAP_T,r.wrapMode)):(e.texParameteri(r.target,e.TEXTURE_WRAP_S,r.wrapMode.s),e.texParameteri(r.target,e.TEXTURE_WRAP_T,r.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,r){const i=e.capabilities.textureFilterAnisotropic;i&&e.gl.texParameterf(r.target,i.TEXTURE_MAX_ANISOTROPY,r.maxAnisotropy??1)}};function zwt(t){return t in pr}function Vwt(t){return t in io}function Gk(t){return M(t)&&"type"in t&&t.type==="compressed"}function Gwt(t){return M(t)&&"byteLength"in t}function VQ(t){return M(t)&&!Gk(t)&&!Gwt(t)}function Ow(t){return t===cr.TEXTURE_3D||t===cr.TEXTURE_2D_ARRAY}function B1e(t,e,r,i=1){let n=Math.max(e,r);return t===cr.TEXTURE_3D&&(n=Math.max(n,i)),Math.round(Math.log(n)/Math.LN2)+1}Xt.TEXTURE_UNIT_FOR_UPDATES=0;function Fc(t,e=the,r=Di,i=-1,n=1){let s=null;return e===gP?s=new Float32Array([i,i,0,0,n,i,1,0,i,n,0,1,n,n,1,1]):s=new Float32Array([i,i,n,i,i,n,n,n]),new Hm(t,r,{geometry:e},{geometry:Ji.createVertex(t,ki.STATIC_DRAW,s)})}function jwt(t,e=the,r=Di){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new Hm(t,r,{geometry:e},{geometry:Ji.createVertex(t,ki.STATIC_DRAW,i)})}const YFe=4;function XFe(t,e=YFe){return new Xt(t,{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.NEAREST,width:e,height:e})}function Hwt(t,e,r=YFe){const i=new Uint8Array(r*r*4);for(let n=0;n<i.length;n+=4)i[n+0]=255*e[0],i[n+1]=255*e[1],i[n+2]=255*e[2],i[n+3]=255*e[3];return new Xt(t,{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.NEAREST,width:r,height:r},i)}function ZFe(t){return new Xt(t,{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}let GQ=class{constructor(e,r){this._view=e,this.type=va.Realistic,this._handles=new cn,this._passParameters=new Dwt,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=yi.radius,this._fadeHaze=0,this._updateRadius(yi.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([xe(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds()),xe(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds())]);const n=new qFe;n.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(Eie,n),n.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(Eie,n),this._vao=Fc(i,gP)}destroy(){this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._vao.dispose(),this._handles.destroy()}render(e){this._render(e,this._atmosphereTechnique,e.offscreenRenderingHelper.depthTexture)}renderHaze(e,r){this._fadeHaze=r,this._render(e,this._atmosphereHazeTechnique,e.offscreenRenderingHelper.linearDepthTexture)}_render(e,r,i){if(k(i))return;this._update(e.bindParameters.camera),this._passParameters.depthTex=i;const n=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);e.offscreenRenderingHelper.renderDepthDetached(()=>this._renderCommon(n,e))}_renderCommon(e,r){k(this._vao)||(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(wr.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=yi.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(yi.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,ti(this._passParameters.radii,e,e+gL),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-bie)*bie)}_update(e){if(k(e))return;const r=vc(e.eye),i=Math.sqrt(r),n=r-this._passParameters.radii[1]*this._passParameters.radii[1],s=He((i-this._passParameters.radii[0])/gL,0,1);pn(this._passParameters.heightParameters,i,r,n,s),this._passParameters.altitudeFade=Jue(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Mr(Mr(.6,1,GR(9500,10500,i-yi.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function cs(){return new Float32Array(3)}function pz(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function sn(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function JFe(t,e){return new Float32Array(t,e,3)}function nhe(){return cs()}function KFe(){return sn(1,1,1)}function e6e(){return sn(1,0,0)}function t6e(){return sn(0,1,0)}function r6e(){return sn(0,0,1)}const qwt=nhe(),Wwt=KFe(),Qwt=e6e(),Ywt=t6e(),Xwt=r6e();Object.freeze(Object.defineProperty({__proto__:null,ONES:Wwt,UNIT_X:Qwt,UNIT_Y:Ywt,UNIT_Z:Xwt,ZEROS:qwt,clone:pz,create:cs,createView:JFe,fromValues:sn,ones:KFe,unitX:e6e,unitY:t6e,unitZ:r6e,zeros:nhe},Symbol.toStringTag,{value:"Module"}));function i6e(t){t.extensions.add("GL_EXT_shader_texture_lod"),t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(D`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function she(t,e){switch(t.include(TA,e),t.fragment.code.add(D`
  struct TextureLookupParameter {
    vec2 uv;
    ${e.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),e.textureCoordinateType){case wo.Default:case wo.Compressed:return void t.fragment.code.add(D`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case wo.Atlas:return t.include(i6e),void t.fragment.code.add(D`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:e.textureCoordinateType;case wo.None:case wo.COUNT:return}}let yp=class extends Ys{constructor(e,r){super(e,"vec3",Sn.Draw,(i,n,s,o)=>i.setUniform3fv(e,r(n,s,o)))}},AL=class extends Ys{constructor(e,r){super(e,"vec2",Sn.Draw,(i,n,s,o)=>i.setUniform2fv(e,r(n,s,o)))}},ZN=class extends Ys{constructor(e,r){super(e,"sampler2D",Sn.Draw,(i,n,s)=>i.bindTexture(e,r(n,s)))}};function g2(t,e,r=hn.None){const i=[new ZN(t,e)];if(r&hn.Size){const n=t+Kue;i.push(new AL(n,(s,o)=>{const a=e(s,o);return M(a)?ti(z1e,a.descriptor.width,a.descriptor.height):yh}))}if(r&hn.InvSize){const n=t+Pj;i.push(new AL(n,(s,o)=>{const a=e(s,o);return M(a)?ti(z1e,1/a.descriptor.width,1/a.descriptor.height):yh}))}return i}const z1e=Ft();let aw=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return B_.LOADED}},ohe=class extends aw{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=us(this._texture),this._textureNormal=us(this._textureNormal),this._textureEmissive=us(this._textureEmissive),this._textureOcclusion=us(this._textureOcclusion),this._textureMetallicRoughness=us(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?B_.LOADED:B_.LOADING}get textureBindParameters(){return new n6e(M(this._texture)?this._texture.glTexture:null,M(this._textureNormal)?this._textureNormal.glTexture:null,M(this._textureEmissive)?this._textureEmissive.glTexture:null,M(this._textureOcclusion)?this._textureOcclusion.glTexture:null,M(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){(k(this._texture)||e!==this._texture.id)&&(this._texture=us(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(k(e))return void r(null);const i=this._textureRepository.acquire(e);if(Op(i))return++this._numLoading,void i.then(n=>{if(this._disposed)return us(n),void r(null);r(n)}).finally(()=>--this._numLoading);r(i)}},n6e=class extends En{constructor(e=null,r=null,i=null,n=null,s=null){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=n,this.textureMetallicRoughness=s}};const Jur=sn(0,.6,.2);var Jt;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(Jt||(Jt={}));function ahe(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===Jt.Normal&&i&&t.include(she,e),e.pbrMode!==Jt.Schematic)if(e.pbrMode!==Jt.Disabled){if(e.pbrMode===Jt.Normal){r.code.add(D`vec3 mrr;
vec3 emission;
float occlusion;`);const n=e.supportsTextureAtlas?e.hasWebGL2Context?hn.None:hn.Size:hn.None,s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(s===Sn.Pass?Sm("texMetallicRoughness",o=>o.textureMetallicRoughness,n):g2("texMetallicRoughness",o=>o.textureMetallicRoughness,n)),r.code.add(D`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(s===Sn.Pass?Sm("texEmission",o=>o.textureEmissive,n):g2("texEmission",o=>o.textureEmissive,n)),r.code.add(D`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(s===Sn.Pass?Sm("texOcclusion",o=>o.textureOcclusion,n):g2("texOcclusion",o=>o.textureOcclusion,n)),r.code.add(D`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(D`float getBakedOcclusion() { return 1.0; }`),r.uniforms.add(s===Sn.Pass?[new kr("emissionFactor",o=>o.emissiveFactor),new kr("mrrFactors",o=>o.mrrFactors)]:[new yp("emissionFactor",o=>o.emissiveFactor),new yp("mrrFactors",o=>o.mrrFactors)]),r.code.add(D`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${i?D`vtc.uv = vuv0;`:""}
      ${e.hasMetallicRoughnessTextureTransform?D`vtc.uv = metallicRoughnessUV;`:""}
      ${e.hasMetallicRoughnessTexture?e.supportsTextureAtlas?D`
                vtc.size = ${Nf(e,"texMetallicRoughness")};
                applyMetallnessAndRoughness(vtc);`:D`applyMetallnessAndRoughness(vtc);`:""}
      ${e.hasEmissiveTextureTransform?D`vtc.uv = emissiveUV;`:""}
      ${e.hasEmissionTexture?e.supportsTextureAtlas?D`
                vtc.size = ${Nf(e,"texEmission")};
                applyEmission(vtc);`:D`applyEmission(vtc);`:""}
      ${e.hasOcclusionTextureTransform?D`vtc.uv = occlusionUV;`:""}
      ${e.hasOcclusionTexture?e.supportsTextureAtlas?D`
                vtc.size = ${Nf(e,"texOcclusion")};
                applyOcclusion(vtc);`:D`applyOcclusion(vtc);`:""}
    }
  `)}}else r.code.add(D`float getBakedOcclusion() { return 1.0; }`);else r.code.add(D`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function lhe(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new kr("lightingAmbientSH0",(n,s)=>Le(V1e,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),r.code.add(D`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add([new pi("lightingAmbientSH_R",(n,s)=>pn(Ay,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new pi("lightingAmbientSH_G",(n,s)=>pn(Ay,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new pi("lightingAmbientSH_B",(n,s)=>pn(Ay,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))]),r.code.add(D`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add([new kr("lightingAmbientSH0",(n,s)=>Le(V1e,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new pi("lightingAmbientSH_R1",(n,s)=>pn(Ay,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new pi("lightingAmbientSH_G1",(n,s)=>pn(Ay,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new pi("lightingAmbientSH_B1",(n,s)=>pn(Ay,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new pi("lightingAmbientSH_R2",(n,s)=>pn(Ay,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new pi("lightingAmbientSH_G2",(n,s)=>pn(Ay,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new pi("lightingAmbientSH_B2",(n,s)=>pn(Ay,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))]),r.code.add(D`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==Jt.Normal&&e.pbrMode!==Jt.Schematic||r.code.add(D`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const V1e=G(),Ay=Kr();function JN(t){t.vertex.code.add(D`const float PI = 3.141592653589793;`),t.fragment.code.add(D`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var oo,GS;function Zwt(t){return M(t)&&M(t.cubeMap)}function che(t){return M(t)&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(oo||(oo={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(GS||(GS={}));let Jwt=class{constructor(){this.readChannels=GS.RG,this.renderingStage=oo.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=G(),this.isCameraPositionFinal=!0,this.parallax=new G1e,this.parallaxNew=new G1e,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:ba.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:Qh.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:D2.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===ba.FADE_OUT||this.fadeInOut.stage===ba.FADE_IN||this.fadeIn.stage===Qh.FADE_IN||this.fadeInOutHeight.stage!==D2.FINISHED||this.renderingStage===oo.FADING_TEXTURE_CHANNELS}};var Qh,ba,D2;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(Qh||(Qh={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(ba||(ba={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(D2||(D2={}));let G1e=class{constructor(){this.anchorPointClouds=G(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=ht()}},z_=class extends Ys{constructor(e,r){super(e,"bool",Sn.Pass,(i,n,s)=>i.setUniform1b(e,r(n,s)))}},Kwt=class extends Ys{constructor(e,r){super(e,"samplerCube",Sn.Pass,(i,n,s)=>i.bindTexture(e,r(n,s)))}};function s6e(t){const e=t.fragment;e.uniforms.add([new fs("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new fs("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new kr("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new kr("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new ut("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new ut("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new ut("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===ba.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new ut("crossFadeAnchorFactor",(r,i)=>He(i.cloudsFade.crossFade.factor,0,1)),new Kwt("cubeMap",(r,i)=>M(i.cloudsFade.data)&&M(i.cloudsFade.data.cubeMap)?i.cloudsFade.data.cubeMap.colorTexture:null),new z_("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new z_("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===GS.RG),new z_("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===oo.FADING_TEXTURE_CHANNELS)]),e.constants.add("planetRadius","float",yi.radius),e.code.add(D`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(D`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(D`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),x1(e),ty(e),e.code.add(D`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(D`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(D`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(D`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(D`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function ry(t){t.code.add(D`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function ext(){const t=new Ui;t.attributes.add(z.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add([new fs("inverseProjectionMatrix",(i,n)=>n.camera.inverseProjectionMatrix),new fs("inverseViewMatrix",(i,n)=>nP(txt,n.camera.viewMatrix))]),e.code.add(D`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(ry),r.include(bd),t.include(lhe,{pbrMode:Jt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(JN),t.include(Oj),t.include(uz,{useLegacyTerrainShading:!1}),t.include(s6e,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1}),r.uniforms.add([new kr("cameraPosition",(i,n)=>n.camera.eye)]),r.code.add(D`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const txt=ht(),rxt=Object.freeze(Object.defineProperty({__proto__:null,build:ext},Symbol.toStringTag,{value:"Module"}));let o6e=class a6e extends qi{constructor(e){super(e,new Nc,()=>this.destroy())}initializeProgram(e){return new zi(e.rctx,a6e.shader.get().build(),Di)}initializePipeline(){return Pr({blending:Da(st.ONE,st.ZERO,st.SRC_ALPHA,st.ONE),depthTest:{func:Qn.LEQUAL},colorWrite:Gr})}};o6e.shader=new Bi(rxt,()=>be(()=>import("./CloudsComposition.glsl-a1cfac9e.js"),[]));let Qx=class extends rt{constructor(e){super(e),this._technique=new o6e(e),this._vao=Fc(e.rctx)}destroy(){this._technique=us(this._technique),this._vao=kt(this._vao)}render(e){const r=e.bindParameters.cloudsFade;if(k(this._vao)||k(r.data))return;if(!this._technique.compiled)return void this.requestRender();const i=e.rctx.bindTechnique(this._technique,ixt,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(wr.TRIANGLE_STRIP,0,4)}};h([f({constructOnly:!0})],Qx.prototype,"rctx",void 0),h([f({constructOnly:!0})],Qx.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],Qx.prototype,"planetRadius",void 0),h([f({constructOnly:!0})],Qx.prototype,"requestRender",void 0),Qx=h([Q("esri.views.3d.environment.CloudsComposition")],Qx);const ixt=new En;function Jf(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function nxt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function uhe(t,e,r,i,n,s,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function hhe(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Kf(t,e){if(t===e){const r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function SE(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,p=-u*s+a*l,A=c*s-o*l;let v=r*d+i*p+n*A;return v?(v=1/v,t[0]=d*v,t[1]=(-u*i+n*c)*v,t[2]=(a*i-n*o)*v,t[3]=p*v,t[4]=(u*r-n*l)*v,t[5]=(-a*r+n*s)*v,t[6]=A*v,t[7]=(-c*r+i*l)*v,t[8]=(o*r-i*s)*v,t):null}function sxt(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=n*c-i*u,t[2]=i*a-n*o,t[3]=a*l-s*u,t[4]=r*u-n*l,t[5]=n*s-r*a,t[6]=s*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*s,t}function oxt(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+r*(-c*n+o*a)+i*(l*n-s*a)}function mO(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=r[0],A=r[1],v=r[2],b=r[3],S=r[4],E=r[5],R=r[6],O=r[7],I=r[8];return t[0]=p*i+A*o+v*c,t[1]=p*n+A*a+v*u,t[2]=p*s+A*l+v*d,t[3]=b*i+S*o+E*c,t[4]=b*n+S*a+E*u,t[5]=b*s+S*l+E*d,t[6]=R*i+O*o+I*c,t[7]=R*n+O*a+I*u,t[8]=R*s+O*l+I*d,t}function fz(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=r[0],A=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=p*i+A*o+c,t[7]=p*n+A*a+u,t[8]=p*s+A*l+d,t}function dhe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=Math.sin(r),A=Math.cos(r);return t[0]=A*i+p*o,t[1]=A*n+p*a,t[2]=A*s+p*l,t[3]=A*o-p*i,t[4]=A*a-p*n,t[5]=A*l-p*s,t[6]=c,t[7]=u,t[8]=d,t}function phe(t,e,r){const i=r[0],n=r[1],s=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=s*e[6],t[7]=s*e[7],t[8]=s*e[8],t}function axt(t,e,r){const i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t}function lxt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function cxt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function uxt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function hxt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function fhe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,d=i*a,p=n*o,A=n*a,v=n*l,b=s*o,S=s*a,E=s*l;return t[0]=1-d-v,t[3]=u-E,t[6]=p+S,t[1]=u+E,t[4]=1-c-v,t[7]=A-b,t[2]=p-S,t[5]=A+b,t[8]=1-c-d,t}function l6e(t,e){const r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],d=u*o-a*c,p=-u*s+a*l,A=c*s-o*l,v=r*d+i*p+n*A;if(!v)return null;const b=1/v;return t[0]=d*b,t[1]=(-u*i+n*c)*b,t[2]=(a*i-n*o)*b,t[3]=p*b,t[4]=(u*r-n*l)*b,t[5]=(-a*r+n*s)*b,t[6]=A*b,t[7]=(-c*r+i*l)*b,t[8]=(o*r-i*s)*b,t}function gO(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],A=e[11],v=e[12],b=e[13],S=e[14],E=e[15],R=r*a-i*o,O=r*l-n*o,I=r*c-s*o,N=i*l-n*a,L=i*c-s*a,B=n*c-s*l,U=u*b-d*v,q=u*S-p*v,Z=u*E-A*v,X=d*S-p*b,ee=d*E-A*b,se=p*E-A*S;let ue=R*se-O*ee+I*X+N*Z-L*q+B*U;return ue?(ue=1/ue,t[0]=(a*se-l*ee+c*X)*ue,t[1]=(l*Z-o*se-c*q)*ue,t[2]=(o*ee-a*Z+c*U)*ue,t[3]=(n*ee-i*se-s*X)*ue,t[4]=(r*se-n*Z+s*q)*ue,t[5]=(i*Z-r*ee-s*U)*ue,t[6]=(b*B-S*L+E*N)*ue,t[7]=(S*I-v*B-E*O)*ue,t[8]=(v*L-b*I+E*R)*ue,t):null}function dxt(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function pxt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function fxt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function mxt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function c6e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function gxt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function Axt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function yxt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function _xt(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=e[0],p=e[1],A=e[2],v=e[3],b=e[4],S=e[5],E=e[6],R=e[7],O=e[8],I=Dc();return Math.abs(r-d)<=I*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-p)<=I*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(n-A)<=I*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(s-v)<=I*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(o-b)<=I*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-S)<=I*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-E)<=I*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-R)<=I*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(u-O)<=I*Math.max(1,Math.abs(u),Math.abs(O))}function mhe(t){const e=Dc(),r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(r*r+s*s+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}const vxt=mO,bxt=c6e;Object.freeze(Object.defineProperty({__proto__:null,add:mxt,adjoint:sxt,copy:nxt,determinant:oxt,equals:_xt,exactEquals:yxt,frob:fxt,fromMat2d:hxt,fromMat4:Jf,fromQuat:fhe,fromRotation:cxt,fromScaling:uxt,fromTranslation:lxt,identity:hhe,invert:SE,isOrthoNormal:mhe,mul:vxt,multiply:mO,multiplyScalar:gxt,multiplyScalarAndAdd:Axt,normalFromMat4:gO,normalFromMat4Legacy:l6e,projection:dxt,rotate:dhe,scale:phe,scaleByVec2:axt,set:uhe,str:pxt,sub:bxt,subtract:c6e,translate:fz,transpose:Kf},Symbol.toStringTag,{value:"Module"}));var ch;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(ch||(ch={}));let jk=class extends Nc{constructor(){super(...arguments),this.steps=ch.SIXTEEN,this.writeTextureChannels=GS.RG}};h([ae({count:ch.COUNT})],jk.prototype,"steps",void 0),h([ae({constValue:Fe("esri-mobile")?1024:2048})],jk.prototype,"cubeMapSize",void 0),h([ae()],jk.prototype,"writeTextureChannels",void 0);let E4=class{constructor(e,r,i,n,s,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=n,this.detailSize=s,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const j1e=new E4([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],ch.SIXTEEN),fc={sunny:j1e,cloudy:new E4([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],ch.TWOHUNDRED,.6),rainy:new E4([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],ch.TWOHUNDRED,.4),snowy:new E4([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],ch.HUNDRED,.65),foggy:new E4([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],ch.SIXTEEN),default:j1e},mf=Fe("esri-mobile")?64:128,wxt=mf/128,V0=Math.ceil(Math.sqrt(mf)),rm=(mf+2)*V0,xxt=1e5,jQ=128,Txt=rm/1560;function s0(t,e=!0){t.attributes.add(z.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(D`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?D`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let yL=class extends Ys{constructor(e,r){super(e,"mat3",Sn.Draw,(i,n,s)=>i.setUniformMatrix3fv(e,r(n,s)))}},u6e=class extends En{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=fc.default.raymarchingSteps,this.weatherTile=Ft()}},h6e=class extends En{constructor(){super(...arguments),this.viewMatrix=Es()}};function Sxt(t){const e=new Ui;e.include(s0,!1);const r=e.fragment;return r.uniforms.add([new ut("cloudRadius",i=>i.cloudRadius),new ut("power",i=>Mr(35,120,i.absorption)),new ut("sigmaE",i=>1+i.absorption),new ut("density",i=>Mr(0,.3,i.density)),new ut("cloudSize",i=>Mr(0,.02,Math.max(.01,1-i.cloudSize))),new ut("detailSize",i=>Mr(0,.2,Math.max(.01,1-i.detailSize))),new ut("smoothness",i=>Mr(0,.5,1-i.smoothness)),new ut("cloudHeight",i=>Mr(0,1500,i.cloudHeight)),new ut("coverage",i=>i.coverage),new yL("view",i=>i.viewMatrix),new _r("cloudShapeTexture",i=>M(i.noiseTexture)?i.noiseTexture.textureAtlas:null),new ji("cloudVariables",i=>ti(Ext,i.coverage,i.absorption))]),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(D`
    const int STEPS = ${t.steps===ch.SIXTEEN?D`16`:t.steps===ch.HUNDRED?D`100`:D`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(D`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${D.float(rm)};
      const float dataWidth = ${D.float(rm)};
      const float tileRows = ${D.float(V0)};
      const vec3 atlasDimensions = vec3(${D.float(mf)}, ${D.float(mf)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${D.float(wxt)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${D.float(Txt)} * p) / ${D.float(rm)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),r.code.add(D`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(D`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(D`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(D`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(D`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const Ext=Ft(),Cxt=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:h6e,CloudsPassParameters:u6e,build:Sxt},Symbol.toStringTag,{value:"Module"}));let d6e=class p6e extends qi{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new zi(e.rctx,p6e.shader.get().build(this.configuration),Di)}initializePipeline(){return Pr({blending:jm(st.CONSTANT_COLOR,st.ONE_MINUS_CONSTANT_COLOR,UA.ADD,this.configuration.writeTextureChannels===GS.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Qn.LEQUAL},colorWrite:Gr})}};d6e.shader=new Bi(Cxt,()=>be(()=>import("./Clouds.glsl-b1b7cf83.js"),[]));var op;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(op||(op={}));let Cie=class extends Nc{constructor(){super(...arguments),this.mode=op.Full}};h([ae({count:op.COUNT})],Cie.prototype,"mode",void 0);let f6e=class extends En{constructor(){super(...arguments),this.weatherTile=Gi(0,0)}};function Mxt(t){const e=new Ui;return e.include(s0,!1),e.fragment.code.add(D`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===op.Full&&e.fragment.code.add(D`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${D.float(V0)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${D.float(8)});

      float worley0 = worley(p, ${D.float(2)} * 2.0);
      float worley1 = worley(p, ${D.float(2)} * 8.0);
      float worley2 = worley(p, ${D.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${D.float(2)});
      float worley1 = worley(p, ${D.float(2)} * 2.0);
      float worley2 = worley(p, ${D.float(2)} * 4.0);
      float worley3 = worley(p, ${D.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new ji("weatherTile",r=>r.weatherTile)),e.fragment.code.add(D`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${D.float(jQ)});

      // Get global coordinates of p
      p += weatherTile * ${D.float(jQ)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${D.float(xxt)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(D`void main() {`),t.mode===op.Full&&e.fragment.code.add(D`
        float padWidth = 1.0;
        float paddedSize = ${D.float(mf)} + 2.0 * padWidth;
        float tileCount = ${D.float(V0)} * ${D.float(V0)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${D.float(mf)};
          }

          if (startPadY) {
            pixel.y += ${D.float(mf)};
          }

          if (endPadX) {
            pixel.x -= ${D.float(mf)};
          }

          if (endPadY) {
            pixel.y -= ${D.float(mf)};
          }

          uv = vec2(pixel.xy / ${D.float(mf)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${D.float(mf)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${D.float(V0)} * ${D.float(V0)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${D.float(V0)} * ${D.float(V0)});
        p = p_;
        p.z /= (${D.float(V0)} * ${D.float(V0)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(D`
      vec2 mapUV = ${D.float(jQ)} * (gl_FragCoord.xy / ${D.float(rm)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===op.Full?D`gl_FragColor.ba = vec2(0.0, map);`:D`gl_FragColor = vec4(map);`};
    }
  `),e}const Rxt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:f6e,build:Mxt},Symbol.toStringTag,{value:"Module"}));let Mie=class m6e extends qi{initializeProgram(e){return new zi(e.rctx,m6e.shader.get().build(this.configuration),Di)}initializePipeline(){return Pr({blending:this.configuration.mode===op.Full?jm(st.ONE,st.ZERO):Da(st.ZERO,st.ONE,st.ONE,st.ZERO),depthTest:{func:Qn.ALWAYS},colorWrite:Gr})}};Mie.shader=new Bi(Rxt,()=>be(()=>import("./NoiseTextureAtlas.glsl-e3419d21.js"),[]));let kC=class{constructor(e,r){this._context=e,this._desc=r,this.type="renderbuffer",this._context.instanceCounter.increment(Pa.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==lr.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,n,s)}else i.renderbufferStorage(i.RENDERBUFFER,o,n,s)}get descriptor(){return this._desc}get samples(){const e=this._desc.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}resize(e,r){const i=this._desc;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const n=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Pa.Renderbuffer,this),this._context=AS(this._context))}},uo=class UC{constructor(e,r,i=null,n=null){if(this._context=e,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._depthStencilTexture=null,this._initialized=!1,this._desc={...r},e.instanceCounter.increment(Pa.FramebufferObject,this),M(i)){Array.isArray(i)||(i=[i]);for(let s=0;s<i.length;++s){const o=i[s],a=Hd.COLOR_ATTACHMENT0+s;let l;q1e(o)?(e_(o)?(l=o.descriptor,this._colorAttachments.set(a,o)):(l=o,this._colorAttachments.set(a,new Xt(this._context,l))),i8(l,this._desc)):(H1e(o)?(l=o.descriptor,this._colorAttachments.set(a,o)):(l=o,this._colorAttachments.set(a,new kC(this._context,l))),HQ(l,this._desc)),this._validateColorAttachmentPoint(a)}}if(M(n)){let s,o;if(q1e(n))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),e_(n)?(o=n.descriptor,this._depthStencilTexture=n):(o=n,this._depthStencilTexture=new Xt(this._context,o)),i8(o,this._desc);else{H1e(n)?(o=n.descriptor,s=n):(o=n,s=new kC(this._context,o));const a=this._desc.depthStencilTarget??Ni.DEPTH_STENCIL_RENDER_BUFFER;a===Ni.STENCIL_RENDER_BUFFER?this._stencilAttachment=s:a===Ni.DEPTH_RENDER_BUFFER||a===Ni.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=s:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=a,HQ(o,this._desc)}}}dispose(){if(!this._desc)return;const e=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Pa.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const e=this._colorAttachments.get(Hd.COLOR_ATTACHMENT0);return e&&e_(e)?e:null}get colorAttachment(){return this._colorAttachments.get(Hd.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width??0}get height(){return this._desc.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[r,i])=>e+VS(i),0)+VS(this.depthStencilAttachment)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&e_(r)?r:null}attachColorTexture(e,r=Hd.COLOR_ATTACHMENT0){e&&(this._validateColorAttachmentPoint(r),i8(e.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e))}detachColorTexture(e=Hd.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(e_(r)){const i=r;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),i}}setColorTextureTarget(e,r=Hd.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);e_(i)&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencilTexture(e){if(k(e))return;const r=e.descriptor;r.pixelFormat!==_t.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==xr.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),i8(r,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Ni.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Ni.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,I1e)),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,I1e)),this._depthStencilTexture=null,e}attachDepthStencilBuffer(e){if(k(e))return;const r=e.descriptor;if(r.internalFormat!==lu.DEPTH_STENCIL&&r.internalFormat!==lu.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),HQ(r,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=r.internalFormat===lu.DEPTH_STENCIL?Ni.DEPTH_STENCIL_RENDER_BUFFER:Ni.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,n=this._desc.depthStencilTarget===Ni.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(qa.FRAMEBUFFER,n,i.RENDERBUFFER,e.glName)}this._depthAttachment=e}detachDepthStencilBuffer(){const e=this._context.gl,r=this._depthAttachment;if(r&&this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Ni.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(qa.FRAMEBUFFER,i,e.RENDERBUFFER,null)}return this._depthAttachment=null,r}detachAll(){this._colorAttachments.forEach((e,r)=>this._detachColorAttachment(r)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(e,r,i,n,s,o,a){(e<0||r<0||s<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==cr.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||(c==null?void 0:c.width)==null||(c==null?void 0:c.height)==null||e+i>l.width||r+n>l.height||s+i>c.width||o+n>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const u=this._context,d=u.bindTexture(a,Xt.TEXTURE_UNIT_FOR_UPDATES);u.setActiveTexture(Xt.TEXTURE_UNIT_FOR_UPDATES),u.bindFramebuffer(this),u.gl.copyTexSubImage2D(cr.TEXTURE_2D,0,s,o,e,r,i,n),u.bindTexture(d,Xt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,n,s,o,a){(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,n,s,o,a)}async readPixelsAsync(e,r,i,n,s,o,a){if(this._context.type!==lr.WEBGL2)return Yd()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,r,i,n,s,o,a);const l=this._context.gl,c=Ji.createPixelPack(this._context,ki.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,n,s,o,0),this._context.unbindBuffer(yr.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){const i=this._desc;if(i.width!==e||i.height!==r){if(i.width=e,i.height=r,!this._initialized)return this._colorAttachments.forEach(n=>{n&&n.resize(e,r)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(e,r));this._colorAttachments.forEach(n=>{n&&n.resize(e,r)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(e,r):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(e,r),this._stencilAttachment&&this._stencilAttachment.resize(e,r)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(e=qa.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=this._context,n=r.createFramebuffer(),s=this._desc,o=s.colorTarget??Fs.RENDER_BUFFER,a=s.width??1,l=s.height??1;if(r.bindFramebuffer(e,n),this._colorAttachments.size===0)if(o===Fs.TEXTURE||o===Fs.CUBEMAP)this._colorAttachments.set(Hd.COLOR_ATTACHMENT0,Oxt(i,s,this.descriptor.colorTarget===Fs.CUBEMAP?cr.TEXTURE_CUBE_MAP:cr.TEXTURE_2D));else{const u=new kC(i,{internalFormat:pr.RGBA4,width:a,height:l});this._colorAttachments.set(Hd.COLOR_ATTACHMENT0,u)}this._colorAttachments.forEach((u,d)=>{u&&(e_(u)?this._framebufferTexture2D(u.glName,d,W1e(u),e):r.framebufferRenderbuffer(e,d,r.RENDERBUFFER,u.glName))});const c=s.depthStencilTarget??Ni.NONE;switch(c){case Ni.DEPTH_RENDER_BUFFER:case Ni.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new kC(i,{internalFormat:s.depthStencilTarget===Ni.DEPTH_RENDER_BUFFER?lu.DEPTH_COMPONENT16:lu.DEPTH_STENCIL,width:a,height:l}));const u=c===Ni.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(e,u,r.RENDERBUFFER,this._depthAttachment.glName);break}case Ni.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new kC(i,{internalFormat:lu.STENCIL_INDEX8,width:a,height:l})),r.framebufferRenderbuffer(e,r.STENCIL_ATTACHMENT,r.RENDERBUFFER,this._stencilAttachment.glName);break;case Ni.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){i.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const u={target:cr.TEXTURE_2D,pixelFormat:_t.DEPTH_STENCIL,dataType:xr.UNSIGNED_INT_24_8,samplingMode:zt.NEAREST,wrapMode:Ar.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new Xt(i,u)}this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,W1e(this._depthStencilTexture),e)}Yd()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=n,this._initialized=!0}_framebufferTexture2D(e,r=Hd.COLOR_ATTACHMENT0,i=cr.TEXTURE_2D,n=qa.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,r,i,e,s)}_detachColorAttachment(e){Yd()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const r=this._context.gl,i=this._colorAttachments.get(e);return e_(i)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)):this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(qa.FRAMEBUFFER,e,r.RENDERBUFFER,null)),this._colorAttachments.delete(e),i}_disposeColorAttachments(){this._colorAttachments.forEach((e,r)=>{this._detachColorAttachment(r),e.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Ni.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(qa.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(qa.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(e){if(UC._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const n=this._context.gl;UC._MAX_COLOR_ATTACHMENTS=n.getParameter(i.MAX_COLOR_ATTACHMENTS)}else UC._MAX_COLOR_ATTACHMENTS=1}const r=e-Hd.COLOR_ATTACHMENT0;r+1>UC._MAX_COLOR_ATTACHMENTS&&we.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${UC._MAX_COLOR_ATTACHMENTS} color attachments`)}};function e_(t){return t!=null&&"type"in t&&t.type==="texture"}function H1e(t){return t!=null&&"type"in t&&t.type==="renderbuffer"}function q1e(t){return e_(t)||t!=null&&"pixelFormat"in t}function Oxt(t,e,r){return new Xt(t,{target:r,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.NEAREST,wrapMode:Ar.CLAMP_TO_EDGE,width:e.width,height:e.height})}function i8(t,e){t.target!==cr.TEXTURE_2D&&t.target!==cr.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Color attachment texture must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}function HQ(t,e){e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}function W1e(t){return t.descriptor.target===cr.TEXTURE_CUBE_MAP?cr.TEXTURE_CUBE_MAP_POSITIVE_X:cr.TEXTURE_2D}uo._MAX_COLOR_ATTACHMENTS=-1;let C4=class extends rt{constructor(e){super(e),this._needsRender=!0,this._passParameters=new f6e,this._frameBuffer=new uo(e.context.renderContext.rctx,{colorTarget:Fs.TEXTURE,width:rm,height:rm},{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:zt.LINEAR,hasMipmap:!1,width:rm,height:rm}),this._vao=Fc(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return M(this._texture)?M(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(op.WeatherMap)):M(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(op.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||($a(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=us(this._fullTechniqueCached),this._weatherMapTechniqueCached=us(this._weatherMapTechniqueCached),this._frameBuffer=kt(this._frameBuffer),this._vao=kt(this._vao)}get _fullTechnique(){if(k(this._fullTechniqueCached)){const e=new Cie;e.mode=op.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(Mie,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(k(this._weatherMapTechniqueCached)){const e=new Cie;e.mode=op.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(Mie,e)}return this._weatherMapTechniqueCached}_render(e){if(k(this._vao)||k(this._frameBuffer))return null;const r=e===op.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,n=i.getViewport();i.setViewport(0,0,rm,rm),i.bindFramebuffer(this._frameBuffer);const s=i.bindTechnique(r,this._passParameters,null);return i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(n.x,n.y,n.width,n.height),this._needsRender=!1,this._frameBuffer.colorTexture}};h([f({constructOnly:!0})],C4.prototype,"context",void 0),h([f({readOnly:!0})],C4.prototype,"_techniqueRepository",null),C4=h([Q("esri.views.3d.environment.NoiseTextureAtlas")],C4);function g6e(t){t.include(Tp),t.uniforms.add([new _r("geometryDepthTexture",(e,r)=>r.multipassGeometry.linearDepthTexture),new ji("nearFar",(e,r)=>r.camera.nearFar)]),t.code.add(D`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let Pxt=class{constructor(){this.enabled=!1}};function Sp(t,e){e.hasMultipassTerrain&&(t.fragment.include(Tp),t.fragment.uniforms.add(new _r("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new ji("nearFar",(r,i)=>i.camera.nearFar)),t.fragment.uniforms.add(new ji("inverseViewport",(r,i)=>i.inverseViewport)),t.fragment.code.add(D`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let Ixt=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function $xt(t,e){const r=t.fragment;r.include(Tp),r.uniforms.add(new ji("nearFar",(i,n)=>n.camera.nearFar)),r.uniforms.add(new _r("depthMap",(i,n)=>n.linearDepthTexture)),r.uniforms.add(new fs("proj",(i,n)=>n.ssr.camera.projectionMatrix)),r.uniforms.add(new ut("invResolutionHeight",(i,n)=>1/n.ssr.camera.height)),r.uniforms.add(new fs("reprojectionMatrix",(i,n)=>n.ssr.reprojectionMatrix)),r.code.add(D`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let Dxt=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=ht()}};function $j(t){return t?{ray:el(t.ray),c0:t.c0,c1:t.c1}:{ray:el(),c0:0,c1:Number.MAX_VALUE}}function Lxt(t,e=$j()){return NB(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function Nxt(t,e,r=$j()){const i=ct(t.vector);return Y$e(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function ghr(t,e){return A6e(t,t.c0,e)}function Ahr(t,e){return A6e(t,t.c1,e)}function A6e(t,e,r){return ze(r,t.ray.origin,Oe(r,t.ray.direction,e))}new v1(()=>$j());function _L(t){return t?[Xi(t[0]),Xi(t[1]),Xi(t[2]),Xi(t[3]),Xi(t[4]),Xi(t[5])]:[Xi(),Xi(),Xi(),Xi(),Xi(),Xi()]}function y6e(){return[G(),G(),G(),G(),G(),G(),G(),G()]}function mz(t,e){for(let r=0;r<L2.NUM;r++)tj(t[r],e[r])}function _6e(t,e,r,i=zxt){const n=js(Mce.get(),e,t);Ml(n,n);for(let s=0;s<Rie.NUM;++s){const o=cp(Cce.get(),Bxt[s],n);Le(i[s],o[0]/o[3],o[1]/o[3],o[2]/o[3])}v6e(r,i)}function v6e(t,e){yc(e[jt.FAR_BOTTOM_LEFT],e[jt.NEAR_BOTTOM_LEFT],e[jt.NEAR_TOP_LEFT],t[Fn.LEFT]),yc(e[jt.NEAR_BOTTOM_RIGHT],e[jt.FAR_BOTTOM_RIGHT],e[jt.FAR_TOP_RIGHT],t[Fn.RIGHT]),yc(e[jt.FAR_BOTTOM_LEFT],e[jt.FAR_BOTTOM_RIGHT],e[jt.NEAR_BOTTOM_RIGHT],t[Fn.BOTTOM]),yc(e[jt.NEAR_TOP_LEFT],e[jt.NEAR_TOP_RIGHT],e[jt.FAR_TOP_RIGHT],t[Fn.TOP]),yc(e[jt.NEAR_BOTTOM_LEFT],e[jt.NEAR_BOTTOM_RIGHT],e[jt.NEAR_TOP_RIGHT],t[Fn.NEAR]),yc(e[jt.FAR_BOTTOM_RIGHT],e[jt.FAR_BOTTOM_LEFT],e[jt.FAR_TOP_LEFT],t[Fn.FAR])}function Zb(t,e){for(let r=0;r<L2.NUM;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function Fxt(t,e){return w6e(t,Lxt(e,x6e.get()))}function yhr(t,e){for(let r=0;r<L2.NUM;r++){const i=t[r];if(!Blt(i,e))return!1}return!0}function kxt(t,e,r){return w6e(t,Nxt(e,r,x6e.get()))}function b6e(t,e){for(let r=0;r<L2.NUM;r++)if(kn(t[r],e)>0)return!1;return!0}function w6e(t,e){for(let r=0;r<L2.NUM;r++)if(!Ult(t[r],e))return!1;return!0}var Fn,jt;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(Fn||(Fn={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(jt||(jt={}));const Uxt={bottom:[jt.FAR_BOTTOM_RIGHT,jt.NEAR_BOTTOM_RIGHT,jt.NEAR_BOTTOM_LEFT,jt.FAR_BOTTOM_LEFT],near:[jt.NEAR_BOTTOM_LEFT,jt.NEAR_BOTTOM_RIGHT,jt.NEAR_TOP_RIGHT,jt.NEAR_TOP_LEFT],far:[jt.FAR_BOTTOM_RIGHT,jt.FAR_BOTTOM_LEFT,jt.FAR_TOP_LEFT,jt.FAR_TOP_RIGHT],right:[jt.NEAR_BOTTOM_RIGHT,jt.FAR_BOTTOM_RIGHT,jt.FAR_TOP_RIGHT,jt.NEAR_TOP_RIGHT],left:[jt.FAR_BOTTOM_LEFT,jt.NEAR_BOTTOM_LEFT,jt.NEAR_TOP_LEFT,jt.FAR_TOP_LEFT],top:[jt.FAR_TOP_LEFT,jt.NEAR_TOP_LEFT,jt.NEAR_TOP_RIGHT,jt.FAR_TOP_RIGHT]};var L2,Rie;(function(t){t[t.NUM=6]="NUM"})(L2||(L2={})),function(t){t[t.NUM=8]="NUM"}(Rie||(Rie={}));const Bxt=[Fr(-1,-1,-1,1),Fr(1,-1,-1,1),Fr(1,1,-1,1),Fr(-1,1,-1,1),Fr(-1,-1,1,1),Fr(1,-1,1,1),Fr(1,1,1,1),Fr(-1,1,1,1)],x6e=new v1($j),zxt=y6e();function Vxt(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function Gxt(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function jxt(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function Hxt(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var Oie;let mr=Oie=class extends rt{constructor(t={}){super(t),this._center=G(),this._up=G(),this._viewUp=G(),this._viewForward=G(),this._viewRight=G(),this._ray=el(),this._viewport=Fr(0,0,1,1),this._padding=Fr(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Gi(1,1e3),this._viewDirty=!0,this._viewMatrix=ht(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=ht(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=ht(),this._frustumDirty=!0,this._frustum=_L(),this._fullViewport=Kr(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return Ve(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Ia(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=YO(Kr(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&Nle(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[si.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[si.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[si.RIGHT]+this._padding[si.LEFT]}set fullWidth(t){this.width=t-(this._padding[si.RIGHT]+this._padding[si.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[si.TOP]+this._padding[si.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[si.TOP]+this._padding[si.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[si.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[si.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){YM(this._padding,t)||(this._viewport[0]+=t[si.LEFT]-this._padding[si.LEFT],this._viewport[1]+=t[si.BOTTOM]-this._padding[si.BOTTOM],this._viewport[2]-=t[si.RIGHT]+t[si.LEFT]-(this._padding[si.RIGHT]+this._padding[si.LEFT]),this._viewport[3]-=t[si.TOP]+t[si.BOTTOM]-(this._padding[si.TOP]+this._padding[si.BOTTOM]),lm(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(js(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,n=ZIe(ht(),-i*(1+2*this._padding[si.LEFT]/t),i*(1+2*this._padding[si.RIGHT]/t),-r*(1+2*this._padding[si.BOTTOM]/e),r*(1+2*this._padding[si.TOP]/e),this.near,this.far),s=this._get("projectionMatrix");return s&&gce(s,n)?s:n}get inverseProjectionMatrix(){return Ml(ht(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||ht()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return jxt(this._fov,this.width,this.height)}set fovX(t){this._fov=Vxt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Hxt(this._fov,this.width,this.height)}set fovY(t){this._fov=Gxt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return zn(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Ml(this._viewInverseTransposeMatrix,this.viewMatrix),gd(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){Pe(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,lm(this._viewport,t.viewport),this.notifyChange("_viewport"),lm(this._padding,t.padding),this.notifyChange("_padding"),$a(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Ia(this._viewMatrix,t.viewMatrix),Pe(this._viewRight,t.viewRight),Pe(this._viewUp,t.viewUp),Pe(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(mz(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Ia(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),lm(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new Oie().copyFrom(this)}equals(t){return fu(this.eye,t.eye)&&fu(this.center,t.center)&&fu(this.up,t.up)&&YM(this._viewport,t.viewport)&&YM(this._padding,t.padding)&&RFe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||TB(t.padding,this._padding)>=.5||TB(this.screenViewport,t.screenViewport)>=.5)return!1;Ka(lc,t.eye,t.center),Ka(qQ,this.eye,this.center);const e=Qe(lc,qQ),r=xK(lc),i=xK(qQ),n=5e-4;return e*e>=(1-1e-10)*r*i&&Ile(t.eye,this.eye)<Math.max(r,i)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(C5(this.viewForward,Ve(lc,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Ns()){return t[0]=(this.padding[si.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[si.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[si.LEFT]+this.width*e,t[1]=this.padding[si.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==ni&&Pe(ni,t),ni[3]=1,cp(ni,ni,this.projectionMatrix);const r=Math.abs(ni[3]);Oe(ni,ni,1/r);const i=this.fullViewport;e[0]=Mr(0,i[0]+i[2],.5+.5*ni[0]),e[1]=Mr(0,i[1]+i[3],.5+.5*ni[1]),e[2]=.5*(ni[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;ni[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],ni[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],ni[2]=(2*t[2]-1)*t[3],ni[3]=t[3],this.inverseProjectionMatrix!=null&&(cp(ni,ni,this.inverseProjectionMatrix),e[0]=ni[0],e[1]=ni[1],e[2]=ni[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,WQ),this.renderToScreen(WQ,e),e}projectToRenderScreen(t,e){if(ni[0]=t[0],ni[1]=t[1],ni[2]=t[2],ni[3]=1,cp(ni,ni,this.viewProjectionMatrix),ni[3]===0)return null;Oe(ni,ni,1/Math.abs(ni[3]));const r=this.fullViewport;return"x"in e?(e.x=Mr(0,r[0]+r[2],.5+.5*ni[0]),e.y=Mr(0,r[1]+r[3],.5+.5*ni[1])):(e[0]=Mr(0,r[0]+r[2],.5+.5*ni[0]),e[1]=Mr(0,r[1]+r[3],.5+.5*ni[1]),e.length>2&&(e[2]=.5*(ni[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,WQ),e)}unprojectFromRenderScreen(t,e){if(js(n8,this.projectionMatrix,this.viewMatrix),!Ml(n8,n8))return null;const r=this.fullViewport;return ni[0]=2*(t[0]-r[0])/r[2]-1,ni[1]=2*(t[1]-r[1])/r[3]-1,ni[2]=2*t[2]-1,ni[3]=1,cp(ni,ni,n8),ni[3]===0?null:(e[0]=ni[0]/ni[3],e[1]=ni[1]/ni[3],e[2]=ni[2]/ni[3],e)}constrainWindowSize(t,e,r,i){const n=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(n-r/2,0),a=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(n-r/2,0),c=-Math.min(this.fullHeight-s-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-n-r/2,0),i-c- -Math.min(s-i/2,0)]}computeUp(t){t===wt.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){Ve(lc,this.center,this.eye);const t=ct(this.center);t<1?(Le(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(Qe(lc,this.center))>.9999*ct(lc)*t||(Kt(this._up,lc,this.center),Kt(this._up,this._up,lc),Ye(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){y1(lc,this.eye,this.center),Math.abs(lc[2])<=.9999&&(Oe(lc,lc,lc[2]),Le(this._up,-lc[0],-lc[1],1-lc[2]),Ye(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?fu(t,e)||(Pe(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):we.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(_6e(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(QG(this._viewMatrix,this.eye,this.center,this.up),Le(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Le(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Le(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};h([f()],mr.prototype,"_center",void 0),h([f()],mr.prototype,"_up",void 0),h([f()],mr.prototype,"_viewport",void 0),h([f()],mr.prototype,"_padding",void 0),h([f()],mr.prototype,"_fov",void 0),h([f()],mr.prototype,"_nearFar",void 0),h([f()],mr.prototype,"_pixelRatio",void 0),h([f()],mr.prototype,"pixelRatio",null),h([f()],mr.prototype,"eye",null),h([f()],mr.prototype,"center",null),h([f()],mr.prototype,"up",null),h([f({readOnly:!0})],mr.prototype,"nearFar",null),h([f()],mr.prototype,"near",null),h([f()],mr.prototype,"far",null),h([f()],mr.prototype,"viewport",null),h([f({readOnly:!0})],mr.prototype,"screenViewport",null),h([f()],mr.prototype,"x",null),h([f()],mr.prototype,"y",null),h([f()],mr.prototype,"width",null),h([f()],mr.prototype,"height",null),h([f()],mr.prototype,"fullWidth",null),h([f()],mr.prototype,"fullHeight",null),h([f({readOnly:!0})],mr.prototype,"_aspect",null),h([f()],mr.prototype,"padding",null),h([f({readOnly:!0})],mr.prototype,"projectionMatrix",null),h([f({readOnly:!0})],mr.prototype,"inverseProjectionMatrix",null),h([f()],mr.prototype,"fov",null),h([f()],mr.prototype,"fovX",null),h([f()],mr.prototype,"fovY",null),mr=Oie=h([Q("esri.views.3d.webgl-engine.lib.Camera")],mr);const ni=Kr(),n8=ht(),lc=G(),qQ=G(),WQ=Yl();var si;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(si||(si={}));var nt;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(nt||(nt={}));var dr;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(dr||(dr={}));let ghe=class{constructor(e=G()){this.intensity=e}},T6e=class{constructor(e=G(),r=pt(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},gz=class{constructor(e=G(),r=pt(.57735,.57735,.57735),i=!0,n=1,s=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=n,this.environmentStrength=s}},S6e=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function qxt(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function QQ(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function sR(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function E6e(t){return(t+1)*(t+1)}function Wxt(t){return He(Math.floor(Math.sqrt(t)-1),0,2)}function C6e(t,e,r){const i=t[0],n=t[1],s=t[2],o=r||[];return o.length=E6e(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*s,o[3]=.4886025119*n),e>=2&&(o[4]=1.09254843059*i*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*i*s,o[8]=.54627421529*(i*i-n*n)),o}function Qxt(t,e){const r=E6e(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function Yxt(t,e){const r=Wxt(e.r.length);for(const i of t)Cc(Pie,i.direction),C6e(Pie,r,w_),qxt(w_,Hk),QQ(w_,i.intensity[0],XE),sR(e.r,XE),QQ(w_,i.intensity[1],XE),sR(e.g,XE),QQ(w_,i.intensity[2],XE),sR(e.b,XE);return e}function Xxt(t,e){C6e(Pie,0,w_);for(const r of t)e.r[0]+=w_[0]*Hk[0]*r.intensity[0]*4*Math.PI,e.g[0]+=w_[0]*Hk[0]*r.intensity[1]*4*Math.PI,e.b[0]+=w_[0]*Hk[0]*r.intensity[2]*4*Math.PI;return e}function Zxt(t,e,r,i){Qxt(e,i),Le(r.intensity,0,0,0);let n=!1;const s=Jxt,o=Kxt,a=eTt;s.length=0,o.length=0,a.length=0;for(const l of t)l instanceof gz&&!n?(Pe(r.direction,l.direction),Pe(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,n=!0):l instanceof gz||l instanceof T6e?s.push(l):l instanceof ghe?o.push(l):l instanceof S6e&&a.push(l);Yxt(s,i),Xxt(o,i);for(const l of a)sR(i.r,l.r),sR(i.g,l.g),sR(i.b,l.b)}const Jxt=[],Kxt=[],eTt=[],w_=[0],XE=[0],Pie=G(),Hk=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Q1e=class{constructor(){this.color=G(),this.intensity=1}},tTt=class{constructor(){this.direction=G(),this.ambient=new Q1e,this.diffuse=new Q1e}};const M6e=.4;let YQ=class{constructor(){this._shOrder=2,this._legacy=new tTt,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new S6e,this._mainLight=new gz(G(),pt(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){Zxt(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Pe(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,Oe(this._legacy.diffuse.color,this._mainLight.intensity,r),Pe(s8,this._legacy.diffuse.color),Oe(s8,s8,M6e*this.globalFactor),ze(this._legacy.ambient.color,this._legacy.ambient.color,s8)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),this._mainLight.direction=Gs(e.mainLight.direction),this._mainLight.intensity=Gs(e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(Eo(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=Mr(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=Mr(e.mainLight.specularStrength,r.mainLight.specularStrength,i),Pe(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=Mr(e.globalFactor,r.globalFactor,i),this.noonFactor=Mr(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let n=0;n<r.sh.r.length;n++)this._sphericalHarmonics.r[n]=Mr(e.sh.r[n],r.sh.r[n],i),this._sphericalHarmonics.g[n]=Mr(e.sh.g[n],r.sh.g[n],i),this._sphericalHarmonics.b[n]=Mr(e.sh.b[n],r.sh.b[n],i);else for(let n=0;n<r.sh.r.length;n++)this._sphericalHarmonics.r[n]=r.sh.r[n],this._sphericalHarmonics.g[n]=r.sh.g[n],this._sphericalHarmonics.b[n]=r.sh.b[n]}};const s8=G();let Dj=class{constructor(e,r,i){this.shadowMap=e,this.ssaoHelper=r,this.slicePlane=i,this.slot=nt.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=dr.NONE,this._camera=new mr,this._inverseViewport=Ft(),this.oldLighting=new YQ,this.newLighting=new YQ,this._fadedLighting=new YQ,this._lighting=this.newLighting,this.ssr=new Dxt,this.multipassTerrain=new Ixt,this.multipassGeometry=new Pxt,this.overlays=[],this.cloudsFade=new Jwt}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},Hu=class extends rt{constructor(e){super(e),this._handles=new cn,this._techniques=new Array,this._techniqueConfiguration=new jk,this._bindParameters=new Dj(null,null,null),this._passParameters=new u6e,this._drawParameters=new h6e,this._weatherTile=Ft(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Mr(fc.default.coverage[0],fc.default.coverage[1],.5),this.density=Mr(fc.default.density[0],fc.default.density[1],.5),this.absorption=Mr(fc.default.absorption[0],fc.default.absorption[1],.5),this.cloudSize=Mr(fc.default.cloudSize[0],fc.default.cloudSize[1],.5),this.detailSize=Mr(fc.default.detailSize[0],fc.default.detailSize[1],.5),this.smoothness=Mr(fc.default.smoothness[0],fc.default.smoothness[1],.5),this.cloudHeight=Mr(fc.default.cloudHeight[0],fc.default.cloudHeight[1],.5),this.raymarchingSteps=fc.default.raymarchingSteps,this._viewMatrix=ht(),this._dirty=!1,this.running=!1}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===GS.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new d6e({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;ti(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let n=0,s=0;if(M(this.view.environment)&&this.view.environment.lighting.type!=="virtual"&&M(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),n=31*o.getUTCMonth()+o.getUTCDate(),s=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+n)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),OFe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){this._vao=Fc(this.context.renderContext.rctx);const e=ln(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(ar.CLOUDS_GENERATOR,this),xe(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Rr)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>us(e)),this._frameBufferCube=kt(this._frameBufferCube),this._techniques.length=0,this._vao=kt(this._vao),this._passParameters.noiseTexture=yt(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case ch.SIXTEEN:return 1;case ch.HUNDRED:return 4;case ch.COUNT:case ch.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(M(this._passParameters.noiseTexture))this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new C4({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return M(this._passParameters.noiseTexture.textureAtlas)}_ensureFrameBufferCube(e){if(k(this._frameBufferCube)){const r={target:cr.TEXTURE_CUBE_MAP,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:zt.LINEAR,hasMipmap:!1,width:e,height:e};this._frameBufferCube=new uo(this.context.renderContext.rctx,{colorTarget:Fs.CUBEMAP,width:e,height:e},r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=kt(this._frameBufferCube)}applyPreset(e,r){const i=e.median,n=s=>{const o=Mr(s[0],s[1],i);return r<.5?Mr(s[0],o,2*r):Mr(o,s[1],2*(r-.5))};this.coverage=n(e.coverage),this.density=n(e.density),this.absorption=n(e.absorption),this.cloudSize=n(e.cloudSize),this.detailSize=n(e.detailSize),this.smoothness=n(e.smoothness),this.cloudHeight=n(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){if(k(this._vao))return this._dirty=this.running=!1,this.context.renderContext.bindParameters.cloudsFade.renderingStage=oo.FINISHED_RENDERING,void e.madeProgress();this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),$a(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return rc.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=oo.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,n=i.bindTechnique(r,this._passParameters,this._bindParameters);i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao);const s=i.getViewport(),o=r.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;i.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);i.bindFramebuffer(c);const u=rTt[this._faceIndex],d=iTt[this._faceIndex];KIe(this._viewMatrix,nTt,u,d),Jf(this._drawParameters.viewMatrix,this._viewMatrix);const p=cr.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(p),n.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=oo.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),rc.YIELD}};h([f({constructOnly:!0})],Hu.prototype,"context",void 0),h([f({constructOnly:!0})],Hu.prototype,"view",void 0),h([f({constructOnly:!0})],Hu.prototype,"requestRender",void 0),h([f()],Hu.prototype,"coverage",void 0),h([f()],Hu.prototype,"density",void 0),h([f()],Hu.prototype,"absorption",void 0),h([f()],Hu.prototype,"cloudSize",void 0),h([f()],Hu.prototype,"detailSize",void 0),h([f()],Hu.prototype,"smoothness",void 0),h([f()],Hu.prototype,"cloudHeight",void 0),h([f()],Hu.prototype,"raymarchingSteps",void 0),h([f()],Hu.prototype,"running",void 0),Hu=h([Q("esri.views.3d.environment.CloudsGenerator")],Hu);const rTt=[sn(1,0,0),sn(-1,0,0),sn(0,1,0),sn(0,-1,0),sn(0,0,1)],iTt=[sn(0,1,0),sn(0,1,0),sn(0,0,-1),sn(0,0,1),sn(0,1,0)],nTt=nhe();let Ahe=class extends En{constructor(){super(...arguments),this.fogColor=G(),this.hazeColor=G(),this.fogStrength=4e-6,this.hazeStrength=4e-6,this.atmosphereC=1,this.fogAmount=0,this.hazeAmount=0}};function sTt(t){const e=new Ui;e.attributes.add(z.POSITION,"vec2"),e.include(TA,{textureCoordinateType:wo.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add([new fs("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new fs("inverseViewMatrix",(n,s)=>nP(oTt,s.camera.viewMatrix))]),r.code.add(D`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new ut("atmosphereC",n=>n.atmosphereC)),i.uniforms.add(new kr("cameraPosition",(n,s)=>s.camera.eye)),i.uniforms.add(new ji("nearFar",(n,s)=>s.camera.nearFar)),i.uniforms.add(new _r("depthTex",n=>n.depthTexture)),i.uniforms.add(new ut("fogStrength",n=>t.haze?n.hazeStrength:n.fogStrength)),i.uniforms.add(new ut("fogAmount",n=>t.haze?n.hazeAmount:n.fogAmount)),i.uniforms.add(new kr("fogColor",n=>t.haze?n.hazeColor:n.fogColor)),e.include(Oj),i.include(Tp),i.code.add(D`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(D`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(D`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${t.haze?D`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),e}const oTt=ht(),R6e=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:Ahe,build:sTt},Symbol.toStringTag,{value:"Module"}));let O6e=class P6e extends qi{initializeProgram(e){return new zi(e.rctx,P6e.shader.get().build(this.configuration),Di)}initializePipeline(){return this.configuration.haze?Pr({blending:Da(st.ONE,st.ZERO,st.ONE_MINUS_SRC_COLOR,st.ONE),colorWrite:Gr}):Pr({blending:Da(st.SRC_ALPHA,st.ZERO,st.ONE_MINUS_SRC_ALPHA,st.ONE),colorWrite:Gr})}};O6e.shader=new Bi(R6e,()=>be(()=>import("./FogHaze.glsl-58dd66d4.js"),[]));let yhe=class extends Nc{constructor(){super(...arguments),this.haze=!1}};h([ae()],yhe.prototype,"haze",void 0);const aTt=.95,lTt=1;let M4=class extends rt{constructor(e){super(e),this._passParameters=new Ahe;const r=e.context.renderContext.rctx;this._vao=Fc(r,gP),this._technique=e.context.techniqueRepository.acquire(O6e,new yhe);const i=ln(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+gL}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(wr.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;Ye(Y1e,i.eye);const n=Math.max(0,Qe(Y1e,e.bindParameters.lighting.mainLight.direction)),s=r.color;Oe(X1e,s,.1),Eo(this._passParameters.fogColor,X1e,s,n);const o=ct(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-GR(aTt*ff,lTt*ff,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};h([f({constructOnly:!0})],M4.prototype,"context",void 0),h([f({constructOnly:!0})],M4.prototype,"view",void 0),M4=h([Q("esri.views.3d.environment.Fog")],M4);let cTt=class{constructor(){this.color=G(),this.strength=0,this.amount=0}};const Y1e=G(),X1e=G();let Xa=class extends Nc{constructor(){super(...arguments),this.hasWebGL2Context=!1}};h([ae({constValue:!0})],Xa.prototype,"hasSliceHighlight",void 0),h([ae({constValue:!1})],Xa.prototype,"hasSliceInVertexProgram",void 0),h([ae({constValue:!1})],Xa.prototype,"instancedDoublePrecision",void 0),h([ae({constValue:!1})],Xa.prototype,"useLegacyTerrainShading",void 0),h([ae({constValue:!1})],Xa.prototype,"hasModelTransformation",void 0),h([ae({constValue:Sn.Pass})],Xa.prototype,"pbrTextureBindType",void 0),h([ae()],Xa.prototype,"hasWebGL2Context",void 0);var BA;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(BA||(BA={}));let _he=class extends Xa{constructor(){super(...arguments),this.geometry=BA.Cone}};h([ae({count:BA.COUNT})],_he.prototype,"geometry",void 0);var ne;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(ne||(ne={}));function KN(t){t.attributes.add(z.POSITION,"vec3"),t.vertex.code.add(D`vec3 positionModel() { return position; }`)}function Az({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(D`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(D`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let iy=class extends Ys{constructor(e,r){super(e,"mat3",Sn.Pass,(i,n,s)=>i.setUniformMatrix3fv(e,r(n,s)))}};function oR(t,e){t.include(KN);const r=t.vertex;r.include(Az,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add([new kr("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new kr("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new iy("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new fs("transformProjFromView",i=>i.transformProjFromView),new yL("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new yp("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new yp("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)]),r.code.add(D`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(D`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?D`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:D`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new kr("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(D`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(D`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let I6e=class extends En{constructor(){super(...arguments),this.transformWorldFromViewTH=G(),this.transformWorldFromViewTL=G(),this.transformViewFromCameraRelativeRS=Es(),this.transformProjFromView=ht()}},$6e=class extends En{constructor(){super(...arguments),this.transformWorldFromModelRS=Es(),this.transformWorldFromModelTH=cs(),this.transformWorldFromModelTL=cs()}};function N2(t){t.varyings.add("linearDepth","float")}function jS(t){t.vertex.uniforms.add(new ji("nearFar",(e,r)=>r.camera.nearFar))}function Lj(t){t.vertex.code.add(D`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function AP(t,e){const{vertex:r}=t;switch(e.output){case ne.Color:if(e.receiveShadows)return N2(t),void r.code.add(D`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case ne.Depth:case ne.Shadow:case ne.ShadowHighlight:case ne.ShadowExcludeHighlight:return t.include(oR,e),N2(t),jS(t),Lj(t),void r.code.add(D`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(D`void forwardLinearDepth() {}`)}function uh(t,e){if(Lj(t),e.hasModelTransformation)return t.vertex.code.add(D`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),void t.vertex.code.add(D`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.vertex.code.add(D`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(D`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let vhe=class extends En{constructor(){super(...arguments),this.texV=Ft(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new D6e}},D6e=class{constructor(){this.center=G(),this.v1=G(),this.v2=G()}};function uTt(t){const e=new Ui,{vertex:r,fragment:i}=e;if(x1(r),t.geometry===BA.Underground)e.attributes.add(z.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add([new kr("cameraPosition",(n,s)=>s.camera.eye),new ut("undergroundFadeAlpha",n=>n.undergroundFadeAlpha)]),r.code.add(D`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(D`void main() {
gl_FragColor = color;
}`);else{e.include(uh,t),e.attributes.add(z.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const n=t.geometry===BA.Cylinder;r.uniforms.add([new fs("proj",(a,l)=>l.camera.projectionMatrix),new fs("view",(a,l)=>l.camera.viewMatrix)]),n||(e.varyings.add("innerFactor","float"),r.uniforms.add(new kr("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new kr("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new kr("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new ji("texV",a=>a.texV)),r.uniforms.add(new ut("innerScale",a=>a.innerScale)));const s=6.2831853,o=1/128;r.code.add(D`
		void main(void) {
      ${n?D`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:D`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${D.float(s*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${D.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new _r("tex",a=>a.texture)),n||i.uniforms.add(new ut("altitudeFade",a=>a.altitudeFade)),i.code.add(D`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${n?D`gl_FragColor = atmosphereColor;`:D`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const hTt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:D6e,SimpleAtmospherePassParameters:vhe,build:uTt},Symbol.toStringTag,{value:"Module"}));let yz=class L6e extends qi{initializeProgram(e){return new zi(e.rctx,L6e.shader.get().build(this.configuration),Di)}initializePipeline(){return this.configuration.geometry===BA.Cylinder?Pr({blending:Da(st.SRC_ALPHA,st.ONE,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),culling:ehe,depthTest:{func:Qn.LEQUAL},colorWrite:Gr}):Pr({blending:Da(st.SRC_ALPHA,st.ONE,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qn.LEQUAL},colorWrite:Gr})}};yz.shader=new Bi(hTt,()=>be(()=>import("./SimpleAtmosphere.glsl-12556cc2.js"),[]));const N6e=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function wd(t,e=0){const r=t.stride;return t.fieldNames.filter(i=>{const n=t.fields.get(i).optional;return!(n&&n.glPadding)}).map(i=>{const n=t.fields.get(i),s=n.constructor.ElementCount,o=dTt(n.constructor.ElementType),a=n.offset,l=!(!n.optional||!n.optional.glNormalized);return new Rl(i,s,o,a,r,l,e)})}function dTt(t){const e=pTt[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const pTt={u8:Yt.UNSIGNED_BYTE,u16:Yt.UNSIGNED_SHORT,u32:Yt.UNSIGNED_INT,i8:Yt.BYTE,i16:Yt.SHORT,i32:Yt.INT,f32:Yt.FLOAT};let bhe=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;n===void 0&&(n=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<9;n++)r[n]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[i++]=r[n]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};bhe.ElementCount=9;let whe=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;n===void 0&&(n=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<16;n++)r[n]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[i++]=r[n]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};whe.ElementCount=16;let E1=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;n===void 0&&(n=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};E1.ElementCount=1;let C1=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;n===void 0&&(n=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,ti(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};C1.ElementCount=2;let M1=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;n===void 0&&(n=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,Le(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=n}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};M1.ElementCount=3;let R1=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;n===void 0&&(n=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,pn(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,n,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=n,this.typedBuffer[e]=s}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};R1.ElementCount=4;let xhe=class F6e extends E1{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}static fromTypedArray(e,r){return new F6e(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};xhe.ElementType="f32";let O1=class Iie extends C1{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Iie,e,r)}static fromTypedArray(e,r){return new Iie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};O1.ElementType="f32";let Wn=class $ie extends M1{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer($ie,e,r)}static fromTypedArray(e,r){return new $ie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Wn.ElementType="f32";let Ad=class Die extends R1{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Die,e,r)}static fromTypedArray(e,r){return new Die(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Ad.ElementType="f32";let F2=class Lie extends bhe{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Lie,e,r)}static fromTypedArray(e,r){return new Lie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};F2.ElementType="f32";let The=class Nie extends bhe{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Nie,e,r)}static fromTypedArray(e,r){return new Nie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};The.ElementType="f64";let She=class Fie extends whe{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Fie,e,r)}static fromTypedArray(e,r){return new Fie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};She.ElementType="f32";let vL=class kie extends whe{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(kie,e,r)}static fromTypedArray(e,r){return new kie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};vL.ElementType="f64";let Ehe=class Uie extends E1{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Uie,e,r)}static fromTypedArray(e,r){return new Uie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Ehe.ElementType="f64";let Che=class Bie extends C1{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Bie,e,r)}static fromTypedArray(e,r){return new Bie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Che.ElementType="f64";let Pc=class zie extends M1{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(zie,e,r)}static fromTypedArray(e,r){return new zie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Pc.ElementType="f64";let Nj=class Vie extends R1{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Vie,e,r)}static fromTypedArray(e,r){return new Vie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Nj.ElementType="f64";let AO=class Gie extends E1{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Gie,e,r)}static fromTypedArray(e,r){return new Gie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};AO.ElementType="u8";let Fj=class jie extends C1{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(jie,e,r)}static fromTypedArray(e,r){return new jie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Fj.ElementType="u8";let bL=class Hie extends M1{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Hie,e,r)}static fromTypedArray(e,r){return new Hie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};bL.ElementType="u8";let Ic=class qie extends R1{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(qie,e,r)}static fromTypedArray(e,r){return new qie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Ic.ElementType="u8";let kj=class Wie extends E1{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Wie,e,r)}static fromTypedArray(e,r){return new Wie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};kj.ElementType="u16";let Mhe=class Qie extends C1{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Qie,e,r)}static fromTypedArray(e,r){return new Qie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Mhe.ElementType="u16";let Uj=class Yie extends M1{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Yie,e,r)}static fromTypedArray(e,r){return new Yie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Uj.ElementType="u16";let eF=class Xie extends R1{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Xie,e,r)}static fromTypedArray(e,r){return new Xie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};eF.ElementType="u16";let Bj=class Zie extends E1{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Zie,e,r)}static fromTypedArray(e,r){return new Zie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Bj.ElementType="u32";let Rhe=class Jie extends C1{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Jie,e,r)}static fromTypedArray(e,r){return new Jie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Rhe.ElementType="u32";let k6e=class Kie extends M1{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Kie,e,r)}static fromTypedArray(e,r){return new Kie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};k6e.ElementType="u32";let U6e=class ene extends R1{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(ene,e,r)}static fromTypedArray(e,r){return new ene(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};U6e.ElementType="u32";let Ohe=class tne extends E1{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(tne,e,r)}static fromTypedArray(e,r){return new tne(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Ohe.ElementType="i8";let zj=class rne extends C1{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(rne,e,r)}static fromTypedArray(e,r){return new rne(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};zj.ElementType="i8";let B6e=class ine extends M1{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(ine,e,r)}static fromTypedArray(e,r){return new ine(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};B6e.ElementType="i8";let z6e=class nne extends R1{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(nne,e,r)}static fromTypedArray(e,r){return new nne(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};z6e.ElementType="i8";let V6e=class sne extends E1{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(sne,e,r)}static fromTypedArray(e,r){return new sne(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};V6e.ElementType="i16";let Vj=class one extends C1{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(one,e,r)}static fromTypedArray(e,r){return new one(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Vj.ElementType="i16";let G6e=class ane extends M1{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(ane,e,r)}static fromTypedArray(e,r){return new ane(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};G6e.ElementType="i16";let j6e=class lne extends R1{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(lne,e,r)}static fromTypedArray(e,r){return new lne(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};j6e.ElementType="i16";let H6e=class cne extends E1{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(cne,e,r)}static fromTypedArray(e,r){return new cne(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};H6e.ElementType="i32";let q6e=class une extends C1{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(une,e,r)}static fromTypedArray(e,r){return new une(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};q6e.ElementType="i32";let W6e=class hne extends M1{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(hne,e,r)}static fromTypedArray(e,r){return new hne(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};W6e.ElementType="i32";let Q6e=class dne extends R1{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(dne,e,r)}static fromTypedArray(e,r){return new dne(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Q6e.ElementType="i32";function Y6e(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}function fTt(t){switch(t){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0}}function mTt(t){switch(t){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1}}function gTt(t){switch(t){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303}}let Z1e=class X6e{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fieldNames){const n=e.fields.get(i);this[i]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new X6e(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r,i,n){const s=this.stride;if(s%4==0){const o=new Uint32Array(e.buffer,r*s,n*s/4);new Uint32Array(this.buffer,i*s,n*s/4).set(o)}else{const o=new Uint8Array(e.buffer,r*s,n*s);new Uint8Array(this.buffer,i*s,n*s).set(o)}}},ATt=class Z6e{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,r){return this._appendField(e,O1,r),this}vec2f64(e,r){return this._appendField(e,Che,r),this}vec3f(e,r){return this._appendField(e,Wn,r),this}vec3f64(e,r){return this._appendField(e,Pc,r),this}vec4f(e,r){return this._appendField(e,Ad,r),this}vec4f64(e,r){return this._appendField(e,Nj,r),this}mat3f(e,r){return this._appendField(e,F2,r),this}mat3f64(e,r){return this._appendField(e,The,r),this}mat4f(e,r){return this._appendField(e,She,r),this}mat4f64(e,r){return this._appendField(e,vL,r),this}vec4u8(e,r){return this._appendField(e,Ic,r),this}f32(e,r){return this._appendField(e,xhe,r),this}f64(e,r){return this._appendField(e,Ehe,r),this}u8(e,r){return this._appendField(e,AO,r),this}u16(e,r){return this._appendField(e,kj,r),this}i8(e,r){return this._appendField(e,Ohe,r),this}vec2i8(e,r){return this._appendField(e,zj,r),this}vec2i16(e,r){return this._appendField(e,Vj,r),this}vec2u8(e,r){return this._appendField(e,Fj,r),this}vec4u16(e,r){return this._appendField(e,eF,r),this}u32(e,r){return this._appendField(e,Bj,r),this}_appendField(e,r,i){const n=r.ElementCount*Y6e(r.ElementType),s=this.stride;this.fields.set(e,{size:n,constructor:r,offset:s,optional:i}),this.stride+=n,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.includes(e)}createBuffer(e){return new Z1e(this,e)}createView(e){return new Z1e(this,e)}clone(){const e=new Z6e;return e.stride=this.stride,e.fields=new Map,this.fields.forEach((r,i)=>e.fields.set(i,r)),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}};function Cs(){return new ATt}let Pt=class{constructor(e,r,i=!1,n=r){this.data=e,this.size=r,this.exclusive=i,this.stride=n}};var pne;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function r(o,a){const l=o[a],c=o[a+1],u=o[a+2],d=1/Math.sqrt(l*l+c*c+u*u);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function n(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]+l[c],u[d+1]=o[a+1]+l[c+1],u[d+2]=o[a+2]+l[c+2]}function s(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]-l[c],u[d+1]=o[a+1]-l[c+1],u[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=n,t.subtract=s})(pne||(pne={}));var lo;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(lo||(lo={}));function yd(t,e=!1){return t<=OA?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function yTt(t){return length<=OA?Array.from(t):new Float64Array(t)}function Ff(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function xo(t,e=!1){return t<=OA?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function J1e(t){return length<=OA?Array.from(t):new Float32Array(t)}function K1e(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function _Tt(t){if(t.length<OA)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return Uint16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}const Yc=Kr();let vTt=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function tr(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new vTt(`${e} at ${r}`)}}function ZE(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function eve(t,e,r,i){let n,s=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],u=(i[2]-t[2])/e[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>o)&&(u<o&&(o=u),!(o<0))}function o8(t,e,r,i,n,s=Ft()){const o=(i[n]-r[n])*(e[0]-t[0])-(i[0]-r[0])*(e[n]-t[n]),a=(i[0]-r[0])*(t[n]-r[n])-(i[n]-r[n])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return s[0]=t[0]+l*(e[0]-t[0]),s[1]=t[n]+l*(e[n]-t[n]),!0}function tve(t,e,r,i,n){Yc[0]=t[0],Yc[1]=t[1],Yc[2]=t[2],Yc[3]=1,cp(Yc,Yc,e),n.length>2&&(n[2]=-Yc[2]),cp(Yc,Yc,r),tr(Yc[3]!==0),n[0]=Yc[0]/Yc[3],n[1]=Yc[1]/Yc[3],n[2]=Yc[2]/Yc[3],n[0]=(.5*n[0]+.5)*i[2]+i[0],n[1]=(.5*n[1]+.5)*i[3]+i[1]}function bTt(t,e){return Math.log(t)/Math.log(e)}function wTt(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function J6e(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}let K6e=class e8e{constructor(e,r,i,n){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.indices=i,this.position=n,this._children=void 0,tr(e.length>=1),tr(i.length%this._numIndexPerPrimitive==0),tr(i.length>=e.length*this._numIndexPerPrimitive),tr(n.size===3||n.size===4);const{data:s,size:o}=n,a=e.length;let l=o*i[this._numIndexPerPrimitive*e[0]];Pw.clear(),Pw.push(l);const c=pt(s[l],s[l+1],s[l+2]),u=Gs(c);for(let A=0;A<a;++A){const v=this._numIndexPerPrimitive*e[A];for(let b=0;b<this._numIndexPerPrimitive;++b){l=o*i[v+b],Pw.push(l);let S=s[l];c[0]=Math.min(S,c[0]),u[0]=Math.max(S,u[0]),S=s[l+1],c[1]=Math.min(S,c[1]),u[1]=Math.max(S,u[1]),S=s[l+2],c[2]=Math.min(S,c[2]),u[2]=Math.max(S,u[2])}}this.bbMin=c,this.bbMax=u;const d=Eo(G(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let p=this.radius*this.radius;for(let A=0;A<Pw.length;++A){l=Pw.getItemAt(A);const v=s[l]-d[0],b=s[l+1]-d[1],S=s[l+2]-d[2],E=v*v+b*b+S*S;if(E<=p)continue;const R=Math.sqrt(E),O=.5*(R-this.radius);this.radius=this.radius+O,p=this.radius*this.radius;const I=O/R;d[0]+=v*I,d[1]+=b*I,d[2]+=S*I}this.center=d,Pw.clear()}getChildren(){if(this._children||Cl(this.bbMin,this.bbMax)<=1)return this._children;const e=Eo(G(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),n=new Array(8);for(let c=0;c<8;++c)n[c]=0;const{data:s,size:o}=this.position;for(let c=0;c<r;++c){let u=0;const d=this._numIndexPerPrimitive*this.primitiveIndices[c];let p=o*this.indices[d],A=s[p],v=s[p+1],b=s[p+2];for(let S=1;S<this._numIndexPerPrimitive;++S){p=o*this.indices[d+S];const E=s[p],R=s[p+1],O=s[p+2];E<A&&(A=E),R<v&&(v=R),O<b&&(b=O)}A<e[0]&&(u|=1),v<e[1]&&(u|=2),b<e[2]&&(u|=4),i[c]=u,++n[u]}let a=0;for(let c=0;c<8;++c)n[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=n[c]>0?new Uint32Array(n[c]):void 0;for(let c=0;c<8;++c)n[c]=0;for(let c=0;c<r;++c){const u=i[c];l[u][n[u]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new e8e(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){Pw.prune()}};const Pw=new Vr({deallocator:null});let tF=class{constructor(){this.id=hd()}unload(){}};function xTt(t){return t?{p0:Gs(t.p0),p1:Gs(t.p1),p2:Gs(t.p2)}:{p0:G(),p1:G(),p2:G()}}function rve(t,e,r){const i=e[0]-t[0],n=e[1]-t[1],s=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-n*s)}function TTt(t,e,r){return Ve(XQ,e,t),Ve(ive,r,t),ct(Kt(XQ,XQ,ive))/2}new v1(Gm);new v1(()=>xTt());const XQ=G(),ive=G();function STt(t,e,r){if(!t||!e)return!1;const{size:i,data:n}=t;Le(r,0,0,0),Le(uf,0,0,0);let s=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a+0]*i,c=e[a+1]*i,u=e[a+2]*i;Le(Qa,n[l+0],n[l+1],n[l+2]),Le(x_,n[c+0],n[c+1],n[c+2]),Le(a8,n[u+0],n[u+1],n[u+2]);const d=TTt(Qa,x_,a8);d?(ze(Qa,Qa,x_),ze(Qa,Qa,a8),Oe(Qa,Qa,1/3*d),ze(r,r,Qa),s+=d):(ze(uf,uf,Qa),ze(uf,uf,x_),ze(uf,uf,a8),o+=3)}return(o!==0||s!==0)&&(s!==0?(Oe(r,r,1/s),!0):o!==0&&(Oe(r,uf,1/o),!0))}function ETt(t,e,r){if(!t||!e)return!1;const{size:i,data:n}=t;Le(r,0,0,0);let s=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*i;s!==l&&(r[0]+=n[l+0],r[1]+=n[l+1],r[2]+=n[l+2],o++),s=l}return o>1&&Oe(r,r,1/o),o>0}function CTt(t,e,r,i){if(!t)return!1;Le(i,0,0,0),Le(uf,0,0,0);let n=0,s=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(r?2:0);for(let u=0;u<c;u+=2){const d=u<l?u:l,p=u<l?u+1:0,A=(e?e[d]:d)*o,v=(e?e[p]:p)*o;Qa[0]=a[A],Qa[1]=a[A+1],Qa[2]=a[A+2],x_[0]=a[v],x_[1]=a[v+1],x_[2]=a[v+2],Oe(Qa,ze(Qa,Qa,x_),.5);const b=EN(Qa,x_);b>0?(ze(i,i,Oe(Qa,Qa,b)),n+=b):n===0&&(ze(uf,uf,Qa),s++)}return n!==0?(Oe(i,i,1/n),!0):s!==0&&(Oe(i,uf,1/s),!0)}const Qa=G(),x_=G(),a8=G(),uf=G();function aR(t){if(Array.isArray(t)){if(t.length<OA)return t;for(const e of t)if(e>=65536)return new Uint32Array(t);return new Uint16Array(t)}if(t.length<OA)return Array.from(t);if(t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return t;for(const e of t)if(e>=65536)return t;return new Uint16Array(t)}function t8e(t){const e=3*t;return e<=OA?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}let Ab=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const r8e=[0],lR=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function yO(t){if(t===1)return r8e;if(t<OA)return Array.from(new Uint16Array(lR.buffer,0,t));if(t<lR.length)return new Uint16Array(lR.buffer,0,t);if(t>Ab.length){const e=Math.max(2*Ab.length,t);Ab=new Uint32Array(e);for(let r=0;r<Ab.length;r++)Ab[r]=r}return new Uint32Array(Ab.buffer,0,t)}function Qhr(t){if(t===1)return r8e;if(t<OA)return Array.from(new Uint16Array(lR.buffer,0,t));if(t<lR.length)return new Uint16Array(lR.slice(0,t));if(t>Ab.length){const e=new Uint32Array(t);for(let r=0;r<e.length;r++)e[r]=r;return e}return new Uint32Array(Ab.slice(0,t))}let _z=class{constructor(e){this.channel=e,this.id=hd()}};function fne(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function MTt(t,e){const r=t.length;for(let i=0;i<r;++i)EM[0]=t[i],e[i]=EM[0];return e}function RTt(t,e){const r=t.length;for(let i=0;i<r;++i)EM[0]=t[i],EM[1]=t[i]-EM[0],e[i]=EM[1];return e}const EM=new Float32Array(2);function mne(t,e){return k(t)&&(t=[]),t.push(e),t}function gne(t,e){if(k(t))return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function OTt(t,e,r,i,n){l8[0]=t.get(e,0),l8[1]=t.get(e,1),l8[2]=t.get(e,2),fne(l8,Iw,3),r.set(n,0,Iw[0]),i.set(n,0,Iw[1]),r.set(n,1,Iw[2]),i.set(n,1,Iw[3]),r.set(n,2,Iw[4]),i.set(n,2,Iw[5])}const l8=G(),Iw=new Float32Array(6);let zo=class i8e extends tF{constructor(e,r,i=[],n=null,s=lo.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=n,this.type=s,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=PTt(this._vertexAttributes),c=yO(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const u of this._vertexAttributes.keys())this._indices.set(u,c)}else for(const[l,c]of i)c&&(this._indices.set(l,aR(c)),l===z.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const r=new i8e(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,n)=>{i.exclusive=!1,r._vertexAttributes.set(n,i)}),this._indices.forEach((i,n)=>r._indices.set(n,i)),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let r=this._vertexAttributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:_Tt(r.data)},this._vertexAttributes.set(e,r)),r}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return k(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===lo.Mesh?this._computeAttachmentOriginTriangles(e):this.type===lo.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(M(this._transformation)&&Ot(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.indices.get(z.POSITION),i=this.vertexAttributes.get(z.POSITION);return STt(i,r,e)}_computeAttachmentOriginLines(e){const r=this.vertexAttributes.get(z.POSITION),i=this.indices.get(z.POSITION);return CTt(r,i,i&&ITt(this.material.parameters,r,i),e)}_computeAttachmentOriginPoints(e){const r=this.indices.get(z.POSITION),i=this.vertexAttributes.get(z.POSITION);return ETt(i,r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(z.POSITION),r=this.vertexAttributes.get(z.POSITION);if(!e||e.length===0||!r)return null;const i=this.type===lo.Mesh?3:1;tr(e.length%i==0,"Indexing error: "+e.length+" not divisible by "+i);const n=yO(e.length/i);return new K6e(n,i,e,r)}get transformation(){return br(this._transformation,wp)}set transformation(e){this._transformation=e&&e!==wp?eO(e):null}get shaderTransformation(){return M(this._shaderTransformer)?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return M(this._shaderTransformer)}addHighlight(){const e=new _z(l1.Highlight);return this.highlights=mne(this.highlights,e),e}removeHighlight(e){this.highlights=gne(this.highlights,e)}};function PTt(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function ITt(t,e,r){return!(!("isClosed"in t)||!t.isClosed)&&(r?r.length>2:e.data.length>6)}const JE=pne,ZQ=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],$Tt=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],DTt=[0,0,1,0,1,1,0,1],LTt=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],n8e=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)n8e[6*t+e]=t;const Yx=new Array(36);for(let t=0;t<6;t++)Yx[6*t+0]=0,Yx[6*t+1]=1,Yx[6*t+2]=2,Yx[6*t+3]=2,Yx[6*t+4]=3,Yx[6*t+5]=0;function NTt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=ZQ[i][0]*e[0],r[3*i+1]=ZQ[i][1]*e[1],r[3*i+2]=ZQ[i][2]*e[2];return new zo(t,[[z.POSITION,new Pt(r,3,!0)],[z.NORMAL,new Pt($Tt,3)],[z.UV0,new Pt(DTt,2)]],[[z.POSITION,LTt],[z.NORMAL,n8e],[z.UV0,Yx]])}const JQ=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],FTt=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],kTt=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],UTt=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function BTt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=JQ[i][0]*e[0],r[3*i+1]=JQ[i][1]*e[1],r[3*i+2]=JQ[i][2]*e[2];return new zo(t,[[z.POSITION,new Pt(r,3,!0)],[z.NORMAL,new Pt(FTt,3)]],[[z.POSITION,kTt],[z.NORMAL,UTt]])}const qk=sn(-.5,0,-.5),Wk=sn(.5,0,-.5),Qk=sn(0,0,.5),Yk=sn(0,.5,0),KE=cs(),e3=cs(),cR=cs(),uR=cs(),hR=cs();Ve(KE,qk,Yk),Ve(e3,qk,Wk),Kt(cR,KE,e3),Ye(cR,cR),Ve(KE,Wk,Yk),Ve(e3,Wk,Qk),Kt(uR,KE,e3),Ye(uR,uR),Ve(KE,Qk,Yk),Ve(e3,Qk,qk),Kt(hR,KE,e3),Ye(hR,hR);const KQ=[qk,Wk,Qk,Yk],zTt=[0,-1,0,cR[0],cR[1],cR[2],uR[0],uR[1],uR[2],hR[0],hR[1],hR[2]],VTt=[0,1,2,3,1,0,3,2,1,3,0,2],GTt=[0,0,0,1,1,1,2,2,2,3,3,3];function jTt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=KQ[i][0]*e[0],r[3*i+1]=KQ[i][1]*e[1],r[3*i+2]=KQ[i][2]*e[2];return new zo(t,[[z.POSITION,new Pt(r,3,!0)],[z.NORMAL,new Pt(zTt,3)]],[[z.POSITION,VTt],[z.NORMAL,GTt]])}function Xhr(t,e,r,i,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),u=Math.max(2,Math.floor(i)),d=(c+1)*(u+1),p=xo(3*d),A=xo(3*d),v=xo(2*d),b=[];let S=0;for(let I=0;I<=u;I++){const N=[],L=I/u,B=a+L*l,U=Math.cos(B);for(let q=0;q<=c;q++){const Z=q/c,X=s+Z*o,ee=Math.cos(X)*U,se=Math.sin(B),ue=-Math.sin(X)*U;p[3*S]=ee*e,p[3*S+1]=se*e,p[3*S+2]=ue*e,A[3*S]=ee,A[3*S+1]=se,A[3*S+2]=ue,v[2*S]=Z,v[2*S+1]=L,N.push(S),++S}b.push(N)}const E=new Array;for(let I=0;I<u;I++)for(let N=0;N<c;N++){const L=b[I][N],B=b[I][N+1],U=b[I+1][N+1],q=b[I+1][N];I===0?(E.push(L),E.push(U),E.push(q)):I===u-1?(E.push(L),E.push(B),E.push(U)):(E.push(L),E.push(B),E.push(U),E.push(U),E.push(q),E.push(L))}const R=[[z.POSITION,E],[z.NORMAL,E]],O=[[z.POSITION,new Pt(p,3,!0)],[z.NORMAL,new Pt(A,3,!0)]];return n.uv&&(O.push([z.UV0,new Pt(v,2,!0)]),R.push([z.UV0,E])),n.offset&&(R[0][0]=z.OFFSET,O[0][0]=z.OFFSET,R.push([z.POSITION,new Array(E.length).fill(0)]),O.push([z.POSITION,new Pt(Float64Array.from(n.offset),3,!0)])),new zo(t,O,R)}function HTt(t,e,r,i){const{vertexAttributes:n,indices:s}=s8e(e,r,i);return new zo(t,n,s)}function s8e(t,e,r){const i=t;let n,s;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const u=i*(1+Math.sqrt(5))/2;n=[-i,u,0,i,u,0,-i,-u,0,i,-u,0,0,-i,u,0,i,u,0,-i,-u,0,i,-u,u,0,-i,u,0,i,-u,0,-i,-u,0,i],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let u=0;u<n.length;u+=3)JE.scale(n,u,t/JE.length(n,u));let o={};function a(u,d){u>d&&([u,d]=[d,u]);const p=u.toString()+"."+d.toString();if(o[p])return o[p];let A=n.length;return n.length+=3,JE.add(n,3*u,n,3*d,n,A),JE.scale(n,A,t/JE.length(n,A)),A/=3,o[p]=A,A}for(let u=0;u<e;u++){const d=s.length,p=new Array(4*d);for(let A=0;A<d;A+=3){const v=s[A],b=s[A+1],S=s[A+2],E=a(v,b),R=a(b,S),O=a(S,v),I=4*A;p[I]=v,p[I+1]=E,p[I+2]=O,p[I+3]=b,p[I+4]=R,p[I+5]=E,p[I+6]=S,p[I+7]=O,p[I+8]=R,p[I+9]=E,p[I+10]=R,p[I+11]=O}s=p,o={}}const l=J1e(n);for(let u=0;u<l.length;u+=3)JE.normalize(l,u);const c=[[z.POSITION,s],[z.NORMAL,s]];return{vertexAttributes:[[z.POSITION,new Pt(J1e(n),3,!0)],[z.NORMAL,new Pt(l,3,!0)]],indices:c}}function Ane(t,e,r,i,n,s,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],u=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const d=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],p=M(n)&&n.length===2?n:[1,1],A=[[z.POSITION,new Pt(c,3,!0)],[z.NORMAL,new Pt(u,3,!0)],[z.UV0,new Pt(o,o.length)],[z.COLOR,new Pt(d,4,!0)],[z.SIZE,new Pt(p,2)]];if(s!=null){const v=[s[0],s[1],s[2],s[3]];A.push([z.AUXPOS1,new Pt(v,4)])}if(a!=null){const v=[a[0],a[1],a[2],a[3]];A.push([z.AUXPOS2,new Pt(v,4)])}return new zo(t,A,null,null,lo.Point,l)}const qTt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function Zhr(t,e=qTt){const r=new Array(12);for(let u=0;u<4;u++)for(let d=0;d<3;d++)r[3*u+d]=e[u][d];const i=[0,1,2,2,3,0],n=[0,0,1],s=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[z.POSITION,i],[z.NORMAL,s],[z.UV0,i],[z.COLOR,s]],c=[[z.POSITION,new Pt(r,3,!0)],[z.NORMAL,new Pt(n,3,!0)],[z.UV0,new Pt(o,2,!0)],[z.COLOR,new Pt(a,4,!0)]];return new zo(t,c,l)}function nve(t,e,r,i,n,s=!0,o=!0){let a=0;const l=r,c=e;let u=sn(0,a,0),d=sn(0,a+c,0),p=sn(0,-1,0),A=sn(0,1,0);n&&(a=c,d=sn(0,0,0),u=sn(0,a,0),p=sn(0,1,0),A=sn(0,-1,0));const v=[d,u],b=[p,A],S=i+2,E=Math.sqrt(c*c+l*l);if(n)for(let U=i-1;U>=0;U--){const q=U*(2*Math.PI/i),Z=sn(Math.cos(q)*l,a,Math.sin(q)*l);v.push(Z);const X=sn(c*Math.cos(q)/E,-l/E,c*Math.sin(q)/E);b.push(X)}else for(let U=0;U<i;U++){const q=U*(2*Math.PI/i),Z=sn(Math.cos(q)*l,a,Math.sin(q)*l);v.push(Z);const X=sn(c*Math.cos(q)/E,l/E,c*Math.sin(q)/E);b.push(X)}const R=new Array,O=new Array;if(s){for(let U=3;U<v.length;U++)R.push(1),R.push(U-1),R.push(U),O.push(0),O.push(0),O.push(0);R.push(v.length-1),R.push(2),R.push(1),O.push(0),O.push(0),O.push(0)}if(o){for(let U=3;U<v.length;U++)R.push(U),R.push(U-1),R.push(0),O.push(U),O.push(U-1),O.push(1);R.push(0),R.push(2),R.push(v.length-1),O.push(1),O.push(2),O.push(b.length-1)}const I=xo(3*S);for(let U=0;U<S;U++)I[3*U]=v[U][0],I[3*U+1]=v[U][1],I[3*U+2]=v[U][2];const N=xo(3*S);for(let U=0;U<S;U++)N[3*U]=b[U][0],N[3*U+1]=b[U][1],N[3*U+2]=b[U][2];const L=[[z.POSITION,R],[z.NORMAL,O]],B=[[z.POSITION,new Pt(I,3,!0)],[z.NORMAL,new Pt(N,3,!0)]];return new zo(t,B,L)}function WTt(t,e,r,i,n,s,o){const a=n?pz(n):sn(1,0,0),l=s?pz(s):sn(0,0,0);o=o??!0;const c=cs();Ye(c,a);const u=cs();Oe(u,c,Math.abs(e));const d=cs();Oe(d,u,-.5),ze(d,d,l);const p=sn(0,1,0);Math.abs(1-Qe(c,p))<.2&&Le(p,0,0,1);const A=cs();Kt(A,c,p),Ye(A,A),Kt(p,A,c);const v=2*i+(o?2:0),b=i+(o?2:0),S=xo(3*v),E=xo(3*b),R=xo(2*v),O=new Array(3*i*(o?4:2)),I=new Array(3*i*(o?4:2));o&&(S[3*(v-2)+0]=d[0],S[3*(v-2)+1]=d[1],S[3*(v-2)+2]=d[2],R[2*(v-2)]=0,R[2*(v-2)+1]=0,S[3*(v-1)+0]=S[3*(v-2)+0]+u[0],S[3*(v-1)+1]=S[3*(v-2)+1]+u[1],S[3*(v-1)+2]=S[3*(v-2)+2]+u[2],R[2*(v-1)]=1,R[2*(v-1)+1]=1,E[3*(b-2)+0]=-c[0],E[3*(b-2)+1]=-c[1],E[3*(b-2)+2]=-c[2],E[3*(b-1)+0]=c[0],E[3*(b-1)+1]=c[1],E[3*(b-1)+2]=c[2]);const N=(X,ee,se)=>{O[X]=ee,I[X]=se};let L=0;const B=cs(),U=cs();for(let X=0;X<i;X++){const ee=X*(2*Math.PI/i);Oe(B,p,Math.sin(ee)),Oe(U,A,Math.cos(ee)),ze(B,B,U),E[3*X+0]=B[0],E[3*X+1]=B[1],E[3*X+2]=B[2],Oe(B,B,r),ze(B,B,d),S[3*X+0]=B[0],S[3*X+1]=B[1],S[3*X+2]=B[2],R[2*X+0]=X/i,R[2*X+1]=0,S[3*(X+i)+0]=S[3*X+0]+u[0],S[3*(X+i)+1]=S[3*X+1]+u[1],S[3*(X+i)+2]=S[3*X+2]+u[2],R[2*(X+i)+0]=X/i,R[2*X+1]=1;const se=(X+1)%i;N(L++,X,X),N(L++,X+i,X),N(L++,se,se),N(L++,se,se),N(L++,X+i,X),N(L++,se+i,se)}if(o){for(let X=0;X<i;X++){const ee=(X+1)%i;N(L++,v-2,b-2),N(L++,X,b-2),N(L++,ee,b-2)}for(let X=0;X<i;X++){const ee=(X+1)%i;N(L++,X+i,b-1),N(L++,v-1,b-1),N(L++,ee+i,b-1)}}const q=[[z.POSITION,O],[z.NORMAL,I],[z.UV0,O]],Z=[[z.POSITION,new Pt(S,3,!0)],[z.NORMAL,new Pt(E,3,!0)],[z.UV0,new Pt(R,2,!0)]];return new zo(t,Z,q)}function Jhr(t,e,r,i,n,s,o=sn(0,0,0)){const a=e.length,l=xo(r.length*a*3+(6*i.length||0)),c=xo(r.length*a*3+(i?6:0)),u=new Array,d=new Array;let p=0,A=0;const v=cs(),b=cs(),S=cs(),E=cs(),R=cs(),O=cs(),I=cs(),N=G(),L=cs(),B=cs(),U=cs(),q=cs(),Z=cs(),X=Xi();Le(L,0,1,0),Ve(b,r[1],r[0]),Ye(b,b),s?(ze(N,r[0],o),Ye(S,N)):Le(S,0,0,1),vz(b,S,L,L,R,S,sve),Pe(E,S),Pe(q,R);for(let W=0;W<i.length;W++)Oe(O,R,i[W][0]),Oe(N,S,i[W][2]),ze(O,O,N),ze(O,O,r[0]),l[p++]=O[0],l[p++]=O[1],l[p++]=O[2];c[A++]=-b[0],c[A++]=-b[1],c[A++]=-b[2];for(let W=0;W<n.length;W++)u.push(n[W][0]>0?n[W][0]:-n[W][0]-1+i.length),u.push(n[W][1]>0?n[W][1]:-n[W][1]-1+i.length),u.push(n[W][2]>0?n[W][2]:-n[W][2]-1+i.length),d.push(0),d.push(0),d.push(0);let ee=i.length;const se=i.length-1;for(let W=0;W<r.length;W++){let oe=!1;W>0&&(Pe(v,b),W<r.length-1?(Ve(b,r[W+1],r[W]),Ye(b,b)):oe=!0,ze(B,v,b),Ye(B,B),ze(U,r[W-1],E),LN(r[W],B,X),bE(X,xp(U,v),N)?(Ve(N,N,r[W]),Ye(S,N),Kt(R,B,S),Ye(R,R)):vz(B,E,q,L,R,S,sve),Pe(E,S),Pe(q,R)),s&&(ze(N,r[W],o),Ye(Z,N));for(let le=0;le<a;le++)if(Oe(O,R,e[le][0]),Oe(N,S,e[le][1]),ze(O,O,N),Ye(I,O),c[A++]=I[0],c[A++]=I[1],c[A++]=I[2],ze(O,O,r[W]),l[p++]=O[0],l[p++]=O[1],l[p++]=O[2],!oe){const fe=(le+1)%a;u.push(ee+le),u.push(ee+a+le),u.push(ee+fe),u.push(ee+fe),u.push(ee+a+le),u.push(ee+a+fe);for(let de=0;de<6;de++){const Ee=u.length-6;d.push(u[Ee+de]-se)}}ee+=a}const ue=r[r.length-1];for(let W=0;W<i.length;W++)Oe(O,R,i[W][0]),Oe(N,S,i[W][1]),ze(O,O,N),ze(O,O,ue),l[p++]=O[0],l[p++]=O[1],l[p++]=O[2];const re=A/3;c[A++]=b[0],c[A++]=b[1],c[A++]=b[2];const te=ee-a;for(let W=0;W<n.length;W++)u.push(n[W][0]>=0?ee+n[W][0]:-n[W][0]-1+te),u.push(n[W][2]>=0?ee+n[W][2]:-n[W][2]-1+te),u.push(n[W][1]>=0?ee+n[W][1]:-n[W][1]-1+te),d.push(re),d.push(re),d.push(re);const j=[[z.POSITION,u],[z.NORMAL,d]],H=[[z.POSITION,new Pt(l,3,!0)],[z.NORMAL,new Pt(c,3,!0)]];return new zo(t,H,j)}function Khr(t,e,r,i){tr(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),tr(e[0].length===3,"createPolylineGeometry(): malformed vertex"),tr(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),tr(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const n=yd(3*e.length),s=new Array(2*(e.length-1));let o=0,a=0;for(let u=0;u<e.length;u++){for(let d=0;d<3;d++)n[o++]=e[u][d];u>0&&(s[a++]=u-1,s[a++]=u)}const l=[],c=[];if(l.push([z.POSITION,s]),c.push([z.POSITION,new Pt(n,3,!0)]),r){const u=xo(3*r.length);let d=0;for(let p=0;p<e.length;p++)for(let A=0;A<3;A++)u[d++]=r[p][A];l.push([z.NORMAL,s]),c.push([z.NORMAL,new Pt(u,3,!0)])}return i&&(c.push([z.COLOR,new Pt(i,4)]),l.push([z.COLOR,yO(i.length/4)])),new zo(t,c,l,null,lo.Line)}function QTt(t,e=t){const r=t.vertexAttributes,i=r.get(z.POSITION).data,n=r.get(z.NORMAL).data;if(n){const s=e.getMutableAttribute(z.NORMAL).data;for(let o=0;o<n.length;o+=3){const a=n[o+1];s[o+1]=-n[o+2],s[o+2]=a}}if(i){const s=e.getMutableAttribute(z.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];s[o+1]=-i[o+2],s[o+2]=a}}}function eY(t,e,r,i,n){return!(Math.abs(Qe(e,t))>n)&&(Kt(r,t,e),Ye(r,r),Kt(i,r,t),Ye(i,i),!0)}function vz(t,e,r,i,n,s,o){return eY(t,e,n,s,o)||eY(t,r,n,s,o)||eY(t,i,n,s,o)}const sve=.99619469809;let YTt=class{constructor(e,r){this.type=va.Panoramic,this._configuration=new _he,this._passParameters=new vhe,this._configuration.geometry=BA.Cylinder,this._technique=r.techniqueRepository.acquire(yz,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=Xl(this._vao,"geometry"),this._passParameters.texture=new Xt(i,{pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:zt.LINEAR,flipped:!0,width:1,height:512},N6e)}destroy(){this._passParameters.texture=kt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);XTt(ove,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",ove),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(wr.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=s8e(1,2,!1),i=r.indices[0][1],n=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const s=n.data,o=ave.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,s[c]),a.set(l,1,s[c+1]),a.set(l,2,s[c+2])}return new Hm(e,Di,{geometry:wd(ave)},{geometry:Ji.createVertex(e,ki.STATIC_DRAW,o.buffer)})}};function XTt(t,e){Ia(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const ove=ht(),ave=Cs().vec3f(z.POSITION);var c1;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(c1||(c1={}));let yne=class extends Nc{constructor(){super(...arguments),this.type=c1.Rain}};h([ae({count:c1.COUNT})],yne.prototype,"type",void 0);function ZTt(t){const e=new Ui;return e.attributes.add(z.POSITION,"vec3"),e.attributes.add(z.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new kr("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new kr("offset",(r,i)=>JTt(r,i))),e.vertex.uniforms.add(new ut("width",r=>r.width)),e.vertex.uniforms.add(new fs("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new fs("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new ut("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(D`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===c1.Rain?D`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:D`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add([new ut("opacity",r=>r.opacity),new kr("particleColor",(r,i)=>KTt(i,t))]),e.fragment.code.add(D`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===c1.Rain?D`d = 0.35 * smoothstep(0.5, 0.0, d);`:D`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function JTt(t,e){const r=e.camera.eye,i=.5*t.width,n=1/t.width,s=HOe(_ne,Le(_ne,(r[0]+i)*n,(r[1]+i)*n,(r[2]+i)*n));return Ka(s,r,Oe(s,s,t.width))}function KTt(t,e){const r=e.type===c1.Rain?tSt:eSt,i=Oe(_ne,r,rSt),n=t.camera.eye;Ye(lve,n);const s=Math.max(0,Qe(lve,t.lighting.mainLight.direction));return Eo(i,i,r,s)}const _ne=G(),lve=G(),eSt=pt(1,1,1),tSt=pt(.85,.85,.85),rSt=.7,iSt=Object.freeze(Object.defineProperty({__proto__:null,build:ZTt},Symbol.toStringTag,{value:"Module"}));let nSt=class extends En{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},vne=class o8e extends qi{initializeProgram(e){return new zi(e.rctx,o8e.shader.get().build(this.configuration),Xk)}initializePipeline(){return Pr({blending:Da(st.ONE,st.ONE,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qn.LEQUAL},colorWrite:Gr})}};vne.shader=new Bi(iSt,()=>be(()=>import("./Precipitation.glsl-cef4002b.js"),[]));const Xk=new Map([[z.POSITION,0],[z.INSTANCEFEATUREATTRIBUTE,1]]);let a8e=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return M(r)?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},sSt=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},Xx=class extends rt{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new nSt,this._animation=new a8e,this._updatingTracking=new _A,this._passParameters.time=0,this._passParameters.radius=ln(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=us(this._snowTechniqueCached),this._rainTechniqueCached=us(this._rainTechniqueCached),this._vao=kt(this._vao),this._instanceIdBuffer=kt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(k(this._rainTechniqueCached)){const e=new yne;e.type=c1.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(vne,e)}return this._rainTechniqueCached}get _snowTechnique(){if(k(this._snowTechniqueCached)){const e=new yne;e.type=c1.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(vne,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){var l;const n=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!n.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),k(n)||k(this._vao)||k(this._instanceIdBuffer)||(M(e.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?Mr(0,o,2*r):Mr(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*Yae(this._animation.time)%1e5;const a=s.bindTechnique(n,this._passParameters,e.bindParameters);s.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),rhe(s,Xk,this._instanceIdBuffer,cve,0),(l=s.capabilities.instancing)==null||l.drawArraysInstanced(wr.TRIANGLES,0,3,this._numParticles*r),ihe(s,Xk,this._instanceIdBuffer,cve)}_ensureResources(e){k(this._vao)&&(this._vao=this._createVertexArrayObject(e)),k(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return Ji.createVertex(e,ki.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Hm(e,Xk,{geometry:wd(oSt)},{geometry:Ji.createVertex(e,ki.STATIC_DRAW,r)})}};h([f({constructOnly:!0})],Xx.prototype,"context",void 0),h([f({constructOnly:!0})],Xx.prototype,"view",void 0),h([f({readOnly:!0})],Xx.prototype,"updating",null),h([f()],Xx.prototype,"_updatingTracking",void 0),Xx=h([Q("esri.views.3d.environment.Precipitation")],Xx);const oSt=Cs().vec3f(z.POSITION),cve=wd(Cs().f32(z.INSTANCEFEATUREATTRIBUTE),1),aSt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),c8=128,uve=-bie,hve=0,tY=50,lSt=()=>1-511/512,cSt=lk([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let uSt=class{constructor(e,r){this.view=e,this.type=va.Simple,this._passParameters=new vhe,this._vaoCount=0,this._texV1=1,this._isMars=XA(e.spatialReference);const i=ln(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+uve)/this._planetRadius,this._middleRimFactor=(this._planetRadius+hve)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=hve/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const n=r.renderContext.rctx;this._cameraChangeHandle=xe(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),vo),this._vao=this._createRibbon(n),this._vaoCount=Xl(this._vao,"geometry"),this._fadeVao=Fc(n),this._fadeVaoCount=Xl(this._fadeVao,"geometry");const s=this._isMars?aSt:N6e;this._passParameters.texture=new Xt(n,{pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:zt.LINEAR,flipped:!0,width:1,height:512},s);const o=new _he;o.geometry=BA.Cone,this._coneTechnique=this._techniqueRepository.acquire(yz,o),o.geometry=BA.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(yz,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=kt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._vao),i.drawArrays(wr.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(wr.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=G(),i=this._planetRadius,n=ct(e.eye),s=n-i;if(s<0){const A=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=A}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(tY,s),a=i+uve;this._passParameters.innerScale=hSt(i+o,i,a)-1,this._passParameters.altitudeFade=Jue(s),Oe(r,e.eye,(i+tY)/n),dve(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=lSt(),u=cSt(s);let d=this._texV0+c*this._texVScale,p=this._texV0+l*u*this._texVScale;if(s>tY){dve(e.eye,e.center,e.up,i,this._passParameters.silhouette);const A=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),v=He((A-1.5)/(l-1.5),0,1);d=this._texV0+v*c*this._texVScale,p=this._texV0+Mr(this._texV1,l*u,v)*this._texVScale}ti(this._passParameters.texV,d,p)}_createRibbon(e){const r=xo(3+3*c8*3),i=new Uint32Array(3*c8*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<c8;o++){const a=9*o+3;r[a+0]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===c8-1?1:l+3,u=15*o;i[u+0]=l,i[u+1]=l+1,i[u+2]=c+1,i[u+3]=c+1,i[u+4]=c,i[u+5]=l,i[u+6]=l+1,i[u+7]=l+2,i[u+8]=c+2,i[u+9]=c+2,i[u+10]=c+1,i[u+11]=l+1,i[u+12]=l,i[u+13]=c,i[u+14]=0}const n=pve.createBuffer(i.length),s=n.position;for(let o=0;o<i.length;++o){const a=3*i[o];s.set(o,0,r[a]),s.set(o,1,r[a+1]),s.set(o,2,r[a+2])}return new Hm(e,Di,{geometry:wd(pve)},{geometry:Ji.createVertex(e,ki.STATIC_DRAW,n.buffer)})}_computeScreenRimWidth(e,r,i,n){return ze(t3,n.center,n.v2),Oe(u8,t3,this._outerRimFactor),QG(rY,r,t3,i),tve(t3,rY,e.projectionMatrix,e.viewport,t3),tve(u8,rY,e.projectionMatrix,e.viewport,u8),zn(t3,u8)/e.height}};function dve(t,e,r,i,n){const s=ct(t),o=i*Math.sqrt(s*s-i*i)/s,a=Math.sqrt(i*i-o*o),l=n.v1,c=n.v2;return Oe(n.center,t,a/s),Kt(l,t,e),vc(l)<1&&Kt(l,t,r),Oe(l,l,o/ct(l)),Kt(c,l,t),Oe(c,c,o/ct(c)),o}const rY=ht(),t3=G(),u8=G();function hSt(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const pve=Cs().vec3f(z.POSITION);let l8e=class c8e extends qi{initializeProgram(e){return new zi(e.rctx,c8e.shader.get().build(this.configuration),Di)}initializePipeline(){return Pr({blending:Da(st.ONE,st.ZERO,st.ONE_MINUS_SRC_COLOR,st.ONE),colorWrite:Gr})}};l8e.shader=new Bi(R6e,()=>be(()=>import("./FogHaze.glsl-58dd66d4.js"),[]));const dSt=.7,pSt=1;let R4=class extends rt{constructor(e){super(e),this._passParameters=new Ahe;const r=e.context.renderContext.rctx;this._vao=Fc(r,gP);const i=ln(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+gL;const n=new yhe;n.haze=!0,this._hazeTechnique=e.context.techniqueRepository.acquire(l8e,n)}destroy(){this._hazeTechnique.release(),this._vao.dispose()}set strength(e){this._passParameters.hazeStrength=e}get strength(){return this._passParameters.hazeStrength}render(e,r){if(this.view.basemapTerrain.baseOpacity===0||(this._update(e,r),this._passParameters.hazeAmount<=0))return;const i=this._hazeTechnique;if(!i.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderSimpleHaze(s,e)})}_renderSimpleHaze(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(wr.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;Ye(fve,i.eye);const n=Math.max(0,Qe(fve,e.bindParameters.lighting.mainLight.direction)),s=mSt;Oe(mve,s,0),Eo(this._passParameters.hazeColor,mve,s,n);const o=ct(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.hazeAmount=(1-GR(dSt*ff,pSt*ff,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};h([f({constructOnly:!0})],R4.prototype,"context",void 0),h([f({constructOnly:!0})],R4.prototype,"view",void 0),R4=h([Q("esri.views.3d.environment.SimpleHaze")],R4);let fSt=class{constructor(){this.strength=0,this.amount=0}};const mSt=pt(.24,.44,.8),fve=G(),mve=G();function Phe(t){const e=D`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,r=D`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;t.vertex.code.add(e),t.vertex.code.add(r),t.fragment.code.add(e),t.fragment.code.add(r)}function gSt(){const t=new Ui;return t.attributes.add(z.POSITION,"vec3"),t.attributes.add(z.COLOR,"vec4"),t.attributes.add(z.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add([new fs("transform",(e,r)=>ASt(e,r)),new pi("viewport",(e,r)=>r.camera.fullViewport),new ut("pixelRatio",(e,r)=>r.camera.pixelRatio)]),t.include(Phe),t.vertex.code.add(D`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(D`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),t}function ASt(t,e){return Ia(tv,e.camera.projectionMatrix),tv[10]=24e-8-1,tv[11]=-1,tv[14]=(24e-8-2)*e.camera.near,js(tv,tv,e.camera.viewMatrix),js(tv,tv,t.modelMatrix)}const tv=ht(),ySt=Object.freeze(Object.defineProperty({__proto__:null,build:gSt},Symbol.toStringTag,{value:"Module"}));let _St=class extends En{constructor(){super(...arguments),this.modelMatrix=ht()}},u8e=class h8e extends qi{constructor(e){super(e,new Nc,()=>this.destroy())}initializeProgram(e){return new zi(e.rctx,h8e.shader.get().build(),Di)}initializePipeline(){return Pr({blending:Da(st.SRC_ALPHA,st.ONE,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qn.LEQUAL},colorWrite:Gr})}};u8e.shader=new Bi(ySt,()=>be(()=>import("./Stars.glsl-f28e8580.js"),[]));let nb=class extends rt{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return M(this._loadDataTask)&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new _St,this._updatingTracking=new _A}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Gf(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=us(this._technique),this._vao=kt(this._vao)}render(e){const{rctx:r}=e;if(this._ensureResources(r),k(this._technique)||k(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,this._renderParameter,e.bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(wr.POINTS,0,this._numPoints)}_ensureResources(e){if(M(this._technique)||k(r3))return;this._technique=new u8e({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=r3.byteLength/gve;const r=new Float32Array(r3,0,2*this._numPoints),i=new Uint8Array(r3,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,n=>this._update(n),Rr)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),n=Ia(this._renderParameter.modelMatrix,wSt);JR(n,n,-i*Math.PI),js(n,bSt,n),JR(n,n,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,n){const s=Ave.createBuffer(n),o=s.position,a=s.color,l=s.size;for(let c=0;c<n;c++){const u=r[2*c+0],d=r[2*c+1];o.set(c,0,-Math.cos(u)*Math.sin(d)),o.set(c,1,-Math.sin(u)*Math.sin(d)),o.set(c,2,-Math.cos(d));const p=this._unpackUint8Attributes(i[c]),A=this._hexToRGB(vSt[p[1]]);a.set(c,0,255*A[0]),a.set(c,1,255*A[1]),a.set(c,2,255*A[2]),a.set(c,3,255),l.set(c,p[0])}return new Hm(e,Di,{geometry:wd(Ave)},{geometry:Ji.createVertex(e,ki.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(M(r3))return null;const e=xN(async r=>{const{data:i}=await jrt("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),r3=i});return e.promise.catch(r=>{$o(r)||we.getLogger(this.declaredClass).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new pe("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/gve;if(r%1!=0||r>5e4||r<5e3)throw new pe("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};h([f({constructOnly:!0})],nb.prototype,"view",void 0),h([f({constructOnly:!0})],nb.prototype,"requestRender",void 0),h([f({readOnly:!0})],nb.prototype,"updating",null),h([f()],nb.prototype,"_loadDataTask",void 0),h([f()],nb.prototype,"_updatingTracking",void 0),nb=h([Q("esri.views.3d.environment.Stars")],nb);const vSt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],bSt=Sce(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),wSt=Sce(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),gve=9,Ave=Cs().vec3f(z.POSITION).vec4u8(z.COLOR).f32(z.SIZE);let r3=null;function xSt(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function bz(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function Ihe(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>Dc()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function $he(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*u+o*a+n*c-s*l,t[1]=n*u+o*l+s*a-i*c,t[2]=s*u+o*c+i*l-n*a,t[3]=o*u-i*a-n*l-s*c,t}function TSt(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=n*l+s*a,t[2]=s*l-n*a,t[3]=o*l-i*a,t}function SSt(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-s*a,t[1]=n*l+o*a,t[2]=s*l+i*a,t[3]=o*l-n*a,t}function ESt(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=n*l-i*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function CSt(t,e){const r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function Zk(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3];let l,c,u,d,p,A=r[0],v=r[1],b=r[2],S=r[3];return c=n*A+s*v+o*b+a*S,c<0&&(c=-c,A=-A,v=-v,b=-b,S=-S),1-c>Dc()?(l=Math.acos(c),u=Math.sin(l),d=Math.sin((1-i)*l)/u,p=Math.sin(i*l)/u):(d=1-i,p=i),t[0]=d*n+p*A,t[1]=d*s+p*v,t[2]=d*o+p*b,t[3]=d*a+p*S,t}function MSt(t){const e=SN,r=e(),i=e(),n=e(),s=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=s*Math.sin(2*Math.PI*i),t[1]=s*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*n),t[3]=o*Math.cos(2*Math.PI*n),t}function RSt(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r*r+i*i+n*n+s*s,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-n*a,t[3]=s*a,t}function HS(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function d8e(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,o=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*o+o]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*s+o]-e[3*o+s])*i,t[s]=(e[3*s+n]+e[3*n+s])*i,t[o]=(e[3*o+n]+e[3*n+o])*i}return t}function OSt(t,e,r,i){const n=.5*Math.PI/180;e*=n,r*=n,i*=n;const s=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return t[0]=s*l*u-o*a*c,t[1]=o*a*u+s*l*c,t[2]=o*l*c-s*a*u,t[3]=o*l*u+s*a*c,t}function PSt(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const Dhe=lm,ISt=pn,$St=$le,DSt=$he,LSt=YO,NSt=ePe,FSt=CG,p8e=Dle,kSt=p8e,f8e=Lle,USt=f8e,Lhe=KOe,BSt=YM,zSt=Nle;function VSt(t,e,r){const i=Qe(e,r);return i<-.999999?(Kt(ng,GSt,e),Gh(ng)<1e-6&&Kt(ng,jSt,e),Ye(ng,ng),bz(t,ng,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Kt(ng,e,r),t[0]=ng[0],t[1]=ng[1],t[2]=ng[2],t[3]=1+i,Lhe(t,t))}const ng=G(),GSt=pt(1,0,0),jSt=pt(0,1,0);function HSt(t,e,r,i,n,s){return Zk(yve,e,n,s),Zk(_ve,r,i,s),Zk(t,yve,_ve,2*s*(1-s)),t}const yve=n0(),_ve=n0();function qSt(t,e,r,i){const n=WSt;return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],Lhe(t,d8e(t,n))}const WSt=Es();Object.freeze(Object.defineProperty({__proto__:null,add:$St,calculateW:CSt,conjugate:HS,copy:Dhe,dot:NSt,equals:zSt,exactEquals:BSt,fromEuler:OSt,fromMat3:d8e,getAxisAngle:Ihe,identity:xSt,invert:RSt,len:kSt,length:p8e,lerp:FSt,mul:DSt,multiply:$he,normalize:Lhe,random:MSt,rotateX:TSt,rotateY:SSt,rotateZ:ESt,rotationTo:VSt,scale:LSt,set:ISt,setAxes:qSt,setAxisAngle:bz,slerp:Zk,sqlerp:HSt,sqrLen:USt,squaredLength:f8e,str:PSt},Symbol.toStringTag,{value:"Module"}));function rF(t=YSt){return[t[0],t[1],t[2],t[3]]}function hdr(t,e,r=rF()){return Pe(r,t),r[3]=e,r}function vve(t,e,r=rF()){return Kt(r,t,e),Ye(r,r),r[3]=-QOe(t,e),r}function ddr(t,e,r=rF()){return bz(h8,t,bve(t)),bz(wve,e,bve(e)),$he(h8,wve,h8),QSt(r,xu(Ihe(r,h8)))}function pdr(t){return t}function bve(t){return Dr(t[3])}function QSt(t,e){return t[3]=e,t}const YSt=[0,0,1,0],h8=n0(),wve=n0();rF();function XSt(t,e,r){const i=t.parallax.anchorPointClouds;t.fadeIn.stage===Qh.FINISHED&&(t.fadeIn.factor=0,Pe(i,nA),t.fadeIn.stage=Qh.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=ba.FINISHED),t.fadeIn.stage===Qh.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(che(t.data)&&t.renderingStage!==oo.RENDERING||t.renderingStage===oo.FADING_TEXTURE_CHANNELS)&&(Pe(i,nA),t.fadeIn.stage=Qh.FADE_IN,t.startTime=e,t.renderingStage===oo.FADING_TEXTURE_CHANNELS&&(t.renderingStage=oo.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===Qh.FADE_IN?t.fadeIn.factor=r?He((e-t.startTime)/(m8e*r),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===Qh.FADE_IN&&(t.fadeIn.stage=Qh.FINISHED,t.fadeIn.factor=1)}function ZSt(t,e,r){const{fadeInOut:i,crossFade:n}=t;i.stage===ba.FINISHED&&(t.startTime=e,i.factor=1,i.stage=ba.FADE_OUT),i.factor>0&&i.stage===ba.FADE_OUT?i.factor=r?1-He((e-t.startTime)/(rEt*r),0,1):0:(i.factor<=0&&i.stage===ba.FADE_OUT&&(i.factor=0,Pe(t.parallax.anchorPointClouds,nA)),i.factor<=0&&i.stage===ba.FADE_OUT&&t.isCameraPositionFinal&&(i.factor=0,i.stage=ba.SWITCH,t.crossFade.enabled=!1,n.factor=1),i.stage===ba.SWITCH&&(che(t.data)&&t.renderingStage!==oo.RENDERING||t.renderingStage===oo.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,i.factor=0,i.stage=ba.FADE_IN,Pe(t.parallax.anchorPointClouds,nA),t.crossFade.enabled=!1,n.factor=1,t.renderingStage===oo.FADING_TEXTURE_CHANNELS&&(t.renderingStage=oo.SWITCH_CHANNELS)),i.factor<1&&i.stage===ba.FADE_IN?i.factor=r?He((e-t.startTime)/(m8e*r),0,1):1:i.factor>=1&&i.stage===ba.FADE_IN&&(i.stage=ba.FINISHED,i.factor=1))}function JSt(t,e,r,i){const{crossFade:n}=t,s=t.parallax.anchorPointClouds;t.crossFade.enabled&&!i||(Pe(t.parallaxNew.anchorPointClouds,nA),t.startTime=e,n.factor=0,t.crossFade.enabled=!0),n.factor<1&&t.crossFade.enabled?n.factor=r?He((e-t.startTime)/(iEt*r),0,1):1:n.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,n.factor=1,Pe(s,t.parallaxNew.anchorPointClouds),t.renderingStage===oo.FADING_TEXTURE_CHANNELS&&(t.renderingStage=oo.SWITCH_CHANNELS))}function xve(t,e,r,i){const n=t.fadeInOutHeight,s=n.stage===D2.FINISHED?r:t.startTimeHeightFade;if(i!==0){const o=(r-s)/(nEt*i);n.factor+=e?-o:o}else n.factor=e?0:1;t.startTimeHeightFade=r,n.factor=He(n.factor,0,1),n.stage=D2.HEIGHT_FADE}function KSt(t,e,r,i,n){t.renderingStage===oo.FINISHED_RENDERING&&(t.renderingStage=oo.FADING_TEXTURE_CHANNELS);const s=ct(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=s-yi.radius>ff?1:0),t.isCameraPositionFinal=S2(t.cameraPositionLastFrame,e.eye),Ye(nA,e.eye),Oe(nA,nA,yi.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&Pe(o.anchorPointClouds,nA);const a=ct(Ve(tEt,o.anchorPointClouds,nA));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==Qh.FINISHED?XSt(t,i,n):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==ba.FINISHED?ZSt(t,i,n):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===oo.FADING_TEXTURE_CHANNELS?JSt(t,i,n,(r!==Mi.IDLE||!che(t.data))&&t.renderingStage!==oo.FADING_TEXTURE_CHANNELS):l=!1;const c=s-yi.radius;if((c>1.7*ff||c<-ff)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>ff||c<-.35*ff)&&t.fadeInOutHeight.factor<1?xve(t,!1,i,n):c<ff&&c>-.35*ff&&t.fadeInOutHeight.factor>0?xve(t,!0,i,n):t.fadeInOutHeight.stage=D2.FINISHED,t.renderingStage===oo.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=oo.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(s*s-yi.radius*yi.radius,0))/s,vve(Tve,o.anchorPointClouds,i3),sd(o.transform,wp,i3[3],i3),l){const{parallaxNew:u}=t;vve(Tve,u.anchorPointClouds,i3),sd(u.transform,wp,i3[3],i3)}Pe(t.cameraPositionLastFrame,e.eye)}function eEt(t){return t.crossFade.enabled||t.fadeInOut.stage!==ba.FINISHED||t.fadeIn.stage!==Qh.FINISHED||t.fadeInOutHeight.stage!==D2.FINISHED||t.renderingStage!==oo.FINISHED}const Tve=pt(0,0,1),i3=rF(),nA=G(),tEt=G(),m8e=1,rEt=.5,iEt=1.3,nEt=1;let yP=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){var i;return(i=this._outer.get(e))==null?void 0:i.get(r)}set(e,r,i){const n=this._outer.get(e);n?n.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var Ao;function Sve(t=Fe("enable-feature:high-quality-idle")){const e=new yP;return t&&(e.set(Mi.INTERACTING,Ao.Antialiasing,!0),e.set(Mi.IDLE,Ao.Antialiasing,!0),e.set(Mi.INTERACTING,Ao.HighQualityTransparency,!0),e.set(Mi.IDLE,Ao.HighQualityTransparency,!0),e.set(Mi.INTERACTING,Ao.RealisticAtmosphere,!0),e.set(Mi.IDLE,Ao.RealisticAtmosphere,!0),e.set(Mi.IDLE,Ao.SSAO,!0),e.set(Mi.IDLE,Ao.WaterReflection,!0),e.set(Mi.IDLE,Ao.PhysicalPixelRendering,!0)),e.set(Mi.ANIMATING,Ao.ShadowMapUpdate,!0),e.set(Mi.INTERACTING,Ao.ShadowMapUpdate,!0),e.set(Mi.IDLE,Ao.ShadowMapUpdate,!0),e.set(Mi.IDLE,Ao.HighQualityVoxel,!0),e}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighQualityVoxel=2]="HighQualityVoxel",t[t.RealisticAtmosphere=3]="RealisticAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.ShadowMapUpdate=6]="ShadowMapUpdate",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Ao||(Ao={}));var dR;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(dR||(dR={}));var O4;const sEt=[nt.POSTPROCESSING_ENVIRONMENT_OPAQUE,nt.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let za=O4=class extends rt{constructor(t){super(t),this._context=null,this._atmosphere=null,this._hqAtmosphere=null,this._oldWeatherParameters=new iY,this._newWeatherParameters=new iY,this._fadedWeatherParameters=new iY,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(sEt,this)}destroy(){var t;this.removeHandles(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return M(this._hqAtmosphere)&&this.view._stage.renderer.isFeatureEnabled(Ao.RealisticAtmosphere)?this._hqAtmosphere:this._atmosphere}get _atmosphereType(){return M(this.atmosphere)?this.atmosphere.type:va.None}get canRender(){var t;return!!((t=this.view.basemapTerrain)!=null&&t.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._atmosphereType===va.Realistic}updateAnimation(t){return!!M(this._precipitation)&&this._precipitation.update(t)}get updating(){return M(this._stars)&&this._stars.updating||M(this._clouds)&&this._clouds.running}get weatherVisible(){return ct(this.view.state.camera.eye)-ln(this.view.spatialReference).radius<=ff}get _stars(){var i;const t=this.view,e=((i=t.environment)==null?void 0:i.starsEnabled)??!1,r=this._get("_stars");return!e||k(this._context)?(yt(r),null):M(r)?r:new nb({view:t,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||k(this._context))return yt(t),null;const e=this.view,r=this._context;return M(t)&&t.context===r?t:(yt(t),new Xx({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||k(this._context))return yt(t),null;if(M(t))return t;const e=this.view,r=this._context;return yt(t),new Hu({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||k(this._context))return yt(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=ln(this.view.spatialReference).radius;return M(t)&&t.viewingMode===e&&t.planetRadius===i?t:(yt(t),new Qx({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||k(this._context))return yt(t),null;if(M(t))return t;const e=this.view,r=this._context;return new M4({context:r,view:e})}get _simpleHaze(){const t=this._get("_simpleHaze");if(!this.weatherEnabled||k(this._context))return yt(t),null;if(M(t))return t;const e=this.view,r=this._context;return new R4({context:r,view:e})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([ic(()=>{var r;return(r=this.view)==null?void 0:r.basemapTerrain},()=>this._updateBasemapTerrain(),vo),xe(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),r=>this._updateAtmosphere(r),vo),xe(()=>this._stars,e),xe(()=>this._precipitation,e),xe(()=>this._clouds,()=>this._updateWeather(),Rr),xe(()=>this._fog,()=>this._updateFogHaze(),Rr),xe(()=>this._simpleHaze,()=>this._updateFogHaze(),Rr),xe(()=>this.view.state.mode,()=>{this._setNeedsRender()},fn),xe(()=>this._atmosphereType,()=>this._updateBasemapTerrain(),vo),xe(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},vo)])}uninitializeRenderContext(){this._context=null,this._atmosphere=yt(this._atmosphere),this._hqAtmosphere=yt(this._hqAtmosphere),this._set("_stars",yt(this._stars)),this._set("_precipitation",yt(this._precipitation)),this._set("_clouds",yt(this._clouds)),this._set("_cloudsComposition",yt(this._cloudsComposition)),this._set("_fog",yt(this._fog)),this._set("_simpleHaze",yt(this._simpleHaze))}prepareRender(t){t.bindParameters.cloudsFade.data=Zwt(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&(KSt(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===oo.FINISHED&&M(this._clouds)&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){if(t.output===ne.Color)switch(t.bindParameters.slot){case nt.POSTPROCESSING_ENVIRONMENT_OPAQUE:M(this._stars)&&this._stars.render(t),M(this.atmosphere)&&(this.atmosphere.render(t),M(this._cloudsComposition)&&M(t.bindParameters.cloudsFade.data)&&(this.weatherVisible&&M(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),eEt(t.bindParameters.cloudsFade)&&M(this._context)&&this._context.requestRender());break;case nt.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(M(this.atmosphere)&&(this.atmosphere.renderHaze(t,this._weatherParameters.haze.amount),this._weatherParameters.haze.amount>0&&this._atmosphereType!==va.Realistic&&M(this._simpleHaze)&&this._simpleHaze.render(t,this._weatherParameters.haze),this._weatherParameters.fog.amount>0&&M(this._fog)&&this._fog.render(t,this._weatherParameters.fog),M(this._precipitation))){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(t,e.precipitation,e.type)}}}updateLightSources(t,e,r,i){if(M(this._context)){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=e,n.bindParameters.newLighting.globalFactor=r,n.bindParameters.newLighting.set(t),i===dR.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return k(t)?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===Qh.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===ba.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;k(t)||k(this._clouds)||(this._clouds.applyPreset(fc[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){M(this._context)&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(k(this._fog)||k(this._simpleHaze)||k(t)||k(this._context))return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=Mr(3e-5,.005,t.weatherAdjustment**3),Pe(this._newWeatherParameters.fog.color,Eve),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===va.Realistic?1:0,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Mr(4e-6,2e-4,(t.effect??0)**3),Pe(this._newWeatherParameters.fog.color,oEt),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Mr(4e-6,2e-4,(t.effect??0)**3),Pe(this._newWeatherParameters.fog.color,Eve),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===va.Realistic?1:0,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.haze.strength=4e-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(M(this._atmosphere)?this._atmosphere.type===e:e===va.None)return;this._atmosphere=yt(this._atmosphere),this._hqAtmosphere=yt(this._hqAtmosphere);const r=this._getAtmosphereClass(e);r&&M(this._context)&&(this._atmosphere=new r(this.view,this._context),e===va.Simple&&(this._hqAtmosphere=new GQ(this.view,this._context))),this._setNeedsRender(),this._updateBasemapTerrain()}_getAtmosphereClass(t){switch(t){case va.Realistic:return GQ;case va.Panoramic:return YTt;case va.Simple:return uSt;default:case va.None:return null}}_selectAtmosphereType(t){const{enabled:e,quality:r,viewingMode:i}=t;return!e||ZA(this.view.spatialReference)?va.None:i===wt.Local?va.Panoramic:M(this._context)&&r==="high"&&GQ.isSupported(this._context)&&ND(this.view.spatialReference)?va.Realistic:va.Simple}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=this._atmosphereType===va.Simple)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),stubGetAtmosphereClass:t=>{Cve=O4.prototype._getAtmosphereClass,O4.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{O4.prototype._getAtmosphereClass=Cve}}}};h([f({constructOnly:!0})],za.prototype,"view",void 0),h([f({readOnly:!0})],za.prototype,"atmosphere",null),h([f({readOnly:!0})],za.prototype,"_atmosphereType",null),h([f({type:Boolean,readOnly:!0})],za.prototype,"updating",null),h([f({readOnly:!0})],za.prototype,"weatherVisible",null),h([f()],za.prototype,"_context",void 0),h([f()],za.prototype,"_atmosphere",void 0),h([f()],za.prototype,"_hqAtmosphere",void 0),h([f({readOnly:!0})],za.prototype,"_stars",null),h([f({readOnly:!0})],za.prototype,"_precipitation",null),h([f({readOnly:!0})],za.prototype,"_clouds",null),h([f({readOnly:!0})],za.prototype,"_cloudsComposition",null),h([f({readOnly:!0})],za.prototype,"_fog",null),h([f({readOnly:!0})],za.prototype,"_simpleHaze",null),h([f({readOnly:!0})],za.prototype,"weatherEnabled",null),h([f({readOnly:!0})],za.prototype,"_precipitationEnabled",null),h([f({readOnly:!0})],za.prototype,"_weatherUpdateParameters",null),za=O4=h([Q("esri.views.3d.environment.EnvironmentRenderer")],za);let iY=class{constructor(){this.fog=new cTt,this.haze=new fSt}copyFrom(e){this.fog.amount=e.fog.amount,this.haze.amount=e.haze.amount,this.fog.strength=e.fog.strength,this.haze.strength=e.haze.strength,Pe(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=Mr(e.fog.amount,r.fog.amount,i),this.haze.amount=Mr(e.haze.amount,r.haze.amount,i),this.fog.strength=Mr(e.fog.strength,r.fog.strength,i),this.haze.strength=Mr(e.haze.strength,r.haze.strength,i),Eo(this.fog.color,e.fog.color,r.fog.color,i)}};const oEt=pt(.5,.5,.5),Eve=pt(1.5,1.5,1.5);let Cve;function Mve(t,e,r){if(k(e.longitude)||k(e.latitude)||k(r.longitude)||k(r.latitude))throw new Error("Invalid points: no lon/lat");return aEt(t,e.longitude,e.latitude,r.longitude,r.latitude)}function aEt(t,e,r,i,n){const s=Dr(r),o=Dr(n),a=s-o,l=Dr(e)-Dr(i),c=Math.sin(a/2),u=Math.sin(l/2),d=2*jf(Math.sqrt(c*c+Math.cos(s)*Math.cos(o)*u*u))*t;return Math.round(1e4*d)/1e4}function lEt(t,e,r){const i=e.spatialReference,n=ln(i),s=new Ht(e.x,t.y,i),o=new Ht(r.x,t.y,i),a=new Ht(t.x,e.y,i),l=new Ht(t.x,r.y,i);return{lon:Mve(n.radius,s,o),lat:Mve(n.radius,a,l)}}function cEt(t,e,r){const i=e/r,n=Dr(t),s=Math.sin(i/2),o=Math.cos(n),a=2*jf(Math.sqrt(s*s/(o*o)));return xu(a)}function uEt(t,e){let r=t/15;return e||(r=Math.round(r)),r}function Rve(t,e){const r=t==null?void 0:t[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=uEt(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const n=e.minutes%1;return e.minutes-=n,e.seconds=Math.round(60*n),e}var Ove,Pve,Ive,bne={},hEt={get exports(){return bne},set exports(t){bne=t}};Ove=hEt,Pve=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,n=Math.asin,s=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,d={dec:0,ra:0};function p(j){return j.valueOf()/l-.5+c}function A(j){return new Date((j+.5-c)*l)}function v(j){return p(j)-u}var b=23.4397*a;function S(j,H){return s(e(j)*r(b)-i(H)*e(b),r(j))}function E(j,H){return n(e(H)*r(b)+r(H)*e(b)*e(j))}function R(j,H,W){return s(e(j),r(j)*e(H)-i(W)*r(H))}function O(j,H,W){return n(e(H)*e(W)+r(H)*r(W)*r(j))}function I(j,H){return a*(280.16+360.9856235*j)-H}function N(j){return a*(357.5291+.98560028*j)}function L(j){return a*(1.9148*e(j)+.02*e(2*j)+3e-4*e(3*j))}function B(j,H){return j+H+102.9372*a+t}function U(j,H){var W=N(j),oe=B(W,L(W));return H||(H={dec:0,ra:0}),H.dec=E(oe,0),H.ra=S(oe,0),H}var q={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(j,H,W,oe){var le=a*-W,fe=a*H,de=v(j),Ee=U(de,d),Ie=I(de,le)-Ee.ra;return oe||(oe={azimuth:0,altitude:0}),oe.azimuth=R(Ie,fe,Ee.dec),oe.altitude=O(Ie,fe,Ee.dec),oe}},Z=[[-.83,"sunrise","sunset"]];q.addTime=function(j,H,W){Z.push([j,H,W])};var X=9e-4;function ee(j,H){return Math.round(j-X-H/(2*t))}function se(j,H,W){return X+(j+H)/(2*t)+W}function ue(j,H,W){return u+j+.0053*e(H)-.0069*e(2*W)}function re(j,H,W){return o((e(j)-e(H)*e(W))/(r(H)*r(W)))}function te(j){var H=a*(134.963+13.064993*j),W=a*(93.272+13.22935*j),oe=a*(218.316+13.176396*j)+6.289*a*e(H),le=5.128*a*e(W),fe=385001-20905*r(H);return{ra:S(oe,le),dec:E(oe,le),dist:fe}}return q.getTimes=function(j,H,W){var oe=a*-W,le=a*H,fe=ee(v(j),oe),de=se(0,oe,fe),Ee=N(de),Ie=L(Ee),Ge=B(Ee,Ie),Ke=E(Ge,0),vt=ue(de,Ee,Ge);function ke(rr){return ue(se(re(rr,le,Ke),oe,fe),Ee,Ge)}function Ne(rr){var vr=(e(rr)-e(le)*e(Ke))/(r(le)*r(Ke));return vr<-1?q.PolarException.MIDNIGHT_SUN:vr>1?q.PolarException.POLAR_NIGHT:q.PolarException.NORMAL}var Xe,Se,It,lt,qt,er={solarNoon:A(vt),nadir:A(vt-.5),polarException:q.PolarException.NORMAL};for(Xe=0,Se=Z.length;Xe<Se;Xe+=1)qt=vt-((lt=ke((It=Z[Xe])[0]*a))-vt),er[It[1]]=A(qt),er[It[2]]=A(lt);return er.polarException=Ne(Z[0][0]*a),er},q.getMoonPosition=function(j,H,W){var oe=a*-W,le=a*H,fe=v(j),de=te(fe),Ee=I(fe,oe)-de.ra,Ie=O(Ee,le,de.dec);return Ie+=.017*a/i(Ie+10.26*a/(Ie+5.1*a)),{azimuth:R(Ee,le,de.dec),altitude:Ie,distance:de.dist}},q.getMoonFraction=function(j){var H=v(j),W=U(H),oe=te(H),le=149598e3,fe=o(e(W.dec)*e(oe.dec)+r(W.dec)*r(oe.dec)*r(W.ra-oe.ra)),de=s(le*e(fe),oe.dist-le*r(fe));return(1+r(de))/2},q},(Ive=Pve())!==void 0&&(Ove.exports=Ive);const qS=bne,Jg={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function dEt(t,e,r,i,n,s){Le(s.ambient.color,1,1,1),s.ambient.intensity=Jg.global.ambient,Le(s.direct.color,1,1,1),s.direct.intensity=Jg.global.direct;const o=e[2],a=He((Math.abs(o)-Jg.local.altitude)/(Jg.global.altitude-Jg.local.altitude),0,1);let l;if(s.globalFactor=a,M(t)&&(l=qS.getTimes(t,e[1],e[0])),a<1){let c;if(M(t))c=_Et(t,l,i);else{const u=y8e(i);c={direct:{intensity:Jg.local.directAtNoon*u.direct,color:pt(1,1,1)},ambient:{intensity:Jg.local.ambientAtNoon*u.ambient,color:pt(1,1,1)},timeOfDay:"early afternoon"}}Eo(s.ambient.color,c.ambient.color,s.ambient.color,a),s.ambient.intensity=Mr(c.ambient.intensity,s.ambient.intensity,a),Eo(s.direct.color,c.direct.color,s.direct.color,a),s.direct.intensity=Mr(c.direct.intensity,s.direct.intensity,a),s.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,s.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}s.noonFactor=M(t)?yEt(t,l):1,M(t)?pEt(t,e,r,s.direct.directionToLightSource):g8e(n,r,s.direct.directionToLightSource)}function g8e(t,e,r){e===wt.Global?Ye(nY,t.eye):Le(nY,0,0,1),Oe(sY,t.viewForward,-1);const i=ak(sY,nY),n=Math.max(i-2*oY,0),s=.85*n/(n+1),o=Math.max(oY,i-oY-s);bp(Dve,-o,t.viewRight),Ot(r,sY,Dve),ze(r,r,Oe(vEt,t.viewRight,bEt)),Ye(r,r)}function pEt(t,e,r,i){const n=AEt,s=Xf(gEt);if(r===wt.Global)qS.getPosition(t,0,0,n),Le(i,0,0,-1),ZR(s,s,-n.azimuth),qG(s,s,-n.altitude),Ot(i,i,s);else{const o=Jg.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=He(c,0,1),c<1?(qS.getPosition(t,e[1],e[0],n),n.azimuth=(1-c)*n.azimuth+c*a.azimuth,n.altitude=(1-c)*n.altitude+c*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),Le(i,0,-1,0),JR(s,s,-n.azimuth),ZR(s,s,-n.altitude),Ot(i,i,s)}}function fEt(t,e){if(e===wt.Global)return!0;const r=Jg.planarDirection;return Math.abs(t)<r.localAltitude}const mEt=pt(.5773502691896258,-.5773502691896258,.5773502691896258);let A8e=class{constructor(){this.ambient={color:pt(1,1,1),intensity:.55},this.direct={color:pt(1,1,1),intensity:.55,directionToLightSource:Gs(mEt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const gEt=ht(),AEt={azimuth:0,altitude:0};function yEt(t,e){const r=t.valueOf();let i,n;e.polarException===qS.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=i+432e6):e.polarException===qS.PolarException.POLAR_NIGHT?(i=r-2,n=r-1):(i=e.sunrise.valueOf(),n=e.sunset.valueOf());const s=i+(n-i)/2;return 1-He(Math.abs(r-s)/432e5,0,1)}function y8e(t){switch(t){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function $ve(t,e){const r=(t[0]+t[1]+t[2])/3;for(let i=0;i<3;i++)t[i]=t[i]+(r-t[i])*e;return t}function _Et(t,e,r){const i=t.valueOf();let n,s;e.polarException===qS.PolarException.MIDNIGHT_SUN?(n=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=n+432e6):e.polarException===qS.PolarException.POLAR_NIGHT?(n=i-2,s=i-1):(n=e.sunrise.valueOf(),s=e.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,u=a+l,d=.06*o,p=n-d/2,A=n+d/2,v=s-d/2,b=s+d/2,S=Jg.local,E=[.01,S.ambientAtNight],R=[.8,.8,1],O=[.01,.01,.01],I=[S.directAtTwilight,S.ambientAtTwilight],N=[1,.6,.5],L=[.8,.8,1],B=[.9*S.directAtNoon,S.ambientAtNoon],U=[1,.98,.98],q=[.98,.98,1],Z=[S.directAtNoon,S.ambientAtNoon],X=[1,1,1],ee=[1,1,1],se=B,ue=U,re=q,te=I,j=N,H=L;let W,oe,le=[0,0],fe=[0,0,0],de=[0,0,0];i<p||i>b?(le=E,fe=O,de=R,oe="night"):i<A?(W=A-p,le=kl(i-p,W,E,I),fe=kl(i-p,W,O,N),de=kl(i-p,W,R,L),oe="sun rising"):i<c?(W=c-A,le=kl(i-A,W,I,B),fe=kl(i-A,W,N,U),de=kl(i-A,W,L,q),oe="early morning"):i<a?(W=a-c,le=kl(i-c,W,B,Z),fe=kl(i-c,W,U,X),de=kl(i-c,W,q,ee),oe="late morning"):i<u?(W=u-a,le=kl(i-a,W,Z,se),fe=kl(i-a,W,X,ue),de=kl(i-a,W,ee,re),oe="early afternoon"):i<v?(W=v-u,le=kl(i-u,W,se,te),fe=kl(i-u,W,ue,j),de=kl(i-u,W,re,H),oe="late afternoon"):i<b&&(W=b-v,le=kl(i-v,W,te,E),fe=kl(i-v,W,j,O),de=kl(i-v,W,H,R),oe="sun setting");let Ee=0;switch(r){case"rainy":case"foggy":case"snowy":Ee=.5}Ee>0&&(fe=$ve(fe,Ee),de=$ve(de,Ee));const Ie=pt(fe[0],fe[1],fe[2]),Ge=pt(de[0],de[1],de[2]),Ke=y8e(r);return{direct:{intensity:le[0]*Ke.direct,color:Ie},ambient:{intensity:le[1]*Ke.ambient,color:Ge},timeOfDay:oe}}function kl(t,e,r,i){const n=[];for(let s=0;s<r.length;s++)n[s]=(i[s]-r[s])*t/e+r[s];return n}const Dve=ht(),nY=G(),sY=G(),vEt=G(),oY=.25,bEt=.2;let L0=class extends Ws.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new cn,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new gz,this._ambientLight=new ghe,this._moonLight=new T6e,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,r,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(r=this._view)==null?void 0:r.state)==null?void 0:i.viewingMode)===wt.Global&&ND(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new za({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this._viewHandles.add([xe(()=>e.environment.lighting,n=>this._updateLightingHandler(n),fn),xe(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),fn),xe(()=>e.stationary,()=>this._interactingStationaryHandler()),xe(()=>e.environment.lighting.directShadowsEnabled,r,fn),xe(()=>e.environment.lighting.ambientOcclusionEnabled,r,fn),xe(()=>e.environment.lighting.waterReflectionEnabled,r,fn),xe(()=>{var n;return(n=e.environment.background)==null?void 0:n.color},r,fn),xe(()=>e.spatialReference,()=>this._resetReferencePosition(!0),fn),xe(()=>e.environment.weather.type,()=>this._updateLighting(null,dR.Faded),fn),xe(()=>this.weatherEnabled,()=>this._updateLighting(null,dR.Faded),fn),xe(()=>e.viewingMode,()=>this._resetReferencePosition(!0),vo),xe(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),vo),xe(()=>e.state.camera,i,vo),xe(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=yt(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;(r==null?void 0:r.type)!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if((r==null?void 0:r.type)!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!IS(i)){const n=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(n))return void this._requestReferencePositionUpdate(n)}if(this._preupdateTracking(e),M(this._referencePosWGS84Comparable)){const n=Rve(this._referencePosWGS84Comparable,Lve);M(n)&&(r.autoUpdate(null,n),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=ND(this._view.spatialReference);if(i&&!IS(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const n=e.position;return k(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=G()),i?Hat(n,this._referencePosWGS84Comparable):Le(this._referencePosWGS84Comparable,n.longitude??0,n.latitude??0,n.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=dR.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const n=this._referencePosWGS84Comparable,s=M(n)?wEt:xEt,o=this.weatherVisible?i.environment.weather.type:"disabled";M(n)?dEt(e,n,i.state.viewingMode,o,i.state.camera,s):i.environment.lighting.type==="virtual"&&g8e(i.state.camera,i.state.viewingMode,s.direct.directionToLightSource);const a=this._mainLight,l=s.direct;Oe(a.intensity,l.color,l.intensity*Math.PI),Pe(a.direction,l.directionToLightSource),a.specularStrength=s.specularStrength,a.environmentStrength=s.environmentStrength;const c=this._ambientLight;Oe(c.intensity,s.ambient.color,s.ambient.intensity);const u=this._moonLight;Eo(u.intensity,SEt,EEt,s.globalFactor);const d=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));Oe(u.intensity,u.intensity,d),Pe(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],s.noonFactor,s.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||k(e))return!1;const i=TEt;i.setTime((r||this._view.environment.lighting.date).getTime());const n=Rve(e,Lve);if(k(n))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===n.hours&&s.minutes===n.minutes&&s.seconds===n.seconds)return!1}else s=n;const o=i.getUTCHours()-(n.hours-s.hours),a=i.getUTCMinutes()-(n.minutes-s.minutes),l=i.getUTCSeconds()-(n.seconds-s.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,n)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=tp(this._referencePosWGS84Comparable,!0,s=>fEt(s[2],this._view.state.viewingMode)),i=this._view.environment.background,n=i instanceof xFe?{type:"color",color:Ece($t.toUnitRGBA(i.color))}:{type:"color",color:Fr(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:n,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=yS(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),n=this._referencePosUpdateTimer=yS(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===n&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};h([f({type:Boolean,readOnly:!0})],L0.prototype,"updating",null),h([f()],L0.prototype,"disableQueries",void 0),h([f()],L0.prototype,"_disableWeather",void 0),h([f()],L0.prototype,"weatherEnabled",null),h([f()],L0.prototype,"weatherVisible",null),h([f()],L0.prototype,"referencePositionWGS84Comparable",null),h([f()],L0.prototype,"_renderer",void 0),h([f()],L0.prototype,"_referencePosWGS84Comparable",void 0),L0=h([Q("esri.views.3d.environment.SceneViewEnvironmentManager")],L0);const wEt=new A8e,xEt=new A8e,TEt=new Date,Lve={hours:0,minutes:0,seconds:0},SEt=pt(.22,.22,.33),EEt=pt(.22,.22,.22);var is;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(is||(is={}));var ei;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(ei||(ei={}));var nl;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(nl||(nl={}));function wL(t,e){return(t&e)!=0}function wz(t,e,r,i,n,s){t!==0&&(r?(s.min=Math.min(s.min,e),s.max=Math.max(s.max,e)):i!=null?(s.min-=Math.max(0,(e-s.min)*(1-i)),s.max+=Math.max(0,(e-s.max)*(1-i))):n&&(s.min-=Math.max(0,e-s.min-n),s.max+=Math.max(0,e-s.max-n)))}const k2={selection:is.NONE,interactionType:ei.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:nl.TUMBLE};function _8e(t,e,r,i){return e=e||t.viewForward,Pe(i,e),Oe(i,i,Math.sign(Qe(e,r))),i}function CEt(t,e,r,i){return IEt(t,e,r,OEt(i,e,r,!0))}function MEt(t,e,r,i){const n=Qe(r,Ve(t,i,e));return ze(t,e,Oe(t,r,n))}const REt={dir:G(),len:0,clip:Ft()};function OEt(t,e,r,i){const n=REt;return t?(r&&i&&(n.len=zn(e,r)),Pe(n.dir,t)):i?(n.len=zn(e,r),Ve(n.dir,r,e),Oe(n.dir,n.dir,1/n.len)):(Ve(n.dir,r,e),Ye(n.dir,n.dir)),n}function PEt(t,e,r){const i=Qe(t,r.dir),n=-kn(t,e);if(n<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return n>0;if((n<0||i<0)&&!(n<0&&i<0))return!0;const s=n/i;return i>0?s<r.clip[1]&&(r.clip[1]=s):s>r.clip[0]&&(r.clip[0]=s),r.clip[0]<=r.clip[1]}function IEt(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let n=0;n<t.length;n++)if(!PEt(t[n],e,i))return!1;return!0}function $Et(t,e,r=k2){const i=Nhe(t,e,r);if(i===0)return!1;const n=t.renderCoordsHelper,s=n.getAltitude(e.eye)+i,o=_8e(e,r.interactionDirection,NEt(t,e,Math.sign(i),BEt),UEt),a=Pe(zEt,e.viewForward),l=n.intersectInfiniteManifold(xp(e.eye,o),s,aY);return e.eye=M(l)?l:n.setAltitude(aY,s,e.eye),e.center=MEt(aY,e.eye,a,e.center),!0}function Nhe(t,e,r=k2){if(!DEt(t,r)||!t.state.constraints.altitude)return 0;const i=FEt(t.state.constraints.altitude,kEt);LEt(t,r,i);const n=t.renderCoordsHelper.getAltitude(e.eye),s=He(n,i.min,i.max)-n;return Math.abs(s)<=1e-6?0:s}function DEt(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==ei.TUMBLE||!wL(e.selection,is.TILT))}function LEt(t,e,r){const i=e.interactionType;if(i===ei.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===ei.TUMBLE||i===ei.ZOOM,c=Nhe(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=n,r.max=s,wz(c,u,l,a,.05*u,r)}function NEt(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),Oe(i,i,r),i}function FEt(t,e){return e.min=t.min,e.max=t.max,e}const kEt={min:0,max:0},UEt=G(),BEt=G(),zEt=G(),aY=G();function Fhe(t,e,r=k2){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;d8.min=0,d8.max=i,GEt(t,r,d8);const n=khe(t,e),s=d8.max-n;return s>=-1e-6?0:s}function VEt(t,e,r=k2){const i=Fhe(t,e,r);if(i===0)return!1;const n=t.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=khe(t,e)+i,o=Pe(HEt,e.eye),a=_8e(e,r.interactionDirection,jEt(e,n.renderLocation,QEt),WEt);if(!sw(Z$e(n.renderLocation,s),xp(e.eye,a),p8))return!1;e.eye=p8;const l=Ve(qEt,e.eye,o);e.center=ze(p8,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,p8);return M(u)&&(e.center=u),!0}function GEt(t,e,r){const i=e.interactionType;if(i===ei.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===ei.ZOOM||i===ei.PAN,c=Fhe(t,o),u=c===0?0:khe(t,o);r.min=n,r.max=s,wz(c,u,l,a,.05*u,r)}function khe(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?zn(e.eye,r.renderLocation):0}function jEt(t,e,r){return y1(r,t.eye,e)}const d8={min:0,max:0},HEt=G(),qEt=G(),WEt=G(),QEt=G(),p8=G();var ws,Ol;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(ws||(ws={}));let YEt=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Ol.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Ol||(Ol={}));let XEt=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},ZEt=class extends XEt{constructor(e,r,i,n){super(e,r,i),this.center=M(n)?Gs(n):null}},v8e=class{constructor(e){this.layerUid=e}},Gj=class extends v8e{constructor(e,r){super(e),this.graphicUid=r}};function qm(t){return M(t)&&M(t.dist)}function Nve(t){return(e,r,i)=>(Eo(Fve,e,r,i),!Lce(t,Fve))}function jj(t){return qm(t)&&t.intersector===ws.OBJECT&&!!t.target}function Hj(t){return qm(t)&&t.intersector===ws.HUD&&!!t.target&&"center"in t.target&&M(t.target.center)}const Fve=G();let JEt=class{constructor(){this._transform=ht(),this._transformInverse=new f8({value:this._transform},Ml,ht),this._transformInverseTranspose=new f8(this._transformInverse,gd,ht),this._transformTranspose=new f8({value:this._transform},gd,ht),this._transformInverseRotation=new f8({value:this._transform},l6e,Es)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Ia(this._transform,e)}multiplyTransform(e){js(this._transform,this._transform,e)}set(e){Ia(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},f8=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},KEt=class{constructor(e=0){this.offset=e,this.tmpVertex=G()}applyToVertex(e,r,i){const n=e+this.localOrigin[0],s=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(n*n+s*s+o*o);return this.tmpVertex[0]=e+n*a,this.tmpVertex[1]=r+s*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(e){for(let s=0;s<3;++s)rv[s]=e[0+s]+this.localOrigin[s],m8[s]=e[3+s]+this.localOrigin[s],n3[s]=rv[s];const r=this.applyToVertex(rv[0],rv[1],rv[2]);for(let s=0;s<3;++s)e[s]=r[s],e[s+3]=r[s];const i=s=>{const o=this.applyToVertex(s[0],s[1],s[2]);for(let a=0;a<3;++a)e[a+0]=Math.min(e[a+0],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let s=1;s<8;++s){for(let o=0;o<3;++o)n3[o]=s&1<<o?m8[o]:rv[o];i(n3)}let n=0;for(let s=0;s<3;++s)rv[s]*m8[s]<0&&(n|=1<<s);if(n!==0&&n!==7){for(let s=0;s<8;++s)if(!(n&s)){for(let o=0;o<3;++o)n[o]?n3[o]=0:n3[o]=s&1<<o?rv[o]:m8[o];i(n3)}}for(let s=0;s<3;++s)e[s+0]-=this.localOrigin[s],e[s+3]-=this.localOrigin[s];return e}};const rv=G(),m8=G(),n3=G();let e3t=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=G(),this._mbs=Ho(),this._obb={center:G(),halfSize:cs(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,r,i){const n=e,s=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(n*n+s*s+o*o);return this._tmpVertex[0]=e+n*a,this._tmpVertex[1]=r+s*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(e){const r=e[0],i=e[1],n=e[2]+this.componentLocalOriginLength,s=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=r*s<0?0:Math.min(Math.abs(r),Math.abs(s)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),u=n*a<0?0:Math.min(Math.abs(n),Math.abs(a)),d=Math.sqrt(l*l+c*c+u*u);if(d<this._totalOffset)return e[0]-=r<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=n<0?this._totalOffset:0,e[3]+=s>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const p=Math.max(Math.abs(r),Math.abs(s)),A=Math.max(Math.abs(i),Math.abs(o)),v=Math.max(Math.abs(n),Math.abs(a)),b=Math.sqrt(p*p+A*A+v*v),S=this._totalOffset/b,E=this._totalOffset/d;return e[0]+=r*(r>0?S:E),e[1]+=i*(i>0?S:E),e[2]+=n*(n>0?S:E),e[3]+=s*(s<0?S:E),e[4]+=o*(o<0?S:E),e[5]+=a*(a<0?S:E),e}applyToMbs(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/r;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/r,this._mbs}applyToObb(e){const r=e.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,Tm(this._obb.halfSize,e.halfSize,e.quaternion),ze(this._obb.halfSize,this._obb.halfSize,e.center);const n=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*n,this._obb.halfSize[1]+=this._obb.halfSize[1]*n,this._obb.halfSize[2]+=this._obb.halfSize[2]*n,Ve(this._obb.halfSize,this._obb.halfSize,e.center),HS(zve,e.quaternion),Tm(this._obb.halfSize,this._obb.halfSize,zve),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},t3t=class{constructor(e=0){this.offset=e,this.sphere=Ho(),this.tmpVertex=G()}applyToVertex(e,r,i){const n=this.objectTransform.transform;let s=n[0]*e+n[4]*r+n[8]*i+n[12],o=n[1]*e+n[5]*r+n[9]*i+n[13],a=n[2]*e+n[6]*r+n[10]*i+n[14];const l=this.offset/Math.sqrt(s*s+o*o+a*a);s+=s*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*s+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*s+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*s+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const n=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*n,r[1]+=r[1]*n,r[2]+=r[2]*n}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/r;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const kve=new t3t;function wne(t){return M(t)?(kve.offset=t,kve):null}const Uve=new e3t;function r3t(t){return M(t)?(Uve.offset=t,Uve):null}const Bve=new KEt;function i3t(t){return M(t)?(Bve.offset=t,Bve):null}const Rb="terrain",zve=n0(),_O=1e-5;let n3t=class{constructor(e){this.options=new YEt,this._results=new s3t,this.transform=new JEt,this.tolerance=_O,this.verticalOffset=null,this._ray=el(),this._rayEnd=G(),this._rayBeginTransformed=G(),this._rayEndTransformed=G(),this.viewingMode=e??wt.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(ylt(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&NB(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===wt.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,ze(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,n,s){this.point=r,this.filterPredicate=n,this.tolerance=i??_O;const o=wne(this.verticalOffset);if(M(e)&&e.length>0){const a=s?l=>{s(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();M(c)?(M(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(u=>a(u))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.transformation,n=wne(this.verticalOffset);for(const s of r){if(!s.visible)continue;const{material:o,id:a}=s;this.transform.setAndInvalidateLazyTransforms(i,s.shaderTransformation),Ot(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Ot(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;M(n)&&(n.objectTransform=this.transform),o.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,d,p,A,v)=>{if(c>=0){if(M(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const b=p?this._results.hud:this._results,S=p?E=>{const R=new ZEt(e,a,d,v);E.set(ws.HUD,R,c,u,wp,A)}:E=>E.set(ws.OBJECT,{object:e,geometryId:a,triangleNr:d},c,u,l,A);if((b.min.drapedLayerOrder==null||A>=b.min.drapedLayerOrder)&&(b.min.dist==null||c<b.min.dist)&&S(b.min),this.options.store!==Ol.MIN&&(b.max.drapedLayerOrder==null||A<b.max.drapedLayerOrder)&&(b.max.dist==null||c>b.max.dist)&&S(b.max),this.options.store===Ol.ALL)if(p){const E=new xne(this._ray);S(E),this._results.hud.all.push(E)}else{const E=new pR(this._ray);S(E),this._results.all.push(E)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?br(r.dist,0)-br(i.dist,0):r.drapedLayerOrder!==i.drapedLayerOrder?br(r.drapedLayerOrder,Number.MAX_VALUE)-br(i.drapedLayerOrder,Number.MAX_VALUE):br(i.drapedLayerGraphicOrder,Number.MIN_VALUE)-br(r.drapedLayerGraphicOrder,Number.MIN_VALUE))}};function e0(t){return new n3t(t)}let s3t=class{constructor(){this.min=new pR(el()),this.max=new pR(el()),this.hud={min:new xne(el()),max:new xne(el()),all:new Array},this.ground=new pR(el()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},pR=class{get ray(){return this._ray}get distanceInRenderSpace(){return M(this.dist)?(Oe(g8,this.ray.direction,this.dist),ct(g8)):null}getIntersectionPoint(e){return!!qm(this)&&(Oe(g8,this.ray.direction,this.dist),ze(e,this.ray.origin,g8),!0)}getTransformedNormal(e){return Pe(xI,this.normal),xI[3]=0,cp(xI,xI,this.transformation),Pe(e,xI),Ye(e,e)}constructor(e){this.intersector=ws.OBJECT,this.normal=G(),this.transformation=ht(),this._ray=el(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=ws.OBJECT,NB(e,this._ray)}set(e,r,i,n,s,o,a){this.intersector=e,this.dist=i,Pe(this.normal,br(n,jOe)),Ia(this.transformation,br(s,wp)),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){NB(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Pe(this.normal,e.normal),Ia(this.transformation,e.transformation)}},xne=class extends pR{constructor(){super(...arguments),this.intersector=ws.HUD}};function Uhe(t){return new pR(t)}const g8=G(),xI=Kr();function b8e(t,e,r,i){return M(t.renderCoordsHelper.fromRenderCoords(e.eye,xz,i))&&sIe(r,xz)}function qj(t,e){return t.elevationProvider?br(t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground"),0):0}function EE(t,e,r,i){const n=t.state.camera.clone();e&&r&&i&&(n.eye=e,n.center=r,n.up=i),o3t(t,n.ray,iv)||Pe(iv,n.center);const s=t.state.constraints,o=s.minimumPoiDistance;if(Cl(n.eye,iv)<o){const a=s.collision.enabled;Pe($w,n.viewForward),Oe($w,$w,o),a?n.eye=Ve(xz,iv,$w):ze(iv,n.eye,$w);const l=t.renderCoordsHelper,c=l.getAltitude(n.eye),u=s.collision.elevationMargin;a&&c<u&&(Ve($w,iv,n.eye),n.eye=l.setAltitude(xz,u,n.eye),ze(iv,n.eye,$w))}return n.center=iv,n}function Vve(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=qj(t,e),n=t.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(e,r,t.renderDataExtent,i,l3t),o=s*s;return Cl(e,r)>o}function o3t(t,e,r){let i=Gve[t.viewingMode];i||(i=e0(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,Gve[t.viewingMode]=i);const{isGlobal:n}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||Vve(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||Vve(t,e.origin,r))||!!n&&a3t(e,r,ln(t.spatialReference).radius)}function a3t(t,e,r){const i=Qe(t.origin,t.origin)-r*r,n=i>0?Math.sqrt(i)/3:1;return Oe(e,t.direction,n/ct(t.direction)),ze(e,e,t.origin),!0}const Gve={},xz=G(),iv=G(),$w=G(),l3t={near:0,far:0};function _P(t,e,r=Of.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const n=qj(t,e.eye),s=t.renderCoordsHelper.getAltitude(e.eye),o=n+i.collision.elevationMargin;if(s>=o)return!1;const a=ct(e.eye);if(Ve(A8,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(c3t,o,e.eye),r===Of.EYE_AND_CENTER)e.center=ze(A8,e.eye,A8);else if(r===Of.EYE_AND_CENTER_SCALE){const l=(a-s+o)/a;e.center=Oe(A8,e.center,l)}return!0}var Of;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Of||(Of={}));const A8=G(),c3t=G();function U2(t,e,r){t.worldUpAtPosition(e,jve),Ve(lY,r,e);const i=ct(lY);return i===0?0:pa(Qe(lY,jve)/i)}const jve=G(),lY=G();function w8e(t,e,r=k2,i=!0){TI.eyeCenterDistance=0,TI.requiresTwoSteps=!1;const n=Bhe(t,e,r,void 0,TI);if(n===0)return!1;switch(bp(y8,-n,e.viewRight),r.tiltMode){case nl.LOOK_AROUND:Ot(nv,e.viewForward,y8),Oe(nv,nv,TI.eyeCenterDistance),e.center=ze(Ob,e.eye,nv);break;case nl.TUMBLE:Ve(nv,e.center,e.eye),Ot(nv,nv,y8),e.eye=Ve(Ob,e.center,nv);break;default:r.tiltMode}return e.up=Ot(Ob,e.up,y8),!TI.requiresTwoSteps||!i||w8e(t,e,r,!1)}function Bhe(t,e,r=k2,i=k2,n){if(!t.state.constraints.tilt)return 0;const s=e.distance,o=t.state.constraints.tilt(s,_3t);return y3t(t,r,o),i.interactionType===ei.TUMBLE&&wL(i.selection,is.ALTITUDE)&&x8e(t,i.interactionStartCamera,o),r.tiltMode===nl.LOOK_AROUND||i.tiltMode===nl.LOOK_AROUND?h3t(t,e,o,n):u3t(t,e,o)}function u3t(t,e,r){const i=U2(t.renderCoordsHelper,e.center,e.eye),n=i-He(i,r.min,r.max);return xL(n)?n:0}function h3t(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return p3t(t,e,r,i);case"local":return d3t(t,e,r,i)}}function d3t(t,e,r,i){const n=U2(t.renderCoordsHelper,e.center,e.eye),s=He(n,r.min,r.max),o=n-s;if(!xL(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(s);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function p3t(t,e,r,i){const n=f3t(t,e,v3t),s=He(n.tiltAtCenter,r.min,r.max);if(!xL(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=m3t(n),a=g3t(n,o)):(o=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=A3t(n,o)),i&&(i.eyeCenterDistance=Tne(n,o)),a}function f3t(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=i+ln(t.spatialReference).radius,s=t.renderCoordsHelper.intersectManifold(e.ray,i,Ob);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,M(s)?(r.eyeCenterDistance=zn(e.eye,s),r.tiltAtCenter=U2(t.renderCoordsHelper,s,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=U2(t.renderCoordsHelper,e.center,e.eye):(oP(KG(ej,n),e.ray,Ob),r.eyeCenterDistance=zn(e.eye,Ob),r.tiltAtCenter=pa(-Qe(e.viewForward,Ye(Ob,Ob)))),r.radius=n,r.eyeRadius=ct(e.eye),r.constraints=t.state.constraints,r}function xL(t){return Math.abs(t)>1e-9}function m3t(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let n=i,s=e.clampTilt(r,i);const o=Tne(t,s);if(e.clampTilt(o,i)===s)return s;let a=0;for(;a<10&&xL(s-n);){const l=(n+s)/2,c=Tne(t,l);xL(e.clampTilt(c,l)-l)?n=l:s=l,a++}return s}function Tne(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-He(e,0,Math.PI),i=jf(t.radius/t.eyeRadius*Math.sin(r)),n=Math.PI-r-i,s=Math.sin(n)/Math.sin(r);if(t.eyeRadius<t.radius&&s>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return s*t.eyeRadius}function g3t(t,e){const r=jf(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=jf(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function A3t(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function y3t(t,e,r){if(e.interactionType===ei.NONE)return;const{interactionStartCamera:i,interactionFactor:n}=e;if(!i)return;const{min:s,max:o}=r,a=Bhe(t,i,k2,e),l=a===0?0:U2(t.renderCoordsHelper,i.center,i.eye);r.min=s,r.max=o,e.interactionType===ei.TUMBLE?(wL(e.selection,is.ALTITUDE)&&x8e(t,i,r),wz(a,l,!0,n,Hve,r)):wz(a,l,!1,n,Hve,r)}function x8e(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const n=vc(e.center),s=Math.sqrt(n),o=e.distance,a=ln(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,u=(l*l-o*o-n)/(-2*s*o),d=(c*c-o*o-n)/(-2*s*o);r.min=Math.max(r.min,Math.min(Math.PI-pa(d),r.max)),r.max=Math.min(r.max,Math.PI-pa(u))}const nv=G(),y8=ht(),Ob=G(),Hve=Dr(5),_3t={min:0,max:0},v3t={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},TI={eyeCenterDistance:0,requiresTwoSteps:!1};function b3t(t){return t}const Wj=t=>t*t,zhe=t=>1-Wj(1-t),w3t=t=>t<.5?Wj(2*t)/2:(zhe(2*(t-.5))+1)/2,Vhe=t=>t*t*t,T8e=t=>1-Vhe(1-t),S8e=t=>t<.5?Vhe(2*t)/2:(T8e(2*(t-.5))+1)/2,Ghe=t=>t*t*t*t,E8e=t=>1-Ghe(1-t),x3t=t=>t<.5?Ghe(2*t)/2:(E8e(2*(t-.5))+1)/2,jhe=t=>t*t*t*t*t,C8e=t=>1-jhe(1-t),T3t=t=>t<.5?jhe(2*t)/2:(C8e(2*(t-.5))+1)/2,Hhe=t=>1-Math.cos(t*Math.PI/2),M8e=t=>1-Hhe(1-t),S3t=t=>t<.5?Hhe(2*t)/2:(M8e(2*(t-.5))+1)/2,qhe=t=>2**(10*(t-1)),iF=t=>1-qhe(1-t),E3t=t=>t<.5?qhe(2*t)/2:(iF(2*(t-.5))+1)/2,Whe=t=>-(Math.sqrt(1-t*t)-1),R8e=t=>1-Whe(1-t),C3t=t=>t<.5?Whe(2*t)/2:(R8e(2*(t-.5))+1)/2;function o0(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function a0(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const M3t=a0(o0(1),1),R3t=a0(o0(1),0),O8e=a0(o0(1),.5),O3t=a0(o0(2),1),P3t=a0(o0(2),0),I3t=a0(o0(2),.5),$3t=a0(o0(3),1),D3t=a0(o0(3),0),L3t=a0(o0(3),.5),N3t=a0(o0(4),1),F3t=a0(o0(4),0),k3t=a0(o0(4),.5),U3t={linear:b3t,"in-quad":Wj,"out-quad":zhe,"in-out-quad":w3t,"in-coast-quad":M3t,"out-coast-quad":R3t,"in-out-coast-quad":O8e,"in-cubic":Vhe,"out-cubic":T8e,"in-out-cubic":S8e,"in-coast-cubic":O3t,"out-coast-cubic":P3t,"in-out-coast-cubic":I3t,"in-quart":Ghe,"out-quart":E8e,"in-out-quart":x3t,"in-coast-quart":$3t,"out-coast-quart":D3t,"in-out-coast-quart":L3t,"in-quint":jhe,"out-quint":C8e,"in-out-quint":T3t,"in-coast-quint":N3t,"out-coast-quint":F3t,"in-out-coast-quint":k3t,"in-sine":Hhe,"out-sine":M8e,"in-out-sine":S3t,"in-expo":qhe,"out-expo":iF,"in-out-expo":E3t,"in-circ":Whe,"out-circ":R8e,"in-out-circ":C3t};function bo(t,e,r=G3t,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let n=!1;for(let a=0;a<j3t;a++){let l=0;for(const c of V3t)if(wL(r.selection,c.type)){const u=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(n=!0,l+=u)}if(l===0)break}const s=wL(r.selection,is.COLLISION),o=B3t(r.interactionType,t);return s&&_P(t,i,o)&&(n=!0),n&&i.computeUp(t.state.viewingMode),n}function B3t(t,e){switch(t){case ei.PAN:return Of.EYE_AND_CENTER;case ei.ASCEND:return e.state.isGlobal?Of.EYE_AND_CENTER_SCALE:Of.EYE_AND_CENTER;default:return Of.EYE}}function im(t){const e=Math.min(1,t/150);return S8e(e)}function z3t(t,e,r){return Bhe(t,e,r)*e.distance}const V3t=[{type:is.TILT,error:z3t,apply:w8e},{type:is.ALTITUDE,error:Nhe,apply:$Et},{type:is.DISTANCE,error:Fhe,apply:VEt}],G3t={selection:is.ALL,interactionType:ei.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:nl.TUMBLE},j3t=5,Ed=G(),xh=G(),sv=G(),cc=G(),Dw=G(),H3t=G(),Cd={upward:pt(0,0,1),forward:pt(0,1,0),sideway:pt(1,0,0)},qve=Es();let Wve=class{constructor(e=wt.Global){this.viewingMode=e,this.center=G(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Gs(Cd.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===wt.Global){const s=(ct(this.center)+ct(e.center))/2;r.pan=ak(this.center,e.center)*s}else r.pan=zn(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const n=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,n),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===wt.Global?$lt(e.center,r.center,i.pan,this.center):Eo(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?Mr(e.distance,r.distance,i.zoom):e.distance,this.pitch=Mr(e.pitch,r.pitch,i.rotate);let n=e.yaw;const s=r.yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this.yaw=Mr(n,s,i.rotate)}copyFrom(e){Pe(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,Pe(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,qve);Pe(this.center,e.center),Ve(cc,e.center,e.eye),nd(cc,cc,r),nd(Dw,e.up,r),this.distance=ct(cc),this.distance!==0&&(cc[0]/=this.distance,cc[1]/=this.distance,cc[2]/=this.distance),this.pitch=this._eyeUpToPitch(cc),this.yaw=this._eyeUpToYaw(cc,Dw),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,qve);Kf(r,r),this._axisAngleVec3(Cd.sideway,this.pitch-Math.PI/2,Cd.forward,cc),this._axisAngleVec3(Cd.upward,this.yaw,cc),this._axisAngleVec3(Cd.sideway,this.pitch-Math.PI/2,Cd.upward,Dw),this._axisAngleVec3(Cd.upward,this.yaw,Dw),Oe(cc,cc,this.distance),nd(cc,cc,r),nd(Dw,Dw,r),e.center=this.center,e.eye=Ve(cc,this.center,cc),e.up=Dw}_axisAngleVec3(e,r,i,n=i){const s=Math.cos(r),o=Math.sin(r);return Oe(Ed,i,s),Kt(xh,e,i),Oe(xh,xh,o),Oe(sv,e,(1-s)*Qe(e,i)),ze(n,ze(n,Ed,xh),sv)}_lookAtOrientation(e,r=Es()){return this._upAtLookAt(e,sv),Kt(Ed,this.lookAtDirection,sv),Ye(Ed,Ed),Ed[0]===0&&Ed[1]===0&&Ed[2]===0&&Pe(Ed,Cd.sideway),Kt(xh,sv,Ed),Ye(xh,xh),r[0]=Ed[0],r[1]=xh[0],r[2]=sv[0],r[3]=Ed[1],r[4]=xh[1],r[5]=sv[1],r[6]=Ed[2],r[7]=xh[2],r[8]=sv[2],r}_upAtLookAt(e,r){return this.viewingMode===wt.Local?Pe(r,Cd.upward):Ye(r,e)}_eyeUpToPitch(e){return Math.PI-ak(Cd.upward,e)}_eyeUpToYaw(e,r){const i=H3t;return Math.abs(r[2])<.5?(Pe(i,r),e[2]>0&&Oe(i,i,-1)):Pe(i,e),Kt(xh,i,Cd.upward),Ye(xh,xh),ak(Cd.sideway,xh,Cd.upward)}};const Tz={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let q3t=class P8e{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:Tz.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new P8e(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:Tz.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},W3t=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,n=0;const s=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),s.hasPan&&!isNaN(r.pan)&&isFinite(s.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/s.compared.pan:r.pan=1,s.hasRotate&&!isNaN(r.rotate)&&isFinite(s.compared.rotate)?r.rotate=(n+l.compared.rotate*r.rotate)/s.compared.rotate:r.rotate=1,s.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,u=this.segments[0].definition.compared.sourceZoom,d=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-u)/(d-u)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,n+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},cY=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,n=r.targetZoom;this._zoomSign=i>n?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const s=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=r.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:n,hasRotate:s}=this.definition;let o=0,a=0;i&&(n&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&n&&s){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else n?this._panPixelFlow=l:i?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);this._time=s?this.rotateTime:i?this.zoomTime:n?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),n=this._interpolateComponentsPan(e),s=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=n,r.rotate=s):r={zoom:i,pan:n,rotate:s},r}};function Q3t(t,e,r){const i=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function Y3t(t,e,r){const i=1/e,n=Math.log(t.compared.sourceZoom*i),s=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*s*o*l*c-t.halfWindowSize*n*s*o*l+t.halfWindowSize*n*s*o*c/(a*a)}function X3t(t,e,r){const i=e-t.compared.sourceZoom,n=1/i,s=1/e,o=Math.log(t.compared.sourceZoom*s),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Z3t(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function J3t(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function K3t(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function eCt(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function tCt(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function rCt(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function iCt(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function nCt(t,e,r){const i=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,s=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*n*s*a+t.halfWindowSize*i*n*s*l/(o*o)+t.halfWindowSize*n*s*a*l/e}function sCt(t,e,r){const i=e-t.compared.targetZoom,n=1/i,s=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function oCt(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function aCt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function lCt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function cCt(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?n*(e-i):n*(e+i)}function uCt(t,e){let r=hCt(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=i.ascensionFactor===0,s=i.descensionFactor===0,o=n?Z3t:Q3t,a=n?J3t:Y3t,l=n?K3t:X3t,c=s?oCt:iCt,u=s?aCt:nCt,d=s?lCt:sCt,p=I=>o(t,I,i)+eCt(t,I,i)+c(t,I,i),A=I=>a(t,I,i)+tCt(t,I,i)+u(t,I,i),v=I=>l(t,I,i)+rCt(t,I,i)+d(t,I,i);let b=p(r);const S=cCt(t);let E;const R=e.maximumIterations||20,O=e.maximumDistance!=null?e.maximumDistance:1/0;for(E=0;E<R;E++){const N=(A(r)+1e-6)/v(r);if(isNaN(N)||r>=O&&N<0){if(!isFinite(O))return null;r=O,b=p(r);break}if(r-=N,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const L=p(r);if(Math.abs(L-b)/b<=.005)break;b=L}return b>S*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function hCt(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let dCt=class extends W3t{constructor(e,r){super(),this._preallocSegments=[new cY,new cY,new cY],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r&&r.apex&&(i=uCt(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=zhe(i.zoom):e===this._descensionSegment&&(i.zoom=Wj(i.zoom)),i}_updateWithApex(e,r){const[i,n,s]=this._preallocSegments,o=(r==null?void 0:r.ascensionFactor)??.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const pCt={zoom:0,pan:0,rotate:0};let fCt=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new q3t(e),this.path=new dCt}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(cRe(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing?i.easing:this._time>=1e3?O8e:iF}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,pCt);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const n=r.minDuration!=null?r.minDuration:Tz.minDuration/i,s=r.maxDuration!=null?r.maxDuration:Tz.maxDuration/i;return Math.min(Math.max(n,e),s)}};const mCt=G();let gCt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new fCt(()=>new Wve(e)),this._current=new Wve(e)}update(e,r,i){const n=this._animation.definition.source,s=this._animation.definition.target,o=Ve(mCt,r.center,e.center),a=ct(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),Pe(n.lookAtDirection,o),Pe(s.lookAtDirection,o),n.copyFromRenderCamera(e),s.copyFromRenderCamera(r),this._current.copyFrom(n),this._animation.update(n,s,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new mr,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+cRe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};var Ls;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(Ls||(Ls={}));let A_=class extends rt{constructor(e){super(e),this.state=Ls.Ready}get active(){return this.state===Ls.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Ls.Stopped,!0)}finishController(){this.state=Ls.Finished}get steppingFinished(){return!1}};h([f({constructOnly:!0})],A_.prototype,"view",void 0),h([f({readOnly:!0})],A_.prototype,"active",null),h([f()],A_.prototype,"state",void 0),h([f({readOnly:!0})],A_.prototype,"isInteractive",null),A_=h([Q("esri.views.3d.state.controllers.CameraController")],A_);let TL=class extends A_{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(en()),this._asyncResult=null),this.state===Ls.Finished||this.state===Ls.Stopped?(fG(e),this.state===Ls.Finished?e.resolve():e.reject(en())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Ls.Running,M(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!M(this.viewAnimation)||this.state!==Ls.Ready&&this.state!==Ls.Running||(this.viewAnimation.state===dO.State.FINISHED?this.finish():this.viewAnimation.state===dO.State.STOPPED&&(this.state=Ls.Stopped))}onControllerEnd(){M(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===Ls.Finished?this.viewAnimation.finish():this.state===Ls.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Ls.Finished?this._asyncResult.resolve():this._asyncResult.reject(en()))}finish(){this.finishController()}};TL=h([Q("esri.views.3d.state.controllers.AnimationController")],TL);let R_=class extends TL{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new gCt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new dO}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);_8.copyFrom(this.view.state.camera);const n=e0(this.view.state.viewingMode);this.intersectionHelper.intersectRay(_8.ray,n,Qve)&&(_8.center=Qve),this.animation.update(_8,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?U3t[e.easing]:e.easing}}};h([f({constructOnly:!0})],R_.prototype,"mode",void 0),h([f({readOnly:!0})],R_.prototype,"isInteractive",null),R_=h([Q("esri.views.3d.state.controllers.PointToPointAnimationController")],R_);const _8=new mr,Qve=G();function Qj(t=yCt){return[t[0],t[1],t[2],t[3]]}function SL(t,e){return ACt(t[0],t[1],t[2],e,Cce.get())}function ACt(t,e,r,i,n=Qj()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function Qhe(t,e,r){return Kt(r,t,e),Ye(r,r),r[3]=Oce(t,e),r}const yCt=[0,0,1,0];function I8e(t,e,r){return _Ct(t,t.screenToRender(e,Et.get()),r)}function _Ct(t,e,r){const i=$a(Et.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const n=$a(Et.get(),e);n[2]=1;const s=t.unprojectFromRenderScreen(n,Et.get());return k(s)?null:(Ve(r.direction,s,r.origin),r)}function vP(t,e,r){return Yhe(t,t.screenToRender(e,Et.get()),r)}function Yhe(t,e,r){Pe(r.origin,t.eye);const i=Le(Et.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(i,Et.get());return k(n)?null:(Ve(r.direction,n,r.origin),r)}function Xhe(t,e,r,i){const n=vP(e,r,vCt);return sw(t,n,i)}const vCt=el();var vO;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(vO||(vO={}));const $8e=30,Sz=[1,3e8],Yj=80,D8e=8,L8e=200,N8e=1508e5,F8e=5,k8e=50,bCt=5,wCt=10,uY=90,CE={exclude:new Set([Rb])};function nS(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function Sne(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function B2(t,e,r){const i=bp(Mce.get(),r[3],r);k(i)||t$e(i,wp)||(Ve(wn,t.eye,e),Ot(wn,wn,i),t.eye=ze(wn,wn,e),Ve(wn,t.center,e),Ot(wn,wn,i),t.center=ze(wn,wn,e),t.up=Ot(wn,t.up,i))}function xCt(t,e,r,i){return bE(t,I8e(e,r,Khe),i)}function Ene(t,e,r,i){return bE(t,vP(e,r,Khe),i)}function Zhe(t,e,r,i){const n=Et.get();let s=1-r;Ve(n,e,t.eye);const o=ct(n);let a=o*(1-s);s>=0&&a<i&&(a=i,s=-(a-o)/o),Math.abs(o-a)<1e-6||(Oe(n,n,s),t.eye=ze(wn,t.eye,n),t.center=Eo(wn,t.center,e,s))}function U8e(t,e,r){e.getScreenCenter(Yve),Xhe(t,e,Yve,wn)&&(e.center=wn);const i=e.distance,n=i*r;if(Math.abs(i-n)<1e-6)return;const s=Oe(Et.get(),e.viewForward,n);e.eye=Ve(wn,e.center,s)}const Yve=Ns();function hY(t,e){Le(e,0,0,0);for(const r of t)ze(e,e,r);Oe(e,e,1/t.length)}function Jk(t,e,r,i){return Math.sin(t/ct(e))*(r+i.radius)}function Xve(t,e,r,i){return Jk(Math.PI/2,e,r,i)+(t-Math.PI/2)}var tl;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(tl||(tl={}));const Zve={Elevation:3e4,Angle:Dr(16)},v8={Pole:.95,Angle:Dr(18),Tilt:45},B8e=Dr(80);function z8e(t,e,r,i,n,s){const o=G(),a=Ho();let l=!0,c=!0;return t.intersectScreen(r,o,s)?a[3]=ct(o):(c=!1,e.aboveGround&&n!==vO.Ellipsoid?a[3]=Math.max(ct(e.center),.9*i.radius):a[3]=ct(e.eye)-e.relativeElevation,n===vO.Silhouette?EL(a,e,r,o):l=Xhe(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function Xj(t,e,r){return ct(t.eye)-r.radius>Zve.Elevation?tl.Horizontal:(vP(t,e,sbe),-Math.sign(t.relativeElevation)*(.5*Math.PI+Oce(t.eye,sbe.direction))<Zve.Angle?tl.Vertical:tl.Horizontal)}function V8e(t,e,r){Ve(dY,r,e),t.eye=Ve(wn,t.eye,dY),t.center=Ve(wn,t.center,dY)}const dY=G();function EL(t,e,r,i){const n=vP(e,r,Khe);return!k(n)&&(oP(t,n,b8),sw(t,n,i)?!(Cl(b8,n.origin)<Cl(i,n.origin))||(Pe(i,b8),!1):(Ve(s3,e.eye,e.center),Ye(s3,s3),s4e(s3,-Qe(Ye(s3,s3),b8),Jve),bE(Jve,n,i),!1))}const b8=G(),s3=G(),Jve=Xi();function G8e(t,e,r,i,n,s){let o=0;if(Kt(Mz,t,e),Ve(S8,t,e),ct(t)<=n||!i.aboveGround){Kt(r,S8,i.eye);const a=Qe(t,e)/(ct(t)*ct(e));if(a<.9999)o=pa(a);else{const c=ct(Kt(G(),t,e))/(ct(t)*ct(e));o=jf(c)}const l=Math.cos(He(C2.normalize(Dr(s)),0,B8e));o=-o-Math.max(0,ct(e)-n)/(l*n)}else Ve(Kve,i.eye,i.center),Kt(r,S8,Kve),o=-ct(S8)/n;return Ye(r,r),Oe(r,r,ct(Mz)),o}const Kve=G();function ebe(t,e,r,i){let n,s;const o=Math.cos(He(C2.normalize(Dr(i)),0,B8e));return n=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):pa(e/r),s=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):pa(t/r),(s-n)*r}function TCt(t,e,r,i,n,s,o,a,l,c){const u=ebe(t[2],e[2],s[3],a),d=l?ebe(t[0],e[0],s[3],180):e[0]-t[0],p=Math.sin(o)*d-Math.cos(o)*u,A=Math.cos(o)*d+Math.sin(o)*u;Ye(wn,n);const v=l?p/Math.sqrt(Math.abs(s[3]**2-Qe(r,wn)**2)):p/s[3],b=A/Math.sqrt(Math.abs(s[3]**2-Qe(r,i)**2));ti(c,v,b)}function j8e(t,e,r,i,n,s,o,a,l,c){Kt(Mz,t,e),lte(s.up,s.eye,w8,x8,T8),lte([0,0,1],s.eye,V_,A2,Q8e),Pe(r,A2),Pe(i,V_),Ye(r,r),Oe(r,r,ct(Mz)),eAe(t,Ye(x8,x8),Ye(T8,T8),Ye(w8,w8),tbe),eAe(e,x8,T8,w8,rbe),TCt(tbe,rbe,t,V_,A2,o,a,l,c,n)}function SCt(t,e,r,i,n,s,o){bp(Ez,n,i),bp(Cz,o,s),js(CM,Ez,Cz),Ve(e,t,r),Ot(e,e,CM),ze(e,e,r)}function H8e(t,e,r,i,n,s){bp(Ez,i,r),bp(Cz,s,n),js(CM,Ez,Cz),Ve(wn,t.eye,e),Ot(wn,wn,CM),t.eye=ze(wn,wn,e),Ve(wn,t.center,e),Ot(wn,wn,CM),t.center=ze(wn,wn,e),Ve(wn,t.up,e),Ot(wn,wn,CM),t.up=ze(wn,wn,e)}function Jhe(t,e,r,i,n,s){return(Math.abs(i)>Math.PI-v8.Angle||Math.abs(i)<v8.Angle)&&(Math.abs(t[2])<r*v8.Pole||Math.abs(e)>r)&&s.aboveGround&&n<v8.Tilt}function q8e(t,e,r,i,n,s){if(s)Qhe(r,i,ibe),B2(e,t,ibe);else{const o=G8e(r,i,nbe,e,t[3],n);B2(e,t,SL(nbe,o))}}function W8e(t,e,r,i,n,s,o){const a=o?20:1,l=1e-12;let c,u;Pe(Lw,i),E8.copyFrom(e);for(let d=0;d<a&&Cl(r,Lw)>l&&(c=Cl(r,Lw),j8e(r,Lw,A2,V_,SI,E8,t,n,s,o),H8e(E8,t,V_,SI[1],A2,SI[0]),SCt(Lw,Lw,t,V_,SI[1],A2,SI[0]),u=Cl(r,Lw),u<c||d===0);d++)e.copyFrom(E8)}function ECt(t,e,r,i,n,s,o){Jhe(r,Qe(e.up,r),t[3],-C2.normalize(Dr(n)),s,e)?W8e(t,e,r,i,-C2.normalize(Dr(n)),s,o):q8e(t,e,r,i,s,o)}function CCt(t,e,r,i,n,s){const{eye:o}=t;lte([0,0,1],o,V_,A2,Q8e);const a=e.translation[0]*r.pan,l=n.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-Qe(t.center,V_)**2/ct(t.center)**2)),.5),u=(Math.sin(s)*l+Math.cos(s)*a)/c,d=-Math.cos(s)*l+Math.sin(s)*a;switch(sd(i.pan.matrix,i.pan.matrix,u,V_),i.pan.enabled=!0,n.mode){case"pan":sd(i.pan.matrix,i.pan.matrix,d,A2),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function MCt(t,e,r,i,n){const{eye:s,viewRight:o}=t,a=Kt(Et.get(),o,s),l=e.translation[0]*r.pan;switch(l!==0&&(sd(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),n.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(sd(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function RCt(t,e,r,i,n,s,o,a,l){Jhe(t.center,Qe(t.up,t.center),ct(t.center),-C2.normalize(Dr(s)),o,e)?CCt(e,r,i,a,l,-C2.normalize(Dr(n))):MCt(e,r,i,a,l)}const V_=G(),A2=G(),Q8e=G(),w8=G(),x8=G(),T8=G(),tbe=G(),rbe=G(),SI=Ft(),ibe=Qj(),Ez=ht(),Cz=ht(),CM=ht(),Lw=G(),wn=G(),S8=G(),E8=new mr,Mz=G(),nbe=G(),Khe={origin:G(),direction:G()},sbe={origin:G(),direction:G()},obe=.6,pY=4,OCt=60;let Rz=class extends R_{constructor(){super(...arguments),this._zoomLocation=G(),this._tmpCamera=new mr,this._tmpViewDir=G(),this._tmpRayDir={origin:G(),direction:G()},this._targetOnSphere=G(),this._tmpCenter=G(),this._constraintOptions={selection:is.ALL_EXCEPT_COLLISION,interactionType:ei.ZOOM,interactionFactor:null,interactionStartCamera:new mr,interactionDirection:null,tiltMode:nl.TUMBLE},this._sphere=Ho()}initialize(){this._intersector=e0(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(i.camera):this.animation.cameraAt(1,n));let s=!1,o=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?CE:{})&&(s=e>0,o=!0),this._tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:Pe(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:iF}}_updateCamera(e,r,i,n,s){const o=ln(this.view.spatialReference),a=Xj(e,n,o),l=Math.abs(this.view.camera.position.z);Ye(M8,e.eye),Oe(M8,M8,-1),vP(e,n,this._tmpRayDir),Ye(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=He(Math.min(D8e,1/Math.abs(Qe(M8,this._tmpRayDir.direction)))*l,L8e,N8e);if(a===tl.Horizontal){let u=obe**r;this._sphere[3]=ct(i),Ve(this._tmpViewDir,e.center,e.eye);const d=Math.min(ct(this._tmpViewDir),c);let p=d*u;if(u<=1&&p<pY&&(p=pY,u=p/d),Math.abs(d-p)<1e-6)return;const A=ct(e.center);if(this._sphere[3]!==A){const v=this._sphere[3]+u*(A-this._sphere[3]);e.center=Oe(C8,e.center,v/A)}Oe(this._tmpViewDir,this._tmpViewDir,-u),e.eye=ze(C8,e.center,this._tmpViewDir),bo(this.view,e,this._constraintOptions),Cl(i,e.center)>1e-12&&Xhe(this._sphere,e,n,this._targetOnSphere)&&ECt(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let u=obe**Math.abs(r);const d=r>0?1:-1;Ve(this._tmpViewDir,i,e.eye);const p=ct(this._tmpViewDir),A=this.view._stage.renderView.getMinimalDepthForArea(null,n[0],n[1],this.view.state.camera,OCt);let v=M(A)?A:c;v=s&&r>0?Math.min(v,p):v,Oe(this._tmpRayDir.direction,this._tmpRayDir.direction,v),ze(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let b=v*u;const S=Math.max(pY,1.01*e.nearFar[0]);if(r>0&&b<S&&(b=S,u=b/v),Math.abs(v-b)<1e-6)return;Oe(this._tmpRayDir.direction,this._tmpRayDir.direction,d*(1-u)),e.eye=ze(C8,e.eye,this._tmpRayDir.direction),e.center=ze(C8,e.center,this._tmpRayDir.direction)}_P(this.view,e)}};Rz=h([Q("esri.views.3d.state.controllers.global.ZoomStepController")],Rz);const C8=G(),M8=G(),PCt=.6,ICt=4,$Ct=60;let Oz=class extends R_{constructor(){super(...arguments),this._zoomLocation=G(),this._tmpCamera=new mr,this._tmpRayDir=G(),this._tmpCenter=G(),this._constraintOptions={selection:is.ALL,interactionType:ei.ZOOM,interactionFactor:null,interactionStartCamera:new mr,interactionDirection:null,tiltMode:nl.TUMBLE}}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(i.camera):this.animation.cameraAt(1,n)),this._tmpCamera.copyFrom(i.camera);const s=e0(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?CE:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:Pe(this._zoomLocation,this._tmpCamera.center);const a=PCt**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r[0],r[1],this.view.state.camera,$Ct);Ve(R8,this._tmpCamera.eye,this._zoomLocation),Ye(R8,R8);const c=He(Math.min(D8e,1/Math.abs(Qe(DCt,R8)))*Math.abs(this.view.camera.position.z),L8e,N8e);if(l=M(l)?l:c,l){const u=G();Ve(u,this._zoomLocation,this._tmpCamera.eye),(l<ct(u)||!o)&&(Ye(u,u),ze(this._zoomLocation,this._tmpCamera.eye,Oe(u,u,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:iF}}_updateCamera(e,r,i){Ve(this._tmpRayDir,i,e.eye);const n=ct(this._tmpRayDir);let s=n*r;const o=r<=1,a=Math.max(ICt,1.01*e.nearFar[0]);s!==0&&(o&&s<a&&(s=a,r=s/n),Math.abs(n-s)<1e-6||(Oe(this._tmpRayDir,this._tmpRayDir,r),e.eye=Ve(abe,i,this._tmpRayDir),e.center=Eo(abe,e.center,i,1-r),bo(this.view,e,this._constraintOptions)))}};Oz=h([Q("esri.views.3d.state.controllers.local.ZoomStepController")],Oz);const abe=G(),DCt=pt(0,0,1),R8=G();function LCt(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function ede(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let NCt=class extends Il{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(LCt(r,"primary")){const i=this._view.state.isGlobal?new Rz({view:this._view,mode:"animation"}):new Oz({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Ns(r.x,r.y)),e.stopPropagation()}}};function FCt(t,e,r){return t===wt.Global?new UCt(r):new kCt(e,r)}let kCt=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=ln(r),this._unitInMeters=Eu(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,n,s){var O;s||(s={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-n,c=(O=this._elevationProvider)==null?void 0:O.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(i=M(i)?i:new an({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},d=Math.max(u.x,u.y,u.z);Ve(Nw,r,e),o3[0]=Nw[0]>0?i.xmax:i.xmin,o3[1]=Nw[1]>0?i.ymax:i.ymin,o3[2]=Nw[2]>0?d/2:-d/2,Ve(o3,o3,e),Ye(Nw,Nw);const p=1.1*Qe(o3,Nw)*this._unitInMeters,A=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),v=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),b=v*VCt*this._unitInMeters,S=v*GCt*this._unitInMeters,E=He((o-S)/(b-S),0,1)**3,R=Math.min(Mr(A,p,E),A)*Math.max(Math.log(Math.abs(l)),1);return Y8e(Math.min(R,Math.max(34064e4,d))/this._unitInMeters,BCt,this._unitInMeters,s)}},UCt=class{constructor(e){this._referenceEllipsoid=ln(e)}compute(e,r,i,n,s){s||(s={near:0,far:0});const o=ct(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,n),c=Math.abs(a-n),u=Math.max(c,Math.abs(a)),d=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return Y8e(1.2*Mr(d,p,Jue(u)),He(2e4-(Math.log(u)-7.983)/9.011*19e3,1e3,2e4),1,s)}};function Y8e(t,e,r,i){const n=zCt/r;return t/e>n?(i.far=t,i.near=i.far/e):(i.near=n,i.far=i.near*e),i}const BCt=2e4,zCt=2,VCt=.001,GCt=1e-4,o3=G(),Nw=G();let Kk=class extends rt{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;M(e.spatialReference)&&b8e(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>_P(this.view,e,Of.EYE_AND_CENTER))}};h([f({constructOnly:!0})],Kk.prototype,"view",void 0),Kk=h([Q("esri.views.3d.state.ElevationCollisionConstraint")],Kk);let P4=class extends rt{constructor(e){super(e),this.nearFarHeuristic=FCt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([xe(()=>{var e,r,i,n;return[(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.near,(n=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:n.far]},()=>this._clipDistanceNearFarChanged()),xe(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),xe(()=>this.view.renderDataExtent,()=>this._updateNearFar(),fn),xe(()=>{var e,r,i,n;return[(r=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:r.min,(n=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:n.max]},()=>this._updateAltitude(),fn),xe(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.max},()=>this._updateTiltMax(),fn),xe(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.mode},()=>this._updateTilt(),fn),xe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),fn),xe(()=>{var e,r,i,n,s,o;return[(i=(r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.navigationConstraint)==null?void 0:i.type,(o=(s=(n=this.view.state)==null?void 0:n.constraints)==null?void 0:s.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),fn)]),this.view.state.isLocal&&this.addHandles(xe(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Rr)),this._updateNearFar(),this.view.state.viewingMode!==wt.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new Kk({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var r;const e=(r=this.view.constraints)==null?void 0:r.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,qj(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){var n,s,o;const e=(o=(s=(n=this.view.map)==null?void 0:n.ground)==null?void 0:s.navigationConstraint)==null?void 0:o.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(is.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==wt.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(Dr(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(xu(i))}}_updateLocalSurfaceDistance(e){if(k(e))return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,n=3*r/Math.atan(i.camera.fov/2);n!==i.constraints.distance&&(i.constraints.distance=n)}_reapplyConstraints(e=is.ALL){this.view.state.updateCamera(r=>bo(this.view,r,{selection:e,interactionType:ei.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:nl.TUMBLE}))}};h([f({constructOnly:!0})],P4.prototype,"view",void 0),h([f({readOnly:!0})],P4.prototype,"surfaceCollisionConstraint",void 0),P4=h([Q("esri.views.3d.state.ConstraintsManager")],P4);let Pb=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=_L(),this._points=y6e(),this.lines=new Array(12),this._origin=G(),this._direction=G(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:G(),endpoint:null}}update(e){_6e(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),Pe(this._origin,e.eye),Pe(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)Pe(this._points[r],e[r]);v6e(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return Zb(this.frustum,e)}intersectsRay(e){return Fxt(this.frustum,e)}intersectsLineSegment(e,r){return kxt(this.frustum,e,r)}intersectsPoint(e){return b6e(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;fY(this.lines[r],e[r],e[i]),fY(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),fY(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function fY(t,e,r){t.origin=e,t.endpoint=r,y1(t.direction,e,r)}Pb.planePointIndices=Uxt,Pb.nearFarLineIndices=[[jt.NEAR_BOTTOM_LEFT,jt.FAR_BOTTOM_LEFT],[jt.NEAR_BOTTOM_RIGHT,jt.FAR_BOTTOM_RIGHT],[jt.NEAR_TOP_RIGHT,jt.FAR_TOP_RIGHT],[jt.NEAR_TOP_LEFT,jt.FAR_TOP_LEFT]];let z5=class extends A_{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e),this._handles=new cn}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Ls.Running,this._handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this._handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){M(e.spatialReference)&&!b8e(this.view,this.desiredCamera,e.extent,e.spatialReference)||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),_P(this.view,e,Of.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Ls.Stopped)})}};h([f({constructOnly:!0})],z5.prototype,"desiredCamera",null),z5=h([Q("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],z5);const jCt=G(),O8=G();function tde(){return{direction:G(),up:G()}}function X8e(t,e,r,i,n){let s=Ye(jCt,t),o=Qe(s,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(Qe(e,i)),o<.99?(Pe(s,e),a&&Oe(s,s,-1)):s=null);let l=0;if(s){Oe(O8,i,Qe(i,s)),Ve(s,s,O8);const u=Qe(s,n)/(ct(s)*ct(n));Kt(O8,s,n),l=(Qe(O8,i)>0?1:-1)*xu(pa(u))}const c=xu(pa(-Qe(i,t)/ct(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const Z8e=pt(0,1,0),J8e=pt(0,0,1),EI=ht(),yy=G(),_y=G();function K8e(t,e,r,i=tde()){const{direction:n,up:s}=i;return QIe(EI,-Dr(e)),ZR(EI,EI,Dr(r)),Ot(n,J8e,EI),Oe(n,n,-1),Ot(s,Z8e,EI),i}function HCt(t,e,r,i){return X8e(e,r,i,J8e,Z8e)}function qCt(t,e,r,i){const n=K8e(t,r,i),s=G();return Oe(s,n.direction,-e),ze(s,s,t),{up:n.up,eye:s,heading:r,tilt:i}}function WCt(t){return xu(t)}function QCt(t){return Dr(t)}function e9e(t,e,r,i,n){const s=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return nc(e,yy,s),nc(e,_y,s),yy[0]-=r/2,_y[0]+=r/2,yy[1]-=i/2,_y[1]+=i/2,il(yy,s,yy,o),il(_y,s,_y,o),n?(n.xmin=yy[0],n.ymin=yy[1],n.xmax=_y[0],n.ymax=_y[1],n.spatialReference=o):n=new an(yy[0],yy[1],_y[0],_y[1],o),n}const YCt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:HCt,eyeForCenterWithHeadingTilt:qCt,eyeTiltToLookAtTilt:QCt,headingTiltToDirectionUp:K8e,lookAtTiltToEyeTilt:WCt,toExtent:e9e},Symbol.toStringTag,{value:"Module"})),t9e=pt(0,0,1),r9e=Ye(G(),pt(1,1,1)),XCt=new E2(-180,180),CI=ht(),yb=G(),a3=G();function i9e(t,e,r,i=tde()){Kt(yb,t,t9e),Qe(yb,yb)===0&&Kt(yb,t,r9e),bp(CI,-Dr(e),t),sd(CI,CI,-Dr(r),yb);const{up:n,direction:s}=i;return Kt(n,yb,t),Ye(n,n),Ot(n,n,CI),Ye(s,t),Cc(s,s),Ot(s,s,CI),i}function ZCt(t,e,r,i){const n=yb,s=a3;return Ye(n,t),Kt(a3,n,t9e),Qe(a3,a3)===0&&Kt(a3,n,r9e),Kt(s,a3,n),X8e(e,r,i,n,s)}function JCt(t,e,r,i){const n={eye:G(),up:null,tilt:i,heading:r},s=yb;s[0]=t[0],s[1]=t[2],s[2]=-t[1];const o=e,a=Dr(r),l=Dr(i),c=Math.sin(a),u=Math.cos(a),d=Math.sin(l),p=Math.cos(l),A=ct(s);let v;if(Math.abs(l)<1e-8)v=o+A;else{const te=A/d,j=jf(o/te),H=Math.PI-l-j;v=te*Math.sin(H)}const b=p*o,S=o*o*(d*d),E=u*u*S,R=v-b,O=R*R,I=E*(E+O-s[1]*s[1]);if(I<0)return Oe(n.eye,s,v/A),n.tilt=0,P8(n,t);const N=Math.sqrt(I),L=s[1]*R,B=E+O;let U;if(U=u>0?-N+L:N+L,Math.abs(B)<1e-8)return A<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):Oe(n.eye,s,v/A),n.tilt=0,mY(n.eye),P8(n,t);n.eye[1]=U/B;const q=c*c*S,Z=d*o,X=u*Z*n.eye[1],ee=n.eye[1]*n.eye[1],se=1-ee,ue=Math.sqrt(se),re=E*ee+q-2*X*ue*R+se*O;return Math.abs(re)<1e-8?(Oe(n.eye,s,v/A),n.tilt=0,mY(n.eye),P8(n,t)):(n.eye[0]=(se*(v*s[0]-b*s[0])-Z*ue*(s[0]*n.eye[1]*u+s[2]*c))/re,n.eye[2]=(se*(v*s[2]-b*s[2])-Z*ue*(s[2]*n.eye[1]*u-s[0]*c))/re,Oe(n.eye,n.eye,v),mY(n.eye),P8(n,t))}function mY(t){const e=t[1];t[1]=-t[2],t[2]=e}function P8(t,e){const r=i9e(e,t.heading,t.tilt);return t.up=r.up,t}function KCt(t,e,r){const i=ct(e),n=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),s=jf(r/(n/Math.sin(t)));return xu(t-s)}function eMt(t,e,r){const i=Dr(t),n=ct(e);return jf(r/(n/Math.sin(i)))+i}function n9e(t,e,r,i,n){let s,o,a,l;const c=e.latitude,u=ln(t.spatialReference).radius,d=e.longitude,p=cEt(c,r,u)/2;s=d-p,o=d+p;const A=Dr(c),v=(1+Math.sin(A))/(1-Math.sin(A)),b=(v+1)*Math.tan(i/u/2),S=b*b;function E(O){const I=Math.PI/2;return(O=Lnt.normalize(O,-I))>I&&(O=Math.PI-O),O}if(a=1.5*Math.PI-2*Math.atan(.5*(b+Math.sqrt(4*v+S))),l=a+i/u,a=E(a),l=E(l),l<a){const O=l;l=a,a=O}if(a=Math.max(xu(a),-90),l=Math.min(xu(l),90),o=XCt.monotonic(s,o),o-s>180){const O=(o-s-180)/2;s+=O,o-=O}const R=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:St.WGS84;return n?(n.xmin=s,n.ymin=a,n.xmax=o,n.ymax=l,n.spatialReference=R):n=new an(s,a,o,l,R),t.spatialReference&&t.spatialReference.isWebMercator&&N_(n,!1,n),n}const tMt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:ZCt,eyeForCenterWithHeadingTilt:JCt,eyeTiltToLookAtTilt:eMt,headingTiltToDirectionUp:i9e,lookAtTiltToEyeTilt:KCt,toExtent:n9e},Symbol.toStringTag,{value:"Module"}));function Pz(t){return t.type==="point"}let s9e=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function o9e(t){return"array"in t}function hA(t,e,r="ground"){if(Pz(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(o9e(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,br(e.spatialReference,t.spatialReference),r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function Iz(t,e){return t!=null&&(e==null||(e===wt.Local?!t.isGeographic||t.isWGS84||t.wkid===Sf.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===Sf.CGCS2000||t.wkid===Sf.GCSMARS2000||t.wkid===Sf.GCSMARS2000_SPHERE||t.wkid===Sf.GCSMOON2000))}const a9e=we.getLogger("esri.views.3d.support.cameraUtils"),l9e=39.37,c9e=96,Cne=1,rMt=8,iMt=5,u9e=1,lbe=G(),nMt={heading:0,tilt:0},Ib=new Ht,sMt=new E2(-20037508342788905e-9,20037508342788905e-9),oMt=new E2(-180,180);var Zl;function nF(t){return t.spatialReference||St.WGS84}function bP(t){return t.viewingMode==="global"?tMt:YCt}function aMt(t,e,r,i,n){return bP(t).headingTiltToDirectionUp(e,r,i,n)}function d_(t,e){if(k(e))return null;const r=t.renderSpatialReference,i=bP(t).headingTiltToDirectionUp,n=G();if(!nc(e.position,n,r))return null;const s=i(n,e.heading,e.tilt);Oe(s.direction,s.direction,t.state.camera.distance),ze(s.direction,s.direction,n);const o=EE(t,n,s.direction,s.up);return o.fov=Dr(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Zl||(Zl={}));const l3=G();function bO(t,e,r){const i=t.renderSpatialReference,n=Zj(t,e.eye,e.viewForward,e.up,nMt);let s=nF(t);return il(e.eye,i,l3,s)||(s=St.WGS84,il(e.eye,i,l3,s)),k(r)?new qf(new Ht(l3,s),n.heading,n.tilt,xu(e.fov)):(r.position.x=l3[0],r.position.y=l3[1],r.position.z=l3[2],r.position.spatialReference=s,r.heading=n.heading,r.tilt=n.tilt,r.fov=xu(e.fov),r)}function rde(t,e,r){const i=t.state.camera,n=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===wt.Global&&r!=null&&(e*=Math.cos(Dr(r))),e/=t.renderCoordsHelper.unitInMeters,n/(c9e*l9e/e)/Math.tan(i.fovX/2)}function WS(t,e,r){const i=t.state.camera,n=e*Math.tan(i.fovX/2),s=i.width/2/i.pixelRatio;let o=c9e*l9e/(s/n);return t.renderCoordsHelper.viewingMode===wt.Global&&r!=null&&(o/=Math.cos(Dr(r))),o*=t.renderCoordsHelper.unitInMeters,o}function h9e(t,e,r,i,n,s){return d9e(t,e,rde(t,r,e.latitude),i,n,s)}function d9e(t,e,r,i,n,s){if(sS(s)){const a=new wP(s.signal);return CL(t,i.heading,i.tilt,e,r,n,a),void a.resolver.promise.then(l=>{const c=Dz(t,l,i.fov);if(!k(c))return s.resolver.resolve(c);s.resolver.reject()},l=>s.resolver.reject(l))}const o=CL(t,i.heading,i.tilt,e,r,n);return Dz(t,o,i.fov,s)}function Zj(t,e,r,i,n){return bP(t).directionToHeadingTilt(e,r,i,n)}function lMt(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,Ib,t.spatialReference)&&t.elevationProvider&&br(hA(t.elevationProvider,Ib),0)>(Ib.z??0)-u9e)}async function cMt(t,e,r){if(!t.renderCoordsHelper.fromRenderCoords(e,Ib,t.spatialReference)||!t.elevationProvider)return!1;const i=Ib.z??0,n=await t.elevationProvider.queryElevation(Ib.x,Ib.y,i,Ib.spatialReference,"ground",r);return br(n,0)>i-u9e}async function uMt(t,e,r){const i=G();if(e)if(e instanceof Ht){if(nc(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const n=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",r);return M(n)&&t.renderCoordsHelper.setAltitude(i,n),i}}else Pe(i,e);else Pe(i,t.state.camera.center);return i}function hMt(t,e){const r=G();if(e&&e instanceof Ht){if(nc(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const i=hA(t.elevationProvider,e);M(i)&&t.renderCoordsHelper.setAltitude(r,i)}}else Pe(r,e||t.state.camera.center);return r}function CL(t,e,r,i,n,s,o){const a=i&&i instanceof Ht?i:null;if(sS(o))return uMt(t,i,o.signal).then(c=>{Mne(t,e,r,a,c,n,s,o)},c=>o.resolver.reject(c)),null;const l=hMt(t,i);return Mne(t,e,r,a,l,n,s,o)}function Mne(t,e,r,i,n,s,o,a){if(k(i)){const d=t.renderSpatialReference;if(i=O2(n,d,nF(t)),k(i))return null}s=Math.max(s,t.state.constraints.minimumPoiDistance);const l=fMt(t,e,r,n,s,o),c=(0,bP(t).eyeForCenterWithHeadingTilt)(n,s,l.heading,l.tilt);if(o===Zl.ADJUST&&t.viewingMode==="global"&&r>0){const d=()=>{const A=p9e(t,n,s,gMt(t,s,r,n));return o=r-A<1?Zl.LOCKED:Zl.ADJUST,Mne(t,e,A,i,n,s,o,a)},p=t.map.ground.navigationConstraint;if(!p||p.type==="stay-above"){if(lMt(t,c.eye))return d();if(sS(a))return cMt(t,c.eye,a.signal).then(A=>A?d():(a.resolver.resolve({eye:c.eye,up:c.up,center:Gs(n),heading:c.heading,tilt:c.tilt}),null)),null}}const u=!a||sS(a)?{center:G(),eye:G(),up:G(),tilt:0,heading:0}:a;return u.eye=c.eye,u.up=c.up,u.center=Gs(n),u.heading=c.heading,u.tilt=c.tilt,sS(a)&&a.resolver.resolve(u),u}function V5(t,e,r,i,n,s=null){let o,a,l;if(t.state.isGlobal){if(!Iz(e.spatialReference,wt.Global))return sS(s)&&s.resolver.reject(),null;const S=new Ht(e.xmin,e.ymin,e.spatialReference),E=new Ht(e.xmax,e.ymax,e.spatialReference),R=e.spatialReference.isGeographic?oMt:sMt;o=new Ht({x:R.center(S.x,E.x),y:(E.y+S.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const O=ln(e.spatialReference),I=lEt(o,S,E);a=I.lon,l=I.lat,R.diff(S.x,E.x)>R.range/2&&(a+=O.halfCircumference),a=Math.min(a,O.halfCircumference),l=Math.min(l,O.halfCircumference)}else{const S=br(t.renderSpatialReference,e.spatialReference);S.equals(e.spatialReference)||(e=vE(e,S)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const E=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new Ht({x:e.xmin+.5*a,y:e.ymin+.5*l,z:E,spatialReference:S})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,u=t.state.camera,d=1/Math.tan(u.fovX/2),p=1/Math.tan(u.fovY/2),A=1/Math.tan(u.fov/2),v=Math.max(.5*a*d,.5*l*p,.5*c*A)/Cne;if(sS(s)){const S=new wP(s.signal);return CL(t,r,i,o,v,n,S),void S.resolver.promise.then(E=>{const R=Dz(t,E,t.camera.fov);if(!k(R))return s.resolver.resolve(R);s.resolver.reject()},E=>s.resolver.reject(E))}const b=CL(t,r,i,o,v,n);return Dz(t,b,t.camera.fov,s)}function dMt(t,e,r){const i=t.renderSpatialReference,n=O2(r,i,nF(t));if(k(n))return null;const s=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=EN(e.eye,r),l=2*a*s*Cne,c=2*a*o*Cne;return t.viewingMode==="global"?n9e(t,n,l,c):e9e(t,n,l,c)}function pMt(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>rMt)return!0;const n=t.renderSpatialReference,s=nF(t),o=O2(e,n,s),a=O2(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,s);if(k(o)||k(a))return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>iMt}function fMt(t,e,r,i,n,s){let o=0;return s===Zl.ADJUST&&pMt(t,i,n)?(e=0,o=mMt(t,n,r,i)):o=ide(t,i,n,r),o=t.state.constraints.clampTilt(n,o),{heading:e,tilt:r=p9e(t,i,n,o)}}const $z=.7;function mMt(t,e,r,i){const n=ide(t,i,e,r);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-$z)+s.max*$z;return Math.min(n,o)}function gMt(t,e,r,i){let n=ide(t,i,e,r);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);return n=Math.min(n,.5*Math.PI),s.min*(1-$z)+n*$z}function p9e(t,e,r,i){return bP(t).lookAtTiltToEyeTilt(i,e,r)}function ide(t,e,r,i){return bP(t).eyeTiltToLookAtTilt(i,e,r)}function Dz(t,e,r,i){if(k(e))return null;const n=t.renderSpatialReference,s=O2(e.eye,n,nF(t));return k(s)?null:M(i)?(i.position=s,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):new qf(s,e.heading,e.tilt,r)}function AMt(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(e);a9e.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function f9e(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(e);a9e.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function m9e(t,e){return il(e.center,t.renderSpatialReference,lbe,St.WGS84),WS(t,e.distance,lbe[1])}let wP=class{constructor(e){this.signal=e,this.resolver=T2()}};function sS(t){return t&&"resolver"in t}const yMt=.66;function g9e(t){return 360-qle.normalize(t)}function Jj(t){return qle.normalize(360-t)}function MI(t){return M(t)&&t.resolver&&t.resolver.reject(),null}function _Mt(t,e){return M(t)&&t.resolver&&t.resolver.resolve(e),e}function A9e(t,e,r,i=null){if(!e)return MI(i);const n=t.spatialReference||St.WGS84;if(M(e.camera)){const c=ew(e.camera.position,n);if(k(c))return MI(i);const u=e.camera.clone();return u.position=c,_Mt(i,u)}if(k(e.targetGeometry))return MI(i);const s=e.get("targetGeometry.spatialReference");if(s&&!u2(s,n))return MI(i);const o=bO(t,t.state.camera);let a=Zl.ADJUST;if(e.rotation!=null&&(o.heading=g9e(e.rotation),a=Zl.LOCKED),r!=null&&(o.tilt=r),e.targetGeometry.type==="point"){const c=e.targetGeometry;let u;const d=e.targetGeometry.clone();return u=e.scale!=null?rde(t,e.scale,c.latitude):t.state.camera.distance,d9e(t,d,u,o,a,i)}const l=e.targetGeometry.extent;return l?V5(t,l,o.heading,o.tilt,a,i):MI(i)}function vMt(t,e,r=null){return k(r)&&(r=new Dm),ode(t,null,e.clone(),r)}async function bMt(t,e,r){const i=PMt(t,e);if(!i)throw new pe("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new qf({fov:t.camera.fov}),s=new Dm({camera:n});if(i.target instanceof Dm)return Fw(await TMt(t,i.target,i,r,s));if(i.target instanceof qf)return Fw(_9e(t,i.target,s));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof an){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return Fw(o||c?await Rne(t,i,i.target.center,n,r,s):await MMt(t,i,i.target,n,r,s))}const a={boundingBox:qn(),hasZ:!1,screenSpaceObjects:[]},l=o?wMt(t,i):void 0;if(await y9e(t,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(um(a.boundingBox,_o),Xd.x=_o[0],Xd.y=_o[1],Xd.z=_o[2],Xd.spatialReference=t.spatialReference,isFinite(Xd.z)&&a.hasZ?c=oce(a.boundingBox):(Xd.z=void 0,c=Qst(sce(a.boundingBox,$Mt))),o||c)return Fw(await Rne(t,i,Xd,n,r,s));const u=IMt(t,a.screenSpaceObjects);return Fw(await OMt(t,i,Xd,a.boundingBox,u,n,r,s))}return i.position?Fw(EMt(t,i,n,s)):Fw(await CMt(t,i,n,r,s))}function nde(t,e){return e.scale==null&&e.zoom!=null?f9e(t,e.zoom):e.scale}function wMt(t,e){const r=nde(t,e);return r?yct(r):void 0}function sde(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=g9e(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function ode(t,e,r,i){const n=t.spatialReference||St.WGS84;return e=M(e)?e:d_(t,r),k(e)||(i.targetGeometry=O2(e.center,t.renderSpatialReference,n),i.scale=m9e(t,e),i.rotation=Jj(r.heading),i.camera=r),i}function Lz(t,e,r){var a,l;const i=()=>new pe("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw i();if(!u2(e.spatialReference,t.spatialReference))throw new pe("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=t.spatialReference)==null?void 0:a.wkid})`,{geometry:e});const n=[];if(!e.hasZ&&t.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&M(t.basemapTerrain.spatialReference)&&u2(c,t.basemapTerrain.spatialReference)&&t.elevationProvider?_o[2]=br(hA(t.elevationProvider,c),0):_o[2]=0}(0,DMt[e.type])(e,c=>{n.push(c[0],c[1],c[2])},_o);const s=n.length/3;if(s===0)throw i();const o=new Array(n.length);if(qs(n,e.spatialReference,0,o,t.spatialReference,0,s)){e.hasZ&&(r.hasZ=!0);for(let c=0;c<o.length;c+=3)e.hasZ?(_o[0]=o[c+0],_o[1]=o[c+1],_o[2]=o[c+2]):(_o[0]=o[c+0],_o[1]=o[c+1]),kA(r.boundingBox,_o)}}async function xMt(t,e,r,i){const n=await Pm(t.whenViewForGraphic(e));if(n.ok===!1||k(n.value)||!("whenGraphicBounds"in n.value))return void Lz(t,e.geometry,i);const s=n.value,o=await Pm(s.whenGraphicBounds(e,{minDemResolution:r}));if(o.ok===!1)return void Lz(t,e.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;YR(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function y9e(t,e,r,i){var n;if(Array.isArray(e)&&e.length===2){const s=e[0],o=e[1];if(typeof s=="number"&&typeof o=="number")return Xd.x=s,Xd.y=o,Xd.z=void 0,Xd.spatialReference=(n=t.spatialReference)!=null&&n.isGeographic?t.spatialReference:St.WGS84,void Lz(t,Xd,i)}e&&typeof e.map=="function"?await fh(e.map(s=>y9e(t,s,r,i))):e instanceof K2?Lz(t,e,i):e instanceof Pl&&await xMt(t,e,r,i)}async function TMt(t,e,r,i,n){if(M(e.camera))return _9e(t,e.camera,n);n.scale=e.scale,n.rotation=e.rotation,n.targetGeometry=M(e.targetGeometry)?e.targetGeometry.clone():null,n.camera=null,r.heading!=null?n.rotation=Jj(r.heading):r.rotation!=null&&(n.rotation=r.rotation);const s=nde(t,r);s!=null&&(n.scale=s);const o=new wP(i);return A9e(t,n,r.tilt,o),n.camera=await o.resolver.promise,n}function _9e(t,e,r){const i=t.spatialReference,n=ew(e.position,i);return k(n)?null:((e=e.clone()).fov=t.camera.fov,e.position=n,ode(t,null,e,r))}function SMt(t,e,r,i,n,s){const o=t.renderSpatialReference;return nc(r,$8,o),nc(e,gY,o),s.targetGeometry=new Ht(e),n.position=new Ht(r),Ve(Nz,gY,$8),Zj(t,$8,Nz,i.up,n),s.scale=WS(t,zn($8,gY),s.targetGeometry.latitude),s.rotation=Jj(n.heading),s.camera=n,s}async function Rne(t,e,r,i,n,s){if(k(r))throw new pe("createfromcenter","invalid point");s.targetGeometry=r.clone();const o=EE(t);if(e.position)return SMt(t,s.targetGeometry,e.position,o,i,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=Oe(_o,o.viewForward,-l);o.eye=ze(_o,o.center,c),s.scale=WS(t,l,r.latitude)}bO(t,o,i);const a=sde(i,e)?Zl.LOCKED:Zl.ADJUST;if(!e.zoomFactor){const l=nde(t,e);l==null?(nc(r,_o,t.renderSpatialReference),b6e(o.frustum,_o)?s.scale=WS(t,zn(o.eye,_o),r.latitude):s.scale=m9e(t,o)):s.scale=l;const c=new wP(n);h9e(t,s.targetGeometry,s.scale,i,a,c),s.camera=await c.resolver.promise}return s}function EMt(t,e,r,i){const n=EE(t);return Pe(Nz,n.viewForward),Zj(t,n.eye,Nz,n.up,AY),r.position=new Ht(e.position),r.heading=e.heading!=null?e.heading:AY.heading,r.tilt=e.tilt!=null?e.tilt:AY.tilt,ode(t,null,r,i)}async function CMt(t,e,r,i,n){const s=EE(t);return Rne(t,e,O2(s.center,t.renderSpatialReference,t.spatialReference),r,i,n)}async function MMt(t,e,r,i,n,s){s.targetGeometry=r.clone();const o=EE(t);bO(t,o,i);const a=sde(i,e)?Zl.LOCKED:Zl.ADJUST,l=new wP(n);return V5(t,r,i.heading,i.tilt,a,l),s.camera=await l.resolver.promise,s}function RMt(t,e,r,i,n){let s=0;r.z!=null?s=r.z:t.basemapTerrain&&t.elevationProvider&&(s=hA(t.elevationProvider,r)),Le(_o,r.x,r.y,s),Lm(t.spatialReference,_o,cbe,t.renderSpatialReference),Jf(I8,cbe),Kf(I8,I8),qn(RI);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let v=0;v<o.length;v++){const b=o[v];let S=i[b[2]];isFinite(S)||(S=s),Le(_o,i[b[0]],i[b[1]],S),il(_o,t.spatialReference,_o,t.renderSpatialReference),kA(RI,nd(_o,_o,I8))}const a=mE(RI),l=rw(RI),c=gE(RI),u=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),p=.5*Math.sqrt(a*a+c*c)*Math.max(d,u)+.5*l,A=.5*l*d+.5*Math.max(a,c);return Math.max(p,A)/n}async function OMt(t,e,r,i,n,s,o,a){a.targetGeometry=r.clone();const l=EE(t),c=RMt(t,l,r,i,n);bO(t,l,s);const u=sde(s,e)?Zl.LOCKED:Zl.ADJUST;a.scale=WS(t,c,a.targetGeometry.latitude);const d=new wP(o);return h9e(t,a.targetGeometry,a.scale,s,u,d),a.camera=await d.resolver.promise,a}function PMt(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};if("declaredClass"in e||Array.isArray(e))r.target=e;else{for(const i in e)r[i]=e[i];e.center&&!r.target&&(r.target=e.center)}return r}function Fw(t){return t&&M(t.camera)&&(t.rotation=Jj(t.camera.heading)),t}function IMt(t,e){const r=yMt;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n].screenSpaceBoundingRect;i=Math.max(i,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return r-i/Math.min(t.width,t.height)*2}const _o=G(),cbe=ht(),I8=Es(),RI=fa(),$Mt=oi(),Nz=G(),$8=G(),gY=G(),AY={heading:0,tilt:0},Xd=new Ht,DMt={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let n=0;n<t.rings.length;n++){const s=t.rings[n];for(let o=0;o<s.length;o++)r[0]=s[o][0],r[1]=s[o][1],i&&(r[2]=s[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];for(let o=0;o<s.length;o++)r[0]=s[o][0],r[1]=s[o][1],i&&(r[2]=s[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,n=t.hasZ;for(let s=0;s<i.length;s++)r[0]=i[s][0],r[1]=i[s][1],n&&(r[2]=i[s][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(Le(r,t.xmin,t.ymin,t.zmin)),e(Le(r,t.xmax,t.ymin,t.zmin)),e(Le(r,t.xmin,t.ymax,t.zmin)),e(Le(r,t.xmax,t.ymax,t.zmin)),e(Le(r,t.xmin,t.ymin,t.zmax)),e(Le(r,t.xmax,t.ymin,t.zmax)),e(Le(r,t.xmin,t.ymax,t.zmax)),e(Le(r,t.xmax,t.ymax,t.zmax))):(e(Le(r,t.xmin,t.ymin,r[2])),e(Le(r,t.xmax,t.ymin,r[2])),e(Le(r,t.xmin,t.ymax,r[2])),e(Le(r,t.xmax,t.ymax,r[2])))},mesh(t,e,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(i)for(let n=0;n<i.length;n+=3)e(Le(r,i[n+0],i[n+1],i[n+2]))}};let LMt=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;const o=new AbortController;M(this.options.signal)&&Sc(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,r){return this._promise.then(e,r)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&M(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(en())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await QD(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,bMt(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(!k(r))if(this.options.animate){if(k(this._animationController))return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var s;const r=!!(this.target instanceof Dm&&this.target.camera||this.target instanceof qf),i=e.camera;if(k(i))return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(s=this.view.spatialReference)==null?void 0:s.wkid;return this.reject(new pe("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const n=d_(this.view,i);return k(n)?(this.reject(new pe("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:n,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(k(i))return void this.reject(new pe("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||k(r.viewAnimation)||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let n;e.isFullySpecified?(n=new z5({view:this.view,desiredCamera:e.camera}),_P(this.view,e.camera,Of.EYE_AND_CENTER)):bo(this.view,e.camera),r.begin(e.camera,this.options);const s=()=>{const a=this.view.state.cameraController;n&&(a&&a.active?a instanceof R_&&M(a.viewAnimation)&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=n):M(r.viewAnimation)&&r.viewAnimation.target===e.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=n))},o=a=>{if(!k(this.view.state))switch(r.state){case Ls.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Ls.Ready:case Ls.Rejected:case Ls.Running:case Ls.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(s,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof R_&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new R_({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(M(r)&&r.stop(),this.reject(new pe("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},Xo=class extends rt{get camera(){const e=this._get("camera");if(!this.ready)return e;const r=bO(this.view,this.view.state.camera,yY);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){var r,i;this._updatePropertyBeforeReady("camera",e)||((r=this.view.elevationProvider)==null||r.enableElevationCache(!0),this.setStateCamera(d_(this.view,e),{applyConstraints:!1})||we.getLogger(this.declaredClass).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=bO(this.view,this.view.state.contentCamera,yY);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=d_(this.view,e);k(r)?this.view.state.contentCamera=null:(this._updateElevation(r),this.view.state.contentCamera=r)}installContentCameraReset(e){if(this.removeHandles(_Y),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,n=sh(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([xe(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(_Y),this.test.contentCameraResetState.clear())}),xe(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),xe(()=>this.view.state.camera,o=>{const a=Cl(n,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],_Y),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var r;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():we.getLogger(this.declaredClass).error("#center=","Invalid center",e):we.getLogger(this.declaredClass).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):we.getLogger(this.declaredClass).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=dMt(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return M(r)?r:this._get("extent")}set extent(e){var r;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||we.getLogger(this.declaredClass).error("#extent=","Invalid extent",e):we.getLogger(this.declaredClass).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):we.getLogger(this.declaredClass).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return WS(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||we.getLogger(this.declaredClass).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,n=this._get("padding"),s=Math.round(r[si.TOP]/i),o=Math.round(r[si.RIGHT]/i),a=Math.round(r[si.BOTTOM]/i),l=Math.round(r[si.LEFT]/i);return n!=null&&n.top===s&&n.right===o&&n.bottom===a&&n.left===l?n:{top:s,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,D8),this.view.state.updateCamera(r=>r.padding=D8))}_paddingToArray(e,r,i){e?pn(i,e.top||0,e.right||0,e.bottom||0,e.left||0):pn(i,0,0,0,0);for(let n=0;n<4;n++)i[n]=Math.round(i[n]*r)}get screenCenter(){const e=this.padding;return Qf((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?vMt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var r;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||we.getLogger(this.declaredClass).error("#viewpoint=","Invalid viewpoint",e);else{const i=M(e.camera)?e.camera.position:e.targetGeometry,n=M(i)&&i.spatialReference;we.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(n?n.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e)}else we.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?AMt(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||we.getLogger(this.declaredClass).error("#zoom=","Invalid zoom",e)}get _pixelRatio(){var e;return M(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRendering?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,(e=this.view)==null?void 0:e.qualitySettings.maximumPixelRatio)}get _rasterPixelRatio(){return M(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,r;return((r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer.isFeatureEnabled(Ao.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var r,i;const e=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled(Ao.PhysicalPixelRendering,Mi.IDLE)||e.isFeatureEnabled(Ao.PhysicalPixelRendering,Mi.INTERACTING)||e.isFeatureEnabled(Ao.PhysicalPixelRendering,Mi.ANIMATING))}constructor(e){super(e),this._propertiesPool=new a1({frustum:Pb},this),this._cameraSetByUser=!1,this._gotoOperation=null,this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._cameraChangeTime=0,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(r){this.viewStateManager._updatingIgnoreRenderState=r},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||M(this.renderState)}}}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Bo(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),xe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,r)=>this._cameraChangedHandler(e,r),fn)]),ic(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([NR({prepare:()=>this._prepareFrame()}),xe(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(L8)}),Bo(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=yt(this._propertiesPool)}init(){this.constraintsManager=new P4({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===wt.Local&&this.addHandles(ic(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(L8),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),L8)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(L8),this.constraintsManager=yt(this.constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return M(this._gotoOperation)&&this._gotoOperation.abort(i.animate),this._gotoOperation=new LMt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(EE(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r==null?void 0:r.cameraController;i&&(r.updateCamera(n=>i.stepController(e,n)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){M(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:n}of FMt){const s=e.has(i),o=this._isOverridden(i);!s&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||o)&&n.forEach(a=>e.add(a))}return r}_setInitialView(e){if(k(e)||this._cameraSetByUser)return;if(e instanceof qf)return void this.setStateCamera(d_(this.view,e),{applyConstraints:!1});if(e instanceof Dm){if(e.targetGeometry instanceof an){const s=V5(this.view,e.targetGeometry,0,.5,Zl.LOCKED);return void(M(s)&&this.setStateCamera(d_(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},n=this._viewpointToCamera(e);return void this.setStateCamera(n,i)}const r=V5(this.view,e,0,.5,Zl.LOCKED);M(r)&&this.setStateCamera(d_(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&NMt.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!k(e)&&(e instanceof Dm?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof qf?this.isCompatible(e.position):e.spatialReference&&u2(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=kMt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=ov){const{heading:n,tilt:s}=this._getPreservingHeadingTilt(),o=CL(this.view,n,s,e,r,Zl.ADJUST);return k(o)?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),n=V5(this.view,e,r,i,Zl.ADJUST,yY);return n?d_(this.view,n):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,n=r.location.latitude;if(n==null)return null;const s=rde(this.view,e,n);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(f9e(this.view,e))}_viewpointToCamera(e){return d_(this.view,A9e(this.view,e))}setStateCamera(e,r){return!(k(e)||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&bo(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new z5({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._pixelRatio,n=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);if(n!==0&&s!==0&&(r.width===n&&r.height===s||(r.width=n,r.height=s),this.view.state)){const o=this.view.state.camera;o.fullWidth===n&&o.fullHeight===s&&o.pixelRatio===i||(ov.copyFrom(o),ov.pixelRatio!==i&&(this._paddingToArray(this.padding,i,D8),ov.padding=D8),ov.fullWidth=n,ov.fullHeight=s,ov.pixelRatio=i,this.view.state.camera=ov),this._updateViewState()}}_updateElevation(e){var s;const r=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=((s=this.view.renderCoordsHelper)==null?void 0:s.getAltitude(e.eye))??0,n=r?qj(this.view,e.eye):0;e.relativeElevation=i-n}_updateViewState(){M(this.test.renderState)?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Mi.ANIMATING:this.view.interacting?this.view.state.mode=Mi.INTERACTING:(this.view.state.mode===Mi.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=UMt?this.view.state.mode=Mi.INTERACTING:this.view.state.mode=Mi.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio,this.view.state.contentPixelRatio=Math.min(this._pixelRatio,this.view.qualitySettings.maximumPixelRatio)}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};h([f({type:qf,dependsOn:["view.state.camera","ready"]})],Xo.prototype,"camera",null),h([f({type:qf,dependsOn:["view.state.contentCamera","ready"]})],Xo.prototype,"contentCamera",null),h([f({type:Ht})],Xo.prototype,"center",null),h([f({type:an})],Xo.prototype,"extent",null),h([f({readOnly:!0})],Xo.prototype,"frustum",null),h([f({readOnly:!0})],Xo.prototype,"hasInitialView",null),h([f({readOnly:!0,type:Boolean})],Xo.prototype,"ready",void 0),h([f({type:Number})],Xo.prototype,"scale",null),h([f()],Xo.prototype,"padding",null),h([f({readOnly:!0})],Xo.prototype,"screenCenter",null),h([f({constructOnly:!0})],Xo.prototype,"view",void 0),h([f({type:Dm})],Xo.prototype,"viewpoint",null),h([f({type:Number})],Xo.prototype,"zoom",null),h([f({readOnly:!0})],Xo.prototype,"_pixelRatio",null),h([f({readOnly:!0})],Xo.prototype,"_rasterPixelRatio",null),h([f({readOnly:!0})],Xo.prototype,"_usePhysicalPixelRendering",null),h([f({readOnly:!0})],Xo.prototype,"_usePhysicalPixelRenderingAny",null),h([f()],Xo.prototype,"_windowDevicePixelRatio",void 0),h([f()],Xo.prototype,"_devicePixelRatioOverride",void 0),Xo=h([Q("esri.views.3d.state.ViewStateManager")],Xo);const NMt=["camera","viewpoint","extent","scale","center","zoom"],FMt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],kMt={heading:0,tilt:0},yY=new qf,ov=new mr,D8=Kr(),L8="pending-initial-view",_Y="content-camera-reset",UMt=300,ube=100;let dA=class extends A_{constructor(){super(...arguments),this.startCamera=new mr,this.currentCamera=new mr,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<ube}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=Ls.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),ube),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};h([f({readOnly:!0})],dA.prototype,"isInteractive",null),h([f()],dA.prototype,"_lastInteraction",void 0),dA=h([Q("esri.views.3d.state.controllers.InteractiveController")],dA);var Hh;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Hh||(Hh={}));let G5=class extends dA{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Hh.CENTER,this._rotScale=0,this._lastPoint=Ft(),this._tmpWorldUp=G(),this._tmpViewDir=G(),this._tmpRotCurPoint=Ft(),this._tmpTransf=ht(),this._tmpAxis=G(),this._tmpPivotPoint=G(),this._pivotPos=G(),this._constraintOptions={selection:is.ALL,interactionType:ei.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:nl.TUMBLE}}initialize(){this._rotScale=this.pivot===Hh.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Hh.EYE:Pe(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=ei.LOOK_AROUND,this._constraintOptions.tiltMode=nl.LOOK_AROUND,this._constraintOptions.selection=is.NONE;break;case Hh.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?CE:{});r||Pe(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=ei.TUMBLE,this._constraintOptions.tiltMode=nl.TUMBLE,this._constraintOptions.selection=is.ALL&~is.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,nS(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,n=G();Ve(n,this._pivotPos,i.eye);const s=ct(n),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,hbe);let a=Math.max(Math.min(bCt,1/Math.abs(Qe(hbe,i.viewForward)))*o,wCt);r&&(a=Math.min(s,a));const l=ln(this.view.spatialReference),c=Ns(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),u=Xj(this.startCamera,c,l);let d=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*uY,uY),p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,uY);(M(d)||M(p))&&(d=br(d,p),p=k(p)||u===tl.Horizontal?d:p,a=d>p?p:d,a=r?Math.min(a,s):a),Ye(n,n),Pe(this._pivotPos,ze(this._tmpPivotPoint,i.eye,Oe(this._tmpPivotPoint,n,a)))}update(e){if(this.active){switch(this.pivot){case Hh.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Hh.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}bo(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,n){this.view.renderCoordsHelper.worldUpAtPosition(n,this._tmpWorldUp),nS(e,r,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;Ve(this._tmpViewDir,i,n);const a=ct(this._tmpViewDir),l=pa(Qe(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===Hh.EYE){s*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;s=c-Math.max(-u,Math.min(u,c+s))}return s=He(s+l,Hl.min,Hl.max)-l,Kt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Hh.CENTER&&(o=-o),bp(this._tmpTransf,o,this._tmpWorldUp),sd(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),Ot(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Ot(vY,e.up,this._tmpTransf),ze(vY,n,this._tmpViewDir),$a(this._lastPoint,this._tmpRotCurPoint),vY}};h([f()],G5.prototype,"pivot",void 0),G5=h([Q("esri.views.3d.state.controllers.RotateController")],G5);const vY=G(),hbe=G();let bY=class extends Il{constructor(e,r,i,n){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!ede(e.data,this.pointerAction))return;const i=Ns(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new G5({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},One=class extends dA{constructor(){super(...arguments),this._pickPoint=G(),this._tmpP0=Ft(),this._panAxisAngle=Qj(),this._tmpRayDir=G(),this._tmpRayDirPick=G(),this._targetOnSphere=G(),this._navMode=tl.Horizontal,this._tmpRay={origin:G(),direction:G()},this.dragBeginPoint=Ns(),this._normalizedAnchorPoint=Ft(),this._constraintOptions={selection:is.ALL_EXCEPT_COLLISION,interactionType:ei.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:nl.TUMBLE},this._sphere=Ho(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;$a(this.dragBeginPoint,e),nS(this.startCamera,e,this._normalizedAnchorPoint);const r=ln(this.view.spatialReference),i=z8e(this._intersectionHelper,this.startCamera,e,r,vO.Ellipsoid,this.view.map.ground.opacity===0?CE:{});if(this._navMode=Xj(this.startCamera,e,r),this._navMode===tl.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=br(i.scenePickPoint,this._pickPoint),this._sphere=i.sphere;else{let n;vP(this.startCamera,e,this._tmpRay),Ye(this._tmpRay.direction,this._tmpRay.direction),M(i.scenePickPoint)&&(Ve(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),n=ct(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,dbe);let o=He(Math.min($8e,1/Math.abs(Qe(dbe,this._tmpRay.direction)))*s,Sz[0],Sz[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,Yj);o=M(a)?a:o,o=n!=null?Math.min(o,n):o,this._hasPickPoint=!0,Oe(this._tmpRay.direction,this._tmpRay.direction,o),ze(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===tl.Horizontal){Ve(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=ct(this._tmpRayDir);nS(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=r*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&n<s&&(n=s),Math.abs(r-n)<1e-6)return;if(this._hasPickPoint&&n<r){const o=1-(1-n/r)*(1-this._sphere[3]/ct(this.currentCamera.center));this.currentCamera.center=Oe(N8,this.currentCamera.center,o)}Oe(this._tmpRayDir,this._tmpRayDir,-n/r),this.currentCamera.eye=ze(N8,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=im(US(this.dragBeginPoint,e)),bo(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(EL(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Qhe(this._pickPoint,this._targetOnSphere,this._panAxisAngle),B2(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=ct(this._tmpRay.direction);nS(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=r*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&n<s&&(n=s),Math.abs(r-n)<1e-6)return;Oe(this._tmpRayDir,this._tmpRay.direction,1-n/r),this.currentCamera.eye=ze(N8,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=ze(N8,this.currentCamera.center,this._tmpRayDir)}_P(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};One=h([Q("esri.views.3d.state.controllers.global.ZoomController")],One);const N8=G(),dbe=G();let Pne=class extends dA{constructor(){super(...arguments),this._tmpP=G(),this._tmpDir=G(),this._tmpN=G(),this._tmpP0=Ft(),this._tmpPoi=G(),this._tmpRayDir=G(),this.dragBeginPoint=Ns(),this._normalizedAnchorPoint=Ft(),this._constraintOptions={selection:is.ALL,interactionType:ei.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:G(),tiltMode:nl.TUMBLE},this._plane=Xi()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;$a(this.dragBeginPoint,e),nS(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?CE:{});Ve(this._tmpDir,this._tmpP,this.startCamera.eye);const i=ct(this._tmpDir);Ye(this._tmpDir,this._tmpDir);const n=Math.abs(this.view.camera.position.z);let s=He(Math.min($8e,1/Math.abs(Qe(BMt,this._tmpDir)))*n,Sz[0],Sz[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,Yj);s=M(o)?o:s,s=r?Math.min(s,i):s,Oe(this._tmpDir,this._tmpDir,s),ze(this._tmpP,this.startCamera.eye,this._tmpDir),Ve(this._tmpN,this.startCamera.eye,this.startCamera.center),Ye(this._tmpN,this._tmpN),this._tmpN[1]<0&&Cc(this._tmpN,this._tmpN),LN(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;xCt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||Pe(this._tmpPoi,this.currentCamera.center),nS(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);$a(this._normalizedAnchorPoint,this._tmpP0),Ve(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=ct(this._tmpRayDir);let n=i*(1-r);this._constraintOptions.interactionDirection&&(Pe(this._constraintOptions.interactionDirection,this._tmpRayDir),Oe(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const s=this.view.state.constraints.minimumPoiDistance;r>=0&&n<s&&(n=s,r=-(n-i)/i),Math.abs(i-n)<1e-6||(Oe(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=ze(kw,this.currentCamera.eye,this._tmpRayDir),Eo(kw,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?kw[2]=Math.max(this.startCamera.center[2],kw[2]):kw[2]=Math.min(this.startCamera.center[2],kw[2]),this.currentCamera.center=kw,this._constraintOptions.interactionFactor=im(US(this.dragBeginPoint,e)),bo(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};Pne=h([Q("esri.views.3d.state.controllers.local.ZoomController")],Pne);const kw=G(),BMt=pt(0,0,1);let zMt=class extends Il{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!ede(e.data,this.pointerAction))return;const i=Ns(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new One({view:this._view}):this._cameraController=new Pne({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function f0(t){let e=t*t;return t<0&&(e*=-1),e}function pbe(t,e,r){const i=r,n=t.state,s=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return s.deviceType==="standard"?(i.translation[0]=f0(n.axes[0]),i.translation[1]=f0(n.axes[1]),i.translation[2]=f0(n.buttons[7])-f0(n.buttons[6]),i.heading=f0(n.axes[2]),i.tilt=f0(n.axes[3])):s.deviceType==="spacemouse"&&(i.translation[0]=1.2*f0(n.axes[0]),i.translation[1]=1.2*f0(n.axes[1]),i.translation[2]=2*-f0(n.axes[2]),i.heading=1.2*f0(n.axes[5]),i.tilt=1.2*f0(n.axes[3])),i.tilt*=o,Oe(i.translation,i.translation,a),i}function fbe(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function wY(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let BT=class extends dA{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new mr,this._headingStart=0,this._constraintOptions={selection:is.ALL,interactionType:ei.NONE,interactionStartCamera:new mr,interactionFactor:0,interactionDirection:null,tiltMode:nl.LOOK_AROUND}}handleEventGamepad(e){const r=pbe(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||wY(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,fbe(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=fbe(this._keysButtonState,this._transformation);wY(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Uw),this._applyDisabledMovementTypes(Uw),this._applyPan(Uw.pan),this._applyRotate(Uw.rotate),this._applyZoom(Uw.zoom),this._applyAscend(Uw.ascend),this._constraintOptions.interactionType=ei.NONE,this._constraintOptions.selection=is.COLLISION,bo(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;Ve(Iu,r.center,r.eye),Ot(Iu,Iu,e.matrix),r.center=ze(Iu,Iu,r.eye),r.up=Ot(Iu,r.up,e.matrix),this._constraintOptions.interactionType=ei.LOOK_AROUND,this._constraintOptions.selection=is.ALL_EXCEPT_COLLISION,bo(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=Ot(Iu,r.eye,e.matrix),r.center=Ot(Iu,r.center,e.matrix),this.view.state.isGlobal&&(r.up=Ot(Iu,r.up,e.matrix)),this._constraintOptions.interactionType=ei.PAN,this._constraintOptions.selection=is.ALL,bo(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=ze(Iu,this.currentCamera.eye,Oe(Et.get(),r,e)),Pe(OI,r),Cc(OI,OI),this._constraintOptions.interactionDirection=OI,this._constraintOptions.interactionType=ei.ZOOM,this._constraintOptions.selection=is.ALL_EXCEPT_COLLISION,bo(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Et.get());if(this._constraintOptions.interactionDirection=Pe(OI,r),this.view.state.isGlobal){const i=ct(this.currentCamera.eye),n=(i+e)/i;this.currentCamera.eye=Oe(Iu,this.currentCamera.eye,n),this.currentCamera.center=Oe(Iu,this.currentCamera.center,n)}else{const i=Oe(Et.get(),r,e);this.currentCamera.eye=ze(Iu,this.currentCamera.eye,i),this.currentCamera.center=ze(Iu,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=ei.ASCEND,this._constraintOptions.selection=is.COLLISION,bo(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=is.ALL_EXCEPT_COLLISION,bo(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){QMt(i);const n=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(n,r,i):this._calculateControlTransformationGlobal(n,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,Iu)}_calculateControlTransformationLocal(e,r,i){const{viewRight:n,viewForward:s}=r,o=this._transformation,a=this.view.navigation.gamepad,l=Le(Et.get(),s[0],s[1],0);Ye(l,l);const c=o.translation[0]*e.pan;if(c!==0){const b=Oe(Et.get(),n,c);Ah(i.pan.matrix,i.pan.matrix,b),i.pan.enabled=!0}switch(a.mode){case"pan":{const b=-o.translation[1]*e.pan;if(b!==0){const S=Oe(Et.get(),l,b);Ah(i.pan.matrix,i.pan.matrix,S),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;i.ascend=u;const d=-o.heading*e.rotate;d!==0&&(sd(i.rotate.matrix,i.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Et.get())),i.rotate.enabled=!0);const p=o.tilt*e.rotate,A=U2(this.view.renderCoordsHelper,r.center,r.eye),v=He(A+p,Hl.min,Hl.max)-A;v&&(sd(i.rotate.matrix,i.rotate.matrix,v,n),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:n,viewRight:s}=r,o=this._transformation,a=this.view.navigation.gamepad,l=Kt(Et.get(),s,n);Ye(l,l),Cc(l,l),RCt(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Uw.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;i.ascend=u;const d=-o.heading*e.rotate;d!==0&&(sd(i.rotate.matrix,i.rotate.matrix,d,this._tmpCamera.eye),i.rotate.enabled=!0);const p=o.tilt*e.rotate,A=this._clampTiltDeltaGlobalToValidRange(p,r.ray,c);A!==0&&(sd(i.rotate.matrix,i.rotate.matrix,A,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const n=ln(this.view.spatialReference),s=Jk(Hl.min,r.origin,i,n);let o=0,a=0;const l=Et.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=U2(this.view.renderCoordsHelper,l,r.origin);o=Jk(c,r.origin,i,n),a=Jk(Hl.max,r.origin,i,n)}else{oP(KG(ej,i+n.radius),r,l);const c=pa(-Qe(r.direction,Ye(l,l)));o=Xve(c,r.origin,i,n),a=Xve(Hl.max,r.origin,i,n)}return He(o+e,s,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:n}=this.view,s=n.getAltitude(e),o=r+Math.abs(s-r);return n.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:n}=this.view.state,{direction:s}=aMt(this.view,r,0,v9e,WMt),o=i.intersectManifoldClosestSilhouette(xp(r,s),e,Et.get()),a=zn(r,o),l=i.intersectManifoldClosestSilhouette(xp(r,y1(Et.get(),r,n.center)),e,Et.get()),c=zn(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:n,isGlobal:s}=i,o=r.intersectManifoldClosestSilhouette(n.ray,this._filteredSurfaceElevation,Et.get());if(s){const a=Ve(Et.get(),e,o),l=ct(a);Oe(a,a,1/l);const c=Ye(Et.get(),e),u=pa(Qe(c,a));return l*Math.sin(Math.min(GMt,u))}{const a=Pe(Et.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),zn(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:jMt}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+ln(this.view.spatialReference).radius,{camera:n,isGlobal:s}=this.view.state,o=Et.get(),a=this._getPointAbsoluteSurfaceElevation(n.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=n.width/2,u=mbe*n.width,d=mbe*n.width,p=l*Math.tan(.5*n.fovX)/c,A=p/i,v=p/this._computeHeadingRotateRadius(o),b=a-r;return{pan:(s?A:p)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*b-b),zoom:2**(u*e/c)*l-l,rotate:He(v*d,HMt,qMt)*e}}_applyDisabledMovementTypes(e){!M(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Xf(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Xf(e.rotate.matrix))}static activatesFor(e,r){const i=pbe(r,e.navigation.gamepad,VMt);return!(r.action==="end"||wY(i))}};h([f({constructOnly:!0})],BT.prototype,"gamepadDevice",void 0),h([f({constructOnly:!0})],BT.prototype,"disableMovements",void 0),BT=h([Q("esri.views.3d.state.controllers.GamepadKeyboardController")],BT);const VMt={translation:[0,0,0],heading:0,tilt:0,zoom:0},v9e=80,GMt=Dr(v9e),mbe=.75,jMt=5,HMt=Dr(30),qMt=Dr(80),Uw={zoom:0,ascend:0,pan:{enabled:!1,matrix:ht()},rotate:{enabled:!1,matrix:ht()}},Iu=G(),OI=G(),WMt=tde();function QMt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Xf(t.pan.matrix),t.rotate.enabled=!1,Xf(t.rotate.matrix)}let YMt=class extends Il{constructor(e){super(!0),this._view=e,this._watchHandles=new cn,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([xe(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Rr),xe(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||BT.activatesFor(this._view,e.data)){if(!i){const n=new BT({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var Bh;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Bh||(Bh={}));let XMt=class extends Il{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:wt.Local},this._keyToNumber={[r.left]:Bh.LEFT,[r.right]:Bh.RIGHT,[r.forward]:Bh.FORWARD,[r.backward]:Bh.BACKWARD,[r.up]:Bh.UP,[r.down]:Bh.DOWN,[r.headingLeft]:Bh.HEADINGLEFT,[r.headingRight]:Bh.HEADINGRIGHT,[r.tiltUp]:Bh.TILTUP,[r.tiltDown]:Bh.TILTDOWN,[r.zoomIn]:Bh.ZOOMIN,[r.zoomOut]:Bh.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new BT({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},ZMt=class extends Il{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new Rz({view:this._view,mode:"interaction"}):new Oz({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Ns(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},Fz=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},QS=class extends TL{constructor(){super(...arguments),this._beginCamera=new mr,this._elapsedTimeSec=0,this.constraintOptions={selection:is.ALL,interactionType:ei.PAN,interactionFactor:0,interactionStartCamera:new mr,interactionDirection:null,tiltMode:nl.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new dO}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),bo(this.view,r,this.constraintOptions)}};QS=h([Q("esri.views.3d.state.controllers.momentum.MomentumController")],QS);let j5=class extends QS{constructor(e){super(e),this.interactionType=ei.PAN,this._tmpPan=G()}momentumStep(e,r){const i=this.momentum.value(e);Oe(this._tmpPan,this.momentum.direction,i),r.eye=Ve(gbe,r.eye,this._tmpPan),r.center=Ve(gbe,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};h([f({constructOnly:!0})],j5.prototype,"momentum",void 0),j5=h([Q("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],j5);const gbe=G(),JMt=G(),F8=G();let eU=class extends QS{constructor(e){super(e),this.interactionType=ei.PAN}momentumStep(e,r){const i=this.momentum.value1(e),n=this.momentum.value2(e);Pe(F8,r.eye),Ye(F8,F8),Kt(this.momentum.axis2,F8,this.momentum.axis1),H8e(r,JMt,this.momentum.axis1,i,this.momentum.axis2,n)}};h([f({constructOnly:!0})],eU.prototype,"momentum",void 0),eU=h([Q("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],eU);let wT=class extends QS{set center(e){this._set("center",Gs(e))}set axis(e){this._set("axis",Gs(e))}constructor(e){super(e),this.interactionType=ei.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);B2(r,this.center,SL(this.axis,i))}};h([f({constructOnly:!0})],wT.prototype,"momentum",void 0),h([f({constructOnly:!0})],wT.prototype,"center",null),h([f({constructOnly:!0})],wT.prototype,"axis",null),wT=h([Q("esri.views.3d.state.controllers.momentum.MomentumController")],wT);let MM=class extends QS{set zoomCenter(e){this._set("zoomCenter",Gs(e))}constructor(e){super(e),this.interactionType=ei.ZOOM,this.constraintOptions.interactionDirection=G()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;Pe(i,r.eye);const n=this.momentum.valueDelta(0,e);Zhe(r,this.zoomCenter,n,this.view.state.constraints.minimumPoiDistance),y1(i,r.eye,i)}};h([f({constructOnly:!0})],MM.prototype,"momentum",void 0),h([f({constructOnly:!0})],MM.prototype,"zoomCenter",null),MM=h([Q("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],MM);let Zx=class extends QS{set screenCenter(e){this._set("screenCenter",Ns(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Gs(e))}constructor(e){super(e),this.interactionType=ei.ZOOM,this.radius=0,this._tmpSceneCenter=G(),this._tmpZoomAxisAngle=Qj(),this._sphere=Ho()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);U8e(this._sphere,r,i),this.constraintOptions.interactionType=ei.ZOOM,bo(this.view,r,this.constraintOptions),EL(this._sphere,r,this.screenCenter,this._tmpSceneCenter),Qhe(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),B2(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=ei.PAN}};h([f({constructOnly:!0})],Zx.prototype,"momentum",void 0),h([f({constructOnly:!0})],Zx.prototype,"screenCenter",null),h([f({constructOnly:!0})],Zx.prototype,"sceneCenter",null),h([f({constructOnly:!0})],Zx.prototype,"radius",void 0),Zx=h([Q("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Zx);let nm=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},Kj=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},KMt=class extends Kj{constructor(e,r,i,n,s){super(e,r,i),this._sceneVelocity=n,this.direction=s}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},b9e=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new nm(.6),this._screen=[new nm(.4),new nm(.4)],this._scene=[new nm(.6),new nm(.6),new nm(.6)],this._tmpDirection=G()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),n=this._time.filteredDelta,s=n==null||i==null?0:i/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,r,i){Le(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=ct(this._tmpDirection);n>0&&Oe(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new KMt(e,r,i,s==null?0:n/s,this._tmpDirection)}},Abe=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const ybe=1e-5;let eRt=class extends Kj{constructor(e,r,i,n,s,o=0,a){super(e,r,i),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},tRt=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=G(),this._tmpAxis2=G(),this._tmpAngles=Ft(),this._time=new nm(.3),this._screen=[new nm(.4),new nm(.4)],this._angle1=new Abe(.6),this._angle2=new Abe(.6),this._axis1=G(),this._axis2=G(),this._lastScene=G()}addMomentumDirectRotation(e,r,i,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=G8e(this._lastScene,r,this._tmpAxis2,n,s,o);this._angle2.update(0),vc(this._tmpAxis2)<ybe?a=0:Ye(this._axis1,this._tmpAxis2),this._angle1.update(a),Pe(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,n,s,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;j8e(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,o,a,!1),vc(this._tmpAxis2)<ybe?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),Ye(this._axis1,this._tmpAxis1),Ye(this._axis2,this._tmpAxis2)),Pe(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),n=this._time.filteredDelta,s=i==null||n==null?0:i/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,r,i){const n=this._time.filteredDelta,s=this._angle1.filteredValue,o=this._angle2.filteredValue,a=n==null||o==null?0:o/n;return new eRt(e,r,i,n==null||s==null?0:s/n,this._axis1,a,this._axis2)}},w9e=class{constructor(e=2.5,r=.01,i=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=n,this.enabled=!0,this.value=new nm(.8),this.time=new nm(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=He(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new Kj(e,r,i)}},x9e=class extends w9e{constructor(e=3,r=.01,i=.95,n=12){super(e,r,i,n)}add(e,r){const i=this.value.lastValue;if(i!=null){let n=e-i;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=i+n}super.add(e,r)}},rRt=class extends Kj{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),n=super.value(e+r)-i;return Math.exp(n)}},T9e=class extends w9e{constructor(e=2.5,r=.01,i=.95,n=12){super(e,r,i,n)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new rRt(e,r,i)}},Ine=class extends dA{constructor(){super(...arguments),this._smoothRotation=new Fz(.05),this._rotationAxis=G(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Xi(),this._beginRadius=0,this._smoothScaling=new Fz(.05),this._zoomCenterScreen=Ns(),this._zoomMomentumEstimator=new T9e,this._rotationMomentumEstimator=new x9e,this._panSphericalMomentumEstimator=new tRt,this._panPlanarMomentumEstimator=new b9e,this._adjustedSphere=Ho(),this._tmp3d=G(),this._tmpScreenPointArray=Ns(),this._beginScreenPoint=Ns(),this._beginScenePoint=G(),this._screenPickPoint=Ns(),this._scenePickPoint=G(),this._mode=tl.Horizontal,this._sphere=Ho(),this._pointerCount=0,this._tmpInteractionDirection=G(),this._constraintOptions={selection:is.ALL,interactionType:ei.NONE,interactionFactor:0,interactionStartCamera:new mr,interactionDirection:null,tiltMode:nl.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var s;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panPlanarMomentumEstimator.enabled=r,this._panSphericalMomentumEstimator.enabled=r,this._beginHeading=-C2.normalize(Dr(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),tA(e.center,this._screenPickPoint),$a(this._beginScreenPoint,this._screenPickPoint);const i=ln(this.view.spatialReference),n=z8e(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,vO.Silhouette,this.view.map.ground.opacity===0?CE:{});k(n.scenePickPoint)||(this._scenePickPoint=n.scenePickPoint,this._sphere=n.sphere,Pe(this._beginScenePoint,this._scenePickPoint),this._mode=Xj(this.startCamera,this._screenPickPoint,i),this._mode===tl.Vertical&&this._preparePlanarPanMode(e,n.hasGeometryIntersection),(s=this._constraintOptions.interactionStartCamera)==null||s.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===tl.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===tl.Horizontal?new Zx({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new MM({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new wT({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===tl.Horizontal){const n=this._panSphericalMomentumEstimator.evaluateMomentum();if(n)return new eU({view:this.view,momentum:n})}else{const n=this._panPlanarMomentumEstimator.evaluateMomentum();if(n)return new j5({view:this.view,momentum:n})}return null}_preparePlanarPanMode(e,r){const i=Cc(this._tmp3d,this.startCamera.viewForward);LN(this._scenePickPoint,i,this._panningPlane);const n=Ns(this._screenPickPoint[0],0),s=G(),o=ct(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],EL(this._adjustedSphere,this.startCamera,n,s);const a=Yl();this.startCamera.projectToRenderScreen(s,a);const l=G(),c=G(),u=G();Ve(l,this._scenePickPoint,this.currentCamera.eye);const d=ct(l);Ye(l,l);const p=F8e*Math.max(Math.abs(this.view.camera.position.z),k8e),A=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,Yj);let v=M(A)?A:p;v=r?Math.min(v,d):v,Pe(u,ze(c,this.currentCamera.eye,Oe(c,l,v))),this._panningPlane[3]=-Qe(this._panningPlane,u),this.startCamera.center=ze(c,this.startCamera.eye,Oe(c,this.startCamera.viewForward,v));const b=tA(e.center,this._tmpScreenPointArray);Ene(this._panningPlane,this.startCamera,b,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),U8e(this._sphere,this.currentCamera,this._smoothScaling.value),tA(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=ei.ZOOM,this._constraintOptions.interactionFactor=im(e.radius-this._beginRadius),bo(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=tA(e.center,this._tmpScreenPointArray);EL(this._sphere,this.currentCamera,r,this._tmp3d),Jhe(this._beginScenePoint,Qe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(W8e(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(q8e(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=ei.PAN,this._constraintOptions.interactionFactor=im(US(this._screenPickPoint,r)),bo(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){Ye(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Cc(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+Sne(e.angle-r),n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(i);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),B2(this.currentCamera,this._sphere,SL(this._rotationAxis,s)),this._constraintOptions.interactionType=ei.TUMBLE,this._constraintOptions.interactionFactor=im(e.radius*i),bo(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=tA(e.center,this._tmpScreenPointArray);Ene(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(V8e(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=ei.PAN,this._constraintOptions.interactionFactor=im(US(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),bo(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Zhe(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=ei.ZOOM,this._constraintOptions.interactionFactor=im(e.radius-this._beginRadius),bo(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){Pe(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Cc(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=Sne(i);const n=r+i,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(n);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),B2(this.currentCamera,this._sphere,SL(this._rotationAxis,o)),this._constraintOptions.interactionType=ei.TUMBLE,this._constraintOptions.interactionFactor=im(e.radius*o),bo(this.view,this.currentCamera,this._constraintOptions)}};Ine=h([Q("esri.views.3d.state.controllers.global.PinchAndPanController")],Ine);const _be=pt(0,0,1),iRt={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let $ne=class extends dA{constructor(){super(...arguments),this._rotationValueSmooth=new Fz(.05),this._scalingValueSmooth=new Fz(.05),this._planeHorizontal=Xi(),this._planeVertical=Xi(),this._rotationMomentumEstimator=new x9e,this._panMomentumEstimator=new b9e(300,12,.9),this._zoomMomentumEstimator=new T9e,this._beginRadius=0,this._beginCenter=G(),this._beginAngle=0,this._tmpPoints=[],this._panMode=tl.Horizontal,this._beginCenterScreen=Ns(),this._tmpCentroid3d=G(),this._tmpCentroid2d=Ns(),this._tmp2d=Ns(),this._pointerCount=0,this._constraintOptions={selection:is.ALL,interactionType:ei.NONE,interactionFactor:0,interactionStartCamera:new mr,interactionDirection:null,tiltMode:nl.TUMBLE}}begin(e){var v;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),tA(e.center,this._beginCenterScreen),s4e(_be,0,this._planeHorizontal);const i=G(),n=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?CE:{}),s=G();Cc(s,this.startCamera.viewForward);const o=G();Pe(o,_be);const a=Qe(s,o),l=jf(a<0?-a:a);this._panMode=l>=iRt.ANGLE_THRESHOLD?tl.Horizontal:tl.Vertical;const c=Math.min(F8e,1/Math.abs(Qe(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),k8e);ste(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||ote(this._planeHorizontal,this._planeHorizontal);const u=G(),d=G(),p=G();Ve(u,i,this.currentCamera.eye);const A=ct(u);if(Ye(u,u),this._panMode===tl.Vertical){Oe(o,o,a),Ve(this._planeVertical,s,o),Ye(this._planeVertical,this._planeVertical),ste(this._planeVertical,this._planeVertical,i);const b=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,Yj);let S=M(b)?b:c;S=n?Math.min(S,A):S,Pe(p,ze(d,this.currentCamera.eye,Oe(d,u,S))),this._planeVertical[3]=-Qe(this._planeVertical,p),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),hY(this._tmpPoints,this._beginCenter)}else{const b=n?A:c;Pe(p,ze(d,this.currentCamera.eye,Oe(d,u,b))),this._planeHorizontal[3]=-Qe(this._planeHorizontal,p),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),hY(this._tmpPoints,this._beginCenter)}(v=this._constraintOptions.interactionStartCamera)==null||v.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===tl.Horizontal?this._planeHorizontal:this._planeVertical,n=this._beginCenter;if(r){const s=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(s),Zhe(this.currentCamera,n,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=ei.ZOOM,this._constraintOptions.interactionFactor=im(Math.abs(e.radius-this._beginRadius)),bo(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),hY(this._tmpPoints,this._tmpCentroid3d),tA(e.center,this._tmpCentroid2d),V8e(this.currentCamera,n,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=ei.PAN,this._constraintOptions.interactionFactor=im(US(this._beginCenterScreen,this._tmpCentroid2d)),bo(this.view,this.currentCamera,this._constraintOptions),r){const s=this._planeHorizontal,o=n,a=this._rotationValueSmooth.value,l=a+Sne(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const u=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(u,.001*e.timestamp),B2(this.currentCamera,o,SL(s,u)),this._constraintOptions.interactionType=ei.TUMBLE,this._constraintOptions.interactionFactor=im(Math.abs(e.radius*u)),bo(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new MM({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new wT({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const n=this._panMomentumEstimator.evaluateMomentum();return n?new j5({view:this.view,momentum:n}):null}_computePlanePoints(e,r,i,n){n.length=e.size;const s=this._tmp2d;let o=0;return e.forEach(a=>{s[0]=a.x,s[1]=a.y,n[o]===void 0&&(n[o]=G()),Ene(r,i,s,n[o]),o+=1}),n}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};$ne=h([Q("esri.views.3d.state.controllers.local.PinchAndPanController")],$ne);let vbe=class extends Il{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!ede(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,n=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new Ine({view:this._view}):new $ne({view:this._view})}},nRt=class extends Il{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},S9e=class extends Il{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},sRt=class extends S9e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},oRt=class extends S9e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},aRt=class extends Il{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){var n,s,o;const r=this._invert?-1:1,i=Ns(0,e.data.delta*r);switch(e.data.action){case"begin":(n=this._cameraController)==null||n.end(),this._cameraController=new G5({view:this._view,pivot:Hh.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(s=this._cameraController)==null||s.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function bbe(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value?r.value:1:0),axes:e.axes.map(r=>uRt(r,t.axisThreshold))}:{buttons:[],axes:[]}}function lRt(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function cRt(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function uRt(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let hRt=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const o=s.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,bbe(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=i&&n,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new Yue(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=NR({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(n=>{const s=this._inputDevices[n.index];if(!s)return;const o=this._latestUpdate[n.index],a=bbe(s),l=i||cRt(a);o&&(o.timestamp===n.timestamp||!o.active&&l||lRt(o.state,a))||this._emitGamepadEvent(n,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const n=r[i];this._validate(n)&&e(n)}}_emitGamepadEvent(e,r,i){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!i)return;const o=!s&&i?"start":s&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const wbe=Fe("edge"),dRt=Fe("chrome"),pRt=Fe("ff"),fRt=Fe("safari"),xbe="esri-view-surface",c3={touchNone:`${xbe}--touch-none`,touchPan:`${xbe}--touch-pan`};let E9e=class C9e{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new hRt(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=yt(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(xY[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&xY[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(xY[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,r){r?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?c3.touchNone:c3.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?c3.touchPan:c3.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(c3.touchNone),this._element.classList.remove(c3.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=dFe(this._element,e);return C9e.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const i=ubt(r);i&&e==="key-up"&&this._keyDownState.delete(i);const n={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:wbe&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}wbe?i*=.7:dRt||fRt?i*=.6:pRt&&(i*=1.375);const n=100,s=Math.abs(i);s>n&&(i=i/s*200/(1+Math.exp(-.02*(s-n))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};E9e.test={disableSubpixelCoordinates:!1};const xY={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let mRt=class extends Il{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function M9e(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function gRt(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function ARt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Qf()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[O,I]=t,[N,L]=[I.x-O.x,I.y-O.y];return e.radius=Math.sqrt(N*N+L*L)/2,e.center.x=(O.x+I.x)/2,e.center.y=(O.y+I.y)/2,e}let r=0,i=0;for(let O=0;O<t.length;O++)r+=t[O].x,i+=t[O].y;r/=t.length,i/=t.length;const n=t.map(O=>O.x-r),s=t.map(O=>O.y-i);let o=0,a=0,l=0,c=0,u=0,d=0,p=0;for(let O=0;O<n.length;O++){const I=n[O],N=s[O],L=I*I,B=N*N;o+=L,a+=B,l+=I*N,c+=L*I,u+=B*N,d+=I*B,p+=N*L}const A=.5*(c+d),v=.5*(u+p),b=o*a-l*l,S=(A*a-v*l)/b,E=(o*v-l*A)/b,R=Qf(S+r,E+i);return{radius:Math.sqrt(S*S+E*E+(o+a)/t.length),center:R}}function H5(t){const{native:e}=t,{pointerId:r,button:i,pointerType:n}=e;return n==="mouse"?`${r}:${i}`:`${n}`}let yRt=class extends Il{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:n,pointers:_Rt(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=k8(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,n);const s=tU(n,R9e(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=k8(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=k8(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=tU(i,r)-e,i.lastAngle=tU(i,r)-e})}_emitEvent(e,r,i){const n=k8(this._activePointerMap);this._drag.emit(this._createPayload(e,r,n,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,n=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,n)):(this._addPointer(i),this._emitEvent("added",i,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function R9e(t){const e=[];return t.forEach(r=>{e.push(Qf(r.event.x,r.event.y))}),ARt(e)}function k8(t){const e=R9e(t);let r=0;return t.forEach(i=>{let n=tU(i,e),s=n-i.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=i.lastAngle+s,i.lastAngle=n;const o=n-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function _Rt(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function tU(t,e){const r=t.event,i=r.x-e.center.x,n=r.y-e.center.y;return Math.atan2(n,i)}var Tbe;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(Tbe||(Tbe={}));const Jb={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let vRt=class extends Il{constructor(e=Jb.maximumDoubleClickDelay,r=Jb.maximumDoubleClickDistance,i=Jb.maximumDoubleTouchDelay,n=Jb.maximumDoubleTouchDistance,s=gG){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=ps(e.doubleClickTimer))}get hasPendingInputs(){return Ql(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=ps(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:n}=e.native;return i==="mouse"?`${r}:${n}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,n=this._getPointerId(r);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;M9e(o,r)>l?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=H5(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,n=H5(r),s=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s),a=1;this._pointerState.set(n,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},bRt=class extends Il{constructor(e=Jb.maximumDoubleClickDelay,r=Jb.maximumDoubleClickDistance,i=Jb.maximumDoubleTouchDelay,n=Jb.maximumDoubleTouchDistance,s=gG){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=H5(r);if(!this._pointerState.has(i)){const n={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,n),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=H5(r),n=this._pointerState.get(i);if(n&&n.downButton===r.native.button){const s=n.immediateDoubleClick;if(s){s.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;M9e(s,e.data)>o?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=H5(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const PI={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let wRt=class extends Il{constructor(e=PI.maximumClickDelay,r=PI.movementUntilMouseDrag,i=PI.movementUntilPenDrag,n=PI.movementUntilTouchDrag,s=PI.holdDelay,o=gG){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=ps(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const s={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,n=this._pointerState.get(i);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,r),void 0,n.modifiers):gRt(r,n.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),n.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,i===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,r)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,n=i.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,r==="pointer-up"?i:s.previousEvent),void 0,s.modifiers):r==="pointer-up"&&s.downButton===i.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(n),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},xRt=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var r,i;this._startEvent=e,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},TRt=class extends Il{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new xRt({start:(i,n)=>this._observeStart(i,n),update:(i,n,s)=>this._observeUpdate(i,n,s),end:(i,n)=>this._observeEnd(n)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,n=1/0,s=-1/0,o=1/0;for(const{x:b,y:S}of r.pointers.values())i=Math.max(i,b),n=Math.min(n,b),s=Math.max(s,S),o=Math.min(o,S);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:b,y:S}of e.pointers.values())a=Math.max(a,b),l=Math.min(l,b),c=Math.max(c,S),u=Math.min(u,S);const d=i-n,p=s-o,A=a-l,v=c-u;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(A-d)<=this._maxDelta&&Math.abs(v-p)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((n,s)=>{const o=r.pointers.get(s);i=Math.min(i,Math.abs(n.y-o.y))}),i>=this._threshold}},N0=class extends rt{constructor(){super(...arguments),this._handles=new cn}destroy(){this._handles=yt(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return!!((e=this._inputManager)!=null&&e.hasPendingInputs)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=yt(this._inputManager)}connect(){const e=this.view;this._source=new E9e(this.view.surface,e.input);const r=[new bRt,new wRt,new vRt,new yRt(this.view.navigation),new TRt],i=new $g({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new mRt],f2.INTERNAL),this._modeDragPan=new vbe(e,"primary"),this._modeDragRotate=new bY(e,"secondary",Hh.CENTER),this._modeDragZoom=new zMt(e,"tertiary");const n={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new nRt(e),new NCt(e),new YMt(e),new XMt(e,n.pan),new ZMt(e),new oRt(e,n.resetTilt),new sRt(e,n.resetHeading),new bY(e,"primary",Hh.EYE,[n.lookAround]),new bY(e,"secondary",Hh.CENTER,[n.lookAround]),new vbe(e,"tertiary",[n.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new aRt(e)],f2.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(xe(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},Rr))}_updateMode(){var n;const e=this.mode,r=this.primaryDragAction,i=(n=Dne.get(e))==null?void 0:n.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};h([f()],N0.prototype,"view",void 0),h([f({value:"pan"})],N0.prototype,"primaryDragAction",null),h([f({value:"default"})],N0.prototype,"mode",null),h([f({readOnly:!0})],N0.prototype,"hasPendingInputs",null),h([f()],N0.prototype,"latestPointerType",null),h([f()],N0.prototype,"latestPointerLocation",null),h([f()],N0.prototype,"multiTouchActive",null),h([f()],N0.prototype,"_inputManager",void 0),N0=h([Q("esri.views.3d.input.SceneInputManager")],N0);const Dne=new Map,TY=new Map,SY=new Map;TY.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),TY.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),SY.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),SY.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),Dne.set("default",TY),Dne.set("pro",SY);const SRt=N0;let Zd,fR,Lne=!1,Nne=!1,Fne=!1,kne=!1,q5=null;function ERt(t,e){if(!Nne||!fR)return;O9e();const r=fR;let i=0;for(let n=0;n<t.accBinsNumX;n++)for(let s=0;s<t.accBinsNumY;s++){const o=t.accBins[n][t.accBinsNumY-1-s];i+=o.length;const a=n*t.accBinsSizeX,l=(n+1)*t.accBinsSizeX,c=s*t.accBinsSizeY,u=(s+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),P9e(a,l,c,u,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function CRt(t){Fne=tn.DECONFLICTOR_SHOW_VISIBLE,kne=tn.DECONFLICTOR_SHOW_INVISIBLE,Lne=Fne||kne,Nne=tn.DECONFLICTOR_SHOW_GRID,q5=null,Lne||Nne?q5=()=>MRt(t):Zd&&(Zd.parentElement.removeChild(Zd),Zd=null)}function O9e(){q5&&(q5(),q5=null)}function MRt(t){Zd==null&&(Zd=document.createElement("canvas"),Zd.setAttribute("id","canvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Zd));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:n,height:s}=r,o=n*i,a=s*i;Zd.setAttribute("width",`${o}px`),Zd.setAttribute("height",`${a}px`),Zd.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),fR=Zd.getContext("2d"),fR.clearRect(0,0,n,s),fR.font="12px Arial"}function P9e(t,e,r,i,n){O9e();const s=Zd.height,o=fR;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(t,s-r),o.lineTo(e,s-r),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.closePath()}function RRt(t,e){Lne&&(e&&Fne||!e&&kne)&&P9e(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var wl,td;(function(t){t[t.GRAPHIC=0]="GRAPHIC",t[t.LABEL=1]="LABEL",t[t._COUNT=2]="_COUNT"})(wl||(wl={})),function(t){t[t.USER_SETTING=0]="USER_SETTING",t[t.SCALE_RANGE=1]="SCALE_RANGE",t[t.FILTER=2]="FILTER",t[t.DECONFLICTION=3]="DECONFLICTION",t[t._COUNT=4]="_COUNT"}(td||(td={}));function I9e(t,e){return new N9e(t,k9e,e)}function ORt(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:n}=k9e;return new N9e(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:EY.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:EY.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:n,minPixelSize:EY.minPixelSize},e)}function PRt(t){return Math.abs(t*t*t)}function $9e(t,e,r){const i=r.parameters,n=r.paddingPixelsOverride;return II.scale=Math.min(i.divisor/(e-i.offset),1),II.factor=PRt(t),II.minPixelSize=i.minPixelSize,II.paddingPixels=n,II}function D9e(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function ade(t,e){return Math.max(Mr(t*e.scale,t,e.factor),D9e(t,e))}function IRt(t,e,r){const i=$9e(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,ade(1,i)}function Sbe(t,e,r,i){i.scale=IRt(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function L9e(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,D9e(t[1],e)/Math.max(1e-5,t[1])),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function $Rt(t,e,r,i){return ade(t,$9e(e,r,i))}let N9e=class F9e{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,r,i,n=DRt(),s){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=n,this._paddingPixelsOverride=s,this._viewingMode===wt.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new F9e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:n,scaleFallOffRange:s,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,r),u=this._coverageCompensation(e,r,c),{tiltAngle:d,scaleFallOffFactor:p}=c,A=Math.sin(d)*l,v=.5*Math.PI-d-a*(.5-n*u),b=A/Math.cos(v),S=v+a*s*u,E=(b-p*(A/Math.cos(S)))/(1-p);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=E,i.divisor=b-E,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(e,r,i=Ebe){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=Ebe){const n=this._description.curvatureDependent,s=1+e.distance/r,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=He((o-a)/(l-a),0,1),[u,d]=[n.min,n.max];return i.tiltAngle=Mr(u.tiltAngle,d.tiltAngle,c),i.scaleFallOffFactor=Mr(u.scaleFallOffFactor,d.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const n=r*r,s=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+n-2*Math.cos(s)*a*r,c=Math.sqrt(l),u=Math.sqrt(l-n);return(Math.acos(u/c)-Math.asin(r/(c/Math.sin(s)))+.5*o)/o}};const k9e={curvatureDependent:{min:{curvature:Dr(10),tiltAngle:Dr(12),scaleFallOffFactor:.5},max:{curvature:Dr(70),tiltAngle:Dr(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},EY={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function DRt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const II={scale:0,factor:0,minPixelSize:0,paddingPixels:0},Ebe={tiltAngle:0,scaleFallOffFactor:0};function LRt(t){return t instanceof Float32Array&&t.length>=16}function NRt(t){return Array.isArray(t)&&t.length>=16}function FRt(t){return LRt(t)||NRt(t)}function lde(t){t.vertex.code.add(D`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(D`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(D`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(D`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(D`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(D`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(D`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function kRt(t){t.uniforms.add(new pi("screenSizePerspective",e=>U9e(e.screenSizePerspective)))}function eH(t){t.uniforms.add(new pi("screenSizePerspectiveAlignment",e=>U9e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function U9e(t){return pn(URt,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const URt=Kr();let B9e=class extends Ys{constructor(e,r){super(e,"mat4",Sn.Draw,(i,n,s)=>i.setUniformMatrix4fv(e,r(n,s)))}};function Um(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Ec):t.uniforms.add(new yp("cameraPosition",(r,i)=>Le(z9e,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function pd(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add([new fs("proj",(i,n)=>n.camera.projectionMatrix),new B9e("view",(i,n)=>Ah(Cbe,n.camera.viewMatrix,i.origin)),new yp("localOrigin",i=>i.origin)]);const r=i=>Le(z9e,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add([new fs("proj",(i,n)=>n.camera.projectionMatrix),new fs("view",(i,n)=>Ah(Cbe,n.camera.viewMatrix,r(n))),new kr("localOrigin",(i,n)=>r(n))])}const Cbe=BN(),z9e=G();function wO(t){t.uniforms.add(new fs("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function V9e(t,e){const r=t.vertex;e.hasVerticalOffset?(G9e(r),e.hasScreenSizePerspective&&(t.include(lde),eH(r),Um(t.vertex,e)),r.code.add(D`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?D`vec3 worldNormal = normalize(worldPos + localOrigin);`:D`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?D`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:D`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(D`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const BRt=Kr();function G9e(t){t.uniforms.add(new pi("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return pn(BRt,s*a,o,i,n)}))}var qd;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(qd||(qd={}));var lh;function j9e(t,e){t.include(lde),t.attributes.add(z.POSITION,"vec3"),t.attributes.add(z.NORMAL,"vec3"),t.attributes.add(z.AUXPOS1,"vec4");const r=t.vertex;pd(r,e),Um(r,e),r.uniforms.add([new pi("viewport",(i,n)=>n.camera.fullViewport),new ut("polygonOffset",i=>i.shaderPolygonOffset),new ut("cameraGroundRelative",(i,n)=>n.camera.aboveGround?1:-1),new ut("renderTransparentlyOccludedHUD",(i,n)=>n.renderTransparentlyOccludedHUD===qd.Occluded?1:n.renderTransparentlyOccludedHUD===qd.NotOccluded?0:.75),new _r("hudVisibilityTexture",(i,n)=>n.hudVisibilityTexture)]),e.hasVerticalOffset&&G9e(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(D`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(D`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.isDraped&&!e.hasVerticalOffset||wO(r),e.isDraped||(r.uniforms.add(new ut("perDistancePixelRatio",(i,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),r.code.add(D`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===lh.Screen&&r.uniforms.add(new ut("pixelRatio",(i,n)=>n.camera.pixelRatio)),e.hasScreenSizePerspective&&eH(r),r.code.add(D`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===lh.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?D`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==lh.Screen?D`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===lh.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===lh.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.code.add(D`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(lh||(lh={}));const U8=fa();function H9e(t,e,r,i,n,s){if(t.visible)if(t.boundingInfo){tr(t.type===lo.Mesh);const o=e.tolerance;q9e(t.boundingInfo,r,i,o,n,s)}else{const o=t.indices.get(z.POSITION),a=t.vertexAttributes.get(z.POSITION);sF(r,i,0,o.length/3,o,a,void 0,n,s)}}const zRt=G();function q9e(t,e,r,i,n,s){if(k(t))return;const o=Q9e(e,r,zRt);if(lIe(U8,t.bbMin),cIe(U8,t.bbMax),M(n)&&n.applyToAabb(U8),ude(U8,e,o,i)){const{primitiveIndices:a,indices:l,position:c}=t,u=a?a.length:l.length/3;if(u>HRt){const d=t.getChildren();if(d!==void 0){for(const p of d)q9e(p,e,r,i,n,s);return}}sF(e,r,0,u,l,c,a,n,s)}}const W9e=G();function sF(t,e,r,i,n,s,o,a,l){if(o)return VRt(t,e,r,i,n,s,o,a,l);const{data:c,stride:u}=s,d=t[0],p=t[1],A=t[2],v=e[0]-d,b=e[1]-p,S=e[2]-A;for(let E=r,R=3*r;E<i;++E){let O=u*n[R++],I=c[O++],N=c[O++],L=c[O];O=u*n[R++];let B=c[O++],U=c[O++],q=c[O];O=u*n[R++];let Z=c[O++],X=c[O++],ee=c[O];M(a)&&([I,N,L]=a.applyToVertex(I,N,L,E),[B,U,q]=a.applyToVertex(B,U,q,E),[Z,X,ee]=a.applyToVertex(Z,X,ee,E));const se=B-I,ue=U-N,re=q-L,te=Z-I,j=X-N,H=ee-L,W=b*H-j*S,oe=S*te-H*v,le=v*j-te*b,fe=se*W+ue*oe+re*le;if(Math.abs(fe)<=Number.EPSILON)continue;const de=d-I,Ee=p-N,Ie=A-L,Ge=de*W+Ee*oe+Ie*le;if(fe>0){if(Ge<0||Ge>fe)continue}else if(Ge>0||Ge<fe)continue;const Ke=Ee*re-ue*Ie,vt=Ie*se-re*de,ke=de*ue-se*Ee,Ne=v*Ke+b*vt+S*ke;if(fe>0){if(Ne<0||Ge+Ne>fe)continue}else if(Ne>0||Ge+Ne<fe)continue;const Xe=(te*Ke+j*vt+H*ke)/fe;Xe>=0&&l(Xe,cde(se,ue,re,te,j,H,W9e),E,!1)}}function VRt(t,e,r,i,n,s,o,a,l){const{data:c,stride:u}=s,d=t[0],p=t[1],A=t[2],v=e[0]-d,b=e[1]-p,S=e[2]-A;for(let E=r;E<i;++E){const R=o[E];let O=3*R,I=u*n[O++],N=c[I++],L=c[I++],B=c[I];I=u*n[O++];let U=c[I++],q=c[I++],Z=c[I];I=u*n[O];let X=c[I++],ee=c[I++],se=c[I];M(a)&&([N,L,B]=a.applyToVertex(N,L,B,E),[U,q,Z]=a.applyToVertex(U,q,Z,E),[X,ee,se]=a.applyToVertex(X,ee,se,E));const ue=U-N,re=q-L,te=Z-B,j=X-N,H=ee-L,W=se-B,oe=b*W-H*S,le=S*j-W*v,fe=v*H-j*b,de=ue*oe+re*le+te*fe;if(Math.abs(de)<=Number.EPSILON)continue;const Ee=d-N,Ie=p-L,Ge=A-B,Ke=Ee*oe+Ie*le+Ge*fe;if(de>0){if(Ke<0||Ke>de)continue}else if(Ke>0||Ke<de)continue;const vt=Ie*te-re*Ge,ke=Ge*ue-te*Ee,Ne=Ee*re-ue*Ie,Xe=v*vt+b*ke+S*Ne;if(de>0){if(Xe<0||Ke+Xe>de)continue}else if(Xe>0||Ke+Xe<de)continue;const Se=(j*vt+H*ke+W*Ne)/de;Se>=0&&l(Se,cde(ue,re,te,j,H,W,W9e),R,!1)}}const Mbe=G(),Rbe=G();function cde(t,e,r,i,n,s,o){return Le(Mbe,t,e,r),Le(Rbe,i,n,s),Kt(o,Mbe,Rbe),Ye(o,o),o}function Q9e(t,e,r){return Le(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function ude(t,e,r,i){return hde(t,e,r,i,1/0)}function hde(t,e,r,i,n){const s=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-i-e[1])*r[1],u=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const d=(t[2]-i-e[2])*r[2],p=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(d,p)),!(l<0)&&(a=Math.max(a,Math.min(d,p)),!(a>l)&&a<n)}function Y9e(t,e,r,i,n){let s=(r.screenLength||0)*t.pixelRatio;M(n)&&(s=$Rt(s,i,e,n));const o=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return He(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function X9e(t,e){const r=e?X9e(e):{};for(const i in t){let n=t[i];n&&n.forEach&&(n=jRt(n)),n==null&&i in r||(r[i]=n)}return r}function GRt(t,e){let r=!1;for(const i in e){const n=e[i];n!==void 0&&(Array.isArray(n)?t[i]===null?(t[i]=n.slice(),r=!0):Fae(t[i],n)&&(r=!0):t[i]!==n&&(r=!0,t[i]=n))}return r}function jRt(t){const e=[];return t.forEach(r=>e.push(r)),e}const Z9e={multiply:1,ignore:2,replace:3,tint:4},HRt=1e3;let lw=class extends tF{constructor(e,r){super(),this.type=lo.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Di,this._pp0=pt(0,0,1),this._pp1=pt(0,0,0),this._parameters=X9e(e,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){GRt(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){M(this.repository)&&this.repository.materialChanged(this)}intersectDraped(e,r,i,n,s,o){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,r,i,this._pp0,this._pp1,s)}},J9e=class extends sSt{constructor(e,r,i){super(r,i),this.camera=e}};var Ds;(function(t){t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Ds||(Ds={}));let xP=class extends En{constructor(){super(...arguments),this.renderOccluded=Ds.Occlude}},K9e=class{constructor(){this.factor=new Obe,this.factorAlignment=new Obe}},Obe=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function Zpr(t,e,r,i,n=1){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,n===1)for(let l=0;l<a;++l)s[i]=e[t[l]],i+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let u=0;u<n;u++)s[i]=c,i+=o}}function qRt(t,e,r,i){const n=r.typedBuffer,s=r.typedBufferStride,o=t.length;i*=s;for(let a=0;a<o;++a){const l=2*t[a];n[i]=e[l],n[i+1]=e[l+1],i+=s}}function e7e(t,e,r,i,n){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,n==null||n===1)for(let l=0;l<a;++l){const c=3*t[l];s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let u=0;u<n;++u)s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],i+=o}}function xO(t,e,r,i,n=1){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,n===1)for(let l=0;l<a;++l){const c=4*t[l];s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],s[i+3]=e[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let u=0;u<n;++u)s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],s[i+3]=e[c+3],i+=o}}function Pbe(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride;e*=n;for(let s=0;s<r;++s)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=n}function tH(t,e,r,i,n,s=1){if(!r)return void e7e(t,e,i,n,s);const o=i.typedBuffer,a=i.typedBufferStride,l=t.length,c=r[0],u=r[1],d=r[2],p=r[4],A=r[5],v=r[6],b=r[8],S=r[9],E=r[10],R=r[12],O=r[13],I=r[14];n*=a;let N=0,L=0,B=0;const U=YG(r)?q=>{N=e[q]+R,L=e[q+1]+O,B=e[q+2]+I}:q=>{const Z=e[q],X=e[q+1],ee=e[q+2];N=c*Z+p*X+b*ee+R,L=u*Z+A*X+S*ee+O,B=d*Z+v*X+E*ee+I};if(s===1)for(let q=0;q<l;++q)U(3*t[q]),o[n]=N,o[n+1]=L,o[n+2]=B,n+=a;else for(let q=0;q<l;++q){U(3*t[q]);for(let Z=0;Z<s;++Z)o[n]=N,o[n+1]=L,o[n+2]=B,n+=a}}function dde(t,e,r,i,n,s=1){if(!r)return void e7e(t,e,i,n,s);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,u=o[0],d=o[1],p=o[2],A=o[4],v=o[5],b=o[6],S=o[8],E=o[9],R=o[10],O=!Ace(o),I=1e-6,N=1-I;n*=l;let L=0,B=0,U=0;const q=YG(o)?Z=>{L=e[Z],B=e[Z+1],U=e[Z+2]}:Z=>{const X=e[Z],ee=e[Z+1],se=e[Z+2];L=u*X+A*ee+S*se,B=d*X+v*ee+E*se,U=p*X+b*ee+R*se};if(s===1)if(O)for(let Z=0;Z<c;++Z){q(3*t[Z]);const X=L*L+B*B+U*U;if(X<N&&X>I){const ee=1/Math.sqrt(X);a[n]=L*ee,a[n+1]=B*ee,a[n+2]=U*ee}else a[n]=L,a[n+1]=B,a[n+2]=U;n+=l}else for(let Z=0;Z<c;++Z)q(3*t[Z]),a[n]=L,a[n+1]=B,a[n+2]=U,n+=l;else for(let Z=0;Z<c;++Z){if(q(3*t[Z]),O){const X=L*L+B*B+U*U;if(X<N&&X>I){const ee=1/Math.sqrt(X);L*=ee,B*=ee,U*=ee}}for(let X=0;X<s;++X)a[n]=L,a[n+1]=B,a[n+2]=U,n+=l}}function WRt(t,e,r,i,n,s=1){if(!r)return void xO(t,e,i,n,s);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,u=o[0],d=o[1],p=o[2],A=o[4],v=o[5],b=o[6],S=o[8],E=o[9],R=o[10],O=!Ace(o),I=1e-6,N=1-I;if(n*=l,s===1)for(let L=0;L<c;++L){const B=4*t[L],U=e[B],q=e[B+1],Z=e[B+2],X=e[B+3];let ee=u*U+A*q+S*Z,se=d*U+v*q+E*Z,ue=p*U+b*q+R*Z;if(O){const re=ee*ee+se*se+ue*ue;if(re<N&&re>I){const te=1/Math.sqrt(re);ee*=te,se*=te,ue*=te}}a[n]=ee,a[n+1]=se,a[n+2]=ue,a[n+3]=X,n+=l}else for(let L=0;L<c;++L){const B=4*t[L],U=e[B],q=e[B+1],Z=e[B+2],X=e[B+3];let ee=u*U+A*q+S*Z,se=d*U+v*q+E*Z,ue=p*U+b*q+R*Z;if(O){const re=ee*ee+se*se+ue*ue;if(re<N&&re>I){const te=1/Math.sqrt(re);ee*=te,se*=te,ue*=te}}for(let re=0;re<s;++re)a[n]=ee,a[n+1]=se,a[n+2]=ue,a[n+3]=X,n+=l}}function pde(t,e,r,i,n,s=1){const o=i.typedBuffer,a=i.typedBufferStride,l=t.length;if(n*=a,r!==e.length||r!==4)if(s!==1)if(r!==4)for(let c=0;c<l;++c){const u=3*t[c];for(let d=0;d<s;++d)o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=255,n+=a}else for(let c=0;c<l;++c){const u=4*t[c];for(let d=0;d<s;++d)o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=e[u+3],n+=a}else{if(r===4){for(let c=0;c<l;++c){const u=4*t[c];o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=e[u+3],n+=a}return}for(let c=0;c<l;++c){const u=3*t[c];o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=255,n+=a}}else{o[n]=e[0],o[n+1]=e[1],o[n+2]=e[2],o[n+3]=e[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),u=a/4,d=c[n/=4];n+=u;const p=l*s;for(let A=1;A<p;++A)c[n]=d,n+=u}}function t7e(t,e,r,i,n=1){const s=e.typedBuffer,o=e.typedBufferStride;if(i*=o,n===1)for(let a=0;a<r;++a)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<n;++l)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o}function r7e(t,e,r,i,n,s){for(const o of e.fieldNames){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)switch(o){case z.POSITION:{tr(a.size===3);const c=n.getField(o,Wn);tr(!!c,`No buffer view for ${o}`),c&&tH(l,a.data,r,c,s);break}case z.NORMAL:{tr(a.size===3);const c=n.getField(o,Wn);tr(!!c,`No buffer view for ${o}`),c&&dde(l,a.data,i,c,s);break}case z.UV0:{tr(a.size===2);const c=n.getField(o,O1);tr(!!c,`No buffer view for ${o}`),c&&qRt(l,a.data,c,s);break}case z.COLOR:case z.SYMBOLCOLOR:{tr(a.size===3||a.size===4);const c=n.getField(o,Ic);tr(!!c,`No buffer view for ${o}`),c&&pde(l,a.data,a.size,c,s);break}case z.TANGENT:{tr(a.size===4);const c=n.getField(o,Ad);tr(!!c,`No buffer view for ${o}`),c&&WRt(l,a.data,i,c,s);break}case z.PROFILERIGHT:case z.PROFILEUP:case z.PROFILEVERTEXANDNORMAL:case z.FEATUREVALUE:{tr(a.size===4);const c=n.getField(o,Ad);tr(!!c,`No buffer view for ${o}`),c&&xO(l,a.data,c,s)}}else if(o===z.OBJECTANDLAYERIDCOLOR&&M(t.objectAndLayerIdColor)){const c=t.indices.get(z.POSITION);if(tr(!!c,`No buffer view for ${o}`),c){const u=c.length,d=n.getField(o,Ic);t7e(t.objectAndLayerIdColor,d,u,s)}}}}function ML(t,e,r=0){const i=He(t,0,XRt);for(let n=0;n<4;n++)e[r+n]=Math.floor(256*ZRt(i*QRt[n]))}function fde(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*YRt[i];return r}const QRt=[1,256,65536,16777216],YRt=[1/256,1/65536,1/16777216,1/4294967296],XRt=fde(new Uint8ClampedArray([255,255,255,255]));function ZRt(t){return t-Math.floor(t)}async function u1(t,e){const{data:r}=await ns(t,{responseType:"image",...e});return r}let mde=class extends En{constructor(){super(...arguments),this.color=Fr(1,1,1,1)}};function JRt(){const t=new Ui;return t.include(s0),t.fragment.uniforms.add([new _r("tex",e=>e.texture),new pi("uColor",e=>e.color)]),t.fragment.code.add(D`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),t}const KRt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:mde,build:JRt},Symbol.toStringTag,{value:"Module"}));function eOt(){if(k(CY)){const t=e=>nn(`esri/libs/basisu/${e}`);CY=be(()=>import("./basis_transcoder-e0466ff6.js"),["assets/basis_transcoder-e0466ff6.js","assets/_commonjsHelpers-2f3e7994.js"]).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return CY}let CY;var xT;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(xT||(xT={}));let Em=null,B8=null;async function i7e(){return k(B8)&&(B8=eOt(),Em=await B8),B8}function tOt(t,e){if(k(Em))return t.byteLength;const r=new Em.BasisFile(new Uint8Array(t)),i=s7e(r)?n7e(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function rOt(t,e){if(k(Em))return t.byteLength;const r=new Em.KTX2File(new Uint8Array(t)),i=o7e(r)?n7e(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function n7e(t,e,r,i,n){const s=WFe(e?io.COMPRESSED_RGBA8_ETC2_EAC:io.COMPRESSED_RGB8_ETC2),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*s*o)}function s7e(t){return t.getNumImages()>=1&&!t.isUASTC()}function o7e(t){return t.getFaces()>=1&&t.isETC1S()}async function iOt(t,e,r){k(Em)&&(Em=await i7e());const i=new Em.BasisFile(new Uint8Array(r));if(!s7e(i))return null;i.startTranscoding();const n=a7e(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(s,o)=>i.getImageTranscodedSizeInBytes(0,s,o),(s,o,a)=>i.transcodeImage(a,0,s,o,0,0));return i.close(),i.delete(),n}async function nOt(t,e,r){k(Em)&&(Em=await i7e());const i=new Em.KTX2File(new Uint8Array(r));if(!o7e(i))return null;i.startTranscoding();const n=a7e(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(s,o)=>i.getImageTranscodedSizeInBytes(s,0,0,o),(s,o,a)=>i.transcodeImage(a,s,0,0,o,0,-1,-1));return i.close(),i.delete(),n}function a7e(t,e,r,i,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,d]=l?i?[xT.ETC2_RGBA,io.COMPRESSED_RGBA8_ETC2_EAC]:[xT.ETC1_RGB,io.COMPRESSED_RGB8_ETC2]:c?i?[xT.BC3_RGBA,io.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[xT.BC1_RGB,io.COMPRESSED_RGB_S3TC_DXT1_EXT]:[xT.RGBA32,_t.RGBA],p=e.hasMipmap?r:Math.min(1,r),A=[];for(let E=0;E<p;E++)A.push(new Uint8Array(o(E,u))),a(E,u,A[E]);const v=A.length>1,b=v?zt.LINEAR_MIPMAP_LINEAR:zt.LINEAR,S={...e,samplingMode:b,hasMipmap:v,internalFormat:d,width:n,height:s};return new Xt(t,S,{type:"compressed",levels:A})}const $I=we.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),sOt=542327876,oOt=131072,aOt=4;function gde(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function lOt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const cOt=gde("DXT1"),uOt=gde("DXT3"),hOt=gde("DXT5"),dOt=31,pOt=0,fOt=1,mOt=2,gOt=3,AOt=4,yOt=7,_Ot=20,vOt=21;function bOt(t,e,r){const{textureData:i,internalFormat:n,width:s,height:o}=nh(wOt(r,e.hasMipmap??!1));return e.samplingMode=i.levels.length>1?zt.LINEAR_MIPMAP_LINEAR:zt.LINEAR,e.hasMipmap=i.levels.length>1,e.internalFormat=n,e.width=s,e.height=o,new Xt(t,e,i)}function wOt(t,e){const r=new Int32Array(t,0,dOt);if(r[pOt]!==sOt)return $I.error("Invalid magic number in DDS header"),null;if(!(r[_Ot]&aOt))return $I.error("Unsupported format, must contain a FourCC code"),null;const i=r[vOt];let n,s;switch(i){case cOt:n=8,s=io.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case uOt:n=16,s=io.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case hOt:n=16,s=io.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return $I.error("Unsupported FourCC code:",lOt(i)),null}let o=1,a=r[AOt],l=r[gOt];!(3&a)&&!(3&l)||($I.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let d,p;r[mOt]&oOt&&e!==!1&&(o=Math.max(1,r[yOt])),o===1||Im(a)&&Im(l)||($I.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let A=r[fOt]+4;const v=[];for(let b=0;b<o;++b)p=(a+3>>2)*(l+3>>2)*n,d=new Uint8Array(t,A,p),v.push(d),A+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:v},internalFormat:s,width:c,height:u}}let ME=class rU extends tF{constructor(e,r){super(),this._data=e,this.type=lo.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new Ws,this._passParameters=new mde,this.params=r||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:Ar.REPEAT,t:Ar.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||m2.STRETCH,this.estimatedTexMemRequired=rU._estimateTexMemRequired(this._data,this.params),this._startPreload()}_startPreload(){const e=this._data;k(e)||(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(UR(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){YA(e.src)||UR(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static _getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static _estimateTexMemRequired(e,r){if(k(e))return 0;if(KP(e)||hT(e))return r.encoding===b_.KTX2_ENCODING?rOt(e,!!r.mipmap):r.encoding===b_.BASIS_ENCODING?tOt(e,!!r.mipmap):e.byteLength;const{width:i,height:n}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?rU._getDataDimensions(e):r;return(r.mipmap?4/3:1)*i*n*(r.components||4)||0}dispose(){this._data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(e){return{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?zt.LINEAR_MIPMAP_LINEAR:zt.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.maxAnisotropy??(this.params.mipmap?e.parameters.maxMaxAnisotropy:1)}}get glTexture(){return this._glTexture}load(e,r){if(M(this._glTexture))return this._glTexture;if(M(this._loadingPromise))return this._loadingPromise;const i=this._data;return k(i)?(this._glTexture=new Xt(e,this._createDescriptor(e),null),this._glTexture):typeof i=="string"?this._loadFromURL(e,r,i):i instanceof Image?this._loadFromImageElement(e,r,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,r,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i,r):(KP(i)||hT(i))&&this.params.encoding===b_.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,i)):(KP(i)||hT(i))&&this.params.encoding===b_.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,i)):(KP(i)||hT(i))&&this.params.encoding===b_.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,i)):hT(i)?this._loadFromPixelData(e,i):KP(i)?this._loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e,r,i){if(!(this._data instanceof HTMLVideoElement)||k(this._glTexture)||this._data.readyState<W5.HAVE_CURRENT_DATA||i===this._data.currentTime)return i;if(M(this._powerOfTwoStretchInfo)){const{framebuffer:n,vao:s,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this._data),this._drawStretchedTexture(e,r,n,s,o,this._glTexture)}else{const{videoWidth:n,videoHeight:s}=this._data,{width:o,height:a}=this._glTexture.descriptor;n!==o||s!==a?this._glTexture.updateData(0,0,0,Math.min(n,o),Math.min(s,a),this._data):this._glTexture.setData(this._data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this._data.currentTime}_loadFromDDSData(e,r){return this._glTexture=bOt(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>nOt(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>iOt(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){tr(this.params.width>0&&this.params.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this.params.components===1?_t.LUMINANCE:this.params.components===3?_t.RGB:_t.RGBA,i.width=this.params.width,i.height=this.params.height,this._glTexture=new Xt(e,i,r),this._glTexture}_loadFromURL(e,r,i){return this._loadAsync(async n=>{const s=await u1(i,{signal:n});return fi(n),this._loadFromImage(e,s,r)})}_loadFromImageElement(e,r,i){return i.complete?this._loadFromImage(e,i,r):this._loadAsync(async n=>{const s=await TOe(i,i.src,!1,n);return fi(n),this._loadFromImage(e,s,r)})}_loadFromVideoElement(e,r,i){return i.readyState>=W5.HAVE_CURRENT_DATA?this._loadFromImage(e,i,r):this._loadFromVideoElementAsync(e,r,i)}_loadFromVideoElementAsync(e,r,i){return this._loadAsync(n=>new Promise((s,o)=>{const a=()=>{i.removeEventListener("loadeddata",l),i.removeEventListener("error",c),ps(u)},l=()=>{i.readyState>=W5.HAVE_CURRENT_DATA&&(a(),s(this._loadFromImage(e,i,r)))},c=d=>{a(),o(d||new pe("Failed to load video"))};i.addEventListener("loadeddata",l),i.addEventListener("error",c);const u=Sc(n,()=>c(en()))}))}_loadFromImage(e,r,i){const n=rU._getDataDimensions(r);this.params.width=n.width,this.params.height=n.height;const s=this._createDescriptor(e);return s.pixelFormat=this.params.components===3?_t.RGB:_t.RGBA,!this._requiresPowerOfTwo(e,s)||Im(n.width)&&Im(n.height)?(s.width=n.width,s.height=n.height,this._glTexture=new Xt(e,s,r),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(e,r,n,s,i),this._glTexture)}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const n=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(n,n),i}_requiresPowerOfTwo(e,r){const i=Ar.CLAMP_TO_EDGE,n=typeof r.wrapMode=="number"?r.wrapMode===i:r.wrapMode.s===i&&r.wrapMode.t===i;return e.type===lr.WEBGL1&&(r.hasMipmap||!n)}_makePowerOfTwoTexture(e,r,i,n,s){const{width:o,height:a}=i,l=VR(o),c=VR(a);let u;switch(n.width=l,n.height=c,this.params.powerOfTwoResizeMode){case m2.PAD:n.textureCoordinateScaleFactor=[o/l,a/c],u=new Xt(e,n),u.updateData(0,0,0,o,a,r);break;case m2.STRETCH:case null:case void 0:u=this._stretchToPowerOfTwo(e,r,n,s());break;default:this.params.powerOfTwoResizeMode}return n.hasMipmap&&u.generateMipmap(),u}_stretchToPowerOfTwo(e,r,i,n){const s=new Xt(e,i),o=new uo(e,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE},s),a=new Xt(e,{target:cr.TEXTURE_2D,pixelFormat:i.pixelFormat,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:zt.LINEAR,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},r),l=Fc(e),c=e.getBoundFramebufferObject();return this._drawStretchedTexture(e,n,o,l,a,s),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),e.bindFramebuffer(c),s}_drawStretchedTexture(e,r,i,n,s,o){this._passParameters.texture=s,e.bindFramebuffer(i);const a=e.getViewport();e.setViewport(0,0,o.descriptor.width,o.descriptor.height),e.bindTechnique(r,this._passParameters,null),e.bindVAO(n),e.drawArrays(wr.TRIANGLE_STRIP,0,Xl(n,"geometry")),e.bindFramebuffer(null),e.setViewport(a.x,a.y,a.width,a.height),this._passParameters.texture=null}unload(){if(M(this._powerOfTwoStretchInfo)){const{framebuffer:e,vao:r,sourceTexture:i}=this._powerOfTwoStretchInfo;r.dispose(!0),i.dispose(),e.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(M(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),M(this._loadingController)){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};var W5;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(W5||(W5={}));const RL=128,Ade=.5;function l7e(t,e=RL,r=e*Ade,i=0){const n=xOt(t,e,r,i);return new ME(n,{mipmap:!1,wrap:{s:Ar.CLAMP_TO_EDGE,t:Ar.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function xOt(t,e=RL,r=e*Ade,i=0){switch(t){case"circle":default:return TOt(e,r);case"square":return SOt(e,r);case"cross":return COt(e,r,i);case"x":return MOt(e,r,i);case"kite":return EOt(e,r);case"triangle":return ROt(e,r);case"arrow":return OOt(e,r)}}function TOt(t,e){const r=t/2-.5;return oF(t,h7e(r,r,e/2))}function SOt(t,e){return c7e(t,e,!1)}function EOt(t,e){return c7e(t,e,!0)}function COt(t,e,r=0){return u7e(t,e,!1,r)}function MOt(t,e,r=0){return u7e(t,e,!0,r)}function ROt(t,e){return oF(t,d7e(t/2,e,e/2))}function OOt(t,e){const r=e,i=e/2,n=t/2,s=.8*r,o=h7e(n,(t-e)/2-s,Math.sqrt(s*s+i*i)),a=d7e(n,r,i);return oF(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function c7e(t,e,r){return r&&(e/=Math.SQRT2),oF(t,(i,n)=>{let s=i-.5*t+.25,o=.5*t-n-.75;if(r){const a=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=a}return Math.max(Math.abs(s),Math.abs(o))-.5*e})}function u7e(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const n=.5*e;return oF(t,(s,o)=>{let a,l=s-.5*t,c=.5*t-o-1;if(r){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>n?Math.sqrt((l-n)*(l-n)+c*c):c:c>n?Math.sqrt(l*l+(c-n)*(c-n)):l,a-=i/2,a})}function h7e(t,e,r){return(i,n)=>{const s=i-t,o=n-e;return Math.sqrt(s*s+o*o)-r}}function d7e(t,e,r){const i=Math.sqrt(e*e+r*r);return(n,s)=>{const o=Math.abs(n-t)-r,a=s-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function oF(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let n=0;n<t;n++){const s=n+t*i;let o=e(n,i);o=o/t+.5,ML(o,r,4*s)}return r}let Kpr=class extends En{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function POt(t,e){p7e(t,e,[new kr("slicePlaneOrigin",(r,i)=>A7e(e,r,i)),new kr("slicePlaneBasis1",(r,i)=>{var n;return kz(e,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new kr("slicePlaneBasis2",(r,i)=>{var n;return kz(e,r,i,(n=i.slicePlane)==null?void 0:n.basis2)})])}function To(t,e){p7e(t,e,[new yp("slicePlaneOrigin",(r,i)=>A7e(e,r,i)),new yp("slicePlaneBasis1",(r,i)=>{var n;return kz(e,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new yp("slicePlaneBasis2",(r,i)=>{var n;return kz(e,r,i,(n=i.slicePlane)==null?void 0:n.basis2)})])}function p7e(t,e,r){if(!e.hasSlicePlane){const o=D`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}t.extensions.add("GL_OES_standard_derivatives"),e.hasSliceInVertexProgram&&t.vertex.uniforms.add(r),t.fragment.uniforms.add(r);const i=D`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=D`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?D`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:D`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(s)}function f7e(t,e,r){return t.instancedDoublePrecision?Le(IOt,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function m7e(t,e){return M(t)?Ve(Uz,e.origin,t):e.origin}function g7e(t,e,r){return t.hasSliceTranslatedView?M(e)?Ah($Ot,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function A7e(t,e,r){if(k(r.slicePlane))return Ec;const i=f7e(t,e,r),n=m7e(i,r.slicePlane),s=g7e(t,i,r);return M(s)?Ot(Uz,n,s):n}function kz(t,e,r,i){if(k(i)||k(r.slicePlane))return Ec;const n=f7e(t,e,r),s=m7e(n,r.slicePlane),o=g7e(t,n,r);return M(o)?(ze(DI,i,s),Ot(Uz,s,o),Ot(DI,DI,o),Ve(DI,DI,Uz)):i}const IOt=G(),Uz=G(),DI=G(),$Ot=ht();function rH(t,e){const r=e.output===ne.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(z.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):t.attributes.add(z.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(D`
     void forwardObjectAndLayerIdColor() {
      ${r?i?D`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:D`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:D``} }`),t.fragment.code.add(D`
      void outputObjectAndLayerIdColor() {
        ${r?D`gl_FragColor = objectAndLayerIdColorVarying;`:D``} }`)}function DOt(t,e){const{vertex:r,fragment:i}=t;e.hasMultipassGeometry&&r.include(g6e),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(D`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?D`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&i.include(Tp),e.hasMultipassTerrain&&i.uniforms.add([...Sm("terrainDepthTexture",(n,s)=>s.multipassTerrain.linearDepthTexture,e.hasWebGL2Context?hn.None:hn.InvSize),new ji("nearFar",(n,s)=>s.camera.nearFar)]),i.include(bd),i.code.add(D`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${e.hasMultipassTerrain?D`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${gu(e,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const LOt=Fr(1,1,0,1),y7e=Fr(1,0,1,1);function P1(t,e){t.fragment.uniforms.add(Sm("depthTex",(r,i)=>i.highlightDepthTexture,e.hasWebGL2Context?hn.None:hn.InvSize)),t.fragment.constants.add("occludedHighlightFlag","vec4",LOt).add("unoccludedHighlightFlag","vec4",y7e),t.fragment.code.add(D`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${gu(e,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)}let iH=class extends Ys{constructor(e,r,i){super(e,"vec4",Sn.Pass,(n,s,o)=>n.setUniform4fv(e,r(s,o)),i)}},bc=class extends Ys{constructor(e,r,i){super(e,"float",Sn.Pass,(n,s,o)=>n.setUniform1fv(e,r(s,o)),i)}},yde=class extends xP{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=pt(1,1,1),this.vvSizeMaxSize=pt(100,100,100),this.vvSizeOffset=pt(0,0,0),this.vvSizeFactor=pt(1,1,1),this.vvSizeValue=pt(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Es()}};const Cm=8;function mR(t,e){e.hasVvInstancing&&(e.vvSize||e.vvColor)&&t.attributes.add(z.INSTANCEFEATUREATTRIBUTE,"vec4");const r=t.vertex;e.vvSize?(r.uniforms.add(new kr("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new kr("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new kr("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new kr("vvSizeFactor",i=>i.vvSizeFactor)),r.uniforms.add(new iy("vvSymbolRotationMatrix",i=>i.vvSymbolRotationMatrix)),r.uniforms.add(new kr("vvSymbolAnchor",i=>i.vvSymbolAnchor)),r.code.add(D`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(D`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?D`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(D`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",Cm),e.hasVvInstancing&&r.uniforms.add([new bc("vvColorValues",i=>i.vvColorValues,Cm),new iH("vvColorColors",i=>i.vvColorColors,Cm)]),r.code.add(D`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${e.hasVvInstancing?D`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):r.code.add(D`vec4 vvColor() { return vec4(1.0); }`)}const Bz=.1,Jl=.001;function NOt(t){const e=new Ui,r=t.signedDistanceFieldEnabled;if(e.include(Phe),e.include(j9e,t),e.include(To,t),t.occlusionPass)return e.include(DOt,t),e;const{vertex:i,fragment:n}=e;e.include(lde),n.include(bd),n.include(ry),e.include(mR,t),e.include(rH,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),i.uniforms.add([new pi("viewport",(c,u)=>u.camera.fullViewport),new ji("screenOffset",(c,u)=>ti(_7e,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new ji("anchorPosition",c=>zz(c)),new pi("materialColor",c=>c.color),new ut("pixelRatio",(c,u)=>u.camera.pixelRatio)]),r&&(i.uniforms.add(new pi("outlineColor",c=>c.outlineColor)),n.uniforms.add([new pi("outlineColor",c=>Ibe(c)?c.outlineColor:vA),new ut("outlineSize",c=>Ibe(c)?c.outlineSize:0)])),t.hasScreenSizePerspective&&(kRt(i),eH(i)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(z.UV0,"vec2"),e.attributes.add(z.COLOR,"vec4"),e.attributes.add(z.SIZE,"vec2"),e.attributes.add(z.AUXPOS2,"vec4"),i.code.add(D`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?D`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:D`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const s=D`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?r?D`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:D`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:D`posProj += quadOffset;`;t.vvColor&&i.uniforms.add([new iH("vvColorColors",c=>c.vvColorColors,Cm),new bc("vvColorValues",c=>c.vvColorValues,Cm)]),i.uniforms.add(new ji("textureCoordinateScaleFactor",c=>M(c.texture)&&M(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:U$e)),i.code.add(D`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${s}
    ${t.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===ne.ObjectAndLayerIdColor?D`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${D.float(Jl)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${D.float(Jl)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?D`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),n.uniforms.add(new _r("tex",c=>c.texture));const a=t.debugDrawLabelBorder?D`(isBorder > 0.0 ? 0.0 : ${D.float(Bz)})`:D.float(Bz),l=D`
    ${t.debugDrawLabelBorder?D`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?D`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${D.float(RL)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${D.float(Jl)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:D`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?D`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===ne.Alpha&&n.code.add(D`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),t.output===ne.ObjectAndLayerIdColor&&n.code.add(D`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===ne.Color&&n.code.add(D`
    void main() {
      ${l}
      ${t.transparencyPassType===dr.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),t.output===ne.Highlight&&(e.include(P1,t),n.code.add(D`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?D`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function Ibe(t){return t.outlineColor[3]>0&&t.outlineSize>0}function zz(t,e=_7e){return t.textureIsSignedDistanceField?FOt(t.anchorPosition,t.distanceFieldBoundingBox,e):$a(e,t.anchorPosition),e}function FOt(t,e,r){M(e)?ti(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):ti(r,0,0)}const _7e=Ft(),kOt=Object.freeze(Object.defineProperty({__proto__:null,build:NOt,calculateAnchorPosForRendering:zz},Symbol.toStringTag,{value:"Module"})),_p=Da(st.SRC_ALPHA,st.ONE,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),UOt=jm(st.ONE,st.ONE),v7e=jm(st.ZERO,st.ONE_MINUS_SRC_ALPHA);function I1(t){return t===dr.FrontFace?null:t===dr.Alpha?v7e:UOt}function nH(t){return t===dr.FrontFace?_h:null}const sH=5e5,oH={factor:-1,units:-2};function aH(t){return t?oH:null}function cw(t,e=Qn.LESS){return t===dr.NONE||t===dr.FrontFace?e:Qn.LEQUAL}let b7e=class w7e extends qi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2,r.spherical=e.viewingMode===wt.Global}initializeProgram(e){return new zi(e.rctx,w7e.shader.get().build(this.configuration),Di)}_setPipelineState(e){const r=this.configuration,i=e===dr.NONE,n=e===dr.FrontFace,s=this.configuration.hasPolygonOffset?BOt:null,o=(i||n)&&r.output!==ne.Highlight&&(r.depthEnabled||r.occlusionPass)?_h:null;return Pr({blending:r.output===ne.Color||r.output===ne.Alpha||r.output===ne.Highlight?i?zOt:I1(e):null,depthTest:{func:Qn.LEQUAL},depthWrite:o,colorWrite:Gr,polygonOffset:s})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?wr.POINTS:wr.TRIANGLES}};b7e.shader=new Bi(kOt,()=>be(()=>import("./HUDMaterial.glsl-7c30171d.js"),[]));const BOt={factor:0,units:-4},zOt=jm(st.ONE,st.ONE_MINUS_SRC_ALPHA);let go=class extends Xa{constructor(){super(...arguments),this.output=ne.Color,this.screenCenterOffsetUnitsEnabled=lh.World,this.transparencyPassType=dr.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};h([ae({count:ne.COUNT})],go.prototype,"output",void 0),h([ae({count:lh.COUNT})],go.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([ae({count:dr.COUNT})],go.prototype,"transparencyPassType",void 0),h([ae()],go.prototype,"spherical",void 0),h([ae()],go.prototype,"occlusionTestEnabled",void 0),h([ae()],go.prototype,"signedDistanceFieldEnabled",void 0),h([ae()],go.prototype,"vvSize",void 0),h([ae()],go.prototype,"vvColor",void 0),h([ae()],go.prototype,"hasVerticalOffset",void 0),h([ae()],go.prototype,"hasScreenSizePerspective",void 0),h([ae()],go.prototype,"debugDrawLabelBorder",void 0),h([ae()],go.prototype,"binaryHighlightOcclusionEnabled",void 0),h([ae()],go.prototype,"hasSlicePlane",void 0),h([ae()],go.prototype,"hasPolygonOffset",void 0),h([ae()],go.prototype,"depthEnabled",void 0),h([ae()],go.prototype,"pixelSnappingEnabled",void 0),h([ae()],go.prototype,"isDraped",void 0),h([ae()],go.prototype,"hasMultipassGeometry",void 0),h([ae()],go.prototype,"hasMultipassTerrain",void 0),h([ae()],go.prototype,"cullAboveGround",void 0),h([ae()],go.prototype,"occlusionPass",void 0),h([ae()],go.prototype,"objectAndLayerIdColorInstanced",void 0),h([ae({constValue:!0})],go.prototype,"hasSliceInVertexProgram",void 0),h([ae({constValue:!1})],go.prototype,"hasVvInstancing",void 0);let TO=class extends lw{constructor(e){super(e,new ZOt),this._configuration=new go}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?lh.Screen:lh.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=r.slot===nt.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===ne.Color||e===ne.Alpha),e===ne.Color&&(this._configuration.debugDrawLabelBorder=!!tn.LABELS_SHOW_BORDER),e===ne.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!i.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(Jf(RY,r),M(e.shaderTransformer)){const R=e.shaderTransformer(Lbe);l=R[0],c=R[5],jOt(RY)}const u=e.vertexAttributes.get(z.POSITION),d=e.vertexAttributes.get(z.SIZE),p=e.vertexAttributes.get(z.NORMAL),A=e.vertexAttributes.get(z.AUXPOS1);tr(u.size>=3);const v=i.point,b=i.camera,S=zz(a);l*=b.pixelRatio,c*=b.pixelRatio;const E=this.parameters.centerOffsetUnits==="screen";for(let R=0;R<u.data.length/u.size;R++){const O=R*u.size;Le(uc,u.data[O],u.data[O+1],u.data[O+2]),Ot(uc,uc,r);const I=R*d.size;av[0]=d.data[I]*l,av[1]=d.data[I+1]*c,Ot(uc,uc,b.viewMatrix);const N=R*A.size;if(Le(Md,A.data[N+0],A.data[N+1],A.data[N+2]),!E&&(uc[0]+=Md[0],uc[1]+=Md[1],Md[2]!==0)){const B=Md[2];Ye(Md,uc),Ve(uc,uc,Oe(Md,Md,B))}const L=R*p.size;if(Le(LI,p.data[L],p.data[L+1],p.data[L+2]),this._normalAndViewAngle(LI,RY,b,OY),this._applyVerticalOffsetTransformationView(uc,OY,b,MY),b.applyProjection(uc,Xc),Xc[0]>-1){Xc[0]=Math.floor(Xc[0]),Xc[1]=Math.floor(Xc[1]),E&&(Md[0]||Md[1])&&(Xc[0]+=Md[0],Md[1]!==0&&(Xc[1]+=ade(Md[1],MY.factorAlignment)),b.unapplyProjection(Xc,uc)),Xc[0]+=this.parameters.screenOffset[0],Xc[1]+=this.parameters.screenOffset[1],L9e(av,MY.factor,av);const B=QOt*b.pixelRatio;let U=0;if(a.textureIsSignedDistanceField&&(U=a.outlineSize*b.pixelRatio/2),v&&$be(v,Xc[0],Xc[1],av,B,U,a,S)){const q=i.ray;if(Ot(Dbe,uc,Ml(WOt,b.viewMatrix)),Xc[0]=v[0],Xc[1]=v[1],b.unprojectFromRenderScreen(Xc,uc)){const Z=G();Pe(Z,q.direction);const X=1/ct(Z);Oe(Z,Z,X),o(zn(q.origin,uc)*X,Z,-1,!0,1,Dbe)}}}}}intersectDraped(e,r,i,n,s,o){const a=e.vertexAttributes.get(z.POSITION),l=e.vertexAttributes.get(z.SIZE),c=this.parameters,u=zz(c);let d=1,p=1;if(M(e.shaderTransformer)){const v=e.shaderTransformer(Lbe);d=v[0],p=v[5]}d*=e.screenToWorldRatio,p*=e.screenToWorldRatio;const A=YOt*e.screenToWorldRatio;for(let v=0;v<a.data.length/a.size;v++){const b=v*a.size,S=a.data[b],E=a.data[b+1],R=v*l.size;av[0]=l.data[R]*d,av[1]=l.data[R+1]*p;let O=0;c.textureIsSignedDistanceField&&(O=c.outlineSize*e.screenToWorldRatio/2),$be(n,S,E,av,A,O,c,u)&&s(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new KOt(this)}_normalAndViewAngle(e,r,i,n){return FRt(r)&&(r=Jf(qOt,r)),nd(n.normal,e,r),Ot(n.normal,n.normal,i.viewInverseTransposeMatrix),n.cosAngle=Qe(x7e,XOt),n}_updateScaleInfo(e,r,i){const n=this.parameters;M(n.screenSizePerspective)?Sbe(i,r,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),M(n.screenSizePerspectiveAlignment)?Sbe(i,r,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,r,i,n,s,o,a){const l=this._normalAndViewAngle(r,i,s,OY);return this._applyVerticalGroundOffsetView(e,l,s,a),this._applyVerticalOffsetTransformationView(a,l,s,o),this._applyPolygonOffsetView(a,l,n[3],s,a),this._applyCenterOffsetView(a,n,a),a}applyShaderOffsetsNDC(e,r,i,n,s){return this._applyCenterOffsetNDC(e,r,i,n),M(s)&&Pe(s,n),this._applyPolygonOffsetNDC(n,r,i,n),n}_applyPolygonOffsetView(e,r,i,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return Pe(s,e);const c=He(Math.abs(r.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/n.viewport[2];return Oe(s,e,l>0?u:1/u),s}_applyVerticalGroundOffsetView(e,r,i,n){const s=ct(e),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(s),l=Oe(uc,r.normal,o*a);return ze(n,e,l),n}_applyVerticalOffsetTransformationView(e,r,i,n){const s=this.parameters;if(!s.verticalOffset||!s.verticalOffset.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const c=ct(e);this._updateScaleInfo(n,c,r.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const o=ct(e),a=br(s.screenSizePerspectiveAlignment,s.screenSizePerspective),l=Y9e(i,o,s.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(n,o,r.cosAngle),Oe(r.normal,r.normal,l),ze(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const n=this.parameters.centerOffsetUnits!=="screen";return i!==e&&Pe(i,e),n&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(Ye(LI,i),ze(i,i,Oe(LI,LI,r[2])))),i}_applyCenterOffsetNDC(e,r,i,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==e&&Pe(n,e),s||(n[0]+=r[0]/i.fullWidth*2,n[1]+=r[1]/i.fullHeight*2),n}_applyPolygonOffsetNDC(e,r,i,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&Pe(n,e),s){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);n[2]-=(a||o)*s}return n}requiresSlot(e,r){if(r===ne.Color||r===ne.Alpha||r===ne.Highlight||r===ne.ObjectAndLayerIdColor){if(e===nt.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:n}=this.parameters;return e===(i?nt.LABEL_MATERIAL:nt.HUD_MATERIAL)||n&&e===nt.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new VOt(e)}calculateRelativeScreenBounds(e,r,i=oi()){return GOt(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}},VOt=class extends ohe{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(b7e,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function GOt(t,e,r,i=HOt){return $a(i,t.anchorPosition),i[0]*=-e[0],i[1]*=-e[1],i[0]+=t.screenOffset[0]*r,i[1]+=t.screenOffset[1]*r,i}function jOt(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+r*r+i*i),d=1/Math.sqrt(n*n+s*s+o*o),p=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=r*u,t[2]=i*u,t[3]=n*d,t[4]=s*d,t[5]=o*d,t[6]=a*p,t[7]=l*p,t[8]=c*p,t}function $be(t,e,r,i,n,s,o,a){let l=e-n-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*n,u=r-n-(a[1]>0?i[1]*a[1]:0),d=u+i[1]+2*n;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&M(p)&&(l+=i[0]*p[0],u+=i[1]*p[1],c-=i[0]*(1-p[2]),d-=i[1]*(1-p[3]),l-=s,c+=s,u-=s,d+=s),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<d}const MY=new K9e,HOt=Ft(),uc=G(),LI=G(),Xc=Kr(),x7e=G(),Dbe=G(),RY=Es(),qOt=Es(),WOt=ht(),Md=G(),OY={normal:x7e,cosAngle:0},Lbe=ht(),QOt=1,YOt=2,av=[0,0],XOt=pt(0,0,1);let ZOt=class extends n6e{constructor(){super(...arguments),this.renderOccluded=Ds.Occlude,this.color=Fr(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Gi(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Fr(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const T7e=Cs().vec3f(z.POSITION).vec3f(z.NORMAL).vec2f(z.UV0).vec4u8(z.COLOR).vec2f(z.SIZE).vec4f(z.AUXPOS1).vec4f(z.AUXPOS2),JOt=T7e.clone().vec4u8(z.OBJECTANDLAYERIDCOLOR);let KOt=class{constructor(e){this._material=e,this.vertexBufferLayout=Fe("enable-feature:objectAndLayerId-rendering")?JOt:T7e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(z.POSITION).length}write(e,r,i,n,s){tH(i.indices.get(z.POSITION),i.vertexAttributes.get(z.POSITION).data,e,n.position,s,6),dde(i.indices.get(z.NORMAL),i.vertexAttributes.get(z.NORMAL).data,r,n.normal,s,6);const o=i.vertexAttributes.get(z.UV0).data;let a,l,c,u;if(o==null||o.length<4){const E=this._material.parameters;a=0,l=0,c=E.texCoordScale[0],u=E.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let d=i.indices.get(z.POSITION).length,p=s;const A=n.uv0;for(let E=0;E<d;++E)A.set(p,0,a),A.set(p,1,l),p+=1,A.set(p,0,c),A.set(p,1,l),p+=1,A.set(p,0,c),A.set(p,1,u),p+=1,A.set(p,0,c),A.set(p,1,u),p+=1,A.set(p,0,a),A.set(p,1,u),p+=1,A.set(p,0,a),A.set(p,1,l),p+=1;pde(i.indices.get(z.COLOR),i.vertexAttributes.get(z.COLOR).data,4,n.color,s,6);const v=i.indices.get(z.SIZE),b=i.vertexAttributes.get(z.SIZE).data;d=v.length;const S=n.size;p=s;for(let E=0;E<d;++E){const R=b[2*v[E]],O=b[2*v[E]+1];for(let I=0;I<6;++I)S.set(p,0,R),S.set(p,1,O),p+=1}if(i.indices.get(z.AUXPOS1)&&i.vertexAttributes.get(z.AUXPOS1)?xO(i.indices.get(z.AUXPOS1),i.vertexAttributes.get(z.AUXPOS1).data,n.auxpos1,s,6):Pbe(n.auxpos1,s,6*d),i.indices.get(z.AUXPOS2)&&i.vertexAttributes.get(z.AUXPOS2)?xO(i.indices.get(z.AUXPOS2),i.vertexAttributes.get(z.AUXPOS2).data,n.auxpos2,s,6):Pbe(n.auxpos2,s,6*d),M(i.objectAndLayerIdColor)&&i.indices.get(z.POSITION)){const E=i.indices.get(z.POSITION).length,R=n.getField(z.OBJECTANDLAYERIDCOLOR,Ic);t7e(i.objectAndLayerIdColor,R,E,s,6)}}};const sg=G(),u3=Kr(),NI=Kr(),PY=G(),ePt=ht(),tPt=Ho(),IY=el(),rPt=G(),iPt=oi();class nPt{constructor(){this.aabr=oi(),this.distance=0,this.culled=!1,this.visible=!1}}class sPt{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var Vh;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Vh||(Vh={}));class S7e{constructor(){this.camera=new mr,this.slicePlane=b1(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),wE(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let RM=class extends rt{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new S7e,this._state=Vh.Idle,this._active=new Map,this._visible=new Map,this._iterators=new cPt,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Vh.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Vh.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Vh.Idle:this._startUpdate(),t.madeProgress();case Vh.Process:if(this._state=Vh.Process,!this._processActiveGraphics(t))return;case Vh.Sort:if(this._state=Vh.Sort,!this._sortVisibleGraphics(t))return;case Vh.Deconflict:if(this._state=Vh.Deconflict,!this._deconflictVisibleGraphics(t))return;default:ERt(this,this._visible),this._state=Vh.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(k(t)||t.type!=="object3d")return!1;const e=t.stageObject;if((e?e.geometries.length:0)!==1)return!1;const r=e==null?void 0:e.geometries[0];return(r==null?void 0:r.material)instanceof TO}_startUpdate(){CRt(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new nPt,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),oPt(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=nP(ePt,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?tPt:null;let n=0;for(M(i)&&(Ot(i,Ec,this._runningViewState.camera.viewMatrix),i[3]=ln(this.view.spatialReference).radius,n=t4e(i,Ec));!t.done;){t.madeProgress();const s=e.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=s.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,n),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===wl.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=i.value,s=n.info[this.visibilityGroup];if(!s||s.culled)continue;const o=n.graphics3DGraphic,a=(!r||o.isVisible())&&!this._isConflicted(n);a&&this._addToBins(n),s.visible=a,this._setGraphicVisibility(n,a),RRt(s,a)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=Nbe(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=Nbe(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=aPt(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const n=t.graphics3DGraphic;if(n.destroyed)return;const s=t.info[this.visibilityGroup];if(!n.isVisible(wl.GRAPHIC,td.DECONFLICTION))return void(s.culled=!0);const o=this.getGraphicsLayers(n);Yf(s.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(k(a)){if(a=dPt,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,sg)||M(r)&&this._isCulledByHorizon(a,r,i))return void(s.culled=!0);!tn.TESTS_DISABLE_OPTIMIZATIONS&&s.visible&&(a.distance*=.7)}this._expandBoundingRect(s,l,c,a)}k(a)?s.culled=!0:(s.distance=a.distance,s.culled=!1)}_getProjectionInfo(t,e,r){const i=this._runningViewState.camera,n=t.stageObject,s=n.geometries[0],o=s.material,a=n.boundingVolumeWorldSpace.bounds;Ot(sg,a,i.viewMatrix);const l=s.vertexAttributes,c=l.get(z.NORMAL).data,u=l.get(z.AUXPOS1).data;o.applyShaderOffsetsView(sg,c,n.transformation,u,i,r.scaleInfo,sg),pn(u3,sg[0],sg[1],sg[2],1),cp(NI,u3,i.projectionMatrix),Oe(r.positionNDC,NI,1/NI[3]),o.applyShaderOffsetsNDC(r.positionNDC,u,i,r.positionNDC,PY),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(PY[2]),r.distance=PY[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),pn(NI,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),cp(u3,NI,e),YO(u3,u3,1/u3[3]),Le(r.positionView,sg[0],sg[1],sg[2])}_isCulledByHorizon(t,e,r){return Pe(IY.direction,t.positionView),Le(IY.origin,0,0,0),!!sw(e,IY,rPt)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&Lce(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:n}){const s=this._runningViewState.camera,o=e.getScreenSize(uPt);L9e(o,n.factor,o),o[0]*=s.pixelRatio,o[1]*=s.pixelRatio;const a=OB(r.calculateRelativeScreenBounds(o,n.factorAlignment.scale,iPt),Mr(0,s.fullWidth,.5+.5*i[0]),Mr(0,s.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(sp(a),$m(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}h2(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let n=Math.floor(r.aabr[1]/this._accBinsSizeY);n<=Math.floor(r.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;const s=this._accBins[i][n];for(let o=0;o<s.length;o++){const a=s.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,NG(l.aabr,r.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)i.push(new Vr)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),n=Math.floor(e.aabr[1]/this._accBinsSizeY),s=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=n;a<=s;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(td.DECONFLICTION,e,this.visibilityGroup),this.visibilityGroup===wl.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function oPt(t,e){const r=t.graphics3DGraphic;r.destroyed||r.clearVisibilityFlag(td.DECONFLICTION,e)}function*Nbe(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*aPt(t,e,r){e.clear(),t.forEach((n,s)=>{const o=e.pushNew();o.id=s,o.visible=n.graphics3DGraphic.hasVisibilityFlag(td.DECONFLICTION,r),o.prio=n.info?n.info[r].distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((n,s)=>n.visible!==s.visible?n.visible?-1:1:n.prio!==s.prio?n.prio-s.prio:n.id-s.id);for(let n=i.next();!n.done;n=i.next())yield;e.forAll(n=>{const s=t.get(n.id);s&&(t.delete(n.id),t.set(n.id,s))}),e.clear()}h([f({constructOnly:!0})],RM.prototype,"view",void 0),h([f({type:Boolean,readOnly:!0})],RM.prototype,"updating",null),RM=h([Q("esri.views.3d.layers.graphics.Deconflictor")],RM);let lPt=class{};class cPt{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new Vr({allocator:n=>n||new lPt})}}const uPt=Ft();class hPt{constructor(){this.positionView=G(),this.positionNDC=G(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new K9e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const dPt=new hPt,pPt=2e3;let iU=class extends RM{constructor(e){super(e),this.visibilityGroup=wl.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return rc.YIELD;const r=performance.now();if(e.state!==Mi.IDLE&&r-this._lastDeconfliction<pPt)return rc.YIELD;super.runTask(e),this.state===Vh.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};h([f({constructOnly:!0})],iU.prototype,"parent",void 0),iU=h([Q("esri.views.3d.layers.graphics.LabelDeconflictor")],iU);let Une=class extends RM{constructor(){super(...arguments),this._handles=new cn,this._contexts=new Map,this._viewState=new S7e,this.visibilityGroup=wl.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([xe(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.state)==null?void 0:r.camera},()=>{this._updateViewState(),this.setDirty()}),xe(()=>{var e,r,i;return(i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity},(e,r)=>{e!==1&&r!==1||this.setDirty()}),xe(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Rr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(ar.GRAPHICS_DECONFLICTOR,this),this._labels=new iU({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&$Y(e));r.setVisibilityFlag(td.DECONFLICTION,i,wl.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;M(e)&&g4e(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=M(e)}_slicePlaneChanged(){Ql(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const n=i.graphic.uid,s=new sPt(i,e.symbolCreationContext.slicePlaneEnabled);r.set(n,s),$Y(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,r){const i=r.graphic.uid,n=e.get(i);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=$Y(e);i||fPt(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(n=>n.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!r||!r.length)return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function $Y(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function fPt(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.clearVisibilityFlag(td.DECONFLICTION))}Une=h([Q("esri.views.3d.layers.graphics.GraphicsDeconflictor")],Une);const _de=(t,e,r)=>[e,r],SO=(t,e,r)=>[e,r,t[2]],vde=(t,e,r)=>[e,r,t[2],t[3]];function dfr(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:M(t.extent)?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function mPt({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function gPt({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function E7e({scale:t,translate:e},r){return r*t[0]+e[0]}function C7e({scale:t,translate:e},r){return e[1]-r*t[1]}function M7e(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[n,s]=t.scale;let o=E7e(t,r[0][0]),a=C7e(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*n,a-=c[1]*s,i[l]=e(c,o,a)}return i}function R7e(t,e,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=M7e(t,e,r[n]);return i}function APt(t,e,r,i){return M7e(t,r?i?vde:SO:i?SO:_de,e)}function yPt(t,e,r,i){return R7e(t,r?i?vde:SO:i?SO:_de,e)}function _Pt(t,e,r,i){return R7e(t,r?i?vde:SO:i?SO:_de,e)}function pfr(t,e,r,i,n){return e.x=mPt(t,r.x),e.y=gPt(t,r.y),e!==r&&(i&&(e.z=r.z),n&&(e.m=r.m)),e}function O7e(t,e,r,i,n){return M(r)&&(e.points=APt(t,r.points,i,n)),e}function P7e(t,e,r,i,n){return k(r)||(e.x=E7e(t,r.x),e.y=C7e(t,r.y),e!==r&&(i&&(e.z=r.z),n&&(e.m=r.m))),e}function I7e(t,e,r,i,n){return M(r)&&(e.rings=_Pt(t,r.rings,i,n)),e}function $7e(t,e,r,i,n){return M(r)&&(e.paths=yPt(t,r.paths,i,n)),e}let ffr=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function gfr(t){return M(t.geometry)}let Afr=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function _fr(t){var s;const e=bPe.fromJSON(t.geometryType),r=St.fromJSON(t.spatialReference),i=t.transform,n=t.features.map(o=>{const a=vPt(o,e,r,t.objectIdFieldName),l=a.geometry;if(M(l)&&i)switch(l.type){case"point":a.geometry=P7e(i,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=O7e(i,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=I7e(i,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=$7e(i,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:n,spatialReference:r,fields:((s=t.fields)==null?void 0:s.map(o=>mj.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function vPt(t,e,r,i){return{uid:hd(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:bPt(t.geometry,e,r),visible:!0}}function bPt(t,e,r){if(k(t))return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function $1(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function wPt(t){if(k(t))return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),n=t.type==="polyline"?t.paths:t.rings;for(const s of n)r+=s.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(n.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=n6(t.vertexAttributes.position),e+=n6(t.vertexAttributes.normal),e+=n6(t.vertexAttributes.uv),e+=n6(t.vertexAttributes.tangent)}return e}function vfr(t){let e=32;return e+=E$e(t.attributes),e+=3,e+=8+wPt(t.geometry),e}function xPt(t){if(k(t))return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function bfr(t){if(k(t))return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function wfr(t,e){switch(qn(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)bW(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)bW(e,t.rings[r],!!t.hasZ);break;case"multipoint":bW(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function TPt(t,e){switch(Yf(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)vW(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)vW(e,t.rings[r]);break;case"multipoint":vW(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function xfr(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function D7e(t){return"declaredClass"in t}function Fbe(t){return"declaredClass"in t}function SPt(t){return"declaredClass"in t}function EPt(t,e){return t?SPt(t)?t:new Pl({layer:e,sourceLayer:e,visible:t.visible,symbol:Te(t.symbol),attributes:Te(t.attributes),geometry:L7e(t.geometry)}):null}function L7e(t){return k(t)?null:D7e(t)?t:r1(CPt(t))}function CPt(t){const{wkid:e,wkt:r,latestWkid:i}=t.spatialReference,n={wkid:e,wkt:r,latestWkid:i};switch(t.type){case"point":{const{x:s,y:o,z:a,m:l}=t;return{x:s,y:o,z:a,m:l,spatialReference:n}}case"polygon":{const{rings:s,hasZ:o,hasM:a}=t;return{rings:kbe(s),hasZ:o,hasM:a,spatialReference:n}}case"polyline":{const{paths:s,hasZ:o,hasM:a}=t;return{paths:kbe(s),hasZ:o,hasM:a,spatialReference:n}}case"extent":{const{xmin:s,xmax:o,ymin:a,ymax:l,zmin:c,zmax:u,mmin:d,mmax:p,hasZ:A,hasM:v}=t;return{xmin:s,xmax:o,ymin:a,ymax:l,zmin:c,zmax:u,mmin:d,mmax:p,hasZ:A,hasM:v,spatialReference:n}}case"multipoint":{const{points:s,hasZ:o,hasM:a}=t;return{points:F7e(s)?N7e(s):s,hasZ:o,hasM:a,spatialReference:n}}default:return}}function kbe(t){return MPt(t)?t.map(e=>N7e(e)):t}function N7e(t){return t.map(e=>Array.from(e))}function MPt(t){for(const e of t)if(e.length!==0)return F7e(e);return!1}function F7e(t){return t.length>0&&(zae(t[0])||Vae(t[0]))}function RPt(t,e){if(!t)return null;let r;if(Fbe(t)){if(e==null)return t.clone();if(Fbe(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=$1(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function Tfr(t){const{wkid:e,wkt:r,latestWkid:i}=t,n={wkid:e,wkt:r,latestWkid:i};return St.fromJSON(n)}const DY=we.getLogger("esri.layers.support.labelFormatUtils"),LY={type:"simple",evaluate:()=>null},OPt={getAttribute:(t,e)=>t.field(e)};async function k7e(t,e,r){if(!t||!t.symbol||!e)return LY;const i=t.where,n=Tj(t),s=i?await be(()=>import("./WhereClause-3b5a65ae.js").then(a=>a.W),["assets/WhereClause-3b5a65ae.js","assets/executionError-fb3f283a.js"]):null;let o;if(n.type==="arcade"){const a=await knt(n.expression,r,e);if(k(a))return LY;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{DY.error(new pe("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:n}))}return null},needsHydrationToEvaluate:()=>Fue(n.expression)==null}}else o={type:"simple",evaluate:a=>n.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),u=e.get(c);if(!u)return l;let d=null;return"attributes"in a?a&&a.attributes&&(d=a.attributes[u.name]):d=a.field(u.name),d==null?"":U7e(d,u)})};if(i){let a;try{a=s.WhereClause.create(i,e)}catch(c){return DY.error(new pe("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),LY}const l=o.evaluate;o.evaluate=c=>{const u="attributes"in c?void 0:OPt;try{if(a.testFeature(c,u))return l(c)}catch(d){DY.error(new pe("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:d}))}return null}}return o}function U7e(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const n=t;for(const s of r.codedValues)if(s.code===n)return s.name}else if(r.type==="range"){const n=+t,s="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(s<=n&&n<=o)return r.name}}let i=t;return e.type==="date"||e.type==="esriFieldTypeDate"?i=LA(i,OG("short-date")):RG(e)&&(i=NA(+i)),i||""}const Sfr=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:k7e,formatField:U7e},Symbol.toStringTag,{value:"Module"}));let B7e=class{constructor(e=null,r="center",i="center",n=null,s=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",u=0,d=0){this.verticalOffset=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=n,this.translation=s,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=u,this.displayHeight=d}};function bde(t,e){if(t.type==="point")return lv(t,e,!1);if(D7e(t))switch(t.type){case"extent":return lv(t.center,e,!1);case"polygon":return lv(t.centroid,e,!1);case"polyline":return lv(Ube(t),e,!0);case"mesh":return lv(t.origin,e,!1)}else switch(t.type){case"extent":return lv(PPt(t),e,!0);case"polygon":return lv(IPt(t),e,!0);case"polyline":return lv(Ube(t),e,!0)}}function Ube(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=sPe(e,nPe(e)/2);return $1(r[0],r[1],r[2],t.spatialReference)}function PPt(t){return $1(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function IPt(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=kle(t.rings,!!t.hasZ);return $1(r[0],r[1],r[2],t.spatialReference)}function lv(t,e,r){const i=r?t:RPt(t);return e&&t?zat(t,i,e)?i:null:i}function Cfr(t,e,r,i=0){if(t){e||(e=oi());const n=t;let s=.5*n.width*(r-1),o=.5*n.height*(r-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),pn(e,n.xmin-s-i,n.ymin-o-i,n.xmax+s+i,n.ymax+o+i),e}return null}function z7e(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(z.AUXPOS1);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[r]))}}function Q5(t,e){const r=DN(Ef);return M(t)&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),M(e)?r[3]=e:M(t)&&t.length>3&&(r[3]=t[3]),r}function Mfr(t,e,r,i,n,s=[0,0,0,0]){for(let o=0;o<3;++o)M(t)&&t[o]!=null?s[o]=t[o]:M(r)&&r[o]!=null?s[o]=r[o]:s[o]=n[o];return M(e)?s[3]=e:M(i)?s[3]=i:s[3]=n[3],s}function Bbe(t=cA,e,r,i=1){const n=new Array(3);if(k(e)||k(r))n[0]=1,n[1]=1,n[2]=1;else{let s,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,d=a===0&&!s&&!u,p=r[a];l==="symbol-value"||d?c=p!==0?e[a]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(n[a]=c,s=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)n[a]==null?n[a]=s:n[a]===0&&(n[a]=.001*o)}for(let s=2;s>=0;s--)n[s]/=i;return sh(n)}function $Pt(t){return t.isPrimitive!=null}function lH(t){return Vz($Pt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function Vz(t){if(Array.isArray(t)){for(const e of t)if(!Vz(e))return!1;return!0}return t==null||t>=0}function DPt(t,e,r,i=ht()){const n=t||0,s=e||0,o=r||0;return n!==0&&JR(i,i,-n/180*Math.PI),s!==0&&ZR(i,i,s/180*Math.PI),o!==0&&qG(i,i,o/180*Math.PI),i}function wde(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=Eu(e),n=mE(t)*i,s=gE(t)*i,o=rw(t)*(e.isGeographic?1:i);return n===0&&s===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(n,s,o)}function V7e(t,e,r,i,n,s,o,a,l,c,u){const d=VPt[u.mode];let p,A,v=0;if(qs(t,e,r,i,l.spatialReference,n,a))return d.requiresAlignment(u)?(v=d.applyElevationAlignmentBuffer(i,n,s,o,a,l,c,u),p=s,A=o):(p=i,A=n),qs(p,l.spatialReference,A,s,c.spatialReference,o,a)?v:void 0}function TP(t,e,r,i,n){const s=(Pz(t)?t.z:o9e(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=br(hA(e,t,"ground"),0);return n.verticalDistanceToGround=0,n.sampledElevation=o,void(n.z=o)}case"relative-to-ground":{const o=br(hA(e,t,"ground"),0),a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=br(hA(e,t,"scene"),0),a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(s,i),a=br(hA(e,t,"ground"),0);return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function LPt(t,e,r,i){return TP(t,e,r,i,OM),OM.z}function aF(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?Hs.UPDATE:t.onTheGroundChanged}function t0(t){return t==="relative-to-ground"||t==="relative-to-scene"}function z2(t){return t!=="absolute-height"}function NPt(t,e,r,i,n){TP(e,r,n,i,OM),z7e(t,OM.verticalDistanceToGround);const s=OM.sampledElevation,o=Ia(GPt,t.transformation);return z8[0]=e.x,z8[1]=e.y,z8[2]=OM.z,Lm(e.spatialReference,z8,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function FPt(t,e,r,i,n,s){let o=0;const a=s.spatialReference;e*=3,i*=3;for(let l=0;l<n;++l){const c=t[e+0],u=t[e+1],d=t[e+2],p=br(s.getElevation(c,u,d,a,"ground"),0);o+=p,r[i+0]=c,r[i+1]=u,r[i+2]=p,e+=3,i+=3}return o/n}function kPt(t,e,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=s.spatialReference;e*=3,i*=3;for(let p=0;p<n;++p){const A=t[e+0],v=t[e+1],b=t[e+2],S=br(s.getElevation(A,v,b,d,"ground"),0);l+=S,r[i+0]=A,r[i+1]=v,r[i+2]=u==null?b+S+c:S+c,e+=3,i+=3}return l/n}function UPt(t,e,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=s.spatialReference;e*=3,i*=3;for(let p=0;p<n;++p){const A=t[e+0],v=t[e+1],b=t[e+2],S=br(s.getElevation(A,v,b,d,"scene"),0);l+=S,r[i+0]=A,r[i+1]=v,r[i+2]=u==null?b+S+c:S+c,e+=3,i+=3}return l/n}function BPt(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function zPt(t,e,r,i,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let u=0;u<n;++u){const d=t[e+0],p=t[e+1],A=t[e+2];r[i+0]=d,r[i+1]=p,r[i+2]=c==null?A+l:l,e+=3,i+=3}return 0}let lF=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Hs;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Hs||(Hs={}));const VPt={"absolute-height":{applyElevationAlignmentBuffer:zPt,requiresAlignment:BPt},"on-the-ground":{applyElevationAlignmentBuffer:FPt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:kPt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:UPt,requiresAlignment:()=>!0}},GPt=ht(),OM=new lF,z8=G();function xde(t){return M(t.mapPositions)}function G7e(t,e,r,i,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!xde(l))continue;const{update:c,averageGeometrySampledElevation:u}=H7e(l,e,r,i,n);a+=u,c&&s.geometryVertexAttrsUpdated(l)}return a/o.length}function OL(t,e,r,i,n){var d;const s=t.stageObject,o=e.centerPointInElevationSR;let a=0;(d=s.metadata)!=null&&d.usesVerticalDistanceToGround?(i(o,ah),z7e(s,ah.verticalDistanceToGround),a=ah.sampledElevation):(i(o,ah),e.mode!=="absolute-height"&&(a=ah.sampledElevation));const l=Ia(jPt,s.transformation),c=Le(j7e,l[12],l[13],l[14]);tn.TESTS_DISABLE_OPTIMIZATIONS?(oh[0]=o.x,oh[1]=o.y,oh[2]=ah.z,Lm(o.spatialReference,oh,l,n.spatialReference)&&(s.transformation=l)):n.setAltitudeOfTransformation(ah.z,l);const u=Tde/n.unitInMeters;return(Math.abs(l[12]-c[0])>=u||Math.abs(l[13]-c[1])>=u||Math.abs(l[14]-c[2])>=u)&&(s.transformation=l),a}const jPt=ht();function HPt(t,e,r,i,n){const s=t.graphics3DSymbolLayer.lodRenderer;if(k(s))return 0;const o=e.centerPointInElevationSR;i(o,ah);const a=e.mode!=="absolute-height"?ah.sampledElevation:0,l=s.instanceData,c=t.instanceIndex,u=WPt;l.getGlobalTransform(c,u);const d=Le(j7e,u[12],u[13],u[14]);tn.TESTS_DISABLE_OPTIMIZATIONS?(oh[0]=o.x,oh[1]=o.y,oh[2]=ah.z,Lm(o.spatialReference,oh,u,n.spatialReference)&&l.setGlobalTransform(c,u)):n.setAltitudeOfTransformation(ah.z,u);const p=Tde/n.unitInMeters;return(tn.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-d[0])>=p||Math.abs(u[13]-d[1])>=p||Math.abs(u[14]-d[2])>=p)&&l.setGlobalTransform(c,u),a}function qPt(t,e,r,i,n){const s=t.stageObject,o=s.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const d of o){if(!xde(d))continue;const p=d.vertexAttributes.get(z.POSITION);if(p!==l){const{update:A,averageGeometrySampledElevation:v}=H7e(d,e,r,i,n);c=v,l=p,u=A}u&&s.geometryVertexAttrsUpdated(d),a+=c}return a/o.length}const Tde=.01,oh=G(),Lp=G(),h3=G(),WPt=ht(),j7e=G(),ah=new lF;function H7e(t,e,r,i,n){let s=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;Lp[0]=o[12],Lp[1]=o[13],Lp[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(z.POSITION),c=l.data,u=l.size,d=c.length/u,p=new s9e(t.mapPositions,r);let A=0,v=0;for(let b=0;b<d;b++){if(h3[0]=c[A],h3[1]=c[A+1],h3[2]=c[A+2],i(p,ah),a&&(v+=ah.sampledElevation),tn.TESTS_DISABLE_OPTIMIZATIONS)c[A]=p.array[p.offset],c[A+1]=p.array[p.offset+1],c[A+2]=ah.z,qs(c,r,A,c,n.spatialReference,A,1),c[A]-=Lp[0],c[A+1]-=Lp[1],c[A+2]-=Lp[2],s=!0;else{oh[0]=c[A]+Lp[0],oh[1]=c[A+1]+Lp[1],oh[2]=c[A+2]+Lp[2],n.setAltitude(oh,ah.z),c[A]=oh[0]-Lp[0],c[A+1]=oh[1]-Lp[1],c[A+2]=oh[2]-Lp[2];const S=Tde/n.unitInMeters;(Math.abs(h3[0]-c[A])>=S||Math.abs(h3[1]-c[A+1])>=S||Math.abs(h3[2]-c[A+2])>=S)&&(s=!0)}A+=u,p.offset+=3}return v/=d,{update:s,averageGeometrySampledElevation:v}}const QPt=we.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function YPt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function Ofr(t){const e=t&&t.expression;if(typeof e=="string"){const r=Q7e(e);if(r!=null)return{cachedResult:r}}return null}async function Pfr(t,e,r,i){const n=t&&t.expression;if(typeof n!="string")return null;const s=Q7e(n);if(s!=null)return{cachedResult:s};const o=await DA();fi(r);const a=o.arcadeUtils,l=a.createSyntaxTree(n);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function q7e(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function Sde(t,e){if(t!=null&&!W7e(t)){if(!e||!t.arcade)return void QPt.errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=L7e(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function XPt(t){if(t!=null){if(W7e(t))return t.cachedResult;const e=t.arcade;let r=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function Ifr(t,e=!1){let r=t&&t.featureExpressionInfo;const i=r&&r.expression;return e||i==="0"||(r=null),r??null}const ZPt={cachedResult:0};function W7e(t){return t.cachedResult!=null}function Q7e(t){return t==="0"?0:null}let Wm=class Y7e{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Xgt(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=XPt(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Ygt(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=br(e.offset,0)}updateFeatureExpressionInfoContext(e,r,i){if(k(e))return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&M(r)&&M(i)?(this._featureExpressionInfoContext=YPt(e),Sde(this._featureExpressionInfoContext,q7e(n.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new Y7e;return M(e)&&r.setFromElevationInfo(e),r}},JPt=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};var Hr;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(Hr||(Hr={}));let KPt=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},ny=class{get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}constructor(e,r,i,n,s,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e,r){this._stageLayer=r,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.add(this.stageObject)}destroy(){const e=this._stage;this._stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries)),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=this._stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),M(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(e,r){if(k(this._edgeState))return;const i=zbe(this._edgeState.baseMaterial);let n=!1;for(const s of this._edgeState.edgeMaterials)s.objectTransparency!==i&&(s.objectTransparency=i,n=!0);n&&this._resetEdgeObject(r),this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){k(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stage!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),M(this._edgeState))){const r=this._stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,n){if(this.elevationAligner==null)return;M(i)&&Sde(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>TP(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r),this._resetEdgeObject(n)}alignWithAbsoluteElevation(e,r,i){const n=(s,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,n,r),this._resetEdgeObject(i)}getCenterObjectSpace(e=G()){return Pe(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=fa()){const r=this.stageObject.boundingVolumeObjectSpace;return lIe(e,r.min),cIe(e,r.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.transformation;e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(vy)&&(Ot(vy,vy,this.stageObject.transformation),ze(e.render.origin,e.render.origin,vy),e.render.num++)}async getProjectedBoundingBox(e,r,i,n,s){const o=this.getBoundingBoxObjectSpace(s),a=eIt,l=oce(o)?1:a.length;for(let u=0;u<l;u++){const d=a[u];cv[0]=o[d[0]],cv[1]=o[d[1]],cv[2]=o[d[2]],Ot(cv,cv,this.stageObject.transformation),Bw[3*u+0]=cv[0],Bw[3*u+1]=cv[1],Bw[3*u+2]=cv[2]}if(!e(Bw,0,l))return null;qn(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],Bw[u+d]),o[d+3]=Math.max(o[d+3],Bw[u+d]);c&&i.push({location:Bw.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){um(o,vy);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(r.useViewElevation)d=br(r.service.getElevation(vy[0],vy[1],u),0);else try{const p=wde(o,r.service.spatialReference,r);d=br(await r.service.queryElevation(vy[0],vy[1],n,p,u),0)}catch{}aIe(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e,r){e===l1.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===l1.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}_resetEdgeObject(e){if(k(this._edgeState))return;const r=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(k(i))return;const n=zbe(i.baseMaterial);for(const s of i.edgeMaterials)s.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var s;return(s=this._stageLayer)==null?void 0:s.sync()})}};function zbe(t){return t.isVisible()?t.parameters.transparent?Hr.TRANSPARENT:Hr.OPAQUE:Hr.INVISIBLE}const Bw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],cv=G(),vy=G(),eIt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let X7e=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=br(e,0)}};var ua;(function(t){t[t.Recreate_Symbol=0]="Recreate_Symbol",t[t.Recreate_Graphics=1]="Recreate_Graphics",t[t.Fast_Update=2]="Fast_Update"})(ua||(ua={}));let Ede=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=ep.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===ep.LOADED?(e&&e(),br(this._loader,Promise.resolve())):this._loadStatus===ep.FAILED?(r&&r(this._loadError),br(this._loader,Promise.resolve())):(k(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=ep.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=ep.FAILED,!$o(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){M(this._abortController)?this._abortController=Gf(this._abortController):this._loadStatus===ep.LOADING&&(this._loadStatus=ep.FAILED),this._loader=null}};var ep;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(ep||(ep={}));const Z7e=3,Bne=3,J7e=10;let K7e=class{constructor(e,r=null){this.geometry=e,this.textures=r}};function V8(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),gN(e)}function Vbe(t){const e=new Array;return t.levels.forEach(r=>{r.components.forEach(i=>{M(i.textures)&&e.push(...i.textures)})}),gN(e)}function eke(t){const e=t.components.map(r=>r.geometry);return gN(e)}function Gbe(t){const e=[];return t.levels.forEach(r=>{r.components.forEach(i=>{e.push(i.geometry)})}),gN(e)}function tIt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function tke(t,e){const r=(i,n,s=!1)=>({levels:i.map(o=>{const a=n(o.tesselation);return s&&QTt(a),{components:[new K7e(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>HTt(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>NTt(e,1));case"cone":return r(NY,i=>nve(e,1,.5,i,!1),!0);case"inverted-cone":return r(NY,i=>nve(e,1,.5,i,!0),!0);case"cylinder":return r(NY,i=>WTt(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>jTt(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>BTt(e,1),!0);default:return}}const NY=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function rIt(t){return t.type==="fill"}function iIt(t){return t.type==="extrude"}function nIt(t){return t&&t.enabled&&(iIt(t)||rIt(t))&&M(t.edges)}function sIt(t){return t&&t.enabled&&t.edges||null}function rke(t,e){return oIt(sIt(t),e)}function oIt(t,e){if(k(t))return null;const r=M(t.color)?Ece($t.toUnitRGBA(t.color)):Fr(0,0,0,0),i=El(t.size),n=El(t.extensionLength);switch(t.type){case"solid":return aIt({color:r,size:i,extensionLength:n,...e});case"sketch":return lIt({color:r,size:i,extensionLength:n,...e});default:return}}function aIt(t){return{...cIt,...t,type:"solid"}}function lIt(t){return{...uIt,...t,type:"sketch"}}const cIt={color:Fr(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Hr.OPAQUE,hasSlicePlane:!1},uIt={color:Fr(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Hr.OPAQUE,hasSlicePlane:!1},Cde={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function Ufr(t){return t.type==="web-style"?Cde:Mde(t.symbolLayers.toArray().map(e=>ike(t,e)))}function Mde(t){let e=0,r=0,i=0,n=!1,s=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)k(a)||(e+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,n=n||a.estimated,++s);return{primitivesPerFeature:e,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:n,memory:o,numComplexities:s}}function Bfr(t){const e=Mde(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const jbe={};function ike(t,e){const r=nke(t,e),i=nIt(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:M(e.outline)&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return e.resource&&e.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...hIt(e.resource&&e.resource.primitive||yIe),memory:r};case"path":{let n=0,s=0;switch(e.profile){case"circle":n=J7e;break;case"quad":n=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":s=Z7e;break;case"miter":case"bevel":s=1;break;default:return}const o=2*n,a=n*s*2;let l=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":l+=2*(n-1);break;case"round":l+=2*(n*(Bne-1)*2+n);break;default:return}return{primitivesPerFeature:l,primitivesPerCoordinate:a+o,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function nke(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?$u.EXTRUDE_EDGES:$u.EXTRUDE;case"fill":return M(e.outline)&&e.outline.size>0?$u.FILL_OUTLINE:$u.FILL;case"water":return $u.FILL;case"line":return e.join==="round"?$u.LINE_ROUND:$u.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return $u.PATH_ROUND_CIRCLE;case"quad":return $u.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return $u.PATH_MITER_CIRCLE;case"quad":return $u.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?$u.OBJECT_POINT:$u.OBJECT_POLYGON;case"icon":case"text":return r?$u.ICON_POINT:$u.ICON_POLYGON;default:return}}function hIt(t){let e=jbe[t];if(e)return e;const r=tke(t,null);return e={primitivesPerFeature:eke(r.levels[0]).reduce((i,n)=>i+n.indices.get(z.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},jbe[t]=e,e}const $u={ICON_POINT:{bytesPerFeature:3293.7707557538765,bytesPerFeatureLabel:1020.2764,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2213.51585392203,bytesPerFeatureLabel:1008.84664,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:4745.397589234022,bytesPerFeatureLabel:1006.5440666666666,bytesPerCoordinate:3.8971910718981526,resourceBytes:0,draped:{bytesPerFeature:3711.9299672493826,bytesPerFeatureLabel:991.1003999999999,bytesPerCoordinate:3.916858016273668}},OBJECT_POINT:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855,resourceBytes:0,draped:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855}},LINE_MITER:{bytesPerFeature:5757.019675077085,bytesPerFeatureLabel:998.6150266666667,bytesPerCoordinate:24.456810187064043,resourceBytes:0,draped:{bytesPerFeature:4101.480288021862,bytesPerFeatureLabel:1007.7540599999999,bytesPerCoordinate:18.25629912730874}},LINE_ROUND:{bytesPerFeature:5770.95297166408,bytesPerFeatureLabel:1017.77396,bytesPerCoordinate:24.60919037084966,resourceBytes:0,draped:{bytesPerFeature:4089.5796612121826,bytesPerFeatureLabel:987.8320266666666,bytesPerCoordinate:18.43599029126731}},PATH_MITER_CIRCLE:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863,resourceBytes:0,draped:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863}},PATH_ROUND_CIRCLE:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177,resourceBytes:0,draped:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177}},PATH_MITER_QUAD:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994,resourceBytes:0,draped:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994}},PATH_ROUND_QUAD:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293,resourceBytes:0,draped:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293}},FILL:{bytesPerFeature:6141.501452970723,bytesPerFeatureLabel:1008.2056066666665,bytesPerCoordinate:9.669541106191478,resourceBytes:0,draped:{bytesPerFeature:4615.812654782311,bytesPerFeatureLabel:1004.2114200000001,bytesPerCoordinate:7.378043214430644}},FILL_OUTLINE:{bytesPerFeature:9038.575581319641,bytesPerFeatureLabel:1017.9996066666668,bytesPerCoordinate:14.96569682175086,resourceBytes:0,draped:{bytesPerFeature:6369.386021594582,bytesPerFeatureLabel:1008.9863733333334,bytesPerCoordinate:10.25287774000214}},EXTRUDE:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849,resourceBytes:0,draped:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849}},EXTRUDE_EDGES:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031,resourceBytes:0,draped:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031}}},d3=we.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let sy=class extends Ede{constructor(e,r,i,n){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=d3,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new Wm,this.complexity=this.computeComplexity(),this._ignoreDrivers=n.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=Hbe(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this._ignoreDrivers)return!1;const r=this._drivenProperties,i=Hbe(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,n){const s=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${n} geometry failed to be created`;let l=null;s?!this._logGeometryValidationWarnings(r,i,n)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&d3.warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const n=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(d3.warnOncePerTick(`${n} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(d3.warnOncePerTick(`${n} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(M(r)&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const n=e;if(!isFinite(n.x)||!isFinite(n.y))return d3.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return dIt}_defaultElevationInfoZ(){return pIt}_updateElevationContext(){M(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r){const i=e.geometry,n=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,r.mode=this.getGeometryElevationMode(i,n),r.offsetMeters=br(this._elevationContext.meterUnitOffset,br(n.offset,0));const s=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";s&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=s?ZPt:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=qbe){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(M(e)?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=qbe){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return Q5(null,i);const n=M(e)?$t.toUnitRGB(e):cA;return Q5(n,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,s=Q5(i,n);return M(r)&&(s[0]*=r,s[1]*=r,s[2]*=r,s[3]*=r),s}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return ike(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,n)!==Hs.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,r,i){let n=Hs.UPDATE;return e.forEach(s=>{const o=r(s);if(M(o)){const a=s.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else n=Hs.RECREATE}),n}applyRendererDiff(e,r){return ua.Recreate_Symbol}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const r=this._fastUpdates.visualVariables,i=r.size?G_(r.size.field,e):0,n=r.color?G_(r.color.field,e):0,s=r.opacity?G_(r.opacity.field,e):0;return Fr(i,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&d3.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var r,i,n,s,o,a,l,c,u,d,p,A;return{size:((n=(i=(r=this._fastUpdates)==null?void 0:r.visualVariables)==null?void 0:i.size)==null?void 0:n.field)??null,color:((a=(o=(s=this._fastUpdates)==null?void 0:s.visualVariables)==null?void 0:o.color)==null?void 0:a.field)??null,opacity:((u=(c=(l=this._fastUpdates)==null?void 0:l.visualVariables)==null?void 0:c.opacity)==null?void 0:u.field)??null,rotation:((A=(p=(d=this._fastUpdates)==null?void 0:d.visualVariables)==null?void 0:p.rotation)==null?void 0:A.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function G_(t,e){const r=t!=null?e.attributes[t]:0;return r!=null&&isFinite(r)?r:0}function Hbe(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const n=r.stops[i].color;n&&(e.opacity=!0,n.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const dIt={mode:"on-the-ground",offset:0,unit:"meters"},pIt={mode:"absolute-height",offset:0,unit:"meters"},qbe={hasIntrinsicColor:!1};let D1=class extends tF{get geometries(){return this._geometries}get transformation(){return this._transformation}set transformation(e){Ia(this._transformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}constructor(e={}){super(),this.type=lo.Object,this._geometries=new Array,this._transformation=ht(),this._bvObjectSpace=new Wbe,this._bvWorldSpace=new Wbe,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=e.castShadow==null||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new ske);const r=e.geometries;M(r)&&(this._geometries=Array.from(r))}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){tr(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new _z(l1.MaskOccludee);for(const r of this._geometries)r.occludees=mne(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=gne(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new _z(l1.Highlight);for(const r of this._geometries)r.highlights=mne(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=gne(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return js(r,this.transformation,e.transformation)}_getCombinedShaderTransformation(e){return js(ht(),this.transformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(const n of this._geometries){const s=n.boundingInfo;M(s)&&(Qbe(s,this._bvObjectSpace,n.shaderTransformation),Qbe(s,this._bvWorldSpace,this._getCombinedShaderTransformation(n)))}Eo(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Eo(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=G(),r=G(),i=$S(this.transformation);for(const n of this._geometries){const s=n.boundingInfo;if(k(s))continue;const o=n.shaderTransformation,a=$S(o);Ot(e,s.center,o);const l=zn(e,this._bvObjectSpace.bounds),c=s.radius*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),Ot(r,e,this.transformation);const u=zn(r,this._bvWorldSpace.bounds),d=c*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],u+d)}this._bvDirty=!1}_invalidateBoundingVolume(){this._bvDirty=!0,M(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,r){M(this._parentLayer)&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},ske=class{constructor(){this.min=pt(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=pt(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Wbe=class extends ske{constructor(){super(...arguments),this.bounds=Ho()}init(){Le(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Le(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),J$e(this.bounds)}};function Qbe(t,e,r){const i=t.bbMin,n=t.bbMax;if(YG(r)){const s=Le(fIt,r[12],r[13],r[14]);ze(Rd,i,s),ze(m0,n,s);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Rd[o]),e.max[o]=Math.max(e.max[o],m0[o])}else if(Ot(Rd,i,r),fu(i,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],Rd[s]),e.max[s]=Math.max(e.max[s],Rd[s]);else{Ot(m0,n,r);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],Rd[s],m0[s]),e.max[s]=Math.max(e.max[s],Rd[s],m0[s]);for(let s=0;s<3;++s){Pe(Rd,i),Pe(m0,n),Rd[s]=n[s],m0[s]=i[s],Ot(Rd,Rd,r),Ot(m0,m0,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Rd[o],m0[o]),e.max[o]=Math.max(e.max[o],Rd[o],m0[o])}}}const fIt=G(),Rd=G(),m0=G();function Rde(t,e,r,i,n,s){const o=t.clippingExtent;if(nc(e,Kb,t.elevationProvider.spatialReference),M(o)&&!nce(o,Kb))return null;nc(e,Kb,t.renderCoordsHelper.spatialReference);const a=t.localOriginFactory.getOrigin(Kb),l=new D1({castShadow:!1,metadata:{layerUid:t.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0}});return r.shaderTransformer=s,r.localOrigin=a,l.addGeometry(r),{object:l,sampledElevation:NPt(l,e,t.elevationProvider,t.renderCoordsHelper,i)}}function PL(t,e,r){const i=t.elevationContext,n=r.spatialReference;nc(e,Kb,n),i.centerPointInElevationSR=$1(Kb[0],Kb[1],e.hasZ?Kb[2]:0,M(n)?n:null)}function IL(t){switch(t.type){case"point":return t;case"polygon":case"extent":return bde(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=sPe(e,nPe(e)/2);return $1(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const Kb=G();function Ode(){return new Float32Array(2)}function mIt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function vf(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function gIt(t,e){return new Float32Array(t,e,2)}function oke(){return Ode()}function ake(){return vf(1,1)}function lke(){return vf(1,0)}function cke(){return vf(0,1)}const uke=oke(),hke=ake(),AIt=lke(),yIt=cke();Object.freeze(Object.defineProperty({__proto__:null,ONES:hke,UNIT_X:AIt,UNIT_Y:yIt,ZEROS:uke,clone:mIt,create:Ode,createView:gIt,fromValues:vf,ones:ake,unitX:lke,unitY:cke,zeros:oke},Symbol.toStringTag,{value:"Module"}));function _It(t){const e=new Ui;e.include(Phe),e.include(j9e,t),e.include(To,t),e.attributes.add(z.UV0,"vec2");const{vertex:r,fragment:i}=e;return r.uniforms.add([new pi("viewport",(n,s)=>s.camera.fullViewport),new ut("lineSize",(n,s)=>Math.ceil(n.size)*s.camera.pixelRatio),new ji("pixelToNDC",(n,s)=>ti(Xbe,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new ut("borderSize",(n,s)=>M(n.borderColor)?s.camera.pixelRatio:0),new ji("screenOffset",(n,s)=>ti(Xbe,n.screenOffset[0]*s.camera.pixelRatio,n.screenOffset[1]*s.camera.pixelRatio))]),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&eH(r),r.code.add(D`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?D`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?D`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:D`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?D`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:D`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?D`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:D`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add([new pi("uColor",n=>Ybe(n.color)),new pi("borderColor",n=>Ybe(n.borderColor))]),t.hasMultipassGeometry&&(i.include(g6e,t),i.uniforms.add(new ji("inverseViewport",(n,s)=>s.inverseViewport))),i.code.add(D`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?D`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:D`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function Ybe(t){return M(t)?t:vA}const Xbe=Ft(),vIt=Object.freeze(Object.defineProperty({__proto__:null,build:_It},Symbol.toStringTag,{value:"Module"}));let dke=class pke extends qi{initializeConfiguration(e,r){r.spherical=e.viewingMode===wt.Global}initializeProgram(e){return new zi(e.rctx,pke.shader.get().build(this.configuration),Di)}setPipelineState(e){const r=e?Qn.ALWAYS:Qn.LESS;return this.configuration.depthHudEnabled?Pr({depthTest:{func:r},depthWrite:_h}):Pr({blending:Da(st.ONE,st.SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:Gr})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};dke.shader=new Bi(vIt,()=>be(()=>import("./LineCallout.glsl-f3c83d28.js"),[]));let nf=class extends Xa{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=lh.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};h([ae({count:lh.COUNT})],nf.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([ae()],nf.prototype,"spherical",void 0),h([ae()],nf.prototype,"occlusionTestEnabled",void 0),h([ae()],nf.prototype,"hasVerticalOffset",void 0),h([ae()],nf.prototype,"hasScreenSizePerspective",void 0),h([ae()],nf.prototype,"depthHudEnabled",void 0),h([ae()],nf.prototype,"depthHudAlignStartEnabled",void 0),h([ae()],nf.prototype,"hasSlicePlane",void 0),h([ae()],nf.prototype,"hasMultipassGeometry",void 0),h([ae({constValue:!0})],nf.prototype,"hasSliceInVertexProgram",void 0),h([ae({constValue:!1})],nf.prototype,"isDraped",void 0);let G8=class zne extends lw{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new fke),this._configuration=new nf,this._uniqueMaterialIdentifier=zne.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,r){const i=(r==null?void 0:r.slot)!==nt.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=M(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=M(this.parameters.screenSizePerspective),this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?lh.Screen:lh.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,r){if(r===ne.Color)switch(e){case nt.LINE_CALLOUTS:case nt.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new bIt(e)}createBufferWriter(){return new xIt}validateParameters(e){const r=zne.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},bIt=class extends aw{beginSlot(e){return this.ensureTechnique(dke,e)}},fke=class extends xP{constructor(){super(...arguments),this.screenOffset=yh,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const wIt=Cs().vec3f(z.POSITION).vec3f(z.NORMAL).vec2f(z.UV0).vec4f(z.AUXPOS1),Zbe=[vf(0,0),vf(1,0),vf(0,1),vf(1,0),vf(1,1),vf(0,1)];let xIt=class{constructor(){this.vertexBufferLayout=wIt}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(z.POSITION).length}write(e,r,i,n,s){tH(i.indices.get(z.POSITION),i.vertexAttributes.get(z.POSITION).data,e,n.position,s,6),dde(i.indices.get(z.NORMAL),i.vertexAttributes.get(z.NORMAL).data,r,n.normal,s,6),xO(i.indices.get(z.AUXPOS1),i.vertexAttributes.get(z.AUXPOS1).data,n.auxpos1,s,6);for(let o=0;o<Zbe.length;++o)n.uv0.setVec(s+o,Zbe[o])}},mke=class gke extends sy{constructor(e,r){super(e,null,r,EIt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new G8(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.screenOffset=e.screenOffset||yh,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){const e=new fke,r=this.symbol,i=r.callout;if(e.color=M(i.color)?$t.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=El(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;e.verticalOffset={screenLength:El(o),minWorldLength:a||0,maxWorldLength:M(l)?l:1/0}}e.borderColor=M(i.border)&&M(i.border.color)?$t.toUnitRGBA(i.border.color):null;const n=r.symbolLayers.getItemAt(0).type==="object",s=r.type==="label-3d";return e.occlusionTest=!n,e.shaderPolygonOffset=n?0:void 0,e.depthHUDAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return SIt}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,n=this.setGraphicElevationContext(i,new Wm,r.elevationOffset||0),s=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&o||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!TIe(l)))return null;const a=bde(i.geometry);return k(a)?null:this._createAs3DShape(a,n,r,i.uid)}layerOpacityChanged(){M(this._material)&&this._material.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=aF(gke.elevationModeChangeTypes,i,n);return s!==Hs.UPDATE||e.forEach(o=>{const a=r(o);M(a)&&this.updateGraphicElevationContext(o.graphic,a)}),s}slicePlaneEnabledChanged(){return k(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}setGraphicElevationContext(e,r,i=0){const n=super.setGraphicElevationContext(e,r);return n.addOffsetRenderUnits(i),n}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,M(r.metadata)?r.metadata.elevationOffset:0),r.needsElevationUpdates=t0(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Cde.memory}}_createVertexData(e){const{translation:r,centerOffset:i}=e,n=new Pt(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),s=new Pt(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[z.POSITION,n],[z.NORMAL,new Pt([0,0,1],3,!0)],[z.AUXPOS1,s]]}_getOrCreateMaterial(e){const r=this._perInstanceMaterialParameters(e),i=G8.uniqueMaterialIdentifier(r);if(M(this._material)&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(M(e.materialCollection)){let n=e.materialCollection.get(i);return k(n)&&(n=new G8(r),e.materialCollection.add(i,n)),{material:n,isUnique:!1}}return{material:new G8(r),isUnique:!0}}_createAs3DShape(e,r,i,n){const s=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}),a=this._getOrCreateMaterial(i),l=new zo(a.material,this._createVertexData(i),TIt,null,lo.Point,o),c=Rde(this._context,e,l,r,n);if(k(c))return null;const u=new ny(this,c.object,[l],a.isUnique?[a.material]:null,null,OL,r);return u.metadata=new X7e(i.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=t0(r.mode),PL(u,e,this._context.elevationProvider),u}};mke.elevationModeChangeTypes={definedChanged:Hs.UPDATE,staysOnTheGround:Hs.UPDATE,onTheGroundChanged:Hs.RECREATE};const FY=[0],TIt=[[z.POSITION,FY],[z.NORMAL,FY],[z.AUXPOS1,FY]],SIt={mode:"relative-to-ground",offset:0},EIt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let CIt=class{constructor(e,r,i=G(),n=Kr(),s=Ft(),o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=n,this.screenOffset=s,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},MIt=class extends JPt{};const Jbe=we.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function RIt(t,e){if(!dce(t))return Jbe.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=OIt[t.callout.type];return r?new r(t,e):(Jbe.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const OIt={line:mke},Kbe=new Sl(Array,t=>FG(t,uIe),null,10,5),PIt=oi();let IIt=class{get labelLayers(){return this._labelLayers}get extent(){return this._extent}constructor(e,r,i,n,s){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._labelLayers=new Array,this._auxiliaryLayers=new Array,this._visibilityFlags=$It(wl._COUNT,td._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++r.referenced,this._featureExpressionFeature=s?q7e(s,e,n):null;for(const o of i)M(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}initialize(e,r){this._layer=r,this._stage=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e,r),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this.layers=null,this._auxiliaryLayers=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers.length=0}addLabelGraphic(e,r,i){this._labelLayers.push(e),e.initialize(r,i),e.setVisibility(this.isVisible(wl.LABEL))}addAuxiliaryGraphic(e){this._auxiliaryLayers.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=wl.GRAPHIC,r){for(let i=0;i<=e;i++){const n=this._visibilityFlags[i];for(let s=0;s<n.length;++s)if(n[s]===!1&&s!==r)return!1}return!0}hasVisibilityFlag(e,r){return this._visibilityFlags[r][e]!=null}setVisibilityFlag(e,r,i){const n=this.isVisible(i);this._visibilityFlags[i][e]=r;const s=this.isVisible(i);if(n===s)return!1;if(i===wl.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(s));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(s));const o=this.isVisible(wl.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(e,r=wl.GRAPHIC){return this.setVisibilityFlag(e,void 0,r)}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(k(r))return!1;this._extent=oi(),TPt(r,this._extent);const i=r.spatialReference;if(!jo(i,e)&&!ZG(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return M(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===r||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=r),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(e,r,i){let n=e.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=Hf.fromExtent(n.type==="mesh"?n.extent:n)),N0t(n,r,i)}get usedMemory(){let e=E$e(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(k(i))return;const n=r.type==="draped"?i.memory.draped:i.memory;e+=n.bytesPerFeature,n.bytesPerCoordinate&&(e+=xPt(this.graphic.geometry)*n.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:G(),num:0},draped:{origin:Ft(),num:0}};for(const r of this.layers)k(r)||r.computeAttachmentOrigin(e);return e.render.num>1&&Oe(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&ed(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?qn(s.boundingBox):s.boundingBox=qn(),s.requiresDrapedElevation=!1,await wG(this.layers,async o=>{if(k(o))return;const a=o.type==="draped"?r:e,l=Kbe.acquire(),c=await o.getProjectedBoundingBox(a,i,s.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&YR(s.boundingBox,l),Kbe.release(l)}),Zst(s.boundingBox)||dee(sce(s.boundingBox,PIt))?s:null}needsElevationUpdates(){for(const e of this.layers)if(M(e)&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;for(const e of this._labelLayers)if(e&&e.needsElevationUpdates)return!0;return!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(n=>{n.type==="object3d"&&n.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._forEachGraphicList(this._auxiliaryLayers,e)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}};function $It(t,e){const r=new Array(t);for(let i=0;i<r.length;i++)r[i]=new Array(e);return r}var e2e,t2e,r2e,V2={},DIt={get exports(){return V2},set exports(t){V2=t}};e2e=DIt,t2e=function(){function t(j,H,W){W=W||2;var oe,le,fe,de,Ee,Ie,Ge,Ke=H&&H.length,vt=Ke?H[0]*W:j.length,ke=e(j,0,vt,W,!0),Ne=[];if(!ke||ke.next===ke.prev)return Ne;if(Ke&&(ke=l(j,H,ke,W)),j.length>80*W){oe=fe=j[0],le=de=j[1];for(var Xe=W;Xe<vt;Xe+=W)(Ee=j[Xe])<oe&&(oe=Ee),(Ie=j[Xe+1])<le&&(le=Ie),Ee>fe&&(fe=Ee),Ie>de&&(de=Ie);Ge=(Ge=Math.max(fe-oe,de-le))!==0?1/Ge:0}return i(ke,Ne,W,oe,le,Ge),Ne}function e(j,H,W,oe,le){var fe,de;if(le===te(j,H,W,oe)>0)for(fe=H;fe<W;fe+=oe)de=se(fe,j[fe],j[fe+1],de);else for(fe=W-oe;fe>=H;fe-=oe)de=se(fe,j[fe],j[fe+1],de);if(de&&N(de,de.next)){var Ee=de.next;ue(de),de=Ee}return de}function r(j,H){if(!j)return j;H||(H=j);var W,oe=j;do if(W=!1,oe.steiner||!N(oe,oe.next)&&I(oe.prev,oe,oe.next)!==0)oe=oe.next;else{var le=oe.prev;if(ue(oe),(oe=H=le)===oe.next)break;W=!0}while(W||oe!==H);return H}function i(j,H,W,oe,le,fe,de){if(j){!de&&fe&&v(j,oe,le,fe);for(var Ee,Ie,Ge=j;j.prev!==j.next;)if(Ee=j.prev,Ie=j.next,fe?s(j,oe,le,fe):n(j))H.push(Ee.i/W),H.push(j.i/W),H.push(Ie.i/W),ue(j),j=Ie.next,Ge=Ie.next;else if((j=Ie)===Ge){de?de===1?i(j=o(r(j),H,W),H,W,oe,le,fe,2):de===2&&a(j,H,W,oe,le,fe):i(r(j),H,W,oe,le,fe,1);break}}}function n(j){var H=j.prev,W=j,oe=j.next;if(I(H,W,oe)>=0)return!1;for(var le=j.next.next;le!==j.prev;){if(R(H.x,H.y,W.x,W.y,oe.x,oe.y,le.x,le.y)&&I(le.prev,le,le.next)>=0)return!1;le=le.next}return!0}function s(j,H,W,oe){var le=j.prev,fe=j,de=j.next;if(I(le,fe,de)>=0)return!1;for(var Ee=le.x<fe.x?le.x<de.x?le.x:de.x:fe.x<de.x?fe.x:de.x,Ie=le.y<fe.y?le.y<de.y?le.y:de.y:fe.y<de.y?fe.y:de.y,Ge=le.x>fe.x?le.x>de.x?le.x:de.x:fe.x>de.x?fe.x:de.x,Ke=le.y>fe.y?le.y>de.y?le.y:de.y:fe.y>de.y?fe.y:de.y,vt=S(Ee,Ie,H,W,oe),ke=S(Ge,Ke,H,W,oe),Ne=j.prevZ,Xe=j.nextZ;Ne&&Ne.z>=vt&&Xe&&Xe.z<=ke;){if(Ne!==j.prev&&Ne!==j.next&&R(le.x,le.y,fe.x,fe.y,de.x,de.y,Ne.x,Ne.y)&&I(Ne.prev,Ne,Ne.next)>=0||(Ne=Ne.prevZ,Xe!==j.prev&&Xe!==j.next&&R(le.x,le.y,fe.x,fe.y,de.x,de.y,Xe.x,Xe.y)&&I(Xe.prev,Xe,Xe.next)>=0))return!1;Xe=Xe.nextZ}for(;Ne&&Ne.z>=vt;){if(Ne!==j.prev&&Ne!==j.next&&R(le.x,le.y,fe.x,fe.y,de.x,de.y,Ne.x,Ne.y)&&I(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.prevZ}for(;Xe&&Xe.z<=ke;){if(Xe!==j.prev&&Xe!==j.next&&R(le.x,le.y,fe.x,fe.y,de.x,de.y,Xe.x,Xe.y)&&I(Xe.prev,Xe,Xe.next)>=0)return!1;Xe=Xe.nextZ}return!0}function o(j,H,W){var oe=j;do{var le=oe.prev,fe=oe.next.next;!N(le,fe)&&L(le,oe,oe.next,fe)&&Z(le,fe)&&Z(fe,le)&&(H.push(le.i/W),H.push(oe.i/W),H.push(fe.i/W),ue(oe),ue(oe.next),oe=j=fe),oe=oe.next}while(oe!==j);return r(oe)}function a(j,H,W,oe,le,fe){var de=j;do{for(var Ee=de.next.next;Ee!==de.prev;){if(de.i!==Ee.i&&O(de,Ee)){var Ie=ee(de,Ee);return de=r(de,de.next),Ie=r(Ie,Ie.next),i(de,H,W,oe,le,fe),void i(Ie,H,W,oe,le,fe)}Ee=Ee.next}de=de.next}while(de!==j)}function l(j,H,W,oe){var le,fe,de,Ee=[];for(le=0,fe=H.length;le<fe;le++)(de=e(j,H[le]*oe,le<fe-1?H[le+1]*oe:j.length,oe,!1))===de.next&&(de.steiner=!0),Ee.push(E(de));for(Ee.sort(c),le=0;le<Ee.length;le++)W=r(W=d(Ee[le],W),W.next);return W}function c(j,H){return j.x-H.x}function u(j){if(j.next.prev===j)return j;let H=j;for(;;){const W=H.next;if(W.prev===H||W===H||W===j)break;H=W}return H}function d(j,H){var W=p(j,H);if(!W)return H;var oe=ee(W,j),le=r(W,W.next);let fe=u(oe);return r(fe,fe.next),le=u(le),u(H===W?le:H)}function p(j,H){var W,oe=H,le=j.x,fe=j.y,de=-1/0;do{if(fe<=oe.y&&fe>=oe.next.y&&oe.next.y!==oe.y){var Ee=oe.x+(fe-oe.y)*(oe.next.x-oe.x)/(oe.next.y-oe.y);if(Ee<=le&&Ee>de){if(de=Ee,Ee===le){if(fe===oe.y)return oe;if(fe===oe.next.y)return oe.next}W=oe.x<oe.next.x?oe:oe.next}}oe=oe.next}while(oe!==H);if(!W)return null;if(le===de)return W;var Ie,Ge=W,Ke=W.x,vt=W.y,ke=1/0;oe=W;do le>=oe.x&&oe.x>=Ke&&le!==oe.x&&R(fe<vt?le:de,fe,Ke,vt,fe<vt?de:le,fe,oe.x,oe.y)&&(Ie=Math.abs(fe-oe.y)/(le-oe.x),Z(oe,j)&&(Ie<ke||Ie===ke&&(oe.x>W.x||oe.x===W.x&&A(W,oe)))&&(W=oe,ke=Ie)),oe=oe.next;while(oe!==Ge);return W}function A(j,H){return I(j.prev,j,H.prev)<0&&I(H.next,j,j.next)<0}function v(j,H,W,oe){var le=j;do le.z===null&&(le.z=S(le.x,le.y,H,W,oe)),le.prevZ=le.prev,le.nextZ=le.next,le=le.next;while(le!==j);le.prevZ.nextZ=null,le.prevZ=null,b(le)}function b(j){var H,W,oe,le,fe,de,Ee,Ie,Ge=1;do{for(W=j,j=null,fe=null,de=0;W;){for(de++,oe=W,Ee=0,H=0;H<Ge&&(Ee++,oe=oe.nextZ);H++);for(Ie=Ge;Ee>0||Ie>0&&oe;)Ee!==0&&(Ie===0||!oe||W.z<=oe.z)?(le=W,W=W.nextZ,Ee--):(le=oe,oe=oe.nextZ,Ie--),fe?fe.nextZ=le:j=le,le.prevZ=fe,fe=le;W=oe}fe.nextZ=null,Ge*=2}while(de>1);return j}function S(j,H,W,oe,le){return(j=1431655765&((j=858993459&((j=252645135&((j=16711935&((j=32767*(j-W)*le)|j<<8))|j<<4))|j<<2))|j<<1))|(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H=32767*(H-oe)*le)|H<<8))|H<<4))|H<<2))|H<<1))<<1}function E(j){var H=j,W=j;do(H.x<W.x||H.x===W.x&&H.y<W.y)&&(W=H),H=H.next;while(H!==j);return W}function R(j,H,W,oe,le,fe,de,Ee){return(le-de)*(H-Ee)-(j-de)*(fe-Ee)>=0&&(j-de)*(oe-Ee)-(W-de)*(H-Ee)>=0&&(W-de)*(fe-Ee)-(le-de)*(oe-Ee)>=0}function O(j,H){return j.next.i!==H.i&&j.prev.i!==H.i&&!q(j,H)&&(Z(j,H)&&Z(H,j)&&X(j,H)&&(I(j.prev,j,H.prev)||I(j,H.prev,H))||N(j,H)&&I(j.prev,j,j.next)>0&&I(H.prev,H,H.next)>0)}function I(j,H,W){return(H.y-j.y)*(W.x-H.x)-(H.x-j.x)*(W.y-H.y)}function N(j,H){return j.x===H.x&&j.y===H.y}function L(j,H,W,oe){var le=U(I(j,H,W)),fe=U(I(j,H,oe)),de=U(I(W,oe,j)),Ee=U(I(W,oe,H));return le!==fe&&de!==Ee||!(le!==0||!B(j,W,H))||!(fe!==0||!B(j,oe,H))||!(de!==0||!B(W,j,oe))||!(Ee!==0||!B(W,H,oe))}function B(j,H,W){return H.x<=Math.max(j.x,W.x)&&H.x>=Math.min(j.x,W.x)&&H.y<=Math.max(j.y,W.y)&&H.y>=Math.min(j.y,W.y)}function U(j){return j>0?1:j<0?-1:0}function q(j,H){var W=j;do{if(W.i!==j.i&&W.next.i!==j.i&&W.i!==H.i&&W.next.i!==H.i&&L(W,W.next,j,H))return!0;W=W.next}while(W!==j);return!1}function Z(j,H){return I(j.prev,j,j.next)<0?I(j,H,j.next)>=0&&I(j,j.prev,H)>=0:I(j,H,j.prev)<0||I(j,j.next,H)<0}function X(j,H){var W=j,oe=!1,le=(j.x+H.x)/2,fe=(j.y+H.y)/2;do W.y>fe!=W.next.y>fe&&W.next.y!==W.y&&le<(W.next.x-W.x)*(fe-W.y)/(W.next.y-W.y)+W.x&&(oe=!oe),W=W.next;while(W!==j);return oe}function ee(j,H){var W=new re(j.i,j.x,j.y),oe=new re(H.i,H.x,H.y),le=j.next,fe=H.prev;return j.next=H,H.prev=j,W.next=le,le.prev=W,oe.next=W,W.prev=oe,fe.next=oe,oe.prev=fe,oe}function se(j,H,W,oe){var le=new re(j,H,W);return oe?(le.next=oe.next,le.prev=oe,oe.next.prev=le,oe.next=le):(le.prev=le,le.next=le),le}function ue(j){j.next.prev=j.prev,j.prev.next=j.next,j.prevZ&&(j.prevZ.nextZ=j.nextZ),j.nextZ&&(j.nextZ.prevZ=j.prevZ)}function re(j,H,W){this.i=j,this.x=H,this.y=W,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function te(j,H,W,oe){for(var le=0,fe=H,de=W-oe;fe<W;fe+=oe)le+=(j[de]-j[fe])*(j[fe+1]+j[de+1]),de=fe;return le}return t.deviation=function(j,H,W,oe){var le=H&&H.length,fe=le?H[0]*W:j.length,de=Math.abs(te(j,0,fe,W));if(le)for(var Ee=0,Ie=H.length;Ee<Ie;Ee++){var Ge=H[Ee]*W,Ke=Ee<Ie-1?H[Ee+1]*W:j.length;de-=Math.abs(te(j,Ge,Ke,W))}var vt=0;for(Ee=0;Ee<oe.length;Ee+=3){var ke=oe[Ee]*W,Ne=oe[Ee+1]*W,Xe=oe[Ee+2]*W;vt+=Math.abs((j[ke]-j[Xe])*(j[Ne+1]-j[ke+1])-(j[ke]-j[Ne])*(j[Xe+1]-j[ke+1]))}return de===0&&vt===0?0:Math.abs((vt-de)/de)},t.flatten=function(j){for(var H=j[0][0].length,W={vertices:[],holes:[],dimensions:H},oe=0,le=0;le<j.length;le++){for(var fe=0;fe<j[le].length;fe++)for(var de=0;de<H;de++)W.vertices.push(j[le][fe][de]);le>0&&(oe+=j[le-1].length,W.holes.push(oe))}return W},t},(r2e=t2e())!==void 0&&(e2e.exports=r2e);const cH=we.getLogger("esri.views.3d.support.buffer.math");function cF(t,e,r){if(t.count!==e.count)return void cH.error("source and destination buffers need to have the same number of elements");const i=t.count,n=r[0],s=r[1],o=r[2],a=r[4],l=r[5],c=r[6],u=r[8],d=r[9],p=r[10],A=r[12],v=r[13],b=r[14],S=t.typedBuffer,E=t.typedBufferStride,R=e.typedBuffer,O=e.typedBufferStride;for(let I=0;I<i;I++){const N=I*E,L=I*O,B=R[L],U=R[L+1],q=R[L+2];S[N]=n*B+a*U+u*q+A,S[N+1]=s*B+l*U+d*q+v,S[N+2]=o*B+c*U+p*q+b}}function G2(t,e,r){if(t.count!==e.count)return void cH.error("source and destination buffers need to have the same number of elements");const i=t.count,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],d=r[7],p=r[8],A=t.typedBuffer,v=t.typedBufferStride,b=e.typedBuffer,S=e.typedBufferStride;for(let E=0;E<i;E++){const R=E*v,O=E*S,I=b[O],N=b[O+1],L=b[O+2];A[R]=n*I+a*N+u*L,A[R+1]=s*I+l*N+d*L,A[R+2]=o*I+c*N+p*L}}function Vne(t,e,r){const i=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<i;l++){const c=l*s,u=l*a;n[c]=r*o[u],n[c+1]=r*o[u+1],n[c+2]=r*o[u+2]}}function Pde(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*n,c=a*o,u=s[c],d=s[c+1],p=s[c+2],A=u*u+d*d+p*p;if(A>0){const v=1/Math.sqrt(A);i[l]=v*u,i[l+1]=v*d,i[l+2]=v*p}}}function LIt(t,e,r){const i=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<i;l++){const c=l*s,u=l*a;n[c]=o[u]>>r,n[c+1]=o[u+1]>>r,n[c+2]=o[u+2]>>r}}Object.freeze(Object.defineProperty({__proto__:null,normalize:Pde,scale:Vne,shiftRight:LIt,transformMat3:G2,transformMat4:cF},Symbol.toStringTag,{value:"Module"}));function NIt(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function i2e(t,e,r,i,n,s=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:n,draped:s}}function uH(t,e){if(!t||t.symbol)return null;const r=e&&e.renderer;return t&&M(r)&&r.getObservationRenderer?r.getObservationRenderer(t):r}function FIt(t,e){if(M(t.symbol))return t.symbol;const r=uH(t,e);return M(r)&&r.type!=="dot-density"?r.getSymbol(t,e):null}function Jfr(t,e){const r=uH(t,e),i=FIt(t,e);if(k(i))return null;const n={renderer:r,symbol:i};if(k(r)||!("visualVariables"in r)||!r.visualVariables)return n;const s=Aue(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)switch(a.type){case"color":n.color=l.toRgba();break;case"size":if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":n.opacity=l;break;case"rotation":switch(a.axis){case"tilt":n.tilt=l;break;case"roll":n.roll=l;break;default:n.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(n.size=o),n}async function kIt(t,e){if(M(t.symbol))return t.symbol;const r=uH(t,e);return M(r)?r.getSymbolAsync(t,e):null}async function Kfr(t,e){const r=uH(t,e),i=await kIt(t,e);if(!i)return null;const n={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return n;const s=Aue(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)if(a.type==="color")n.color=$t.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?n.opacity=l:a.type==="rotation"&&a.axis==="tilt"?n.tilt=l:a.type==="rotation"&&a.axis==="roll"?n.roll=l:a.type==="rotation"&&(n.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(n.size=o),n}function UIt(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function BIt(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function n2e(t){const e=[[z.POSITION,t.indices]],r=[[z.POSITION,new Pt(t.attributeData.position,3,!0)]];return M(t.attributeData.color)&&(r.push([z.COLOR,new Pt(t.attributeData.color,4,!0)]),e.push([z.COLOR,new Array(t.indices.length).fill(0)])),M(t.attributeData.uvMapSpace)&&(r.push([z.UVMAPSPACE,new Pt(t.attributeData.uvMapSpace,4,!0)]),e.push([z.UVMAPSPACE,t.indices])),M(t.attributeData.boundingRect)&&(r.push([z.BOUNDINGRECT,new Pt(t.attributeData.boundingRect,9,!0)]),e.push([z.BOUNDINGRECT,t.indices])),new zo(t.material,r,e,t.mapPositions,lo.Mesh,t.attributeData.objectAndLayerIdColor)}function s2e(t){const e=[[z.POSITION,t.indices],[z.UV0,t.indices]],r=[[z.POSITION,new Pt(t.attributeData.position,3,!0)],[z.UV0,new Pt(t.attributeData.uv0,2,!0)]];return new zo(t.material,r,e,t.mapPositions)}function $L(t){switch(t.type){case"extent":if(t instanceof an)return Hf.fromExtent(t);break;case"polygon":return t}return null}let hH=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function Gne(t,e,r){const i=Array.isArray(t),n=i?t.length/e:t.byteLength/(4*e),s=i?t:new Uint32Array(t,0,n*e),o=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let u=0;if(c)for(let L=0;L<c.length-1;L++){const B=c[L+1]-c[L];B>u&&(u=B)}else u=n;const d=Math.floor(1.1*u)+1;(og==null||og.length<2*d)&&(og=new Uint32Array(VR(2*d)));for(let L=0;L<2*d;L++)og[L]=0;let p=0;const A=!!c&&!!a,v=A?l:n;let b=t8e(n/3);const S=new Uint32Array(l),E=1.96;let R=o!==0?Math.ceil(4*E*E/(o*o)*o*(1-o)):v,O=1,I=c?c[1]:v;for(let L=0;L<v;L++){if(L===R){const ee=1-p/L;if(ee+E*Math.sqrt(ee*(1-ee)/L)<o)return null;R*=2}if(L===I){for(let ee=0;ee<2*d;ee++)og[ee]=0;if(a)for(let ee=c[O-1];ee<c[O];ee++)S[ee]=b[a[ee]];I=c[++O]}const B=A?a[L]:L,U=B*e,q=GIt(s,U,e);let Z=q%d,X=p;for(;og[2*Z+1]!==0;){if(og[2*Z]===q){const ee=og[2*Z+1]-1;if(zIt(s,U,ee*e,e)){X=b[ee];break}}Z++,Z>=d&&(Z-=d)}X===p&&(og[2*Z]=q,og[2*Z+1]=B+1,p++),b[B]=X}if(o!==0&&1-p/n<o)return null;if(A){for(let L=c[O-1];L<S.length;L++)S[L]=b[a[L]];b=aR(S)}const N=i?new Array(p):new Uint32Array(p*e);p=0;for(let L=0;L<v;L++)b[L]===p&&(VIt(s,(A?a[L]:L)*e,N,p*e,e),p++);if(a&&!A){const L=new Uint32Array(l);for(let B=0;B<L.length;B++)L[B]=b[a[B]];b=aR(L)}return{buffer:Array.isArray(N)?N:N.buffer,indices:b,uniqueCount:p}}function zIt(t,e,r,i){for(let n=0;n<i;n++)if(t[e+n]!==t[r+n])return!1;return!0}function VIt(t,e,r,i,n){for(let s=0;s<n;s++)r[i+s]=t[e+s]}function GIt(t,e,r){let i=0;for(let n=0;n<r;n++)i=t[e+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let og=null;function t0r(t){const e=uF(t.rings,t.hasZ,zA.CCW_IS_HOLE),r=new Array;let i=0,n=0;for(const a of e.polygons){const l=a.count,c=a.index,u=Ff(e.position,3*c,3*l),d=a.holeIndices.map(A=>A-c),p=new Uint32Array(V2(u,d,3));r.push({position:u,faces:p}),i+=u.length,n+=p.length}const s=jIt(r,i,n),o=Array.isArray(s.position)?Gne(s.position,3,{originalIndices:s.faces}):Gne(s.position.buffer,6,{originalIndices:s.faces});return s.position=new Float64Array(o.buffer),s.faces=o.indices,s}function jIt(t,e,r){if(t.length===1)return t[0];const i=yd(e),n=new Uint32Array(r);let s=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[s++]=l.position[c];for(let c=0;c<l.faces.length;c++)n[o++]=l.faces[c]+a;a=s/3}return{position:i,faces:n}}function uF(t,e,r){const i=t.length,n=new Array(i),s=new Array(i),o=new Array(i);let a=0,l=0,c=0,u=0;for(let A=0;A<i;++A)u+=t[A].length;const d=yd(3*u);let p=0;for(let A=i-1;A>=0;A--){const v=t[A],b=r===zA.CCW_IS_HOLE&&HIt(v);if(b&&i!==1)n[a++]=v;else{let S=v.length;for(let R=0;R<a;++R)S+=n[R].length;const E={index:p,pathLengths:new Array(a+1),count:S,holeIndices:new Array(a)};E.pathLengths[0]=v.length,v.length>0&&(o[c++]={index:p,count:v.length}),p=b?j8(v,v.length-1,-1,d,p,v.length,e):j8(v,0,1,d,p,v.length,e);for(let R=0;R<a;++R){const O=n[R];E.holeIndices[R]=p,E.pathLengths[R+1]=O.length,O.length>0&&(o[c++]={index:p,count:O.length}),p=j8(O,0,1,d,p,O.length,e)}a=0,E.count>0&&(s[l++]=E)}}for(let A=0;A<a;++A){const v=n[A];v.length>0&&(o[c++]={index:p,count:v.length}),p=j8(v,0,1,d,p,v.length,e)}return s.length=l,o.length=c,{position:d,polygons:s,outlines:o}}function j8(t,e,r,i,n,s,o){n*=3;for(let a=0;a<s;++a){const l=t[e];i[n++]=l[0],i[n++]=l[1],i[n++]=o?l[2]:0,e+=r}return n/3}function HIt(t){return!oPe(t,!1,!1)}var zA;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(zA||(zA={}));var Y5,Gz,jne;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(Y5||(Y5={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(Gz||(Gz={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(jne||(jne={}));var bs,bf,gr,X5,Vs,sa,Ac;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(bs||(bs={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(bf||(bf={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(gr||(gr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(X5||(X5={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(Vs||(Vs={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(sa||(sa={})),function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"}(Ac||(Ac={}));let qIt=class{constructor(e,r){this.vec3=e,this.id=r}};function Z5(t,e,r,i){return new qIt(pt(t,e,r),i)}var ih;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(ih||(ih={}));let o2e=class{get extent(){return this._extent}constructor(e,r){this.index=e,this.renderTargets=r,this._extent=oi(),this.resolution=0,this.renderLocalOrigin=Z5(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new WIt,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const r=e===ih.ColorAndWater?this.renderTargets.getTarget(Vs.Color):e===ih.Highlight?this.renderTargets.getTarget(Vs.Highlight):e===ih.ObjectAndLayerIdColor?this.renderTargets.getTarget(Vs.ObjectAndLayerIdColor):this.renderTargets.getTarget(Vs.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(Vs.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(Vs.Color):null}getNormalTexture(e){const r=e===ih.ColorAndWater?this.renderTargets.getTarget(Vs.Water):null;return r?r.getTexture():null}draw(e,r){const i=this.computeRenderTargetValidityBitfield();for(const n of this.renderTargets.renderTargets)n.type!==Vs.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[n.type]=e.drawTarget(this,n,r):this.validTargets[n.type]=!1;return i^this.computeRenderTargetValidityBitfield()?fO.CHANGED:fO.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[Vs.Color]|+e[Vs.ColorNoRasterImage]<<1|+e[Vs.Highlight]<<2|+e[Vs.Water]<<3|+e[Vs.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];OB(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];OB(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,i1(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===bs.INNER?0:this.resolution,0,this.resolution,this.resolution)}},WIt=class{constructor(){this.extents=[oi(),oi(),oi()],this.numViews=0}},Ake=class{constructor(e,r){this._size=Ode(),this._fbo=null,this._fbo=new uo(e,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE},{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:zt.LINEAR_MIPMAP_LINEAR,hasMipmap:r,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=kt(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(e,r){this._size[0]=e,this._size[1]=r,this._fbo.resize(this._size[0],this._size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){const e=this._fbo.colorTexture;e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},p3=class{constructor(e,r,i,n=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new Ake(e,n)}},QIt=class{constructor(e){this.renderTargets=[new p3(e,ne.Color,Vs.Color),new p3(e,ne.Color,Vs.ColorNoRasterImage),new p3(e,ne.Highlight,Vs.Highlight,!1),new p3(e,ne.Normal,Vs.Water),new p3(e,ne.Color,Vs.Occluded)],Fe("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new p3(e,ne.ObjectAndLayerIdColor,Vs.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,r,i){if(e)r.lastUsed=i;else if(i-r.lastUsed>YIt)r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0;else if(r.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,r)=>e+r.fbo.gpuMemoryUsage,0)}};const YIt=1e3;let yke=class{constructor(e){this._context=e,this._perConstructorInstances=new yP,this._frameCounter=0,this._keepAliveFrameCount=a2e}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=ZIt){const i=r.key;let n=this._perConstructorInstances.get(e,i);if(k(n)){const s=new e(this._context,r,()=>this.release(s));n=new XIt(s),this._perConstructorInstances.set(e,i,n)}return++n.refCount,n.technique}releaseAndAcquire(e,r,i){if(M(i)){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(k(e)||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);k(r)||(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==a2e&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,n)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,n))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const n=async(s,o)=>{const a=o.shader;a&&(await a.reload(),s.forEach(l=>l.technique.reload(this._context)))};e.push(n(r,i))}),await Promise.all(e)}},XIt=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const a2e=-1,ZIt=new Nc;let _ke=class{constructor(e,r,i,n){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=n,this._id2glMaterialRef=new yP}dispose(){this._textureRepository.destroy()}acquire(e,r,i){if(this._ownMaterial(e),!e.requiresSlot(r,i))return null;let n=this._id2glMaterialRef.get(i,e.id);if(k(n)){const s=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});n=new JIt(s),this._id2glMaterialRef.set(i,e.id,n)}return n.ref(),n.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);M(i)&&(i.unref(),i.referenced||(kt(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){M(e.repository)&&e.repository!==this&&we.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},JIt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,tr(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const KIt={orderedRepackingEnabled:!1},e$t={rootOrigin:null},t$t=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let Hne=class qne{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new ja,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),ja.clearPool(),Wne[0]=null,zw.prune(),Jx.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=ja.acquire();for(let n=0;n<r;n++){const s=e[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(i.init(this._root),this._add(s,i))}ja.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=ja.acquire();for(const n of e){const s=M(r)?r:rO(this._objectToBoundingSphere(n),o$t);I4(s[3])?(i.init(this._root),this._remove(n,s,i)):this._degenerateObjects.delete(n)}ja.release(i),this._shrink()}update(e,r){if(!I4(r[3])&&this._isDegenerate(e))return;const i=s$t(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const n=xp(e,r);this._forEachNode(this._root,s=>{if(!this._intersectsNode(n,s))return!1;const o=s.node;return o.terminals.forAll(a=>{this._intersectsObject(n,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(n,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,n){const s=xp(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(s,o,n))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,n=()=>!0,s=1/0){let o=1/0,a=1/0,l=null;const c=kY(e,r),u=d=>{if(--s,!n(d))return;const p=this._objectToBoundingSphere(d);if(!Zb(i,p))return;const A=_b(e,r,p),v=A-p[3],b=A+p[3];v<o&&(o=v,a=b,l=d)};return this._forEachNodeDepthOrdered(this._root,d=>{if(s<=0||!Zb(i,d.bounds)||(Oe(Np,c,d.halfSize),ze(Np,Np,d.bounds),_b(e,r,Np)>a))return!1;const p=d.node;return p.terminals.forAll(A=>u(A)),p.residents!==null&&p.residents.forAll(A=>u(A)),!0},e,r),l}forEachInDepthRange(e,r,i,n,s,o,a){let l=-1/0,c=1/0;const u={setRange:b=>{i===qne.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,b.near),c=Math.min(c,b.far)):(l=Math.max(l,-b.far),c=Math.min(c,-b.near))}};u.setRange(n);const d=_b(r,i,e),p=kY(r,i),A=kY(r,-i),v=b=>{if(!a(b))return;const S=this._objectToBoundingSphere(b),E=S,R=_b(r,i,E)-d,O=R-S[3],I=R+S[3];O>c||I<l||!Zb(o,S)||s(b,u)};this._forEachNodeDepthOrdered(this._root,b=>{if(!Zb(o,b.bounds)||(Oe(Np,p,b.halfSize),ze(Np,Np,b.bounds),_b(r,i,Np)-d>c)||(Oe(Np,A,b.halfSize),ze(Np,Np,b.bounds),_b(r,i,Np)-d<l))return!1;const S=b.node;return S.terminals.forAll(E=>v(E)),S.residents!==null&&S.residents.forAll(E=>v(E)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize))}forEachNeighbor(e,r){const i=F_(r),n=r,s=l=>{const c=this._objectToBoundingSphere(l),u=F_(c),d=i+u;return!(Cl(c,n)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=s(l))};this._forEachNode(this._root,l=>{const c=F_(l.bounds),u=i+c;if(Cl(l.bounds,n)-u*u>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return H8(r.bounds,2*-r.halfSize,Jd),H8(r.bounds,2*r.halfSize,Kd),eve(e.origin,e.direction,Jd,Kd)}_intersectsNodeWithOffset(e,r,i){return H8(r.bounds,2*-r.halfSize,Jd),H8(r.bounds,2*r.halfSize,Kd),i.applyToMinMax(Jd,Kd),eve(e.origin,e.direction,Jd,Kd)}_intersectsObject(e,r){const i=this._objectToBoundingSphere(r);return!(i[3]>0)||ite(i,e)}_intersectsObjectWithOffset(e,r,i){const n=this._objectToBoundingSphere(r);return!(n[3]>0)||ite(i.applyToBoundingSphere(n),e)}_forEachNode(e,r){let i=ja.acquire().init(e);const n=[i];for(;n.length!==0;){if(i=n.pop(),r(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&n.push(ja.acquire().init(i).advance(s));ja.release(i)}}_forEachNodeDepthOrdered(e,r,i,n=qne.DepthOrder.FRONT_TO_BACK){let s=ja.acquire().init(e);const o=[s];for(n$t(i,n,u2e);o.length!==0;){if(s=o.pop(),r(s)&&!s.isLeaf())for(let a=7;a>=0;--a){const l=u2e[a];s.node.children[l]&&o.push(ja.acquire().init(s).advance(l))}ja.release(s)}}_remove(e,r,i){zw.clear();const n=i.advanceTo(r,(s,o)=>{zw.push(s.node),zw.push(o)})?i.node.terminals:i.node.residents;if(n.removeUnordered(e),n.length===0)for(let s=zw.length-2;s>=0;s-=2){const o=zw.data[s],a=zw.data[s+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new Vr({shrink:!0})),!0)}_add(e,r){r.advanceTo(this._objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const n=ja.acquire().init(e);this._add(r.getItemAt(i),n),ja.release(n)}}_grow(e,r){if(r!==0&&(l2e(e,r,i=>this._objectToBoundingSphere(i),by),I4(by[3])&&!this._fitsInsideTree(by)))if(this._nodeIsEmpty(this._root.node))rO(by,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(by);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(by,i):this._growRootAsSubNode(i),ja.release(i)}}_rebuildTree(e,r){Pe(BY,r.bounds),BY[3]=r.halfSize,l2e([e,BY],2,n=>n,zY);const i=ja.acquire().init(this._root);this._root.initFrom(null,zY,zY[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),ja.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,n=>(i=Math.max(i,n.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let n=-1/0;const s=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=s[l]-o-(i[l]-r),u=i[l]+r-(s[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),p=Math.max(0,Math.ceil(u/(2*o)))+1,A=2**Math.ceil(Math.log(d+p)*Math.LOG2E);n=Math.max(n,A),q8[l].min=d,q8[l].max=p}for(let l=0;l<3;l++){let c=q8[l].min,u=q8[l].max;const d=(n-(c+u))/2;c+=Math.ceil(d),u+=Math.floor(d);const p=s[l]-o-c*o*2;UY[l]=p+(u+c)*o}const a=n*o;return UY[3]=a*bke,ja.acquire().initFrom(null,UY,a,0)}_growRootAsSubNode(e){const r=this._root.node;Pe(by,this._root.bounds),by[3]=this._root.halfSize,this._root.init(e),e.advanceTo(by,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,n=0;for(;n<r.length&&e==null;)i=n++,e=r[i];for(;n<r.length;)if(r[n++])return-1;return i}_isDegenerate(e){return!I4(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}},ja=class BC{constructor(){this.bounds=Ho(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,n=this.depth){return this.node=M(e)?e:BC.createEmptyNode(),M(r)&&rO(r,this.bounds),this.halfSize=i,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*bke}advance(e){let r=this.node.children[e];r||(r=BC.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=vke[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);r&&r(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Vr({shrink:!0}),residents:new Vr({shrink:!0})}}static acquire(){return BC._pool.acquire()}static release(e){BC._pool.release(e)}static clearPool(){BC._pool.prune()}};function r$t(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function i$t(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function H8(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function l2e(t,e,r,i){if(e===1){const n=r(t[0]);rO(n,i)}else{Jd[0]=1/0,Jd[1]=1/0,Jd[2]=1/0,Kd[0]=-1/0,Kd[1]=-1/0,Kd[2]=-1/0;for(let n=0;n<e;n++){const s=r(t[n]);I4(s[3])&&(r$t(Jd,s),i$t(Kd,s))}Eo(i,Jd,Kd,.5),i[3]=Math.max(Kd[0]-Jd[0],Kd[1]-Jd[1],Kd[2]-Jd[2])/2}}function n$t(t,e,r){if(!Jx.length)for(let i=0;i<8;++i)Jx.push({index:0,distance:0});for(let i=0;i<8;++i){const n=vke[i];Jx.data[i].index=i,Jx.data[i].distance=_b(t,e,n)}Jx.sort((i,n)=>i.distance-n.distance);for(let i=0;i<8;++i)r[i]=Jx.data[i].index}function kY(t,e){let r,i=1/0;for(let n=0;n<8;++n){const s=_b(t,e,c2e[n]);s<i&&(i=s,r=c2e[n])}return r}function _b(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function I4(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}ja._pool=new Sl(ja),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(Hne||(Hne={}));const vke=[pt(-1,-1,-1),pt(1,-1,-1),pt(-1,1,-1),pt(1,1,-1),pt(-1,-1,1),pt(1,-1,1),pt(-1,1,1),pt(1,1,1)],c2e=[pt(-1,-1,-1),pt(-1,-1,1),pt(-1,1,-1),pt(-1,1,1),pt(1,-1,-1),pt(1,-1,1),pt(1,1,-1),pt(1,1,1)],bke=Math.sqrt(3),Wne=[null];function s$t(t){return Wne[0]=t,Wne}const UY=Ho(),Np=G(),Jd=G(),Kd=G(),zw=new Vr,o$t=Ho(),by=Ho(),BY=Ho(),zY=Ho(),q8=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Jx=new Vr,u2e=[0,0,0,0,0,0,0,0],gm=Hne;var y2;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(y2||(y2={}));let wke=class extends tF{get objects(){return this._objects}constructor(e,r=""){super(),this.apiLayerUid=r,this.type=lo.Layer,this.events=new Ws,this.sliceable=!1,this._objects=new Vr,this._objectsAdded=new Vr,this._stageHandles=new cn,this.apiLayerUid=r,this.visible=(e==null?void 0:e.visible)??!0,this.pickable=(e==null?void 0:e.pickable)??!0,this.updatePolicy=(e==null?void 0:e.updatePolicy)??y2.ASYNC,this._disableOctree=(e==null?void 0:e.disableOctree)??!1}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const r of t$t)this._stageHandles.add(this.events.on(r,i=>e.handleEvent(r,i)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),M(this._octree)&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),M(this._octree)&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),M(this._octree)&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),M(this._octree)){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){M(this._stage)&&this.updatePolicy!==y2.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){M(this._octree)&&!this._objectsAdded.includes(e)&&this._octree.update(e,r)}getSpatialQueryAccelerator(){return k(this._octree)&&this._objects.length>50&&!this._disableOctree?(this._octree=new gm(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):M(this._octree)&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=yt(this._octree),this._objectsAdded.clear()}};function jz(t){return M(t)&&t.type===lo.Layer}var kf,YS;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(kf||(kf={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(YS||(YS={}));let ml=class extends Xa{constructor(){super(...arguments),this.output=ne.Color,this.transparencyPassType=dr.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=kf.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=YS.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};h([ae({count:ne.COUNT})],ml.prototype,"output",void 0),h([ae({count:dr.COUNT})],ml.prototype,"transparencyPassType",void 0),h([ae()],ml.prototype,"occluder",void 0),h([ae()],ml.prototype,"hasSlicePlane",void 0),h([ae()],ml.prototype,"writeDepth",void 0),h([ae({count:kf.COUNT})],ml.prototype,"space",void 0),h([ae()],ml.prototype,"hideOnShortSegments",void 0),h([ae()],ml.prototype,"hasCap",void 0),h([ae({count:YS.COUNT})],ml.prototype,"anchor",void 0),h([ae()],ml.prototype,"hasTip",void 0),h([ae()],ml.prototype,"vvSize",void 0),h([ae()],ml.prototype,"vvColor",void 0),h([ae()],ml.prototype,"vvOpacity",void 0),h([ae()],ml.prototype,"hasOccludees",void 0),h([ae()],ml.prototype,"hasMultipassTerrain",void 0),h([ae()],ml.prototype,"cullAboveGround",void 0),h([ae({constValue:!0})],ml.prototype,"hasVvInstancing",void 0),h([ae({constValue:!0})],ml.prototype,"hasSliceTranslatedView",void 0);const h2e=8;function xke(t,e){const r=t.vertex;r.uniforms.add(new ut("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(z.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new kr("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new kr("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new kr("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new kr("vvSizeFactor",i=>i.vvSizeFactor)),r.code.add(D`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(z.SIZE,"float"),r.code.add(D`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(z.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add([new bc("vvOpacityValues",i=>i.vvOpacityValues,h2e),new bc("vvOpacityOpacities",i=>i.vvOpacityOpacities,h2e)]),r.code.add(D`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(D`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.attributes.add(z.COLORFEATUREATTRIBUTE,"float"),r.constants.add("vvColorNumber","int",Cm),r.uniforms.add(new bc("vvColorValues",i=>i.vvColorValues,Cm)),r.uniforms.add(new iH("vvColorColors",i=>i.vvColorColors,Cm)),r.code.add(D`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(t.attributes.add(z.COLOR,"vec4"),r.code.add(D`vec4 getColor(){
return applyOpacity(color);
}`))}function h1(t,e){switch(t.fragment.include(bd),e.output){case ne.Shadow:case ne.ShadowHighlight:case ne.ShadowExcludeHighlight:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(D`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case ne.Depth:t.fragment.code.add(D`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}}let Tke=class{constructor(e){this._rctx=e,this._cache=new Map}destroy(){this._cache.forEach(e=>kt(e.stippleTexture)),this._cache.clear()}_acquire(e){if(k(e))return null;const r=this._patternId(e),i=this._cache.get(r);if(i)return i.refCount++,i;const{encodedData:n,paddedPixels:s}=l$t(e),o=new a$t(new Xt(this._rctx,{width:s,height:1,internalFormat:_t.RGBA,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE},n));return this._cache.set(r,o),o}release(e){if(k(e))return;const r=this._patternId(e),i=this._cache.get(r);i&&(i.refCount--,i.refCount===0&&(M(i.stippleTexture)&&i.stippleTexture.dispose(),this._cache.delete(r)))}swap(e,r){const i=this._acquire(r);return this.release(e),i}_patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}},a$t=class extends En{constructor(e){super(),this.stippleTexture=e,this.refCount=1}};function l$t(t){const e=Ide(t),r=1/t.pixelRatio,i=Ske(t),n=Eke(t),s=(Math.floor(.5*(n-1))+.5)*r,o=[];let a=1;for(const A of e){for(let v=0;v<A;v++){const b=a*(Math.min(v,A-1-v)+.5)*r/s*.5+.5;o.push(b)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=i+Cke,d=new Uint8Array(4*u);let p=4;for(const A of c)ML(A,d,p),p+=4;return d.copyWithin(0,p-4,p),d.copyWithin(p,4,8),{encodedData:d,paddedPixels:u}}function Ide(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function Ske(t){if(k(t))return 1;const e=Ide(t);return Math.floor(e.reduce((r,i)=>r+i))}function Eke(t){return Ide(t).reduce((e,r)=>Math.max(e,r))}const Cke=2;function c$t(t){return k(t)?vA:t.length===4?t:pn(u$t,t[0],t[1],t[2],1)}const u$t=Kr();function Mke(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?h$t(t,e):d$t(t)}function h$t(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:n}=t;n.include(bd),e.draped||(Um(i,e),i.uniforms.add(new ut("worldToScreenPerDistanceRatio",(o,a)=>1/a.camera.perScreenPixelRatio)),i.code.add(D`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),i.code.add(D`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${f$t};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(D`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(D`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),i.uniforms.add(new ut("pixelRatio",(o,a)=>a.camera.pixelRatio)),i.code.add(D`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?D`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),n.constants.add("stippleTexturePadding","float",Cke);const s=e.hasWebGL2Context?hn.None:hn.Size;n.uniforms.add(Sm("stipplePatternTexture",o=>o.stippleTexture,s)),n.uniforms.add([new ut("stipplePatternSDFNormalizer",o=>p$t(o.stipplePattern)),new ut("stipplePatternPixelSizeInv",o=>1/$de(o))]),n.code.add(D`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${Nf(e,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `),n.code.add(D`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?D`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:D`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?D`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?D`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:D`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?D`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:D`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(n.uniforms.add(new pi("stippleOffColor",o=>c$t(o.stippleOffColor))),n.code.add(D`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(D`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function d$t(t){t.fragment.code.add(D`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function p$t(t){return M(t)?(Math.floor(.5*(Eke(t)-1))+.5)/t.pixelRatio:1}function $de(t){const e=t.stipplePattern;return M(e)?Ske(t.stipplePattern)/e.pixelRatio:1}const f$t=D.float(.4),DL=64,Dde=DL/2,Rke=Dde/5,m$t=DL/Rke,g$t=.25;function A$t(t,e){return t.fromData(`${e}-marker`,()=>l7e(e,DL,Dde,Rke))}function Oke(t,e){const r=t.vertex;t.constants.add("markerSizePerLineWidth","float",m$t),r.uniforms.add(new ut("pixelRatio",(i,n)=>n.camera.pixelRatio)),k(r.uniforms.get("markerScale"))&&r.constants.add("markerScale","float",1),r.code.add(D`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===kf.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new ut("perRenderPixelRatio",(i,n)=>n.camera.perRenderPixelRatio)),r.code.add(D`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))}var Uf;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Uf||(Uf={}));let vs=class extends Xa{constructor(){super(...arguments),this.output=ne.Color,this.capType=Uf.BUTT,this.transparencyPassType=dr.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};h([ae({count:ne.COUNT})],vs.prototype,"output",void 0),h([ae({count:Uf.COUNT})],vs.prototype,"capType",void 0),h([ae({count:dr.COUNT})],vs.prototype,"transparencyPassType",void 0),h([ae()],vs.prototype,"occluder",void 0),h([ae()],vs.prototype,"hasSlicePlane",void 0),h([ae()],vs.prototype,"hasPolygonOffset",void 0),h([ae()],vs.prototype,"writeDepth",void 0),h([ae()],vs.prototype,"draped",void 0),h([ae()],vs.prototype,"stippleEnabled",void 0),h([ae()],vs.prototype,"stippleOffColorEnabled",void 0),h([ae()],vs.prototype,"stippleScaleWithLineWidth",void 0),h([ae()],vs.prototype,"stipplePreferContinuous",void 0),h([ae()],vs.prototype,"roundJoins",void 0),h([ae()],vs.prototype,"applyMarkerOffset",void 0),h([ae()],vs.prototype,"vvSize",void 0),h([ae()],vs.prototype,"vvColor",void 0),h([ae()],vs.prototype,"vvOpacity",void 0),h([ae()],vs.prototype,"falloffEnabled",void 0),h([ae()],vs.prototype,"innerColorEnabled",void 0),h([ae()],vs.prototype,"hasOccludees",void 0),h([ae()],vs.prototype,"hasMultipassTerrain",void 0),h([ae()],vs.prototype,"cullAboveGround",void 0),h([ae()],vs.prototype,"wireframe",void 0),h([ae({constValue:!0})],vs.prototype,"stippleRequiresClamp",void 0),h([ae({constValue:!0})],vs.prototype,"stippleRequiresStretchMeasure",void 0),h([ae({constValue:!0})],vs.prototype,"hasVvInstancing",void 0),h([ae({constValue:!0})],vs.prototype,"hasSliceTranslatedView",void 0),h([ae()],vs.prototype,"objectAndLayerIdColorInstanced",void 0);const Hz=1;function y$t(t){const e=new Ui,{vertex:r,fragment:i}=e,n=t.hasMultipassTerrain&&(t.output===ne.Color||t.output===ne.Alpha);e.include(JN),e.include(xke,t),e.include(Mke,t);const s=t.applyMarkerOffset&&!t.draped;s&&(r.uniforms.add(new ut("markerScale",A=>A.markerScale)),e.include(Oke,{space:kf.World})),t.output===ne.Depth&&e.include(h1,t),e.include(rH,t),pd(r,t),r.uniforms.add([new fs("inverseProjectionMatrix",(A,v)=>v.camera.inverseProjectionMatrix),new ji("nearFar",(A,v)=>v.camera.nearFar),new ut("miterLimit",A=>A.join!=="miter"?0:A.miterLimit),new pi("viewport",(A,v)=>v.camera.fullViewport)]),r.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(z.POSITION,"vec3"),e.attributes.add(z.SUBDIVISIONFACTOR,"float"),e.attributes.add(z.UV0,"vec2"),e.attributes.add(z.AUXPOS1,"vec3"),e.attributes.add(z.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),N2(e),n&&e.varyings.add("depth","float");const o=t.capType===Uf.ROUND,a=t.stippleEnabled&&t.stippleScaleWithLineWidth||o;a&&e.varyings.add("vLineWidth","float");const l=t.stippleEnabled&&t.stippleScaleWithLineWidth;l&&e.varyings.add("vLineSizeInv","float");const c=t.innerColorEnabled||o;c&&e.varyings.add("vLineDistance","float");const u=t.stippleEnabled&&o,d=t.falloffEnabled||u;d&&e.varyings.add("vLineDistanceNorm","float"),o&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),r.code.add(D`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(D`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),Lj(e),r.code.add(D`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${n?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new ut("pixelRatio",(A,v)=>v.camera.pixelRatio)),r.code.add(D`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${a?D`vLineWidth = lineWidth;`:""}
      ${l?D`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),s&&r.code.add(D`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(D`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||o)&&r.code.add(D`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${o?D`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(D`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?r.code.add(D`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?D`min(1.0, subdivisionFactor * ${D.float((Hz+2)/(Hz+1))})`:D`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(D`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=t.capType!==Uf.BUTT;return r.code.add(D`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?D`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(D`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${d||c?D`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?D`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${d?D`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),o&&r.code.add(D`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?r.uniforms.add(new ut("worldToScreenRatio",(A,v)=>1/v.screenToPCSRatio)):r.code.add(D`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(D`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.code.add(D`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(D`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new ut("stipplePatternPixelSize",A=>$de(A))),r.code.add(D`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(D`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),n&&e.include(Sp,t),e.include(To,t),i.include(ry),i.code.add(D`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?i.code.add(D`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(o&&i.code.add(D`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${D.float(Jl)}) {
        discard;
      }
    `),u?i.code.add(D`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${D.float(Jl)}, stippleCoverage);
      `):i.code.add(D`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new pi("intrinsicColor",A=>A.color)),t.output!==ne.ObjectAndLayerIdColor&&i.code.add(D`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(D`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(i.uniforms.add(new pi("innerColor",A=>br(A.innerColor,A.color))),i.uniforms.add(new ut("innerWidth",(A,v)=>A.innerWidth*v.camera.pixelRatio)),i.code.add(D`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(D`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(i.uniforms.add(new ut("falloff",A=>A.falloff)),i.code.add(D`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(D`
    ${t.output===ne.ObjectAndLayerIdColor?D`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${D.float(Jl)}) {
      discard;
    }

    ${t.output===ne.Alpha?D`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===ne.Color?D`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===ne.Color&&t.transparencyPassType===dr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${t.output===ne.Highlight?D`gl_FragColor = vec4(1.0);`:""}
    ${t.output===ne.Depth?D`outputDepth(linearDepth);`:""}
    ${t.output===ne.ObjectAndLayerIdColor?D`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const _$t=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:Hz,build:y$t},Symbol.toStringTag,{value:"Module"})),Lde={func:Qn.LESS},qz={func:Qn.ALWAYS},VA={mask:255},Pke={mask:0},v$t=t=>({function:{func:Qn.NOTEQUAL,ref:t,mask:t},operation:{fail:co.KEEP,zFail:co.KEEP,zPass:co.KEEP}}),b$t=t=>({function:{func:Qn.ALWAYS,ref:t,mask:t},operation:{fail:co.KEEP,zFail:co.KEEP,zPass:co.REPLACE}}),uw={function:{func:Qn.ALWAYS,ref:dh.OutlineVisualElementMask,mask:dh.OutlineVisualElementMask},operation:{fail:co.KEEP,zFail:co.KEEP,zPass:co.ZERO}},j2={function:{func:Qn.ALWAYS,ref:dh.OutlineVisualElementMask,mask:dh.OutlineVisualElementMask},operation:{fail:co.KEEP,zFail:co.KEEP,zPass:co.REPLACE}},Ike={function:{func:Qn.EQUAL,ref:dh.OutlineVisualElementMask,mask:dh.OutlineVisualElementMask},operation:{fail:co.KEEP,zFail:co.KEEP,zPass:co.KEEP}},$ke={function:{func:Qn.NOTEQUAL,ref:dh.OutlineVisualElementMask,mask:dh.OutlineVisualElementMask},operation:{fail:co.KEEP,zFail:co.KEEP,zPass:co.KEEP}},Dke=new Map([[z.POSITION,0],[z.SUBDIVISIONFACTOR,1],[z.UV0,2],[z.AUXPOS1,3],[z.AUXPOS2,4],[z.COLOR,5],[z.COLORFEATUREATTRIBUTE,5],[z.SIZE,6],[z.SIZEFEATUREATTRIBUTE,6],[z.OPACITYFEATUREATTRIBUTE,7],[z.OBJECTANDLAYERIDCOLOR,8]]);let Lke=class Nke extends qi{initializeProgram(e){return new zi(e.rctx,Nke.shader.get().build(this.configuration),Dke)}_makePipelineState(e,r){const i=this.configuration,n=e===dr.NONE,s=e===dr.FrontFace;return Pr({blending:i.output===ne.Color||i.output===ne.Alpha?n?_p:I1(e):null,depthTest:{func:cw(e)},depthWrite:n?i.writeDepth?_h:null:nH(e),colorWrite:Gr,stencilWrite:i.hasOccludees?VA:null,stencilTest:i.hasOccludees?r?j2:uw:null,polygonOffset:n||s?i.hasPolygonOffset?d2e:null:oH})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?d2e:null;this._occluderPipelineTransparent=Pr({blending:_p,polygonOffset:r,depthTest:qz,depthWrite:null,colorWrite:Gr,stencilWrite:null,stencilTest:$ke}),this._occluderPipelineOpaque=Pr({blending:_p,polygonOffset:r,depthTest:qz,depthWrite:null,colorWrite:Gr,stencilWrite:Pke,stencilTest:Ike}),this._occluderPipelineMaskWrite=Pr({blending:null,polygonOffset:r,depthTest:Lde,depthWrite:null,colorWrite:null,stencilWrite:VA,stencilTest:j2})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?wr.LINES:wr.TRIANGLE_STRIP}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===nt.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===nt.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};Lke.shader=new Bi(_$t,()=>be(()=>import("./RibbonLine.glsl-6a8dae93.js"),[]));const d2e={factor:0,units:-4};var zh;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(zh||(zh={}));let PM=class extends lw{constructor(e){super(e,new x$t),this._configuration=new vs,this._vertexAttributeLocations=Dke,this._layout=this.createLayout()}isClosed(e,r){return kke(this.parameters,e,r)}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===nt.DRAPED_MATERIAL;const i=M(this.parameters.stipplePattern)&&e!==ne.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&M(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!M(this.parameters.markerParameters)&&S$t(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&M(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Ds.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,n,s,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(z.POSITION).data,l=e.vertexAttributes.get(z.SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const b=e.vertexAttributes.get(z.SIZEFEATUREATTRIBUTE).data[0];c*=He(this.parameters.vvSizeOffset[0]+b*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else l&&(c*=l.data[0]);const u=n[0],d=n[1],p=(c/2+4)*e.screenToWorldRatio;let A=Number.MAX_VALUE,v=0;for(let b=0;b<a.length-5;b+=3){const S=a[b],E=a[b+1],R=u-S,O=d-E,I=a[b+3]-S,N=a[b+4]-E,L=He((I*R+N*O)/(I*I+N*N),0,1),B=I*L-R,U=N*L-O,q=B*B+U*U;q<A&&(A=q,v=b/3)}A<p*p&&s(o.dist,o.normal,v,!1)}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!e.visible)return;if(!J6e(r))return void we.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(z.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const R=a.get(z.SIZEFEATUREATTRIBUTE).data[0];c*=He(this.parameters.vvSizeOffset[0]+R*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a.has(z.SIZE)&&(c*=a.get(z.SIZE).data[0]);const u=i.camera,d=E$t;$a(d,i.point);const p=c*u.pixelRatio/2+4*u.pixelRatio;Le(FI[0],d[0]-p,d[1]+p,0),Le(FI[1],d[0]+p,d[1]+p,0),Le(FI[2],d[0]+p,d[1]-p,0),Le(FI[3],d[0]-p,d[1]-p,0);for(let R=0;R<4;R++)if(!u.unprojectFromRenderScreen(FI[R],wy[R]))return;yc(u.eye,wy[0],wy[1],GY),yc(u.eye,wy[1],wy[2],jY),yc(u.eye,wy[2],wy[3],HY),yc(u.eye,wy[3],wy[0],qY);let A=Number.MAX_VALUE,v=0;const b=Fke(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let R=0;R<b;R+=3){Du[0]=l[R]+r[12],Du[1]=l[R+1]+r[13],Du[2]=l[R+2]+r[14];const O=(R+3)%l.length;if(Lu[0]=l[O]+r[12],Lu[1]=l[O+1]+r[13],Lu[2]=l[O+2]+r[14],kn(GY,Du)<0&&kn(GY,Lu)<0||kn(jY,Du)<0&&kn(jY,Lu)<0||kn(HY,Du)<0&&kn(HY,Lu)<0||kn(qY,Du)<0&&kn(qY,Lu)<0)continue;if(u.projectToRenderScreen(Du,Gw),u.projectToRenderScreen(Lu,jw),Gw[2]<0&&jw[2]>0){Ve(ag,Du,Lu);const N=u.frustum,L=-kn(N[Fn.NEAR],Du)/Qe(ag,N[Fn.NEAR]);Oe(ag,ag,L),ze(Du,Du,ag),u.projectToRenderScreen(Du,Gw)}else if(Gw[2]>0&&jw[2]<0){Ve(ag,Lu,Du);const N=u.frustum,L=-kn(N[Fn.NEAR],Lu)/Qe(ag,N[Fn.NEAR]);Oe(ag,ag,L),ze(Lu,Lu,ag),u.projectToRenderScreen(Lu,jw)}else if(Gw[2]<0&&jw[2]<0)continue;Gw[2]=0,jw[2]=0;const I=Rce(eS(Gw,jw,m2e),d);I<A&&(A=I,Pe(p2e,Du),Pe(f2e,Lu),v=R/3)}const S=i.rayBegin,E=i.rayEnd;if(A<p*p){let R=Number.MAX_VALUE;if(W$e(eS(p2e,f2e,m2e),eS(S,E,C$t),Vw)){Ve(Vw,Vw,S);const O=ct(Vw);Oe(Vw,Vw,1/O),R=O/zn(S,E)}o(R,Vw,v,!1)}}createLayout(){const e=Cs().vec3f(z.POSITION).f32(z.SUBDIVISIONFACTOR).vec2f(z.UV0).vec3f(z.AUXPOS1).vec3f(z.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(z.SIZEFEATUREATTRIBUTE):e.f32(z.SIZE),this.parameters.vvColorEnabled?e.f32(z.COLORFEATUREATTRIBUTE):e.vec4f(z.COLOR),this.parameters.vvOpacityEnabled&&e.f32(z.OPACITYFEATUREATTRIBUTE),Fe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(z.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new T$t(this._layout,this.parameters)}requiresSlot(e,r){return r===ne.Color||r===ne.Alpha||r===ne.Highlight||r===ne.Depth||r===ne.ObjectAndLayerIdColor?e===nt.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ds.OccludeAndTransparentStencil?e===nt.OPAQUE_MATERIAL||e===nt.OCCLUDER_MATERIAL||e===nt.TRANSPARENT_OCCLUDER_MATERIAL:r===ne.Color||r===ne.Alpha?e===(this.parameters.writeDepth?nt.TRANSPARENT_MATERIAL:nt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===nt.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new w$t(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),M(e.markerParameters)&&(e.markerScale=e.markerParameters.width/e.width)}},w$t=class extends aw{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==ne.Color&&this._output!==ne.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,r)),this._stipplePattern=r),this.ensureTechnique(Lke,e)}},x$t=class extends yde{constructor(){super(...arguments),this.width=0,this.color=Ef,this.join="miter",this.cap=Uf.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},T$t=class{constructor(e,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=Hz+i}}_isClosed(e){return Fke(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.indices.get(z.POSITION).length/2+1,n=this._isClosed(e);let s=n?2:2*2;return s+=((n?i:i-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,r,i,n,s){var re;const o=M$t,a=R$t,l=O$t,c=i.vertexAttributes.get(z.POSITION).data,u=i.indices&&i.indices.get(z.POSITION),d=(re=i.vertexAttributes.get(z.DISTANCETOSTART))==null?void 0:re.data;u&&u.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=1,A=0;this._parameters.vvSizeEnabled?A=i.vertexAttributes.get(z.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(z.SIZE)&&(p=i.vertexAttributes.get(z.SIZE).data[0]);let v=[1,1,1,1],b=0;this._parameters.vvColorEnabled?b=i.vertexAttributes.get(z.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(z.COLOR)&&(v=i.vertexAttributes.get(z.COLOR).data);const S=Fe("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let E=0;this._parameters.vvOpacityEnabled&&(E=i.vertexAttributes.get(z.OPACITYFEATUREATTRIBUTE).data[0]);const R=c.length/3,O=new Float32Array(n.buffer),I=Fe("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,N=this.vertexBufferLayout.stride/4;let L=s*N;const B=L;let U=0;const q=d?(te,j,H)=>U=d[H]:(te,j,H)=>U+=zn(te,j),Z=Fe("enable-feature:objectAndLayerId-rendering"),X=(te,j,H,W,oe,le,fe)=>{if(O[L++]=j[0],O[L++]=j[1],O[L++]=j[2],O[L++]=W,O[L++]=fe,O[L++]=oe,O[L++]=te[0],O[L++]=te[1],O[L++]=te[2],O[L++]=H[0],O[L++]=H[1],O[L++]=H[2],this._parameters.vvSizeEnabled?O[L++]=A:O[L++]=p,this._parameters.vvColorEnabled)O[L++]=b;else{const de=Math.min(4*le,v.length-4);O[L++]=v[de],O[L++]=v[de+1],O[L++]=v[de+2],O[L++]=v[de+3]}this._parameters.vvOpacityEnabled&&(O[L++]=E),Z&&(M(S)&&(I[4*L]=S[0],I[4*L+1]=S[1],I[4*L+2]=S[2],I[4*L+3]=S[3]),L++)};L+=N,Le(a,c[0],c[1],c[2]),e&&Ot(a,a,e);const ee=this._isClosed(i);if(ee){const te=c.length-3;Le(o,c[te],c[te+1],c[te+2]),e&&Ot(o,o,e)}else Le(l,c[3],c[4],c[5]),e&&Ot(l,l,e),X(a,a,l,1,zh.LEFT_CAP_START,0,0),X(a,a,l,1,zh.RIGHT_CAP_START,0,0),Pe(o,a),Pe(a,l);const se=ee?0:1,ue=ee?R:R-1;for(let te=se;te<ue;te++){const j=(te+1)%R*3;Le(l,c[j],c[j+1],c[j+2]),e&&Ot(l,l,e),q(o,a,te),X(o,a,l,0,zh.LEFT_JOIN_END,te,U),X(o,a,l,0,zh.RIGHT_JOIN_END,te,U);const H=this.numJoinSubdivisions;for(let W=0;W<H;++W){const oe=(W+1)/(H+1);X(o,a,l,oe,zh.LEFT_JOIN_END,te,U),X(o,a,l,oe,zh.RIGHT_JOIN_END,te,U)}X(o,a,l,1,zh.LEFT_JOIN_START,te,U),X(o,a,l,1,zh.RIGHT_JOIN_START,te,U),Pe(o,a),Pe(a,l)}ee?(Le(l,c[3],c[4],c[5]),e&&Ot(l,l,e),U=q(o,a,ue),X(o,a,l,0,zh.LEFT_JOIN_END,se,U),X(o,a,l,0,zh.RIGHT_JOIN_END,se,U)):(U=q(o,a,ue),X(o,a,a,0,zh.LEFT_CAP_END,ue,U),X(o,a,a,0,zh.RIGHT_CAP_END,ue,U)),VY(O,B+N,O,B,N),L=VY(O,L-N,O,L,N),this._parameters.wireframe&&this._addWireframeVertices(n,B,L,N)}_addWireframeVertices(e,r,i,n){const s=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=VY(o,c,s,a,n);for(let c=0;c<o.length-1;c+=2*n)l(c),l(c+2*n),l(c+1*n),l(c+2*n),l(c+1*n),l(c+3*n)}};function VY(t,e,r,i,n){for(let s=0;s<n;s++)r[i++]=t[e++];return i}function Fke(t,e,r){return kke(t,e.get(z.POSITION).data,r?r.get(z.POSITION):null)}function kke(t,e,r){return!!t.isClosed&&(r?r.length>2:e.length>6)}function S$t(t){return t.anchor===YS.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const Du=G(),Lu=G(),ag=G(),Vw=G(),E$t=G(),Gw=Yl(),jw=Yl(),p2e=G(),f2e=G(),m2e=Gm(),C$t=Gm(),M$t=G(),R$t=G(),O$t=G(),FI=[Yl(),Yl(),Yl(),Yl()],wy=[G(),G(),G(),G()],GY=Xi(),jY=Xi(),HY=Xi(),qY=Xi();let Nde=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+hd()}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const u=e$t.rootOrigin;if(M(u))return this._origins.set(this._rootOriginId,Z5(u[0],u[1],u[2],this._rootOriginId)),this.getOrigin(e);const d=Z5(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,d),d}const i=this._gridSize,n=Math.round(e[0]/i),s=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${n}/${s}/${o}`;let l=this._origins.get(a);const c=.5*i;if(Ve(sl,e,r.vec3),sl[0]=Math.abs(sl[0]),sl[1]=Math.abs(sl[1]),sl[2]=Math.abs(sl[2]),sl[0]<c&&sl[1]<c&&sl[2]<c){if(l){const u=Math.max(...sl);if(Ve(sl,e,l.vec3),sl[0]=Math.abs(sl[0]),sl[1]=Math.abs(sl[1]),sl[2]=Math.abs(sl[2]),Math.max(...sl)<u)return l}return r}return l||(l=Z5(n*i,s*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=Fr(1,1,0,1)){const i=window.view,n=i._stage,s=r.toString();if(!this._objects.has(s)){this._material=new PM({width:2,color:r}),n.add(this._material);const A=new wke({pickable:!1}),v=new D1({castShadow:!1});n.add(v),A.add(v),n.add(A),this._objects.set(s,v)}const o=this._objects.get(s),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,d=.5*this._gridSize;for(let A=0;A<l;A++)c[3*A+0]=e[0]+(1&a[A]?d:-d),c[3*A+1]=e[1]+(2&a[A]?d:-d),c[3*A+2]=e[2]+(4&a[A]?d:-d),A>0&&u.push(A-1,A);qs(c,this._originSR,0,c,i.renderSpatialReference,0,l);const p=new zo(this._material,[[z.POSITION,new Pt(c,3,!0)]],[[z.POSITION,u]],null,lo.Line);n.add(p),o.addGeometry(p)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const sl=G();let Uke=class{constructor(e,r,i,n=null){this.rctx=e,this.sliceHelper=n,this.lastFrameCamera=new mr,this.output=ne.Color,this.renderOccludedMask=g2e,this.bindParameters=new Dj(r,i,M(n)?n.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=g2e}},P$t=class extends Uke{constructor(e,r,i,n,s){super(e,i,n,s),this.offscreenRenderingHelper=r,this.sliceHelper=s,this.time=0}};const g2e=Ds.Occlude|Ds.OccludeAndTransparent|Ds.OccludeAndTransparentStencil;let $4=class extends mr{constructor(){super(...arguments),this._projectionMatrix=ht()}get projectionMatrix(){return this._projectionMatrix}};h([f()],$4.prototype,"_projectionMatrix",void 0),h([f({readOnly:!0})],$4.prototype,"projectionMatrix",null),$4=h([Q("esri.views.3d.webgl-engine.lib.CascadeCamera")],$4);var EO;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(EO||(EO={}));let W8=class{constructor(){this.camera=new $4,this.lightMat=ht()}},Fde=class{get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return pn(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,r){this._rctx=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._projectionView=ht(),this._projectionViewInverse=ht(),this._modelViewLight=ht(),this._splitSchemeLambda=0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Kr(),this._cascades=[new W8,new W8,new W8,new W8],this._lastOrigin=null,this._maxTextureSize=Math.min(Fe("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(e){this._maxNumCascades=He(Math.floor(e),1,4)}get maxCascades(){return this._maxNumCascades}set enabled(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&M(this._depthTexture)}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)QY[e]=this._cascades[e];return QY.length=this._numCascades,QY}start(e,r,i){tr(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();const{near:n,far:s}=this._clampNearFar(i);this._computeCascadeDistances(s,n),this._setupMatrices(e,r);const{viewMatrix:o,projectionMatrix:a}=e;for(let l=0;l<this._numCascades;++l)this._constructCascade(l,a,o,r);this._lastOrigin=null,this.clear()}finish(e){tr(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!fu(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||G(),Pe(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){Ah(w2e,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)x2e[16*r+i]=w2e[i]}}return x2e}takeCascadeSnapshotTo(e,r){tr(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const n=this._rctx,s=n.bindTexture(i,Xt.TEXTURE_UNIT_FOR_UPDATES);n.gl.copyTexSubImage2D(cr.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),n.bindTexture(s,Xt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(rs.COLOR_BUFFER_BIT|rs.DEPTH_BUFFER_BIT)}_computeTextureSize(e,r){const i=.5*Math.log(e*e+r*r)*Math.LOG2E,n=.35,s=2**Math.round(i+n);return Math.min(this._maxTextureSize,2*s)}_ensureDepthTexture(){if(M(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const e={target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:zt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new Xt(this._rctx,e),this._fbo=new uo(this._rctx,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(e){let r=this._snapshots[e];if(M(r)&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(e);const i={target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:zt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return r=new Xt(this._rctx,i),this._snapshots[e]=r,r}_discardDepthTexture(){this._fbo=kt(this._fbo),this._depthTexture=kt(this._depthTexture)}_discardSnapshot(e){this._snapshots[e]=kt(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,r,i,n){const s=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);tr(l<c);for(let A=0;A<8;++A){pn(A2e,A%4==0||A%4==3?-1:1,A%4==0||A%4==1?-1:1,A<4?l:c,1);const v=hf[A];cp(v,A2e,this._projectionViewInverse),v[0]/=v[3],v[1]/=v[3],v[2]/=v[3]}Cc(WY,hf[0]),s.camera.viewMatrix=Ah(I$t,this._modelViewLight,WY);for(let A=0;A<8;++A)Ot(hf[A],hf[A],s.camera.viewMatrix);let u=hf[0][2],d=hf[0][2];for(let A=1;A<8;++A)u=Math.min(u,hf[A][2]),d=Math.max(d,hf[A][2]);u-=200,d+=200,s.camera.near=-d,s.camera.far=-u,N$t(i,n,u,d,s.camera),js(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const p=this._textureSize/2;s.camera.viewport=[e%2==0?0:p,Math.floor(e/2)===0?0:p,p,p]}_setupMatrices(e,r){js(this._projectionView,e.projectionMatrix,e.viewMatrix),Ml(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===wt.Global?e.eye:Le(WY,0,0,1);QG(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r){this._numCascades=Math.min(1+Math.floor(bTt(e/r,4)),this._maxNumCascades);const i=(e-r)/this._numCascades,n=(e/r)**(1/this._numCascades);let s=r,o=r;for(let a=0;a<this._numCascades+1;++a)this._cascadeDistances[a]=Mr(s,o,this._splitSchemeLambda),s*=n,o+=i}get gpuMemoryUsage(){var e;return this._snapshots.reduce((r,i)=>r+VS(i),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){const e=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(r){e._splitSchemeLambda=r},get splitSchemeLambda(){return e._splitSchemeLambda}}}};const I$t=ht(),A2e=Kr(),hf=[];for(let t=0;t<8;++t)hf.push(Kr());const y2e=Ft(),_2e=Ft(),$$t=Ft(),v2e=Ft(),b2e=Ft(),WY=G(),QY=[],w2e=ht(),x2e=new Float32Array(64),Od=Ft(),f3=Ft(),Hw=[Ft(),Ft(),Ft(),Ft()],_a=Ft(),YY=Ft(),uv=Ft(),kI=Ft(),m3=Ft(),g3=Ft(),Q8=Ft();function D$t(t,e,r,i,n,s,o,a){ti(Od,0,0);for(let N=0;N<4;++N)Z0(Od,Od,t[N]);ed(Od,Od,.25),ti(f3,0,0);for(let N=4;N<8;++N)Z0(f3,f3,t[N]);ed(f3,f3,.25),NC(Hw[0],t[4],t[5],.5),NC(Hw[1],t[5],t[6],.5),NC(Hw[2],t[6],t[7],.5),NC(Hw[3],t[7],t[4],.5);let l=0,c=cz(Hw[0],Od);for(let N=1;N<4;++N){const L=cz(Hw[N],Od);L<c&&(c=L,l=N)}iA(_a,Hw[l],t[l+4]);const u=_a[0];let d,p;_a[0]=-_a[1],_a[1]=u,iA(YY,f3,Od),Ko(YY,_a)<0&&Zue(_a,_a),NC(_a,_a,YY,r),mL(_a,_a),d=p=Ko(iA(uv,t[0],Od),_a);for(let N=1;N<8;++N){const L=Ko(iA(uv,t[N],Od),_a);L<d?d=L:L>p&&(p=L)}$a(i,Od),ed(uv,_a,d-e),Z0(i,i,uv);let A=-1,v=1,b=0,S=0;for(let N=0;N<8;++N){iA(kI,t[N],i),mL(kI,kI);const L=_a[0]*kI[1]-_a[1]*kI[0];L>0?L>A&&(A=L,b=N):L<v&&(v=L,S=N)}ZE(A>0,"leftArea"),ZE(v<0,"rightArea"),ed(m3,_a,d),Z0(m3,m3,Od),ed(g3,_a,p),Z0(g3,g3,Od),Q8[0]=-_a[1],Q8[1]=_a[0];const E=o8(i,t[S],g3,Z0(uv,g3,Q8),1,n),R=o8(i,t[b],g3,uv,1,s),O=o8(i,t[b],m3,Z0(uv,m3,Q8),1,o),I=o8(i,t[S],m3,uv,1,a);ZE(E,"rayRay"),ZE(R,"rayRay"),ZE(O,"rayRay"),ZE(I,"rayRay")}function Pi(t,e){return 3*e+t}const T2e=Ft();function Th(t,e){return ti(T2e,t[e],t[e+3]),T2e}const Nu=Ft(),Gt=Es();function L$t(t,e,r,i,n){iA(Nu,r,i),ed(Nu,Nu,.5),Gt[0]=Nu[0],Gt[1]=Nu[1],Gt[2]=0,Gt[3]=Nu[1],Gt[4]=-Nu[0],Gt[5]=0,Gt[6]=Nu[0]*Nu[0]+Nu[1]*Nu[1],Gt[7]=Nu[0]*Nu[1]-Nu[1]*Nu[0],Gt[8]=1,Gt[Pi(0,2)]=-Ko(Th(Gt,0),t),Gt[Pi(1,2)]=-Ko(Th(Gt,1),t);let s=Ko(Th(Gt,0),r)+Gt[Pi(0,2)],o=Ko(Th(Gt,1),r)+Gt[Pi(1,2)],a=Ko(Th(Gt,0),i)+Gt[Pi(0,2)],l=Ko(Th(Gt,1),i)+Gt[Pi(1,2)];s=-(s+a)/(o+l),Gt[Pi(0,0)]+=Gt[Pi(1,0)]*s,Gt[Pi(0,1)]+=Gt[Pi(1,1)]*s,Gt[Pi(0,2)]+=Gt[Pi(1,2)]*s,s=1/(Ko(Th(Gt,0),r)+Gt[Pi(0,2)]),o=1/(Ko(Th(Gt,1),r)+Gt[Pi(1,2)]),Gt[Pi(0,0)]*=s,Gt[Pi(0,1)]*=s,Gt[Pi(0,2)]*=s,Gt[Pi(1,0)]*=o,Gt[Pi(1,1)]*=o,Gt[Pi(1,2)]*=o,Gt[Pi(2,0)]=Gt[Pi(1,0)],Gt[Pi(2,1)]=Gt[Pi(1,1)],Gt[Pi(2,2)]=Gt[Pi(1,2)],Gt[Pi(1,2)]+=1,s=Ko(Th(Gt,1),e)+Gt[Pi(1,2)],o=Ko(Th(Gt,2),e)+Gt[Pi(2,2)],a=Ko(Th(Gt,1),r)+Gt[Pi(1,2)],l=Ko(Th(Gt,2),r)+Gt[Pi(2,2)],s=-.5*(s/o+a/l),Gt[Pi(1,0)]+=Gt[Pi(2,0)]*s,Gt[Pi(1,1)]+=Gt[Pi(2,1)]*s,Gt[Pi(1,2)]+=Gt[Pi(2,2)]*s,s=Ko(Th(Gt,1),e)+Gt[Pi(1,2)],o=Ko(Th(Gt,2),e)+Gt[Pi(2,2)],a=-o/s,Gt[Pi(1,0)]*=a,Gt[Pi(1,1)]*=a,Gt[Pi(1,2)]*=a,n[0]=Gt[0],n[1]=Gt[1],n[2]=0,n[3]=Gt[2],n[4]=Gt[3],n[5]=Gt[4],n[6]=0,n[7]=Gt[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=Gt[6],n[13]=Gt[7],n[14]=0,n[15]=Gt[8]}function N$t(t,e,r,i,n){const s=1/hf[0][3],o=1/hf[4][3];tr(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin(pa(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,D$t(hf,a,l,y2e,_2e,$$t,v2e,b2e),L$t(y2e,_2e,v2e,b2e,n.projectionMatrix),n.projectionMatrix[10]=2/(r-i),n.projectionMatrix[14]=-(r+i)/(r-i)}function F$t(t){return qm(t)&&t.intersector===ws.TERRAIN&&!!t.target}let k$t=class extends Gj{constructor(e,r,i){super(e,r),this.triangleNr=i}};function Bke(t){return qm(t)&&t.intersector===ws.OVERLAY&&!!t.target}let Qne=class{constructor(){this.adds=new Vr,this.removes=new Vr,this.updates=new Vr({allocator:e=>e||new U$t,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},U$t=class{},B$t=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var $s,Ta;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})($s||($s={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Ta||(Ta={}));function zke(t){const e=new Map,r=i=>{let n=e.get(i);return n||(n=new B$t,e.set(i,n)),n};return t.removes.forAll(i=>{XY(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{XY(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{XY(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function XY(t){return t.geometry.indexCount>=1}let z$t=class{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createProgram()}_createProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,r=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,r,new Map([]))}_createIndexbuffer(){return Ji.createIndex(this._rctx,ki.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,yr.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(wr.POINTS,1,Yt.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},Vke=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}destroy(){this._map.forEach((e,r)=>{M(e)&&this._repository.release(this._material,r)})}load(e,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const n=this._map.get(i);if(M(n)){if(n.ensureResources(e)===B_.LOADED)return n;this._repository.requestRender()}return null}};function V$t(t){const e=D`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;t.vertex.code.add(e)}function hF(t,e){switch(e.normalType){case An.CompressedAttribute:t.include(V$t),t.attributes.add(z.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(D`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`);break;case An.Attribute:t.attributes.add(z.NORMAL,"vec3"),t.vertex.code.add(D`vec3 normalModel() {
return normal;
}`);break;case An.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(D`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case An.COUNT:case An.Ground:}}var An;(function(t){t[t.Attribute=0]="Attribute",t[t.CompressedAttribute=1]="CompressedAttribute",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(An||(An={}));function dH(t,e){switch(e.normalType){case An.Attribute:case An.CompressedAttribute:t.include(hF,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add([new yL("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new iy("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)]),t.vertex.code.add(D`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case An.Ground:t.include(oR,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(D`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?D`normalize(vPositionWorldCameraRelative);`:D`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case An.ScreenDerivative:t.vertex.code.add(D`void forwardNormal() {}`);break;default:e.normalType;case An.COUNT:}}let Gke=class extends I6e{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Es()}},jke=class extends $6e{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Es(),this.toMapSpace=Kr()}},Yne=class extends jke{constructor(e=G()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},SP=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(z.POSITION).length}write(e,r,i,n,s){r7e(i,this.vertexBufferLayout,e,r,n,s)}};const G$t=Cs().vec3f(z.POSITION),j$t=Cs().vec3f(z.POSITION).vec2f(z.UV0),Hke=Cs().vec3f(z.POSITION).vec4u8(z.COLOR);Cs().vec3f(z.POSITION).vec4u8(z.OBJECTANDLAYERIDCOLOR);Cs().vec3f(z.POSITION).vec2f(z.UV0).vec4u8(z.OBJECTANDLAYERIDCOLOR);const H$t=Cs().vec3f(z.POSITION).vec4u8(z.COLOR).vec4u8(z.OBJECTANDLAYERIDCOLOR);let kde=class extends lw{intersect(e,r,i,n,s,o){return H9e(e,i,n,s,void 0,o)}};function q$t(t){t.fragment.code.add(D`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function W$t(t){t.fragment.code.add(D`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function S2e(t){t.fragment.uniforms.add(new _r("texWaveNormal",e=>e.waveNormal)),t.fragment.uniforms.add(new _r("texWavePerturbation",e=>e.wavePertubation)),t.fragment.uniforms.add([new pi("waveParams",e=>pn(Q$t,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new ji("waveDirection",e=>ti(Y$t,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))]),t.include(q$t),t.fragment.code.add(D`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const Q$t=Kr(),Y$t=Ft();function LL(t,e){e.spherical?t.vertex.code.add(D`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(D`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(D`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(D`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}let dF=class extends Ys{constructor(e,r){super(e,"int",Sn.Pass,(i,n,s)=>i.setUniform1i(e,r(n,s)))}},X$t=class extends Ys{constructor(e,r,i){super(e,"mat4",Sn.Draw,(n,s,o)=>n.setUniformMatrix4fv(e,r(s,o)),i)}},Z$t=class extends Ys{constructor(e,r,i){super(e,"mat4",Sn.Pass,(n,s,o)=>n.setUniformMatrix4fv(e,r(s,o)),i)}},qke=class extends En{constructor(){super(...arguments),this.origin=G()}};function pH(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Z$t("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),Wke(t,e))}function XS(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new X$t("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),Wke(t,e))}function Wke(t,e){const r=t.fragment;r.include(bd),r.uniforms.add([...Sm("shadowMapTex",(i,n)=>n.shadowMap.depthTexture,e.hasWebGL2Context?hn.None:hn.Size),new dF("numCascades",(i,n)=>n.shadowMap.numCascades),new pi("cascadeDistances",(i,n)=>n.shadowMap.cascadeDistances)]),r.code.add(D`
    int chooseCascade(float depth, out mat4 mat) {
      vec4 distance = cascadeDistances;

      // choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float textureSize, sampler2D _depthTex) {
      float halfPixelSize = 0.5 / textureSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * textureSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= numCascades) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      vec2 textureSize = ${Nf(e,"shadowMapTex")};

      return filterShadow(uv, lvpos, textureSize.x, shadowMapTex);
    }
  `)}function J$t(t){const e=t.fragment.code;e.add(D`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(D`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(D`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function Ude(t,e){const r=t.fragment.code;t.include(JN),e.pbrMode!==Jt.Normal&&e.pbrMode!==Jt.Schematic&&e.pbrMode!==Jt.Terrain&&e.pbrMode!==Jt.TerrainWithWater||(r.add(D`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(D`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==Jt.Normal&&e.pbrMode!==Jt.Schematic||(t.include(J$t),r.add(D`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(D`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(D`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(D`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function K$t(t,e){const r=t.fragment.code;t.include(JN),r.add(D`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(D`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(D`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(D`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(D`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function Qke(t,e){t.include(K$t,e),t.include(Oj),t.include(W$t),e.hasCloudsReflections&&t.include(s6e,e),e.hasScreenSpaceReflections&&t.include($xt,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(D`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add([new ut("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new ut("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)]),r.code.add(D`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(D`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add([new fs("view",(i,n)=>n.ssr.camera.viewMatrix),new _r("lastFrameColorTexture",(i,n)=>n.ssr.lastFrameColorTexture),new ut("fadeFactor",(i,n)=>n.ssr.fadeFactor)]),r.code.add(D`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactor;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(D`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(D`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(D`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(D`return waterRenderedColor;
}`)}function e4t(t){const e=new Ui,{vertex:r,fragment:i}=e;pd(r,t),e.include(uh,t),e.attributes.add(z.POSITION,"vec3"),e.attributes.add(z.UV0,"vec2");const n=new pi("waterColor",s=>s.color);if(t.output===ne.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(D`
        void main(void) {
          if (waterColor.a < ${D.float(Jl)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(n),i.code.add(D`void main() {
gl_FragColor = waterColor;
}`),e;switch(t.output!==ne.Color&&t.output!==ne.Alpha||(e.include(LL,t),e.include(AP,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.uniforms.add(n),r.code.add(D`
      void main(void) {
        if (waterColor.a < ${D.float(Jl)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===ne.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Sp,t),t.output){case ne.Alpha:e.include(To,t),i.uniforms.add(n),i.code.add(D`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case ne.Color:e.include(uz,t),e.include(lhe,{pbrMode:Jt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(S2e),e.include(To,t),e.include(XS,t),e.include(Qke,t),i.uniforms.add([n,new ut("timeElapsed",s=>s.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")]),Um(i,t),i.include(ry),x1(i),ty(i),i.code.add(D`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?D`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${t.transparencyPassType===dr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case ne.Normal:e.include(LL,t),e.include(S2e,t),e.include(To,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(n),r.code.add(D`
        void main(void) {
          if (waterColor.a < ${D.float(Jl)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new ut("timeElapsed",s=>s.timeElapsed)),i.code.add(D`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case ne.Highlight:e.include(P1,t),e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(D`
      void main(void) {
        if (waterColor.a < ${D.float(Jl)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(To,t),i.code.add(D`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const t4t=Object.freeze(Object.defineProperty({__proto__:null,build:e4t},Symbol.toStringTag,{value:"Module"}));let Yke=class Xke extends qi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2,r.spherical=e.viewingMode===wt.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new zi(e.rctx,Xke.shader.get().build(this.configuration),Di)}_setPipelineState(e){const r=this.configuration,i=e===dr.NONE,n=e===dr.FrontFace;return Pr({blending:r.output!==ne.Normal&&r.output!==ne.Highlight&&r.transparent?i?_p:I1(e):null,depthTest:{func:cw(e)},depthWrite:i?r.writeDepth?_h:null:nH(e),colorWrite:Gr,polygonOffset:i||n?null:aH(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Yke.shader=new Bi(t4t,()=>be(()=>import("./WaterSurface.glsl-692148df.js"),[]));let gl=class extends Xa{constructor(){super(...arguments),this.output=ne.Color,this.transparencyPassType=dr.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};h([ae({count:ne.COUNT})],gl.prototype,"output",void 0),h([ae({count:dr.COUNT})],gl.prototype,"transparencyPassType",void 0),h([ae()],gl.prototype,"spherical",void 0),h([ae()],gl.prototype,"receiveShadows",void 0),h([ae()],gl.prototype,"hasSlicePlane",void 0),h([ae()],gl.prototype,"transparent",void 0),h([ae()],gl.prototype,"enableOffset",void 0),h([ae()],gl.prototype,"writeDepth",void 0),h([ae()],gl.prototype,"hasScreenSpaceReflections",void 0),h([ae()],gl.prototype,"doublePrecisionRequiresObfuscation",void 0),h([ae()],gl.prototype,"hasCloudsReflections",void 0),h([ae()],gl.prototype,"isDraped",void 0),h([ae()],gl.prototype,"hasMultipassTerrain",void 0),h([ae()],gl.prototype,"cullAboveGround",void 0),h([ae({constValue:Jt.Water})],gl.prototype,"pbrMode",void 0),h([ae({constValue:!0})],gl.prototype,"useCustomDTRExponentForWater",void 0),h([ae({constValue:!0})],gl.prototype,"highStepCount",void 0),h([ae({constValue:!1})],gl.prototype,"useFillLights",void 0);let r4t=class extends aw{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const r=M(e.cloudsFade.data);r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===ne.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(Yke,e)}},Zke=class extends kde{constructor(e){super(e,new Jke),this._configuration=new gl,this.animation=new a8e}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<sH,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<i4t;const i=this.animation.advance(e);return this.setParameters({timeElapsed:Yae(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(e,r){switch(r){case ne.Normal:return e===nt.DRAPED_WATER;case ne.Color:if(this.parameters.isDraped)return e===nt.DRAPED_MATERIAL;break;case ne.Alpha:break;case ne.Highlight:return e===nt.OPAQUE_MATERIAL||e===nt.DRAPED_MATERIAL;default:return!1}let i=nt.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?nt.TRANSPARENT_MATERIAL:nt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new r4t(e)}createBufferWriter(){return new SP(j$t)}},Jke=class extends xP{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Gi(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Fr(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}};const i4t=35e3;let Bde=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function E2e(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;)r=!1,t.forEach(i=>{const n=e.get(i.to);n&&(i.to=n.to,e.delete(n.from),t.removeUnordered(n),r=!0)})}let C2e=class extends Bde{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return M(this.geometry.highlights)&&this.isVisible}get hasOccludees(){return M(this.geometry.occludees)}},n4t=class{constructor(){this.first=0,this.count=0}},s4t=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Vr({allocator:e=>e||new Bde,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=Y8(),this.drawCommandsHighlight=Y8(),this.drawCommandsOccludees=Y8(),this.drawCommandsShadowHighlightRest=Y8()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=r,n.to=i,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),n=this.holes.front();return M(this.vao)&&this.holes.length===1&&n.to===Math.floor(this.vao.size/e)?(i.first=0,void(i.count=n.from)):(i.first=1/0,i.count=0,this._instances.forEach(s=>{i.first=Math.min(i.first,s.from),i.count=Math.max(i.count,s.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,n)=>i.from===n.from?i.to-n.to:i.from-n.from);for(const i of r)i.isVisible&&(M2e(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),M2e(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function o4t(t){return M(t.vao)}function Y8(){return new Vr({allocator:t=>t||new n4t,deallocator:t=>t})}function M2e(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(a4t(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function a4t(t,e){return t.first+t.count>=e.from}let l4t=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const c4t=dk+1;let u4t=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=e.newCache(`VaoCache ${hd()}`,h4t)}dispose(){this._cache.destroy()}newVao(e){const r=e.toString(),i=this._cache.pop(r);if(M(i)){const s=i.pop();return i.length>0&&this._cache.put(r,i,e*i.length,c4t),s}const n=new Hm(this._rctx,this._locations,{geometry:this._layout},{geometry:Ji.createVertex(this._rctx,ki.STATIC_DRAW)});return n.vertexBuffers.geometry.setSize(e),n}deleteVao(e){if(k(e))return null;const r=e.size,i=r.toString(),n=this._cache.pop(i);return M(n)?(n.push(e),this._cache.put(i,n,r*n.length,-1)):this._cache.put(i,[e],r,-1),null}};function h4t(t,e){if(e===g_.ALL)return void t.forEach(n=>n.dispose());const r=t.pop(),i=t.length*r.size;return r.dispose(),i}let Kke=class{constructor(e,r,i){this._rctx=e,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new Vke(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new u4t(e,i.vertexAttributeLocations,wd(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new z$t(this._rctx))}dispose(){var e;this._glMaterials.destroy(),this._dataByOrigin.forEach(r=>r.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof Zke}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==Ds.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,n)=>i+n.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(n=>e(n.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){var n;const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const s of e){const o=s.renderGeometry,a=(n=this._dataByOrigin.get(o.localOrigin.id))==null?void 0:n.findBuffer(o.id);if(k(a))return;const l=a.instances.get(o.id);if(s.updateType&(Ta.GEOMETRY|Ta.TRANSFORMATION)){const c=K8(r.elementCount(l.geometry.geometry)*i),u=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(o,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i)}s.updateType&(Ta.HIGHLIGHT|Ta.OCCLUDEE|Ta.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){var n;const i=new yP;for(const s of e){const o=s.localOrigin;if(k(o))continue;let a=i.get(o.id,null);k(a)&&(a=new R2e(o.vec3),i.set(o.id,null,a)),a.changes.push(s)}for(const s of r){const o=s.localOrigin;if(k(o))continue;const a=(n=this._dataByOrigin.get(o.id))==null?void 0:n.findBuffer(s.id);if(k(a))continue;let l=i.get(o.id,a);k(l)&&(l=new R2e(o.vec3),i.set(o.id,a,l)),l.changes.push(s)}return i}_addAndRemoveGeometries(e,r){const{_bufferWriter:i,_dataByOrigin:n}=this,s=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),u=M(c)?c.changes:[];o.delete(l,null);let d=n.get(l);if(a.forEach((p,A)=>{if(o.delete(l,A),k(A))return void tr(!1,"No VAO for removed geometries");if(A.instances.size===p.changes.length)return this._vaoCache.deleteVao(A.vao),PD(d.buffers,A),void(d.buffers.length===0&&u.length===0&&n.delete(l));const v=A.numElements,b=A.vao.size/4,S=u.reduce((I,N)=>I+i.elementCount(N.geometry),0),E=p.changes.reduce((I,N)=>I+i.elementCount(N.geometry),0),R=Math.min((v+S-E)*s,J8),O=R>b;R>Wz&&R<b/2?(p.changes.forEach(({id:I})=>A.deleteInstance(I)),A.instances.forEach(({geometry:I})=>u.push(I)),this._vaoCache.deleteVao(A.vao),PD(d.buffers,A)):O?this._applyAndRebuild(A,u,p):this._applyRemoves(A,p)}),u.length>0)for(k(d)&&(d=new l4t(c.origin),n.set(l,d)),d.buffers.forEach(p=>this._applyAdds(p,u));u.length>0;)d.buffers.push(this._applyAndRebuild(new s4t,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,Ql(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(M(i))for(const v of i.changes)e.deleteInstance(v.id);const n=this._bufferWriter,s=n.vertexBufferLayout.stride,o=s/4,a=Math.floor(J8/o);let l=e.numElements;for(;r.length>0;){const v=r.pop(),b=n.elementCount(v.geometry);if(l+b>a&&l>0){r.push(v);break}l+=b;const S=new C2e(v,0,0);tr(e.instances.get(v.id)==null),e.addInstance(v.id,S)}const c=l*o,u=K8(c),d=n.vertexBufferLayout.createView(u.buffer);let p=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((v,b)=>{this._writeGeometry(v.geometry,d,p);const S=p;p+=n.elementCount(v.geometry.geometry),e.updateInstance(b,S,p),e.updateDrawState(v)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(P2e(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,p*o),e.holes.clear();const A=e.holes.pushNew();return A.from=p,A.to=Math.floor(e.vao.size/s),e.updateDrawCommands(s),e}_applyRemoves(e,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=lg.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const d=lg.pushNew();d.from=c.from,d.to=c.to}E2e(lg);const i=this._bufferWriter.vertexBufferLayout.stride/4,n=lg.reduce((a,l)=>Math.max(a,l.numElements),0)*i,s=K8(n);s.fill(0,0,n);const o=e.vao.vertexBuffers.geometry;lg.forAll(a=>o.setSubData(s,a.from*i,0,a.numElements*i)),e.holes.pushArray(lg.data,lg.length),lg.forAll((a,l)=>lg.data[l]=null),lg.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0)return;if(!o4t(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,n=i.vertexBufferLayout.stride/4,s=e.numElements,o=r.reduce((E,R)=>E+i.elementCount(R.geometry),0),a=Math.min((s+o)*n,J8),l=4*a;if(e.vao.size<P2e(J8-Wz)&&l>e.vao.size)return void this._applyAndRebuild(e,r,null);E2e(e.holes);const c=new Array;for(const E of r){const R=i.elementCount(E.geometry),O=d4t(e.holes,R);c.push(O)}const u=e.vao.vertexBuffers.geometry;let d=0,p=0,A=0;const v=K8(a),b=i.vertexBufferLayout.createView(v.buffer);r.forEach((E,R)=>{const O=c[R];if(k(O))return;if(A!==O){const L=A-p;L>0&&u.setSubData(v,p*n,0,L*n),p=O,d=0}const I=i.elementCount(E.geometry);this._writeGeometry(E,b,d),d+=I,A=O+I;const N=new C2e(E,O,O+I);tr(e.instances.get(E.id)==null),e.addInstance(E.id,N),e.drawCommandsDirty=!0});const S=A-p;S>0&&u.setSubData(v,p*n,0,S*n),qJe(r,(E,R)=>k(c[R]))}_writeGeometry(e,r,i){const n=e.localOrigin.vec3;wTt(O2e,-n[0],-n[1],-n[2]);const s=js(p4t,O2e,e.transformation);Ml(X8,s),gd(X8,X8),this._bufferWriter.write(s,X8,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,r){return this.material.requiresSlot(e,r)}render(e,r){var c;if(!this.requiresSlot(r.slot,e))return!1;const i=e===ne.Highlight||e===ne.ShadowHighlight;if(i&&!this._hasHighlights)return!1;const n=e===ne.ShadowExcludeHighlight,s=!(i||n),o=this._rctx;let a;const l=()=>{if(M(a))return a;const u=this._glMaterials.load(o,r.slot,e);return k(u)?null:(a=u.beginSlot(r),k(a)?null:(o.bindTechnique(a,this.material.parameters,r),a))};(c=this._appleAmdDriverHelper)==null||c.resetIndicesType();for(const u of this._dataByOrigin.values())for(const d of u.buffers){if(i&&!d.hasHighlights)continue;const p=(i?d.drawCommandsHighlight:n&&d.needsMultipleCommands()?d.drawCommandsShadowHighlightRest:d.drawCommandsDefault)||null,A=s&&d.drawCommandsOccludees||null;if(p!=null&&p.length||A!=null&&A.length){const v=l();if(k(v))return!1;v.program.bindDraw(new Yne(u.origin),r,this.material.parameters),v.ensureAttributeLocations(d.vao),o.bindVAO(d.vao),p!=null&&p.length&&(v.bindPipelineState(o,r.slot,!1),p.forAll(b=>o.drawArrays(v.primitiveType,b.first,b.count))),A!=null&&A.length&&(v.bindPipelineState(o,r.slot,!0),A.forAll(b=>o.drawArrays(v.primitiveType,b.first,b.count)))}}return M(a)}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},R2e=class{constructor(e){this.origin=e,this.changes=new Array}};function d4t(t,e){let r;if(!t.some(n=>!(n.numElements<e)&&(r=n,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const O2e=ht(),p4t=ht(),X8=ht(),lg=new Vr({allocator:t=>t||new Bde,deallocator:null}),Wz=65536,Z8=4*Wz,eUe=16777216,J8=eUe/4;let ZY=new Float32Array(Wz);function K8(t){return ZY.length<t&&(ZY=new Float32Array(t)),ZY}function P2e(t){const e=4*t;return e<Z8?Z8:Math.max(Math.min(Math.ceil(1.5*e/Z8)*Z8,eUe),e)}let Vd=class extends rt{constructor(e){super(e),this._pending=new f4t,this._changes=new Qne,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Vr,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Ql(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=zke(this._changes);let r=!1,i=!1,n=!1;return e.forEach((s,o)=>{let a=this._materialRenderers.get(o);if(!a&&s.adds.length>0&&(a=new Kke(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),r=!0,i=!0,n=!0),!a)return;const l=i||a.hasHighlights,c=n||a.hasWater;a.modify(s),i=i||l!==a.hasHighlights,n=n||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),r=!0)}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Ql(this._materialRenderers,s=>s.hasHighlights)),n&&(this._hasWater=Ql(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const n=this._pending.empty;for(const s of i)this._pending.adds.add(s);n&&this.notifyChange("updating"),r===$s.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,n=this._pending.adds;for(const s of e)n.has(s)?(this._pending.removed.add(s),n.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===$s.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const n of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(n),s.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case Ta.TRANSFORMATION:case Ta.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Ta.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=i.updateAnimation(e)||r),r}render(e){this._sortedMaterialRenderers.forAll(r=>{r.material.shouldRender(e)&&r.render(e.output,e.bindParameters)})}intersect(e,r,i,n,s){return this._geometries.forEach(o=>{if(n&&!n(o))return;this._intersectRenderGeometry(o,i,r,0,e,s);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,s),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((r,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push(r)}),this._sortedMaterialRenderers.sort((r,i)=>{const n=i.material.renderPriority-r.material.renderPriority;return n!==0?n:r.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,n,s,o){if(!e.visible)return;let a=0;n+=e.transformation[12],a=e.transformation[13],JY[0]=i[0]-n,JY[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,JY,(l,c,u)=>{m4t(r,u,e.material.renderPriority,o,s,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(k(this.drapeSource.notifyGraphicGeometryChanged))return;let r;for(const i of e){const n=i.graphicUid;M(n)&&n!==r&&(this.drapeSource.notifyGraphicGeometryChanged(n),r=n)}}_notifyGraphicVisibilityChanged(e){if(k(this.drapeSource.notifyGraphicVisibilityChanged))return;let r;for(const i of e){const n=i.graphicUid;M(n)&&n!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(n),r=n)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return k(e.localOrigin)&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};h([f()],Vd.prototype,"drapeSource",void 0),h([f()],Vd.prototype,"updating",null),h([f()],Vd.prototype,"rctx",null),h([f()],Vd.prototype,"rendererContext",void 0),h([f()],Vd.prototype,"_materialRepository",null),h([f()],Vd.prototype,"_localOriginFactory",null),h([f({readOnly:!0})],Vd.prototype,"isEmpty",null),h([f()],Vd.prototype,"_materialRenderers",void 0),h([f()],Vd.prototype,"_geometries",void 0),Vd=h([Q("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Vd);let f4t=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function m4t(t,e,r,i,n,s,o){const a=new k$t(s,o,e),l=c=>{c.set(ws.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((n.results.min.drapedLayerOrder==null||r>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==Ol.MIN&&(n.results.max.drapedLayerOrder==null||r<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===Ol.ALL){const c=Uhe(n.ray);l(c),n.results.all.push(c)}}const JY=Ft(),KY=4;function g4t(){const t=new Ui,e=t.fragment;t.include(s0);const r=(KY+1)/2,i=1/(2*r*r);return e.include(Tp),e.uniforms.add([new _r("depthMap",n=>n.depthTexture),new ZN("tex",n=>n.colorTexture),new AL("blurSize",n=>n.blurSize),new ut("projScale",(n,s)=>{const o=zn(s.camera.eye,s.camera.center);return o>5e4?Math.max(0,n.projScale-(o-5e4)):n.projScale}),new ji("nearFar",(n,s)=>s.camera.nearFar)]),e.code.add(D`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture2D(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${D.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(D`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${D.int(KY)}; r <= ${D.int(KY)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      gl_FragColor = vec4(b / w_total);
    }
  `),t}const A4t=Object.freeze(Object.defineProperty({__proto__:null,build:g4t},Symbol.toStringTag,{value:"Module"}));let tUe=class rUe extends qi{initializeProgram(e){return new zi(e.rctx,rUe.shader.get().build(),Di)}initializePipeline(){return Pr({colorWrite:Gr})}};tUe.shader=new Bi(A4t,()=>be(()=>import("./SSAOBlur.glsl-7e205c9e.js"),[]));const y4t="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function fH(t){t.fragment.uniforms.add(new pi("projInfo",(e,r)=>_4t(r))),t.fragment.uniforms.add(new ji("zScale",(e,r)=>iUe(r))),t.fragment.code.add(D`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function _4t(t){const e=t.camera.projectionMatrix;return e[11]===0?pn(I2e,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):pn(I2e,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const I2e=Kr();function iUe(t){return t.camera.projectionMatrix[11]===0?ti($2e,0,1):ti($2e,1,0)}const $2e=Ft(),D2e=16;function v4t(){const t=new Ui,e=t.fragment;return t.include(s0),e.include(Tp),t.include(fH),e.uniforms.add(new ut("radius",(r,i)=>zde(i.camera))),e.code.add(D`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),e.code.add(D`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add([new ji("nearFar",(r,i)=>i.camera.nearFar),new _r("normalMap",r=>r.normalTexture),new _r("depthMap",r=>r.depthTexture),new ji("zScale",(r,i)=>iUe(i)),new ut("projScale",r=>r.projScale),new _r("rnm",r=>r.noiseTexture),new ji("rnmScale",(r,i)=>ti(L2e,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new ut("intensity",r=>r.intensity),new ji("screenSize",(r,i)=>ti(L2e,i.camera.fullWidth,i.camera.fullHeight))]),e.code.add(D`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        gl_FragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture2D(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${D.int(D2e)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${D.int(D2e)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      gl_FragColor = vec4(A);
    }
  `),t}function zde(t){return Math.max(10,20*t.computeRenderPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const L2e=Ft(),b4t=Object.freeze(Object.defineProperty({__proto__:null,build:v4t,getRadius:zde},Symbol.toStringTag,{value:"Module"}));let nUe=class sUe extends qi{initializeProgram(e){return new zi(e.rctx,sUe.shader.get().build(),Di)}initializePipeline(){return Pr({colorWrite:Gr})}};nUe.shader=new Bi(b4t,()=>be(()=>import("./SSAO.glsl-40a6c552.js"),[]));let w4t=class extends En{constructor(){super(...arguments),this.projScale=1}},x4t=class extends w4t{constructor(){super(...arguments),this.intensity=1}},T4t=class extends En{},S4t=class extends T4t{constructor(){super(...arguments),this.blurSize=Ft()}};const D4=2;let oUe=class{constructor(e,r,i,n){this._view=e,this._techniqueRepository=r,this._rctx=i,this._requestRender=n,this._quadVAO=null,this._passParameters=new x4t,this._drawParameters=new S4t}dispose(){this.enabled=!1,this._quadVAO=kt(this._quadVAO)}disposeOffscreenBuffers(){rl(this._ssaoFBO,e=>e.resize(0,0)),rl(this._blur0FBO,e=>e.resize(0,0)),rl(this._blur1FBO,e=>e.resize(0,0))}set enabled(e){e?this._enable():this._disable()}get enabled(){return M(this._enableTime)}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return M(this._blur1FBO)?this._blur1FBO.colorTexture:null}render(e,r,i,n){if(k(this._enableTime)||k(i)||k(n)||k(this._ssaoFBO)||k(this._blur0FBO)||k(this._blur1FBO))return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const s=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=n,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*E4t/zde(o)**6*l;const c=o.fullViewport,u=c[2],d=c[3],p=u/D4,A=d/D4;this._ssaoFBO.resize(u,d),this._blur0FBO.resize(p,A),this._blur1FBO.resize(p,A),k(this._quadVAO)&&(this._quadVAO=Fc(this._rctx)),s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,u,d),s.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),s.bindVAO(this._quadVAO);const v=Xl(this._quadVAO,"geometry");s.drawArrays(wr.TRIANGLE_STRIP,0,v);const b=s.bindTechnique(this._blurTechnique,this._passParameters,e);s.setViewport(0,0,p,A),s.bindFramebuffer(this._blur0FBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,ti(this._drawParameters.blurSize,0,D4/d),b.bindDraw(this._drawParameters,e,this._passParameters),s.setViewport(0,0,p,A),s.drawArrays(wr.TRIANGLE_STRIP,0,v),s.bindFramebuffer(this._blur1FBO),this._drawParameters.colorTexture=this._blur0FBO.colorTexture,ti(this._drawParameters.blurSize,D4/u,0),b.bindDraw(this._drawParameters,e,this._passParameters),s.drawArrays(wr.TRIANGLE_STRIP,0,v),s.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(M(this._enableTime))return;const e={target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.LINEAR,wrapMode:Ar.CLAMP_TO_EDGE,width:0,height:0},r={colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE};this._ssaoFBO=new uo(this._rctx,r,e),this._blur0FBO=new uo(this._rctx,r,e),this._blur1FBO=new uo(this._rctx,r,e);const i=Uint8Array.from(atob(y4t),n=>n.charCodeAt(0));this._passParameters.noiseTexture=new Xt(this._rctx,{target:cr.TEXTURE_2D,pixelFormat:_t.RGB,dataType:xr.UNSIGNED_BYTE,hasMipmap:!0,width:32,height:32},i),k(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(nUe)),k(this._blurTechnique)&&(this._blurTechnique=this._techniqueRepository.acquire(tUe)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=kt(this._passParameters.noiseTexture),this._blur1FBO=kt(this._blur1FBO),this._blur0FBO=kt(this._blur0FBO),this._ssaoFBO=kt(this._ssaoFBO)}get gpuMemoryUsage(){return(M(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(M(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(M(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}};const E4t=.5;let Vde=class aUe extends qi{initializeProgram(e){return new zi(e.rctx,aUe.shader.get().build(),Di)}initializePipeline(){return this.configuration.hasAlpha?Pr({blending:Da(st.SRC_ALPHA,st.ONE,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),colorWrite:Gr}):Pr({colorWrite:Gr})}};Vde.shader=new Bi(KRt,()=>be(()=>import("./TextureOnly.glsl-f5ae9eb3.js"),[]));let Gde=class extends Nc{constructor(){super(...arguments),this.hasAlpha=!1}};h([ae()],Gde.prototype,"hasAlpha",void 0);let F0=class extends rt{get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new cn,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Vr,this._passParameters=new mde,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new mr,this.worldToPCSRatio=1,this.events=new Ws,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const r=e.waterTextureRepository;this._stippleTextureRepository=new Tke(e.renderingContext),this._shaderTechniqueRepository=new yke({rctx:this._rctx,viewingMode:wt.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:r}),this._renderContext=new Uke(this._rctx,new Fde(this._rctx,this.view.state.viewingMode),new oUe(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([xe(()=>r.updating,()=>this.events.emit("content-changed"),vo),xe(()=>this.spatialReference,i=>this._localOriginFactory=new Nde(i),vo),Bo(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new _ke(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&Qz)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=nt.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=ZFe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=dr.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new ghe(pt(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(ar.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=us(this._debugTextureTechnique),this._passParameters.texture=kt(this._passParameters.texture),this._bindParameters.highlightDepthTexture=kt(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=yt(this._shaderTechniqueRepository),this._temporaryFBO=kt(this._temporaryFBO),this._quadVAO=kt(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||Ql(this._renderers,e=>e.updating)}get hasOverlays(){return M(this._overlays)&&M(this._overlayRenderTarget)}get gpuMemoryUsage(){return M(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Vd)}createDrapeSourceRenderer(e,r,i){const n=this._renderers.get(e);M(n)&&n.destroy();const s=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(xe(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(k(e))return;const r=this._renderers.get(e);k(r)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),r.destroy())}collectUnusedRenderTargetMemory(e){let r=!1;if(M(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const[n,s]=this.overlays,o=n.validTargets[i.type]||!s.validTargets[i.type];r=this._overlayRenderTarget.validateUsageForTarget(o,i,e)||r}return r}get overlays(){return br(this._overlays,[])}ensureDrapeTargets(e){M(this._overlays)&&this._overlays.forEach(r=>r.hasTargetWithoutRasterImage=$7(e,i=>i.drapeTargetType===jne.WithoutRasterImage))}ensureDrapeSources(e){M(this._overlays)&&this._overlays.forEach(r=>{r.hasDrapedFeatureSource=$7(e,i=>i.drapeSourceType===Y5.Features),r.hasDrapedRasterSource=$7(e,i=>i.drapeSourceType===Y5.RasterImage)})}ensureOverlays(e,r){k(this._overlays)&&(this._overlayRenderTarget=new QIt(this._rctx),this._overlays=[new o2e(bs.INNER,this._overlayRenderTarget),new o2e(bs.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=kt(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[n,s]of this._renderers){if(e.done)break;(n.destroyed||r(n))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(M(this._overlays)&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(pu,e=>e.updatePolicy===y2.SYNC)}get isEmpty(){return!tn.OVERLAY_DRAW_DEBUG_TEXTURE&&!Ql(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,r,i){const n=e.canvasGeometries;if(n.numViews===0)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const s=r.output;if(this.isEmpty||s===ne.Highlight&&!this.hasHighlights||s===ne.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const o=r.fbo;if(!o.isValid())return!1;const a=2*e.resolution,l=e.resolution;o.resize(a,l);const c=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*i,this._renderContext.output=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===ne.Normal?nt.DRAPED_WATER:nt.DRAPED_MATERIAL,e.applyViewport(this._rctx),o.bind(c),e.index===bs.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(rs.COLOR_BUFFER_BIT)),r.type===Vs.Occluded&&(this._renderContext.renderOccludedMask=Qz),tn.OVERLAY_DRAW_DEBUG_TEXTURE&&r.type!==Vs.Occluded)for(let u=0;u<n.numViews;u++)this._setViewParameters(n.extents[u],e),this._drawDebugTexture(e.resolution,M4t[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:u,renderer:d})=>{if(r.type===Vs.ColorNoRasterImage&&u.drapeSourceType===Y5.RasterImage)return;const{fullOpacity:p}=u,A=M(p)&&p<1&&s===ne.Color;A&&(this.bindTemporaryFramebuffer(this._rctx,a,l),c.clearSafe(rs.COLOR_BUFFER_BIT));for(let v=0;v<n.numViews;v++)this._setViewParameters(n.extents[v],e),d.render(this._renderContext);A&&M(this._temporaryFBO)&&(o.bind(c),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),p,e.index))}),c.bindFramebuffer(null),o.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,i){k(this._temporaryFBO)&&(this._temporaryFBO=new Ake(e,!1)),this._temporaryFBO.resize(r,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,n){var o;let s=0;for(const a of this._renderers.values())s=((o=a.intersect)==null?void 0:o.call(a,e,r,i,n,s))??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((r,i)=>{const n=e.indexOf(i.layer),s=n>=0,o=this._renderers.size*(i.renderGroup??(s?Gz.MapLayer:Gz.ViewLayer))+(s?n:0);this._sortedRenderers.push(new C4t(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],JIe(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),WG(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Ql(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Ql(this._renderers,r=>r.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Ql(this._renderers,r=>r.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,e,r);const i=this._rctx;i.bindTechnique(this._debugTextureTechnique,this._passParameters,null),i.bindVAO(this._quadVAO),i.drawArrays(wr.TRIANGLE_STRIP,0,Xl(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,r,i){if(Le(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const n=new Uint8Array(e*r*4);let s=0;for(let a=0;a<r;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>r-20?(n[s++]=255,n[s++]=255,n[s++]=255,n[s++]=255):(n[s++]=255,n[s++]=255,n[s++]=255,n[s++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}this._passParameters.texture=new Xt(this._rctx,{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.NEAREST,width:e,height:r},n);const o=new Gde;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(Vde,o),this._quadVAO=Fc(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};h([f()],F0.prototype,"_sortedDrapeSourceRenderersDirty",void 0),h([f({autoDestroy:!0})],F0.prototype,"_shaderTechniqueRepository",void 0),h([f({autoDestroy:!0})],F0.prototype,"_stippleTextureRepository",void 0),h([f({constructOnly:!0})],F0.prototype,"view",void 0),h([f()],F0.prototype,"worldToPCSRatio",void 0),h([f()],F0.prototype,"spatialReference",void 0),h([f({type:Boolean,readOnly:!0})],F0.prototype,"updating",null),h([f()],F0.prototype,"isEmpty",null),F0=h([Q("esri.views.3d.terrain.OverlayRenderer")],F0);let C4t=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const M4t=[[1,.5,.5],[.5,.5,1]],jde=-2,Qz=Ds.OccludeAndTransparent;function Hde(t,e,r,i){const n=uF(t.rings,!!t.hasZ,zA.CCW_IS_HOLE),s=yd(n.position.length),o=V7e(n.position,t.spatialReference,0,s,0,n.position,0,n.position.length/3,e,r,i),a=o!=null;return new P4t(n.position,s,uUe(n.polygons,n.position,s),cUe(n.outlines,n.position,s),a,o)}function lUe(t,e){const r=uF(t.rings,!1,zA.CCW_IS_HOLE),i=qs(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let n=2;n<r.position.length;n+=3)r.position[n]=jde;return{position:r.position,polygons:uUe(r.polygons,r.position),outlines:cUe(r.outlines,r.position),projectionSuccess:i}}function cUe(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:n})=>{const s=3*i,o=3*n;return M(r)?new hUe(i,n,Ff(e,s,o),Ff(r,s,o)):new qde(i,n,Ff(e,s,o))})}function uUe(t,e,r=null){const i=new Array;for(const{index:n,count:s,holeIndices:o,pathLengths:a}of t){if(s<=1)continue;const l=3*n,c=3*s,u=o.map(p=>p-n),d=M(r)?new R4t(n,s,Ff(e,3*n,3*s),Ff(r,l,c),u,a):new O4t(n,s,Ff(e,3*n,3*s),u,a);i.push(d)}return i}let qde=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},hUe=class extends qde{constructor(e,r,i,n){super(e,r,i),this.mapPositions=n}},R4t=class extends hUe{constructor(e,r,i,n,s,o){super(e,r,i,n),this.holeIndices=s,this.pathLengths=o}},O4t=class extends qde{constructor(e,r,i,n,s){super(e,r,i),this.holeIndices=n,this.pathLengths=s}},P4t=class{constructor(e,r,i,n,s,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=n,this.projectionSuccess=s,this.sampledElevation=o}};function dUe(t,e){const r=t.fragment;switch(r.code.add(D`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case ks.None:r.code.add(D`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case ks.View:r.code.add(D`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case ks.WindingOrder:r.code.add(D`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case ks.COUNT:}}var ks;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(ks||(ks={}));function pUe(t){t.vertex.code.add(D`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let I4t=class extends Nc{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function fUe(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(z.MODELORIGINHI,"vec3"),t.attributes.add(z.MODELORIGINLO,"vec3"),t.attributes.add(z.MODEL,"mat3"),t.attributes.add(z.MODELNORMAL,"mat3"));const r=t.vertex;e.instancedDoublePrecision&&(r.include(Az,e),r.uniforms.add(new yp("viewOriginHi",(i,n)=>MTt(Le(e9,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),e9))),r.uniforms.add(new yp("viewOriginLo",(i,n)=>RTt(Le(e9,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),e9)))),r.code.add(D`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(D`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?D`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(D`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===ne.Normal&&(wO(r),r.code.add(D`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&r.code.add(D`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}h([ae()],I4t.prototype,"instancedDoublePrecision",void 0);const e9=G();var oa;function $4t(t){switch(t){case"multiply":default:return oa.Multiply;case"ignore":return oa.Ignore;case"replace":return oa.Replace;case"tint":return oa.Tint}}function mUe(t,e,r){if(k(t)||e===oa.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=He(Math.round(t[3]*Yz),0,Yz),n=i===0||e===oa.Tint?0:e===oa.Replace?D4t:L4t;r[0]=He(Math.round(t[0]*A3),0,A3),r[1]=He(Math.round(t[1]*A3),0,A3),r[2]=He(Math.round(t[2]*A3),0,A3),r[3]=i+n}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(oa||(oa={}));const A3=255,Yz=85,D4t=Yz,L4t=2*Yz;function gUe(t){t.vertex.code.add(D`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${D.int(oa.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${D.int(oa.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${D.int(oa.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${D.int(oa.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function AUe(t,e){e.hasSymbolColors?(t.include(gUe),t.attributes.add(z.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(D`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new dF("colorMixMode",r=>Z9e[r.colorMixMode])),t.vertex.code.add(D`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function RE(t,e){e.hasVertexColors?(t.attributes.add(z.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(D`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(D`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(D`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function N4t(t){t.fragment.code.add(D`
    #define discardOrAdjustAlpha(color) { if (color.a < ${D.float(Jl)}) { discard; } }
  `)}let oS=class extends Ys{constructor(e,r){super(e,"float",Sn.Draw,(i,n,s)=>i.setUniform1f(e,r(n,s)))}};function aS(t,e){yUe(t,e,new ut("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function F4t(t,e){yUe(t,e,new oS("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function yUe(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==xn.Mask&&e.alphaDiscardMode!==xn.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case xn.Blend:return t.include(N4t);case xn.Opaque:i.code.add(D`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case xn.Mask:i.code.add(D`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case xn.MaskBlend:t.fragment.code.add(D`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function _Ue(t,e){const{vertex:r,fragment:i}=t,n=e.hasModelTransformation;n&&r.uniforms.add(new fs("model",o=>M(o.modelTransformation)?o.modelTransformation:wp));const s=e.hasColorTexture&&e.alphaDiscardMode!==xn.Opaque;switch(e.output){case ne.Depth:case ne.Shadow:case ne.ShadowHighlight:case ne.ShadowExcludeHighlight:case ne.ObjectAndLayerIdColor:pd(r,e),t.include(uh,e),t.include(TA,e),t.include(mR,e),t.include(h1,e),t.include(To,e),t.include(rH,e),jS(t),t.varyings.add("depth","float"),s&&i.uniforms.add(new _r("tex",o=>o.texture)),r.code.add(D`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${n?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(aS,e),i.code.add(D`
          void main(void) {
            discardBySlice(vpos);
            ${s?D`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?D`colorUV`:D`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===ne.ObjectAndLayerIdColor?D`outputObjectAndLayerIdColor();`:D`outputDepth(depth);`}
          }
        `);break;case ne.Normal:pd(r,e),t.include(uh,e),t.include(hF,e),t.include(dH,e),t.include(TA,e),t.include(mR,e),s&&i.uniforms.add(new _r("tex",o=>o.texture)),t.varyings.add("vPositionView","vec3"),r.code.add(D`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${e.normalType===An.Attribute?D`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${n?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(To,e),t.include(aS,e),i.code.add(D`
          void main() {
            discardBySlice(vpos);
            ${s?D`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?D`colorUV`:D`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===An.ScreenDerivative?D`
                vec3 normal = screenDerivativeNormal(vPositionView);`:D`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case ne.Highlight:pd(r,e),t.include(uh,e),t.include(TA,e),t.include(mR,e),s&&i.uniforms.add(new _r("tex",o=>o.texture)),r.code.add(D`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${n?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(To,e),t.include(aS,e),t.include(P1,e),i.code.add(D`
          void main() {
            discardBySlice(vpos);
            ${s?D`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?D`colorUV`:D`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function vUe(t,e){const r=t.fragment;if(e.hasVertexTangents?(t.attributes.add(z.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===ks.WindingOrder?r.code.add(D`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(D`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(t.extensions.add("GL_OES_standard_derivatives"),r.code.add(D`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),e.textureCoordinateType!==wo.None){t.include(she,e);const i=e.supportsTextureAtlas?e.hasWebGL2Context?hn.None:hn.Size:hn.None;r.uniforms.add(e.pbrTextureBindType===Sn.Pass?Sm("normalTexture",n=>n.textureNormal,i):g2("normalTexture",n=>n.textureNormal,i)),r.code.add(D`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${e.supportsTextureAtlas?D`vtc.size = ${Nf(e,"normalTexture")};`:""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function pF(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(Sm("ssaoTex",(i,n)=>n.ssaoHelper.colorTexture,e.hasWebGL2Context?hn.None:hn.InvSize)),r.constants.add("blurSizePixelsInverse","float",1/D4),r.code.add(D`
      float evaluateAmbientOcclusionInverse() {
        vec2 ssaoTextureSizeInverse = ${Nf(e,"ssaoTex",!0)};
        return texture2D(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
      }

      float evaluateAmbientOcclusion() {
        return 1.0 - evaluateAmbientOcclusionInverse();
      }
    `)):r.code.add(D`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function fF(t){t.constants.add("ambientBoostFactor","float",M6e)}function EP(t){t.uniforms.add(new ut("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function ZS(t,e){const r=t.fragment;switch(t.include(pF,e),e.pbrMode!==Jt.Disabled&&t.include(Ude,e),t.include(lhe,e),t.include(JN),r.code.add(D`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===Jt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),fF(r),EP(r),x1(r),r.code.add(D`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?D`normalize(vPosWorld)`:D`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),ty(r),r.code.add(D`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case Jt.Disabled:case Jt.WaterOnIntegratedMesh:case Jt.Water:t.include(uz,e),r.code.add(D`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case Jt.Normal:case Jt.Schematic:r.code.add(D`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(D`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new z_("hasFillLights",(i,n)=>n.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(D`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add([new ut("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new ut("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)]),r.code.add(D`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(D`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===Jt.Schematic?D`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:D`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case Jt.Terrain:case Jt.TerrainWithWater:t.include(uz,e),r.code.add(D`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case Jt.COUNT:}}function ph(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function bUe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function nU(t,e,r,i,n,s,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function k4t(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:bUe,create:ph,createView:k4t,fromValues:nU},Symbol.toStringTag,{value:"Module"}));function U4t(t){t.vertex.uniforms.add(new iy("colorTextureTransformMatrix",e=>M(e.colorTextureTransformMatrix)?e.colorTextureTransformMatrix:ph())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(D`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function B4t(t){t.vertex.uniforms.add(new iy("normalTextureTransformMatrix",e=>M(e.normalTextureTransformMatrix)?e.normalTextureTransformMatrix:ph())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(D`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function z4t(t){t.vertex.uniforms.add(new iy("emissiveTextureTransformMatrix",e=>M(e.emissiveTextureTransformMatrix)?e.emissiveTextureTransformMatrix:ph())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(D`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function V4t(t){t.vertex.uniforms.add(new iy("occlusionTextureTransformMatrix",e=>M(e.occlusionTextureTransformMatrix)?e.occlusionTextureTransformMatrix:ph())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(D`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function G4t(t){t.vertex.uniforms.add(new iy("metallicRoughnessTextureTransformMatrix",e=>M(e.metallicRoughnessTextureTransformMatrix)?e.metallicRoughnessTextureTransformMatrix:ph())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(D`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function NL(t){t.include(ry),t.code.add(D`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${D.int(oa.Multiply)}) {
        return allMixed;
      }
      if (mode == ${D.int(oa.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${D.int(oa.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${D.int(oa.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${D.int(oa.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function j4t(t){const e=new Ui,{vertex:r,fragment:i,varyings:n}=e;return pd(r,t),e.include(KN),n.add("vpos","vec3"),e.include(mR,t),e.include(fUe,t),e.include(V9e,t),t.hasColorTextureTransform&&e.include(U4t),t.output!==ne.Color&&t.output!==ne.Alpha||(t.hasNormalTextureTransform&&e.include(B4t),t.hasEmissionTextureTransform&&e.include(z4t),t.hasOcclusionTextureTransform&&e.include(V4t),t.hasMetallicRoughnessTextureTransform&&e.include(G4t),Um(r,t),e.include(hF,t),e.include(uh,t),t.normalType===An.Attribute&&t.offsetBackfaces&&e.include(pUe),e.include(vUe,t),e.include(dH,t),t.instancedColor&&e.attributes.add(z.INSTANCECOLOR,"vec4"),n.add("localvpos","vec3"),e.include(TA,t),e.include(AP,t),e.include(AUe,t),e.include(RE,t),r.uniforms.add(new pi("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),t.hasMultipassTerrain&&n.add("depth","float"),t.hasModelTransformation&&r.uniforms.add(new fs("model",s=>M(s.modelTransformation)?s.modelTransformation:wp)),r.code.add(D`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${D.float(Jl)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${t.normalType===An.Attribute?D`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${t.hasModelTransformation?"model,":""} vpos);
          ${t.normalType===An.Attribute&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?D`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?D`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?D`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?D`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?D`forwardMetallicRoughnessUV();`:""}
      }
    `)),t.output===ne.Alpha&&(e.include(To,t),e.include(aS,t),e.include(Sp,t),i.uniforms.add([new ut("opacity",s=>s.opacity),new ut("layerOpacity",s=>s.layerOpacity)]),t.hasColorTexture&&i.uniforms.add(new _r("tex",s=>s.texture)),i.include(NL),i.code.add(D`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?D`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?D`colorUV`:D`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:D`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?D`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:D`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),t.output===ne.Color&&(e.include(To,t),e.include(ZS,t),e.include(pF,t),e.include(aS,t),e.include(t.instancedDoublePrecision?pH:XS,t),e.include(Sp,t),Um(i,t),i.uniforms.add([r.uniforms.get("localOrigin"),new kr("ambient",s=>s.ambient),new kr("diffuse",s=>s.diffuse),new ut("opacity",s=>s.opacity),new ut("layerOpacity",s=>s.layerOpacity)]),t.hasColorTexture&&i.uniforms.add(new _r("tex",s=>s.texture)),e.include(ahe,t),e.include(Ude,t),i.include(NL),e.include(dUe,t),fF(i),EP(i),ty(i),i.code.add(D`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?D`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?D`colorUV`:D`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:D`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===An.ScreenDerivative?D`
                vec3 normal = screenDerivativeNormal(localvpos);`:D`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===Jt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?D`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:D`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?D`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:D`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?D`normalize(posWorld);`:D`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?D`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===Jt.Normal||t.pbrMode===Jt.Schematic?D`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?D`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:D`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===dr.Color?D`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),e.include(_Ue,t),e}const H4t=Object.freeze(Object.defineProperty({__proto__:null,build:j4t},Symbol.toStringTag,{value:"Module"}));let q4t=class extends Gke{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=pt(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Vn.Back,this.emissiveFactor=pt(0,0,0),this.instancedDoublePrecision=!1,this.normalType=An.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=pt(.2,.2,.2),this.diffuse=pt(.8,.8,.8),this.externalColor=Fr(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=G(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Es(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=BS.Less,this.textureAlphaMode=xn.Blend,this.textureAlphaCutoff=Bz,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Ds.Occlude}},W4t=class extends jke{constructor(){super(...arguments),this.origin=G(),this.slicePlaneLocalOrigin=this.origin}},Wde=class wUe extends qi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2,r.spherical=e.viewingMode===wt.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?wo.Default:wo.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,wUe.shader)}_initializeProgram(e,r){return new zi(e.rctx,r.get().build(this.configuration),Di)}_convertDepthTestFunction(e){return e===BS.Lequal?Qn.LEQUAL:Qn.LESS}_makePipeline(e,r){const i=this.configuration,n=e===dr.NONE,s=e===dr.FrontFace;return Pr({blending:i.output!==ne.Color&&i.output!==ne.Alpha||!i.transparent?null:n?_p:I1(e),culling:Q4t(i)?Ij(i.cullFace):null,depthTest:{func:cw(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(n||s)&&i.writeDepth?_h:null,colorWrite:Gr,stencilWrite:i.hasOccludees?VA:null,stencilTest:i.hasOccludees?r?j2:uw:null,polygonOffset:n||s?null:aH(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};function Q4t(t){return t.cullFace!==Vn.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}Wde.shader=new Bi(H4t,()=>be(()=>import("./DefaultMaterial.glsl-6e715566.js"),[]));let Br=class extends Xa{constructor(){super(...arguments),this.output=ne.Color,this.alphaDiscardMode=xn.Opaque,this.doubleSidedMode=ks.None,this.pbrMode=Jt.Disabled,this.cullFace=Vn.None,this.transparencyPassType=dr.NONE,this.normalType=An.Attribute,this.textureCoordinateType=wo.None,this.customDepthTest=BS.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};h([ae({count:ne.COUNT})],Br.prototype,"output",void 0),h([ae({count:xn.COUNT})],Br.prototype,"alphaDiscardMode",void 0),h([ae({count:ks.COUNT})],Br.prototype,"doubleSidedMode",void 0),h([ae({count:Jt.COUNT})],Br.prototype,"pbrMode",void 0),h([ae({count:Vn.COUNT})],Br.prototype,"cullFace",void 0),h([ae({count:dr.COUNT})],Br.prototype,"transparencyPassType",void 0),h([ae({count:An.COUNT})],Br.prototype,"normalType",void 0),h([ae({count:wo.COUNT})],Br.prototype,"textureCoordinateType",void 0),h([ae({count:BS.COUNT})],Br.prototype,"customDepthTest",void 0),h([ae()],Br.prototype,"spherical",void 0),h([ae()],Br.prototype,"hasVertexColors",void 0),h([ae()],Br.prototype,"hasSymbolColors",void 0),h([ae()],Br.prototype,"hasVerticalOffset",void 0),h([ae()],Br.prototype,"hasSlicePlane",void 0),h([ae()],Br.prototype,"hasSliceHighlight",void 0),h([ae()],Br.prototype,"hasColorTexture",void 0),h([ae()],Br.prototype,"hasMetallicRoughnessTexture",void 0),h([ae()],Br.prototype,"hasEmissionTexture",void 0),h([ae()],Br.prototype,"hasOcclusionTexture",void 0),h([ae()],Br.prototype,"hasNormalTexture",void 0),h([ae()],Br.prototype,"hasScreenSizePerspective",void 0),h([ae()],Br.prototype,"hasVertexTangents",void 0),h([ae()],Br.prototype,"hasOccludees",void 0),h([ae()],Br.prototype,"hasMultipassTerrain",void 0),h([ae()],Br.prototype,"hasModelTransformation",void 0),h([ae()],Br.prototype,"offsetBackfaces",void 0),h([ae()],Br.prototype,"vvSize",void 0),h([ae()],Br.prototype,"vvColor",void 0),h([ae()],Br.prototype,"receiveShadows",void 0),h([ae()],Br.prototype,"receiveAmbientOcclusion",void 0),h([ae()],Br.prototype,"textureAlphaPremultiplied",void 0),h([ae()],Br.prototype,"instanced",void 0),h([ae()],Br.prototype,"instancedColor",void 0),h([ae()],Br.prototype,"objectAndLayerIdColorInstanced",void 0),h([ae()],Br.prototype,"instancedDoublePrecision",void 0),h([ae()],Br.prototype,"doublePrecisionRequiresObfuscation",void 0),h([ae()],Br.prototype,"writeDepth",void 0),h([ae()],Br.prototype,"transparent",void 0),h([ae()],Br.prototype,"enableOffset",void 0),h([ae()],Br.prototype,"cullAboveGround",void 0),h([ae()],Br.prototype,"snowCover",void 0),h([ae()],Br.prototype,"hasColorTextureTransform",void 0),h([ae()],Br.prototype,"hasEmissionTextureTransform",void 0),h([ae()],Br.prototype,"hasNormalTextureTransform",void 0),h([ae()],Br.prototype,"hasOcclusionTextureTransform",void 0),h([ae()],Br.prototype,"hasMetallicRoughnessTextureTransform",void 0),h([ae({constValue:!0})],Br.prototype,"hasVvInstancing",void 0),h([ae({constValue:!1})],Br.prototype,"useCustomDTRExponentForWater",void 0),h([ae({constValue:!1})],Br.prototype,"supportsTextureAtlas",void 0),h([ae({constValue:!0})],Br.prototype,"useFillLights",void 0);function Y4t(t){const e=new Ui,{vertex:r,fragment:i,varyings:n}=e;return pd(r,t),e.include(KN),n.add("vpos","vec3"),e.include(mR,t),e.include(fUe,t),e.include(V9e,t),t.output!==ne.Color&&t.output!==ne.Alpha||(Um(e.vertex,t),e.include(hF,t),e.include(uh,t),t.offsetBackfaces&&e.include(pUe),t.instancedColor&&e.attributes.add(z.INSTANCECOLOR,"vec4"),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3"),t.hasMultipassTerrain&&n.add("depth","float"),e.include(TA,t),e.include(AP,t),e.include(AUe,t),e.include(RE,t),r.uniforms.add(new pi("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),r.code.add(D`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${D.float(Jl)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?D`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===ne.Alpha&&(e.include(To,t),e.include(aS,t),e.include(Sp,t),i.uniforms.add([new ut("opacity",s=>s.opacity),new ut("layerOpacity",s=>s.layerOpacity)]),t.hasColorTexture&&i.uniforms.add(new _r("tex",s=>s.texture)),i.include(NL),i.code.add(D`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?D`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?D`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?D`colorUV`:D`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:D`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?D`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:D`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),t.output===ne.Color&&(e.include(To,t),e.include(ZS,t),e.include(pF,t),e.include(aS,t),e.include(t.instancedDoublePrecision?pH:XS,t),e.include(Sp,t),Um(e.fragment,t),x1(i),fF(i),EP(i),i.uniforms.add([r.uniforms.get("localOrigin"),r.uniforms.get("view"),new kr("ambient",s=>s.ambient),new kr("diffuse",s=>s.diffuse),new ut("opacity",s=>s.opacity),new ut("layerOpacity",s=>s.layerOpacity)]),t.hasColorTexture&&i.uniforms.add(new _r("tex",s=>s.texture)),e.include(ahe,t),e.include(Ude,t),i.include(NL),e.extensions.add("GL_OES_standard_derivatives"),ty(i),i.code.add(D`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?D`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?D`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?D`colorUV`:D`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:D`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===Jt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?D`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:D`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?D`albedo = mix(albedo, vec3(1), 0.9);`:D``}
        ${D`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===Jt.Normal||t.pbrMode===Jt.Schematic?t.spherical?D`vec3 normalGround = normalize(vpos + localOrigin);`:D`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:D``}
        ${t.pbrMode===Jt.Normal||t.pbrMode===Jt.Schematic?D`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?D`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:D`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===dr.Color?D`gl_FragColor = premultiplyAlpha(gl_FragColor);`:D``}
      }
    `)),e.include(_Ue,t),e}const X4t=Object.freeze(Object.defineProperty({__proto__:null,build:Y4t},Symbol.toStringTag,{value:"Module"}));let xUe=class TUe extends Wde{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=An.Attribute,r.doubleSidedMode=ks.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,TUe.shader)}};xUe.shader=new Bi(X4t,()=>be(()=>import("./RealisticTree.glsl-876ebd16.js"),[]));let d1=class extends lw{constructor(e){super(e,K4t),this.supportsEdges=!0,this._configuration=new Br,this._vertexBufferLayout=e5t(this.parameters)}isVisibleForOutput(e){return e!==ne.Shadow&&e!==ne.ShadowExcludeHighlight&&e!==ne.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{instanced:r,hasVertexColors:i,hasSymbolColors:n,vvColorEnabled:s}=e,o=M(r)&&r.includes("color"),a=e.colorMixMode==="replace",l=e.opacity>0,c=e.externalColor&&e.externalColor[3]>0;return i&&(o||s||n)?!!a||l:i?a?c:l:o||s||n?!!a||l:a?c:l}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=!!this.parameters.instanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.hasVerticalOffset=M(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=M(this.parameters.screenSizePerspective),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,M(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Vn.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=M(this.parameters.modelTransformation),e!==ne.Color&&e!==ne.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=ks.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?ks.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?ks.WindingOrder:ks.None,this._configuration.instancedColor=M(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Jt.Schematic:Jt.Normal:Jt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<sH,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return M(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,n,s,o){if(M(this.parameters.verticalOffset)){const a=i.camera;Le(tX,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case wt.Global:l=Ye(N2e,tX);break;case wt.Local:l=Pe(N2e,i5t)}let c=0;const u=Ve(n5t,tX,a.eye),d=ct(u),p=Oe(u,u,1/d);let A=null;this.parameters.screenSizePerspective&&(A=Qe(l,p)),c+=Y9e(a,d,this.parameters.verticalOffset,A??0,this.parameters.screenSizePerspective),Oe(l,l,c),nd(eX,l,i.transform.inverseRotation),n=Ve(t5t,n,eX),s=Ve(r5t,s,eX)}H9e(e,i,n,s,wne(i.verticalOffset),o)}requiresSlot(e,r){return r===ne.Color||r===ne.Alpha||r===ne.Depth||r===ne.Normal||r===ne.Shadow||r===ne.ShadowHighlight||r===ne.ShadowExcludeHighlight||r===ne.Highlight||r===ne.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?nt.TRANSPARENT_MATERIAL:nt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:nt.OPAQUE_MATERIAL)||e===nt.DRAPED_MATERIAL:!1}createGLMaterial(e){return new Z4t(e)}createBufferWriter(){return new SP(this._vertexBufferLayout)}},Z4t=class extends ohe{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==ne.Color&&this._output!==ne.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return Le(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?xUe:Wde,e)}},J4t=class extends q4t{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const K4t=new J4t;function e5t(t){const e=Cs().vec3f(z.POSITION).vec3f(z.NORMAL),r=t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId;return t.hasVertexTangents&&e.vec4f(z.TANGENT),r&&e.vec2f(z.UV0),t.hasVertexColors&&e.vec4u8(z.COLOR),t.hasSymbolColors&&e.vec4u8(z.SYMBOLCOLOR),Fe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(z.OBJECTANDLAYERIDCOLOR),e}const t5t=G(),r5t=G(),i5t=pt(0,0,1),N2e=G(),eX=G(),tX=G(),n5t=G(),s5t=["polygon","extent"];let o5t=class extends sy{constructor(e,r,i,n){super(e,r,i,n),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=lH(this._getSymbolSize());if(a)throw new pe("graphics3dextrudesymbollayer:invalid-size",a)}const e=Oa(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(e),i=sh(r),n=r[3],s=n<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:n,transparent:s,cullFace:s?Vn.None:Vn.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new d1(o),this._bottomMaterial=new d1({...o,cullFace:Vn.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,s5t,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(r,new Wm);return this._createAs3DShape(r,e.renderingInfo,i,n,r.uid)}layerOpacityChanged(e,r){const i=Oa(this.symbolLayer,"material","color"),n=this._getCombinedOpacity(i),s=n<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:n,transparent:s}),this._bottomMaterial.setParameters({opacity:n,transparent:s});const o=this._getLayerOpacity();e.forEach(a=>{const l=r(a);M(l)&&l.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,z2)}slicePlaneEnabledChanged(e,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(i=>{const n=r(i);M(n)&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?UIt(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?ua.Recreate_Symbol:ua.Recreate_Graphics}async queryForSnapping(e,r,i,n){const s=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/xS(r),{objectId:o,target:a}=e,l=Te(a);switch(l.z=(l.z??0)+s,e.type){case"edge":{const{start:c,end:u}=e,d=Te(c),p=Te(u);return d.z=(d.z??0)+s,p.z=(p.z??0)+s,[i2e(o,l,1/0,d,p)]}case"vertex":return[NIt(o,l,1/0),i2e(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,n,s){const o=$L(e.geometry);if(k(o))return null;if(o.rings.length===0||!o.rings.some(se=>se.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=Hde(o,this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=bde(o);if(k(l))return null;const c=new Array,u=fa(),d=ht(),p=G(),A=this._context.renderCoordsHelper.viewingMode===wt.Global;A||this._context.renderCoordsHelper.worldUpAtPosition(null,p),Lm(o.spatialReference,[l.x,l.y,0],d,this._context.renderCoordsHelper.spatialReference);const v=ht();Ml(v,d);const b=Es();gO(b,v);const{polygons:S,mapPositions:E,position:R}=a,O=R.length/3,I=new Float64Array(3*O*6),N=new Float64Array(3*O*6),L=new Float64Array(3*O*6),B=new Float64Array(1*O*6);let U=0;for(let se=0;se<S.length;++se){const ue=S[se],re=ue.count;if(this._context.clippingExtent&&(qn(u),up(u,ue.mapPositions),!hm(u,this._context.clippingExtent)))continue;const te=V2(ue.mapPositions,ue.holeIndices,3);if(te.length===0)continue;const j=3*re*2+te.length,H=new Array(j),W=new Array(te.length),oe=6*re,le=3*I.BYTES_PER_ELEMENT,fe=new Pc(I.buffer,U*le,le,(U+oe)*le),de=3*N.BYTES_PER_ELEMENT,Ee=new Pc(N.buffer,U*de,de,(U+oe)*de),Ie=new Float64Array(L.buffer,3*U*L.BYTES_PER_ELEMENT,3*oe),Ge=new Float64Array(B.buffer,1*U*B.BYTES_PER_ELEMENT,1*oe),Ke=this._getExtrusionSize(r);a5t(R,E,te,ue,fe.typedBuffer,Ie,Ee.typedBuffer,Ge,H,W,Ke,p,A),cF(fe,fe,v),G2(Ee,Ee,b),U+=6*re;const vt=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),ke=new d5t(fe.typedBuffer,Ie,Ee.typedBuffer,Ge);c.push(F2e(this._material,H,H.length-W.length,ke,i,vt)),c.push(F2e(this._bottomMaterial,W,0,ke,i,vt))}if(c.length===0)return null;const q=new D1({geometries:c,metadata:{layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0}});q.transformation=d;const Z=rke(this.symbolLayer,{opacity:this._getLayerOpacity()}),X=M(Z)?{baseMaterial:this._material,edgeMaterials:[Z],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,ee=new ny(this,q,c,null,null,u5t,n,X);return ee.alignedSampledElevation=a.sampledElevation,ee.needsElevationUpdates=z2(n.mode),ee}};function F2e(t,e,r,i,n,s){const o=new Array(e.length).fill(0),a=[[z.POSITION,new Pt(i.positions,3,!0)],[z.NORMAL,new Pt(i.normals,3,!0)],[z.COLOR,new Pt(n,4,!0)],[z.SIZE,new Pt(i.heights,1,!0)]],l=[[z.POSITION,e],[z.NORMAL,e],[z.COLOR,o]];return new zo(t,a,l,i.elevation,lo.Mesh,s,r)}function a5t(t,e,r,i,n,s,o,a,l,c,u,d,p){const A=r.length/3;let v=0,b=2*i.count;l5t(t,e,i.index,i.count,r,0,A,n,s,o,a,l,c,b,u,d,p);let S=2*i.count;b=0,k2e(n,s,a,o,v,i.pathLengths[0],i.count,S,l,b,u),S+=4*i.pathLengths[0],b+=2*i.pathLengths[0],v+=i.pathLengths[0];for(let E=1;E<i.pathLengths.length;++E)k2e(n,s,a,o,v,i.pathLengths[E],i.count,S,l,b,u),S+=4*i.pathLengths[E],b+=2*i.pathLengths[E],v+=i.pathLengths[E]}function l5t(t,e,r,i,n,s,o,a,l,c,u,d,p,A,v,b,S){Pe(Fu,b);const E=v>0?1:-1;let R=3*r,O=0,I=3*O,N=i,L=3*N;for(let q=0;q<i;++q)S&&(Fu[0]=t[R+0],Fu[1]=t[R+1],Fu[2]=t[R+2],Ye(Fu,Fu)),a[I+0]=t[R+0],a[I+1]=t[R+1],a[I+2]=t[R+2],l[I+0]=e[R+0],l[I+1]=e[R+1],l[I+2]=e[R+2],c[I+0]=-E*Fu[0],c[I+1]=-E*Fu[1],c[I+2]=-E*Fu[2],u[O]=0,a[L+0]=t[R+0]+v*Fu[0],a[L+1]=t[R+1]+v*Fu[1],a[L+2]=t[R+2]+v*Fu[2],l[L+0]=e[R+0],l[L+1]=e[R+1],l[L+2]=e[R+2],c[L+0]=E*Fu[0],c[L+1]=E*Fu[1],c[L+2]=E*Fu[2],u[N]=v,I+=3,L+=3,R+=3,O+=1,N+=1;R=3*s,I=0,L=3*A;const B=v<0?j2e:G2e,U=v<0?G2e:j2e;for(let q=0;q<o;++q)p[I+0]=n[R+B[0]],p[I+1]=n[R+B[1]],p[I+2]=n[R+B[2]],d[L+0]=n[R+U[0]]+i,d[L+1]=n[R+U[1]]+i,d[L+2]=n[R+U[2]]+i,I+=3,L+=3,R+=3}function t9(t,e,r,i,n,s,o){i[s]=i[o],o*=3,t[(s*=3)+0]=t[o+0],t[s+1]=t[o+1],t[s+2]=t[o+2],e[s+0]=e[o+0],e[s+1]=e[o+1],e[s+2]=e[o+2],r[s+0]=n[0],r[s+1]=n[1],r[s+2]=n[2]}const UI=G();function k2e(t,e,r,i,n,s,o,a,l,c,u){let d=n,p=n+1,A=n+o,v=n+o+1,b=a,S=a+1,E=a+2*s,R=a+2*s+1;u<0&&(d=n+o+1,v=n),c*=3;for(let O=0;O<s;++O)O===s-1&&(u>0?(p=n,v=n+o):(p=n,d=n+o)),c5t(t,d,p,A,UI),t9(t,e,i,r,UI,b,d),t9(t,e,i,r,UI,S,p),t9(t,e,i,r,UI,E,A),t9(t,e,i,r,UI,R,v),l[c++]=b,l[c++]=E,l[c++]=R,l[c++]=b,l[c++]=R,l[c++]=S,d++,p++,A++,v++,b+=2,S+=2,E+=2,R+=2}const rX=G(),U2e=G(),B2e=G(),z2e=G(),V2e=G();function c5t(t,e,r,i,n){e*=3,r*=3,i*=3,Le(rX,t[e++],t[e++],t[e++]),Le(U2e,t[r++],t[r++],t[r++]),Le(B2e,t[i++],t[i++],t[i++]),Ve(z2e,U2e,rX),Ve(V2e,B2e,rX),Kt(n,V2e,z2e),Ye(n,n)}const y3=G();function u5t(t,e,r,i,n){const s=t.stageObject,o=s.geometries,a=o.length,l=e.mode!=="absolute-height";let c=0;const u=s.transformation,d=nP(ht(),u);for(let p=0;p<a;p+=2){const A=o[p];if(!xde(A))continue;const v=A.getMutableAttribute(z.POSITION).data,b=A.vertexAttributes.get(z.SIZE).data,S=new s9e(A.mapPositions),E=v.length/3;let R=0,O=!1,I=0;for(let N=0;N<E;N++){y3[0]=v[R],y3[1]=v[R+1],y3[2]=v[R+2],i(S,r9),l&&(I+=r9.sampledElevation),tn.TESTS_DISABLE_OPTIMIZATIONS?(Le(Sh,S.array[S.offset+0],S.array[S.offset+1],r9.z+b[R/3]),M(r)&&n.toRenderCoords(Sh,r,Sh),Ot(Sh,Sh,d)):(Le(Sh,v[R+0],v[R+1],v[R+2]),Ot(Sh,Sh,u),n.setAltitude(Sh,r9.z+b[R/3]),Ot(Sh,Sh,d)),v[R]=Sh[0],v[R+1]=Sh[1],v[R+2]=Sh[2];const L=h5t/n.unitInMeters;(Math.abs(y3[0]-v[R])>=L||Math.abs(y3[1]-v[R+1])>=L||Math.abs(y3[2]-v[R+2])>=L)&&(O=!0),S.offset+=3,R+=3}O&&(A.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(o[p]),o[p+1].invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(o[p+1])),c+=I/E}return c/a}const Sh=G(),Fu=G(),r9=new lF,G2e=[0,2,1],j2e=[0,1,2],h5t=.01;let d5t=class{constructor(e,r,i,n){this.positions=e,this.elevation=r,this.normals=i,this.heights=n}};function p5t(t,e,r,i,n){if(k(t))return null;const s=t.referencesGeometry()&&n?f5t(e,i,n):e,o=t.repurposeFeature(s);try{return t.evaluate({...r,$feature:o})}catch(a){return we.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const iX=new Map;function f5t(t,e,r){const{transform:i,hasZ:n,hasM:s}=r;iX.has(e)||iX.set(e,m5t(e));const o=iX.get(e)(t.geometry,i,n,s);return{...t,geometry:o}}function m5t(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,n,s)=>P7e(i,e,r,n,s);case"esriGeometryPolygon":return(r,i,n,s)=>I7e(i,e,r,n,s);case"esriGeometryPolyline":return(r,i,n,s)=>$7e(i,e,r,n,s);case"esriGeometryMultipoint":return(r,i,n,s)=>O7e(i,e,r,n,s);default:return we.getLogger("esri.views.2d.support.arcadeOnDemand").error(new pe("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const Smr=1.2,g5t=vA;let mH=class{constructor(e,r,i,n){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,$s.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Ta.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,$s.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=G()){return Le(e,0,0,0)}getBoundingBoxObjectSpace(e=fa()){return qn(e)}addObjectState(e,r){e===l1.Highlight&&(this.renderGeometries.forEach(i=>{const n=i.geometry.addHighlight();r.addRenderGeometry(i,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Ta.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Ta.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(_3)&&(e.draped.origin[0]+=_3[0],e.draped.origin[1]+=_3[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,n,s){qn(s);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,H2e,i),Xst(s,H2e)}if(r){let o;um(s,_3);const a=wde(s,r.service.spatialReference,r);try{o=await r.service.queryElevation(_3[0],_3[1],n,a,"ground")}catch{}M(o)&&(s[2]=Math.min(s[2],o),s[5]=Math.max(s[5],o))}return s}_getRenderGeometryProjectedBoundingRect(e,r,i,n){if(this.boundingBox)FG(cg,this.boundingBox);else{const s=e.boundingSphere,o=s[3];cg[0]=s[0]-o,cg[1]=s[1]-o,cg[2]=s[2]-o,cg[3]=s[0]+o,cg[4]=s[1]+o,cg[5]=s[2]+o}return r(cg,0,2),this.calculateRelativeScreenBounds&&n.push({location:um(cg),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),sce(cg,i)}};const H2e=oi(),cg=fa(),_3=G();let SUe=class{constructor(e,r,i,n=2048){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(e+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(k(this._metricsCached)){const e=Xne(q2e,i9,i9).getContext("2d");this._setFontProperties(e,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let n,s,o=0,a=0,l=0;this._lines.forEach((v,b)=>{const S=e.measureText(v),E=S.width,R=E+r;this._textWidths.push(E),this._lineWidths.push(R),o=Math.max(o,R),a=Math.max(a,S.actualBoundingBoxAscent),l=Math.max(l,S.actualBoundingBoxDescent),b===0&&(n=S),b===this._lines.length-1&&(s=S)});const c=e.font;let u=Q2e.get(c);if(!u){const v=e.measureText(y5t);u=new v5t(v.actualBoundingBoxAscent,v.actualBoundingBoxDescent),Q2e.set(c,u)}a=Math.max(a,u.actualBoundingBoxAscent),l=Math.max(l,u.actualBoundingBoxDescent);const d=a+l,p=this._hasBackground?n.actualBoundingBoxAscent:a,A=this._hasBackground?s.actualBoundingBoxDescent:l;this._metricsCached=new _5t(a-p,l-A,d,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*A5t}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(k(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case _2.Left:return this._backgroundHorizontalPadding;case _2.Center:return(this.displayWidth-this._lineWidths[e])/2;case _2.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,r=0,i=0){e.save();const n=r/=this.renderPixelRatio,s=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,n,s,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,r+d,i),this._renderLineDecoration(e,r+d,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+d,i,this._textWidths[c]),i+=this._lineSpacing}if(tn.TEXT_SHOW_BASELINE){e.strokeStyle=W2e,e.setLineDash([2,2]),e.lineWidth=1;let c=s+a;for(let u=0;u<this._lines.length;++u){const d=c+this._baselinePosition;this._drawLine(e,[n,d],[n+this.displayWidth,d]),c+=this._lineSpacing}}if(tn.TEXT_SHOW_BORDER&&(e.strokeStyle=W2e,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+n+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,n){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const s=this.renderedWidth,o=this.renderedHeight;n!==0?(n=He(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+n),e.arcTo(r,i,r+n,i,n),e.lineTo(r+s-n,i),e.arcTo(r+s,i,r+s,i+n,n),e.lineTo(r+s,i+o-n),e.arcTo(r+s,i+o,r+s-n,i+o,n),e.lineTo(r+n,i+o),e.arcTo(r,i+o,r,i+o-n,n),e.closePath()):e.rect(r,i,s,o)}_renderHalo(e,r,i,n,s){const o=this.renderedWidth,a=this.renderedHeight,l=Xne(q2e,Math.max(o,i9),Math.max(a,i9)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,n,s):this._renderHaloNative(c,n,s);let d=s+this._baselinePosition;for(let p=0;p<this._lines.length;++p){const A=this._getLineXOffset(p);this._renderLineDecoration(c,n+A,d,this._textWidths[p],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n);for(const[a,l]of EUe)this._fillText(e,s,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const n=2*this._haloSize;i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],a=this._getLineXOffset(s),l=5,c=.1;for(let u=0;u<l;u++){const d=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(d*n),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(e,r){e.font=this._parameters.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,n){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_strokeText(e,r,i,n){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const n=this._toRenderUnit(r[0]),s=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(n)+.5,c=Math.ceil(n+o)-.5,u=Math.floor(s)+.5,d=Math.ceil(s+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,u),e.stroke()}};const EUe=[];for(let e=0;e<360;e+=360/16)EUe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var _2;function Xne(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(_2||(_2={}));const q2e={canvas:null},A5t=.2,i9=512,W2e="rgb(255, 0, 255, 0.5)",y5t=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let _5t=class{constructor(e,r,i,n,s){this.paddingTop=e,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=n,this.baselinePosition=s}},v5t=class{constructor(e,r){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=r}};const Q2e=new Map,b5t=Object.freeze({left:0,center:.5,right:1}),sU=Object.freeze({"bottom-left":Gi(0,0),bottom:Gi(.5,0),"bottom-right":Gi(1,0),left:Gi(0,.5),center:Gi(.5,.5),right:Gi(1,.5),"top-left":Gi(0,1),top:Gi(.5,1),"top-right":Gi(1,1)});function CUe(t){switch(t){case"left":return _2.Left;case"right":return _2.Right;default:return _2.Center}}function Y2e(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function w5t(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function x5t(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function T5t(t){return t==="middle"?"center":t}var _c,X2e;function BI(t){return t!=null}function v3(t){return typeof t=="number"}function gH(t){return typeof t=="string"}function S5t(t){return t==null||gH(t)}function aa(t,e){t&&t.push(e)}function E5t(t,e,r,i=ht()){const n=t||0,s=e||0,o=r||0;return n!==0&&JR(i,i,-n/180*Math.PI),s!==0&&ZR(i,i,s/180*Math.PI),o!==0&&qG(i,i,o/180*Math.PI),i}function hv(t,e,r,i,n){const s=t.minSize,o=t.maxSize;if(t.expression)return aa(n,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=i.symbolSize[r];return e.minSize[r]=a,e.maxSize[r]=a,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=_c.DefinedSize,!0}if(BI(t.field))return BI(t.stops)?t.stops.length===2&&v3(t.stops[0].size)&&v3(t.stops[1].size)?(Z2e(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=_c.DefinedSize,!0):(aa(n,"Could not convert size info: stops only supported with 2 elements"),!1):v3(s)&&v3(o)&&BI(t.minDataValue)&&BI(t.maxDataValue)?(Z2e(s,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=_c.DefinedSize,!0):oO[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/oO[t.valueUnit],e.type[r]=_c.DefinedSize,!0):t.valueUnit==="unknown"?(aa(n,"Could not convert size info: proportional size not supported"),!1):(aa(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!BI(t.field)){if(t.stops&&t.stops[0]&&v3(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=_c.DefinedSize,!0;if(v3(s))return e.minSize[r]=s,e.maxSize[r]=s,e.offset[r]=s,e.factor[r]=0,e.type[r]=_c.DefinedSize,!0}return aa(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Z2e(t,e,r,i,n,s){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;n.minSize[s]=o>0?t:e,n.maxSize[s]=o>0?e:t,n.offset[s]=t-r*o,n.factor[s]=o}function C5t(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return aa(i,"Could not convert size info: unsupported property"),null;if(!S5t(t.field))return aa(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return aa(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size={field:t.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[_c.Undefined,_c.Undefined,_c.Undefined]};let n;switch(t.axis){case"width":return n=hv(t,e.size,0,r,i),n?e:null;case"height":return n=hv(t,e.size,2,r,i),n?e:null;case"depth":return n=hv(t,e.size,1,r,i),n?e:null;case"width-and-depth":return n=hv(t,e.size,0,r,i),n&&hv(t,e.size,1,r,i),n?e:null;case null:case void 0:case"all":return n=hv(t,e.size,0,r,i),n=n&&hv(t,e.size,1,r,i),n=n&&hv(t,e.size,2,r,i),n?e:null;default:return aa(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function M5t(t,e,r){for(let n=0;n<3;++n){let s=e.unitInMeters;t.type[n]===_c.DefinedSize&&(s*=e.modelSize[n],t.type[n]=_c.DefinedScale),t.minSize[n]=t.minSize[n]/s,t.maxSize[n]=t.maxSize[n]/s,t.offset[n]=t.offset[n]/s,t.factor[n]=t.factor[n]/s}let i;if(t.type[0]!==_c.Undefined)i=0;else if(t.type[1]!==_c.Undefined)i=1;else{if(t.type[2]===_c.Undefined)return aa(r,"No size axis contains a valid size or scale"),!1;i=2}for(let n=0;n<3;++n)t.type[n]===_c.Undefined&&(t.minSize[n]=t.minSize[i],t.maxSize[n]=t.maxSize[i],t.offset[n]=t.offset[i],t.factor[n]=t.factor[i],t.type[n]=t.type[i]);return!0}function J2e(t,e,r){t[4*e+0]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function R5t(t,e,r){if(t.normalizationField)return aa(r,"Could not convert color info: unsupported property"),null;if(gH(t.field)){if(!t.stops)return aa(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return aa(r,"Could not convert color info: too many color stops"),null;e.color={field:t.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const i=t.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];e.color.values[n]=s.value,J2e(e.color.colors,n,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return aa(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.color.values[n]=1/0,J2e(e.color.colors,n,i)}}return e}function O5t(t,e,r){if(t.normalizationField)return aa(r,"Could not convert opacity info: unsupported property"),null;if(gH(t.field)){if(!t.stops)return aa(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return aa(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity={field:t.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const i=t.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];e.opacity.values[n]=s.value,e.opacity.opacityValues[n]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return aa(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=i}}return e}function nX(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function P5t(t,e,r){if(!gH(t.field))return aa(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return aa(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return nX(t,e.rotation,0),e;case"roll":return nX(t,e.rotation,1),e;case null:case void 0:case"heading":return nX(t,e.rotation,2),e;default:return aa(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}function MUe(t,e,r){if(!t)return null;const i=!e.supportedTypes||!!e.supportedTypes.size,n=!e.supportedTypes||!!e.supportedTypes.color,s=!e.supportedTypes||!!e.supportedTypes.rotation,o=!!e.supportedTypes&&!!e.supportedTypes.opacity,a=t.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return aa(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return i?C5t(c,l,e,r):l;case"color":return n?R5t(c,l,r):l;case"opacity":return o?O5t(c,l,r):null;case"rotation":return s?P5t(c,l,r):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(t.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!M5t(a.size,e,r)?null:a:null}function Qde(t){return t&&t.size!=null}function FL(t,e){if(!t)return{enabled:!1};if(tn.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const r=MUe(t.visualVariables,e);return r?{enabled:!0,visualVariables:r,materialParameters:RUe(r,e),requiresShaderTransformation:Qde(r)}:{enabled:!1}}function kL(t,e,r){if(!e||!t.enabled)return!1;const i=t.visualVariables,n=MUe(e.visualVariables,r);return!!n&&!!(n9(i.size,n.size,"size")&&n9(i.color,n.color,"color")&&n9(i.rotation,n.rotation,"rotation")&&n9(i.opacity,n.opacity,"opacity"))&&(t.visualVariables=n,t.materialParameters=RUe(n,r),t.requiresShaderTransformation=Qde(n),!0)}function n9(t,e,r){if(!!t!=!!e||t&&t.field!==e.field)return!1;if(t&&r==="rotation"){const i=t,n=e;for(let s=0;s<3;s++)if(i.type[s]!==n.type[s]||i.offset[s]!==n.offset[s]||i.factor[s]!==n.factor[s])return!1}return!0}function RUe(t,e){const r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},i=Qde(t);return t&&t.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=t.size.minSize,r.vvSizeMaxSize=t.size.maxSize,r.vvSizeOffset=t.size.offset,r.vvSizeFactor=t.size.factor):t&&i&&(r.vvSizeValue=e.transformation.scale),t&&i&&(r.vvSymbolAnchor=e.transformation.anchor,r.vvSymbolRotationMatrix=Es(),Xf(J5),E5t(e.transformation.rotation[2],e.transformation.rotation[0],e.transformation.rotation[1],J5),Jf(r.vvSymbolRotationMatrix,J5)),t&&t.color&&(r.vvColorEnabled=!0,r.vvColorValues=t.color.values,r.vvColorColors=t.color.colors),t&&t.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=t.opacity.values,r.vvOpacityOpacities=t.opacity.opacityValues),r}function Zne(t,e,r){if(!t.vvSizeEnabled)return r;Ia(dv,r);const i=t.vvSymbolRotationMatrix;KA(J5,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),js(dv,dv,J5);for(let n=0;n<3;++n){const s=t.vvSizeOffset[n]+e[0]*t.vvSizeFactor[n];K2e[n]=He(s,t.vvSizeMinSize[n],t.vvSizeMaxSize[n])}return HG(dv,dv,K2e),Ah(dv,dv,t.vvSymbolAnchor),dv}function I5t(t,e,r){if(!e.vvSizeEnabled)return Le(t,1,1,1);for(let i=0;i<3;++i){const n=e.vvSizeOffset[i]+r[0]*e.vvSizeFactor[i];t[i]=He(n,e.vvSizeMinSize[i],e.vvSizeMaxSize[i])}return t}(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(_c||(_c={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(X2e||(X2e={}));const dv=ht(),K2e=G(),J5=ht();let CO=class{constructor(e,r={}){this.geometry=e,this.boundingSphere=Kr(),this.screenToWorldRatio=1,this._transformation=ht(),this._shaderTransformationDirty=!0,this.id=hd(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.boundingInfo=r.boundingInfo,this.shaderTransformer=r.shaderTransformer,this.castShadow=!!r.castShadow&&r.castShadow}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,r,i=$S(e)){k(this.boundingInfo)||(Ot(r,this.boundingInfo.center,e),r[3]=this.boundingInfo.radius*i)}get hasShaderTransformation(){return M(this.shaderTransformer)}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return k(this.shaderTransformer)?this.transformation:(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=ht()),Ia(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const $5t=ht(),ewe=pt(0,0,1),D5t=16,L5t=1.5,zT=Ade,N5t=[zT/2,zT/2,1-zT/2,1-zT/2],F5t=[RL*zT,RL*zT];let Jne=class OUe extends sy{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,n){super(e,r,i,n),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(M(i))this._prepareResourcesPrimitive(r,i);else{const n=rft(this.symbolLayer),s=TN(n);s&&s.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(s.data),e):await this._prepareResourcesHref(r,n,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=lH(this._getIconSize());if(e)throw new pe("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?El(e.size):D5t);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){const r=this._getGraphicHash(e);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const n={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",n,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",s.anchorPosition);const o={width:s.imageData.width,height:s.imageData.height,powerOfTwoResizeMode:m2.PAD};i=new ME(s.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_computeSize(e,r){const i=e.width/e.height;return i>1?[r,Math.round(r/i)]:[Math.round(r*i),r]}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(k5t(r)){const{screenLength:i,minWorldLength:n,maxWorldLength:s}=r.verticalOffset;e.verticalOffset={screenLength:El(i),minWorldLength:n||0,maxWorldLength:M(s)?s:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(sX(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,M(this._context.sharedResources.textures)){const s=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>l7e(r));this._texture=s.texture,this._releaseTexture=s,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=N5t;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/zT,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(M(this._context.sharedResources.textures)){const o=await Pm(this._context.sharedResources.textures.fromUrl(r,s,{signal:i}));if(o.ok===!1)throw Jh(o.error),new pe("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,n),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){const n=new KO({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const u=(await be(()=>import("./CIMSymbolRasterizer-39c78343.js"),["assets/CIMSymbolRasterizer-39c78343.js","assets/cimAnalyzer-ef43fe2e.js","assets/BidiEngine-836b7ef6.js","assets/TileClipper-ae6eca9e.js","assets/enums-c655c737.js","assets/number-b10bd8f5.js","assets/_commonjsHelpers-2f3e7994.js","assets/imageutils-8a4a4cba.js","assets/rasterizingUtils-a339c8d2.js"])).CIMSymbolRasterizer;fi(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(n,s,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(isNaN(u.scaleExpression)){const d=u.scaleExpression,p=await Unt(d,this._context.layer.spatialReference,s);a=(A,v,b)=>{const S=p5t(p,A,{$view:b},"esriGeometryPoint",v);return S!==null?S:1}}else o=Number(u.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];fi(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(u=>c.get(u).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||got}_getOutlineSize(){let e=0;const r=this.symbolLayer;return M(r.outline)&&r.outline.size!=null?Math.max(El(r.outline.size),0):(e=sX(this._getPrimitive())?L5t:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),r=this.symbolLayer,i=Oa(r,"outline","color");if(M(i)){const n=$t.toUnitRGB(i),s=i.a*e;return[n[0],n[1],n[2],s]}return[0,0,0,0]}_getFillColor(){if(sX(this._getPrimitive()))return g5t;const e=k(this._getPrimitive()),r=Oa(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?Gi((r.x||0)+.5,.5-(r.y||0)):e in sU?sU[e]:sU.center}_createMaterialAndAddToStage(e,r){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=FL(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let i=M(e.textureId)?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new TO(e),this._cimSymbolMaterials.set(br(e.textureId,0),i),r.add(i)),i}return this._material=new TO(e),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=us(this._releaseTexture)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const n=e.size[i];n&&n!=="symbol-value"&&n!=="proportional"&&(e.size[i]=El(n))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,n=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const d=this._generateTextureCIM(r),p={textureId:d.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(p,this._context.stage),n=[d.params.width,d.params.height]}else n=this._size,i=this._material;const s=IL(r.geometry);if(k(s))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const d=n[0]>n[1]?n[0]:n[1];l=this._getScaleFactor(o,d)}l*=this._symbolTextureRatio;const c=Gi(n[0]*l,n[1]*l),u=this.setGraphicElevationContext(r,new Wm);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,s,i,a,c,e.layer.uid):this._createAs3DShape(r,s,i,a,c,u,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=aF(OUe.elevationModeChangeTypes,i,n);if(s!==Hs.UPDATE)return s;const o=t0(n)||n==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!kL(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return ua.Recreate_Symbol;M(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return ua.Fast_Update}_defaultElevationInfoNoZ(){return U5t}_createAs3DShape(e,r,i,n,s,o,a){const l=this.getFastUpdateAttrValues(e),c=l?b=>Zne(this._fastUpdates.materialParameters,l,b):void 0,u=this._context.layer.uid,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:u}),p=Ane(i,ewe,null,n,s,B5t,null,l,d),A=Rde(this._context,r,p,o,a,c);if(k(A))return null;const v=new ny(this,A.object,[p],null,null,OL,o);return v.alignedSampledElevation=A.sampledElevation,v.needsElevationUpdates=t0(o.mode)||o.mode==="absolute-height",v.getScreenSize=this._createScreenSizeGetter(s,c),v.calculateRelativeScreenBounds=b=>i.calculateRelativeScreenBounds(v.getScreenSize(),1,b),PL(v,r,this._context.elevationProvider),v}_createAsOverlay(e,r,i,n,s,o){i.renderPriority=this._renderPriority;const a=Kr();nc(r,a,this._context.overlaySR),a[2]=jde;const l=this._context.clippingExtent;if(M(l)&&!nce(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=c?b=>Zne(this._fastUpdates.materialParameters,c,b):void 0,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),p=Ane(i,ewe,a,n,s,null,null,c,d),A=new CO(p,{layerUid:o,graphicUid:e.uid,shaderTransformer:u});a[3]=0,lm(A.boundingSphere,a);const v=new mH(this,[A],null,this._context.drapeSourceRenderer);return v.getScreenSize=this._createScreenSizeGetter(s,u),v.calculateRelativeScreenBounds=b=>i.calculateRelativeScreenBounds(v.getScreenSize(),1,b),v}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates.enabled){const n=e[0]/this._symbolTextureRatio,s=e[1]/this._symbolTextureRatio;return(o=Ft())=>{const a=r($5t);return o[0]=a[0]*n+i,o[1]=a[5]*s+i,o}}{const n=e[0]/this._symbolTextureRatio+i,s=e[1]/this._symbolTextureRatio+i;return(o=Ft())=>(o[0]=n,o[1]=s,o)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],r=pt(e,e,e),i=Wf(1),n=e*i;return{modelSize:r,symbolSize:pt(n,n,n),unitInMeters:i,transformation:{anchor:Ec,scale:cA,rotation:Ec}}}_getGraphicHash(e){let r="";for(const i of this._cimRequiredFields)r+=i+e.attributes[i];return r}_forEachMaterial(e){M(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function k5t(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function sX(t){return!k(t)&&(t==="cross"||t==="x")}Jne.PRIMITIVE_SIZE=F5t,Jne.elevationModeChangeTypes={definedChanged:Hs.UPDATE,staysOnTheGround:Hs.NONE,onTheGroundChanged:Hs.RECREATE};const U5t={mode:"relative-to-ground",offset:0},B5t=Fr(0,0,0,1);function Kne(t){switch(t){case"butt":return Uf.BUTT;case"square":return Uf.SQUARE;case"round":return Uf.ROUND;default:return null}}function z5t(t){return t==="diamond"?"kite":t}function ese(t,e,r=null){const i=[],n=[],s=e.mapPositions;V5t(e,n,i);const o=n[0][1].data,a=i[0][1].length,l=new Array(a).fill(0);return G5t(e,n,i,l),q5t(e,n,i,l),j5t(e,n,i,l),H5t(e,n,i,l),W5t(e,n,i,l),Q5t(e,n,i,l),Y5t(e,n,i,o),new zo(t,n,i,s,lo.Line,r)}function V5t(t,e,r){const{attributeData:{position:i},removeDuplicateStartEnd:n}=t,s=X5t(i)&&n,o=i.length/3-(s?1:0),a=new Array(2*(o-1)),l=s?i.slice(0,i.length-3):i;let c=0;for(let u=0;u<o-1;u++)a[c++]=u,a[c++]=u+1;e.push([z.POSITION,new Pt(l,3,s)]),r.push([z.POSITION,a])}function G5t(t,e,r,i){if(M(t.attributeData.colorFeature))return;const n=t.attributeData.color;e.push([z.COLOR,new Pt(br(n,Ef),4)]),r.push([z.COLOR,i])}function j5t(t,e,r,i){if(!M(t.attributeData.normal))return;const n=t.attributeData.normal;e.push([z.NORMAL,new Pt(n,3)]),r.push([z.NORMAL,i])}function H5t(t,e,r,i){const n=t.attributeData.colorFeature;k(n)||(e.push([z.COLORFEATUREATTRIBUTE,new Pt([n],1,!0)]),r.push([z.COLOR,i]))}function q5t(t,e,r,i){if(M(t.attributeData.sizeFeature))return;const n=t.attributeData.size;e.push([z.SIZE,new Pt([br(n,1)],1,!0)]),r.push([z.SIZE,i])}function W5t(t,e,r,i){const n=t.attributeData.sizeFeature;k(n)||(e.push([z.SIZEFEATUREATTRIBUTE,new Pt([n],1,!0)]),r.push([z.SIZEFEATUREATTRIBUTE,i]))}function Q5t(t,e,r,i){const n=t.attributeData.opacityFeature;k(n)||(e.push([z.OPACITYFEATUREATTRIBUTE,new Pt([n],1,!0)]),r.push([z.OPACITYFEATUREATTRIBUTE,i]))}function Y5t(t,e,r,i){if(k(t.overlayInfo)||t.overlayInfo.renderCoordsHelper.viewingMode!==wt.Global||!t.overlayInfo.spatialReference.isGeographic)return;const n=yd(i.length),s=ln(t.overlayInfo.spatialReference);for(let p=0;p<n.length;p+=3)_ce(i,p,n,p,s);const o=i.length/3,a=xo(o+1);let l=Z5t,c=J5t,u=0,d=0;Le(l,n[d++],n[d++],n[d++]),a[0]=0;for(let p=1;p<o+1;++p)p===o&&(d=0),Le(c,n[d++],n[d++],n[d++]),u+=PFe(l,c),a[p]=u,[l,c]=[c,l];e.push([z.DISTANCETOSTART,new Pt(a,1,!0)]),r.push([z.DISTANCETOSTART,r[0][1]])}function X5t(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const Z5t=G(),J5t=G();function Pmr(t,e){if(k(t)||t.length===0)return[];const r=[];return t.forEach(i=>{const n=i.length,s=yd(3*n);i.forEach((a,l)=>{s[3*l+0]=a[0],s[3*l+1]=a[1],s[3*l+2]=a[2]});const o={attributeData:{position:s,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function K5t(t,e,r,i){const n=t.type==="polygon"?zA.CCW_IS_HOLE:zA.NONE,s=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=uF(s,!!t.hasZ,n),l=yd(o.length),c=V7e(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),u=c!=null;return{lines:u?PUe(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function eDt(t,e){const r=t.type==="polygon"?zA.CCW_IS_HOLE:zA.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:n,outlines:s}=uF(i,!1,r),o=qs(n,t.spatialReference,0,n,e,0,n.length/3);for(let a=2;a<n.length;a+=3)n[a]=jde;return{lines:o?PUe(s,n):[],projectionSuccess:o}}function PUe(t,e,r=null){const i=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const o=3*n,a=3*s;i.push({position:Ff(e,3*n,3*s),mapPositions:M(r)?Ff(r,o,a):void 0})}return i}function tDt(t){const e=new Ui,r=t.hasMultipassTerrain&&(t.output===ne.Color||t.output===ne.Alpha),i=t.space===kf.World;t.hasTip&&i&&e.extensions.add("GL_OES_standard_derivatives"),e.include(xke,t),e.include(Oke,t),t.output===ne.Depth&&e.include(h1,t);const{vertex:n,fragment:s}=e;return s.include(bd),pd(n,t),e.attributes.add(z.POSITION,"vec3"),e.attributes.add(z.UV0,"vec2"),e.attributes.add(z.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),N2(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),n.uniforms.add([new ji("nearFar",(o,a)=>a.camera.nearFar),new pi("viewport",(o,a)=>a.camera.fullViewport)]),n.code.add(D`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(D`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(z.NORMAL,"vec3"),wO(n),n.constants.add("tiltThreshold","float",.7),n.code.add(D`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):n.code.add(D`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),n.code.add(D`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===YS.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===kf.Screen&&(n.uniforms.add(new fs("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),n.code.add(D`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),n.code.add(D`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),n.uniforms.add(new ut("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),n.code.add(D`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),n.uniforms.add(new ut("pixelRatio",(o,a)=>a.camera.pixelRatio)),Lj(e),n.code.add(D`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&n.code.add(D`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),n.code.add(D`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(n.code.add(D`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===kf.Screen&&n.code.add(D`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),n.code.add(D`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(Sp,t),e.include(To,t),s.uniforms.add([new pi("intrinsicColor",o=>o.color),new _r("tex",o=>o.texture)]),s.include(ry),e.constants.add("texelSize","float",1/DL),s.code.add(D`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",Dde/DL),e.constants.add("relativeTipLineWidth","float",g$t),s.code.add(D`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",Jl),s.code.add(D`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===ne.ObjectAndLayerIdColor?D`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===ne.Alpha?D`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===ne.Color?D`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===ne.Color&&t.transparencyPassType===dr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${t.output===ne.Highlight?D`gl_FragColor = vec4(1.0);`:""}
    ${t.output===ne.Depth?D`outputDepth(linearDepth);`:""}
  }
  `),e}const rDt=Object.freeze(Object.defineProperty({__proto__:null,build:tDt},Symbol.toStringTag,{value:"Module"})),IUe=new Map([[z.POSITION,0],[z.UV0,2],[z.AUXPOS1,3],[z.NORMAL,4],[z.COLOR,5],[z.COLORFEATUREATTRIBUTE,5],[z.SIZE,6],[z.SIZEFEATUREATTRIBUTE,6],[z.OPACITYFEATUREATTRIBUTE,7]]);let $Ue=class DUe extends qi{initializeProgram(e){return new zi(e.rctx,DUe.shader.get().build(this.configuration),IUe)}_makePipelineState(e,r){const i=this.configuration,n=e===dr.NONE;return Pr({blending:i.output===ne.Color||i.output===ne.Alpha?n?_p:I1(e):null,depthTest:{func:cw(e)},depthWrite:n?i.writeDepth?_h:null:nH(e),colorWrite:Gr,stencilWrite:i.hasOccludees?VA:null,stencilTest:i.hasOccludees?r?j2:uw:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Pr({blending:_p,depthTest:qz,depthWrite:null,colorWrite:Gr,stencilWrite:null,stencilTest:$ke}),this._occluderPipelineOpaque=Pr({blending:_p,depthTest:qz,depthWrite:null,colorWrite:Gr,stencilWrite:Pke,stencilTest:Ike}),this._occluderPipelineMaskWrite=Pr({blending:null,depthTest:Lde,depthWrite:null,colorWrite:null,stencilWrite:VA,stencilTest:j2})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===nt.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===nt.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};$Ue.shader=new Bi(rDt,()=>be(()=>import("./LineMarker.glsl-d0654f4e.js"),[]));let iDt=class extends lw{constructor(e){super(e,new sDt),this._vertexAttributeLocations=IUe,this._configuration=new ml,this._layout=this.createLayout()}dispose(){}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===nt.DRAPED_MATERIAL?kf.Draped:this.parameters.worldSpace?kf.World:kf.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Uf.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===Ds.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Cs().vec3f(z.POSITION).vec2f(z.UV0).vec3f(z.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(z.NORMAL),this.parameters.vvSizeEnabled?e.f32(z.SIZEFEATUREATTRIBUTE):e.f32(z.SIZE),this.parameters.vvColorEnabled?e.f32(z.COLORFEATUREATTRIBUTE):e.vec4f(z.COLOR),this.parameters.vvOpacityEnabled&&e.f32(z.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new oDt(this._layout,this.parameters)}requiresSlot(e,r){return r===ne.Color||r===ne.Alpha||r===ne.Highlight||r===ne.Depth?e===nt.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ds.OccludeAndTransparentStencil?e===nt.OPAQUE_MATERIAL||e===nt.OCCLUDER_MATERIAL||e===nt.TRANSPARENT_OCCLUDER_MATERIAL:r===ne.Color||r===ne.Alpha?e===(this.parameters.writeDepth?nt.TRANSPARENT_MATERIAL:nt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===nt.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new nDt(e)}},nDt=class extends ohe{_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique($Ue,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==ne.Color&&this._output!==ne.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},sDt=class extends yde{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Uf.BUTT,this.anchor=YS.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}},oDt=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,n,s){const o=i.vertexAttributes.get(z.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(z.NORMAL);this._parameters.worldSpace&&M(c)&&(l=c.data);let u=1,d=0;this._parameters.vvSizeEnabled?d=i.vertexAttributes.get(z.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(z.SIZE)&&(u=i.vertexAttributes.get(z.SIZE).data[0]);let p=[1,1,1,1],A=0;this._parameters.vvColorEnabled?A=i.vertexAttributes.get(z.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(z.COLOR)&&(p=i.vertexAttributes.get(z.COLOR).data);let v=0;this._parameters.vvOpacityEnabled&&(v=i.vertexAttributes.get(z.OPACITYFEATUREATTRIBUTE).data[0]);const b=new Float32Array(n.buffer);let S=s*(this.vertexBufferLayout.stride/4);const E=(N,L,B,U)=>{if(b[S++]=N[0],b[S++]=N[1],b[S++]=N[2],b[S++]=B[0],b[S++]=B[1],b[S++]=L[0],b[S++]=L[1],b[S++]=L[2],this._parameters.worldSpace&&(b[S++]=l[0],b[S++]=l[1],b[S++]=l[2]),this._parameters.vvSizeEnabled?b[S++]=d:b[S++]=u,this._parameters.vvColorEnabled)b[S++]=A;else{const q=Math.min(4*U,p.length-4);b[S++]=p[q+0],b[S++]=p[q+1],b[S++]=p[q+2],b[S++]=p[q+3]}this._parameters.vvOpacityEnabled&&(b[S++]=v)};let R;(function(N){N[N.ASCENDING=1]="ASCENDING",N[N.DESCENDING=-1]="DESCENDING"})(R||(R={}));const O=(N,L)=>{const B=Le(aDt,o[3*N],o[3*N+1],o[3*N+2]),U=lDt;let q=N+L;do Le(U,o[3*q],o[3*q+1],o[3*q+2]),q+=L;while(S2(B,U)&&q>=0&&q<a);e&&(Ot(B,B,e),Ot(U,U,e)),E(B,U,[-1,-1],N),E(B,U,[1,-1],N),E(B,U,[1,1],N),E(B,U,[-1,-1],N),E(B,U,[1,1],N),E(B,U,[-1,1],N)},I=this._parameters.placement;I!=="begin"&&I!=="begin-end"||O(0,R.ASCENDING),I!=="end"&&I!=="begin-end"||O(a-1,R.DESCENDING)}};const aDt=G(),lDt=G(),hc={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},cDt={dash:hc.dash,"dash-dot":[...hc.dash,...hc.dot],dot:hc.dot,"long-dash":hc["long-dash"],"long-dash-dot":[...hc["long-dash"],...hc.dot],"long-dash-dot-dot":[...hc["long-dash"],...hc.dot,...hc.dot],none:null,"short-dash":hc["short-dash"],"short-dash-dot":[...hc["short-dash"],...hc["short-dot"]],"short-dash-dot-dot":[...hc["short-dash"],...hc["short-dot"],...hc["short-dot"]],"short-dot":hc["short-dot"],solid:null},uDt=8;function hDt(t,e=2){return k(t)?t:{pattern:t.slice(),pixelRatio:e}}function Nmr(t,e=2){return{pattern:[t,t],pixelRatio:e}}function LUe(t){return M(t)&&t.type==="style"?dDt(t.style):null}function dDt(t){return M(t)?hDt(cDt[t],uDt):null}const pDt=["polyline","polygon","extent"];let NUe=class FUe extends sy{constructor(e,r,i,n){super(e,r,i,n)}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=FL(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Wf(1))<0)throw new pe("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=M(this.symbolLayer.marker)&&M(this._context.sharedResources.textures)?A$t(this._context.sharedResources.textures,z5t(this.symbolLayer.marker.style)):null}_getMaterialParameters(e,r=!1){var s;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const n={width:this._computeMaterialWidth((s=this.symbolLayer)==null?void 0:s.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Kne(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:LUe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...n,...this._fastUpdates.materialParameters}:n}get _materialColor(){return rl(this.symbolLayer.material,e=>e.color)}get _markerColor(){return rl(this.symbolLayer.marker,e=>e.color)}get _lineMaterial(){return k(this._lineMaterialCached)&&(this._lineMaterialCached=new PM(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return k(this._ringMaterialCached)&&(this._ringMaterialCached=new PM(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return k(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new PM({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return k(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new PM({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return k(this._markerMaterialCached)&&M(this.symbolLayer.marker)&&M(this._markerTexture)&&(this._markerMaterialCached=new iDt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=us(this._markerTexture)}_getDrivenSize(e){return this._drivenProperties.size&&e.size?El(BIt(e.size)):1}_getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?G_(this._fastUpdates.visualVariables.size.field,e):null}_getDrivenColor(e){const r=Fr(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}_getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?G_(this._fastUpdates.visualVariables.color.field,e):null}_getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?G_(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,pDt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Wm);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!kL(this._fastUpdates,r,this._vvConvertOptions))return ua.Recreate_Symbol;this._forEachMaterial(n=>n.setParameters(this._fastUpdates.materialParameters))}return ua.Fast_Update}prepareSymbolLayerPatch(e){var s,o;if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};((s=r.size)==null?void 0:s.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=Kne(br(r.cap.newValue,"butt")),delete r.cap);const n=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,n),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r))}_forEachMaterial(e){M(this._lineMaterialCached)&&e(this._lineMaterialCached),M(this._ringMaterialCached)&&e(this._ringMaterialCached),M(this._wireframeLineMaterialCached)&&e(this._wireframeLineMaterialCached),M(this._wireframeRingMaterialCached)&&e(this._wireframeRingMaterialCached),M(this._markerMaterialCached)&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,r=!1){const i=e.parameters.color,n=Oa(this.symbolLayer,"material","color"),s=this._patternHidesLine&&!r?0:this._getCombinedOpacity(n),o=Fr(i[0],i[1],i[2],s);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=aF(FUe.elevationModeChangeTypes,i,n);if(s!==Hs.UPDATE)return s;const o=t0(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof an)return Hf.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const n=e.graphic,s=this._getGeometryAsPolygonOrPolyline(n.geometry),o=s.type==="polygon"?s.rings:s.paths,a=new Array,l=fa(),c=K5t(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),u=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,u,"LineSymbol3DLayer");for(let A=0;A<c.lines.length;A++){const v=c.lines[A],b=v.position,S=v.mapPositions;if(M(this._context.clippingExtent)&&(qn(l),up(l,S),!hm(l,this._context.clippingExtent)))continue;const E=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,b,S,s.type,K5.ELEVATED,i);a.push(E),tn.LINE_WIREFRAMES&&a.push(E.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),M(this._markerMaterial)&&a.push(E.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const d=new D1({geometries:a,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),p=new ny(this,d,a,null,null,qPt,r);return p.alignedSampledElevation=c.sampledElevation,p.needsElevationUpdates=t0(r.mode),p}_createGeometry(e,r,i,n,s,o,a){const l=s==="polygon",c=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,u=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid});return ese(e,{overlayInfo:o===K5.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:l,mapPositions:n,attributeData:{position:i,size:u?null:this._getDrivenSize(r.renderingInfo),color:c?null:this._getDrivenColor(r.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(r.graphic),colorFeature:this._getColorFeatureAttributeData(r.graphic),opacityFeature:this._getOpacityFeatureAttributeData(r.graphic)}},d)}_createAsOverlay(e,r){const i=e.graphic,n=this._getGeometryAsPolygonOrPolyline(i.geometry),s=n.type==="polygon"?n.rings:n.paths,o=n.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=tn.LINE_WIREFRAMES?n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;M(a)&&(a.renderPriority=this._renderPriority-.001),M(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=fa(),d=qn(),p=eDt(n,this._context.overlaySR),A=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,s,A,"LineSymbol3DLayer");for(const v of p.lines){if(qn(u),up(u,v.position),!hm(u,this._context.clippingExtent))continue;YR(d,u);const b=E=>{const R=this._createGeometry(E,e,v.position,void 0,n.type,K5.DRAPED,i.uid),O=new CO(R,{layerUid:r,graphicUid:i.uid});return c.push(O),O};if(M(l)){const E=b(l),R=this.symbolLayer.marker.placement;R!=="begin"&&R!=="begin-end"||up(u,v.position,0,1),R!=="end"&&R!=="begin-end"||up(u,v.position,v.position.length-3,1),this._updateBoundingSphere(E,u)}const S=b(o);if(this._updateBoundingSphere(S,u),tn.LINE_WIREFRAMES){const E=b(a);this._updateBoundingSphere(E,u)}}return new mH(this,c,d,this._context.drapeSourceRenderer)}_updateBoundingSphere(e,r){pn(e.boundingSphere,.5*(r[0]+r[3]),.5*(r[1]+r[4]),0,.5*Math.sqrt((r[3]-r[0])*(r[3]-r[0])+(r[4]-r[1])*(r[4]-r[1])))}get _patternHidesLine(){const e=this.symbolLayer.pattern;return M(e)&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=br(e,Wf(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?El(1):1:El(e)}_prepareMaterialPatch(e,r,i){var a;const n=r.material;if(k(n))return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(n.type==="collection")return;const s=n.type==="complete"?rl(n.newValue,l=>l.color):((a=n.diff.color)==null?void 0:a.type)==="complete"?n.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(s);i.useMaterialColor&&this._patchMaterialColor(DN(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete r.material}_prepareMarkerPatch(e,r){const i=r.marker;if(k(i)||i.type!=="partial"||M(i.diff.style)||M(i.diff.placement)||M(i.diff.color)&&i.diff.color.type!=="complete")return{changed:!1,useMaterialColor:k(this._markerColor)};const n=i.diff.color;if(k(n))return delete r.marker,{changed:!1,useMaterialColor:k(this._markerColor)};const s=n.newValue;return k(s)?(delete r.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(s),this._markerMaterialCached,e),delete r.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(e,r,i){k(r)||i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var K5;NUe.elevationModeChangeTypes={definedChanged:Hs.RECREATE,staysOnTheGround:Hs.NONE,onTheGroundChanged:Hs.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(K5||(K5={}));let zI=null,Xz=!0;function oX(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(Xz)try{return new ImageData(t,e)}catch{Xz=!1}return kUe(t,e,r)}function fDt(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(Xz)try{return new ImageData(t,e,r)}catch{Xz=!1}const n=kUe(e,r,i);return n.data.set(t,0),n}function mDt(){return zI||(zI=document.createElement("canvas"),zI.width=1,zI.height=1),zI}function kUe(t,e,r){return r||(r=mDt()),r.getContext("2d").createImageData(t,e)}var zC;const aX=new WeakMap;let gDt=0,Fg=zC=class extends Je{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const n={type:"image-element",src:RS(t.src,i),crossOrigin:t.crossOrigin};e[r]=n}else if(t instanceof HTMLCanvasElement){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),s={type:"canvas-element",imageData:this._encodeImageData(n)};e[r]=s}else if(t instanceof HTMLVideoElement){const n={type:"video-element",src:RS(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=n}else if(t instanceof ImageData){const n={type:"image-data",imageData:this._encodeImageData(t)};e[r]=n}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(aX.has(this.data)||aX.set(this.data,++gDt),e(aX.get(this.data))):e()}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new zC(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return fDt(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new zC({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new zC({data:t}):FR(zC,t)}};h([f({type:String,json:{write:M2}})],Fg.prototype,"url",null),h([f({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),f()],Fg.prototype,"data",null),h([Ct("data")],Fg.prototype,"writeData",null),h([gt("data")],Fg.prototype,"readData",null),h([f({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Fg.prototype,"transparent",null),h([f({json:{write:!0}})],Fg.prototype,"wrap",void 0),h([f({readOnly:!0})],Fg.prototype,"contentHash",null),Fg=zC=h([Q("esri.geometry.support.MeshTexture")],Fg);const eD=Fg;var tse;let k0=tse=class extends Je{constructor(t){super(t),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=M(t)?t.get(this):null;if(r)return r;const i=new tse(this.clonePropertiesWithDeduplication(e));return M(t)&&t.set(this,i),i}clonePropertiesWithDeduplication(t){return{color:M(this.color)?this.color.clone():null,colorTexture:M(this.colorTexture)?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:M(this.normalTexture)?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:M(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:M(this.normalTextureTransform)?this.normalTextureTransform:null}}};h([f({type:$t,json:{write:!0}})],k0.prototype,"color",void 0),h([f({type:eD,json:{write:!0}})],k0.prototype,"colorTexture",void 0),h([f({type:eD,json:{write:!0}})],k0.prototype,"normalTexture",void 0),h([f({nonNullable:!0,json:{write:!0}})],k0.prototype,"alphaMode",void 0),h([f({nonNullable:!0,json:{write:!0}})],k0.prototype,"alphaCutoff",void 0),h([f({nonNullable:!0,json:{write:!0}})],k0.prototype,"doubleSided",void 0),h([f()],k0.prototype,"colorTextureTransform",void 0),h([f()],k0.prototype,"normalTextureTransform",void 0),k0=tse=h([Q("esri.geometry.support.MeshMaterial")],k0);const Yde=k0;var rse;let sf=rse=class extends Yde{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=M(t)?t.get(this):null;if(r)return r;const i=new rse(this.clonePropertiesWithDeduplication(e));return M(t)&&t.set(this,i),i}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:M(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:M(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:M(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:M(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(t):null,occlusionTextureTransform:M(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:M(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:M(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};h([f({type:$t,json:{write:!0}})],sf.prototype,"emissiveColor",void 0),h([f({type:eD,json:{write:!0}})],sf.prototype,"emissiveTexture",void 0),h([f({type:eD,json:{write:!0}})],sf.prototype,"occlusionTexture",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],sf.prototype,"metallic",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],sf.prototype,"roughness",void 0),h([f({type:eD,json:{write:!0}})],sf.prototype,"metallicRoughnessTexture",void 0),h([f()],sf.prototype,"occlusionTextureTransform",void 0),h([f()],sf.prototype,"emissiveTextureTransform",void 0),h([f()],sf.prototype,"metallicRoughnessTextureTransform",void 0),sf=rse=h([Q("esri.geometry.support.MeshMaterialMetallicRoughness")],sf);const UUe=sf;var oU;const BUe="esri.geometry.support.MeshVertexAttributes",b3=we.getLogger(BUe);let Fp=oU=class extends Je{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return VC(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},b3)}castPosition(t){return t&&t instanceof Float32Array&&b3.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),VC(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},b3)}castUv(t){return VC(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},b3)}castNormal(t){return VC(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},b3)}castTangent(t){return VC(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},b3)}clone(){const t={position:Te(this.position),uv:Te(this.uv),normal:Te(this.normal),tangent:Te(this.tangent),color:Te(this.color)};return new oU(t)}clonePositional(){const t={position:Te(this.position),normal:Te(this.normal),tangent:Te(this.tangent),uv:this.uv,color:this.color};return new oU(t)}};function lX(t,e,r,i){const{loggerTag:n,stride:s}=e;return t.length%s!=0?(i.error(n,`Invalid array length, expected a multiple of ${s}`),new r([])):t}function VC(t,e,r,i,n){if(!t)return t;if(t instanceof e)return lX(t,i,e,n);for(const s of r)if(t instanceof s)return lX(new e(t),i,e,n);if(Array.isArray(t))return lX(new e(t),i,e,n);{const s=r.map(o=>`'${o.name}'`);return n.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function VI(t,e,r){e[r]=ADt(t)}function ADt(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}h([f({json:{write:VI}})],Fp.prototype,"color",void 0),h([Wr("color")],Fp.prototype,"castColor",null),h([f({nonNullable:!0,json:{write:VI}})],Fp.prototype,"position",void 0),h([Wr("position")],Fp.prototype,"castPosition",null),h([f({json:{write:VI}})],Fp.prototype,"uv",void 0),h([Wr("uv")],Fp.prototype,"castUv",null),h([f({json:{write:VI}})],Fp.prototype,"normal",void 0),h([Wr("normal")],Fp.prototype,"castNormal",null),h([f({json:{write:VI}})],Fp.prototype,"tangent",void 0),h([Wr("tangent")],Fp.prototype,"castTangent",null),Fp=oU=h([Q(BUe)],Fp);var L4;const zUe="esri.geometry.support.MeshComponent",yDt=we.getLogger(zUe);let t_=L4=class extends Je{static from(t){return FR(L4,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return VC(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},yDt)}castMaterial(t){return FR(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?UUe:Yde,t)}clone(){return new L4({faces:Te(this.faces),shading:this.shading,material:Te(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:Te(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new L4(r)}};h([f({json:{write:!0}})],t_.prototype,"faces",void 0),h([Wr("faces")],t_.prototype,"castFaces",null),h([f({type:Yde,json:{write:!0}})],t_.prototype,"material",void 0),h([Wr("material")],t_.prototype,"castMaterial",null),h([f({type:String,json:{write:!0}})],t_.prototype,"shading",void 0),h([f({type:Boolean})],t_.prototype,"trustSourceNormals",void 0),t_=L4=h([Q(zUe)],t_);const _Dt=t_,AH=we.getLogger("esri.geometry.support.meshUtils.normalProjection");function vDt(t,e,r,i,n){return _H(i)?(yH(j_.TO_PCPF,Wn.fromTypedArray(t),Pc.fromTypedArray(e),Pc.fromTypedArray(r),i,Wn.fromTypedArray(n)),n):(AH.error("Cannot convert spatial reference to PCPF"),n)}function Fmr(t,e,r,i,n){return _H(i)?(yH(j_.FROM_PCPF,Wn.fromTypedArray(t),Pc.fromTypedArray(e),Pc.fromTypedArray(r),i,Wn.fromTypedArray(n)),n):(AH.error("Cannot convert to spatial reference from PCPF"),n)}function kmr(t,e,r){return qs(t,e,0,r,sj(e),0,t.length/3),r}function Umr(t,e,r){return qs(t,sj(r),0,e,r,0,t.length/3),e}function bDt(t,e,r){if(k(t))return e;const i=Pc.fromTypedArray(t),n=Pc.fromTypedArray(e);return cF(n,i,r),e}function wDt(t,e,r){if(k(t))return e;gO(Ha,r);const i=Wn.fromTypedArray(t),n=Wn.fromTypedArray(e);return G2(n,i,Ha),mhe(Ha)||Pde(n,n),e}function xDt(t,e,r){if(k(t))return e;gO(Ha,r);const i=Wn.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),n=Wn.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT);if(G2(n,i,Ha),mhe(Ha)||Pde(n,n),t!==e)for(let s=3;s<t.length;s+=4)e[s]=t[s];return e}function TDt(t,e,r,i,n){if(!_H(i))return AH.error("Cannot convert spatial reference to PCPF"),n;yH(j_.TO_PCPF,Wn.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Pc.fromTypedArray(e),Pc.fromTypedArray(r),i,Wn.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function Bmr(t,e,r,i,n){if(!_H(i))return AH.error("Cannot convert to spatial reference from PCPF"),n;yH(j_.FROM_PCPF,Wn.fromTypedArray(t,16),Pc.fromTypedArray(e),Pc.fromTypedArray(r),i,Wn.fromTypedArray(n,16));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function yH(t,e,r,i,n,s){if(!e)return;const o=r.count,a=sj(n);if(VUe(n))for(let l=0;l<o;l++)i.getVec(l,s9),e.getVec(l,ug),Lm(a,s9,o9,a),Jf(Ha,o9),t===j_.FROM_PCPF&&Kf(Ha,Ha),nd(ug,ug,Ha),s.setVec(l,ug);else for(let l=0;l<o;l++){i.getVec(l,s9),e.getVec(l,ug),Lm(a,s9,o9,a),Jf(Ha,o9);const c=_B(r.get(l,1));let u=Math.cos(c);t===j_.TO_PCPF&&(u=1/u),Ha[0]*=u,Ha[1]*=u,Ha[2]*=u,Ha[3]*=u,Ha[4]*=u,Ha[5]*=u,t===j_.FROM_PCPF&&Kf(Ha,Ha),nd(ug,ug,Ha),Ye(ug,ug),s.setVec(l,ug)}return s}function _H(t){return VUe(t)||SDt(t)}function VUe(t){return t.isWGS84||aOe(t)||XA(t)||ZA(t)}function SDt(t){return t.isWebMercator}var j_;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(j_||(j_={}));const s9=G(),ug=G(),o9=ht(),Ha=Es();let GUe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=b_.KTX2_ENCODING}};function lS(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function EDt(t){return new Promise((e,r)=>{const i=new Blob([t]),n=new FileReader;n.onload=()=>{const s=n.result;e(JSON.parse(s))},n.onerror=s=>{r(s)},n.readAsText(i)})}async function CDt(t,e){return e===b_.KTX2_ENCODING?new GUe(t):new Promise((r,i)=>{const n=new Blob([t],{type:e}),s=URL.createObjectURL(n),o=new Image,a=()=>{URL.revokeObjectURL(s),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=u=>{URL.revokeObjectURL(s),i(u),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=s})}function sA(t){if(k(t))return null;const e=M(t.offset)?t.offset:uke,r=M(t.rotation)?t.rotation:0,i=M(t.scale)?t.scale:hke,n=nU(1,0,0,0,1,0,e[0],e[1],1),s=nU(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=nU(i[0],0,0,0,i[1],0,0,0,1),a=ph();return mO(a,s,o),mO(a,n,a),a}function MDt(t){const e=new Ui,{vertex:r,fragment:i}=e;return e.include(uh,t),e.include(RE,t),e.include(Mke,t),pd(r,t),t.stippleEnabled&&(e.attributes.add(z.UV0,"vec2"),e.attributes.add(z.AUXPOS1,"vec3"),r.uniforms.add(new pi("viewport",(n,s)=>s.camera.fullViewport))),e.attributes.add(z.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(D`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(r.code.add(D`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?r.uniforms.add(new ut("worldToScreenRatio",(n,s)=>1/s.screenToPCSRatio)):r.code.add(D`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(D`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?r.code.add(D`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(D`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new ut("stipplePatternPixelSize",n=>$de(n))),r.code.add(D`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(D`}`),t.output===ne.Highlight&&e.include(P1,t),e.include(To,t),i.uniforms.add(new ut("alphaCoverage",(n,s)=>Math.min(1,n.width*s.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new pi("constantColor",n=>n.color)),i.code.add(D`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===ne.ObjectAndLayerIdColor?D`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${D.float(Jl)}) {
      discard;
    }

    ${t.output===ne.Color?D`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===ne.Highlight?D`outputHighlight();`:""}
  }
  `),e}const RDt=Object.freeze(Object.defineProperty({__proto__:null,build:MDt},Symbol.toStringTag,{value:"Module"}));let jUe=class HUe extends qi{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==ne.Highlight}initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2}initializeProgram(e){return new zi(e.rctx,HUe.shader.get().build(this.configuration),Di)}initializePipeline(){const e=this.configuration,r=Da(st.SRC_ALPHA,st.ONE,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),i=(n,s=null,o=null)=>Pr({blending:s,depthTest:Lde,depthWrite:o,colorWrite:Gr,stencilWrite:e.hasOccludees?VA:null,stencilTest:e.hasOccludees?n?j2:uw:null});return e.output===ne.Color?(this._occludeePipelineState=i(!0,e.transparent||this._stippleEnabled?r:null,_h),i(!1,e.transparent||this._stippleEnabled?r:null,_h)):i(!1)}get primitiveType(){return wr.LINES}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};jUe.shader=new Bi(RDt,()=>be(()=>import("./NativeLine.glsl-4c654d0e.js"),[]));let Ud=class extends Xa{constructor(){super(...arguments),this.output=ne.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};h([ae({count:ne.COUNT})],Ud.prototype,"output",void 0),h([ae()],Ud.prototype,"hasSlicePlane",void 0),h([ae()],Ud.prototype,"hasVertexColors",void 0),h([ae()],Ud.prototype,"transparent",void 0),h([ae()],Ud.prototype,"draped",void 0),h([ae()],Ud.prototype,"stippleEnabled",void 0),h([ae()],Ud.prototype,"stippleOffColorEnabled",void 0),h([ae()],Ud.prototype,"stipplePreferContinuous",void 0),h([ae()],Ud.prototype,"hasOccludees",void 0),h([ae({constValue:!1})],Ud.prototype,"stippleRequiresClamp",void 0),h([ae({constValue:!1})],Ud.prototype,"stippleScaleWithLineWidth",void 0),h([ae({constValue:!1})],Ud.prototype,"stippleRequiresStretchMeasure",void 0);var Zz;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(Zz||(Zz={}));let twe=class extends lw{constructor(e){super(e,new IDt),this._configuration=new Ud}getConfiguration(e,r){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===nt.DRAPED_MATERIAL;const i=M(this.parameters.stipplePattern);return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&M(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!e.visible)return;if(!J6e(r))return void we.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(z.POSITION).data,l=i.camera,c=DDt;$a(c,i.point);const u=2;Le(GI[0],c[0]-u,c[1]+u,0),Le(GI[1],c[0]+u,c[1]+u,0),Le(GI[2],c[0]+u,c[1]-u,0),Le(GI[3],c[0]-u,c[1]-u,0);for(let b=0;b<4;b++)if(!l.unprojectFromRenderScreen(GI[b],xy[b]))return;yc(l.eye,xy[0],xy[1],cX),yc(l.eye,xy[1],xy[2],uX),yc(l.eye,xy[2],xy[3],hX),yc(l.eye,xy[3],xy[0],dX);let d=Number.MAX_VALUE,p=0;for(let b=0;b<a.length-5;b+=3){if(iu[0]=a[b]+r[12],iu[1]=a[b+1]+r[13],iu[2]=a[b+2]+r[14],nu[0]=a[b+3]+r[12],nu[1]=a[b+4]+r[13],nu[2]=a[b+5]+r[14],kn(cX,iu)<0&&kn(cX,nu)<0||kn(uX,iu)<0&&kn(uX,nu)<0||kn(hX,iu)<0&&kn(hX,nu)<0||kn(dX,iu)<0&&kn(dX,nu)<0)continue;if(l.projectToRenderScreen(iu,Ww),l.projectToRenderScreen(nu,Qw),Ww[2]<0&&Qw[2]>0){Ve(hg,iu,nu);const E=l.frustum,R=-kn(E[Fn.NEAR],iu)/Qe(hg,E[Fn.NEAR]);Oe(hg,hg,R),ze(iu,iu,hg),l.projectToRenderScreen(iu,Ww)}else if(Ww[2]>0&&Qw[2]<0){Ve(hg,nu,iu);const E=l.frustum,R=-kn(E[Fn.NEAR],nu)/Qe(hg,E[Fn.NEAR]);Oe(hg,hg,R),ze(nu,nu,hg),l.projectToRenderScreen(nu,Qw)}else if(Ww[2]<0&&Qw[2]<0)continue;Ww[2]=0,Qw[2]=0;const S=Rce(eS(Ww,Qw,nwe),c);S<d&&(d=S,Pe(rwe,iu),Pe(iwe,nu),p=b/3)}const A=i.rayBegin,v=i.rayEnd;if(d<u*u){let b=Number.MAX_VALUE;if(W$e(eS(rwe,iwe,nwe),eS(A,v,$Dt),qw)){Ve(qw,qw,A);const S=ct(qw);Oe(qw,qw,1/S),b=S/zn(A,v)}o(b,qw,p,!1)}}intersectDraped(e,r,i,n,s,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(z.POSITION).data,l=e.vertexAttributes.get(z.SIZE),c=l?l.data[0]:0,u=n[0],d=n[1],p=((c+1)/2+4)*e.screenToWorldRatio;let A=Number.MAX_VALUE,v=0;for(let b=0;b<a.length-5;b+=3){const S=a[b],E=a[b+1],R=u-S,O=d-E,I=a[b+3]-S,N=a[b+4]-E,L=He((I*R+N*O)/(I*I+N*N),0,1),B=I*L-R,U=N*L-O,q=B*B+U*U;q<A&&(A=q,v=b/3)}A<p*p&&s(o.dist,o.normal,v,!1)}requiresSlot(e,r){return!(r!==ne.Color&&r!==ne.Highlight&&r!==ne.ObjectAndLayerIdColor||e!==nt.OPAQUE_MATERIAL&&e!==nt.DRAPED_MATERIAL)}createGLMaterial(e){return new ODt(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?Hke:G$t;return k(this.parameters.stipplePattern)?new SP(e):new PDt(e.clone().vec3f(z.AUXPOS1).vec2f(z.UV0))}},ODt=class extends aw{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===ne.Color&&this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,r)),this._stipplePattern=r),this.ensureTechnique(jUe,e)}},PDt=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(z.POSITION).length}write(e,r,i,n,s){r7e(i,this.vertexBufferLayout,e,r,n,s),this._writeAuxpos1(e,i,n,s),this._writeUV0(e,i,n,s)}_writeAuxpos1(e,r,i,n){const s=i.getField(z.AUXPOS1,Wn),o=r.indices.get(z.POSITION),a=r.vertexAttributes.get(z.POSITION).data,l=e,c=s.typedBufferStride,u=s.typedBuffer;n*=c;for(let d=0;d<o.length-1;d+=2)for(const p of[1,0]){const A=3*o[d+p],v=a[A],b=a[A+1],S=a[A+2],E=l[0]*v+l[4]*b+l[8]*S+l[12],R=l[1]*v+l[5]*b+l[9]*S+l[13],O=l[2]*v+l[6]*b+l[10]*S+l[14];u[n]=E,u[n+1]=R,u[n+2]=O,n+=c}}_writeUV0(e,r,i,n){var O;const s=i.getField(z.UV0,O1),o=r.indices.get(z.POSITION),a=r.vertexAttributes.get(z.POSITION).data,l=(O=r.vertexAttributes.get(z.DISTANCETOSTART))==null?void 0:O.data,c=s.typedBufferStride,u=s.typedBuffer;let d=0;u[n*=c]=Zz.START,u[n+1]=d,n+=c;const p=3*o[0],A=Le(iu,a[p],a[p+1],a[p+2]);e&&Ot(A,A,e);const v=nu,b=o.length-1;let S=1;const E=l?(I,N,L)=>d=l[L]:(I,N,L)=>d+=zn(I,N);for(let I=1;I<b;I+=2){const N=3*o[I];Le(v,a[N],a[N+1],a[N+2]),e&&Ot(v,v,e),E(A,v,S++);for(let L=0;L<2;++L)u[n]=1-L,u[n+1]=d,n+=c;Pe(A,v)}const R=3*o[b];Le(v,a[R],a[R+1],a[R+2]),e&&Ot(v,v,e),E(A,v,S),u[n]=Zz.END,u[n+1]=d}},IDt=class extends xP{constructor(){super(...arguments),this.color=Ef,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const iu=G(),nu=G(),hg=G(),qw=G(),Ww=Yl(),Qw=Yl(),rwe=G(),iwe=G(),nwe=Gm(),$Dt=Gm(),DDt=G(),GI=[Yl(),Yl(),Yl(),Yl()],xy=[G(),G(),G(),G()],cX=Xi(),uX=Xi(),hX=Xi(),dX=Xi(),LDt=["mesh"];class NDt extends sy{constructor(e,r,i,n){super(e,r,i,n),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){tn.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new twe({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new twe({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),e=>e.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,LDt,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new Wm),n=e.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._materials.forEach(n=>{n.material.setParameters({layerOpacity:i});const s=n.material.parameters;this._setMaterialTransparentParameter(s,n),n.material.setParameters({transparent:s.transparent})}),e.forEach(n=>{const s=r(n);M(s)&&s.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,z2)}slicePlaneEnabledChanged(e,r){return this._materials.forEach(i=>{i.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{const n=r(i);M(n)&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach(r=>r.material.setParameters({usePBR:e})),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return k(e)?"-":e instanceof $t?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,s=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:n,hasVertexTangents:s,uid:`vc:${n},vt:${s},vct${r},svc:${i}`}}_materialProperties(e,r,i){const n=this._materialPropertiesDefault(e,i);if(!r.material)return n;const{color:s,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:u}=r.material,d=this._colorOrTextureUid(s),p=this._colorOrTextureUid(o),A=this._colorOrTextureUid(a);if(n.color=s,n.colorTexture=o,n.normalTexture=a,n.uid=`${n.uid},cmuid:${d},ctmuid:${p},ntmuid:${A},ds:${l},ac:${c},am:${u}`,r.material instanceof UUe){const{metallic:v,roughness:b,metallicRoughnessTexture:S,emissiveColor:E,emissiveTexture:R,occlusionTexture:O}=r.material,I=this._colorOrTextureUid(S),N=this._colorOrTextureUid(E),L=this._colorOrTextureUid(R),B=this._colorOrTextureUid(O);n.metallic=v,n.roughness=b,n.metallicRoughnessTexture=S,n.emissiveColor=E,n.emissiveTexture=R,n.occlusionTexture=O,n.colorTextureTransform=r.material.colorTextureTransform,n.normalTextureTransform=r.material.normalTextureTransform,n.emissiveTextureTransform=r.material.emissiveTextureTransform,n.occlusionTextureTransform=r.material.occlusionTextureTransform,n.metallicRoughnessTextureTransform=r.material.metallicRoughnessTextureTransform,n.uid=`${n.uid},mrm:${v},mrr:${b},mrt:${I},emuid:${N},etmuid:${L},otmuid:${B}`}return n}_setInternalColorValueParameters(e,r){r.diffuse=$t.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,xn.Opaque);return M(r)?r.id:null}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const n=`${e.contentHash}/${r}`;let s=this._textures.get(n);return s||(s=new ME(lS(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!lS(i)&&r!==xn.Opaque,encoding:lS(i)&&M(i.encoding)?i.encoding:void 0}),this._textures.set(n,s),this._context.stage.add(s),this._context.stage.loadImmediate(s)),s}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Ar.CLAMP_TO_EDGE;case"mirror":return Ar.MIRRORED_REPEAT;default:return Ar.REPEAT}}_setInternalMaterialParameters(e,r){if(M(e.color)&&this._setInternalColorValueParameters(e.color,r),M(e.colorTexture)){const i=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);M(i)?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.params.preMultiplyAlpha):r.textureId=void 0}M(e.normalTexture)&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),M(e.emissiveColor)&&(r.emissiveFactor=$t.toUnitRGB(e.emissiveColor)),M(e.emissiveTexture)&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),M(e.occlusionTexture)&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),M(e.metallicRoughnessTexture)&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=sA(e.colorTextureTransform),r.normalTextureTransformMatrix=sA(e.normalTextureTransform),r.occlusionTextureTransformMatrix=sA(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=sA(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=sA(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const r=this._drivenProperties.color;let i=M(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(r)e.externalColor=Ef;else{const n=M(this.symbolLayer.material)?this.symbolLayer.material.color:null;M(n)?e.externalColor=$t.toUnitRGBA(n):(i=null,e.externalColor=Ef)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(k(r))return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){var v,b,S;const i=(v=r.material)==null?void 0:v.color,n=(b=r.material)==null?void 0:b.colorTexture,s=(S=r.material)==null?void 0:S.alphaMode,o=s==="blend",a=s!=="opaque"&&(this._hasTransparentVertexColors(e)||M(i)&&i.a<1||M(n)&&n.transparent||o),l=this._materialProperties(e,r,a),c=this._materials.get(l.uid);if(c)return c.material;const u={material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},d=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,p={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Ec,diffuse:cA,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Vn.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};d||(p.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),r.material&&(p.doubleSided=r.material.doubleSided,p.cullFace=r.material.doubleSided?Vn.None:Vn.Back,p.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const A=new d1(p);return u.material=A,this._materials.set(l.uid,u),this._context.stage.add(A),A}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?xn.MaskBlend:xn.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?xn.Opaque:r.alphaMode==="mask"?xn.Mask:xn.Blend}_addDebugNormals(e,r){const i=r.length,n=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let A=0;A<i;A++){const v=r[A],b=v.vertexAttributes.get(z.POSITION),S=v.vertexAttributes.get(z.NORMAL),E=v.indices.get(z.POSITION),R=v.indices.get(z.NORMAL),O=b.data,I=S.data;for(let N=0;N<E.length;N++){const L=3*E[N],B=3*R[N];for(let U=0;U<3;U++)o.push(O[L+U]);for(let U=0;U<3;U++)o.push(O[L+U]+I[B+U]*s);if(a.push(a.length),a.push(a.length),N%3==0){this._calculateFaceNormal(O,E,N,T3),this._getFaceVertices(O,E,N,Ul,w3,x3),ze(Ul,Ul,w3),ze(Ul,Ul,x3),Oe(Ul,Ul,1/3);for(let U=0;U<3;U++)l.push(Ul[U]);for(let U=0;U<3;U++)l.push(Ul[U]+T3[U]*s);c.push(c.length),c.push(c.length)}}}const u=r[0].transformation,d=new zo(this._debugVertexNormalMaterial,[[z.POSITION,new Pt(o,3,!0)]],[[z.POSITION,a]],null,lo.Line);r.push(d),d.transformation=u;const p=new zo(this._debugFaceNormalMaterial,[[z.POSITION,new Pt(l,3,!0)]],[[z.POSITION,c]],null,lo.Line);p.transformation=u,r.push(p)}_createAs3DShape(e,r,i,n){const s=e.geometry;if(s.type!=="mesh")return null;const o=this._createGeometryInfo(s,r,n);if(k(o))return null;const{geometries:a,objectTransformation:l}=o;tn.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,a);const c=new D1({geometries:a,metadata:{layerUid:this._context.layer.uid,graphicUid:n}});c.transformation=l;const u=rke(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=M(u)?new KPt(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,p=new ny(this,c,a,null,null,OL,i,d);p.needsElevationUpdates=z2(i.mode),p.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c);const{elevationProvider:A,renderCoordsHelper:v}=this._context,b=(S,E)=>TP(S,A,i,v,E);return p.alignedSampledElevation=OL(p,i,A.spatialReference,b,v),p}_getCenterPointInElevationSR(e){const r=$1(0,0,0,M(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);return h$e([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,n){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,n);case"flat":return this._createComponentNormalsFlat(e,n);case"smooth":return this._createComponentNormalsSmooth(e,n)}}_createComponentNormalsSource(e,r,i,n){if(k(r))return this._createComponentNormalsFlat(e,n);let s=!1;if(!i.trustSourceNormals)for(let o=0;o<n.length;o+=3){this._calculateFaceNormal(e,n,o,T3);for(let a=0;a<3;a++){const l=3*n[o+a];Ul[0]=r[l+0],Ul[1]=r[l+1],Ul[2]=r[l+2],Qe(T3,Ul)<0&&(r[l+0]=-r[l+0],r[l+1]=-r[l+1],r[l+2]=-r[l+2],s=!0)}}return new pX(r,n,s)}_createComponentNormalsFlat(e,r){const i=xo(r.length),n=new Array(3*r.length);for(let s=0;s<r.length;s+=3){const o=this._calculateFaceNormal(e,r,s,T3);for(let a=0;a<3;a++)i[s+a]=o[a],n[s+a]=s/3}return new pX(i,n,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,T3);for(let l=0;l<3;l++){const c=r[o+l];let u=i[c];u||(u={normal:G(),count:0},i[c]=u),ze(u.normal,u.normal,a),u.count++}}const n=xo(3*r.length),s=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(Ye(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)n[3*o+l]=a.normal[l];s[o]=o}return new pX(n,s,!1)}_getFaceVertices(e,r,i,n,s,o){const a=3*r[i+0],l=3*r[i+1],c=3*r[i+2];n[0]=e[a+0],n[1]=e[a+1],n[2]=e[a+2],s[0]=e[l+0],s[1]=e[l+1],s[2]=e[l+2],o[0]=e[c+0],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,n){return this._getFaceVertices(e,r,i,Ul,w3,x3),Ve(w3,w3,Ul),Ve(x3,x3,Ul),Kt(Ul,w3,x3),Ye(n,Ul),n}_getOrCreateComponents(e){return br(e.components,FDt)}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const n=r.reprojection===Gd.ECEF?r.transformBeforeProject:null;if(M(n)&&(i=bDt(i,new Float64Array(i.length),n)),r.reprojection===Gd.NONE)return r.needsBufferCopy?new Float64Array(i):i;const s=M(n)?i:new Float64Array(i.length);return qs(i,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,i.length/3),s}_createNormalBuffer(e,r,i){let n=e.vertexAttributes.normal;if(k(n))return null;const s=i.reprojection===Gd.ECEF?i.transformBeforeProject:null;if(M(s)&&(n=wDt(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Gd.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=M(s)?n:new Float32Array(n.length);return vDt(n,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let n=e.vertexAttributes.tangent;if(k(n))return null;const s=i.reprojection===Gd.ECEF?i.transformBeforeProject:null;if(M(s)&&(n=xDt(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Gd.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=M(s)?n:new Float32Array(n.length);return TDt(n,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const r=this._getVertexOpacityAndColor(e),i=$4t(Oa(this.symbolLayer,"material","colorMixMode")),n=new Uint8Array(4);return mUe(r,i,n),n}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const n=e.vertexAttributes.normal,s=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(M(n)&&n.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(M(o)&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(M(s)&&s.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(r),d=this._createNormalBuffer(e,l,a),p=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:d,tangentBuffer:p,uvBuffer:s,colorBuffer:c,symbolColorBuffer:u,objectTransformation:a.reprojection===Gd.NONE&&M(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(e,l,d,p),geometryTransformation:a.reprojection===Gd.NONE&&M(a.geometryTransformation)?a.geometryTransformation:ht()}}_computeReprojectionInfo(e){const r=M(e.transform),i=r&&e.transform.geographic||this._context.renderCoordsHelper.viewingMode===wt.Local?Gd.NONE:Gd.ECEF;if(r){if(i===Gd.NONE){const s=ht();return Lm(e.spatialReference,e.transform.origin,s,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:s,geometryTransformation:eO(e.transform.localMatrix),needsBufferCopy:!1}}const n=WG(ht(),e.transform.origin);return js(n,n,e.transform.localMatrix),{reprojection:i,transformBeforeProject:n,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,n){const s=this._context.renderCoordsHelper.spatialReference,o=e.anchor;a9[0]=o.x,a9[1]=o.y,a9[2]=o.z;const a=ht();Lm(e.spatialReference,a9,a,s);const l=Pc.fromTypedArray(r);if(Ml(swe,a),cF(l,l,swe),M(i)||M(n)){if(Jf(jI,a),Kf(jI,jI),M(i)){const c=Wn.fromTypedArray(i);G2(c,c,jI)}if(M(n)){const c=Wn.fromTypedArray(n,4*n.BYTES_PER_ELEMENT);G2(c,c,jI)}}return a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,n=r.faces;if(n){let s=-1;for(let o=0;o<n.length;o++){const a=n[o];a>s&&(s=a)}if(i<=s)return this.logger.warn(`Vertex index ${s} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces?r.faces:yO(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let n;const s=r.length/3;return M(i)&&!e.spatialReference.equals(i)?(n=new Float64Array(r.length),qs(e.vertexAttributes.position,e.spatialReference,0,n,i,0,s)):n=r,qn(fX),up(fX,n,0,s),!hm(fX,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!OS(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const n=this._createBuffers(e,r);if(k(n))return null;const{positionBuffer:s,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:d,geometryTransformation:p}=n,A=this._getOrCreateComponents(e),v=new Array;let b=!1;for(const S of A){if(!this._validateFaces(e,S))return null;const E=this._getOrCreateFaces(e,S);if(E.length===0)continue;const R=this._createComponentNormals(s,c,S,E);R.didFlipNormals&&(b=!0);const O=[[z.POSITION,new Pt(s,3,!0)],[z.NORMAL,new Pt(R.normals,3,!0)]],I=[[z.POSITION,E],[z.NORMAL,R.indices]];M(a)&&(O.push([z.COLOR,new Pt(a,4,!0)]),I.push([z.COLOR,E])),M(l)&&(O.push([z.SYMBOLCOLOR,new Pt(l,4,!0)]),I.push([z.SYMBOLCOLOR,new Array(E.length).fill(0)])),M(o)&&(O.push([z.UV0,new Pt(o,2,!0)]),I.push([z.UV0,E])),M(u)&&(O.push([z.TANGENT,new Pt(u,4,!0)]),I.push([z.TANGENT,E]));const N=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),L=this._getOrCreateMaterial(e,S),B=new zo(L,O,I,null,lo.Mesh,N);B.transformation=p,v.push(B)}return b&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:v,objectTransformation:d}}}let pX=class{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}};const a9=G(),Ul=G(),w3=G(),x3=G(),T3=G(),swe=ht(),jI=Es(),fX=fa(),FDt=[new _Dt];var Gd;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(Gd||(Gd={}));let kDt=class{constructor(e,r,i,n){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){Sde(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>TP(o,e,this.elevationContext,r,a),s=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r);M(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(e=G()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,dg),Ot(e,this._lodRenderer.baseBoundingSphere.center,dg)}getBoundingBoxObjectSpace(e=fa()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,dg);const r=this._lodRenderer.baseBoundingBox;qn(e);for(let i=0;i<8;++i)Le(kp,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),Ot(kp,kp,dg),kA(e,kp);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,dg),e.render.origin[0]+=dg[12],e.render.origin[1]+=dg[13],e.render.origin[2]+=dg[14],e.render.num++}async getProjectedBoundingBox(e,r,i,n,s){const o=this.getBoundingBoxObjectSpace(s),a=UDt,l=oce(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,dg);for(let u=0;u<l;u++){const d=a[u];kp[0]=o[d[0]],kp[1]=o[d[1]],kp[2]=o[d[2]],Ot(kp,kp,dg),Yw[3*u+0]=kp[0],Yw[3*u+1]=kp[1],Yw[3*u+2]=kp[2]}if(!e(Yw,0,l))return null;qn(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],Yw[u+d]),o[d+3]=Math.max(o[d+3],Yw[u+d]);c&&i.push({location:Yw.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&(um(o,mX),this.elevationContext.mode!=="absolute-height")){let u;const d=wde(o,r.service.spatialReference,r);try{u=await r.service.queryElevation(mX[0],mX[1],n,d,"ground")}catch{}M(u)&&aIe(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,r){if(e===l1.Highlight){const i=new _z(e);this._addHighlightId(i),r.addExternal(n=>{this._removeHighlightId(n)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const Yw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],kp=G(),mX=G(),UDt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],dg=ht();function BDt(t){const e=new Array;return t.stageResources.geometries.forEach(r=>{const i=t.stageResources.textures;e.push(new K7e(r,i))}),{components:e,minScreenSpaceRadius:br(t.lodThreshold,0),pivotOffset:t.pivotOffset}}function zDt(t){return{levels:t.map(e=>BDt(e))}}function VDt(t,e,r){if(t.count!==e.count)return void cH.error("source and destination buffers need to have the same number of elements");const i=t.count,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],d=r[7],p=r[8],A=r[9],v=r[10],b=r[11],S=r[12],E=r[13],R=r[14],O=r[15],I=t.typedBuffer,N=t.typedBufferStride,L=e.typedBuffer,B=e.typedBufferStride;for(let U=0;U<i;U++){const q=U*N,Z=U*B,X=L[Z],ee=L[Z+1],se=L[Z+2],ue=L[Z+3];I[q]=n*X+l*ee+p*se+S*ue,I[q+1]=s*X+c*ee+A*se+E*ue,I[q+2]=o*X+u*ee+v*se+R*ue,I[q+3]=a*X+d*ee+b*se+O*ue}}function qUe(t,e,r){if(t.count!==e.count)return void cH.error("source and destination buffers need to have the same number of elements");const i=t.count,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],d=r[7],p=r[8],A=t.typedBuffer,v=t.typedBufferStride,b=e.typedBuffer,S=e.typedBufferStride;for(let E=0;E<i;E++){const R=E*v,O=E*S,I=b[O],N=b[O+1],L=b[O+2],B=b[O+3];A[R]=n*I+a*N+u*L,A[R+1]=s*I+l*N+d*L,A[R+2]=o*I+c*N+p*L,A[R+3]=B}}function GDt(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*n,c=a*o,u=s[c],d=s[c+1],p=s[c+2],A=u*u+d*d+p*p;if(A>0){const v=1/Math.sqrt(A);i[l]=v*u,i[l+1]=v*d,i[l+2]=v*p}}}function ise(t,e,r){const i=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<i;l++){const c=l*s,u=l*a;n[c]=r*o[u],n[c+1]=r*o[u+1],n[c+2]=r*o[u+2],n[c+3]=r*o[u+3]}}function jDt(t,e,r){const i=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<i;l++){const c=l*s,u=l*a;n[c]=o[u]>>r,n[c+1]=o[u+1]>>r,n[c+2]=o[u+2]>>r,n[c+3]=o[u+3]>>r}}Object.freeze(Object.defineProperty({__proto__:null,normalize:GDt,scale:ise,shiftRight:jDt,transformMat3:qUe,transformMat4:VDt},Symbol.toStringTag,{value:"Module"}));function HDt(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let u=0;u<a;++u){for(let d=0;d<9;++d)i[l+d]=s[c+d];l+=n,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:HDt},Symbol.toStringTag,{value:"Module"}));function qDt(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let u=0;u<a;++u){for(let d=0;d<16;++d)i[l+d]=s[c+d];l+=n,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:qDt},Symbol.toStringTag,{value:"Module"}));function WDt(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let u=0;u<a;++u)i[l]=s[c],l+=n,c+=o}function aU(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,copy:WDt,makeDense:aU},Symbol.toStringTag,{value:"Module"}));function WUe(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let u=0;u<a;++u)i[l]=s[c],i[l+1]=s[c+1],l+=n,c+=o}function QUe(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;if(mTt(e.elementType)){const u=gTt(e.elementType);if(fTt(e.elementType))for(let d=0;d<a;++d)i[l]=Math.max(s[c]/u,-1),i[l+1]=Math.max(s[c+1]/u,-1),l+=n,c+=o;else for(let d=0;d<a;++d)i[l]=s[c]/u,i[l+1]=s[c+1]/u,l+=n,c+=o}else WUe(t,e,r);return t}function QDt(t,e,r,i){const n=t.typedBuffer,s=t.typedBufferStride,o=(i==null?void 0:i.count)??t.count;let a=((i==null?void 0:i.dstIndex)??0)*s;for(let l=0;l<o;++l)n[a]=e,n[a+1]=r,a+=s}Object.freeze(Object.defineProperty({__proto__:null,copy:WUe,fill:QDt,normalizeIntegerBuffer:QUe},Symbol.toStringTag,{value:"Module"}));function vH(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let u=0;u<a;++u)i[l]=s[c],i[l+1]=s[c+1],i[l+2]=s[c+2],l+=n,c+=o}function YDt(t,e,r,i,n){const s=t.typedBuffer,o=t.typedBufferStride,a=(n==null?void 0:n.count)??t.count;let l=((n==null?void 0:n.dstIndex)??0)*o;for(let c=0;c<a;++c)s[l]=e,s[l+1]=r,s[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:vH,fill:YDt},Symbol.toStringTag,{value:"Module"}));function YUe(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let u=0;u<a;++u)i[l]=s[c],i[l+1]=s[c+1],i[l+2]=s[c+2],i[l+3]=s[c+3],l+=n,c+=o}function XUe(t,e,r,i,n,s){const o=t.typedBuffer,a=t.typedBufferStride,l=(s==null?void 0:s.count)??t.count;let c=((s==null?void 0:s.dstIndex)??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=n,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:YUe,fill:XUe},Symbol.toStringTag,{value:"Module"}));function TT(t,e){return new t(new ArrayBuffer(e*t.ElementCount*Y6e(t.ElementType)))}let ZUe=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return YA(e)?(fi(r),ule(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(k(this._streamDataRequester))return(await ns(r,{responseType:XDt[e]})).data;const n=await Pm(this._streamDataRequester.request(r,e,i));if(n.ok===!0)return n.value;throw Jh(n.error),new pe("",`Request for resource failed: ${n.error}`)}};const XDt={image:"image",binary:"array-buffer",json:"json"};function ZDt(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function JDt(t,e={}){return{data:t,parameters:{wrap:{s:Ar.REPEAT,t:Ar.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let MO=class{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new pe(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new MO(this.major,this.minor,this._context)}static parse(e,r=""){const[i,n]=e.split("."),s=/^\s*\d+\s*$/;if(!i||!i.match||!i.match(s))throw new pe((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!n||!n.match||!n.match(s))throw new pe((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(n,10);return new MO(o,a,r)}},owe=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var tD,awe;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(tD||(tD={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(awe||(awe={}));const JUe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},KDt={pbrMetallicRoughness:JUe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},eLt={ESRI_externalColorMixMode:"tint"},lwe=(t={})=>{const e={...JUe,...t.pbrMetallicRoughness},r=tLt({...eLt,...t.extras});return{...KDt,...t,pbrMetallicRoughness:e,extras:r}};function tLt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const rLt={magFilter:zt.LINEAR,minFilter:zt.LINEAR_MIPMAP_LINEAR,wrapS:Ar.REPEAT,wrapT:Ar.REPEAT},iLt=t=>({...rLt,...t});function nLt(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,n,s)=>(e=n||"",r=s||"","")),{dirPart:e,filePart:r}}const l9={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let sLt=class sb{constructor(e,r,i,n){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=n,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=nLt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new pe("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new pe("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new pe("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(YA(r)){const o=TN(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new sb(e,r,l)}catch{}const a=ule(r);if(sb._isGLBData(a))return this._fromGLBData(e,r,a)}if(r.endsWith(".gltf")){const o=await e.loadJSON(r,i);return new sb(e,r,o)}const n=await e.loadBinary(r,i);if(sb._isGLBData(n))return this._fromGLBData(e,r,n);const s=await e.loadJSON(r,i);return new sb(e,r,s)}static _isGLBData(e){if(e==null)return!1;const r=new owe(e);return r.remainingBytes()>=4&&r.readUint32()===l9.MAGIC}static async _fromGLBData(e,r,i){const n=await sb._parseGLBData(i);return new sb(e,r,n.json,n.binaryData)}static async _parseGLBData(e){const r=new owe(e);if(r.remainingBytes()<12)throw new pe("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),n=r.readUint32(),s=r.readUint32();if(i!==l9.MAGIC)throw new pe("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<s)throw new pe("gltf-loader-error","GLB binary data is smaller than header specifies.");if(n!==2)throw new pe("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),u=r.readUint32();if(l===0){if(u!==l9.CHUNK_TYPE_JSON)throw new pe("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new pe("gltf-loader-error","No JSON data found.");o=await EDt(r.readUint8Array(c))}else if(l===1){if(u!==l9.CHUNK_TYPE_BIN)throw new pe("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else we.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new pe("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new pe("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const n=await this._getBufferLoader(e,r);if(n.byteLength!==i.byteLength)throw new pe("gltf-loader-error","Buffer byte lengths should match.");return n}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const n=this.json.buffers[e].uri,s=this._context.loadBinary(this._resolveUri(n),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,s),s}async getAccessor(e,r){if(!this.json.accessors)throw new pe("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if((i==null?void 0:i.bufferView)==null)throw new pe("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[tD.MAT2,tD.MAT3,tD.MAT4])throw new pe("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const n=this.json.bufferViews[i.bufferView],s=await this.getBuffer(n.buffer,r),o=lLt[i.type],a=cLt[i.componentType],l=o*a,c=n.byteStride||l;return{raw:s.buffer,byteStride:c,byteOffset:s.byteOffset+(n.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case Yt.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case Yt.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case Yt.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case Yt.UNSIGNED_BYTE:return aU(this._wrapAccessor(AO,i));case Yt.UNSIGNED_SHORT:return aU(this._wrapAccessor(kj,i));case Yt.UNSIGNED_INT:return aU(this._wrapAccessor(Bj,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new pe("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==Yt.FLOAT)throw new pe("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Yt[i.componentType]);if(i.componentCount!==3)throw new pe("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(Wn,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new pe("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==Yt.FLOAT)throw new pe("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Yt[i.componentType]);if(i.componentCount!==3)throw new pe("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(Wn,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new pe("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==Yt.FLOAT)throw new pe("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Yt[i.componentType]);if(i.componentCount!==4)throw new pe("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new Ad(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new pe("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new pe("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===Yt.FLOAT)return this._wrapAccessor(O1,i);if(!i.normalized)throw new pe("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return uLt(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new pe("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new pe("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===Yt.FLOAT)return this._wrapAccessor(Ad,i);if(i.componentType===Yt.UNSIGNED_BYTE)return this._wrapAccessor(Ic,i);if(i.componentType===Yt.UNSIGNED_SHORT)return this._wrapAccessor(eF,i)}else if(i.componentCount===3){if(i.componentType===Yt.FLOAT)return this._wrapAccessor(Wn,i);if(i.componentType===Yt.UNSIGNED_BYTE)return this._wrapAccessor(bL,i);if(i.componentType===Yt.UNSIGNED_SHORT)return this._wrapAccessor(Uj,i)}throw new pe("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Yt[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){var s,o,a,l,c,u,d,p,A,v;let n=e.material?this._materialCache.get(e.material):void 0;if(!n){const b=e.material!=null?lwe(this.json.materials[e.material]):lwe(),S=b.pbrMetallicRoughness,E=this.hasVertexColors(e),R=this.getTexture(S.baseColorTexture,r),O=this.getTexture(b.normalTexture,r),I=i?this.getTexture(b.occlusionTexture,r):void 0,N=i?this.getTexture(b.emissiveTexture,r):void 0,L=i?this.getTexture(S.metallicRoughnessTexture,r):void 0,B=e.material!=null?e.material:-1;n={alphaMode:b.alphaMode,alphaCutoff:b.alphaCutoff,color:S.baseColorFactor,doubleSided:!!b.doubleSided,colorTexture:await R,normalTexture:await O,name:b.name,id:B,occlusionTexture:await I,emissiveTexture:await N,emissiveFactor:b.emissiveFactor,metallicFactor:S.metallicFactor,roughnessFactor:S.roughnessFactor,metallicRoughnessTexture:await L,hasVertexColors:E,ESRI_externalColorMixMode:b.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(s=S==null?void 0:S.baseColorTexture)==null?void 0:s.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=b.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(u=(c=b.occlusionTexture)==null?void 0:c.extensions)==null?void 0:u.KHR_texture_transform,emissiveTextureTransform:(p=(d=b.emissiveTexture)==null?void 0:d.extensions)==null?void 0:p.KHR_texture_transform,metallicRoughnessTextureTransform:(v=(A=S==null?void 0:S.metallicRoughnessTexture)==null?void 0:A.extensions)==null?void 0:v.KHR_texture_transform}}return n}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new pe("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,n=this.json.textures[i],s=iLt(n.sampler!=null?this.json.samplers[n.sampler]:{}),o=this._getTextureSourceId(n),a=this.json.images[o],l=await this._loadTextureImageData(i,n,r);return Xae(this._textureCache,i,()=>{const c=d=>d===33071||d===33648||d===10497,u=d=>{throw new pe("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(s.wrapS)?s.wrapS:u(s.wrapS),wrapT:c(s.wrapT)?s.wrapT:u(s.wrapT),minFilter:s.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return oLt;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),n=this.json.nodes[e];n.matrix?r=js(ht(),i,n.matrix):n.translation||n.rotation||n.scale?(r=eO(i),n.translation&&Ah(r,r,n.translation),n.rotation&&(c9[3]=Ihe(c9,n.rotation),sd(r,r,c9[3],c9)),n.scale&&HG(r,r,n.scale)):r=eO(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return np(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=MO.parse(this.json.asset.version,"glTF");aLt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new pe("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const n=this._textureLoaders.get(e);if(n)return n;const s=this._createTextureLoader(r,i);return this._textureLoaders.set(e,s),s}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new pe("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),n=this.json.images[i];if(n.uri){if(n.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(n.uri),r);return new GUe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(n.uri),r)}if(n.bufferView==null)throw new pe("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(n.mimeType==null)throw new pe("gltf-loader-unsupported-feature","Image mimeType must be defined.");const s=this.json.bufferViews[n.bufferView],o=await this.getBuffer(s.buffer,r);if(s.byteStride!=null)throw new pe("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(s.byteOffset||0);return CDt(new Uint8Array(o.buffer,a,s.byteLength),n.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await QJ(Array.from(this._bufferLoaders.values())),r=await QJ(Array.from(this._textureLoaders.values()));return e.reduce((i,n)=>i+((n==null?void 0:n.byteLength)??0),0)+r.reduce((i,n)=>i+(n?lS(n)?n.data.byteLength:n.width*n.height*4:0),0)}};const oLt=WIe(ht(),Math.PI/2),aLt=new MO(2,0,"glTF"),c9=n0(),lLt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},cLt={[Yt.BYTE]:1,[Yt.UNSIGNED_BYTE]:1,[Yt.SHORT]:2,[Yt.UNSIGNED_SHORT]:2,[Yt.FLOAT]:4,[Yt.UNSIGNED_INT]:4};function uLt(t){switch(t.componentType){case Yt.BYTE:return new zj(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Yt.UNSIGNED_BYTE:return new Fj(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Yt.SHORT:return new Vj(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Yt.UNSIGNED_SHORT:return new Mhe(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Yt.UNSIGNED_INT:return new Rhe(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Yt.FLOAT:return new O1(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let hLt=0;async function KUe(t,e,r={},i=!0){const n=await sLt.load(t,e,r),s="gltf_"+hLt++,o={lods:[],materials:new Map,textures:new Map,meta:dLt(n)},a=!(!n.json.asset.extras||n.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await pLt(n,async(u,d,p,A)=>{const v=l.get(p)??0;l.set(p,v+1);const b=u.mode!==void 0?u.mode:wr.TRIANGLES,S=b===wr.TRIANGLES||b===wr.TRIANGLE_STRIP||b===wr.TRIANGLE_FAN?b:null;if(k(S))return void we.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+wr[b]+"). Skipping primitive.");if(!n.hasPositions(u))return void we.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const E=n.getPositionData(u,r),R=n.getMaterial(u,r,i),O=n.hasNormals(u)?n.getNormalData(u,r):null,I=n.hasTangents(u)?n.getTangentData(u,r):null,N=n.hasTextureCoordinates(u)?n.getTextureCoordinates(u,r):null,L=n.hasVertexColors(u)?n.getVertexColors(u,r):null,B=n.getIndexData(u,r),U={transform:eO(d),attributes:{position:await E,normal:O?await O:null,texCoord0:N?await N:null,color:L?await L:null,tangent:I?await I:null},indices:await B,primitiveType:S,material:mLt(o,await R,s)};let q=null;M(o.meta)&&M(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(q=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:A,lodThreshold:q},o.lods[p].parts[v]=U});for(const u of o.lods)u.parts=u.parts.filter(d=>!!d);const c=await n.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:n.uri},customMeta:{},size:c}}function dLt(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const n=i.extras;M(n)&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(r=n)}),r}async function pLt(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,n=i.length>1,s=[];for(const a of i){const l=r.nodes[a];s.push(o(a,0)),fLt(l)&&!n&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=r.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&we.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=r.meshes[c.mesh];for(const p of d.primitives)s.push(e(p,u,l,d.name))}for(const d of c.children||[])s.push(o(d,l))}await Promise.all(s)}function fLt(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function mLt(t,e,r){const i=s=>{const o=`${r}_tex_${s&&s.id}${s&&s.name?"_"+s.name:""}`;if(s&&!t.textures.has(o)){const a=JDt(s.data,{wrap:{s:s.wrapS,t:s.wrapT},mipmap:gLt.includes(s.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},n=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(n)){const s=ZDt({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(n,s)}return n}const gLt=[zt.LINEAR_MIPMAP_LINEAR,zt.LINEAR_MIPMAP_NEAREST];function ALt(t,e=yO){return typeof t=="number"?e(t):Uae(t)||hT(t)?new Uint32Array(t):t}function yLt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=t8e(r);if(typeof t=="number"){let n=0;for(let s=0;s<r;s+=1)s%2==0?(i[n++]=s,i[n++]=s+1,i[n++]=s+2):(i[n++]=s+1,i[n++]=s,i[n++]=s+2)}else{let n=0;for(let s=0;s<r;s+=1)if(s%2==0){const o=t[s],a=t[s+1],l=t[s+2];i[n++]=o,i[n++]=a,i[n++]=l}else{const o=t[s+1],a=t[s],l=t[s+2];i[n++]=o,i[n++]=a,i[n++]=l}}return i}function _Lt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let n=0;for(let s=0;s<r;++s)i[n++]=0,i[n++]=s+1,i[n++]=s+2;return i}{const n=t[0];let s=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=n,i[o++]=s,i[o++]=l,s=l}return i}}let vLt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},bLt=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new vLt,this.numberOfVertices=0}};const r_=we.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function eBe(t,e){const r=await wLt(t,e),i=await CLt(r.textureDefinitions??{},e);let n=0;for(const s in i)if(i.hasOwnProperty(s)){const o=i[s];n+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:n+C$e(r)}}async function wLt(t,e){const r=M(e)&&e.streamDataRequester;if(r)return xLt(t,r,e);const i=await Pm(ns(t,e));if(i.ok===!0)return i.value.data;Jh(i.error),tBe(i.error)}async function xLt(t,e,r){const i=await Pm(e.request(t,"json",r));if(i.ok===!0)return i.value;Jh(i.error),tBe(i.error.details.url)}function tBe(t){throw new pe("",`Request for object resource failed: ${t}`)}function TLt(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(r_.warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=e.faces;if(s){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=s[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(r_.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(r_.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(r_.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else r_.warn("Indexed geometries must specify faces"),i=!1;break}default:r_.warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(r_.warn("Geometry requires material"),i=!1);const n=t.params.vertexAttributes;for(const s in n)n[s].values||(r_.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function SLt(t,e){const r=new Array,i=new Array,n=new Array,s=new yP,o=t.resource,a=MO.parse(o.version||"1.0","wosr");RLt.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},d=t.textures;let p=0;const A=new Map;for(let v=0;v<c.length;v++){const b=c[v];if(!TLt(b))continue;const S=MLt(b),E=b.params.vertexAttributes,R=[];for(const X in E){const ee=E[X],se=ee.values;R.push([X,new Pt(se,ee.valuesPerElement,!0)])}const O=[];if(b.params.topology!=="PerAttributeArray"){const X=b.params.faces;for(const ee in X)O.push([ee,X[ee].values])}const I=S.texture,N=d&&d[I];if(N&&!A.has(I)){const{image:X,params:ee}=N,se=new ME(X,ee);i.push(se),A.set(I,se)}const L=A.get(I),B=L?L.id:void 0,U=S.material;let q=s.get(U,I);if(k(q)){const X=u[U.substring(U.lastIndexOf("/")+1)].params;X.transparency===1&&(X.transparency=0);const ee=N&&N.alphaChannelUsage,se=X.transparency>0||ee==="transparency"||ee==="maskAndTransparency",ue=N?rBe(N.alphaChannelUsage):void 0,re={ambient:sh(X.diffuse),diffuse:sh(X.diffuse),opacity:1-(X.transparency||0),transparent:se,textureAlphaMode:ue,textureAlphaCutoff:.33,textureId:B,initTextureTransparent:!0,doubleSided:!0,cullFace:Vn.None,colorMixMode:X.externalColorMixMode||"tint",textureAlphaPremultiplied:!!N&&!!N.params.preMultiplyAlpha};M(e)&&e.materialParamsMixin&&Object.assign(re,e.materialParamsMixin),q=new d1(re),s.set(U,I,q)}n.push(q);const Z=new zo(q,R,O);p+=O.position?O.position.length:0,r.push(Z)}return{engineResources:[{name:l,stageResources:{textures:i,materials:n,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:ELt(r)}}function ELt(t){const e=qn();return t.forEach(r=>{const i=r.boundingInfo;M(i)&&(kA(e,i.bbMin),kA(e,i.bbMax))}),e}async function CLt(t,e){const r=[];for(const s in t){const o=t[s],a=o.images[0].data;if(!a){r_.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+s,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:Ar.REPEAT,t:Ar.REPEAT},preMultiplyAlpha:rBe(u)!==xn.Opaque},p=M(e)&&e.disableTextures?Promise.resolve(null):u1(l,e);r.push(p.then(A=>({refId:c,image:A,params:d,alphaChannelUsage:u})))}const i=await Promise.all(r),n={};for(const s of i)n[s.refId]=s;return n}function rBe(t){switch(t){case"mask":return xn.Mask;case"maskAndTransparency":return xn.MaskBlend;case"none":return xn.Opaque;default:return xn.Blend}}function MLt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const RLt=new MO(1,2,"wosr"),S3=2.1;async function iBe(t,e){const r=nBe(obt(t));if(r.fileType==="wosr"){const d=await(e.cache?e.cache.loadWOSR(r.url,e):eBe(r.url,e)),{engineResources:p,referenceBoundingBox:A}=SLt(d,e);return{lods:p,referenceBoundingBox:A,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):KUe(new ZUe(e.streamDataRequester),r.url,e,e.usePBR)),n=Oa(i.model.meta,"ESRI_proxyEllipsoid"),s=i.meta.isEsriSymbolResource&&M(n)&&i.meta.uri.includes("/RealisticTrees/");s&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,DLt(i,n));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:s,mrrFactors:[0,1,.2]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},l={...e.materialParamsMixin,treeRendering:s},{engineResources:c,referenceBoundingBox:u}=sBe(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function nBe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function sBe(t,e,r,i){const n=t.model,s=new Array,o=new Map,a=new Map,l=n.lods.length,c=qn();return n.lods.forEach((u,d)=>{const p=i.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&d!==i.singleLodIndex;if(p&&d!==0)return;const A=new bLt(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(v=>{const b=p?new d1({}):OLt(n,v,A,e,r,o,a),{geometry:S,vertexCount:E}=PLt(v,M(b)?b:new d1({})),R=S.boundingInfo;M(R)&&d===0&&(kA(c,R.bbMin),kA(c,R.bbMax)),M(b)&&(A.stageResources.geometries.push(S),A.numberOfVertices+=E)}),p||s.push(A)}),{engineResources:s,referenceBoundingBox:c}}function OLt(t,e,r,i,n,s,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=M(e.attributes.texCoord0),u=M(e.attributes.normal);if(k(l))return null;const d=ILt(l.alphaMode);if(!s.has(a)){if(c){const I=(N,L=!1)=>{if(M(N)&&!o.has(N)){const B=t.textures.get(N);if(M(B)){const U=B.data;o.set(N,new ME(lS(U)?U.data:U,{...B.parameters,preMultiplyAlpha:!lS(U)&&L,encoding:lS(U)&&M(U.encoding)?U.encoding:void 0}))}}};I(l.textureColor,d!==xn.Opaque),I(l.textureNormal),I(l.textureOcclusion),I(l.textureEmissive),I(l.textureMetallicRoughness)}const A=l.color[0]**(1/S3),v=l.color[1]**(1/S3),b=l.color[2]**(1/S3),S=l.emissiveFactor[0]**(1/S3),E=l.emissiveFactor[1]**(1/S3),R=l.emissiveFactor[2]**(1/S3),O=M(l.textureColor)&&c?o.get(l.textureColor):null;s.set(a,new d1({...i,transparent:d===xn.Blend,customDepthTest:BS.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[A,v,b],ambient:[A,v,b],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Vn.None:Vn.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?An.Attribute:An.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:M(O)?O.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:M(l.textureNormal)&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:M(O)&&!!O.params.preMultiplyAlpha,occlusionTextureId:M(l.textureOcclusion)&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:M(l.textureEmissive)&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:M(l.textureMetallicRoughness)&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[S,E,R],mrrFactors:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:sA(l.colorTextureTransform),normalTextureTransformMatrix:sA(l.normalTextureTransform),occlusionTextureTransformMatrix:sA(l.occlusionTextureTransform),emissiveTextureTransformMatrix:sA(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:sA(l.metallicRoughnessTextureTransform),...n}))}const p=s.get(a);if(r.stageResources.materials.push(p),c){const A=v=>{M(v)&&r.stageResources.textures.push(o.get(v))};A(l.textureColor),A(l.textureNormal),A(l.textureOcclusion),A(l.textureEmissive),A(l.textureMetallicRoughness)}return p}function PLt(t,e){const r=t.attributes.position.count,i=$Lt(t.indices||r,t.primitiveType),n=TT(Wn,r);cF(n,t.attributes.position,t.transform);const s=[[z.POSITION,new Pt(n.typedBuffer,n.elementCount,!0)]],o=[[z.POSITION,i]];if(M(t.attributes.normal)){const a=TT(Wn,r);gO(u9,t.transform),G2(a,t.attributes.normal,u9),s.push([z.NORMAL,new Pt(a.typedBuffer,a.elementCount,!0)]),o.push([z.NORMAL,i])}if(M(t.attributes.tangent)){const a=TT(Ad,r);gO(u9,t.transform),qUe(a,t.attributes.tangent,u9),s.push([z.TANGENT,new Pt(a.typedBuffer,a.elementCount,!0)]),o.push([z.TANGENT,i])}if(M(t.attributes.texCoord0)){const a=TT(O1,r);QUe(a,t.attributes.texCoord0),s.push([z.UV0,new Pt(a.typedBuffer,a.elementCount,!0)]),o.push([z.UV0,i])}if(M(t.attributes.color)){const a=TT(Ic,r);if(t.attributes.color.elementCount===4)t.attributes.color instanceof Ad?ise(a,t.attributes.color,255):t.attributes.color instanceof Ic?YUe(a,t.attributes.color):t.attributes.color instanceof eF&&ise(a,t.attributes.color,1/256);else{XUe(a,255,255,255,255);const l=new bL(a.buffer,0,4);t.attributes.color instanceof Wn?Vne(l,t.attributes.color,255):t.attributes.color instanceof bL?vH(l,t.attributes.color):t.attributes.color instanceof Uj&&Vne(l,t.attributes.color,1/256)}s.push([z.COLOR,new Pt(a.typedBuffer,a.elementCount,!0)]),o.push([z.COLOR,i])}return{geometry:new zo(e,s,o),vertexCount:r}}const u9=Es();function ILt(t){switch(t){case"BLEND":return xn.Blend;case"MASK":return xn.Mask;case"OPAQUE":case null:case void 0:return xn.Opaque}}function $Lt(t,e){switch(e){case wr.TRIANGLES:return ALt(t);case wr.TRIANGLE_STRIP:return yLt(t);case wr.TRIANGLE_FAN:return _Lt(t)}}function DLt(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const n of i.parts){const s=n.attributes.normal;if(k(s))return;const o=n.attributes.position,a=o.count,l=G(),c=G(),u=G(),d=TT(Ic,a),p=TT(Wn,a),A=Ml(ht(),n.transform);for(let v=0;v<a;v++){o.getVec(v,c),s.getVec(v,l),Ot(c,c,n.transform),Ve(u,c,e.center),xB(u,u,e.radius);const b=u[2],S=ct(u),E=Math.min(.45+.55*S*S,1);xB(u,u,e.radius),A!==null&&Ot(u,u,A),Ye(u,u),r+1!==t.model.lods.length&&t.model.lods.length>1&&Eo(u,u,l,b>-1?.2:Math.min(-4*b-3.8,1)),p.setVec(v,u),d.set(v,0,255*E),d.set(v,1,255*E),d.set(v,2,255*E),d.set(v,3,255)}n.attributes.normal=p,n.attributes.color=d}}}const egr=Object.freeze(Object.defineProperty({__proto__:null,fetch:iBe,gltfToEngineResources:sBe,parseUrl:nBe},Symbol.toStringTag,{value:"Module"}));var os;function LLt(t){let e=Cs().mat4f64(z.LOCALTRANSFORM).mat4f64(z.GLOBALTRANSFORM).vec4f64(z.BOUNDINGSPHERE).vec3f64(z.MODELORIGIN).mat3f(z.MODEL).mat3f(z.MODELNORMAL).vec2f(z.MODELSCALEFACTORS);return t.includes("color")&&(e=e.vec4f(z.COLOR)),t.includes("featureAttribute")&&(e=e.vec4f(z.FEATUREATTRIBUTE)),e=e.u8(z.STATE).u8(z.LODLEVEL),t.includes(z.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(z.OBJECTANDLAYERIDCOLOR)),e.alignTo(8),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(os||(os={}));let NLt=class{constructor(e){this.localTransform=e.getField(z.LOCALTRANSFORM,vL),this.globalTransform=e.getField(z.GLOBALTRANSFORM,vL),this.modelOrigin=e.getField(z.MODELORIGIN,Pc),this.model=e.getField(z.MODEL,F2),this.modelNormal=e.getField(z.MODELNORMAL,F2),this.modelScaleFactors=e.getField(z.MODELSCALEFACTORS,O1),this.boundingSphere=e.getField(z.BOUNDINGSPHERE,Nj),this.color=e.getField(z.COLOR,Ad),this.featureAttribute=e.getField(z.FEATUREATTRIBUTE,Ad),this.state=e.getField(z.STATE,AO),this.lodLevel=e.getField(z.LODLEVEL,AO),this.objectAndLayerIdColor=e.getField(z.OBJECTANDLAYERIDCOLOR,Ic)}},GC=class extends rt{constructor(e,r){super(e),this.events=new Ws,this._capacity=0,this._size=0,this._next=0,this._buffer=null,this._view=null,this._layout=LLt(r)}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,os.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;tr(e>=0&&e<this._capacity&&(r.get(e)&os.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,os.ACTIVE)?this._setStateFlags(e,os.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;tr(e>=0&&e<this._capacity&&(r.get(e)&os.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=pv,n=g0;r.localTransform.getMat(e,cwe),r.globalTransform.getMat(e,gX);const s=js(gX,gX,cwe);Le(i,s[12],s[13],s[14]),r.modelOrigin.setVec(e,i),Jf(n,s),r.model.setMat(e,n);const o=Ilt(pv,s);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),SE(n,n),Kf(n,n),r.modelNormal.setMat(e,n),this._setStateFlags(e,os.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,g0),i.modelOrigin.getVec(e,pv),r[0]=g0[0],r[1]=g0[1],r[2]=g0[2],r[3]=0,r[4]=g0[3],r[5]=g0[4],r[6]=g0[5],r[7]=0,r[8]=g0[6],r[9]=g0[7],r[10]=g0[8],r[11]=0,r[12]=pv[0],r[13]=pv[1],r[14]=pv[2],r[15]=1}applyShaderTransformation(e,r){M(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),M(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){return this._view.localTransform.getMat(e,r),M(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);if(M(this.shaderTransformation)){const i=this.shaderTransformation.scaleFactor(pv,this,e);r*=Math.max(i[0],i[1],i[2])}return r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);if(M(this.shaderTransformation)){const i=this.shaderTransformation.scaleFactor(pv,this,e);r*=FLt(i[0],i[1],i[2])}return r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}getColor(e,r){this._view.color.getVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,os.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,os.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,os.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,os.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){const e=Math.max(kLt,Math.floor(this._capacity*ULt)),r=this._layout.createBuffer(e);if(this._buffer){const i=new Uint8Array(this._buffer.buffer);new Uint8Array(r.buffer).set(i)}this._capacity=e,this._buffer=r,this._view=new NLt(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&os.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function FLt(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}h([f({constructOnly:!0})],GC.prototype,"shaderTransformation",void 0),h([f()],GC.prototype,"_size",void 0),h([f({readOnly:!0})],GC.prototype,"size",null),GC=h([Q("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],GC);const kLt=1024,ULt=2,pv=G(),g0=Es(),cwe=ht(),gX=ht();let BLt=class extends gm{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=Ho(),this._tmpMat4=ht(),this._instanceData=e,this._boundingSphere=r}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Ot(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*$S(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},zLt=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const n=i.computeScreenPixelSizeAt(e),s=this._worldSpaceRadius*r/n;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)s>=this._minScreenSpaceRadii[a]&&(o=a);return o}},VLt=class extends Gj{constructor(e,r,i,n,s,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=n,this.baseBoundingSphere=s,this.numLodLevels=o}};function Xde(t){return qm(t)&&t.intersector===ws.LOD&&!!t.target}let GLt=class{constructor(e,r){const i=e.renderContext.rctx,n=r.geometry;this._materialRepository=e.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});const s=n.material.createBufferWriter(),o=s.vertexBufferLayout,a=s.elementCount(n),l=s.allocate(a);s.write(null,null,n,l,0),this.geometry=n,this.material=n.material,this.glMaterials=new Vke(n.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Ji.createVertex(i,ki.STATIC_DRAW,l.buffer),this.vao=new Hm(i,Di,{geometry:wd(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,n,s,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,n,(u,d,p,A,v)=>{if(u>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,u))return;const b=new VLt(o.layerUid,o.graphicUid(s),c,p,a,l);if((e.results.min.drapedLayerOrder==null||v>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(ws.LOD,b,u,d,e.transform.transform,v),e.options.store!==Ol.MIN&&(e.results.max.drapedLayerOrder==null||v>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(ws.LOD,b,u,d,e.transform.transform,v),e.options.store===Ol.ALL){const S=Uhe(e.results.min.ray);S.set(ws.LOD,b,u,d,e.transform.transform,v),e.results.all.push(S)}}})}},jLt=class oBe{static async create(e,r,i){const n=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new GLt(e,o),i))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(M);if(Ra(i)||s.length!==n.length){s.forEach(o=>o.destroy()),fi(i);for(const o of n)if(o.status==="rejected")throw o.reason}return new oBe(r.minScreenSpaceRadius,s)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,n,s,o,a){this.components.forEach(l=>l.intersect(e,r,i,n,s,o,this.boundingSphere,a))}get boundingBox(){if(k(this._boundingBox)){const e=qn();this.components.forEach(r=>{M(r.boundingInfo)&&(kA(e,r.boundingInfo.bbMin),kA(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(k(this._boundingSphere)){const e=this.boundingBox,r=G();um(e,r),this._boundingSphere={center:r,radius:.5*oIe(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}},HLt=class{constructor(e,r,i){this._elementSize=r,this._buffer=Ji.createVertex(e,ki.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,r,i,n=0){const s=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,n=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,n)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},qLt=class{constructor(e){this.modelOriginHi=e.getField(z.MODELORIGINHI,Wn),this.modelOriginLo=e.getField(z.MODELORIGINLO,Wn),this.model=e.getField(z.MODEL,F2),this.modelNormal=e.getField(z.MODELNORMAL,F2),this.color=e.getField(z.INSTANCECOLOR,Ad),this.featureAttribute=e.getField(z.INSTANCEFEATUREATTRIBUTE,Ad),this.objectAndLayerIdColor=e.getField(z.OBJECTANDLAYERIDCOLOR_INSTANCED,Ic)}},uwe=class{constructor(e,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){tr(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){tr(this._updating,"not updating"),this.size<QLt*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){tr(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),tr(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){tr(this._updating,"not updating"),tr(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(hwe,Math.floor(this._capacity*WLt));this._resize(e)}_shrink(){const e=Math.max(hwe,Math.floor(this._capacity*YLt));this._resize(e)}_resize(e){if(tr(this._updating,"not updating"),e===this._capacity)return;const r=new HLt(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,n=this._compactInstances(r);tr(n===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new qLt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const hwe=1024,WLt=2,QLt=.3,YLt=.5,XLt=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new zLt(e,r)};let of=class extends rt{constructor(e,r){super(e),this.type=ws.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new mr,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[nt.OPAQUE_MATERIAL,nt.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new GC({shaderTransformation:e.shaderTransformation},e.optionalFields),this._frameTask=r.registerTask(ar.LOD_RENDERER,this)}initialize(){this._instanceBufferLayout=JLt(this.optionalFields),this._glInstanceBufferLayout=wd(this._instanceBufferLayout,1),this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))}destroy(){this._frameTask.remove()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(r=>{const i=r.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu}),this._highlightRenderInstanceData.forEach(r=>{const i=r.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu}),e}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,n)=>{const s=this._defaultRenderInstanceData[n],o=this._highlightRenderInstanceData[n],a=s.size+o.size,l=i.triangleCount;r.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:e,renderedInstances:r.reduce((i,n)=>i+n.renderedInstances,0),renderedTriangles:r.reduce((i,n)=>i+n.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,n=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new uwe(i,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new uwe(i,this._instanceBufferLayout)),jLt.create(e,o,r)))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(M);if(Ra(r)||s.length!==n.length){s.forEach(o=>o.destroy()),fi(r);for(const o of n)if(o.status==="rejected")throw o.reason}this._levels=s,this._levelSelector=XLt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceData.forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(r=>r.material.requiresSlot(nt.TRANSPARENT_MATERIAL,ne.Color)))}get needsHighlight(){return this._highlightRenderInstanceData.some(e=>e.size>0)}prepareRender(e){if(!tn.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(pu),this._needFullCycle=!1)}}render(e){!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output)||(e.rctx.bindVAO(),e.output!==ne.Highlight&&e.output!==ne.ShadowHighlight&&this._renderComponents(e,this._defaultRenderInstanceData),e.output!==ne.ShadowExcludeHighlight&&this._renderComponents(e,this._highlightRenderInstanceData))}intersect(e,r,i,n){if(!this.baseMaterial.isVisible()||k(this._octree))return;const s=G();Ve(s,n,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,fwe),e.transform.set(fwe),Ot(mwe,i,e.transform.inverse),Ot(gwe,n,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;tr((l&os.ACTIVE)!=0,"invalid instance state"),tr(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,r,mwe,gwe,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,s,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(k(this._octreeCached)){const r=this._instanceData,i=(e=r.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new BLt(r,this.baseBoundingSphere);for(let n=0;n<r.capacity;++n)i.get(n)&os.ACTIVE&&this._octreeCached.addInstance(n)}return this._octreeCached}_invalidateOctree(){this._octreeCached=yt(this._octreeCached)}_queryDepthRangeOctree(e){if(k(this._octree))return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,gm.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(r,gm.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||n==null)return{near:1/0,far:-1/0};const s=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,pg),Ve(pg,pg,s);const a=Qe(pg,r)-pg[3];o.boundingSphere.getVec(n,pg),Ve(pg,pg,s);const l=Qe(pg,r)+pg[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(e=>e.startUpdateCycle()),this._highlightRenderInstanceData.forEach(e=>e.startUpdateCycle())}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:n}=this;this._defaultRenderInstanceData.forEach(u=>u.beginUpdate()),this._highlightRenderInstanceData.forEach(u=>u.beginUpdate());const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;for(let u=0;u<a&&!e.done;++u){c===this._cycleStartIndex&&this._startUpdateCycle();const d=o.state.get(c);let p=0;if(!(d&os.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const A=o.lodLevel.get(c);if(d&os.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[A].freeTail(),d&os.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[A].freeTail(),d&os.REMOVE)s.freeInstance(c);else if(d&os.VISIBLE){let v=0;r&&(o.modelOrigin.getVec(c,pwe),v=n.selectLevel(pwe,s.getCombinedMedianScaleFactor(c),i)),p=d&~(os.ACTIVE|os.TRANSFORM_CHANGED),v>=0&&(d&os.HIGHLIGHT?(dwe(this._highlightRenderInstanceData[v],o,c),p|=os.HIGHLIGHT_ACTIVE):(dwe(this._defaultRenderInstanceData[v],o,c),p|=os.DEFAULT_ACTIVE)),o.state.set(c,p),o.lodLevel.set(c,v)}else p=d&~(os.ACTIVE|os.TRANSFORM_CHANGED),o.state.set(c,p);if(M(this._octreeCached)){const v=!!(d&os.ACTIVE),b=!!(p&os.ACTIVE);!v&&b?this._octreeCached.addInstance(c):v&&!b?this._octreeCached.removeInstance(c):v&&b&&d&os.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(u=>u.endUpdate()),this._highlightRenderInstanceData.forEach(u=>u.endUpdate()),this._context.requestRender()}_renderComponents(e,r){this.levels.forEach((i,n)=>{const s=i.components.map(o=>this._beginComponent(e,r[n],o));i.components.forEach((o,a)=>this._renderComponent(e,s[a],r[n],o,n))})}_beginComponent(e,r,i){const{bindParameters:n,rctx:s,output:o}=e;if(r.size===0||!i.material.requiresSlot(n.slot,e.output))return null;const a=i.glMaterials.load(s,n.slot,o);return M(a)?a.beginSlot(n):null}_renderComponent(e,r,i,n,s){if(k(r))return;const{bindParameters:o,rctx:a}=e,l=a.bindTechnique(r,n.material.parameters,o);a.bindVAO(n.vao),r.ensureAttributeLocations(n.vao),l.bindDraw(KLt,o,n.material.parameters),tn.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===ne.Color&&(l.setUniform4fv("externalColor",Awe[Math.min(s,Awe.length-1)]),l.setUniform1i("colorMixMode",Z9e.replace));const c=a.capabilities.instancing,u=i.capacity,d=i.headIndex,p=i.tailIndex,A=i.firstIndex,v=this._glInstanceBufferLayout,b=(S,E)=>{rhe(a,Di,i.buffer,v,S),c.drawArraysInstanced(r.primitiveType,0,n.vertexCount,E-S),ihe(a,Di,i.buffer,v)};n.material.parameters.transparent&&A!=null?d>p?(tr(A>=p&&A<=d,"invalid firstIndex"),b(A,d),b(p,A)):d<p&&(A<=d?(tr(A>=0&&A<=d,"invalid firstIndex"),b(A,d),b(p,u),b(0,A)):(tr(A>=p&&A<=u,"invalid firstIndex"),b(A,u),b(0,d),b(p,A))):d>p?b(p,d):d<p&&(b(0,d),b(p,u)),a.bindVAO(null)}};function dwe(t,e,r){const i=t.allocateHead();ZLt(e,r,t.view,i)}function ZLt(t,e,r,i){OTt(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function JLt(t){let e=Cs().vec3f(z.MODELORIGINHI).vec3f(z.MODELORIGINLO).mat3f(z.MODEL).mat3f(z.MODELNORMAL);return M(t)&&t.includes("color")&&(e=e.vec4f(z.INSTANCECOLOR)),M(t)&&t.includes("featureAttribute")&&(e=e.vec4f(z.INSTANCEFEATUREATTRIBUTE)),M(t)&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(z.OBJECTANDLAYERIDCOLOR_INSTANCED)),e}h([f({constructOnly:!0})],of.prototype,"symbol",void 0),h([f({constructOnly:!0})],of.prototype,"optionalFields",void 0),h([f({constructOnly:!0})],of.prototype,"metadata",void 0),h([f({constructOnly:!0})],of.prototype,"shaderTransformation",void 0),h([f()],of.prototype,"_instanceData",void 0),h([f()],of.prototype,"_cycleStartIndex",void 0),h([f({readOnly:!0})],of.prototype,"_enableLevelSelection",null),h([f()],of.prototype,"_updateCyclesWithStaticCamera",void 0),h([f({readOnly:!0})],of.prototype,"running",null),of=h([Q("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],of);const pwe=G(),pg=Kr(),fwe=ht(),mwe=G(),gwe=G(),Awe=[Fr(1,0,1,1),Fr(0,0,1,1),Fr(0,1,0,1),Fr(1,1,0,1),Fr(1,0,0,1)],KLt=new W4t;let ywe=class{constructor(e,r,i,n,s,o,a,l,c,u,d,p){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=n,this.resourceSize=s,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=d,this.pivotOffset=p}},eNt=class extends sy{getCachedSize(){const[e,r,i]=M(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,n){super(e,r,i,n),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&lH(this.symbolLayer))throw new Error;const r=this.symbolLayer;if(this._isPrimitive){const i=r.resource?r.resource.primitive:yIe;this._resources=await this._createResourcesForPrimitive(i,e)}else this._resources=await this._createResourcesForUrl(r.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return M(this._resources)?this._resources.extentPadding:0}get _isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return M(this._resources)?this._resources.lodRenderer:null}_setMaterialTransparencyParams(e,r=Oa(this.symbolLayer,"material","color")){const i=this._getCombinedOpacity(r),n=i<1||this.needsDrivenTransparentPass;return e.transparent=n,e.opacity=i,e.cullFace=n?Vn.None:Vn.Back,e}async _createResourcesForPrimitive(e,r){if(!tIt(e))throw new Error(`Unknown object symbol primitive: ${e}`);const i=this.symbolLayer,n=fa(sot(e)),s=sh(m6(n)),o=sh(wW(s,i)),a=ct(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:cA,diffuse:cA,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!u.usePBR;this._setMaterialTransparencyParams(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:R,minWorldLength:O,maxWorldLength:I}=p.verticalOffset;u.verticalOffset={screenLength:El(R),minWorldLength:O||0,maxWorldLength:M(I)?I:1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=Ef;else{const R=M(i.material)?i.material.color:null,O=M(R)?$t.toUnitRGBA(R):Ef;u.externalColor=O}this._fastUpdates=FL(this._context.renderer,this._fastVisualVariableConvertOptions(n,o,s,lx)),u.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(u,this._fastUpdates.materialParameters),u.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(u.instanced.push("color"),this._optionalFields.push("color")),Fe("enable-feature:objectAndLayerId-rendering")&&(u.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const A=new d1(u),v=tke(e,A);if(!v)throw new Error(`Unknown object symbol primitive: ${e}`);const b=V8(v).map(R=>({opacity:1,transparent:R.parameters.transparent})),S=await this._createStageResources(v,d,r),E=await this._createLodRenderer(v,r);return new ywe(v,E,S,b,s,l,c,n,o,a,d,lx)}async _createResourcesForUrl(e,r){const i=["transformation"],n={materialParamsMixin:{instanced:i,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=FL(this._context.renderer,this._fastVisualVariableConvertOptions(lx,lx,lx,lx)),this._fastUpdates.enabled?(Object.assign(n.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color")),Fe("enable-feature:objectAndLayerId-rendering")&&(i.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:Z,minWorldLength:X,maxWorldLength:ee}=s.verticalOffset;n.materialParamsMixin.verticalOffset={screenLength:El(Z),minWorldLength:X||0,maxWorldLength:M(ee)?ee:1/0},n.materialParamsMixin.castShadows=!1}n.signal=r,n.usePBR=this._context.physicalBasedRenderingEnabled,n.skipHighLods=this._context.skipHighSymbolLods;const o=n.usePBR,a=await iBe(e,n),l=a.isEsriSymbolResource,c=a.isWosr,u=zDt(a.lods);u.levels.sort((Z,X)=>Z.minScreenSpaceRadius-X.minScreenSpaceRadius);const d=this._context,p=this.symbolLayer.material,A=this._getExternalColorParameters(p),v=Oa(this.symbolLayer,"material","color"),b=this._getCombinedOpacity(v,{hasIntrinsicColor:!0}),S=this.needsDrivenTransparentPass,E=V8(u),R=V8(u).map(Z=>({opacity:Z.parameters.opacity||1,transparent:Z.parameters.transparent}));E.forEach(Z=>{const X=Z.parameters;Z.setParameters(A);const ee=X.opacity*b,se=ee<1||S||X.transparent;Z.setParameters({opacity:ee,transparent:se}),d.screenSizePerspectiveEnabled&&Z.setParameters({screenSizePerspective:d.sharedResources.screenSizePerspectiveSettings})});const O=a.referenceBoundingBox,I=sh(m6(O)),N=sh(u.levels[0].pivotOffset),L=sh(wW(I,this.symbolLayer)),B=ct(L);kL(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(O,L,I,N))&&E.forEach(Z=>Z.setParameters(this._fastUpdates.materialParameters));const U=await this._createStageResources(u,o,r),q=await this._createLodRenderer(u,r);return new ywe(u,q,U,R,I,l,c,O,L,B,o,N)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const n=this._context.stage,s=V8(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),n.addMany(s),this._addDisposeResource(()=>n.removeMany(s));const o=Vbe(e);n.addMany(o),this._addDisposeResource(()=>n.removeMany(o)),await n.load(o,i),fi(i);const a=Gbe(e);return n.addMany(a),this._addDisposeResource(()=>n.removeMany(a)),{materials:s,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},s=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,h9),Ia(c,Zne(this._fastUpdates.materialParameters,h9,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,h9),I5t(a,this._fastUpdates.materialParameters,h9))}:null,o=new of({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:s},this._context.scheduler);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(o),o.destroy()}),await i.addRenderPlugin(o.slots,o,r),o}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=Ef:M(e)&&M(e.color)?r.externalColor=$t.toUnitRGBA(e.color):(r.externalColor=Ef,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=IL(r.geometry);if(k(i))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const n=this.setGraphicElevationContext(r,new Wm),s=e.renderingInfo;return this._createAs3DShape(r,i,s,n,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(k(this._resources))return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters;for(let s=0;s<i.length;s++){const o=i[s],a=Oa(this.symbolLayer,"material","color"),l=n[s],c=this._getCombinedOpacity(a,{hasIntrinsicColor:r})*l.opacity,u=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:u}),this._isPrimitive&&o.setParameters({cullFace:u?Vn.None:Vn.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,z2)}slicePlaneEnabledChanged(){if(k(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(k(this._resources))return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!1}applyRendererDiff(e,r){if(k(this._resources))return ua.Recreate_Symbol;const{stageResources:{materials:i},lodRenderer:n,resourceBoundingBox:s,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!kL(this._fastUpdates,r,this._fastVisualVariableConvertOptions(s,o,a,l)))return ua.Recreate_Symbol;for(const u of i)u.setParameters(this._fastUpdates.materialParameters);n.notifyShaderTransformationChanged()}return ua.Fast_Update}computeComplexity(){if(k(this._resources))return super.computeComplexity();const e=this._resources.lodResources,r=eke(e.levels[0]).reduce((s,o)=>s+o.indices.get(z.POSITION).length,0)/3,i=s=>Array.from(s.vertexAttributes.values()).reduce((o,a)=>{var l;return o+(((l=a.data.buffer)==null?void 0:l.byteLength)??0)},0)+Array.from(s.indices.values()).reduce((o,a)=>o+(Array.isArray(a)?12*a.length:a.buffer.byteLength),0),n=Vbe(e).reduce((s,o)=>s+(o.params.encoding&&o.params.encoding==="image/ktx2"?o.estimatedTexMemRequired:o.estimatedTexMemRequired/4),0)+Gbe(e).reduce((s,o)=>s+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...nke(this.symbol,this.symbolLayer),resourceBytes:n}}}_hasLodRenderer(){return M(this._resources)}_createAs3DShape(e,r,i,n,s,o){if(!this._hasLodRenderer()||k(this._resources))return null;const a=this.getFastUpdateAttrValues(e),l=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?Q5(i.color,i.opacity):null,c=this._context.clippingExtent;if(nc(r,E3,this._context.elevationProvider.spatialReference),M(c)&&!nce(c,E3))return null;const u=this._requiresTerrainElevation(n),d=this._computeGlobalTransform(r,n,AX,d9),p=this._computeLocalTransform(this._resources,this.symbolLayer,i,_we),A=this._resources.lodRenderer.instanceData,v=A.addInstance();this._instanceIndexToGraphicUid.set(v,s),A.setLocalTransform(v,p,!1),A.setGlobalTransform(v,d),a&&A.setFeatureAttribute(v,a),l&&A.setColor(v,l),M(this._context.stage.renderView.objectAndLayerIdRenderHelper)&&A.setObjectAndLayerIdColor(v,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:s,layerUid:o}));const b=new kDt(this,v,HPt,n);return u&&(b.alignedSampledElevation=d9.sampledElevation),b.needsElevationUpdates=z2(n.mode),PL(b,r,this._context.elevationProvider),b}_computeGlobalTransform(e,r,i,n){return TP(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,n),E3[0]=e.x,E3[1]=e.y,E3[2]=n.z,Lm(e.spatialReference,E3,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,n){return Xf(n),this._applyObjectRotation(i,!1,n),this._applyObjectRotation(r,!0,n),this._applyObjectScale(e,i,n),this._applyAnchor(e,r,n),n}_applyObjectScale(e,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const n=this._drivenProperties.size&&r.size?r.size:e.symbolSize,s=Bbe(n,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);s[0]===1&&s[1]===1&&s[2]===1||HG(i,i,s)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(k(this._resources))return!0;const i=r&&IL(r);if(k(i))return!1;const n=this.getGeometryElevationMode(r);return e.elevationContext.mode===n&&(this._computeGlobalTransform(i,e.elevationContext,AX,d9),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=d9.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,AX,!0),PL(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||k(this._resources))return;const i=(v,b,S)=>br(v!=null&&v.type==="complete"?v.newValue:b,S),n=i(r.heading,this.symbolLayer.heading,0),s=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),u=i(r.anchor,this.symbolLayer.anchor,void 0),d=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const p={heading:n,tilt:s,roll:o,anchor:u,anchorPosition:d},A=this._resources;this.loadStatus===ep.LOADED&&e.symbolLayerStatePatches.push(()=>{A.symbolSize=sh(wW(A.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((v,b)=>{const S=this._computeLocalTransform(A,p,b,_we),E=v.instanceIndex;A.lodRenderer.instanceData.setLocalTransform(E,S,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const n=i.color.newValue,s=M(n)?$t.toUnitRGBA(n):Ef;delete i.color;const o=this._resources;k(o)||e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,s),l=this._setMaterialTransparencyParams({},n)):l=this._setMaterialTransparencyParams({externalColor:s},n);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&r))return DPt(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const n=G();switch(i.anchor){case"center":Pe(n,um(e)),Cc(n,n);break;case"top":{const s=um(e);Le(n,-s[0],-s[1],-e[5]);break}case"bottom":{const s=um(e);Le(n,-s[0],-s[1],-e[2]);break}case"relative":{const s=um(e),o=m6(e),a=i.anchorPosition,l=a?pt(a.x,a.y,a.z):Ec;EG(n,o,l),ze(n,n,s),Cc(n,n);break}default:M(r)?Cc(n,r):Pe(n,Ec)}return n}_applyAnchor(e,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const n=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);n&&Ah(i,i,n)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,n){const s=M(e)?sh(m6(e)):cA,o=M(e)?this._computeAnchor(e,n,this.symbolLayer):Ec,a=this._context.renderCoordsHelper.unitInMeters,l=Bbe(M(r)?r:void 0,r,i,a),c=pt(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:s,symbolSize:M(r)?r:cA,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}};const E3=G(),_we=ht(),AX=ht(),h9=Kr(),d9=new lF;function tNt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function rNt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function nse(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function iNt(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function nNt(t,e){const r=e[0],i=e[1],n=e[2],s=e[3];let o=r*s-n*i;return o?(o=1/o,t[0]=s*o,t[1]=-i*o,t[2]=-n*o,t[3]=r*o,t):null}function sNt(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function oNt(t){return t[0]*t[3]-t[2]*t[1]}function aBe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*a+s*l,t[1]=n*a+o*l,t[2]=i*c+s*u,t[3]=n*c+o*u,t}function aNt(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=n*l+o*a,t[2]=i*-a+s*l,t[3]=n*-a+o*l,t}function lNt(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=n*a,t[2]=s*l,t[3]=o*l,t}function cNt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function uNt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function hNt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function dNt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function pNt(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function fNt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function lBe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function mNt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function gNt(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Dc();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}function ANt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function yNt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const _Nt=aBe,vNt=lBe;Object.freeze(Object.defineProperty({__proto__:null,LDU:pNt,add:fNt,adjoint:sNt,copy:tNt,determinant:oNt,equals:gNt,exactEquals:mNt,frob:dNt,fromRotation:cNt,fromScaling:uNt,identity:rNt,invert:nNt,mul:_Nt,multiply:aBe,multiplyScalar:ANt,multiplyScalarAndAdd:yNt,rotate:aNt,scale:lNt,set:nse,str:hNt,sub:vNt,subtract:lBe,transpose:iNt},Symbol.toStringTag,{value:"Module"}));let bNt=class extends zo{constructor(e,r,i,n,s,o,a,l){super(e,r,i,null,lo.Mesh,l),this.path=n,this.geometrySR=s,this.upVectorAlignment=o,this.stencilWidth=a}};var v2;function cBe(t){return"upVectorAlignment"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(v2||(v2={}));function uBe(){return[1,0,0,1]}function wNt(t){return[t[0],t[1],t[2],t[3]]}function xNt(t,e,r,i){return[t,e,r,i]}function TNt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:wNt,create:uBe,createView:TNt,fromValues:xNt},Symbol.toStringTag,{value:"Module"}));function hBe(){return{up:G(),right:G()}}function SNt(t,e,r){Ot(t.up,e.up,r),Ot(t.right,e.right,r)}function ENt(t,e,r){ti(t,Qe(r,e.right),Qe(r,e.up))}let CNt=class{constructor(){this.pos=G(),this.posES=G(),this.vLeft=G(),this.vRight=G(),this.vMinSiblingLength=0,this.frame=hBe(),this.rotationFrameUp=G(),this.rotationRight=Ft(),this.rotationAngle=0,this.miterStretch=uBe(),this.maxStretchDistance=0}setFrameFromUpVector(e){Pe(this.frame.up,e),ze(jC,this.vLeft,this.vRight),Ye(jC,jC),Oe(sse,this.frame.up,Qe(jC,this.frame.up)),Ve(f9,jC,sse),Ye(f9,f9),Kt(this.frame.right,f9,this.frame.up)}},dBe=class{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[]}addVertex(e,r){return this.vertices.push(Q$(e)),this.vertexNormals.push(Q$(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:Q$(e),normal:r?Q$(r):null}),this.poles.length-1}addSegment(e,r=null){this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}};function MNt(t=20){const r=new dBe,i={v0:0,v1:0};r.addPole(Gi(0,0));for(let s=0;s<t;++s){const o=2*s*Math.PI/t,a=Math.cos(o),l=Math.sin(o),c=Gi(a*.5,l*.5),u=Gi(a,l);r.addVertex(c,u)}for(let s=0;s<t-1;++s){const o={v0:s,v1:s+1};r.addSegment(o,i)}const n={v0:t-1,v1:0};return r.addSegment(n,i),r}function RNt(){const r=new dBe,i=Gi(.5*-1,.5*-1),n=Gi(.5*1,.5*-1),s=Gi(.5*1,.5*1),o=Gi(.5*-1,.5*1),a=Gi(0,-1),l=Gi(1,0),c=Gi(0,1),u=Gi(-1,0);return r.addPole(Gi(0,.5*1),c),r.addPole(Gi(0,.5*1)),r.addPole(Gi(0,.5*-1)),r.addPole(Gi(0,.5*-1),a),r.addVertex(i,a),r.addVertex(n,a),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(n,l),r.addVertex(s,l),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(s,c),r.addVertex(o,c),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(o,u),r.addVertex(i,u),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),r}let ONt=class{constructor(e){this.vertices=e,this.offset=G(),this.xform=ht();const r=Math.floor((e.length-1)/2);Pe(this.offset,this.vertices[r].pos);for(const i of this.vertices)Ve(i.pos,i.pos,this.offset);Ah(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];r.index=0,r.vLeft=G(),Ve(r.vRight,this.vertices[1].pos,r.pos);let i=ct(r.vRight);r.vMinSiblingLength=i,Ye(r.vRight,r.vRight);let n=r;for(let s=1;s<e;++s){const o=this.vertices[s];if(o.index=s,o.vLeft=n.vRight,s<e-1){Ve(o.vRight,this.vertices[s+1].pos,o.pos);const a=ct(o.vRight);o.vMinSiblingLength=Math.min(i,a),i=a,Ye(o.vRight,o.vRight)}else Pe(o.vRight,o.vLeft),o.vMinSiblingLength=i;n=o}}};function PNt(t,e){let r=null;const i=t.vertices.length,n=.99619469809,s=G(),o=G(),a=G(),l=G(),c=G(),u=G(),d=Xi();let p=t.vertices[0];Pe(o,e),Le(s,0,1,0),vz(p.vRight,o,s,s,a,o,n),Pe(p.frame.up,o),Pe(p.frame.right,a),r=p;for(let A=1;A<i;++A){p=t.vertices[A],ze(c,p.vLeft,p.vRight);let v=ct(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),ze(u,r.pos,r.frame.up),LN(p.pos,c,d),bE(d,xp(u,p.vLeft),l)?(Ve(l,l,p.pos),Ye(o,l),Kt(a,c,o),Ye(a,a)):vz(c,r.frame.up,r.frame.right,s,a,o,n),Pe(p.frame.up,o),Pe(p.frame.right,a),r=p}}let INt=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.index,e.frame,r.vertices[n],r.vertexNormals[n],!1)}},yX=class{constructor(e=.8*Math.PI,r=1){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const n=UNt;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(let s=0;s<this.numBendSubdivisions+1;++s){bp(wwe,.5*-e.rotationAngle+s*e.rotationAngle/this.numBendSubdivisions,e.rotationFrameUp),SNt(n,e.frame,wwe);for(let o=0;o<r.vertices.length;++o)Ko(r.vertices[o],e.rotationRight)*e.rotationAngle>=0?i(e.index,n,r.vertices[o],r.vertexNormals[o],!1):(vie(VT,r.vertices[o],e.miterStretch),i(e.index,e.frame,VT,r.vertexNormals[o],!0))}else for(let s=0;s<this.numBendSubdivisions+1;++s)for(let o=0;o<r.vertices.length;++o){const a=Ko(r.vertices[o],e.rotationRight)*e.rotationAngle>=0;vie(VT,r.vertices[o],e.miterStretch),i(e.index,e.frame,VT,r.vertexNormals[o],!a)}}},Zde=class{rebuildConnectingProfileGeometry(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.index,e.frame,r.vertices[n],r.vertexNormals[n],0,0)}},vwe=class extends Zde{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}},p9=class extends Zde{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.index,e.frame,r.vertices[n],r.vertexNormals[n],this.profilePlaneOffset,0)}rebuildCapGeometry(e,r){const i=Jde;ti(i,0,0);const n=this.flip?1:-1;for(let s=0;s<this.profile.vertices.length;++s)r(e.index,e.frame,this.profile.vertices[s],i,this.profilePlaneOffset,n)}buildTopology(e,r){const i=this.vertexBufferStart+this.profile.vertexIndices[0];for(let n=1;n<this.profile.numSegments;++n){const s=this.profile.vertexIndices[2*n+0],o=this.profile.vertexIndices[2*n+1],a=this.vertexBufferStart+s,l=this.vertexBufferStart+o;this.flip?r(l,a,i):r(i,a,l)}}},bwe=class extends Zde{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}getNumVertices(){let e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length,e}getNumIndices(){let e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(let r=0;r<this.profile.numSegments;++r){const i=this.profile.vertexIndices[2*r+0],n=this.profile.vertexIndices[2*r+1];this.profile.poleIndices[i]===this.profile.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=e.frame,n=.5*this.sign,s=VT,o=Jde;ti(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?r(e.index,i,l.position,l.normal,n,0):r(e.index,i,l.position,o,n,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)r(e.index,i,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),u=Math.cos(l);for(let d=0;d<this.profile.vertices.length;++d){const p=this.profile.poles[this.profile.poleIndices[d]];iA(s,this.profile.vertices[d],p.position),ed(s,s,c),p.normal?(Z0(s,s,p.position),r(e.index,i,s,p.normal,n*u,0)):(mL(o,s),ed(o,o,c),Z0(s,s,p.position),r(e.index,i,s,o,n*u,this.sign*u))}}}buildTopology(e,r){const i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let s=0;s<this.profile.numSegments;++s){const o=this.profile.vertexIndices[2*s+0],a=this.profile.vertexIndices[2*s+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let u=i+o,d=i+a;for(let p=0;p<this.numSegments-1;++p){const A=n+p*this.profile.vertices.length+o,v=n+p*this.profile.vertices.length+a;this.flip?(r(A,d,u),r(d,A,v)):(r(u,d,A),r(v,A,d)),u=A,d=v}this.flip?(r(l,d,u),l!==c&&r(l,c,d)):(r(u,d,l),l!==c&&r(d,c,l))}}},$Nt=class{constructor(e,r,i,n,s,o={}){this.options=o,this._extrusionVertexCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.profile=r,this.path=e,this.extruder=i,this.startCap=n,this.endCap=s;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=xo(1*this.numVerticesTotal),this.profileRightAxisData=xo(4*this.numVerticesTotal),this.profileUpAxisData=xo(4*this.numVerticesTotal),this.profileVertexAndNormalData=xo(4*this.numVerticesTotal),this.originData=xo(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,r,i,n,s){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=n[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,s){const o=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,n,s,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=n[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=s,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}_rebuildGeometry(){const e=(i,n,s,o,a)=>this.emitVertex(i,n,s,o,a),r=(i,n,s,o,a,l)=>this.emitCapVertex(i,n,s,o,a,l);this._extrusionVertexCount=0;for(const i of this.path.vertices)this.originData[3*i.index+0]=i.pos[0],this.originData[3*i.index+1]=i.pos[1],this.originData[3*i.index+2]=i.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,r);for(let i=1;i<this.path.vertices.length-1;++i)this.extruder.extrude(this.path.vertices[i],this.profile,e);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,r),this.startCap.rebuildCapGeometry(this.path.vertices[0],r),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],r)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let n=3*(2*(r*i));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const s=new Array,o=new Array,a=new Array,l=(c,u,d)=>{s.push(c),s.push(u),s.push(d),o.push(c),o.push(u),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[d])};for(let c=0;c<r;++c){const u=this.profile.vertexIndices[2*c],d=this.profile.vertexIndices[2*c+1];for(let p=0;p<i;++p){const A=p*e+u,v=(p+1)*e+d,b=p*e+d;l(A,(p+1)*e+u,v),l(A,v,b)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=aR(s),this.normalIndices=aR(o),this.pathVertexIndices=aR(a)}onPathChanged(){this._rebuildGeometry()}},pBe=class{constructor(e){this.builder=e}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}},fBe=class extends pBe{constructor(e){super(e),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=xo(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=xo(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;for(let r=0;r<this.builder.numVerticesTotal;++r){let i=this.builder.pathVertexData[r];const n=i===0||i===this.builder.path.vertices.length-1;i*=3;const s=LNt;Le(s,this.builder.originData[i++],this.builder.originData[i++],this.builder.originData[i]);const o=4*r,a=sse,l=VT,c=jC,u=FNt,d=kNt;let p=0,A=0;if(Le(u,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),Le(d,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),ti(l,this.builder.profileVertexAndNormalData[o]*e[0],this.builder.profileVertexAndNormalData[o+1]*e[1]),n)Kt(c,d,u),p=this.builder.profileRightAxisData[o+3]*e[0],A=this.builder.profileUpAxisData[o+3];else{const b=Jde,S=NNt;ti(b,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const E=Xue(b);mL(b,b);const R=Ko(l,b);if(Math.abs(R)>E){ti(S,-b[1],b[0]);const O=Ko(l,S);ed(b,b,E*Math.sign(R)),ed(S,S,O),Z0(l,b,S)}Le(c,0,0,0)}Le(a,u[0]*l[0]+d[0]*l[1],u[1]*l[0]+d[1]*l[1],u[2]*l[0]+d[2]*l[1]),this.vertexAttributePosition[3*r+0]=s[0]+a[0]+c[0]*p,this.vertexAttributePosition[3*r+1]=s[1]+a[1]+c[1]*p,this.vertexAttributePosition[3*r+2]=s[2]+a[2]+c[2]*p;const v=VT;ti(v,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*r+0]=u[0]*v[0]+d[0]*v[1]+c[0]*A,this.vertexAttributeNormal[3*r+1]=u[1]*v[0]+d[1]*v[1]+c[1]*A,this.vertexAttributeNormal[3*r+2]=u[2]*v[0]+d[2]*v[1]+c[2]*A}}createGeometryData(){const e=[[z.POSITION,this.builder.vertexIndices],[z.NORMAL,this.builder.normalIndices]],r=[[z.POSITION,new Pt(this.vertexAttributePosition,3,!0)],[z.NORMAL,new Pt(this.vertexAttributeNormal,3,!0)]];if(this.vertexAttributeColor){const i=this.builder.vertexIndices.length;e.push([z.COLOR,new Array(i).fill(0)]),r.push([z.COLOR,new Pt(this.vertexAttributeColor,4)])}return{vertexAttributes:r,indices:e}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(e,r,i){const n=this.builder.vertexIndices,s=new Pt(this.vertexAttributePosition,3),o=n.length/3;sF(e,r,0,o,n,s,void 0,void 0,i)}},DNt=class extends pBe{constructor(e,r,i,n){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=n,this.vvData=null,this.baked=new fBe(e),this.vvData=xo(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s+0]=r,this.vvData[4*s+1]=i,this.vvData[4*s+2]=n;const o=s===0||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[z.POSITION,new Pt(this.builder.originData,3,!0)],[z.PROFILERIGHT,new Pt(this.builder.profileRightAxisData,4,!0)],[z.PROFILEUP,new Pt(this.builder.profileUpAxisData,4,!0)],[z.PROFILEVERTEXANDNORMAL,new Pt(this.builder.profileVertexAndNormalData,4,!0)],[z.FEATUREVALUE,new Pt(this.vvData,4,!0)]],indices:[[z.POSITION,this.builder.pathVertexIndices],[z.PROFILERIGHT,this.builder.vertexIndices],[z.PROFILEUP,this.builder.vertexIndices],[z.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[z.FEATUREVALUE,this.builder.pathVertexIndices]]}}};const LNt=G(),VT=Ft(),Jde=Ft(),NNt=Ft(),sse=G(),jC=G(),FNt=G(),kNt=G(),f9=G(),UNt=hBe(),wwe=ht(),_X=8;function BNt(t,e){const r=z.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(D`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new ji("size",n=>n.size)),e.vvSize?(i.uniforms.add(new kr("vvSizeMinSize",n=>n.vvSizeMinSize)),i.uniforms.add(new kr("vvSizeMaxSize",n=>n.vvSizeMaxSize)),i.uniforms.add(new kr("vvSizeOffset",n=>n.vvSizeOffset)),i.uniforms.add(new kr("vvSizeFactor",n=>n.vvSizeFactor)),i.code.add(D`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(D`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",_X),i.uniforms.add([new bc("vvOpacityValues",n=>n.vvOpacityValues,_X),new bc("vvOpacityOpacities",n=>n.vvOpacityOpacities,_X)]),i.code.add(D`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(D`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",Cm),i.uniforms.add([new bc("vvColorValues",n=>n.vvColorValues,Cm),new iH("vvColorColors",n=>n.vvColorColors,Cm)]),i.code.add(D`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(D`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(KN),t.attributes.add(z.PROFILERIGHT,"vec4"),t.attributes.add(z.PROFILEUP,"vec4"),t.attributes.add(z.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(D`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(D`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(D`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(D`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let zNt=class extends yde{constructor(){super(...arguments),this.size=Gi(1,1)}};function VNt(t){const e=new Ui,{vertex:r,fragment:i}=e;switch(pd(r,t),e.varyings.add("vpos","vec3"),e.include(BNt,t),t.output!==ne.Color&&t.output!==ne.Alpha||(e.include(uh,t),e.include(XS,t),e.include(AP,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(D`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===ne.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Sp,t),t.output){case ne.Alpha:e.include(To,t),i.uniforms.add(new ut("opacity",n=>n.opacity)),i.code.add(D`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `);break;case ne.Color:e.include(To,t),e.include(ZS,t),e.include(pF,t),e.include(XS,t),e.include(dUe,t),Um(i,t),fF(i),EP(i),i.uniforms.add([r.uniforms.get("localOrigin"),new kr("ambient",n=>n.ambient),new kr("diffuse",n=>n.diffuse),new kr("specular",n=>n.specular),new ut("opacity",n=>n.opacity)]),i.include(ry),ty(i),i.code.add(D`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          gl_FragColor = vec4(shadedColor, combinedOpacity);
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
          ${t.transparencyPassType===dr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
        }
      `);break;case ne.Depth:case ne.Shadow:case ne.ShadowHighlight:case ne.ShadowExcludeHighlight:e.include(uh,t),jS(e),e.varyings.add("depth","float"),r.code.add(D`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(To,t),e.include(h1,t),i.code.add(D`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case ne.Normal:e.include(uh,t),e.include(LL,t),wO(r),e.varyings.add("vnormal","vec3"),r.code.add(D`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(To,t),i.code.add(D`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case ne.Highlight:e.include(uh,t),e.include(LL,t),e.varyings.add("vnormal","vec3"),r.code.add(D`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(To,t),e.include(P1,t),i.code.add(D`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const GNt=Object.freeze(Object.defineProperty({__proto__:null,build:VNt},Symbol.toStringTag,{value:"Module"})),mBe=new Map([[z.POSITION,0],[z.PROFILERIGHT,1],[z.PROFILEUP,2],[z.PROFILEVERTEXANDNORMAL,3],[z.FEATUREVALUE,4]]);let jNt=class extends zNt{constructor(){super(...arguments),this.ambient=pt(.2,.2,.2),this.diffuse=pt(.8,.8,.8),this.specular=pt(0,0,0),this.opacity=1}},gBe=class ABe extends qi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2,r.spherical=e.viewingMode===wt.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new zi(e.rctx,ABe.shader.get().build(this.configuration),mBe)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===dr.NONE,n=e===dr.FrontFace;return Pr({blending:r.output!==ne.Color&&r.output!==ne.Alpha||!r.transparent?null:i?_p:I1(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==ks.None?NFe:null,depthTest:{func:cw(e)},depthWrite:i||n?_h:null,colorWrite:Gr,stencilWrite:r.hasOccludees?VA:null,stencilTest:r.hasOccludees?uw:null,polygonOffset:i||n?null:oH})}};gBe.shader=new Bi(GNt,()=>be(()=>import("./Path.glsl-fa1abea2.js"),[]));let Va=class extends Xa{constructor(){super(...arguments),this.output=ne.Color,this.doubleSidedMode=ks.None,this.transparencyPassType=dr.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};h([ae({count:ne.COUNT})],Va.prototype,"output",void 0),h([ae({count:ks.COUNT})],Va.prototype,"doubleSidedMode",void 0),h([ae({count:dr.COUNT})],Va.prototype,"transparencyPassType",void 0),h([ae()],Va.prototype,"spherical",void 0),h([ae()],Va.prototype,"receiveShadows",void 0),h([ae()],Va.prototype,"receiveAmbientOcclusion",void 0),h([ae()],Va.prototype,"vvSize",void 0),h([ae()],Va.prototype,"vvColor",void 0),h([ae()],Va.prototype,"vvOpacity",void 0),h([ae()],Va.prototype,"hasSlicePlane",void 0),h([ae()],Va.prototype,"transparent",void 0),h([ae()],Va.prototype,"hasOccludees",void 0),h([ae()],Va.prototype,"hasMultipassTerrain",void 0),h([ae()],Va.prototype,"cullAboveGround",void 0),h([ae()],Va.prototype,"doublePrecisionRequiresObfuscation",void 0),h([ae({constValue:Jt.Disabled})],Va.prototype,"pbrMode",void 0),h([ae({constValue:!0})],Va.prototype,"hasVvInstancing",void 0),h([ae({constValue:!1})],Va.prototype,"useCustomDTRExponentForWater",void 0),h([ae({constValue:!1})],Va.prototype,"useFillLights",void 0);let HNt=class yBe extends lw{constructor(e){super(e,new WNt),this.supportsEdges=!0,this._vertexAttributeLocations=mBe,this._configuration=new Va,this._vertexBufferLayout=yBe.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==ne.Color&&e!==ne.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?ks.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?ks.WindingOrder:ks.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==ne.Shadow&&e!==ne.ShadowExcludeHighlight&&e!==ne.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,n,s,o){const a=e;if(!cBe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const S=this.parameters.vvSizeOffset,E=this.parameters.vvSizeFactor,R=this.parameters.vvSizeMinSize,O=this.parameters.vvSizeMaxSize,I=l.sizeAttributeValue;c[0]*=He(S[0]+I*E[0],R[0],O[0]),c[1]*=He(S[2]+I*E[2],R[2],O[2])}const u=Math.max(c[0],c[1]),d=e.boundingInfo;if(k(d))return void this._intersectTriangles(l,c,n,s,o);const p=MS(d.bbMin[0]-u,d.bbMin[1]-u,d.bbMin[2]-u,d.bbMax[0]+u,d.bbMax[1]+u,d.bbMax[2]+u),A=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],v=Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]),b=[v/A[0],v/A[1],v/A[2]];ude(p,n,b,i.tolerance)&&this._intersectTriangles(l,c,n,s,o)}_intersectTriangles(e,r,i,n,s){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,n,s)}createBufferWriter(){return new SP(this._vertexBufferLayout)}requiresSlot(e,r){switch(r){case ne.Shadow:case ne.ShadowHighlight:case ne.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case ne.Color:case ne.Alpha:case ne.Depth:case ne.Normal:case ne.Highlight:case ne.ObjectAndLayerIdColor:return e===(this.parameters.transparent?nt.TRANSPARENT_MATERIAL:nt.OPAQUE_MATERIAL)||e===nt.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new qNt(e)}static getVertexBufferLayout(){return Cs().vec3f(z.POSITION).vec4f(z.PROFILERIGHT).vec4f(z.PROFILEUP).vec4f(z.PROFILEVERTEXANDNORMAL).vec4f(z.FEATUREVALUE)}},qNt=class extends aw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){(k(this.technique)||e.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==ne.Color&&this._output!==ne.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(gBe,e)}},WNt=class extends jNt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const QNt=["polyline"];let YNt=class extends sy{constructor(e,r,i,n){super(e,r,i,n),this._intrinsicSize=Gi(1,1),this._upVectorAlignment=v2.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=M(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,r=M(this.symbolLayer.height)?this.symbolLayer.height:e;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,r],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=FL(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?v2.World:v2.Path;const n=this.symbolLayer.profile||"circle";switch(n){default:case"circle":this._profile=MNt(J7e);break;case"quad":this._profile=RNt()}let s=[0,0];switch(i!=="center"&&(s={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[i],this._profile.translate(s[0],s[1])),this.symbolLayer.join){case"round":this._extruder=new yX(0,Z7e);break;case"bevel":this._extruder=new yX(0,1);break;case"miter":this._extruder=new yX(.8*Math.PI,1);break;default:this._extruder=new INt}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new vwe,this._endCap=new vwe;break;case"butt":default:this._startCap=new p9(this._profile,0),this._endCap=new p9(this._profile,0,!0);break;case"square":this._startCap=new p9(this._profile,-.5),this._endCap=new p9(this._profile,.5,!0);break;case"round":{const A=n==="quad";this._startCap=new bwe({profile:this._profile,flip:!1,breakNormals:A,subdivisions:Bne}),this._endCap=new bwe({profile:this._profile,flip:!0,breakNormals:A,subdivisions:Bne});break}}const a=Oa(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=sh(l),u=l[3],d=u<1||this.needsDrivenTransparentPass,p={diffuse:c,ambient:c,opacity:u,transparent:d,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:d||o==="none"?Vn.None:Vn.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(ti(this._intrinsicSize,e,r),!Vz(this._intrinsicSize[0])||!Vz(this._intrinsicSize[1])))throw new pe("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||ed(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const A={...p,...this._fastUpdates.materialParameters,size:$$e(this._intrinsicSize)};this._material=new HNt(A)}else p.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new d1(p);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,QNt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Wm),n=e.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}layerOpacityChanged(){const e=Oa(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,z2)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!kL(this._fastUpdates,r,this._vvConvertOptions))return ua.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return ua.Fast_Update}_getVertexData(e){let r=0;const i=e.paths,n=[],s=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const p of i)r+=p.length;const l=yd(3*r),c=yd(3*r);let u=0;for(const p of i){n.push({index:u,numVertices:p.length});for(const A of p)l[u++]=A[0],l[u++]=A[1],l[u++]=e.hasZ?A[2]:0}let d=!0;return M(o)&&!s.equals(o)&&(d=qs(l,s,0,l,o,0,r)),M(o)&&!o.equals(a)?qs(l,o,0,c,a,0,r):this._copyVertices(l,0,c,0,r),{pathVertexDataInfos:n,vertexDataES:l,vertexDataRS:c,projectionSuccess:d,terrainElevation:0}}_copyVertices(e,r,i,n,s){r*=3,n*=3;for(let o=0;o<s;++o)i[n++]=e[r++],i[n++]=e[r++],i[n++]=e[r++]}_createAs3DShape(e,r,i,n){const s=e.geometry,o=new Array,a=s.spatialReference,l=fa(),c=this._context.renderCoordsHelper;vBe.spatialReference=a;const u=this._getVertexData(s);if(!u.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(u.pathVertexDataInfos.length===0)return s.paths.length!==0&&s.paths.some(v=>v.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;for(const v of u.pathVertexDataInfos){const b=v.index,S=v.numVertices;if(S<2||M(this._context.clippingExtent)&&(qn(l),up(l,u.vertexDataES,3*b,S),!hm(l,this._context.clippingExtent)))continue;const E=[];for(let q=b;q<b+3*S;){const Z=q++,X=q++,ee=q++,se=new CNt;Le(se.posES,u.vertexDataES[Z],u.vertexDataES[X],u.vertexDataES[ee]);const ue=LPt(se.posES,this._context.elevationProvider,i,c);Le(ss,u.vertexDataRS[Z],u.vertexDataRS[X],u.vertexDataRS[ee]),c.setAltitude(ss,ue),Pe(se.pos,ss),E.push(se)}const R=new ONt(E);_Be(R,this._upVectorAlignment,this._context.renderCoordsHelper);const O=new $Nt(R,this._profile,this._extruder,this._startCap,this._endCap);let I=null;if(this._fastUpdates.enabled){const q=this._fastUpdates.visualVariables,Z=q.size?G_(q.size.field,e):0,X=q.color?G_(q.color.field,e):0,ee=q.opacity?G_(q.opacity.field,e):0;I=new DNt(O,Z,X,ee)}else{const q=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const ee=r.size;q[0]*=xwe(ee[0],ee[2]==="symbol-value"?this.symbolLayer.height||0:ee[2],this.symbolLayer.width||0),q[1]*=xwe(ee[2],ee[0]==="symbol-value"?this.symbolLayer.width||0:ee[0],this.symbolLayer.height||0)}let Z;this._drivenProperties.color&&(Z=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(Z=Z?[Z[0],Z[1],Z[2],r.opacity]:[1,1,1,r.opacity]);const X=new fBe(O);X.bake(q),Z&&X.bakeVertexColors(Z),I=X}const{vertexAttributes:N,indices:L}=I.createGeometryData(),B=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),U=new bNt(this._material,N,L,I,a,this._upVectorAlignment,this._stencilWidth,B);U.transformation=I.xform,o.push(U)}if(o.length===0)return null;const d={layerUid:this._context.layer.uid,graphicUid:n},p=new D1({geometries:o,metadata:d}),A=new ny(this,p,o,null,null,ZNt,i);return A.alignedSampledElevation=u.terrainElevation,A.needsElevationUpdates=z2(i.mode),A}};function _Be(t,e,r){switch(e){default:case v2.World:for(const i of t.vertices){ze(ss,i.pos,t.offset),r.worldUpAtPosition(ss,ss),i.setFrameFromUpVector(ss),i.rotationFrameUp=i.frame.up,ti(i.rotationRight,1,0),Oe(ss,i.frame.up,Qe(i.frame.up,i.vLeft)),Ve(ss,i.vLeft,ss),Cc(ss,ss),Ye(ss,ss),Oe(fv,i.frame.up,Qe(i.frame.up,i.vRight)),Ve(fv,i.vRight,fv),Ye(fv,fv),Kt(Twe,i.rotationFrameUp,i.vLeft);const n=Math.sign(Qe(Twe,i.vRight));if(i.rotationAngle=n*(Math.PI-pa(Qe(ss,fv))),Math.abs(i.rotationAngle)>0){const o=fW(Math.cos(.5*i.rotationAngle));nse(i.miterStretch,o-1+1,0,0,1)}const s=Math.PI-i.rotationAngle;i.maxStretchDistance=Math.abs(i.vMinSiblingLength/Math.cos(.5*s))}break;case v2.Path:ze(ss,t.vertices[0].pos,t.offset),r.worldUpAtPosition(ss,ss),PNt(t,ss);for(const i of t.vertices){const n=Math.sign(Qe(i.frame.right,i.vRight));Kt(i.rotationFrameUp,i.vRight,i.vLeft),Oe(i.rotationFrameUp,i.rotationFrameUp,n),Ye(i.rotationFrameUp,i.rotationFrameUp);const s=Qe(i.rotationFrameUp,i.frame.up),o=Qe(i.rotationFrameUp,i.frame.right);if(Oe(ss,i.frame.up,-o),Oe(fv,i.frame.right,s),ze(ss,ss,fv),Ye(ss,ss),ENt(i.rotationRight,i.frame,ss),Cc(ss,i.vLeft),i.rotationAngle=-n*(Math.PI-pa(Qe(ss,i.vRight))),Math.abs(i.rotationAngle)>0){const l=fW(Math.cos(.5*i.rotationAngle));nse(i.miterStretch,1+(l-1)*i.rotationRight[0]*i.rotationRight[0],(l-1)*i.rotationRight[0]*i.rotationRight[1],(l-1)*i.rotationRight[0]*i.rotationRight[1],1+(l-1)*i.rotationRight[1]*i.rotationRight[1])}const a=Math.PI-i.rotationAngle;i.maxStretchDistance=Math.abs(i.vMinSiblingLength*fW(Math.cos(.5*a)))}}}function xwe(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function XNt(t,e,r,i){let n=0;for(const s of t.vertices)r(s.posES,vX),n+=vX.sampledElevation,ze(ss,s.pos,t.offset),i.setAltitude(ss,vX.z),Ve(s.pos,ss,t.offset);return t.updatePathVertexInformation(),n/t.vertices.length}function ZNt(t,e,r,i,n){const s=t.stageObject,o=s.geometries;let a=0;JNt.spatialReference=n.spatialReference;for(const l of o){if(!cBe(l))continue;const c=l.path,u=c.builder.path,d=l.geometrySR;vBe.spatialReference=d,a+=XNt(u,e,i,n),l.upVectorAlignment!==v2.World&&_Be(u,l.upVectorAlignment,n),c.onPathChanged(),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(l)}return a/o.length}const JNt=$1(0,0,0,null),vBe=$1(0,0,0,null),ss=G(),fv=G(),Twe=G(),vX=new lF;function KNt(t,e,r,i,n=1){if(r.isGeographic&&i===wt.Global){const c=yd(e.length),u=e.length,d=ln(r);for(let p=0;p<u;p+=3)_ce(e,p,c,p,d);e=c}ti(ta,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)ta[0]=Math.min(ta[0],e[c]),ta[1]=Math.min(ta[1],e[c+1]);const s=ta[0]%n,o=ta[1]%n,a=ta[0]-s,l=ta[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/n,t[u+1]=(e[c+1]-l)/n,t[u+2]=a/n,t[u+3]=l/n}}function bBe(t,e,r,i,n=1){Le(Xw,1,0,0),Le(Zw,0,1,0),Le(M3,0,0,1),rFt(bX,r),eFt(r,Swe)&&tFt(Swe,Xw,Zw,M3,i,bX),ti(ta,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),ti(Jw,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<r.length;u+=3){Le(C3,r[u],r[u+1],r[u+2]);const d=Qe(Xw,C3),p=Qe(Zw,C3);ta[0]=Math.min(ta[0],d),ta[1]=Math.min(ta[1],p),Jw[0]=Math.max(Jw[0],d),Jw[1]=Math.max(Jw[1],p)}const s=Qe(M3,bX);xX(mv,ta[0],ta[1],s,Xw,Zw,M3),xX(Kw,Jw[0],ta[1],s,Xw,Zw,M3),xX(ex,ta[0],Jw[1],s,Xw,Zw,M3),Ve(Kw,Kw,mv),Oe(Kw,Kw,.5),Ve(ex,ex,mv),Oe(ex,ex,.5),ze(mv,mv,Kw),ze(mv,mv,ex);const o=ta[0]%n,a=ta[1]%n,l=ta[0]-o,c=ta[1]-a;for(let u=0;u<r.length;u+=3){Le(C3,r[u],r[u+1],r[u+2]);const d=u/3,p=4*d;t[p]=(Qe(Xw,C3)-l)/n,t[p+1]=(Qe(Zw,C3)-c)/n,t[p+2]=l/n,t[p+3]=c/n;const A=9*d;for(let v=0;v<3;v++)e[A+v]=mv[v],e[A+v+3]=Kw[v],e[A+v+6]=ex[v]}}const bX=G(),C3=G(),Swe=Xi(),Xw=G(),Zw=G(),M3=G(),ta=Ft(),Jw=Ft(),mv=G(),Kw=G(),ex=G();function eFt(t,e){const r=t.length/3-1;return o4e(t,e,0,Math.floor(r/3),Math.floor(r*(2/3)))}function tFt(t,e,r,i,n,s){M(n)?(n.basisMatrixAtPosition(s,fg),Le(m9,fg[0],fg[1],fg[2]),Le(g9,fg[4],fg[5],fg[6]),Le(wX,fg[8],fg[9],fg[10])):(Le(m9,1,0,0),Le(g9,0,1,0),Le(wX,0,0,1));const o=t;Qe(o,wX)<0&&Oe(o,o,-1),Pe(i,o);const a=Qe(o,g9),l=Qe(o,m9);Math.abs(a)<Math.abs(l)?(PT(e,m9,o,-l),Ye(e,e),Kt(r,e,o),Ye(r,r),Oe(r,r,-1)):(PT(r,g9,o,-a),Ye(r,r),Kt(e,r,o),Ye(e,e))}const fg=ht(),m9=G(),g9=G(),wX=G();function rFt(t,e){Le(HI,0,0,0);for(let r=0;r<e.length-3;r+=3)HI[0]+=e[r],HI[1]+=e[r+1],HI[2]+=e[r+2];Oe(t,HI,1/(e.length/3-1))}const HI=G();function xX(t,e,r,i,n,s,o){Le(t,e*n[0]+r*s[0]+i*o[0],e*n[1]+r*s[1]+i*o[1],e*n[2]+r*s[2]+i*o[2])}function iFt(t){const e=new Ui,{vertex:r,fragment:i}=e,n=t.output===ne.Depth,s=t.hasMultipassTerrain&&(t.output===ne.Color||t.output===ne.Alpha);return pd(r,t),e.include(uh,t),e.include(RE,t),e.include(rH,t),e.attributes.add(z.POSITION,"vec3"),e.varyings.add("vpos","vec3"),s&&e.varyings.add("depth","float"),n&&(e.include(h1,t),jS(e),N2(e)),r.code.add(D`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${s?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${n?D`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:D`transformPosition(proj, view, vpos);`}
    }
  `),e.include(To,t),s&&e.include(Sp,t),i.include(ry),i.uniforms.add(new pi("eColor",o=>o.color)),t.output===ne.Highlight&&e.include(P1,t),i.code.add(D`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${t.hasVertexColors?"vColor * eColor;":"eColor;"}

    ${t.output===ne.ObjectAndLayerIdColor?D`fColor.a = 1.0;`:""}

    if (fColor.a < ${D.float(Jl)}) {
      discard;
    }

    ${t.output===ne.Alpha?D`gl_FragColor = vec4(fColor.a);`:""}

    ${t.output===ne.Color?D`gl_FragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===dr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${t.output===ne.Highlight?D`outputHighlight();`:""};
    ${t.output===ne.Depth?D`outputDepth(linearDepth);`:""};
    ${t.output===ne.ObjectAndLayerIdColor?D`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const nFt=Object.freeze(Object.defineProperty({__proto__:null,build:iFt},Symbol.toStringTag,{value:"Module"}));let wBe=class xBe extends qi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2}initializeProgram(e){return new zi(e.rctx,xBe.shader.get().build(this.configuration),Di)}_createPipeline(e,r){const i=this.configuration,n=e===dr.NONE,s=e===dr.FrontFace;return Pr({blending:i.output!==ne.Color&&i.output!==ne.Alpha||!i.transparent?null:n?_p:I1(e),culling:Ij(i.cullFace),depthTest:{func:cw(e)},depthWrite:(n||s)&&i.writeDepth?_h:null,colorWrite:Gr,stencilWrite:i.hasOccludees?VA:null,stencilTest:i.hasOccludees?r?j2:uw:null,polygonOffset:n||s?i.polygonOffset?sFt:null:aH(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};wBe.shader=new Bi(nFt,()=>be(()=>import("./ColorMaterial.glsl-9fc04763.js"),[]));const sFt={factor:1,units:1};let Nh=class extends Xa{constructor(){super(...arguments),this.output=ne.Color,this.cullFace=Vn.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=dr.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1}};h([ae({count:ne.COUNT})],Nh.prototype,"output",void 0),h([ae({count:Vn.COUNT})],Nh.prototype,"cullFace",void 0),h([ae()],Nh.prototype,"hasSlicePlane",void 0),h([ae()],Nh.prototype,"hasVertexColors",void 0),h([ae()],Nh.prototype,"transparent",void 0),h([ae()],Nh.prototype,"polygonOffset",void 0),h([ae()],Nh.prototype,"enableOffset",void 0),h([ae()],Nh.prototype,"writeDepth",void 0),h([ae()],Nh.prototype,"hasOccludees",void 0),h([ae({count:dr.COUNT})],Nh.prototype,"transparencyPassType",void 0),h([ae()],Nh.prototype,"hasMultipassTerrain",void 0),h([ae()],Nh.prototype,"cullAboveGround",void 0),h([ae()],Nh.prototype,"objectAndLayerIdColorInstanced",void 0);let Ewe=class extends kde{constructor(e){super(e,new aFt),this.supportsEdges=!0,this._configuration=new Nh}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<sH,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,r){return r===ne.Color||r===ne.Alpha||r===ne.Highlight||r===ne.Depth&&this.parameters.writeLinearDepth||r===ne.ObjectAndLayerIdColor?e===nt.DRAPED_MATERIAL?!0:r===ne.Highlight?e===nt.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?nt.TRANSPARENT_MATERIAL:nt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:nt.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new oFt(e)}createBufferWriter(){return new SP(Fe("enable-feature:objectAndLayerId-rendering")?H$t:Hke)}},oFt=class extends aw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==ne.Color&&this._output!==ne.Alpha||this._updateOccludeeState(e),this.ensureTechnique(wBe,e)}},aFt=class extends xP{constructor(){super(...arguments),this.color=vA,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Vn.None,this.hasOccludees=!1}};var xl;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(xl||(xl={}));const ose=.70710678118,Cwe=ose,lFt=.08715574274;function cFt(t){const e=new Ui,r=t.hasMultipassTerrain&&(t.output===ne.Color||t.output===ne.Alpha);t.draped||e.extensions.add("GL_OES_standard_derivatives");const{vertex:i,fragment:n}=e;pd(i,t),e.include(uh,t),e.include(RE,t),t.draped?i.uniforms.add(new ut("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):e.attributes.add(z.BOUNDINGRECT,"mat3"),e.attributes.add(z.POSITION,"vec3"),e.attributes.add(z.UVMAPSPACE,"vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r&&e.varyings.add("depth","float");const s=t.style===xl.ForwardDiagonal||t.style===xl.BackwardDiagonal||t.style===xl.DiagonalCross;s&&i.code.add(D`
      const mat2 rotate45 = mat2(${D.float(ose)}, ${D.float(-Cwe)},
                                 ${D.float(Cwe)}, ${D.float(ose)});
    `),t.draped||(Um(i,t),i.uniforms.add(new ut("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),i.code.add(D`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(D`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(D`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${D.float(lFt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(D`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${s?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${s?" * rotate45":""};

      ${t.draped?"":D`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${D.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const o=t.output===ne.Depth;return o&&(e.include(h1,t),jS(e),N2(e)),i.code.add(D`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${o?D`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:D`transformPosition(proj, view, vpos);`}
    }
  `),e.include(To,t),n.include(ry),t.draped&&n.uniforms.add(new ut("texelSize",(a,l)=>1/l.camera.pixelRatio)),t.output===ne.Highlight&&e.include(P1,t),r&&e.include(Sp,t),t.output!==ne.Highlight&&(n.code.add(D`
      const float lineWidth = ${D.float(t.lineWidth)};
      const float spacing = ${D.float(t.patternSpacing)};
      const float spacingINV = ${D.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||n.code.add(D`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.uniforms.add(new pi("uColor",a=>a.color)),n.code.add(D`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${t.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${t.output!==ne.Highlight?D`color.a *= ${uFt(t)};`:""}

      ${t.output===ne.ObjectAndLayerIdColor?D`color.a = 1.0;`:""}

      if (color.a < ${D.float(Jl)}) {
        discard;
      }

      ${t.output===ne.Alpha?D`gl_FragColor = vec4(color.a);`:""}

      ${t.output===ne.Color?D`gl_FragColor = color; ${t.transparencyPassType===dr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${t.output===ne.Highlight?D`outputHighlight();`:""}
      ${t.output===ne.Depth?D`outputDepth(linearDepth);`:""};
    }
  `),e}function uFt(t){function e(r){return t.draped?D`coverage(vuv.${r}, texelSize)`:D`sample(vuv.${r})`}switch(t.style){case xl.ForwardDiagonal:case xl.Horizontal:return e("y");case xl.BackwardDiagonal:case xl.Vertical:return e("x");case xl.DiagonalCross:case xl.Cross:return D`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const hFt=Object.freeze(Object.defineProperty({__proto__:null,build:cFt},Symbol.toStringTag,{value:"Module"}));let TBe=class SBe extends qi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2}initializeProgram(e){return new zi(e.rctx,SBe.shader.get().build(this.configuration),EBe)}_setPipelineState(e,r){const i=this.configuration,n=e===dr.NONE,s=e===dr.FrontFace;return Pr({blending:i.output===ne.Color||i.output===ne.Alpha?n?_p:I1(e):null,culling:Ij(i.cullFace),depthTest:{func:cw(e)},depthWrite:n?i.writeDepth?_h:null:nH(e),colorWrite:Gr,stencilWrite:i.hasOccludees?VA:null,stencilTest:i.hasOccludees?r?j2:uw:null,polygonOffset:n||s?i.polygonOffset?dFt:null:aH(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};TBe.shader=new Bi(hFt,()=>be(()=>import("./Pattern.glsl-9ba7298c.js"),[]));const dFt={factor:1,units:1};let su=class extends Xa{constructor(){super(...arguments),this.output=ne.Color,this.cullFace=Vn.None,this.transparencyPassType=dr.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};h([ae({count:ne.COUNT})],su.prototype,"output",void 0),h([ae({count:Vn.COUNT})],su.prototype,"cullFace",void 0),h([ae({count:xl.COUNT})],su.prototype,"style",void 0),h([ae({count:dr.COUNT})],su.prototype,"transparencyPassType",void 0),h([ae()],su.prototype,"hasSlicePlane",void 0),h([ae()],su.prototype,"hasVertexColors",void 0),h([ae()],su.prototype,"polygonOffset",void 0),h([ae()],su.prototype,"writeDepth",void 0),h([ae()],su.prototype,"hasOccludees",void 0),h([ae()],su.prototype,"patternSpacing",void 0),h([ae()],su.prototype,"lineWidth",void 0),h([ae()],su.prototype,"enableOffset",void 0),h([ae()],su.prototype,"draped",void 0),h([ae()],su.prototype,"hasMultipassTerrain",void 0),h([ae()],su.prototype,"cullAboveGround",void 0);const EBe=new Map([[z.POSITION,0],[z.COLOR,3],[z.UVMAPSPACE,4],[z.BOUNDINGRECT,5]]);let Kde=class extends kde{constructor(e){super(e,new mFt),this.supportsEdges=!0,this._vertexAttributeLocations=EBe,this._configuration=new su}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<sH,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,r){return r===ne.Color||r===ne.Alpha||r===ne.Highlight||r===ne.Depth&&this.parameters.writeLinearDepth?e===nt.DRAPED_MATERIAL?!0:r===ne.Highlight?e===nt.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?nt.TRANSPARENT_MATERIAL:nt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new pFt(e)}createBufferWriter(){const e=Cs().vec3f(z.POSITION).vec4u8(z.COLOR).vec4f(z.UVMAPSPACE);return this.parameters.draped||e.mat3f(z.BOUNDINGRECT),new fFt(e)}},pFt=class extends aw{_updateParameters(e){return this.ensureTechnique(TBe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==ne.Color&&this._output!==ne.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},fFt=class extends SP{write(e,r,i,n,s){for(const o of this.vertexBufferLayout.fieldNames){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case z.POSITION:{tr(a.size===3);const c=n.getField(o,Wn);c&&tH(l,a.data,e,c,s);break}case z.COLOR:{tr(a.size===3||a.size===4);const c=n.getField(o,Ic);c&&pde(l,a.data,a.size,c,s);break}case z.UVMAPSPACE:{tr(a.size===4);const c=n.getField(o,Ad);c&&xO(l,a.data,c,s);break}case z.BOUNDINGRECT:{tr(a.size===9);const c=n.getField(o,F2);c&&this.writeBoundingRect(l,a.data,e,c,s);break}}}}writeBoundingRect(e,r,i,n,s){const o=i,a=n.typedBuffer,l=n.typedBufferStride,c=e.length;s*=l;for(let u=0;u<c;++u){const d=9*e[u],p=r[d],A=r[d+1],v=r[d+2];a[s]=o[0]*p+o[4]*A+o[8]*v+o[12],a[s+1]=o[1]*p+o[5]*A+o[9]*v+o[13],a[s+2]=o[2]*p+o[6]*A+o[10]*v+o[14];for(let b=3;b<9;++b)a[s+b]=r[d+b];s+=l}}},mFt=class extends xP{constructor(){super(...arguments),this.color=Fr(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Vn.None,this.hasOccludees=!1,this.style=xl.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function gFt(t,e,r){return yFt(AFt(t),e,r)}function AFt(t){return t&&t.pattern||null}function yFt(t,e,r){return M(t)?t.style==="none"||t.style==="solid"?(t.style==="none"&&(e.color=Fr(0,0,0,0),e.transparent=!0),new Ewe(e)):(e.style=_Ft(t.style),e.draped=r.isDraped,new Kde(e)):new Ewe(e)}function _Ft(t){switch(t){case"horizontal":return xl.Horizontal;case"vertical":return xl.Vertical;case"cross":return xl.Cross;case"forward-diagonal":return xl.ForwardDiagonal;case"backward-diagonal":return xl.BackwardDiagonal;case"diagonal-cross":return xl.DiagonalCross;default:return}}function vFt(t){return t.material instanceof Kde&&!t.material.parameters.draped}function bFt(t,e){if(vFt(t)){const r=t.vertexAttributes.get(z.POSITION).data,i=t.getMutableAttribute(z.UVMAPSPACE).data,n=t.getMutableAttribute(z.BOUNDINGRECT).data;bBe(i,n,r,e)}}function wFt(t,e,r,i,n){const s=G7e(t,e,r,i,n),o=t.stageObject.geometries;for(const a of o)bFt(a,n);return s}const xFt=["polyline","polygon","extent"];let CBe=class MBe extends sy{constructor(e,r,i,n){super(e,r,i,n),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(M(this._material))return;const e=Oa(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(e);this._material=gFt(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof Kde,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(M(this._outlineMaterial)||!this._isValidOutline(e))return;this._hasOutline=!0;const r=i=>{const n=LUe(e.pattern);return new PM({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:n,stippleScaleWithLineWidth:!0,cap:Kne(e.patternCap||"butt")})};this._outlineMaterial=r(El(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return M(e)&&e.size!=null&&e.size>0&&M(e.color)&&(k(e.pattern)||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,xFt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(r,new Wm);return this.ensureDrapedStatus(n.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,n)}layerOpacityChanged(){if(M(this._material)){const e=this._material.parameters.color,r=Oa(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(r);this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(M(this._outlineMaterial)){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=aF(MBe.elevationModeChangeTypes,i,n);if(s!==Hs.UPDATE)return s;const o=t0(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){if(M(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),M(this._outlineMaterial)){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,r,i){var u;const n=$L(e.geometry);if(k(n))return null;const s=Hde(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new TFt(s,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=xo(4*a,!0),o.boundingRect=yd(9*a,!0),bBe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(u=this._context.stage.renderView)==null?void 0:u.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,n.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new D1({geometries:o.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),c=new ny(this,l,o.outGeometries,null,null,wFt,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=t0(i.mode),c}_createAs3DShapeFill(e){const r=e.renderData.polygons;for(const{position:i,mapPositions:n,holeIndices:s,index:o,count:a}of r){if(M(this._context.clippingExtent)&&(qn(Up),up(Up,n),!hm(Up,this._context.clippingExtent)))continue;const l=V2(n,s,3);if(l.length===0)continue;const c=n2e({material:this._material,indices:l,mapPositions:n,attributeData:{position:i,color:e.color,uvMapSpace:this._needsUV?K1e(e.uvMapSpace,4*o,4*a):null,boundingRect:this._needsUV?Ff(e.boundingRect,9*o,9*a):null,objectAndLayerIdColor:e.objectAndLayerIdColor}});e.outGeometries.push(c)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:n,position:s}=r[i];if(M(this._context.clippingExtent)&&(qn(Up),up(Up,n),!hm(Up,this._context.clippingExtent)))continue;const o=ese(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:n,attributeData:{position:s}},e.objectAndLayerIdColor),a=o.vertexAttributes.get(z.POSITION);a.data===s&&(a.data=yTt(s)),e.outGeometries.push(o)}}_createAsOverlay(e,r){var a;const i=$L(e.geometry);if(k(i))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,M(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const n=lUe(i,this._context.overlaySR),s=new SFt(n,r,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=xo(4*o,!0),KNt(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=qn(),s.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(s),this._createAsOverlayFill(s),this._hasOutline&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,i.rings,"rings","FillSymbol3DLayer"),s.outGeometries.length===0?null:new mH(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e){const r=e.renderData.polygons;for(const{position:i,holeIndices:n,index:s,count:o}of r){const a=qn(Up);if(up(a,i),!hm(a,this._context.clippingExtent))continue;const l=V2(i,n,3);if(l.length===0)continue;YR(e.outBoundingBox,a);const c=n2e({material:this._material,indices:l,attributeData:{position:i,color:e.color,uvMapSpace:this._needsUV?K1e(e.uvMapSpace,4*s,4*o):null,objectAndLayerIdColor:e.objectAndLayerIdColor}}),u=new CO(c,e);pn(u.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(u)}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:n}=r[i];if(qn(Up),up(Up,n),!hm(Up,this._context.clippingExtent))continue;YR(e.outBoundingBox,Up);const s=ese(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:n}},e.objectAndLayerIdColor),o=new CO(s,e),a=Up;pn(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(o)}}_getOutlineOpacity(){const e=Oa(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(M(e)?e.a:0)}_getOutlineColor(){const e=Oa(this.symbolLayer,"outline","color"),r=this._getOutlineOpacity();return Q5(M(e)?$t.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};CBe.elevationModeChangeTypes={definedChanged:Hs.RECREATE,staysOnTheGround:Hs.NONE,onTheGroundChanged:Hs.RECREATE};const Up=fa();let TFt=class extends hH{constructor(e,r,i,n){super(e,i,n),this.color=r}},SFt=class extends hH{constructor(e,r,i,n){super(e,i,n),this.color=r}},RBe=class OBe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){const i=Oa(e,"material","color"),n=tp(i,vA,$t.toUnitRGBA),s=tp(e.size,12,El),o=e.lineHeight,a=M(e.background)?$t.toUnitRGBA(e.background.color):vA,l={family:tp(e.font,"sans-serif",A=>A.family),decoration:tp(e.font,"none",A=>A.decoration),weight:tp(e.font,"normal",A=>A.weight),style:tp(e.font,"normal",A=>A.style)},c=e.halo,u=M(c)&&M(c.color)&&c.size>0?{size:El(c.size),color:$t.toUnitRGBA(c.color)}:{size:0,color:vA},d=new OBe({color:n,size:s,background:{color:a,padding:M(e.background)?[.65*s,.5*s]:[0,0],borderRadius:M(e.background)?s*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:r}),p=d.fontString(s);try{await document.fonts.load(p)}catch{we.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${p}'. Some text symbology may be rendered using the default browser font.`)}return d}},EFt=class{constructor(e,r,i){this._renderer=new SUe(e,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=Xne(CFt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new ME(e,{wrap:{s:Ar.CLAMP_TO_EDGE,t:Ar.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:m2.PAD})}};const CFt={canvas:null},MFt=[0,0,1];let RFt=class extends sy{constructor(e,r,i,n){super(e,r,i,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=lH(this.symbolLayer.size);if(e)throw new pe("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await RBe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=IL(r.geometry);if(k(i))return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const n=this.symbolLayer.text;if(k(n)||n==="")return null;const s=dce(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(M(s)&&!TIe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new B7e(s,this.symbolLayer.horizontalAlignment,T5t(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,n,o)}createLabel(e,r,i,n){const s=e.graphic,o=IL(s.geometry);if(k(o))return this.logger.warn(`unsupported geometry type for label: ${s.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(s,o,a,r,i,n)}setGraphicElevationContext(e,r,i=0){const n=super.setGraphicElevationContext(e,r);return n.addOffsetRenderUnits(i),n}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return Mwe(e,r,(i,n)=>{this.updateGraphicElevationContext(n,i)}),Hs.UPDATE}slicePlaneEnabledChanged(e,r){return Mwe(e,r,i=>{for(const n of i.stageObject.geometries)n.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}skipHighSymbolLodsChanged(){return!0}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,M(r.metadata)?r.metadata.elevationOffset:0),r.needsElevationUpdates=t0(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return PFt}_createAs3DShape(e,r,i,n,s,o){const a=this.setGraphicElevationContext(e,new Wm,n.elevationOffset),l=Oa(e.geometry,"type")==="polyline",c=e.uid;let u=null,d=null;if(k(o)){const U=CUe(n.horizontalPlacement);u=new EFt(i,U,this._textRenderParameters);let q=null;if(M(this._context.sharedResources.textures)){d=this._context.sharedResources.textures.fromData(u.key,()=>u.create(),()=>{M(q)&&q.release()});const Z=this._context.stage.renderView.textureRepository.acquire(d.texture.id);if(k(Z)||Op(Z))return d.release(),null;q=Z}}const p=OFt(u,n),A={occlusionTest:!0,screenOffset:n.screenOffset,anchorPosition:p,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.centerOffsetUnits,drawInSecondSlot:!0};if(M(o)?A.textureId=o.id:M(d)&&(A.textureId=d.texture.id),M(n.verticalOffset)){const{screenLength:U,minWorldLength:q,maxWorldLength:Z}=n.verticalOffset;A.verticalOffset={screenLength:El(U),minWorldLength:q||0,maxWorldLength:M(Z)?Z:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:U,screenSizePerspectiveSettingsLabels:q}=this._context.sharedResources;A.screenSizePerspective=q.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),A.screenSizePerspectiveAlignment=U}let v;if(l&&(A.shaderPolygonOffset=1e-4),A.hasSlicePlane=this._context.slicePlaneEnabled,M(s)){const U=JSON.stringify(A);v=s.get(U),k(v)&&(v=new TO(A),s.add(U,v))}else v=new TO(A);const b=n.translation,S=M(u)?Gi(u.displayWidth,u.displayHeight):yh,E=n.centerOffset,R=Ane(v,MFt,b,null,S,E,[0,0],null),O=Rde(this._context,r,R,a,c);if(k(O))return null;const I=new ny(this,O.object,[R],k(s)?[v]:null,d,OL,a);I.alignedSampledElevation=O.sampledElevation,I.needsElevationUpdates=t0(a.mode)||a.mode==="absolute-height";const{displayWidth:N,displayHeight:L}=M(u)?u:n;I.getScreenSize=(U=Ft())=>(U[0]=N,U[1]=L,U);const B=new X7e(n.elevationOffset,i);return I.metadata=B,PL(I,r,this._context.elevationProvider),I}};function Mwe(t,e,r){t&&t.forEach(i=>{const n=e(i);M(n)&&r(n,i.graphic)})}function OFt(t,e){if(e.verticalPlacement==="baseline"){const i=b5t[e.horizontalPlacement],n=M(t)?t.baselineAnchorY:0;return Gi(i,n)}const r=x5t(e.horizontalPlacement,e.verticalPlacement);return sU[r]}const PFt={mode:"relative-to-ground",offset:0},IFt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},$Ft=["polyline","polygon","extent"];let ase=class Kx extends sy{constructor(e,r,i,n){super(e,r,i,n)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,$Ft,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Wm);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(M(this._material))return;const e=new Jke,r=this.symbolLayer.color;M(r)&&(e.color=$t.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=M(this.symbolLayer.waveDirection)?Kx.headingVectorFromAngle(this.symbolLayer.waveDirection):Gi(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=IFt[n];e.waveStrength=s.waveStrength,e.waveTextureRepeat=s.textureRepeat,e.waveVelocity=s.waveVelocity,e.flowStrength=s.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new Zke(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(k(this._material))return;const e=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=aF(Kx.elevationModeChangeTypes,i,n);if(s!==Hs.UPDATE)return s;const o=t0(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return M(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,r,i){const n=$L(e.geometry);if(k(n))return null;const s=Hde(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=s.position.length/3,a=yd(2*o);this._createUVCoordsFromVertices(a,s.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new DFt(s,a);if(this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,n.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new D1({geometries:l.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),u=new ny(this,c,l.outGeometries,null,null,G7e,r);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=t0(r.mode),u}_createUVCoordsFromVertices(e,r,i,n){const s=Eu(n);Yf(gv);for(let l=0;l<i;l++)ti(Rwe,r[3*l],r[3*l+1]),rce(gv,Rwe);YO(gv,gv,s);const o=gv[0]%Kx.unitSizeOfTexture,a=gv[1]%Kx.unitSizeOfTexture;A9[0]=gv[0]-o,A9[1]=gv[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*s-A9[0])/Kx.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*s-A9[1])/Kx.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:n,index:s,position:o,mapPositions:a,holeIndices:l}of r){if(M(this._context.clippingExtent)&&(qn(Av),up(Av,a),!hm(Av,this._context.clippingExtent)))continue;const c=V2(a,l,3);if(c.length===0)continue;const u=Ff(i,2*s,2*n),d=s2e({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:u}});e.outGeometries.push(d)}}_createAsOverlay(e){const r=$L(e.geometry);if(k(r))return null;this._material.renderPriority=this._renderPriority;const i=lUe(r,this._context.overlaySR),n=i.position.length/3,s=yd(2*n);this._createUVCoordsFromVertices(s,i.position,n,this._context.overlaySR);const o=new LFt(i,s,this._context.layer.uid,e.uid);return o.outBoundingBox=qn(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new mH(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:n,holeIndices:s,index:o,count:a}of i){if(qn(Av),up(Av,n),!hm(Av,this._context.clippingExtent))continue;YR(e.outBoundingBox,Av);const l=V2(n,s,3);if(l.length===0)continue;const c=Ff(r,2*o,2*a),u=s2e({material:this._material,indices:l,attributeData:{position:n,uv0:c}}),d=new CO(u,e),p=Av;pn(d.boundingSphere,.5*(p[0]+p[3]),.5*(p[1]+p[4]),0,.5*Math.sqrt((p[3]-p[0])*(p[3]-p[0])+(p[4]-p[1])*(p[4]-p[1]))),e.outGeometries.push(d)}}static headingVectorFromAngle(e){const r=Ft(),i=SG(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};ase.unitSizeOfTexture=100,ase.elevationModeChangeTypes={definedChanged:Hs.RECREATE,staysOnTheGround:Hs.NONE,onTheGroundChanged:Hs.RECREATE};const A9=Ft(),gv=oi(),Rwe=Ft(),Av=fa();let DFt=class extends hH{constructor(e,r){super(e,null,null),this.uvCoords=r}},LFt=class extends hH{constructor(e,r,i,n){super(e,i,n),this.uvCoords=r}};function NFt(t,e,r,i){const n=Owe[t.type]&&Owe[t.type][e.type]||FFt[e.type];return n?new n(t,e,r,i):(we.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const FFt={icon:Jne,object:eNt,line:NUe,path:YNt,fill:CBe,extrude:o5t,text:RFt,water:ase},Owe={"mesh-3d":{fill:NDt}};let kFt=class extends Ede{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const n=this.symbolLayers[i];M(n)&&(n.symbol=e,n.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const n=[];for(let s=0;s<i;s++){const o=r.getItemAt(s);if(o.enabled===!1)continue;y9.renderPriority=1-(1+s)/i,y9.renderPriorityStep=1/i,y9.ignoreDrivers=o._ignoreDrivers;const a=NFt(this.symbol,o,this._context,y9),l=Wae(e,()=>{this.symbolLayers[s]=null,a.destroy()});l&&n.push(l),this.symbolLayers[s]=a}if(await wG(this.symbolLayers,async(s,o)=>{if(M(s))try{await s.load(),this._extentPadding+=Math.max(this._extentPadding,s.extentPadding)}catch{this.symbolLayers[o]=null}}),n.forEach(s=>s.remove()),fi(e),this.symbolLayers.length&&!this.symbolLayers.some(s=>!!s))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return M(r)?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>M(e)&&e.queryForSnapping)}createGraphics3DGraphic(e,r){const i=e.graphic,n=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];n[o]=M(a)?a.createGraphics3DGraphic(e):null}const s=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new IIt(i,r||this,n,e.layer,s)}get complexity(){return Mde(this.symbolLayers.map(e=>Oa(e,"complexity")))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let n=0;n<i;n++){const s=this.symbolLayers[n],o=a=>{const l=a.layers[n];return l instanceof ny?l:null};if(M(s)&&!s.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==ep.LOADED?ua.Recreate_Symbol:this.symbolLayers.reduce((i,n)=>i!==ua.Recreate_Symbol&&M(n)?Math.min(i,n.applyRendererDiff(e,r)):i,ua.Fast_Update)}prepareSymbolPatch(e){if(this.loadStatus===ep.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(k(n))return;const o=i[s];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[s];M(u)&&a.graphics3DGraphicPatches.forEach(d=>d(u,c))})}})}updateGeometry(e,r){for(let i=0;i<this.symbolLayers.length;i++){const n=this.symbolLayers[i];if(k(n))continue;const s=e.layers[i];if(k(s)||!n.updateGeometry(s,r))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(k(i))continue;const n=e.layers[r];M(n)&&i.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(n=>{k(n)||(n.loadStatus===ep.LOADING?e++:n.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,n){const s=this.symbolLayers.filter(M).filter(a=>M(a.queryForSnapping)).map(a=>a.queryForSnapping(e,r,i,n)),o=await Promise.all(s);return fi(n),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)M(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const y9={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};let UFt=class extends Ede{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return M(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return M(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return M(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),M(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return M(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return M(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:Cde}globalPropertyChanged(e,r){return!!M(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return M(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(e,r):ua.Recreate_Symbol}prepareSymbolPatch(e){M(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return!!M(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,r)}onRemoveGraphic(){}getFastUpdateStatus(){return M(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){M(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function epe(t){return t instanceof UFt?t.graphics3DSymbol:t instanceof kFt?t:null}const UL=we.getLogger("esri.views.3d.layers.graphics.labelPlacement");function BFt(t){const e=YFt(t);if(k(e))return null;const r=zFt(t,e);if(k(r))return null;const i=r.anchor,n=!!e.hasLabelVerticalOffset;return GFt({anchor:i,verticalOffset:e.verticalOffset,screenOffset:Ft(),centerOffset:Fr(0,0,0,-1),centerOffsetUnits:"world",translation:G(),elevationOffset:0,hasLabelVerticalOffset:n},r,t)}function zFt(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=Am[r],n=i||Jz(t);return r&&!i&&UL.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),VFt(n,t)}function tpe(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=epe(e);return M(r)?r.symbol.symbolLayers.getItemAt(0):null}function VFt(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(k(r))return null;if(M(e.disablePlacement))return e.labelClass.labelPlacement?(UL.warnOncePerTick(Pwe(t.placement,e.disablePlacement.logEntityDescription)),Jz(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return UL.warnOncePerTick(Pwe(t.placement,`'${i}' geometries`)),Jz(e);break;case"point":case"mesh":return t}return t}function Pwe(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function Jz(t){const e=t.graphics3DGraphic.graphic.geometry;if(k(e))return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=tpe(t);return M(r)&&r.type==="extrude"?Am["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Am["above-center"];default:return}}function GFt(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(k(i))return null;switch(i.type){case"point":HFt(t,e,r);break;case"polygon":jFt(t,e,r);break;case"mesh":rpe(t,e,r.graphics3DGraphic.layers[0])}return t}function jFt(t,e,r){const i=tpe(r);if(!k(i))switch(i.type){case"extrude":{const n=r.graphics3DGraphic.layers[0];M(n)?(n.getBoundingBoxObjectSpace(rD),um(rD,t.translation),t.translation[2]=rw(rD)/2):Le(t.translation,0,0,0),rpe(t,e,n);break}}}function HFt(t,e,r){const i=tpe(r);if(k(i))return;const n=r.graphics3DGraphic.layers[0];switch(M(n)?n.getCenterObjectSpace(t.translation):Le(t.translation,0,0,0),i.type){case"icon":case"text":qFt(t,e,r,n);break;case"object":rpe(t,e,n)}}function qFt(t,e,r,i){const{graphics3DGraphic:n}=r,s=M(i)?i.getScreenSize():null;if(!n.isDraped&&M(s)){const o=WFt(r);qI[0]=s[0]/2*(e.normalizedOffset[0]-o[0]),qI[1]=s[1]/2*(e.normalizedOffset[1]-o[1]),t.screenOffset[0]=qI[0],t.hasLabelVerticalOffset?(t.centerOffset[1]=qI[1],t.centerOffsetUnits="screen"):t.screenOffset[1]=qI[1]}else t.hasLabelVerticalOffset||t.anchor==="center"||(Am[r.labelClass.labelPlacement]&&UL.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center")}function WFt(t,e=XFt){const{graphics3DGraphic:r}=t,i=r.layers[0],n=M(i)?i.stageObject.geometries[0].material:null;if(n&&n instanceof TO){const s=n.parameters.anchorPosition;e[0]=2*(s[0]-.5),e[1]=2*(s[1]-.5)}else e[0]=0,e[1]=0;return e}function rpe(t,e,r){const i=M(r)?r.getBoundingBoxObjectSpace(rD):rD,n=pt(i[3]-i[0],i[4]-i[1],i[5]-i[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);t.centerOffset[0]=s/2*e.normalizedOffset[0];const o=t.translation[2],a=n[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=ct(n);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function QFt(t){return t==="above-center"}function YFt(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,n=epe(i.graphics3DSymbol),s=rl(n,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Am[e]||Jz(t);return M(s)&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Iwe(s.verticalOffset),anchor:null,normalizedOffset:null}:r&&r.hasVisibleVerticalOffset()&&(k(s)||!s.supportsCallout()||!s.verticalOffset||i.isDraped)?QFt(o.placement)?{placement:"above-center",verticalOffset:Iwe(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(UL.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function Iwe(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const Am={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},$we={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in $we){const e=$we[t],r=Am[t];e.forEach(i=>{Am[i]=r})}Object.freeze&&(Object.freeze(Am),Object.keys(Am).forEach(t=>{Object.freeze(Am[t]),Object.freeze(Am[t].normalizedOffset)}));const qI=[0,0],XFt=[0,0],rD=fa();let Dwe=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const TX=512,SX=4096,ZFt=.85,JFt=.95;let KFt=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=Kr()}},e6t=class{constructor(e,r){this.textId=e,this.textRenderer=r,this.placement=new KFt,this.rendered=!1}},N4=class extends rt{constructor(e){super(e),this.type=lo.Texture,this.id=hd(),this.events=new Ws,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._stage=this.view._stage,this._canvas=this._create2DCanvas(),this._ctx=this._canvas.getContext("2d"),this._stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=kt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this._atlas.size.width}get height(){return this._atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,flipped:!0,samplingMode:zt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return M(this._glTexture)||(this._glTexture=new Xt(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(ar.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=ps(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=kt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",TX.toString()),e.setAttribute("height",TX.toString()),e}_update2DCanvasSize(){this._canvas.setAttribute("width",this._atlas.size.width.toString()),this._canvas.setAttribute("height",this._atlas.size.height.toString())}_createAtlasRegion(e=TX){this._atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,r){let i=Math.max(e,r);return i+=256,i=VR(i),i=Math.min(i,SX),i}_resizeAtlas(e,r){r=r||e;const i=this._atlas;i.size.width=e,i.size.height=r,M(this._glTexture)&&this._glTexture.resize(e,r),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this._atlas;e.cursor.x=WI,e.cursor.y=WI+Lwe,e.lineHeight=0,this._needsClear=!0}_getAtlasUsage(){const e=this._atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this._elementsToRemove.size,r=this._elementsToAddOrUpdate.size,i=this._elements.size;return this._getAtlasUsage()/i*(i+r-e)}_addAtlasElement(e,r,i,n){const s=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,pn(e.placement.uvMinMax,e.placement.offset.x/s.size.width,1-(e.placement.offset.y+a)/s.size.height,(e.placement.offset.x+o)/s.size.width,1-e.placement.offset.y/s.size.height),s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,n),this._elements.set(r,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const r=e.placement.offset;this._ctx.clearRect(r.x,r.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i&&i.delete(r)&&(r.geometries[0].vertexAttributes.get(z.SIZE).data=[0,0],r.geometryVertexAttrsUpdated(r.geometries[0]))}_processAddition(e,r){const i=this._atlas,n=e.textId,s=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=s+WI,l=o+WI+Lwe;if(i.cursor.x+a<i.size.width&&i.cursor.y+l<i.size.height)this._addAtlasElement(e,n,a,l),this._elementsToRender.set(n,e),this._elementsToAddOrUpdate.delete(n);else{if(!(i.cursor.y+l+i.lineHeight<i.size.height)){const c=this._getExpectedAtlasUsage(),u=c>ZFt&&i.size.width<SX;return u&&this._resizeAtlas(2*i.size.width,2*i.size.height),!r||!u&&c>JFt&&i.size.width===SX?(this._processRemovals(),IM.OK):(this._repack(),IM.REPACK)}i.cursor.x=WI,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,n,a,l),this._elementsToRender.set(n,e),this._elementsToAddOrUpdate.delete(n)}return IM.OK}_processRemovals(){this._elementsToRemove.forEach((e,r)=>{const i=this._stageObjects.get(r);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this._stageObjects.delete(r)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,r)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(r,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const r=this._stageObjects.get(e.textId);r&&r.forEach(i=>{i.geometries[0].vertexAttributes.get(z.UV0).data=new Float32Array(e.placement.uvMinMax),i.geometries[0].vertexAttributes.get(z.SIZE).data=[e.textRenderer.displayWidth,e.textRenderer.displayHeight],i.geometryVertexAttrsUpdated(i.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,r=!0){if(k(this._glTexture))return rc.YIELD;let i=!1;if(Ql(this._elementsToAddOrUpdate,(s,o)=>{const a=this._elements.get(o);if(a&&a.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const u=c.geometries[0].vertexAttributes,d=this._elements.get(o);u.get(z.UV0).data=d.placement.uvMinMax,u.get(z.SIZE).data=[d.textRenderer.displayWidth,d.textRenderer.displayHeight],c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),r)===IM.REPACK&&(i=!0,!0)}),i)return this.runTask(pu,!1),void e.madeProgress();let n=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),Ql(this._elementsToRender,(s,o)=>(this._processRenderingRequest(s),this._elementsToRender.delete(o),n=!0,e.madeProgress(),e.done)),n&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&KIt.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,r){const i=e.key;this._elementsToAddOrUpdate.has(i)||this._elementsToAddOrUpdate.set(i,new e6t(i,e)),this._addStageObject(i,r),this._elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,r){const i=e.key;this._elementsToRemove.set(i,this._elements.get(i)),this._removeStageObject(i,r)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((i,n)=>e.push({element:i,key:n}));let r=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){r=!1;break}if(!r||this._elementsToRemove.size){e.sort((i,n)=>i.key.localeCompare(n.key)),this._elements.clear();for(const{element:i,key:n}of e)this._elements.set(n,i);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:r,_elementsToRemove:i,_atlas:n}=this,s=this;return{elements:e,stageObjects:r,elementsToRemove:i,atlas:n,resizeAtlas:(o,a)=>s._resizeAtlas(o,a),run:(o,a)=>s.runTask(o,a)}}};h([f({constructOnly:!0})],N4.prototype,"view",void 0),h([f({type:Boolean})],N4.prototype,"updating",void 0),N4=h([Q("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],N4);const WI=2,Lwe=2;var IM;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(IM||(IM={}));let Nwe=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},t6t=class{constructor(e,r,i,n,s){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=n,this.labelFunction=s,this.calloutSymbolLayerIndex=0}},r6t=class{constructor(e,r,i,n,s,o,a){this.layer=e,this.graphics3DCore=r,this.scaleVisibility=i,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=s,this.disablePlacement=o,this.active=a,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new wke({pickable:!0,disableOctree:!0},e.uid)}},eT=class extends rt{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new cn,this._handles.add([xe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),xe(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(ar.LABELER,this)]),this._textTextureAtlas=new N4({view:this.view}),this._hudMaterialCollection=new Dwe(this.view._stage),this._calloutMaterialCollection=new Dwe(this.view._stage)}dispose(){this._handles=yt(this._handles),this._textTextureAtlas=kt(this._textTextureAtlas),this._hudMaterialCollection=kt(this._hudMaterialCollection),this._calloutMaterialCollection=kt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const n=new Nwe(e,r);this._labels.set(i,n),e.labelsToInitialize.set(i,n),r.setVisibilityFlag(td.USER_SETTING,!0,wl.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(td.USER_SETTING,!1,wl.LABEL),this.setLabelGraphicVisibility(r,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];M(i)&&this._textTextureAtlas.addTextTexture(i,r.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];M(i)&&this._textTextureAtlas.removeTextTexture(i,r.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),rc.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active){if(!Fwe(r)){if(i6t(r)){this._deactivateLabelingContext(r);continue}if(this._createLabelClassContext(r),EX(r)){this._dirty=!0;continue}if(!Fwe(r))continue}Ql(r.labelsToInitialize,(i,n)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(n,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(n),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(r=>this._removeLabelTextureFromAtlas(r)),this._labelsToAdd.forEach(r=>this._addLabelTextureToAtlas(r)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const r=(o=e.labelClassAbortController)==null?void 0:o.signal;await((l=(a=e.layer).when)==null?void 0:l.call(a)),fi(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,n=i.layer,s=n.labelingInfo&&n.labelingInfo.filter(c=>!!c.symbol);!s||s.length===0||(await wG(s,async(c,u)=>{const d=c.symbol,p=epe(i.getOrCreateGraphics3DSymbol(d));if(k(p))return void we.getLogger(this.declaredClass).error("Failed to create Graphics3DSymbol for label");await p.load(),fi(r);let A=null;dce(d)&&d.hasVisibleCallout()&&(A=RIt(d,i.symbolCreationContext),await A.load(),fi(r));const v=await Pm(k7e(c,e.layer.fieldsIndex,this.view.spatialReference));if(fi(r),v.ok===!0){const b=await this._createTextRenderParameters(p.symbol);fi(r),e.labelClassContexts[u]=new t6t(c,p,A,b,v.value)}else we.getLogger(this.declaredClass).error(`Label expression failed to evaluate: ${v.error}`)}),fi(r))}async _createLabelClassContext(e){return k(e.labelClassPromise)&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if($o(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.getItemAt(0);return r&&r.type==="text"?RBe.fromSymbol(r,this.view.state.rasterPixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Gf(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,n,s){const o=new B7e(i.verticalOffset,Y2e(i.anchor),w5t(i.anchor),e.text,i.translation,i.elevationOffset,i.centerOffset,i.screenOffset,i.centerOffsetUnits,e.displayWidth,e.displayHeight);return yv.graphic=r,yv.renderingInfo=null,yv.layer=n,s.createLabel(yv,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,r,i,n,s){return yv.graphic=e,yv.layer=s,yv.renderingInfo=new CIt(null,r,n.translation,n.centerOffset,n.screenOffset,n.centerOffsetUnits,n.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(yv)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,n=i.labelClassContexts;if(!n||n.length===0||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let s=!1;const o=r.graphic,a=i.layer,l=_9(i.layer),c=this.view._stage;for(let u=0;u<n.length;u++){const d=e.textRenderers[u],p=e.textLabelPlacements[u];if(k(d)||k(p))continue;const A=n[u],v=A.graphics3DSymbol,b=v.symbol&&v.symbol.type==="label-3d"?v.symbol:null,S=v.symbolLayers[0];if(!S)continue;S.setElevationInfoOverride(i.elevationInfoOverride);const E=this._createTextSymbolGraphic(d,o,p,a,S);if(k(E))return!1;E._labelClass=A.labelClass,E._labelIndex=u,r.addLabelGraphic(E,c,i.stageLayer),r.setVisibilityFlag(td.USER_SETTING,l,wl.LABEL),r.clearVisibilityFlag(td.SCALE_RANGE,wl.LABEL),r.setVisibilityFlag(td.DECONFLICTION,!1,wl.LABEL),s=!0;const R=A.graphics3DCalloutSymbolLayer;if(R&&p.hasLabelVerticalOffset){R.setElevationInfoOverride(i.elevationInfoOverride);const O=this._createLineCalloutGraphic(o,b,R,p,a);M(O)&&(A.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(O,c,i.stageLayer))}break}return i.scaleVisibility&&s&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const n=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];n!=null&&n.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var s;if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const n=e.graphics3DGraphic.graphic;for(let o=0;o<i.length;o++){const a=i[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,!a.textRenderParameters)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const R=l.needsHydrationToEvaluate()?EPt(n,r.layer):n;c=l.evaluate(R)}catch{c=null}else c=l.evaluate(n);if(k(c)||c===""||/^\s+$/.test(c))continue;const u=a.graphics3DSymbol,d=((s=u.symbol)==null?void 0:s.type)==="label-3d"?u.symbol:null;if(!u.symbolLayers[0])continue;const p=e.graphics3DGraphic,A=a.labelClass,v=r.disablePlacement,b=BFt({graphics3DGraphic:p,labelSymbol:d,labelClass:A,disablePlacement:v});if(k(b))continue;const S=Y2e(b.anchor),E=CUe(S);e.textRenderers[o]=new SUe(c,E,a.textRenderParameters),e.textLabelPlacements[o]=b}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const n=new Nwe(e,r);this._labels.set(i,n),e.labelsToInitialize.set(i,n)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,n=this._labels.get(i);e.graphics.delete(i),n&&(this._destroyGraphic(n,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.has(r)&&(this._labels.delete(r),this._labelsToAdd.delete(r),this._labelsToRemove.delete(r)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const n=e.graphics.get(i);n&&(this._removeGraphic(e,n),this._addGraphic(e,n))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const n=new Map;r.graphics.forEach(o=>n.set(o.graphic.uid,o));const s=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,n,s),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,o)}}}_visibilityInfoChange(e){const r=_9(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const n=this._labels.get(i);n&&(this._destroyGraphic(n,i),n.visible=!1,n.rendered=!1,e.labelsToInitialize.set(i,n))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const n=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,o=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new r6t(a,e,r,n,s,o,_9(a));return this.view._stage.add(l.stageLayer),this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>_9(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(n=>this._removeGraphic(r,n)),this.view._stage.remove(r.stageLayer),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,n=this._labels.get(i);n&&n.visible!==r&&(r&&!n.rendered?(this._labelsToAdd.set(i,n),this._labelsToRemove.delete(i),n.textInitialized||n.labelingContext.labelsToInitialize.set(i,n)):!r&&n.rendered&&(this._labelsToRemove.set(i,n),this._labelsToAdd.delete(i)),n.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(r=>EX(r))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(EX(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function EX(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function Fwe(t){return t.labelClassContexts&&t.labelClassContexts.length}function i6t(t){return t.labelClassContexts===null}function _9(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(r=>!!r.symbol))}h([f({constructOnly:!0})],eT.prototype,"view",void 0),h([f({constructOnly:!0})],eT.prototype,"deconflictor",void 0),h([f()],eT.prototype,"_textTextureAtlas",void 0),h([f({type:Boolean,readOnly:!0})],eT.prototype,"updating",null),eT=h([Q("esri.views.3d.layers.graphics.Labeler")],eT);const yv=new MIt(null,null,null);let F4=class HC{constructor(e,r,i,n=null){this.lij=[0,0,0],this.extent=oi(),this.resolution=0,this.loadPriority=0,this.measures={visibility:gc.VISIBLE_ON_SURFACE,screenRect:oi(),distance:0,shouldSplit:!1},this.used=!1,n&&this.acquire(e,r,i,n)}acquire(e,r,i,n){this.tilingScheme=n,this.id=HC.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,n.getExtent(e,r,i,this.extent),this.resolution=n.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],n=2*this.lij[2];return e?(e[0].acquire(r,i,n,this.tilingScheme),e[1].acquire(r,i+1,n,this.tilingScheme),e[2].acquire(r,i,n+1,this.tilingScheme),e[3].acquire(r,i+1,n+1,this.tilingScheme),e):[new HC(r,i,n,this.tilingScheme),new HC(r,i+1,n,this.tilingScheme),new HC(r,i,n+1,this.tilingScheme),new HC(r,i+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,i1(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var gc;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(gc||(gc={}));const PBe=.5*Math.PI,n6t=PBe/Math.PI*180;let s6t=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:G(),direction:G()};for(let r=0;r<4;r++)this._extent[r]={origin:G(),direction:G(),cap:{next:null,direction:G()}},this._planes[r]=Xi();this._planes[Fn.NEAR]=Xi(),this._planes[Fn.FAR]=Xi(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,n=!0){const s=this._extent;this._toRenderBoundingExtent(e,r,i),ze(this._center.origin,s[0].origin,s[2].origin),Oe(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),n||Oe(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=s[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=s[o===3?0:o+1];a.cap.next=l.origin,y1(a.cap.direction,a.origin,l.origin),rL(a.direction,a.cap.direction,a.origin,this._planes[o]),n||Oe(a.direction,a.direction,-1)}rL(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[Fn.NEAR]),n?ote(this._planes[Fn.NEAR],this._planes[Fn.FAR]):(tj(this._planes[Fn.FAR],this._planes[Fn.NEAR]),ote(this._planes[Fn.NEAR],this._planes[Fn.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*ln(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===wt.Global){const s=this._maxSpanSpatialReference.isGeographic?n6t:PBe*r;if(this._maxSpan>s)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const s=this._extent[0];return!(i||!e.intersectsRay(xp(s.origin,s.direction)))}for(let s=0;s<this._extent.length;s++){const o=this._extent[s];if(!i&&e.intersectsRay(xp(o.origin,o.direction))||e.intersectsLineSegment(eS(o.origin,o.cap.next,a6t),o.cap.direction))return!0}const n=i?this._planes:this._planesWithoutFar;for(let s=0;s<e.lines.length;s++){const o=e.lines[s];if(CEt(n,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){ice(e,A0),A0[2]=i,Lm(r,A0,CX,this._renderCoordsHelper.spatialReference),Ml(kwe,CX),qn(Eh);for(const{x0:s,x1:o,y0:a,y1:l}of o6t)for(let c=0;c<5;c++){const u=c/4;A0[0]=Mr(e[s],e[o],u),A0[1]=Mr(e[a],e[l],u),A0[2]=i,il(A0,r,A0,this._renderCoordsHelper.spatialReference),Ot(A0,A0,kwe),kA(Eh,A0)}Le(this._extent[0].origin,Eh[0],Eh[1],Eh[2]),Le(this._extent[1].origin,Eh[3],Eh[1],Eh[2]),Le(this._extent[2].origin,Eh[3],Eh[4],Eh[2]),Le(this._extent[3].origin,Eh[0],Eh[4],Eh[2]);for(let s=0;s<4;++s)Ot(this._extent[s].origin,this._extent[s].origin,CX)}_toRenderBoundingExtentLocal(e,r,i){ZG(e,r,Ty,this._renderCoordsHelper.spatialReference),Le(this._extent[0].origin,Ty[0],Ty[1],i),Le(this._extent[1].origin,Ty[2],Ty[1],i),Le(this._extent[2].origin,Ty[2],Ty[3],i),Le(this._extent[3].origin,Ty[0],Ty[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case wt.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case wt.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(kn(e.planes[Fn.NEAR],this._center.origin)<0&&Qe(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(kn(e.planes[Fn.NEAR],i.origin)<0&&Qe(i.direction,e.direction)<0)return!0}return!1}};const o6t=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],A0=G(),CX=ht(),kwe=ht(),Eh=fa(),Ty=oi(),a6t=Gm();let l6t=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new Pb(e),this._extendedFrustum=new Pb(e),this._intersector=new s6t({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return gc.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===wt.Global&&e.lij[0]>=c6t&&e.lij[0]<u6t,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==gc.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=Pb.nearFarLineIndices,i=e.mutablePoints;for(const n of r){const[s,o]=n,a=i[s],l=i[o];Ve(Pd,l,a),Oe(Pd,Pd,d6t),ze(i[o],a,Pd)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=gc.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const n=Vwe.acquire();e.getChildren(n);for(const s of n){const o=this.calculate(s);if(o!==gc.INVISIBLE&&(r=o,o===gc.VISIBLE_ON_SURFACE))break}return Vwe.release(n),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const n=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,n),n}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===wt.Global&&e.lij[0]<h6t?this._calculateSingleTileVisibilitySided(e,!1)===gc.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,r){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=ln(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?gc.VISIBLE_ON_SURFACE:gc.VISIBLE_WHEN_EXTENDED:gc.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,Pd);this._aboveGround||Cc(r,r);const i=pa(-Qe(r,e.viewForward));if(this._allTilesInvisible=i>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum))return;const n=this._extendedFrustumParameters(),s=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=n.pointIndices[o],l=s[a],c=this._renderCoordsHelper.getAltitude(l);if(n.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Pd),a){case jt.FAR_BOTTOM_LEFT:case jt.FAR_TOP_LEFT:case jt.NEAR_BOTTOM_LEFT:case jt.NEAR_TOP_LEFT:ate(this._extendedFrustum.planes[Fn.LEFT],Pd,Pd);break;case jt.FAR_BOTTOM_RIGHT:case jt.FAR_TOP_RIGHT:case jt.NEAR_BOTTOM_RIGHT:case jt.NEAR_TOP_RIGHT:ate(this._extendedFrustum.planes[Fn.RIGHT],Pd,Pd)}Oe(Pd,Pd,n.direction),this._renderCoordsHelper.intersectInfiniteManifold(xp(l,Pd),n.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(s),yc(s[jt.NEAR_BOTTOM_LEFT],s[jt.NEAR_BOTTOM_RIGHT],s[jt.NEAR_TOP_RIGHT],Bwe),yc(s[jt.NEAR_BOTTOM_RIGHT],s[jt.NEAR_TOP_RIGHT],s[jt.NEAR_TOP_LEFT],zwe),Qe(Bwe,zwe)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[jt.NEAR_BOTTOM_LEFT],o[jt.NEAR_BOTTOM_RIGHT]]=[o[jt.NEAR_BOTTOM_RIGHT],o[jt.NEAR_BOTTOM_LEFT]]:[o[jt.NEAR_TOP_LEFT],o[jt.NEAR_TOP_RIGHT]]=[o[jt.NEAR_TOP_RIGHT],o[jt.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-Uwe;return{zWithMargin:e,pointIndices:Pb.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+Uwe;return{zWithMargin:e,pointIndices:Pb.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const c6t=2,u6t=6,h6t=12,d6t=.95,Uwe=1,Pd=G(),Bwe=Xi(),zwe=Xi(),Vwe=new Sl(Array,t=>{t.length!==4&&(t[0]=new F4,t[1]=new F4,t[2]=new F4,t[3]=new F4)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let p6t=class{constructor(e){this._camera=new mr,this._focusOnMap=[0,0],this._screenRect=oi(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new l6t(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,tce(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=Wst(e.extent,this._focusOnMap),e.measures.visibility!==gc.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=f6t,i=1<<r,n=e.measures.screenRect;Yf(n);let s=0;const o=e.lij[0]+r,a=e.lij[1]<<r,l=e.lij[2]<<r,c=this._tileSizeWithBias(e),u=c*c;for(let d=0;d<i;d++)for(let p=0;p<i;p++)if(s+=this._computeScreenArea(e,o,a+d,l+p,n),s>u)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===gc.VISIBLE_WHEN_EXTENDED?this._tileSize*m6t:this._tileSize}_computeScreenArea(e,r,i,n,s){const o=e.measures.visibility===gc.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,n,o,_v),Yf(MX);for(let a=0;a<4;a++)rce(MX,_v[a]);return h2(s,MX,s),rve(_v[0],_v[1],_v[2])+rve(_v[0],_v[2],_v[3])}_projectToScreen(e,r,i,n,s){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,r,i,QI),this._toRenderCoords(QI,0,3,vv[0]),this._toRenderCoords(QI,2,3,vv[1]),this._toRenderCoords(QI,2,1,vv[2]),this._toRenderCoords(QI,0,1,vv[3]),n&&(this._projectToPlane(vv,this._camera.frustum[Fn.NEAR]),this._projectToPlane(vv,this._camera.frustum[Fn.TOP]),this._projectToPlane(vv,this._camera.frustum[Fn.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(vv[o],Gwe),this._camera.renderToScreen(Gwe,s[o])}_projectToPlane(e,r){for(let n=0;n<4;n++)XI[n]=kn(r,e[n]);const i=Math.max(XI[0],XI[1],XI[2],XI[3]);if(i>0){const n=Oe(YI,r,-i);for(let s=0;s<4;s++)ze(e[s],e[s],n)}}_toRenderCoords(e,r,i,n){return YI[0]=e[r],YI[1]=e[i],YI[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(YI,this._tilingScheme.spatialReference,n),n}};const MX=oi(),f6t=2,m6t=5,_v=[Ns(),Ns(),Ns(),Ns()],QI=oi(),YI=G(),vv=[G(),G(),G(),G()],XI=[0,0,0,0],Gwe=Yl();function aAr(t,e,r){if(k(t)||k(r))return!1;let i=!0;return ea[0]=t.xmin!=null?t.xmin:0,ea[1]=t.ymin!=null?t.ymin:0,ea[2]=t.zmin!=null?t.zmin:0,i=i&&qs(ea,t.spatialReference,0,e,r,0,1),ea[0]=t.xmax!=null?t.xmax:0,ea[1]=t.ymax!=null?t.ymax:0,ea[2]=t.zmax!=null?t.zmax:0,i=i&&qs(ea,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function IBe(t,e,r){if(k(t)||k(r))return!1;let i=!0;return ea[0]=t.xmin!=null?t.xmin:0,ea[1]=t.ymin!=null?t.ymin:0,ea[2]=t.zmin!=null?t.zmin:0,i=i&&qs(ea,t.spatialReference,0,ea,r,0,1),e[0]=ea[0],e[1]=ea[1],ea[0]=t.xmax!=null?t.xmax:0,ea[1]=t.ymax!=null?t.ymax:0,ea[2]=t.zmax!=null?t.zmax:0,i=i&&qs(ea,t.spatialReference,0,ea,r,0,1),e[2]=ea[0],e[3]=ea[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const ea=G();let yl=class extends rt{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(M(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void we.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||M(r)&&e&&r.equals(e))return;const i=M(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(k(this.filterExtent))return null;const e=oi();return IBe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new ur,this.tileSize=512,this._idToTile=new Map,this._handles=new cn,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Vr}initialize(){this._handles.add([xe(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),fn),xe(()=>{var e,r,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(r=this.viewState)==null?void 0:r.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),vo)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(ar.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=ps(this._frameWorker),this._handles=yt(this._handles)}addClient(){const e=A6t();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(pu))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),M(this._frameWorker)&&(this._frameWorker.priority=ar.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&M(this._frameWorker)&&(this._frameWorker.priority=ar.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new p6t({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new F4(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){e.sort((r,i)=>{const n=r.measures.screenRect,s=i.measures.screenRect;return n[1]+n[3]-(s[1]+s[3])}),Yf(v9);for(let r=0;r<e.length;r++)if(h2(v9,e.data[r].measures.screenRect,v9),$m(v9)>y6t)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!NG(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==gc.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const n of this.tiles.items)n.used=!1;const r=e.filter(n=>{const s=this._idToTile.get(n.id);return s?(s.copyMeasurementsFrom(n),s.used=!0):this._idToTile.set(n.id,n),!s}),i=this.tiles.items.filter(n=>!n.used&&(this._idToTile.delete(n.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===gc.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};h([f({constructOnly:!0})],yl.prototype,"scheduler",void 0),h([f({constructOnly:!0})],yl.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],yl.prototype,"tilingSchemeOwner",void 0),h([f({constructOnly:!0})],yl.prototype,"cameraOnSurface",void 0),h([f({constructOnly:!0})],yl.prototype,"focus",void 0),h([f({constructOnly:!0})],yl.prototype,"viewState",void 0),h([f({constructOnly:!0})],yl.prototype,"terrain",void 0),h([f()],yl.prototype,"tiles",void 0),h([f()],yl.prototype,"tileSize",void 0),h([f({readOnly:!0})],yl.prototype,"tilingScheme",null),h([f()],yl.prototype,"filterExtent",null),h([f({readOnly:!0})],yl.prototype,"_filterExtentRect",null),h([f({readOnly:!0})],yl.prototype,"_rootTileIds",null),h([f({value:!1})],yl.prototype,"suspended",null),h([f({readOnly:!0})],yl.prototype,"updating",null),yl=h([Q("esri.views.3d.layers.support.FeatureTileTree3D")],yl);let g6t=0;function A6t(){return g6t++}const v9=oi(),y6t=10;let Zo=class extends rt{constructor(){super(...arguments),this._propertiesPool=new a1({camera:mr},this),this._lastSeenCameraProjectionValues=new mr,this.mode=Mi.ANIMATING,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Ws,this.viewingMode=wt.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new Ky({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new a1({camera:mr},this)}createInitialCamera(){if(this.viewingMode===wt.Global){const e=ln(this.spatialReference).radius;this.camera=new mr({eye:pt(4*e,0,0),center:pt(e,0,0),up:pt(0,0,1)})}else this.camera=new mr({eye:pt(0,0,100),center:pt(0,0,0),up:pt(0,1,0)})}get animation(){return this.cameraController instanceof TL&&M(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==Bp&&Bp.copyFrom(e),Bp.computeUp(this.viewingMode),this.events.emit("before-camera-change",Bp);const r=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Bp)&&(this._lastSeenCameraProjectionValues.copyFrom(Bp),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),(!r||!r.equals(Bp))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(Bp)),this._cameraChanged=!r||!r.almostEquals(Bp),this._cameraChanged)){const i=yRe(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return br(this._contentCamera,this.camera)}set contentCamera(e){this._contentCamera=M(e)?e.clone():null}get fixedContentCamera(){return M(this._contentCamera)}get isGlobal(){return this.viewingMode===wt.Global}get isLocal(){return this.viewingMode===wt.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.removeHandles(jwe),this.addHandles(ic(()=>e.state===Ls.Finished||e.state===Ls.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),jwe),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Ls.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Ls.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Bp.copyFrom(this._get("camera")),e(Bp),this.camera=Bp,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[si.TOP]!==r.padding[si.TOP]||e.padding[si.RIGHT]!==r.padding[si.RIGHT]||e.padding[si.BOTTOM]!==r.padding[si.BOTTOM]||e.padding[si.LEFT]!==r.padding[si.LEFT]}};h([f()],Zo.prototype,"mode",void 0),h([f({readOnly:!0,type:dO})],Zo.prototype,"animation",null),h([f({type:mr})],Zo.prototype,"camera",null),h([f({readOnly:!0})],Zo.prototype,"pixelRatio",null),h([f()],Zo.prototype,"rasterPixelRatio",void 0),h([f()],Zo.prototype,"contentPixelRatio",void 0),h([f({})],Zo.prototype,"_contentCamera",void 0),h([f({type:mr})],Zo.prototype,"contentCamera",null),h([f({readOnly:!0})],Zo.prototype,"fixedContentCamera",null),h([f({readOnly:!0})],Zo.prototype,"constraints",void 0),h([f({readOnly:!0})],Zo.prototype,"events",void 0),h([f({readOnly:!0})],Zo.prototype,"isGlobal",null),h([f({readOnly:!0})],Zo.prototype,"isLocal",null),h([f({readOnly:!0})],Zo.prototype,"viewingMode",void 0),h([f({readOnly:!0})],Zo.prototype,"spatialReference",void 0),h([f()],Zo.prototype,"navigating",null),h([f()],Zo.prototype,"stationary",null),h([f()],Zo.prototype,"_cameraChanged",void 0),h([f()],Zo.prototype,"cameraController",null),Zo=h([Q("esri.views.3d.state.ViewState")],Zo);const _6t=Zo,Bp=new mr,jwe="ViewStateHandles";let v6t=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Vr,this._tolerance=_O,this._tmpRay=el(),this._tmpRegion=oi(),this._validateHUDIntersector=e0(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),Hwe(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,Hwe(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,n){return r.options.selectionMode=!1,r.options.store=Ol.MIN,this.computeIntersection(e,r,n),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,n=.5){return e.getRenderCenter(x9,i,n),x9[0]+=.0466,x9[1]-=.0123,Yhe(e,x9,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const n=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(n,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const n=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||qm(n)&&n.intersector!==ws.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=_O){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===ws.TERRAIN?1:i.type===ws.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===ws.TERRAIN?1:i.type===ws.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return I8e(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==wt.Local||k(e)||ze(r,e.origin,Ye(Et.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,n=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,n)}_intersectElevation(e,r,i=0,n=null){if(k(e))return null;const s=M(r)?r.mode:"absolute-height",o=M(r)?br(r.offset,0):0,a=s!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(s==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,w9)){const R=this._view.computeMapPointFromVec3d(w9);return R.z??(R.z=0),R.z-=o,R}return null}const c=this._view.state.camera,u=Et.get();c.projectToRenderScreen(e.origin,u);const d=new qwe(null,this._forEachLayer),p=this._view.slicePlane,A=M(p)?Nve(p):null,v=e0(this.viewingMode);v.options.store=Ol.MIN,v.options.verticalOffset=l;const b=e.origin,S=ze(Et.get(),b,e.direction);v.reset(b,S,c),v.point=u;const E=M(n)?"type"in n&&n.type==="graphics"?R=>{var O;return((O=R.metadata)==null?void 0:O.layerUid)!==n.uid}:R=>{var O;return((O=R.metadata)==null?void 0:O.graphicUid)!==n.uid}:null;switch(s){case"relative-to-scene":{const R=O=>{var I;return(k(E)||E(O))&&!!((I=O.metadata)!=null&&I.isElevationSource)};v.intersect(d.layers,u,this._tolerance,null,R),this._externalIntersectionHandlers.forAll(O=>{if(O.type===ws.I3S||O.type===ws.TERRAIN){const I=O.slicePlaneEnabled?A:null;O.intersect(v,I,v.rayBegin,v.rayEnd,u)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(R=>{if(R.isGround){const O=R.slicePlaneEnabled?A:null;R.intersect(v,O,v.rayBegin,v.rayEnd,u)}})}if(v.results.min.getIntersectionPoint(w9)){const R=this._view.computeMapPointFromVec3d(w9);return R.z=i,R}return null}computeIntersection(e,r,i){var v;if(k(e))return;const n=this._view.state.camera,s=Et.get();n.projectToRenderScreen(e.origin,s);const o=new qwe(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=ze(Et.get(),e.origin,e.direction);r.reset(a,l,n),r.intersect(o.layers,s,this._tolerance);const c=this._view.slicePlane,u=M(c)?Nve(c):null;r.intersect(o.sliceableLayers,s,this._tolerance,u);const d=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(b=>{const S=b.layerUid,E=Array.isArray(S),R=E?S:[S];E&&(r.options.filteredLayerUids=[]);let O=!1;for(const I of R)o.filterLayerUid(I)?O=!0:E&&r.options.filteredLayerUids.push(I);if(r.options.isFiltered=!O,b.isGround&&d||!r.options.isFiltered){const I=b.slicePlaneEnabled?u:null;b.intersect(r,I,a,l,s)}});const p=Et.get(),A=this._view.basemapTerrain;if(i&&i.enableDraped&&M(A.spatialReference)&&r.results.ground.getIntersectionPoint(p)){const b=A.overlayManager.renderer,S=this._view.renderCoordsHelper.spatialReference,E=Et.get();this._view.renderCoordsHelper.fromRenderCoords(p,E,A.spatialReference),E[2]=br((v=this._view.elevationProvider)==null?void 0:v.getElevation(p[0],p[1],p[2],S,"ground"),0),b.intersect(r,E,r.results.ground,R=>o.filterRenderGeometry(R))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;i1(this._tmpRegion,mee);const i=this._view.state.camera,n=[],s=this._tmpRegion,o=E=>{const R=new w6t(E);i.projectToRenderScreen(E.target.center,R.screenPoint),R.screenPoint[0]=Math.floor(R.screenPoint[0]),R.screenPoint[1]=Math.floor(R.screenPoint[1]),n.push(R),rce(s,R.screenPoint)};e.sortResults(r.all),M(r.min.dist)&&o(r.min);for(const E of r.all)r.min.target.object!==E.target.object&&r.max.target.object!==E.target.object&&o(E);if(M(r.max.dist)&&r.max.target.object!==r.min.target.object&&o(r.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,s[0]-k4),u=Math.max(0,s[1]-k4),d=Math.min(sp(s)+2*k4,a-c),p=Math.min($m(s)+2*k4,l-u),A=new Uint8Array(d*p*4);this._view._stage.renderer.readHUDVisibility(c,u,d,p,A);let v=!0;const b=k(e.results.max.dist);let S=0;for(const E of n)for(const R of b6t)if(A[4*(Math.min(E.screenPoint[0]+R[0],a)-s[0]+(Math.min(E.screenPoint[1]+R[1],l)-s[1])*d)]){v&&(e.results.min.copy(E.result),v=!1),b&&e.results.max.copy(E.result),e.options.store===Ol.ALL&&e.results.all.splice(S++,0,E.result);break}}};const k4=1,b6t=(()=>{const t=[],e=k4;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let w6t=class{constructor(e){this.result=e,this.screenPoint=Yl()}},b9;function Hwe(t){return b9&&b9.viewingMode===t||(b9=e0(t)),b9}let qwe=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return k(e)?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function Wwe(t){return typeof t=="object"&&"intersect"in t}const w9=G(),x9=Yl();let pAr=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,n,s){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,s,i,n)}},x6t=class{constructor(e,r,i,n){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(ar.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,r,i,n=0){return new Promise((s,o)=>{const a={x:e,y:r,minDemResolution:n,result:{resolve:s,reject:o},signal:i};this._queries.push(a),Sc(i,()=>{kae(this._queries,a),o(en())})})}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(u=>u.result.reject()),void e.madeProgress();const n=r.map(u=>[u.x,u.y]),s=r.reduce((u,d)=>Math.min(u,d.minDemResolution),1/0),o=new CN({points:n,spatialReference:this.spatialReference}),a=r.length>1&&r.some(u=>!!u.signal)?new AbortController:null,l=M(a)?a.signal:r[0].signal;if(M(a)){let u=0;r.forEach(d=>Sc(d.signal,()=>{u++,d.result.reject(en()),u===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:s,signal:l};i.queryElevation(o,c).then(u=>{r.forEach((d,p)=>{M(d.signal)&&d.signal.aborted?d.result.reject(en()):d.result.resolve(u.geometry.points[p][2])})}).catch(u=>{r.forEach(d=>d.result.reject(u))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(pu)}}},U4=class extends Ws.EventedMixin(rt){get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:r.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=yt(this._elevationQueryCached)}get _elevationQuery(){return k(this._elevationQueryCached)&&(this._elevationQueryCached=new x6t(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,r,i,n,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&jo(n,a.spatialReference)&&s===a.queryContext)return a.result}let o=null;return o=T9(o,this._im,e,r,i,n,s),k(o)&&(o=T9(o,this._ground,e,r,i,n,s)),s==="scene"&&(o=T9(o,this._scene,e,r,i,n,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:n,queryContext:s,result:o}),o}queryElevation(e,r,i,n,s,o=null,a=0){const l=T2();return this._elevationQuery.queryElevation(e,r,o,a).then(c=>{s==="scene"&&(c=T9(c,this._scene,e,r,i,n,s)),l.resolve(c)}).catch(c=>{$o(c)?l.reject(c):l.resolve(this.getElevation(e,r,i,n,s))}),l.promise}register(e,r){this._handles.set(r,r.on("elevation-change",i=>this.emit("elevation-change",i))),this._providersFromContext(e).push(r)}unregister(e){var r;this._handles.has(e)&&((r=this._handles.get(e))==null||r.remove(),this._handles.delete(e));for(const i of[this._im,this._ground,this._scene]){const n=i.indexOf(e);n>-1&&i.splice(n,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function T9(t,e,r,i,n,s,o){for(const a of e){const l=a.getElevation(r,i,n,s,o);M(l)&&(t=M(t)?Math.max(l,t):l)}return t}h([f({constructOnly:!0})],U4.prototype,"view",void 0),h([f()],U4.prototype,"spatialReference",null),U4=h([Q("esri.views.3d.support.CombinedElevationProvider")],U4);let B4=class lse{static isValidProfile(e){return e in lse.profiles}static getDefaultProfile(){return Fe("esri-iPhone")?"low":"medium"}static apply(e,r){const i=lse.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const n=r.sceneService.object,s=i.sceneService.object;n.lodFactor=s.lodFactor,n.lodCrossfadeinDuration=s.lodCrossfadeinDuration,n.lodCrossfadeoutDuration=s.lodCrossfadeoutDuration,n.lodCrossfadeUncoveredDuration=s.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};function Qwe(){const t=!!Fe("esri-mobile"),e=!!Fe("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!Fe("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:t?600:750,additionalCacheMemory:t?0:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!Fe("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:t?900:1500,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}B4.test={reset(){const t=Qwe();for(const e in t)B4.profiles[e]=t[e]}},function(t){t.profiles=Qwe()}(B4||(B4={}));const lU=B4;function $Be(){return new Float32Array(4)}function T6t(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Bm(t,e,r,i){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function S6t(t,e){return new Float32Array(t,e,4)}function DBe(){return $Be()}function LBe(){return Bm(1,1,1,1)}function NBe(){return Bm(1,0,0,0)}function FBe(){return Bm(0,1,0,0)}function kBe(){return Bm(0,0,1,0)}function UBe(){return Bm(0,0,0,1)}const E6t=DBe(),C6t=LBe(),M6t=NBe(),R6t=FBe(),O6t=kBe(),P6t=UBe();Object.freeze(Object.defineProperty({__proto__:null,ONES:C6t,UNIT_W:P6t,UNIT_X:M6t,UNIT_Y:R6t,UNIT_Z:O6t,ZEROS:E6t,clone:T6t,create:$Be,createView:S6t,fromValues:Bm,ones:LBe,unitW:UBe,unitX:NBe,unitY:FBe,unitZ:kBe,zeros:DBe},Symbol.toStringTag,{value:"Module"}));const Ywe=new $t([0,255,255]),Xwe=new $t([0,0,0]),Zwe=1,Jwe=.25,Kwe=.4,exe=.2;let kg=class extends rt{constructor(){super(...arguments),this.color=Ywe.clone(),this.haloColor=null,this.haloOpacity=Zwe,this.fillOpacity=Jwe,this.shadowOpacity=Kwe,this.shadowColor=Xwe.clone(),this.shadowDifference=exe}static toEngineOptions(e){const r=$t.toUnitRGBA(e.color??Ywe),i=M(e.haloColor)?$t.toUnitRGBA(e.haloColor):r,n=$t.toUnitRGBA(e.shadowColor??Xwe),s=e.haloOpacity??Zwe,o=e.fillOpacity??Jwe,a=e.shadowOpacity??Kwe,l=e.shadowDifference??exe;return{color:Bm(r[0],r[1],r[2],r[3]),haloColor:Bm(i[0],i[1],i[2],i[3]),haloOpacity:s,haloOpacityOccluded:.25*s,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:Fr(n[0],n[1],n[2],n[3]),occludedShadowOpacity:a*(1-l)}}};h([f({type:$t})],kg.prototype,"color",void 0),h([f({type:$t})],kg.prototype,"haloColor",void 0),h([f()],kg.prototype,"haloOpacity",void 0),h([f()],kg.prototype,"fillOpacity",void 0),h([f()],kg.prototype,"shadowOpacity",void 0),h([f({type:$t})],kg.prototype,"shadowColor",void 0),h([f()],kg.prototype,"shadowDifference",void 0),kg=h([Q("esri.views.3d.support.HighlightOptions")],kg);const cse=kg;let tT=class extends Je{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(n=>n.toJSON()),r=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:XO(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};h([f()],tT.prototype,"geometries",void 0),h([f({json:{read:{source:"outSR"}}})],tT.prototype,"outSpatialReference",void 0),h([f()],tT.prototype,"transformation",void 0),h([f()],tT.prototype,"transformForward",void 0),tT=h([Q("esri.rest.support.ProjectParameters")],tT);const ipe=tT,I6t=Go(ipe);async function BBe(t,e,r){e=I6t(e);const i=oue(t),n={...i.query,f:"json",...e.toJSON()},s=e.outSpatialReference,o=XO(e.geometries[0]),a=Ift(n,r);return ns(i.path+"/project",a).then(({data:{geometries:l}})=>lDe(l,o,s))}async function npe(t=null,e){var n,s;if(gn.geometryServiceUrl)return gn.geometryServiceUrl;if(!t)throw new pe("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||mh.getDefault():t,await r.load({signal:e});const i=(s=(n=r.helperServices)==null?void 0:n.geometry)==null?void 0:s.url;if(!i)throw new pe("internal:geometry-service-url-not-configured");return i}async function $6t(t,e,r=null,i){const n=await npe(r,i),s=new ipe;s.geometries=[t],s.outSpatialReference=e;const o=await BBe(n,s,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new pe("internal:geometry-service-projection-failed")}const D6t=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:npe,projectGeometry:$6t},Symbol.toStringTag,{value:"Module"}));let L6t=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=Eu(this.spatialReference,ln(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=npe(e&&e.get("portalItem")).catch(()=>{throw new pe("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,n=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],n=!1);const s=i.map(l=>l instanceof Ht?l:new Ht(l,this.spatialReference)),o=new ipe({geometries:s,outSpatialReference:St.WGS84}),a=(await BBe(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return n?a:a[0]}},G0=class extends rt{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};h([f()],G0.prototype,"minTotalNumberOfFeatures",void 0),h([f()],G0.prototype,"maxTotalNumberOfFeatures",void 0),h([f()],G0.prototype,"maxTotalNumberOfPrimitives",void 0),h([f()],G0.prototype,"snapshotAvailable",void 0),h([f()],G0.prototype,"polygonLodFactor",void 0),h([f()],G0.prototype,"polylineLodFactor",void 0),h([f()],G0.prototype,"skipHighSymbolLods",void 0),G0=h([Q("esri.views.3d.support.QualitySettings.Graphics3DSettings")],G0);let SA=class extends rt{constructor(){super(...arguments),this.lodFactor=1}};h([f()],SA.prototype,"lodFactor",void 0),SA=h([Q("esri.views.3d.support.QualitySettings.LoDFactorSettings")],SA);let Kz=class extends SA{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};Kz=h([Q("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],Kz);let p_=class extends rt{constructor(){super(...arguments),this.object=new Kz,this.point=new SA,this.integratedMesh=new SA,this.pointCloud=new SA,this.uncompressedTextureDownsamplingEnabled=!1}};h([f({type:Kz})],p_.prototype,"object",void 0),h([f({type:SA})],p_.prototype,"point",void 0),h([f({type:SA})],p_.prototype,"integratedMesh",void 0),h([f({type:SA})],p_.prototype,"pointCloud",void 0),h([f()],p_.prototype,"uncompressedTextureDownsamplingEnabled",void 0),p_=h([Q("esri.views.3d.support.QualitySettings.SceneServiceSettings")],p_);let vb=class extends rt{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};h([f()],vb.prototype,"lodBias",void 0),h([f()],vb.prototype,"angledSplitBias",void 0),h([f()],vb.prototype,"reduceTileLevelDifferences",void 0),h([f()],vb.prototype,"textureFadeDuration",void 0),vb=h([Q("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],vb);let $M=class extends rt{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};h([f()],$M.prototype,"pixelRatio",void 0),h([f()],$M.prototype,"maxTotalNumberOfFeatures",void 0),$M=h([Q("esri.views.3d.support.QualitySettings.HeatmapSettings")],$M);let qu=class extends rt{constructor(){super(...arguments),this.graphics3D=new G0,this.sceneService=new p_,this.tiledSurface=new vb,this.heatmap=new $M,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.memoryLimit=void 0,this.additionalCacheMemory=void 0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};h([f({type:G0})],qu.prototype,"graphics3D",void 0),h([f({type:p_})],qu.prototype,"sceneService",void 0),h([f({type:vb})],qu.prototype,"tiledSurface",void 0),h([f({type:$M})],qu.prototype,"heatmap",void 0),h([f()],qu.prototype,"fadeDuration",void 0),h([f()],qu.prototype,"antialiasingEnabled",void 0),h([f()],qu.prototype,"physicallyBasedRenderingEnabled",void 0),h([f()],qu.prototype,"highQualityTransparency",void 0),h([f()],qu.prototype,"memoryLimit",void 0),h([f()],qu.prototype,"additionalCacheMemory",void 0),h([f()],qu.prototype,"frameRate",void 0),h([f()],qu.prototype,"maximumPixelRatio",void 0),qu=h([Q("esri.views.3d.support.QualitySettings.QualitySettings")],qu);const txe=qu;function N6t(t){return zae(t)&&t.length>=3}function F6t(t){return(Vae(t)||Array.isArray(t))&&t.length>=3}function k6t(t){return N6t(t)||F6t(t)}let U6t=class use{constructor(e,r,i,n){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=n,this._tmpCoordinateSystem=oct(n)}set extent(e){e&&act(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return mct(this._coordinateSystem,e)}setAltitude(e,r,i=e){return b4e(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){gct(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return hct(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return dct(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,od.X,Et.get()),n=this.worldBasisAtPosition(e,od.Y,Et.get()),s=this.worldBasisAtPosition(e,od.Z,Et.get());return KA(r,i[0],i[1],i[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,Et.get()),n=this.worldBasisAtPosition(e,od.Y,Et.get()),s=X$e(r,n,i);return xu(s)}intersectManifoldClosestSilhouette(e,r,i){return DW(this._coordinateSystem,r,this._tmpCoordinateSystem),fct(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){DW(this._coordinateSystem,r,this._tmpCoordinateSystem);const n=Et.get();return pct(this._tmpCoordinateSystem,e,n)?Pe(i,n):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===wt.Global)return this.intersectManifold(e,r,i);DW(this._coordinateSystem,r,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=Et.get();return bE(n.plane,e,s)?Pe(i,s):null}toRenderCoords(e,r,i){return Pz(e)?nc(e,r,this.spatialReference):il(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return Pz(r)?(M(i)&&(r.spatialReference=i),h$e(e,this.spatialReference,r)):k6t(r)?il(e,this.spatialReference,r,i)?r:null:O2(e,this.spatialReference,r)}static create(e,r){switch(e){case wt.Local:return new use(wt.Local,r,Eu(r),uct());case wt.Global:return new use(wt.Global,r,1,cct(r))}}static renderUnitScaleFactor(e,r){return rxe(e)/rxe(r)}};function rxe(t){if(Iz(t,wt.Global))return 1;const e=w4e(!1,t);return Eu(e)}var oA;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(oA||(oA={}));const B6t=(()=>{const t=new Array;return t[oA.ELEVATION]=10,t[oA.BASEMAP]=10,t[oA.I3S_INDEX]=10,t[oA.I3S_DATA]=10,t[oA.SYMBOLOGY]=5,t})(),z6t=30;function zBe(t){return typeof t.getUsedMemory=="function"}function V6t(t){return new Wu({view:t})}const S9=1,RX=1,G6t=.75,j6t=.6,ixe=1.3;let Wu=class extends rt{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new nue,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(S9),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,r){return new Kpt(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<j6t&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(S9);else if(e)(this._memoryPredicted>1.1*RX||this._memoryUsed>RX)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/ixe),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>RX)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/ixe),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<G6t&&this._quality<S9){this._stableQuality=this._quality;const r=.05;e=this._updateQuality(this._quality+r)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),S9))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,r=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderer.edgeView;M(i)&&(e+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(zBe(a)){const l=a.ignoresMemoryFactor()?this._quality:1;e+=a.getUsedMemory()*l,r+=a.getUnloadedMemory()*l}});const n=k(this._warnMemoryUsage)||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&n){this._warnMemoryUsage=e;const a=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);we.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${a(s)} Current: ${a(e)} Projected: ${a(e+r)} Quality: ${l}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+r)/s;const o=s-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r}}}};h([f({constructOnly:!0})],Wu.prototype,"view",void 0),h([f()],Wu.prototype,"maxMemory",null),h([f()],Wu.prototype,"additionalCacheMemory",null),h([f()],Wu.prototype,"memoryFactor",null),h([f()],Wu.prototype,"updating",null),h([f()],Wu.prototype,"usedMemory",null),h([f()],Wu.prototype,"_quality",void 0),h([f()],Wu.prototype,"_memoryUsed",void 0),h([f()],Wu.prototype,"_updating",void 0),h([f()],Wu.prototype,"_stableQuality",void 0),h([f()],Wu.prototype,"_maxMemory",void 0),h([f()],Wu.prototype,"_additionalCacheMemory",void 0),Wu=h([Q("esri.views.3d.support.MemoryController")],Wu);let H6t=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},q6t=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new W6t}},W6t=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},Q6t=class{constructor(e,r,i,n){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=n.map(s=>new q6t(s))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,n)=>this._taskCallback(i,n))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,tr(r.numWorkers>=0),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},cU=class extends rt{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new Q6t((n,s)=>this._startLoading(n,s),(n,s)=>this._doneLoadingCB(n,s),e,r),i&&(this._frameTask=i.registerTask(ar.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=ps(this._frameTask),this._tasks.forEach(e=>Gf(e.abortController)),this._loadQueue=yt(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,n={}){const s=T2();s.__signal=M(n)?n.signal:null;const o=this._createOrUpdateTask(e,r,i,n,s);return Sc(n,()=>this._cancelRequest(o,s)),s.promise}_createTask(e,r,i,n,s,o){const a=new Z6t(e,r,i,n,s);return this._updateTask(a,o),this._tasks.set(s,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){var i;PD(e.resolvers,r),r.reject(en()),e.resolvers.length===0&&(e.status===lf.DOWNLOADING&&(e.status=lf.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=lf.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,n,s){const o=J6t(M(n)&&n.uid||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,s),a):this._createTask(e,n,r,i,o,s)}_doneLoadingCB(e,r){this._loadQueue&&(tr(e.status===lf.DOWNLOADING),e.status=lf.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();fi(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==lf.DOWNLOADED&&(r.err=r.err||en()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!$o(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const n of e.resolvers)if(r)$o(r)?n.reject(r):n.reject(new pe("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const s=i<=0?e.result:Te(e.result);n.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===lf.CANCELLED)return!1;let i,n;switch(e.startTime=performance.now(),e.status=lf.DOWNLOADING,e.docType){case"binary":n="array-buffer",i=0;break;case"image":n="image";break;case"image+type":n="array-buffer";break;default:n="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=ns(e.url,{...e.options,responseType:n,timeout:i,signal:s});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===lf.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const u=c.data,d=X6t(u);if(n="image",e.size=u.byteLength,d==="unknown")return e.request=ns(e.url,{responseType:n,timeout:i,signal:s}),void e.request.then(v=>a(v.data),l);const p=new Blob([u],{type:d}),A=window.URL.createObjectURL(p);o=()=>window.URL.revokeObjectURL(A),e.request=ns(A,{responseType:n,timeout:i,signal:s}),e.request.then(v=>a(new bH(v.data,d,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};h([f({readOnly:!0})],cU.prototype,"updating",void 0),cU=h([Q("esri.views.3d.support.StreamDataLoader")],cU);const Y6t={numRetries:0};function X6t(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let bH=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}},Z6t=class extends H6t{constructor(e,r,i,n,s){super(n),this.url=e,this.options=r,this.docType=i,this.key=s,this.result=null,this.status=lf.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Y6t.numRetries}};function J6t(t,e,r){return`${t}:${e}:${r}`}var lf;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(lf||(lf={}));let uU=class extends rt{constructor(){super(...arguments),this.updating=!1}};function K6t(t){return new Ug({view:t})}h([f({readOnly:!0})],uU.prototype,"updating",void 0),uU=h([Q("esri.views.3d.support.ResourceControllerMain")],uU);let Ug=class extends uU{constructor(){super(...arguments),this._immediateTask=hO,this._normalTask=hO,this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=Zbt(),this._memoryController=V6t(this.view),this._streamDataLoader=new cU,this._streamDataLoader.setup(z6t,B6t,this._scheduler),this.addHandles([xe(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},fn),xe(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=NR({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(ar.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(ar.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=ps(this._frameTask),this._streamDataLoader=yt(this._streamDataLoader),this._memoryController=yt(this._memoryController),this._scheduler=yt(this._scheduler)}get updating(){var e,r,i;return!!((e=this._memoryController)!=null&&e.updating||(r=this._streamDataLoader)!=null&&r.updating||(i=this._immediateTask)!=null&&i.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,n,s)=>r.request(i,n,e,s),get busy(){return!r.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(Yae(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};h([f({constructOnly:!0})],Ug.prototype,"view",void 0),h([f()],Ug.prototype,"_scheduler",void 0),h([f()],Ug.prototype,"_memoryController",void 0),h([f()],Ug.prototype,"_streamDataLoader",void 0),h([f()],Ug.prototype,"_immediateTask",void 0),h([f()],Ug.prototype,"_normalTask",void 0),h([f({readOnly:!0})],Ug.prototype,"updating",null),Ug=h([Q("esri.views.3d.support.ResourceControllerImpl")],Ug);function e8t(t){return"performanceInfo"in t}const R3=G(),t8t=G(),Sy=G(),Ey=G();function r8t(t,e,r=0){const i=t.extent;if(k(i))return!1;if(r===0)return sIe(i,e);const n=Math.min(i[2]-i[0],i[3]-i[1]);return qst(i,e,r*n)}function E9(t,e,r,i){Pe(R3,r),R3[i]=e[i];const n=Ve(R3,R3,e),s=Ve(t8t,t,e),o=Qe(s,n),a=Qe(n,n);let l;l=o<=0?e:a<=o?r:ze(R3,e,Oe(n,n,o/a));const c=Ve(R3,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function i8t(t,e,r){const i=t.extent;if(k(i))return 0;Sy[0]=i[0],Sy[1]=i[1],Sy[2]=r,Ey[0]=i[2],Ey[1]=i[3],Ey[2]=r;let n=1/0,s=1/0;return e[0]<Sy[0]?n=E9(e,Sy,Ey,0):e[0]>Ey[0]&&(n=E9(e,Ey,Sy,0)),e[1]<Sy[1]?s=E9(e,Sy,Ey,1):e[1]>Ey[1]&&(s=E9(e,Ey,Sy,1)),Math.min(n,s)}function n8t(t,e,r){if(k(t))return Que();if(t.spatialReference.isGeographic&&!IS(t.spatialReference))return new pe("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=Kh.checkUnsupported(t);if(M(i))return i;if(k(r))return new pe("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=s8t(t,r);if(n)return n;const s=t.spatialReference;return M(e)&&!(s.equals(e)||e.isWGS84&&s.isWebMercator)?new pe("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function s8t(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,n=[i*t.size[0],i*t.size[1]],s=[t.origin.x,t.origin.y],o=iIe(e),a=oi();Kh.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>wM){const c=r[0].scale*2**r[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const d=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**d)*10**d,new pe("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:wM})}return null}const o8t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:n8t,isInsideExtent:r8t,tiltToExtentEdge:i8t},Symbol.toStringTag,{value:"Module"}));function a8t(){return!0}function l8t(){return 0}function c8t(t,e){if(k(t))return Que();const r=t.lods.length-1,i=t.spatialReference,n=IS(i)||XA(i)||ZA(i);if(i.isWebMercator){if(!Kh.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new pe("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new pe("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Kh.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new pe("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new pe("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return M(e)&&!t.spatialReference.equals(e)?new pe("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const u8t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:c8t,isInsideExtent:a8t,tiltToExtentEdge:l8t},Symbol.toStringTag,{value:"Module"})),h8t={[wt.Global]:u8t,[wt.Local]:o8t};function Kg(t,e){t||console.warn("Terrain: "+e)}let ha=!1,eV=!1;function d8t(t){eV=t,ha=ha||t}function p8t(t){ha=t}function at(t,e){var r;if(ha&&!t){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(e||"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function hse(t){return wH(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function tV(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function wH(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function spe(t){return(t==null?void 0:t.type)==="tile-3d"}function BL(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function VBe(t){return(t==null?void 0:t.type)==="wmts-3d"}function dse(t){return(t==null?void 0:t.type)==="elevation-3d"}function ZI(t){return(t==null?void 0:t.type)==="group"}function rV(t){return t&&(spe(t)||VBe(t)||wH(t)||BL(t))}function pse(t){return t&&(spe(t)||wH(t)||BL(t)||VBe(t))}function zL(t){return pse(t)||dse(t)}function f8t(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return M(e)&&"type"in e&&e.type==="raster-tile"}function m8t(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return M(e)&&"type"in e&&e.type==="vector-tile"}function g8t(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return M(e)&&"type"in e&&e.type==="tile-texture"}function A8t(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e instanceof HTMLImageElement||e instanceof bH||e instanceof HTMLCanvasElement||e instanceof ImageData}function gR(t){return M(t)&&"release"in t&&t.release(),null}function nxe(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function ope(t,e,r,i){return h8t[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function xH(t,e,r){let i=null,n=null;if((t==null?void 0:t.type)==="wmts"){const s=y8t(t,e,r);i=s.tileInfo,n=s.fullExtent}else{n=tV(t)?t.getCompatibleFullExtent(e):t.fullExtent;const s=r===wt.Local;if(tV(t))i=t.getCompatibleTileInfo(e,n,s);else if((t==null?void 0:t.type)==="vector-tile"){const o=s&&!_8t(e)||v8t.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return M(i)&&M(n)&&ope(i,n,e,r)==null?{tileInfo:i,fullExtent:n}:null}function y8t(t,e,r){const i=eit(t);if(M(i)){if(!ur.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const n=i.find(s=>ope(s.tileInfo,s.fullExtent,e,r)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function _8t(t){return t.isWGS84||t.isWebMercator||aOe(t)||!ND(t)}const v8t={force512VTL:!1};function sxe(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function Cy(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function wf(t,e,r=x8t){return Math.abs(t-e)<r}function fse(t){return t===gr.NORTH_EAST?gr.SOUTH_WEST:t===gr.NORTH_WEST?gr.SOUTH_EAST:t===gr.SOUTH_WEST?gr.NORTH_EAST:gr.NORTH_WEST}function iV(t){return t===gr.NORTH?gr.SOUTH:t===gr.EAST?gr.WEST:t===gr.SOUTH?gr.NORTH:gr.EAST}function b8t(t){return t===gr.NORTH_WEST||t===gr.SOUTH_WEST}function w8t(t){return t===gr.NORTH_WEST||t===gr.NORTH_EAST}function oxe(t){return t===gr.NORTH_WEST||t===gr.WEST||t===gr.SOUTH_WEST}function axe(t){return t===gr.NORTH_EAST||t===gr.EAST||t===gr.SOUTH_EAST}function lxe(t){return t===gr.SOUTH_EAST||t===gr.SOUTH||t===gr.SOUTH_WEST}function cxe(t){return t===gr.NORTH_EAST||t===gr.NORTH||t===gr.NORTH_WEST}const pA=[gr.NORTH,gr.EAST,gr.SOUTH,gr.WEST],nV=[gr.NORTH_EAST,gr.SOUTH_EAST,gr.SOUTH_WEST,gr.NORTH_WEST],x8t=1e-5;let T8t=class{constructor(e,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=zL(e)?r.basemapTerrain.getUsedMemoryForLayerView(e):e.getUsedMemory(),e8t(e)){const i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}},S8t=class{constructor(e){var i;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,M(e.resourceController)){const n=e.resourceController.memoryController;this.totalMemory=(n.maxMemory??0)*tO.MEGABYTES,this.usedMemory=Math.round(n.usedMemory*this.totalMemory),this.quality=n.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.getUsedMemory())??0;const r=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=M(r)?r.usedMemory:0,e.allLayerViews.items.forEach(n=>{(zBe(n)||zL(n))&&this.layerPerformanceInfos.push(new T8t(n,e))}),this.layerPerformanceInfos.sort((n,s)=>s.memory-n.memory)}},E8t=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const n=i?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(n);return M(s)?Promise.resolve(s):this._loadOnce(this._gltfLoading,this._gltfMemCache,n,o=>KUe(new ZUe(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,n=this._wosrMemCache.get(i);return M(n)?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,s=>eBe(e,s),r)}async _loadOnce(e,r,i,n,s){fi(s);const o=Sc(s,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:n({...s,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),fi(s),l}finally{ps(o)}}_abortLoad(e,r){const i=e.get(r);M(i)&&--i.refCount>0||(e.delete(r),M(i)&&i.abortController.abort())}},C8t=class extends xM{constructor(e,r,i,n){super(r,n),this._streamDataRequester=e,this._parameters=i}async fromUrl(e,r,i){fi(i);const n=M(i)?i.signal:null,s=this.makeUid(e,r);let o=this._textureRequests.get(s);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:s,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a};const c=o;this._textureRequests.set(s,o),o.textureAsync=l.then(async u=>{const d=this._createTexture(e,u,r);return c.texture=d,c.abortController=null,this._stage.add(d),await this._stage.load(d),{uid:s,texture:d,release:()=>this._release(s)}},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await Qae(o.textureAsync,n)}catch(a){throw this._release(s),a}}_createTexture(e,r,i){var s;const n={...this._parameters,powerOfTwoResizeMode:m2.PAD};if(tOe(e)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(s=this._stage.renderView)!=null&&s.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return n.width=r.width,n.height=r.height,new ME(r,n)}},M8t=class{constructor(e){this.textures=null,this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(oA.SYMBOLOGY),this.objectResourceCache=new E8t((i,n)=>e.resourceController.memoryController.newCache(i,n)),this.textures=new C8t(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:Ar.CLAMP_TO_EDGE,t:Ar.CLAMP_TO_EDGE}},e.resourceController.scheduler);const r=ln(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=I9e(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=ORt(e.viewingMode,r)}destroy(){yt(this.textures),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Rm();this._graphicsOwners.push(e);const r=xe(()=>{var i;return(i=e.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Rm(()=>{r.remove(),PD(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new cn;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([xe(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,fn),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=yt(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;C9.distance=e.centerOnSurfaceInfrequent.distance,C9.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(C9),this.screenSizePerspectiveSettingsLabels.update(C9),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const C9={distance:0,fovY:0};let qC=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new Vb({symbolLayers:[new zb({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new AE({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(e,r){if(k(r))return;this.hide();const i=new Ht({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new Pl({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){M(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}},$b=class extends rt{constructor(e){super(e),this.handles=new cn}destroy(){this.handles.destroy()}};h([f({constructOnly:!0})],$b.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],$b.prototype,"surface",void 0),h([f({constructOnly:!0})],$b.prototype,"state",void 0),$b=h([Q("esri.views.3d.support.PointOfInterest")],$b);const R8t=Array;let U0=class extends $b{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new a1({location:Ht,renderLocation:R8t},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=G(),this._tmpPoint=new Ht}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Bo(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=yt(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,r=zn(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return WS(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),rc.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const r=(this._tmpPoint.z??0)>O8t&&this.renderCoordsHelper.viewingMode===wt.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?P8t:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{$o(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,rc.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(OX,this._estimatedSurfaceAltitude,this._camera.eye),fu(this._get("renderLocation"),OX)||(this._set("renderLocation",Pe(this._propertiesPool.get("renderLocation"),OX)),this.notifyChange("renderLocation"))}};h([f({constructOnly:!0})],U0.prototype,"scheduler",void 0),h([f({constructOnly:!0})],U0.prototype,"cache",void 0),h([f({constructOnly:!0})],U0.prototype,"task",void 0),h([f({readOnly:!0})],U0.prototype,"location",null),h([f({constructOnly:!0})],U0.prototype,"map",void 0),h([f({readOnly:!0})],U0.prototype,"renderLocation",void 0),h([f({readOnly:!0})],U0.prototype,"scale",null),h([f({readOnly:!0})],U0.prototype,"updating",null),U0=h([Q("esri.views.3d.support.CameraOnSurface")],U0);const OX=G(),O8t=1e5,P8t=1e6,I8t=Array;let cf=class extends $b{constructor(e){super(e),this._propertiesPool=new a1({location:Ht,renderLocation:I8t},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=G(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=ps(this._frameWorker),this._propertiesPool=yt(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,rc.YIELD}_updateRenderLocation(){const e=D8t;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const n=L8t;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(Pe(e,n),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=zn(this._camera.eye,e):(Oe(e,this._camera.viewForward,this._get("distance")),ze(e,e,this._camera.eye)),fu(this._get("renderLocation"),e)||this._set("renderLocation",Pe(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){var n,s;const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const o=ln(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=vc(i.eye),c=l<a*a,u=zn(i.eye,r);if(c&&u>o/4){const d=a-Math.sqrt(l);return Oe(r,i.viewForward,d),ze(r,r,i.eye),!0}}else{const o=(n=this.surface)!=null&&n.ready?this.surface.extent:null;M(o)&&ZG(o,(s=this.surface)==null?void 0:s.spatialReference,JI,this.renderCoordsHelper.spatialReference)&&(r[0]=He(r[0],JI[0],JI[2]),r[1]=He(r[1],JI[1],JI[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(tn.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,n=zn(i,e),s=zn(i,r);if(Math.abs(s-n)/n>$8t)return!0}return!1}};h([f({constructOnly:!0})],cf.prototype,"scheduler",void 0),h([f({constructOnly:!0})],cf.prototype,"task",void 0),h([f()],cf.prototype,"distance",void 0),h([f({constructOnly:!0})],cf.prototype,"estimateSurfaceAltitudeAtCenter",void 0),h([f({readOnly:!0})],cf.prototype,"location",null),h([f({readOnly:!0})],cf.prototype,"renderLocation",void 0),h([f()],cf.prototype,"updating",void 0),cf=h([Q("esri.views.3d.support.CenterOnSurface")],cf);const $8t=.05,D8t=G(),L8t=G(),JI=oi();let N8t=class{constructor(e){this._handles=new cn,this.events=new Ws,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=yt(this._handles)}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",F8t)}};const F8t={},k8t=Array;let Bg=class extends $b{constructor(e){super(e),this._propertiesPool=new a1({location:Ht,renderLocation:k8t},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([xe(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),xe(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(ar.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=yt(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,n=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,uxe);const s=Math.max(0,(Math.acos(Qe(uxe,n.viewForward))-.5*Math.PI)*(n.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!S2(e,r)){const c=this._propertiesPool.get("renderLocation");Pe(c,r),this._set("renderLocation",c)}return rc.YIELD}const o=1-He(s/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(hxe);const l=this._propertiesPool.get("renderLocation");return Eo(l,r,hxe,a),e&&S2(e,l)||this._set("renderLocation",l),rc.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(Yl());if(i[1]=r.aboveGround?r.padding[si.BOTTOM]:r.fullHeight-r.padding[si.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const n=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,KI)){Ve(KI,KI,r.eye);const s=Ye(KI,KI);if(this.renderCoordsHelper.intersectManifold(xp(r.eye,s),n,e))return e}return this.renderCoordsHelper.setAltitude(e,n,r.eye)}updateRenderLocation(){this._dirty=!0}};h([f()],Bg.prototype,"_dirty",void 0),h([f({constructOnly:!0})],Bg.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Bg.prototype,"centerOnSurface",void 0),h([f({constructOnly:!0})],Bg.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),h([f({readOnly:!0})],Bg.prototype,"updating",null),h([f({readOnly:!0})],Bg.prototype,"location",null),h([f({readOnly:!0})],Bg.prototype,"renderLocation",void 0),Bg=h([Q("esri.views.3d.support.pointsOfInterest.Focus")],Bg);const uxe=G(),KI=G(),hxe=G();let i_=class extends rt{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=G();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new cn}initialize(){this.view.state.isLocal&&(this._handles.add([xe(()=>{var e,r;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(r=this.surfaceView)==null?void 0:r.extent]},()=>this._update()),Bo(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||k(this.surfaceView.extent)||k(this.surfaceView.spatialReference))return void this._set("location",null);const e=ice(this.surfaceView.extent),r=new Ht({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{$o(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",r)}};h([f({constructOnly:!0})],i_.prototype,"view",void 0),h([f({constructOnly:!0})],i_.prototype,"cache",void 0),h([f()],i_.prototype,"surface",null),h([f()],i_.prototype,"surfaceView",null),h([f({readOnly:!0})],i_.prototype,"location",void 0),h([f({readOnly:!0})],i_.prototype,"renderLocation",null),i_=h([Q("esri.views.3d.terrain.StableSurfaceCenter")],i_);let n_=class extends rt{constructor(e){super(e),this._tileGeometryUpdateExtent=Yf(),this._tileGeometryUpdateSpatialReference=null,this.events=new Ws,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(ar.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",U8t),Yf(this._tileGeometryUpdateExtent),this._set("updating",!1)),rc.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,h2(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,n=B8t,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,tx,r),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,rx,r),tx[0]<rx[0]?(n[0]=tx[0],n[2]=rx[0]):(n[0]=rx[0],n[2]=tx[0]),tx[1]<rx[1]?(n[1]=tx[1],n[3]=rx[1]):(n[1]=rx[1],n[3]=tx[1]),NG(n,e)}};h([f({constructOnly:!0})],n_.prototype,"state",void 0),h([f({constructOnly:!0})],n_.prototype,"centerOnSurfaces",void 0),h([f({constructOnly:!0})],n_.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],n_.prototype,"scheduler",void 0),h([f({constructOnly:!0})],n_.prototype,"surface",void 0),h([f({readOnly:!0})],n_.prototype,"updating",void 0),n_=h([Q("esri.views.3d.support.SurfaceGeometryUpdates")],n_);const U8t={},tx=G(),rx=G(),B8t=Yf();let Zu=class extends rt{constructor(e){super(e),this._handles=new cn,this._tmpRay=el(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new a1({renderPointOfView:z8t},this),this.renderPointOfView=G(),this._pois=new Array,this._debugCenters=new Map}initialize(){var u;const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:n}=this.view;this._surfaceIntersector=e0(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Ol.MIN,this._contentIntersector=e0(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(u=this.view.basemapTerrain)==null?void 0:u.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new cf({...l,task:ar.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new cf({...l,task:ar.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new cf({...l,task:ar.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new U0({...l,cache:a,task:ar.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("surfaceGeometryUpdates",new n_({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new N8t({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new i_({cache:a,view:this.view})),this._set("focus",new Bg({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceInfrequent,estimateSurfaceIntersectionAtRenderPoint:(d,p)=>this._estimateSurfaceIntersectionAtRenderPoint(d,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new qC(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new qC(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new qC(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new qC(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new qC(c,"green","Focus")),this._handles.add([xe(()=>e.contentCamera,d=>this._cameraChanged(d),fn),xe(()=>r.extent,()=>this._updateCenterPointsOfInterest()),ic(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),fn),Bo(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Bo(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),ic(()=>tn.SHOW_POI,d=>this._setDebug(d),Rr)]),this._cameraChanged(this.view.state.contentCamera);for(const d of this._pois)d.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(r=>r.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return k(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,O3,G8t)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(O3):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(k(e))return this._surfaceAltitudeAtCenter;const r=e.origin,i=ze(O3,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(O3)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(O3)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const n=Yhe(r,e,V8t);if(k(n))return null;const s=n.origin,o=ze(O3,n.origin,n.direction);return this._surfaceIntersector.resetWithRay(n,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;fu(this.renderPointOfView,r)||this._set("renderPointOfView",Pe(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this._handles.remove("debug");for(const r of this._pois)this._handles.add(xe(()=>r.renderLocation,i=>{var n;return(n=this._debugCenters.get(r))==null?void 0:n.show(i,r.renderCoordsHelper.spatialReference)},Rr),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};h([f({readOnly:!0})],Zu.prototype,"centerOnContent",void 0),h([f({readOnly:!0})],Zu.prototype,"centerOnSurfaceFrequent",void 0),h([f({readOnly:!0})],Zu.prototype,"centerOnSurfaceInfrequent",void 0),h([f({readOnly:!0})],Zu.prototype,"cameraOnSurface",void 0),h([f({readOnly:!0})],Zu.prototype,"focus",void 0),h([f({readOnly:!0})],Zu.prototype,"renderPointOfView",void 0),h([f({readOnly:!0})],Zu.prototype,"surfaceOrigin",void 0),h([f({readOnly:!0})],Zu.prototype,"contentGeometryUpdates",void 0),h([f({readOnly:!0})],Zu.prototype,"surfaceGeometryUpdates",void 0),h([f({constructOnly:!0})],Zu.prototype,"view",void 0),h([f({readOnly:!0})],Zu.prototype,"updating",null),Zu=h([Q("esri.views.3d.support.PointsOfInterest")],Zu);const z8t=Array,O3=G(),V8t=el(),G8t={exclude:new Set([Rb])};let j8t=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},H8t=class{constructor(e,r,i,n){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=n)}get hasNoDataValues(){if(k(this._hasNoDataValues)){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(M(this._minValue))return;const{noDataValue:e,values:r}=this;let i=1/0,n=-1/0,s=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,n=o>n?o:n,s=!1);s?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=n>-3e38?n:0)}},GBe=class{constructor(e,r,i,n,s={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=jIe(e,{...s,schedule:n}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>we.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),Rm(()=>{i.removed=!0,kae(this._listeners,i),this._thread&&M(i.threadHandle)&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const n=this._transferLists[e],s=n?n(r):[];return this._thread.invoke(e,r,{transferList:s,signal:i})}return this._promise?this._promise.then(()=>(fi(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},dxe=class extends GBe{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(iD.forEach((e,r)=>{e===this&&iD.delete(r)}),this.destroy())}};const iD=new Map;function q8t(t=null){let e=iD.get(t);return e||(M(t)?(e=new dxe(r=>t.immediate.schedule(r)),iD.set(t,e)):(e=new dxe,iD.set(null,e))),++e.ref,e}var Yh,pxe,fxe;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(Yh||(Yh={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(pxe||(pxe={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(fxe||(fxe={}));let W8t=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},ryr=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function nyr(t,e,r,i,n,s){const o=r-n;if(o>=0)return(e>>o)+(i-(s<<o))*(t>>o);const a=-o;return e-(s-(i<<a))*(t>>a)<<a}let syr=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][n]||null}getCellSpan(e,r,i,n){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function Q8t(t,e,r,i,n,s){const o=e[i++];for(let a=0;a<o;a++){const l=new W8t(s);l.xTile=e[i++],l.yTile=e[i++],l.hash=e[i++],l.priority=e[i++];const c=e[i++];for(let p=0;p<c;p++){const A=e[i++],v=e[i++],b=e[i++],S=e[i++],E=!!e[i++],R=e[i++],O=r[i++],I=r[i++],N=e[i++],L=e[i++];l.colliders.push({xTile:A,yTile:v,dxPixels:b,dyPixels:S,hard:E,partIndex:R,width:N,height:L,minLod:O,maxLod:I})}const u=t[i++];for(let p=0;p<u;p++)l.textVertexRanges.push([t[i++],t[i++]]);const d=t[i++];for(let p=0;p<d;p++)l.iconVertexRanges.push([t[i++],t[i++]]);n.push(l)}return i}function ayr(t,e,r){for(const[i,n]of t.symbols)Y8t(t,e,r,n,i)}function Y8t(t,e,r,i,n){const s=t.layerData.get(n);if(s.type===Yh.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],u=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const p=r?Math.floor(127*u)|d<<7:d?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.iconVertexRanges)for(let d=c;d<c+u;d+=4)s.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1],u=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const p=r?Math.floor(127*u)|d<<7:d?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.textVertexRanges)for(let d=c;d<c+u;d+=4)s.textOpacity[d/4]=l}s.lastOpacityUpdate=e,s.opacityChanged=!0}}let TH=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e,this.memoryUsed=e.byteLength;let i=1;const n=new Uint32Array(e);this.layerUIDs=[];const s=n[i++];for(let o=0;o<s;o++)this.layerUIDs[o]=n[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return k(this._data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){k(this._data)||(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},X8t=class extends TH{constructor(e,r){super(e,r),this.type=Yh.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.lineIndexStart=i[n++],this.lineIndexCount=i[n++];const s=i[n++];if(s>0){const o=new Map;for(let a=0;a<s;a++){const l=i[n++],c=i[n++],u=i[n++];o.set(l,[c,u])}this.patternMap=o}this.bufferDataOffset=n}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){M(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),M(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),M(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++];this.lineVertexBuffer=Ji.createVertex(e,ki.STATIC_DRAW,new Int32Array(s.buffer,4*i,o)),i+=o;const a=n[i++];this.lineIndexBuffer=Ji.createIndex(e,ki.STATIC_DRAW,new Uint32Array(n.buffer,4*i,a)),i+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new Zf(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}},Z8t=class extends TH{constructor(e,r){super(e,r),this.type=Yh.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.fillIndexStart=i[n++],this.fillIndexCount=i[n++],this.outlineIndexStart=i[n++],this.outlineIndexCount=i[n++];const s=i[n++];if(s>0){const o=new Map;for(let a=0;a<s;a++){const l=i[n++],c=i[n++],u=i[n++];o.set(l,[c,u])}this.patternMap=o}this.bufferDataOffset=n}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){M(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),M(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),M(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,M(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),M(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),M(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++];this.fillVertexBuffer=Ji.createVertex(e,ki.STATIC_DRAW,new Int32Array(s.buffer,4*i,o)),i+=o;const a=n[i++];this.fillIndexBuffer=Ji.createIndex(e,ki.STATIC_DRAW,new Uint32Array(n.buffer,4*i,a)),i+=a;const l=n[i++];this.outlineVertexBuffer=Ji.createVertex(e,ki.STATIC_DRAW,new Int32Array(s.buffer,4*i,l)),i+=l;const c=n[i++];this.outlineIndexBuffer=Ji.createIndex(e,ki.STATIC_DRAW,new Uint32Array(n.buffer,4*i,c)),i+=c;const u=this.layer,d=u.fillMaterial,p=u.outlineMaterial;this.fillVertexArrayObject=new Zf(e,d.getAttributeLocations(),d.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new Zf(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}},J8t=class extends TH{constructor(e,r,i){super(e,r),this.type=Yh.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const n=new Uint32Array(e),s=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!n[a++];const l=n[a++];for(let p=0;p<l;p++){const A=n[a++],v=n[a++],b=n[a++];this.iconPerPageElementsMap.set(A,[v,b])}const c=n[a++];for(let p=0;p<c;p++){const A=n[a++],v=n[a++],b=n[a++];this.glyphPerPageElementsMap.set(A,[v,b])}const u=n[a++],d=n[a++];this.iconOpacity=new Int32Array(u),this.textOpacity=new Int32Array(d),a=Q8t(n,s,o,a,this.symbols,i),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){M(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),M(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),M(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),M(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,M(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),M(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),M(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),M(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconOpacityBuffer;e.length>0&&e.byteLength===r.size&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,n=this.textOpacityBuffer;i.length>0&&i.byteLength===n.size&&n.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++];this.iconVertexBuffer=Ji.createVertex(e,ki.STATIC_DRAW,new Int32Array(s.buffer,4*i,o)),i+=o;const a=n[i++];this.iconIndexBuffer=Ji.createIndex(e,ki.STATIC_DRAW,new Uint32Array(n.buffer,4*i,a)),i+=a;const l=n[i++];this.textVertexBuffer=Ji.createVertex(e,ki.STATIC_DRAW,new Int32Array(s.buffer,4*i,l)),i+=l;const c=n[i++];this.textIndexBuffer=Ji.createIndex(e,ki.STATIC_DRAW,new Uint32Array(n.buffer,4*i,c)),i+=c,this.iconOpacityBuffer=Ji.createVertex(e,ki.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=Ji.createVertex(e,ki.STATIC_DRAW,this.textOpacity.buffer);const u=this.layer,d=u.iconMaterial,p=u.textMaterial;this.iconVertexArrayObject=new Zf(e,d.getAttributeLocations(),d.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new Zf(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}},K8t=class extends TH{constructor(e,r){super(e,r),this.type=Yh.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.circleIndexStart=i[n++],this.circleIndexCount=i[n++],this.bufferDataOffset=n}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){M(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),M(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),M(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++];this.circleVertexBuffer=Ji.createVertex(e,ki.STATIC_DRAW,new Int32Array(s.buffer,4*i,o)),i+=o;const a=n[i++];this.circleIndexBuffer=Ji.createIndex(e,ki.STATIC_DRAW,new Uint32Array(n.buffer,4*i,a)),i+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new Zf(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}};const pyr=!0,fyr=32,mxe=200,e9t=1/Fe("mapview-transitions-duration");let t9t=class extends Ws{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var i;if(this._stage===e)return;const r=this._stage;this._stage=e,e?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return k(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=T2(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=T2(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,r;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===i)this.computedVisible=this.visible;else{const s=e*e9t;this.computedOpacity=n>i?Math.max(i,n-s):Math.min(i,n+s),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},mse=class rT{static getId(e,r,i,n){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${n}`}constructor(e,r,i,n){this.set(e,r,i,n)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,n){this.set(e,r,i,n)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new rT(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,n){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[s,o,a,l]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new rT(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,n=this.world;return[new rT(e,r,i,n),new rT(e,r,i+1,n),new rT(e,r+1,i,n),new rT(e,r+1,i+1,n)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};mse.pool=new Sl(mse,null,null,25,50);let r9t=class extends t9t{constructor(e,r,i,n,s,o,a=s,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new mse(e),this.resolution=r,this.x=i,this.y=n,this.width=s,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;uhe(i,o,0,0,0,a,0,n,s,1),mO(this.transforms.dvs,e.displayViewMat3,i)}},PX=class jBe extends r9t{constructor(e,r,i,n,s,o,a,l=null){super(e,r,i,n,s,o,4096,4096),this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<mxe}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<mxe)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let r=!1;for(const i of e)if(this.layerData.has(i)){const n=this.layerData.get(i);this._memoryUsedByLayerData-=n.memoryUsed,n.type===Yh.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),r=!0),n.destroy(),this.layerData.delete(i),this.layerCount--}M(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(HBe.delete(this),jBe._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(e){let r=!1;if(e){const{bucketsWithData:i,emptyBuckets:n}=e,s=this._createRenderBuckets(i);if(n&&n.byteLength>0){const o=new Uint32Array(n);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of s)this._deleteLayerData(o),a.type===Yh.SYMBOL&&(this.symbols.set(o,a.symbols),r=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;M(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[i,n]of this.layerData)n.type===Yh.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,n=this.height/this.rangeY*r,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;hhe(o),fz(o,o,s),dhe(o,o,Math.PI*e.rotation/180),phe(o,o,[i,n,1])}_createTransforms(){return{dvs:ph(),tileMat3:ph(),tileUnitsToPixels:ph()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;e.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const n of e){const s=this._deserializeBucket(n,i);for(const o of s.layerUIDs)r.set(o,s)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case Yh.FILL:i=new Z8t(e,this.styleRepository);break;case Yh.LINE:i=new X8t(e,this.styleRepository);break;case Yh.SYMBOL:i=new J8t(e,this.styleRepository,this);break;case Yh.CIRCLE:i=new K8t(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e),this.layerCount--}};const HBe=new Map;function i9t(){HBe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}const Ayr={value:.5,readOnly:!0},n9t={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let DM=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},s9t=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},o9t=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new s9t(i,r)}computeMinMaxValue(e,r,i,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return n;const o=2**s;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return n;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,d=.5*dL;let p=(c-1)/o,A=(i-this.j*o)*p,v=(r-this.i*o)*p;if(p<1){const b=Math.floor(A),S=Math.floor(v),E=b+S*c,R=u[E],O=u[E+1],I=u[E+c],N=u[E+c+1];if(R+O+I+N<d){const L=A-b,B=v-S,U=S6(R,O,I,N,L,B),q=S6(R,O,I,N,L+p,B),Z=S6(R,O,I,N,L,B+p),X=S6(R,O,I,N,L+p,B+p);return n.min=Math.min(U,q,Z,X),n.max=Math.max(U,q,Z,X),n}A=b,v=S,p=1}else A=Math.floor(A),v=Math.floor(v),p=Math.ceil(p);for(let b=A;b<=A+p;b++)for(let S=v;S<=v+p;S++){const E=u[b+S*c];E<d?(a=Math.min(a,E),l=Math.max(l,E)):n.hasNoDataValues=!0}return n.min=a,n.max=l,n}};const a9t=.5*dL;function hs(t,e,r){if(k(r))return null;for(const i of r){if(!i)continue;const n=i.safeWidth;let s=He(i.dy*(i.y1-e),0,n),o=He(i.dx*(t-i.x0),0,n);const a=Math.floor(s),l=Math.floor(o),c=i.data.width,u=a*c+l,d=i.data.values,p=d[u],A=d[u+1],v=u+c,b=d[v],S=d[v+1];if(p+b+A+S<a9t){s-=a,o-=l;const E=p+(A-p)*o;return E+(b+(S-b)*o-E)*s}}return null}let af=class extends rt{constructor(e){super(e),this._handles=new cn}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles=yt(this._handles)}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const n=qBe(i.fullExtent,this.viewSpatialReference);M(n)&&e.push(iIe(n))}}),e}};function l9t(t,e){return t===wt.Global?new gse(e):new Ase(e)}h([f({readOnly:!0})],af.prototype,"layerViewsExtent",null),h([f({readOnly:!0})],af.prototype,"tiledLayersExtent",null),h([f({readOnly:!0})],af.prototype,"stencilEnabledExtents",null),h([f()],af.prototype,"viewSpatialReference",void 0),h([f()],af.prototype,"tilingScheme",void 0),h([f()],af.prototype,"defaultTiledLayersExtent",void 0),h([f({constructOnly:!0})],af.prototype,"layers",void 0),h([f({constructOnly:!0})],af.prototype,"layerViews",void 0),af=h([Q("esri.views.3d.terrain.ExtentHelper")],af);let gse=class extends af{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?aFe:Fbt}};gse=h([Q("esri.views.3d.terrain.ExtentHelperGlobal")],gse);let Ase=class extends af{_computeLayerViewsExtent(){const e=Yf(),r=this.viewSpatialReference;this.layerViews.forEach(s=>{const o=s.layer;if(s.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=qBe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,r);h2(e,a,e)}});const i=dee(e)?e:null,n=this._get("layerViewsExtent");return XT(i,n)?n:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=Yf();this.layers.forEach(o=>{if(o.loaded&&_5(o)){const a=xH(o,r,wt.Local);if(k(a))return;const{tileInfo:l,fullExtent:c}=a;M(l)&&M(c)&&(tV(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&h2(i,c,i)}}),h2(i,this.defaultTiledLayersExtent,i);const n=dee(i)?i:null,s=this._get("tiledLayersExtent");return XT(n,s)?s:n}};function qBe(t,e){return M(t)&&!t.spatialReference.equals(e)?l$e(t,t.spatialReference,e):t}Ase=h([Q("esri.views.3d.terrain.ExtentHelperLocal")],Ase);var di;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(di||(di={}));const iT=[di.ELEVATION,di.MAP];function WBe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const r=Object.keys(t);for(const i of r)i.search(".glsl")!==-1&&delete t[i]}}const c9t=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let bv,Qu=class extends rt{get running(){return this._placementDirty&&(this._drapeSources.size>0||this._view.graphics.length>0||tn.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this._view.state.isGlobal}get _worldToPCSRatio(){return M(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?ln(this._spatialReference).metersPerDegree:1}get _view(){return this.surface.view}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new cn,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=Fe("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){var r;const e=this._view;this.renderer=new F0({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=e0(this._view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",i=>{var n;return(n=e._stage)==null?void 0:n.renderer.setParameters({hasOverlayWater:i})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),xe(()=>{var i,n,s;return[(i=e.pointsOfInterest)==null?void 0:i.renderPointOfView,(s=(n=e.pointsOfInterest)==null?void 0:n.centerOnSurfaceFrequent)==null?void 0:s.location]},()=>this.setPlacementDirty()),xe(()=>{var i,n;return[(i=e.state)==null?void 0:i.pixelRatio,(n=e.state)==null?void 0:n.contentPixelRatio]},()=>this.setPlacementDirty(),fn),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(ar.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",i=>{this._updateOverlays(pu,i,so.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,so.BACKGROUND,i.pixelRatio)})]),(r=e._stage)==null||r.renderer.setParameters({renderOverlay:i=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(i),this._drawOverlayTextures(this.renderer.overlays,so.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})}destroy(){this._handles=yt(this._handles),M(bv)&&(bv.hide(),bv=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this._view.renderSpatialReference;M(e)&&M(r)?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new E2(-20037508342787e-6,20037508342787e-6):new E2(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),n}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Vd)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&M(e.setDrapingExtent)&&M(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this._view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this._view.state.contentCamera,so.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return rc.YIELD;const n=this._computeOverlayResolution(r);this._computeOverlayExtents(r,n,My);const s=sp(My.inner)/sp(My.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(bs.INNER,My.inner,n,1*My.pixelRatioAdjustment,My.mapUnitsPerPixel),a=this._updateOverlay(bs.OUTER,My.outer,n,s*My.pixelRatioAdjustment,My.mapUnitsPerPixel);o!==Xg.EXTENT&&a!==Xg.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),o===Xg.NONE&&a===Xg.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this._view.state.contentPixelRatio,i=e.fullWidth/e.pixelRatio*r,n=e.fullHeight/e.pixelRatio*r;return Math.min(VR(Math.max(i,n)+256),this._maxResolution)}_updateOverlay(e,r,i,n,s){if(this.renderer.overlays.length===0)return Xg.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=s,o.pixelRatio=n,u9t(r,o.extent)&&i===o.resolution)return a===s?Xg.NONE:Xg.RERENDER_ONLY;i1(o.extent,r),o.resolution=i;const l=ice(o.extent);return o.renderLocalOrigin=Z5(l[0],l[1],0,"OV_"+this._latestOriginId++),Xg.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[bs.INNER],n=this.renderer.overlays[bs.OUTER],s=e.extent;this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,n.extent)?(this._setTileOverlayData(s,bs.INNER,r),this._setTileOverlayData(s,bs.OUTER,r)):(this._clearTileOverlayData(bs.INNER,r),this._clearTileOverlayData(bs.OUTER,r))}else this._clearTileOverlayData(bs.INNER,r),this._clearTileOverlayData(bs.OUTER,r)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const r=this.renderer.overlays[bs.INNER],i=this.renderer.overlays[bs.OUTER],n=this._pointIsInExtent(e,r.extent)?r:i;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const n=this.renderer.overlays[r].extent,s=sp(n),o=$m(n);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(n[0],a);const l=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,sp(e)/s,$m(e)/o),i.setOffset(r,(a-n[0])/s,(e[1]-n[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){WBe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(pu)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||M(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,n=new J9e(this._view.state.camera,i,this._view.state.forcedAnimationTime);this.renderer.updateAnimation(n)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,n){const s=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,p9t,r,i);if(k(s))return!1;const o=s.origin,a=ze(M9,s.origin,s.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this._view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(n)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const n=.55,s=this._view.renderCoordsHelper.getAltitude(e.eye),o=this._view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=He(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+a,e.aboveGround?s-a:1/0),c=e.aboveGround;if(this._view.viewingMode==="global"){const u=M9;oP(KG(ej,ln(this._view.spatialReference).radius+l),xp(e.eye,e.viewForward),u),Ve(u,u,e.eye);const d=C2.normalize(X$e(e.viewForward,u,e.viewRight))/e.fovY+.5,p=d<=0||d>=1?.5:n;i=c?p*d:d+p*(1-d)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(u),p=Fr(0,d,1,0),A=cp(p,p,e.projectionMatrix)[1],v=He(.5+.5*A,0,1);i=v===1||v===0?.5:c?v*n:1-(1-v)*n}return!!this._intersectGroundFromView(e,.5,i,r)&&Ile(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const n=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=G();this._findHorizonBasedPointOfInterest(e,s)||Pe(s,n);const o=Math.max(.1,zn(e.eye,s)),a=U2(this._view.renderCoordsHelper,n,e.eye),l=Math.PI/2-Math.abs(a-Math.PI/2);tn.OVERLAY_SHOW_CENTER?(k(bv)&&(bv=new qC(this._view.graphics,"red")),bv.show(s,this._renderSR)):M(bv)&&bv.hide(),this._overlaySREqualsRenderSR||il(s,this._renderSR,s,this._spatialReference);const c=this.surface.extent,u=!this._isSpherical&&M(this._spatialReference)&&this._spatialReference.isGeographic,d=u&&M(this._spatialReference)?1/ln(this._spatialReference).metersPerDegree:1,p=this._view.state.contentPixelRatio,A=e.perScreenPixelRatio/p*o*d;i.mapUnitsPerPixel=A/this._worldToPCSRatio;let v=r*A/2,b=!1,S=u?90:1/0;this._isSpherical&&M(c)&&M(this._spatialReference)&&(this._spatialReference.isWebMercator?(v/=Math.cos(_B(s[1])),S=c[3]):(b=!0,v/=ln(this._spatialReference).metersPerDegree,S=90),v>=S&&(v=S,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let E=1;b&&(E=1/Math.max(.2,Math.cos(Math.abs(Dr(s[1])))),v*E>180&&(E=180/v),i.mapUnitsPerPixel*=E);const R=Math.log(2)/12;v=Math.exp(Math.round(Math.log(v)/R)*R);const O=v*E,I=32,N=.5*r/(I*O),L=.5*r/(I*v);s[0]=Math.round(s[0]*N)/N,s[1]=Math.round(s[1]*L)/L;const B=i.inner;B[0]=s[0]-O,B[1]=s[1]-v,B[2]=s[0]+O,B[3]=s[1]+v,this._isSpherical&&this._shiftExtentToFitBounds(B,1/0,S);const U=i.outer;if(6*O>sp(c))i1(U,c);else if(l<=.25*Math.PI)U[0]=B[0]-O,U[1]=B[1]-v,U[2]=B[2]+O,U[3]=B[3]+v;else{il(e.eye,this._renderSR,M9,this._spatialReference),iA(ix,s,M9);let Z=-Math.atan2(ix[1],ix[0])+.125*Math.PI;Z<0&&(Z+=2*Math.PI);const X=Math.floor(Z/(.25*Math.PI));YO(ix,c9t[X],2*v),ix[0]*=E,ix[2]*=E,$le(U,B,ix)}if(this._isSpherical)U[0]=this._longitudeCyclical.clamp(U[0]),U[2]=this._longitudeCyclical.clamp(U[2]),U[1]=Math.max(U[1],-S),U[3]=Math.min(U[3],S);else{const Z=pee(B,c,h9t),X=pee(U,c,d9t);wge(Z,X)&&(U[2]=U[0],U[3]=U[1])}const q=Math.abs(B[2]-B[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,q),i.pixelRatioAdjustment=i.mapUnitsPerPixel/q}_drawOverlayTextures(e,r,i=this._view.state.contentPixelRatio){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const n=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[bs.INNER],i),o=this._drawOverlay(e[bs.OUTER],i);s!==fO.CHANGED&&o!==fO.CHANGED||this.surface.updateTileOverlayParams(so.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),n?(this.surface.requestRender(r),r===so.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(so.BACKGROUND)}_drawOverlay(e,r){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,r)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,r){return!k(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):NG(e,r))}_rectInsideRect(e,r){return!k(r)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:wge(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,n=e.y;return i>r[0]&&i<r[2]&&n>r[1]&&n<r[3]}_shiftExtentToFitBounds(e,r,i){let n=0,s=0;e[0]<-r?n=e[0]+r:e[2]>r&&(n=r-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),OB(e,n,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(pu)}}};function u9t(t,e){const i=tn.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}h([f()],Qu.prototype,"_spatialReference",void 0),h([f({readOnly:!0})],Qu.prototype,"running",null),h([f()],Qu.prototype,"_placementDirty",void 0),h([f()],Qu.prototype,"_contentUpdated",void 0),h([f()],Qu.prototype,"_isSpherical",null),h([f()],Qu.prototype,"_worldToPCSRatio",null),h([f({autoDestroy:!0})],Qu.prototype,"renderer",void 0),h([f({constructOnly:!0})],Qu.prototype,"surface",void 0),h([f()],Qu.prototype,"suspended",null),h([f()],Qu.prototype,"updating",null),h([f({type:Boolean})],Qu.prototype,"hasHighlights",null),h([f({type:Boolean})],Qu.prototype,"rendersOccluded",null),Qu=h([Q("esri.views.3d.terrain.OverlayManager")],Qu);const ix=Kr(),M9=G(),My={inner:oi(),outer:oi(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},h9t=oi(),d9t=oi(),p9t=el();var Xg;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(Xg||(Xg={}));let QBe=class yse{constructor(e,r){this._factoryCallback=e,this._lengthCallback=r,this._pool=new Map}acquire(e){if(!yse.test.disabled){const r=this._pool.get(e);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(e)}catch(r){const i=window.performance&&window.performance.memory;let n="";throw i&&(n=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+r+n),r}}release(e){if(yse.test.disabled)return;const r=this._lengthCallback(e);let i=this._pool.get(r);i||(i=new Vr({shrink:!0}),this._pool.set(r,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};QBe.test={disabled:!1};let f9t=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=qn(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},gxe=class{constructor(e,r,i,n,s){this.attributes=e,this.localOrigin=r,this.index0=i,this.stride=n,this.count=s}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return at(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,r){this.attributes.position.getVec(e,r)}_getNormalRaw(e,r){this.attributes.normalCompressed.getVec(e,r)}getVertexPos(e,r){this._getVertexRaw(this.getAttributeIndex(r),e),ze(e,e,this.localOrigin)}getNormal(e,r){const i=Ft();this._getNormalRaw(this.getAttributeIndex(r),i),y9t(e,i)}_setNormal(e,r,i,n){VL(this.attributes.normalCompressed,e,r,i,n)}_setUV(e,r,i){fd(this.attributes.uv0,e,r,i)}setNormalFromValues(e,r,i,n){this._setNormal(this.getAttributeIndex(e),r,i,n)}setVertexFromValuesRawPositionUV(e,r,i,n,s,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,r,i,n),this._setUV(a,s,o)}setVertexFromValuesRawPositionUVNormal(e,r,i,n,s,o,a,l,c){const u=this.getAttributeIndex(e);this.attributes.position.setValues(u,r,i,n),this._setUV(u,s,o),this._setNormal(u,a,l,c)}};const m9t=Cs().vec3f(z.POSITION).vec2i16(z.UV0).vec2i16(z.NORMALCOMPRESSED,{glNormalized:!0}),ape=new QBe(t=>m9t.createBuffer(t),t=>t.count);function g9t(){ape.clear()}function YBe(t){return ape.acquire(t)}function A9t(t){ape.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}function VL(t,e,r,i,n){const s=1/(Math.abs(r)+Math.abs(i)+Math.abs(n)),o=r*s,a=i*s,l=n<=0?(o>=0?1:-1)*(1-Math.abs(a)):o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(o)):a;t.setValues(e,yxe(l),yxe(c))}function y9t(t,e){const r=_xe(e[0]),i=_xe(e[1]),n=1-Math.abs(r)-Math.abs(i);t[2]=n,n<0?(t[0]=(r>=0?1:-1)*(1-Math.abs(i)),t[1]=(i>=0?1:-1)*(1-Math.abs(r))):(t[0]=r,t[1]=i),Ye(t,t)}const Axe=16384;function fd(t,e,r,i){t.setValues(e,r*Axe,i*Axe)}function yxe(t){return He(Math.round(32767*t),-32767,32767)}function _xe(t){return He(t/32767,-1,1)}function _u(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}let _9t=class{constructor(){this.sinLonLUT=new Array(m4+1),this.cosLonLUT=new Array(m4+1),this.sinLatLUT=new Array(m4+1),this.cosLatLUT=new Array(m4+1)}update(e,r,i){const n=r[0],s=r[2];for(let o=0;o<=e;o++){const a=o/e,l=n*(1-a)+s*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},R9=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},v9t=class{constructor(){this.cornerNeighborData=[new R9,new R9,new R9,new R9],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},b9t=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.shading=!1,this.samplerDataVersion=0,this.neighborData=new v9t}},XBe=class hU{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=yt(this._current),this._next=yt(this._next),this._waiting=yt(this._waiting),this._delayed=yt(this._delayed)}get current(){if(k(this._current))return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=hU.test.fadeMoment;if(M(this._delayed)&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,H_.Immediate),this._delayed=null)),M(this._next)){e=e||performance.now();const r=this._fadeDuration,i=M(this._current)&&this._next.texture===this._current.texture,n=this._next.type!==sa.FADING,s=e-this._fadeStart>=r;(i||n||s)&&(yt(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(k(this._next))return 1;const e=hU.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return M(this._next)||M(this._delayed)}push(e,r=H_.Immediate){this._delayed=yt(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),k(this._current))return void(this._current=e);const i=hU.test.fadeMoment||performance.now();return r!==H_.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):k(this._next)?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(k(e)||(yt(this._waiting),this._waiting=e))}get _fadeDuration(){return k(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var H_;XBe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(H_||(H_={}));var RO;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(RO||(RO={}));let ZBe=class{constructor(){this._queue=new Vr,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),M(e)&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const e=(r=this._last)==null?void 0:r.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},w9t=class{constructor(){this._q=new Vr}get done(){return this._q.length===0}reset(e){if(this._q.clear(),!k(e)){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function nD(t,e,r){if(k(e)||k(e.fullExtent))return!1;const i=e.fullExtent,n=t.extent;if(r){if(n[0]<i.xmin||n[1]<i.ymin||n[2]>i.xmax||n[3]>i.ymax)return!1}else if(i.xmin>n[2]||i.ymin>n[3]||i.xmax<n[0]||i.ymax<n[1])return!1;const s=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&s>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&s<.99999999*a)}function q_(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function JBe(t,e,r=null){k(r)||r.length===0?t===RO.BACK_TO_FRONT?e.sort(x9t):e.sort(T9t):e.sort((i,n)=>S9t(i,n,t,r))}function x9t(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function T9t(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function KBe(t,e,r){const i=t.screenDepth,n=e.screenDepth;return i<n?-r:i>n?r:q_(t,e)}function S9t(t,e,r,i){return vxe(t,i)===vxe(e,i)?KBe(t,e,r):t?r:-r}function vxe(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function E9t(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function C9t(t,e){const r=t.length;for(let i=0;i<r;++i)t.getItemAt(i).updateDistanceToPOI(e);t.sort(E9t)}function M9t(t,e,r){let i=1,n=0,s=0;for(;t!==e;)if(i*=.5,n*=.5,s*=.5,1&t.lij[2]&&(n+=.5),!(1&t.lij[1])&&(s+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,n,s,i)}function R9t(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let n=0;n<4;n++){const s=i.children[n];if(s&&s!==r)return!0}}return!1}function $yr(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,n=r?e:t,s=1<<n[0]-i[0];return Math.floor(n[1]/s)===i[1]&&Math.floor(n[2]/s)===i[2]}let lpe=class{get updating(){return!!this._tileRequested}init(e,r,i,n){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,sa.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return M(e)?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),n=hse(i),{minLevel:s,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?nD:()=>!0;let u=this.tile;const d=u.level;let p;const A=this._tileLayerInfo.upsampleInfo,v=M(A)?A.tile.level:-1,b=!!M(A)&&v-d>=a,S=Oa(n,"tilemapCache");for(;u&&c(u,n,!1)&&u.level>=s;){const E=u.level,R=d-E,O=u.layerInfo[r][e];if(O.data&&R>=a){(!b||E>v)&&this._setUpsampleTile(u),O.dataInvalidated&&(p=u);break}if((k(S)||S.getAvailability(u.lij[0],u.lij[1],u.lij[2])!=="unavailable")&&E<=o&&!O.data&&!O.dataMissing&&((k(p)||u.level===s||E%oFe==0||d-p.level<a)&&(p=u),R>=l))break;u=u.parent}return M(p)&&d-p.level<a&&this._tileLayerInfo.upsampleInfo&&(p=null),p}_findAncestorWithData(){const e=this.tile.vlevel,r=this._desiredMinLevelDelta;let i;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=r)return n;i=n}return i}_setUpsampleTile(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,sa.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},O9t=class extends lpe{get _desiredMinLevelDelta(){throw bxe}get _progressiveLevelModulo(){throw bxe}dispose(){}};const bxe=new Error("Abstract method called on TileAgent"),Ch=new O9t;let eze=class extends lpe{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return sie(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},tze=class extends lpe{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return oFe}};var cS,JS;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(cS||(cS={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(JS||(JS={}));function P9t(t,e){t.fragment.uniforms.add([new _r("u_colormap",r=>r.u_colormap),new ut("u_colormapOffset",r=>r.colormap.u_colormapOffset),new ut("u_colormapMaxIndex",r=>r.colormap.u_colormapMaxIndex),new ut("u_opacity",r=>r.common.u_opacity)]),t.fragment.code.add(D`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${gu(e,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)}function I9t(t,e){t.fragment.uniforms.add(Sm("u_transformGrid",r=>r.u_transformGrid,e.hasWebGL2Context?hn.None:hn.InvSize)),t.fragment.uniforms.add(new ji("u_transformSpacing",r=>r.common.u_transformSpacing)),t.fragment.uniforms.add(new ji("u_targetImageSize",r=>r.common.u_targetImageSize)),t.fragment.code.add(D`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${gu(e,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${gu(e,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${gu(e,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${gu(e,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)}let rze=class extends En{constructor(){super(...arguments),this.scale=1,this.offset=yh}};function ize(t){t.attributes.add(z.POSITION,"vec2"),t.attributes.add(z.UV0,"vec2"),t.vertex.uniforms.add(new ut("scale",e=>e.scale)),t.vertex.uniforms.add(new ji("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(D`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let $9t=class extends rze{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function D9t(t,e){t.include(I9t,e),t.fragment.uniforms.add([new _r("u_image",r=>r.u_image),new z_("u_flipY",r=>r.common.u_flipY),new z_("u_applyTransform",r=>r.common.u_applyTransform)]),t.fragment.code.add(D`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}var mt;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(mt||(mt={}));const _se={normal:mt.Normal,average:mt.Average,lighten:mt.Lighten,lighter:mt.Lighter,screen:mt.Screen,plus:mt.Plus,"color-dodge":mt.ColorDodge,darken:mt.Darken,multiply:mt.Multiply,"color-burn":mt.ColorBurn,overlay:mt.Overlay,"soft-light":mt.SoftLight,"hard-light":mt.HardLight,"vivid-light":mt.VividLight,hue:mt.Hue,saturation:mt.Saturation,luminosity:mt.Luminosity,color:mt.Color,difference:mt.Difference,exclusion:mt.Exclusion,minus:mt.Minus,invert:mt.Invert,reflect:mt.Reflect,"destination-over":mt.DestinationOver,"destination-atop":mt.DestinationAtop,"destination-in":mt.DestinationIn,"destination-out":mt.DestinationOut,"source-atop":mt.SourceAtop,"source-in":mt.SourceIn,"source-out":mt.SourceOut,xor:mt.Xor};function L9t(t){return t===mt.DestinationOver||t===mt.DestinationAtop||t===mt.DestinationIn||t===mt.DestinationOut||t===mt.SourceAtop||t===mt.SourceIn||t===mt.SourceOut||t===mt.Xor}function cpe(t){t.code.add(D`
    float lineFactorAtPosition(float value) {
      float pos = value * ${D.float(257)};
      if(pos < 0.5 || pos > ${D.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function N9t(t,e){const r=e.blendMode;r!==mt.Normal&&(r===mt.Reflect&&t.code.add(D`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==mt.ColorDodge&&r!==mt.VividLight||t.code.add(D`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==mt.ColorBurn&&r!==mt.VividLight||t.code.add(D`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===mt.Overlay&&t.code.add(D`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===mt.HardLight&&t.code.add(D`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===mt.SoftLight&&t.code.add(D`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===mt.VividLight&&t.code.add(D`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==mt.Hue&&r!==mt.Saturation&&r!==mt.Color&&r!==mt.Luminosity||(t.code.add(D`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==mt.Hue&&r!==mt.Saturation||t.code.add(D`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(D`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===mt.Multiply?D`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.Average?D`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.Lighten?D`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.Darken?D`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.Lighter?D`return vec4(cl * ol + cb * ob, ol + ob);`:r===mt.Plus?D`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===mt.Minus?D`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===mt.Screen?D`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.Difference?D`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.Invert?D`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===mt.DestinationOver?D`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===mt.DestinationAtop?D`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===mt.DestinationOut?D`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===mt.SourceAtop?D`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===mt.SourceOut?D`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===mt.Xor?D`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===mt.DestinationIn?D`return vec4(cb * ob * ol, ol * ob);`:r===mt.SourceIn?D`return vec4(cl * ol * ob, ol * ob);`:r===mt.Hue?D`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.Saturation?D`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.Color?D`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.Luminosity?D`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.Exclusion?D`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.Reflect?D`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.ColorDodge?D`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.ColorBurn?D`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.Overlay?D`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.SoftLight?D`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.HardLight?D`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===mt.VividLight?D`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:D``}
    }
  `))}var Sa,ym,J0;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(Sa||(Sa={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(ym||(ym={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(J0||(J0={}));function nze(t,e){const r=e.output===Sa.GridComposite,i=e.output===Sa.ColorComposite,n=e.output===Sa.GroupBackgroundComposite,s=e.output===Sa.Composite;r&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(cpe)),i&&t.fragment.uniforms.add(new kr("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===ym.Required;if(o&&t.fragment.uniforms.add(new ut("baseOpacity",c=>c.baseOpacity)),s){const c=e.hasWebGL2Context?hn.None:hn.InvSize;t.fragment.uniforms.add(Sm("fboColor",u=>u.fboTexture,c))}const a=e.blendMode!==mt.Normal,l=e.premultipliedSource===J0.On;t.fragment.include(N9t,e),t.fragment.code.add(D`
    vec4 getBackground(vec2 uv) {
      return ${o?D`baseOpacity *`:""} ${n?D`vec4(0.0, 0.0, 0.0, 0.0)`:i?D`vec4(backgroundColor, 1.0)`:r?D`vec4(gridColor(uv), 1.0)`:D`${gu(e,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?D`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:D`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(s&&!o||n)?D`colorLayer * opacity;`:D`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let SH=class extends $9t{constructor(e,r,i,n,s,o){super(e,n,s),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=Ec,this.fboTexture=null,this.baseOpacity=1}},F9t=class extends SH{},k9t=class extends SH{};function U9t(t){const e=new Ui;return e.include(ize),e.include(D9t,t),e.include(P9t,t),e.include(nze,t),e.fragment.code.add(D`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===cS.Stretch?z9t(e,t):t.colorizerType===cS.Lut?B9t(e):t.colorizerType===cS.Hillshade&&V9t(e,t),e}function B9t(t){t.fragment.code.add(D`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function z9t(t,e){t.fragment.uniforms.add([new dF("u_bandCount",i=>i.symbolizer.u_bandCount),new bc("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new bc("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new bc("u_factor",i=>i.symbolizer.u_factor,3),new ut("u_minOutput",i=>i.symbolizer.u_minOutput),new ut("u_maxOutput",i=>i.symbolizer.u_maxOutput),new z_("u_useGamma",i=>i.symbolizer.u_useGamma),new bc("u_gamma",i=>i.symbolizer.u_gamma,3),new bc("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new ut("u_opacity",i=>i.common.u_opacity)]),t.fragment.code.add(D`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?D`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:D`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(D`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===JS.Noop?D`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:D`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function V9t(t,e){const r=t.fragment;r.uniforms.add([new _r("u_image",n=>n.u_image),new dF("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new bc("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new bc("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new bc("u_cosZs",n=>n.symbolizer.u_cosZs,6),new bc("u_weights",n=>n.symbolizer.u_weights,6),new ji("u_factor",n=>n.symbolizer.u_factor),new ut("u_minValue",n=>n.symbolizer.u_minValue),new ut("u_maxValue",n=>n.symbolizer.u_maxValue),new ji("u_srcImageSize",n=>n.common.u_srcImageSize)]),r.include(ry),r.code.add(D`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(D`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?D`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:D`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(D`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const G9t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:k9t,ColorizerStretchUniforms:F9t,ColorizerUniforms:SH,build:U9t},Symbol.toStringTag,{value:"Module"}));function j9t(t,e,r="nearest",i=!1){var c;const n=!(i&&e.pixelType==="u8"),s=n?xr.FLOAT:xr.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:n?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:e.width,height:e.height,target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,internalFormat:t.type===lr.WEBGL2&&n?pr.RGBA32F:_t.RGBA,samplingMode:!a||r!=="bilinear"&&r!=="cubic"?zt.NEAREST:zt.LINEAR,dataType:s,wrapMode:Ar.CLAMP_TO_EDGE,flipped:!1};return new Xt(t,l,o)}function H9t(t,e){const{spacing:r,offsets:i,coefficients:n,size:[s,o]}=e,a=r[0]>1,l={width:a?4*s:s,height:o,target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,internalFormat:t.type===lr.WEBGL2?pr.RGBA32F:_t.RGBA,dataType:xr.FLOAT,samplingMode:zt.NEAREST,wrapMode:Ar.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?s*o*16:2*i.length);if(a&&n!=null)for(let u=0,d=0;u<n.length;u++)c[d++]=n[u],u%3==2&&(c[d++]=1);else for(let u=0;u<o;u++)for(let d=0;d<s;d++){const p=4*(u*s+d),A=2*(d*o+u);c[p]=i[A],c[p+1]=i[A+1],c[p+3]=i[A]===-1?0:1}return new Xt(t,l,c)}function wxe(t,e){const r={width:e.length/4,height:1,target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,internalFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.NEAREST,wrapMode:Ar.CLAMP_TO_EDGE,flipped:!1};return new Xt(t,r,e)}function q9t(t,e,r,i=1,n=!0){return{u_flipY:n,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:yh,u_transformGridSize:t?t.size:yh,u_targetImageSize:e,u_srcImageSize:r}}function W9t(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function Q9t(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function Y9t(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const xxe={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let X9t=class{constructor(e,r,i=null,n=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=r,this.width=i||r.width,this.height=n||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=kt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...xxe,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||xxe}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){M(e)&&e.length>0?this._bandIds&&e.every((r,i)=>{var n;return!!((n=this._bandIds)!=null&&n[i])&&r===this._bandIds[i]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,M(this._rasterTexture)){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?zt.LINEAR:zt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=kt(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((k(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(e,this.bandIds),M(this._rasterTexture)&&(this._updateColormapTexture(e),this.transformGrid&&k(this._transformGridTexture)&&(this._transformGridTexture=H9t(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:n,opacity:s}=this,o=q9t(r,[i,n],[this.source.width,this.source.height],s),a=W9t(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Q9t(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Y9t(this.symbolizerParameters):null;return new SH(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(k(this._memoryUsed)){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>M(r)?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=kt(this._rasterTexture),this._transformGridTexture=kt(this._transformGridTexture),this._colormapTexture=kt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=kt(this._rasterTexture));const n=k(r)&&k(this.bandIds)||M(r)&&M(this.bandIds)&&r.join("")===this.bandIds.join("");if(M(this._rasterTexture)&&n)return;this._rasterTexture=kt(this._rasterTexture);const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=j9t(e,i,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((n,s)=>n!==r[s])?(this._colormapTexture=kt(this._colormapTexture),this._colormapTexture=wxe(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=wxe(e,i),void(this._colormap=i)):(this._colormapTexture=kt(this._colormapTexture),void(this._colormap=null))}},dU=class{constructor(){this.waitingAgents=new Vr,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=IX.acquire();return r._init(e),r}release(){this.dispose(),pU.delete(this),IX.release(this)}dispose(){this.loadingAgent=kt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=gR(this._data)}static prune(){IX.prune(0)}_init(e){this.waitingAgents.clear(),this._data=gR(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Gf(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){M(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e===r||k(r))this._unsetUpsampleInfo();else{if(k(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),M9t(e,r,this._upsampleInfo)}}get data(){return this._data}set data(e){gR(this._data),this._data=e}};const IX=new Sl(dU,null,()=>{}),pU=new Map;function Z9t(){pU.size>0&&(console.log(`${pU.size} live TilePerLayerInfo allocations:`),pU.forEach(t=>console.log(t,`
`)))}let WC=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}};var fr;(function(t){t[t.NONE=0]="NONE",t[t.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",t[t.SPLIT=2]="SPLIT",t[t.VSPLITMERGE=4]="VSPLITMERGE",t[t.MERGE=8]="MERGE",t[t.RENDERDATA=16]="RENDERDATA",t[t.GEOMETRY=32]="GEOMETRY",t[t.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=128]="TEXTURE_FADING"})(fr||(fr={}));const $X=G(),P3=G(),ol=G(),J9t=.1;let upe=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=oi(),this._elevationBounds=Ft(),this.layerInfo=[[],[]],this.extentInRadians=oi(),this.centerAtSeaLevel=G(),this._center=[G(),Ho(),G()],this.up=Ole(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=G()}static prune(){hpe.prune(0),dpe.prune(0),dU.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Oo.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){var i;this._dirty=!1;const e=((i=this.parent)==null?void 0:i.frustumVisibility)??Ac.INTERSECTS;this._frustumVisibility=e===Ac.INSIDE?Ac.INSIDE:e===Ac.OUTSIDE?Ac.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==Ac.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){const e=this._surface.snapLevel;if(M(e)){const r=this.level-e;if(r===0)return!0;if(r===1)return!1}return this.isLeaf}init(e,r,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=ln(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Oo.MIDDLE][3]=0,this.vlevel=e?e[0]:0,r&&r.elevationBounds?$a(this._elevationBounds,r.elevationBounds):ti(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const n of iT){const s=i.numLayers(n),o=this.layerInfo[n];for(const a of o)a.release();o.length=s;for(let a=0;a<s;a++)o[a]=dU.acquire(this._surface.upsampleInfoPool),n===di.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,m4)}release(){Kg(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of iT){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[di.MAP].reduce((e,r)=>e+(r instanceof PX?r.memoryUsage:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){if(M(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:i}of this.layerInfo[di.MAP])i instanceof PX?e+=this._getTerrainDataMemory(i):this._mapTileMemoryInternal+=this._getTerrainDataMemory(i);const r=this._cpuImageMemorySize;for(const i of this.layerInfo[di.ELEVATION])this._usedMemory+=i.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=VS(this.renderData.textureDescriptor)),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i!=null&&i.data?e===di.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===di.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof WC?VS(e.texture):e instanceof HTMLImageElement||e instanceof bH?this._cpuImageMemorySize:e instanceof PX||e instanceof X9t?e.memoryUsage:0}updateScreenDepth(e){const r=this._center[Oo.MIDDLE],i=e,n=r[0],s=r[1],o=r[2],a=i[2]*n+i[6]*s+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*n+i[7]*s+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||M(e.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Ac.OUTSIDE))return fr.NONE;const n=this.level;Ve($X,this._center[Oo.MIDDLE],r);let s=vc($X),o=Oo.MIDDLE;Ve(P3,this._center[Oo.TOP],r);const a=vc(P3);a<s&&(s=a,o=Oo.TOP),Ve(P3,this._center[Oo.BOTTOM],r);const l=vc(P3);if(l<s&&(s=l,o=Oo.BOTTOM),this._edgeLen2>s&&n<e.maxLod)return fr.SPLIT;const c=Math.sqrt(s),u=e.fovX*c*2,d=this._edgeLen/u,p=()=>{const S=n+Math.ceil(-Math.log2(e.relativeWidthLimit/d));return S!==this.vlevel?(this.vlevel=S,fr.VSPLITMERGE):fr.NONE_HIT_MAXLOD};if(M(i)&&i-n===1)return n>=e.maxLod?p():fr.SPLIT;const A=Qe(this.up,$X),v=this._elevationBounds[1]-this._elevationBounds[0],b=v/this.edgeLen;if(e.aboveGround&&A>0&&b<.001&&A/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return fr.NONE;if(d<e.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,fr.VSPLITMERGE):fr.NONE;if(n>=e.maxLod)return p();if(n>6){Ve(P3,this._center[o],r),Oe(ol,this.up,A),Ve(ol,ol,P3);const S=vc(ol);if(S>this.radius*this.radius){Oe(ol,ol,this.radius/Math.sqrt(S)),ze(ol,ol,this._center[o]),Ve(ol,r,ol);const E=Math.min(1,(Math.abs(Qe(ol,this.up))+.5*v+this._curvatureHeight)/ct(ol)),R=J9t/e.angledSplitBias,O=e.fovY*c*2;if(E*(this._edgeLen/O)<R*e.relativeHeightLimit)return fr.NONE}}return fr.SPLIT}setChildren(e,r,i,n){Kg(!!(e&&r&&i&&n),"Null child passed"),this._children[0]=e,this._children[1]=r,this._children[2]=i,this._children[3]=n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of iT)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of iT){const i=this.layerInfo[r];for(const n of i)n.loadingAgent&&n.loadingAgent!==Ch&&(O9(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(fr.GEOMETRY),this.resetPendingUpdate(fr.TEXTURE_NOFADING),this.resetPendingUpdate(fr.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[di.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==Ch&&(O9(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(XT(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;M(e)?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=i&&this._isWithinClippingArea,s=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(fr.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of iT){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==Ch&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(fr.SPLIT)||e!==di.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===fr.SPLIT||e===fr.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const n=this.layerInfo[r][e];if(n.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),!0;if(n.waitingAgents.push(i),n.data&&!n.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),i.dataArrived(this),!0;if(n.requestPromise)return!0;Gf(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,r,n.requestAbort);if(!s)return n.requestAbort=null,!1;const o=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return vc(Ve(ol,this._center[Oo.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const n=this.layerInfo[r][e],s=n.waitingAgents,o=s.removeUnordered(i)!=null;Kg(o,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const n=this.layerInfo[r][e];n.data=i,n.dataInvalidated=!1,n.waitingAgents.forAll(s=>s.dataArrived(this)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${e} error ${i}`);const n=this.layerInfo[r][e];n.dataMissing=!0,n.waitingAgents.forAll(s=>s.dataMissing()),n.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r){switch(e){case di.MAP:return this._updateTexture(r);case di.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===sa.FADING?fr.TEXTURE_NOFADING:fr.TEXTURE_FADING),this.setPendingUpdate(e===sa.FADING?fr.TEXTURE_FADING:fr.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(fr.GEOMETRY);for(const e of this.layerInfo[di.ELEVATION])e.pendingUpdates|=fr.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBounds,r=e[0],i=e[1];ti(e,1/0,-1/0);const n=this.layerInfo[di.ELEVATION];let s=!0;for(const o of n)M(o.elevationBounds)&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(s=!1));s&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),r===e[0]&&i===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,r=.5*(e[0]+e[1]),i=this._center;Oe(ol,this.up,r),ze(i[Oo.MIDDLE],this.centerAtSeaLevel,ol),Oe(ol,this.up,e[0]),ze(i[Oo.TOP],this.centerAtSeaLevel,ol),Oe(ol,this.up,e[1]),ze(i[Oo.BOTTOM],this.centerAtSeaLevel,ol)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[di.ELEVATION][e],n=sie(this.level),s=Math.max(this.vlevel-n,0),o=i.elevationBounds;if(M(o)&&o.level>=r&&o.level<=s)return;const a=this._surface.layerViewByIndex(e,di.ELEVATION),l=hse(a);if(!nD(this,l,!1))return;const c=e7t;let u=!1;const d=i.data;if(d&&d.level<=s){const p=i.data;c.min=p.samplerData.data.minValue,c.max=p.samplerData.data.maxValue,c.hasNoDataValues=p.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let p,A,v=0;for(let b=this._parent;b&&(!A||v<n)&&(v=this.vlevel-b.level,p=A||p,A=b.layerInfo[di.ELEVATION][e].data,!(!A&&p&&b.level<=s));b=b.parent);A=A||p,A&&(A.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=A.level,u=!0))}u&&(k(i.elevationBounds)&&(i.elevationBounds=new DM),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const n=this.layerInfo[i];for(const a of n)a.loadingAgent&&a.loadingAgent!==Ch&&(O9(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<n.length;++a)e[a]===void 0&&n[a].release();const s=new Array(...n),o=r.length;n.length=o;for(let a=0;a<o;a++){const l=r[a];n[a]=l>-1?s[l]:dU.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,sa.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===Ch&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of iT){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==Ch&&(i.loadingAgent.setSuspension(r),i.loadingAgent===Ch&&this.updateRenderData(e,sa.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==Ch&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=Ch,!i.data&&k(i.upsampleInfo)&&this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||zR(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){var n,s,o;for(let a=e;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(rV(l)&&((n=l==null?void 0:l.layer)==null?void 0:n.blendMode)!=="normal"||zR((s=l==null?void 0:l.layer)==null?void 0:s.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const n=this._isSuspended(r);for(let s=e;s<i.length;++s){const o=i[s];let a=!1;const l=this._surface.layerViewByIndex(s,r),c=hse(l);if(o.loadingAgent?nD(this,c,!1)?(o.loadingAgent!==Ch&&o.loadingAgent.setSuspension(n),o.loadingAgent!==Ch&&(a=o.loadingAgent.update())):o.dispose():nD(this,c,!1)&&(o.loadingAgent=K9t(this,s,r,n),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Ch&&this.setPendingUpdate(fr.GEOMETRY):(O9(o.loadingAgent),o.loadingAgent=Ch)),o.loadingAgent===Ch&&this.updateRenderData(r,sa.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.vlevel-this.level,i=Math.max(this.level-e,sie(this.level)-r),n=He(1+(this.maxTesselation>>i),2,this.maxTesselation+1),s=this.getDefaultVerticesPerSide();return Math.max(n,s)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(M(i)){for(const n of i)if(t7t(n,e)){let s=n,o=e[0]-s.level-1;for(;o>=0&&!s.isLeaf&&!r(s);){const a=e[1]>>o&1,l=e[2]>>o&1;s=s.children[2*a+l],o--}return r(s)?s:null}}return null}findNeighborTile(e,r){const i=this.lij,n=this.getNeighborLIJ(i,e);return n?r7t(i,n)?r(this)?this:null:this._findLIJ(n,r):null}findCorner(e,r){const i=e===gr.NORTH_EAST?1:e===gr.NORTH_WEST?0:e===gr.SOUTH_WEST?2:3;let n=this;for(;n.children[0]&&(!r||!r(n));)n=n.children[i];return n}findNeighborCornerTileExact(e,r){var i;return((i=this.findNeighborTile(e,n=>r(n)||n.level===this.level))==null?void 0:i.findCorner(fse(e),r))||null}forAllSubtreeOnSide(e,r){const i=e===gr.NORTH?[0,1]:e===gr.NORTH_EAST?[1]:e===gr.EAST?[1,3]:e===gr.SOUTH_EAST?[3]:e===gr.SOUTH?[2,3]:e===gr.SOUTH_WEST?[2]:e===gr.WEST?[0,2]:[0],n=s=>{const o=s.children;!r(s)&&o[0]&&i.forEach(a=>n(o[a]))};n(this)}forallNeighbors(e){nV.forEach(r=>this.findNeighborCornerTileExact(r,e)),pA.forEach(r=>{var i;return(i=this.findNeighborTile(r,n=>n.level===this.level||e(n)))==null?void 0:i.forAllSubtreeOnSide(iV(r),e)})}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(at(!ha||i>=0),i===0)return 0;const n=2**i,s=(1&e)==1,o=s?0:1,a=r.lij[o+1]*n,l=this.lij[o+1],c=l-a,u=s?n-1-c:c;return ha&&(at(a<=l&&l<a+n),at(0<=u&&u<n)),u}forEachLoadedNeighbor(e){const r=this.level,i=n=>n.level===r||n.isLoaded;pA.forEach(n=>{const s=this.findNeighborTile(n,i);s!=null&&s!==this&&s.forAllSubtreeOnSide(iV(n),o=>!!o.isLoaded&&(e(o,n),!0))}),nV.forEach(n=>{var o;const s=(o=this.findNeighborTile(n,i))==null?void 0:o.findCorner(fse(n),a=>a.isLoaded);at(!s||vse(this,s,n)),s!=null&&s.isLoaded&&e(s,n)})}getNeighborLIJ(e,r){const i=cxe(r)?-1:lxe(r)?1:0,n=oxe(r)?-1:axe(r)?1:0,s=[e[0],e[1]+i,e[2]+n];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+Dc()>=this.surface.extent[1]}checkGeometryWaterproofness(){var e;eV&&(at(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,n=.25*(r[2]-r[0]);if(cxe(e)&&r[3]+n>=i[3]||lxe(e)&&r[1]-n<=i[1])return!1;const s=this.surface.isGlobal;return!(!s&&oxe(e)&&r[0]-n<=i[0])&&!(!s&&axe(e)&&r[2]+n>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;Pe(this._lastPOI,e);const i=this._center[Oo.MIDDLE],n=e[0]-i[0],s=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=n*n+s*s+o*o}};function K9t(t,e,r,i){const n=r===di.ELEVATION?dpe.acquire():hpe.acquire();return n.init(t,e,r,i),n}function O9(t){t.dispose(),t instanceof eze?dpe.release(t):t instanceof tze&&hpe.release(t)}const hpe=new Sl(tze),dpe=new Sl(eze),e7t=new DM;var Oo;function t7t(t,e){const r=t.level,i=e[0];if(r>i)return!1;const n=i-r,s=Math.floor(e[1]/2**n),o=Math.floor(e[2]/2**n);return s===t.lij[1]&&o===t.lij[2]}function r7t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function i7t(t,e,r){if(k(t)||k(e))return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===gr.EAST||t.isWestEnd&&e.isEastEnd&&r===gr.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case gr.NORTH:return wf(t.extent[3],e.extent[1],i);case gr.SOUTH:return wf(t.extent[1],e.extent[3],i);case gr.EAST:return wf(t.extent[2],e.extent[0],i)||wf(t.extent[2],-e.extent[0],i);case gr.WEST:return wf(t.extent[0],e.extent[2],i)||wf(t.extent[0],-e.extent[2],i)}}function vse(t,e,r){return!k(t)&&!k(e)&&e!==t&&(t.level>=e.level?Txe(t,e,r):Txe(e,t,fse(r)))}function Txe(t,e,r){at(t.level>=e.level);const i=b8t(r),n=w8t(r),s=t.extent,o=e.extent,a=[i?s[0]:s[2],n?s[3]:s[1]],l=[i?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),u=wf(a[0],l[0],c)||t.surface.isGlobal&&wf(a[0],-l[0],c),d=wf(a[1],l[1],c);if(u&&d)return!0;if(t.level===e.level||!u&&!d)return at(!1),!1;const p=u?Sxe(o[1],o[3],s[1],s[3],c):Sxe(o[0],o[2],s[0],s[2],c);return at(p),p}function Sxe(t,e,r,i,n=Dc()){return t-n<=r&&r<=i&&i<=e+n}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Oo||(Oo={}));let n7t=class{constructor(){this._scales=Fr(-1,-1,-1,-1),this._offsets=Fr(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function s7t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(D`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(D`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(D`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let ppe=class extends Gke{constructor(){super(...arguments),this.slicePlaneLocalOrigin=G(),this.origin=this.slicePlaneLocalOrigin}};var rd;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(rd||(rd={}));let o7t=class extends ppe{constructor(){super(...arguments),this.identifier=rd.Material,this.output=ne.Color,this.transparent=!1,this.integratedMesh=!1}},a7t=class extends ppe{constructor(){super(...arguments),this.identifier=rd.ShadowMap}},l7t=class extends ppe{constructor(){super(...arguments),this.identifier=rd.Highlight}},sV=class extends Ys{constructor(e,r){super(e,"vec4",Sn.Draw,(i,n,s)=>i.setUniform4fv(e,r(n,s)))}};var W_;function c7t(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add([new sV("overlayTexOffset",(n,s)=>u7t(n,s)),new sV("overlayTexScale",(n,s)=>h7t(n,s))]),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new _r("ovColorTex",(n,s)=>bse(n,s))),sze(t,e)}function sze(t,e){t.extensions.add("GL_OES_standard_derivatives"),e.pbrMode!==Jt.Water&&e.pbrMode!==Jt.WaterOnIntegratedMesh&&e.pbrMode!==Jt.TerrainWithWater||t.include(Qke,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(D`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(D`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(D`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(D`
    vec4 getOverlayColorTexel(vec4 texCoords) {
          vec2 texDim =  ${Nf(e,"ovColorTex")};

          vec4 color0 = ${gu(e,"ovColorTex","vec2(texCoords.x * 0.5, texCoords.y)*texDim")};
          vec4 color1 = ${gu(e,"ovColorTex","vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim")};

          bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
          bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));

          return mix(color1 * float(isValid1), color0, float(isValid0));
    }
  `),e.pbrMode!==Jt.Water&&e.pbrMode!==Jt.WaterOnIntegratedMesh&&e.pbrMode!==Jt.TerrainWithWater||(x1(i),ty(i),i.code.add(D`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function bse(t,e){return e.overlays.length===0?null:t.identifier===rd.Material&&t.output===ne.Color?e.overlays[bs.INNER].getColorTextureNoRasterImage():t.identifier===rd.Material&&t.output===ne.ObjectAndLayerIdColor?e.overlays[bs.INNER].getColorTexture(ih.ObjectAndLayerIdColor):t.identifier===rd.Highlight?e.overlays[bs.INNER].getValidTexture(Vs.Highlight):null}function u7t(t,e){for(const r of e.overlays){const{index:i,extent:n}=r;nIe(n)>0&&(AR[2*i]=t.toMapSpace[0]/sp(n)-n[0]/sp(n),AR[2*i+1]=t.toMapSpace[1]/$m(n)-n[1]/$m(n))}return AR}function h7t(t,e){for(const r of e.overlays){const{index:i,extent:n}=r;nIe(n)>0&&(AR[2*i]=t.toMapSpace[2]/sp(n),AR[2*i+1]=t.toMapSpace[3]/$m(n))}return AR}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(W_||(W_={}));const AR=Kr();var fA;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(fA||(fA={}));let d7t=class extends En{constructor(){super(...arguments),this.overlayOpacity=1}};function e$(t,e){t.vertex.uniforms.add([new oV("overlayTexOffset"),new oV("overlayTexScale")]),t.fragment.uniforms.add([new ut("overlayOpacity",r=>r.overlayOpacity),new _r("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[bs.INNER].getColorTexture(r.overlaySource))]),sze(t,e)}function p7t(t,e){const{vertex:r,fragment:i,varyings:n}=t;n.add("vtc","vec2"),r.uniforms.add(new oV("texOffsetAndScale")),i.uniforms.add(new Exe("tex")),i.uniforms.add(new DX("textureOpacities"));const s=e.textureFadingEnabled&&!e.renderOccluded;s&&(r.uniforms.add(new oV("nextTexOffsetAndScale")),n.add("nvtc","vec2"),i.uniforms.add(new Exe("texNext")),i.uniforms.add(new DX("nextTexOpacities")),i.uniforms.add(new f7t("fadeFactor")));const o=e.tileBlendInput===fA.ColorComposite,a=e.tileBlendInput===fA.GridComposite;a&&i.include(cpe),o&&i.uniforms.add(new DX("backgroundColor")),r.code.add(D`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?D`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:D``}
  }`),i.code.add(D`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?D`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?D`backgroundColor`:D`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:D`return color;`}
    }`),s?i.code.add(D`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(D`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}let f7t=class extends Ys{constructor(e){super(e,"float")}},DX=class extends Ys{constructor(e){super(e,"vec3")}},oV=class extends Ys{constructor(e){super(e,"vec4")}},Exe=class extends Ys{constructor(e){super(e,"sampler2D")}},oze=class extends d7t{};function m7t(t){const e=new Ui,{vertex:r,fragment:i,varyings:n}=e;e.include(KN),e.include(hF,t),e.include(TA,t);const s=()=>{e.include(LL,t),r.code.add(D`
      vec3 decodeNormalTerrain(vec2 e) {
        float z = 1.0 - abs(e.x) - abs(e.y);
        vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
        return normalize(n);
      }

      vec3 getNormal() {
        return  ${t.shading?D`decodeNormalTerrain(normalCompressed)`:D`getLocalUp(position, localOrigin)`};
      }
  `)};pd(r,t),e.include(uh,t);const o=t.overlayMode!==W_.Disabled;switch(t.output){case ne.Color:{e.include(p7t,t),e.include(ZS,t),o&&e.include(e$,{...t,pbrMode:t.pbrMode===Jt.Terrain?Jt.TerrainWithWater:Jt.Water});const a=t.overlayMode===W_.EnabledWithWater;a&&e.include(s7t,t),n.add("vnormal","vec3"),n.add("vpos","vec3"),n.add("vup","vec3"),s(),(t.atmosphere||t.screenSizePerspective)&&wO(r);const l=t.receiveShadows&&!t.renderOccluded;l&&e.include(AP,t),t.atmosphere&&n.add("wnormal","vec3"),t.screenSizePerspective&&(n.add("screenSizeDistanceToCamera","float"),n.add("screenSizeCosAngle","float")),r.code.add(D`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${a?D`forwardVertexTangent(vnormal);`:D``}

          ${t.atmosphere?D`wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?D`setOverlayVTC(uv);`:""}
          ${t.tileBorders?D`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?D`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${l?D`forwardLinearDepth();`:""}

        }
      `),e.extensions.add("GL_OES_standard_derivatives"),e.extensions.add("GL_EXT_shader_texture_lod"),e.include(To,t),e.include(ZS,t),e.include(pF,t),e.include(XS,t),Um(i,t),fF(i),EP(i),i.uniforms.add([r.uniforms.get("localOrigin"),new kr("viewDirection",(c,u)=>Ye(Cxe,Le(Cxe,u.camera.viewMatrix[12],u.camera.viewMatrix[13],u.camera.viewMatrix[14])))]),a&&i.uniforms.add([new _r("ovWaterTex",(c,u)=>u.overlays.length===0?null:u.overlays[bs.INNER].getNormalTexture(c.overlaySource)),new B9e("view",(c,u)=>Ah(g7t,u.camera.viewMatrix,c.origin))]),i.code.add(D`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),x1(i),ty(i),i.code.add(D`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical&&t.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?D`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?D`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }
          ${t.atmosphere?D`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${t.atmosphere?D`atm + tileColor.rgb;`:D`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===Jt.Terrain||t.pbrMode===Jt.TerrainWithWater?D`gl_FragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:D`gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${a?D`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?D`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?D`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:D`
                  vec3 tNormal = normalize(normal);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?D`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `)}break;case ne.Depth:o&&e.include(e$,t),e.include(h1,t),N2(e),jS(e),r.code.add(D`
              void main(void) {
                ${o?D`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(D`
              void main() {
                ${o&&t.invisible?D`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case ne.Shadow:case ne.ShadowHighlight:case ne.ShadowExcludeHighlight:e.include(h1,t),N2(e),jS(e),r.code.add(D`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(D`void main() {
outputDepth(linearDepth);
}`);break;case ne.Normal:o&&e.include(e$,t),n.add("vnormal","vec3"),wO(r),s(),r.code.add(D`
            void main(void) {
              ${o?D`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(D`
            void main() {
              ${o&&t.invisible?D`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case ne.Highlight:o&&e.include(e$,t),r.code.add(D`
          void main() {
            ${o?D`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(P1,t),i.code.add(D`
          void main() {
            ${o?D`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===ne.ObjectAndLayerIdColor&&(e.include(e$,{...t,pbrMode:Jt.Disabled}),r.code.add(D`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(D`void main() {
gl_FragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const g7t=ht(),Cxe=G(),A7t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:oze,build:m7t},Symbol.toStringTag,{value:"Module"}));let aze=class lze extends qi{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2,r.spherical=e.viewingMode===wt.Global}initializeProgram(e){return new zi(e.rctx,lze.shader.get().build(this.configuration),cze)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Pr({blending:r.renderOccluded?jm(st.ONE,st.ONE_MINUS_SRC_ALPHA):null,culling:i?ehe:null,depthTest:r.renderOccluded?null:{func:Qn.LESS},depthWrite:r.renderOccluded?null:_h,colorWrite:Gr,stencilTest:e?v$t(dh.IntegratedMeshMaskExcluded):null})}getPipelineState(e,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,r)}};aze.shader=new Bi(A7t,()=>be(()=>import("./Terrain.glsl-6eb90994.js"),[]));const cze=new Map([[z.POSITION,0],[z.UV0,1],[z.NORMALCOMPRESSED,2]]);let y7t=class{constructor(){this.geometryInfo=new f9t,this.intersectionData=null,this.geometryState=null,this._textureRef=new XBe(()=>this.tile.surface.textureFadeDuration),this.overlay=new n7t,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const r=this.geometryInfo;r.indices=null,r.vertexAttributes=null,qn(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new b9t,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),ha&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)at(this.geometryInfo.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){var l;const i=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(M(c)&&(e===0&&i.extent[3]>c[3]||e===1&&i.extent[2]>c[2]||e===2&&i.extent[1]<c[1]||e===3&&i.extent[0]<c[0]))return n}const s=i.level,o=pA[e];if(!r)return at(k((l=i.surface)==null?void 0:l.rootTiles)||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),n;if(r.isLoaded){const c=r,u=c.renderData.geometryState,d=s-c.level;if(at(d>=0),d===0){const v=u.numVerticesPerSide-1;return Math.max(v,n)}const p=2**d,A=u.neighborData.edgeResolutions[(e+2)%4]/p;return Math.max(1,A)}at(!r.isLeaf);let a=n;return r.forAllSubtreeOnSide(iV(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-s)),!0):(at(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState.neighborData,i=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),n=r.edgePeerNeighbors,s=r.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(pA[l],i),u=ST(e,c),d=((a=u==null?void 0:u.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,p=n[l],A=u!==ST(e,p),v=s[l]!==d;n[l]=c,(A||v)&&(s[l]=d,this._markEdgeDirty(l));const b=r.edgeResolutions[l],S=this._calculateEdgeResolution(l,c);at(Im(S)),at(S>=1),r.edgeResolutions[l]=S,b!==S&&this._markEdgeResolutionDirty(l)}const o=r.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(nV[l],i);o[l]=c;const u=ST(e,n[l]),d=ST(e,n[(l+1)%4]),p=ST(e,c);y0[l]=p,y0[(l+1)%4]=d,y0[(l+2)%4]=e,y0[(l+3)%4]=u,at(y0.some(S=>(S==null?void 0:S.isLoaded)||S===e));const A=y0.reduce((S,E)=>Math.min(S,(E==null?void 0:E.level)??1/0),1/0);y0.forEach((S,E)=>{S&&(S==null?void 0:S.level)>A&&(y0[E]=null)}),at(y0.some(S=>(S==null?void 0:S.isLoaded)||S===e));const v=r.cornerNeighborData[l].cornerTiles,b=r.cornerNeighborData[l].cornerTileSamplerVersions;for(let S=0;S<4;++S){const E=y0[S],R=(E==null?void 0:E.renderData.geometryState.samplerDataVersion)??-1,O=v[S]!==E,I=!O&&b[S]!==R;(O||I)&&(v[S]=E,b[S]=R,this._markCornerDirty(l))}at(v.some(S=>(S==null?void 0:S.isLoaded)||S===e))}ha&&at(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)y0[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;ha&&at(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,n=this.geometryInfo.vertexAttributes,s=!i||!n||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!s&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;s?(this.releaseGeometry(),this._createGeometry(e)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,A9t(this.geometryInfo),!0)}ensureTexture(e,r){return M(this._texture)&&this._texture.descriptor.width!==e&&this.releaseTexture(),k(this._texture)&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){M(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const r=1<<e;this._dirtyCorners|=r}_markEdgeDirty(e){const r=1<<e;this._dirtyEdges|=r}_markEdgeResolutionDirty(e){const r=1<<e;this._dirtyEdgeResolutions|=r,this._dirtyEdges|=r}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),n=Math.max(i,5);let s=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(s=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==n&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=n,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),J_(o.clippingArea,s)||(this._clippingAreaChanged=!0,o.clippingArea=s,a=!0);const l=r.surface,c=l.wireframe;o.wireframe!==c&&(this._wireframeChanged=!0,o.wireframe=c,a=!0);const u=l.shading;return o.shading!==u&&(this._shadingChanged=u,o.shading=u,a=u),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometryInfo.vertexAttributes,i=this.geometryInfo.indices,n=e.gl;this._vao=new Hm(e,cze,{geometry:wd(r.layout)},{geometry:Ji.createVertex(e,n.STATIC_DRAW,r.buffer)},Ji.createIndex(e,n.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=H_.Immediate){M(e)&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[di.ELEVATION],i=r.length,n=new Array(i);let s=0,o=0,a=!1;for(let u=0;u<i;u++){const d=r[u];if(M(d.upsampleInfo)){const p=d.upsampleInfo.tile,A=p.layerInfo[di.ELEVATION][u].data,v=A&&A.samplerData;e&&e[s]===v||(a=!0),n[s++]=v,o=Math.max(o,p.lij[0])}else if(d.data){const p=this.tile.surface.layerViewByIndex(u,di.ELEVATION);if(nD(this.tile,p.layer,!1)){const A=d.data;e&&e[s]===A.samplerData||(a=!0),n[s++]=A.samplerData,o=this.tile.level}}}M(e)&&e.length!==s&&(a=!0);const l=s>0,c=l?n:null;return l&&(n.length=s),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i;const e=tp(this.intersectionData,0,n=>n.estimatedMemoryUsage);return(((r=this.geometryInfo.indices)==null?void 0:r.byteLength)??0)+(((i=this.geometryInfo.vertexAttributes)==null?void 0:i.byteLength)??0)+e}get textureDescriptor(){return M(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!ha)return;const e=this.tile;if(at(e==null?void 0:e.isLoaded),!e.isLoaded||!e.intersectsClippingArea)return;const r=e.renderData;if(e.level===0)return;const i=e.surface.extent;if(M(i)&&!e.intersectsExtent(i))return;const n=pA.map((l,c)=>!!M(i)&&(c<2?-1:1)*(e.extent[3-c]-i[3-c])<0),s=e.level;at(this._dirtyCorners===0),at(this._dirtyEdges===0),at(this._dirtyEdgeResolutions===0),at(!this._numVerticesPerSideChanged),at(!this._samplerDataChanged),at(!this._clippingAreaChanged),at(!this._wireframeChanged);const o=nV.map(l=>e.findNeighborCornerTileExact(l,c=>!c.intersectsClippingArea||c.isLoaded||c.level===e.level)??null).map(l=>l!=null&&l.intersectsClippingArea?l:null),a=this.geometryState.neighborData;for(let l=0;l<4;++l){const c=a.cornerPeerNeighbors[l],u=o[l];at(u===c,`Tile[${e.lij}].corner[${l}] out of date: cur=[${c==null?void 0:c.lij}] exp=[${u==null?void 0:u.lij}]`)}pA.forEach((l,c)=>{if(n[c])return;const u=e.findNeighborTile(l,H=>(H.level===s||(H==null?void 0:H.isLoaded))&&(H==null?void 0:H.intersectsClippingArea));if(!u){const H=!e.surface.updatingRootTiles&&M(e.surface.rootTiles)&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(l);return void at(!H)}at(u.isLoaded||u.level===e.level),at(u===this.geometryState.neighborData.edgePeerNeighbors[c]);const d=s-u.level;if(!u.isLoaded)return at(!u.isLeaf),void at(d===0);const p=u.renderData;at(i7t(e,u,l)),at(d>=0);const A=2**d;if(d<0)return void at(!1);const v=r.geometryInfo,b=v.outerEdges[c],S=v.numVerticesPerSide-1,E=p.geometryInfo;if(!E)return void at(!1);{const H=this.geometryState.neighborData.edgePeerNeighbors[c];if(H!=null&&H.isLoaded){const W=H.renderData;at(H==H),at(r.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===W.geometryState.samplerDataVersion),at(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===W.geometryState.samplerDataVersion)}}const R=(c+2)%4,O=E.outerEdges[R],I=b.count-1,N=O.count-1;at(I*A===N,`Tile[${e.lij}]:e${c},res=${I} edgeRes mismatch with Neighbor[${u.lij}]:e${R},res=${N} (expected:${I*A})`);const L=e.extent,B=l===gr.NORTH||l===gr.SOUTH,U=O.count-1,q=U/2**d,Z=b.count-1;if(q<1)return void at(Z===1);at(q===Z),at(Im(q));const X=E.numVerticesPerSide-1;at(d>0||q===Math.max(X,S));const ee=e.getNeighborEdgeStartVertexIndex(c,u);at(0<=ee&&ee<A);const se=ee*q;at(0<=se&&se<=U-q);let ue=0,re=se;b.getVertexPos(mg,0),b.getVertexPos(gg,b.count-1);const te=zn(mg,gg),j=Math.max(_7t,1e-4*te);for(let H=0;H<=q;++H){b.getVertexPos(mg,ue),O.getVertexPos(gg,re);const W=H/q,oe=B?L[0]+W*(L[2]-L[0]):l===gr.WEST?L[0]:L[2],le=B?l===gr.SOUTH?L[1]:L[3]:L[1]+W*(L[3]-L[1]),fe=e.surface.extent;if(k(fe)||LG(fe,oe,le)){const de=EN(mg,gg),Ee=Gh(mg)-yi.radius,Ie=Gh(gg)-yi.radius,Ge=de<j;if(!Ge){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${c}[${ue}/${b.count}] and [${u.lij}].edge${R}[${re}/${O.count}]`),M(fe)&&console.warn("  surface extent= ",fe," x,y=",oe,",",le);const Ke=G();Ve(Ke,r.localOrigin,p.localOrigin),Gh(Ke)>0&&console.warn(`   localOrigins: ${r.localOrigin} vs ${p.localOrigin} d=${Gh(Ke)} [${Ke}]`),(()=>{const vt=Gs(mg),ke=Gs(gg);e.updateEdgeElevations(),u.updateEdgeElevations(),b.getVertexPos(mg,ue),O.getVertexPos(gg,re);const Ne=G();Ka(Ne,mg,vt),Gh(Ne)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${vt} vs ${mg} d=${Gh(Ne)} [${Ne}]`),Ka(Ne,gg,ke),Gh(Ne)>0&&console.warn(`  XXX Neighbor[${u.lij}] edge out of date: ${ke} vs ${gg} d=${Gh(Ne)} [${Ne}]`)})(),at(Ge,`Mismatch in tile [${e.lij}].edge[${c}][${ue}/${b.count}] vs neighbor [${u.lij}].edge[${R}][${re}/${O.count}] ${Cy(mg)} vs ${Cy(gg)}  dist=${de} h(t|n|d)=${Ee}|${Ie}|${Ie-Ee}`)}if(e.surface.shading){b.getNormal(I3,ue),O.getNormal($3,re),Ye(Mxe,I3),Ye(Rxe,$3);const Ke=Qe(Mxe,Rxe),vt=1-Ke<.01||!1||e===u;if(!vt){const ke=G();Ka(ke,I3,$3);const Ne=()=>`Mismatch in tile edge normal ${sxe(e.lij)} (${ue}/${b.count-1}) edge ${c} vs neighbor ${sxe(u.lij)}  (${re}/${O.count-1}) nedge ${R} :${Cy(I3)} vs ${Cy($3)}  dot = ${Ke} : ${Cy(ke)}`;console.warn("Mismatch in tile edge normal: ",Ne());{e.updateEdgeElevations(),u.updateEdgeElevations();const Xe=G(),Se=G();b.getNormal(Xe,ue),O.getNormal(Se,re),S2(I3,Xe)||console.warn("Missing update in tile normal: ",Cy(I3)," => ",Cy(Xe)),S2($3,Se)||console.warn("Missing update in neighbor normal: ",Cy($3)," => ",Cy(Se))}at(vt,Ne())}}}ue+=1,re+=1}})}};const mg=G(),gg=G(),I3=G(),$3=G(),Mxe=G(),Rxe=G(),_7t=1,y0=[null,null,null,null];function ST(t,e){return e!=null&&e.isLoaded||e===t?e:null}const v7t=65536;function b7t(t,e){const r=t.tile,{extent:i,extentInRadians:n,surface:s}=r,o=t.localOrigin,a=t.geometryState,l=s.isWebMercator,c=s.shading||KS,u=a.numVerticesPerSide,d=u-1,p=(u-2)**2,A=l&&(e===bf.HAS_SOUTH_POLE||e===bf.HAS_BOTH_POLES),v=l&&(e===bf.HAS_NORTH_POLE||e===bf.HAS_BOTH_POLES),b=6,S=((A?1:0)+(v?1:0))*b*(d+1),E=a.neighborData,R=E.edgeResolutions.reduce((U,q)=>U+q+1,0),O=YBe(p+S+R),I=t.geometryInfo;I.numVerticesPerSide=a.numVerticesPerSide,I.vertexAttributes=O;const N=I.boundingBox;qn(N);const L=fpe(t);Fo.update(d,n,L),w7t(t),yze(t,p),uze(t);const B=[];if((()=>{let U=p+R;const q=o[0],Z=o[1],X=o[2],ee=r.ellipsoid.radius,se=i[1],ue=i[3],re=(te,j)=>{const H=j*u;_u(-q,-Z,te*ee-X,N),B.push({connectedRowOffset:H,connectedOuterEdgeOffset:te===1?0:2,rowOffset:U,latitudeResolution:b});const W=pze(te===-1?se:ue,ee),oe=te*Math.PI/2-W,le=.99*(te===1?1:-1),fe=ee+0,de=O.position,Ee=O.uv0,Ie=O.normalCompressed;for(let Ge=1;Ge<=b;++Ge){const Ke=W+oe*(Ge/b),vt=Math.cos(Ke),ke=Math.sin(Ke);for(let Ne=0;Ne<=d;Ne++){const Xe=Ne/d,Se=Fo.sinLonLUT[Ne],It=Fo.cosLonLUT[Ne]*vt,lt=Se*vt,qt=ke,er=It*fe-q,rr=lt*fe-Z,vr=qt*fe-X;_u(er,rr,vr,N),de.setValues(U,er,rr,vr),fd(Ee,U,Xe,le),c&&VL(Ie,U,It,lt,qt),++U}}};A&&re(-1,0),v&&re(1,d)})(),Aze(I,a.numVerticesPerSide,B,[0,u-1],[0,u-1],a.wireframe),t.intersectionData=null,ha)for(let U=0;U<4;++U)at(I.outerEdges[U].count===E.edgeResolutions[U]+1)}function w7t(t){const e=t.tile;e.intersectsClippingArea&&(e.surface.shading||KS?T7t(t):x7t(t))}function x7t(t){const e=t.geometryState,r=e.numVerticesPerSide,i=r-2,n=r-1,s=t.geometryInfo,o=s.vertexAttributes,a=o.position,l=o.uv0,c=t.tile,u=c.extent,d=u[0],p=u[2],A=u[1],v=u[3],b=c.ellipsoid.radius,S=e.samplerData,E=t.localOrigin,R=E[0],O=E[1],I=E[2],N=s.boundingBox,L=a.typedBuffer,B=a.typedBufferStride;let U=0;for(let q=1;q<=i;q++){const Z=q/n,X=A*(1-Z)+v*Z,ee=Fo.sinLatLUT[q],se=Fo.cosLatLUT[q];for(let ue=1;ue<=i;ue++){const re=ue/n,te=d*(1-re)+p*re,j=Fo.sinLonLUT[ue],H=Fo.cosLonLUT[ue],W=b+hs(te,X,S),oe=H*se*W-R,le=j*se*W-O,fe=ee*W-I;_u(oe,le,fe,N);const de=U*B;L[de]=oe,L[de+1]=le,L[de+2]=fe,fd(l,U,re,Z),++U}}}function T7t(t){const e=t.geometryState,r=e.numVerticesPerSide,i=r-2,n=r-1,s=t.geometryInfo,o=s.vertexAttributes,a=o.position,l=o.uv0,c=o.normalCompressed,u=t.tile,d=u.extent,p=d[0],A=d[2],v=d[1],b=d[3],S=u.ellipsoid.radius,E=e.samplerData,R=t.localOrigin,O=R[0],I=R[1],N=R[2],L=a.typedBuffer,B=a.typedBufferStride,U=1/n,q=s.boundingBox;let Z=0;if(1<=i){const X=U,ee=v*(1-X)+b*X,se=Fo.sinLatLUT[1],ue=Fo.cosLatLUT[1];for(let re=1;re<=i;re++){const te=re*U,j=p*(1-te)+A*te,H=Fo.sinLonLUT[re],W=Fo.cosLonLUT[re],oe=S+hs(j,ee,E),le=oe*W*ue-O,fe=oe*H*ue-I,de=oe*se-N;_u(le,fe,de,q);const Ee=(re-1)*B;L[Ee]=le,L[Ee+1]=fe,L[Ee+2]=de,fd(l,re-1,te,X)}}for(let X=1;X<=i;X++){const ee=X*U,se=v*(1-ee)+b*ee,ue=Fo.sinLatLUT[X],re=Fo.cosLatLUT[X],te=X+1,j=te*U,H=v*(1-j)+b*j,W=Fo.sinLatLUT[te],oe=Fo.cosLatLUT[te],le=Fo.sinLonLUT[0],fe=Fo.cosLonLUT[0],de=S+hs(p,se,E);let Ee=fe*re*de-O,Ie=le*re*de-I,Ge=ue*de-N;const Ke=Z*B;let vt=L[Ke],ke=L[Ke+1],Ne=L[Ke+2];for(let Xe=1;Xe<=i;Xe++){const Se=Xe*U,It=p*(1-Se)+A*Se,lt=Fo.sinLonLUT[Xe],qt=Fo.cosLonLUT[Xe];let er=qt*re,rr=lt*re,vr=ue,ri=0,Wi=0,Lr=0;{let Ut=0,bt=0,Bt=0;if(Xe<i){const vi=(Z+1)*B;Ut=L[vi],bt=L[vi+1],Bt=L[vi+2]}else{const vi=Fo.sinLonLUT[n],xi=Fo.cosLonLUT[n],Ti=S+hs(A,se,E);Ut=xi*re*Ti-O,bt=vi*re*Ti-I,Bt=ue*Ti-N}const Wt=Ee,sr=Ie,Ir=Ge;Ee=vt,Ie=ke,Ge=Ne,vt=Ut,ke=bt,Ne=Bt,ri=Ut-Wt,Wi=bt-sr,Lr=Bt-Ir}{let Ut=0,bt=0,Bt=0;if(X>1){const Wt=(Z-i)*B;Ut=L[Wt],bt=L[Wt+1],Bt=L[Wt+2]}else{const Wt=Fo.sinLatLUT[0],sr=Fo.cosLatLUT[0],Ir=S+hs(It,v,E);Ut=qt*sr*Ir-O,bt=lt*sr*Ir-I,Bt=Wt*Ir-N}{const Wt=S+hs(It,H,E),sr=qt*oe*Wt-O,Ir=lt*oe*Wt-I,vi=W*Wt-N;if(X<i){const Cn=Z+i,Ur=Cn*B;L[Ur]=sr,L[Ur+1]=Ir,L[Ur+2]=vi,_u(sr,Ir,vi,q),fd(l,Cn,Se,j)}const xi=Ut-sr,Ti=bt-Ir,bi=Bt-vi;vr*vr<.999&&(er=Lr*Ti-Wi*bi,rr=ri*bi-Lr*xi,vr=Wi*xi-ri*Ti)}}const ii=1/Math.sqrt(er*er+rr*rr+vr*vr);VL(c,Z,er*ii,rr*ii,vr*ii),++Z}}}function S7t(t){t.tile.intersectsClippingArea&&(uze(t),EH(t))}function E7t(t){t.tile.intersectsClippingArea&&(dze(t),hze(t,!0),EH(t))}function uze(t){t.tile.intersectsClippingArea&&(dze(t),hze(t))}function hze(t,e=!1){const r=t.geometryState,i=t.geometryInfo,n=r.neighborData,s=t.tile,o=s.level,a=s.extent,l=s.ellipsoid.radius,c=s.extentInRadians,u=c[0],d=c[2],p=c[1],A=c[3],v=r.samplerData,b=a[0],S=a[2],E=a[1],R=a[3],O=fpe(t),I=i.boundingBox,N=t.localOrigin,L=N[0],B=N[1],U=N[2],q=s.surface.shading||KS,Z=i.vertexAttributes,X=Z.position,ee=X.typedBuffer,se=X.typedBufferStride,ue=Z.uv0;for(let re=0;re<4;++re){const te=re===1||re===3,j=n.edgeResolutions[re];at(Im(j));const H=j+1,W=ST(s,n.edgePeerNeighbors[re]);if(bze(s,W,re)){_ze(t,re,W);continue}const oe=M(W);at(!oe||W.level===s.level),at(!oe||q_(s,W)<=0);const le=W==null?void 0:W.renderData,fe=le==null?void 0:le.geometryState;if(ha){const bt=s.surface;if(!W&&bt&&!bt.updatingRootTiles){const Bt=pA[re],Wt=s.findNeighborTile(Bt,sr=>sr.isLoaded||sr.isLeaf||sr.level===s.level);Wt?Wt.intersectsClippingArea&&(at(!Wt.isLoaded),at(!Wt.isLeaf),at(Wt.level===o)):at(k(bt==null?void 0:bt.rootTiles)||!s.shouldHaveNeighbor(Bt))}}const de=re===1?a[2]:a[0],Ee=W==null?void 0:W.extent,Ie=Ee&&te?re===1?Ee[0]:Ee[2]:de,Ge=re===0?a[3]:a[1],Ke=re===1?1:0,vt=re===0?1:0,ke=re===1?d:u,Ne=re===0?A:p,Xe=Math.sin(ke),Se=Math.cos(ke),It=Math.sin(Ne),lt=Math.cos(Ne),qt=fe==null?void 0:fe.samplerData,er=oe?(bt,Bt,Wt)=>.5*(hs(bt,Bt,v)+hs(Wt,Bt,qt)):(bt,Bt,Wt)=>hs(bt,Bt,v),rr=i.outerEdges[re],vr=e&&H>3?H-3:1,ri=M(v)&&v.some(bt=>bt!=null),Wi=M(qt)&&qt.some(bt=>bt!=null),Lr=ri||Wi,ii=1/j,Ut=rr.index0;q?(at(!Ee||wf(Ee[2]-Ee[0],a[2]-a[0])),(()=>{const bt=re===1?-1:re===3?1:0,Bt=re===0?-1:re===2?1:0,Wt=(a[2]-a[0])*ii,sr=bt*Wt,Ir=Bt*Wt,vi=te?bt*((d-u)*ii):0,xi=te?0:Bt*ii,Ti=vt,bi=te?ke+vi:ke,Cn=te?Math.sin(bi):Xe,Ur=te?Math.cos(bi):Se,ai=te?ke-vi:ke,Qr=te?Math.sin(ai):Xe,Ms=te?Math.cos(ai):Se,un=te?Ne:O(Ti+xi),Xn=te?It:Math.sin(un),dn=te?lt:Math.cos(un),Gn=te?Ne:O(Ti-xi),ms=te?It:Math.sin(Gn),tt=te?lt:Math.cos(Gn);let ma=0,Do=0,Rs=0;{const rn=0*ii,ga=te?de:b*(1-rn)+S*rn,La=te?Ie:ga,De=te?E*(1-rn)+R*rn:Ge,Li=te?ke:u*(1-rn)+d*rn,$e=te?Xe:Math.sin(Li),qe=te?Se:Math.cos(Li),ft=te?O(rn):Ne,et=te?Math.sin(ft):It,y=te?Math.cos(ft):lt,ie=l+er(ga,De,La);ma=qe*y*ie,Do=$e*y*ie,Rs=et*ie}let Zn=0,Dn=0,gs=0;{const rn=1*ii,ga=te?de:b*(1-rn)+S*rn,La=te?Ie:ga,De=te?E*(1-rn)+R*rn:Ge,Li=te?ke:u*(1-rn)+d*rn,$e=te?Xe:Math.sin(Li),qe=te?Se:Math.cos(Li),ft=te?O(rn):Ne,et=te?Math.sin(ft):It,y=te?Math.cos(ft):lt,ie=l+er(ga,De,La);Zn=qe*y*ie,Dn=$e*y*ie,gs=et*ie}for(let rn=1;rn<H-1;rn+=vr){let ga=0,La=0,De=0;{const Na=(rn+1)*ii,Uc=te?de:b*(1-Na)+S*Na,ho=te?Ie:Uc,Oi=te?E*(1-Na)+R*Na:Ge,ya=te?ke:u*(1-Na)+d*Na,Td=te?Xe:Math.sin(ya),k1=te?Se:Math.cos(ya),Cu=te?O(Na):Ne,Xr=te?Math.sin(Cu):It,he=te?Math.cos(Cu):lt,Sr=l+er(Uc,Oi,ho);ga=k1*he*Sr,La=Td*he*Sr,De=Xr*Sr}const Li=ga,$e=La,qe=De,ft=Zn,et=Dn,y=gs;Zn=Li,Dn=$e,gs=qe;{const Na=Ut+rn,Uc=Na*se,ho=ft-L,Oi=et-B,ya=y-U;ee[Uc]=ho,ee[Uc+1]=Oi,ee[Uc+2]=ya,_u(ho,Oi,ya,I);const Td=rn*ii;fd(ue,Na,te?Ke:Td,te?Td:vt)}const ie=ma,Ri=Do,Mn=Rs;ma=ft,Do=et,Rs=y;const Rn=ft,Yr=et,wi=y,Tr=1/Math.sqrt(Rn*Rn+Yr*Yr+wi*wi),_n=wi*Tr;let Nr=0,Aa=0,xd=0;if(Lr&&_n*_n<.999){let Na=0,Uc=0,ho=0;{const Oi=re===0?-1:1;Na=Oi*(Li-ie),Uc=Oi*($e-Ri),ho=Oi*(qe-Mn)}{const Oi=rn*ii,ya=te?de:b*(1-Oi)+S*Oi,Td=te?Ie:ya,k1=te?E*(1-Oi)+R*Oi:Ge,Cu=te?ke:u*(1-Oi)+d*Oi,Xr=te?Xe:Math.sin(Cu),he=te?Se:Math.cos(Cu),Sr=te?O(Oi):Ne,Ll=te?Math.sin(Sr):It,DE=te?Math.cos(Sr):lt;let gw=Rn,me=Yr,We=wi;if(oe){const Y=l+hs(Td-sr,k1-Ir,qt),Zr=te?DE:tt;gw=(te?Ms:he)*Zr*Y,me=(te?Qr:Xr)*Zr*Y,We=(te?Ll:ms)*Y}{const Y=l+hs(ya+sr,k1+Ir,v),Zr=te?DE:dn,Wo=(te?Ur:he)*Zr*Y,Os=(te?Cn:Xr)*Zr*Y,oc=(te?Ll:Xn)*Y;oe||(gw=2*Rn-Wo,me=2*Yr-Os,We=2*wi-oc);const Xm=re===3?-1:1,IF=Xm*(gw-Wo),FP=Xm*(me-Os),kP=Xm*(We-oc);Nr=ho*FP-Uc*kP,Aa=Na*kP-ho*IF,xd=Uc*IF-Na*FP;const LE=1/Math.sqrt(Nr*Nr+Aa*Aa+xd*xd);Nr*=LE,Aa*=LE,xd*=LE}}}else Nr=Rn*Tr,Aa=Yr*Tr,xd=wi*Tr;rr.setNormalFromValues(rn,Nr,Aa,xd)}})()):(()=>{for(let bt=1;bt<H-1;bt+=vr){const Bt=bt*ii,Wt=te?Ke:Bt,sr=te?Bt:vt,Ir=te?de:b*(1-Bt)+S*Bt,vi=te?E*(1-Bt)+R*Bt:Ge,xi=te?Ie:Ir,Ti=te?ke:u*(1-Bt)+d*Bt,bi=te?Xe:Math.sin(Ti),Cn=te?Se:Math.cos(Ti),Ur=te?O(Bt):Ne,ai=te?Math.sin(Ur):It,Qr=te?Math.cos(Ur):lt,Ms=er(Ir,vi,xi),un=l+Ms,Xn=Cn*Qr*un-L,dn=bi*Qr*un-B,Gn=ai*un-U;_u(Xn,dn,Gn,I);const ms=Ut+bt,tt=ms*se;ee[tt]=Xn,ee[tt+1]=dn,ee[tt+2]=Gn,fd(ue,ms,Wt,sr)}})()}}function dze(t){vze(t)}function pze(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function C7t(t,e,r,i){return pze(t*(1-i)+e*i,r)}function M7t(t,e,r){return t*(1-r)+e*r}function fpe(t){const e=t.tile;if(e.surface.isWebMercator){const i=e.extent,n=e.ellipsoid.radius;return s=>C7t(i[1],i[3],n,s)}const r=e.extentInRadians;return i=>M7t(r[1],r[3],i)}function R7t(t,e){const r=t.tile.extent,i=t.geometryState,n=r[0],s=r[1],o=r[2]-n,a=r[3]-s,l=i.clippingArea,c=M(l)?Math.max(0,(l[0]-n)/o):0,u=M(l)?Math.max(0,(l[1]-s)/a):0,d=M(l)?Math.min(1,(l[2]-n)/o):1,p=M(l)?Math.min(1,(l[3]-s)/a):1,A=i.numVerticesPerSide,v=(A-2)**2,b=i.neighborData.edgeResolutions.reduce((O,I)=>O+I+1,0),S=YBe(v+b),E=t.geometryInfo,R=E.boundingBox;qn(R),E.numVerticesPerSide=i.numVerticesPerSide,E.vertexAttributes=S,pn(E.uvRange,c,u,d,p),O7t(t),yze(t,v),fze(t),Aze(E,i.numVerticesPerSide,[],[0,A-1],[0,A-1],i.wireframe),t.intersectionData=null}function O7t(t){const e=t.tile;e.intersectsClippingArea&&(e.surface.shading?I7t(t):P7t(t))}function P7t(t){const e=t.geometryState,r=e.samplerData,i=t.tile,n=i.surface,s=t.localOrigin,o=n.isWebMercatorOnPlateeCarree,a=e.clippingArea,l=M(a)?a:CH,c=i.extent,u=c[0],d=c[1],p=c[2],A=c[3],v=Math.max(u,l[0]),b=Math.min(p,l[2]),S=Math.max(d,l[1]),E=Math.min(A,l[3]),R=s[0],O=s[1],I=s[2],N=i.ellipsoid.radius,L=i.horizontalScale,B=mpe(o,N,L),U=e.numVerticesPerSide,q=U-1,Z=U-2,X=t.geometryInfo,ee=X.uvRange,se=ee[0],ue=ee[1],re=ee[2],te=ee[3],j=X.boundingBox,H=X.vertexAttributes,W=H.position,oe=H.uv0;let le=0;for(let fe=1;fe<=Z;fe++){const de=fe/q,Ee=He(d*(1-de)+A*de,S,E),Ie=He(de,ue,te),Ge=B(Ee)-O;for(let Ke=1;Ke<=Z;Ke++){const vt=Ke/q,ke=He(u*(1-vt)+p*vt,v,b),Ne=He(vt,se,re),Xe=ke*L-R,Se=hs(ke,Ee,r)-I;_u(Xe,Ge,Se,j),W.setValues(le,Xe,Ge,Se),fd(oe,le,Ne,Ie),++le}}}function I7t(t){const e=t.tile,r=e.surface;if(!(r.shading||KS))return;const i=t.geometryState,n=i.samplerData,s=t.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=M(a)?a:CH,c=e.extent,u=c[0],d=c[1],p=c[2],A=c[3],v=Math.max(u,l[0]),b=Math.min(p,l[2]),S=Math.max(d,l[1]),E=Math.min(A,l[3]),R=e.ellipsoid.radius,O=e.horizontalScale,I=i.numVerticesPerSide,N=I-1,L=I-2,B=t.geometryInfo,U=B.vertexAttributes,q=U.position,Z=U.uv0,X=U.normalCompressed,ee=B.uvRange,se=ee[0],ue=ee[1],re=ee[2],te=ee[3],j=B.boundingBox,H=s[0],W=s[1],oe=s[2],le=q.typedBuffer,fe=q.typedBufferStride;let de=0;const Ee=He(d,S,E),Ie=o?(Math.PI/2-2*Math.atan(Math.exp(-Ee/R)))*R:Ee*O,Ge=1/N,Ke=He(d*(1-Ge)+A*Ge,S,E);let vt=Ie,ke=o?(Math.PI/2-2*Math.atan(Math.exp(-Ke/R)))*R:Ke*O;for(let Ne=1;Ne<=L;Ne++){const Xe=Ne/N,Se=He(d*(1-Xe)+A*Xe,S,E),It=He(Xe,ue,te),lt=ke,qt=(Ne-1)/N,er=He(d*(1-qt)+A*qt,S,E),rr=vt,vr=(Ne+1)/N,ri=He(d*(1-vr)+A*vr,S,E),Wi=o?(Math.PI/2-2*Math.atan(Math.exp(-ri/R)))*R:ri*O,Lr=He(vr,ue,te);vt=ke,ke=Wi;const ii=He(u,v,b);let Ut=ii*O,bt=hs(ii,Se,n);const Bt=1/N,Wt=He(Bt,se,re),sr=He(u*(1-Wt)+p*Wt,v,b);let Ir=Wt,vi=sr,xi=sr*O,Ti=hs(sr,Se,n);if(Ne===1){const bi=xi-H,Cn=vt-W,Ur=Ti-oe,ai=0*fe;le[ai]=bi,le[ai+1]=Cn,le[ai+2]=Ur,_u(bi,Cn,Ur,j);const Qr=He(Bt,se,re);fd(Z,de,Qr,It)}for(let bi=1;bi<=L;bi++){const Cn=xi,Ur=Ti,ai=(bi+1)/N,Qr=He(ai,se,re),Ms=He(u*(1-ai)+p*ai,v,b),un=vi;vi=Ms;{const Rs=de+1,Zn=Rs*fe;if(Ne===1||bi===L){const Dn=Ms*O,gs=hs(Ms,Se,n);if(Ne===1&&bi<L){const rn=Dn-H,ga=lt-W,La=gs-oe;le[Zn]=rn,le[Zn+1]=ga,le[Zn+2]=La,_u(rn,ga,La,j),fd(Z,Rs,Qr,It)}xi=Dn,Ti=gs}else xi=le[Zn]+H,Ti=le[Zn+2]+oe}const Xn=xi,dn=Ti,Gn=Ut,ms=bt;Ut=Cn,bt=Ur;const tt=(de-L)*fe,ma=Ne===1?hs(un,er,n):le[tt+2]+oe,Do=hs(un,ri,n);if(Ne<L){const Rs=de+L,Zn=Rs*fe,Dn=Cn-H,gs=Wi-W,rn=Do-oe;le[Zn]=Dn,le[Zn+1]=gs,le[Zn+2]=rn,_u(Dn,gs,rn,j);const ga=Ir;Ir=Qr,fd(Z,Rs,ga,Lr)}{const Rs=Xn-Gn,Zn=rr-Wi,Dn=Zn*(dn-ms),gs=Rs*(ma-Do),rn=-Zn*Rs,ga=Dn*Dn+gs*gs+rn*rn;if(ga===0)VL(X,de,0,0,1);else{const La=1/Math.sqrt(ga);VL(X,de,Dn*La,gs*La,rn*La)}}++de}}}function $7t(t,e){t.tile.intersectsClippingArea&&(gze(t),mze(t,!0),EH(t))}function D7t(t,e){t.tile.intersectsClippingArea&&(fze(t),EH(t))}function fze(t,e){t.tile.intersectsClippingArea&&(gze(t),mze(t,!1))}function mze(t,e){const r=t.geometryState,i=r.neighborData,n=t.tile,s=n.surface,o=s.shading||KS,a=n.extent,l=r.clippingArea,c=M(l)?l:CH,u=a[0],d=a[2],p=a[1],A=a[3],v=[A>c[3],d>c[2],p<c[1],u<c[0]],b=t.geometryInfo,S=n.horizontalScale,E=mpe(s.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,S),R=b.boundingBox,O=b.uvRange[0],I=b.uvRange[1],N=b.uvRange[2],L=b.uvRange[3],B=Math.max(u,c[0]),U=Math.min(d,c[2]),q=Math.max(p,c[1]),Z=Math.min(A,c[3]),X=t.localOrigin,ee=X[0],se=X[1],ue=X[2],re=r.samplerData;for(let te=0;te<4;++te){const j=te===1||te===3,H=i.edgeResolutions[te];at(Im(H));const W=H+1,oe=v[te],le=ST(n,i.edgePeerNeighbors[te]);if(!oe&&bze(n,le,te)){_ze(t,te,le);continue}const fe=M(le)&&!oe,de=le==null?void 0:le.renderData,Ee=de==null?void 0:de.geometryState;if(ha&&(at(!fe||le.level===n.level),at(!fe||q_(n,le)<=0),n&&!le&&!s.updatingRootTiles)){const It=pA[te],lt=n.findNeighborTile(It,qt=>qt.isLoaded||qt.isLeaf||qt.level===n.level);s.updatingRootTiles||(lt?lt.intersectsClippingArea&&(at(!lt.isLoaded),at(!lt.isLeaf),at(lt.level===n.level)):at(k(s==null?void 0:s.rootTiles)||!n.shouldHaveNeighbor(It)))}const Ie=He(te===1?d:u,B,U),Ge=He(te===0?A:p,q,Z),Ke=Ee==null?void 0:Ee.samplerData,vt=b.outerEdges[te],ke=e&&W>3?W-3:1,Ne=He(te===1?1:0,O,N),Xe=He(te===0?1:0,I,L),Se=fe?(It,lt)=>.5*(hs(It,lt,Ke)+hs(It,lt,re)):(It,lt)=>hs(It,lt,re);if(o){const It=(d-u)/H,lt=j?te===1?It:-It:0,qt=j?0:te===0?It:-It,er=-lt,rr=-qt;let vr=0,ri=0,Wi=0;{const bt=0/H,Bt=j?Ie:He(u*(1-bt)+d*bt,B,U),Wt=j?He(p*(1-bt)+A*bt,q,Z):Ge,sr=Se(Bt,Wt);vr=Bt*S,ri=E(Wt),Wi=sr}let Lr=0,ii=0,Ut=0;{const bt=1/H,Bt=j?Ie:He(u*(1-bt)+d*bt,B,U),Wt=j?He(p*(1-bt)+A*bt,q,Z):Ge,sr=Se(Bt,Wt);Lr=Bt*S,ii=E(Wt),Ut=sr}for(let bt=1;bt<W-1;bt+=ke){const Bt=bt/H,Wt=Lr,sr=ii,Ir=Ut;{const un=j?Ne:He(Bt,O,N),Xn=j?He(Bt,I,L):Xe,dn=Wt-ee,Gn=sr-se,ms=Ir-ue;_u(Wt,Gn,ms,R),vt.setVertexFromValuesRawPositionUV(bt,dn,Gn,ms,un,Xn)}{const un=(bt+1)/H,Xn=j?Ie:He(u*(1-un)+d*un,B,U),dn=j?He(p*(1-un)+A*un,q,Z):Ge,Gn=Se(Xn,dn);Lr=Xn*S,ii=E(dn),Ut=Gn}const vi=Lr,xi=Ut,Ti=vr,bi=ri,Cn=Wi;vr=Wt,ri=sr,Wi=Ir;let Ur=0,ai=0,Qr=0;if(j){const un=ii-sr,Xn=xi-Ir,dn=bi-sr,Gn=Cn-Ir,ms=He(p*(1-Bt)+A*Bt,q,Z),tt=Ie+er,ma=tt*S-Wt,Do=hs(tt,ms,re)-Ir,Rs=te===3?-1:1;if(Ur=Rs*(-dn+un)*Do,ai=Rs*ma*(-Gn+Xn),Qr=-Rs*ma*(-dn+un),fe){const Zn=Ie+lt,Dn=Zn*S-Wt;Ur=(-dn+un)*(Do-(hs(Zn,ms,Ke)-Ir)),ai=(ma-Dn)*(-Gn+Xn),Qr=-(ma-Dn)*(-dn+un)}}else{const un=vi-Wt,Xn=xi-Ir,dn=Ti-Wt,Gn=Cn-Ir,ms=He(u*(1-Bt)+d*Bt,B,U),tt=Ge+rr,ma=hs(ms,tt,re)-Ir,Do=E(tt)-sr,Rs=te===2?-1:1;if(Ur=Rs*Do*(-Gn+Xn),ai=Rs*(-dn+un)*ma,Qr=-Rs*Do*(-dn+un),fe){const Zn=ms,Dn=Ge+qt,gs=E(Dn)-sr;Ur=(-Do+gs)*(-Gn+Xn),ai=(-dn+un)*(-ma+(hs(Zn,Dn,Ke)-Ir)),Qr=-(-Do+gs)*(-dn+un)}}const Ms=1/Math.sqrt(Ur*Ur+ai*ai+Qr*Qr);vt.setNormalFromValues(bt,Ur*Ms,ai*Ms,Qr*Ms)}}else for(let It=1;It<W-1;It+=ke){const lt=It/H,qt=j?Ie:He(u*(1-lt)+d*lt,B,U),er=j?He(p*(1-lt)+A*lt,q,Z):Ge,rr=j?Ne:He(lt,O,N),vr=j?He(lt,I,L):Xe,ri=Se(qt,er),Wi=qt*S-ee,Lr=E(er)-se,ii=ri-ue;_u(Wi,Lr,ii,R),vt.setVertexFromValuesRawPositionUV(It,Wi,Lr,ii,rr,vr)}}}function gze(t,e){vze(t)}function L7t(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function N7t(t,e){return t*e}function mpe(t,e,r){return t?i=>L7t(i,e):i=>N7t(i,r)}function Aze(t,e,r,i,n,s){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,i[1])-Math.max(1,i[0]))*(Math.min(e-2,n[1])-Math.max(1,n[0])),c=pA.map((O,I)=>I===0&&n[1]<e-2||I===1&&i[1]<e-2||I===2&&n[0]>1||I===3&&i[0]>1),u=t.outerEdges.reduce((O,I,N)=>O+(c[N]?0:o-2+I.count-1),0),d=r.reduce((O,I)=>O+o*(2*(I.latitudeResolution-1)+1),0),p=s?2:1,A=3*(l+u+d)*p,v=a>=v7t?new Uint32Array(A):new Uint16Array(A);let b=0;const S=e-2,E=o-2;at(E>=0);const R=(O,I,N,L,B,U)=>{const q=O*B,Z=U[q],X=U[q+1],ee=U[q+2],se=I*B,ue=U[se],re=U[se+1],te=U[se+2],j=N*B,H=U[j],W=U[j+1],oe=U[j+2],le=L*B,fe=U[le],de=U[le+1],Ee=U[le+2];return(ue-fe)*(ue-fe)+(re-de)*(re-de)+(te-Ee)*(te-Ee)>(Z-H)*(Z-H)+(X-W)*(X-W)+(ee-oe)*(ee-oe)};if(s){const O=(N,L,B)=>{v[b++]=N,v[b++]=L,v[b++]=L,v[b++]=B,v[b++]=B,v[b++]=N,ha&&(at(N<a),at(L<a),at(B<a),at(b<=A))};(()=>{for(let N=Math.max(n[0],1)-1;N<Math.min(n[1],e-2)-1;++N){const L=N*S;for(let B=Math.max(i[0],1)-1;B<Math.min(i[1],e-2)-1;++B){const U=N*S+B,q=U+1,Z=q+S,X=Z-1,ee=L+B,se=ee+1,ue=se+S,re=ue-1,te=t.vertexAttributes.position.typedBuffer,j=t.vertexAttributes.position.typedBufferStride;R(ee,se,ue,re,j,te)?(O(U,q,Z),O(Z,X,U)):(O(U,q,X),O(X,Z,q))}}})(),at(b===3*l*p),(()=>{for(let N=0;N<4;++N){const L=b;if(c[N])continue;const B=t.outerEdges[N],U=t.innerEdges[N];let q=0,Z=0;const X=B.count,ee=U.count;at(ee===o-1);let se=0;const ue=N===1||N===2?(re,te,j)=>O(re,te,j):(re,te,j)=>O(re,j,te);for(;q<X-1||Z<ee-1;){const re=U.getVertexIndex(Z),te=B.getVertexIndex(q),j=q<X-1,H=Z<ee-1;j&&(!H||(j?0+o*(q+.5)/(X-1):0)<=(H?1+E*(Z+.5)/(ee-1):0))?(++q,ha&&at(q<X),ue(re,te,B.getVertexIndex(q)),se++):(++Z,ha&&at(Z<ee),ue(re,te,U.getVertexIndex(Z)),se++)}ha&&(at(q===X-1),at(Z===ee-1),at(se===X+ee-2),at(se===o-2+B.count-1),at(b===L+3*se*p))}})(),at(b===3*(l+u)*p);const I=N=>{const L=t.outerEdges[N.connectedOuterEdgeOffset];let B=L.getVertexIndex(0),U=L.stride;for(let q=0;q<N.latitudeResolution;++q){const Z=q===0?N.rowOffset:B+e;for(let X=0;X<o;X++)O(B,B+1,Z+X),q<N.latitudeResolution-1&&O(B+1,Z+X+1,Z+X),B+=U;B=Z,U=1}};r.forEach(I)}else{(()=>{const I=Math.max(n[0],1)-1,N=Math.min(n[1],e-2)-1,L=Math.max(i[0],1)-1,B=Math.min(i[1],e-2)-1;for(let U=I;U<N;++U){const q=U*S;for(let Z=L;Z<B;++Z){const X=q+Z,ee=X+1,se=ee+S,ue=se-1,re=t.vertexAttributes.position.typedBuffer,te=t.vertexAttributes.position.typedBufferStride;R(X,ee,se,ue,te,re)?(v[b]=X,v[b+1]=ee,v[b+2]=se,v[b+3]=se,v[b+4]=ue,v[b+5]=X):(v[b]=X,v[b+1]=ee,v[b+2]=ue,v[b+3]=ue,v[b+4]=ee,v[b+5]=se),b+=6}}})(),at(b===3*l*p),(()=>{for(let I=0;I<4;++I){if(c[I])continue;const N=t.outerEdges[I],L=t.innerEdges[I];let B=0,U=0;const q=N.count,Z=L.count;at(Z===o-1);const X=I===1||I===2,ee=X?1:2,se=X?2:1,ue=N.index0,re=N.stride,te=L.index0,j=L.stride;for(;B<q-1||U<Z-1;){const H=te+U*j,W=ue+B*re,oe=B<q-1,le=U<Z-1,fe=oe&&(!le||(oe?0+o*(B+.5)/(q-1):0)<=(le?1+E*(U+.5)/(Z-1):0));fe?++B:++U;const de=fe?W+re:H+j;v[b]=H,v[b+ee]=W,v[b+se]=de,b+=3}}})(),at(b===3*(l+u)*p);const O=I=>{const N=t.outerEdges[I.connectedOuterEdgeOffset];let L=N.getVertexIndex(0),B=N.stride;for(let U=0;U<I.latitudeResolution;++U){const q=U===0?I.rowOffset:L+e;for(let Z=0;Z<o;Z++){const X=q+Z;v[b]=L,v[b+1]=L+1,v[b+2]=X,U<I.latitudeResolution-1?(v[b+3]=L+1,v[b+4]=X+1,v[b+5]=X,b+=6):b+=3,L+=B}L=q,B=1}};r.forEach(O)}at(b===A),t.indices=v,t.indexCount=A}function yze(t,e){const r=t.localOrigin,i=t.geometryInfo,n=t.geometryState.neighborData.edgeResolutions,s=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?s-1:0)*s+(l===1?s-1:0),d=(c?0:1)*s+(c?1:0);i.innerEdges[l]=new gxe(o,r,u,d,s)}{const c=a,u=n[l]+1;i.outerEdges[l]=new gxe(o,r,c,1,u),a+=u}}}function _ze(t,e,r){const i=(e+2)%4,n=t.geometryState,s=t.tile,o=n.neighborData,a=s.level-r.level,l=e===1||e===3,c=o.edgeResolutions[e];at(Im(c));const u=c+1,d=t.geometryInfo,p=d.boundingBox,A=d.outerEdges[e],v=d.uvRange[0],b=d.uvRange[1],S=d.uvRange[2],E=d.uvRange[3],R=He(e===1?1:0,v,S),O=He(e===0?1:0,b,E),I=r.renderData,N=I.geometryState,L=I.geometryInfo.outerEdges[i],B=s.getNeighborEdgeStartVertexIndex(e,r)*c,U=c*2**a;at(N.neighborData.edgeResolutions[i]===U),at(L.count-1===U);const q=I.localOrigin[0]-t.localOrigin[0],Z=I.localOrigin[1]-t.localOrigin[1],X=I.localOrigin[2]-t.localOrigin[2],ee=A.attributes,se=A.index0,ue=A.stride,re=ee.position.typedBuffer,te=ee.position.typedBufferStride,j=ee.normalCompressed.typedBuffer,H=ee.normalCompressed.typedBufferStride,W=ee.uv0,oe=L.attributes,le=L.index0,fe=L.stride,de=oe.position.typedBuffer,Ee=oe.position.typedBufferStride,Ie=oe.normalCompressed.typedBuffer,Ge=oe.normalCompressed.typedBufferStride;for(let Ke=1;Ke<u-1;++Ke){const vt=se+ue*Ke,ke=le+fe*(B+Ke),Ne=vt*te,Xe=ke*Ee,Se=de[Xe]+q,It=de[Xe+1]+Z,lt=de[Xe+2]+X;re[Ne]=Se,re[Ne+1]=It,re[Ne+2]=lt,_u(Se,It,lt,p);const qt=vt*H,er=ke*Ge;j[qt]=Ie[er],j[qt+1]=Ie[er+1];const rr=Ke/c,vr=l?R:He(rr,v,S),ri=l?He(rr,b,E):O;fd(W,vt,vr,ri)}}function vze(t){var Xe;const e=t.geometryState,r=e.neighborData,i=t.localOrigin,n=r.cornerNeighborData,s=t.geometryInfo,o=s.outerEdges,a=s.boundingBox,l=t.tile,c=((Xe=t.tile.surface.view)==null?void 0:Xe.viewingMode)==="local",u=l.ellipsoid.radius,d=l.extentInRadians,p=l.horizontalScale;let A=0,v=0,b=0;const S=(Se,It,lt)=>{const qt=d[It===0?1:3],er=d[Se===0?0:2],rr=Math.cos(qt),vr=Math.sin(qt),ri=Math.sin(er),Wi=Math.cos(er),Lr=u+lt;A=Wi*rr*Lr,v=ri*rr*Lr,b=vr*Lr},E=c?(()=>{const Se=t.geometryState.clippingArea,It=l.extent,lt=M(Se)&&(It[3]>Se[3]||It[2]>Se[2]||It[1]<Se[1]||It[0]<Se[0]),qt=mpe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,p);return(er,rr,vr)=>{const ri=er===0?se[0]:se[2],Wi=rr===0?se[1]:se[3],Lr=lt?He(ri,Se[0],Se[2]):ri,ii=lt?He(Wi,Se[1],Se[3]):Wi,Ut=vr;A=Lr*p,v=qt(ii),b=Ut}})():S;let R=0,O=0,I=0,N=0,L=0,B=0,U=0,q=0,Z=0;const X=c&&t.tile.surface.isWebMercatorOnPlateeCarree,ee=(Se,It,lt,qt,er)=>{let rr=0,vr=0,ri=0;if(c){const Wi=It*p,Lr=X?(Math.PI/2-2*Math.atan(Math.exp(-lt/u)))*u:lt*p;rr=Wi-A,vr=Lr-v,ri=qt-b}else{const Wi=fpe(Se),Lr=Se.tile,ii=Lr.extent,Ut=Lr.extentInRadians,bt=(It-ii[0])/(ii[2]-ii[0]),Bt=(lt-ii[1])/(ii[3]-ii[1]),Wt=Ut[0]*(1-bt)+Ut[2]*bt,sr=Wi(Bt),Ir=Math.cos(sr),vi=Math.sin(sr),xi=Math.sin(Wt),Ti=Math.cos(Wt),bi=u+qt;rr=Ti*Ir*bi-A,vr=xi*Ir*bi-v,ri=vi*bi-b}switch(er){case 0:U+=rr,q+=vr,Z+=ri;break;case 1:N-=rr,L-=vr,B-=ri;break;case 2:U-=rr,q-=vr,Z-=ri;break;case 3:N+=rr,L+=vr,B+=ri}},se=l.extent,ue=e.clippingArea,re=M(ue)?ue:CH,te=se[0],j=se[2],H=se[1],W=se[3],oe=[W>re[3],j>re[2],H<re[1],te<re[0]],le=Math.max(te,re[0]),fe=Math.min(j,re[2]),de=Math.max(H,re[1]),Ee=Math.min(W,re[3]),Ie=s.uvRange[0],Ge=s.uvRange[1],Ke=s.uvRange[2],vt=s.uvRange[3],ke=l.surface.shading||KS,Ne=Se=>{var ii;const It=n[Se].cornerTiles;R=0,O=0,I=1;let lt=1/0;for(let Ut=0;Ut<4;++Ut)lt=Math.min(lt,((ii=It[Ut])==null?void 0:ii.level)??1/0);for(let Ut=0;Ut<4;++Ut){const bt=It[Ut];t$[Ut]=(bt==null?void 0:bt.level)===lt?bt:null}let qt=1,er=0;for(let Ut=0;Ut<4;++Ut){const bt=t$[Ut];bt&&(qt=Math.max(qt,bt==null?void 0:bt.renderData.geometryState.numVerticesPerSide),er=bt.extent[2]-bt.extent[0])}const rr=er,vr=qt;at(vr>1);const ri=rr/vr;for(let Ut=0;Ut<4;++Ut){const bt=t$[(Ut+3)%4],Bt=t$[Ut%4];if(!bt&&!Bt)continue;const Wt=Ut===0?1:Ut===1?2:Ut===2?3:0,sr=Ut===0?2:Ut===1?3:Ut===2?0:1;if(bt&&Bt){const Ir=LX[Ut][0]*ri,vi=LX[Ut][1]*ri,xi=bt.extent,Ti=xi[Wt===0||Wt===1?2:0]+Ir,bi=xi[Wt===0||Wt===3?3:1]+vi,Cn=Bt.extent,Ur=Cn[sr===0||sr===1?2:0]+Ir,ai=Cn[sr===0||sr===3?3:1]+vi,Qr=bt.renderData,Ms=Bt.renderData,un=hs(Ti,bi,Qr.geometryState.samplerData),Xn=hs(Ur,ai,Ms.geometryState.samplerData);ee(Qr,Ti,bi,.5*(un+Xn),Ut)}else{const Ir=bt??Bt,vi=bt?Wt:sr,xi=Ir.extent,Ti=LX[Ut],bi=xi[vi===0||vi===1?2:0]+Ti[0]*ri,Cn=xi[vi===0||vi===3?3:1]+Ti[1]*ri,Ur=Ir.renderData,ai=hs(bi,Cn,Ur.geometryState.samplerData);ee(Ur,bi,Cn,ai,Ut)}}if(!c){const Ut=Math.sqrt(A*A+v*v+b*b);R=A/Ut,O=v/Ut,I=b/Ut}const Wi=Math.sqrt(N*N+L*L+B*B);N/=Wi,L/=Wi,B/=Wi;const Lr=Math.sqrt(U*U+q*q+Z*Z);if(U/=Lr,q/=Lr,Z/=Lr,c||I*I<.999){R=B*q-L*Z,O=N*Z-B*U,I=L*U-N*q;const Ut=1/Math.sqrt(R*R+O*O+I*I);R*=Ut,O*=Ut,I*=Ut}};for(let Se=0;Se<4;++Se){const It=Se,lt=(Se+1)%4,qt=Se===0||Se===1?1:0,er=Se===0||Se===3?1:0,rr=He(qt,Ie,Ke),vr=He(er,Ge,vt),ri=o[It],Wi=Se===0||Se===3?ri.count-1:0,Lr=o[lt],ii=Se===0||Se===1?Lr.count-1:0,Ut=n[Se].cornerTiles;let bt=-1;for(let sr=0;sr<4;++sr){const Ir=Ut[sr];Ir&&(bt===-1||q_(Ut[bt],Ir)>0)&&(bt=sr)}const Bt=bt,Wt=Ut[Bt];if(R=0,O=0,I=1,Wt!==l){const sr=l.level-Wt.level,Ir=2**sr,vi=[Wt.lij[0]+sr,Wt.lij[1]*Ir,Wt.lij[2]*Ir],xi=[vi[1]+Ir===l.lij[1],Se===0&&(Bt===1||Bt===0&&Wt!==Ut[3])||Se===1&&(Bt===0||Bt===1&&Wt!==Ut[2]),vi[1]===l.lij[1]+1,Se===2&&(Bt===3||Bt===2&&Wt!==Ut[1])||Se===3&&(Bt===2||Bt===3&&Wt!==Ut[0])],Ti=xi.reduce((Qr,Ms)=>Qr+(Ms?1:0),0);at(Ti===1||Ti===2);let bi=-1,Cn=-1;const Ur=Wt.renderData;if(Ti===1){const Qr=xi.findIndex(un=>un);at(0<=Qr&&Qr<=3),bi=(Qr+2)%4;const Ms=t.geometryState.neighborData.edgeResolutions[Qr];Cn=l.getNeighborEdgeStartVertexIndex(Qr,Wt)*Ms+Ms*(Qr===0&&Se===0||Qr===1&&Se===0||Qr===2&&Se===1||Qr===3&&Se===3?1:0)}else{at(xi[1]||xi[3]),bi=xi[1]?3:1;const Qr=Ur.geometryState.neighborData.edgeResolutions[bi];Cn=Se===0||Se===3?0:Qr}const ai=Ur.geometryInfo.outerEdges[bi];{const Qr=ri.index0+Wi*ri.stride,Ms=Lr.index0+ii*Lr.stride,un=ai.index0+Cn*ai.stride;{const Xn=ai.attributes.position,dn=Xn.typedBuffer,Gn=un*Xn.typedBufferStride,ms=t.localOrigin,tt=ai.localOrigin,ma=dn[Gn]+tt[0]-ms[0],Do=dn[Gn+1]+tt[1]-ms[1],Rs=dn[Gn+2]+tt[2]-ms[2];_u(ma,Do,Rs,a);{const Zn=ri.attributes.position,Dn=Zn.typedBuffer,gs=Qr*Zn.typedBufferStride;Dn[gs]=ma,Dn[gs+1]=Do,Dn[gs+2]=Rs}{const Zn=Lr.attributes.position,Dn=Zn.typedBuffer,gs=Ms*Zn.typedBufferStride;Dn[gs]=ma,Dn[gs+1]=Do,Dn[gs+2]=Rs}}fd(ri.attributes.uv0,Qr,rr,vr),fd(Lr.attributes.uv0,Ms,rr,vr);{const Xn=ai.attributes.normalCompressed.typedBuffer,dn=un*ai.attributes.normalCompressed.typedBufferStride;{const Gn=ri.attributes.normalCompressed,ms=Gn.typedBuffer,tt=Qr*Gn.typedBufferStride;ms[tt]=Xn[dn],ms[tt+1]=Xn[dn+1]}{const Gn=Lr.attributes.normalCompressed,ms=Gn.typedBuffer,tt=Ms*Gn.typedBufferStride;ms[tt]=Xn[dn],ms[tt+1]=Xn[dn+1]}}}}else{const sr=oe[It],Ir=oe[lt];let vi;if(sr||Ir){const Cn=He(te*(1-qt)+j*qt,le,fe),Ur=He(H*(1-er)+W*er,de,Ee),ai=e.samplerData;vi=hs(Cn,Ur,ai)}else vi=F7t(Ut);E(qt,er,vi),(ke||KS)&&Ne(Se);const xi=A-i[0],Ti=v-i[1],bi=b-i[2];_u(xi,Ti,bi,a),ri.setVertexFromValuesRawPositionUVNormal(Wi,xi,Ti,bi,rr,vr,R,O,I),Lr.setVertexFromValuesRawPositionUVNormal(ii,xi,Ti,bi,rr,vr,R,O,I)}}for(let Se=0;Se<4;++Se)t$[Se]=null}function F7t(t){var s,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);ha&&(at(!t[0]||!t[2]||vse(t[0],t[2],gr.SOUTH_WEST)),at(!t[1]||!t[3]||vse(t[1],t[3],gr.NORTH_WEST)));let r=0,i=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,u=a===0||a===3,d=l.extent,p=d[c?0:2],A=d[u?1:3],v=(o=(s=l.renderData)==null?void 0:s.geometryState)==null?void 0:o.samplerData;i+=hs(p,A,v),r++}}const n=r?i/r:0;return at(n!=null),n}function EH(t){const e=t.vao,r=t.geometryInfo.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const LX=[[0,1],[1,0],[0,-1],[-1,0]],Fo=new _9t,CH=tce(-1/0,-1/0,1/0,1/0),t$=[null,null,null,null];function bze(t,e,r){if(!e)return!1;const i=q_(t,e);return i>0||i===0&&r>=2}const KS=!0;let k7t=class extends upe{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=oi(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const n=i.view.renderSpatialReference,s=i.spatialReference,o=M(n)&&fle(n)&&M(s)&&s.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const u=pt(c[0],c[1],0);il(u,St.WebMercator,u,St.PlateCarree);const d=pt(c[2],c[3],0);il(d,St.WebMercator,d,St.PlateCarree),l[0]=u[0],l[1]=u[1],l[2]=d[0],l[3]=d[1]}else for(let u=0;u<4;++u)l[u]=c[u]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),n=Math.sqrt(r*r+i*i),s=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(n,s);this._center[Oo.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],n=r[1],s=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let u=0;u<6;u++){const d=e[u],p=d[0],A=d[1],v=d[2],b=d[3];if(p*(p>0?i:o)+A*(A>0?n:a)+v*(v>0?s:l)+b>=0)return Ac.OUTSIDE;c=c&&p*(p<0?i:o)+A*(A<0?n:a)+v*(v<0?s:l)+b<=0}return c?Ac.INSIDE:Ac.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return eot(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,r,i,n){return P9[0]=1/r[0],P9[1]=1/r[1],P9[2]=1/r[2],hde(this._aabb(),e,P9,i,n)}createGeometry(){R7t(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){$7t(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){D7t(this.renderData,this._horizontalScaleFactor)}};const P9=G();let U7t=class{constructor(){this.extent=Kr(),this.minLevel=0,this.maxLevel=0,this.callback=null}},fU=class extends rt{constructor(){super(...arguments),this._queries=new Vr({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Vr({initialSize:30}),this._queryPool=new Sl(U7t)}queryVisibleLevelRange(e,r,i,n){const s=this._queryPool.acquire();lm(s.extent,e),s.minLevel=r??-Number.MAX_VALUE,s.maxLevel=i??Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const n=this._queries.data[i],s=n.extent;r>=n.minLevel&&r<=n.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};h([f()],fU.prototype,"updating",null),fU=h([Q("esri.views.3d.terrain.ScaleRangeQueries")],fU);let B7t=class extends upe{get convexHull(){return this._convexHull}constructor(e,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=Ho(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const n=this.ellipsoid.radius,s=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],u=Mr(o,l,.5),d=Mr(s,a,.5),p=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-s)*Math.cos(p)*n,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=n-Math.sqrt(n*n-this._edgeLen2/4),elt(this.centerAtSeaLevel,d,u,this.ellipsoid.radius);const A=sh(this.centerAtSeaLevel);Ye(A,A),this.up=A,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)Le(e[Oo.MIDDLE],0,0,0),Le(e[Oo.TOP],0,0,0),Le(e[Oo.BOTTOM],0,0,0),e[Oo.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=e[Oo.MIDDLE],i=this.convexHull;let n=0;for(let s=0;s<8;++s)n=Math.max(n,z7t(r,i,3*s));e[Oo.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibilityStatus(e){if(!Zb(e,this._boundingSphere))return Ac.OUTSIDE;if(this.lij[0]<10)return Ac.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let n=!0;for(let s=0;s<L2.NUM;s++){const o=s===Fn.NEAR,a=e[s],l=a[0],c=a[1],u=a[2],d=a[3]-(o?i:0);let p=!1;for(let A=0;A<8;++A){const v=3*A;if(l*r[v+0]+c*r[v+1]+u*r[v+2]+d<0){if(p=!0,!n)break}else n=!1}if(!p)return Ac.OUTSIDE}return n?Ac.INSIDE:Ac.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){b7t(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),ha&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBounds,n=this.ellipsoid.radius,s=i[1];if(this.level===0)Le(r,0,0,0),e[3]=n+s;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];nx(Ixe,a,l,n),nx($xe,a,c,n),ze(r,Ixe,$xe);const u=.5*(i[0]+i[1]);Oe(r,r,(n+u)/Gh(r));const d=this.convexHull;let p=0;const A=(b,S)=>{const E=b[0]-d[3*S+0],R=b[1]-d[3*S+1],O=b[2]-d[3*S+2];return Math.sqrt(E*E+R*R+O*O)};for(let b=0;b<8;++b){const S=A(r,b);p=Math.max(p,S)}const v=p;e[3]=v+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,n=this._getPatchType(),s=this.surface.isWebMercator,o=s&&n===bf.HAS_NORTH_POLE,a=s&&n===bf.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,u=e[0],d=e[2],p=a?-c:e[1],A=o?c:e[3],v=.5*(u+d),b=i[0],S=r+(l?Math.min(0,b-1):b),E=(te,j,H)=>nx(te,j,H,S),R=G(),O=G(),I=G(),N=G();E(R,u,p),E(O,u,A),E(I,d,A),E(N,d,p);const L=(te,j)=>{for(let H=0;H<3;++H)this._convexHull[3*j+H]=te[H]};L(R,0),L(O,1),L(I,2),L(N,3);const B=i[1],U=r+(l?Math.max(0,B+1):B),q=G(),Z=G(),X=G();nx(Z,v,A,S),nx(X,v,p,S),ze(q,Z,X),Ye(q,q);const ee=G(),se=G(),ue=(te,j)=>{Ka(se,te,j),Ye(se,se);const H=-Qe(te,ee)/Qe(se,ee);at(H>=0),Oe(se,se,H),ze(te,te,se)};if(2**this.lij[0]>2*this.lij[1]){const te=X,j=G();Kt(j,Pxe,te),Ye(j,j),Kt(ee,te,j),Ye(ee,ee),at(wf(Qe(ee,te)/Gh(te),0)),ue(R,O),ue(N,I),L(R,0),L(N,3)}else if(2**this.lij[0]!==2*this.lij[1]){const te=Z,j=G();Kt(j,Pxe,te),Ye(j,j),Kt(ee,j,te),Ye(ee,ee),ue(O,R),ue(I,N),L(O,1),L(I,2)}const re=(te,j)=>{const H=U/Qe(j,q);for(let W=0;W<3;++W)this._convexHull[3*te+W]=j[W]*H};re(4,R),re(5,O),re(6,I),re(7,N)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?bf.HAS_BOTH_POLES:bf.HAS_NORTH_POLE:i?bf.HAS_SOUTH_POLE:bf.REGULAR}intersectsRay(e,r,i,n){const s=this._boundingSphere,o=s[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=s[0]-e[0],c=s[1]-e[1],u=s[2]-e[2],d=(l*r[0]+c*r[1]+u*r[2])/a,p=r[0]*d-l,A=r[1]*d-c,v=r[2]*d-u;return p*p+A*A+v*v<o*o}getDefaultVerticesPerSide(){return this.level<Oxe.length?Oxe[this.level]+1:2}updateCornerElevations(){E7t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){S7t(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var Ee;if(!ha||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,n=G(),s=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=s+o[0],l=1,c=0,u=this._center[Oo.MIDDLE][3],d=this.convexHull,p=(Ie,Ge)=>{for(let Ke=0;Ke<3;++Ke)Ie[Ke]=d[3*Ge+Ke]};{const Ie=G(),Ge=G(),Ke=G(),vt=G(),ke=G(),Ne=(Xe,Se,It,lt)=>{p(Ge,Xe),p(Ke,Se),p(vt,It),Ka(Ge,Ge,Ke),Ka(vt,vt,Ke),Kt(Ie,Ge,vt),Ye(Ie,Ie);const qt=Qe(Ie,Ke);p(ke,lt);const er=Qe(Ie,ke),rr=Math.abs(er-qt);at(wf(rr,0),`Non coplanar ${Xe},${Se},${It},${lt} diff = ${rr}`)};Ne(0,1,2,3),Ne(4,5,6,7),Ne(0,1,4,5),Ne(1,2,5,6),Ne(2,3,6,7),Ne(3,0,7,4)}const A=yd(24),v=(Ie,Ge,Ke)=>{const vt=4*Ie;for(let ke=0;ke<3;++ke)A[vt+ke]=Ge[ke];A[vt+3]=Ke},b=G(),S=G(),E=G(),R=G(),O=(Ie,Ge,Ke,vt)=>{p(b,Ge),p(S,Ke),p(E,vt),Ka(b,b,S),Ye(b,b),Ka(E,E,S),Ye(E,E),Kt(R,b,E),Ye(R,R);const ke=Qe(R,S);v(Ie,R,ke)};O(0,0,1,2),O(1,1,0,4),O(2,1,5,2),O(3,3,2,6),O(4,4,0,3),O(5,4,6,5);const I=1,N=(Ie,Ge,Ke,vt)=>{const ke=4*Ie;return A[ke+0]*Ge+A[ke+1]*Ke+A[ke+2]*vt-A[ke+3]},L=(Ie,Ge,Ke,vt)=>N(Ie,Ge,Ke,vt)>=-I,B=(Ie,Ge)=>L(Ie,Ge[0],Ge[1],Ge[2]),U=2**this.lij[0]>2*this.lij[1],q=(Ie,Ge,Ke)=>Math.sqrt(wze(Ie,Ge,Ke,i[0],i[1],i[2]))<r,Z=Ie=>q(Ie[0],Ie[1],Ie[2]),X=(Ie,Ge)=>q(Ie[Ge+0],Ie[Ge+1],Ie[Ge+2]),ee=this.extentInRadians,se=.5*(ee[0]+ee[2]),ue=ee[1],re=ee[3],te=G(),j=G();nx(te,se,re,a),nx(j,se,ue,a);const H=U?"Upper":"Lower";let W=!0;for(let Ie=0;Ie<6;++Ie){for(let Ge=0;Ge<8;++Ge){const Ke=3*Ge,vt=L(Ie,d[Ke+0],d[Ke+1],d[Ke+2]);W&&(W=vt),at(vt,`Tile[${this.lij}] Convex hull point ${Ge} outside of plane ${Ie}`)}at(B(Ie,j),`Tile[${this.lij}] (${H}) bottom mid outside of plane ${Ie}`),at(B(Ie,te),`Tile[${this.lij}] (${H}) top mid outside of plane ${Ie}`)}at(W,"Not all convex hull points are inside  convex hull polyhedron"),at(Z(j),`Tile[${this.lij}] (${H}) bottom mid outside of bounding sphere`),at(Z(te),`Tile[${this.lij}] (${H}) top mid outside of bounding sphere`);for(let Ie=0;Ie<8;++Ie){const Ge=X(d,3*Ie);at(Ge,`Tile[${this.lij}] Convex hull point ${Ie} outside of bounding sphere`)}for(let Ie=0;Ie<6;++Ie)for(let Ge=0;Ge<8;++Ge){const Ke=3*Ge;L(Ie,d[Ke+0],d[Ke+1],d[Ke+2])||console.error(`Tile[${this.lij}] Convex hull point ${Ge} outside of plane ${Ie}`)}const oe=this.extentInRadians,le=Math.max(oe[2]-oe[0],oe[3]-oe[1]),fe=Math.round(le*s),de=this.renderData;if(de){const Ie=de.geometryInfo,Ge=de.localOrigin,Ke=(Ee=Ie.vertexAttributes)==null?void 0:Ee.position;if(!Ke)return;const vt=Ke.count,ke=G(),Ne=Ie.numVerticesPerSide-2,Xe=Ne*Ne,Se=de.geometryState.neighborData,It=Se.edgeResolutions.reduce((lt,qt)=>lt+qt+1,0);for(let lt=0;lt<vt;++lt){const qt=lt<Xe,er=!qt&&lt<Xe+It;let rr=!1,vr=-1;if(er){let Ur=Xe;for(let ai=0;ai<4;++ai){const Qr=Se.edgeResolutions[ai];if(lt===Ur||lt===Ur+Qr-1){rr=!0;break}if(Ur+=Qr,lt<Ur){vr=ai;break}}}const ri=vr,Wi=rr,Lr=er&&!Wi,ii=er?Se.edgePeerNeighbors[ri]:null,Ut=er&&ii&&q_(this,ii)>0,bt=qt?"internal":Lr?"edge":Wi?"corner":"pole";Ke.getVec(lt,n),ze(ke,n,Ge);const Bt=Gh(ke)-s;let Wt=0,sr=!1;const Ir=o[0]-Bt,vi=Bt-o[1],xi=Ir>l,Ti=vi>l,bi=xi||Ti,Cn=`Tile[${this.lij}].vertex[${lt}]:${bt}`+(xi?"(below)":Ti?"(above)":"")+(Ut?"(Neighbor)":"");{const Ur=EN(ke,i);if(Ur>=r+c){const ai=Ur-r;bi||(console.error(`${Cn} is out of the bounding sphere by ${ai.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${Bt.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(ai/r).toFixed(0)})`),sr=!0)}}for(let Ur=0;Ur<6;++Ur)if(!L(Ur,ke[0],ke[1],ke[2])){const ai=N(Ur,ke[0],ke[1],ke[2]),Qr=lt%Ne,Ms=(lt-Qr)/Ne;Ur===0&&Ir||Ur===5&&vi||(console.error(`${Cn} (${Qr},${Ms})|${Ne}] is out of the bounding trapezoid plane ${Ur} h=${Math.round(Bt)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(ai)} radii = ${Math.round(r)}/${Math.round(u)}} : maxL = ${fe}`),++Wt)}if(sr||Wt>0)break}}}};const Oxe=[128,64,64,32,16,8,8,4];function z7t(t,e,r){return wze(t[0],t[1],t[2],e[r+0],e[r+1],e[r+2])}function wze(t,e,r,i,n,s){const o=i-t,a=n-e,l=s-r;return o*o+a*a+l*l}const nx=(t,e,r,i)=>{const n=Math.cos(e),s=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*n,t[1]=i*o*s,t[2]=i*a},Pxe=[0,0,1],Ixe=G(),$xe=G();let V7t=class{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}},xze=class extends Nc{constructor(){super(...arguments),this.blendMode=mt.Normal}};h([ae({count:mt.COUNT})],xze.prototype,"blendMode",void 0);let LM=class extends xze{constructor(){super(...arguments),this.output=Sa.Composite,this.baseOpacityMode=ym.NotRequired,this.premultipliedSource=J0.Off,this.hasWebGL2Context=!1}};h([ae({count:Sa.COUNT})],LM.prototype,"output",void 0),h([ae({count:ym.COUNT})],LM.prototype,"baseOpacityMode",void 0),h([ae()],LM.prototype,"premultipliedSource",void 0),h([ae()],LM.prototype,"hasWebGL2Context",void 0);var eE;function G7t(t){const e=new Ui;if(e.include(ize),t.background===eE.Only){const r=t.output===Sa.ColorComposite;return r?e.fragment.uniforms.add(new kr("backgroundColor",i=>i.backgroundColor)):(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(cpe)),e.fragment.code.add(D`
    void main() {
      gl_FragColor = vec4(${r?D`backgroundColor`:D`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(nze,t),e.fragment.uniforms.add(new _r("tex",r=>r.texture)),e.fragment.uniforms.add(new ut("opacity",r=>r.opacity)),e.fragment.code.add(D`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(eE||(eE={}));const j7t=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return eE},build:G7t},Symbol.toStringTag,{value:"Module"}));let H7t=class extends rze{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Ec}},Tze=class Sze extends qi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2}initializeProgram(e){return new zi(e.rctx,Sze.shader.get().build(this.configuration),Di)}initializePipeline(){return Pr({blending:jm(st.ONE,st.ONE_MINUS_SRC_ALPHA),colorWrite:Gr})}};Tze.shader=new Bi(j7t,()=>be(()=>import("./BlendLayers.glsl-15deb702.js"),[]));let Eze=class extends LM{constructor(){super(...arguments),this.background=eE.BelowLayer}};h([ae()],Eze.prototype,"background",void 0);let NX=class{constructor(e,r,i,n,s,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=Fr(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=pt(n,s,o)}destroy(){this.texture.release()}};function mU(){return[1,0,0,1,0,0]}function q7t(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function W7t(t,e,r,i,n,s){return[t,e,r,i,n,s]}function Q7t(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:q7t,create:mU,createView:Q7t,fromValues:W7t},Symbol.toStringTag,{value:"Module"}));function Y7t(t){return t instanceof Float32Array&&t.length>=2}function X7t(t){return Array.isArray(t)&&t.length>=2}function FX(t){return Y7t(t)||X7t(t)}const Z7t=96,J7t=39.37;function gpe(t,e){return e.type?ti(t,e.x,e.y):$a(t,e)}function K7t(t){return Eu(t)}function ekt(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const tkt=function(){const t=Ft();return function(e,r,i){const n=r.targetGeometry;gpe(t,n);const s=.5*MH(r);return e.xmin=t[0]-s*i[0],e.ymin=t[1]-s*i[1],e.xmax=t[0]+s*i[0],e.ymax=t[1]+s*i[1],e.spatialReference=n.spatialReference,e}}();function MH(t){return t.scale*rkt(t.targetGeometry)}function rkt(t){return M(t)&&xc(t.spatialReference)?1/(K7t(t.spatialReference)*J7t*Z7t):1}function ikt(t){return SG(t.rotation)||0}const Ape=function(){const t=Ft(),e=Ft(),r=Ft();return function(i,n,s,o,a,l){return Zue(t,n),ed(e,s,.5*l),ti(r,1/o*l,-1/o*l),Hue(i,e),a&&Gue(i,i,a),YNe(i,i,r),jue(i,i,t),i}}(),nkt=function(){const t=Ft();return function(e,r,i,n){const s=MH(r),o=ikt(r);return gpe(t,r.targetGeometry),Ape(e,t,i,s,o,n)}}(),skt=function(){const t=Ft();return function(e,r,i,n){const s=MH(r);return gpe(t,r.targetGeometry),Ape(e,t,i,s,0,n)}}();function okt(t){const e=c2(t);return e?e.valid[1]-e.valid[0]:0}function akt(t,e){return Math.round(okt(t)/e)}var wse;const Ry=[0,0];let ob=wse=class extends Je{constructor(t){super(t),this._viewpoint2D={center:Ft(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new an,this.id=0,this.inverseTransform=mU(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=mU(),this.transformNoRotation=mU(),this.displayMat3=ph(),this.displayViewMat3=ph(),this.viewMat3=ph(),this.viewMat2d=HNe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=ekt(r,t.viewpoint),this._set("size",$a(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new wse({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return FX(e)?Wx(t,e,this.inverseTransform):(Ry[0]=e,Ry[1]=r,Wx(t,Ry,this.inverseTransform))}toScreen(t,e,r){return FX(e)?Wx(t,e,this.transform):(Ry[0]=e,Ry[1]=r,Wx(t,Ry,this.transform))}toScreenNoRotation(t,e,r){return FX(e)?Wx(t,e,this.transformNoRotation):(Ry[0]=e,Ry[1]=r,Wx(t,Ry,this.transformNoRotation))}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,n=this._get("size");return Ape(t,r,n,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),o=new Dm({targetGeometry:new Ht(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!s||!e||!r)return;this.resolution=MH(o),this.rotation=i,this.scale=r,this.spatialReference=e,$a(this.center,t);const a=s[0]!==0?2/s[0]:0,l=s[1]!==0?-2/s[1]:0;uhe(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=hhe(this.viewMat3),u=vf(s[0]/2,s[1]/2),d=vf(-s[0]/2,-s[1]/2),p=SG(i);fz(c,c,u),dhe(c,c,p),fz(c,c,d),mO(this.displayViewMat3,this.displayMat3,c);const A=Hue(this.viewMat2d,u);return Gue(A,A,p),jue(A,A,d),tkt(this.extent,o,s),nkt(this.transform,o,s,n),WNe(this.inverseTransform,this.transform),skt(this.transformNoRotation,o,s,n),this.worldScreenWidth=akt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};h([f({readOnly:!0})],ob.prototype,"id",void 0),h([f({value:1,json:{write:!0}})],ob.prototype,"pixelRatio",null),h([f({json:{write:!0}})],ob.prototype,"size",null),h([f()],ob.prototype,"spatialReference",void 0),h([f({type:Dm,json:{write:!0}})],ob.prototype,"viewpoint",null),ob=wse=h([Q("esri.views.2d.ViewState")],ob);const lkt=ob,ckt=.125;let ukt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new lkt({viewpoint:new Dm({targetGeometry:new Ht(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,r,i,n,s,o,a,l,c,u){const d=o.adjustLevel(r[0]),p=this._renderParams;p.context=e,p.painter=n,p.glyphMosaic=n.glyphMosaic,p.spriteMosaic=n.spriteMosaic,p.pixelRatio=u,p.displayLevel=d,p.requiredLevel=d;const A=o.getScale(r[0]),[v,b]=o.getShift(r,a*A),S=ckt*a*A/c,E=i.transforms.dvs;E[0]=S,E[4]=-S,E[6]=-1-v-l[0]*a*2,E[7]=1+b+(1-l[1])*a*2-2,p.state.size[0]=c,p.state.size[1]=c,i.stage||i.attachWithContext(e),i.triangleCount=0,n.drawTile(p,i,s)}},Cze=class Mze extends qi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2}initializeProgram(e){return new zi(e.rctx,Mze.shader.get().build(this.configuration),Di)}initializePipeline(){return Pr({blending:jm(st.ONE,st.ONE_MINUS_SRC_ALPHA),colorWrite:Gr})}};Cze.shader=new Bi(G9t,()=>be(()=>import("./RasterColorizer.glsl-383b75fe.js"),[]));let gU=class extends LM{constructor(){super(...arguments),this.colorizerType=cS.Stretch,this.stretchType=JS.Noop,this.applyColormap=!0}};h([ae({count:cS.COUNT})],gU.prototype,"colorizerType",void 0),h([ae({count:JS.COUNT})],gU.prototype,"stretchType",void 0),h([ae()],gU.prototype,"applyColormap",void 0);let Dxe=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new uo(this._rctx,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.DEPTH_RENDER_BUFFER,width:e,height:e});return this._fbos.set(e,i),i}};const hkt=we.getLogger("esri.views.3d.terrain");let dkt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new ukt,this._bindParameters=new Dj(null,null,null),this._blendLayersTechniqueConfig=new Eze,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Fc(this._rctx,gP)}dispose(){this._fbos.forEach(kt),this._fbos=null,this._vtFBO=kt(this._vtFBO),this._vaoQuad=kt(this._vaoQuad),this._vectorTileHelper=kt(this._vectorTileHelper),this._backgroundTechnique=us(this._backgroundTechnique),this._applyOpacityTechnique=us(this._applyOpacityTechnique),this._blendLayersTechnique=us(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,n=J0.Off,s=eE.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(Tze,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(mt.Normal,r?Sa.ColorComposite:Sa.GridComposite,ym.NotRequired,J0.Off,eE.Only),n=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(n)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(wr.TRIANGLE_STRIP,0,Xl(this._vaoQuad,"geometry"))}drawGroup(e,r,i,n,s,o=J0.On){r===Sa.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(n,r,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,r,i,n,s,o=J0.Off){if(k(e.texture))return;e.fboTexture=r===Sa.GroupBackgroundComposite||n===mt.Normal&&s===ym.NotRequired&&o===J0.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(n,r,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,r,i,n,s,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,di.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=n===mt.Normal&&s===ym.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,n,s);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,c,null);this._render(u)}_getRasterColorizerTechnique(e,r,i,n){const s=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(s.type);return k(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new gU,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?JS.Noop:JS.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(Cze,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,n,s,o,a,l,c){const u=this._rctx,d=o.sourceLayerInfo.data,p=o.tile.surface.layerViewByIndex(o.layerIndex,di.MAP),A=s===ym.Required||e.opacity<1||n!==mt.Normal||r!==Sa.Composite,v=A?J0.On:J0.Off;this._getBlendLayersTechnique(n,r,s,v).bindPipelineState(u);let b=null,S=null;A?(S=this.currentFBO(i),k(this._vtFBO)&&(this._vtFBO=new Dxe(this._rctx)),b=this._vtFBO.get(i),u.bindFramebuffer(b),this._clearCurrentFBO()):c&&u.clearSafe(rs.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(u,o.sourceLod,d,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/o.scale),o.offset,l,a)}catch(E){hkt.warnOnce("A render call containing vector tiles did not resolve correctly.",E)}return!M(b)||(u.bindFramebuffer(S),e.texture=b.colorTexture,e.offset=yh,e.scale=1,this.drawRasterData(e,r,i,n,s,v),c)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Xt.TEXTURE_UNIT_FOR_UPDATES),n=e.descriptor;r.gl.copyTexImage2D(cr.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),e.generateMipmap(),r.bindTexture(i,Xt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(rs.COLOR_BUFFER_BIT|rs.DEPTH_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let n=this._fbos.length;n<=r;n++)this._fbos.push(new Dxe(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},pkt=class{constructor(e,r,i,n){this.start=e,this.end=r,this.blendMode=i,this.opacity=n}},fkt=class{constructor(e,r,i){this._rctx=e,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new H7t,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new dkt(this._rctx,this._techniqueRepository),this._blackTex=new WC(Hwt(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=kt(this._composition),this._backgroundTexture=us(this._backgroundTexture),this._blackTex=us(this._blackTex)}get backgroundIsGrid(){return k(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,n=i.baseOpacity;let s=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let u=!1;aV.clear(),D3.length=0;const d=e.layerInfo[di.MAP];let p=d.length,A=0;for(;A<d.length;A++){const S=i.layerViewByIndex(A,di.MAP),E=S.layer.opacity;Lxe[A]=E;const R=S.fullOpacity;if(Nxe[A]=R,DOe(S.layer)&&p>=d.length&&(p=A),rV(S)){Fxe[A]=S.layer.blendMode;let I=S.layer.blendMode!=="normal";if(zR(S.layer.parent)){const N=xse(S.layer.parent);M(N)&&N!==""&&(I=Rze(S.layer.parent)||I)}I&&(u=I,l=!1)}if(E===0&&!u){d[A].pendingUpdates&=~(fr.TEXTURE_NOFADING&fr.TEXTURE_FADING);continue}++o;const O=kX(e,A);if(O){if(d[A].pendingUpdates&=~(fr.TEXTURE_NOFADING&fr.TEXTURE_FADING),zR(S.layer.parent)){const I=xse(S.layer.parent);M(I)&&I!==""&&Oze(S.layer.parent,A)}BL(S)?a=Math.max(a,this.tileSize*c):n===1&&R===1&&(S.isOpaque||this._dataToTexture(O)&&O.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++s}}this._rctx.type===lr.WEBGL1&&(a=mkt(a));const v=a/this.tileSize,b=A-1;this._ensureBackgroundTexture(this.tileSize),s!==0?s===1&&!u&&this._useLayerTexture(e,b,p,Nxe[b])||this._composeMapLayers(e,r,b,p,Lxe,Fxe,a,v,!l||u,aV,u):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){k(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=yh,this._passParameters.scale=1,this._passParameters.opacity=1,M(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,M(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,r){let i=H_.Immediate;(e.surface.view.layerViewManager.updating||r>0)&&(i=H_.Delayed);const n=e.renderData;this._backgroundTexture&&k(n.textureReference)&&(i=H_.Immediate),n.setTextureReference(M(this._backgroundTexture)?new NX(this._backgroundTexture,sa.FADING,kxe,e.surface.baseOpacity,0,1):null,i)}_useLayerTexture(e,r,i,n){const s=r<i,o=s?1:e.surface.baseOpacity,a=s?e.surface.baseOpacity:1,l=kX(e,r);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new NX(l.sourceLayerInfo.data,sa.FADING,l,o,a,n)),!0)}_composeMapLayers(e,r,i,n,s,o,a,l,c,u,d){this._composition.ensureBuffer(a);const p=e.surface.baseOpacity;let A=!1,v=zt.LINEAR_MIPMAP_LINEAR,b=!1,S=0;for(let O=i;O>=0;O--){const I=kX(e,O);if(!I||s[O]===0&&!d)continue;const N=O<n&&p<1&&!A;this._passParameters.baseOpacity=N?p:1;const L=this._passParameters.baseOpacity<1?ym.Required:ym.NotRequired;N&&(A=!0);let B=!1;u.forEach(X=>{X.start===O&&(D3.push(X),this._composition.openGroup(a),B=!0)});const U=S===0,q=B?Sa.GroupBackgroundComposite:c&&U?this.backgroundIsGrid?Sa.GridComposite:Sa.ColorComposite:Sa.Composite,Z=_se[o[O]];for(m8t(I)?(this._passParameters.opacity=s[O],b=this._composition.drawVectorData(this._passParameters,q,a,Z,L,I,l,this.tileSize,b)):f8t(I)?(this._passParameters.opacity=s[O],this._composition.drawImageryTileData(this._passParameters,q,a,Z,L,I),this._hasNearestInterpolation(I)&&(v=zt.NEAREST)):this._dataToTexture(I)&&(this._passParameters.texture=I.sourceLayerInfo.data.texture,this._passParameters.offset=I.offset,this._passParameters.scale=I.scale,this._passParameters.opacity=s[O],this._composition.drawRasterData(this._passParameters,q,a,Z,L));D3.length>0&&D3[D3.length-1].end===O;){const X=D3.pop();this._passParameters.opacity=X.opacity,this._passParameters.offset=yh,this._passParameters.scale=1;const ee=c&&U?this.backgroundIsGrid?Sa.GridComposite:Sa.ColorComposite:Sa.Composite;this._composition.drawGroup(this._passParameters,ee,a,_se[X.blendMode],L)}S++}const E=e.renderData,R=E.ensureTexture(a,()=>this._buildTexture(a,v));this._composition.copyFBOToTexture(R),this._composition.unbind(),E.setTextureReference(new NX(R,r,kxe,A?1:p,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(A8t(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data),e.tile.setMemoryDirty()}return g8t(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r=zt.LINEAR_MIPMAP_LINEAR){if(k(e))return null;const i={target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:r,maxAnisotropy:this._maxAnisotropy,preMultiplyAlpha:!0,flipped:!0,hasMipmap:!0},n=this._rctx;let s;if(typeof e=="number")i.width=i.height=e,s=new WC(new Xt(n,i));else if(e instanceof bH)i.isOpaque=e.isOpaque,s=new WC(new Xt(n,i,e.image)),e.release();else try{i.width=e.width,i.height=e.height,s=new WC(new Xt(n,i,e))}catch{s=new WC(XFe(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=n.bindTexture(s.texture,Xt.TEXTURE_UNIT_FOR_UPDATES);return s.generateMipmap(),n.bindTexture(o,Xt.TEXTURE_UNIT_FOR_UPDATES),s}get test(){return{backgroundTexture:this._backgroundTexture}}};function mkt(t){const e=VR(t),r=e*e,i=t*t;if(r===i)return t;const n=e/2;return r-i<i-n*n?e:n}function kX(t,e){Id.layerIndex=e;const r=t.layerInfo[di.MAP][e];if(M(r.data))return ti(Id.offset,0,0),Id.tile=t,Id.scale=1,Id.sourceLod=t.lij,Id.sourceLayerInfo=r,Id;const i=r.upsampleInfo;if(M(i)){const n=i.tile.layerInfo[di.MAP][e];return Id.tile=i.tile,$a(Id.offset,i.offset),Id.scale=i.scale,Id.sourceLod=i.tile.lij,Id.sourceLayerInfo=n,Id}return null}function xse(t){return t.get("uid")}function Rze(t){let e=t.blendMode!=="normal";return zR(t.parent)&&(e=Rze(t.parent)||e),e}function Oze(t,e){zR(t.parent)&&Oze(t.parent,e);const r=xse(t);if(M(r)&&r!==""){const i=aV.get(r);i?i.start=e:aV.set(r,new pkt(e,e,t.blendMode,t.opacity))}}const Lxe=new Array,Nxe=new Array,Fxe=new Array,aV=new Map,D3=new Array,Id={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},kxe={offset:[0,0],scale:1},Pze=200,UX=40,gkt=.8,Akt=10,z4=1e-6;function ykt(t,e,r){const i=e,n=r;let s=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(n[a]<=z4)return!1;const c=(l-i[a])/n[a];s=Math.max(s,c)}else if(n[a]<=-z4){const c=(l-i[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}{const l=t[a+3];if(i[a]>l){if(n[a]>=-z4)return!1;const c=(l-i[a])/n[a];s=Math.max(s,c)}else if(n[a]>=z4){const c=(l-i[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}}return!0}let Uxe=class{constructor(e,r,i,n,s){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=n,this.rightStartIndex=s}},ype=class Tse{constructor(e,r,i,n){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positionAttribute=n,this._rayDirection=G(),this.bspNodeTree=new Array;const s=i-r,o=s<=Ize?new Uint16Array(s):new Uint32Array(s);this.indices=o;for(let a=0;a<s;++a)o[a]=a;{const a=xkt(e,r,i,n.data,n.stride),l=He(Math.log2(s/UX),2,Akt),c=(u,d,p)=>{const A=bkt(o,a,u,d),v=d-u;if(v<=UX){const I=new Uxe(A,void 0,0,u,d);return this.bspNodeTree.push(I),I}const{axis:b,midValue:S}=wkt(A),E=vkt(o,a,u,d,b,S),R=(I,N)=>{if(p>l)return;const L=N-I;return L<UX||L>=gkt*v?void 0:c(I,N,p+1)},O=new Uxe(A,b,S,E.next,E.mid);return this.bspNodeTree.push(O),O.leftNode=R(u,E.next),O.rightNode=R(E.mid,d),O};c(0,s,0),this.triangleVertexIndices=Tkt(o,e,r,i)}}intersectRayTriangleRange(e,r){{if(e>=r)return;const i=this.triangleVertexIndices,n=this.positionAttribute.data,s=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],u=this._rayDirection,d=u[0],p=u[1],A=u[2];for(let v=e,b=3*e;v<r;++v){let S=i[b++]*s;const E=n[S++],R=n[S++],O=n[S];S=i[b++]*s;const I=n[S++],N=n[S++],L=n[S];S=i[b++]*s;const B=I-E,U=N-R,q=L-O,Z=n[S++]-E,X=n[S++]-R,ee=n[S]-O,se=p*ee-X*A,ue=A*Z-ee*d,re=d*X-Z*p,te=B*se+U*ue+q*re;if(Math.abs(te)<=Number.EPSILON)continue;const j=a-E,H=l-R,W=c-O,oe=j*se+H*ue+W*re;if(te>0){if(oe<0||oe>te)continue}else if(oe>0||oe<te)continue;const le=H*q-U*W,fe=W*B-q*j,de=j*U-B*H,Ee=d*le+p*fe+A*de;if(te>0){if(Ee<0||oe+Ee>te)continue}else if(Ee>0||oe+Ee<te)continue;const Ie=(Z*le+X*fe+ee*de)/te;if(Ie>=0){const Ge=this.indices[v]+this.firstTriangleIndex,Ke=cde(B,U,q,Z,X,ee,_kt);this._callback(Ie,Ke,Ge,!1)}}}Tse.numFacesTested+=r-e}intersectRay(e,r){Tse.numFacesTested=0;const i=pt(e.r0[0],e.r0[1],e.r0[2]),n=pt(e.r1[0],e.r1[1],e.r1[2]),s=n[0]-i[0],o=n[1]-i[1],a=n[2]-i[2];if(s*s+o*o+a*a<z4)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=s,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const u=this.bspNodeTree[0];this.intersectRayBSP(u,0,c)}intersectRayBSP(e,r,i){const n=this._rayOrigin,s=this._rayDirection;if(!ykt(e.aabb,n,s))return;const o=e.axis,a=e.d;if(n[o]<a||s[o]<0){const l=r,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),n[o]>a||s[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};ype.numFacesTested=0;const _kt=G(),L3=[1/0,1/0,1/0],N3=[-1/0,-1/0,-1/0];function vkt(t,e,r,i,n,s){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+n+3]<=s?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+n]>=s?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function bkt(t,e,r,i){if(i<=r)return MS(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[r];for(let s=0;s<3;++s)L3[s]=e[n+0+s],N3[s]=e[n+3+s]}for(let n=r+1;n<i;++n){const s=6*t[n];for(let o=0;o<3;++o)L3[o]=Math.min(L3[o],e[s+0+o]),N3[o]=Math.max(N3[o],e[s+3+o])}return MS(L3[0],L3[1],L3[2],N3[0],N3[1],N3[2])}function wkt(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],n=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:n,midValue:(t[n]+t[n+3])/2}}function xkt(t,e,r,i,n){const s=r-e,o=new Float32Array(6*s);for(let a=0;a<s;++a){const l=3*(a+e),c=t[l+0]*n,u=t[l+1]*n,d=t[l+2]*n;for(let p=0;p<3;++p){const A=i[c+p],v=i[u+p],b=i[d+p];o[6*a+p]=Math.min(A,v,b),o[6*a+3+p]=Math.max(A,v,b)}}return o}function Tkt(t,e,r,i){const n=i-r;let s=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)s=Math.max(e[3*a+l],s);const o=s<=Ize?new Uint16Array(3*n):new Uint32Array(3*n);for(let a=0;a<n;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const u=e[l+c];o[3*a+c]=u}}return o}const Ize=65535;let Ps=class extends Xa{constructor(){super(...arguments),this.output=ne.Color,this.overlayMode=W_.Disabled,this.tileBlendInput=fA.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.shading=!tn.TERRAIN_USE_LEGACY_SHADING,this.useLegacyTerrainShading=tn.TERRAIN_USE_LEGACY_SHADING,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=Jt.Terrain}};h([ae({count:ne.COUNT})],Ps.prototype,"output",void 0),h([ae({count:W_.COUNT})],Ps.prototype,"overlayMode",void 0),h([ae({count:fA.COUNT})],Ps.prototype,"tileBlendInput",void 0),h([ae()],Ps.prototype,"spherical",void 0),h([ae()],Ps.prototype,"doublePrecisionRequiresObfuscation",void 0),h([ae()],Ps.prototype,"atmosphere",void 0),h([ae()],Ps.prototype,"receiveShadows",void 0),h([ae()],Ps.prototype,"hasSlicePlane",void 0),h([ae()],Ps.prototype,"backfaceCullingEnabled",void 0),h([ae()],Ps.prototype,"stencilEnabled",void 0),h([ae()],Ps.prototype,"textureFadingEnabled",void 0),h([ae()],Ps.prototype,"renderOccluded",void 0),h([ae()],Ps.prototype,"hasScreenSpaceReflections",void 0),h([ae()],Ps.prototype,"hasCloudsReflections",void 0),h([ae()],Ps.prototype,"shading",void 0),h([ae()],Ps.prototype,"useLegacyTerrainShading",void 0),h([ae()],Ps.prototype,"invisible",void 0),h([ae()],Ps.prototype,"tileBorders",void 0),h([ae()],Ps.prototype,"visualizeNormals",void 0),h([ae()],Ps.prototype,"screenSizePerspective",void 0),h([ae()],Ps.prototype,"receiveAmbientOcclusion",void 0),h([ae({count:Jt.COUNT})],Ps.prototype,"pbrMode",void 0),h([ae({constValue:An.CompressedAttribute})],Ps.prototype,"normalType",void 0),h([ae({constValue:wo.Compressed})],Ps.prototype,"textureCoordinateType",void 0),h([ae({constValue:!1})],Ps.prototype,"highStepCount",void 0),h([ae({constValue:!1})],Ps.prototype,"useCustomDTRExponentForWater",void 0),h([ae({constValue:!1})],Ps.prototype,"useFillLights",void 0);const BX=7,Skt=10,zX=fa();var wa;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(wa||(wa={}));let Fh=class extends rt{get _isGlobal(){return this._stage.viewingMode===wt.Global}get shading(){return this._techniqueConfiguration.shading}set shading(e){this._techniqueConfiguration.shading=e}constructor(e){super(e),this.type=ws.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Ps,this._passParameters=new oze,this._rctx=null,this._renderDataPool=new Sl(y7t),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new ZBe,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=wa.Opaque,this._velvetOverground=!0,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Ds.Occlude}initialize(){const e=[nt.OPAQUE_TERRAIN,nt.TRANSPARENT_TERRAIN,nt.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),g9t()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===wa.TransparentWithDraped||e===wa.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return Rb}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?Qz:Ds.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,M(this._tileRenderer)&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,fr.TEXTURE_FADING)}updateTileTexture(e,r){M(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(e,r===fr.TEXTURE_FADING?sa.FADING:sa.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[di.ELEVATION])i.pendingUpdates&=~fr.GEOMETRY;e.resetPendingUpdate(fr.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=Skt-BX,i=Math.max(0,Math.floor((e.level-r)/BX)*BX);if(this._isGlobal&&i===0)return Ec;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=so.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=so.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=so.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new fkt(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=XFe(this._rctx)}uninitializeRenderContext(){this._emptyTex=kt(this._emptyTex),this._tileRenderer=kt(this._tileRenderer)}intersect(e,r,i,n){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==wa.Opaque)return;const s=Ekt,o=Ckt;Ve(s,n,i),Le(o,1/s[0],1/s[1],1/s[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===Ol.MIN,d=!!e.results.ground.target,p=i3t(e.verticalOffset),A=e.tolerance;let v,b=u&&M(a.dist)?a.dist:1/0;const S=R=>{const O=R.renderData;if(!(O!=null&&O.vao))return;const I=O.geometryInfo;FG(zX,I.boundingBox);const N=O.localOrigin;M(p)&&(p.localOrigin=N,p.applyToAabb(zX));const L=zX;if(F3[0]=i[0]-N[0],F3[1]=i[1]-N[1],F3[2]=i[2]-N[2],!hde(L,F3,o,A,b))return;const B=(re,te,j)=>{re.set(this.type,R,te,j,wp),b=u&&M(a.dist)?a.dist:1/0},U=(re,te)=>{if(M(te)&&re>=0&&(e.options.backfacesTerrain||Qe(te,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,n,re))){if((c.dist==null||re<c.dist)&&B(c,re,te),e.options.isFiltered)return;e.options.store===Ol.ALL&&(k(v)?(v=Uhe(e.ray),B(v,re,te),e.results.all.push(v)):re<v.dist&&B(v,re,te)),(a.dist==null||re<a.dist)&&B(a,re,te),e.options.store!==Ol.MIN&&(l.dist==null||re>l.dist)&&B(l,re,te)}},q=Mkt;Ve(q,n,N);const Z=I.indices,X=I.vertexAttributes,ee=X.getField(z.POSITION,Wn),se=new Pt(ee.typedBuffer,3,!1,X.stride/4),ue=I.indexCount/3;if(k(p)&&ue>Pze){const re=R.renderData;k(re.intersectionData)&&(re.intersectionData=new ype(Z,0,ue,se)),re.intersectionData.intersectRay({r0:F3,r1:q},U)}else sF(F3,q,0,ue,Z,se,null,p,U)},E=this._rootTiles;M(E)&&(()=>{const R=this._tileIterator;R.reset(E);const O=e.options.invisibleTerrain;for(let I=R.next();I;I=R.next())!(I.visible||O&&I.intersectsClippingArea)||!M(p)&&!I.intersectsRay(i,s,A,b)||d&&this._useStencilForTile(I)?R.skipSubtree():S(I)})()}processScaleRangeQueries(e,r){var i;if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const n of this._patchGroups.values())for(const s of n)M((i=s.renderData)==null?void 0:i.textureReference)&&e.queriesForTile(s);e.process(),r.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===nt.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&Qz))return null}else{const r=this.transparency===wa.Opaque?nt.OPAQUE_TERRAIN:nt.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}switch(e.output){case ne.Color:return this.transparency===wa.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=M(e.bindParameters.cloudsFade.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?W_.Disabled:this._overlayRenderer.hasWater?W_.EnabledWithWater:W_.Enabled,this._updateTechnique(ne.Color,e.bindParameters.slot===nt.OCCLUDED_TERRAIN));case ne.Shadow:case ne.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(ne.Shadow,!1)):null;case ne.Depth:return this.transparency===wa.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(ne.Depth,!1));case ne.Normal:return this.transparency===wa.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(ne.Normal,!1));case ne.ObjectAndLayerIdColor:return this.transparency===wa.Empty?null:this._updateTechnique(ne.ObjectAndLayerIdColor,!1);case ne.Highlight:return this.transparency!==wa.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(ne.Highlight,!1)):null}return null}render(e,r){const i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case ne.Color:{const n=e.bindParameters.slot===nt.OCCLUDED_TERRAIN?ih.Occluded:ih.ColorAndWater;this.transparency===wa.Opaque?this._renderMaterialPass(e,r,n):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,r,n),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case ne.Depth:case ne.Normal:this._renderAuxiliaryPass(e,r,ih.None);break;case ne.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,r,ih.Highlight);break;case ne.Shadow:case ne.ShadowExcludeHighlight:this._castShadows&&i&&this._renderAuxiliaryPass(e,r,ih.None);break;case ne.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,ih.ObjectAndLayerIdColor)}}_renderMaterialPass(e,r,i){const{rctx:n}=e;this._passParameters.overlaySource=i,n.bindTechnique(r,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,r,i)}_renderAuxiliaryPass(e,r,i){const n=e.rctx;this._passParameters.overlaySource=i,n.bindTechnique(r,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,r,i)}updateTileBackground(e=null){if(k(this._tileRenderer))return;const r=this._tileRenderer;let i=null;if(M(e)){const n=$t.toUnitRGBA(e);i=pt(n[0]||0,n[1]||0,n[2]||0)}r.setBackground(i),this._allTiles.forAll(n=>r.updateTileTexture(n,sa.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?fA.GridComposite:M(r.backgroundColor)?fA.ColorComposite:fA.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==RO.NONE){const e=Array.from(this._patchGroups.values()),r=this._stencilEnabledLayerExtents;for(const i of e)JBe(this.renderOrder,i,r);e.sort((i,n)=>KBe(i[0],n[0],this.renderOrder)),this._patchGroups=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var r;const e=this._rootTiles;if(!k(e)){(r=e[0])==null||r.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),n=i.renderData;if(!n){this._numTilesCulled++;continue}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}const s=n.localOrigin;let o=this._patchGroups.get(s);o||(o=new Array,this._patchGroups.set(s,o)),o.push(i),(!this._highestVisibleLODTile||i.vlevel>this._highestVisibleLODTile.vlevel)&&(this._highestVisibleLODTile=i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderPatchGroupsAuxiliary(e,r,i){const n=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const o=s[0].renderData.localOrigin;r.program.bindDraw(new Yne(o),e.bindParameters,this._passParameters);for(let a=0;a<s.length;a++)this._renderPatch(e,r,s[a],wr.TRIANGLES,n,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,r,i){const n=e.bindParameters.camera,s=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const d=I9e(this._stage.viewingMode,this._ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;d.update({distance:p,fovY:n.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===ih.Occluded;a&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",Ec),s.setUniform4fv("texOffsetAndScale",vA));const l=M(this._tileRenderer)&&M(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:Ec;this._techniqueConfiguration.tileBlendInput===fA.ColorComposite&&s.setUniform3fv("backgroundColor",l);const c=this.wireframe?wr.LINES:wr.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);const u=this._patchGroups;for(const d of u.values()){const p=d[0].renderData.localOrigin;r.program.bindDraw(new Yne(p),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const A of d){const v=A.renderData,b=v.textureReference;if(!k(b)){if(!a){s.setUniform4fv("texOffsetAndScale",b.offsetAndScale),s.bindTexture("tex",b.texture.texture);const S=v.textureFadeFactor,E=S<1?v.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&M(E)&&S<1?(s.setUniform1f("fadeFactor",S),s.setUniform4fv("nextTexOffsetAndScale",E.offsetAndScale),s.setUniform3fv("nextTexOpacities",E.opacities),s.bindTexture("texNext",E.texture.texture)):s.setUniform1f("fadeFactor",1),v.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",b.opacities)}this._renderPatch(e,r,A,c,o,i),A.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,n,s,o){const a=i.renderData,l=a.vao,c=l.indexBuffer;if(k(c))return void(ha&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const u=r.program;o===ih.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),s&&(r.useStencil=this._useStencilForTile(i),r.bindPipelineState(e.rctx,e.bindParameters.slot));const d=a.geometryInfo.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(n,d,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,e===ne.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=r,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(aze,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};h([f({constructOnly:!0})],Fh.prototype,"_overlayRenderer",void 0),h([f({constructOnly:!0})],Fh.prototype,"_stage",void 0),h([f({readOnly:!0})],Fh.prototype,"_isGlobal",null),h([f({constructOnly:!0})],Fh.prototype,"_allTiles",void 0),h([f({constructOnly:!0})],Fh.prototype,"_ellipsoidRadius",void 0),h([f({value:!1})],Fh.prototype,"renderingDisabled",null),h([f()],Fh.prototype,"renderPatchBorders",null),h([f()],Fh.prototype,"visualizeNormals",null),h([f()],Fh.prototype,"cullBackFaces",null),h([f({value:RO.FRONT_TO_BACK})],Fh.prototype,"renderOrder",null),h([f()],Fh.prototype,"wireframe",null),Fh=h([Q("esri.views.3d.terrain.TerrainRenderer")],Fh);const Ekt=G(),Ckt=G(),F3=G(),Mkt=G();let Rkt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},zg=class extends rt{constructor(e){super(e),this._handles=new cn}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(xe(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=yt(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!_5(r)||r.isRejected())&&!(r.isFulfilled()&&!Okt(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!((r==null?void 0:r.type)==="vector-tile"||tV(r)))),e)if(e.isResolved()){const r=xH(e,this.viewSpatialReference,this.viewingMode);if(M(r)){const i=new Kh(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===wt.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=Kh.makeWebMercatorAuxiliarySphere(r):IS(e.spatialReference)&&(e=Kh.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(xe(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===wt.Global){const e=this.extentHelper.viewSpatialReference,r=IS(e)||XA(e)||ZA(e);e.isWebMercator?this.tilingScheme=Kh.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=Kh.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;M(e)&&!XT(e,this.extent)&&(this.tilingScheme=Kh.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function Okt(t,e,r){return M(xH(t,e,r))}h([f()],zg.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],zg.prototype,"extent",void 0),h([f({value:!1})],zg.prototype,"tilingSchemeLocked",void 0),h([f({constructOnly:!0})],zg.prototype,"viewSpatialReference",void 0),h([f({constructOnly:!0})],zg.prototype,"layers",void 0),h([f({constructOnly:!0})],zg.prototype,"extentHelper",void 0),h([f({constructOnly:!0})],zg.prototype,"viewingMode",void 0),zg=h([Q("esri.views.3d.terrain.TilingSchemeLogic")],zg);let Pkt=class{constructor(){this.offset=Ft(),this.scale=0,this.tile=null}init(e,r,i,n){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=n}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},jr=class extends Ws.EventedMixin(rt){constructor(e){var r,i;super(e),this._scaleRangeQueries=new fU,this._iteratorPool=new Sl(ZBe,n=>n.remove=()=>this._iteratorPool.release(n)),this._postorderIterator=new w9t,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new Rkt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=G(),this._eyePosSurfaceSR=G(),this._splitLimits=new V7t,this._frustum=_L(),this._viewProjectionMatrix=ht(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new cn,this._watchUpdatingTracking=new _A,this._frameTask=hO,this._allTiles=new Vr,this._upsampleInfoPool=new Sl(Pkt),this._rootTilesExtent=oi(),this.updatingProgress=0,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=St.WebMercator,this.visibleElevationBounds=new DM(1/0,-1/0),this.rootTileElevationBounds=new DM(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this._shading=!0,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this._isGlobal=!((i=(r=e.view)==null?void 0:r.state)!=null&&i.isLocal)}initialize(){this._lercDecoder=q8t(this.view.resourceController),this._tilePool=this.view.state.isLocal?new Sl(k7t):new Sl(B7t);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",o=>o.unloadMapData()),this._elevationQueryCache=new j8t(e.newCache("elevation-query")),this._set("overlayManager",new Qu({surface:this})),this._handles.add([xe(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),xe(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),xe(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new Fh({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:ln(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([xe(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?sa.UNFADED:sa.IMMEDIATE)},vo),xe(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?sa.UNFADED:sa.IMMEDIATE),vo),xe(()=>this.renderingDisabled,()=>{var o,a;return(a=(o=this.view)==null?void 0:o._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},fn),xe(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},vo),xe(()=>this.snapLevel,()=>this._viewChanged=!0,fn),xe(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),xe(()=>tn.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?be(()=>import("./TerrainTileTree3DDebugger-1020c515.js"),["assets/TerrainTileTree3DDebugger-1020c515.js","assets/TileTreeDebugger-85d501fa.js"]).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&tn.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=yt(this._treeDebugger))},Rr)]);const{spatialReference:r}=this.view;this._extentHelper=l9t(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:r});const i=new BD({getCollections:()=>{var o,a,l;return(l=(a=(o=this.view)==null?void 0:o.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:l.map(({layers:c})=>c)},getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),n=new zg({layers:i,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:r});this._set("tilingSchemeLogic",n),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(oA.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(oA.BASEMAP);const s=this.view.resourceController.scheduler;this._frameTask=s.registerTask(ar.TERRAIN_SURFACE,this),this._handles.add([xe(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),Rr),xe(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),fn),xe(()=>this.extent,()=>this._updateRootTiles(),Rr),this.view.on("resize",()=>this._viewChangeUpdate()),xe(()=>{var l,c;const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,(c=(l=o.resourceController)==null?void 0:l.memoryController)==null?void 0:c.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),vo),xe(()=>{var o,a;return(a=(o=this.view.qualitySettings)==null?void 0:o.tiledSurface)==null?void 0:a.textureFadeDuration},o=>this._renderer.textureFadingEnabled=o>0,Rr),xe(()=>{var o;return(o=this.view.qualitySettings)==null?void 0:o.physicallyBasedRenderingEnabled},o=>this._renderer.pbrMode=o?Jt.Terrain:Jt.Disabled,Rr),xe(()=>this._userClippingExtent,()=>this._updateClippingExtent(),fn)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._handles.add([xe(()=>{var o;return(o=this.view)==null?void 0:o.map.ground.shading},()=>{this._updateShadingIfChanged()})]),this._updateShading(),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=us(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=yt(this._upsampleMapCache),this._elevationQueryCache=yt(this._elevationQueryCache);const e=this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",yt(this.tilingSchemeLogic)),e.destroy(),this._basemapLayerViewHandles.forEach((r,i)=>this._unregisterTiledLayerView(i)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",yt(this.overlayManager)),this._tilePool=yt(this._tilePool),upe.prune(),this._treeDebugger=yt(this._treeDebugger),this._renderer=yt(this._renderer),this._iteratorPool=yt(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=yt(this._upsampleInfoPool),i9t(),Z9t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,r;if(this.lodSnapping===X5.ON){const i=this.view,n=this.tilingScheme,s=(r=(e=i.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:r.scale;if(s&&n){const o=i.state.contentCamera;let a=Zj(i,o.eye,o.viewForward,o.up).tilt;a>90&&(a=180-a);const l=2*(a/90)**2,c=n.levelAtScale(s)-l;return Math.round(c)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?X5.ON:X5.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:r}=this.view;if(k(r)||k(e))return null;const i=oi(),n=IBe(r,i,e)?i:null,s=this._get("extent");return XT(n,s)?s:n}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=pee(this.groundExtent,this._userClippingExtent,oi()),r=this._get("extent");return XT(e,r)?r:e}get groundExtent(){return M(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view.map.ground.opacity}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return M(this._rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e;return((e=this.tilingScheme)==null?void 0:e.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e;return((e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)??!1}set velvetOverground(e){this._renderer.velvetOverground=e,this._set("velvetOverground",e)}get wireframe(){return this._renderer.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===wa.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,r,i,n){this._renderer.intersect(e,r,i,n)}getElevation(e,r,i,n){const s=this._rootTiles;if(k(s)||!s.length||s[0].layerInfo[di.ELEVATION].length===0)return null;const o=ku;return o[0]=e,o[1]=r,o[2]=i,il(o,n,o,this._spatialReference)?zxe(s,o[0],o[1]):(we.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,r,i){const n=this._rootTiles,s=n?n[0].layerInfo[di.ELEVATION].length:0;if(!k(n)&&n.length&&s!==0)for(let o=0;o<r;++o){const a=3*o;i(o,zxe(n,e[a+0],e[a+1]))}else for(let o=0;o<r;++o)i(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!nc(e,ku,this.spatialReference))return we.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const r=this._rootTiles;if(M(r)){for(const i of r)if(i!=null&&i.containsPoint(ku)){let n=i;for(;n.children[0]&&!n.rendered;){const s=n.children[0].extent;let o=0;ku[0]>s[2]&&(o+=1),ku[1]<s[1]&&(o+=2),n=n.children[o]}return this._getLodBiasCorrectedScale(n.level)}}return 1/0}getSphereElevationBounds(e,r,i,n,s){var u;if(ku[0]=e,ku[1]=r,ku[2]=i,ku[3]=n,!il(ku,s,ku,(u=this.tilingScheme)==null?void 0:u.spatialReference))return we.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let o=1/0,a=-1/0;const l=d=>{if(d&&bge(d.extent,ku))if(d.isLeaf||d.rendered)o=Math.min(o,d.elevationBounds[0]),a=Math.max(a,d.elevationBounds[1]);else for(const p of d.children)l(p)},c=this._rootTiles;if(M(c))for(const d of c)l(d);return{min:o,max:a}}getSphereScale(e,r){if(!this.tilingScheme)return null;if(!nc(e,ku,this.spatialReference))return we.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;ku[3]=r;let i=null;const n=o=>{if(o&&bge(o.extent,ku)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)n(l);else{const l=this._getLodBiasCorrectedScale(o.level);i=i==null?l:Math.min(i,l)}}},s=this._rootTiles;if(M(s))for(const o of s)n(o);return i}queryVisibleScaleRange(e,r,i,n){const s=r?this.tilingScheme.levelAtScale(r):0,o=i?this.tilingScheme.levelAtScale(i):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,s+a,o+a,n)}_evaluateTransparency(){var o,a;const e=this.baseOpacity,r=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,n=this._allSurfaceLayersTransparent()?r?wa.Empty:wa.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?wa.Opaque:wa.Semitransparent,s=i!==n;return s&&(this._renderer.transparency=n,(a=(o=this.view)==null?void 0:o._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var i,n,s;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;Kg(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((n=(i=this.view)==null?void 0:i.state)!=null&&n.isLocal),this.tilingScheme&&this._removeAllTiles();const r=(e==null?void 0:e.spatialReference)??St.WebMercator;this._spatialReference=r,this._isWebMercator=!!(r!=null&&r.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&fle((s=this.view)==null?void 0:s.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,r,i,n){const s=this._tilePool.acquire();return I9[0]=e,I9[1]=r,I9[2]=i,s.init(I9,n,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:r}=this;if(!r)return;const i=Dkt;let n=r.rootTilesInExtent(e,i,5*wM);if(M(this._rootTiles)){if(n.length>wM)return void we.getLogger(this.declaredClass).warn(kbt);const s=this._rootTiles.map(a=>a.lij),o=BJe(s,n,Bxe);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>Bxe(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,n.length>wM&&(we.getLogger(this.declaredClass).warn(Ubt),n=r.rootTilesInExtent(e,i,wM)),this._setRootTiles(n.map(s=>this._newRootTile(s)));XT(i,this._rootTilesExtent)||(this._rootTilesExtent=oi(i)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(r=>r.isLoaded&&r.intersectsClippingArea);e.forEach(r=>this._renderer.updateTileGeometryState(r)),e.forEach(r=>r.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(q_);const r=this.renderer;e.forEach(i=>r.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===fr.SPLIT}_newRootTile(e){const r=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(r)&&r.setPendingUpdate(fr.SPLIT),this._loadTile(r),this._markTileToUpdate(r),this._updateRootTileElevationBounds(),r}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),M(e)){const r=this._iteratorPool.acquire();for(r.reset(e);!r.done;)this._allTiles.push(r.next());r.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(fr.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(k(e))return;const r=R9t(e),i=this.visibleElevationBounds;let n=r?i.min:1/0,s=r?i.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(fr.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(fr.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(n=Math.min(c.elevationBounds[0],n),s=Math.max(c.elevationBounds[1],s))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(n)&&isFinite(s)&&(i.min!==n||i.max!==s)&&(this.visibleElevationBounds=new DM(n,s))}_updateRootTileElevationBounds(){let e=1/0,r=-1/0;const i=this._rootTiles;M(i)&&i.forEach(({elevationBounds:s})=>{e=Math.min(e,s[0]),r=Math.max(r,s[1])});const n=this.rootTileElevationBounds;n.min===e&&n.max===r||(this.rootTileElevationBounds=new DM(e,r))}_updateViewDependentParameters(){const{camera:e,contentCamera:r}=this.view.state,i=Math.tan(.5*r.fovX),n=Math.tan(.5*r.fovY),s=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=n,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(k(this._splitLimits.frustum)&&(this._splitLimits.frustum=_L()),mz(this._splitLimits.frustum,r.frustum)):this._splitLimits.frustum=null,mz(this._frustum,e.frustum),js(this._viewProjectionMatrix,r.projectionMatrix,r.viewMatrix),Pe(this._eyePosRenderSR,r.eye),il(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&($ze(e)?this._loadChildren(e):$kt(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const r=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}_updateTileTexture(e,r){const i=e.resetPendingUpdate(fr.TEXTURE_FADING)?fr.TEXTURE_FADING:!!e.resetPendingUpdate(fr.TEXTURE_NOFADING)&&fr.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,r.madeProgress())}_emitElevationUpdateEventForTiles(){const e=GX.extent;Yf(e),this._pendingTilesForElevationUpdateEvent.forEach(r=>h2(e,r.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),GX.spatialReference=this.spatialReference,this.emit("elevation-change",GX)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const r=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,r),this._updateElevation(e),this._updateTextures(e),r||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed?this.requestUpdate():this.getUsedMemory(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const r=this._iteratorPool.acquire();r.reset(this._rootTiles);const i=this.snapLevel,n=this._splitLimits,s=this._eyePosRenderSR;for(;!r.done;){const o=r.next(),a=o.shouldSplit(n,s,i);if(a!==fr.SPLIT){if(o.resetPendingUpdate(fr.SPLIT)&&o.updateAgentSuspension(),a===fr.VSPLITMERGE&&o.updateAgents(di.ELEVATION),r.skipSubtree(),!o.isLeaf){o.setPendingUpdate(fr.MERGE),o.resetPendingUpdate(fr.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let u=l.next();!l.done;u=l.next())this._updateClippingStatus(u),u.updateVisibility(),u.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(fr.MERGE),o.isLeaf&&(o.setPendingUpdate(fr.SPLIT),r.skipSubtree()),o.rendered&&o.setPendingUpdate(fr.RENDERDATA)}r.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(C9t(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){at(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const r=Array.from(this._pendingTilesToUpdate.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea),i=(s,o)=>{!(o!=null&&o.isLoaded)||!o.intersectsClippingArea||o.level<s.level||e.has(o)||(e.add(o),r.push(o),o.renderData.updateNeighborData())};r.sort(q_);const n=r.length;for(let s=0;s<n;++s){const o=r[s];at(o.isLoaded),at(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData;for(let u=0;u<4;++u)if(l&1<<u){const d=a.geometryState.neighborData.edgePeerNeighbors[u];d&&(d==null?void 0:d.level)>=o.level&&d.forAllSubtreeOnSide(iV(pA[u]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&(at(e.has(p)||q_(o,p)<0),i(o,p),!0)),i(o,c.cornerPeerNeighbors[u]),i(o,c.cornerPeerNeighbors[(u+1)%4])}}e.clear(),this._updateTilesGeometries(r),ha&&eV&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,r){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const n=this.view.state.fixedContentCamera;let s=!1;for(;!e.done;){s=!0;let o=!1;const a=!this._allTiles.some(l=>{var u;if(!i&&!n&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(fr.MERGE)){if(!r)return l.setPendingUpdate(fr.MERGE),e.done;for(;(u=c.parent)!=null&&u.resetPendingUpdate(fr.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(fr.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(fr.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!i){i=!0;continue}if(!o)break}else this._allTilesDirty=!0}s?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(r=>(r.resetPendingUpdate(fr.GEOMETRY)&&(this._updateTileGeometryState(r),this._updateTileTexture(r,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(r=>(this._updateTileTexture(r,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(so.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*Nbt}_getLodBiasCorrectedScale(e){const r=this.tilingScheme.levels,i=He(e-this._lodBias,0,r.length-1),n=i-Math.floor(i);return r[Math.floor(i)].scale*(1-n)+r[Math.ceil(i)].scale*n}_removeAllTiles(){M(this._rootTiles)&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let r=!1;for(let i=0;i<4;++i)r=this._purgeTile(e.children[i])||r;return e.unsetChildren(),r}_purgeTile(e){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),r}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){Kg(e.isLeaf,"tile that is already split should not be split again!");const r=e.level+1,i=2*e.lij[1],n=2*e.lij[2];e.setChildren(this._createTile(r,i,n,e),this._createTile(r,i,n+1,e),this._createTile(r,i+1,n,e),this._createTile(r,i+1,n+1,e)),e.setPendingUpdate(fr.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,r=e.level){$9.spatialReference=this.spatialReference,$9.extent=e.extent,$9.scale=this._getLodBiasCorrectedScale(r),this.emit("scale-change",$9)}_createTile(e,r,i,n){Kg(!!n,"_createTile sanity check");const s=this._acquireTile(e,r,i,n);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(fr.SPLIT),s}get shortBatches(){return this.view.state.mode!==Mi.IDLE}_mergeTile(e){Kg(!e.hasPendingUpdate(fr.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(Kg(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){Kg(e.rendered,"parent should be rendered"),this._unloadTile(e);const r=e.children;r.forEach(i=>this._loadTile(i)),r.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const r=e.parent;this._unloadChildren(r),this._loadTile(r),this._markTileToUpdate(r),this._emitTileScaleChange(r,r.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const r=e.children;if(r[0])for(let i=0;i<4;++i){const n=r[i];this._unloadChildren(n),this._unloadTile(n)}}_loadTile(e){e.load(),e.setPendingUpdate(fr.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,r,i){const n=new o9t(e.lij,e.extent,i);e.dataArrived(r,di.ELEVATION,n);const s=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(s);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=pu){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let r=!1;const i=new Set;let n=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),zL(s)||ZI(s))if(this._basemapLayerViewHandles.has(s.uid)&&!ZI(s)){const o=this._layerClassFromLayerView(s),a=this._getLayerIdxByUID(o,s.uid);M(a)&&((a<n||k(n))&&(r=!0),n=a)}else this._registerTiledLayerView(s),s.layer.loaded&&(r=!0);this._basemapLayerViewHandles.forEach((s,o)=>{i.has(o)||(this._unregisterTiledLayerView(o),r=!0)}),r&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var r,i;let e=((i=(r=this.view.map)==null?void 0:r.ground)==null?void 0:i.opacity)===0;for(const n of this.view.allLayerViews.items)if(pse(n)&&!DOe(n.layer)&&n.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((rV(e)||ZI(e))&&L9t(_se[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return dse(e)?di.ELEVATION:di.MAP}_registerTiledLayerView(e){const r=[];if((rV(e)||ZI(e))&&r.push(xe(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(sa.UNFADED)})),ZI(e))return;const i=this._layerClassFromLayerView(e);r.push(xe(()=>e.suspended,()=>this._updateTiledLayers())),r.push(xe(()=>e.fullOpacity,()=>this._updateTileTextures(sa.UNFADED))),r.push(xe(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.on("data-changed",()=>{const n=this._getLayerIdxByUID(i,e.uid);M(n)&&this._invalidateLayerData(n,i)}),this._basemapLayerViewHandles.set(e.uid,r)}_unregisterTiledLayerView(e){const r=this._basemapLayerViewHandles.get(e);if(r){for(let i=0;i<r.length;i++)r[i].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,r=[[],[]];let i=null;e.forEach(n=>{if(!n.layer||n.suspended||!zL(n)||!n.fullExtent)return;const s=this._layerClassFromLayerView(n);if(s===di.MAP){const o=n.displayLevelRange.maxLevel;o!==1/0&&(i===null||o>i)&&(i=o)}r[s].push(n)});for(const n of iT){const s=this._layerViews[n],o=r[n];o.reverse();const a=o.length;let l=s.length!==a;const c=new Array(a),u=new Array(s.length);this._layerIndexByUid[n].clear();for(let d=0;d<a;d++){const p=o[d].uid;this._layerIndexByUid[n].set(p,d);const A=s.indexOf(o[d]);c[d]=A,d!==A&&(l=!0),A>-1&&(u[A]=d)}if(l){const d=this._postorderIterator;for(d.reset(this._rootTiles);!d.done;)d.next().modifyLayers(u,c,n);this._layerViews[n]=o,this._restartAllAgents(n),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const r=this._postorderIterator;for(r.reset(this._rootTiles);!r.done;){const i=r.next();i.restartAgents(e),e===di.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,r){return this._layerViews[r][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(r=>{r.updateAgents(di.MAP),e===sa.IMMEDIATE?this.renderer.updateTileTexture(r,fr.TEXTURE_NOFADING):r.updateRenderData(di.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,r){this._allTiles.forAll(i=>i.removeLayerAgent(e,r)),this._allTiles.forAll(i=>i.invalidateLayerData(e,r))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=so.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,r,i,n){const s=this.layerViewByIndex(r,i),o=s.layer;return!o.tilemapCache||BL(s)?this._requestTileData(e,i,s,n):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...n,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,fi(n),$o(a)||this._dataMissing(e,i,s,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,n),n.signal)))}_requestTileData(e,r,i,n){return r===di.ELEVATION?dse(i)?this._requestElevationTileData(e,i,n):Promise.reject():pse(i)?this._requestMapTileData(e,i,n):Promise.reject()}_requestElevationTileData(e,r,i){++this._asyncWorkItems;const n=a=>{if(Ra(i))return;const l=this._layerIndexByUid[di.ELEVATION].get(r.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):we.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",di.ELEVATION,e.lij.toString())},s=a=>{$o(a)||(this._dataMissing(e,di.ELEVATION,r,a),this.requestUpdate())};if(nxe(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:dL,signal:i.signal}).then(a=>{if(!Ra(i))return this._frameTask.schedule(()=>n(a),i.signal,s);we.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const o=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:dL},i.signal)).then(a=>{a?n(new H8t(a)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,r,i){++this._asyncWorkItems;const n=(u,d)=>{--this._asyncWorkItems,gR(d),Ra(i)||(this._dataMissing(e,di.MAP,r,u),this.requestUpdate())},s=u=>d=>n(d,u),o=u=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Ra(i)?gR(u):this._mapTileDataArrived(e,r,u)},i.signal,s(u)).catch(s(u)),a=(u,d=null)=>this._frameTask.schedule(()=>n(u,d));if(BL(r)){const u=r.schemaHelper.getLevelRowColumn(e.lij);return r.fetchTile(u[0],u[1],u[2],i).then(o,a)}if(wH(r))return r.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(o,a);if(spe(r)&&nxe(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(u=>{if(Ra(i))return we.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(en());o(u)},a);let l=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);G1t(r.layer)&&r.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${r.layer.refreshTimestamp}`);const c=r.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,i).then(o,a)}_mapTileDataArrived(e,r,i){const n=this._getLayerIdxByUID(di.MAP,r.uid);M(n)?e.dataArrived(n,di.MAP,i):(gR(i),we.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,r){return this._layerIndexByUid[e].get(r)}_dataMissing(e,r,i,n){const s=this._getLayerIdxByUID(r,i.uid);M(s)?e.dataMissing(s,r,n):we.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(r=>{r.renderData&&this.overlayManager.setTileParameters(r)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(r=>{r.isLeaf&&e.numLeaves++;const i=r.level;r.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),r.visible&&(e.numVisible++,r.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(k(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),M(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,r)=>e+r.usedMemory,0):null}getUsedMemoryForLayerView(e){let r=0;const i=this._layerClassFromLayerView(e),n=this._getLayerIdxByUID(i,e.uid);return M(n)&&this._allTiles.forAll(s=>r+=s.getUsedMemoryForLayer(i,n)),r}getTile(e){if(k(e)||k(this._rootTiles))return null;const r=e.split("/").map(a=>+a);if(r[0]===0)return this._rootTiles.find(a=>a.lij[1]===r[1]&&a.lij[2]===r[2]);const i=2**r[0],n=Math.floor(r[1]/i),s=Math.floor(r[2]/i);let o;if(this._rootTiles.some(a=>a.lij[1]===n&&a.lij[2]===s&&(o=a,!0)),o){let a=1<<r[0]-1;for(;o.lij[0]<r[0];){let l=r[1]&a?2:0;if((r[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return Kg(o.lij[0]===r[0]&&o.lij[1]===r[1]&&o.lij[2]===r[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{M(e._rootTiles)&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){VX.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&VX.push(i)});const r=VX.toArray();return JBe(e.renderOrder,r),r},lockTilingScheme(r,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(r)}}}checkAllTilesWaterproofness(){if(!eV)return;const e=this._rootTiles;if(k(e))return;const r=o=>{var a,l,c;return((c=(l=(a=o==null?void 0:o.renderData)==null?void 0:a.geometryInfo)==null?void 0:l.indices)==null?void 0:c.length)>0},i=(o,a)=>{r(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},n=o=>{var a,l;if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometryInfo&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!((a=o.renderData)!=null&&a.geometryInfo)||(((l=o.renderData.geometryInfo.indices)==null?void 0:l.length)??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometryInfo),r(o)){o.checkGeometryWaterproofness();for(const c of o.children)i(c,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const c of o.children)n(c)},s=o=>{var u;const a=((u=o.parent)==null?void 0:u.visible)??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const d of o.children)s(d)};for(const o of e)n(o),s(o)}get isGlobal(){return this._isGlobal}get shading(){return this._shading}_updateShadingIfChanged(){var r,i,n;((n=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.ground)==null?void 0:n.shading)!==this._shading&&this._updateShading()}_updateShading(){var r,i,n;const e=(n=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.ground)==null?void 0:n.shading;this._shading=e,this.renderer&&(this.renderer.shading=e,this.renderer.setNeedsRender()),this._updateAllTileGeometries()}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(M(this.spatialReference)&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const r=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<r)return e;if(!this.isGlobal)return null;const n=(i+(i<0?r:0))%r;return[e[0],e[1],n]}enableInternalChecks(e){p8t(e)}enableWaterproofnessChecks(e){d8t(e)}};h([f()],jr.prototype,"_renderer",void 0),h([f({constructOnly:!0})],jr.prototype,"_scaleRangeQueries",void 0),h([f()],jr.prototype,"_hasPendingUpdates",void 0),h([f()],jr.prototype,"_asyncWorkItems",void 0),h([f()],jr.prototype,"_allTilesDirty",void 0),h([f()],jr.prototype,"_allTilesSorted",void 0),h([f()],jr.prototype,"_viewChanged",void 0),h([f({readOnly:!0})],jr.prototype,"_watchUpdatingTracking",void 0),h([f()],jr.prototype,"_frameTask",void 0),h([f({readOnly:!0})],jr.prototype,"snapLevel",null),h([f({readOnly:!0})],jr.prototype,"lodSnapping",null),h([f({constructOnly:!0})],jr.prototype,"view",void 0),h([f()],jr.prototype,"_userClippingExtent",null),h([f()],jr.prototype,"_rootTilesExtent",void 0),h([f({readOnly:!0})],jr.prototype,"extent",null),h([f({readOnly:!0})],jr.prototype,"groundExtent",null),h([f({readOnly:!0})],jr.prototype,"_tilingSchemeExtent",null),h([f({readOnly:!0})],jr.prototype,"updating",null),h([f({readOnly:!0})],jr.prototype,"running",null),h([f(n9t)],jr.prototype,"updatingProgress",void 0),h([f({readOnly:!0})],jr.prototype,"updatingProgressValue",null),h([f()],jr.prototype,"_maxNumUpdating",void 0),h([f()],jr.prototype,"baseOpacity",null),h([f()],jr.prototype,"hasCompositeBlendMode",void 0),h([f({readOnly:!0})],jr.prototype,"overlayManager",void 0),h([f({readOnly:!0})],jr.prototype,"viewingMode",null),h([f()],jr.prototype,"maxTextureScale",void 0),h([f({readOnly:!0})],jr.prototype,"ready",null),h([f({value:RO.FRONT_TO_BACK})],jr.prototype,"renderOrder",null),h([f({readOnly:!0})],jr.prototype,"rootTiles",null),h([f()],jr.prototype,"_rootTiles",void 0),h([f({readOnly:!0})],jr.prototype,"spatialReference",null),h([f({type:$t})],jr.prototype,"backgroundColor",null),h([f({value:!1})],jr.prototype,"slicePlaneEnabled",null),h([f({readOnly:!0})],jr.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],jr.prototype,"tilingSchemeLocked",null),h([f({readOnly:!0})],jr.prototype,"tilingSchemeLogic",void 0),h([f({value:!0})],jr.prototype,"velvetOverground",null),h([f()],jr.prototype,"wireframe",null),h([f({value:!1})],jr.prototype,"suspended",null),h([f()],jr.prototype,"textureFadeDuration",null),h([f()],jr.prototype,"visibleElevationBounds",void 0),h([f()],jr.prototype,"rootTileElevationBounds",void 0),h([f()],jr.prototype,"_layerViewsDirty",void 0),h([f()],jr.prototype,"renderPatchBorders",null),h([f()],jr.prototype,"visualizeNormals",null),h([f()],jr.prototype,"renderingDisabled",null),jr=h([Q("esri.views.3d.terrain.TerrainSurface")],jr);const Ikt=jr;function Bxe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function $ze(t){const e=t.children;if(!e[0])return!1;for(const r of e)if(r.shouldLoad)return!0;for(const r of e)if($ze(r))return!0;return!1}function $kt(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const ku=Kr(),Dkt=oi(),I9=[0,0,0],VX=new Vr,GX={spatialReference:null,extent:oi(),context:"ground"},$9={spatialReference:null,extent:null,scale:0};function zxe(t,e,r){var i;for(const n of t){if(!n.containsPointXY(e,r))continue;let s=n;for(;s&&!s.renderData;){const a=(e>s.extentMidX?1:0)+(r<s.extentMidY?2:0);s=s.children[a]}const o=((i=s==null?void 0:s.renderData)==null?void 0:i.geometryState.samplerData)??null;return hs(e,r,o)}return null}let Lkt=class{constructor(e,r,i){this.operation=e,this.geometry=r,this.states=i}},V4=class extends rt{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c},u)=>{let d=!1;if(l===$s.UPDATE){const p=o.get(u);if(p){if(c&Ta.TRANSFORMATION){const A=this.model.getObject(s);this.model.updateRenderGeometryTransformation(A,a,p)&&(d=!0)}d||r.updates.push({renderGeometry:p,updateType:c})}else tr(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===$s.REMOVE||d){const p=o.get(u);p?(r.removes.push(p),o.delete(u)):l===$s.REMOVE&&tr(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===$s.ADD||d){const p=this.model.getObject(s);if(M(p)){const A=this.model.getRenderGeometry(p,a);r.adds.push(A),o.set(u,A)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(n=>n.forEach(s=>r.push(s)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,$s.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Ta.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Ta.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Ta.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,$s.UPDATE,Ta.GEOMETRY)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const n of r.geometries)this._objectGeometryAdded(r,n,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const n of r.geometries)this._objectGeometryRemoved(r,n,i)}shaderTransformationChanged(e){const r=this._residentGeomRecords.get(e.id);r&&r.forEach((i,n)=>{const s=this.model.getObject(n);s&&s.hasVolativeTransformation()&&i.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(n=>{this._updateOrCreateDirtyRecord(e,n.geometry,r,$s.UPDATE,Ta.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,$s.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,$s.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,n,s=Ta.NONE){i=br(i,this._getParentLayerId(e));const o=e.id,a=r.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){const u=c.operation;u===$s.REMOVE&&n===$s.ADD&&c.states!==Ta.NONE?c.operation=$s.UPDATE:u===$s.REMOVE&&n===$s.ADD||u===$s.ADD&&n===$s.REMOVE?l.delete(a):u!==$s.UPDATE||n!==$s.REMOVE&&n!==$s.UPDATE?(tr((u===$s.REMOVE||u===$s.ADD)&&n===$s.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=s):(c.operation=n,c.states|=s)}else l.set(a,new Lkt(n,r,s));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let n=i.get(r);return n||(n=new Map,i.set(r,n)),n}get _hasDirtyGeometryRecords(){return Ql(this._dirtyGeomRecords,e=>Ql(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let n=i.get(r);return n||(n=new Map,i.set(r,n)),n}_getParentLayerId(e){return M(e.parentLayer)?e.parentLayer.id:NKe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,n)=>{i.forEach((s,o)=>{r.length>0&&(r+=`
`),r+=n+"."+o;const a=[];s.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,n)=>e.commitLayer(n,r))}}};h([f({constructOnly:!0})],V4.prototype,"model",void 0),h([f()],V4.prototype,"dirty",void 0),V4=h([Q("esri.views.3d.webgl-engine.lib.ModelDirtySet")],V4);const Nkt=V4;let AU=class extends rt{constructor(){super(...arguments),this.dirtySet=new Nkt({model:this}),this._content=new Map,this._originFactory=new Nde(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;tr(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),jz(e)&&this.dirtySet.layerAdded(e)}remove(e){tr(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),jz(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const r of e)M(r)&&(tr(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)tr(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id),r.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const{shaderTransformer:i,localOrigin:n}=r,s=new CO(r,{boundingInfo:r.boundingInfo,shaderTransformer:i,castShadow:e.castShadow});return s.updateTransformation(o=>e.getCombinedStaticTransformation(r,o)),s.localOrigin=M(n)?n:this._originFactory.getOrigin(s.boundingSphere),s}updateRenderGeometryTransformation(e,r,i){if(k(e))return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(r,s));const n=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==n}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<lo.COUNT;++i)e[i]=r.filter(n=>n.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};h([f({constructOnly:!0})],AU.prototype,"dirtySet",void 0),AU=h([Q("esri.views.3d.webgl-engine.parts.Model")],AU);function Fkt(){const t=new Float32Array(4);return t[3]=1,t}function Dze(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function kkt(t,e,r,i){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function Lze(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:Dze,create:Fkt,createView:Lze,fromValues:kkt},Symbol.toStringTag,{value:"Module"}));const OO=1e-6,r$=[0,0,0],D9=[0,0,0];function Ukt(t,e){const{data:r,size:i}=t,n=r.length/i;if(n<=0)return;const s=new Qkt(t);yU(r$,s.minProj,s.maxProj),ET(r$,r$,.5),xf(D9,s.maxProj,s.minProj);const o=Sse(D9),a=new Ykt;a.quality=o,n<14&&(t=new Pt(new Float64Array(s.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],u=[0,0,0],d=[0,0,0],p=[0,0,0],A=[0,0,0],v=[0,0,0];switch(Bkt(s,t,v,l,c,u,d,p,A,a)){case 1:return void Hxe(r$,D9,e);case 2:return void Wkt(t,d,e)}zkt(t,v,l,c,u,d,p,A,a),Nze(t,a.b0,a.b1,a.b2,_R,vR);const b=[0,0,0];xf(b,vR,_R),a.quality=Sse(b),a.quality<o?Fze(a.b0,a.b1,a.b2,_R,vR,b,e):Hxe(r$,D9,e)}function Bkt(t,e,r,i,n,s,o,a,l,c){return Vkt(t,i,n),Ese(i,n)<OO?1:(xf(o,i,n),Gl(o,o),Gkt(e,i,o,s)<OO?2:(xf(a,n,s),Gl(a,a),xf(l,s,i),Gl(l,l),Tf(r,a,o),Gl(r,r),nT(e,r,o,a,l,c),0))}const i$=[0,0,0],n$=[0,0,0],zp=[0,0,0],Vp=[0,0,0],Gp=[0,0,0],wv=[0,0,0],xv=[0,0,0],Tv=[0,0,0];function zkt(t,e,r,i,n,s,o,a,l){jkt(t,e,r,i$,n$),i$[0]!==void 0&&(xf(zp,i$,r),Gl(zp,zp),xf(Vp,i$,i),Gl(Vp,Vp),xf(Gp,i$,n),Gl(Gp,Gp),Tf(wv,Vp,s),Gl(wv,wv),Tf(xv,Gp,o),Gl(xv,xv),Tf(Tv,zp,a),Gl(Tv,Tv),nT(t,wv,s,Vp,zp,l),nT(t,xv,o,Gp,Vp,l),nT(t,Tv,a,zp,Gp,l)),n$[0]!==void 0&&(xf(zp,n$,r),Gl(zp,zp),xf(Vp,n$,i),Gl(Vp,Vp),xf(Gp,n$,n),Gl(Gp,Gp),Tf(wv,Vp,s),Gl(wv,wv),Tf(xv,Gp,o),Gl(xv,xv),Tf(Tv,zp,a),Gl(Tv,Tv),nT(t,wv,s,Vp,zp,l),nT(t,xv,o,Gp,Vp,l),nT(t,Tv,a,zp,Gp,l))}function Vkt(t,e,r){let i=Ese(t.maxVert[0],t.minVert[0]),n=0;for(let s=1;s<7;++s){const o=Ese(t.maxVert[s],t.minVert[s]);o>i&&(i=o,n=s)}ad(e,t.minVert[n]),ad(r,t.maxVert[n])}const jp=[0,0,0];function Gkt(t,e,r,i){const{data:n,size:s}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<n.length;l+=s){jp[0]=n[l]-e[0],jp[1]=n[l+1]-e[1],jp[2]=n[l+2]-e[2];const c=r[0]*jp[0]+r[1]*jp[1]+r[2]*jp[2],u=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],d=jp[0]*jp[0]+jp[1]*jp[1]+jp[2]*jp[2]-c*c/u;d>o&&(o=d,a=l)}return ad(i,n,a),o}const xa=[0,0];function jkt(t,e,r,i,n){qkt(t,e,xa,n,i);const s=Uze(r,e);xa[1]-OO<=s&&(i[0]=void 0),xa[0]+OO>=s&&(n[0]=void 0)}const Vxe=[0,0,0],Gxe=[0,0,0],jxe=[0,0,0],k3=[0,0,0],U3=[0,0,0],L9=[0,0,0];function nT(t,e,r,i,n,s){if(kze(e)<OO)return;Tf(Vxe,r,e),Tf(Gxe,i,e),Tf(jxe,n,e),yR(t,e,xa),U3[1]=xa[0],k3[1]=xa[1],L9[1]=k3[1]-U3[1];const o=[r,i,n],a=[Vxe,Gxe,jxe];for(let l=0;l<3;++l){yR(t,o[l],xa),U3[0]=xa[0],k3[0]=xa[1],yR(t,a[l],xa),U3[2]=xa[0],k3[2]=xa[1],L9[0]=k3[0]-U3[0],L9[2]=k3[2]-U3[2];const c=Sse(L9);c<s.quality&&(ad(s.b0,o[l]),ad(s.b1,e),ad(s.b2,a[l]),s.quality=c)}}const Hkt=[0,0,0];function yR(t,e,r){const{data:i,size:n}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<i.length;s+=n){const o=i[s]*e[0]+i[s+1]*e[1]+i[s+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function qkt(t,e,r,i,n){const{data:s,size:o}=t;ad(i,s),ad(n,i),r[0]=Uze(Hkt,e),r[1]=r[0];for(let a=o;a<s.length;a+=o){const l=s[a]*e[0]+s[a+1]*e[1]+s[a+2]*e[2];l<r[0]&&(r[0]=l,ad(i,s,a)),l>r[1]&&(r[1]=l,ad(n,s,a))}}function Hxe(t,e,r){ad(r.center,t),ET(r.halfSize,e,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const Oy=[0,0,0],B3=[0,0,0],s$=[0,0,0],_R=[0,0,0],vR=[0,0,0],qxe=[0,0,0];function Wkt(t,e,r){ad(Oy,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Oy[0]=0:Math.abs(e[1])>Math.abs(e[2])?Oy[1]=0:Oy[2]=0,kze(Oy)<OO&&(Oy[0]=Oy[1]=Oy[2]=1),Tf(B3,e,Oy),Gl(B3,B3),Tf(s$,e,B3),Gl(s$,s$),Nze(t,e,B3,s$,_R,vR),xf(qxe,vR,_R),Fze(e,B3,s$,_R,vR,qxe,r)}function Nze(t,e,r,i,n,s){yR(t,e,xa),n[0]=xa[0],s[0]=xa[1],yR(t,r,xa),n[1]=xa[0],s[1]=xa[1],yR(t,i,xa),n[2]=xa[0],s[2]=xa[1]}const N9=[0,0,0],Ag=[1,0,0,0,1,0,0,0,1],z3=[0,0,0];function Fze(t,e,r,i,n,s,o){Ag[0]=t[0],Ag[1]=t[1],Ag[2]=t[2],Ag[3]=e[0],Ag[4]=e[1],Ag[5]=e[2],Ag[6]=r[0],Ag[7]=r[1],Ag[8]=r[2],Xkt(o.quaternion,Ag),yU(z3,i,n),ET(z3,z3,.5),ET(o.center,t,z3[0]),ET(N9,e,z3[1]),yU(o.center,o.center,N9),ET(N9,r,z3[2]),yU(o.center,o.center,N9),ET(o.halfSize,s,.5)}const $d=7;let Qkt=class{constructor(e){this.minVert=new Array($d),this.maxVert=new Array($d);const r=64*$d;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,$d),i+=8*$d,this.maxProj=new Float64Array(this.buffer,i,$d),i+=8*$d;for(let l=0;l<$d;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<$d;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<$d;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const n=new Array($d),s=new Array($d),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,n[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,s[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,n[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,s[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,n[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,s[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,n[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,s[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,n[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,s[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,n[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,s[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,n[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,s[6]=l)}for(let l=0;l<$d;++l){let c=n[l];ad(this.minVert[l],o,c),c=s[l],ad(this.maxVert[l],o,c)}}},Ykt=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function Sse(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function yU(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function xf(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function ET(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function ad(t,e,r=0){t[0]=e[r+0],t[1]=e[r+1],t[2]=e[r+2]}function Tf(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2];t[0]=n*l-s*a,t[1]=s*o-i*l,t[2]=i*a-n*o}function Gl(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function kze(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function Ese(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function Uze(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Xkt(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const n=(i+1)%3,s=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*n+n]-e[3*s+s]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*n+s]-e[3*s+n])*o,t[n]=(e[3*n+i]+e[3*i+n])*o,t[s]=(e[3*s+i]+e[3*i+s])*o}}const sD=n0(),GT=G(),Zkt=G(),Jkt=Es();let D_r=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:Rle(this.buffer,56*a+0),halfSize:JFe(this.buffer,56*a+24),quaternion:Lze(this.buffer,56*a+36)}}};function Bze(t=[0,0,0],e=[-1,-1,-1],r=n0()){return{center:Gs(t),halfSize:pz(e),quaternion:Dze(r)}}function Wxe(t){return Bze(t.center,t.halfSize,t.quaternion)}function N_r(t,e){Pe(e.center,t.center),Pe(e.halfSize,t.halfSize),Dhe(e.quaternion,t.quaternion)}function F_r(t,e){return e=e||Bze(),Ukt(t,e),e}function sT(t,e){const r=kn(e,t.center),i=RH(t,e);return r>i?1:r<-i?-1:0}function k_r(t,e){e||(e=fa());const r=fhe(Jkt,t.quaternion),i=t.halfSize[0]*Math.abs(r[0])+t.halfSize[1]*Math.abs(r[3])+t.halfSize[2]*Math.abs(r[6]),n=t.halfSize[0]*Math.abs(r[1])+t.halfSize[1]*Math.abs(r[4])+t.halfSize[2]*Math.abs(r[7]),s=t.halfSize[0]*Math.abs(r[2])+t.halfSize[1]*Math.abs(r[5])+t.halfSize[2]*Math.abs(r[8]);return e[0]=t.center[0]-i,e[1]=t.center[1]-n,e[2]=t.center[2]-s,e[3]=t.center[0]+i,e[4]=t.center[1]+n,e[5]=t.center[2]+s,e}function U_r(t,e){return kn(e,t.center)-RH(t,e)}function B_r(t,e){return kn(e,t.center)+RH(t,e)}function z_r(t,e){return sT(t,e[0])<=0&&sT(t,e[1])<=0&&sT(t,e[2])<=0&&sT(t,e[3])<=0&&sT(t,e[4])<=0&&sT(t,e[5])<=0}function V_r(t,e,r,i=0){HS(sD,t.quaternion),Ve(GT,e,t.center);const n=Tm(GT,GT,sD),s=Tm(Zkt,r,sD);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(s[l])>1e-6){const c=(i+t.halfSize[l]-n[l])/s[l],u=(-i-t.halfSize[l]-n[l])/s[l];o=Math.max(o,Math.min(c,u)),a=Math.min(a,Math.max(c,u))}else if(n[l]>t.halfSize[l]+i||n[l]<-t.halfSize[l]-i)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let n=0;n<i.length;n++)t[e+n]=i[n];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function RH(t,e){HS(sD,t.quaternion),Tm(GT,e,sD);const r=t.halfSize;return Math.abs(GT[0]*r[0])+Math.abs(GT[1]*r[1])+Math.abs(GT[2]*r[2])}function G_r(t,e){for(let r=0;r<8;++r){const i=e[r];i[0]=1&r?-t.halfSize[0]:t.halfSize[0],i[1]=2&r?-t.halfSize[1]:t.halfSize[1],i[2]=4&r?-t.halfSize[2]:t.halfSize[2],Tm(i,i,t.quaternion),ze(i,i,t.center)}}function Kkt(t){return Gh(t.halfSize)}function eUt(t,e,r,i,n){if(Dhe(n.quaternion,t.quaternion),i===wt.Global){HS(F9,t.quaternion),Tm(Sv,t.center,F9),wK(V3,Sv),WOe(G3,V3,t.halfSize),Ka(G3,V3,G3);const s=ct(G3);ze(G3,V3,t.halfSize);const o=ct(G3);if(s<r)Pe(n.center,t.center),Le(Sv,r,r,r),ze(n.halfSize,t.halfSize,Sv);else{const a=o>0?1+e/o:1,l=s>0?1+r/s:1,c=(l+a)/2,u=(l-a)/2;Oe(n.halfSize,V3,u),PT(n.halfSize,n.halfSize,t.halfSize,c),Oe(n.center,V3,c),PT(n.center,n.center,t.halfSize,u),qOe(Sv,Sv),EG(n.center,n.center,Sv),Tm(n.center,n.center,n.quaternion)}}else{const s=Le(Sv,0,0,1);PT(n.center,t.center,s,(r+e)/2),HS(F9,t.quaternion),Tm(s,s,F9),wK(s,s),PT(n.halfSize,t.halfSize,s,(r-e)/2)}return n}const Sv=G(),V3=G(),G3=G(),F9=n0();let tUt=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];return r}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=rUt(e)}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i],s=n+r[i+1];for(let o=n;o<s;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i];if(!e(n,n+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let n=0;n<i.length;n+=2){const s=i[n],o=s+i[n+1],a=e[s],l=e[o];r[n]=a,r[n+1]=l-a}return r}};function rUt(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let n=1;n<t.length;n++){const s=t[n];r+i===s?i+=1:(e.push(r),e.push(i),r=s,i=1)}return e.push(r),e.push(i),e}let iUt=class{constructor(e,r){this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=r.slice();const i=this.count;this.visibility=new tUt(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let n=0;n<i;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return k(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return k(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return k(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((k(this.cachedHighlightRanges)||k(this.cachedDefaultRanges))&&M(this.highlightCounts)){const{highlightRanges:e,defaultRanges:r}=nUt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function nUt(t,e,r){const i=[],n=[];let s=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(s!==a-1&&(i.length&&i.push(r[s+1]-i[i.length-1]),i.push(r[a])),s=a):(o!==a-1&&(n.length&&n.push(r[o+1]-n[n.length-1]),n.push(r[a])),o=a),!0)),i.length&&i.push(r[s+1]-i[i.length-1]),n.length&&n.push(r[o+1]-n[n.length-1]),{highlightRanges:i,defaultRanges:n}}let G4=class extends rt{constructor(){super(...arguments),this.visible=bR.Hidden}};var bR;h([f({autoDestroy:!0})],G4.prototype,"renderable",void 0),h([f({autoDestroy:!0})],G4.prototype,"components",void 0),G4=h([Q("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],G4),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(bR||(bR={}));function sUt(t,e,r,i){if(r>=e)return t;t==null&&(t=oUt());const n=t.isVisibleBit;let s=t.data;const o=Vze(s),a=r/o|0,l=r-o*a,c=(e-1)/o|0,u=s,d=i===n;if(!(r<u.length*o)&&d){const A=a+1,v=Math.ceil(u.length*1.5),b=c+1;let S=Math.max(A,v);S=Math.min(S,b),s=new Uint32Array(S),s.set(u)}return a<s.length&&(s[a]=lUt(s[a],l,d)),t.data=s,t}function zze(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,n=Vze(i);return e<i.length*n?aUt(r,i,e,n):!t.isVisibleBit}function oUt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function aUt(t,e,r,i){const n=r/i|0,s=r-n*i;return cUt(e[n],s)===t}function Vze(t){return t.BYTES_PER_ELEMENT*8}function lUt(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function cUt(t,e){return(t&1<<e)!=0}let uUt=class{constructor(e,r){this._indices=M(e.indices)?e.indices:yO(e.positions.length/3),this._positions=new Wn(e.positions),this._components=r,this._componentIntersectionData=new Array(r.count)}getComponentAabb(e,r){if(M(this._perComponentAabbs)){for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*e+i];return r}return this._computePerComponentAabbs(),this.getComponentAabb(e,r)}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions.typedBuffer,r.stride=this._positions.typedBufferStride,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,n,s,o,a){const l=new Pt(this._positions.typedBuffer,3,!1,this._positions.typedBufferStride),c=this._indices,u=this._components.offsets,d=Q9e(e,r,hUt),p=e[2],A=r[2];this._components.visibility.forEachComponent(v=>{if(!zze(this._components.pickability,v))return!0;const b=this.getComponentAabb(v,dUt);if(M(o)){const I=o[v];M(s)?s.componentOffset=I:(e[2]=p-I,r[2]=A-I)}if(M(s)&&s.applyToAabb(b),!ude(b,e,d,i))return!0;const S=u[v]/3,E=u[v+1]/3,R=E-S,O=(I,N,L)=>a(v,I,nd(N,N,n),L);return k(s)&&R>Pze?(this._componentIntersectionData[v]==null&&(this._componentIntersectionData[v]=new ype(this._indices,S,E,l)),this._componentIntersectionData[v].intersectRay({r0:e,r1:r},O)):sF(e,r,S,E,c,l,void 0,s,O),!0})}_computePerComponentAabbs(){const e=this._components.count;this._perComponentAabbs=new Float32Array(6*e);const r=this._indices,i=this._positions.typedBuffer,n=this._positions.typedBufferStride,s=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=s[a],c=s[a+1];let u=1/0,d=1/0,p=1/0,A=-1/0,v=-1/0,b=-1/0;for(let S=l;S<c;S++){const E=r[S]*n,R=i[E],O=i[E+1],I=i[E+2];u=Math.min(u,R),d=Math.min(d,O),p=Math.min(p,I),A=Math.max(A,R),v=Math.max(v,O),b=Math.max(b,I)}this._perComponentAabbs[o++]=u,this._perComponentAabbs[o++]=d,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=A,this._perComponentAabbs[o++]=v,this._perComponentAabbs[o++]=b}}get positions(){return this._positions}get indices(){return this._indices}};const hUt=G(),dUt=fa();let pUt=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},fUt=class{constructor(e,r,i,n){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=n}dispose(){this.vao.dispose()}},mUt=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function gUt(t,e){return{near:t,far:e}}function mF(t){return t?GL(t,1/0,-1/0):gUt(1/0,-1/0)}function GL(t,e,r){return t.near=e,t.far=r,t}function PO(t,e,r=t){return e!=null&&(r.near=Math.min(t.near,e.near),r.far=Math.max(t.far,e.far)),r}function k9(t,e){return t.near<=e&&e<=t.far}const Cse={near:0,far:0};function AUt(t,e){const r=mF(),{eye:i,frustum:n,viewForward:s}=t;e.forAll(o=>{const a=M(o.offsetObb)?o.offsetObb:o.obb,l=Qe(Ka(Bd,a.center,i),s),c=RH(a,s);if(k9(r,l-c)&&k9(r,l+c))return;const u=wUt(a,n);if(u===-1)return;if(u===0)return Py.far=l+c,Py.near=l-c,void PO(r,Py);const d=U9.pushNew();d.near=l-c,d.far=l+c,d.mask=u,d.object=o});for(let o=0;o<U9.length;o++){const a=U9.data[o];if(k9(r,a.near)&&k9(r,a.far))continue;Py.far=a.far,Py.near=1/0,bUt(M(a.object.offsetObb)?a.object.offsetObb:a.object.obb,i,yUt,c=>{let u=_Ut;for(let d=0;d<Gze&&c.length>0;d++){if(!(a.mask&1<<d))continue;vUt(n[d],c,u);const p=c;c=u,u=p}for(let d=0;d<c.length;d+=3){Le(Ju,c.data[d+0],c.data[d+1],c.data[d+2]);const p=Qe(Ka(Ju,Ju,i),s);Py.near=Math.min(Py.near,p)}})===0&&(Py.near=0),PO(r,Py)}return U9.length=0,r}const U9=new Vr({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=AS(t.object),t)}),Py=mF(),Ju=G(),sx=G(),yUt=new Vr({deallocator:null}),_Ut=new Vr({deallocator:null});function vUt(t,e,r){r.length=0;const i=e.length-3;jX(Ju,e,i);const n=kn(t,Ju);n<=0&&(r.push(Ju[0]),r.push(Ju[1]),r.push(Ju[2]));let s=0,o=n;for(;s<i;s+=3){jX(sx,e,s);const a=kn(t,sx);o*a<0&&(Eo(Ju,sx,Ju,a/(a-o)),Ku(r,Ju)),a<=0&&Ku(r,sx),o=a,Pe(Ju,sx)}o*n<0&&(jX(sx,e,i),Eo(Ju,sx,Ju,n/(n-o)),Ku(r,Ju))}function jX(t,e,r){return Le(t,e.data[r+0],e.data[r+1],e.data[r+2])}function Ku(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function bUt(t,e,r,i){HS(Yxe,t.quaternion),Ka(Bd,e,t.center),Tm(Bd,Bd,Yxe);const n=8*((Bd[0]<-t.halfSize[0]?-1:Bd[0]>t.halfSize[0]?1:0)+3*(Bd[1]<-t.halfSize[1]?-1:Bd[1]>t.halfSize[1]?1:0)+9*(Bd[2]<-t.halfSize[2]?-1:Bd[2]>t.halfSize[2]?1:0)+13),s=Qxe[n];if(s===0)return s;fhe(B9,t.quaternion),phe(B9,B9,t.halfSize);const o=(a,l)=>{const c=Qxe[n+l+1];return Le(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),nd(a,a,B9),ze(a,t.center,a)};return r.length=0,Ku(r,o(HX,0)),Ku(r,o(Xxe,1)),Ku(r,o(Bd,2)),Ku(r,o(Zxe,3)),i(r),s===1||(r.length=0,Ku(r,HX),Ku(r,Zxe),Ku(r,o(Bd,4)),Ku(r,o(Jxe,5)),i(r),s===2||(r.length=0,Ku(r,HX),Ku(r,Jxe),Ku(r,o(Bd,6)),Ku(r,Xxe),i(r))),s}const Qxe=(()=>{const t=new Int8Array(216);let e=0;const r=i=>{for(let n=0;n<i.length;n++)t[e+n]=i[n];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),Gze=4;function wUt(t,e){let r=0;for(let i=0;i<Gze;i++){const n=sT(t,e[i]);if(n>0)return-1;n===0&&(r|=1<<i)}return r}const B9=Es(),Yxe=n0(),Bd=G(),HX=G(),Xxe=G(),Zxe=G(),Jxe=G();let xUt=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?AUt(e,this._objects.visibleObjects):null}};function TUt(t){const e=Cs().vec3f(z.POSITION);return t.normals&&e.vec2i16(z.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===wo.Default?e.vec2f(z.UV0):t.textureCoordinates===wo.Atlas&&(e.vec2f(z.UV0),e.vec4u16(z.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(z.COLOR,{glNormalized:!0}),e.alignTo(4)}let SUt=class{constructor(){this.externalColor=Kr(),this.externalColorMixMode=oa.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},EUt=class extends Ys{constructor(e,r){super(e,"int",Sn.Draw,(i,n,s)=>i.setUniform1i(e,r(n,s)))}};var EA;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(EA||(EA={}));const _pe=429496.7296;function jze(t,e){ML(t/_pe*.5+.5,e)}function CUt(t,e){switch(e.componentData){case EA.Varying:return MUt(t,e);case EA.Uniform:return RUt(t);case EA.COUNT:return;default:e.componentData}}function MUt(t,e){const{vertex:r,fragment:i}=t;r.include(bd),r.uniforms.add(g2("componentColorTex",s=>s.componentParameters.texture.texture,e.hasWebGL2Context?hn.None:hn.Size)),t.attributes.add(z.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const n=e.output===ne.ObjectAndLayerIdColor;n&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(gUe),r.constants.add("elevationScale","float",2*_pe),r.constants.add("stride","float",Fe("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(D`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${Nf(e,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `),r.code.add(D`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${gu(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${gu(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${n?D`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${gu(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:D`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(D`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?D`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function RUt(t){const{vertex:e,fragment:r}=t;e.uniforms.add(new sV("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new EUt("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(D`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(D`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var Cf;function OUt(t,e){const r=t.vertex;switch(r.code.add(D`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Cf.None:r.code.add(D`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Cf.Opaque:r.code.add(D`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Cf.Transparent:r.code.add(D`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(Cf||(Cf={}));var CA;function e1r(t){return t&&XA(t)?CA.Mars:t&&ZA(t)?CA.Moon:CA.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(CA||(CA={}));var ip;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(ip||(ip={}));let gi=class extends Nc{constructor(){super(...arguments),this.output=ne.Color,this.textureCoordinateType=wo.None,this.componentData=EA.Uniform,this.cullFace=Vn.Back,this.vertexDiscardMode=Cf.None,this.doubleSidedMode=ks.WindingOrder,this.alphaDiscardMode=xn.Opaque,this.integratedMeshMode=ip.None,this.transparencyPassType=dr.NONE,this.ellipsoidMode=CA.Earth,this.pbrMode=Jt.Disabled,this.normalType=An.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.useLegacyTerrainShading=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.hasWebGL2Context=!1}};h([ae({count:ne.COUNT})],gi.prototype,"output",void 0),h([ae({count:wo.COUNT})],gi.prototype,"textureCoordinateType",void 0),h([ae({count:EA.COUNT})],gi.prototype,"componentData",void 0),h([ae({count:Vn.COUNT})],gi.prototype,"cullFace",void 0),h([ae({count:Cf.COUNT})],gi.prototype,"vertexDiscardMode",void 0),h([ae({count:ks.COUNT})],gi.prototype,"doubleSidedMode",void 0),h([ae({count:xn.COUNT})],gi.prototype,"alphaDiscardMode",void 0),h([ae({count:ip.COUNT})],gi.prototype,"integratedMeshMode",void 0),h([ae({count:dr.COUNT})],gi.prototype,"transparencyPassType",void 0),h([ae({count:CA.COUNT})],gi.prototype,"ellipsoidMode",void 0),h([ae({count:Jt.COUNT})],gi.prototype,"pbrMode",void 0),h([ae({count:An.COUNT})],gi.prototype,"normalType",void 0),h([ae()],gi.prototype,"spherical",void 0),h([ae()],gi.prototype,"doublePrecisionRequiresObfuscation",void 0),h([ae()],gi.prototype,"hasVertexColors",void 0),h([ae()],gi.prototype,"hasNormals",void 0),h([ae()],gi.prototype,"hasSlicePlane",void 0),h([ae()],gi.prototype,"hasBaseColorTexture",void 0),h([ae()],gi.prototype,"receiveAmbientOcclusion",void 0),h([ae()],gi.prototype,"receiveShadows",void 0),h([ae()],gi.prototype,"blendingEnabled",void 0),h([ae()],gi.prototype,"hasScreenSpaceReflections",void 0),h([ae()],gi.prototype,"hasPolygonOffset",void 0),h([ae()],gi.prototype,"hasMetallicRoughnessTexture",void 0),h([ae()],gi.prototype,"hasEmissionTexture",void 0),h([ae()],gi.prototype,"hasOcclusionTexture",void 0),h([ae()],gi.prototype,"hasNormalTexture",void 0),h([ae()],gi.prototype,"hasOccludees",void 0),h([ae()],gi.prototype,"hasMultipassTerrain",void 0),h([ae()],gi.prototype,"cullAboveGround",void 0),h([ae()],gi.prototype,"useLegacyTerrainShading",void 0),h([ae()],gi.prototype,"hasCloudsReflections",void 0),h([ae()],gi.prototype,"snowCover",void 0),h([ae()],gi.prototype,"objectAndLayerIdColor",void 0),h([ae()],gi.prototype,"hasWebGL2Context",void 0),h([ae({constValue:Sn.Draw})],gi.prototype,"pbrTextureBindType",void 0),h([ae({constValue:!0})],gi.prototype,"hasSliceHighlight",void 0),h([ae({constValue:!1})],gi.prototype,"hasSliceInVertexProgram",void 0),h([ae({constValue:!1})],gi.prototype,"useCustomDTRExponentForWater",void 0),h([ae({constValue:!1})],gi.prototype,"hasVertexTangents",void 0),h([ae({constValue:!0})],gi.prototype,"supportsTextureAtlas",void 0),h([ae({constValue:!1})],gi.prototype,"highStepCount",void 0),h([ae({constValue:!1})],gi.prototype,"instancedDoublePrecision",void 0),h([ae({constValue:!0})],gi.prototype,"useFillLights",void 0),h([ae({constValue:!1})],gi.prototype,"objectAndLayerIdColorInstanced",void 0);function Kxe(t,e){t.include(RE,e),t.fragment.include(NL);const r=t.fragment;r.uniforms.add(new sV("baseColor",i=>i.baseColor)),r.uniforms.add(new oS("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(D`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(D`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(D`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function eTe(t,e){const r=t.fragment;switch(e.doubleSidedMode){case ks.None:r.code.add(D`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case ks.View:t.include(oR,e),r.code.add(D`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case ks.WindingOrder:r.code.add(D`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case ks.COUNT:}switch(e.normalType){case An.Attribute:case An.CompressedAttribute:t.include(dH,e),r.code.add(D`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case An.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.include(oR,e),r.code.add(D`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case An.Ground:e.spherical?(t.include(oR,e),r.code.add(D`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(D`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),t.extensions.add("GL_OES_standard_derivatives"),r.code.add(D`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case An.COUNT:}}function PUt(t,e){const r=t.fragment;if(e.hasBaseColorTexture&&(e.output===ne.Color||e.alphaDiscardMode!==xn.Opaque)){t.include(she,e);const i=e.textureCoordinateType===wo.Atlas;r.uniforms.add(g2("baseColorTexture",n=>n.texture,i?e.hasWebGL2Context?hn.None:hn.Size:hn.None)),i?(t.include(i6e),r.code.add(D`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${Nf(e,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):r.code.add(D`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else r.code.add(D`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function IUt(t){const e=new Ui;e.include(oR,t),e.include(dH,t),e.include(RE,t),e.include(TA,t),e.include(AP,t),e.include(CUt,t),e.include(F4t,t),e.include(POt,t),e.include(PUt,t),e.include(OUt,t);const{vertex:r,fragment:i}=e;t.pbrMode!==Jt.Normal&&t.pbrMode!==Jt.Schematic||(e.include(ahe,t),t.hasNormalTexture&&e.include(vUe,t));const n=t.output===ne.Shadow||t.output===ne.ShadowHighlight||t.output===ne.ShadowExcludeHighlight;n&&t.componentData===EA.Varying?r.code.add(D`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(D`#define discardShadows(castShadows) {}`);const s=t.integratedMeshMode===ip.ColorOverlay||t.integratedMeshMode===ip.ColorOverlayWithWater,o=s&&t.output===ne.Color&&t.pbrMode===Jt.WaterOnIntegratedMesh;return s&&(e.include(ZS,t),e.include(c7t,t),t.spherical?r.code.add(D`
      const float invEllipsoidRadius = ${D.float(1/(t.ellipsoidMode===CA.Earth?yi.radius:t.ellipsoidMode===CA.Mars?yA.radius:t1.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(D`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(D`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===ne.ObjectAndLayerIdColor?D`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${D.float(Jl)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===ne.ObjectAndLayerIdColor?D`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?D`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:D`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?D`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===ne.Alpha&&(i.include(Tp),e.include(Sp,t),e.include(Kxe,t),s&&i.uniforms.add(new _r("ovColorTex",(a,l)=>bse(a,l))),i.code.add(D`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?D`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?D`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),t.output===ne.Color&&(i.include(Tp),e.include(Sp,t),e.include(Kxe,t),e.include(eTe,t),e.include(ZS,t),t.receiveShadows?(e.include(pH,t),i.code.add(D`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(D`float evaluateShadow() { return 0.0; }`),s&&i.uniforms.add(new _r("ovColorTex",(a,l)=>bse(a,l))),i.code.add(D`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?D`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?D`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===Jt.Normal||t.pbrMode===Jt.Schematic?(ty(i),i.code.add(D`
        ${t.pbrMode===Jt.Normal?D`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(D`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(D`vec3 shadingNormal = normalVertex;`),i.code.add(D`${t.spherical?D`vec3 normalGround = normalize(positionWorld());`:D`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(D`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?D`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?D` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?i.code.add(D`float shadow = evaluateShadow();`):t.spherical?(EP(i),i.code.add(D`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(D`float shadow = 0.0;`),o&&i.uniforms.add(new _r("ovNormalTex",(a,l)=>vpe(l))),t.snowCover&&(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(D`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),i.code.add(D`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?D` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?D`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(D`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===dr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),(t.output===ne.Depth||n)&&(e.include(h1,t),i.code.add(D`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===ne.Normal&&(e.include(eTe,t),i.code.add(D`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===An.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===ne.ObjectAndLayerIdColor&&e.fragment.code.add(D`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?D`gl_FragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===ne.Highlight&&(e.include(P1,t),i.code.add(D`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?D`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function vpe(t){return t.overlays.length===0?null:t.overlays[bs.INNER].getValidTexture(Vs.Water)}const $Ut=Object.freeze(Object.defineProperty({__proto__:null,build:IUt,getOverlayNormalTexture:vpe},Symbol.toStringTag,{value:"Module"}));let Hze=class qze extends qi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2,r.spherical=e.viewingMode===wt.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new zi(e.rctx,qze.shader.get().build(this.configuration),Wze)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==ip.None,n=e===dr.NONE,s=e===dr.FrontFace;return Pr({blending:r.output!==ne.Color&&r.output!==ne.Alpha||!r.blendingEnabled?null:n?_p:I1(e),culling:Ij(r.cullFace),depthTest:{func:cw(e)},depthWrite:n||s?_h:null,colorWrite:Gr,stencilWrite:i||r.hasOccludees?VA:null,stencilTest:i?b$t(dh.IntegratedMeshMaskExcluded):r.hasOccludees?uw:null,polygonOffset:n||s?r.hasPolygonOffset?{factor:2,units:2}:null:oH})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Hze.shader=new Bi($Ut,()=>be(()=>import("./ComponentShader.glsl-4162ddd4.js"),[]));const Wze=new Map([[z.POSITION,0],[z.NORMAL,1],[z.NORMALCOMPRESSED,1],[z.COLOR,2],[z.UV0,3],[z.UVREGION,4],[z.COMPONENTINDEX,5]]);let DUt=class extends En{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},bpe=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Bs(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const n=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(s){const o=this[i];if(o==null)this[i]=s;else{if(n.equals(o,s))return;n.copy(o,s)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(n){this[i]!==n&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=n,this._setDirty())}})}}function tTe(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let OH=class{constructor(e){this._low=cs(),this._high=cs(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){const r=this._low,i=this._high;Pe(r,e),Ka(i,e,r)}setElements(e,r,i){Le(rTe,e,r,i),this.set(rTe)}get(e){return ze(e,this._low,this._high)}getLowScaled(e){return Oe(e,this._low,1)}};const rTe=G();let Ga=class extends DUt{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=Bm(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=sn(1,1,.5),this.emissiveFactor=sn(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new _U,this.componentParameters=new oD,this.textureAlphaCutoff=Bz,this.alphaDiscardMode=xn.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=CA.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new gi;const i=new OH(e.position),n=bUe(e.rotationScale);SE(n,n),this.transformNormalGlobalFromModel=Kf(n,n),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=us(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return M(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return M(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return M(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return M(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return M(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,n){const s=this._techniqueConfiguration;s.hasVertexColors=n.colors,s.hasNormals=n.normals,s.textureCoordinateType=n.textureCoordinates,s.hasMetallicRoughnessTexture=M(this.metallicRoughnessTexture),s.hasEmissionTexture=M(this.emissionTexture),s.hasOcclusionTexture=M(this.occlusionTexture),s.hasNormalTexture=M(this.normalTexture),s.transparencyPassType=r.identifier===rd.Material&&i.transparencyPassType!=null?i.transparencyPassType:dr.NONE,s.hasMultipassTerrain=r.identifier===rd.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,s.cullAboveGround=r.identifier===rd.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?ks.View:ks.None,s.hasBaseColorTexture=M(this.baseColorTexture);const o=this._computeWhichMaterialPass();s.blendingEnabled=o===ou.Transparent||o===ou.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?NUt(i)?vpe(i)?ip.ColorOverlayWithWater:ip.ColorOverlay:ip.NoOverlay:ip.None,s.useLegacyTerrainShading=this.isIntegratedMesh&&tn.TERRAIN_USE_LEGACY_SHADING,s.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&k(this.baseColorTexture);if(s.pbrMode=s.integratedMeshMode===ip.ColorOverlayWithWater?Jt.WaterOnIntegratedMesh:this.usePBR?a?Jt.Schematic:Jt.Normal:Jt.Disabled,s.normalType=s.integratedMeshMode===ip.None?s.hasNormals?An.CompressedAttribute:An.ScreenDerivative:An.Ground,s.hasSlicePlane=M(i.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,r.identifier===rd.ShadowMap)s.output=ne.Shadow,s.vertexDiscardMode=Cf.None;else if(r.identifier===rd.Highlight)s.output=ne.Highlight,s.vertexDiscardMode=Cf.None;else{switch(this._computeWhichMaterialPass()===ou.OpaqueAndTransparent?s.vertexDiscardMode=r.transparent?Cf.Opaque:Cf.Transparent:s.vertexDiscardMode=Cf.None,s.output=r.output,s.receiveAmbientOcclusion=!1,s.receiveShadows=!1,r.output){case ne.Color:s.receiveAmbientOcclusion=i.ssaoHelper.active,s.hasOccludees=i.hasOccludees,s.receiveShadows=i.shadowMap.ready,s.hasScreenSpaceReflections=i.ssr.enabled,s.hasCloudsReflections=M(i.cloudsFade.data);break;case ne.Alpha:s.hasOccludees=i.hasOccludees;break;case ne.ObjectAndLayerIdColor:s.objectAndLayerIdColor=!0}s.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(Hze,s,this._technique),this._setClean(),this._technique}hasSnowCover(e){return M(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const n=i.renderable.geometry,s=i.components,o=i.renderable.meta.cameraDepthSquared,a=s.geometryRanges,l=s.highlightRanges,c=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case ou.Opaque:e.materialOpaque.submitDraw(this,n,a,o);break;case ou.Transparent:e.materialTransparent.submitDraw(this,n,a,o);break;case ou.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,n,a,o),e.materialTransparent.submitDraw(this,n,a,o);break;case ou.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,n,a,o),LUt(r)&&e.highlightIntegratedMesh.submitDraw(this,n,a,o)}const u=this.componentParameters.castShadows!==Ea.None;u&&e.shadowMap.submitDraw(this,n,a,o),M(l)&&(e.highlight.submitDraw(this,n,l,o),u&&e.highlightShadowMap.submitDraw(this,n,l,o)),u&&M(c)&&e.defaultShadowMap.submitDraw(this,n,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?ou.IntegratedMesh:this.objectOpacity<1?ou.Transparent:this.componentParameters.opaqueOverride===Ea.All?ou.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===xn.Blend||this.alphaDiscardMode===xn.MaskBlend?ou.Transparent:this.componentParameters.transparent===Ea.None?ou.Opaque:this.componentParameters.transparent===Ea.All?ou.Transparent:ou.OpaqueAndTransparent}};var ou,Ea;h([Bs({vectorOps:tPe})],Ga.prototype,"baseColor",void 0),h([Bs()],Ga.prototype,"usePBR",void 0),h([Bs()],Ga.prototype,"hasParametersFromSource",void 0),h([Bs({vectorOps:oge})],Ga.prototype,"mrrFactors",void 0),h([Bs({vectorOps:oge})],Ga.prototype,"emissiveFactor",void 0),h([Bs({dispose:!0})],Ga.prototype,"baseColorTexture",void 0),h([Bs({dispose:!0})],Ga.prototype,"metallicRoughnessTexture",void 0),h([Bs({dispose:!0})],Ga.prototype,"emissionTexture",void 0),h([Bs({dispose:!0})],Ga.prototype,"occlusionTexture",void 0),h([Bs({dispose:!0})],Ga.prototype,"normalTexture",void 0),h([Bs()],Ga.prototype,"objectOpacity",void 0),h([tTe()],Ga.prototype,"commonMaterialParameters",void 0),h([tTe()],Ga.prototype,"componentParameters",void 0),h([Bs()],Ga.prototype,"textureAlphaCutoff",void 0),h([Bs()],Ga.prototype,"alphaDiscardMode",void 0),h([Bs()],Ga.prototype,"isIntegratedMesh",void 0),h([Bs()],Ga.prototype,"polygonOffsetEnabled",void 0),h([Bs()],Ga.prototype,"ellipsoidMode",void 0),h([Bs()],Ga.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(ou||(ou={}));let _U=class extends bpe{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Vn.Back,this.hasSlicePlane=!0}};h([Bs()],_U.prototype,"doubleSided",void 0),h([Bs()],_U.prototype,"cullFace",void 0),h([Bs()],_U.prototype,"hasSlicePlane",void 0);let oD=class extends bpe{constructor(){super(...arguments),this.externalColor=Fr(1,1,1,1),this.externalColorMixMode=oa.Multiply,this.castShadows=Ea.All}get transparent(){return this.externalColor[3]<1?Ea.All:Ea.None}get opaqueOverride(){return this.externalColorMixMode===oa.Replace&&this.externalColor[3]===1?Ea.All:Ea.None}get visible(){return this.externalColor[3]>0?Ea.All:Ea.None}get type(){return EA.Uniform}};h([Bs({vectorOps:tPe})],oD.prototype,"externalColor",void 0),h([Bs()],oD.prototype,"externalColorMixMode",void 0),h([Bs()],oD.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Ea||(Ea={}));let j4=class extends bpe{constructor(){super(...arguments),this.texture=null,this.transparent=Ea.None,this.opaqueOverride=Ea.None,this.castShadows=Ea.None}get type(){return EA.Varying}};function LUt(t){return t.overlays.length!==0&&M(t.overlays[bs.INNER].getValidTexture(Vs.Highlight))}function NUt(t){return t.overlays.length!==0&&M(t.overlays[bs.INNER].getColorTextureNoRasterImage())}h([Bs()],j4.prototype,"texture",void 0),h([Bs()],j4.prototype,"transparent",void 0),h([Bs()],j4.prototype,"opaqueOverride",void 0),h([Bs()],j4.prototype,"castShadows",void 0);const lV=Cs().vec3f(z.POSITION).u16(z.COMPONENTINDEX).u16(z.U16PADDING),Qze=Cs().vec2u8(z.SIDENESS),FUt=wd(Qze),Yze=Cs().vec3f(z.POSITION0).vec3f(z.POSITION1).u16(z.COMPONENTINDEX).u8(z.VARIANTOFFSET,{glNormalized:!0}).u8(z.VARIANTSTROKE).u8(z.VARIANTEXTENSION,{glNormalized:!0}).u8(z.U8PADDING,{glPadding:!0}).u16(z.U16PADDING,{glPadding:!0}),Mse=Yze.clone().vec3f(z.NORMAL),Rse=Yze.clone().vec3f(z.NORMALA).vec3f(z.NORMALB),Xze=new Map([[z.POSITION0,0],[z.POSITION1,1],[z.COMPONENTINDEX,2],[z.VARIANTOFFSET,3],[z.VARIANTSTROKE,4],[z.VARIANTEXTENSION,5],[z.NORMAL,6],[z.NORMALA,6],[z.NORMALB,7],[z.SIDENESS,8]]);function iTe(t,e,r){const i=e/3,n=new Uint32Array(r+1),s=new Uint32Array(r+1),o=(E,R)=>{E<R?n[E+1]++:s[R+1]++};for(let E=0;E<i;E++){const R=t[3*E],O=t[3*E+1],I=t[3*E+2];o(R,O),o(O,I),o(I,R)}let a=0,l=0;for(let E=0;E<r;E++){const R=n[E+1],O=s[E+1];n[E+1]=a,s[E+1]=l,a+=R,l+=O}const c=new Uint32Array(6*i),u=n[r],d=(E,R,O)=>{if(E<R){const I=n[E+1]++;c[2*I]=R,c[2*I+1]=O}else{const I=s[R+1]++;c[2*u+2*I]=E,c[2*u+2*I+1]=O}};for(let E=0;E<i;E++){const R=t[3*E],O=t[3*E+1],I=t[3*E+2];d(R,O,E),d(O,I,E),d(I,R,E)}const p=(E,R)=>{const O=2*E,I=R-E;for(let N=1;N<I;N++){const L=c[O+2*N],B=c[O+2*N+1];let U=N-1;for(;U>=0&&c[O+2*U]>L;U--)c[O+2*U+2]=c[O+2*U],c[O+2*U+3]=c[O+2*U+1];c[O+2*U+2]=L,c[O+2*U+3]=B}};for(let E=0;E<r;E++)p(n[E],n[E+1]),p(u+s[E],u+s[E+1]);const A=new Int32Array(3*i),v=(E,R)=>E===t[3*R]?0:E===t[3*R+1]?1:E===t[3*R+2]?2:-1,b=(E,R)=>{const O=v(E,R);A[3*R+O]=-1},S=(E,R,O,I)=>{const N=v(E,R);A[3*R+N]=I;const L=v(O,I);A[3*I+L]=R};for(let E=0;E<r;E++){let R=n[E];const O=n[E+1];let I=s[E];const N=s[E+1];for(;R<O&&I<N;){const L=c[2*R],B=c[2*u+2*I];L===B?(S(E,c[2*R+1],B,c[2*u+2*I+1]),R++,I++):L<B?(b(E,c[2*R+1]),R++):(b(B,c[2*u+2*I+1]),I++)}for(;R<O;)b(E,c[2*R+1]),R++;for(;I<N;)b(c[2*u+2*I],c[2*u+2*I+1]),I++}return A}let Zze=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?UUt:kUt}write(e,r,i){const n=this._edgeHashFunction(i);V9.seed=n;const s=V9.getIntRange(0,255),o=V9.getIntRange(0,this.settings.variants-1),a=.7,l=V9.getFloat(),c=255*(.5*BUt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,s),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const wpe=new Float32Array(6),cV=new Uint32Array(wpe.buffer),e2=new Uint32Array(1);function kUt(t){const e=wpe;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],e2[0]=5381;for(let r=0;r<cV.length;r++)e2[0]=31*e2[0]+cV[r];return e2[0]}function UUt(t){const e=wpe;e[0]=j3(t.position0[0]),e[1]=j3(t.position0[1]),e[2]=j3(t.position0[2]),e[3]=j3(t.position1[0]),e[4]=j3(t.position1[1]),e[5]=j3(t.position1[2]),e2[0]=5381;for(let r=0;r<cV.length;r++)e2[0]=31*e2[0]+cV[r];return e2[0]}const nTe=1e4;function j3(t){return Math.round(t*nTe)/nTe}function BUt(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let uV=class{constructor(){this._commonWriter=new Zze}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return Mse.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),ze(z9,i.faceNormal0,i.faceNormal1),Ye(z9,z9),e.normal.setVec(r,z9)}trim(e,r){return this._commonWriter.trim(e,r)}};uV.Layout=Mse,uV.glLayout=wd(Mse,1);let hV=class{constructor(){this._commonWriter=new Zze}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return Rse.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),e.normalA.setVec(r,i.faceNormal0),e.normalB.setVec(r,i.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};hV.Layout=Rse,hV.glLayout=wd(Rse,1);const z9=G(),V9=new d5,oT=-1;var dV;function zUt(t,e,r,i=WUt){const n=t.vertices.position,s=t.vertices.componentIndex,o=Dr(i.anglePlanar),a=Dr(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),u=Ose.edge,d=u.position0,p=u.position1,A=u.faceNormal0,v=u.faceNormal1,b=qUt(t),S=HUt(t),E=S.length/4,R=e.allocate(E);let O=0;const I=E,N=r.allocate(I);let L=0,B=0,U=0;const q=GJe(0,E),Z=new Float32Array(E);Z.forEach((re,te,j)=>{n.getVec(S[4*te+0],d),n.getVec(S[4*te+1],p),j[te]=zn(d,p)}),q.sort((re,te)=>Z[te]-Z[re]);const X=new Array,ee=new Array;for(let re=0;re<E;re++){const te=q[re],j=Z[te],H=S[4*te+0],W=S[4*te+1],oe=S[4*te+2],le=S[4*te+3],fe=le===oT;if(n.getVec(H,d),n.getVec(W,p),fe)Le(A,b[3*oe+0],b[3*oe+1],b[3*oe+2]),Pe(v,A),u.componentIndex=s.get(H),u.cosAngle=Qe(A,v);else{if(Le(A,b[3*oe+0],b[3*oe+1],b[3*oe+2]),Le(v,b[3*le+0],b[3*le+1],b[3*le+2]),u.componentIndex=s.get(H),u.cosAngle=Qe(A,v),GUt(u,c))continue;u.cosAngle<-.9999&&Pe(v,A)}B+=j,U++,fe||VUt(u,l)?(e.write(R,O++,u),X.push(j)):jUt(u,o)&&(r.write(N,L++,u),ee.push(j))}const se=new Float32Array(X.reverse()),ue=new Float32Array(ee.reverse());return{regular:{instancesData:e.trim(R,O),lodInfo:{lengths:se}},silhouette:{instancesData:r.trim(N,L),lodInfo:{lengths:ue}},averageEdgeLength:B/U}}function VUt(t,e){return t.cosAngle<e}function GUt(t,e){return t.cosAngle>e}function jUt(t,e){const r=pa(t.cosAngle),i=Ose.fwd,n=Ose.ortho;return y1(i,t.position1,t.position0),r*(Qe(Kt(n,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function HUt(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let n=0;for(let a=0;a<e;a++){const l=i[3*a+0],c=i[3*a+1],u=i[3*a+2],d=r[3*a+0],p=r[3*a+1],A=r[3*a+2];n+=l===oT||d<p?1:0,n+=c===oT||p<A?1:0,n+=u===oT||A<d?1:0}const s=new Int32Array(4*n);let o=0;for(let a=0;a<e;a++){const l=i[3*a+0],c=i[3*a+1],u=i[3*a+2],d=r[3*a+0],p=r[3*a+1],A=r[3*a+2];(l===oT||d<p)&&(s[o++]=d,s[o++]=p,s[o++]=a,s[o++]=l),(c===oT||p<A)&&(s[o++]=p,s[o++]=A,s[o++]=a,s[o++]=c),(u===oT||A<d)&&(s[o++]=A,s[o++]=d,s[o++]=a,s[o++]=u)}return s}function qUt(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,n=qX.v0,s=qX.v1,o=qX.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l+0],u=i[3*l+1],d=i[3*l+2];r.getVec(c,n),r.getVec(u,s),r.getVec(d,o),Ve(s,s,n),Ve(o,o,n),Kt(n,s,o),Ye(n,n),a[3*l+0]=n[0],a[3*l+1]=n[1],a[3*l+2]=n[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(dV||(dV={}));const Ose={edge:{position0:G(),position1:G(),faceNormal0:G(),faceNormal1:G(),componentIndex:0,cosAngle:0},ortho:G(),fwd:G()},qX={v0:G(),v1:G(),v2:G()},WUt={anglePlanar:4,angleSignificantEdge:35};function QUt(t){const e=YUt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return sTe.updateSettings(t.writerSettings),oTe.updateSettings(t.writerSettings),zUt(e,sTe,oTe)}function YUt(t,e,r,i){if(e){const o=iTe(r,i,t.count);return new XUt(r,i,o,t)}const n=Gne(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),s=iTe(n.indices,i,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:s,vertices:lV.createView(n.buffer)}}let XUt=class{constructor(e,r,i,n){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=n}};const sTe=new uV,oTe=new hV,p1r=Cs().vec3f(z.POSITION0).vec3f(z.POSITION1),ZUt=Cs().vec3f(z.POSITION0).vec3f(z.POSITION1).u16(z.COMPONENTINDEX).u16(z.U16PADDING,{glPadding:!0});let JUt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},KUt=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0,this._texture=new Xt(this._rctx,{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.NEAREST,wrapMode:Ar.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this._data=new Ic(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,n,s,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,n),this._data.set(a,2,s),this._data.set(a,3,o)}setDataElement(e,r,i,n){const s=e*this._fieldCount+r;this._dirty=!0,this._data.set(s,i,n)}resizeToFit(e){const r=e*this._fieldCount;if(r>=this._data.count){const i=Math.ceil((r+1)/this.textureWidth)*this.textureWidth,n=new Ic(new ArrayBuffer(4*i));n.typedBuffer.set(this._data.typedBuffer),this._data=n}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const Jze=65536;let eBt=class{constructor(e,r=1){this.textureBuffer=new KUt(e,r),this._indexManager=new JUt(Jze)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},Kze=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>Jze)return null;const r=new eBt(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const aTe=we.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class tBt{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._objects=[new Vr,new Vr],this._renderSubmit=new xUt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=Fe("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new Kze(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){tr(this._objects[bR.Hidden].length===0&&this._objects[bR.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(e){const r=new G4;return r.toMapSpace=e.toMapSpace,r.transform=e.transform,r.obb=Wxe(e.obb),r.components=new iUt(this._componentBufferManager,e.geometry.componentOffsets),r.renderable=this._createRenderable(e,r.components),r.intersectionGeometry=new uUt(e.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(e){const r=e;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=Cl(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,n=i.renderable.material,s=i.components,o=s.materialDataBuffer,a=s.materialDataIndices,l=new SUt,c=o.textureBuffer,u=new Uint8Array(4),d=new Uint32Array(u.buffer);let p=0,A=0,v=0,b=s.verticalOffsets,S=1/0,E=-1/0,R=!1,O=!1,I=0;for(let N=0;N<s.count;N++){r(N,l),p+=+(l.externalColor[3]<1),A+=+(l.externalColorMixMode===oa.Replace&&l.externalColor[3]===1),v+=+l.castShadows,mUe(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[N],0,u[0],u[1],u[2],u[3]),R||(R=N>0&&I!==d[0]),I=d[0],O||(O=l.elevationOffset!==0),O&&k(b)&&(b=new Array(N).fill(0)),M(b)&&(b[N]=l.elevationOffset),S=Math.min(S,l.elevationOffset),E=Math.max(E,l.elevationOffset),jze(l.elevationOffset,u),c.setData(a[N],1,u[0],u[1],u[2],u[3]);const L=l.objectAndLayerIdColor;M(L)&&c.setData(a[N],2,L[0],L[1],L[2],L[3]),l.pickable!==zze(s.pickability,N)&&(s.pickability=sUt(s.pickability,s.count,N,l.pickable))}s.verticalOffsets=O?b:null,i.offsetObb=O?eUt(i.obb,S,E,this._viewingMode,M(i.offsetObb)?i.offsetObb:Wxe(i.obb)):null,R||O||this._hasObjectAndLayerId?(n.componentParameters=new j4,n.componentParameters.castShadows=WX(v,s.count),n.componentParameters.transparent=WX(p,s.count),n.componentParameters.opaqueOverride=WX(A,s.count),n.componentParameters.texture=c,c.updateTexture()):(n.componentParameters=new oD,n.componentParameters.castShadows=l.castShadows?Ea.All:Ea.None,n.componentParameters.externalColor=l.externalColor,n.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,r,i,n=!1){e.intersectionGeometry.getComponentAabb(r,i);const s=e,o=s.components.verticalOffsets;if(n||k(o))return i;const a=o[r];if(this._viewingMode===wt.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=r3t(a);return l.localOrigin=s.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}intersect(e,r,i,n,s,o){const a=e;M(s)&&(s.localOrigin=a.transform.position);const l=SE(lTe,a.transform.rotationScale);Ka(G9,r,a.transform.position),Ka(j9,i,a.transform.position),nd(G9,G9,l),nd(j9,j9,l);const c=Kf(lTe,l);return a.intersectionGeometry.intersect(G9,j9,n,c,s,a.components.verticalOffsets,o)}addEdges(e,r,i,n){const s=e,{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets;return r.addComponentObject(e,s.transform,{center:s.obb.center,radius:Kkt(s.obb)},a,o,l,i,n)}async extractEdgeInformation(e,r,i){const n=e,s=n.components.visibility;if(s.allInvisible())return{buffer:ZUt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets,c=lV.createBuffer(a.count);vH(c.position,a),G2(c.position,c.position,n.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,d=this._computeVisibilityIndices(o,s,l,u);return{origin:Gs(n.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let n=0;for(let s=0;s<i.length-1;s++){const o=i[s],a=i[s+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,n)}n++}}_computeVisibilityIndices(e,r,i,n){if(e&&r.allVisible())return e;let s=0;r.forEachComponentRange((l,c)=>(s+=i[c]-i[l],!0));const o=Array.isArray(e)?new Array(s):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let a=0;return r.forEachComponentRange((l,c)=>{const u=i[l],d=i[c];for(let p=u;p<d;p++)o[a++]=e?e[p]:p;return!0}),o}addComponentHighlight(e,r){const i=e.components;k(i.highlightCounts)&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(k(i.highlightCounts))return void aTe.warn("Removing non-existing highlight.");const n=i.highlightCounts[r],s=i.highlightCounts[i.count];if(n!==0){if(n>1)return i.highlightCounts[r]=n-1,void(i.highlightCounts[i.count]=s-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),s===1?i.highlightCounts=null:i.highlightCounts[i.count]=s-1}else aTe.warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;M(r.highlightCounts)&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[bR.Visible]}_createRenderable(e,r){const i=this._renderManager.rctx,n=e.geometry,s=n.vertices.layoutParameters,o=Ji.createVertex(i,ki.STATIC_DRAW,n.vertices.data),a=rl(n.indices,b=>Ji.createIndex(i,ki.STATIC_DRAW,b)),l=wd(TUt(s)),c=new Uint16Array(n.vertices.count);for(let b=0;b<r.count;b++){const S=r.offsets[b],E=r.offsets[b+1],R=r.materialDataIndices[b];if(M(n.indices))for(let O=S;O<E;O++)c[n.indices[O]]=R;else for(let O=S;O<E;O++)c[O]=R}const u=Ji.createVertex(i,ki.STATIC_DRAW,c.buffer),d=new Ga(e.transform,e.toMapSpace),p=new Zf(i,Wze,{data:l,componentIndices:rBt},{data:o,componentIndices:u},a),A=new fUt(p,wr.TRIANGLES,s,M(a)),v={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+u.byteSize+(M(a)?a.byteSize:0)};return new pUt(d,A,v)}_notifyDirty(){this._renderManager.notifyDirty()}}const rBt=wd(Cs().u16(z.COMPONENTINDEX));function WX(t,e){return t===e?Ea.All:t===0?Ea.None:Ea.Some}const lTe=ph(),G9=G(),j9=G();let eVe=class extends En{constructor(){super(...arguments),this.opacity=1}};function iBt(t){const e=new Ui;return e.include(s0),e.fragment.uniforms.add(new _r("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new ut("opacity",r=>r.opacity)),e.fragment.code.add(D`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const nBt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:eVe,build:iBt},Symbol.toStringTag,{value:"Module"}));var wc;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(wc||(wc={}));let Pse=class extends Nc{constructor(){super(...arguments),this.alphaMode=wc.None,this.hasOpacityFactor=!1}};h([ae({count:wc.COUNT})],Pse.prototype,"alphaMode",void 0),h([ae()],Pse.prototype,"hasOpacityFactor",void 0);let tVe=class rVe extends qi{initializeProgram(e){return new zi(e.rctx,rVe.shader.get().build(this.configuration),Di)}initializePipeline(){switch(this.configuration.alphaMode){case wc.None:return Pr({colorWrite:Gr});case wc.Alpha:return Pr({blending:Da(st.SRC_ALPHA,st.ONE,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),colorWrite:Gr});case wc.PremultipliedAlpha:case wc.COUNT:return Pr({blending:jm(st.ONE,st.ONE_MINUS_SRC_ALPHA),colorWrite:Gr})}}};tVe.shader=new Bi(nBt,()=>be(()=>import("./Compositing.glsl-c934fb1c.js"),[]));let iVe=class extends En{};function sBt(){const t=new Ui;return t.include(s0),t.fragment.uniforms.add(new _r("tex",e=>e.texture)),t.fragment.code.add(D`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),t}const oBt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:iVe,build:sBt},Symbol.toStringTag,{value:"Module"}));let nVe=class sVe extends qi{initializeProgram(e){return new zi(e.rctx,sVe.shader.get().build(),Di)}initializePipeline(){return Pr({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};nVe.shader=new Bi(oBt,()=>be(()=>import("./HUDCompositing.glsl-53c41cd3.js"),[]));let oVe=class extends En{};function aBt(){const t=new Ui;return t.include(s0),t.fragment.uniforms.add([new _r("colorTexture",e=>e.colorTexture),new _r("alphaTexture",e=>e.alphaTexture),new _r("frontFaceTexture",e=>e.frontFaceTexture)]),t.fragment.code.add(D`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const lBt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:oVe,build:aBt},Symbol.toStringTag,{value:"Module"}));let aVe=class lVe extends qi{initializeProgram(e){return new zi(e.rctx,lVe.shader.get().build(),Di)}initializePipeline(){return Pr({blending:Da(st.SRC_ALPHA,st.ONE,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),colorWrite:Gr})}};aVe.shader=new Bi(lBt,()=>be(()=>import("./OITCompositing.glsl-424c52bb.js"),[]));let cVe=class extends En{constructor(){super(...arguments),this.overlayIndex=bs.INNER,this.opacity=1}};function cBt(){const t=new Ui;return t.include(s0),t.fragment.uniforms.add(new _r("tex",e=>e.texture)),t.fragment.uniforms.add(new dF("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new ut("opacity",e=>e.opacity)),t.fragment.code.add(D`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`),t}const uBt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:cVe,build:cBt},Symbol.toStringTag,{value:"Module"}));let uVe=class hVe extends qi{initializeProgram(e){return new zi(e.rctx,hVe.shader.get().build(),Di)}initializePipeline(){return Pr({blending:jm(st.ONE,st.ONE_MINUS_SRC_ALPHA),colorWrite:Gr})}};uVe.shader=new Bi(uBt,()=>be(()=>import("./OverlayCompositing.glsl-2ebd7e65.js"),[]));let hBt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new Pse,this._passParameters=new eVe,this._oitParameters=new oVe,this._hudParameters=new iVe,this._overlayParameters=new cVe}destroy(){this._vao=kt(this._vao)}compositeOIT(e,r,i,n){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=n;const s=this._rctx,o=this._techniqueRepository.acquire(aVe);s.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(wr.TRIANGLE_STRIP,0,Xl(a,"geometry")),o.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._rctx,n=this._techniqueRepository.acquire(nVe);i.bindTechnique(n,this._hudParameters,e);const s=this._ensureVAO();i.bindVAO(s),i.drawArrays(wr.TRIANGLE_STRIP,0,Xl(s,"geometry")),n.release()}compositeOverlay(e,r,i,n){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=n;const s=this._rctx,o=this._techniqueRepository.acquire(uVe);s.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(wr.TRIANGLE_STRIP,0,Xl(a,"geometry")),o.release()}composite(e,r,i=wc.None,n=1){const s=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=r,this._passParameters.opacity=n;const o=this._techniqueRepository.acquire(tVe,this._configuration);s.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(wr.TRIANGLE_STRIP,0,Xl(a,"geometry")),o.release()}_ensureVAO(){return k(this._vao)&&(this._vao=Fc(this._rctx)),this._vao}};const dBt=1e4,Ise=100,pBt=500,fBt=500,mBt=.1;function gBt(t,e,r){return fde(e,t)*(r[1]-r[0])+r[0]}function ABt(t,e,r){let i=0;if(!e.some(s=>(i+=s.numGeometries,i>=dBt)))return SBt.compute(t,e);const n=mF();return r.forAll(s=>{s.visible&&PO(n,yBt(t,s))}),n}function yBt(t,e){if(!e.visible)return;const r=mF(),i=e.getSpatialQueryAccelerator();return M(i)?_Bt(r,t,i):vBt(r,t,e.objects),r}function _Bt(t,e,r){const i=e.eye,n=e.viewForward,s=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<pBt)GL(df,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,n,gm.DepthOrder.FRONT_TO_BACK,df,(l,c)=>{$se(t,e,l),df.far=t.near,c.setRange(df)},s,o),GL(df,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,n,gm.DepthOrder.BACK_TO_FRONT,df,(l,c)=>{$se(t,e,l),df.near=t.far,c.setRange(df)},s,o);else{const l=Math.max(Math.min(a,fBt),Math.ceil(a*mBt)),c=r.findClosest(n,gm.DepthOrder.FRONT_TO_BACK,s,o,l),u=r.findClosest(n,gm.DepthOrder.BACK_TO_FRONT,s,o,l);c&&u&&(cTe(t,e,c.boundingVolumeWorldSpace.bounds),cTe(t,e,u.boundingVolumeWorldSpace.bounds))}}function vBt(t,e,r){H3.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&H3.add(i)}),H3.empty||(H3.sort(e),GL(df,e.near,Math.min(t.near,e.far)),H3.forEachInDepthRange(df,gm.DepthOrder.FRONT_TO_BACK,(i,n)=>{n<t.near&&$se(t,e,i)}),GL(df,Math.max(t.far,e.near),e.far),H3.forEachInDepthRange(df,gm.DepthOrder.BACK_TO_FRONT,(i,n,s)=>{t.far=Math.max(t.far,s)}))}function $se(t,e,r){if(!r.visible||!Zb(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,n=TBt;r.geometries.forEach(s=>{js(n,i,s.shaderTransformation);const o=$S(n);dVe(t,e,s.boundingInfo,n,o)})}function dVe(t,e,r,i,n){if(k(r))return;Ot(jl,r.center,i);const{eye:s,viewForward:o}=e,a=o[0]*(jl[0]-s[0])+o[1]*(jl[1]-s[1])+o[2]*(jl[2]-s[2]);if(jl[3]=r.radius*n,!(a-jl[3]>t.near&&a+jl[3]<t.far)&&Zb(e.frustum,jl))if(r.radius>Ise&&r.getChildren())for(const l of r.getChildren())dVe(t,e,l,i,n);else Dse.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function cTe(t,e,r){const i=e.eye,n=e.viewForward,s=(r[0]-i[0])*n[0]+(r[1]-i[1])*n[1]+(r[2]-i[2])*n[2];t.near=Math.min(t.near,s-r[3]),t.far=Math.max(t.far,s+r[3])}let bBt=class{constructor(){this._items=new Vr({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(n=>{const s=n.obj.boundingVolumeWorldSpace.bounds,o=(s[0]-r[0])*i[0]+(s[1]-r[1])*i[1]+(s[2]-r[2])*i[2];n.distance=o,n.near=o-s[3],n.far=o+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(e,r,i){if(r===gm.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<e.near||s.near>e.far||i(s.obj,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<e.near||s.near>e.far||i(s.obj,s.near,s.far)}}},wBt=class{constructor(){this._view=ht(),this._viewProj=ht(),this._frustum=_L(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),Ia(this._view,e.viewMatrix),js(this._viewProj,e.projectionMatrix,this._view),mz(this._frustum,e.frustum);const i=this._view,n=i[2],s=i[6],o=i[10],a=i[14];r.forAll(p=>p.forEachGeometry(A=>{if(!A.visible||!A.castShadow)return;let v;A.hasShaderTransformation?(A.computeBoundingSphere(A.shaderTransformation,jl,1),v=jl):v=A.boundingSphere;const b=n*v[0]+s*v[1]+o*v[2]+a,S=b-v[3],E=b+v[3];this._geometries.push(A),this._near.push(-E),this._far.push(-S)}));const l=new mUt;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,d=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=c.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=c.far?l.far=this._far[p]:this._farCandidates[d++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,A)=>this._near[p]<this._near[A]?-1:this._near[p]>this._near[A]?1:0),this._farCandidates.sort((p,A)=>this._far[p]<this._far[A]?1:this._far[p]>this._far[A]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){const A=this._nearCandidates[p];if(this._near[A]<l.near){const v=this._geometries[A],b=v.boundingInfo;this._includeNearBoundingInfoRec(b,v.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){const A=this._farCandidates[p];if(this._far[A]>l.far){const v=this._geometries[A],b=v.boundingInfo;this._includeFarBoundingInfoRec(b,v.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(k(e))return;const n=e.center;Ot(jl,n,r);const s=$S(r),o=jl[0],a=jl[1],l=jl[2],c=e.radius*s,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=d+c;if(!(-(d-c)<2||-p>=i.near))if(-p>this._looseRange.near)i.near=-p;else{if(c>Ise){const A=e.getChildren();if(A!==void 0){for(const v of A)this._includeNearBoundingInfoRec(v,r,i);return}}Dse.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(k(e))return;let n=e.radius;const s=e.center;Ot(jl,s,r);const o=$S(r),a=jl[0],l=jl[1],c=jl[2];n*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>n||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>n||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>n||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>n)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-n;if(!(-d<=i.far))if(-d<this._looseRange.far)i.far=-d;else{if(n>Ise){const p=e.getChildren();if(p!==void 0){for(const A of p)this._includeFarBoundingInfoRec(A,r,i);return}}Dse.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},xBt=class{constructor(){this._modelViewProj=ht(),this._clipPosition=[Kr(),Kr(),Kr(),Kr(),Kr(),Kr(),Kr(),Kr()]}unionDepthRangeWithAABB(e,r,i,n,s){const o=this._modelViewProj;js(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?n[0]:s[0],d=l===0||l===1||l===4||l===5?n[1]:s[1],p=l<4?n[2]:s[2];c[0]=o[0]*u+o[4]*d+o[8]*p+o[12],c[1]=o[1]*u+o[5]*d+o[9]*p+o[13],c[2]=o[2]*u+o[6]*d+o[10]*p+o[14],c[3]=o[3]*u+o[7]*d+o[11]*p+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[QX[l][0]],u=this._clipPosition[QX[l][1]],d=this._clipPosition[QX[l][2]],p=this._clipTriangle(c,u,d);let A=!0;for(let v=0;v<p.length;++v)if(p[v][3]>=2){A=!1;break}if(!A){a=!0;for(let v=0;v<p.length;++v){const b=p[v][3];Number.isFinite(b)&&(e.near=Math.min(b,e.near),e.far=Math.max(b,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void tr(!1)}_intersect(e,r,i){let n=0;return i===0?n=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?n=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?n=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(n=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),CG(Kr(),e,r,n)}_clipTriangle(e,r,i){let n=[e,r,i];for(let s=0;s<4;++s){const o=n;n=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,s)?(this._inside(l,s)||n.push(this._intersect(l,c,s)),n.push(c)):this._inside(l,s)&&n.push(this._intersect(l,c,s))}}return n}};const QX=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],jl=Ho(),TBt=ht(),df=mF(),H3=new bBt,SBt=new wBt,Dse=new xBt;let EBt=class{},CBt=class extends En{constructor(){super(...arguments),this.textures=new EBt}};function MBt(){const t=new Ui;return t.attributes.add(z.POSITION,"vec2"),t.vertex.uniforms.add(new pi("drawPosition",(e,r)=>RBt(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(D`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new _r("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new _r("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new _r("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new z_("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new z_("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(D`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function RBt(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,n=t.magnifier.offset.y*r;tA(t.magnifier.position,uTe);const s=e.camera.screenToRender(uTe,OBt),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return pn(PBt,(s[0]+i)/a*2-1,(s[1]-n)/l*2-1,o/a*2,o/l*2)}const uTe=Ns(),OBt=QPe(),PBt=Kr();async function IBt(t){const e=be(()=>import("./mask-svg-023bbc42.js"),[]),r=be(()=>import("./overlay-svg-d62383f3.js"),[]),i=u1((await e).default,{signal:t}),n=u1((await r).default,{signal:t}),s={mask:await i,overlay:await n};return fi(t),s}let QC=class extends rt{constructor(){super(...arguments),this._handles=new cn,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new CBt,this.events=new Ws,this.attributeLocations=new Map([[z.POSITION,0]]),this._tmpScreenPoint=Ns(),this._tmpRenderPoint=QPe()}get updating(){return k(this._imageSources)&&M(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};M(this._magnifier)&&this._handles.add(xe(()=>rl(this._magnifier,i=>i.version),r)),r()}get enabled(){return M(this._validMagnifier)}get _validMagnifier(){return M(this._magnifier)&&this._magnifier.visible&&M(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get _factor(){return M(this._magnifier)&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),M(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(k(i))return;const n=r.camera.pixelRatio,s=Math.ceil(n*i.size);if(this._updateResources(e,s),k(this._resources))return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*s);o.input.resize(a,a),tA(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,u=r.camera.fullHeight,d=.5*a,p=.5*a;l[0]=He(l[0],d,c-d-1),l[1]=He(l[1],p,u-p-1);const A=Math.floor(l[0]-d),v=Math.floor(l[1]-p),b=this._resources.program;b.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,A,v,a,a,0),this._passParameters.magnifier=i,e.useProgram(b),b.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(wr.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(k(e))return;const r=e.maskUrl,i=e.overlayUrl;!M(this._imageLoadTask)||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),M(this._imageSources)||M(this._imageLoadTask)||(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:xN(async n=>{const s=k(r)||k(i)?IBt(n):null,o=M(r)?u1(r,{signal:n}):s.then(l=>l.mask),a=M(i)?u1(i,{signal:n}):s.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(M(this._resources)){if(this._passParameters.textures.size!==r){const n=this._createTextureResources(e,r);if(k(n))return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=n}return}const i=this._createTextureResources(e,r);k(i)||(this._resources={program:this._createProgram(e),vao:Fc(e,the,this.attributeLocations,0,1),pipelineState:Pr({blending:jm(st.ONE,st.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Gr})},this._passParameters.textures=i)}_disposeResources(){k(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(k(this._imageSources))return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new Xt(e,{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,internalFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:zt.LINEAR,flipped:!0,preMultiplyAlpha:!tOe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result},this._imageSources.overlay),n=new Xt(e,{target:cr.TEXTURE_2D,pixelFormat:_t.ALPHA,internalFormat:_t.ALPHA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:zt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new Xt(e,{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,internalFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:zt.LINEAR,flipped:!1}),mask:n,overlay:i,size:r}}_createProgram(e){return new zi(e,MBt(),this.attributeLocations)}};h([f()],QC.prototype,"_imageSources",void 0),h([f()],QC.prototype,"_imageLoadTask",void 0),h([f({readOnly:!0})],QC.prototype,"updating",null),QC=h([Q("esri/views/3d/webgl-engine/lib/MagnifierHelper")],QC);let $Bt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Ic(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,n,s,o=null,a=null,l=null){if(!(e&&r&&i&&n)||(this._layerUidToId.set(n,i),this._layerUidToPopupEnabled.set(n,s),!s))return;let c=this._layerUidToGraphicsUidToObjectId.get(n);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(n,c)),c.set(r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return Fr(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return we.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(e.layerUid);i||(i=new Map,this._uidToRenderColor.set(e.layerUid,i));let n=i.get(e.graphicUid);if(!n){for(;!n;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(n=o)}if(n>16777215)throw new Error("Object ID Overflow");i.set(e.graphicUid,n),this._colorToUID.set(n,e)}const s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new Ic(s)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const n=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let s=null;n?(s=n.get(i.graphicUid),s||we.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):we.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||we.getLogger(this.declaredClass).warn("no layerId found for uid "+i.layerUid),s&&o&&e.set(r,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:o,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:o})}return e}};var jL;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(jL||(jL={}));let Ev=class{constructor(e,r,i=jL.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new Vr({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,n){const s=this._draws.pushNew();s.geometry=r,s.geometryRanges=i,s.material=e,s.depthSquaredHint=n,s.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}dispatch(e,r){const i=this._rctx;this._previouslyBoundDraw.clear();let n=null;const s=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,e,r,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=s[a];l===n&&l.configuration.transparencyPassType===dr.NONE||(i.bindTechnique(l,e,r),n=l);const c=this._draws.data[a],u=c.geometry;i.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,p=d.length;if(c.indexType!==0){const A=vU.get(c.indexType);for(let v=0;v<p;v+=2){const b=d[v],S=d[v+1];i.drawElements(u.primitiveType,S,c.indexType,b*A)}}else for(let A=0;A<p;A+=2){const v=d[A],b=d[A+1];i.drawArrays(u.primitiveType,v,b)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===jL.FrontToBack?1:-1;this._draws.sort((r,i)=>{const n=e*(r.depthSquaredHint-i.depthSquaredHint);return n!==0?n:r.geometry.vao.size-i.geometry.vao.size})}get count(){return this._draws.length}};const vU=new Map;vU.set(Yt.UNSIGNED_BYTE,1),vU.set(Yt.UNSIGNED_SHORT,2),vU.set(Yt.UNSIGNED_INT,4);let DBt=class{constructor(e,r){this.rctx=e,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new o7t,this._shadowPassParameters=new a7t,this._highlightPassParameters=new l7t,this._systems=new Set,this._passes={materialOpaque:new Ev(e,r),materialTransparent:new Ev(e,r,jL.BackToFront),materialIntegratedMesh:new Ev(e,r),shadowMap:new Ev(e,r),highlight:new Ev(e,r),highlightIntegratedMesh:new Ev(e,r),highlightShadowMap:new Ev(e,r),defaultShadowMap:new Ev(e,r)}}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(e){if(this._systems.size!==0)switch(this._configure(e),this._materialPassParameters.output=e.output,e.bindParameters.slot){case nt.OPAQUE_MATERIAL:switch(e.output){case ne.Color:case ne.Depth:case ne.Normal:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters);case ne.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,e.bindParameters);case ne.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case ne.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case ne.ShadowExcludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case ne.ObjectAndLayerIdColor:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters)}return;case nt.TRANSPARENT_MATERIAL:switch(e.output){case ne.Color:case ne.Alpha:case ne.Depth:case ne.Normal:case ne.ObjectAndLayerIdColor:return this._passes.materialTransparent.dispatch(this._materialPassParameters,e.bindParameters)}return;case nt.INTEGRATED_MESH:switch(e.output){case ne.Color:case ne.Depth:case ne.Normal:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters);case ne.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,e.bindParameters);case ne.ObjectAndLayerIdColor:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[nt.OPAQUE_MATERIAL,nt.TRANSPARENT_MATERIAL,nt.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const n=i.queryShadowCasterDepthRange(e);M(n)&&PO(r,n,r)}),r}_configure(e){const r=e.output===ne.Shadow||e.output===ne.ShadowHighlight||e.output===ne.ShadowExcludeHighlight?this._shadowPassParameters:e.output===ne.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,r)}_updateParameters(e,r){const i=e.bindParameters.camera,n=i.viewInverseTransposeMatrix;Le(YX,n[3],n[7],n[11]),XX.set(YX),Pe(r.transformWorldFromViewTH,XX.high),Pe(r.transformWorldFromViewTL,XX.low),Pe(r.slicePlaneLocalOrigin,YX),Jf(r.transformViewFromCameraRelativeRS,i.viewMatrix),Ia(r.transformProjFromView,i.projectionMatrix),r.identifier===rd.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===nt.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===nt.INTEGRATED_MESH,Kf(hTe,r.transformViewFromCameraRelativeRS),SE(r.transformNormalViewFromGlobal,hTe))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const YX=G(),hTe=Es(),XX=new OH;let LBt=class{constructor(){this._step=fTe,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,Fe("enable-feature:high-quality-idle")){const n=r?performance.now()-this._firstIdleTime:0;if(n>=dTe+FBt)return this._step=1/0,void(this._dilation=1);this._dilation=n>=dTe?kBt:1}else this._dilation=1;const i=He(e/NBt,fTe,BBt);this._step===1/0?this._step=i:this._step=this._step*pTe+i*(1-pTe)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const NBt=.5,dTe=6e4,FBt=5e3,kBt=10,pTe=.9,UBt=30,fTe=1e3/1,BBt=1e3/UBt,zBt=8.6,VBt=.4;function GBt(){const t=new Ui,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(z.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(z.UV0,"vec2"),e.uniforms.add(new _r("coverageTex",s=>s.coverageTexture)),i.add(D`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new _r("tex",s=>s.blurColorTexture)),r.uniforms.add(new _r("origin",s=>s.highlightColorTexture)),r.uniforms.add(new pi("uColor",s=>s.color)),r.uniforms.add(new pi("haloColor",s=>s.haloColor)),r.uniforms.add(new pi("opacities",s=>pn(jBt,s.haloOpacity,s.haloOpacityOccluded,s.fillOpacity,s.fillOpacityOccluded))),r.constants.add("outlineSize","float",zBt),r.constants.add("blurSize","float",VBt),n.add(D`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const jBt=Kr(),HBt=Object.freeze(Object.defineProperty({__proto__:null,build:GBt},Symbol.toStringTag,{value:"Module"}));let pVe=class fVe extends qi{initializeProgram(e){return new zi(e.rctx,fVe.shader.get().build(),Di)}initializePipeline(){return Pr({blending:Da(st.SRC_ALPHA,st.ONE,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),colorWrite:Gr})}};pVe.shader=new Bi(HBt,()=>be(()=>import("./HighlightApply.glsl-cd8019d1.js"),[]));let mVe=class extends En{constructor(){super(...arguments),this.blurSize=Ft()}};function qBt(){const t=new Ui,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(z.POSITION,"vec2"),t.attributes.add(z.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new _r("coverageTex",s=>s.coverageTexture)),r.uniforms.add(new AL("blurSize",s=>s.blurSize)),i.add(D`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new ZN("tex",s=>s.blurInputTexture)),n.add(D`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),t}const WBt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:mVe,build:qBt},Symbol.toStringTag,{value:"Module"}));let gVe=class AVe extends qi{initializeProgram(e){return new zi(e.rctx,AVe.shader.get().build(),Di)}initializePipeline(){return Pr({colorWrite:Gr})}};gVe.shader=new Bi(WBt,()=>be(()=>import("./HighlightBlur.glsl-8b0015d5.js"),[]));let yVe=class extends En{constructor(){super(...arguments),this.invFramebufferDim=Ft()}};function QBt(){const t=new Ui,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(z.POSITION,"vec2"),i.add(D`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new ZN("tex",s=>s.inputTexture)),r.uniforms.add(new AL("invFramebufferDim",s=>s.invFramebufferDim)),n.add(D`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const YBt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:yVe,build:QBt},Symbol.toStringTag,{value:"Module"}));let _Ve=class vVe extends qi{initializeProgram(e){return new zi(e.rctx,vVe.shader.get().build(),Di)}initializePipeline(){return Pr({colorWrite:Gr})}};_Ve.shader=new Bi(YBt,()=>be(()=>import("./HighlightDownsample.glsl-b22b6b88.js"),[]));let mTe=class extends En{constructor(){super(...arguments),this.color=Bm(1,0,1,1),this.haloColor=Bm(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Fr(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const XBt=32;let ZBt=class{constructor(e,r){this._techniqueRep=e,this._rctx=r,this._viewportToRestore=Kr(),this._passParameters=new mTe,this._downsampleDrawParameters=new yVe,this._blurDrawParameters=new mVe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=Fc(this._rctx);const e={colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE,width:0,height:0},r={target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.LINEAR,wrapMode:Ar.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new uo(this._rctx,e,r),this._blur1Fbo=new uo(this._rctx,e,r),this._blurTechnique=this._techniqueRep.acquire(gVe),this._downsampleTechnique=this._techniqueRep.acquire(_Ve),this._applyTechnique=this._techniqueRep.acquire(pVe)}dispose(){if(this._blurTechnique=us(this._blurTechnique),this._downsampleTechnique=us(this._downsampleTechnique),this._applyTechnique=us(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._blur0Fbo=kt(this._blur0Fbo),this._blur1Fbo=kt(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new mTe,...e}}render(e,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const n=e.camera;lm(this._viewportToRestore,n.fullViewport);const s=n.fullWidth,o=n.fullHeight,a=n.pixelRatio,l=Math.ceil(s/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const u=this._rctx;u.bindVAO(this._quadVAO);let d=null;this._gridUpdateResources(r,XBt),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,d=this._grid.vao;const p=u.bindTechnique(this._blurTechnique,this._passParameters,e);u.bindVAO(d),u.bindFramebuffer(this._blur0Fbo),u.setViewport(0,0,l,c),u.setClearColor(0,0,0,0),u.clear(rs.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,ti(this._blurDrawParameters.blurSize,1/l,0),p.bindDraw(this._blurDrawParameters,e,this._passParameters),u.drawArrays(this._blurTechnique.primitiveType,0,Xl(d,"geometry")),u.bindFramebuffer(this._blur1Fbo),u.clear(rs.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,ti(this._blurDrawParameters.blurSize,0,1/c),p.bindDraw(this._blurDrawParameters,e,this._passParameters),u.drawArrays(this._blurTechnique.primitiveType,0,Xl(d,"geometry")),u.bindFramebuffer(i),u.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,u.bindTechnique(this._applyTechnique,this._passParameters,e),u.drawArrays(this._applyTechnique.primitiveType,0,Xl(d,"geometry")),u.bindVAO(null)}_gridUpdateResources(e,r){const i=this._rctx,n=this._grid;let s=!1;if(n.coverageMipmap===null&&(n.coverageMipmap=[e],s=!0),n.viewportWidth===e.width&&n.viewportHeight===e.height||(s=!0,n.viewportWidth=e.width,n.viewportHeight=e.height),n.coverageMipmap[0]=e,n.cellPixelSize!==r&&(n.cellPixelSize=r,s=!0),s){for(let l=1;l<n.coverageMipmap.length;l++)n.coverageMipmap[l].dispose();n.mipmapLevels=Math.ceil(Math.log(n.cellPixelSize)*Math.LOG2E),n.coverageMipmap.length=n.mipmapLevels+1;for(let l=0;l<n.mipmapLevels;l++){const c=n.coverageMipmap[l],u={target:cr.TEXTURE_2D,pixelFormat:_t.RGB,dataType:xr.UNSIGNED_SHORT_5_6_5,samplingMode:zt.LINEAR,wrapMode:Ar.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},d={colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};n.coverageMipmap[l+1]=new uo(i,d,u)}}const o=Math.ceil(e.height/n.cellPixelSize),a=Math.ceil(e.width/n.cellPixelSize);if(!n.vao||n.verticalCellCount!==o||n.horizontalCellCount!==a){n.verticalCellCount=o,n.horizontalCellCount=a;const l=o+1,c=a+1,u=1/o,d=1/a,p=6,A=4,v=new Float32Array(p*A*l*c);let b=0;for(let S=0;S<l;S++)for(let E=0;E<c;E++)v[b+0]=(E-.5)*d*2-1,v[b+1]=(S-.5)*u*2-1,v[b+2]=E*d,v[b+3]=S*u,v[b+4]=(E+.5)*d*2-1,v[b+5]=(S-.5)*u*2-1,v[b+6]=E*d,v[b+7]=S*u,v[b+8]=(E-.5)*d*2-1,v[b+9]=(S+.5)*u*2-1,v[b+10]=E*d,v[b+11]=S*u,v[b+12]=(E-.5)*d*2-1,v[b+13]=(S+.5)*u*2-1,v[b+14]=E*d,v[b+15]=S*u,v[b+16]=(E+.5)*d*2-1,v[b+17]=(S-.5)*u*2-1,v[b+18]=E*d,v[b+19]=S*u,v[b+20]=(E+.5)*d*2-1,v[b+21]=(S+.5)*u*2-1,v[b+22]=E*d,v[b+23]=S*u,b+=p*A;n.vao&&n.vao.dispose(!0),n.vao=new Hm(i,Di,{geometry:gP},{geometry:Ji.createVertex(i,ki.STATIC_DRAW,v)})}}_gridComputeMipmap(e){const r=this._rctx,i=this._grid,n=r.bindTechnique(this._downsampleTechnique,this._passParameters,e);r.bindVAO(this._quadVAO);for(let s=0;s<i.mipmapLevels;s++){r.bindFramebuffer(i.coverageMipmap[s+1]);const o=i.coverageMipmap[s+1].width,a=i.coverageMipmap[s+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[s].colorTexture,ti(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),n.bindDraw(this._downsampleDrawParameters,e,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(wr.TRIANGLE_STRIP,0,Xl(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(M(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(M(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)e+=r.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const JBt={dataType:xr.UNSIGNED_BYTE,internalFormat:_t.RGBA},KBt={};let ezt=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=e.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(e=>e.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(e=>e.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(e){const r=e.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._depthBuffers,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(e,r){const i=e.get(r);i&&(this._framebuffers.forEach((n,s)=>{n.colorAttachment!==i&&n.depthStencilAttachment!==i||(n.detachAll(),n.dispose(),this._framebuffers.delete(s))}),i.dispose(),e.delete(r))}getDepthTexture(e,r){if(!this.depthTextureSupported)return null;let i=this._depthTextures.get(e.id);return!i||i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=AS()),i||(i=new Xt(this._rctx,{target:cr.TEXTURE_2D,pixelFormat:_t.DEPTH_STENCIL,dataType:xr.UNSIGNED_INT_24_8,samplingMode:zt.NEAREST,wrapMode:Ar.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._depthTextures.set(e.id,i),this._activeTargets.add(e.id)),i}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getDepthBuffer(e,r){if(this.depthTextureSupported)return null;let i=this._depthBuffers.get(e.id);return i?i.descriptor.width===r.width&&i.descriptor.height===r.height||i.resize(r.width,r.height):(i=new kC(this._rctx,{internalFormat:lu.DEPTH_STENCIL,...r}),this._depthBuffers.set(e.id,i),this._activeTargets.add(e.id)),i}getColorTexture(e,r){let i=this._colorTextures.get(e.id);return i&&(i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=AS())),i||(i=new Xt(this._rctx,{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,internalFormat:e.internalFormat,dataType:e.dataType,samplingMode:e.samplingMode!=null?e.samplingMode:zt.LINEAR,wrapMode:Ar.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._colorTextures.set(e.id,i),this._activeTargets.add(e.id)),i}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:hd(),...KBt,...e}}registerColorTarget(e={}){return{id:hd(),...JBt,...e}}getFramebuffer(e,r,i){const n=this._getKey(r,i);let s=this._framebuffers.get(n);const o=this.getColorTexture(r,e);if(this.depthTextureSupported){const l=i?this.getDepthTexture(i,e):void 0;return s?((s.width!==e.width||s.height!==e.height||s.colorTexture!==o||s.depthStencilTexture!==l)&&(s.detachAll(),s.resize(e.width,e.height),s.attachColorTexture(o),s.attachDepthStencilTexture(l)),s):(s=M(i)?new uo(this._rctx,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.DEPTH_STENCIL_TEXTURE},o,l):new uo(this._rctx,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE},o),this._framebuffers.set(n,s),s)}const a=i?this.getDepthBuffer(i,e):void 0;return s?((s.width!==e.width||s.height!==e.height||s.colorTexture!==o)&&(s.detachAll(),s.resize(e.width,e.height),s.attachColorTexture(o),s.attachDepthStencilBuffer(a)),s):(s=new uo(this._rctx,{colorTarget:Fs.TEXTURE,depthStencilTarget:i?Ni.DEPTH_STENCIL_RENDER_BUFFER:Ni.NONE},o,a),this._framebuffers.set(n,s),s)}_getKey(e,r){return`${e.id}_${r?r.id:"X"}_${e.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let e=0;const r=new Set,i=n=>{r.has(n)||(r.add(n),e+=VS(n))};return this._depthTextures.forEach(i),this._colorTextures.forEach(i),this._depthBuffers.forEach(i),e}},tzt=class{constructor(e,r){this._rctx=e,this._compositingHelper=r,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._background={type:"color",color:[0,0,0,1]};const i=e.type===lr.WEBGL2;this._renderTargetHelper=new ezt(e);const n=this._renderTargetHelper;this._mainColorTargets=[n.registerColorTarget({name:"mainColorTarget0"}),n.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=n.registerColorTarget({name:"frontFaceTarget"});const s=o=>n.registerColorTarget({name:o,dataType:xr.FLOAT,internalFormat:i?pr.RGBA32F:_t.RGBA,samplingMode:zt.NEAREST});this.colorFloatTarget=s("colorFloatTarget"),this.alphaFloatTarget=s("alphaFloatTarget"),this.mainDepth=n.registerDepthTarget({name:"mainDepth"}),this.linearDepth=n.registerColorTarget({name:"linearDepth",samplingMode:zt.NEAREST}),this.terrainLinearDepth=n.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=n.registerColorTarget({name:"geometryLinearDepth"}),this.normal=n.registerColorTarget({name:"normal"}),this.highlight=n.registerColorTarget({name:"highlight",internalFormat:i?pr.RGBA4:_t.RGBA,dataType:xr.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=n.registerColorTarget({name:"hudVisibility",internalFormat:i?pr.RGBA4:_t.RGBA,dataType:xr.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=n.registerColorTarget({name:"tmpColor"}),this.tmpDepth=n.registerDepthTarget({name:"tmpDepth"}),this.hudColor=n.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,r){return this._renderTargetHelper.getFramebuffer(this._dimensions,e,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1])),this._mainColorTarget=this._mainColorTarget===0&&e?1:0}initializeFrame(e){const r=this._rctx;this._dimensions.width=e.fullWidth,this._dimensions.height=e.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(rs.COLOR_BUFFER_BIT|rs.DEPTH_BUFFER_BIT|rs.STENCIL_BUFFER_BIT)}composite(e){M(this.colorTexture)&&this._compositingHelper.composite(e,this.colorTexture,wc.None)}renderTmpAndCompositeToMain(e,r,i,n=!1){this.renderToTargets(e,this.tmpColor,n?this.tmpDepth:this.mainDepth,rzt),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}renderHUDVisibility(e,r=!1){this.renderToTargets(e,this.hudVisibility,r?this.tmpDepth:this.mainDepth,izt)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,r,i){let n,s;switch(r){case dr.Color:n=this.colorFloatTarget,s=[0,0,0,0];break;case dr.Alpha:n=this.alphaFloatTarget,s=[1,1,1,1];break;case dr.FrontFace:n=this.frontFaceTarget,s=[0,0,0,0]}i?this.renderToTargets(e,n,this.tmpDepth,s,!0,!0):this.renderToTargets(e,n,this.mainDepth,s,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),wc.PremultipliedAlpha)}compositeOccludedOntoMain(e,r){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),wc.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(e,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(rs.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,r,i=!1,n=!1){const s=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);s.setClearColor(r[0],r[1],r[2],l),o|=rs.COLOR_BUFFER_BIT}i&&(o|=rs.DEPTH_BUFFER_BIT),n===!1?n=0:(n===!0&&(n=255),o|=rs.STENCIL_BUFFER_BIT),o&&s.clearSafe(o,n),e(),s.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,r,i,n,s=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(e,n,s,o),a}bindTarget(e,r){const i=this._renderTargetHelper.getFramebuffer(this._dimensions,e,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this._dimensions)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const rzt=[0,0,0,0],izt=[0,1,0,1];let nzt=class{constructor(e){this._context=e,this._renderPlugins=new Vr,this._slots=[];for(let r=0;r<nt.MAX_SLOTS;++r)this._slots[r]=[]}add(e,r,i){const n=()=>{if(i!=null&&i.aborted)throw r.uninitializeRenderContext(),en();this._renderPlugins.push(r);for(const o of e)this._slots[o].push(r);this._context.requestRender()},s=r.initializeRenderContext(this._context,i);if(Op(s))return s.then(n);n()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender()}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;e.filter(i=>{if(!i.canRender)return!1;if(szt(i)){const n=i.prepareTechnique(this._context.renderContext);return!!n&&(r.push(n),!0)}return r.push(null),!0}).forEach((i,n)=>i.render(this._context.renderContext,r[n]))}queryDepthRange(e){const r=ozt;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const n=i.queryDepthRange(e);n&&PO(r,n,r)}}),r}get needsTransparentPass(){return this._renderPlugins.some(e=>!!e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>!!e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>!!e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[nt.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,0)}};function szt(t){return"prepareTechnique"in t}const ozt={near:0,far:0};let bVe=class extends qke{};const PH=255,azt=1/PH;function lzt(t){const e=new Ui,r=e.fragment;return r.include(bd),r.include(Tp),e.include(fH),e.include(s0),e.include(pH,t),r.uniforms.add([new _r("depthMap",i=>i.linearDepthTexture),new fs("inverseViewMatrix",(i,n)=>Ml(gTe,Ah(gTe,n.camera.viewMatrix,n.camera.center))),new ji("nearFar",(i,n)=>n.camera.nearFar)]),r.constants.add("sampleValue","float",azt),r.code.add(D`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const gTe=ht(),czt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:bVe,ShadowCastMaxSamples:PH,build:lzt},Symbol.toStringTag,{value:"Module"}));var tE;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(tE||(tE={}));let Lse=class extends Nc{constructor(){super(...arguments),this.visualization=tE.Gradient,this.bandsEnabled=!1}};h([ae({count:tE.COUNT})],Lse.prototype,"visualization",void 0),h([ae()],Lse.prototype,"bandsEnabled",void 0);let wVe=class extends En{constructor(e){super(),this.shadowCastMap=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=DN(uzt),this.bandSize=.1,this.threshold=.5}};const uzt=Fr(.01,0,.25,1);function hzt(t){const e=new Ui,r=e.fragment;r.include(bd),r.include(Tp),e.include(fH),e.include(s0);const{visualization:i,bandsEnabled:n}=t;r.constants.add("inverseSampleValue","float",PH),r.uniforms.add([new _r("shadowCastMap",a=>a.shadowCastMap),new ut("sampleScale",a=>a.sampleScale),new ut("opacityFromElevation",a=>a.opacityFromElevation),new pi("uColor",a=>a.color)]);const s=i===tE.Gradient,o=i===tE.Threshold;return s&&n?r.uniforms.add(new ut("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new ut("threshold",a=>a.threshold)),r.code.add(D`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?D`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${s&&n?D`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?D`* strength`:""});
      }
    `),e}const dzt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:wVe,build:hzt},Symbol.toStringTag,{value:"Module"}));let xVe=class TVe extends qi{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new zi(e.rctx,TVe.shader.get().build(this.configuration),Di)}initializePipeline(){return Pr({blending:_p,colorWrite:Gr,depthTest:null,depthWrite:null})}get primitiveType(){return wr.TRIANGLE_STRIP}};xVe.shader=new Bi(dzt,()=>be(()=>import("./ShadowCastVisualize.glsl-4cef1ea3.js"),[]));const pzt=4e4,fzt=5e4,SVe=1/512;let bU=class extends rt{constructor(e,r,i,n){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=n,this._passParameters=new wVe(this._data.shadowCastTexture),this._techniqueConfig=new Lse,this._enabled=!1,this._vao=Fc(r),this._techniqueConfig.visualization=tE.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=kt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(xVe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,this._passParameters,e),this._rctx.drawArrays(r.primitiveType,0,Xl(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>SVe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;YM(e,r)||(lm(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};h([f()],bU.prototype,"opacityFromElevation",null),bU=h([Q("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],bU);let pV=class extends Nc{constructor(){super(...arguments),this.receiveShadows=!0,this.hasWebGL2Context=!1}};h([ae()],pV.prototype,"receiveShadows",void 0),h([ae()],pV.prototype,"hasWebGL2Context",void 0);let EVe=class CVe extends qi{constructor(e){super(e,new pV,()=>this.destroy())}initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2}initializeProgram(e){return new zi(e.rctx,CVe.shader.get().build(this.configuration),Di)}initializePipeline(){return Pr({blending:Da(st.ONE,st.ONE,st.ONE,st.ONE),colorWrite:Gr,depthTest:null,depthWrite:null})}get primitiveType(){return wr.TRIANGLE_STRIP}};EVe.shader=new Bi(czt,()=>be(()=>import("./ShadowCastAccumulate.glsl-f76254a7.js"),[]));let Yu=class extends rt{constructor(e,r,i,n,s,o){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=n,this._renderToShadowMap=s,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new bVe,this._enabledInternal=!1,this._cachedLightDirections=[],this._depthRange=Cse,this._previewing=!1,this._handles=new cn,this._cameraForcedForScreenshot=!1,this._bindParameters=new Dj(new Fde(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=Fc(e);const a={colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE,width:0,height:0},l={target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.LINEAR,wrapMode:Ar.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new uo(e,a,l),this._accumulationRenderer=new bU(r,e,this,o);const c=this._stage.view.resourceController.scheduler;this._handles.add([c.registerTask(ar.SHADOW_ACCUMULATOR,this),xe(()=>i.renderView,u=>{this._handles.remove(ATe),M(u)&&this._handles.add(u.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),ATe)},vo),xe(()=>this._previewing,()=>this._requestRenderIfEnabled(),fn)])}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(k(this._accumulationTechniqueCached)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new EVe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabledInternal&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==Cse&&this._opacityFromElevation>SVe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(J_(r,e,S2))return;const i=Math.min(PH,e.length);r.length=i,this._sampleCount=i;for(let n=0;n<i;++n)r[n]=Pe(r[n]??G(),e[n]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,n){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=n,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(mzt,this._sampleCount-this._progress);for(let o=0;o<s;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=kt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=kt(this._fbo),this._vao=kt(this._vao),this._accumulationTechniqueCached=us(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this._enabled=e.enabled),e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||this._progress<1||e<0||e>this._fbo.width||r<0||r>this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,_t.RGBA,xr.UNSIGNED_BYTE,yTe),yTe[0]/this._progress)}_start(){this._progress=0,this._enabledInternal=!0}_stop(){this._enabledInternal=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(rs.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Xl(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*gzt%this._lightDirections.length]}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-GR(pzt,fzt,e.relativeElevation))}set _enabled(e){e!==this._enabledInternal&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabledInternal&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};h([f()],Yu.prototype,"_progress",void 0),h([f()],Yu.prototype,"_sampleCount",void 0),h([f()],Yu.prototype,"_enabledInternal",void 0),h([f()],Yu.prototype,"_depthRange",void 0),h([f()],Yu.prototype,"_previewing",void 0),h([f()],Yu.prototype,"_accumulationRenderer",void 0),h([f()],Yu.prototype,"_isRefining",null),h([f()],Yu.prototype,"_isActive",null),h([f()],Yu.prototype,"canAccumulate",null),h([f()],Yu.prototype,"_isDoneAccumulating",null),h([f()],Yu.prototype,"_opacityFromElevation",null),h([f()],Yu.prototype,"running",null),Yu=h([Q("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Yu);const mzt=6,ATe="renderView",gzt=104729,yTe=new Uint8Array(4),_Te={highlightedThreshold:.99999,selfShadowThreshold:.025};function Azt(t){const e=new Ui;e.include(XS,t);const r=e.fragment;return r.include(bd),r.include(Tp),e.include(fH),e.include(s0),r.uniforms.add([new _r("defaultDepthTex",(i,n)=>n.shadowMap.getSnapshot(EO.Default)),new _r("highlightDepthTex",(i,n)=>n.shadowMap.getSnapshot(EO.Highlight)),new _r("depthMap",(i,n)=>n.linearDepthTexture),new _r("highlightMap",(i,n)=>n.highlightColorTexture),new pi("uColor",i=>i.shadowColor),new ji("nearFar",(i,n)=>n.camera.nearFar),new ut("opacity",i=>i.shadowOpacity),new ut("occludedOpacity",i=>i.occludedShadowOpacity),new ut("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new kr("lightingMainDirectionView",(i,n)=>Ye(bTe,Ot(bTe,n.lighting.mainLight.direction,n.camera.viewInverseTransposeMatrix))),new ji("texelSize",(i,n)=>M(n.linearDepthTexture)?ti(yzt,1/n.linearDepthTexture.descriptor.width,1/n.linearDepthTexture.descriptor.height):yh),new fs("inverseViewMatrix",(i,n)=>Ml(vTe,Ah(vTe,n.camera.viewMatrix,n.camera.center)))]),r.constants.add("unoccludedHighlightFlag","vec4",y7e).add("highlightedThreshold","float",_Te.highlightedThreshold).add("selfShadowThreshold","float",_Te.selfShadowThreshold),r.code.add(D`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(D`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const vTe=ht(),bTe=G(),yzt=Ft(),_zt=Object.freeze(Object.defineProperty({__proto__:null,build:Azt},Symbol.toStringTag,{value:"Module"}));let vzt=class extends En{constructor(){super(...arguments),this.shadowColor=Fr(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},MVe=class RVe extends qi{constructor(e){super(e,new pV,()=>this.destroy())}initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2}initializeProgram(e){return new zi(e.rctx,RVe.shader.get().build(this.configuration),Di)}initializePipeline(){return Pr({blending:Da(st.SRC_ALPHA,st.ONE,st.ONE_MINUS_SRC_ALPHA,st.ONE_MINUS_SRC_ALPHA),colorWrite:Gr,depthTest:null,depthWrite:null})}get primitiveType(){return wr.TRIANGLE_STRIP}};MVe.shader=new Bi(_zt,()=>be(()=>import("./ShadowHighlight.glsl-331c6015.js"),[]));const bzt=.001953125,wzt=4e4,xzt=5e4;let Tzt=class{constructor(e,r){this._rctx=e,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new vzt,this._drawParameters=new qke,this._vao=Fc(this._rctx)}get _technique(){return k(this._techniqueCached)&&(this._techniqueCached=new MVe({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,r){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,Xl(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.size)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,r){this._passParameters.opacityElevation=1-GR(wzt,xzt,e.relativeElevation);const i=this._viewingMode===wt.Global?Ye(wTe,e.center):Le(wTe,0,0,1),n=Qe(i,r);this._passParameters.dayNightTerminator=GR(0,1,He(30*n,0,1))}dispose(){this._vao=kt(this._vao),this._techniqueCached=us(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=bzt}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const wTe=G(),xTe=b1();let Szt=class{constructor(){this._plane=b1()}get isEnabled(){return!m4e(this.plane,xTe)}get plane(){return this._plane}set plane(e){wE(e||xTe,this._plane)}},Ezt=class extends En{};function HL(t){t.uniforms.add(new pi("resolution",e=>{const{descriptor:r}=e.colorTexture,i=r.width,n=r.height;return pn(Czt,1/i,1/n,i,n)}))}const Czt=Kr(),q3={maxSearchSteps:8,maxDistanceAreaTex:16};function Mzt(){const t=new Ui,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(z.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),HL(i),i.code.add(D`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${D.int(q3.maxSearchSteps)} );
      }
    `),n.uniforms.add(new _r("edgesTexture",s=>s.edges.colorTexture)),n.uniforms.add(new _r("areaTexture",s=>s.areaTexture)),n.uniforms.add(new _r("searchTexture",s=>s.searchTexture)),HL(n),n.code.add(D`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign(x) * floor(abs(x) + 0.5);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${D.int(q3.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${D.int(q3.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${D.int(q3.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${D.int(q3.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${D.int(q3.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture2D( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        gl_FragColor = weights;
      }
    `),t}const Rzt=Object.freeze(Object.defineProperty({__proto__:null,build:Mzt},Symbol.toStringTag,{value:"Module"}));let OVe=class PVe extends qi{initializeProgram(e){return new zi(e.rctx,PVe.shader.get().build(),Di)}initializePipeline(){return Pr({colorWrite:Gr})}};OVe.shader=new Bi(Rzt,()=>be(()=>import("./BlendWeights.glsl-f13e41dc.js"),[]));function Ozt(){const t=new Ui,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(z.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),HL(i),i.code.add(D`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),n.uniforms.add(new _r("blendWeightsTexture",s=>s.blend.colorTexture)),n.uniforms.add(new _r("colorTexture",s=>s.colorTexture)),HL(n),n.code.add(D`void main() {
vec4 a;
a.rb = texture2D(blendWeightsTexture, uv).rb;
a.g = texture2D(blendWeightsTexture, offsets[1].zw).g;
a.a = texture2D(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
gl_FragColor = texture2D( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTexture, uv, 0.0 );
vec4 Cop = texture2D( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
gl_FragColor = mix(C, Cop, s);
}
}`),t}const Pzt=Object.freeze(Object.defineProperty({__proto__:null,build:Ozt},Symbol.toStringTag,{value:"Module"}));let IVe=class $Ve extends qi{initializeProgram(e){return new zi(e.rctx,$Ve.shader.get().build(),Di)}initializePipeline(){return Pr({colorWrite:Gr})}};IVe.shader=new Bi(Pzt,()=>be(()=>import("./Blur.glsl-856a3150.js"),[]));const TTe={threshold:.05,localConstrastAdaption:2};function Izt(){const t=new Ui,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(z.POSITION,"vec2"),HL(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(D`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),n.uniforms.add(new _r("colorTexture",s=>s.colorTexture)),n.code.add(D`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D(colorTexture, uv).rgb;

      vec3 Cleft = texture2D(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture2D(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${D.float(TTe.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture2D(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture2D(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${D.float(TTe.localConstrastAdaption)}) * delta.xy);

      gl_FragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const $zt=Object.freeze(Object.defineProperty({__proto__:null,build:Izt},Symbol.toStringTag,{value:"Module"}));let DVe=class LVe extends qi{initializeProgram(e){return new zi(e.rctx,LVe.shader.get().build(),Di)}initializePipeline(){return Pr({colorWrite:Gr})}};DVe.shader=new Bi($zt,()=>be(()=>import("./EdgeDetect.glsl-1e7ea430.js"),[]));let H4=class extends rt{constructor(e,r){super({}),this._rctx=e,this._techniqueRep=r,this._passParameters=new Ezt,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=Gf(this._abortController),this.disable()}_loadResources(e){if(M(this._abortController))return!1;if(M(this._passParameters.searchTexture))return!0;this._abortController=new AbortController;const r=this._abortController.signal;return be(()=>import("./SmaaRenderPassData-660b7d34.js"),[]).then(i=>this._loadTextures(i,r)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,r){return fi(r),Promise.all([this._loadTextureFromBase64(e.areaTexture,zt.LINEAR,_t.RGB),this._loadTextureFromBase64(e.searchTexure,zt.NEAREST,_t.LUMINANCE)]).then(([i,n])=>{Ra(r)?(i.dispose(),n.dispose(),fi(r)):(this._passParameters.areaTexture=i,this._passParameters.searchTexture=n)})}get updating(){return M(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const r=new Nc;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(DVe,r,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(OVe,r,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(IVe,r,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=jwt(this._rctx),this._passParameters.edges=new uo(this._rctx,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE},{target:cr.TEXTURE_2D,pixelFormat:_t.RGB,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.LINEAR,wrapMode:Ar.CLAMP_TO_EDGE,width:4,height:4}),this._passParameters.blend=new uo(this._rctx,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE},{target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.LINEAR,wrapMode:Ar.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=kt(this._vao),this._passParameters.areaTexture=kt(this._passParameters.areaTexture),this._passParameters.searchTexture=kt(this._passParameters.searchTexture),this._passParameters.blend=kt(this._passParameters.blend),this._passParameters.edges=kt(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const r=this._validPassParameters;if(k(r))return;r.colorTexture=e;const i=this._rctx,n=i.getBoundFramebufferObject(),s=e.descriptor.width,o=e.descriptor.height;i.bindVAO(this._vao),i.setViewport(0,0,s,o),r.edges.resize(s,o),i.bindFramebuffer(r.edges),i.setClearColor(0,0,0,1),i.clear(rs.COLOR_BUFFER_BIT),i.bindTechnique(this._edgeDetectTechnique,r,null),i.drawArrays(wr.TRIANGLES,0,3),r.blend.resize(s,o),i.bindFramebuffer(r.blend),i.setClearColor(0,0,1,1),i.clear(rs.COLOR_BUFFER_BIT),i.bindTechnique(this._blendWeightsTechnique,r,null),i.drawArrays(wr.TRIANGLES,0,3),i.bindFramebuffer(n),i.setClearColor(0,1,0,1),i.clear(rs.COLOR_BUFFER_BIT),i.bindTechnique(this._blurTechnique,r,null),i.drawArrays(wr.TRIANGLES,0,3)}_loadTextureFromBase64(e,r,i){return u1(e).then(n=>new Xt(this._rctx,{pixelFormat:i,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.CLAMP_TO_EDGE,width:n.width,height:n.height,samplingMode:r},n))}};h([f()],H4.prototype,"_abortController",void 0),h([f({readOnly:!0})],H4.prototype,"updating",null),H4=h([Q("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],H4);function Dzt(t,e){const r=-t[0],i=-t[1],n=-t[2],s=e[3],o=e[7],a=e[11],l=e[15];e[0]+=s*r,e[1]+=s*i,e[2]+=s*n,e[4]+=o*r,e[5]+=o*i,e[6]+=o*n,e[8]+=a*r,e[9]+=a*i,e[10]+=a*n,e[12]+=l*r,e[13]+=l*i,e[14]+=l*n}function Lzt(t,e){const r=t[0],i=t[1],n=t[2];e[12]+=r*e[0]+i*e[4]+n*e[8],e[13]+=r*e[1]+i*e[5]+n*e[9],e[14]+=r*e[2]+i*e[6]+n*e[10],e[14]+=r*e[3]+i*e[7]+n*e[11]}let Nzt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new Fzt(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{Ia(r.viewMatrix,e),Lzt(r.origin.vec3,r.viewMatrix)})}},Fzt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=ht()}},kzt=class extends I6e{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=Es()}},Uzt=class extends $6e{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Es(),this.slicePlaneLocalOrigin=G(),this.transformNormalGlobalFromModel=Es()}};function Bzt(t){const e=D`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const zzt=Gi(.5,-4e-4);function Vzt(t,e){const r=t.vertex;r.include(Bzt),r.constants.add("depthBias","vec2",zzt),r.uniforms.add(new ji("inverseViewport",(i,n)=>n.inverseViewport)),e.legacy?(r.uniforms.add(new fs("proj",(i,n)=>n.camera.projectionMatrix)),r.code.add(D`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new iy("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),r.uniforms.add(new fs("transformProjFromView",i=>i.transformProjFromView)),r.code.add(D`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(D`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function Gzt(t,e){const r=t.fragment;r.constants.add("coverageTestThreshold","float",.01),e.antialiasing?r.code.add(D`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(D`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function jzt(t,e){const r=t.vertex;e.silhouette?(r.code.add(D`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(D`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(D`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(D`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function Hzt(t,e){const r=t.vertex;r.include(bd),r.uniforms.add(new ut("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(D`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(g2("componentDataTex",i=>i.componentDataTexture,e.hasWebGL2Context?hn.None:hn.InvSize)),t.attributes.add(z.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*_pe),r.code.add(D`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${Nf(e,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${gu(e,"componentDataTex","colorIndex")};
      vec4 otherValue = ${gu(e,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${gu(e,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?r.code.add(D`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new yL("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(D`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(z.NORMALA,"vec3"),t.attributes.add(z.NORMALB,"vec3"),r.code.add(D`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(z.NORMAL,"vec3"),r.code.add(D`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?r.code.add(D`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(Az,e),r.include(Az,e),r.uniforms.add([new iy("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new yL("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new yp("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new yp("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new kr("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new kr("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)]),r.code.add(D`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?D`normalize(transformWorldFromModelTL + rotatedModelPosition);`:D`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new fs("transformProjFromView",(i,n)=>n.camera.projectionMatrix)),r.code.add(D`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(D`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function qzt(t){return t.mode===la.SKETCH||t.mode===la.MIXED}var la,CT;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(la||(la={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(CT||(CT={}));function xpe(t,e){const r=t.vertex;switch(t.attributes.add(z.SIDENESS,"vec2"),e.mode===la.MIXED?r.code.add(D`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(D`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case la.MIXED:r.code.add(D`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case la.SKETCH:r.code.add(D`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case la.SOLID:r.code.add(D`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case la.COUNT:break;default:e.mode}}function Wzt(t,e){const r=t.vertex;switch(t.include(xpe,e),e.mode){case la.SOLID:r.code.add(D`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case la.SKETCH:r.uniforms.add(new oS("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(D`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case la.MIXED:r.uniforms.add(new oS("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(D`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Qzt(t,e){t.include(xpe,e);const{vertex:r,fragment:i}=t;switch(qzt(e)&&(r.uniforms.add(g2("strokesTexture",n=>n.strokesTexture.texture,e.hasWebGL2Context?hn.None:hn.InvSize)),r.uniforms.add([new oS("strokesLog2Resolution",n=>Math.log2(n.strokesTexture.resolution)),new oS("strokeVariants",n=>n.strokesTexture.variants)]),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add([new ZN("strokesTexture",n=>n.strokesTexture.texture),new oS("strokesNormalizationScale",n=>n.strokesTexture.normalizationScale)]),r.code.add(D`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${Nf(e,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),t.fragment.include(bd),i.code.add(D`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case la.SOLID:r.code.add(D`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(D`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case la.SKETCH:r.code.add(D`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(D`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case la.MIXED:t.varyings.add("vType","float"),r.code.add(D`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(D`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Yzt(t){const e=new Ui,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add([new STe("model"),new STe("localView")]),e.include(Vzt,t),e.include(Hzt,t),e.include(Wzt,t),e.include(xpe,t),e.include(Qzt,t),e.include(To,t),e.include(jzt,t),e.include(Gzt,t),e.include(Sp,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add([new ji("pixelToNDC",(n,s)=>ti(Xzt,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new pi("viewport",(n,s)=>s.camera.fullViewport),new ut("pixelRatio",(n,s)=>s.camera.pixelRatio)]),e.attributes.add(z.POSITION0,"vec3"),e.attributes.add(z.POSITION1,"vec3"),e.attributes.add(z.VARIANTOFFSET,"float"),e.attributes.add(z.VARIANTSTROKE,"float"),e.attributes.add(z.VARIANTEXTENSION,"float"),r.code.add(D`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?D`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:D`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===la.SKETCH?D`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===la.MIXED?D`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(D`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      gl_FragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const Xzt=Ft();let STe=class extends Ys{constructor(e){super(e,"mat4")}};const Zzt=Object.freeze(Object.defineProperty({__proto__:null,build:Yzt},Symbol.toStringTag,{value:"Module"}));let NVe=class FVe extends qi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===lr.WEBGL2}initializeProgram(e){return new zi(e.rctx,FVe.shader.get().build(this.configuration),Xze)}initializePipeline(e){return e.blendMinMax?Pr({blending:Da(st.ONE,st.ONE,st.ZERO,st.ONE,UA.ADD,e.blendMinMax.MAX),depthTest:{func:Qn.LEQUAL},colorWrite:Gr}):Pr({depthTest:{func:Qn.LEQUAL},depthWrite:_h,colorWrite:Gr})}};NVe.shader=new Bi(Zzt,()=>be(()=>import("./EdgeShader.glsl-9ceecb6c.js"),[]));let Vg=class extends Xa{constructor(){super(...arguments),this.mode=la.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};h([ae({count:la.COUNT})],Vg.prototype,"mode",void 0),h([ae()],Vg.prototype,"hasSlicePlane",void 0),h([ae()],Vg.prototype,"silhouette",void 0),h([ae()],Vg.prototype,"legacy",void 0),h([ae()],Vg.prototype,"antialiasing",void 0),h([ae()],Vg.prototype,"doublePrecisionRequiresObfuscation",void 0),h([ae()],Vg.prototype,"hasMultipassTerrain",void 0),h([ae()],Vg.prototype,"cullAboveGround",void 0),h([ae()],Vg.prototype,"spherical",void 0);const Jzt=8,ZX=128,Kzt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},eVt={solid:la.SOLID,sketch:la.SKETCH,uber:la.MIXED};let JX=class kVe{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new Vg,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[Hr.TRANSPARENT]:{[Hr.TRANSPARENT]:new Vr,[Hr.OPAQUE]:new Vr},[Hr.OPAQUE]:{[Hr.TRANSPARENT]:new Vr,[Hr.OPAQUE]:new Vr}},this._renderablesDirty=!1,this._drawParameters=new Uzt,this._settings={...Kzt,...i},this.key=kVe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const n=this._settings.strokesTexture.variants;this.writerSettings={variants:n,reducedPrecision:tn.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=eVt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=us(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){this._renderablesDirty&&this._sortRenderables(),this._sortedRenderables[r][Hr.TRANSPARENT].forAll(e),this._sortedRenderables[r][Hr.OPAQUE].forAll(e)}updateTechnique(e,r){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(NVe,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,i,n,s){this._render(e,r,r.regular.vao,i,n,s)}renderSilhouetteEdges(e,r,i,n,s){this._render(e,r,r.silhouette.vao,i,n,s)}_render(e,r,i,n,s,o){o>0&&(this._bindDraw(e,r,n,s),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(wr.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,n){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const s=new OH(r.transform.position),o=Kf(ETe,SE(ETe,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=s.low,this._drawParameters.transformWorldFromModelTH=s.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=n.camera.viewInverseTransposeMatrix;Le(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,n,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[Hr.TRANSPARENT][Hr.TRANSPARENT].clear(),this._sortedRenderables[Hr.TRANSPARENT][Hr.OPAQUE].clear(),this._sortedRenderables[Hr.OPAQUE][Hr.TRANSPARENT].clear(),this._sortedRenderables[Hr.OPAQUE][Hr.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==Hr.INVISIBLE&&r.edgeTransparency!==Hr.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[Hr.TRANSPARENT][Hr.TRANSPARENT].sort(e),this._sortedRenderables[Hr.TRANSPARENT][Hr.OPAQUE].sort(e),this._sortedRenderables[Hr.OPAQUE][Hr.TRANSPARENT].sort(e),this._sortedRenderables[Hr.OPAQUE][Hr.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const ETe=ph();function nvr(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:tVt(t.layout)}}function H9(t){return rVt(t.layout).createView(t.buffer)}function tVt(t){const e=new Array;return t.fields.forEach((r,i)=>{const n={...r,constructor:UVe(r.constructor)};e.push([i,n])}),{stride:t.stride,fields:e,fieldNames:t.fieldNames}}function rVt(t){const e=Cs();return e.stride=t.stride,e.fieldNames=t.fieldNames,t.fields.forEach(r=>e.fields.set(r[0],{...r[1],constructor:nVt(r[1].constructor)})),e}const iVt=[xhe,O1,Wn,Ad,F2,She,Ehe,Che,Pc,Nj,The,vL,AO,Fj,bL,Ic,kj,Mhe,Uj,eF,Bj,Rhe,k6e,U6e,Ohe,zj,B6e,z6e,V6e,Vj,G6e,j6e,H6e,q6e,W6e,Q6e];function UVe(t){return`${t.ElementType}_${t.ElementCount}`}function nVt(t){return BVe.get(t)}const BVe=new Map;iVt.forEach(t=>BVe.set(UVe(t),t));let sVt=class extends GBe{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return QUt(e);const n=await this.invoke(new KX(e),r);return this._unpackOutput(n)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new KX(e),r);return H9(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new KX(e),r);return H9(i)}_unpackOutput(e){return{regular:{instancesData:H9(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:H9(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},KX=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Array.isArray(e.indices)?e.indices:e.indices.buffer,this.indicesType=Array.isArray(e.indices)?"Array":Bae(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function oVt(t){const r=o$.resolution,i=r/2,n=new Uint8Array(4*r*r),s=4*r*i,o=o$.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,u=o$.strokes.length;let d=(c-1)*u*l;for(const{distance:A,pressure:v}of o$.strokes){let b=A,S=v,E=d;for(let R=0;R<c;R++){R!==0&&(b=CTe(b,qL.DISTANCE),S=CTe(S,qL.PRESSURE));for(let O=0;O<o$.resolution;O++){const I=.5+(b?b[O%b.length]/a:0),N=S?S[O%S.length]:1;ML(I,n,E),ML(N,n,E+s),E+=4}E-=l*(u+1)}d+=l}const p=new Xt(t,{pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:zt.LINEAR,width:r,height:r,wrapMode:Ar.REPEAT},n);return new lVt(r,a,o,u,p)}function CTe(t,e){if(!t)return null;const r=t.length/2,i=aVt*r,n=new Array(r);let s=0;const o=e===qL.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;n[s++]=o?Math.min(i,1-(1-l)*MTe):Math.min(i,l*MTe)}return n}var qL;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(qL||(qL={}));const aVt=.1,MTe=.5;let lVt=class{constructor(e,r,i,n,s){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=n,this.texture=s}dispose(){this.texture=kt(this.texture)}};const o$={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function RTe(t){let e=null;for(const r of t){const i=r.type;if(cVt(r)){if(k(e))e=i;else if(e!==i)return"uber"}}return M(e)?e:"uber"}function OTe(t){let e=Hr.INVISIBLE;for(const{material:r}of t)if(zVe(r)){if(r.color[3]*r.opacity<1)return Hr.TRANSPARENT;e=Hr.OPAQUE}return e}function PTe(t){let e=Hr.INVISIBLE;for(const{material:r}of t)if(zVe(r)){switch(r.objectTransparency){case Hr.TRANSPARENT:case Hr.INVISIBLE:return Hr.TRANSPARENT;case Hr.OPAQUE:if(r.opacity<1)return Hr.TRANSPARENT}e=Hr.OPAQUE}return e}function zVe(t){return t.size*t.color[3]*t.opacity>0}function cVt(t){return t.size*t.color[3]>0}function ITe(t,e,r,i){for(let n=0;n<t.length;n++){const s=t[n].index,o=e[n],a=e[n+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,s)}else for(let l=o;l<a;l++)r.set(l,s)}}let B0=class extends rt{constructor(t){super(t),this._updatingHandles=new _A,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=G(),this._localOrigins=new Nzt(new Nde(t.renderSR))}initialize(){this._worker=new sVt(this.schedule),this._componentColorManager=new Kze(this.rctx,3);const t=Qze.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Ji.createVertex(this.rctx,ki.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=kt(this._strokesTexture),this._componentColorManager=yt(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=kt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,r,i,n,s,o,a){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let l;const c=new DTe(new Promise(d=>l=d),r.center,r.radius);this._perObjectData.set(t,c);const u=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,i,n,s,o,a));return this.setNeedsRender(),l(),u}async addOrUpdateObject3D(t,e,r,i){if(this.destroyed)return void we.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");const n=this._perObjectData.get(t);let s;(n==null?void 0:n.renderables.length)>0&&this._perObjectDataEvictionCache.add(n);const o=t.boundingVolumeWorldSpace.bounds,a=new DTe(new Promise(c=>s=c),o,F_(o));this._perObjectData.set(t,a);const l=new Array;if(r.mergeGeometries&&t.geometries.length>1&&uVt(t))l.push(this._addObjectMergedGeometries(t,a,e,r,i));else for(let c=0;c<t.geometries.length;c++){const u=t.geometries[c];u.material.supportsEdges&&l.push(this._addGeometry(t,a,u,e[0],r,i))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(n),this.setNeedsRender(),s()}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(k(r))return;const i=e instanceof Array?n=>e[n]:()=>e;r.renderables.forEach(n=>{const s=n.components.meta.length;for(let o=0;o<s;o++){const a=i(o),l=n.components.meta[o],c=l.index;l.material.opacity=a,n.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(n)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return M(e)?e.renderables.reduce((r,i)=>r+i.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,r,i){const n=t instanceof D1,s=!!r.hasSlicePlane,o=RTe(e),a=JX.getKey(o,s,n),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));k(l)||(l.renderables.forEach(c=>{if(a!==c.rendererKey){const u=this._renderers.get(c.rendererKey),d=this._acquireRenderer(o,s,n);u.removeRenderable(c),--u.refCount,c.rendererKey=a,d.addRenderable(c)}for(let u=0;u<e.length;u++)c.components.meta[u].material=e[u];i&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));k(r)||(r.renderables.forEach(i=>{const n=i.components.meta;for(let s=0;s<n.length;s++)i.components.meta[s].verticalOffset=(e==null?void 0:e[s])??0;this._updateComponentBuffer(i.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));M(r)&&(r.renderables.forEach(i=>i.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(k(this._componentColorManager))return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const r=t.camera.viewInverseTransposeMatrix,i=G(),n=new OH;let s=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,u=!0;l.forEachRenderable(d=>{d.visible&&(s+=d.statistics.averageEdgeLength,o++,c&&d.regular&&(l.updateTechnique(t,!1),c=!1),u&&d.silhouette&&(l.updateTechnique(t,!0),u=!1))},e)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new kzt(40*s/o,e);Le(i,r[3],r[7],r[11]),n.set(i),Pe(a.transformWorldFromViewTH,n.high),Pe(a.transformWorldFromViewTL,n.low),Jf(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),Kf(kTe,a.transformViewFromCameraRelativeRS),SE(a.transformNormalViewFromGlobal,kTe),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=OTe(t.components.meta),r=PTe(t.components.meta);e===t.edgeTransparency&&r===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=r,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,r){t.getCombinedStaticTransformation(e,r);const i=M(e.localOrigin)?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(Le(this._tmpModelPosition,r[12],r[13],r[14]));return e.localOrigin=i.origin,Dzt(i.origin.vec3,r),i}_updateComponentBuffer(t){const{meta:e,buffer:r}=t,i=new Uint8Array(4);for(let n=0;n<e.length;n++){const s=e[n].material,o=e[n].index,a=He(Math.round(s.size*Jzt),0,255),l=He(s.extensionLength,-ZX,255-ZX)+ZX,c=s.type==="solid"?dV.SOLID:dV.SKETCH,u=255*s.opacity,d=s.color,p=255*d[0],A=255*d[1],v=255*d[2],b=255*d[3];r.textureBuffer.setData(o,0,p,A,v,b),r.textureBuffer.setData(o,1,a,l,c,u),jze(e[n].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(t){if(k(this._componentColorManager))return null;const e=new Array,r=this._componentColorManager.getBuffer(t.length);for(let n=0;n<t.length;n++){const s=t[n],o=r.acquireIndex();e.push({index:o,verticalOffset:0,material:s})}const i=new hVt(r,e);return this._updateComponentBuffer(i),i}_extractEdges(t,e,r,i,n,s=n.length){return this._worker.process({data:e,indices:n,indicesLength:s,writerSettings:t,skipDeduplicate:r},this._workerAbort.signal,i)}_createRenderable(t,e,r,i,n){const s=c=>M(this._verticesBufferObject)?new dVt(new Hm(this.rctx,Xze,{vertices:FUt,instances:c===CT.REGULAR?uV.glLayout:hV.glLayout},{vertices:this._verticesBufferObject,instances:Ji.createVertex(this.rctx,ki.STATIC_DRAW,c===CT.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===CT.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?s(CT.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?s(CT.SILHOUETTE):null,l=(M(o)?o.vao.size:0)+(M(a)?a.vao.size:0);return new fVt(o,a,{gpuMemoryUsage:l,externalMemoryUsage:n,averageEdgeLength:t.averageEdgeLength},r,OTe(e.meta),PTe(e.meta),e,i)}async _addGeometry(t,e,r,i,n,s){const o=r.vertexAttributes.get(z.POSITION),a=r.indices.get(z.POSITION),l=ht(),c=this._computeModelTransformWithLocalOrigin(t,r,l),u=new FTe(o,a,l,c);return this._addPositionData(e,u,r.edgeIndicesLength,i,n,s)}async _addPositionData(t,e,r,i,n,s=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([i]);if(k(o)||r<=0)return;const a=this._acquireRenderer(i.type,!!n.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,u=e.indices,d=e.position,p=d.data.length/d.size,A=lV.createBuffer(p);for(let S=0;S<p;S++)A.position.set(S,0,d.data[S*d.size+0]),A.position.set(S,1,d.data[S*d.size+1]),A.position.set(S,2,d.data[S*d.size+2]);ITe(o.meta,[0,A.componentIndex.count],A.componentIndex);const v=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,A,!1,s,u,r));if(t.loaded==null)return;const b=this._createRenderable(v,o,new pVt(l,c),a.key,!1);t.renderables.push(b),a.addRenderable(b),this._gpuMemoryUsage+=b.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,r,i,n,s,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(s);if(k(a))return 0;const l=RTe(s),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),u=lV.createBuffer(r.count);vH(u.position,r),ITe(a.meta,n,u.componentIndex,i);const d=!0,p=c.writerSettings,A=await this._updatingHandles.addPromise(this._extractEdges(p,u,d,!1,i));if(e.loaded==null)return 0;const v=this._createRenderable(A,a,t,c.key,!0);return e.renderables.push(v),c.addRenderable(v),v.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,r,i,n){const s=new Map;let o=0,a=null,l=0;for(let E=0;E<t.geometries.length;E++){const R=t.geometries[E];if(!R.material.supportsEdges)continue;!a&&R.localOrigin&&(a=R);const O=R.vertexAttributes.get(z.POSITION);l+=O.data.length/O.size,o+=R.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,u=o?new c(o):null,d=[];let p=0;for(let E=0;E<t.geometries.length;E++){const R=t.geometries[E];if(!R.material.supportsEdges)continue;const O=R.vertexAttributes.get(z.POSITION),I=R.indices.get(z.POSITION);let N=s.get(O.data);if(N==null){N=d.length/3;for(let L=0;L<O.data.length;L+=O.size)d.push(O.data[L+0]),d.push(O.data[L+1]),d.push(O.data[L+2]);s.set(O.data,N)}if(I)for(let L=0;L<R.edgeIndicesLength;L++)u[p++]=N+I[L]}const A=a||t.geometries[0],v=ht(),b=this._computeModelTransformWithLocalOrigin(t,A,v);for(let E=0;E<t.geometries.length;E++)t.geometries[E].localOrigin=b.origin;const S=new FTe({data:d,size:3},u,v,b);await this._updatingHandles.addPromise(this._addPositionData(e,S,u.length,r[0],i,n))}_acquireRenderer(t,e,r){const i=JX.getKey(t,e,r);let n=this._renderers.get(i);return k(this._strokesTexture)&&(this._strokesTexture=oVt(this.rctx)),n||(n=new JX(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===wt.Global}),this._renderers.set(i,n)),++n.refCount,n}_removeRenderable(t){$Te(t.regular),$Te(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const r of t.components.meta)t.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,r=t.camera.viewForward,i=G(),n=s=>{Ka(i,s.center,e);const o=Qe(i,r),a=s.radius,l=o<-a?1/0:o<a?0:o-a;s.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(n),this._perObjectDataEvictionCache.forEach(n)}_renderRegularEdges(t,e,r){const i=t.bindRegularEdges(r,e),n=r.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!LTe(o)||!o.visible)return;const a=q9(o.regular.lod.lengths,o.distanceToCamera,s);t.renderRegularEdges(i,o,r,e,a)},n)}_renderSilhouetteEdges(t,e,r){const i=t.bindSilhouetteEdges(r,e),n=r.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!NTe(o)||!o.visible)return;const a=q9(o.silhouette.lod.lengths,o.distanceToCamera,s);t.renderSilhouetteEdges(i,o,r,e,a)},n)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const r=t.perScreenPixelRatio,i=(n,s)=>n.forEachRenderable(o=>{o.visible&&!e&&(LTe(o)&&(e=q9(o.regular.lod.lengths,o.distanceToCamera,r)>0),!e&&NTe(o)&&(e=q9(o.silhouette.lod.lengths,o.distanceToCamera,r)>0))},s);return this._renderers.forEach(n=>{e||(i(n,Hr.OPAQUE),i(n,Hr.TRANSPARENT))}),e}}}};function $Te(t){M(t)&&(t.vao.vertexBuffers.instances.dispose(),t.vao.dispose(!1),t.vao=null)}function uVt(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const n=t.geometries[i];if(n.material.supportsEdges){if(e){if(!J_(e,n.transformation))return!1}else e=n.transformation;if(!r&&M(n.localOrigin))r=n;else if(r&&M(r.localOrigin)&&M(n.localOrigin)&&r.localOrigin.id!==n.localOrigin.id)return!1}}return!0}h([f({constructOnly:!0})],B0.prototype,"rctx",void 0),h([f({constructOnly:!0})],B0.prototype,"renderSR",void 0),h([f({constructOnly:!0})],B0.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],B0.prototype,"techniqueRepository",void 0),h([f({constructOnly:!0})],B0.prototype,"setNeedsRender",void 0),h([f({constructOnly:!0})],B0.prototype,"schedule",void 0),h([f({readOnly:!0})],B0.prototype,"_updatingHandles",void 0),h([f({readOnly:!0})],B0.prototype,"updating",null),B0=h([Q("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],B0);class DTe{constructor(e,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class hVt{constructor(e,r){this.buffer=e,this.meta=r}}let dVt=class{constructor(e,r){this.vao=e,this.lod=r}};class pVt{constructor(e,r){this.modelMatrix=e,this.origin=r}}class fVt{constructor(e,r,i,n,s,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=n,this.edgeTransparency=s,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function LTe(t){return M(t.regular)}function NTe(t){return M(t.silhouette)}function q9(t,e,r){const i=e*r,n=jJe(t,i,!0);return n===-1?i<t[0]?t.length:0:t.length-n}let FTe=class{constructor(e,r,i,n){this.position=e,this.indices=r,this.modelTransform=i,this.origin=n}};const kTe=Es();function oy(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let UTe=class{constructor(e,r,i,n,s,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=n,this.disjoint=s,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},s_=!1;function mVt(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&oy(t)?new UTe(()=>t.createQuery(),i=>{t.deleteQuery(i),s_=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{s_||(s_=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),s_=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new UTe(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),s_=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{s_||(s_=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),s_=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function gVt(t,e){const r=t.capabilities.disjointTimerQuery;return k(r)?null:new AVt(r,e)}let AVt=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(i,null)})}start(){s_||(this._currentQuery=this._queryPool.pop(),k(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||k(this._currentQuery)||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(k(r))return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){M(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){M(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{k(e)||this._timer.deleteQuery(e)})}};var Hn;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Hn||(Hn={}));const BTe="Total";let yVt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new E_(BTe),this._cpuTimeSamplers=new Map(Object.values(Hn).map(r=>[r,new E_(r)])),this._enableGPUTimer=0,this._totalGPUTime=new E_("GPU"),this._gpuTimeSamplers=new Map(Object.values(Hn).map(r=>[r,new E_(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return M(this._gpuTimerPool)}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(k(this._gpuTimerPool)){const e=[...Object.values(Hn),BTe];this._gpuTimerPool=gVt(this._rctx,e)}return k(this._gpuTimerPool)?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:jae(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=kt(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),M(this._gpuTimerPool)&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,M(this._gpuTimerPool)){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(M(this._gpuTimerPool)){const r=this._gpuTimerPool.stop(Hn.FINISH);this._gpuTimeSamplers.get(Hn.FINISH).record(r)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),M(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},zd=class extends rt{get _bindParameters(){return this._renderContext.bindParameters}isFeatureEnabled(t,e=this._state){return br(this._renderStateFeatures.get(e,t),!1)}setFeatureEnabled(t,e,r){this._renderStateFeatures.set(e,t,r),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(Ao.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Ao.HighQualityTransparency)}get hasWaterReflection(){return this.hasWater&&(this._waterReflectionEnabled||this.isFeatureEnabled(Ao.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(t,e,r,i,n,s,o,a){super({}),this._stage=t,this._materialRepository=e,this._shaderTechniqueRepository=i,this._rctx=n,this._compositingHelper=s,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new Vr,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new Szt,this._state=Mi.IDLE,this._renderStateFeatures=Sve(),this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=wa.Opaque,this._waterReflectionEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new LBt,this._handles=new cn,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new H4(this._rctx,i),a(),this._offscreen=new tzt(this._rctx,this._compositingHelper),this.performanceInfo=new yVt(this._rctx),this._shadowMap=new Fde(this._rctx,t.viewingMode),this._ssaoHelper=new oUe(t.view,i,this._rctx,a),this._highlight=new ZBt(i,this._rctx),this._shadowHighlight=new Tzt(this._rctx,t.viewingMode),this._shadowAccumulator=new Yu(this._rctx,i,t,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,u)=>{l.shadowMap.start(l.camera,c,u),this._renderShadowCascades(ne.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._renderContext=new P$t(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new nzt({renderContext:this._renderContext,techniqueRepository:i,textureRepository:r,materialRepository:this._materialRepository,requestRender:a,controller:t}),this.renderPassManager=new DBt(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([xe(()=>this._stage.view.state.camera,()=>a(),vo),xe(()=>tn.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(Hr.TRANSPARENT):()=>{},a()},Rr),xe(()=>this._ssaoEnabled||this.isFeatureEnabled(Ao.SSAO),l=>this._ssaoHelper.enabled=l,vo)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=ps(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=kt(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),K6e.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||M(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return k(this._edgeView)&&(this._edgeView=new B0({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:t=>this._stage.view.resourceController.immediate.schedule(t)}),this._handles.add(xe(()=>rl(this._edgeView,t=>t.updating),()=>this._requestRender(),fn)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return gce(this._bindParameters.ssr.reprojectionMatrix,wp)}set _reprojectionMatrix(t){Fae(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var t;return!!((t=this._shadowMap)!=null&&t.enabled)}setParameters(t){const{_shadowMap:e,_bindParameters:r}=this;if(t.screenSpaceReflectionsEnabled!==void 0&&r.ssr.enabled!==t.screenSpaceReflectionsEnabled&&(r.ssr.enabled=t.screenSpaceReflectionsEnabled,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),M(t.environment)){M(t.environment.weather)&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible),t.environment.lighting.ambientOcclusionEnabled!==void 0&&this._ssaoEnabled!==t.environment.lighting.ambientOcclusionEnabled&&(this._ssaoEnabled=t.environment.lighting.ambientOcclusionEnabled,this._requestRender()),t.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==t.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=t.environment.lighting.waterReflectionEnabled,this._requestRender());const i=t.environment.lighting.type!=="virtual";r.enableFillLights!==i&&(r.enableFillLights=i,this._requestRender())}t.background&&this._offscreen.background!==t.background&&(this._offscreen.background=t.background,this._requestRender()),t.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==t.antialiasingEnabled&&(this._antialiasingEnabled=t.antialiasingEnabled,this._requestRender()),t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(t.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(t.defaultHighlightOptions),this._requestRender()),t.overlays!==void 0&&this._bindParameters.overlays!==t.overlays&&(this._bindParameters.overlays=t.overlays,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.renderOverlay!==void 0&&this._renderOverlay!==t.renderOverlay&&(this._renderOverlay=t.renderOverlay,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==t.terrainRenderingEnabled&&(this._terrainRenderingEnabled=t.terrainRenderingEnabled,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:i,updates:n}=t;if(r.length===0&&i.length===0&&n.length===0)return;const s=zke(t);let o=!1;s.forEach((a,l)=>{if(e.done)return;let c=this._materialRenderers.find(u=>u.material===l);k(c)&&a.adds.length>0&&(c=new Kke(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(u=>t.removes.removeUnordered(u)),a.adds.forEach(u=>t.adds.removeUnordered(u)),a.updates.forEach(u=>t.updates.removeUnordered(u)),e.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(a=>a.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(a=>a.hasOccludees),this._hasWater=this._materialRenderers.some(a=>a.hasWater),this._hasHUDElements=this._materialRenderers.some(a=>a.requiresSlot(nt.LINE_CALLOUTS_HUD_DEPTH,ne.Color)||a.requiresSlot(nt.HUD_MATERIAL,ne.Color)||a.requiresSlot(nt.LABEL_MATERIAL,ne.Color)),this._requestRender()}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(r=>this._hasAnimations=r.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?ps(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(t,e,r,i,n){this._isRendering=!0,this.performanceInfo.startFrame();const{camera:s,contentCamera:o,mode:a}=r;this._state=a,this._renderOverlay(n),this.performanceInfo.advance(Hn.OVERLAY),this._renderContext.time=n,this._bindParameters.transparencyPassType=dr.NONE;const l=this._offscreen;l.setupRenderTarget(this.hasWaterReflection);const c=b1(this._sliceHelper.plane);i===zS.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(t),s.setGLViewport(this._rctx),this._prepare(s,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Hn.PREPARE);const u=this._computeDepthRange(s);this._renderShadowMap(t,s,this._bindParameters.lighting.mainLight.direction,u),this.performanceInfo.advance(Hn.SHADOW_MAP),l.initializeFrame(s),this._ensureBindParameters(s,o),this._renderLinearDepth(),this.performanceInfo.advance(Hn.LINEAR_DEPTH),this._accumulateShadows(u,s,o),this.performanceInfo.advance(Hn.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(Hn.NORMALS),this._ensureBindParametersSSR(n),this._renderSSAO(n),this.performanceInfo.advance(Hn.SSAO),this._renderContext.output=ne.Color,l.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Hn.OPAQUE);const d=this._terrainRenderingEnabled&&(this._terrainTransparency===wa.Semitransparent||this._terrainTransparency===wa.TransparentWithDraped),p=this._highQualityTransparency&&d;this._renderTerrainLinearDepth(p),this._setMultipassEnabled(p),this._setTerrainCulling(p),this._renderEdges(Hr.OPAQUE),this.performanceInfo.advance(Hn.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(nt.VOXEL),this.performanceInfo.advance(Hn.VOXEL),this._renderHiddenTransparentEdges();const A=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;A&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Hn.TRANSPARENT),this._renderGeometryLinearDepth(p);const v=this._renderHUDVisibility(p);p||this._renderInternalSlot(nt.LINE_CALLOUTS),this.performanceInfo.advance(Hn.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(Hn.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(Hr.TRANSPARENT,p),this.performanceInfo.advance(Hn.TRANSPARENT_EDGES),this._renderTransparentTerrain(),d&&v&&(p?this._renderLineCallouts(qd.Occluded):l.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(qd.Occluded,l.framebuffer),this.performanceInfo.advance(Hn.HUD_OCCLUDED)),this.performanceInfo.advance(Hn.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),d&&(l.compositeTransparentTerrainOntoMain(this._bindParameters),p&&(this._renderEdges(Hr.OPAQUE),this.performanceInfo.advance(Hn.OPAQUE_EDGES),A&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Hn.TRANSPARENT),this._renderEdges(Hr.TRANSPARENT),this.performanceInfo.advance(Hn.TRANSPARENT_EDGES))),p&&this._renderLineCallouts(qd.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),l.renderToTargets(()=>{this._renderInternalSlot(nt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(nt.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(nt.LASERLINES)},l.currentColorTarget,l.mainDepth),this.performanceInfo.advance(Hn.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&l.renderTmpAndCompositeToMain(()=>this._renderSlot(nt.LASERLINES_CONTRAST_CONTROL),this._bindParameters,wc.PremultipliedAlpha),this.performanceInfo.advance(Hn.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(Hn.OCCLUDED);const b=i===zS.ON&&this._magnifierHelper.enabled,S=b&&k(t)?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):t;this._rctx.bindFramebuffer(S);const E=this._offscreen.colorTexture;!this._renderAntiAliasing(E)&&M(E)&&this._compositingHelper.composite(this._bindParameters,E,wc.None),this.performanceInfo.advance(Hn.ANTIALIASING),this._renderHUD(qd.NotOccluded,S),this.performanceInfo.advance(Hn.HUD),this._renderHighlights(S,this._bindParameters),this.performanceInfo.advance(Hn.HIGHLIGHTS),b&&this._magnifierHelper.render(this._rctx,this._bindParameters),S!==t&&(this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,wc.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=c,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_renderObjectAndLayerIdColor(t){if(M(t)&&Fe("enable-feature:objectAndLayerId-rendering")){const e=this._renderContext.output;this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(ne.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=qd.NotOccluded,this._renderInternalSlot(nt.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,r=t===so.BACKGROUND;if(r||e){const i=r?this.performanceInfo.elapsedTime:0,n=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),s=Math.max(i,n);this._animationTimestep.frame(s,r)}}readDepthPixels(t,e,r){const i=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const n=rs.COLOR_BUFFER_BIT|rs.DEPTH_BUFFER_BIT|rs.STENCIL_BUFFER_BIT;this._rctx.clearSafe(n),this._renderGeometryAndTransparentTerrainPass(ne.Depth)}i.readPixels(e[0],e[1],e[2],e[3],_t.RGBA,xr.UNSIGNED_BYTE,r)}readHUDVisibility(t,e,r,i,n){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(t,e,r,i,_t.RGBA,xr.UNSIGNED_BYTE,n)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassEnabled(t){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_renderSlot(t){this._bindParameters.slot=t,this._renderPlugins.render()}_renderEdges(t,e=!1){const r=this._edgeView;M(r)&&r.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>r.render(this._bindParameters,t),this._bindParameters,wc.Alpha,e)}_renderShadowMap(t,e,r,i){const n=this._shadowMap;n.enabled&&this.isFeatureEnabled(Ao.ShadowMapUpdate)&&(n.start(e,r,i),this._shadowHighlight.updateParameters(e,r),this._needsShadowHighlight?(this._renderShadowCascades(ne.ShadowHighlight,this._shadowMap,s=>n.takeCascadeSnapshotTo(s,EO.Highlight)),n.clear(),this._renderShadowCascades(ne.ShadowExcludeHighlight,this._shadowMap,s=>{n.takeCascadeSnapshotTo(s,EO.Default),this._renderGeometryAndTransparentTerrainPass(ne.ShadowHighlight)})):this._renderShadowCascades(ne.Shadow),n.finish(t),e.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap,r=i=>{}){for(const i of e.cascades)i.camera.setGLViewport(this._rctx),this._prepare(i.camera,i.camera),this._renderGeometryAndTransparentTerrainPass(t),r(i)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasWaterReflection||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(ne.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=ne.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(t){if(t){const e=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(ne.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(ne.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return Cse;const e=ABt(t,this._materialRenderers,this._stage.layers);return PO(e,this.renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderGeometryAndTransparentTerrainPass(t){this._renderContext.output=t,this._renderGeometryPass(t),this._renderTransparentTerrain()}_renderGeometryPass(t){this._renderContext.output=t,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(t){this._ssaoHelper.render(this._bindParameters,t,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_renderOpaqueGeometry(){this._renderSlot(nt.INTEGRATED_MESH),this._renderSlot(nt.OPAQUE_TERRAIN),this._renderInternalSlot(nt.OPAQUE_MATERIAL),this._renderSlot(nt.OPAQUE_MATERIAL),this._renderSlot(nt.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(nt.TRANSPARENT_MATERIAL),this._renderSlot(nt.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(nt.TRANSPARENT_TERRAIN)}_renderHUDVisibility(t){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(nt.OCCLUSION_PIXELS)},t),e}_renderLineCallouts(t){this._bindParameters.renderTransparentlyOccludedHUD=t,t===qd.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(nt.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(nt.LINE_CALLOUTS)}_renderHUD(t,e){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(t),!0),this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,wc.PremultipliedAlpha)):t===qd.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(qd.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(t))}_renderHUDElements(t){this._bindParameters.renderTransparentlyOccludedHUD=t,this._renderInternalSlot(nt.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(nt.HUD_MATERIAL),this._renderInternalSlot(nt.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(t,e){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const r=this._highlight,i=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(ne.Highlight),this._rctx.clearSafe(rs.DEPTH_BUFFER_BIT),this._renderHUDElements(qd.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=i.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(e,t),r.render(this._bindParameters,i,t)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(t,e,r){this._needsShadowCast&&M(this._offscreen.linearDepthTexture)&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,t,e,r)}_renderOrderIndependentTransparency(t,e){const r=n=>{this._bindParameters.transparencyPassType=n,this._offscreen.renderOITPass(()=>t(),n,e)},i=this._renderContext.output;this._renderContext.output=ne.Alpha,r(dr.Alpha),this._renderContext.output=ne.Color,r(dr.Color),r(dr.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,e),this._bindParameters.transparencyPassType=dr.NONE,this._renderContext.output=i,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let t=0;_0.clear(),this._materialRenderers.forAll(s=>{s.material&&s.material.isVisible()&&s.material.renderOccluded===Ds.OccludeAndTransparentStencil&&(t|=s.material.renderOccluded,_0.push(s))});const e=this._offscreen,r=(s,o,a,l,c)=>{t&o&&(e.renderToTargets(a,e.tmpColor,e.mainDepth,[0,0,0,0],l,c),e.compositeOccludedOntoMain(this._bindParameters,s))};_0.length!==0&&(this._renderInternalSlot(nt.OCCLUDER_MATERIAL,_0),r(.5,Ds.OccludeAndTransparentStencil,()=>this._renderInternalSlot(nt.TRANSPARENT_OCCLUDER_MATERIAL,_0),!1,!1)),_0.clear(),this._materialRenderers.forAll(s=>{s.material&&s.material.isVisible()&&(s.material.renderOccluded===Ds.OccludeAndTransparent||s.material.renderOccluded===Ds.Transparent||s.material.renderOccluded===Ds.Opaque)&&(t|=s.material.renderOccluded,_0.push(s))});const i=this._renderPlugins.renderOccludedFlags;if(t|=i,!t)return;const n=s=>{this._renderContext.renderOccludedMask=s,i>Ds.Occlude&&this._renderSlot(nt.OCCLUDED_TERRAIN),this._renderInternalSlot(nt.OPAQUE_MATERIAL,_0),this._renderInternalSlot(nt.TRANSPARENT_MATERIAL,_0),this._renderInternalSlot(nt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,_0),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=ne.Color,r(.5,Ds.OccludeAndTransparent,()=>n(Ds.OccludeAndTransparent),!0,dh.OutlineVisualElementMask),r(.5,Ds.Transparent,()=>n(Ds.Transparent),!0,dh.OutlineVisualElementMask),r(1,Ds.Opaque,()=>n(Ds.Opaque),!0,dh.OutlineVisualElementMask),_0.clear()}_renderAntiAliasing(t){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&M(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(r=>r.requiresSlot(nt.TRANSPARENT_MATERIAL,ne.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.mainColorTexture=r.mainColorTexture,this._bindParameters.highlightDepthTexture=r.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.enabled=this.hasWaterReflection,this._bindParameters.ssr.enabled){k(this._waterReflectionEnableTime)&&(this._waterReflectionEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=wp:(Ml(VTe,this._bindParameters.camera.viewMatrix),Ml(zTe,this._bindParameters.camera.projectionMatrix),js(W3,VTe,zTe),js(W3,this._renderContext.lastFrameCamera.viewMatrix,W3),js(W3,this._renderContext.lastFrameCamera.projectionMatrix,W3),this._reprojectionMatrix=W3),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._waterReflectionEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._bindParameters.ssr.lastFrameColorTexture=null,this._waterReflectionEnableTime=null}_renderInternalSlot(t,e=this._materialRenderers){let r=!1;return this._bindParameters.slot=t,e.forAll(i=>{i.material.shouldRender(this._renderContext)&&i.render(this._renderContext.output,this._bindParameters)&&(r=!0)}),r}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=ZFe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var t,e,r,i,n;return{offscreen:((t=this._offscreen)==null?void 0:t.gpuMemoryUsage)??0,highlights:(((e=this._highlight)==null?void 0:e.gpuMemoryUsage)??0)+(((r=this._shadowHighlight)==null?void 0:r.gpuMemoryUsage)??0),shadows:((i=this._shadowMap)==null?void 0:i.gpuMemoryUsage)??0,ssao:((n=this._ssaoHelper)==null?void 0:n.gpuMemoryUsage)??0}}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=Sve()},getFramebufferTexture:e=>{switch(e){case bb.Color:return t._offscreen.colorTexture;case bb.LinearDepth:return t._offscreen.linearDepthTexture;case bb.Normals:return t._offscreen.normalTexture;case bb.ShadowMap:return t._shadowMap.depthTexture;case bb.HudVisibility:return t._offscreen.hudVisibilityTexture;case bb.Highlight:return t._offscreen.highlightTexture}}}}};var bb;h([f()],zd.prototype,"_shadowAccumulator",void 0),h([f()],zd.prototype,"_state",void 0),h([f()],zd.prototype,"_renderStateFeatures",void 0),h([f()],zd.prototype,"_antialiasingEnabled",void 0),h([f({readOnly:!0})],zd.prototype,"_antialiasing",null),h([f()],zd.prototype,"_ssaoEnabled",void 0),h([f()],zd.prototype,"_smaaPass",void 0),h([f({autoDestroy:!0})],zd.prototype,"_edgeView",void 0),h([f()],zd.prototype,"updating",null),h([f()],zd.prototype,"isCameraFinal",null),zd=h([Q("esri.views.3d.webgl-engine.lib.Renderer")],zd),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(bb||(bb={}));const _0=new Vr,zTe=ht(),VTe=ht(),W3=ht();let GTe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:st.ONE,dstRGB:st.ZERO,srcAlpha:st.ONE,dstAlpha:st.ZERO},this.blendEquation={mode:UA.ADD,modeAlpha:UA.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=mm.BACK,this.frontFace=pO.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Qn.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:mm.FRONT_AND_BACK,func:Qn.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:mm.FRONT_AND_BACK,fail:co.KEEP,zFail:co.KEEP,zPass:co.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},_Vt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,n)=>{const s=n.split(`
`);s.shift(),s.shift(),e+=`${i}: ${s.shift()}
`,s.forEach(o=>e+=`   ${o}
`)})}return e}};const vVt={RECORD_ALLOCATIONS:!1};let bVt=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new _Vt(vVt.RECORD_ALLOCATIONS);this._current.length<Pa.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,r){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(r)}decrement(e,r){--this._current[e],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,r)=>e+r,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<Pa.COUNT;++r){const i=this._current[r];i>0&&(e+=`${Pa[r]}: ${i}
`)}}return e+=this._allocations.information,e}};const wVt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var jTe,Nse={},xVt={get exports(){return Nse},set exports(t){Nse=t}};(jTe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(xVt.exports=jTe);const TVt=Nse;var HTe,Fse={},SVt={get exports(){return Fse},set exports(t){Fse=t}};HTe=SVt,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(HTe.exports=e)}();const qTe=Fse;var kse={},EVt={get exports(){return kse},set exports(t){kse=t}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(EVt);const CVt=kse;var v0=999,WTe=9999,eZ=0,tZ=1,QTe=2,YTe=3,XTe=4,W9=5,MVt=6,RVt=7,OVt=8,ZTe=9,PVt=10,JTe=11,IVt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function $Vt(){var t,e,r,i=0,n=0,s=v0,o=[],a=[],l=1,c=0,u=0,d=!1,p=!1,A="";return function(ee){return a=[],ee!==null?b(ee.replace?ee.replace(/\r\n/g,`
`):ee):S()};function v(ee){ee.length&&a.push({type:IVt[s],data:ee,position:u,line:l,column:c})}function b(ee){var se;for(i=0,r=(A+=ee).length;t=A[i],i<r;){switch(se=i,s){case eZ:i=N();break;case tZ:i=I();break;case QTe:i=O();break;case YTe:i=L();break;case XTe:i=q();break;case JTe:i=U();break;case W9:i=Z();break;case WTe:i=X();break;case ZTe:i=R();break;case v0:i=E()}se!==i&&(A[se]===`
`?(c=0,++l):++c)}return n+=i,A=A.slice(i),a}function S(ee){return o.length&&v(o.join("")),s=PVt,v("(eof)"),a}function E(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=n+i-1,s=eZ,e=t,i+1):e==="/"&&t==="/"?(u=n+i-1,s=tZ,e=t,i+1):t==="#"?(s=QTe,u=n+i,i):/\s/.test(t)?(s=ZTe,u=n+i,i):(d=/\d/.test(t),p=/[^\w_]/.test(t),u=n+i,s=d?XTe:p?YTe:WTe,i)}function R(){return/[^\s]/g.test(t)?(v(o.join("")),s=v0,i):(o.push(t),e=t,i+1)}function O(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(v(o.join("")),s=v0,i)}function I(){return O()}function N(){return t==="/"&&e==="*"?(o.push(t),v(o.join("")),s=v0,i+1):(o.push(t),e=t,i+1)}function L(){if(e==="."&&/\d/.test(t))return s=W9,i;if(e==="/"&&t==="*")return s=eZ,i;if(e==="/"&&t==="/")return s=tZ,i;if(t==="."&&o.length){for(;B(o););return s=W9,i}if(t===";"||t===")"||t==="("){if(o.length)for(;B(o););return v(t),s=v0,i+1}var ee=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||ee){for(;B(o););return s=v0,i}return o.push(t),e=t,i+1}function B(ee){for(var se,ue,re=0;;){if(se=qTe.indexOf(ee.slice(0,ee.length+re).join("")),ue=qTe[se],se===-1){if(re--+ee.length>0)continue;ue=ee.slice(0,1).join("")}return v(ue),u+=ue.length,(o=o.slice(ue.length)).length}}function U(){return/[^a-fA-F0-9]/.test(t)?(v(o.join("")),s=v0,i):(o.push(t),e=t,i+1)}function q(){return t==="."||/[eE]/.test(t)?(o.push(t),s=W9,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(s=JTe,o.push(t),e=t,i+1):/[^\d]/.test(t)?(v(o.join("")),s=v0,i):(o.push(t),e=t,i+1)}function Z(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(v(o.join("")),s=v0,i):(o.push(t),e=t,i+1)}function X(){if(/[^\d\w_]/.test(t)){var ee=o.join("");return s=TVt.indexOf(ee)>-1?OVt:CVt.indexOf(ee)>-1?RVt:MVt,v(o.join("")),s=v0,i}return o.push(t),e=t,i+1}}function DVt(t){var e=$Vt(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function LVt(t){return DVt(t)}function NVt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const rZ=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function FVt(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of t)if(n.type==="preprocessor"){const s=i.exec(n.data);if(s){const o=s[1].replace(/\s\s+/g," ");if(o===r)return o;if(o===e)return n.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function kVt(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function q4(t,e,r,i){i=i||r;for(const n of t)if(n.type==="ident"&&n.data===r)return i in e?e[i]++:e[i]=0,q4(t,e,i+"_"+e[i],i);return r}function VVe(t,e,r="afterVersion"){function i(l,c){for(let u=c;u<l.length;u++){const d=l[u];if(d.type==="operator"&&d.data===";")return u}return null}function n(l){let c=-1,u=0,d=-1;for(let p=0;p<l.length;p++){const A=l[p];if(A.type==="preprocessor"&&(A.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++u:A.data.match(/\#endif\s*.*/)&&--u),r!=="afterVersion"&&r!=="afterPrecision"||A.type==="preprocessor"&&/^#version/.test(A.data)&&(d=Math.max(d,p)),r==="afterPrecision"&&A.type==="keyword"&&A.data==="precision"){const v=i(l,p);if(v===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,v)}c<d&&u===0&&(c=p)}return c+1}const s={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=n(t);o(a-1)&&t.splice(a++,0,s);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,s)}function UVt(t,e,r,i="lowp"){VVe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function BVt(t,e,r,i,n="lowp"){VVe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function zVt(t,e){let r,i,n=-1;for(let s=e;s<t.length;s++){const o=t[s];if(o.type==="operator"&&(o.data==="["&&(r=s),o.data==="]")){i=s;break}o.type==="integer"&&(n=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),n}function KTe(t,e){const r=VVt();if(M(r))return r;const i=LVt(t);if(FVt(i,"100","300 es")==="300 es")return t;let n=null,s=null;const o={},a={};for(let l=0;l<i.length;++l){const c=i[l];switch(c.type){case"keyword":e===rp.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=e===rp.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),e===rp.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(n||(n=q4(i,o,"fragColor"),UVt(i,n,"vec4")),c.data=n),e===rp.FRAGMENT_SHADER&&c.data==="gl_FragData"){const u=zVt(i,l+1),d=q4(i,o,"fragData");BVt(i,d,"vec4",u,"mediump"),c.data=d}else e===rp.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(s||(s=q4(i,o,"gl_FragDepth")),c.data=s);break;case"ident":if(wVt.includes(c.data)){if(e===rp.VERTEX_SHADER&&kVt(i,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=q4(i,o,c.data)),c.data=a[c.data]}}}for(let l=i.length-1;l>=0;--l){const c=i[l];if(c.type==="preprocessor"){const u=c.data.match(/\#extension\s+(.*)\:/);if(u&&u[1]&&rZ.includes(u[1].trim())){const A=i[l+1];i.splice(l,A&&A.type==="whitespace"?2:1)}const d=c.data.match(/\#ifdef\s+(.*)/);d&&d[1]&&rZ.includes(d[1].trim())&&(c.data="#if 1");const p=c.data.match(/\#ifndef\s+(.*)/);p&&p[1]&&rZ.includes(p[1].trim())&&(c.data="#if 0")}}return GVt(t,NVt(i))}function VVt(t){return null}function GVt(t,e){return e}const jVt=4294967295;let HVt=class{constructor(e,r,i,n,s=new Map){this._context=e,this._locations=n,this._uniformBlockBindings=s,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===lr.WEBGL2&&(r=KTe(r,rp.VERTEX_SHADER),i=KTe(i,rp.FRAGMENT_SHADER)),this._vShader=eSe(this._context,rp.VERTEX_SHADER,r),this._fShader=eSe(this._context,rp.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Pa.Shader,this),Sie()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),Sie()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===lr.WEBGL2){const l=o;for(const[c,u]of this._uniformBlockBindings){const d=l.getUniformBlockIndex(a,c);d<jVt&&l.uniformBlockBinding(a,d,u)}}this._glName=a,this._context.instanceCounter.increment(Pa.Program,this)}get glName(){return this._glName}get hasGLName(){return M(this._glName)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||k(this.glName)?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Pa.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Pa.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&M(this.glName)&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1iv(e,r){yg(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){yg(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){yg(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){yg(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1fv(e,r){yg(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===n[0]&&i===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),n[0]=r,n[1]=i)}setUniform2fv(e,r){yg(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,n){const s=this._nameToUniform3.get(e);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,n),this._nameToUniform3[e]=[r,i,n]):r===s[0]&&i===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,n),s[0]=r,s[1]=i,s[2]=n)}setUniform3fv(e,r){yg(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(this._getUniformLocation(e),r)}setUniform4f(e,r,i,n,s){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,n,s),this._nameToUniform4.set(e,[r,i,n,s])):o!==void 0&&r===o[0]&&i===o[1]&&n===o[2]&&s===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,n,s),o[0]=r,o[1]=i,o[2]=n,o[3]=s)}setUniform4fv(e,r){yg(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(this._getUniformLocation(e),r)}setUniformMatrix3fv(e,r,i=!1){yg(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,r)}setUniformMatrix4fv(e,r,i=!1){yg(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,r)}stop(){}};function eSe(t,e,r){const i=t.gl,n=i.createShader(e);return i.shaderSource(n,r),i.compileShader(n),Sie()&&!i.getShaderParameter(n,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===rp.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(n)),console.error(qVt(r))),n}function qVt(t){let e=2;return t.replace(/\n/g,()=>`
`+WVt(e++)+":")}function WVt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function yg(t,e,r){const i=t.get(e);return i?Fae(i,r):(t.set(e,Array.from(r)),!0)}let QVt=class{constructor(e){this._rctx=e,this._store=new yP}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,n){const s=this._store.get(e,r);if(M(s))return s.ref(),s;const o=new HVt(this._rctx,e,r,i,n);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLObjects:e}}},gF=class{constructor(){this._result=!1}dispose(){this._program=kt(this._program)}get result(){return M(this._program)&&(this._result=this._test(this._program),this.dispose()),this._result}},YVt=class extends gF{constructor(e){super(),this._rctx=e,this._dummyProgram=null,this._rctx.type===lr.WEBGL2&&Fe("mac")&&Fe("chrome")&&(this._program=this._prepareProgram(),this._dummyProgram=this._prepareDummyProgram())}dispose(){var e;super.dispose(),(e=this._dummyProgram)==null||e.dispose(),this._dummyProgram=null}_test(e){const r=this._rctx;r.resetState();const i=new uo(r,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE},{target:cr.TEXTURE_2D,wrapMode:Ar.CLAMP_TO_EDGE,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.NEAREST,width:1,height:1}),n=Ji.createIndex(this._rctx,ki.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.useProgram(this._dummyProgram),r.bindBuffer(n,yr.ELEMENT_ARRAY_BUFFER),r.drawElements(wr.POINTS,1,Yt.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(wr.TRIANGLES,0,258);const s=new Uint8Array(4);return i.readPixels(0,0,1,1,_t.RGBA,xr.UNSIGNED_BYTE,s),i.dispose(),n.dispose(),s[0]===255}_prepareProgram(){const r=`
    precision highp float;

    varying float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${D.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`
    precision highp float;

    varying float triangleId;

    void main(void) {
      gl_FragColor = triangleId == ${D.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareDummyProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,r=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,r,new Map([]))}},XVt=class extends gF{constructor(e){super(),this._rctx=e,this._program=tSe(this._rctx,!1),this._obfuscated=tSe(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=kt(this._obfuscated)}_test(e){if(Fe("force-double-precision-obfuscation"))return!0;if(k(this._obfuscated))return!1;const r=this._runProgram(e),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new uo(r,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE},{target:cr.TEXTURE_2D,wrapMode:Ar.CLAMP_TO_EDGE,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.NEAREST,width:1,height:1}),n=Ji.createVertex(r,ki.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Zf(r,new Map([["position",0]]),{geometry:[new Rl("position",2,Yt.UNSIGNED_SHORT,0,4)]},{geometry:n}),o=pt(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=pt(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=new Float32Array(6);fne(o,l,3);const c=new Float32Array(6);fne(a,c,3),r.useProgram(e),e.setUniform3f("u_highA",l[0],l[2],l[4]),e.setUniform3f("u_lowA",l[1],l[3],l[5]),e.setUniform3f("u_highB",c[0],c[2],c[4]),e.setUniform3f("u_lowB",c[1],c[3],c[5]),r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.bindVAO(s),r.drawArrays(wr.TRIANGLE_STRIP,0,4);const u=new Uint8Array(4);i.readPixels(0,0,1,1,_t.RGBA,xr.UNSIGNED_BYTE,u),s.dispose(!1),n.dispose(),i.dispose();const d=(o[2]-a[2])/25,p=fde(u);return Math.abs(d-p)}};function tSe(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(r,i,new Map([["position",0]]))}var rSe,iSe,Use={},ZVt={get exports(){return Use},set exports(t){Use=t}};rSe=ZVt,(iSe=function(){var t=function(b){window.console&&window.console.log&&window.console.log(b)},e=function(b){window.console&&window.console.error?window.console.error(b):t(b)},r={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},i=null,n=null;function s(b){if(i==null)for(var S in i={},n={},b)typeof b[S]=="number"&&(i[b[S]]=S,n[S]=b[S])}function o(){if(i==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(b){return o(),i[b]!==void 0}function l(b){o();var S=i[b];return S!==void 0?"gl."+S:"/*UNKNOWN WebGL ENUM*/ 0x"+b.toString(16)}function c(b,S,E,R){var O;if((O=r[b])!==void 0&&(O=O[S])!==void 0&&O[E]){if(typeof O[E]=="object"&&O[E].enumBitwiseOr!==void 0){for(var I=O[E].enumBitwiseOr,N=0,L=[],B=0;B<I.length;++B){var U=n[I[B]];R&U&&(N|=U,L.push(l(U)))}return N===R?L.join(" | "):l(R)}return l(R)}return R===null?"null":R===void 0?"undefined":R.toString()}function u(b,S){for(var E="",R=S.length,O=0;O<R;++O)E+=(O==0?"":", ")+c(b,R,O,S[O]);return E}function d(b,S,E){b.__defineGetter__(E,function(){return S[E]}),b.__defineSetter__(E,function(R){S[E]=R})}function p(b,S,E,R){R=R||b,s(b),S=S||function(U,q,Z){for(var X="",ee=Z.length,se=0;se<ee;++se)X+=(se==0?"":", ")+c(q,ee,se,Z[se]);e("WebGL error "+l(U)+" in "+q+"("+X+")")};var O={};function I(U,q){return function(){E&&E(q,arguments);var Z=U[q].apply(U,arguments),X=R.getError();return X!=0&&(O[X]=!0,S(X,q,arguments)),Z}}var N={};for(var L in b)if(typeof b[L]=="function")if(L!="getExtension")N[L]=I(b,L);else{var B=I(b,L);N[L]=function(){return p(B.apply(b,arguments),S,E,R)}}else d(N,b,L);return N.getError=function(){for(var U in O)if(O.hasOwnProperty(U)&&O[U])return O[U]=!1,U;return b.NO_ERROR},N}function A(b){var S=b.getParameter(b.MAX_VERTEX_ATTRIBS),E=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,E);for(var R=0;R<S;++R)b.disableVertexAttribArray(R),b.vertexAttribPointer(R,4,b.FLOAT,!1,0,0),b.vertexAttrib1f(R,0);b.deleteBuffer(E);var O=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS);for(R=0;R<O;++R)b.activeTexture(b.TEXTURE0+R),b.bindTexture(b.TEXTURE_CUBE_MAP,null),b.bindTexture(b.TEXTURE_2D,null);for(b.activeTexture(b.TEXTURE0),b.useProgram(null),b.bindBuffer(b.ARRAY_BUFFER,null),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null),b.bindFramebuffer(b.FRAMEBUFFER,null),b.bindRenderbuffer(b.RENDERBUFFER,null),b.disable(b.BLEND),b.disable(b.CULL_FACE),b.disable(b.DEPTH_TEST),b.disable(b.DITHER),b.disable(b.SCISSOR_TEST),b.blendColor(0,0,0,0),b.blendEquation(b.FUNC_ADD),b.blendFunc(b.ONE,b.ZERO),b.clearColor(0,0,0,0),b.clearDepth(1),b.clearStencil(-1),b.colorMask(!0,!0,!0,!0),b.cullFace(b.BACK),b.depthFunc(b.LESS),b.depthMask(!0),b.depthRange(0,1),b.frontFace(b.CCW),b.hint(b.GENERATE_MIPMAP_HINT,b.DONT_CARE),b.lineWidth(1),b.pixelStorei(b.PACK_ALIGNMENT,4),b.pixelStorei(b.UNPACK_ALIGNMENT,4),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),b.UNPACK_COLORSPACE_CONVERSION_WEBGL&&b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,b.BROWSER_DEFAULT_WEBGL),b.polygonOffset(0,0),b.sampleCoverage(1,!1),b.scissor(0,0,b.canvas.width,b.canvas.height),b.stencilFunc(b.ALWAYS,0,4294967295),b.stencilMask(4294967295),b.stencilOp(b.KEEP,b.KEEP,b.KEEP),b.viewport(0,0,b.canvas.width,b.canvas.height),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT|b.STENCIL_BUFFER_BIT);b.getError(););}function v(b){var S,E,R=[],O=[],I={},N=1,L=!1,B=[],U=0,q=0,Z=!1,X=0,ee={};function se(de){return typeof de=="function"?de:function(Ee){de.handleEvent(Ee)}}b.getContext=(E=b.getContext,function(){var de=E.apply(b,arguments);if(de instanceof WebGLRenderingContext){if(de!=S){if(S)throw"got different context";I=fe(S=de)}return I}return de});var ue=function(de){R.push(se(de))},re=function(de){O.push(se(de))};function te(de){var Ee=de.addEventListener;de.addEventListener=function(Ie,Ge,Ke){switch(Ie){case"webglcontextlost":ue(Ge);break;case"webglcontextrestored":re(Ge);break;default:Ee.apply(de,arguments)}}}function j(){for(var de=Object.keys(ee),Ee=0;Ee<de.length;++Ee)delete ee[de]}function H(){++q,L||U==q&&b.loseContext()}function W(de,Ee){var Ie=de[Ee];return function(){if(H(),!L)return Ie.apply(de,arguments)}}function oe(){for(var de=0;de<B.length;++de){var Ee=B[de];Ee instanceof WebGLBuffer?S.deleteBuffer(Ee):Ee instanceof WebGLFramebuffer?S.deleteFramebuffer(Ee):Ee instanceof WebGLProgram?S.deleteProgram(Ee):Ee instanceof WebGLRenderbuffer?S.deleteRenderbuffer(Ee):Ee instanceof WebGLShader?S.deleteShader(Ee):Ee instanceof WebGLTexture&&S.deleteTexture(Ee)}}function le(de){return{statusMessage:de,preventDefault:function(){Z=!0}}}return te(b),b.loseContext=function(){if(!L){for(L=!0,U=0,++N;S.getError(););j(),ee[S.CONTEXT_LOST_WEBGL]=!0;var de=le("context lost"),Ee=R.slice();setTimeout(function(){for(var Ie=0;Ie<Ee.length;++Ie)Ee[Ie](de);X>=0&&setTimeout(function(){b.restoreContext()},X)},0)}},b.restoreContext=function(){L&&O.length&&setTimeout(function(){if(!Z)throw"can not restore. webglcontestlost listener did not call event.preventDefault";oe(),A(S),L=!1,q=0,Z=!1;for(var de=O.slice(),Ee=le("context restored"),Ie=0;Ie<de.length;++Ie)de[Ie](Ee)},0)},b.loseContextInNCalls=function(de){if(L)throw"You can not ask a lost contet to be lost";U=q+de},b.getNumCalls=function(){return q},b.setRestoreTimeout=function(de){X=de},b;function fe(de){for(var Ee in de)typeof de[Ee]=="function"?I[Ee]=W(de,Ee):d(I,de,Ee);I.getError=function(){if(H(),!L)for(;Ne=S.getError();)ee[Ne]=!0;for(var Ne in ee)if(ee[Ne])return delete ee[Ne],Ne;return I.NO_ERROR};for(var Ie=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],Ge=0;Ge<Ie.length;++Ge){var Ke=Ie[Ge];I[Ke]=function(Ne){return function(){if(H(),L)return null;var Xe=Ne.apply(de,arguments);return Xe.__webglDebugContextLostId__=N,B.push(Xe),Xe}}(de[Ke])}var vt=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(Ge=0;Ge<vt.length;++Ge)Ke=vt[Ge],I[Ke]=function(Ne){return function(){return H(),L?null:Ne.apply(de,arguments)}}(I[Ke]);var ke=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(Ge=0;Ge<ke.length;++Ge)Ke=ke[Ge],I[Ke]=function(Ne){return function(){return H(),!L&&Ne.apply(de,arguments)}}(I[Ke]);return I.checkFramebufferStatus=function(Ne){return function(){return H(),L?I.FRAMEBUFFER_UNSUPPORTED:Ne.apply(de,arguments)}}(I.checkFramebufferStatus),I.getAttribLocation=function(Ne){return function(){return H(),L?-1:Ne.apply(de,arguments)}}(I.getAttribLocation),I.getVertexAttribOffset=function(Ne){return function(){return H(),L?0:Ne.apply(de,arguments)}}(I.getVertexAttribOffset),I.isContextLost=function(){return L},I}}return{init:s,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:u,makeDebugContext:p,makeLostContextSimulatingCanvas:v,resetToInitialState:A}}())!==void 0&&(rSe.exports=iSe);let JVt=class extends gF{constructor(e){var n,s,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===lr.WEBGL1)return void(this._result=!(!((n=e.capabilities.textureFloat)!=null&&n.textureFloat)||!((s=e.capabilities.colorBufferFloat)!=null&&s.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new uo(r,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE},{target:cr.TEXTURE_2D,wrapMode:Ar.CLAMP_TO_EDGE,pixelFormat:_t.RGBA,dataType:xr.FLOAT,internalFormat:pr.RGBA32F,samplingMode:zt.NEAREST,width:1,height:1}),n=Ji.createVertex(r,ki.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Zf(r,new Map([["a_pos",0]]),{geometry:[new Rl("a_pos",2,Yt.UNSIGNED_SHORT,0,4)]},{geometry:n});r.useProgram(e);const o=r.getBoundFramebufferObject(),{x:a,y:l,width:c,height:u}=r.getViewport();r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.bindVAO(s),r.drawArrays(wr.TRIANGLE_STRIP,0,4);const d=Pr({blending:v7e});r.setPipelineState(d),r.drawArrays(wr.TRIANGLE_STRIP,0,4),Use.init(r);const p=r.gl.getError();return r.setViewport(a,l,c,u),r.bindFramebuffer(o),s.dispose(!1),n.dispose(),i.dispose(),p!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},KVt=class extends gF{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new uo(r,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE},{target:cr.TEXTURE_2D,wrapMode:Ar.CLAMP_TO_EDGE,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.NEAREST,width:1,height:1}),n=new Uint8Array(4),s=Ji.createVertex(r,ki.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Zf(r,new Map([["a_position",0]]),{geometry:[new Rl("a_position",2,Yt.SHORT,0,4)]},{geometry:s});r.useProgram(e);const a=new Xt(r,{target:cr.TEXTURE_2D,wrapMode:Ar.CLAMP_TO_EDGE,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(a,0);const l=r.getBoundFramebufferObject();r.bindFramebuffer(i),r.useProgram(e);const{x:c,y:u,width:d,height:p}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(wr.TRIANGLE_STRIP,0,4),r.setViewport(c,u,d,p),i.readPixels(0,0,1,1,_t.RGBA,xr.UNSIGNED_BYTE,n),o.dispose(!1),s.dispose(),i.dispose();const A=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return A&&we.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),r.bindFramebuffer(l),A}};new Rl("a_pos",2,Yt.BYTE,0,2);new Rl("a_pos",2,Yt.BYTE,0,4),new Rl("a_tex",2,Yt.BYTE,2,4);const eGt={geometry:[new Rl("a_pos",2,Yt.UNSIGNED_SHORT,0,4)]};let tGt=class extends gF{constructor(e){super(),this._rctx=e,this._image=new Image,this._image.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",this._image.width=5,this._image.height=5,this._image.decode();const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;
    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose(),this._image.src=""}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new uo(r,{colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.NONE},{target:cr.TEXTURE_2D,wrapMode:Ar.CLAMP_TO_EDGE,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,samplingMode:zt.NEAREST,width:1,height:1}),n=Ji.createVertex(r,ki.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Zf(r,new Map([["a_pos",0]]),eGt,{geometry:n}),o=new Xt(r,{dataType:xr.UNSIGNED_BYTE,pixelFormat:_t.RGBA,preMultiplyAlpha:!1,wrapMode:Ar.CLAMP_TO_EDGE,samplingMode:zt.LINEAR},this._image);r.useProgram(e),r.bindTexture(o,0),e.setUniform1i("u_texture",0);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:u,height:d}=r.getViewport();r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(rs.COLOR_BUFFER_BIT),r.bindVAO(s),r.drawArrays(wr.TRIANGLE_STRIP,0,4);const p=new Uint8Array(4);return i.readPixels(0,0,1,1,_t.RGBA,xr.UNSIGNED_BYTE,p),s.dispose(!1),n.dispose(),i.dispose(),o.dispose(),r.setViewport(l,c,u,d),r.bindFramebuffer(a),p[0]!==255}},rGt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new JVt(e),this.svgPremultipliesAlpha=new tGt(e),this.doublePrecisionRequiresObfuscation=new XVt(e),this.ignoresSamplerPrecision=new KVt(e),this.drawArraysRequiresIndicesTypeReset=new YVt(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function iGt(t,e){if(e.disjointTimerQuery)return null;if(oy(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const r=t.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function nGt(t){if(oy(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function sGt(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function oGt(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function aGt(t,e){if(oy(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const r=t.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function lGt(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function cGt(t,e){if(oy(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const r=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function uGt(t,e){if(oy(t)){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),i=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function a$(t,e,r,i,n){if(i&&oy(t))return!0;if(e[r])return!1;for(const s of n)if(t.getExtension(s))return!0;return!1}function hGt(t,e){if(!oy(t)||e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function dGt(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function pGt(t,e){if(oy(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const r=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}let fGt=class{constructor(e,r){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=iGt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=nGt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=pGt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=sGt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=oGt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=lGt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=mVt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=cGt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=uGt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=aGt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=a$(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=a$(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=a$(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=a$(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=dGt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=hGt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=a$(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},mGt=class{constructor(e,r){this.gl=e,this.instanceCounter=new bVt,this.programCache=new QVt(this),this._state=new GTe,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=oy(e)?lr.WEBGL2:lr.WEBGL1,this._loadExtensions(),this.configure(r)}get gl2(){return this.type===lr.WEBGL1?null:this.gl}configure(e){this._capabilities=new fGt(this.gl,e),this._parameters=this._loadParameters(e);const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new GTe,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new $wt({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const n=i.color;this.setBlendColor(n.r,n.g,n.b,n.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const n=i.function;this.setStencilFunction(n.func,n.ref,n.mask);const s=i.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),kt(this._driverTest),this._driverTest=new rGt(this)}dispose(){kt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(yr.ARRAY_BUFFER),this.unbindBuffer(yr.ELEMENT_ARRAY_BUFFER),this.type===lr.WEBGL2&&(this.unbindBuffer(yr.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(yr.PIXEL_PACK_BUFFER),this.unbindBuffer(yr.PIXEL_UNPACK_BUFFER),this.unbindBuffer(yr.COPY_READ_BUFFER),this.unbindBuffer(yr.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,Yd()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,n){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(e,r,i,n),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,n){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(e,r,i,n),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,n){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===n||(this.gl.colorMask(e,r,i,n),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,n){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===n||(this.gl.clearColor(e,r,i,n),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=n)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,n){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===n||(this.gl.scissor(e,r,i,n),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=n)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=mm.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,n){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,r,i,n),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===mm.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=mm.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,n){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,r,i,n),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(BQ+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&rs.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&rs.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&rs.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}drawArrays(e,r,i){if(Yd()&&(this._numOfDrawCalls++,this._numOfTriangles+=nSe(e,i)),this.gl.drawArrays(e,r,i),Yd()){const n=F1e(this);n&&console.error("drawArrays:",n)}}drawElements(e,r,i,n){if(Yd()&&(this._numOfDrawCalls++,this._numOfTriangles+=nSe(e,r)),this.gl.drawElements(e,r,i,n),Yd()){const s=F1e(this);if(s){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:r,type:i,offset:n},d=rl(a,v=>v.size)??0,p=n+r,A=d<p?`. Buffer is too small. Attempted to draw index ${p} of ${d}`:"";console.error(`drawElements: ${s}${A}`,{args:u,vao:c})}}}logInfo(){Yd()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Yd()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,n){i=Math.max(Math.round(i),1),n=Math.max(Math.round(n),1);const s=this._state.viewport;s.x===e&&s.y===r&&s.width===i&&s.height===n||(s.x=e,s.y=r,s.width=i,s.height=n,this.gl.viewport(e,r,i,n))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var r;this._state.program!==e&&((r=this._state.program)==null||r.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[r];return k(e)||e.glName==null?(M(n)&&(this.setActiveTexture(r,i),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[r]=null,n):i||n!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,n):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),n)}unbindTexture(e){if(!k(e))for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(k(e))return this.gl.bindFramebuffer(qa.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(qa.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const n=r===qa.READ_FRAMEBUFFER,s=n?this._state.readFramebuffer:this._state.drawFramebuffer;(i||s!==e)&&(k(e)?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),n?this._state.readFramebuffer=br(e,null):this._state.drawFramebuffer=br(e,null))}blitFramebuffer(e,r,i=0,n=0,s=e.width,o=e.height,a=0,l=0,c=r.width,u=r.height,d=rs.COLOR_BUFFER_BIT,p=zt.NEAREST){this.bindFramebufferSeparate(e,qa.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,qa.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,n,s,o,a,l,c,u,d,p)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case yr.ARRAY_BUFFER:this._state.vertexBuffer=Mh(this.gl,e,r,this._state.vertexBuffer);break;case yr.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Mh(this.gl,e,r,this._state.indexBuffer);break;case yr.UNIFORM_BUFFER:this._state.uniformBuffer=Mh(this.gl,e,r,this._state.uniformBuffer);break;case yr.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Mh(this.gl,e,r,this._state.pixelPackBuffer);break;case yr.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Mh(this.gl,e,r,this._state.pixelUnpackBuffer);break;case yr.COPY_READ_BUFFER:this._state.copyReadBuffer=Mh(this.gl,e,r,this._state.copyReadBuffer);break;case yr.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Mh(this.gl,e,r,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let n=i[r];return k(n)&&(n={buffer:null,offset:0,size:0},i[r]=n),n}bindBufferBase(e,r,i){const n=this._getBufferBinding(e,r);k(n)||n.buffer===i&&n.offset===0&&n.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),n.buffer=i,n.offset=0,n.size=0)}bindBufferRange(e,r,i,n,s){const o=this._getBufferBinding(e,r);if(!k(o)&&!(o.buffer===i&&o.offset===n&&o.size===s)){if(n%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,r,i.glName,n,s),o.buffer=i,o.offset=n,o.size=s}}bindUBO(e,r,i,n){k(r)?this.bindBufferBase(yr.UNIFORM_BUFFER,e,null):(Yd()&&(n??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&n!==void 0?this.bindBufferRange(yr.UNIFORM_BUFFER,e,r.buffer,i,n):this.bindBufferBase(yr.UNIFORM_BUFFER,e,r.buffer))}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const n=this._state.uniformBufferBindingPoints[r];M(n)&&n.buffer===e.buffer&&this.bindBufferBase(yr.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case yr.ARRAY_BUFFER:this._state.vertexBuffer=Mh(this.gl,null,e,this._state.vertexBuffer);break;case yr.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Mh(this.gl,null,e,this._state.indexBuffer);break;case yr.UNIFORM_BUFFER:this._state.uniformBuffer=Mh(this.gl,null,e,this._state.uniformBuffer);break;case yr.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Mh(this.gl,null,e,this._state.pixelPackBuffer);break;case yr.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Mh(this.gl,null,e,this._state.pixelUnpackBuffer);break;case yr.COPY_READ_BUFFER:this._state.copyReadBuffer=Mh(this.gl,null,e,this._state.copyReadBuffer);break;case yr.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Mh(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){k(e)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e)}async clientWaitAsync(e=10){const r=this.gl,i=r.fenceSync(Tie.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(Pa.Sync,i),r.flush();do await yS(e),n=r.clientWaitSync(i,0,0);while(n===hz.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Pa.Sync,i),r.deleteSync(i),n===hz.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=qa.FRAMEBUFFER){return e===qa.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(yr.ARRAY_BUFFER),this.unbindBuffer(yr.ELEMENT_ARRAY_BUFFER),this.type===lr.WEBGL2&&(this.unbindBuffer(yr.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(yr.PIXEL_PACK_BUFFER),this.unbindBuffer(yr.PIXEL_UNPACK_BUFFER),this.unbindBuffer(yr.COPY_READ_BUFFER),this.unbindBuffer(yr.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(st.ONE,st.ZERO),this.setBlendEquation(UA.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(mm.BACK),this.setFrontFace(pO.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Qn.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Qn.ALWAYS,0,0),this.setStencilOp(co.KEEP,co.KEEP,co.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var s,o,a;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:r,gl2:i}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)r.disableVertexAttribArray(l);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(yr.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(yr.ELEMENT_ARRAY_BUFFER,null),M(i)){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(yr.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(M(c)){const{buffer:u,offset:d,size:p}=c;u!==null?d===0&&p===0?i.bindBufferBase(yr.UNIFORM_BUFFER,l,u.glName):i.bindBufferRange(yr.UNIFORM_BUFFER,l,u.glName,d,p):i.bindBufferBase(yr.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(yr.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(yr.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(yr.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(yr.COPY_WRITE_BUFFER,null),i.bindFramebuffer(qa.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(qa.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(Hd.COLOR_ATTACHMENT0)),i.bindFramebuffer(qa.DRAW_FRAMEBUFFER,((s=this._state.drawFramebuffer)==null?void 0:s.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(qa.FRAMEBUFFER,((o=this._state.drawFramebuffer)==null?void 0:o.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}r.useProgram(((a=this._state.program)==null?void 0:a.glName)??null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){r.activeTexture(BQ+l),r.bindTexture(cr.TEXTURE_2D,null),r.bindTexture(cr.TEXTURE_CUBE_MAP,null),this.type===lr.WEBGL2&&(r.bindTexture(cr.TEXTURE_3D,null),r.bindTexture(cr.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];M(c)&&r.bindTexture(c.descriptor.target,c.glName)}r.activeTexture(BQ+this._state.activeTexture);const n=this._state.viewport;r.viewport(n.x,n.y,n.width,n.height),this.resetInfo()}_loadExtensions(){this.type===lr.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(e){const r=this.capabilities.textureFilterAnisotropic,i=e.maxAnisotropy??1/0,n=this.type===lr.WEBGL2,s=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:r?Math.min(this.gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY),i):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:n?s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:n?s.getParameter(s.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:n?s.getParameter(s.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:n?s.getParameter(s.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:n?s.getParameter(s.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:n?s.getParameter(s.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:n?s.getParameter(s.MAX_SAMPLES):1};return Xt.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}};function Mh(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function nSe(t,e){switch(t){case wr.POINTS:return 2*e;case wr.TRIANGLES:return e/3;case wr.TRIANGLE_STRIP:case wr.TRIANGLE_FAN:return e-2;default:return 0}}let gGt=class extends mGt{constructor(e,r,i){super(e,r),this.newCache=i,this._refCount=1}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}bindTechnique(e,r,i,n){return this.useProgram(e.program),e.bindPipelineState(this,i==null?void 0:i.slot,!!n),e.program.bindPass(r,i),e.program}get test(){return this.programCache.test}},YC=class extends rt{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Ws,this._frameTask=e.view.resourceController.scheduler.registerTask(ar.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(lo.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return k(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(Vde,new Gde)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),br(r.loadingPromise,r)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(this._rctx,this.textureTechnique,r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",so.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(k(r))return tr(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),n=new AGt(e,()=>{this._frameTask.schedule(()=>{n.isUnreferenced&&r.unload()})});return this._textures.set(e,n),n.ref(),M(r.glTexture)?(this._updateGLTexture(n,r.glTexture),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),n):(this._loadingCount++,n.loadingPromise=this._stage.schedule(()=>{const s=r.load(this._rctx,()=>this.textureTechnique),o=l=>(this._loadingCount--,n.loadingPromise=null,this._updateGLTexture(n,l),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),n),a=l=>(this._loadingCount--,n.loadingPromise=null,$o(l)||we.getLogger(this.declaredClass).error(l),null);return Op(s)?s.then(o,a):o(s)}),n.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",so.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};h([f()],YC.prototype,"_loadingCount",void 0),h([f()],YC.prototype,"_frameTask",void 0),h([f()],YC.prototype,"updating",null),YC=h([Q("esri.views.3d.webgl-engine.lib.TextureRepository")],YC);let AGt=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(we.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}},W4=class extends rt{constructor(){super(...arguments),this._passParameters=new yGt,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=kt(this._passParameters.waveNormal),this._passParameters.wavePertubation=kt(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return B_.LOADING;if(M(this._passParameters.waveNormal)&&M(this._passParameters.wavePertubation))return B_.LOADED;const r={target:cr.TEXTURE_2D,pixelFormat:_t.RGBA,dataType:xr.UNSIGNED_BYTE,wrapMode:Ar.REPEAT,samplingMode:zt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};return++this._loading,u1(nn("esri/images/materials/water/normals.jpg")).then(i=>this._passParameters.waveNormal=new Xt(e,{...r,width:i.width,height:i.height},i)).catch(i=>we.getLogger(this.declaredClass).error("Failed to load water material normal texture.",i)).finally(()=>--this._loading),++this._loading,u1(nn("esri/images/materials/water/perturbation.jpg")).then(i=>this._passParameters.wavePertubation=new Xt(e,{...r,width:i.width,height:i.height},i)).catch(i=>we.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",i)).finally(()=>--this._loading),B_.LOADING}};h([f()],W4.prototype,"_loading",void 0),h([f({type:Boolean,readOnly:!0})],W4.prototype,"updating",null),W4=h([Q("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],W4);let yGt=class extends En{};const sSe=2048,_Gt=1.5,vGt=8;function bGt(t,e){const{format:r,quality:i,rotation:n,disableDecorations:s}=t||{},o=Tpe(t,e.padding),a=MGt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=CGt(t,a),u=PGt(r),d=NGt[u];return{format:u,quality:He(i??d,0,100),area:a,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function wGt(t,e){const r=bGt(t,e),i=r.area,n=r.width/i.width,s=Tpe(r,e.padding),o=s.left+s.right,a=s.top+s.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*n+o),d=Math.floor(c*n+a),p=t&&t.layers?t.layers:[],A=r.ignoreBackground,v=r.ignorePadding;return{framebufferWidth:u,framebufferHeight:d,region:{x:Math.floor(i.x*n)+s.left,y:Math.floor(i.y*n)+s.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:n,layers:p,disableDecorations:r.disableDecorations,ignoreBackground:A,ignorePadding:v,objectAndLayerIdColor:!1}}function iZ(t,e,r){const{ctx:i,canvas:n}=GVe(t,r),s=i.getImageData(0,0,t.width,t.height),o=TGt(n,e);return jVe(n),{dataUrl:o,data:s}}function nZ(t,e){const{ctx:r,canvas:i}=GVe(t,e),n=r.getImageData(0,0,t.width,t.height);return jVe(i),n}function GVe(t,e){const r=xGt();e.premultipliedAlpha&&$Gt(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&IGt(i),{ctx:i,canvas:r}}function jVe(t){t.width=0,t.height=0}function xGt(){return k(sZ)&&(sZ=document.createElement("canvas")),sZ}let sZ=null;function TGt(t,e){const r=DGt[e.format],i=e.quality/100;return t.toDataURL(r,i)}function SGt(t,e,r,i=0,n=0,s=t.width-i,o=t.height-n,a=!1){const{data:l}=t,{width:c,height:u,data:d}=e,p=s/c,A=o/u,v=Math.ceil(p/2),b=Math.ceil(A/2),S=t.width;for(let E=0;E<u;E++)for(let R=0;R<c;R++){const O=4*(R+(a?u-E-1:E)*c);let I=0,N=0,L=0,B=0,U=0,q=0;const Z=(E+.5)*A;for(let X=Math.floor(E*A);X<(E+1)*A;X++){const ee=Math.abs(Z-(X+.5))/b,se=(R+.5)*p,ue=ee*ee;for(let re=Math.floor(R*p);re<(R+1)*p;re++){const te=Math.abs(se-(re+.5))/v,j=Math.sqrt(ue+te*te);if(j>=1)continue;let H=2*j*j*j-3*j*j+1;const W=4*(i+re+(n+X)*S);q+=H*l[W+3],N+=H,!r&&l[W+3]<255&&(H=H*l[W+3]/255),L+=H*l[W],B+=H*l[W+1],U+=H*l[W+2],I+=H}}d[O]=L/I,d[O+1]=B/I,d[O+2]=U/I,d[O+3]=q/N}return e}function EGt(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:n,pixelRatio:s,region:o}=t,a=Tpe(t,r),l=a.left+a.right,c=a.top+a.bottom,u=i-l,d=n-c,p=Math.min(vGt,Math.min((sSe-l)/u,(sSe-c)/d));return p<_Gt?t:{...t,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(d*p)+c,pixelRatio:s*p,resample:{region:{x:Math.round((o.x-a.left)*p)+a.left,y:Math.round((o.y-a.top)*p)+a.top,width:Math.round(o.width*p),height:Math.round(o.height*p)},width:i,height:n}}}function CGt(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const n=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/n)}:{width:Math.floor(i*n),height:Math.floor(i)}}function MGt(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,n=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&n!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,n);else if(i==null&&n!=null){const s=Math.min(r.width,i);r.height=s/r.width*r.height,r.width=s}else if(i!=null&&n==null){const s=Math.min(r.height,n);r.width=s/r.height*r.width,r.height=s}}return RGt(OGt(r,t),e)}function RGt(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),n={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},s=n.width/n.height,o=t.width/t.height;if(o===s)return n;if(o>s){const c=Math.floor(n.width/o),u=n.height-c;return{x:n.x,y:Math.floor(n.y+u/2),width:n.width,height:c}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}function OGt(t,e){if(!e||e.width==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const s=Math.floor(t.height*r);return t.x-=(s-t.width)/2,t.width=s,t}const n=Math.floor(t.width/r);return t.y-=(n-t.height)/2,t.height=n,t}function Tpe(t,e){return!e||t&&t.ignorePadding?FGt:e}function PGt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return LGt}}function IGt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function $Gt(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const n=e[i+3];if(n!==255&&n>0){const s=255/n;e[i+0]=e[i+0]*s,e[i+1]=e[i+1]*s,e[i+2]=e[i+2]*s}}}const DGt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},oSe=98,LGt="png",NGt={png:100,jpg:oSe,jpeg:oSe},FGt={top:0,right:0,bottom:0,left:0};let kGt=class{constructor(e,r){this.viewCamera=e,this.frameHasDecorations=r}},UGt=class{constructor(e,r,i,n){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=n,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(so.BACKGROUND);const r=T2();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const n={...i.settings,pixelRatio:i.settings.pixelRatio*e.viewCamera.pixelRatio},s=this._renderScreenshot(e,n,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const n=e.getContext("2d"),s=i.pixelRatio;return n.save(),n.translate(0,r.height),n.scale(1,-1),i.region&&n.translate(-i.region.x,-i.region.y),n.scale(s,s),r=this._renderFunctions.renderOverlay(e,r),n.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:n,region:s,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=oX(i,n,a);this._rctx.gl.readPixels(0,0,i,n,_t.RGBA,Yt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=oX(s.width,s.height,a);return SGt(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:n}=e,s=this._ensureScreenshotEncodeCanvas(),o=oX(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,i-(n.y+n.height),n.width,n.height,_t.RGBA,Yt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(s,o,e)}_renderScreenshot(e,r,i){let n=null,s=null;const o=e.viewCamera,{framebufferWidth:a,framebufferHeight:l}=r;let c=!1;const u=r.disableDecorations&&e.frameHasDecorations,d=a!==o.fullWidth||l!==o.fullHeight,p=r.ignorePadding&&o.pixelRatio!==r.pixelRatio,A=d||u||p||r.objectAndLayerIdColor;if(r.objectAndLayerIdColor&&(s=new uo(this._rctx,{width:a,height:l,colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.DEPTH_STENCIL_RENDER_BUFFER})),A){const E=o.clone();if(r.ignorePadding){const I=DN(E.padding);for(let N=0;N<4;N++)I[N]=Math.round(I[N]/E.pixelRatio*r.pixelRatio);E.padding=I}E.fullWidth=a,E.fullHeight=l,E.pixelRatio=r.pixelRatio;const R=o.fovX-E.fovX,O=o.fovY-E.fovY;R<0&&R<O?E.fovX=o.fovX:O<0&&O<R&&(E.fovY=o.fovY),this._forceCameraHook(E),c=!0,n=new uo(this._rctx,{width:E.fullWidth,height:E.fullHeight,colorTarget:Fs.TEXTURE,depthStencilTarget:Ni.DEPTH_STENCIL_RENDER_BUFFER}),this._renderFunctions.renderScene(n,s,E,r.disableDecorations?zS.OFF:zS.ON,i),this._disposeOffscreenBuffers()}const v=()=>{this._rctx.bindFramebuffer(null),kt(n)},b=this._readbackScreenshot(r,v);v();let S=null;if(r.objectAndLayerIdColor){const E=()=>{this._rctx.bindFramebuffer(null),kt(s)};this._rctx.bindFramebuffer(s),S=this._readbackScreenshot(r,E),this._rctx.bindFramebuffer(null),E()}if(A&&!this._rctx.contextAttributes.alpha)for(let E=3;E<b.data.length;E+=4)b.data[E]=255;if(S&&!this._rctx.contextAttributes.alpha)for(let E=3;E<S.data.length;E+=4)S.data[E]=255;return c&&this._forceCameraHook(o),[b,S]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},Al=class extends rt{constructor(e){super({}),this.events=new Ws,this.waterTextureRepository=new W4,this._magnifierHelper=new QC,this.objectAndLayerIdRenderHelper=Fe("enable-feature:objectAndLayerId-rendering")?new $Bt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),xe(()=>{var i;return(i=this.waterTextureRepository)==null?void 0:i.updating},()=>this.requestRender(),Rr),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new Tke(this._rctx),this._shaderTechniqueRepository=new yke({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new YC(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",i=>this.requestRender(i)),this._materialRepository=new _ke(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new hBt(this._rctx,this._shaderTechniqueRepository),this.renderer=new zd(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,i=>this.requestRender(i));const r={renderScene:(i,n,s,o,a)=>this.renderer.render(i,n,{camera:s,contentCamera:s,mode:Mi.IDLE},o,a),requestRenderScene:i=>this.requestRender(i),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(i,n)=>e.options.screenshot.renderOverlay(i,n)};this._screenshotManager=new UGt(this._rctx,r,i=>this.events.emit("force-camera-for-screenshot",i),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=ps(this._frameTask),this._shaderTechniqueRepository=yt(this._shaderTechniqueRepository)}get performanceInfo(){const e=this._rctx.gl;return{renderer:this.renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=so.UPDATE){this._needsRender=!0,e===so.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,n,s,o=s){const a=n.constrainWindowSize(r,i,s*n.pixelRatio,o*n.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(n,a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const d=gBt(4*u,l,n.nearFar);c>d&&d!==n.nearFar[0]&&d!==n.nearFar[1]&&(c=d)}if(M(e)){const u=e.pickDepth(r*n.pixelRatio,i*n.pixelRatio,n);M(u)&&c>u&&u!==n.nearFar[0]&&u!==n.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(k(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){WBe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,n=so.BACKGROUND,s=!1;const o={preRender:({time:a})=>{i=this.updating,n=this._needsUpdate?so.UPDATE:so.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||M(r.forcedAnimationTime)||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new J9e(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(so.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,r,zS.ON,a),s=!0,l&&this.renderer.hasWaterReflection&&(this.requestRender(so.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new kGt(r.camera,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{s&&(this.renderer.finish(r.mode===Mi.IDLE?n:so.UPDATE),s=!1)}};this._frameTask=NR(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil==null||r.stencil,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},n=Nwt("3d",this._canvas,i);if(k(n)){const s=Fe("esri-force-webgl");we.getLogger(this.declaredClass).error(s)}else this._rctx=this._newRenderingContext(n,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&we.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&Fe("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},n=(s,o)=>r.view.resourceController.memoryController.newCache(s,o);return new gGt(e,i,n)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return M(this.objectAndLayerIdRenderHelper)?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return k(this._componentObjectCollection)&&(this._componentObjectCollection=new tBt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};h([f({type:Boolean,readOnly:!0})],Al.prototype,"updating",null),h([f({autoDestroy:!0})],Al.prototype,"_rctx",void 0),h([f({autoDestroy:!0})],Al.prototype,"_container",void 0),h([f({autoDestroy:!0})],Al.prototype,"_canvas",void 0),h([f({autoDestroy:!0})],Al.prototype,"_stippleTextureRepository",void 0),h([f({autoDestroy:!0})],Al.prototype,"waterTextureRepository",void 0),h([f({autoDestroy:!0})],Al.prototype,"_magnifierHelper",void 0),h([f({readOnly:!0})],Al.prototype,"objectAndLayerIdRenderHelper",void 0),h([f({autoDestroy:!0})],Al.prototype,"_textureRepository",void 0),h([f({autoDestroy:!0})],Al.prototype,"_compositingHelper",void 0),h([f({autoDestroy:!0,readOnly:!0})],Al.prototype,"renderer",void 0),h([f({autoDestroy:!0})],Al.prototype,"_screenshotManager",void 0),h([f()],Al.prototype,"componentObjectCollection",null),h([f({autoDestroy:!0})],Al.prototype,"_componentObjectCollection",void 0),h([f()],Al.prototype,"_needsUpdate",void 0),h([f()],Al.prototype,"_needsWaterReflectionUpdate",void 0),Al=h([Q("esri.views.3d.webgl-engine.parts.RenderView")],Al);let kh=class extends rt{constructor(e){super(e),this._handles=new cn,this._model=new AU,this._layers=new Vr,this._asyncChangeSet=new Qne,this._syncChangeSet=new Qne,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Al(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(ar.STAGE,this),this._handles.add(this._frameTask)}destroy(){this._handles.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),jz(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){k(e)||(this.renderView.requestRender(),this._model.remove(e),jz(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){M(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){M(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e,r){k(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(i=>k(i.glTexture)).map(i=>this.schedule(()=>this._model.has(i)?i.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null),r)))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const n=this._layerSyncSet.has(i.id)||i.updatePolicy===y2.SYNC,s=n?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,s),this._layerSyncSet.delete(i.id),s.empty||(this.renderer.modify(s,n?pu:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,pu),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==y2.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{(this._layerSyncSet.has(r.id)||r.updatePolicy===y2.SYNC)&&(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id))});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,pu),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,pu),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,pu))}addRenderPlugin(e,r,i){const n=this.renderer.renderPlugins.add(e,r,i),s=()=>{Wwe(r)&&this.view.sceneIntersectionHelper.addIntersectionHandler(r)};if(Op(n))return n.then(s);s()}removeRenderPlugin(e){Wwe(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};kh.DebugSettings={endFrameContentValidation:!1},h([f({constructOnly:!0})],kh.prototype,"view",void 0),h([f({constructOnly:!0})],kh.prototype,"options",void 0),h([f({readOnly:!0})],kh.prototype,"viewingMode",null),h([f({constructOnly:!0})],kh.prototype,"container",void 0),h([f({constructOnly:!0})],kh.prototype,"_handles",void 0),h([f({readOnly:!0})],kh.prototype,"updating",null),h([f({constructOnly:!0})],kh.prototype,"_model",void 0),h([f({autoDestroy:!0})],kh.prototype,"renderView",void 0),h([f({readOnly:!0})],kh.prototype,"renderer",null),h([f({readOnly:!0})],kh.prototype,"running",null),kh=h([Q("esri.views.3d.webgl-engine.Stage")],kh);let Nvr=class extends Gj{constructor(e,r,i,n){super(r,i),this.point=e,this.createGraphic=n}};function HVe(t){return qm(t)&&t.intersector===ws.PCL&&!!t.target}let kvr=class extends v8e{constructor(e,r,i,n,s){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=n,this.triangleNr=s}},Bvr=class extends Gj{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}};function IH(t){return qm(t)&&t.intersector===ws.I3S&&!!t.target}function qVe(t){return qm(t)&&t.intersector===ws.VOXEL&&!!t.target}function aSe(t,e){var r,i;return jj(t)||Hj(t)?WL((r=t.target)==null?void 0:r.object.metadata,e):F$t(t)?(i=e.map)==null?void 0:i.ground:HVe(t)||IH(t)||Bke(t)||qVe(t)?WL(t.target,e):null}function Vvr(t,e){const r=Bse(t,e);return M(r)&&r.type==="graphic"?r.graphic:null}function Bse(t,e){var r;if(k(t))return null;if(jj(t)||Hj(t))return lSe((r=t.target)==null?void 0:r.object.metadata,e);if(HVe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(qVe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return Bke(t)||Xde(t)?lSe(t.target,e):IH(t)?BGt(t.target,e):null}function lSe(t,e){if(k(t)||k(t.graphicUid))return null;const r=WL(t,e);if(k(r))return null;if(r===e.graphics)return k(e.graphicsView)||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(n=>n.layer===r);return!i||i.suspended||k(t.graphicUid)?null:"getHit"in i?i.getHit(t.graphicUid):null}function BGt(t,e){const r=WL(t,e);if(k(r))return null;const i=e.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?VGt(i.getGraphicFromIntersectorTarget(t)):null}function zGt(t,e){const r=WL(t,e);if(k(r))return null;const i=e.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function VGt(t){return M(t)?{type:"graphic",graphic:t,layer:t.layer}:null}function WL(t,e){return!t||k(t.layerUid)?null:M(e.graphicsView)&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid)}function Gvr(t,e){if(jj(t)||Hj(t))return F_(t.target.object.boundingVolumeWorldSpace.bounds);if(Xde(t)){XIe(Q9,t.transformation);const r=Math.max(Q9[0],Q9[1],Q9[2]);return t.target.baseBoundingSphere.radius*r}return IH(t)?rl(zGt(t.target,e),r=>.5*oIe(r)):null}function jvr(t){return!jj(t)&&!Hj(t)&&(Xde(t)?t.target.numLodLevels>1:!!IH(t))}const Q9=G();async function GGt(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=r.results[0],n=(i.distance??0)*(1+jGt),s=r.results.findIndex(o=>(o.distance??0)>n);return s!==-1&&(r.results=r.results.slice(0,s)),r}const jGt=.05;let oZ,aZ;function HGt(t){const e=QFe(t);for(;e.length>1;){const r=cSe(e.shift());if(r.available)return r}return cSe(e.shift())}function cSe(t){switch(t){case lr.WEBGL1:return qGt();case lr.WEBGL2:return WGt()}}function qGt(){return oZ||(oZ=XGt()),oZ}function WGt(){return aZ||(aZ=ZGt()),aZ}let WVe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},QGt=class extends WVe{constructor(){super(...arguments),this.type=lr.WEBGL1}},YGt=class extends WVe{constructor(){super(...arguments),this.type=lr.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function QVe(t,e){var s;if(t===lr.WEBGL1&&typeof WebGLRenderingContext>"u"||t===lr.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=dz(r,t,{failIfMajorPerformanceCaveat:!0});if(k(i)&&(i=dz(r,t),M(i)&&(e.majorPerformanceCaveat=!0)),k(i))return i;if(t===lr.WEBGL1){const o=(s=i.getParameter(i.VERSION))==null?void 0:s.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const n=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return n&&(e.supportsHighPrecisionFragment=n.precision>0),i}function XGt(){const t=new QGt,e=QVe(lr.WEBGL1,t);return k(e)||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function ZGt(){const t=new YGt,e=QVe(lr.WEBGL2,t);return k(e)||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function JGt(t){const e=HGt(t);if(!e.available)return new pe("webgl:required","WebGL is required but not supported.");if(t==="3d"&&e.majorPerformanceCaveat)return new pe("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new pe("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new pe("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===lr.WEBGL1){if(!e.supportsElementIndexUint)return new pe("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new pe("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new pe("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function KGt(t){return t&&"nodeType"in t}function ejt(t){return t&&typeof t.render=="function"}const uSe={component:"esri-component"};let aT=class extends rt{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(uSe.component),r&&r.classList.remove(uSe.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||KGt(e)?(this._set("widget",null),jG(e)):(ejt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};h([f({dependsOn:[]})],aT.prototype,"id",null),h([f()],aT.prototype,"node",null),h([Wr("node")],aT.prototype,"castNode",null),h([f({readOnly:!0})],aT.prototype,"widget",void 0),aT=h([Q("esri.views.ui.Component")],aT);const wU=aT,tjt={left:0,top:0,bottom:0,right:0},YVe={bottom:30,top:15,right:15,left:15},lZ="manual",Iy="esri-ui",Uu={ui:Iy,corner:`${Iy}-corner`,innerContainer:`${Iy}-inner-container`,manualContainer:`${Iy}-manual-container`,cornerContainer:`${Iy}-corner-container`,topLeft:`${Iy}-top-left`,topRight:`${Iy}-top-right`,bottomLeft:`${Iy}-bottom-left`,bottomRight:`${Iy}-bottom-right`};function rjt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function cZ(t){const e=t,r=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(r===null||r===Object.prototype)&&("component"in e||"index"in e||"position"in e)?t:null}function uZ(t,{top:e,bottom:r,left:i,right:n}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=n}let Gg=class extends Ws.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._locale=yu(),this.view=null,this._applyViewPadding=()=>{const r=this.container;r&&uZ(r,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const r=this._innerContainer;r&&uZ(r,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([xe(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Rr),xe(()=>this.padding,this._applyUIPadding,Rr),xe(()=>[this.container,this._locale],([e,r])=>{e&&e.setAttribute("lang",r)},Rr),xle(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentToKey.clear()}set container(e){const r=this._get("container");e!==r&&(e&&(e.classList.add(Uu.ui),lpt(e),this._attachContainers(e)),r&&(r.classList.remove(Uu.ui),uZ(r,{top:"",bottom:"",left:"",right:""}),kIe(r)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const r=this._getViewPadding(),i=r.top+r.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...YVe,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const r=this._getViewPadding(),i=r.left+r.right;return Math.max(e-i,0)}add(e,r){let i,n;if(Array.isArray(e))return void e.forEach(o=>this.add(o,r));const s=cZ(e);s&&({index:i,position:r,component:e,key:n}=s),r&&typeof r=="object"&&({index:i,key:n,position:r}=r),!e||r&&!this._isValidPosition(r)||this._add(e,r,i,n)}remove(e,r){if(!e)return;if(Array.isArray(e))return e.map(n=>this.remove(n,r));const i=this._find(e);if(i){const n=this._componentToKey;if(n.has(e)&&n.get(e)!==r)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(r=>this.empty(r)).reduce((r,i)=>r.concat(i)):(e=e||lZ)===lZ?Array.prototype.slice.call(this._manualContainer.children).filter(r=>!r.classList.contains(Uu.corner)).map(r=>this.remove(r)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,r){if(Array.isArray(e)&&e.forEach(o=>this.move(o,r)),!e)return;let i;const n=cZ(e)||cZ(r);if(n&&(i=n.index,r=n.position,e=n.component||e),r&&!this._isValidPosition(r))return;const s=this.remove(e);s&&this.add(s,{position:r,index:i})}find(e){if(!e)return null;const r=this._findById(e);return r&&(r.widget||r.node)}getPosition(e){for(const r in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[r].contains(e))return r;return null}_add(e,r,i,n){e instanceof wU||(e=new wU({node:e})),this._place({component:e,position:r,index:i}),this._components.push(e),n&&this._componentToKey.set(e,n)}_find(e){return e?e instanceof wU?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||tjt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Uu.innerContainer),e.classList.add(Uu.cornerContainer);const r=document.createElement("div");r.classList.add(Uu.innerContainer),r.classList.add(Uu.manualContainer);const i=document.createElement("div");i.classList.add(Uu.topLeft),i.classList.add(Uu.corner),e.appendChild(i);const n=document.createElement("div");n.classList.add(Uu.topRight),n.classList.add(Uu.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(Uu.bottomLeft),s.classList.add(Uu.corner),e.appendChild(s);const o=document.createElement("div");o.classList.add(Uu.bottomRight),o.classList.add(Uu.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=r;const a=pm();this._cornerNameToContainerLookup={"top-left":i,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":a?n:i,"top-trailing":a?i:n,"bottom-leading":a?o:s,"bottom-trailing":a?s:o},this._positionNameToContainerLookup={manual:r,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const r=e.component,i=e.position||lZ,n=e.index,s=this._positionNameToContainerLookup[i],o=n!=null&&n>-1;if(rjt(r.widget)&&r.widget.startup(),!o)return void s.appendChild(r.node);const a=Array.prototype.slice.call(s.children);if(n===0)return void(s.firstChild?Cge(r.node,s.firstChild):s.appendChild(r.node));n>=a.length?s.appendChild(r.node):Cge(r.node,a[n])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let r,i=null;return this._components.some(n=>(r=n===e,r&&(i=n),r)),i}_findById(e){let r,i=null;return this._components.some(n=>(r=n.id===e,r&&(i=n),r)),i}_findByNode(e){let r,i=null;return this._components.some(n=>(r=n.node===e,r&&(i=n),r)),i}};h([f()],Gg.prototype,"_locale",void 0),h([f()],Gg.prototype,"container",null),h([f()],Gg.prototype,"height",null),h([f({value:YVe})],Gg.prototype,"padding",null),h([Wr("padding")],Gg.prototype,"castPadding",null),h([f()],Gg.prototype,"view",void 0),h([f()],Gg.prototype,"width",null),Gg=h([Q("esri.views.ui.UI")],Gg);const ijt=Gg;function hSe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function njt(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function Y9(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function sjt(t){return t.type==="bing-maps"}const Cv=[];let XC=class extends ZD{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new ur,this.view=null,this._allLayerViewsChange=r=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(n=>xe(()=>{var s;return[n.suspended,(s=n.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),r&&r.removed&&r.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.handles.add([Bo(()=>{var r;return(r=this.view)==null?void 0:r.allLayerViews},"change",r=>this._allLayerViewsChange(r),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),ic(()=>{var r;return((r=this.view)==null?void 0:r.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,r=e==null?void 0:e.allLayerViews;Cv.length=0,e&&r?(r.forEach(i=>{var o;if(i.suspended||!((o=i.layer)!=null&&o.attributionVisible))return;const n=i.layer;if(hSe(n,"user"))return void Y9(Cv,i,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(i)){const a=this._fetchedAttributionData.get(i);return void(a?Y9(Cv,i,this._getDynamicAttribution(a,e,n)):hSe(n)&&Y9(Cv,i,n.copyright))}return void this._fetchAttributionData(i)}const s=n.get("portalItem.accessInformation");Y9(Cv,i,s||n.copyright)}),njt(this.items,Cv)&&(this.items.removeAll(),this.items.addMany(Cv)),Cv.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const r=await Pm(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=r.ok?this._createContributionIndex(r.value,sjt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,r){const i=e.contributors,n={};if(!i)return n;for(let s=0;s<i.length;s++){const o=i[s],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,u=l.zoomMin-(r&&l.zoomMin?1:0),d=l.zoomMax-(r&&l.zoomMax?1:0),p={xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:St.WGS84},A={extent:N_(p),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:s};for(let v=u;v<=d;v++)n[v]=n[v]||[],n[v].push(A)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,r,i){var u;const{extent:n,scale:s}=r;let o=((u=i.tileInfo)==null?void 0:u.scaleToZoom(s))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!n||o==null||o<=-1)return"";const a=e[o],l=ew(n.center.clone().normalize(),r.spatialReference),c={};return a?a.filter(d=>{const p=d.id,A=!c[p]&&l&&d.extent&&wle(d.extent,l);return A&&(c[p]=!0),A}).sort((d,p)=>p.score-d.score||d.objectId-p.objectId).map(d=>d.attribution).join(", "):""}};h([f({readOnly:!0,type:ur})],XC.prototype,"items",void 0),h([f({readOnly:!0})],XC.prototype,"state",null),h([f()],XC.prototype,"view",void 0),XC=h([Q("esri.widgets.Attribution.AttributionViewModel")],XC);const XVe=XC,Q3="esri-attribution",Mv={base:`${Q3} esri-widget`,poweredBy:`${Q3}__powered-by`,sources:`${Q3}__sources`,open:`${Q3}--open`,sourcesOpen:`${Q3}__sources--open`,link:`${Q3}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Xu=class extends Lc{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.iconClass=Mv.widgetIcon,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new XVe}initialize(){this.addHandles(Bo(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Mv.open]:this._isOpen};return Ae("div",{bind:this,class:this.classes(Mv.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return Ae("div",{class:Mv.poweredBy},"Powered by"," ",Ae("a",{class:Mv.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?"0":"",{attributionText:n}=this,s={[Mv.sourcesOpen]:e,[Mv.interactive]:r};return Ae("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Mv.sources,s),innerHTML:n,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:n,scrollWidth:s}=e,o=s>n,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};h([f()],Xu.prototype,"_isOpen",void 0),h([f()],Xu.prototype,"_isInteractive",null),h([f()],Xu.prototype,"_attributionTextOverflowed",void 0),h([f()],Xu.prototype,"_prevSourceNodeHeight",void 0),h([f({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Xu.prototype,"attributionText",null),h([f()],Xu.prototype,"iconClass",void 0),h([f()],Xu.prototype,"itemDelimiter",void 0),h([f()],Xu.prototype,"label",null),h([f(),tc("esri/widgets/Attribution/t9n/Attribution")],Xu.prototype,"messages",void 0),h([f()],Xu.prototype,"view",null),h([f({type:XVe})],Xu.prototype,"viewModel",void 0),h([vl()],Xu.prototype,"_toggleState",null),Xu=h([Q("esri.widgets.Attribution")],Xu);const ojt=Xu,ajt="esri.widgets.CompassViewModel";let lT=class extends que(rt){constructor(e){super(e),this._handles=new cn,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(xe(()=>this.view,this._updateRotationWatcher,Rr))}destroy(){ps(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var r;if(!this.get("view.ready"))return;const e={};((r=this.view)==null?void 0:r.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?xe(()=>e==null?void 0:e.rotation,this._updateForRotation,Rr):xe(()=>e==null?void 0:e.camera,this._updateForCamera,Rr))}};h([f({readOnly:!0})],lT.prototype,"canShowNorth",null),h([f()],lT.prototype,"orientation",void 0),h([f({readOnly:!0})],lT.prototype,"state",null),h([f()],lT.prototype,"view",void 0),lT=h([Q(ajt)],lT);const ZVe=lT,Rv={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let jg=class extends Lc{constructor(e,r){super(e,r),this.iconClass=Rv.widgetIcon,this.messages=null,this.viewModel=new ZVe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="disabled",n=(r==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,o={[Rv.disabled]:i,[Rv.interactive]:!i},a={[Rv.northIcon]:n,[Rv.rotationIcon]:!n},{messages:l}=this;return Ae("div",{bind:this,class:this.classes(Rv.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":l.reset,title:l.reset},Ae("span",{"aria-hidden":"true",class:this.classes(Rv.icon,a),styles:this._toRotationTransform(e)}),Ae("span",{class:Rv.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};h([f()],jg.prototype,"goToOverride",null),h([f()],jg.prototype,"iconClass",void 0),h([f()],jg.prototype,"label",null),h([f(),tc("esri/widgets/Compass/t9n/Compass")],jg.prototype,"messages",void 0),h([f()],jg.prototype,"view",null),h([f({type:ZVe})],jg.prototype,"viewModel",void 0),h([vl()],jg.prototype,"_reset",null),jg=h([Q("esri.widgets.Compass")],jg);const ljt=jg,Y3="esri-navigation-toggle",Hp={base:`${Y3} esri-widget`,button:`${Y3}__button esri-widget--button`,activeButton:`${Y3}__button--active`,panButton:`${Y3}__button--pan`,rotateButton:`${Y3}__button--rotate`,isLayoutHorizontal:`${Y3}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let ZC=class extends rt{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(ic(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e;return this.get("view.ready")&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};h([f({readOnly:!0})],ZC.prototype,"state",null),h([f()],ZC.prototype,"navigationMode",void 0),h([f()],ZC.prototype,"view",void 0),ZC=h([Q("esri.widgets.NavigationToggleViewModel")],ZC);const JVe=ZC;let Hg=class extends Lc{constructor(e,r){super(e,r),this.iconClass=Hp.widgetIcon,this.messages=null,this.viewModel=new JVe}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",r=this.get("viewModel.navigationMode")==="pan",i={[Hp.disabled]:e,[Hp.isLayoutHorizontal]:this.layout==="horizontal"},n={[Hp.activeButton]:r},s={[Hp.activeButton]:!r},o=e?-1:0,a=this.messages.toggle;return Ae("div",{bind:this,class:this.classes(Hp.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},Ae("div",{class:this.classes(Hp.button,Hp.panButton,n)},Ae("span",{class:Hp.panIcon})),Ae("div",{class:this.classes(Hp.button,Hp.rotateButton,s)},Ae("span",{class:Hp.rotationIcon})))}_toggle(){this.toggle()}};h([f()],Hg.prototype,"iconClass",void 0),h([f()],Hg.prototype,"label",null),h([f({value:"vertical"})],Hg.prototype,"layout",null),h([f(),tc("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Hg.prototype,"messages",void 0),h([f()],Hg.prototype,"view",null),h([f({type:JVe})],Hg.prototype,"viewModel",void 0),h([vl()],Hg.prototype,"_toggle",null),Hg=h([Q("esri.widgets.NavigationToggle")],Hg);const cjt=Hg,l$={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let ab=class extends Lc{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,r={[l$.disabled]:!this.enabled,[l$.interactive]:this.enabled},i={[this.iconClass]:!!this.iconClass};return Ae("div",{bind:this,class:this.classes(l$.button,r),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},Ae("span",{"aria-hidden":"true",role:"presentation",class:this.classes(l$.icon,i)}),Ae("span",{class:l$.iconText},this.title))}_triggerAction(){this.action.call(this)}};h([f()],ab.prototype,"action",void 0),h([f()],ab.prototype,"enabled",void 0),h([f()],ab.prototype,"iconClass",void 0),h([f()],ab.prototype,"title",void 0),h([vl()],ab.prototype,"_triggerAction",null),ab=h([Q("esri.widgets.IconButton")],ab);const dSe=ab;let JC=class extends rt{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMaxScale");return r===0||e>r}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMinScale");return r===0||e<r}};h([f({readOnly:!0})],JC.prototype,"canZoomIn",null),h([f({readOnly:!0})],JC.prototype,"canZoomOut",null),h([f()],JC.prototype,"view",void 0),JC=h([Q("esri.widgets.Zoom.ZoomConditions2D")],JC);const ujt=JC;let KC=class extends rt{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};h([f({readOnly:!0})],KC.prototype,"canZoomIn",null),h([f({readOnly:!0})],KC.prototype,"canZoomOut",null),h([f()],KC.prototype,"view",void 0),KC=h([Q("esri.widgets.Zoom.ZoomConditions3D")],KC);const hjt=KC;let lb=class extends rt{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return M(this._zoomConditions)&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return M(this._zoomConditions)&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new ujt({view:e}):e.type==="3d"&&(this._zoomConditions=new hjt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():jM(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():jM(e.goTo({zoomFactor:.5}))}};h([f()],lb.prototype,"_zoomConditions",void 0),h([f()],lb.prototype,"canZoomIn",null),h([f()],lb.prototype,"canZoomOut",null),h([f({readOnly:!0})],lb.prototype,"state",null),h([f()],lb.prototype,"view",null),lb=h([Q("esri.widgets.Zoom.ZoomViewModel")],lb);const KVe=lb,c$={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let o_=class extends Lc{constructor(e,r){super(e,r),this.iconClass=c$.widgetIcon,this.messages=null,this.viewModel=new KVe}initialize(){this._zoomInButton=new dSe({action:this.zoomIn.bind(this),iconClass:c$.zoomInIcon}),this._zoomOutButton=new dSe({action:this.zoomOut.bind(this),iconClass:c$.zoomOutIcon})}destroy(){this._zoomInButton=yt(this._zoomInButton),this._zoomOutButton=yt(this._zoomOutButton)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,r={[c$.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:n}=e;this._zoomInButton.enabled=i,this._zoomOutButton.enabled=n;const{zoomIn:s,zoomOut:o}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=o,Ae("div",{class:this.classes(c$.base,r)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};h([f()],o_.prototype,"iconClass",void 0),h([f()],o_.prototype,"label",null),h([f({value:"vertical"})],o_.prototype,"layout",null),h([f(),tc("esri/widgets/Zoom/t9n/Zoom")],o_.prototype,"messages",void 0),h([f()],o_.prototype,"view",null),h([f({type:KVe})],o_.prototype,"viewModel",void 0),o_=h([Q("esri.widgets.Zoom")],o_);const djt=o_;function pjt(t){return t&&t.view!==void 0}let xU=class extends ijt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this.addHandles([xe(()=>this.components,this._componentsWatcher.bind(this),Rr),xe(()=>this.view,this._updateViewAwareWidgets.bind(this),Rr)])}_add(e,r,i,n){let s=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;s=this._createComponent(e)}super._add(s,r,i,n)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(r=>{const i=this._find(r),n=i&&i.widget;pjt(n)&&(n.view=e)})}_componentsWatcher(e,r){this._removeComponents(r),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);if(r)return new wU({id:e,node:r})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new ojt({view:this.view})}_createCompass(){return new ljt({view:this.view})}_createNavigationToggle(){return new cjt({view:this.view})}_createZoom(){return new djt({view:this.view})}};h([f()],xU.prototype,"components",void 0),xU=h([Q("esri.views.ui.DefaultUI")],xU);const fjt=xU;let TU=class extends fjt{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};h([f()],TU.prototype,"components",void 0),TU=h([Q("esri.views.ui.3d.DefaultUI3D")],TU);const eGe=TU;let Qt=class extends vct(Mbt(jbt(g2t))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._lostWebGLContextHandle=null,this._resolveWhenReady=[],this._propertiesPool=new a1({slicePlane:l4e},this),this._resourceController=K6t(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new Une({view:this}),this.labeler=new eT({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new iO,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new bT,this.environmentManager=new L0,this.floors=new ur,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new y2t({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new _6t,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new eGe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new cse,this.voxelWasm=null,this.voxelWasmPromise=null,aat(),t&&t.environment||(this._defaults.environment=new LC,this.environment=this._defaults.environment);const e=(r=null)=>{M(r)&&r.type===Pn.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.handles.add([Bo(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),xe(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new SRt({view:this}),this.stateManager=new Xo({view:this})}initialize(){this.groundView=new Gbt({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.handles.add(Bo(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Rr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Rr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>PKe(e>0?1e3/Math.ceil(e):0),Rr),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,vo),this.updatingHandles.add(()=>{var e,r;return(r=(e=this.map)==null?void 0:e.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),vo),this.handles.add(xe(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),fn))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=yt(this.sharedSymbolResources),this._set("labeler",yt(this.labeler)),this._set("deconflictor",yt(this.deconflictor)),this._resourceController=yt(this._resourceController),this._set("stateManager",yt(this.stateManager)),this._set("inputManager",yt(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",yt(this.environmentManager)),this.groundView=yt(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!(this._userClippingArea||this.get("map.clippingEnabled"))||k(t)?(this._clippingArea=null,null):t instanceof an?this.spatialReference&&(t=X9(t,this.spatialReference),k(t))?(we.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),k(t.intersection(this._groundAndLayersExtent))&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(we.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&M(t)?we.getLogger(this.declaredClass).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===wt.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return k(e)||k(t)||e.spatialReference.equals(t)?e:X9(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||St.WGS84,r=X9(this.clippingArea,e);M(r)&&(t=M(t)?t.intersection(r):r);const i=this._get("dataExtent");return M(t)&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||St.WGS84;let e;const r=s=>{const o=X9(s,t);k(o)||(M(e)?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const s=i.groundExtent;r(new an({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const s=o=>{!M(o.fullExtent)||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>s(o))}if(k(e))return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const n=this._get("_groundAndLayersExtent");return e.equals(n)?n:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof LC?t:t instanceof SFe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):LC.fromWebsceneEnvironment(t):Go(LC,t):new LC}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||M(this.activeTool)&&this.activeTool.visible}get stationary(){return!this.animation&&!this.resizing&&(k(this.state)||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){lU.isValidProfile(t)&&(lU.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||lU.getDefaultProfile()}set slicePlane(t){if(M(this._stage)&&this._stage.renderer.setParameters({slicePlane:t}),k(t))return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");wE(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?Act(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?iP.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var n,s,o;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(e=!0,a.suspended||zL(a))return;++r,t+=a.updatingProgress}}else++r});for(const a of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])M(a)&&a.updating&&(r+=.1,t+=.5*.1);for(const a of[this.deconflictor,this.labeler,this.basemapTerrain])M(a)&&a.updating&&(++r,t+=a.updatingProgress);const i=this.stateManager.test.updatingIgnoreRenderState?Mi.IDLE:this.state.mode;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i!==Mi.IDLE||this._createGraphicsViewController||(n=this.inputManager)!=null&&n.hasPendingInputs||(o=(s=this.map)==null?void 0:s.allLayers)!=null&&o.some(a=>!a.isFulfilled())),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const a=performance.now();if(t<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-l)+t*l}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?a:0}return e}get viewingMode(){var r;const t=this._predeterminedViewingMode;if(M(t))return DQ(t);const e=this.spatialReference;return e?M((r=this.defaultsFromMap)==null?void 0:r.viewingMode)&&e.equals(this.defaultsFromMap.spatialReference)?DQ(this.defaultsFromMap.viewingMode):Iz(e,wt.Global)?"global":"local":"global"}set viewingMode(t){this.ready?we.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new S8t(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return we.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,i=M(r.graphics)&&(M(r.graphics.include)||M(r.graphics.exclude)),n=g1e(t)?m1e(this,t):t,s=tA(n);r.enableDraped=r.include&&!r.include.has(Rb)||r.exclude&&r.exclude.has(Rb);const o=this.sceneIntersectionHelper,a=e0(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?Ol.ALL:Ol.MIN,o.intersectIntersectorScreen(s,a,r),i){for(const l of a.results.all){const c=Bse(l,this);if(k(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return we.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=br(t.z==null?hA(this.elevationProvider,t):null,0);return nc(t,X3,this.renderSpatialReference,e),this.state.camera.projectToScreen(X3,hZ),Qf(hZ[0],hZ[1])}pixelSizeAt(t){return this.ready?t?(nc(t,X3,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(X3)):0:(we.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return we.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=g1e(t)?m1e(this,t):t,i=Ns(r.x,r.y),n=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;n.requiresGroundFeedback=!0,n.enableDraped=!0;const s=e0(this.state.viewingMode);s.options.selectionMode=!0,s.options.store=Ol.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,s,n);const o=this._intersectResultsToHits(s.results.all,n.graphics),a=s.results.ground,l=aSe(a,this),c=M(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,u={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:qm(a)?a.distanceInRenderSpace:0,layer:c}};return tn.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(u.intersector=s),Promise.resolve(u)}async popupHitTest(t){const{results:e,ground:r}=await GGt(this,t);let i=null;return!(e.length===0||Math.abs(br(e[0].distance,0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:e,screenPoint:t,mapPoint:i}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(k(t.parent))throw new pe("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return iZ(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return nZ(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[nZ(r[0],this._pixelFormat()),nZ(r[1],this._pixelFormat())]}_completeSettings(t){const e=wGt(t,this);return e.pixelRatio/=this.state.pixelRatio,EGt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!Fe("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=iZ(r[0],e,this._pixelFormat()),n=this._completeSettings(t);return n.format="png",[i,iZ(r[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(k(this._stage.renderView.objectAndLayerIdRenderHelper))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return T1e.importLayerView(t)}hasLayerViewModule(t){return T1e.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,r,i;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=JGt(this.type);const e=Fe("safari");if(e&&e<9&&(t=new pe("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),M(t))throw we.getLogger(this.declaredClass).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return M(t)?b1e(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(M(r))return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,wt.Local),n=this._validateSpatialReferenceForViewingMode(t,e,wt.Global);return i||n?i&&n?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,wt.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,wt.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!Iz(t,r)&&(!!k(e)||!!nge(e)||(!_5(e)||!k(xH(e,t,r)))&&(!ige(e)||r!==wt.Global))}_makeSpatialReferenceConstraints(t,e,r){if(k(e))return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,n=t.isWGS84;return nge(e)&&(i||n)?!n||r===wt.Local||ope(e.tileInfo,e.fullExtent,t,wt.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:St.WebMercator,viewingMode:r}]:[{spatialReference:i?St.WGS84:St.WebMercator,viewingMode:r}]:_5(e)||ige(e)||!i&&!n?_5(e)&&i&&r!==wt.Global?[{spatialReference:t,viewingMode:r},{spatialReference:St.WGS84,viewingMode:wt.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?St.WGS84:St.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=M(this.getSpatialReferenceSupport({spatialReference:t})),r=this._predeterminedViewingMode;return e||(M(r)?we.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${DQ(r)} viewing mode.`):t.isGeographic&&we.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let r=this.spatialReference||St.WGS84;return il(t,this.renderSpatialReference,t,r)||(r=St.WGS84,il(t,this.renderSpatialReference,t,r)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=r):e=new Ht(t,r),e}trackGraphicState(t){if(!t.graphic)return we.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const n=s=>{var o;!i&&M(s)&&"processor"in s&&((o=s.processor)==null?void 0:o.type)==="graphics-3d"&&s.processor.graphicsCore&&(r=s.processor.graphicsCore.trackGraphicState(t))};return M(e)?n(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{i=!0,M(r)&&(r.remove(),r=null)}}}highlight(t){if(Array.isArray(t))return DR(t.map(r=>this.highlight(r)));if(ur.isCollection(t))return DR(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Rm()}maskOccludee(t){if(!t)return we.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const n=s=>{!i&&M(s)&&vbt(s)&&(r=s.maskOccludee(t))};return M(e)?n(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{i=!0,M(r)&&(r.remove(),r=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){M(this.graphicsView)&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await QD(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new pe("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(t.layer)&&(n.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,aD.INCLUDE),r=this._externalToInternalRenderItems(t.exclude,aD.EXCLUDE);return{include:e.layerUids,exclude:r.layerUids,graphics:{include:e.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(X3)?(e=this.computeMapPointFromVec3d(X3,e),t.intersector===ws.TERRAIN&&this.basemapTerrain&&(e.z=br(hA(this.basemapTerrain,e),0)),e):null}_intersectResultsToHits(t,e){const r=new Array;let i=null;for(let n=0;n<t.length;n++){const s=t[n],o=aSe(s,this);if(M(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=Bse(s,this);if(k(a))continue;if(a.type==="graphic"){if(k(i)&&n!==t.length-1&&(i=new Set),M(i)){const u=this._getGraphicFilterUid(a.graphic);if(i.has(u))continue;i.add(u)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(s),c=s.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(t){var n;const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const s=i.objectIdField??x4e,o=(n=t.attributes)==null?void 0:n[s];if(o)return`o-${i.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const r=this._getGraphicFilterUid(e);return k(t)||(k(t.include)||t.include.has(r))&&(k(t.exclude)||!t.exclude.has(r))}_externalToInternalRenderItems(t,e,r={layerUids:void 0,graphicUids:void 0}){if(!t)return r;if(t instanceof Pl)mjt(r,this._getGraphicFilterUid(t)),e===aD.INCLUDE&&(M(this.graphicsView)&&t.layer===this?u$(r,this.graphicsView.processor.layer.id):t.layer&&u$(r,t.layer.uid));else if(zJ(t))for(const i of t)i===this.graphics&&M(this.graphicsView)?u$(r,this.graphicsView.processor.layer.id):i===this.map.ground?u$(r,Rb):this._externalToInternalRenderItems(i,e,r);else"uid"in t&&u$(r,t.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new Ikt({view:this})),this._set("elevationProvider",new U4({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Zu({view:this})),this._set("featureTiles",new yl({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var r;const e=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=M(this.basemapTerrain.extent)&&M(this.basemapTerrain.spatialReference)?vE(DG(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;M(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>tn.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(be(()=>import("./FeatureTileTree3DDebugger-90928c35.js"),["assets/FeatureTileTree3DDebugger-90928c35.js","assets/TileTreeDebugger-85d501fa.js"])).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&tn.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||tn.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},vo),this.updatingHandles.add(()=>this.clippingArea,t,vo),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,vo)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new L6t(this.map,t));const e=this.state.isGlobal,r=w4e(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",U6t.create(this.state.viewingMode,r)),e||this.handles.add(xe(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const n=this.renderCoordsHelper.spatialReference;M(i)&&(i[0]!==0||i[1]!==0||i[2]!==0||i[3]!==0)&&ZG(i,this.basemapTerrain.spatialReference,pSe,n)&&(this.renderCoordsHelper.extent=pSe)},fn),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(_O/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){M(t)&&t.type===Pn.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.handles.add(xe(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),fn),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const r=t.getContext("2d");return r.putImageData(e,0,0),this.overlay.renderCanvas(t),r.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(n,s)=>this._renderScreenshotOverlay(n,s)}},e=new v6t(this.state.viewingMode,n=>this._stage.layers.forAll(n),this);this._set("sceneIntersectionHelper",e);const r=jG(this.surface);this._stage=new kh({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=vN(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new pe("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Rr),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,n=>this._stage.renderer.setParameters({highQualityTransparency:n}),Rr),xe(()=>this.magnifier,n=>this._stage.renderView.magnifier=n,vo),this.on("pointer-move",()=>{var n;return(n=this._stage)==null?void 0:n.renderer.resetAnimation()})],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:cse.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(_O/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=yt(this._stage),this._lostWebGLContextHandle=ps(this._lostWebGLContextHandle),this.handles.remove("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new M8t({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await be(()=>import("./GraphicsView3D-4122ad22.js"),["assets/GraphicsView3D-4122ad22.js","assets/GraphicsProcessor-8db9922e.js","assets/Graphics3DObjectStates-b8650f04.js","assets/optimizedFeatureQueryEngineAdapter-b8d26a61.js","assets/centroid-07d28d00.js","assets/PooledRBush-592a8b53.js","assets/quickselect-56c5966e.js"])).default;fi(t),await QD(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),M(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=b1e(this.viewingMode);if(t===wt.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.handles.add(Bo(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Rb);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Rb);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return k(this.voxelWasm)?(k(this.voxelWasmPromise)&&(this.voxelWasmPromise=be(()=>import("./VoxelWasmPerSceneView-85fdc729.js"),[]).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){M(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function u$(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function mjt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function X9(t,e){return M(t)&&OS(t.spatialReference,e)?vE(t,e):null}var aD;Qt.type="3d",h([f()],Qt.prototype,"_userClippingArea",void 0),h([f()],Qt.prototype,"_resourceController",void 0),h([f()],Qt.prototype,"_stage",void 0),h([f({readOnly:!0})],Qt.prototype,"deconflictor",void 0),h([f({readOnly:!0})],Qt.prototype,"labeler",void 0),h([f(PB(iO,"analyses"))],Qt.prototype,"analyses",void 0),h([f({type:dO,readOnly:!0})],Qt.prototype,"animation",null),h([f({readOnly:!0})],Qt.prototype,"basemapTerrain",void 0),h([f({readOnly:!0})],Qt.prototype,"elevationProvider",void 0),h([f()],Qt.prototype,"camera",null),h([f({type:qf})],Qt.prototype,"contentCamera",null),h([f({readOnly:!0})],Qt.prototype,"canvas",void 0),h([f({type:Ht})],Qt.prototype,"center",null),h([f({type:an})],Qt.prototype,"clippingArea",null),h([f({type:bT})],Qt.prototype,"constraints",void 0),h([f({type:an,readOnly:!0})],Qt.prototype,"renderDataExtent",null),h([f({type:an,readOnly:!0})],Qt.prototype,"dataExtent",null),h([f({type:an,readOnly:!0})],Qt.prototype,"_groundAndLayersExtent",null),h([f({value:null,type:LC})],Qt.prototype,"environment",null),h([Wr("environment")],Qt.prototype,"castEnvironment",null),h([f({readOnly:!0})],Qt.prototype,"environmentManager",void 0),h([f({type:an})],Qt.prototype,"extent",null),h([f()],Qt.prototype,"floors",void 0),h([f()],Qt.prototype,"screenCenter",null),h([f()],Qt.prototype,"frustum",null),h([f({type:Number,readOnly:!0})],Qt.prototype,"fullOpacity",void 0),h([f({readOnly:!0})],Qt.prototype,"graphicsView",void 0),h([f({readOnly:!0})],Qt.prototype,"analysisViewManager",void 0),h([f()],Qt.prototype,"groundView",void 0),h([f({type:Boolean})],Qt.prototype,"initialExtentRequired",null),h([f()],Qt.prototype,"_defaultsFromMapSettings",null),h([f()],Qt.prototype,"interacting",null),h([f()],Qt.prototype,"stationary",null),h([f()],Qt.prototype,"navigating",null),h([f()],Qt.prototype,"map",void 0),h([f({readOnly:!0})],Qt.prototype,"mapCoordsHelper",void 0),h([f()],Qt.prototype,"padding",null),h([f({type:Zu,readOnly:!0})],Qt.prototype,"pointsOfInterest",void 0),h([f({type:yl,readOnly:!0})],Qt.prototype,"featureTiles",void 0),h([f()],Qt.prototype,"_featureTreeDebugger",void 0),h([f({type:Boolean})],Qt.prototype,"screenSizePerspectiveEnabled",void 0),h([f({constructOnly:!0})],Qt.prototype,"deactivatedWebGLExtensions",void 0),h([f({constructOnly:!0})],Qt.prototype,"debugWebGLExtensions",void 0),h([f({constructOnly:!0})],Qt.prototype,"renderCanvas",void 0),h([f({constructOnly:!0})],Qt.prototype,"state",void 0),h([f({readOnly:!0})],Qt.prototype,"inputManager",void 0),h([f({readOnly:!0})],Qt.prototype,"stateManager",void 0),h([f({type:["low","medium","high"]})],Qt.prototype,"qualityProfile",null),h([f({type:txe,get(){let t=this._get("qualitySettings");return t||(t=new txe,lU.apply(this.qualityProfile,t)),t}})],Qt.prototype,"qualitySettings",void 0),h([f()],Qt.prototype,"slicePlane",null),h([f({readOnly:!0})],Qt.prototype,"typeSpecificPreconditionsReady",null),h([f({readOnly:!0})],Qt.prototype,"renderCoordsHelper",void 0),h([f({readOnly:!0})],Qt.prototype,"sceneIntersectionHelper",void 0),h([f({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Qt.prototype,"resolution",null),h([f({type:Number})],Qt.prototype,"scale",null),h([f()],Qt.prototype,"heightModelInfo",null),h([f()],Qt.prototype,"spatialReference",void 0),h([f({type:Boolean,constructOnly:!0})],Qt.prototype,"alphaCompositingEnabled",void 0),h([f({constructOnly:!0})],Qt.prototype,"preserveDrawingBufferEnabled",void 0),h([f({type:Boolean})],Qt.prototype,"supersampleScreenshotsEnabled",void 0),h([f({readOnly:!0})],Qt.prototype,"type",void 0),h([f({type:eGe})],Qt.prototype,"ui",void 0),h([f({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating","state.mode"]})],Qt.prototype,"updating",null),h([f({type:Number,readOnly:!0,dependsOn:["updating"]})],Qt.prototype,"updatingProgress",void 0),h([f({type:["global","local"]})],Qt.prototype,"viewingMode",null),h([f({type:Dm})],Qt.prototype,"viewpoint",null),h([f({type:Number})],Qt.prototype,"zoom",null),h([f({type:cse})],Qt.prototype,"highlightOptions",void 0),Qt=h([Q("esri.views.SceneView")],Qt),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(aD||(aD={}));const X3=G(),hZ=Ns(),pSe=oi(),gjt=Qt;let a_=class extends uLe(ONe(zD)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new iS,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,r){return super.on(e,r)}graphicChanged(e){this.emit("graphic-update",e)}};h([f({type:pLe})],a_.prototype,"elevationInfo",void 0),h([f(PB(iS,"graphics"))],a_.prototype,"graphics",void 0),h([f({type:["show","hide"]})],a_.prototype,"listMode",void 0),h([f()],a_.prototype,"screenSizePerspectiveEnabled",void 0),h([f({readOnly:!0})],a_.prototype,"type",void 0),h([f({constructOnly:!0})],a_.prototype,"internal",void 0),a_=h([Q("esri.layers.GraphicsLayer")],a_);const Ajt=a_;let eM=class extends rt{constructor(e){super(e),this.format=null,this.position={coordinate:null,location:null}}get displayCoordinate(){const e=this.get("format");return e&&e.getDisplayCoordinate(this.get("position.coordinate"))}};h([f({readOnly:!0})],eM.prototype,"displayCoordinate",null),h([f()],eM.prototype,"format",void 0),h([f()],eM.prototype,"position",void 0),eM=h([Q("esri.widgets.CoordinateConversion.support.Conversion")],eM);const NM=eM;function yjt(t,e){const r=tGe(e);return[t[0].toFixed(r),t[1].toFixed(r)]}function tGe(t){return t>=500?6:t<500&&t>=50?7:t<50&&t>=5?8:9}function _jt(t,e){const r=t.includes(",")?",":" ",[i,n,s]=t.split(r).map(a=>{const l=a.trim();return l?Number(l):null});if(!fV(i)||!fV(n))return null;const o=new Ht({x:i,y:n,spatialReference:e||St.WGS84});return s&&(o.z=s,o.hasZ=!0),o}function fV(t){return typeof t=="number"&&isFinite(t)}function zse(t){return t&&fV(t.x)&&fV(t.y)}function fSe(t,e){if(t.spatialReference.isGeographic&&e){const[r,i]=yjt([t.x,t.y],e);return`${r}, ${i}`}return`${t.x.toFixed(3)}, ${t.y.toFixed(3)}`}function vjt(t){return t==="dd"||t==="dms"||t==="ddm"||t==="mgrs"||t==="usng"||t==="utm"}const dZ={ar:[".",","],bg:[",",""],bs:[",","."],ca:[",","."],cs:[",",""],da:[",","."],de:[",","."],"de-ch":[".",""],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",",""],fi:[",",""],fr:[",",""],"fr-ch":[",",""],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",",""],id:[",","."],it:[",","."],"it-ch":[".",""],ja:[".",","],ko:[".",","],lt:[",",""],lv:[",",""],mk:[",","."],nb:[",",""],nl:[",","."],pl:[",",""],pt:[",","."],"pt-pt":[",",""],ro:[",","."],ru:[",",""],sk:[",",""],sl:[",","."],sr:[",","."],sv:[",",""],th:[".",","],tr:[",","."],uk:[",",""],vi:[",","."],zh:[".",","]};function $H(t=yu()){let e=(t=t.toLowerCase())in dZ;if(!e){const s=t.split("-");s.length>1&&s[0]in dZ&&(t=s[0],e=!0),e||(t="en")}const[r,i,n="#,##0.###"]=dZ[t];return{decimal:r,group:i,pattern:n}}function bjt(t,e){const r=$H((e={...e}).locale);e.customs=r;const i=e.pattern||r.pattern;return isNaN(t)||Math.abs(t)===1/0?null:wjt(t,i,e)}const rGe=/[#0,]*[#0](?:\.0*#*)?/;function wjt(t,e,r){const i=(r=r||{}).customs.group,n=r.customs.decimal,s=e.split(";"),o=s[0];if((e=s[t<0?1:0]||"-"+o).includes("%"))t*=100;else if(e.includes(""))t*=1e3;else{if(e.includes(""))throw new Error("currency notation not supported");if(e.includes("E"))throw new Error("exponential notation not supported")}const a=rGe,l=o.match(a);if(!l)throw new Error("unable to find a number expression in pattern: "+e);return r.fractional===!1&&(r.places=0),e.replace(a,xjt(t,l[0],{decimal:n,group:i,places:r.places,round:r.round}))}function xjt(t,e,r){(r=r||{}).places===!0&&(r.places=0),r.places===1/0&&(r.places=6);const i=e.split("."),n=typeof r.places=="string"&&r.places.indexOf(",");let s=r.places;n?s=r.places.substring(n+1):s>=0||(s=(i[1]||[]).length),r.round<0||(t=Number(t.toFixed(Number(s))));const o=String(Math.abs(t)).split("."),a=o[1]||"";if(i[1]||r.places){n&&(r.places=r.places.substring(0,n));const v=r.places!==void 0?r.places:i[1]&&i[1].lastIndexOf("0")+1;v>a.length&&(o[1]=a.padEnd(Number(v),"0")),s<a.length&&(o[1]=a.substr(0,Number(s)))}else o[1]&&o.pop();const l=i[0].replace(",","");let c=l.indexOf("0");c!==-1&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].substr(o[0].length-c)));let u,d,p=i[0].lastIndexOf(",");if(p!==-1){u=i[0].length-p-1;const v=i[0].substr(0,p);p=v.lastIndexOf(","),p!==-1&&(d=v.length-p-1)}const A=[];for(let v=o[0];v;){const b=v.length-u;A.push(b>0?v.substr(b):v),v=b>0?v.slice(0,b):"",d&&(u=d,d=void 0)}return o[0]=A.reverse().join(r.group||","),o.join(r.decimal||".")}function Tjt(t){const e=$H((t=t||{}).locale),r=t.pattern||e.pattern,i=e.group,n=e.decimal;let s=1;if(r.includes("%"))s/=100;else if(r.includes(""))s/=1e3;else if(r.includes(""))throw new Error("currency notation not supported");const o=r.split(";");return o.length===1&&o.push("-"+o[0]),{regexp:QL(o,l=>(l="(?:"+XMe(l,".")+")").replace(rGe,c=>{const u={signed:!1,separator:t.strict?i:[i,""],fractional:t.fractional,decimal:n,exponent:!1},d=c.split(".");let p=t.places;d.length===1&&s!==1&&(d[1]="###"),d.length===1||p===0?u.fractional=!1:(p===void 0&&(p=t.pattern?d[1].lastIndexOf("0")+1:1/0),p&&t.fractional==null&&(u.fractional=!0),!t.places&&p<d[1].length&&(p+=","+d[1].length),u.places=p);const A=d[0].split(",");return A.length>1&&(u.groupSize=A.pop().length,A.length>1&&(u.groupSize2=A.pop().length)),"("+Ejt(u)+")"}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:i,decimal:n,factor:s}}function Sjt(t,e){const r=Tjt(e),i=new RegExp("^"+r.regexp+"$").exec(t);if(!i)return NaN;let n=i[1];if(!i[1]){if(!i[2])return NaN;n=i[2],r.factor*=-1}return n=n.replace(new RegExp("["+r.group+"\\s\\xa0]","g"),"").replace(r.decimal,"."),Number(n)*r.factor}function Ejt(t){"places"in(t=t||{})||(t.places=1/0),typeof t.decimal!="string"&&(t.decimal="."),"fractional"in t&&!/^0/.test(String(t.places))||(t.fractional=[!0,!1]),"exponent"in t||(t.exponent=[!0,!1]),"eSigned"in t||(t.eSigned=[!0,!1]);const e=mSe(t),r=QL(t.fractional,n=>{let s="";return n&&t.places!==0&&(s="\\"+t.decimal,t.places===1/0?s="(?:"+s+"\\d+)?":s+="\\d{"+t.places+"}"),s},!0);let i=e+r;return r&&(i="(?:(?:"+i+")|(?:"+r+"))"),i+QL(t.exponent,n=>n?"([eE]"+mSe({signed:t.eSigned})+")":"")}function mSe(t){return"signed"in(t=t||{})||(t.signed=[!0,!1]),"separator"in t?"groupSize"in t||(t.groupSize=3):t.separator="",QL(t.signed,e=>e?"[-+]":"",!0)+QL(t.separator,e=>{if(!e)return"(?:\\d+)";(e=XMe(e))===" "?e="\\s":e===""&&(e="\\s\\xa0");const r=t.groupSize,i=t.groupSize2;if(i){const n="(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+e+"]\\d{"+i+"})*["+e+"]\\d{"+r+"})";return r-i>0?"(?:"+n+"|(?:0|[1-9]\\d{0,"+(r-1)+"}))":n}return"(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+e+"]\\d{"+r+"})*)"},!0)}const QL=(t,e,r)=>{if(!(t instanceof Array))return e(t);const i=[];for(let n=0;n<t.length;n++)i.push(e(t[n]));return Cjt(i.join("|"),!!r)},Cjt=(t,e)=>"("+(e?"?:":"")+t+")";function Mjt(t,e){const r=[];t=(t=(t=t.replace(/[\u00B0\u00BA]/g,"^")).replace(/\u2032/g,"'")).replace(/\u2033/g,'"');const i=hw(e);return JT.dmsToGeog(i,1,[t],r)?new Ht(r[0][0],r[0][1],e||St.WGS84):null}function Rjt(t,e,r){const i=[],n=iGe(r);if(n===-1)return console.warn(`invalid conversionMode: ${r}`),null;const s=hw(e);return qh.mgrsToGeogExtended(s,1,[t],n,i)?new Ht(i[0][0],i[0][1],e||St.WGS84):null}function Ojt(t,e){const r=[];!e&&/\(.+27/.test(t)&&(e=St.GCS_NAD_1927);const i=hw(e);return KD.usngToGeog(i,1,[t],r)?new Ht(r[0][0],r[0][1],e||St.WGS84):null}function Pjt(t,e,r){const i=[],n=nGe(r);if(n===-1)return console.warn(`invalid conversionMode: ${r}`),null;const s=hw(e);return n1.utmToGeog(s,1,[t],n,i)?new Ht(i[0][0],i[0][1],e||St.WGS84):null}function Ijt(t,e,r=0){const i=[[t.x,t.y]],n=[],s=hw(t.spatialReference);let o=0;switch(e){case"dd":o=JT.geogToDd(s,1,i,r,n);break;case"ddm":o=JT.geogToDdm(s,1,i,r,n);break;case"dms":o=JT.geogToDms(s,1,i,r,n);break;default:return console.warn(`invalid format: ${e}`),null}return o?n[0]:null}function $jt(t,e,r=0,i=!1){const n=[[t.x,t.y]],s=[],o=hw(t.spatialReference);let a=iGe(e);return a===-1?(console.warn(`invalid conversionMode: ${e}`),null):(i&&(a|=qh.PE_MGRS_ADD_SPACES),qh.geogToMgrsExtended(o,1,n,r,!1,a,s)?s[0]:null)}function Djt(t,e=0,r=!1){const i=[[t.x,t.y]],n=[],s=hw(t.spatialReference);return KD.geogToUsng(s,1,i,e,!1,r,n)?n[0]:null}function Ljt(t,e,r=!1){const i=[[t.x,t.y]],n=[],s=hw(t.spatialReference);let o=nGe(e);return o===-1?(console.warn(`invalid conversionMode: ${e}`),null):(r&&(o|=n1.PE_UTM_OPTS_ADD_SPACES),n1.geogToUtm(s,1,i,o,n)?n[0]:null)}function hw(t){let e=null;if(t||(t=St.WGS84),t.wkid){if(e=JD.geogcs(t.wkid),!e)throw new pe("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!t.wkt)throw new pe("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(e=JD.fromString(no.PE_TYPE_GEOGCS,t.wkt),!e)throw new pe("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return e}function iGe(t){let e=-1;switch(t){case"automatic":e=qh.PE_MGRS_STYLE_AUTO;break;case"new-180-in-zone-01":e=qh.PE_MGRS_STYLE_NEW|qh.PE_MGRS_180_ZONE_1_PLUS;break;case"new-180-in-zone-60":e=qh.PE_MGRS_STYLE_NEW;break;case"old-180-in-zone-01":e=qh.PE_MGRS_STYLE_OLD|qh.PE_MGRS_180_ZONE_1_PLUS;break;case"old-180-in-zone-60":e=qh.PE_MGRS_STYLE_OLD}return e}function nGe(t){let e=-1;switch(t){case"latitude-band-indicators":e=n1.PE_UTM_OPTS_NONE;break;case"north-south-indicators":e=n1.PE_UTM_OPTS_NS}return e}let Uh=class extends rt{constructor(t){super(t),this.conversionInfo=null,this.coordinateSegments=null,this.defaultPattern=null,this.name=null,this.viewModel=null}get currentPattern(){return this._get("currentPattern")||this._get("defaultPattern")}set currentPattern(t){this._set("currentPattern",t)}get label(){return this.name??""}set label(t){this._overrideIfSome("label",t)}get hasDisplayProperties(){return!(!this.defaultPattern||!this.coordinateSegments)}get spatialReference(){var t;return this.name==="basemap"?this._viewSpatialReference:((t=this.conversionInfo)==null?void 0:t.spatialReference)??St.WGS84}set spatialReference(t){this._overrideIfSome("spatialReference",t)}get _viewSpatialReference(){return this.get("viewModel.view.spatialReference")||St.WGS84}get _additionalCharactersPattern(){const t=this.get("coordinateSegments");if(!t)return null;const e=t.map(i=>i.alias),r=this.currentPattern.replace(new RegExp(`["nsew${e.join()}]`,"gi"),"").replace(/\ /g,"");return new RegExp(`[${r}]`,"g")}get test(){return{additionalCharactersPattern:this._additionalCharactersPattern}}convert(t){if(!zse(t))return Promise.reject(new pe("format:invalid-point","Could not convert invalid point.",{point:t}));const e=this.get("conversionInfo.convert");return e?Promise.resolve().then(()=>e(t)):this._project(t,this.spatialReference).then(r=>this._getCoordinate(r).then(i=>({location:r,coordinate:i})))}getConversionStrategy(){const t=this._viewSpatialReference;return this.get("conversionInfo.convert")||this.get("viewModel.formatterAvailable")||this.name==="xy"&&(t.isWebMercator||t.isWGS84)||this.name==="basemap"?"client":"server"}getDisplayCoordinate(t){if(!t)return null;if(!this.coordinateSegments||!this.currentPattern)return t;let e=this.currentPattern;const r=this._getSegmentMatches(t,!1);for(let i=this.coordinateSegments.length-1;i>=0;i--){const n=this.coordinateSegments[i];e=e.replace(n.alias,r[i])}return e}parseUserInput(t){let e=this.defaultPattern.replace(this._additionalCharactersPattern,"");t=t.replace(this._additionalCharactersPattern,"");const r=this._getSegmentMatches(t,!0);for(let i=this.coordinateSegments.length-1;i>=0;i--){const n=this.coordinateSegments[i];e=e.replace(n.alias,r[i])}return e}_getSegmentMatches(t,e){const r=[];for(let i=0;i<this.coordinateSegments.length;i++){const n=this.coordinateSegments[i],s=t.match(n.searchPattern);if(!s){r.push("");continue}let o=s[0];if(t=t.replace(o,"").trim(),n.substitution){const a=e?n.substitution.input(o):n.substitution.output(o);a&&(o=`${a}`)}r.push(o)}return r}reverseConvert(t){const e=this.parseUserInput(t),r=this.get("conversionInfo.reverseConvert");let i;if(r)i=r(e);else if(this.name==="xy"||this.name==="basemap")i=_jt(e,this.spatialReference);else if(this.viewModel.formatterAvailable)switch(this.name){case"dd":case"ddm":case"dms":i=Mjt(e,this.spatialReference);break;case"mgrs":{const n="automatic";i=Rjt(e,this.spatialReference,n);break}case"utm":{const n="latitude-band-indicators";i=Pjt(e,this.spatialReference,n);break}case"usng":i=Ojt(e,this.spatialReference);break;default:i=null}return i?this._project(i,this._viewSpatialReference):Promise.reject(new pe("format:invalid-input","Could not parse input into point.",{userInput:t}))}_getCoordinate(t){const e=this.get("viewModel.view.scale");if(!zse(t))return Promise.reject(new pe("format:invalid-point","Could not transform invalid point into coordinate.",{point:t}));if(this.get("viewModel.formatterAvailable")||this.name==="basemap"||this.name==="xy")switch(this.name){case"dd":case"ddm":case"dms":{const r=tGe(e);return Promise.resolve(Ijt(t,this.name,r))}case"mgrs":{const n="automatic";return Promise.resolve($jt(t,n,5,!1))}case"usng":return Promise.resolve(Djt(t,5,!1));case"utm":{const i="latitude-band-indicators";return Promise.resolve(Ljt(t,i,!0))}default:return Promise.resolve(fSe(t,e))}return Promise.resolve(fSe(t,e))}_project(t,e){var r,i;if(jo(t.spatialReference,e)||!e)return Promise.resolve(t);if((r=this.viewModel)!=null&&r.formatterAvailable&&XG())return Promise.resolve(vE(t,e));if(!((i=this.viewModel)!=null&&i.formatterAvailable)){const n=ew(t,e);if(M(n))return Promise.resolve(n)}return null}};h([f()],Uh.prototype,"conversionInfo",void 0),h([f()],Uh.prototype,"coordinateSegments",void 0),h([f()],Uh.prototype,"currentPattern",null),h([f()],Uh.prototype,"label",null),h([f()],Uh.prototype,"defaultPattern",void 0),h([f({readOnly:!0})],Uh.prototype,"hasDisplayProperties",null),h([f()],Uh.prototype,"name",void 0),h([f({type:St})],Uh.prototype,"spatialReference",null),h([f()],Uh.prototype,"viewModel",void 0),h([f({readOnly:!0})],Uh.prototype,"_viewSpatialReference",null),h([f({readOnly:!0})],Uh.prototype,"_additionalCharactersPattern",null),Uh=h([Q("esri.widgets.CoordinateConversion.support.Format")],Uh);const Ov=Uh,cT=$H().decimal,Z3={N:"north",S:"south",E:"east",W:"west"},Ro="",Z9=new RegExp(`-?\\d+[\\.|\\${cT}]?\\d*`),Njt=/^[\\0]+(?=\d)/;function gSe(t,e){const r=yu()==="ar",i=t.abbreviatedDirections.north,n=t.abbreviatedDirections.south,s=t.abbreviatedDirections.east,o=t.abbreviatedDirections.west,a=$H().decimal,l={};l[i]="N",l[n]="S",l[s]="E",l[o]="W";const c=new RegExp(`-?\\d+[\\.|\\${a}]?\\d*`),u=new RegExp(`N|S|${i}|${n}`,"i"),d=new RegExp(`E|W|${s}|${o}`,"i"),p={ddm:`Y${Ro} A'${t.abbreviatedDirections.north}, X${Ro} B'${t.abbreviatedDirections.east}`,dms:`Y${Ro} A' B"${t.abbreviatedDirections.north}, X${Ro} C' D"${t.abbreviatedDirections.east}`,dd:`Y${Ro}${t.abbreviatedDirections.north}, X${Ro}${t.abbreviatedDirections.east}`,xy:`X${Ro}, Y${Ro}`,basemap:"X, Y"},A={ddm:`${t.abbreviatedDirections.north}${Ro}Y 'A ,${t.abbreviatedDirections.east}${Ro}X 'B`,dms:`${t.abbreviatedDirections.north}${Ro}Y 'A "B ,${t.abbreviatedDirections.east}${Ro}X 'C "D`,dd:`${t.abbreviatedDirections.north}${Ro}Y ,${t.abbreviatedDirections.east}${Ro}X`,xy:`X${Ro} ,Y${Ro}`,basemap:"X ,Y"},v=new RegExp(`\\d{1,2}[\\.|\\${a}]?\\d*`,"i"),b=new RegExp(`\\d{1,3}[\\.|\\${a}]?\\d*`,"i");e.forEach(S=>{const{name:E}=S;if(E==="dd"?S.coordinateSegments=[{alias:"Y",description:"degrees latitude",searchPattern:v,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:t.abbreviatedDirections.north,description:"north/south indicator",searchPattern:u,substitution:{input:R=>l[R],output:R=>t.abbreviatedDirections[Z3[R]]}},{alias:"X",description:"degrees longitude",searchPattern:b,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:t.abbreviatedDirections.east,description:"east/west indicator",searchPattern:d,substitution:{input:R=>l[R],output:R=>t.abbreviatedDirections[Z3[R]]}}]:E==="ddm"?S.coordinateSegments=[{alias:"Y",description:"degrees latitude",searchPattern:v,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:"A",description:"minutes latitude",searchPattern:v,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:t.abbreviatedDirections.north,description:"north/south indicator",searchPattern:u,substitution:{input:R=>l[R],output:R=>t.abbreviatedDirections[Z3[R]]}},{alias:"X",description:"degrees longitude",searchPattern:b,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:"B",description:"minutes longitude",searchPattern:v,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:t.abbreviatedDirections.east,description:"east/west indicator",searchPattern:d,substitution:{input:R=>l[R],output:R=>t.abbreviatedDirections[Z3[R]]}}]:E==="dms"?S.coordinateSegments=[{alias:"Y",description:"degrees latitude",searchPattern:v,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:"A",description:"minutes latitude",searchPattern:v,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:"B",description:"seconds latitude",searchPattern:v,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:t.abbreviatedDirections.north,description:"north/south indicator",searchPattern:u,substitution:{input:R=>l[R],output:R=>t.abbreviatedDirections[Z3[R]]}},{alias:"X",description:"degrees longitude",searchPattern:b,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:"C",description:"minutes longitude",searchPattern:v,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:"D",description:"seconds longitude",searchPattern:v,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:t.abbreviatedDirections.east,description:"east/west indicator",searchPattern:d,substitution:{input:R=>l[R],output:R=>t.abbreviatedDirections[Z3[R]]}}]:(S.name==="xy"||S.name==="basemap")&&(S.coordinateSegments=[{alias:"X",description:"easting",searchPattern:c,substitution:{input:R=>ls(R),output:R=>as(R)}},{alias:"Y",description:"northing",searchPattern:c,substitution:{input:R=>ls(R),output:R=>as(R)}}]),p[E]){const R=r?A[E]:p[E];S.defaultPattern=R,S.currentPattern=R}})}function Fjt(){const t=new RegExp("N|S","i"),e=new RegExp("E|W","i");return[new Ov({name:"basemap",coordinateSegments:[{alias:"X",description:"easting",searchPattern:Z9,substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"Y",description:"northing",searchPattern:Z9,substitution:{input:r=>ls(r),output:r=>as(r)}}],defaultPattern:"X, Y",viewModel:null}),new Ov({name:"dd",coordinateSegments:[{alias:"Y",description:"degrees latitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\${cT}]?\\d*(?=\\D*?[N|S])`,"i"),substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"N",description:"north/south indicator",searchPattern:t},{alias:"X",description:"degrees longitude",searchPattern:new RegExp(`\\d{1,3}[\\.|\\${cT}]?\\d*(?=\\D*?[E|W|])`,"i"),substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"E",description:"east/west indicator",searchPattern:e}],defaultPattern:`Y${Ro}N, X${Ro}E`,viewModel:null}),new Ov({name:"ddm",coordinateSegments:[{alias:"Y",description:"degrees latitude",searchPattern:new RegExp("\\d{1,2}(?=.*?\\s+.*?[N|S])","i"),substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"A",description:"minutes latitude",searchPattern:new RegExp(`\\d{1,2}[\\.\\${cT}]?\\d*(?=.*?[N|S])`,"i"),substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"N",description:"north/south indicator",searchPattern:t},{alias:"X",description:"degrees longitude",searchPattern:new RegExp("\\d{1,3}(?=\\D*?\\s+.*?[E|W])","i"),substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"B",description:"minutes longitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\|${cT}]?\\d*(?=.*?[E|W])`,"i"),substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"E",description:"east/west indicator",searchPattern:e}],defaultPattern:`Y${Ro} A'N, X${Ro} B'E`,viewModel:null}),new Ov({name:"dms",coordinateSegments:[{alias:"Y",description:"degrees latitude",searchPattern:new RegExp("\\d{1,2}(?=.*?\\s+.*?[N|S])","i"),substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"A",description:"minutes latitude",searchPattern:new RegExp("\\d{1,2}(?=.*?[N|S])","i"),substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"B",description:"seconds latitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\${cT}]?\\d*(?=.*?[N|S])`,"i"),substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"N",description:"north/south indicator",searchPattern:t},{alias:"X",description:"degrees longitude",searchPattern:new RegExp("\\d{1,3}(?=.*?\\s+.*?[E|W])","i"),substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"C",description:"minutes longitude",searchPattern:new RegExp("\\d{1,2}(?=.*?[E|W])","i"),substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"D",description:"seconds longitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\${cT}]?\\d*(?=.*?[E|W])`,"i"),substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"E",description:"east/west indicator",searchPattern:e}],defaultPattern:`Y${Ro} A' B"N, X${Ro} C' D"E`,viewModel:null}),new Ov({name:"xy",coordinateSegments:[{alias:"X",description:"longitude",searchPattern:Z9,substitution:{input:r=>ls(r),output:r=>as(r)}},{alias:"Y",description:"latitude",searchPattern:Z9,substitution:{input:r=>ls(r),output:r=>as(r)}}],defaultPattern:`X${Ro}, Y${Ro}`,viewModel:null}),new Ov({name:"mgrs",coordinateSegments:[{alias:"Z",description:"grid zone",searchPattern:/\d{1,2}\w|[abyz]/i},{alias:"S",description:"grid square",searchPattern:/\w{2}/},{alias:"X",description:"easting",searchPattern:/^\d{5}(?=.?\d{5}$)|^\d{4}(?=.?\d{4}$)|^\d{3}(?=.?\d{3}$)|^\d{2}(?=.?\d{2}$)|^\d(?=.?\d$)/},{alias:"Y",description:"northing",searchPattern:/^\d{1,5}/}],defaultPattern:"Z S X Y",viewModel:null}),new Ov({name:"usng",coordinateSegments:[{alias:"Z",description:"grid zone",searchPattern:/\d{1,2}\w|[abyz]/i},{alias:"S",description:"grid square",searchPattern:/\w{2}/},{alias:"X",description:"easting",searchPattern:/^\d{5}(?=.?\d{5}$)|^\d{4}(?=.?\d{4}$)|^\d{3}(?=.?\d{3}$)|^\d{2}(?=.?\d{2}$)|^\d(?=.?\d$)/},{alias:"Y",description:"northing",searchPattern:/^\d{1,5}/}],defaultPattern:"Z S X Y",viewModel:null}),new Ov({name:"utm",coordinateSegments:[{alias:"Z",description:"zone number",searchPattern:/\d{1,2}|[abyz]/i},{alias:"B",description:"latitude band",searchPattern:/^\D/},{alias:"X",description:"easting",searchPattern:/\d{1,7}(?=\s*\d{7}$)/},{alias:"Y",description:"northing",searchPattern:/\d{1,7}/}],defaultPattern:"ZB X Y",viewModel:null})]}function as(t){const e=t.match(Njt),r=e?e[0]:"",i=t.includes(".")?t.split(".")[1].length:0;return r+bjt(Number(t),{pattern:"###0.###",places:i,round:-1})}function ls(t){return Sjt(t)}const J9={default:"default",crosshair:"crosshair"},kjt=new Ht([0,0,500]),Ujt="xy",Bjt=["mgrs","utm","usng","dd","dms","ddm"],ASe="esri__coordinateConversionWidgetState",_g={conversions:"conversions",formats:"formats",view:"view",viewChange:"view-change"},zjt="esri/images/search/search-symbol-32.png";let pc=class extends que(Ws.EventedAccessor){constructor(t){super(t),this._conversionPromise=null,this._handles=new cn,this._locationGraphic=null,this._pointerCount=0,this.conversions=new ur,this.formats=new ur,this.formatterAvailable=!1,this.messages=null,this.filteredFormats=new ur,this.locationSymbol=new IN({url:nn(zjt),width:24,height:24}),this.storageEnabled=!0,this.storageType="session",this.view=null,this._saveWidgetState=this._saveWidgetState.bind(this),this._handleFormatChange=this._handleFormatChange.bind(this),this._handleConversionChange=this._handleConversionChange.bind(this),this._handleViewChange=this._handleViewChange.bind(this),this._onClick=this._onClick.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerUp=this._onPointerUp.bind(this)}initialize(){const t=async()=>this.messages=await Ele("esri/widgets/CoordinateConversion/t9n/CoordinateConversion");this.formats.addMany(Fjt()),t().then(()=>{if(!this.destroyed&&(gSe(this.messages,this.formats),this.storageEnabled&&this._loadWidgetState(),this.formats.forEach(e=>{e.viewModel=this,this._handles.add(xe(()=>e.currentPattern,this._saveWidgetState),e.name)}),this._handles.add(this.conversions.on("change",this._handleConversionChange),_g.conversions),this._handles.add(this.formats.on("change",this._handleFormatChange),_g.formats),this._handles.add(xle(()=>{t().then(()=>{gSe(this.messages,this.formats)})})),tL().then(()=>{this.formatterAvailable=!0}).catch(e=>{we.getLogger(this.declaredClass).error(new pe("coordinate-conversion:projection-load-failed","Failed to load the projection module.",{error:e})),this.formatterAvailable=!1,this._filterFormatsAndConversions()}).then(()=>this._handles.add(xe(()=>this.view,this._handleViewChange,Rr),_g.viewChange)),this.conversions.length===0)){const e=this.formats.find(r=>r.name===Ujt)||this.formats.getItemAt(0);this.conversions.add(new NM({format:e}))}})}destroy(){this._handles.removeAll(),this._cleanUpView(this.view),this.view=null}castConversions(t){return this._castToConversions(t)}set currentLocation(t){this._set("currentLocation",t),this._updateConversions()}get currentLocation(){return this._get("currentLocation")||null}set mode(t){switch(t){case"capture":this.currentLocation=null,this._startCaptureMode(),this._set("mode",t);break;case"live":this._startLiveMode(),this._set("mode",t)}}get mode(){return this._get("mode")||"live"}get state(){const{messages:t,view:e}=this,r=e==null?void 0:e.ready;return t?r?"ready":e?"loading":"disabled":"disabled"}get storage(){const{storageType:t}=this;return t==="session"?sessionStorage:localStorage}get waitingForConversions(){return this._conversionPromise!=null}setLocation(t){if(this.view.graphics.remove(this._locationGraphic),t){const e=t.clone();e.hasZ&&(e.z=void 0),this._locationGraphic=new Pl({geometry:e,symbol:this.get("locationSymbol")}),this.view.graphics.add(this._locationGraphic)}}convert(t,e){return zse(e)?Promise.resolve().then(()=>t.convert(e)):Promise.reject(new pe("coordinate-conversion:invalid-point","Invalid point cannot be converted.",{point:e}))}goToLocation(t){var n,s,o;const e=this.view,r=e.type==="3d"?e.clippingArea:null,i=(s=(n=e.map)==null?void 0:n.basemap)==null?void 0:s.baseLayers;if(r||(i==null?void 0:i.length)>0){const a=r??((o=i.getItemAt(0))==null?void 0:o.fullExtent);if(M(a)&&!a.contains(t))return Promise.reject(new pe("coordinate-conversion:go-to-failed","Point outside basemap extent.",{point:t}))}return this.callGoTo({target:t})}pause(){this.currentLocation=null,this._handles.remove(_g.view),this.view&&(this.view.cursor=J9.default,this.view.graphics.remove(this._locationGraphic))}previewConversion(t,e=this.currentLocation||kjt){return this._convertMany([t],e).then(()=>t.displayCoordinate)}resume(){this.mode==="capture"?this._startCaptureMode():this._startLiveMode()}reverseConvert(t,e){return e.reverseConvert(t)}async updateConversions(t,e){if(!e||!e.type||e.type!=="point")throw this._clearConversions(this.conversions),new pe("coordinate-conversion:invalid-input-point","Point is invalid, conversions cannot be updated.",{point:e});return this._convertMany(t,e)}_castToConversions(t){const e=new ur;return t.forEach(r=>{let i;if(r instanceof NM)i=r;else if(typeof r=="string"){const n=this.formats.find(s=>s.name===r);n&&(i=new NM({format:n}))}i&&e.add(i)}),e}_cleanUpView(t){t&&(t.graphics.remove(this._locationGraphic),this._handles.remove(_g.view),t.cursor=J9.default)}_clearConversions(t){t.forEach(e=>{e.position={location:null,coordinate:null}})}_convertMany(t,e){return Promise.all(t.map(r=>r.format.convert(e).then(i=>(r.position=i,r)).catch(()=>{r.position=null}))).then(()=>t)}_handleConversionChange(t){t.added.forEach(e=>{const r=e.format;r.viewModel=this,this.currentLocation&&(this._set("waitingForConversions",!0),this.convert(r,this.currentLocation).then(i=>{e.position=i,this._set("waitingForConversions",!1)}))}),this._saveWidgetState()}_handleFormatChange(t){t.added.forEach(e=>{this._handles.add(xe(()=>e.currentPattern,this._saveWidgetState),e.name),e.viewModel=this}),t.removed.forEach(e=>{e.viewModel=null;const r=this.conversions.filter(i=>i.format===e);this.conversions.removeMany(r),this._handles.remove(e.name)})}_loadWidgetState(){try{const t=JSON.parse(this.storage.getItem(ASe));t&&this._setWidgetState(t)}catch(t){we.getLogger(this.declaredClass).error(new pe("coordinate-conversion:invalid-session-storage-json","Could not read from storage.",{error:t}))}}_startCaptureMode(){this._handles.remove(_g.view),this.view&&(this.view.cursor=J9.crosshair,this.currentLocation&&this.setLocation(this.currentLocation),this._handles.add(this.view.on("click",this._onClick),_g.view))}_startLiveMode(){this._pointerCount=0,this._handles.remove(_g.view),this.view&&(this.view.cursor=J9.default,this.view.graphics.remove(this._locationGraphic),this._handles.add([this.view.on("pointer-down",this._onPointerDown),this.view.on("pointer-up",this._onPointerUp),this.view.on("pointer-move",this._onPointerMove)],_g.view))}_handleViewChange(t,e){e&&e!==t&&this._cleanUpView(e),t&&(this.mode==="capture"?this._startCaptureMode():this._startLiveMode(),e&&this._filterFormatsAndConversions())}_onClick(t){if(t.button===0){const e=this.view.toMap(t),r=e&&e.normalize();this.setLocation(r),this.currentLocation=r}}_onPointerDown(t){const{pointerType:e}=t;if(this._pointerCount++,(e==="touch"||e==="pen")&&this._pointerCount===1){const r=this.view.toMap(t);this.currentLocation=r&&r.normalize()}}_onPointerMove(t){const{pointerType:e}=t;if(e==="mouse"||this._pointerCount===1){const r=this.view.toMap(t);this.currentLocation=r&&r.normalize()}}_onPointerUp(){this._pointerCount--}_setWidgetState(t){try{t.formats.forEach(e=>{const r=this.formats.find(i=>i.name===e.name);r&&t.locale===yu()&&e.currentPattern&&(r.currentPattern=e.currentPattern),r&&e.index>=0&&this.conversions.add(new NM({format:r}))})}catch(e){we.getLogger(this.declaredClass).warn(new pe("coordinate-conversion:session-storage-read-error","Could not get widget state from stored JSON.",{error:e}))}}_saveWidgetState(){if(!this.storageEnabled)return;const t=this._toJSON();try{this.storage.setItem(ASe,JSON.stringify({formats:t,locale:yu()}))}catch(e){we.getLogger(this.declaredClass).error(new pe("coordinate-conversion:local-storage-write-error","Could not write to localStorage.",{error:e}))}}async _updateConversions(){try{await this.updateConversions(this.conversions.toArray(),this.currentLocation)}catch{}}_toJSON(){return this.formats.filter(t=>{const e=t.name;return e==="xy"||e==="basemap"||vjt(e)}).map(t=>({name:t.name,currentPattern:t.currentPattern,defaultPattern:t.defaultPattern,index:this.conversions.findIndex(e=>e.format===t)})).sort((t,e)=>t.index-e.index).toArray()}_filterFormatsAndConversions(){const{formatterAvailable:t,conversions:e,formats:r}=this;t||this._handles.add(ic(()=>this.view.spatialReference,i=>{const n=i.isWebMercator||i.isWGS84,s=r.filter(l=>{const{name:c}=l;return!!Bjt.includes(c)||c==="xy"&&!n}),o=this.filteredFormats.filter(l=>l.name==="xy"&&n&&!this.formats.includes(l)),a=e.filter(l=>s.includes(l.format));r.removeMany(s),e.removeMany(a),this.filteredFormats.addMany(s.filter(l=>!this.filteredFormats.includes(l))),r.addMany(o)},{once:!0,initial:!0}),_g.view)}};h([f()],pc.prototype,"conversions",void 0),h([Wr("conversions")],pc.prototype,"castConversions",null),h([f({type:Ht})],pc.prototype,"currentLocation",null),h([f()],pc.prototype,"formats",void 0),h([f()],pc.prototype,"messages",void 0),h([f()],pc.prototype,"mode",null),h([f()],pc.prototype,"filteredFormats",void 0),h([f({readOnly:!0})],pc.prototype,"state",null),h([f()],pc.prototype,"locationSymbol",void 0),h([f({readOnly:!0,dependsOn:["storageType"]})],pc.prototype,"storage",null),h([f()],pc.prototype,"storageEnabled",void 0),h([f()],pc.prototype,"storageType",void 0),h([f({readOnly:!0})],pc.prototype,"waitingForConversions",null),h([f()],pc.prototype,"view",void 0),pc=h([Q("esri.widgets.CoordinateConversion.CoordinateConversionViewModel")],pc);const sGe=pc,Dt={base:"esri-coordinate-conversion esri-widget",captureMode:"esri-coordinate-conversion--capture-mode",noBasemap:"esri-coordinate-conversion--no-basemap",popup:"esri-coordinate-conversion__popup",clipboardPopup:"esri-coordinate-conversion__clipboard-popup",conversionList:"esri-coordinate-conversion__conversion-list",conversionRow:"esri-coordinate-conversion__row",coordDisplay:"esri-coordinate-conversion__display",expanded:"esri-coordinate-conversion__conversions-view--expanded",expandDown:"esri-coordinate-conversion__conversions-view--expand-down",expandUp:"esri-coordinate-conversion__conversions-view--expand-up",conversionsView:"esri-coordinate-conversion__conversions-view",primarySelect:"esri-coordinate-conversion__select-primary",rowSelect:"esri-coordinate-conversion__select-row",toolDisplay:"esri-coordinate-conversion__tools",modeToggle:"esri-coordinate-conversion__mode-toggle",rowButton:"esri-coordinate-conversion__row-button",backButton:"esri-coordinate-conversion__back-button",convertButton:"esri-coordinate-conversion__button",convertButtonSpan:"esri-coordinate-conversion__convert-button-span",coordinateInput:"esri-coordinate-conversion__input-coordinate",inputForm:"esri-coordinate-conversion__input-form",inputFormGroup:"esri-coordinate-conversion__input-group",rejectInput:"esri-coordinate-conversion__input-coordinate--rejected",sectionHeading:"esri-coordinate-conversion__heading",patternInput:"esri-coordinate-conversion__pattern-input",settings:"esri-coordinate__settings",settingsFormGroup:"esri-coordinate-conversion__settings-group",settingsFormGroupHorizontal:"esri-coordinate-conversion__settings-group-horizontal",previewCoordinate:"esri-coordinate-conversion__preview-coordinate",disabled:"esri-disabled",input:"esri-input",button:"esri-button",header:"esri-widget__heading",widgetButton:"esri-widget--button",leftArrow:"esri-icon-left-arrow",rightArrow:"esri-icon-right-arrow",captureButton:"esri-icon-map-pin",collapseButton:"esri-icon-up",copyButton:"esri-icon-duplicate",editButton:"esri-icon-edit",esriSelect:"esri-select",expandButton:"esri-icon-down",goToButton:"esri-icon-locate",refresh:"esri-icon-refresh",removeConversion:"esri-icon-close",settingsButton:"esri-icon-settings2"},ySe={settingsButton:!0,inputButton:!0,captureButton:!0,expandButton:!0},Vjt=750,Gjt=2500;let Is=class extends Lc{constructor(t,e){super(t,e),this._popupMessage=null,this._popupTimeoutId=null,this._clipboardPopupTimeoutId=null,this._coordinateInput=null,this._badInput=!1,this._goToEnabled=!1,this._conversionFormat=null,this._settingsFormat=null,this._previewConversion=null,this._expanded=!1,this._clipboardPopupVisible=!1,this._popupVisible=!1,this._settingsVisible=!1,this._inputVisible=!1,this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.orientation="auto",this.viewModel=new sGe,this.visibleElements={...ySe}}get conversions(){return this.viewModel.conversions}set conversions(t){this.viewModel.conversions=t}get currentLocation(){return this.viewModel.currentLocation}set currentLocation(t){this.viewModel.currentLocation=t}get formats(){return this.viewModel.formats}set formats(t){this.viewModel.formats=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get mode(){return this.viewModel.mode}set mode(t){this.viewModel.mode=t}set multipleConversions(t){t===!1&&(this._expanded=!1,this.conversions.splice(1,this.conversions.length-1)),this._set("multipleConversions",t)}get multipleConversions(){const t=this._get("multipleConversions");return typeof t!="boolean"||t}get locationSymbol(){return this.viewModel.locationSymbol}set locationSymbol(t){this.viewModel.locationSymbol=t}get storageEnabled(){return this.viewModel.storageEnabled}set storageEnabled(t){this.viewModel.storageEnabled=t}get storageType(){return this.viewModel.storageType}set storageType(t){this.viewModel.storageType=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}castVisibleElements(t){return{...ySe,...t}}reverseConvert(t,e){return this.viewModel.reverseConvert(t,e)}render(){const t=this.get("viewModel.state"),e=t==="disabled"?Ae("div",{key:"esri-coordinate__no-basemap"},this.messages.noBasemap):null,r=!e&&this._inputVisible?this._renderInputForm():null,i=!e&&this._settingsVisible?this._renderSettings():null,n=e||r||i?null:this._renderConversionsView(),s=this._popupVisible?this._renderPopup():null,o={[Dt.captureMode]:this.mode==="capture",[Dt.disabled]:t==="loading",[Dt.noBasemap]:t==="disabled"};return Ae("div",{class:this.classes(Dt.base,o)},s,e,n,i,r)}_addConversion(t){const e=t.target,r=e.options[e.options.selectedIndex]["data-format"],i=e["data-index"],n=new NM({format:r});e.options.selectedIndex=0,i>=0&&this.conversions.removeAt(i),this.conversions.add(n,i)}_findSettingsFormat(){return this._settingsFormat||this.conversions.reduceRight((t,e)=>{const r=e.format;return r.get("hasDisplayProperties")?r:t},null)||this.formats.find(t=>t.hasDisplayProperties)}_hidePopup(){this._popupTimeoutId&&(clearTimeout(this._popupTimeoutId),this._popupTimeoutId=null),this._popupVisible=!1,this._popupMessage=null,this.scheduleRender()}_hideClipboardPopup(){this._clipboardPopupTimeoutId&&(clearTimeout(this._clipboardPopupTimeoutId),this._clipboardPopupTimeoutId=null),this._clipboardPopupVisible=!1,this.scheduleRender()}_onConvertComplete(){this._inputVisible=!1,this._coordinateInput.value=""}_onCopy(t){const e=t.currentTarget["data-conversion"].displayCoordinate;t.clipboardData.setData("text/plain",e),this._showClipboardPopup(),t.preventDefault()}_processUserInput(t){const e=Sb(t),r=this.viewModel;if(e!=="Enter"&&e)this._badInput&&(this._badInput=!1);else{const i=this._coordinateInput["data-format"],n=this._coordinateInput.value;this._reverseConvert(n,i).then(s=>{this.mode==="capture"?r.resume():this.mode="capture",this.currentLocation=s,r.setLocation(s),this._onConvertComplete()}).catch(s=>{we.getLogger(this.declaredClass).error(s),this._showPopup(this.messages.invalidCoordinate),this._badInput=!0})}}_reverseConvert(t,e){const r=this.viewModel;return e.reverseConvert(t).then(i=>(this._goToEnabled&&r.goToLocation(i).catch(n=>{we.getLogger(this.declaredClass).warn(n),this._showPopup(this.messages.locationOffBasemap)}),i))}_setInputFormat(t){const e=t.target,r=e[e.options.selectedIndex]["data-format"];this._conversionFormat=r}_setPreviewConversion(){const t=this._findSettingsFormat(),e=this.viewModel;if(t){const r=this.conversions.find(i=>i.format===t);this._previewConversion=new NM({format:t,position:{location:this.currentLocation,coordinate:r&&r.position.coordinate}}),this._previewConversion.position.coordinate||e.previewConversion(this._previewConversion)}}_setSettingsFormat(t){const e=t.target,r=e[e.options.selectedIndex]["data-format"];this._settingsFormat=r,this._setPreviewConversion()}_showClipboardPopup(){this._clipboardPopupVisible?clearTimeout(this._clipboardPopupTimeoutId):this._clipboardPopupVisible=!0,this.scheduleRender(),this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=null,this._hideClipboardPopup()},Vjt)}_showPopup(t,e=Gjt){this._popupMessage=t,this._popupVisible?clearTimeout(this._popupTimeoutId):this._popupVisible=!0,this.scheduleRender(),this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=null,this._hidePopup()},e)}_toggleGoTo(){this._goToEnabled=!this._goToEnabled}_updateCurrentPattern(t){t.stopPropagation();const e=t.target,r=this._findSettingsFormat();r&&(r.currentPattern=e.value)}_renderConversion(t,e){const{messages:r}=this,i=`${this.id}__list-item-${e}`,n=`${t.format.label} ${r.conversionOutputSuffix}`,s=e===0,o=s||this._expanded,a=s?this._renderFirstConversion(t):this._renderTools(e,t,i),l=s&&!t.displayCoordinate?r.noLocation:t.displayCoordinate,c=Ae("div",{"aria-label":l,class:Dt.coordDisplay,"data-conversion":t,role:"listitem",tabindex:"0",title:l},l),u=this._renderOptions(this.formats.filter(d=>d!==t.format));return o?Ae("li",{"aria-label":n,class:Dt.conversionRow,id:i,key:t,role:"group",title:n,tabindex:"0"},Ae("select",{"aria-controls":i,"aria-label":r.selectFormat,class:this.classes(Dt.esriSelect,Dt.rowSelect),bind:this,"data-index":e,onchange:this._addConversion,title:r.selectFormat},Ae("option",{"aria-label":t.format.label,selected:!0,title:t.format.label},t.format.label.toUpperCase()),u),c,a):null}_renderCopyButton(t){const e=this._clipboardPopupVisible&&this._renderClipboardPopup();return Ae("li",{"aria-label":this.messagesCommon.copy,bind:this,class:this.classes(Dt.widgetButton,Dt.rowButton),"data-conversion":t,onclick:this._copyCoordinateOutput,onkeydown:this._copyCoordinateOutput,oncopy:this._onCopy,role:"button",tabindex:"0",title:this.messagesCommon.copy},e,Ae("span",{"aria-hidden":"true",class:Dt.copyButton}))}_renderFirstConversion(t){const e=this.id,r={[Dt.expandButton]:!this._expanded,[Dt.collapseButton]:this._expanded},{messages:i,messagesCommon:n,multipleConversions:s,visibleElements:o}=this,a=this.mode==="live"?i.captureMode:i.liveMode,l=this._expanded?n.collapse:n.expand,c=t.displayCoordinate&&this.mode==="capture"?this._renderCopyButton(t):null,u=s&&o.expandButton&&Ae("li",{"aria-controls":`${e}__${Dt.conversionList}`,"aria-label":l,bind:this,class:Dt.widgetButton,key:"esri-coordinate-conversion__expand-button",onclick:this._toggleExpand,onkeydown:this._toggleExpand,role:"button",tabindex:"0",title:l},Ae("span",{"aria-hidden":"true",class:this.classes(r)})),d=!s&&o.captureButton&&Ae("li",{"aria-label":a,bind:this,class:this.classes(Dt.widgetButton,Dt.modeToggle),key:"esri-coordinate-conversion__mode-toggle",onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",tabindex:"0",title:a},Ae("span",{"aria-hidden":"true",class:Dt.captureButton}));return Ae("ul",{class:Dt.toolDisplay},c,u,d)}_renderInputForm(){const t=this._conversionFormat||this.conversions.getItemAt(0).format,e=this.formats.findIndex(u=>u.name===t.name),r=this.id,i=`${r}__${Dt.coordinateInput}`,n=`${r}__${Dt.coordinateInput}__header`,s=this._renderOptions(this.formats,!0,e),o={[Dt.rejectInput]:this._badInput},{messages:a,messagesCommon:l,headingLevel:c}=this;return Ae("div",{"aria-labelledby":n,class:Dt.inputForm,key:"esri-coordinate-conversion__input-form",role:"search"},Ae("div",{class:Dt.sectionHeading},Ae("div",{"aria-label":l.back,bind:this,class:this.classes(Dt.widgetButton,Dt.backButton),onclick:this._toggleInputVisibility,onkeydown:this._toggleInputVisibility,role:"button",tabindex:"0",title:l.back},this._renderBackIcon()),Ae(lL,{level:c,class:Dt.header,id:n},a.inputCoordTitle)),Ae("div",{class:Dt.inputFormGroup},Ae("select",{"aria-controls":i,"aria-label":a.selectFormat,bind:this,class:this.classes(Dt.esriSelect,Dt.rowSelect),onchange:this._setInputFormat,title:a.selectFormat},s),Ae("input",{afterCreate:nL,"aria-labelledby":n,"aria-required":"true",bind:this,class:this.classes(Dt.coordinateInput,Dt.input,o),"data-format":t,"data-node-ref":"_coordinateInput",id:i,onkeydown:this._processUserInput,placeholder:a.inputCoordTitle,role:"textbox",spellcheck:!1,title:a.inputCoordTitle,type:"text"})),Ae("div",{class:Dt.inputFormGroup},Ae("label",{"aria-label":a.goTo},Ae("input",{bind:this,checked:this._goToEnabled,onclick:this._toggleGoTo,title:a.goTo,type:"checkbox"}),a.goTo),Ae("button",{"aria-label":a.convert,bind:this,class:this.classes(Dt.convertButton,Dt.button),onclick:this._processUserInput,title:a.convert,type:"button"},Ae("span",{class:Dt.convertButtonSpan},a.convert))))}_renderConversionsView(){const t=`${this.id}__${Dt.conversionList}`,e=this._renderPrimaryTools(),r=this._renderOptions(this.formats),i=this.conversions.map((a,l)=>this._renderConversion(a,l)).toArray(),{messages:n}=this,s=this._expanded?Ae("div",{class:Dt.conversionRow},Ae("select",{"aria-controls":t,"aria-label":n.addConversion,bind:this,class:this.classes(Dt.esriSelect,Dt.primarySelect),onchange:this._addConversion,title:n.addConversion},Ae("option",{disabled:!0,selected:!0,value:""},n.addConversion),r),e):null,o={[Dt.expanded]:this._expanded,[Dt.expandUp]:this.orientation==="expand-up",[Dt.expandDown]:this.orientation==="expand-down"};return Ae("div",{class:this.classes(Dt.conversionsView,o),key:"esri-coordinate-conversion__main-view"},Ae("ul",{"aria-expanded":this._expanded?"true":"false",class:Dt.conversionList,id:t},i),s)}_renderOptions(t,e,r){const i=this.conversions.getItemAt(0);return t.map((n,s)=>{const o=!(e||!i)&&(i.format.name===n.name||this.conversions.map(a=>a.format.name).includes(n.name));return Ae("option",{"aria-label":n.label,"data-format":n,disabled:o,key:n.name,selected:s===r,value:n.label},n.label.toUpperCase())}).toArray()}_renderPopup(){return Ae("div",{class:Dt.popup,role:"alert"},this._popupMessage)}_renderClipboardPopup(){return Ae("div",{class:this.classes(Dt.popup,Dt.clipboardPopup),role:"alert"},this.messages.copySuccessMessage)}_renderPrimaryTools(){const{messages:t,visibleElements:e}=this,r=this.mode==="live"?t.captureMode:t.liveMode,i=e.inputButton&&Ae("li",{bind:this,class:Dt.widgetButton,onclick:this._toggleInputVisibility,onkeydown:this._toggleInputVisibility,role:"button",tabindex:"0",title:t.inputCoordTitle},Ae("span",{"aria-hidden":"true",class:Dt.editButton})),n=e.captureButton&&Ae("li",{bind:this,class:this.classes(Dt.widgetButton,Dt.modeToggle),onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",tabindex:"0",title:r},Ae("span",{"aria-hidden":"true",class:Dt.captureButton})),s=e.settingsButton&&Ae("li",{bind:this,class:Dt.widgetButton,onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,role:"button",tabindex:"0",title:t.settingsTitle},Ae("span",{"aria-hidden":"true",class:Dt.settingsButton}));return Ae("ul",{class:Dt.toolDisplay},i,n,s)}_renderSettings(){const t=this.id,e=`${t}__${Dt.patternInput}`,r=`${t}__${Dt.patternInput}__header`,i=`${t}__${Dt.previewCoordinate}`,n=this.formats.filter(p=>p.hasDisplayProperties),s=this._findSettingsFormat(),o=n.indexOf(s),a=this._renderOptions(n,!0,o),l=s.get("currentPattern"),{messages:c,messagesCommon:u,headingLevel:d}=this;return Ae("div",{"aria-labelledby":r,class:Dt.settings,key:"esri-coordinate-conversion__settings"},Ae("div",{class:Dt.sectionHeading},Ae("div",{bind:this,class:this.classes(Dt.widgetButton,Dt.backButton),onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,role:"button",tabindex:"0",title:u.back},this._renderBackIcon()),Ae(lL,{level:d,class:Dt.header,id:r},c.settingsTitle)),Ae("div",{class:Dt.settingsFormGroup},Ae("label",{for:e},c.changeCoordinateDisplay),Ae("select",{"aria-label":c.selectFormat,class:Dt.esriSelect,bind:this,onchange:this._setSettingsFormat,title:c.selectFormat},a),Ae("div",{class:Dt.settingsFormGroupHorizontal},Ae("input",{"aria-controls":i,bind:this,class:this.classes(Dt.patternInput,Dt.input),id:e,oninput:this._updateCurrentPattern,spellcheck:!1,title:c.changeCoordinateDisplay,type:"text",value:l}),Ae("div",{"aria-controls":e,bind:this,class:Dt.widgetButton,onclick:this._setDefaultPattern,onkeydown:this._setDefaultPattern,role:"button",tabindex:"0",title:c.defaultPattern},Ae("span",{"aria-hidden":"true",class:Dt.refresh})))),Ae("div",{class:Dt.settingsFormGroup},Ae("label",null,u.preview,Ae("div",{class:Dt.previewCoordinate,id:i,tabindex:"0"},this._previewConversion.displayCoordinate))))}_renderBackIcon(){return Ae("span",{"aria-hidden":"true",class:pm(this.container)?Dt.rightArrow:Dt.leftArrow})}_renderTools(t,e,r){const i=e.displayCoordinate&&this.mode==="capture"?this._renderCopyButton(e):null,{messages:n}=this;return Ae("ul",{class:Dt.toolDisplay,role:"listitem"},i,Ae("li",{"aria-controls":r,"aria-label":n.removeConversion,bind:this,class:this.classes(Dt.widgetButton,Dt.rowButton),"data-index":t,key:`${r}__${Dt.widgetButton}`,onclick:this._removeConversion,onkeydown:this._removeConversion,tabindex:"0",role:"button",title:n.removeConversion},Ae("span",{"aria-hidden":"true",class:Dt.removeConversion})))}_copyCoordinateOutput(t){const e=t.target;if(!("createTextRange"in document.body)){const r=window.getSelection(),i=document.createRange();i.selectNodeContents(e),r.removeAllRanges(),r.addRange(i)}document.execCommand("copy")}_removeConversion(t){const e=t.currentTarget["data-index"];this.conversions.removeAt(e)}_setDefaultPattern(t){t.stopPropagation();const e=this._findSettingsFormat();e&&(e.currentPattern=e.get("defaultPattern"))}_toggleExpand(){this._expanded=!this._expanded}_toggleInputVisibility(){this._inputVisible=!this._inputVisible,this._popupVisible&&this._hidePopup(),this._inputVisible?this.viewModel.pause():this.viewModel.resume()}_toggleMode(){this.mode=this.mode==="live"?"capture":"live"}_toggleSettingsVisibility(){this._settingsVisible=!this._settingsVisible,this._popupVisible&&this._hidePopup(),this._settingsVisible?(this._setPreviewConversion(),this.viewModel.pause()):this.viewModel.resume()}};h([f()],Is.prototype,"conversions",null),h([f()],Is.prototype,"currentLocation",null),h([f()],Is.prototype,"formats",null),h([f()],Is.prototype,"goToOverride",null),h([f()],Is.prototype,"headingLevel",void 0),h([f()],Is.prototype,"label",null),h([f(),tc("esri/widgets/CoordinateConversion/t9n/CoordinateConversion")],Is.prototype,"messages",void 0),h([f(),tc("esri/t9n/common")],Is.prototype,"messagesCommon",void 0),h([f()],Is.prototype,"mode",null),h([f()],Is.prototype,"orientation",void 0),h([f()],Is.prototype,"multipleConversions",null),h([f()],Is.prototype,"locationSymbol",null),h([f()],Is.prototype,"storageEnabled",null),h([f()],Is.prototype,"storageType",null),h([f()],Is.prototype,"view",null),h([f({type:sGe})],Is.prototype,"viewModel",void 0),h([f()],Is.prototype,"visibleElements",void 0),h([Wr("visibleElements")],Is.prototype,"castVisibleElements",null),h([vl()],Is.prototype,"_copyCoordinateOutput",null),h([vl()],Is.prototype,"_removeConversion",null),h([vl()],Is.prototype,"_setDefaultPattern",null),h([vl()],Is.prototype,"_toggleExpand",null),h([vl()],Is.prototype,"_toggleInputVisibility",null),h([vl()],Is.prototype,"_toggleMode",null),h([vl()],Is.prototype,"_toggleSettingsVisibility",null),Is=h([Q("esri.widgets.CoordinateConversion")],Is);const jjt=Is;var H2=function(t){t=t||{};var e=typeof t<"u"?t:{},r={},i;for(i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);var n="";function s($e){return e.locateFile?e.locateFile($e,n):n+$e}var o;typeof document<"u"&&document.currentScript&&(n=document.currentScript.src),n.indexOf("blob:")!==0?n=n.substr(0,n.lastIndexOf("/")+1):n="",o=function(qe,ft,et){var y=new XMLHttpRequest;y.open("GET",qe,!0),y.responseType="arraybuffer",y.onload=function(){if(y.status==200||y.status==0&&y.response){ft(y.response);return}var Ri=dn(qe);if(Ri){ft(Ri.buffer);return}et()},y.onerror=et,y.send(null)};var a=e.print||console.log.bind(console),l=e.printErr||console.warn.bind(console);for(i in r)r.hasOwnProperty(i)&&(e[i]=r[i]);r=null,e.arguments&&e.arguments;var c=0,u=function($e){c=$e},d=function(){return c},p=8;function A($e,qe,ft,et){switch(ft=ft||"i8",ft.charAt(ft.length-1)==="*"&&(ft="i32"),ft){case"i1":ee[$e>>0]=qe;break;case"i8":ee[$e>>0]=qe;break;case"i16":ue[$e>>1]=qe;break;case"i32":re[$e>>2]=qe;break;case"i64":Bt=[qe>>>0,(bt=qe,+It(bt)>=1?bt>0?(er(+qt(bt/4294967296),4294967295)|0)>>>0:~~+lt((bt-+(~~bt>>>0))/4294967296)>>>0:0)],re[$e>>2]=Bt[0],re[$e+4>>2]=Bt[1];break;case"float":te[$e>>2]=qe;break;case"double":j[$e>>3]=qe;break;default:Li("invalid type for setValue: "+ft)}}function v($e,qe,ft){switch(qe=qe||"i8",qe.charAt(qe.length-1)==="*"&&(qe="i32"),qe){case"i1":return ee[$e>>0];case"i8":return ee[$e>>0];case"i16":return ue[$e>>1];case"i32":return re[$e>>2];case"i64":return re[$e>>2];case"float":return te[$e>>2];case"double":return j[$e>>3];default:Li("invalid type for getValue: "+qe)}return null}var b=!1;function S($e,qe){$e||Li("Assertion failed: "+qe)}function E($e){var qe=e["_"+$e];return S(qe,"Cannot call unknown function "+$e+", make sure it is exported"),qe}function R($e,qe,ft,et,y){var ie={string:function(Nr){var Aa=0;if(Nr!=null&&Nr!==0){var xd=(Nr.length<<2)+1;Aa=Do(xd),U(Nr,Aa,xd)}return Aa},array:function(Nr){var Aa=Do(Nr.length);return q(Nr,Aa),Aa}};function Ri(Nr){return qe==="string"?L(Nr):qe==="boolean"?!!Nr:Nr}var Mn=E($e),Rn=[],Yr=0;if(et)for(var wi=0;wi<et.length;wi++){var Tr=ie[ft[wi]];Tr?(Yr===0&&(Yr=Zn()),Rn[wi]=Tr(et[wi])):Rn[wi]=et[wi]}var _n=Mn.apply(null,Rn);return _n=Ri(_n),Yr!==0&&Rs(Yr),_n}function O($e,qe,ft,et){ft=ft||[];var y=ft.every(function(Ri){return Ri==="number"}),ie=qe!=="string";return ie&&y&&!et?E($e):function(){return R($e,qe,ft,arguments)}}var I=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function N($e,qe,ft){for(var et=qe+ft,y=qe;$e[y]&&!(y>=et);)++y;if(y-qe>16&&$e.subarray&&I)return I.decode($e.subarray(qe,y));for(var ie="";qe<y;){var Ri=$e[qe++];if(!(Ri&128)){ie+=String.fromCharCode(Ri);continue}var Mn=$e[qe++]&63;if((Ri&224)==192){ie+=String.fromCharCode((Ri&31)<<6|Mn);continue}var Rn=$e[qe++]&63;if((Ri&240)==224?Ri=(Ri&15)<<12|Mn<<6|Rn:Ri=(Ri&7)<<18|Mn<<12|Rn<<6|$e[qe++]&63,Ri<65536)ie+=String.fromCharCode(Ri);else{var Yr=Ri-65536;ie+=String.fromCharCode(55296|Yr>>10,56320|Yr&1023)}}return ie}function L($e,qe){return $e?N(se,$e,qe):""}function B($e,qe,ft,et){if(!(et>0))return 0;for(var y=ft,ie=ft+et-1,Ri=0;Ri<$e.length;++Ri){var Mn=$e.charCodeAt(Ri);if(Mn>=55296&&Mn<=57343){var Rn=$e.charCodeAt(++Ri);Mn=65536+((Mn&1023)<<10)|Rn&1023}if(Mn<=127){if(ft>=ie)break;qe[ft++]=Mn}else if(Mn<=2047){if(ft+1>=ie)break;qe[ft++]=192|Mn>>6,qe[ft++]=128|Mn&63}else if(Mn<=65535){if(ft+2>=ie)break;qe[ft++]=224|Mn>>12,qe[ft++]=128|Mn>>6&63,qe[ft++]=128|Mn&63}else{if(ft+3>=ie)break;qe[ft++]=240|Mn>>18,qe[ft++]=128|Mn>>12&63,qe[ft++]=128|Mn>>6&63,qe[ft++]=128|Mn&63}}return qe[ft]=0,ft-y}function U($e,qe,ft){return B($e,se,qe,ft)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function q($e,qe){ee.set($e,qe)}function Z($e,qe){return $e%qe>0&&($e+=qe-$e%qe),$e}var X,ee,se,ue,re,te,j;function H($e){X=$e,e.HEAP8=ee=new Int8Array($e),e.HEAP16=ue=new Int16Array($e),e.HEAP32=re=new Int32Array($e),e.HEAPU8=se=new Uint8Array($e),e.HEAPU16=new Uint16Array($e),e.HEAPU32=new Uint32Array($e),e.HEAPF32=te=new Float32Array($e),e.HEAPF64=j=new Float64Array($e)}var W=5267040,oe=24128,le=e.TOTAL_MEMORY||33554432;e.buffer?X=e.buffer:X=new ArrayBuffer(le),le=X.byteLength,H(X),re[oe>>2]=W;function fe($e){for(;$e.length>0;){var qe=$e.shift();if(typeof qe=="function"){qe();continue}var ft=qe.func;typeof ft=="number"?qe.arg===void 0?e.dynCall_v(ft):e.dynCall_vi(ft,qe.arg):ft(qe.arg===void 0?null:qe.arg)}}var de=[],Ee=[],Ie=[],Ge=[];function Ke(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)Xe(e.preRun.shift());fe(de)}function vt(){fe(Ee)}function ke(){fe(Ie)}function Ne(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Se(e.postRun.shift());fe(Ge)}function Xe($e){de.unshift($e)}function Se($e){Ge.unshift($e)}var It=Math.abs,lt=Math.ceil,qt=Math.floor,er=Math.min,rr=0,vr=null;function ri($e){rr++,e.monitorRunDependencies&&e.monitorRunDependencies(rr)}function Wi($e){if(rr--,e.monitorRunDependencies&&e.monitorRunDependencies(rr),rr==0&&vr){var qe=vr;vr=null,qe()}}e.preloadedImages={},e.preloadedAudios={};var Lr=null,ii="data:application/octet-stream;base64,";function Ut($e){return String.prototype.startsWith?$e.startsWith(ii):$e.indexOf(ii)===0}var bt,Bt;Lr="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var Wt=24144;function sr($e){return $e}function Ir($e){var qe=/\b__Z[\w\d_]+/g;return $e.replace(qe,function(ft){var et=ft;return ft===et?ft:et+" ["+ft+"]"})}function vi(){var $e=new Error;if(!$e.stack){try{throw new Error(0)}catch(qe){$e=qe}if(!$e.stack)return"(no stack trace available)"}return $e.stack.toString()}function xi(){var $e=vi();return e.extraStackTrace&&($e+=`
`+e.extraStackTrace()),Ir($e)}function Ti($e,qe,ft,et){Li("Assertion failed: "+L($e)+", at: "+[qe?L(qe):"unknown filename",ft,et?L(et):"unknown function"])}function bi(){return ee.length}function Cn($e,qe,ft){se.set(se.subarray(qe,qe+ft),$e)}function Ur($e){return e.___errno_location&&(re[e.___errno_location()>>2]=$e),$e}function ai($e){Li("OOM")}function Qr($e){try{var qe=new ArrayBuffer($e);return qe.byteLength!=$e?void 0:(new Int8Array(qe).set(ee),ma(qe),H(qe),1)}catch{}}function Ms($e){var qe=bi(),ft=16777216,et=2147483648-ft;if($e>et)return!1;for(var y=16777216,ie=Math.max(qe,y);ie<$e;)ie<=536870912?ie=Z(2*ie,ft):ie=Math.min(Z((3*ie+2147483648)/4,ft),et);var Ri=Qr(ie);return!!Ri}var un=typeof atob=="function"?atob:function($e){var qe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ft="",et,y,ie,Ri,Mn,Rn,Yr,wi=0;$e=$e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Ri=qe.indexOf($e.charAt(wi++)),Mn=qe.indexOf($e.charAt(wi++)),Rn=qe.indexOf($e.charAt(wi++)),Yr=qe.indexOf($e.charAt(wi++)),et=Ri<<2|Mn>>4,y=(Mn&15)<<4|Rn>>2,ie=(Rn&3)<<6|Yr,ft=ft+String.fromCharCode(et),Rn!==64&&(ft=ft+String.fromCharCode(y)),Yr!==64&&(ft=ft+String.fromCharCode(ie));while(wi<$e.length);return ft};function Xn($e){try{for(var qe=un($e),ft=new Uint8Array(qe.length),et=0;et<qe.length;++et)ft[et]=qe.charCodeAt(et);return ft}catch{throw new Error("Converting base64 string to bytes failed.")}}function dn($e){if(Ut($e))return Xn($e.slice(ii.length))}var Gn={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},ms={a:Li,b:u,c:d,d:Ti,e:Ur,f:bi,g:Cn,h:Ms,i:ai,j:sr,k:Ir,l:Qr,m:vi,n:xi,o:Wt,p:oe},tt=function($e,qe,ft){var et=new $e.Int8Array(ft),y=new $e.Int32Array(ft);new $e.Uint8Array(ft),new $e.Float32Array(ft);var ie=new $e.Float64Array(ft),Ri=qe.o|0,Mn=qe.p|0,Rn=$e.Math.floor,Yr=$e.Math.abs,wi=$e.Math.sqrt,Tr=$e.Math.pow,_n=$e.Math.cos,Nr=$e.Math.sin,Aa=$e.Math.tan,xd=$e.Math.acos,Na=$e.Math.asin,Uc=$e.Math.atan,ho=$e.Math.atan2,Oi=$e.Math.ceil,ya=$e.Math.imul,Td=$e.Math.min,k1=$e.Math.max,Cu=$e.Math.clz32,Xr=qe.b,he=qe.c,Sr=qe.d,Ll=qe.e,DE=qe.f,gw=qe.g,me=qe.h,We=qe.i,Y=24160;function Zr(g){return et=new Int8Array(g),y=new Int32Array(g),ie=new Float64Array(g),ft=g,!0}function Wo(g){g=g|0;var m=0;return m=Y,Y=Y+g|0,Y=Y+15&-16,m|0}function Os(){return Y|0}function oc(g){g=g|0,Y=g}function Xm(g,m){g=g|0,Y=g}function IF(g,m){g=g|0,m=m|0;var _=0,w=0,T=0;return(g|0)<0?(m=2,m|0):(g|0)>13780509?(m=Tq(15,m)|0,m|0):(_=((g|0)<0)<<31>>31,T=Vc(g|0,_|0,3,0)|0,w=he()|0,_=Qi(g|0,_|0,1,0)|0,_=Vc(T|0,w|0,_|0,he()|0)|0,_=Qi(_|0,he()|0,1,0)|0,g=he()|0,y[m>>2]=_,y[m+4>>2]=g,m=0,m|0)}function FP(g,m,_,w){return g=g|0,m=m|0,_=_|0,w=w|0,kP(g,m,_,w,0)|0}function kP(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0,V=0;if(F=Y,Y=Y+16|0,P=F,!(LE(g,m,_,w,T)|0))return w=0,Y=F,w|0;do if((_|0)>=0){if((_|0)>13780509){if(C=Tq(15,P)|0,C|0)break;$=P,P=y[$>>2]|0,$=y[$+4>>2]|0}else C=((_|0)<0)<<31>>31,V=Vc(_|0,C|0,3,0)|0,$=he()|0,C=Qi(_|0,C|0,1,0)|0,C=Vc(V|0,$|0,C|0,he()|0)|0,C=Qi(C|0,he()|0,1,0)|0,$=he()|0,y[P>>2]=C,y[P+4>>2]=$,P=C;if(ww(w|0,0,P<<3|0)|0,T|0){ww(T|0,0,P<<2|0)|0,C=uy(g,m,_,w,T,P,$,0)|0;break}C=Jm(P,4)|0,C?(V=uy(g,m,_,w,C,P,$,0)|0,li(C),C=V):C=13}else C=2;while(0);return V=C,Y=F,V|0}function LE(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0;if(Re=Y,Y=Y+16|0,ve=Re,ge=Re+8|0,_e=ve,y[_e>>2]=g,y[_e+4>>2]=m,(_|0)<0)return ge=2,Y=Re,ge|0;if(C=w,y[C>>2]=g,y[C+4>>2]=m,C=(T|0)!=0,C&&(y[T>>2]=0),Js(g,m)|0)return ge=9,Y=Re,ge|0;y[ge>>2]=0;e:do if((_|0)>=1)if(C)for(J=1,V=0,ce=0,_e=1,C=g;;){if(!(V|ce)){if(C=Nl(C,m,4,ge,ve)|0,C|0)break e;if(m=ve,C=y[m>>2]|0,m=y[m+4>>2]|0,Js(C,m)|0){C=9;break e}}if(C=Nl(C,m,y[22384+(ce<<2)>>2]|0,ge,ve)|0,C|0)break e;if(m=ve,C=y[m>>2]|0,m=y[m+4>>2]|0,g=w+(J<<3)|0,y[g>>2]=C,y[g+4>>2]=m,y[T+(J<<2)>>2]=_e,g=V+1|0,P=(g|0)==(_e|0),$=ce+1|0,F=($|0)==6,Js(C,m)|0){C=9;break e}if(_e=_e+(F&P&1)|0,(_e|0)>(_|0)){C=0;break}else J=J+1|0,V=P?0:g,ce=P?F?0:$:ce}else for(J=1,V=0,ce=0,_e=1,C=g;;){if(!(V|ce)){if(C=Nl(C,m,4,ge,ve)|0,C|0)break e;if(m=ve,C=y[m>>2]|0,m=y[m+4>>2]|0,Js(C,m)|0){C=9;break e}}if(C=Nl(C,m,y[22384+(ce<<2)>>2]|0,ge,ve)|0,C|0)break e;if(m=ve,C=y[m>>2]|0,m=y[m+4>>2]|0,g=w+(J<<3)|0,y[g>>2]=C,y[g+4>>2]=m,g=V+1|0,P=(g|0)==(_e|0),$=ce+1|0,F=($|0)==6,Js(C,m)|0){C=9;break e}if(_e=_e+(F&P&1)|0,(_e|0)>(_|0)){C=0;break}else J=J+1|0,V=P?0:g,ce=P?F?0:$:ce}else C=0;while(0);return ge=C,Y=Re,ge|0}function uy(g,m,_,w,T,C,P,$){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0,C=C|0,P=P|0,$=$|0;var F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0;if(Re=Y,Y=Y+16|0,ve=Re+8|0,ge=Re,F=UE(g|0,m|0,C|0,P|0)|0,J=he()|0,ce=w+(F<<3)|0,Ze=ce,je=y[Ze>>2]|0,Ze=y[Ze+4>>2]|0,V=(je|0)==(g|0)&(Ze|0)==(m|0),!((je|0)==0&(Ze|0)==0|V))do F=Qi(F|0,J|0,1,0)|0,F=kF(F|0,he()|0,C|0,P|0)|0,J=he()|0,ce=w+(F<<3)|0,je=ce,Ze=y[je>>2]|0,je=y[je+4>>2]|0,V=(Ze|0)==(g|0)&(je|0)==(m|0);while(!((Ze|0)==0&(je|0)==0|V));if(F=T+(F<<2)|0,V&&(y[F>>2]|0)<=($|0)||(je=ce,y[je>>2]=g,y[je+4>>2]=m,y[F>>2]=$,($|0)>=(_|0)))return je=0,Y=Re,je|0;switch(V=$+1|0,y[ve>>2]=0,F=Nl(g,m,2,ve,ge)|0,F|0){case 9:{_e=9;break}case 0:{F=ge,F=uy(y[F>>2]|0,y[F+4>>2]|0,_,w,T,C,P,V)|0,F||(_e=9);break}}e:do if((_e|0)==9){switch(y[ve>>2]=0,F=Nl(g,m,3,ve,ge)|0,F|0){case 9:break;case 0:{if(F=ge,F=uy(y[F>>2]|0,y[F+4>>2]|0,_,w,T,C,P,V)|0,F|0)break e;break}default:break e}switch(y[ve>>2]=0,F=Nl(g,m,1,ve,ge)|0,F|0){case 9:break;case 0:{if(F=ge,F=uy(y[F>>2]|0,y[F+4>>2]|0,_,w,T,C,P,V)|0,F|0)break e;break}default:break e}switch(y[ve>>2]=0,F=Nl(g,m,5,ve,ge)|0,F|0){case 9:break;case 0:{if(F=ge,F=uy(y[F>>2]|0,y[F+4>>2]|0,_,w,T,C,P,V)|0,F|0)break e;break}default:break e}switch(y[ve>>2]=0,F=Nl(g,m,4,ve,ge)|0,F|0){case 9:break;case 0:{if(F=ge,F=uy(y[F>>2]|0,y[F+4>>2]|0,_,w,T,C,P,V)|0,F|0)break e;break}default:break e}switch(y[ve>>2]=0,F=Nl(g,m,6,ve,ge)|0,F|0){case 9:break;case 0:{if(F=ge,F=uy(y[F>>2]|0,y[F+4>>2]|0,_,w,T,C,P,V)|0,F|0)break e;break}default:break e}return je=0,Y=Re,je|0}while(0);return je=F,Y=Re,je|0}function Nl(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0;if(_>>>0>6)return T=1,T|0;if(ce=(y[w>>2]|0)%6|0,y[w>>2]=ce,(ce|0)>0){C=0;do _=_w(_)|0,C=C+1|0;while((C|0)<(y[w>>2]|0))}if(ce=dt(g|0,m|0,45)|0,he()|0,J=ce&127,J>>>0>121)return T=5,T|0;F=wh(g,m)|0,C=dt(g|0,m|0,52)|0,he()|0,C=C&15;e:do if(!C)V=8;else{for(;;){if(P=(15-C|0)*3|0,$=dt(g|0,m|0,P|0)|0,he()|0,$=$&7,($|0)==7){m=5;break}if(ge=(Pp(C)|0)==0,C=C+-1|0,_e=Mt(7,0,P|0)|0,m=m&~(he()|0),ve=Mt(y[(ge?432:16)+($*28|0)+(_<<2)>>2]|0,0,P|0)|0,P=he()|0,_=y[(ge?640:224)+($*28|0)+(_<<2)>>2]|0,g=ve|g&~_e,m=P|m,!_){_=0;break e}if(!C){V=8;break e}}return m|0}while(0);(V|0)==8&&(ge=y[848+(J*28|0)+(_<<2)>>2]|0,ve=Mt(ge|0,0,45)|0,g=ve|g,m=he()|0|m&-1040385,_=y[4272+(J*28|0)+(_<<2)>>2]|0,(ge&127|0)==127&&(ge=Mt(y[848+(J*28|0)+20>>2]|0,0,45)|0,m=he()|0|m&-1040385,_=y[4272+(J*28|0)+20>>2]|0,g=vw(ge|g,m)|0,m=he()|0,y[w>>2]=(y[w>>2]|0)+1)),$=dt(g|0,m|0,45)|0,he()|0,$=$&127;e:do if(Zs($)|0){t:do if((wh(g,m)|0)==1){if((J|0)!=($|0))if(bfe($,y[7696+(J*28|0)>>2]|0)|0){g=bq(g,m)|0,P=1,m=he()|0;break}else Sr(23313,22416,436,22424);switch(F|0){case 3:{g=vw(g,m)|0,m=he()|0,y[w>>2]=(y[w>>2]|0)+1,P=0;break t}case 5:{g=bq(g,m)|0,m=he()|0,y[w>>2]=(y[w>>2]|0)+5,P=0;break t}case 0:return ge=9,ge|0;default:return ge=1,ge|0}}else P=0;while(0);if((_|0)>0){C=0;do g=vq(g,m)|0,m=he()|0,C=C+1|0;while((C|0)!=(_|0))}if((J|0)!=($|0)){if(!(hq($)|0)){if((P|0)!=0|(wh(g,m)|0)!=5)break;y[w>>2]=(y[w>>2]|0)+1;break}switch(ce&127){case 8:case 118:break e}(wh(g,m)|0)!=3&&(y[w>>2]=(y[w>>2]|0)+1)}}else if((_|0)>0){C=0;do g=vw(g,m)|0,m=he()|0,C=C+1|0;while((C|0)!=(_|0))}while(0);return y[w>>2]=((y[w>>2]|0)+_|0)%6|0,ge=T,y[ge>>2]=g,y[ge+4>>2]=m,ge=0,ge|0}function uq(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0,V=0;for($=Y,Y=Y+16|0,C=$,P=$+8|0,T=(Js(g,m)|0)==0,T=T?1:2;;){if(y[P>>2]=0,V=(Nl(g,m,T,P,C)|0)==0,F=C,V&((y[F>>2]|0)==(_|0)?(y[F+4>>2]|0)==(w|0):0)){g=4;break}if(T=T+1|0,T>>>0>=7){T=7,g=4;break}}return(g|0)==4?(Y=$,T|0):0}function TQe(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0;if(ge=Y,Y=Y+16|0,_e=ge,ve=ge+8|0,ce=_e,y[ce>>2]=g,y[ce+4>>2]=m,!_)return ve=w,y[ve>>2]=g,y[ve+4>>2]=m,ve=0,Y=ge,ve|0;y[ve>>2]=0;e:do if(Js(g,m)|0)g=9;else{if(C=(_|0)>0,C){T=0,ce=g;do{if(g=Nl(ce,m,4,ve,_e)|0,g|0)break e;if(m=_e,ce=y[m>>2]|0,m=y[m+4>>2]|0,T=T+1|0,Js(ce,m)|0){g=9;break e}}while((T|0)<(_|0));if(J=w,y[J>>2]=ce,y[J+4>>2]=m,J=_+-1|0,C){V=0,g=1;do{if(T=22384+(V<<2)|0,(V|0)==5)for(P=y[T>>2]|0,C=0,T=g;;){if(g=_e,g=Nl(y[g>>2]|0,y[g+4>>2]|0,P,ve,_e)|0,g|0)break e;if((C|0)!=(J|0))if(F=_e,$=y[F>>2]|0,F=y[F+4>>2]|0,g=w+(T<<3)|0,y[g>>2]=$,y[g+4>>2]=F,!(Js($,F)|0))g=T+1|0;else{g=9;break e}else g=T;if(C=C+1|0,(C|0)>=(_|0))break;T=g}else for(P=_e,F=y[T>>2]|0,$=0,T=g,C=y[P>>2]|0,P=y[P+4>>2]|0;;){if(g=Nl(C,P,F,ve,_e)|0,g|0)break e;if(P=_e,C=y[P>>2]|0,P=y[P+4>>2]|0,g=w+(T<<3)|0,y[g>>2]=C,y[g+4>>2]=P,g=T+1|0,Js(C,P)|0){g=9;break e}if($=$+1|0,($|0)>=(_|0))break;T=g}V=V+1|0}while(V>>>0<6);g=_e,P=ce,T=y[g>>2]|0,C=m,g=y[g+4>>2]|0}else P=ce,T=ce,C=m,g=m}else P=w,y[P>>2]=g,y[P+4>>2]=m,P=g,T=g,C=m,g=m;g=(P|0)==(T|0)&(C|0)==(g|0)?0:9}while(0);return ve=g,Y=ge,ve|0}function SQe(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0,V=0;if($=Y,Y=Y+48|0,T=$+16|0,C=$+8|0,P=$,_|0)return P=15,Y=$,P|0;if(V=g,F=y[V+4>>2]|0,_=C,y[_>>2]=y[V>>2],y[_+4>>2]=F,jfe(C,T),m=Tfe(T,m,P)|0,!m){if(_=y[C>>2]|0,C=y[g+8>>2]|0,(C|0)>0){T=y[g+12>>2]|0,m=0;do _=(y[T+(m<<3)>>2]|0)+_|0,m=m+1|0;while((m|0)<(C|0))}m=P,T=y[m>>2]|0,m=y[m+4>>2]|0,C=((_|0)<0)<<31>>31,(m|0)<(C|0)|(m|0)==(C|0)&T>>>0<_>>>0?(m=P,y[m>>2]=_,y[m+4>>2]=C,m=C):_=T,F=Qi(_|0,m|0,12,0)|0,V=he()|0,m=P,y[m>>2]=F,y[m+4>>2]=V,m=w,y[m>>2]=F,y[m+4>>2]=V,m=0}return V=m,Y=$,V|0}function _fe(g,m,_,w,T,C,P){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0,C=C|0,P=P|0;var $=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0,Be=0,Me=0,Lt=0,Zt=0,Tt=0,Nt=0,Jn=0,vn=0,On=0,Si=0,_i=0,Ei=0,As=0,ci=0,Us=0,Ru=0,t0e=0;if(As=Y,Y=Y+64|0,On=As+48|0,Si=As+32|0,_i=As+24|0,Lt=As+8|0,Zt=As,F=y[g>>2]|0,(F|0)<=0)return Ei=0,Y=As,Ei|0;for(Tt=g+4|0,Nt=On+8|0,Jn=Si+8|0,vn=Lt+8|0,$=0,Be=0;;){V=y[Tt>>2]|0,Ue=V+(Be<<4)|0,y[On>>2]=y[Ue>>2],y[On+4>>2]=y[Ue+4>>2],y[On+8>>2]=y[Ue+8>>2],y[On+12>>2]=y[Ue+12>>2],(Be|0)==(F+-1|0)?(y[Si>>2]=y[V>>2],y[Si+4>>2]=y[V+4>>2],y[Si+8>>2]=y[V+8>>2],y[Si+12>>2]=y[V+12>>2]):(Ue=V+(Be+1<<4)|0,y[Si>>2]=y[Ue>>2],y[Si+4>>2]=y[Ue+4>>2],y[Si+8>>2]=y[Ue+8>>2],y[Si+12>>2]=y[Ue+12>>2]),F=DQe(On,Si,w,_i)|0;e:do if(F)V=0,$=F;else if(V=_i,F=y[V>>2]|0,V=y[V+4>>2]|0,(V|0)>0|(V|0)==0&F>>>0>0){je=0,Ue=0;t:for(;;){if(t0e=+ie[On>>3],Ze=zc(F|0,V|0,je|0,Ue|0)|0,Ru=+(Ze>>>0)+4294967296*+(he()|0),ci=+(F>>>0)+4294967296*+(V|0),Us=+(je>>>0)+4294967296*+(Ue|0),ie[Lt>>3]=t0e*Ru/ci+ +ie[Si>>3]*Us/ci,ie[vn>>3]=+ie[Nt>>3]*Ru/ci+ +ie[Jn>>3]*Us/ci,F=Lfe(Lt,w,Zt)|0,F|0){$=F;break}Ze=Zt,Re=y[Ze>>2]|0,Ze=y[Ze+4>>2]|0,_e=UE(Re|0,Ze|0,m|0,_|0)|0,J=he()|0,F=P+(_e<<3)|0,ce=F,V=y[ce>>2]|0,ce=y[ce+4>>2]|0;r:do if((V|0)==0&(ce|0)==0)Me=F,Ei=16;else for(ve=0,ge=0;;){if((ve|0)>(_|0)|(ve|0)==(_|0)&ge>>>0>m>>>0){$=1;break t}if((V|0)==(Re|0)&(ce|0)==(Ze|0))break r;if(F=Qi(_e|0,J|0,1,0)|0,_e=kF(F|0,he()|0,m|0,_|0)|0,J=he()|0,ge=Qi(ge|0,ve|0,1,0)|0,ve=he()|0,F=P+(_e<<3)|0,ce=F,V=y[ce>>2]|0,ce=y[ce+4>>2]|0,(V|0)==0&(ce|0)==0){Me=F,Ei=16;break}}while(0);if((Ei|0)==16&&(Ei=0,!((Re|0)==0&(Ze|0)==0))&&(ge=Me,y[ge>>2]=Re,y[ge+4>>2]=Ze,ge=C+(y[T>>2]<<3)|0,y[ge>>2]=Re,y[ge+4>>2]=Ze,ge=T,ge=Qi(y[ge>>2]|0,y[ge+4>>2]|0,1,0)|0,Re=he()|0,Ze=T,y[Ze>>2]=ge,y[Ze+4>>2]=Re),je=Qi(je|0,Ue|0,1,0)|0,Ue=he()|0,V=_i,F=y[V>>2]|0,V=y[V+4>>2]|0,!((V|0)>(Ue|0)|(V|0)==(Ue|0)&F>>>0>je>>>0)){V=1;break e}}V=0}else V=1;while(0);if(Be=Be+1|0,!V){Ei=21;break}if(F=y[g>>2]|0,(Be|0)>=(F|0)){$=0,Ei=21;break}}return(Ei|0)==21?(Y=As,$|0):0}function EQe(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0,Be=0,Me=0,Lt=0,Zt=0,Tt=0,Nt=0,Jn=0,vn=0,On=0,Si=0,_i=0,Ei=0,As=0,ci=0,Us=0,Ru=0;if(Ru=Y,Y=Y+112|0,Ei=Ru+80|0,F=Ru+72|0,As=Ru,ci=Ru+56|0,_|0)return Us=15,Y=Ru,Us|0;if(V=g+8|0,Us=Zm((y[V>>2]<<5)+32|0)|0,!Us)return Us=13,Y=Ru,Us|0;if(NYe(g,Us),Si=g,_i=y[Si+4>>2]|0,_=F,y[_>>2]=y[Si>>2],y[_+4>>2]=_i,jfe(F,Ei),_=Tfe(Ei,m,As)|0,_)Si=0,_i=0;else{if(_=y[F>>2]|0,C=y[V>>2]|0,(C|0)>0){P=y[g+12>>2]|0,T=0;do _=(y[P+(T<<3)>>2]|0)+_|0,T=T+1|0;while((T|0)!=(C|0));T=_}else T=_;_=As,C=y[_>>2]|0,_=y[_+4>>2]|0,P=((T|0)<0)<<31>>31,(_|0)<(P|0)|(_|0)==(P|0)&C>>>0<T>>>0?(_=As,y[_>>2]=T,y[_+4>>2]=P,_=P):T=C,Si=Qi(T|0,_|0,12,0)|0,_i=he()|0,_=As,y[_>>2]=Si,y[_+4>>2]=_i,_=0}if(_|0)return li(Us),Us=_,Y=Ru,Us|0;if(T=Jm(Si,8)|0,!T)return li(Us),Us=13,Y=Ru,Us|0;if($=Jm(Si,8)|0,!$)return li(Us),li(T),Us=13,Y=Ru,Us|0;vn=Ei,y[vn>>2]=0,y[vn+4>>2]=0,vn=g,On=y[vn+4>>2]|0,_=F,y[_>>2]=y[vn>>2],y[_+4>>2]=On,_=_fe(F,Si,_i,m,Ei,T,$)|0;e:do if(_)li(T),li($),li(Us);else{t:do if((y[V>>2]|0)>0){for(P=g+12|0,C=0;_=_fe((y[P>>2]|0)+(C<<3)|0,Si,_i,m,Ei,T,$)|0,C=C+1|0,!(_|0);)if((C|0)>=(y[V>>2]|0))break t;li(T),li($),li(Us);break e}while(0);(_i|0)>0|(_i|0)==0&Si>>>0>0&&ww($|0,0,Si<<3|0)|0,On=Ei,vn=y[On+4>>2]|0;t:do if((vn|0)>0|(vn|0)==0&(y[On>>2]|0)>>>0>0){Tt=T,Nt=$,Jn=T,vn=$,On=T,_=T,Me=T,Lt=$,Zt=$,T=$;r:for(;;){for(Ze=0,je=0,Ue=0,Be=0,C=0,P=0;;){$=As,F=$+56|0;do y[$>>2]=0,$=$+4|0;while(($|0)<(F|0));if(m=Tt+(Ze<<3)|0,V=y[m>>2]|0,m=y[m+4>>2]|0,LE(V,m,1,As,0)|0){$=As,F=$+56|0;do y[$>>2]=0,$=$+4|0;while(($|0)<(F|0));$=Jm(7,4)|0,$|0&&(uy(V,m,1,As,$,7,0,0)|0,li($))}for(Re=0;;){ge=As+(Re<<3)|0,ve=y[ge>>2]|0,ge=y[ge+4>>2]|0;i:do if((ve|0)==0&(ge|0)==0)$=C,F=P;else{if(J=UE(ve|0,ge|0,Si|0,_i|0)|0,V=he()|0,$=w+(J<<3)|0,m=$,F=y[m>>2]|0,m=y[m+4>>2]|0,!((F|0)==0&(m|0)==0)){ce=0,_e=0;do{if((ce|0)>(_i|0)|(ce|0)==(_i|0)&_e>>>0>Si>>>0)break r;if((F|0)==(ve|0)&(m|0)==(ge|0)){$=C,F=P;break i}$=Qi(J|0,V|0,1,0)|0,J=kF($|0,he()|0,Si|0,_i|0)|0,V=he()|0,_e=Qi(_e|0,ce|0,1,0)|0,ce=he()|0,$=w+(J<<3)|0,m=$,F=y[m>>2]|0,m=y[m+4>>2]|0}while(!((F|0)==0&(m|0)==0))}(ve|0)==0&(ge|0)==0?($=C,F=P):(BP(ve,ge,ci)|0,FYe(g,Us,ci)|0&&(_e=Qi(C|0,P|0,1,0)|0,P=he()|0,ce=$,y[ce>>2]=ve,y[ce+4>>2]=ge,C=Nt+(C<<3)|0,y[C>>2]=ve,y[C+4>>2]=ge,C=_e),$=C,F=P)}while(0);if(Re=Re+1|0,Re>>>0>=7)break;C=$,P=F}if(Ze=Qi(Ze|0,je|0,1,0)|0,je=he()|0,Ue=Qi(Ue|0,Be|0,1,0)|0,Be=he()|0,P=Ei,C=y[P>>2]|0,P=y[P+4>>2]|0,(Be|0)<(P|0)|(Be|0)==(P|0)&Ue>>>0<C>>>0)C=$,P=F;else break}if((P|0)>0|(P|0)==0&C>>>0>0){C=0,P=0;do Be=Tt+(C<<3)|0,y[Be>>2]=0,y[Be+4>>2]=0,C=Qi(C|0,P|0,1,0)|0,P=he()|0,Be=Ei,Ue=y[Be+4>>2]|0;while((P|0)<(Ue|0)|((P|0)==(Ue|0)?C>>>0<(y[Be>>2]|0)>>>0:0))}if(Be=Ei,y[Be>>2]=$,y[Be+4>>2]=F,(F|0)>0|(F|0)==0&$>>>0>0)Re=T,Ze=Zt,je=On,Ue=Lt,Be=Nt,T=Me,Zt=_,Lt=Jn,Me=Re,_=Ze,On=vn,vn=je,Jn=Ue,Nt=Tt,Tt=Be;else break t}li(Jn),li(vn),li(Us),_=1;break e}else _=$;while(0);li(Us),li(T),li(_),_=0}while(0);return Us=_,Y=Ru,Us|0}function CQe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0;if(J=Y,Y=Y+176|0,F=J,(m|0)<1)return Wfe(_,0,0),V=0,Y=J,V|0;for($=g,$=dt(y[$>>2]|0,y[$+4>>2]|0,52)|0,he()|0,Wfe(_,(m|0)>6?m:6,$&15),$=0;w=g+($<<3)|0,w=zP(y[w>>2]|0,y[w+4>>2]|0,F)|0,!(w|0);){if(w=y[F>>2]|0,(w|0)>0){P=0;do C=F+8+(P<<4)|0,P=P+1|0,w=F+8+(((P|0)%(w|0)|0)<<4)|0,T=KYe(_,w,C)|0,T?Xfe(_,T)|0:JYe(_,C,w)|0,w=y[F>>2]|0;while((P|0)<(w|0))}if($=$+1|0,($|0)>=(m|0)){w=0,V=13;break}}return(V|0)==13?(Y=J,w|0):(Qfe(_),V=w,Y=J,V|0)}function MQe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0;if(C=Y,Y=Y+32|0,w=C,T=C+16|0,g=CQe(g,m,T)|0,g|0)return _=g,Y=C,_|0;if(y[_>>2]=0,y[_+4>>2]=0,y[_+8>>2]=0,g=Yfe(T)|0,g|0)do{m=MYe(_)|0;do RYe(m,g)|0,P=g+16|0,y[w>>2]=y[P>>2],y[w+4>>2]=y[P+4>>2],y[w+8>>2]=y[P+8>>2],y[w+12>>2]=y[P+12>>2],Xfe(T,g)|0,g=eXe(T,w)|0;while(g|0);g=Yfe(T)|0}while(g|0);return Qfe(T),g=OYe(_)|0,g?(Bfe(_),P=g,Y=C,P|0):(P=0,Y=C,P|0)}function Zs(g){return g=g|0,g>>>0>121?(g=0,g|0):(g=y[7696+(g*28|0)+16>>2]|0,g|0)}function hq(g){return g=g|0,(g|0)==4|(g|0)==117|0}function vfe(g){return g=g|0,y[11120+((y[g>>2]|0)*216|0)+((y[g+4>>2]|0)*72|0)+((y[g+8>>2]|0)*24|0)+(y[g+12>>2]<<3)>>2]|0}function RQe(g){return g=g|0,y[11120+((y[g>>2]|0)*216|0)+((y[g+4>>2]|0)*72|0)+((y[g+8>>2]|0)*24|0)+(y[g+12>>2]<<3)+4>>2]|0}function OQe(g,m){g=g|0,m=m|0,g=7696+(g*28|0)|0,y[m>>2]=y[g>>2],y[m+4>>2]=y[g+4>>2],y[m+8>>2]=y[g+8>>2],y[m+12>>2]=y[g+12>>2]}function PQe(g,m){g=g|0,m=m|0;var _=0,w=0;if(m>>>0>20)return m=-1,m|0;do if((y[11120+(m*216|0)>>2]|0)!=(g|0))if((y[11120+(m*216|0)+8>>2]|0)!=(g|0))if((y[11120+(m*216|0)+16>>2]|0)!=(g|0))if((y[11120+(m*216|0)+24>>2]|0)!=(g|0))if((y[11120+(m*216|0)+32>>2]|0)!=(g|0))if((y[11120+(m*216|0)+40>>2]|0)!=(g|0))if((y[11120+(m*216|0)+48>>2]|0)!=(g|0))if((y[11120+(m*216|0)+56>>2]|0)!=(g|0))if((y[11120+(m*216|0)+64>>2]|0)!=(g|0))if((y[11120+(m*216|0)+72>>2]|0)!=(g|0))if((y[11120+(m*216|0)+80>>2]|0)!=(g|0))if((y[11120+(m*216|0)+88>>2]|0)!=(g|0))if((y[11120+(m*216|0)+96>>2]|0)!=(g|0))if((y[11120+(m*216|0)+104>>2]|0)!=(g|0))if((y[11120+(m*216|0)+112>>2]|0)!=(g|0))if((y[11120+(m*216|0)+120>>2]|0)!=(g|0))if((y[11120+(m*216|0)+128>>2]|0)!=(g|0))if((y[11120+(m*216|0)+136>>2]|0)==(g|0))g=2,_=1,w=2;else{if((y[11120+(m*216|0)+144>>2]|0)==(g|0)){g=0,_=2,w=0;break}if((y[11120+(m*216|0)+152>>2]|0)==(g|0)){g=0,_=2,w=1;break}if((y[11120+(m*216|0)+160>>2]|0)==(g|0)){g=0,_=2,w=2;break}if((y[11120+(m*216|0)+168>>2]|0)==(g|0)){g=1,_=2,w=0;break}if((y[11120+(m*216|0)+176>>2]|0)==(g|0)){g=1,_=2,w=1;break}if((y[11120+(m*216|0)+184>>2]|0)==(g|0)){g=1,_=2,w=2;break}if((y[11120+(m*216|0)+192>>2]|0)==(g|0)){g=2,_=2,w=0;break}if((y[11120+(m*216|0)+200>>2]|0)==(g|0)){g=2,_=2,w=1;break}if((y[11120+(m*216|0)+208>>2]|0)==(g|0)){g=2,_=2,w=2;break}else g=-1;return g|0}else g=2,_=1,w=1;else g=2,_=1,w=0;else g=1,_=1,w=2;else g=1,_=1,w=1;else g=1,_=1,w=0;else g=0,_=1,w=2;else g=0,_=1,w=1;else g=0,_=1,w=0;else g=2,_=0,w=2;else g=2,_=0,w=1;else g=2,_=0,w=0;else g=1,_=0,w=2;else g=1,_=0,w=1;else g=1,_=0,w=0;else g=0,_=0,w=2;else g=0,_=0,w=1;else g=0,_=0,w=0;while(0);return m=y[11120+(m*216|0)+(_*72|0)+(g*24|0)+(w<<3)+4>>2]|0,m|0}function bfe(g,m){return g=g|0,m=m|0,(y[7696+(g*28|0)+20>>2]|0)==(m|0)?(m=1,m|0):(m=(y[7696+(g*28|0)+24>>2]|0)==(m|0),m|0)}function dq(g,m){return g=g|0,m=m|0,y[848+(g*28|0)+(m<<2)>>2]|0}function pq(g,m){return g=g|0,m=m|0,(y[848+(g*28|0)>>2]|0)==(m|0)?(m=0,m|0):(y[848+(g*28|0)+4>>2]|0)==(m|0)?(m=1,m|0):(y[848+(g*28|0)+8>>2]|0)==(m|0)?(m=2,m|0):(y[848+(g*28|0)+12>>2]|0)==(m|0)?(m=3,m|0):(y[848+(g*28|0)+16>>2]|0)==(m|0)?(m=4,m|0):(y[848+(g*28|0)+20>>2]|0)==(m|0)?(m=5,m|0):((y[848+(g*28|0)+24>>2]|0)==(m|0)?6:7)|0}function IQe(){return 122}function $Qe(g){g=g|0;var m=0,_=0,w=0;m=0;do Mt(m|0,0,45)|0,w=he()|0|134225919,_=g+(m<<3)|0,y[_>>2]=-1,y[_+4>>2]=w,m=m+1|0;while((m|0)!=122);return 0}function wfe(g){return g=g|0,+ie[g+16>>3]<+ie[g+24>>3]|0}function xfe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0;return _=+ie[m>>3],!(_>=+ie[g+8>>3])||!(_<=+ie[g>>3])?(m=0,m|0):(w=+ie[g+16>>3],_=+ie[g+24>>3],T=+ie[m+8>>3],m=T>=_,g=T<=w&1,w<_?m&&(g=1):m||(g=0),m=(g|0)!=0,m|0)}function Tfe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0;ge=Y,Y=Y+288|0,J=ge+264|0,ce=ge+96|0,V=ge,$=V,F=$+96|0;do y[$>>2]=0,$=$+4|0;while(($|0)<(F|0));return m=xq(m,V)|0,m|0?(ve=m,Y=ge,ve|0):(F=V,V=y[F>>2]|0,F=y[F+4>>2]|0,BP(V,F,J)|0,zP(V,F,ce)|0,P=+GP(J,ce+8|0),ie[J>>3]=+ie[g>>3],F=J+8|0,ie[F>>3]=+ie[g+16>>3],ie[ce>>3]=+ie[g+8>>3],V=ce+8|0,ie[V>>3]=+ie[g+24>>3],T=+GP(J,ce),Ze=+ie[F>>3]-+ie[V>>3],C=+Yr(+Ze),Re=+ie[J>>3]-+ie[ce>>3],w=+Yr(+Re),!(Ze==0|Re==0)&&(Ze=+Kfe(+C,+w),Ze=+Oi(+(T*T/+Cq(+(Ze/+Cq(+C,+w)),3)/(P*(P*2.59807621135)*.8))),ie[Ri>>3]=Ze,_e=~~Ze>>>0,ve=+Yr(Ze)>=1?Ze>0?~~+Td(+Rn(Ze/4294967296),4294967295)>>>0:~~+Oi((Ze-+(~~Ze>>>0))/4294967296)>>>0:0,(y[Ri+4>>2]&2146435072|0)!=2146435072)?(ce=(_e|0)==0&(ve|0)==0,m=_,y[m>>2]=ce?1:_e,y[m+4>>2]=ce?0:ve,m=0):m=1,ve=m,Y=ge,ve|0)}function DQe(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0,V=0,J=0;V=Y,Y=Y+288|0,P=V+264|0,$=V+96|0,F=V,T=F,C=T+96|0;do y[T>>2]=0,T=T+4|0;while((T|0)<(C|0));return _=xq(_,F)|0,_|0?(w=_,Y=V,w|0):(_=F,T=y[_>>2]|0,_=y[_+4>>2]|0,BP(T,_,P)|0,zP(T,_,$)|0,J=+GP(P,$+8|0),J=+Oi(+(+GP(g,m)/(J*2))),ie[Ri>>3]=J,_=~~J>>>0,T=+Yr(J)>=1?J>0?~~+Td(+Rn(J/4294967296),4294967295)>>>0:~~+Oi((J-+(~~J>>>0))/4294967296)>>>0:0,(y[Ri+4>>2]&2146435072|0)==2146435072?(w=1,Y=V,w|0):(F=(_|0)==0&(T|0)==0,y[w>>2]=F?1:_,y[w+4>>2]=F?0:T,w=0,Y=V,w|0))}function LQe(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0,y[g>>2]=m,y[g+4>>2]=_,y[g+8>>2]=w}function NQe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0;ce=m+8|0,y[ce>>2]=0,F=+ie[g>>3],P=+Yr(+F),V=+ie[g+8>>3],$=+Yr(+V)/.8660254037844386,P=P+$*.5,_=~~P,g=~~$,P=P-+(_|0),$=$-+(g|0);do if(P<.5)if(P<.3333333333333333)if(y[m>>2]=_,$<(P+1)*.5){y[m+4>>2]=g;break}else{g=g+1|0,y[m+4>>2]=g;break}else if(_e=1-P,g=(!($<_e)&1)+g|0,y[m+4>>2]=g,_e<=$&$<P*2){_=_+1|0,y[m>>2]=_;break}else{y[m>>2]=_;break}else{if(!(P<.6666666666666666))if(_=_+1|0,y[m>>2]=_,$<P*.5){y[m+4>>2]=g;break}else{g=g+1|0,y[m+4>>2]=g;break}if($<1-P){if(y[m+4>>2]=g,P*2+-1<$){y[m>>2]=_;break}}else g=g+1|0,y[m+4>>2]=g;_=_+1|0,y[m>>2]=_}while(0);do if(F<0)if(g&1){J=(g+1|0)/2|0,J=zc(_|0,((_|0)<0)<<31>>31|0,J|0,((J|0)<0)<<31>>31|0)|0,_=~~(+(_|0)-((+(J>>>0)+4294967296*+(he()|0))*2+1)),y[m>>2]=_;break}else{J=(g|0)/2|0,J=zc(_|0,((_|0)<0)<<31>>31|0,J|0,((J|0)<0)<<31>>31|0)|0,_=~~(+(_|0)-(+(J>>>0)+4294967296*+(he()|0))*2),y[m>>2]=_;break}while(0);J=m+4|0,V<0&&(_=_-((g<<1|1|0)/2|0)|0,y[m>>2]=_,g=0-g|0,y[J>>2]=g),w=g-_|0,(_|0)<0?(T=0-_|0,y[J>>2]=w,y[ce>>2]=T,y[m>>2]=0,g=w,_=0):T=0,(g|0)<0&&(_=_-g|0,y[m>>2]=_,T=T-g|0,y[ce>>2]=T,y[J>>2]=0,g=0),C=_-T|0,w=g-T|0,(T|0)<0&&(y[m>>2]=C,y[J>>2]=w,y[ce>>2]=0,g=w,_=C,T=0),w=(g|0)<(_|0)?g:_,w=(T|0)<(w|0)?T:w,!((w|0)<=0)&&(y[m>>2]=_-w,y[J>>2]=g-w,y[ce>>2]=T-w)}function Bc(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0;m=y[g>>2]|0,P=g+4|0,_=y[P>>2]|0,(m|0)<0&&(_=_-m|0,y[P>>2]=_,C=g+8|0,y[C>>2]=(y[C>>2]|0)-m,y[g>>2]=0,m=0),(_|0)<0?(m=m-_|0,y[g>>2]=m,C=g+8|0,T=(y[C>>2]|0)-_|0,y[C>>2]=T,y[P>>2]=0,_=0):(T=g+8|0,C=T,T=y[T>>2]|0),(T|0)<0&&(m=m-T|0,y[g>>2]=m,_=_-T|0,y[P>>2]=_,y[C>>2]=0,T=0),w=(_|0)<(m|0)?_:m,w=(T|0)<(w|0)?T:w,!((w|0)<=0)&&(y[g>>2]=m-w,y[P>>2]=_-w,y[C>>2]=T-w)}function Aw(g,m){g=g|0,m=m|0;var _=0,w=0;w=y[g+8>>2]|0,_=+((y[g+4>>2]|0)-w|0),ie[m>>3]=+((y[g>>2]|0)-w|0)-_*.5,ie[m+8>>3]=_*.8660254037844386}function Mu(g,m,_){g=g|0,m=m|0,_=_|0,y[_>>2]=(y[m>>2]|0)+(y[g>>2]|0),y[_+4>>2]=(y[m+4>>2]|0)+(y[g+4>>2]|0),y[_+8>>2]=(y[m+8>>2]|0)+(y[g+8>>2]|0)}function fq(g,m,_){g=g|0,m=m|0,_=_|0,y[_>>2]=(y[g>>2]|0)-(y[m>>2]|0),y[_+4>>2]=(y[g+4>>2]|0)-(y[m+4>>2]|0),y[_+8>>2]=(y[g+8>>2]|0)-(y[m+8>>2]|0)}function Sfe(g,m){g=g|0,m=m|0;var _=0,w=0;_=ya(y[g>>2]|0,m)|0,y[g>>2]=_,_=g+4|0,w=ya(y[_>>2]|0,m)|0,y[_>>2]=w,g=g+8|0,m=ya(y[g>>2]|0,m)|0,y[g>>2]=m}function $F(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;P=y[g>>2]|0,$=(P|0)<0,w=(y[g+4>>2]|0)-($?P:0)|0,C=(w|0)<0,T=(C?0-w|0:0)+((y[g+8>>2]|0)-($?P:0))|0,_=(T|0)<0,g=_?0:T,m=(C?0:w)-(_?T:0)|0,T=($?0:P)-(C?w:0)-(_?T:0)|0,_=(m|0)<(T|0)?m:T,_=(g|0)<(_|0)?g:_,w=(_|0)>0,g=g-(w?_:0)|0,m=m-(w?_:0)|0;e:do switch(T-(w?_:0)|0){case 0:switch(m|0){case 0:return $=g|0?(g|0)==1?1:7:0,$|0;case 1:return $=g|0?(g|0)==1?3:7:2,$|0;default:break e}case 1:switch(m|0){case 0:return $=g|0?(g|0)==1?5:7:4,$|0;case 1:{if(!g)g=6;else break e;return g|0}default:break e}}while(0);return $=7,$|0}function FQe(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;P=g+8|0,T=y[P>>2]|0,C=(y[g>>2]|0)-T|0,$=g+4|0,T=(y[$>>2]|0)-T|0;do if(C>>>0>715827881|T>>>0>715827881){if(_=(C|0)>0,_){if((2147483647-C|0)<(C|0)||(2147483647-(C<<1)|0)<(C|0))return $=1,$|0}else if((-2147483648-C|0)>(C|0)||(-2147483648-(C<<1)|0)>(C|0))return $=1,$|0;if(m=C*3|0,(T|0)>0){if((2147483647-T|0)<(T|0))return $=1,$|0}else if((-2147483648-T|0)>(T|0))return $=1,$|0;if(w=T<<1,(C|0)>-1){if((m|-2147483648|0)>=(T|0))return $=1,$|0}else if((m^-2147483648|0)<(T|0))return $=1,$|0;if(_){if((2147483647-C|0)<(w|0))m=1;else{_=w;break}return m|0}else{if((-2147483648-C|0)>(w|0))m=1;else{_=w;break}return m|0}}else _=T<<1,m=C*3|0;while(0);w=z1(+(m-T|0)/7)|0,y[g>>2]=w,T=z1(+(_+C|0)/7)|0,y[$>>2]=T,y[P>>2]=0,_=(T|0)<(w|0),m=_?w:T,_=_?T:w;do if((_|0)<0){if((m|0)>0){if((m|-2147483648|0)<(_|0)&((_|0)!=-2147483648&(2147483647-m|0)>=(_|0)))break;Sr(23313,22444,355,22455)}if((_|0)==-2147483648|(-2147483648-m|0)>(_|0)&&Sr(23313,22444,355,22455),(m|0)>-1){if((m|-2147483648|0)<(_|0))break;Sr(23313,22444,355,22455)}else{if((m^-2147483648|0)>=(_|0))break;Sr(23313,22444,355,22455)}}while(0);return m=T-w|0,(w|0)<0?(_=0-w|0,y[$>>2]=m,y[P>>2]=_,y[g>>2]=0,w=0):(m=T,_=0),(m|0)<0&&(w=w-m|0,y[g>>2]=w,_=_-m|0,y[P>>2]=_,y[$>>2]=0,m=0),C=w-_|0,T=m-_|0,(_|0)<0?(y[g>>2]=C,y[$>>2]=T,y[P>>2]=0,m=T,T=C,_=0):T=w,w=(m|0)<(T|0)?m:T,w=(_|0)<(w|0)?_:w,(w|0)<=0?($=0,$|0):(y[g>>2]=T-w,y[$>>2]=m-w,y[P>>2]=_-w,$=0,$|0)}function kQe(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;P=g+8|0,T=y[P>>2]|0,C=(y[g>>2]|0)-T|0,$=g+4|0,T=(y[$>>2]|0)-T|0;do if(C>>>0>715827881|T>>>0>715827881){if(_=(C|0)>0,_){if((2147483647-C|0)<(C|0))return $=1,$|0}else if((-2147483648-C|0)>(C|0))return $=1,$|0;if(m=C<<1,(T|0)>0){if((2147483647-T|0)<(T|0)||(2147483647-(T<<1)|0)<(T|0))return $=1,$|0}else if((-2147483648-T|0)>(T|0)||(-2147483648-(T<<1)|0)>(T|0))return $=1,$|0;if(w=T*3|0,_){if((2147483647-m|0)<(T|0))return $=1,$|0}else if((-2147483648-m|0)>(T|0))return $=1,$|0;if((T|0)>-1){if((w|-2147483648|0)<(C|0)){_=w;break}else m=1;return m|0}else{if((w^-2147483648|0)<(C|0))m=1;else{_=w;break}return m|0}}else _=T*3|0,m=C<<1;while(0);w=z1(+(m+T|0)/7)|0,y[g>>2]=w,T=z1(+(_-C|0)/7)|0,y[$>>2]=T,y[P>>2]=0,_=(T|0)<(w|0),m=_?w:T,_=_?T:w;do if((_|0)<0){if((m|0)>0){if((m|-2147483648|0)<(_|0)&((_|0)!=-2147483648&(2147483647-m|0)>=(_|0)))break;Sr(23313,22444,404,22469)}if((_|0)==-2147483648|(-2147483648-m|0)>(_|0)&&Sr(23313,22444,404,22469),(m|0)>-1){if((m|-2147483648|0)<(_|0))break;Sr(23313,22444,404,22469)}else{if((m^-2147483648|0)>=(_|0))break;Sr(23313,22444,404,22469)}}while(0);return m=T-w|0,(w|0)<0?(_=0-w|0,y[$>>2]=m,y[P>>2]=_,y[g>>2]=0,w=0):(m=T,_=0),(m|0)<0&&(w=w-m|0,y[g>>2]=w,_=_-m|0,y[P>>2]=_,y[$>>2]=0,m=0),C=w-_|0,T=m-_|0,(_|0)<0?(y[g>>2]=C,y[$>>2]=T,y[P>>2]=0,m=T,T=C,_=0):T=w,w=(m|0)<(T|0)?m:T,w=(_|0)<(w|0)?_:w,(w|0)<=0?($=0,$|0):(y[g>>2]=T-w,y[$>>2]=m-w,y[P>>2]=_-w,$=0,$|0)}function UQe(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;P=g+8|0,_=y[P>>2]|0,m=(y[g>>2]|0)-_|0,$=g+4|0,_=(y[$>>2]|0)-_|0,w=z1(+((m*3|0)-_|0)/7)|0,y[g>>2]=w,m=z1(+((_<<1)+m|0)/7)|0,y[$>>2]=m,y[P>>2]=0,_=m-w|0,(w|0)<0?(C=0-w|0,y[$>>2]=_,y[P>>2]=C,y[g>>2]=0,m=_,w=0,_=C):_=0,(m|0)<0&&(w=w-m|0,y[g>>2]=w,_=_-m|0,y[P>>2]=_,y[$>>2]=0,m=0),C=w-_|0,T=m-_|0,(_|0)<0?(y[g>>2]=C,y[$>>2]=T,y[P>>2]=0,m=T,T=C,_=0):T=w,w=(m|0)<(T|0)?m:T,w=(_|0)<(w|0)?_:w,!((w|0)<=0)&&(y[g>>2]=T-w,y[$>>2]=m-w,y[P>>2]=_-w)}function Efe(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;P=g+8|0,_=y[P>>2]|0,m=(y[g>>2]|0)-_|0,$=g+4|0,_=(y[$>>2]|0)-_|0,w=z1(+((m<<1)+_|0)/7)|0,y[g>>2]=w,m=z1(+((_*3|0)-m|0)/7)|0,y[$>>2]=m,y[P>>2]=0,_=m-w|0,(w|0)<0?(C=0-w|0,y[$>>2]=_,y[P>>2]=C,y[g>>2]=0,m=_,w=0,_=C):_=0,(m|0)<0&&(w=w-m|0,y[g>>2]=w,_=_-m|0,y[P>>2]=_,y[$>>2]=0,m=0),C=w-_|0,T=m-_|0,(_|0)<0?(y[g>>2]=C,y[$>>2]=T,y[P>>2]=0,m=T,T=C,_=0):T=w,w=(m|0)<(T|0)?m:T,w=(_|0)<(w|0)?_:w,!((w|0)<=0)&&(y[g>>2]=T-w,y[$>>2]=m-w,y[P>>2]=_-w)}function DF(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;m=y[g>>2]|0,P=g+4|0,_=y[P>>2]|0,$=g+8|0,w=y[$>>2]|0,T=_+(m*3|0)|0,y[g>>2]=T,_=w+(_*3|0)|0,y[P>>2]=_,m=(w*3|0)+m|0,y[$>>2]=m,w=_-T|0,(T|0)<0?(m=m-T|0,y[P>>2]=w,y[$>>2]=m,y[g>>2]=0,_=w,w=0):w=T,(_|0)<0&&(w=w-_|0,y[g>>2]=w,m=m-_|0,y[$>>2]=m,y[P>>2]=0,_=0),C=w-m|0,T=_-m|0,(m|0)<0?(y[g>>2]=C,y[P>>2]=T,y[$>>2]=0,w=C,m=0):T=_,_=(T|0)<(w|0)?T:w,_=(m|0)<(_|0)?m:_,!((_|0)<=0)&&(y[g>>2]=w-_,y[P>>2]=T-_,y[$>>2]=m-_)}function yw(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;T=y[g>>2]|0,P=g+4|0,m=y[P>>2]|0,$=g+8|0,_=y[$>>2]|0,w=(m*3|0)+T|0,T=_+(T*3|0)|0,y[g>>2]=T,y[P>>2]=w,m=(_*3|0)+m|0,y[$>>2]=m,_=w-T|0,(T|0)<0?(m=m-T|0,y[P>>2]=_,y[$>>2]=m,y[g>>2]=0,T=0):_=w,(_|0)<0&&(T=T-_|0,y[g>>2]=T,m=m-_|0,y[$>>2]=m,y[P>>2]=0,_=0),C=T-m|0,w=_-m|0,(m|0)<0?(y[g>>2]=C,y[P>>2]=w,y[$>>2]=0,T=C,m=0):w=_,_=(w|0)<(T|0)?w:T,_=(m|0)<(_|0)?m:_,!((_|0)<=0)&&(y[g>>2]=T-_,y[P>>2]=w-_,y[$>>2]=m-_)}function Cfe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0,$=0;(m+-1|0)>>>0>=6||(T=(y[15440+(m*12|0)>>2]|0)+(y[g>>2]|0)|0,y[g>>2]=T,$=g+4|0,w=(y[15440+(m*12|0)+4>>2]|0)+(y[$>>2]|0)|0,y[$>>2]=w,P=g+8|0,m=(y[15440+(m*12|0)+8>>2]|0)+(y[P>>2]|0)|0,y[P>>2]=m,_=w-T|0,(T|0)<0?(m=m-T|0,y[$>>2]=_,y[P>>2]=m,y[g>>2]=0,w=0):(_=w,w=T),(_|0)<0&&(w=w-_|0,y[g>>2]=w,m=m-_|0,y[P>>2]=m,y[$>>2]=0,_=0),C=w-m|0,T=_-m|0,(m|0)<0?(y[g>>2]=C,y[$>>2]=T,y[P>>2]=0,w=C,m=0):T=_,_=(T|0)<(w|0)?T:w,_=(m|0)<(_|0)?m:_,!((_|0)<=0)&&(y[g>>2]=w-_,y[$>>2]=T-_,y[P>>2]=m-_))}function Mfe(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;T=y[g>>2]|0,P=g+4|0,m=y[P>>2]|0,$=g+8|0,_=y[$>>2]|0,w=m+T|0,T=_+T|0,y[g>>2]=T,y[P>>2]=w,m=_+m|0,y[$>>2]=m,_=w-T|0,(T|0)<0?(m=m-T|0,y[P>>2]=_,y[$>>2]=m,y[g>>2]=0,w=0):(_=w,w=T),(_|0)<0&&(w=w-_|0,y[g>>2]=w,m=m-_|0,y[$>>2]=m,y[P>>2]=0,_=0),C=w-m|0,T=_-m|0,(m|0)<0?(y[g>>2]=C,y[P>>2]=T,y[$>>2]=0,w=C,m=0):T=_,_=(T|0)<(w|0)?T:w,_=(m|0)<(_|0)?m:_,!((_|0)<=0)&&(y[g>>2]=w-_,y[P>>2]=T-_,y[$>>2]=m-_)}function LF(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;m=y[g>>2]|0,P=g+4|0,w=y[P>>2]|0,$=g+8|0,_=y[$>>2]|0,T=w+m|0,y[g>>2]=T,w=_+w|0,y[P>>2]=w,m=_+m|0,y[$>>2]=m,_=w-T|0,(T|0)<0?(m=m-T|0,y[P>>2]=_,y[$>>2]=m,y[g>>2]=0,w=0):(_=w,w=T),(_|0)<0&&(w=w-_|0,y[g>>2]=w,m=m-_|0,y[$>>2]=m,y[P>>2]=0,_=0),C=w-m|0,T=_-m|0,(m|0)<0?(y[g>>2]=C,y[P>>2]=T,y[$>>2]=0,w=C,m=0):T=_,_=(T|0)<(w|0)?T:w,_=(m|0)<(_|0)?m:_,!((_|0)<=0)&&(y[g>>2]=w-_,y[P>>2]=T-_,y[$>>2]=m-_)}function _w(g){switch(g=g|0,g|0){case 1:{g=5;break}case 5:{g=4;break}case 4:{g=6;break}case 6:{g=2;break}case 2:{g=3;break}case 3:{g=1;break}}return g|0}function U1(g){switch(g=g|0,g|0){case 1:{g=3;break}case 3:{g=2;break}case 2:{g=6;break}case 6:{g=4;break}case 4:{g=5;break}case 5:{g=1;break}}return g|0}function Rfe(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;m=y[g>>2]|0,P=g+4|0,_=y[P>>2]|0,$=g+8|0,w=y[$>>2]|0,T=_+(m<<1)|0,y[g>>2]=T,_=w+(_<<1)|0,y[P>>2]=_,m=(w<<1)+m|0,y[$>>2]=m,w=_-T|0,(T|0)<0?(m=m-T|0,y[P>>2]=w,y[$>>2]=m,y[g>>2]=0,_=w,w=0):w=T,(_|0)<0&&(w=w-_|0,y[g>>2]=w,m=m-_|0,y[$>>2]=m,y[P>>2]=0,_=0),C=w-m|0,T=_-m|0,(m|0)<0?(y[g>>2]=C,y[P>>2]=T,y[$>>2]=0,w=C,m=0):T=_,_=(T|0)<(w|0)?T:w,_=(m|0)<(_|0)?m:_,!((_|0)<=0)&&(y[g>>2]=w-_,y[P>>2]=T-_,y[$>>2]=m-_)}function Ofe(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;T=y[g>>2]|0,P=g+4|0,m=y[P>>2]|0,$=g+8|0,_=y[$>>2]|0,w=(m<<1)+T|0,T=_+(T<<1)|0,y[g>>2]=T,y[P>>2]=w,m=(_<<1)+m|0,y[$>>2]=m,_=w-T|0,(T|0)<0?(m=m-T|0,y[P>>2]=_,y[$>>2]=m,y[g>>2]=0,T=0):_=w,(_|0)<0&&(T=T-_|0,y[g>>2]=T,m=m-_|0,y[$>>2]=m,y[P>>2]=0,_=0),C=T-m|0,w=_-m|0,(m|0)<0?(y[g>>2]=C,y[P>>2]=w,y[$>>2]=0,T=C,m=0):w=_,_=(w|0)<(T|0)?w:T,_=(m|0)<(_|0)?m:_,!((_|0)<=0)&&(y[g>>2]=T-_,y[P>>2]=w-_,y[$>>2]=m-_)}function mq(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0,$=0;return P=(y[g>>2]|0)-(y[m>>2]|0)|0,$=(P|0)<0,w=(y[g+4>>2]|0)-(y[m+4>>2]|0)-($?P:0)|0,C=(w|0)<0,T=($?0-P|0:0)+(y[g+8>>2]|0)-(y[m+8>>2]|0)+(C?0-w|0:0)|0,g=(T|0)<0,m=g?0:T,_=(C?0:w)-(g?T:0)|0,T=($?0:P)-(C?w:0)-(g?T:0)|0,g=(_|0)<(T|0)?_:T,g=(m|0)<(g|0)?m:g,w=(g|0)>0,m=m-(w?g:0)|0,_=_-(w?g:0)|0,g=T-(w?g:0)|0,g=(g|0)>-1?g:0-g|0,_=(_|0)>-1?_:0-_|0,m=(m|0)>-1?m:0-m|0,m=(_|0)>(m|0)?_:m,((g|0)>(m|0)?g:m)|0}function BQe(g,m){g=g|0,m=m|0;var _=0;_=y[g+8>>2]|0,y[m>>2]=(y[g>>2]|0)-_,y[m+4>>2]=(y[g+4>>2]|0)-_}function zQe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0,$=0;w=y[g>>2]|0,y[m>>2]=w,T=y[g+4>>2]|0,P=m+4|0,y[P>>2]=T,$=m+8|0,y[$>>2]=0,_=(T|0)<(w|0),g=_?w:T,_=_?T:w;do if((_|0)<0){if((g|0)>0){if((g|-2147483648|0)<(_|0)&((_|0)!=-2147483648&(2147483647-g|0)>=(_|0)))break;return g=1,g|0}if((_|0)==-2147483648|(-2147483648-g|0)>(_|0))return m=1,m|0;if((g|0)>-1){if((g|-2147483648|0)<(_|0))break;return g=1,g|0}else{if((g^-2147483648|0)<(_|0))g=1;else break;return g|0}}while(0);return g=T-w|0,(w|0)<0?(_=0-w|0,y[P>>2]=g,y[$>>2]=_,y[m>>2]=0,w=0):(g=T,_=0),(g|0)<0&&(w=w-g|0,y[m>>2]=w,_=_-g|0,y[$>>2]=_,y[P>>2]=0,g=0),C=w-_|0,T=g-_|0,(_|0)<0?(y[m>>2]=C,y[P>>2]=T,y[$>>2]=0,g=T,T=C,_=0):T=w,w=(g|0)<(T|0)?g:T,w=(_|0)<(w|0)?_:w,(w|0)<=0?(m=0,m|0):(y[m>>2]=T-w,y[P>>2]=g-w,y[$>>2]=_-w,m=0,m|0)}function Pfe(g){g=g|0;var m=0,_=0,w=0,T=0;m=g+8|0,T=y[m>>2]|0,_=T-(y[g>>2]|0)|0,y[g>>2]=_,w=g+4|0,g=(y[w>>2]|0)-T|0,y[w>>2]=g,y[m>>2]=0-(g+_)}function VQe(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;_=y[g>>2]|0,m=0-_|0,y[g>>2]=m,P=g+8|0,y[P>>2]=0,$=g+4|0,w=y[$>>2]|0,T=w+_|0,(_|0)>0?(y[$>>2]=T,y[P>>2]=_,y[g>>2]=0,m=0,w=T):_=0,(w|0)<0?(C=m-w|0,y[g>>2]=C,_=_-w|0,y[P>>2]=_,y[$>>2]=0,T=C-_|0,m=0-_|0,(_|0)<0?(y[g>>2]=T,y[$>>2]=m,y[P>>2]=0,w=m,_=0):(w=0,T=C)):T=m,m=(w|0)<(T|0)?w:T,m=(_|0)<(m|0)?_:m,!((m|0)<=0)&&(y[g>>2]=T-m,y[$>>2]=w-m,y[P>>2]=_-m)}function GQe(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0,V=0,J=0,ce=0;if(ce=Y,Y=Y+64|0,J=ce,$=ce+56|0,!(!0&(m&2013265920|0)==134217728&(!0&(w&2013265920|0)==134217728)))return T=5,Y=ce,T|0;if((g|0)==(_|0)&(m|0)==(w|0))return y[T>>2]=0,T=0,Y=ce,T|0;if(P=dt(g|0,m|0,52)|0,he()|0,P=P&15,V=dt(_|0,w|0,52)|0,he()|0,(P|0)!=(V&15|0))return T=12,Y=ce,T|0;if(C=P+-1|0,P>>>0>1){_q(g,m,C,J)|0,_q(_,w,C,$)|0,V=J,F=y[V>>2]|0,V=y[V+4>>2]|0;e:do if((F|0)==(y[$>>2]|0)&&(V|0)==(y[$+4>>2]|0)){P=(P^15)*3|0,C=dt(g|0,m|0,P|0)|0,he()|0,C=C&7,P=dt(_|0,w|0,P|0)|0,he()|0,P=P&7;do if((C|0)==0|(P|0)==0)y[T>>2]=1,C=0;else if((C|0)==7)C=5;else{if((C|0)==1|(P|0)==1&&Js(F,V)|0){C=5;break}if((y[15536+(C<<2)>>2]|0)!=(P|0)&&(y[15568+(C<<2)>>2]|0)!=(P|0))break e;y[T>>2]=1,C=0}while(0);return T=C,Y=ce,T|0}while(0)}C=J,P=C+56|0;do y[C>>2]=0,C=C+4|0;while((C|0)<(P|0));return FP(g,m,1,J)|0,m=J,!((y[m>>2]|0)==(_|0)&&(y[m+4>>2]|0)==(w|0))&&(m=J+8|0,!((y[m>>2]|0)==(_|0)&&(y[m+4>>2]|0)==(w|0)))&&(m=J+16|0,!((y[m>>2]|0)==(_|0)&&(y[m+4>>2]|0)==(w|0)))&&(m=J+24|0,!((y[m>>2]|0)==(_|0)&&(y[m+4>>2]|0)==(w|0)))&&(m=J+32|0,!((y[m>>2]|0)==(_|0)&&(y[m+4>>2]|0)==(w|0)))&&(m=J+40|0,!((y[m>>2]|0)==(_|0)&&(y[m+4>>2]|0)==(w|0)))?(C=J+48|0,C=((y[C>>2]|0)==(_|0)?(y[C+4>>2]|0)==(w|0):0)&1):C=1,y[T>>2]=C,T=0,Y=ce,T|0}function jQe(g,m,_,w,T){return g=g|0,m=m|0,_=_|0,w=w|0,T=T|0,_=uq(g,m,_,w)|0,(_|0)==7?(T=11,T|0):(w=Mt(_|0,0,56)|0,m=m&-2130706433|(he()|0)|268435456,y[T>>2]=g|w,y[T+4>>2]=m,T=0,T|0)}function HQe(g,m,_){return g=g|0,m=m|0,_=_|0,!0&(m&2013265920|0)==268435456?(y[_>>2]=g,y[_+4>>2]=m&-2130706433|134217728,_=0,_|0):(_=6,_|0)}function qQe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0;return T=Y,Y=Y+16|0,w=T,y[w>>2]=0,!0&(m&2013265920|0)==268435456?(C=dt(g|0,m|0,56)|0,he()|0,w=Nl(g,m&-2130706433|134217728,C&7,w,_)|0,Y=T,w|0):(w=6,Y=T,w|0)}function WQe(g,m){g=g|0,m=m|0;var _=0;switch(_=dt(g|0,m|0,56)|0,he()|0,_&7){case 0:case 7:return _=0,_|0}return _=m&-2130706433|134217728,!(!0&(m&2013265920|0)==268435456)||!0&(m&117440512|0)==16777216&(Js(g,_)|0)!=0?(_=0,_|0):(_=yq(g,_)|0,_|0)}function QQe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0;return T=Y,Y=Y+16|0,w=T,!0&(m&2013265920|0)==268435456?(C=m&-2130706433|134217728,P=_,y[P>>2]=g,y[P+4>>2]=C,y[w>>2]=0,m=dt(g|0,m|0,56)|0,he()|0,w=Nl(g,C,m&7,w,_+8|0)|0,Y=T,w|0):(w=6,Y=T,w|0)}function YQe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0;return T=(Js(g,m)|0)==0,m=m&-2130706433,w=_,y[w>>2]=T?g:0,y[w+4>>2]=T?m|285212672:0,w=_+8|0,y[w>>2]=g,y[w+4>>2]=m|301989888,w=_+16|0,y[w>>2]=g,y[w+4>>2]=m|318767104,w=_+24|0,y[w>>2]=g,y[w+4>>2]=m|335544320,w=_+32|0,y[w>>2]=g,y[w+4>>2]=m|352321536,_=_+40|0,y[_>>2]=g,y[_+4>>2]=m|369098752,0}function NF(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0;return P=Y,Y=Y+16|0,T=P,C=m&-2130706433|134217728,!0&(m&2013265920|0)==268435456?(w=dt(g|0,m|0,56)|0,he()|0,w=QYe(g,C,w&7)|0,(w|0)==-1?(y[_>>2]=0,C=6,Y=P,C|0):(FE(g,C,T)|0&&Sr(23313,22484,282,22499),m=dt(g|0,m|0,52)|0,he()|0,m=m&15,Js(g,C)|0?gq(T,m,w,2,_):Aq(T,m,w,2,_),C=0,Y=P,C|0)):(C=6,Y=P,C|0)}function XQe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0;w=Y,Y=Y+16|0,T=w,ZQe(g,m,_,T),NQe(T,_+4|0),Y=w}function ZQe(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0;if($=Y,Y=Y+16|0,F=$,JQe(g,_,F),C=+xd(+(1-+ie[F>>3]*.5)),C<1e-16){y[w>>2]=0,y[w+4>>2]=0,y[w+8>>2]=0,y[w+12>>2]=0,Y=$;return}if(F=y[_>>2]|0,T=+ie[15920+(F*24|0)>>3],T=+VP(T-+VP(+AYe(15600+(F<<4)|0,g))),Pp(m)|0?P=+VP(T+-.3334731722518321):P=T,T=+Aa(+C)/.381966011250105,(m|0)>0){g=0;do T=T*2.6457513110645907,g=g+1|0;while((g|0)!=(m|0))}C=+_n(+P)*T,ie[w>>3]=C,P=+Nr(+P)*T,ie[w+8>>3]=P,Y=$}function JQe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0;if(C=Y,Y=Y+32|0,T=C,WYe(g,T),y[m>>2]=0,ie[_>>3]=5,w=+Fa(16400,T),w<+ie[_>>3]&&(y[m>>2]=0,ie[_>>3]=w),w=+Fa(16424,T),w<+ie[_>>3]&&(y[m>>2]=1,ie[_>>3]=w),w=+Fa(16448,T),w<+ie[_>>3]&&(y[m>>2]=2,ie[_>>3]=w),w=+Fa(16472,T),w<+ie[_>>3]&&(y[m>>2]=3,ie[_>>3]=w),w=+Fa(16496,T),w<+ie[_>>3]&&(y[m>>2]=4,ie[_>>3]=w),w=+Fa(16520,T),w<+ie[_>>3]&&(y[m>>2]=5,ie[_>>3]=w),w=+Fa(16544,T),w<+ie[_>>3]&&(y[m>>2]=6,ie[_>>3]=w),w=+Fa(16568,T),w<+ie[_>>3]&&(y[m>>2]=7,ie[_>>3]=w),w=+Fa(16592,T),w<+ie[_>>3]&&(y[m>>2]=8,ie[_>>3]=w),w=+Fa(16616,T),w<+ie[_>>3]&&(y[m>>2]=9,ie[_>>3]=w),w=+Fa(16640,T),w<+ie[_>>3]&&(y[m>>2]=10,ie[_>>3]=w),w=+Fa(16664,T),w<+ie[_>>3]&&(y[m>>2]=11,ie[_>>3]=w),w=+Fa(16688,T),w<+ie[_>>3]&&(y[m>>2]=12,ie[_>>3]=w),w=+Fa(16712,T),w<+ie[_>>3]&&(y[m>>2]=13,ie[_>>3]=w),w=+Fa(16736,T),w<+ie[_>>3]&&(y[m>>2]=14,ie[_>>3]=w),w=+Fa(16760,T),w<+ie[_>>3]&&(y[m>>2]=15,ie[_>>3]=w),w=+Fa(16784,T),w<+ie[_>>3]&&(y[m>>2]=16,ie[_>>3]=w),w=+Fa(16808,T),w<+ie[_>>3]&&(y[m>>2]=17,ie[_>>3]=w),w=+Fa(16832,T),w<+ie[_>>3]&&(y[m>>2]=18,ie[_>>3]=w),w=+Fa(16856,T),!(w<+ie[_>>3])){Y=C;return}y[m>>2]=19,ie[_>>3]=w,Y=C}function UP(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0;if(C=+qYe(g),C<1e-16){m=15600+(m<<4)|0,y[T>>2]=y[m>>2],y[T+4>>2]=y[m+4>>2],y[T+8>>2]=y[m+8>>2],y[T+12>>2]=y[m+12>>2];return}if(P=+ho(+ +ie[g+8>>3],+ +ie[g>>3]),(_|0)>0){g=0;do C=C/2.6457513110645907,g=g+1|0;while((g|0)!=(_|0))}w?(C=C/3,_=(Pp(_)|0)==0,C=+Uc(+((_?C:C/2.6457513110645907)*.381966011250105))):(C=+Uc(+(C*.381966011250105)),Pp(_)|0&&(P=+VP(P+.3334731722518321))),yYe(15600+(m<<4)|0,+VP(+ie[15920+(m*24|0)>>3]-P),C,T)}function KQe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0;w=Y,Y=Y+16|0,T=w,Aw(g+4|0,T),UP(T,y[g>>2]|0,m,0,_),Y=w}function gq(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0,Be=0,Me=0,Lt=0,Zt=0,Tt=0,Nt=0,Jn=0,vn=0,On=0,Si=0,_i=0,Ei=0,As=0,ci=0;if(Ei=Y,Y=Y+272|0,C=Ei+256|0,Ue=Ei+240|0,On=Ei,Si=Ei+224|0,_i=Ei+208|0,Be=Ei+176|0,Me=Ei+160|0,Lt=Ei+192|0,Zt=Ei+144|0,Tt=Ei+128|0,Nt=Ei+112|0,Jn=Ei+96|0,vn=Ei+80|0,y[C>>2]=m,y[Ue>>2]=y[g>>2],y[Ue+4>>2]=y[g+4>>2],y[Ue+8>>2]=y[g+8>>2],y[Ue+12>>2]=y[g+12>>2],Ife(Ue,C,On),y[T>>2]=0,Ue=w+_+((w|0)==5&1)|0,(Ue|0)<=(_|0)){Y=Ei;return}F=y[C>>2]|0,V=Si+4|0,J=Be+4|0,ce=_+5|0,_e=16880+(F<<2)|0,ve=16960+(F<<2)|0,ge=Tt+8|0,Re=Nt+8|0,Ze=Jn+8|0,je=_i+4|0,$=_;e:for(;;){P=On+((($|0)%5|0)<<4)|0,y[_i>>2]=y[P>>2],y[_i+4>>2]=y[P+4>>2],y[_i+8>>2]=y[P+8>>2],y[_i+12>>2]=y[P+12>>2];do;while((NE(_i,F,0,1)|0)==2);if(($|0)>(_|0)&(Pp(m)|0)!=0){if(y[Be>>2]=y[_i>>2],y[Be+4>>2]=y[_i+4>>2],y[Be+8>>2]=y[_i+8>>2],y[Be+12>>2]=y[_i+12>>2],Aw(V,Me),w=y[Be>>2]|0,C=y[17040+(w*80|0)+(y[Si>>2]<<2)>>2]|0,y[Be>>2]=y[18640+(w*80|0)+(C*20|0)>>2],P=y[18640+(w*80|0)+(C*20|0)+16>>2]|0,(P|0)>0){g=0;do Mfe(J),g=g+1|0;while((g|0)<(P|0))}switch(P=18640+(w*80|0)+(C*20|0)+4|0,y[Lt>>2]=y[P>>2],y[Lt+4>>2]=y[P+4>>2],y[Lt+8>>2]=y[P+8>>2],Sfe(Lt,(y[_e>>2]|0)*3|0),Mu(J,Lt,J),Bc(J),Aw(J,Zt),As=+(y[ve>>2]|0),ie[Tt>>3]=As*3,ie[ge>>3]=0,ci=As*-1.5,ie[Nt>>3]=ci,ie[Re>>3]=As*2.598076211353316,ie[Jn>>3]=ci,ie[Ze>>3]=As*-2.598076211353316,y[17040+((y[Be>>2]|0)*80|0)+(y[_i>>2]<<2)>>2]|0){case 1:{g=Nt,w=Tt;break}case 3:{g=Jn,w=Nt;break}case 2:{g=Tt,w=Jn;break}default:{g=12;break e}}Hfe(Me,Zt,w,g,vn),UP(vn,y[Be>>2]|0,F,1,T+8+(y[T>>2]<<4)|0),y[T>>2]=(y[T>>2]|0)+1}if(($|0)<(ce|0)&&(Aw(je,Be),UP(Be,y[_i>>2]|0,F,1,T+8+(y[T>>2]<<4)|0),y[T>>2]=(y[T>>2]|0)+1),y[Si>>2]=y[_i>>2],y[Si+4>>2]=y[_i+4>>2],y[Si+8>>2]=y[_i+8>>2],y[Si+12>>2]=y[_i+12>>2],$=$+1|0,($|0)>=(Ue|0)){g=3;break}}if((g|0)==3){Y=Ei;return}else(g|0)==12&&Sr(22522,22569,571,22579)}function Ife(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0;F=Y,Y=Y+128|0,w=F+64|0,T=F,C=w,P=20240,$=C+60|0;do y[C>>2]=y[P>>2],C=C+4|0,P=P+4|0;while((C|0)<($|0));C=T,P=20304,$=C+60|0;do y[C>>2]=y[P>>2],C=C+4|0,P=P+4|0;while((C|0)<($|0));$=(Pp(y[m>>2]|0)|0)==0,w=$?w:T,T=g+4|0,Rfe(T),Ofe(T),Pp(y[m>>2]|0)|0&&(yw(T),y[m>>2]=(y[m>>2]|0)+1),y[_>>2]=y[g>>2],m=_+4|0,Mu(T,w,m),Bc(m),y[_+16>>2]=y[g>>2],m=_+20|0,Mu(T,w+12|0,m),Bc(m),y[_+32>>2]=y[g>>2],m=_+36|0,Mu(T,w+24|0,m),Bc(m),y[_+48>>2]=y[g>>2],m=_+52|0,Mu(T,w+36|0,m),Bc(m),y[_+64>>2]=y[g>>2],_=_+68|0,Mu(T,w+48|0,_),Bc(_),Y=F}function NE(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0;if(ge=Y,Y=Y+32|0,_e=ge+12|0,$=ge,ve=g+4|0,ce=y[16960+(m<<2)>>2]|0,J=(w|0)!=0,ce=J?ce*3|0:ce,T=y[ve>>2]|0,V=g+8|0,P=y[V>>2]|0,J){if(C=g+12|0,w=y[C>>2]|0,T=P+T+w|0,(T|0)==(ce|0))return ve=1,Y=ge,ve|0;F=C}else F=g+12|0,w=y[F>>2]|0,T=P+T+w|0;if((T|0)<=(ce|0))return ve=0,Y=ge,ve|0;do if((w|0)>0){if(w=y[g>>2]|0,(P|0)>0){C=18640+(w*80|0)+60|0,w=g;break}w=18640+(w*80|0)+40|0,_?(LQe(_e,ce,0,0),fq(ve,_e,$),LF($),Mu($,_e,ve),C=w,w=g):(C=w,w=g)}else C=18640+((y[g>>2]|0)*80|0)+20|0,w=g;while(0);if(y[w>>2]=y[C>>2],T=C+16|0,(y[T>>2]|0)>0){w=0;do Mfe(ve),w=w+1|0;while((w|0)<(y[T>>2]|0))}return g=C+4|0,y[_e>>2]=y[g>>2],y[_e+4>>2]=y[g+4>>2],y[_e+8>>2]=y[g+8>>2],m=y[16880+(m<<2)>>2]|0,Sfe(_e,J?m*3|0:m),Mu(ve,_e,ve),Bc(ve),J?w=((y[V>>2]|0)+(y[ve>>2]|0)+(y[F>>2]|0)|0)==(ce|0)?1:2:w=2,ve=w,Y=ge,ve|0}function eYe(g,m){g=g|0,m=m|0;var _=0;do _=NE(g,m,0,1)|0;while((_|0)==2);return _|0}function Aq(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0,Be=0,Me=0,Lt=0,Zt=0,Tt=0,Nt=0,Jn=0,vn=0,On=0;if(Jn=Y,Y=Y+240|0,C=Jn+224|0,Lt=Jn+208|0,Zt=Jn,Tt=Jn+192|0,Nt=Jn+176|0,Ze=Jn+160|0,je=Jn+144|0,Ue=Jn+128|0,Be=Jn+112|0,Me=Jn+96|0,y[C>>2]=m,y[Lt>>2]=y[g>>2],y[Lt+4>>2]=y[g+4>>2],y[Lt+8>>2]=y[g+8>>2],y[Lt+12>>2]=y[g+12>>2],$fe(Lt,C,Zt),y[T>>2]=0,Re=w+_+((w|0)==6&1)|0,(Re|0)<=(_|0)){Y=Jn;return}F=y[C>>2]|0,V=_+6|0,J=16960+(F<<2)|0,ce=je+8|0,_e=Ue+8|0,ve=Be+8|0,ge=Tt+4|0,P=0,$=_,w=-1;e:for(;;){if(C=($|0)%6|0,g=Zt+(C<<4)|0,y[Tt>>2]=y[g>>2],y[Tt+4>>2]=y[g+4>>2],y[Tt+8>>2]=y[g+8>>2],y[Tt+12>>2]=y[g+12>>2],g=P,P=NE(Tt,F,0,1)|0,($|0)>(_|0)&(Pp(m)|0)!=0&&(g|0)!=1&&(y[Tt>>2]|0)!=(w|0)){switch(Aw(Zt+(((C+5|0)%6|0)<<4)+4|0,Nt),Aw(Zt+(C<<4)+4|0,Ze),vn=+(y[J>>2]|0),ie[je>>3]=vn*3,ie[ce>>3]=0,On=vn*-1.5,ie[Ue>>3]=On,ie[_e>>3]=vn*2.598076211353316,ie[Be>>3]=On,ie[ve>>3]=vn*-2.598076211353316,C=y[Lt>>2]|0,y[17040+(C*80|0)+(((w|0)==(C|0)?y[Tt>>2]|0:w)<<2)>>2]|0){case 1:{g=Ue,w=je;break}case 3:{g=Be,w=Ue;break}case 2:{g=je,w=Be;break}default:{g=8;break e}}Hfe(Nt,Ze,w,g,Me),!(qfe(Nt,Me)|0)&&!(qfe(Ze,Me)|0)&&(UP(Me,y[Lt>>2]|0,F,1,T+8+(y[T>>2]<<4)|0),y[T>>2]=(y[T>>2]|0)+1)}if(($|0)<(V|0)&&(Aw(ge,Nt),UP(Nt,y[Tt>>2]|0,F,1,T+8+(y[T>>2]<<4)|0),y[T>>2]=(y[T>>2]|0)+1),$=$+1|0,($|0)>=(Re|0)){g=3;break}else w=y[Tt>>2]|0}if((g|0)==3){Y=Jn;return}else(g|0)==8&&Sr(22606,22569,736,22651)}function $fe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0;F=Y,Y=Y+160|0,w=F+80|0,T=F,C=w,P=20368,$=C+72|0;do y[C>>2]=y[P>>2],C=C+4|0,P=P+4|0;while((C|0)<($|0));C=T,P=20448,$=C+72|0;do y[C>>2]=y[P>>2],C=C+4|0,P=P+4|0;while((C|0)<($|0));$=(Pp(y[m>>2]|0)|0)==0,w=$?w:T,T=g+4|0,Rfe(T),Ofe(T),Pp(y[m>>2]|0)|0&&(yw(T),y[m>>2]=(y[m>>2]|0)+1),y[_>>2]=y[g>>2],m=_+4|0,Mu(T,w,m),Bc(m),y[_+16>>2]=y[g>>2],m=_+20|0,Mu(T,w+12|0,m),Bc(m),y[_+32>>2]=y[g>>2],m=_+36|0,Mu(T,w+24|0,m),Bc(m),y[_+48>>2]=y[g>>2],m=_+52|0,Mu(T,w+36|0,m),Bc(m),y[_+64>>2]=y[g>>2],m=_+68|0,Mu(T,w+48|0,m),Bc(m),y[_+80>>2]=y[g>>2],_=_+84|0,Mu(T,w+60|0,_),Bc(_),Y=F}function tYe(g,m){return g=g|0,m=m|0,m=dt(g|0,m|0,52)|0,he()|0,m&15|0}function Dfe(g,m){return g=g|0,m=m|0,m=dt(g|0,m|0,45)|0,he()|0,m&127|0}function yq(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0,$=0;if(!(!0&(m&-16777216|0)==134217728)||(P=dt(g|0,m|0,45)|0,he()|0,P=P&127,P>>>0>121))return m=0,m|0;_=dt(g|0,m|0,52)|0,he()|0,_=_&15;do if(_|0){for(T=1,w=0;;){if(C=dt(g|0,m|0,(15-T|0)*3|0)|0,he()|0,C=C&7,(C|0)!=0&(w^1))if((C|0)==1&(Zs(P)|0)!=0){$=0,w=13;break}else w=1;if((C|0)==7){$=0,w=13;break}if(T>>>0<_>>>0)T=T+1|0;else{w=9;break}}if((w|0)==9){if((_|0)==15)$=1;else break;return $|0}else if((w|0)==13)return $|0}while(0);for(;;){if($=dt(g|0,m|0,(14-_|0)*3|0)|0,he()|0,!(($&7|0)==7&!0)){$=0,w=13;break}if(_>>>0<14)_=_+1|0;else{$=1,w=13;break}}return(w|0)==13?$|0:0}function _q(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0;if(C=dt(g|0,m|0,52)|0,he()|0,C=C&15,_>>>0>15)return w=4,w|0;if((C|0)<(_|0))return w=12,w|0;if((C|0)==(_|0))return y[w>>2]=g,y[w+4>>2]=m,w=0,w|0;if(T=Mt(_|0,0,52)|0,T=T|g,g=he()|0|m&-15728641,(C|0)>(_|0))do m=Mt(7,0,(14-_|0)*3|0)|0,_=_+1|0,T=m|T,g=he()|0|g;while((_|0)<(C|0));return y[w>>2]=T,y[w+4>>2]=g,w=0,w|0}function FF(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0;if(C=dt(g|0,m|0,52)|0,he()|0,C=C&15,!((_|0)<16&(C|0)<=(_|0)))return w=4,w|0;T=_-C|0,_=dt(g|0,m|0,45)|0,he()|0;e:do if(!(Zs(_&127)|0))_=B1(7,0,T,((T|0)<0)<<31>>31)|0,T=he()|0;else{t:do if(C|0){for(_=1;P=Mt(7,0,(15-_|0)*3|0)|0,!!((P&g|0)==0&((he()|0)&m|0)==0);)if(_>>>0<C>>>0)_=_+1|0;else break t;_=B1(7,0,T,((T|0)<0)<<31>>31)|0,T=he()|0;break e}while(0);_=B1(7,0,T,((T|0)<0)<<31>>31)|0,_=Vc(_|0,he()|0,5,0)|0,_=Qi(_|0,he()|0,-5,-1)|0,_=bw(_|0,he()|0,6,0)|0,_=Qi(_|0,he()|0,1,0)|0,T=he()|0}while(0);return P=w,y[P>>2]=_,y[P+4>>2]=T,P=0,P|0}function Js(g,m){g=g|0,m=m|0;var _=0,w=0,T=0;if(T=dt(g|0,m|0,45)|0,he()|0,!(Zs(T&127)|0))return T=0,T|0;T=dt(g|0,m|0,52)|0,he()|0,T=T&15;e:do if(!T)_=0;else for(w=1;;){if(_=dt(g|0,m|0,(15-w|0)*3|0)|0,he()|0,_=_&7,_|0)break e;if(w>>>0<T>>>0)w=w+1|0;else{_=0;break}}while(0);return T=(_|0)==0&1,T|0}function rYe(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0;if(P=Y,Y=Y+16|0,C=P,Ffe(C,g,m,_),m=C,g=y[m>>2]|0,m=y[m+4>>2]|0,(g|0)==0&(m|0)==0)return Y=P,0;T=0,_=0;do $=w+(T<<3)|0,y[$>>2]=g,y[$+4>>2]=m,T=Qi(T|0,_|0,1,0)|0,_=he()|0,kfe(C),$=C,g=y[$>>2]|0,m=y[$+4>>2]|0;while(!((g|0)==0&(m|0)==0));return Y=P,0}function iYe(g,m,_,w){return g=g|0,m=m|0,_=_|0,w=w|0,(w|0)<(_|0)?(_=m,w=g,Xr(_|0),w|0):(_=Mt(-1,-1,((w-_|0)*3|0)+3|0)|0,w=Mt(~_|0,~(he()|0)|0,(15-w|0)*3|0)|0,_=~(he()|0)&m,w=~w&g,Xr(_|0),w|0)}function nYe(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0;return T=dt(g|0,m|0,52)|0,he()|0,T=T&15,(_|0)<16&(T|0)<=(_|0)?((T|0)<(_|0)&&(T=Mt(-1,-1,((_+-1-T|0)*3|0)+3|0)|0,T=Mt(~T|0,~(he()|0)|0,(15-_|0)*3|0)|0,m=~(he()|0)&m,g=~T&g),T=Mt(_|0,0,52)|0,_=m&-15728641|(he()|0),y[w>>2]=g|T,y[w+4>>2]=_,w=0,w|0):(w=4,w|0)}function sYe(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0,Be=0,Me=0,Lt=0,Zt=0,Tt=0,Nt=0;if((_|0)==0&(w|0)==0)return Tt=0,Tt|0;if(T=g,C=y[T>>2]|0,T=y[T+4>>2]|0,!0&(T&15728640|0)==0){if(!((w|0)>0|(w|0)==0&_>>>0>0)||(Tt=m,y[Tt>>2]=C,y[Tt+4>>2]=T,(_|0)==1&(w|0)==0))return Tt=0,Tt|0;T=1;do Lt=g+(T<<3)|0,Zt=y[Lt+4>>2]|0,Tt=m+(T<<3)|0,y[Tt>>2]=y[Lt>>2],y[Tt+4>>2]=Zt,T=T+1|0;while(0<(w|0)|(w|0)==0&T>>>0<_>>>0);return T=0,T|0}if(Me=_<<3,Zt=Zm(Me)|0,!Zt)return Tt=13,Tt|0;if(BF(Zt|0,g|0,Me|0)|0,Lt=Jm(_,8)|0,!Lt)return li(Zt),Tt=13,Tt|0;e:do if(_|0){t:for(;;){T=Zt,je=y[T>>2]|0,T=y[T+4>>2]|0,Ue=dt(je|0,T|0,52)|0,he()|0,Ue=Ue&15,Be=Ue+-1|0,Ze=(_|0)>0;r:do if((Ue|0)!=0&Ze){if(ve=((_|0)<0)<<31>>31,ge=Mt(Be|0,0,52)|0,Re=he()|0,Be>>>0>15){if(!((je|0)==0&(T|0)==0)){Tt=17;break t}for(C=0;;){if(C=C+1|0,(C|0)>=(_|0))break r;if(w=Zt+(C<<3)|0,Re=y[w>>2]|0,w=y[w+4>>2]|0,!((Re|0)==0&(w|0)==0)){T=w,Tt=17;break t}}}for(C=0,g=je,w=T;;){if(!((g|0)==0&(w|0)==0)){if(!(!0&(w&117440512|0)==0)){Tt=22;break t}if($=dt(g|0,w|0,52)|0,he()|0,$=$&15,($|0)<(Be|0)){T=12,Tt=28;break t}if(($|0)!=(Be|0)&&(g=g|ge,w=w&-15728641|Re,$>>>0>=Ue>>>0)){P=Be;do _e=Mt(7,0,(14-P|0)*3|0)|0,P=P+1|0,g=_e|g,w=he()|0|w;while(P>>>0<$>>>0)}if(P=UE(g|0,w|0,_|0,ve|0)|0,he()|0,V=Lt+(P<<3)|0,$=V,F=y[$>>2]|0,$=y[$+4>>2]|0,(F|0)==0&($|0)==0)P=V;else for(_e=0;;){if((_e|0)>(_|0)){Tt=32;break t}if((F|0)==(g|0)&($&-117440513|0)==(w|0)){J=dt(F|0,$|0,56)|0,he()|0,J=J&7,ce=J+1|0,Nt=dt(F|0,$|0,45)|0,he()|0;i:do if(!(Zs(Nt&127)|0))$=7;else{if(F=dt(F|0,$|0,52)|0,he()|0,F=F&15,!F){$=6;break}for($=1;;){if(Nt=Mt(7,0,(15-$|0)*3|0)|0,!((Nt&g|0)==0&((he()|0)&w|0)==0)){$=7;break i}if($>>>0<F>>>0)$=$+1|0;else{$=6;break}}}while(0);if((J+2|0)>>>0>$>>>0){Tt=42;break t}Nt=Mt(ce|0,0,56)|0,w=he()|0|w&-117440513,ce=V,y[ce>>2]=0,y[ce+4>>2]=0,g=Nt|g}else P=(P+1|0)%(_|0)|0;if(V=Lt+(P<<3)|0,$=V,F=y[$>>2]|0,$=y[$+4>>2]|0,(F|0)==0&($|0)==0){P=V;break}else _e=_e+1|0}Nt=P,y[Nt>>2]=g,y[Nt+4>>2]=w}if(C=C+1|0,(C|0)>=(_|0))break r;w=Zt+(C<<3)|0,g=y[w>>2]|0,w=y[w+4>>2]|0}}while(0);if((_+5|0)>>>0<11){Tt=85;break}if(Re=Jm((_|0)/6|0,8)|0,!Re){Tt=49;break}r:do if(Ze){_e=0,ce=0;do{if($=Lt+(_e<<3)|0,w=$,C=y[w>>2]|0,w=y[w+4>>2]|0,!((C|0)==0&(w|0)==0)){F=dt(C|0,w|0,56)|0,he()|0,F=F&7,g=F+1|0,V=w&-117440513,Nt=dt(C|0,w|0,45)|0,he()|0;i:do if(Zs(Nt&127)|0){if(J=dt(C|0,w|0,52)|0,he()|0,J=J&15,J|0)for(P=1;;){if(Nt=Mt(7,0,(15-P|0)*3|0)|0,!((C&Nt|0)==0&(V&(he()|0)|0)==0))break i;if(P>>>0<J>>>0)P=P+1|0;else break}w=Mt(g|0,0,56)|0,C=w|C,w=he()|0|V,g=$,y[g>>2]=C,y[g+4>>2]=w,g=F+2|0}while(0);(g|0)==7&&(Nt=Re+(ce<<3)|0,y[Nt>>2]=C,y[Nt+4>>2]=w&-117440513,ce=ce+1|0)}_e=_e+1|0}while((_e|0)!=(_|0));if(Ze){if(_e=((_|0)<0)<<31>>31,ve=Mt(Be|0,0,52)|0,ge=he()|0,Be>>>0>15){if(!((je|0)==0&(T|0)==0)){T=4,Tt=84;break t}for(T=0;;){if(T=T+1|0,(T|0)>=(_|0)){C=0,T=ce;break r}if(Nt=Zt+(T<<3)|0,!((y[Nt>>2]|0)==0&(y[Nt+4>>2]|0)==0)){T=4,Tt=84;break t}}}for(J=0,C=0,V=je;;){do if(!((V|0)==0&(T|0)==0)){if($=dt(V|0,T|0,52)|0,he()|0,$=$&15,($|0)<(Be|0)){T=12,Tt=84;break t}do if(($|0)==(Be|0))w=V,$=T;else{if(w=V|ve,g=T&-15728641|ge,$>>>0<Ue>>>0){$=g;break}P=Be;do Nt=Mt(7,0,(14-P|0)*3|0)|0,P=P+1|0,w=Nt|w,g=he()|0|g;while(P>>>0<$>>>0);$=g}while(0);for(P=UE(w|0,$|0,_|0,_e|0)|0,he()|0,g=0;;){if((g|0)>(_|0)){Tt=77;break t}if(Nt=Lt+(P<<3)|0,F=y[Nt+4>>2]|0,(F&-117440513|0)==($|0)&&(y[Nt>>2]|0)==(w|0)){Tt=79;break}if(P=(P+1|0)%(_|0)|0,Nt=Lt+(P<<3)|0,(y[Nt>>2]|0)==(w|0)&&(y[Nt+4>>2]|0)==($|0))break;g=g+1|0}if((Tt|0)==79&&(Tt=0,!0&(F&117440512|0)==100663296))break;Nt=m+(C<<3)|0,y[Nt>>2]=V,y[Nt+4>>2]=T,C=C+1|0}while(0);if(T=J+1|0,(T|0)>=(_|0)){T=ce;break r}Nt=Zt+(T<<3)|0,J=T,V=y[Nt>>2]|0,T=y[Nt+4>>2]|0}}else C=0,T=ce}else C=0,T=0;while(0);if(ww(Lt|0,0,Me|0)|0,BF(Zt|0,Re|0,T<<3|0)|0,li(Re),T)m=m+(C<<3)|0,_=T;else break e}if((Tt|0)==17)!0&(T&117440512|0)==0?(T=4,Tt=28):Tt=22;else if((Tt|0)==32)Sr(23313,22674,362,22684);else{if((Tt|0)==42)return li(Zt),li(Lt),Nt=10,Nt|0;if((Tt|0)==49)return li(Zt),li(Lt),Nt=13,Nt|0;if((Tt|0)==77)Sr(23313,22674,462,22684);else{if((Tt|0)==84)return li(Re),li(Zt),li(Lt),Nt=T,Nt|0;if((Tt|0)==85){BF(m|0,Zt|0,_<<3|0)|0;break}}}if((Tt|0)==22)return li(Zt),li(Lt),Nt=5,Nt|0;if((Tt|0)==28)return li(Zt),li(Lt),Nt=T,Nt|0}while(0);return li(Zt),li(Lt),Nt=0,Nt|0}function oYe(g,m,_,w,T,C,P){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0,C=C|0,P=P|0;var $=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0;if(Re=Y,Y=Y+16|0,ge=Re,!((_|0)>0|(_|0)==0&m>>>0>0))return ge=0,Y=Re,ge|0;if((P|0)>=16)return ge=12,Y=Re,ge|0;_e=0,ve=0,ce=0,$=0;e:for(;;){if(V=g+(_e<<3)|0,F=y[V>>2]|0,V=y[V+4>>2]|0,J=dt(F|0,V|0,52)|0,he()|0,(J&15|0)>(P|0)){$=12,F=11;break}if(Ffe(ge,F,V,P),J=ge,V=y[J>>2]|0,J=y[J+4>>2]|0,(V|0)==0&(J|0)==0)F=ce;else{F=ce;do{if(!(($|0)<(C|0)|($|0)==(C|0)&F>>>0<T>>>0)){F=10;break e}ce=w+(F<<3)|0,y[ce>>2]=V,y[ce+4>>2]=J,F=Qi(F|0,$|0,1,0)|0,$=he()|0,kfe(ge),ce=ge,V=y[ce>>2]|0,J=y[ce+4>>2]|0}while(!((V|0)==0&(J|0)==0))}if(_e=Qi(_e|0,ve|0,1,0)|0,ve=he()|0,(ve|0)<(_|0)|(ve|0)==(_|0)&_e>>>0<m>>>0)ce=F;else{$=0,F=11;break}}return(F|0)==10?(ge=14,Y=Re,ge|0):(F|0)==11?(Y=Re,$|0):0}function aYe(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0;_e=Y,Y=Y+16|0,ce=_e;e:do if((_|0)>0|(_|0)==0&m>>>0>0){for(V=0,P=0,C=0,J=0;;){if(F=g+(V<<3)|0,$=y[F>>2]|0,F=y[F+4>>2]|0,!(($|0)==0&(F|0)==0)&&(F=(FF($,F,w,ce)|0)==0,$=ce,P=Qi(y[$>>2]|0,y[$+4>>2]|0,P|0,C|0)|0,C=he()|0,!F)){C=12;break}if(V=Qi(V|0,J|0,1,0)|0,J=he()|0,!((J|0)<(_|0)|(J|0)==(_|0)&V>>>0<m>>>0))break e}return Y=_e,C|0}else P=0,C=0;while(0);return y[T>>2]=P,y[T+4>>2]=C,T=0,Y=_e,T|0}function lYe(g,m){return g=g|0,m=m|0,m=dt(g|0,m|0,52)|0,he()|0,m&1|0}function wh(g,m){g=g|0,m=m|0;var _=0,w=0,T=0;if(T=dt(g|0,m|0,52)|0,he()|0,T=T&15,!T)return T=0,T|0;for(w=1;;){if(_=dt(g|0,m|0,(15-w|0)*3|0)|0,he()|0,_=_&7,_|0){w=5;break}if(w>>>0<T>>>0)w=w+1|0;else{_=0,w=5;break}}return(w|0)==5?_|0:0}function vq(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0,$=0,F=0;if(F=dt(g|0,m|0,52)|0,he()|0,F=F&15,!F)return $=m,F=g,Xr($|0),F|0;for($=1,_=0;;){C=(15-$|0)*3|0,w=Mt(7,0,C|0)|0,T=he()|0,P=dt(g|0,m|0,C|0)|0,he()|0,C=Mt(_w(P&7)|0,0,C|0)|0,P=he()|0,g=C|g&~w,m=P|m&~T;e:do if(!_)if((C&w|0)==0&(P&T|0)==0)_=0;else if(w=dt(g|0,m|0,52)|0,he()|0,w=w&15,!w)_=1;else{_=1;t:for(;;){switch(P=dt(g|0,m|0,(15-_|0)*3|0)|0,he()|0,P&7){case 1:break t;case 0:break;default:{_=1;break e}}if(_>>>0<w>>>0)_=_+1|0;else{_=1;break e}}for(_=1;;)if(P=(15-_|0)*3|0,T=dt(g|0,m|0,P|0)|0,he()|0,C=Mt(7,0,P|0)|0,m=m&~(he()|0),P=Mt(_w(T&7)|0,0,P|0)|0,g=g&~C|P,m=m|(he()|0),_>>>0<w>>>0)_=_+1|0;else{_=1;break}}while(0);if($>>>0<F>>>0)$=$+1|0;else break}return Xr(m|0),g|0}function vw(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0;if(w=dt(g|0,m|0,52)|0,he()|0,w=w&15,!w)return _=m,w=g,Xr(_|0),w|0;for(_=1;C=(15-_|0)*3|0,P=dt(g|0,m|0,C|0)|0,he()|0,T=Mt(7,0,C|0)|0,m=m&~(he()|0),C=Mt(_w(P&7)|0,0,C|0)|0,g=C|g&~T,m=he()|0|m,_>>>0<w>>>0;)_=_+1|0;return Xr(m|0),g|0}function cYe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0,$=0,F=0;if(F=dt(g|0,m|0,52)|0,he()|0,F=F&15,!F)return $=m,F=g,Xr($|0),F|0;for($=1,_=0;;){C=(15-$|0)*3|0,w=Mt(7,0,C|0)|0,T=he()|0,P=dt(g|0,m|0,C|0)|0,he()|0,C=Mt(U1(P&7)|0,0,C|0)|0,P=he()|0,g=C|g&~w,m=P|m&~T;e:do if(!_)if((C&w|0)==0&(P&T|0)==0)_=0;else if(w=dt(g|0,m|0,52)|0,he()|0,w=w&15,!w)_=1;else{_=1;t:for(;;){switch(P=dt(g|0,m|0,(15-_|0)*3|0)|0,he()|0,P&7){case 1:break t;case 0:break;default:{_=1;break e}}if(_>>>0<w>>>0)_=_+1|0;else{_=1;break e}}for(_=1;;)if(T=(15-_|0)*3|0,C=Mt(7,0,T|0)|0,P=m&~(he()|0),m=dt(g|0,m|0,T|0)|0,he()|0,m=Mt(U1(m&7)|0,0,T|0)|0,g=g&~C|m,m=P|(he()|0),_>>>0<w>>>0)_=_+1|0;else{_=1;break}}while(0);if($>>>0<F>>>0)$=$+1|0;else break}return Xr(m|0),g|0}function bq(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0;if(w=dt(g|0,m|0,52)|0,he()|0,w=w&15,!w)return _=m,w=g,Xr(_|0),w|0;for(_=1;P=(15-_|0)*3|0,C=Mt(7,0,P|0)|0,T=m&~(he()|0),m=dt(g|0,m|0,P|0)|0,he()|0,m=Mt(U1(m&7)|0,0,P|0)|0,g=m|g&~C,m=he()|0|T,_>>>0<w>>>0;)_=_+1|0;return Xr(m|0),g|0}function uYe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0;if(F=Y,Y=Y+64|0,$=F+40|0,w=F+24|0,T=F+12|0,C=F,Mt(m|0,0,52)|0,_=he()|0|134225919,!m)return(y[g+4>>2]|0)>2||(y[g+8>>2]|0)>2||(y[g+12>>2]|0)>2?(P=0,$=0,Xr(P|0),Y=F,$|0):(Mt(vfe(g)|0,0,45)|0,P=he()|0|_,$=-1,Xr(P|0),Y=F,$|0);if(y[$>>2]=y[g>>2],y[$+4>>2]=y[g+4>>2],y[$+8>>2]=y[g+8>>2],y[$+12>>2]=y[g+12>>2],P=$+4|0,(m|0)>0)for(g=-1;y[w>>2]=y[P>>2],y[w+4>>2]=y[P+4>>2],y[w+8>>2]=y[P+8>>2],m&1?(UQe(P),y[T>>2]=y[P>>2],y[T+4>>2]=y[P+4>>2],y[T+8>>2]=y[P+8>>2],DF(T)):(Efe(P),y[T>>2]=y[P>>2],y[T+4>>2]=y[P+4>>2],y[T+8>>2]=y[P+8>>2],yw(T)),fq(w,T,C),Bc(C),J=(15-m|0)*3|0,V=Mt(7,0,J|0)|0,_=_&~(he()|0),J=Mt($F(C)|0,0,J|0)|0,g=J|g&~V,_=he()|0|_,(m|0)>1;)m=m+-1|0;else g=-1;e:do if((y[P>>2]|0)<=2&&(y[$+8>>2]|0)<=2&&(y[$+12>>2]|0)<=2){if(w=vfe($)|0,m=Mt(w|0,0,45)|0,m=m|g,g=he()|0|_&-1040385,C=RQe($)|0,!(Zs(w)|0)){if((C|0)<=0)break;for(T=0;;){if(w=dt(m|0,g|0,52)|0,he()|0,w=w&15,w)for(_=1;J=(15-_|0)*3|0,$=dt(m|0,g|0,J|0)|0,he()|0,V=Mt(7,0,J|0)|0,g=g&~(he()|0),J=Mt(_w($&7)|0,0,J|0)|0,m=m&~V|J,g=g|(he()|0),_>>>0<w>>>0;)_=_+1|0;if(T=T+1|0,(T|0)==(C|0))break e}}T=dt(m|0,g|0,52)|0,he()|0,T=T&15;t:do if(T){_=1;r:for(;;){switch(J=dt(m|0,g|0,(15-_|0)*3|0)|0,he()|0,J&7){case 1:break r;case 0:break;default:break t}if(_>>>0<T>>>0)_=_+1|0;else break t}if(bfe(w,y[$>>2]|0)|0)for(_=1;$=(15-_|0)*3|0,V=Mt(7,0,$|0)|0,J=g&~(he()|0),g=dt(m|0,g|0,$|0)|0,he()|0,g=Mt(U1(g&7)|0,0,$|0)|0,m=m&~V|g,g=J|(he()|0),_>>>0<T>>>0;)_=_+1|0;else for(_=1;J=(15-_|0)*3|0,$=dt(m|0,g|0,J|0)|0,he()|0,V=Mt(7,0,J|0)|0,g=g&~(he()|0),J=Mt(_w($&7)|0,0,J|0)|0,m=m&~V|J,g=g|(he()|0),_>>>0<T>>>0;)_=_+1|0}while(0);if((C|0)>0){_=0;do m=vq(m,g)|0,g=he()|0,_=_+1|0;while((_|0)!=(C|0))}}else m=0,g=0;while(0);return V=g,J=m,Xr(V|0),Y=F,J|0}function Pp(g){return g=g|0,(g|0)%2|0|0}function Lfe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0;return T=Y,Y=Y+16|0,w=T,m>>>0>15?(w=4,Y=T,w|0):(y[g+4>>2]&2146435072|0)==2146435072||(y[g+8+4>>2]&2146435072|0)==2146435072?(w=3,Y=T,w|0):(XQe(g,m,w),m=uYe(w,m)|0,w=he()|0,y[_>>2]=m,y[_+4>>2]=w,(m|0)==0&(w|0)==0&&Sr(23313,22674,786,22697),w=0,Y=T,w|0)}function wq(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0;if(T=_+4|0,C=dt(g|0,m|0,52)|0,he()|0,C=C&15,P=dt(g|0,m|0,45)|0,he()|0,w=(C|0)==0,Zs(P&127)|0){if(w)return P=1,P|0;w=1}else{if(w)return P=0,P|0;!(y[T>>2]|0)&&!(y[_+8>>2]|0)?w=(y[_+12>>2]|0)!=0&1:w=1}for(_=1;_&1?DF(T):yw(T),P=dt(g|0,m|0,(15-_|0)*3|0)|0,he()|0,Cfe(T,P&7),_>>>0<C>>>0;)_=_+1|0;return w|0}function FE(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0;if(J=Y,Y=Y+16|0,F=J,V=dt(g|0,m|0,45)|0,he()|0,V=V&127,V>>>0>121)return y[_>>2]=0,y[_+4>>2]=0,y[_+8>>2]=0,y[_+12>>2]=0,V=5,Y=J,V|0;e:do if(Zs(V)|0&&(C=dt(g|0,m|0,52)|0,he()|0,C=C&15,(C|0)!=0)){w=1;t:for(;;){switch($=dt(g|0,m|0,(15-w|0)*3|0)|0,he()|0,$&7){case 5:break t;case 0:break;default:{w=m;break e}}if(w>>>0<C>>>0)w=w+1|0;else{w=m;break e}}for(T=1,w=m;m=(15-T|0)*3|0,P=Mt(7,0,m|0)|0,$=w&~(he()|0),w=dt(g|0,w|0,m|0)|0,he()|0,w=Mt(U1(w&7)|0,0,m|0)|0,g=g&~P|w,w=$|(he()|0),T>>>0<C>>>0;)T=T+1|0}else w=m;while(0);if($=7696+(V*28|0)|0,y[_>>2]=y[$>>2],y[_+4>>2]=y[$+4>>2],y[_+8>>2]=y[$+8>>2],y[_+12>>2]=y[$+12>>2],!(wq(g,w,_)|0))return V=0,Y=J,V|0;if(P=_+4|0,y[F>>2]=y[P>>2],y[F+4>>2]=y[P+4>>2],y[F+8>>2]=y[P+8>>2],C=dt(g|0,w|0,52)|0,he()|0,$=C&15,C&1?(yw(P),C=$+1|0):C=$,!(Zs(V)|0))w=0;else{e:do if(!$)w=0;else for(m=1;;){if(T=dt(g|0,w|0,(15-m|0)*3|0)|0,he()|0,T=T&7,T|0){w=T;break e}if(m>>>0<$>>>0)m=m+1|0;else{w=0;break}}while(0);w=(w|0)==4&1}if(!(NE(_,C,w,0)|0))(C|0)!=($|0)&&(y[P>>2]=y[F>>2],y[P+4>>2]=y[F+4>>2],y[P+8>>2]=y[F+8>>2]);else{if(Zs(V)|0)do;while(NE(_,C,0,0)|0);(C|0)!=($|0)&&Efe(P)}return V=0,Y=J,V|0}function BP(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0;return C=Y,Y=Y+16|0,w=C,T=FE(g,m,w)|0,T|0?(Y=C,T|0):(T=dt(g|0,m|0,52)|0,he()|0,KQe(w,T&15,_),T=0,Y=C,T|0)}function zP(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0;if(P=Y,Y=Y+16|0,C=P,w=FE(g,m,C)|0,w|0)return C=w,Y=P,C|0;w=dt(g|0,m|0,45)|0,he()|0,w=(Zs(w&127)|0)==0,T=dt(g|0,m|0,52)|0,he()|0,T=T&15;e:do if(!w){if(T|0)for(w=1;;){if($=Mt(7,0,(15-w|0)*3|0)|0,!(($&g|0)==0&((he()|0)&m|0)==0))break e;if(w>>>0<T>>>0)w=w+1|0;else break}return gq(C,T,0,5,_),$=0,Y=P,$|0}while(0);return Aq(C,T,0,6,_),$=0,Y=P,$|0}function hYe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0;if(T=dt(g|0,m|0,45)|0,he()|0,!(Zs(T&127)|0))return T=2,y[_>>2]=T,0;if(T=dt(g|0,m|0,52)|0,he()|0,T=T&15,!T)return T=5,y[_>>2]=T,0;for(w=1;;){if(C=Mt(7,0,(15-w|0)*3|0)|0,!((C&g|0)==0&((he()|0)&m|0)==0)){w=2,g=6;break}if(w>>>0<T>>>0)w=w+1|0;else{w=5,g=6;break}}return(g|0)==6&&(y[_>>2]=w),0}function Nfe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0;ce=Y,Y=Y+128|0,V=ce+112|0,C=ce+96|0,J=ce,T=dt(g|0,m|0,52)|0,he()|0,$=T&15,y[V>>2]=$,P=dt(g|0,m|0,45)|0,he()|0,P=P&127;e:do if(Zs(P)|0){if($|0)for(w=1;;){if(F=Mt(7,0,(15-w|0)*3|0)|0,!((F&g|0)==0&((he()|0)&m|0)==0)){T=0;break e}if(w>>>0<$>>>0)w=w+1|0;else break}if(T&1)T=1;else return F=Mt($+1|0,0,52)|0,J=he()|0|m&-15728641,V=Mt(7,0,(14-$|0)*3|0)|0,J=Nfe((F|g)&~V,J&~(he()|0),_)|0,Y=ce,J|0}else T=0;while(0);if(w=FE(g,m,C)|0,!w){T?(Ife(C,V,J),F=5):($fe(C,V,J),F=6);e:do if(Zs(P)|0)if(!$)g=5;else for(w=1;;){if(P=Mt(7,0,(15-w|0)*3|0)|0,!((P&g|0)==0&((he()|0)&m|0)==0)){g=2;break e}if(w>>>0<$>>>0)w=w+1|0;else{g=5;break}}else g=2;while(0);ww(_|0,-1,g<<2|0)|0;e:do if(T)for(C=0;;){if(P=J+(C<<4)|0,eYe(P,y[V>>2]|0)|0,P=y[P>>2]|0,$=y[_>>2]|0,($|0)==-1|($|0)==(P|0))w=_;else{T=0;do{if(T=T+1|0,T>>>0>=g>>>0){w=1;break e}w=_+(T<<2)|0,$=y[w>>2]|0}while(!(($|0)==-1|($|0)==(P|0)))}if(y[w>>2]=P,C=C+1|0,C>>>0>=F>>>0){w=0;break}}else for(C=0;;){if(P=J+(C<<4)|0,NE(P,y[V>>2]|0,0,1)|0,P=y[P>>2]|0,$=y[_>>2]|0,($|0)==-1|($|0)==(P|0))w=_;else{T=0;do{if(T=T+1|0,T>>>0>=g>>>0){w=1;break e}w=_+(T<<2)|0,$=y[w>>2]|0}while(!(($|0)==-1|($|0)==(P|0)))}if(y[w>>2]=P,C=C+1|0,C>>>0>=F>>>0){w=0;break}}while(0)}return J=w,Y=ce,J|0}function dYe(){return 12}function xq(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0,$=0,F=0;if(g>>>0>15)return $=4,$|0;if(Mt(g|0,0,52)|0,$=he()|0|134225919,!g){_=0,w=0;do Zs(w)|0&&(Mt(w|0,0,45)|0,P=$|(he()|0),g=m+(_<<3)|0,y[g>>2]=-1,y[g+4>>2]=P,_=_+1|0),w=w+1|0;while((w|0)!=122);return _=0,_|0}_=0,P=0;do{if(Zs(P)|0){for(Mt(P|0,0,45)|0,w=1,T=-1,C=$|(he()|0);F=Mt(7,0,(15-w|0)*3|0)|0,T=T&~F,C=C&~(he()|0),(w|0)!=(g|0);)w=w+1|0;F=m+(_<<3)|0,y[F>>2]=T,y[F+4>>2]=C,_=_+1|0}P=P+1|0}while((P|0)!=122);return _=0,_|0}function pYe(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0;if(Ue=Y,Y=Y+16|0,Ze=Ue,je=dt(g|0,m|0,52)|0,he()|0,je=je&15,_>>>0>15)return je=4,Y=Ue,je|0;if((je|0)<(_|0))return je=12,Y=Ue,je|0;if((je|0)!=(_|0))if(C=Mt(_|0,0,52)|0,C=C|g,$=he()|0|m&-15728641,(je|0)>(_|0)){F=_;do Re=Mt(7,0,(14-F|0)*3|0)|0,F=F+1|0,C=Re|C,$=he()|0|$;while((F|0)<(je|0));Re=C}else Re=C;else Re=g,$=m;ge=dt(Re|0,$|0,45)|0,he()|0;e:do if(Zs(ge&127)|0){if(F=dt(Re|0,$|0,52)|0,he()|0,F=F&15,F|0)for(C=1;;){if(ge=Mt(7,0,(15-C|0)*3|0)|0,!((ge&Re|0)==0&((he()|0)&$|0)==0)){V=33;break e}if(C>>>0<F>>>0)C=C+1|0;else break}if(ge=w,y[ge>>2]=0,y[ge+4>>2]=0,(je|0)>(_|0)){for(ge=m&-15728641,ve=je;;){if(_e=ve,ve=ve+-1|0,ve>>>0>15|(je|0)<(ve|0)){V=19;break}if((je|0)!=(ve|0))if(C=Mt(ve|0,0,52)|0,C=C|g,F=he()|0|ge,(je|0)<(_e|0))ce=C;else{V=ve;do ce=Mt(7,0,(14-V|0)*3|0)|0,V=V+1|0,C=ce|C,F=he()|0|F;while((V|0)<(je|0));ce=C}else ce=g,F=m;if(J=dt(ce|0,F|0,45)|0,he()|0,!(Zs(J&127)|0))C=0;else{J=dt(ce|0,F|0,52)|0,he()|0,J=J&15;t:do if(!J)C=0;else for(V=1;;){if(C=dt(ce|0,F|0,(15-V|0)*3|0)|0,he()|0,C=C&7,C|0)break t;if(V>>>0<J>>>0)V=V+1|0;else{C=0;break}}while(0);C=(C|0)==0&1}if(F=dt(g|0,m|0,(15-_e|0)*3|0)|0,he()|0,F=F&7,(F|0)==7){T=5,V=42;break}if(C=(C|0)!=0,(F|0)==1&C){T=5,V=42;break}if(ce=F+(((F|0)!=0&C)<<31>>31)|0,ce|0&&(V=je-_e|0,V=B1(7,0,V,((V|0)<0)<<31>>31)|0,J=he()|0,C?(C=Vc(V|0,J|0,5,0)|0,C=Qi(C|0,he()|0,-5,-1)|0,C=bw(C|0,he()|0,6,0)|0,C=Qi(C|0,he()|0,1,0)|0,F=he()|0):(C=V,F=J),_e=ce+-1|0,_e=Vc(V|0,J|0,_e|0,((_e|0)<0)<<31>>31|0)|0,_e=Qi(C|0,F|0,_e|0,he()|0)|0,ce=he()|0,J=w,J=Qi(_e|0,ce|0,y[J>>2]|0,y[J+4>>2]|0)|0,ce=he()|0,_e=w,y[_e>>2]=J,y[_e+4>>2]=ce),(ve|0)<=(_|0)){V=37;break}}if((V|0)==19)Sr(23313,22674,1099,22710);else if((V|0)==37){P=w,T=y[P+4>>2]|0,P=y[P>>2]|0;break}else if((V|0)==42)return Y=Ue,T|0}else T=0,P=0}else V=33;while(0);e:do if((V|0)==33)if(ge=w,y[ge>>2]=0,y[ge+4>>2]=0,(je|0)>(_|0)){for(C=je;;){if(T=dt(g|0,m|0,(15-C|0)*3|0)|0,he()|0,T=T&7,(T|0)==7){T=5;break}if(P=je-C|0,P=B1(7,0,P,((P|0)<0)<<31>>31)|0,T=Vc(P|0,he()|0,T|0,0)|0,P=he()|0,ge=w,P=Qi(y[ge>>2]|0,y[ge+4>>2]|0,T|0,P|0)|0,T=he()|0,ge=w,y[ge>>2]=P,y[ge+4>>2]=T,C=C+-1|0,(C|0)<=(_|0))break e}return Y=Ue,T|0}else T=0,P=0;while(0);return FF(Re,$,je,Ze)|0&&Sr(23313,22674,1063,22725),je=Ze,Ze=y[je+4>>2]|0,((T|0)>-1|(T|0)==-1&P>>>0>4294967295)&((Ze|0)>(T|0)|((Ze|0)==(T|0)?(y[je>>2]|0)>>>0>P>>>0:0))?(je=0,Y=Ue,je|0):(Sr(23313,22674,1139,22710),0)}function fYe(g,m,_,w,T,C){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0,C=C|0;var P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0;if(ce=Y,Y=Y+16|0,P=ce,T>>>0>15)return C=4,Y=ce,C|0;if($=dt(_|0,w|0,52)|0,he()|0,$=$&15,($|0)>(T|0))return C=12,Y=ce,C|0;if(FF(_,w,T,P)|0&&Sr(23313,22674,1063,22725),J=P,V=y[J+4>>2]|0,!(((m|0)>-1|(m|0)==-1&g>>>0>4294967295)&((V|0)>(m|0)|((V|0)==(m|0)?(y[J>>2]|0)>>>0>g>>>0:0))))return C=2,Y=ce,C|0;J=T-$|0,T=Mt(T|0,0,52)|0,F=he()|0|w&-15728641,V=C,y[V>>2]=T|_,y[V+4>>2]=F,V=dt(_|0,w|0,45)|0,he()|0;e:do if(Zs(V&127)|0){if($|0)for(P=1;;){if(V=Mt(7,0,(15-P|0)*3|0)|0,!((V&_|0)==0&((he()|0)&w|0)==0))break e;if(P>>>0<$>>>0)P=P+1|0;else break}if((J|0)<1)return C=0,Y=ce,C|0;for(V=$^15,w=-1,F=1,P=1;;){$=J-F|0,$=B1(7,0,$,(($|0)<0)<<31>>31)|0,_=he()|0;do if(P)if(P=Vc($|0,_|0,5,0)|0,P=Qi(P|0,he()|0,-5,-1)|0,P=bw(P|0,he()|0,6,0)|0,T=he()|0,(m|0)>(T|0)|(m|0)==(T|0)&g>>>0>P>>>0){m=Qi(g|0,m|0,-1,-1)|0,m=zc(m|0,he()|0,P|0,T|0)|0,P=he()|0,_e=C,ge=y[_e>>2]|0,_e=y[_e+4>>2]|0,Re=(V+w|0)*3|0,ve=Mt(7,0,Re|0)|0,_e=_e&~(he()|0),w=bw(m|0,P|0,$|0,_|0)|0,g=he()|0,T=Qi(w|0,g|0,2,0)|0,Re=Mt(T|0,he()|0,Re|0)|0,_e=he()|0|_e,T=C,y[T>>2]=Re|ge&~ve,y[T+4>>2]=_e,g=Vc(w|0,g|0,$|0,_|0)|0,g=zc(m|0,P|0,g|0,he()|0)|0,P=0,m=he()|0;break}else{Re=C,ve=y[Re>>2]|0,Re=y[Re+4>>2]|0,ge=Mt(7,0,(V+w|0)*3|0)|0,Re=Re&~(he()|0),P=C,y[P>>2]=ve&~ge,y[P+4>>2]=Re,P=1;break}else ve=C,T=y[ve>>2]|0,ve=y[ve+4>>2]|0,w=(V+w|0)*3|0,_e=Mt(7,0,w|0)|0,ve=ve&~(he()|0),Re=bw(g|0,m|0,$|0,_|0)|0,P=he()|0,w=Mt(Re|0,P|0,w|0)|0,ve=he()|0|ve,ge=C,y[ge>>2]=w|T&~_e,y[ge+4>>2]=ve,P=Vc(Re|0,P|0,$|0,_|0)|0,g=zc(g|0,m|0,P|0,he()|0)|0,P=0,m=he()|0;while(0);if((J|0)>(F|0))w=~F,F=F+1|0;else{m=0;break}}return Y=ce,m|0}while(0);if((J|0)<1)return Re=0,Y=ce,Re|0;for(T=$^15,P=1;;)if(ge=J-P|0,ge=B1(7,0,ge,((ge|0)<0)<<31>>31)|0,Re=he()|0,F=C,_=y[F>>2]|0,F=y[F+4>>2]|0,$=(T-P|0)*3|0,w=Mt(7,0,$|0)|0,F=F&~(he()|0),_e=bw(g|0,m|0,ge|0,Re|0)|0,ve=he()|0,$=Mt(_e|0,ve|0,$|0)|0,F=he()|0|F,V=C,y[V>>2]=$|_&~w,y[V+4>>2]=F,Re=Vc(_e|0,ve|0,ge|0,Re|0)|0,g=zc(g|0,m|0,Re|0,he()|0)|0,m=he()|0,(J|0)<=(P|0)){m=0;break}else P=P+1|0;return Y=ce,m|0}function Ffe(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0;T=dt(m|0,_|0,52)|0,he()|0,T=T&15,(m|0)==0&(_|0)==0|((w|0)>15|(T|0)>(w|0))?(w=-1,T=-1,m=0,_=0):(C=iYe(m,_,T+1|0,w)|0,_=(he()|0)&-15728641,m=Mt(w|0,0,52)|0,m=C|m,_=_|(he()|0),C=(Js(m,_)|0)==0,w=C?-1:w),C=g,y[C>>2]=m,y[C+4>>2]=_,y[g+8>>2]=T,y[g+12>>2]=w}function kfe(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0,F=0,V=0;if(_=g,m=y[_>>2]|0,_=y[_+4>>2]|0,!((m|0)==0&(_|0)==0)&&(w=dt(m|0,_|0,52)|0,he()|0,w=w&15,$=Mt(1,0,(w^15)*3|0)|0,m=Qi($|0,he()|0,m|0,_|0)|0,_=he()|0,$=g,y[$>>2]=m,y[$+4>>2]=_,$=g+8|0,P=y[$>>2]|0,!((w|0)<(P|0)))){for(F=g+12|0,C=w;;){if((C|0)==(P|0)){w=5;break}if(V=(C|0)==(y[F>>2]|0),T=(15-C|0)*3|0,w=dt(m|0,_|0,T|0)|0,he()|0,w=w&7,V&((w|0)==1&!0)){w=7;break}if(!((w|0)==7&!0)){w=10;break}if(V=Mt(1,0,T|0)|0,m=Qi(m|0,_|0,V|0,he()|0)|0,_=he()|0,V=g,y[V>>2]=m,y[V+4>>2]=_,(C|0)>(P|0))C=C+-1|0;else{w=10;break}}if((w|0)==5){V=g,y[V>>2]=0,y[V+4>>2]=0,y[$>>2]=-1,y[F>>2]=-1;return}else if((w|0)==7){P=Mt(1,0,T|0)|0,P=Qi(m|0,_|0,P|0,he()|0)|0,$=he()|0,V=g,y[V>>2]=P,y[V+4>>2]=$,y[F>>2]=C+-1;return}else if((w|0)==10)return}}function VP(g){g=+g;var m=0;return m=g<0?g+6.283185307179586:g,+(g>=6.283185307179586?m+-6.283185307179586:m)}function kE(g,m){return g=g|0,m=m|0,+Yr(+(+ie[g>>3]-+ie[m>>3]))<17453292519943298e-27?(m=+Yr(+(+ie[g+8>>3]-+ie[m+8>>3]))<17453292519943298e-27,m|0):(m=0,m|0)}function mYe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0;return T=+ie[m>>3],w=+ie[g>>3],C=+Nr(+((T-w)*.5)),_=+Nr(+((+ie[m+8>>3]-+ie[g+8>>3])*.5)),_=C*C+_*(+_n(+T)*+_n(+w)*_),+(+ho(+ +wi(+_),+ +wi(+(1-_)))*2)}function GP(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0;return T=+ie[m>>3],w=+ie[g>>3],C=+Nr(+((T-w)*.5)),_=+Nr(+((+ie[m+8>>3]-+ie[g+8>>3])*.5)),_=C*C+_*(+_n(+T)*+_n(+w)*_),+(+ho(+ +wi(+_),+ +wi(+(1-_)))*2*6371.007180918475)}function gYe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0;return T=+ie[m>>3],w=+ie[g>>3],C=+Nr(+((T-w)*.5)),_=+Nr(+((+ie[m+8>>3]-+ie[g+8>>3])*.5)),_=C*C+_*(+_n(+T)*+_n(+w)*_),+(+ho(+ +wi(+_),+ +wi(+(1-_)))*2*6371.007180918475*1e3)}function AYe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0;return C=+ie[m>>3],w=+_n(+C),T=+ie[m+8>>3]-+ie[g+8>>3],P=w*+Nr(+T),_=+ie[g>>3],+ +ho(+P,+(+Nr(+C)*+_n(+_)-+_n(+T)*(w*+Nr(+_))))}function yYe(g,m,_,w){g=g|0,m=+m,_=+_,w=w|0;var T=0,C=0,P=0,$=0;if(_<1e-16){y[w>>2]=y[g>>2],y[w+4>>2]=y[g+4>>2],y[w+8>>2]=y[g+8>>2],y[w+12>>2]=y[g+12>>2];return}C=m<0?m+6.283185307179586:m,C=m>=6.283185307179586?C+-6.283185307179586:C;do if(C<1e-16)m=+ie[g>>3]+_,ie[w>>3]=m,T=w;else{if(T=+Yr(+(C+-3.141592653589793))<1e-16,m=+ie[g>>3],T){m=m-_,ie[w>>3]=m,T=w;break}if(P=+_n(+_),_=+Nr(+_),m=P*+Nr(+m)+ +_n(+C)*(_*+_n(+m)),m=m>1?1:m,m=+Na(+(m<-1?-1:m)),ie[w>>3]=m,+Yr(+(m+-1.5707963267948966))<1e-16){ie[w>>3]=1.5707963267948966,ie[w+8>>3]=0;return}if(+Yr(+(m+1.5707963267948966))<1e-16){ie[w>>3]=-1.5707963267948966,ie[w+8>>3]=0;return}if($=+_n(+m),C=_*+Nr(+C)/$,_=+ie[g>>3],m=(P-+Nr(+m)*+Nr(+_))/+_n(+_)/$,P=C>1?1:C,m=m>1?1:m,m=+ie[g+8>>3]+ +ho(+(P<-1?-1:P),+(m<-1?-1:m)),m>3.141592653589793)do m=m+-6.283185307179586;while(m>3.141592653589793);if(m<-3.141592653589793)do m=m+6.283185307179586;while(m<-3.141592653589793);ie[w+8>>3]=m;return}while(0);if(+Yr(+(m+-1.5707963267948966))<1e-16){ie[T>>3]=1.5707963267948966,ie[w+8>>3]=0;return}if(+Yr(+(m+1.5707963267948966))<1e-16){ie[T>>3]=-1.5707963267948966,ie[w+8>>3]=0;return}if(m=+ie[g+8>>3],m>3.141592653589793)do m=m+-6.283185307179586;while(m>3.141592653589793);if(m<-3.141592653589793)do m=m+6.283185307179586;while(m<-3.141592653589793);ie[w+8>>3]=m}function _Ye(g,m){return g=g|0,m=m|0,g>>>0>15?(m=4,m|0):(ie[m>>3]=+ie[20528+(g<<3)>>3],m=0,m|0)}function vYe(g,m){return g=g|0,m=m|0,g>>>0>15?(m=4,m|0):(ie[m>>3]=+ie[20656+(g<<3)>>3],m=0,m|0)}function bYe(g,m){return g=g|0,m=m|0,g>>>0>15?(m=4,m|0):(ie[m>>3]=+ie[20784+(g<<3)>>3],m=0,m|0)}function wYe(g,m){return g=g|0,m=m|0,g>>>0>15?(m=4,m|0):(ie[m>>3]=+ie[20912+(g<<3)>>3],m=0,m|0)}function Tq(g,m){g=g|0,m=m|0;var _=0;return g>>>0>15?(m=4,m|0):(_=B1(7,0,g,((g|0)<0)<<31>>31)|0,_=Vc(_|0,he()|0,120,0)|0,g=he()|0,y[m>>2]=_|2,y[m+4>>2]=g,m=0,m|0)}function Ufe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0;return _e=+ie[m>>3],J=+ie[g>>3],F=+Nr(+((_e-J)*.5)),C=+ie[m+8>>3],V=+ie[g+8>>3],P=+Nr(+((C-V)*.5)),$=+_n(+J),ce=+_n(+_e),P=F*F+P*(ce*$*P),P=+ho(+ +wi(+P),+ +wi(+(1-P)))*2,F=+ie[_>>3],_e=+Nr(+((F-_e)*.5)),w=+ie[_+8>>3],C=+Nr(+((w-C)*.5)),T=+_n(+F),C=_e*_e+C*(ce*T*C),C=+ho(+ +wi(+C),+ +wi(+(1-C)))*2,F=+Nr(+((J-F)*.5)),w=+Nr(+((V-w)*.5)),w=F*F+w*($*T*w),w=+ho(+ +wi(+w),+ +wi(+(1-w)))*2,T=(P+C+w)*.5,+(+Uc(+ +wi(+(+Aa(+(T*.5))*+Aa(+((T-P)*.5))*+Aa(+((T-C)*.5))*+Aa(+((T-w)*.5)))))*4)}function Sq(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0;if($=Y,Y=Y+192|0,C=$+168|0,P=$,T=BP(g,m,C)|0,T|0)return _=T,Y=$,_|0;if(zP(g,m,P)|0&&Sr(23313,22742,386,22751),m=y[P>>2]|0,(m|0)>0){if(w=+Ufe(P+8|0,P+8+(((m|0)!=1&1)<<4)|0,C)+0,(m|0)!=1){g=1;do T=g,g=g+1|0,w=w+ +Ufe(P+8+(T<<4)|0,P+8+(((g|0)%(m|0)|0)<<4)|0,C);while((g|0)<(m|0))}}else w=0;return ie[_>>3]=w,_=0,Y=$,_|0}function xYe(g,m,_){return g=g|0,m=m|0,_=_|0,g=Sq(g,m,_)|0,g|0||(ie[_>>3]=+ie[_>>3]*6371.007180918475*6371.007180918475),g|0}function TYe(g,m,_){return g=g|0,m=m|0,_=_|0,g=Sq(g,m,_)|0,g|0||(ie[_>>3]=+ie[_>>3]*6371.007180918475*6371.007180918475*1e3*1e3),g|0}function SYe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0;if($=Y,Y=Y+176|0,P=$,g=NF(g,m,P)|0,g|0)return P=g,Y=$,P|0;if(ie[_>>3]=0,g=y[P>>2]|0,(g|0)<=1)return P=0,Y=$,P|0;m=g+-1|0,g=0,w=+ie[P+8>>3],T=+ie[P+16>>3],C=0;do g=g+1|0,V=w,w=+ie[P+8+(g<<4)>>3],J=+Nr(+((w-V)*.5)),F=T,T=+ie[P+8+(g<<4)+8>>3],F=+Nr(+((T-F)*.5)),F=J*J+F*(+_n(+w)*+_n(+V)*F),C=C+ +ho(+ +wi(+F),+ +wi(+(1-F)))*2;while((g|0)<(m|0));return ie[_>>3]=C,P=0,Y=$,P|0}function EYe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0;if($=Y,Y=Y+176|0,P=$,g=NF(g,m,P)|0,g|0)return P=g,C=+ie[_>>3],C=C*6371.007180918475,ie[_>>3]=C,Y=$,P|0;if(ie[_>>3]=0,g=y[P>>2]|0,(g|0)<=1)return P=0,C=0,C=C*6371.007180918475,ie[_>>3]=C,Y=$,P|0;m=g+-1|0,g=0,w=+ie[P+8>>3],T=+ie[P+16>>3],C=0;do g=g+1|0,V=w,w=+ie[P+8+(g<<4)>>3],J=+Nr(+((w-V)*.5)),F=T,T=+ie[P+8+(g<<4)+8>>3],F=+Nr(+((T-F)*.5)),F=J*J+F*(+_n(+V)*+_n(+w)*F),C=C+ +ho(+ +wi(+F),+ +wi(+(1-F)))*2;while((g|0)!=(m|0));return ie[_>>3]=C,P=0,J=C,J=J*6371.007180918475,ie[_>>3]=J,Y=$,P|0}function CYe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0;if($=Y,Y=Y+176|0,P=$,g=NF(g,m,P)|0,g|0)return P=g,C=+ie[_>>3],C=C*6371.007180918475,C=C*1e3,ie[_>>3]=C,Y=$,P|0;if(ie[_>>3]=0,g=y[P>>2]|0,(g|0)<=1)return P=0,C=0,C=C*6371.007180918475,C=C*1e3,ie[_>>3]=C,Y=$,P|0;m=g+-1|0,g=0,w=+ie[P+8>>3],T=+ie[P+16>>3],C=0;do g=g+1|0,V=w,w=+ie[P+8+(g<<4)>>3],J=+Nr(+((w-V)*.5)),F=T,T=+ie[P+8+(g<<4)+8>>3],F=+Nr(+((T-F)*.5)),F=J*J+F*(+_n(+V)*+_n(+w)*F),C=C+ +ho(+ +wi(+F),+ +wi(+(1-F)))*2;while((g|0)!=(m|0));return ie[_>>3]=C,P=0,J=C,J=J*6371.007180918475,J=J*1e3,ie[_>>3]=J,Y=$,P|0}function MYe(g){g=g|0;var m=0,_=0,w=0;return m=Jm(1,12)|0,m||Sr(22832,22787,49,22845),_=g+4|0,w=y[_>>2]|0,w|0?(w=w+8|0,y[w>>2]=m,y[_>>2]=m,m|0):(y[g>>2]|0&&Sr(22862,22787,61,22885),w=g,y[w>>2]=m,y[_>>2]=m,m|0)}function RYe(g,m){g=g|0,m=m|0;var _=0,w=0;return w=Zm(24)|0,w||Sr(22899,22787,78,22913),y[w>>2]=y[m>>2],y[w+4>>2]=y[m+4>>2],y[w+8>>2]=y[m+8>>2],y[w+12>>2]=y[m+12>>2],y[w+16>>2]=0,m=g+4|0,_=y[m>>2]|0,_|0?(y[_+16>>2]=w,y[m>>2]=w,w|0):(y[g>>2]|0&&Sr(22928,22787,82,22913),y[g>>2]=w,y[m>>2]=w,w|0)}function Bfe(g){g=g|0;var m=0,_=0,w=0,T=0;if(g)for(w=1;;){if(m=y[g>>2]|0,m|0)do{if(_=y[m>>2]|0,_|0)do T=_,_=y[_+16>>2]|0,li(T);while(_|0);T=m,m=y[m+8>>2]|0,li(T)}while(m|0);if(m=g,g=y[g+8>>2]|0,w||li(m),g)w=0;else break}}function OYe(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0,Be=0,Me=0,Lt=0,Zt=0,Tt=0,Nt=0,Jn=0,vn=0,On=0,Si=0,_i=0,Ei=0,As=0,ci=0;if(T=g+8|0,y[T>>2]|0)return ci=1,ci|0;if(w=y[g>>2]|0,!w)return ci=0,ci|0;m=w,_=0;do _=_+1|0,m=y[m+8>>2]|0;while(m|0);if(_>>>0<2)return ci=0,ci|0;Ei=Zm(_<<2)|0,Ei||Sr(22948,22787,317,22967),_i=Zm(_<<5)|0,_i||Sr(22989,22787,321,22967),y[g>>2]=0,Zt=g+4|0,y[Zt>>2]=0,y[T>>2]=0,_=0,Si=0,Lt=0,ce=0;e:for(;;){if(J=y[w>>2]|0,J){C=0,P=J;do{if(F=+ie[P+8>>3],m=P,P=y[P+16>>2]|0,V=(P|0)==0,T=V?J:P,$=+ie[T+8>>3],+Yr(+(F-$))>3.141592653589793){ci=14;break}C=C+($-F)*(+ie[m>>3]+ +ie[T>>3])}while(!V);if((ci|0)==14){ci=0,C=0,m=J;do Me=+ie[m+8>>3],On=m+16|0,vn=y[On>>2]|0,vn=vn|0?vn:J,Be=+ie[vn+8>>3],C=C+(+ie[m>>3]+ +ie[vn>>3])*((Be<0?Be+6.283185307179586:Be)-(Me<0?Me+6.283185307179586:Me)),m=y[(m|0?On:w)>>2]|0;while(m|0)}C>0?(y[Ei+(Si<<2)>>2]=w,Si=Si+1|0,T=Lt,m=ce):ci=19}else ci=19;if((ci|0)==19){ci=0;do if(_){if(m=_+8|0,y[m>>2]|0){ci=21;break e}if(_=Jm(1,12)|0,!_){ci=23;break e}y[m>>2]=_,T=_+4|0,P=_,m=ce}else if(ce){T=Zt,P=ce+8|0,m=w,_=g;break}else if(y[g>>2]|0){ci=27;break e}else{T=Zt,P=g,m=w,_=g;break}while(0);if(y[P>>2]=w,y[T>>2]=w,P=_i+(Lt<<5)|0,V=y[w>>2]|0,V){for(J=_i+(Lt<<5)+8|0,ie[J>>3]=17976931348623157e292,ce=_i+(Lt<<5)+24|0,ie[ce>>3]=17976931348623157e292,ie[P>>3]=-17976931348623157e292,_e=_i+(Lt<<5)+16|0,ie[_e>>3]=-17976931348623157e292,je=17976931348623157e292,Ue=-17976931348623157e292,T=0,ve=V,F=17976931348623157e292,Re=17976931348623157e292,Ze=-17976931348623157e292,$=-17976931348623157e292;C=+ie[ve>>3],Me=+ie[ve+8>>3],ve=y[ve+16>>2]|0,ge=(ve|0)==0,Be=+ie[(ge?V:ve)+8>>3],C<F&&(ie[J>>3]=C,F=C),Me<Re&&(ie[ce>>3]=Me,Re=Me),C>Ze?ie[P>>3]=C:C=Ze,Me>$&&(ie[_e>>3]=Me,$=Me),je=Me>0&Me<je?Me:je,Ue=Me<0&Me>Ue?Me:Ue,T=T|+Yr(+(Me-Be))>3.141592653589793,!ge;)Ze=C;T&&(ie[_e>>3]=Ue,ie[ce>>3]=je)}else y[P>>2]=0,y[P+4>>2]=0,y[P+8>>2]=0,y[P+12>>2]=0,y[P+16>>2]=0,y[P+20>>2]=0,y[P+24>>2]=0,y[P+28>>2]=0;T=Lt+1|0}if(On=w+8|0,w=y[On>>2]|0,y[On>>2]=0,w)Lt=T,ce=m;else{ci=45;break}}if((ci|0)==21)Sr(22765,22787,35,22799);else if((ci|0)==23)Sr(22819,22787,37,22799);else if((ci|0)==27)Sr(22862,22787,61,22885);else if((ci|0)==45){e:do if((Si|0)>0){for(On=(T|0)==0,Jn=T<<2,vn=(g|0)==0,Nt=0,m=0;;){if(Tt=y[Ei+(Nt<<2)>>2]|0,On)ci=73;else{if(Lt=Zm(Jn)|0,!Lt){ci=50;break}if(Zt=Zm(Jn)|0,!Zt){ci=52;break}t:do if(vn)_=0;else{for(T=0,_=0,P=g;w=_i+(T<<5)|0,zfe(y[P>>2]|0,w,y[Tt>>2]|0)|0?(y[Lt+(_<<2)>>2]=P,y[Zt+(_<<2)>>2]=w,ge=_+1|0):ge=_,P=y[P+8>>2]|0,P;)T=T+1|0,_=ge;if((ge|0)>0)if(w=y[Lt>>2]|0,(ge|0)==1)_=w;else for(_e=0,ve=-1,_=w,ce=w;;){for(V=y[ce>>2]|0,w=0,P=0;T=y[y[Lt+(P<<2)>>2]>>2]|0,(T|0)==(V|0)?J=w:J=w+((zfe(T,y[Zt+(P<<2)>>2]|0,y[V>>2]|0)|0)&1)|0,P=P+1|0,(P|0)!=(ge|0);)w=J;if(T=(J|0)>(ve|0),_=T?ce:_,w=_e+1|0,(w|0)==(ge|0))break t;_e=w,ve=T?J:ve,ce=y[Lt+(w<<2)>>2]|0}else _=0}while(0);if(li(Lt),li(Zt),_){if(T=_+4|0,w=y[T>>2]|0,w)_=w+8|0;else if(y[_>>2]|0){ci=70;break}y[_>>2]=Tt,y[T>>2]=Tt}else ci=73}if((ci|0)==73){if(ci=0,m=y[Tt>>2]|0,m|0)do Zt=m,m=y[m+16>>2]|0,li(Zt);while(m|0);li(Tt),m=1}if(Nt=Nt+1|0,(Nt|0)>=(Si|0)){As=m;break e}}(ci|0)==50?Sr(23004,22787,249,23023):(ci|0)==52?Sr(23042,22787,252,23023):(ci|0)==70&&Sr(22862,22787,61,22885)}else As=0;while(0);return li(Ei),li(_i),ci=As,ci|0}return 0}function zfe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0;if(!(xfe(m,_)|0)||(m=wfe(m)|0,w=+ie[_>>3],T=+ie[_+8>>3],T=m&T<0?T+6.283185307179586:T,g=y[g>>2]|0,!g))return g=0,g|0;if(m){m=0,V=T,_=g;e:for(;;){for(;P=+ie[_>>3],T=+ie[_+8>>3],_=_+16|0,J=y[_>>2]|0,J=J|0?J:g,C=+ie[J>>3],$=+ie[J+8>>3],P>C?(F=P,P=$):(F=C,C=P,P=T,T=$),w=w==C|w==F?w+2220446049250313e-31:w,!!(w<C|w>F);)if(_=y[_>>2]|0,!_){_=22;break e}if($=P<0?P+6.283185307179586:P,P=T<0?T+6.283185307179586:T,V=$==V|P==V?V+-2220446049250313e-31:V,F=$+(P-$)*((w-C)/(F-C)),(F<0?F+6.283185307179586:F)>V&&(m=m^1),_=y[_>>2]|0,!_){_=22;break}}if((_|0)==22)return m|0}else{m=0,V=T,_=g;e:for(;;){for(;P=+ie[_>>3],T=+ie[_+8>>3],_=_+16|0,J=y[_>>2]|0,J=J|0?J:g,C=+ie[J>>3],$=+ie[J+8>>3],P>C?(F=P,P=$):(F=C,C=P,P=T,T=$),w=w==C|w==F?w+2220446049250313e-31:w,!!(w<C|w>F);)if(_=y[_>>2]|0,!_){_=22;break e}if(V=P==V|T==V?V+-2220446049250313e-31:V,P+(T-P)*((w-C)/(F-C))>V&&(m=m^1),_=y[_>>2]|0,!_){_=22;break}}if((_|0)==22)return m|0}return 0}function hy(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0;if(Ue=Y,Y=Y+32|0,je=Ue+16|0,Ze=Ue,C=dt(g|0,m|0,52)|0,he()|0,C=C&15,ve=dt(_|0,w|0,52)|0,he()|0,(C|0)!=(ve&15|0))return je=12,Y=Ue,je|0;if(V=dt(g|0,m|0,45)|0,he()|0,V=V&127,J=dt(_|0,w|0,45)|0,he()|0,J=J&127,V>>>0>121|J>>>0>121)return je=5,Y=Ue,je|0;if(ve=(V|0)!=(J|0),ve){if($=pq(V,J)|0,($|0)==7)return je=1,Y=Ue,je|0;F=pq(J,V)|0,(F|0)==7?Sr(23066,23090,161,23100):(ge=$,P=F)}else ge=0,P=0;ce=Zs(V)|0,_e=Zs(J)|0,y[je>>2]=0,y[je+4>>2]=0,y[je+8>>2]=0,y[je+12>>2]=0;do if(ge){if(J=y[4272+(V*28|0)+(ge<<2)>>2]|0,$=(J|0)>0,_e)if($){V=0,F=_,$=w;do F=cYe(F,$)|0,$=he()|0,P=U1(P)|0,(P|0)==1&&(P=U1(1)|0),V=V+1|0;while((V|0)!=(J|0));J=P,V=F,F=$}else J=P,V=_,F=w;else if($){V=0,F=_,$=w;do F=bq(F,$)|0,$=he()|0,P=U1(P)|0,V=V+1|0;while((V|0)!=(J|0));J=P,V=F,F=$}else J=P,V=_,F=w;if(wq(V,F,je)|0,ve||Sr(23115,23090,191,23100),$=(ce|0)!=0,P=(_e|0)!=0,$&P&&Sr(23142,23090,192,23100),$){if(P=wh(g,m)|0,(P|0)==7){C=5;break}if(et[21872+(P*7|0)+ge>>0]|0){C=1;break}F=y[21040+(P*28|0)+(ge<<2)>>2]|0,V=F}else if(P){if(P=wh(V,F)|0,(P|0)==7){C=5;break}if(et[21872+(P*7|0)+J>>0]|0){C=1;break}V=0,F=y[21040+(J*28|0)+(P<<2)>>2]|0}else V=0,F=0;if((V|F|0)<0)C=5;else{if((F|0)>0){$=je+4|0,P=0;do LF($),P=P+1|0;while((P|0)!=(F|0))}if(y[Ze>>2]=0,y[Ze+4>>2]=0,y[Ze+8>>2]=0,Cfe(Ze,ge),C|0)for(;Pp(C)|0?DF(Ze):yw(Ze),(C|0)>1;)C=C+-1|0;if((V|0)>0){C=0;do LF(Ze),C=C+1|0;while((C|0)!=(V|0))}Re=je+4|0,Mu(Re,Ze,Re),Bc(Re),Re=51}}else if(wq(_,w,je)|0,(ce|0)!=0&(_e|0)!=0)if((J|0)!=(V|0)&&Sr(23173,23090,261,23100),P=wh(g,m)|0,C=wh(_,w)|0,(P|0)==7|(C|0)==7)C=5;else if(et[21872+(P*7|0)+C>>0]|0)C=1;else if(P=y[21040+(P*28|0)+(C<<2)>>2]|0,(P|0)>0){$=je+4|0,C=0;do LF($),C=C+1|0;while((C|0)!=(P|0));Re=51}else Re=51;else Re=51;while(0);return(Re|0)==51&&(C=je+4|0,y[T>>2]=y[C>>2],y[T+4>>2]=y[C+4>>2],y[T+8>>2]=y[C+8>>2],C=0),je=C,Y=Ue,je|0}function Vfe(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0,Be=0;if(Re=Y,Y=Y+48|0,V=Re+36|0,P=Re+24|0,$=Re+12|0,F=Re,T=dt(g|0,m|0,52)|0,he()|0,T=T&15,_e=dt(g|0,m|0,45)|0,he()|0,_e=_e&127,_e>>>0>121)return w=5,Y=Re,w|0;if(J=Zs(_e)|0,Mt(T|0,0,52)|0,Ze=he()|0|134225919,C=w,y[C>>2]=-1,y[C+4>>2]=Ze,!T)return T=$F(_)|0,(T|0)==7||(T=dq(_e,T)|0,(T|0)==127)?(Ze=1,Y=Re,Ze|0):(ve=Mt(T|0,0,45)|0,ge=he()|0,_e=w,ge=y[_e+4>>2]&-1040385|ge,Ze=w,y[Ze>>2]=y[_e>>2]|ve,y[Ze+4>>2]=ge,Ze=0,Y=Re,Ze|0);for(y[V>>2]=y[_>>2],y[V+4>>2]=y[_+4>>2],y[V+8>>2]=y[_+8>>2],_=T;;){if(C=_,_=_+-1|0,y[P>>2]=y[V>>2],y[P+4>>2]=y[V+4>>2],y[P+8>>2]=y[V+8>>2],Pp(C)|0){if(T=FQe(V)|0,T|0){_=13;break}y[$>>2]=y[V>>2],y[$+4>>2]=y[V+4>>2],y[$+8>>2]=y[V+8>>2],DF($)}else{if(T=kQe(V)|0,T|0){_=13;break}y[$>>2]=y[V>>2],y[$+4>>2]=y[V+4>>2],y[$+8>>2]=y[V+8>>2],yw($)}if(fq(P,$,F),Bc(F),T=w,Ue=y[T>>2]|0,T=y[T+4>>2]|0,Be=(15-C|0)*3|0,je=Mt(7,0,Be|0)|0,T=T&~(he()|0),Be=Mt($F(F)|0,0,Be|0)|0,T=he()|0|T,Ze=w,y[Ze>>2]=Be|Ue&~je,y[Ze+4>>2]=T,(C|0)<=1){_=14;break}}e:do if((_|0)!=13&&(_|0)==14)if((y[V>>2]|0)<=1&&(y[V+4>>2]|0)<=1&&(y[V+8>>2]|0)<=1){_=$F(V)|0,T=dq(_e,_)|0,(T|0)==127?F=0:F=Zs(T)|0;t:do if(_){if(J){if(T=wh(g,m)|0,(T|0)==7){T=5;break e}if(C=y[21248+(T*28|0)+(_<<2)>>2]|0,(C|0)>0){T=_,_=0;do T=_w(T)|0,_=_+1|0;while((_|0)!=(C|0))}else T=_;if((T|0)==1){T=9;break e}_=dq(_e,T)|0,(_|0)==127&&Sr(23200,23090,411,23230),Zs(_)|0?Sr(23245,23090,412,23230):(ge=_,ve=C,ce=T)}else ge=T,ve=0,ce=_;if($=y[4272+(_e*28|0)+(ce<<2)>>2]|0,($|0)<=-1&&Sr(23276,23090,419,23230),!F){if((ve|0)<0){T=5;break e}if(ve|0){C=w,T=0,_=y[C>>2]|0,C=y[C+4>>2]|0;do _=vw(_,C)|0,C=he()|0,Be=w,y[Be>>2]=_,y[Be+4>>2]=C,T=T+1|0;while((T|0)<(ve|0))}if(($|0)<=0){T=ge,_=58;break}for(C=w,T=0,_=y[C>>2]|0,C=y[C+4>>2]|0;;)if(_=vw(_,C)|0,C=he()|0,Be=w,y[Be>>2]=_,y[Be+4>>2]=C,T=T+1|0,(T|0)==($|0)){T=ge,_=58;break t}}if(P=pq(ge,_e)|0,(P|0)==7&&Sr(23066,23090,428,23230),T=w,_=y[T>>2]|0,T=y[T+4>>2]|0,($|0)>0){C=0;do _=vw(_,T)|0,T=he()|0,Be=w,y[Be>>2]=_,y[Be+4>>2]=T,C=C+1|0;while((C|0)!=($|0))}if(T=wh(_,T)|0,(T|0)==7&&Sr(23313,23090,440,23230),_=hq(ge)|0,_=y[(_?21664:21456)+(P*28|0)+(T<<2)>>2]|0,(_|0)<0&&Sr(23313,23090,454,23230),!_)T=ge,_=58;else{P=w,T=0,C=y[P>>2]|0,P=y[P+4>>2]|0;do C=vq(C,P)|0,P=he()|0,Be=w,y[Be>>2]=C,y[Be+4>>2]=P,T=T+1|0;while((T|0)<(_|0));T=ge,_=58}}else if((J|0)!=0&(F|0)!=0){if(_=wh(g,m)|0,C=w,C=wh(y[C>>2]|0,y[C+4>>2]|0)|0,(_|0)==7|(C|0)==7){T=5;break e}if(C=y[21248+(_*28|0)+(C<<2)>>2]|0,(C|0)<0){T=5;break e}if(!C)_=59;else{$=w,_=0,P=y[$>>2]|0,$=y[$+4>>2]|0;do P=vw(P,$)|0,$=he()|0,Be=w,y[Be>>2]=P,y[Be+4>>2]=$,_=_+1|0;while((_|0)<(C|0));_=58}}else _=58;while(0);if((_|0)==58&&F&&(_=59),(_|0)==59&&(Be=w,(wh(y[Be>>2]|0,y[Be+4>>2]|0)|0)==1)){T=9;break}Be=w,je=y[Be>>2]|0,Be=y[Be+4>>2]&-1040385,Ue=Mt(T|0,0,45)|0,Be=Be|(he()|0),T=w,y[T>>2]=je|Ue,y[T+4>>2]=Be,T=0}else T=1;while(0);return Be=T,Y=Re,Be|0}function PYe(g,m,_,w,T,C){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0,C=C|0;var P=0,$=0;return $=Y,Y=Y+16|0,P=$,T?g=15:(g=hy(g,m,_,w,P)|0,g||(BQe(P,C),g=0)),Y=$,g|0}function IYe(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0;return P=Y,Y=Y+16|0,C=P,w?_=15:(_=zQe(_,C)|0,_||(_=Vfe(g,m,C,T)|0)),Y=P,_|0}function $Ye(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0;return F=Y,Y=Y+32|0,P=F+12|0,$=F,C=hy(g,m,g,m,P)|0,C|0?($=C,Y=F,$|0):(g=hy(g,m,_,w,$)|0,g|0?($=g,Y=F,$|0):(P=mq(P,$)|0,$=T,y[$>>2]=P,y[$+4>>2]=((P|0)<0)<<31>>31,$=0,Y=F,$|0))}function DYe(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0;return F=Y,Y=Y+32|0,P=F+12|0,$=F,C=hy(g,m,g,m,P)|0,!C&&(C=hy(g,m,_,w,$)|0,!C)?(w=mq(P,$)|0,w=Qi(w|0,((w|0)<0)<<31>>31|0,1,0)|0,P=he()|0,$=T,y[$>>2]=w,y[$+4>>2]=P,$=0,Y=F,$|0):($=C,Y=F,$|0)}function LYe(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0,Be=0,Me=0,Lt=0,Zt=0,Tt=0,Nt=0;if(Tt=Y,Y=Y+48|0,P=Tt+24|0,$=Tt+12|0,Zt=Tt,C=hy(g,m,g,m,P)|0,!C&&(C=hy(g,m,_,w,$)|0,!C)){Me=mq(P,$)|0,Lt=((Me|0)<0)<<31>>31,y[P>>2]=0,y[P+4>>2]=0,y[P+8>>2]=0,y[$>>2]=0,y[$+4>>2]=0,y[$+8>>2]=0,hy(g,m,g,m,P)|0&&Sr(23313,23090,691,23299),hy(g,m,_,w,$)|0&&Sr(23313,23090,696,23299),Pfe(P),Pfe($),Me?(ce=y[P>>2]|0,ge=+(Me|0),je=P+4|0,_e=y[je>>2]|0,Ue=P+8|0,ve=y[Ue>>2]|0,Be=P,w=ce,C=_e,_=ve,Re=+((y[$>>2]|0)-ce|0)/ge,Ze=+((y[$+4>>2]|0)-_e|0)/ge,ge=+((y[$+8>>2]|0)-ve|0)/ge):(C=P+4|0,_=P+8|0,je=C,Ue=_,Be=P,w=y[P>>2]|0,C=y[C>>2]|0,_=y[_>>2]|0,Re=0,Ze=0,ge=0),y[Zt>>2]=w,ve=Zt+4|0,y[ve>>2]=C,_e=Zt+8|0,y[_e>>2]=_;e:do if((Me|0)<0)C=0;else for(J=0,ce=0,C=w;;){V=+(ce>>>0)+4294967296*+(J|0),Nt=Re*V+ +(C|0),F=Ze*V+ +(y[je>>2]|0),V=ge*V+ +(y[Ue>>2]|0),_=~~+UF(+Nt),P=~~+UF(+F),C=~~+UF(+V),Nt=+Yr(+(+(_|0)-Nt)),F=+Yr(+(+(P|0)-F)),V=+Yr(+(+(C|0)-V));do if(Nt>F&Nt>V)_=0-(P+C)|0,w=P;else if($=0-_|0,F>V){w=$-C|0;break}else{w=P,C=$-P|0;break}while(0);if(y[Zt>>2]=_,y[ve>>2]=w,y[_e>>2]=C,VQe(Zt),C=Vfe(g,m,Zt,T+(ce<<3)|0)|0,C|0)break e;if(!((J|0)<(Lt|0)|(J|0)==(Lt|0)&ce>>>0<Me>>>0)){C=0;break e}C=Qi(ce|0,J|0,1,0)|0,$=he()|0,J=$,ce=C,C=y[Be>>2]|0}while(0);return Zt=C,Y=Tt,Zt|0}return Zt=C,Y=Tt,Zt|0}function B1(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0;if((_|0)==0&(w|0)==0)return T=0,C=1,Xr(T|0),C|0;C=g,T=m,g=1,m=0;do P=(_&1|0)==0&!0,g=Vc((P?1:C)|0,(P?0:T)|0,g|0,m|0)|0,m=he()|0,_=Jfe(_|0,w|0,1)|0,w=he()|0,C=Vc(C|0,T|0,C|0,T|0)|0,T=he()|0;while(!((_|0)==0&(w|0)==0));return Xr(m|0),g|0}function Gfe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0;if(!(xfe(m,_)|0)||(m=wfe(m)|0,w=+ie[_>>3],T=+ie[_+8>>3],T=m&T<0?T+6.283185307179586:T,_e=y[g>>2]|0,(_e|0)<=0))return _e=0,_e|0;if(ce=y[g+4>>2]|0,m){m=0,J=T,_=-1,g=0;e:for(;;){for(V=g;P=+ie[ce+(V<<4)>>3],T=+ie[ce+(V<<4)+8>>3],g=(_+2|0)%(_e|0)|0,C=+ie[ce+(g<<4)>>3],$=+ie[ce+(g<<4)+8>>3],P>C?(F=P,P=$):(F=C,C=P,P=T,T=$),w=w==C|w==F?w+2220446049250313e-31:w,!!(w<C|w>F);)if(_=V+1|0,(_|0)>=(_e|0)){_=22;break e}else g=V,V=_,_=g;if($=P<0?P+6.283185307179586:P,P=T<0?T+6.283185307179586:T,J=$==J|P==J?J+-2220446049250313e-31:J,F=$+(P-$)*((w-C)/(F-C)),(F<0?F+6.283185307179586:F)>J&&(m=m^1),g=V+1|0,(g|0)>=(_e|0)){_=22;break}else _=V}if((_|0)==22)return m|0}else{m=0,J=T,_=-1,g=0;e:for(;;){for(V=g;P=+ie[ce+(V<<4)>>3],T=+ie[ce+(V<<4)+8>>3],g=(_+2|0)%(_e|0)|0,C=+ie[ce+(g<<4)>>3],$=+ie[ce+(g<<4)+8>>3],P>C?(F=P,P=$):(F=C,C=P,P=T,T=$),w=w==C|w==F?w+2220446049250313e-31:w,!!(w<C|w>F);)if(_=V+1|0,(_|0)>=(_e|0)){_=22;break e}else g=V,V=_,_=g;if(J=P==J|T==J?J+-2220446049250313e-31:J,P+(T-P)*((w-C)/(F-C))>J&&(m=m^1),g=V+1|0,(g|0)>=(_e|0)){_=22;break}else _=V}if((_|0)==22)return m|0}return 0}function jfe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0;if(ge=y[g>>2]|0,!ge){y[m>>2]=0,y[m+4>>2]=0,y[m+8>>2]=0,y[m+12>>2]=0,y[m+16>>2]=0,y[m+20>>2]=0,y[m+24>>2]=0,y[m+28>>2]=0;return}if(Re=m+8|0,ie[Re>>3]=17976931348623157e292,Ze=m+24|0,ie[Ze>>3]=17976931348623157e292,ie[m>>3]=-17976931348623157e292,je=m+16|0,ie[je>>3]=-17976931348623157e292,!((ge|0)<=0)){for(_e=y[g+4>>2]|0,V=17976931348623157e292,J=-17976931348623157e292,ce=0,g=-1,C=17976931348623157e292,P=17976931348623157e292,F=-17976931348623157e292,w=-17976931348623157e292,ve=0;_=+ie[_e+(ve<<4)>>3],$=+ie[_e+(ve<<4)+8>>3],g=g+2|0,T=+ie[_e+(((g|0)==(ge|0)?0:g)<<4)+8>>3],_<C&&(ie[Re>>3]=_,C=_),$<P&&(ie[Ze>>3]=$,P=$),_>F?ie[m>>3]=_:_=F,$>w&&(ie[je>>3]=$,w=$),V=$>0&$<V?$:V,J=$<0&$>J?$:J,ce=ce|+Yr(+($-T))>3.141592653589793,g=ve+1|0,(g|0)!=(ge|0);)Ue=ve,F=_,ve=g,g=Ue;ce&&(ie[je>>3]=J,ie[Ze>>3]=V)}}function NYe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0,Be=0,Me=0,Lt=0,Zt=0,Tt=0;if(ge=y[g>>2]|0,ge){if(Re=m+8|0,ie[Re>>3]=17976931348623157e292,Ze=m+24|0,ie[Ze>>3]=17976931348623157e292,ie[m>>3]=-17976931348623157e292,je=m+16|0,ie[je>>3]=-17976931348623157e292,(ge|0)>0){for(T=y[g+4>>2]|0,_e=17976931348623157e292,ve=-17976931348623157e292,w=0,_=-1,F=17976931348623157e292,V=17976931348623157e292,ce=-17976931348623157e292,P=-17976931348623157e292,Ue=0;C=+ie[T+(Ue<<4)>>3],J=+ie[T+(Ue<<4)+8>>3],Zt=_+2|0,$=+ie[T+(((Zt|0)==(ge|0)?0:Zt)<<4)+8>>3],C<F&&(ie[Re>>3]=C,F=C),J<V&&(ie[Ze>>3]=J,V=J),C>ce?ie[m>>3]=C:C=ce,J>P&&(ie[je>>3]=J,P=J),_e=J>0&J<_e?J:_e,ve=J<0&J>ve?J:ve,w=w|+Yr(+(J-$))>3.141592653589793,_=Ue+1|0,(_|0)!=(ge|0);)Zt=Ue,ce=C,Ue=_,_=Zt;w&&(ie[je>>3]=ve,ie[Ze>>3]=_e)}}else y[m>>2]=0,y[m+4>>2]=0,y[m+8>>2]=0,y[m+12>>2]=0,y[m+16>>2]=0,y[m+20>>2]=0,y[m+24>>2]=0,y[m+28>>2]=0;if(Zt=g+8|0,_=y[Zt>>2]|0,!((_|0)<=0)){Lt=g+12|0,Me=0;do if(T=y[Lt>>2]|0,w=Me,Me=Me+1|0,Ze=m+(Me<<5)|0,je=y[T+(w<<3)>>2]|0,je){if(Ue=m+(Me<<5)+8|0,ie[Ue>>3]=17976931348623157e292,g=m+(Me<<5)+24|0,ie[g>>3]=17976931348623157e292,ie[Ze>>3]=-17976931348623157e292,Be=m+(Me<<5)+16|0,ie[Be>>3]=-17976931348623157e292,(je|0)>0){for(ge=y[T+(w<<3)+4>>2]|0,_e=17976931348623157e292,ve=-17976931348623157e292,T=0,w=-1,Re=0,F=17976931348623157e292,V=17976931348623157e292,J=-17976931348623157e292,P=-17976931348623157e292;C=+ie[ge+(Re<<4)>>3],ce=+ie[ge+(Re<<4)+8>>3],w=w+2|0,$=+ie[ge+(((w|0)==(je|0)?0:w)<<4)+8>>3],C<F&&(ie[Ue>>3]=C,F=C),ce<V&&(ie[g>>3]=ce,V=ce),C>J?ie[Ze>>3]=C:C=J,ce>P&&(ie[Be>>3]=ce,P=ce),_e=ce>0&ce<_e?ce:_e,ve=ce<0&ce>ve?ce:ve,T=T|+Yr(+(ce-$))>3.141592653589793,w=Re+1|0,(w|0)!=(je|0);)Tt=Re,Re=w,J=C,w=Tt;T&&(ie[Be>>3]=ve,ie[g>>3]=_e)}}else y[Ze>>2]=0,y[Ze+4>>2]=0,y[Ze+8>>2]=0,y[Ze+12>>2]=0,y[Ze+16>>2]=0,y[Ze+20>>2]=0,y[Ze+24>>2]=0,y[Ze+28>>2]=0,_=y[Zt>>2]|0;while((Me|0)<(_|0))}}function FYe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0;if(!(Gfe(g,m,_)|0))return T=0,T|0;if(T=g+8|0,(y[T>>2]|0)<=0)return T=1,T|0;for(w=g+12|0,g=0;;){if(C=g,g=g+1|0,Gfe((y[w>>2]|0)+(C<<3)|0,m+(g<<5)|0,_)|0){g=0,w=6;break}if((g|0)>=(y[T>>2]|0)){g=1,w=6;break}}return(w|0)==6?g|0:0}function kYe(){return 8}function UYe(){return 16}function BYe(){return 168}function zYe(){return 8}function VYe(){return 16}function GYe(){return 12}function jYe(){return 8}function HYe(g){return g=g|0,+(+((y[g>>2]|0)>>>0)+4294967296*+(y[g+4>>2]|0))}function qYe(g){g=g|0;var m=0,_=0;return _=+ie[g>>3],m=+ie[g+8>>3],+ +wi(+(_*_+m*m))}function Hfe(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0;V=+ie[g>>3],F=+ie[m>>3]-V,$=+ie[g+8>>3],P=+ie[m+8>>3]-$,ce=+ie[_>>3],C=+ie[w>>3]-ce,_e=+ie[_+8>>3],J=+ie[w+8>>3]-_e,C=(C*($-_e)-(V-ce)*J)/(F*J-P*C),ie[T>>3]=V+F*C,ie[T+8>>3]=$+P*C}function qfe(g,m){return g=g|0,m=m|0,+Yr(+(+ie[g>>3]-+ie[m>>3]))<11920928955078125e-23?(m=+Yr(+(+ie[g+8>>3]-+ie[m+8>>3]))<11920928955078125e-23,m|0):(m=0,m|0)}function Fa(g,m){g=g|0,m=m|0;var _=0,w=0,T=0;return T=+ie[g>>3]-+ie[m>>3],w=+ie[g+8>>3]-+ie[m+8>>3],_=+ie[g+16>>3]-+ie[m+16>>3],+(T*T+w*w+_*_)}function WYe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0;_=+ie[g>>3],w=+_n(+_),_=+Nr(+_),ie[m+16>>3]=_,_=+ie[g+8>>3],T=w*+_n(+_),ie[m>>3]=T,_=w*+Nr(+_),ie[m+8>>3]=_}function QYe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0;if(C=Y,Y=Y+16|0,T=C,w=Js(g,m)|0,(_+-1|0)>>>0>5||(w=(w|0)!=0,(_|0)==1&w))return T=-1,Y=C,T|0;do if(jP(g,m,T)|0)w=-1;else if(w){w=((y[21936+(_<<2)>>2]|0)+5-(y[T>>2]|0)|0)%5|0;break}else{w=((y[21968+(_<<2)>>2]|0)+6-(y[T>>2]|0)|0)%6|0;break}while(0);return T=w,Y=C,T|0}function jP(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0,V=0;if(V=Y,Y=Y+32|0,P=V+16|0,$=V,w=FE(g,m,P)|0,w|0)return _=w,Y=V,_|0;C=Dfe(g,m)|0,F=wh(g,m)|0,OQe(C,$),w=PQe(C,y[P>>2]|0)|0;e:do if(Zs(C)|0){do switch(C|0){case 4:{g=0;break}case 14:{g=1;break}case 24:{g=2;break}case 38:{g=3;break}case 49:{g=4;break}case 58:{g=5;break}case 63:{g=6;break}case 72:{g=7;break}case 83:{g=8;break}case 97:{g=9;break}case 107:{g=10;break}case 117:{g=11;break}default:{w=1;break e}}while(0);if(T=y[22e3+(g*24|0)+8>>2]|0,m=y[22e3+(g*24|0)+16>>2]|0,g=y[P>>2]|0,(g|0)!=(y[$>>2]|0)&&($=hq(C)|0,g=y[P>>2]|0,$|(g|0)==(m|0)&&(w=(w+1|0)%6|0)),(F|0)==3&(g|0)==(m|0)){w=(w+5|0)%6|0,T=22;break}(F|0)==5&(g|0)==(T|0)&&(w=(w+1|0)%6|0),T=22}else T=22;while(0);return(T|0)==22&&(y[_>>2]=w,w=0),_=w,Y=V,_|0}function Ip(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0,Be=0;if(Be=Y,Y=Y+32|0,Ue=Be+24|0,Ze=Be+20|0,ge=Be+8|0,ve=Be+16|0,_e=Be,F=(Js(g,m)|0)==0,F=F?6:5,J=dt(g|0,m|0,52)|0,he()|0,J=J&15,F>>>0<=_>>>0)return w=2,Y=Be,w|0;ce=(J|0)==0,!ce&&(Re=Mt(7,0,(J^15)*3|0)|0,(Re&g|0)==0&((he()|0)&m|0)==0)?T=_:C=4;e:do if((C|0)==4){if(T=(Js(g,m)|0)!=0,((T?4:5)|0)<(_|0)||jP(g,m,Ue)|0||(C=(y[Ue>>2]|0)+_|0,T?T=22288+(((C|0)%5|0)<<2)|0:T=22320+(((C|0)%6|0)<<2)|0,Re=y[T>>2]|0,(Re|0)==7))return w=1,Y=Be,w|0;y[Ze>>2]=0,T=Nl(g,m,Re,Ze,ge)|0;do if(!T){if($=ge,V=y[$>>2]|0,$=y[$+4>>2]|0,P=$>>>0<m>>>0|($|0)==(m|0)&V>>>0<g>>>0,C=P?V:g,P=P?$:m,!ce&&(ce=Mt(7,0,(J^15)*3|0)|0,(V&ce|0)==0&($&(he()|0)|0)==0))T=_;else{if($=(_+-1+F|0)%(F|0)|0,T=Js(g,m)|0,($|0)<0&&Sr(23313,23315,245,23324),F=(T|0)!=0,((F?4:5)|0)<($|0)&&Sr(23313,23315,245,23324),jP(g,m,Ue)|0&&Sr(23313,23315,245,23324),T=(y[Ue>>2]|0)+$|0,F?T=22288+(((T|0)%5|0)<<2)|0:T=22320+(((T|0)%6|0)<<2)|0,$=y[T>>2]|0,($|0)==7&&Sr(23313,23315,245,23324),y[ve>>2]=0,T=Nl(g,m,$,ve,_e)|0,T|0)break;V=_e,F=y[V>>2]|0,V=y[V+4>>2]|0;do if(V>>>0<P>>>0|(V|0)==(P|0)&F>>>0<C>>>0){if(Js(F,V)|0?C=uq(F,V,g,m)|0:C=y[22384+((((y[ve>>2]|0)+(y[22352+($<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,T=Js(F,V)|0,(C+-1|0)>>>0>5){T=-1,C=F,P=V;break}if(T=(T|0)!=0,(C|0)==1&T){T=-1,C=F,P=V;break}do if(jP(F,V,Ue)|0)T=-1;else if(T){T=((y[21936+(C<<2)>>2]|0)+5-(y[Ue>>2]|0)|0)%5|0;break}else{T=((y[21968+(C<<2)>>2]|0)+6-(y[Ue>>2]|0)|0)%6|0;break}while(0);C=F,P=V}else T=_;while(0);$=ge,V=y[$>>2]|0,$=y[$+4>>2]|0}if((C|0)==(V|0)&(P|0)==($|0)){if(F=(Js(V,$)|0)!=0,F?g=uq(V,$,g,m)|0:g=y[22384+((((y[Ze>>2]|0)+(y[22352+(Re<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,T=Js(V,$)|0,(g+-1|0)>>>0<=5&&(je=(T|0)!=0,!((g|0)==1&je)))do if(jP(V,$,Ue)|0)T=-1;else if(je){T=((y[21936+(g<<2)>>2]|0)+5-(y[Ue>>2]|0)|0)%5|0;break}else{T=((y[21968+(g<<2)>>2]|0)+6-(y[Ue>>2]|0)|0)%6|0;break}while(0);else T=-1;T=T+1|0,T=(T|0)==6|F&(T|0)==5?0:T}m=P,g=C;break e}while(0);return w=T,Y=Be,w|0}while(0);return je=Mt(T|0,0,56)|0,Ue=he()|0|m&-2130706433|536870912,y[w>>2]=je|g,y[w+4>>2]=Ue,w=0,Y=Be,w|0}function YYe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0;return C=(Js(g,m)|0)==0,w=Ip(g,m,0,_)|0,T=(w|0)==0,C?!T||(w=Ip(g,m,1,_+8|0)|0,w|0)||(w=Ip(g,m,2,_+16|0)|0,w|0)||(w=Ip(g,m,3,_+24|0)|0,w|0)||(w=Ip(g,m,4,_+32|0)|0,w)?(C=w,C|0):Ip(g,m,5,_+40|0)|0:!T||(w=Ip(g,m,1,_+8|0)|0,w|0)||(w=Ip(g,m,2,_+16|0)|0,w|0)||(w=Ip(g,m,3,_+24|0)|0,w|0)||(w=Ip(g,m,4,_+32|0)|0,w|0)?(C=w,C|0):(C=_+40|0,y[C>>2]=0,y[C+4>>2]=0,C=0,C|0)}function XYe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0,$=0,F=0;return F=Y,Y=Y+192|0,T=F,C=F+168|0,P=dt(g|0,m|0,56)|0,he()|0,P=P&7,$=m&-2130706433|134217728,w=FE(g,$,C)|0,w|0?($=w,Y=F,$|0):(m=dt(g|0,m|0,52)|0,he()|0,m=m&15,Js(g,$)|0?gq(C,m,P,1,T):Aq(C,m,P,1,T),$=T+8|0,y[_>>2]=y[$>>2],y[_+4>>2]=y[$+4>>2],y[_+8>>2]=y[$+8>>2],y[_+12>>2]=y[$+12>>2],$=0,Y=F,$|0)}function ZYe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0;return T=Y,Y=Y+16|0,_=T,!(!0&(m&2013265920|0)==536870912)||(w=m&-2130706433|134217728,!(yq(g,w)|0))?(w=0,Y=T,w|0):(C=dt(g|0,m|0,56)|0,he()|0,C=(Ip(g,w,C&7,_)|0)==0,w=_,w=C&((y[w>>2]|0)==(g|0)?(y[w+4>>2]|0)==(m|0):0)&1,Y=T,w|0)}function Wfe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0;(m|0)>0?(w=Jm(m,4)|0,y[g>>2]=w,w||Sr(23337,23360,40,23374)):y[g>>2]=0,y[g+4>>2]=m,y[g+8>>2]=0,y[g+12>>2]=_}function Qfe(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0;T=g+4|0,C=g+12|0,P=g+8|0;e:for(;;){for(_=y[T>>2]|0,m=0;;){if((m|0)>=(_|0))break e;if(w=y[g>>2]|0,$=y[w+(m<<2)>>2]|0,!$)m=m+1|0;else break}m=w+(~~(+Yr(+(+Tr(10,+ +(15-(y[C>>2]|0)|0))*(+ie[$>>3]+ +ie[$+8>>3])))%+(_|0))>>>0<<2)|0,_=y[m>>2]|0;t:do if(_|0){if(w=$+32|0,(_|0)==($|0))y[m>>2]=y[w>>2];else{if(_=_+32|0,m=y[_>>2]|0,!m)break;for(;(m|0)!=($|0);)if(_=m+32|0,m=y[_>>2]|0,!m)break t;y[_>>2]=y[w>>2]}li($),y[P>>2]=(y[P>>2]|0)+-1}while(0)}li(y[g>>2]|0)}function Yfe(g){g=g|0;var m=0,_=0,w=0;for(w=y[g+4>>2]|0,_=0;;){if((_|0)>=(w|0)){m=0,_=4;break}if(m=y[(y[g>>2]|0)+(_<<2)>>2]|0,!m)_=_+1|0;else{_=4;break}}return(_|0)==4?m|0:0}function Xfe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0;if(_=~~(+Yr(+(+Tr(10,+ +(15-(y[g+12>>2]|0)|0))*(+ie[m>>3]+ +ie[m+8>>3])))%+(y[g+4>>2]|0))>>>0,_=(y[g>>2]|0)+(_<<2)|0,w=y[_>>2]|0,!w)return C=1,C|0;C=m+32|0;do if((w|0)!=(m|0)){if(_=y[w+32>>2]|0,!_)return C=1,C|0;for(T=_;;){if((T|0)==(m|0)){T=8;break}if(_=y[T+32>>2]|0,_)w=T,T=_;else{_=1,T=10;break}}if((T|0)==8){y[w+32>>2]=y[C>>2];break}else if((T|0)==10)return _|0}else y[_>>2]=y[C>>2];while(0);return li(m),C=g+8|0,y[C>>2]=(y[C>>2]|0)+-1,C=0,C|0}function JYe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0;C=Zm(40)|0,C||Sr(23390,23360,98,23403),y[C>>2]=y[m>>2],y[C+4>>2]=y[m+4>>2],y[C+8>>2]=y[m+8>>2],y[C+12>>2]=y[m+12>>2],T=C+16|0,y[T>>2]=y[_>>2],y[T+4>>2]=y[_+4>>2],y[T+8>>2]=y[_+8>>2],y[T+12>>2]=y[_+12>>2],y[C+32>>2]=0,T=~~(+Yr(+(+Tr(10,+ +(15-(y[g+12>>2]|0)|0))*(+ie[m>>3]+ +ie[m+8>>3])))%+(y[g+4>>2]|0))>>>0,T=(y[g>>2]|0)+(T<<2)|0,w=y[T>>2]|0;do if(!w)y[T>>2]=C;else{for(;!(kE(w,m)|0&&kE(w+16|0,_)|0);)if(T=y[w+32>>2]|0,w=T|0?T:w,!(y[w+32>>2]|0)){P=10;break}if((P|0)==10){y[w+32>>2]=C;break}return li(C),P=w,P|0}while(0);return P=g+8|0,y[P>>2]=(y[P>>2]|0)+1,P=C,P|0}function KYe(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0;if(T=~~(+Yr(+(+Tr(10,+ +(15-(y[g+12>>2]|0)|0))*(+ie[m>>3]+ +ie[m+8>>3])))%+(y[g+4>>2]|0))>>>0,T=y[(y[g>>2]|0)+(T<<2)>>2]|0,!T)return _=0,_|0;if(!_){for(g=T;;){if(kE(g,m)|0){w=10;break}if(g=y[g+32>>2]|0,!g){g=0,w=10;break}}if((w|0)==10)return g|0}for(g=T;;){if(kE(g,m)|0&&kE(g+16|0,_)|0){w=10;break}if(g=y[g+32>>2]|0,!g){g=0,w=10;break}}return(w|0)==10?g|0:0}function eXe(g,m){g=g|0,m=m|0;var _=0;if(_=~~(+Yr(+(+Tr(10,+ +(15-(y[g+12>>2]|0)|0))*(+ie[m>>3]+ +ie[m+8>>3])))%+(y[g+4>>2]|0))>>>0,g=y[(y[g>>2]|0)+(_<<2)>>2]|0,!g)return _=0,_|0;for(;;){if(kE(g,m)|0){m=5;break}if(g=y[g+32>>2]|0,!g){g=0,m=5;break}}return(m|0)==5?g|0:0}function tXe(){return 23424}function rXe(g){return g=+g,+ +e0e(+g)}function z1(g){return g=+g,~~+rXe(g)|0}function Zm(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0,Re=0,Ze=0,je=0,Ue=0,Be=0,Me=0,Lt=0;Lt=Y,Y=Y+16|0,_e=Lt;do if(g>>>0<245){if(V=g>>>0<11?16:g+11&-8,g=V>>>3,ce=y[5857]|0,_=ce>>>g,_&3|0)return m=(_&1^1)+g|0,g=23468+(m<<1<<2)|0,_=g+8|0,w=y[_>>2]|0,T=w+8|0,C=y[T>>2]|0,(C|0)==(g|0)?y[5857]=ce&~(1<<m):(y[C+12>>2]=g,y[_>>2]=C),Me=m<<3,y[w+4>>2]=Me|3,Me=w+Me+4|0,y[Me>>2]=y[Me>>2]|1,Me=T,Y=Lt,Me|0;if(J=y[5859]|0,V>>>0>J>>>0){if(_|0)return m=2<<g,m=_<<g&(m|0-m),m=(m&0-m)+-1|0,$=m>>>12&16,m=m>>>$,_=m>>>5&8,m=m>>>_,C=m>>>2&4,m=m>>>C,g=m>>>1&2,m=m>>>g,w=m>>>1&1,w=(_|$|C|g|w)+(m>>>w)|0,m=23468+(w<<1<<2)|0,g=m+8|0,C=y[g>>2]|0,$=C+8|0,_=y[$>>2]|0,(_|0)==(m|0)?(g=ce&~(1<<w),y[5857]=g):(y[_+12>>2]=m,y[g>>2]=_,g=ce),Me=w<<3,P=Me-V|0,y[C+4>>2]=V|3,T=C+V|0,y[T+4>>2]=P|1,y[C+Me>>2]=P,J|0&&(w=y[5862]|0,m=J>>>3,_=23468+(m<<1<<2)|0,m=1<<m,g&m?(g=_+8|0,m=y[g>>2]|0):(y[5857]=g|m,m=_,g=_+8|0),y[g>>2]=w,y[m+12>>2]=w,y[w+8>>2]=m,y[w+12>>2]=_),y[5859]=P,y[5862]=T,Me=$,Y=Lt,Me|0;if(C=y[5858]|0,C){for(_=(C&0-C)+-1|0,T=_>>>12&16,_=_>>>T,w=_>>>5&8,_=_>>>w,P=_>>>2&4,_=_>>>P,$=_>>>1&2,_=_>>>$,F=_>>>1&1,F=y[23732+((w|T|P|$|F)+(_>>>F)<<2)>>2]|0,_=F,$=F,F=(y[F+4>>2]&-8)-V|0;g=y[_+16>>2]|0,!(!g&&(g=y[_+20>>2]|0,!g));)P=(y[g+4>>2]&-8)-V|0,T=P>>>0<F>>>0,_=g,$=T?g:$,F=T?P:F;if(P=$+V|0,P>>>0>$>>>0){T=y[$+24>>2]|0,m=y[$+12>>2]|0;do if((m|0)==($|0)){if(g=$+20|0,m=y[g>>2]|0,!m&&(g=$+16|0,m=y[g>>2]|0,!m)){_=0;break}for(;;)if(w=m+20|0,_=y[w>>2]|0,_)m=_,g=w;else if(w=m+16|0,_=y[w>>2]|0,_)m=_,g=w;else break;y[g>>2]=0,_=m}else _=y[$+8>>2]|0,y[_+12>>2]=m,y[m+8>>2]=_,_=m;while(0);do if(T|0){if(m=y[$+28>>2]|0,g=23732+(m<<2)|0,($|0)==(y[g>>2]|0)){if(y[g>>2]=_,!_){y[5858]=C&~(1<<m);break}}else if(Me=T+16|0,y[((y[Me>>2]|0)==($|0)?Me:T+20|0)>>2]=_,!_)break;y[_+24>>2]=T,m=y[$+16>>2]|0,m|0&&(y[_+16>>2]=m,y[m+24>>2]=_),m=y[$+20>>2]|0,m|0&&(y[_+20>>2]=m,y[m+24>>2]=_)}while(0);return F>>>0<16?(Me=F+V|0,y[$+4>>2]=Me|3,Me=$+Me+4|0,y[Me>>2]=y[Me>>2]|1):(y[$+4>>2]=V|3,y[P+4>>2]=F|1,y[P+F>>2]=F,J|0&&(w=y[5862]|0,m=J>>>3,_=23468+(m<<1<<2)|0,m=1<<m,m&ce?(g=_+8|0,m=y[g>>2]|0):(y[5857]=m|ce,m=_,g=_+8|0),y[g>>2]=w,y[m+12>>2]=w,y[w+8>>2]=m,y[w+12>>2]=_),y[5859]=F,y[5862]=P),Me=$+8|0,Y=Lt,Me|0}else ce=V}else ce=V}else ce=V}else if(g>>>0<=4294967231)if(g=g+11|0,V=g&-8,w=y[5858]|0,w){T=0-V|0,g=g>>>8,g?V>>>0>16777215?F=31:(ce=(g+1048320|0)>>>16&8,Re=g<<ce,$=(Re+520192|0)>>>16&4,Re=Re<<$,F=(Re+245760|0)>>>16&2,F=14-($|ce|F)+(Re<<F>>>15)|0,F=V>>>(F+7|0)&1|F<<1):F=0,_=y[23732+(F<<2)>>2]|0;e:do if(!_)_=0,g=0,Re=61;else for(g=0,$=V<<((F|0)==31?0:25-(F>>>1)|0),C=0;;){if(P=(y[_+4>>2]&-8)-V|0,P>>>0<T>>>0)if(P)g=_,T=P;else{g=_,T=0,Re=65;break e}if(Re=y[_+20>>2]|0,_=y[_+16+($>>>31<<2)>>2]|0,C=(Re|0)==0|(Re|0)==(_|0)?C:Re,_)$=$<<1;else{_=C,Re=61;break}}while(0);if((Re|0)==61){if((_|0)==0&(g|0)==0){if(g=2<<F,g=(g|0-g)&w,!g){ce=V;break}ce=(g&0-g)+-1|0,P=ce>>>12&16,ce=ce>>>P,C=ce>>>5&8,ce=ce>>>C,$=ce>>>2&4,ce=ce>>>$,F=ce>>>1&2,ce=ce>>>F,_=ce>>>1&1,g=0,_=y[23732+((C|P|$|F|_)+(ce>>>_)<<2)>>2]|0}_?Re=65:($=g,P=T)}if((Re|0)==65)for(C=_;;)if(ce=(y[C+4>>2]&-8)-V|0,_=ce>>>0<T>>>0,T=_?ce:T,g=_?C:g,_=y[C+16>>2]|0,_||(_=y[C+20>>2]|0),_)C=_;else{$=g,P=T;break}if($|0&&P>>>0<((y[5859]|0)-V|0)>>>0&&(J=$+V|0,J>>>0>$>>>0)){C=y[$+24>>2]|0,m=y[$+12>>2]|0;do if((m|0)==($|0)){if(g=$+20|0,m=y[g>>2]|0,!m&&(g=$+16|0,m=y[g>>2]|0,!m)){m=0;break}for(;;)if(T=m+20|0,_=y[T>>2]|0,_)m=_,g=T;else if(T=m+16|0,_=y[T>>2]|0,_)m=_,g=T;else break;y[g>>2]=0}else Me=y[$+8>>2]|0,y[Me+12>>2]=m,y[m+8>>2]=Me;while(0);do if(C){if(g=y[$+28>>2]|0,_=23732+(g<<2)|0,($|0)==(y[_>>2]|0)){if(y[_>>2]=m,!m){w=w&~(1<<g),y[5858]=w;break}}else if(Me=C+16|0,y[((y[Me>>2]|0)==($|0)?Me:C+20|0)>>2]=m,!m)break;y[m+24>>2]=C,g=y[$+16>>2]|0,g|0&&(y[m+16>>2]=g,y[g+24>>2]=m),g=y[$+20>>2]|0,g&&(y[m+20>>2]=g,y[g+24>>2]=m)}while(0);e:do if(P>>>0<16)Me=P+V|0,y[$+4>>2]=Me|3,Me=$+Me+4|0,y[Me>>2]=y[Me>>2]|1;else{if(y[$+4>>2]=V|3,y[J+4>>2]=P|1,y[J+P>>2]=P,m=P>>>3,P>>>0<256){_=23468+(m<<1<<2)|0,g=y[5857]|0,m=1<<m,g&m?(g=_+8|0,m=y[g>>2]|0):(y[5857]=g|m,m=_,g=_+8|0),y[g>>2]=J,y[m+12>>2]=J,y[J+8>>2]=m,y[J+12>>2]=_;break}if(m=P>>>8,m?P>>>0>16777215?_=31:(Be=(m+1048320|0)>>>16&8,Me=m<<Be,Ue=(Me+520192|0)>>>16&4,Me=Me<<Ue,_=(Me+245760|0)>>>16&2,_=14-(Ue|Be|_)+(Me<<_>>>15)|0,_=P>>>(_+7|0)&1|_<<1):_=0,m=23732+(_<<2)|0,y[J+28>>2]=_,g=J+16|0,y[g+4>>2]=0,y[g>>2]=0,g=1<<_,!(w&g)){y[5858]=w|g,y[m>>2]=J,y[J+24>>2]=m,y[J+12>>2]=J,y[J+8>>2]=J;break}m=y[m>>2]|0;t:do if((y[m+4>>2]&-8|0)!=(P|0)){for(w=P<<((_|0)==31?0:25-(_>>>1)|0);_=m+16+(w>>>31<<2)|0,g=y[_>>2]|0,!!g;)if((y[g+4>>2]&-8|0)==(P|0)){m=g;break t}else w=w<<1,m=g;y[_>>2]=J,y[J+24>>2]=m,y[J+12>>2]=J,y[J+8>>2]=J;break e}while(0);Be=m+8|0,Me=y[Be>>2]|0,y[Me+12>>2]=J,y[Be>>2]=J,y[J+8>>2]=Me,y[J+12>>2]=m,y[J+24>>2]=0}while(0);return Me=$+8|0,Y=Lt,Me|0}else ce=V}else ce=V;else ce=-1;while(0);if(_=y[5859]|0,_>>>0>=ce>>>0)return m=_-ce|0,g=y[5862]|0,m>>>0>15?(Me=g+ce|0,y[5862]=Me,y[5859]=m,y[Me+4>>2]=m|1,y[g+_>>2]=m,y[g+4>>2]=ce|3):(y[5859]=0,y[5862]=0,y[g+4>>2]=_|3,Me=g+_+4|0,y[Me>>2]=y[Me>>2]|1),Me=g+8|0,Y=Lt,Me|0;if(P=y[5860]|0,P>>>0>ce>>>0)return Ue=P-ce|0,y[5860]=Ue,Me=y[5863]|0,Be=Me+ce|0,y[5863]=Be,y[Be+4>>2]=Ue|1,y[Me+4>>2]=ce|3,Me=Me+8|0,Y=Lt,Me|0;if(y[5975]|0?g=y[5977]|0:(y[5977]=4096,y[5976]=4096,y[5978]=-1,y[5979]=-1,y[5980]=0,y[5968]=0,y[5975]=_e&-16^1431655768,g=4096),$=ce+48|0,F=ce+47|0,C=g+F|0,T=0-g|0,V=C&T,V>>>0<=ce>>>0||(g=y[5967]|0,g|0&&(J=y[5965]|0,_e=J+V|0,_e>>>0<=J>>>0|_e>>>0>g>>>0)))return Me=0,Y=Lt,Me|0;e:do if(y[5968]&4)m=0,Re=143;else{_=y[5863]|0;t:do if(_){for(w=23876;_e=y[w>>2]|0,!(_e>>>0<=_>>>0&&(_e+(y[w+4>>2]|0)|0)>>>0>_>>>0);)if(g=y[w+8>>2]|0,g)w=g;else{Re=128;break t}if(m=C-P&T,m>>>0<2147483647)if(g=V1(m|0)|0,(g|0)==((y[w>>2]|0)+(y[w+4>>2]|0)|0)){if((g|0)!=-1){P=m,C=g,Re=145;break e}}else w=g,Re=136;else m=0}else Re=128;while(0);do if((Re|0)==128)if(_=V1(0)|0,(_|0)!=-1&&(m=_,ve=y[5976]|0,ge=ve+-1|0,m=(ge&m|0?(ge+m&0-ve)-m|0:0)+V|0,ve=y[5965]|0,ge=m+ve|0,m>>>0>ce>>>0&m>>>0<2147483647)){if(_e=y[5967]|0,_e|0&&ge>>>0<=ve>>>0|ge>>>0>_e>>>0){m=0;break}if(g=V1(m|0)|0,(g|0)==(_|0)){P=m,C=_,Re=145;break e}else w=g,Re=136}else m=0;while(0);do if((Re|0)==136){if(_=0-m|0,!($>>>0>m>>>0&(m>>>0<2147483647&(w|0)!=-1)))if((w|0)==-1){m=0;break}else{P=m,C=w,Re=145;break e}if(g=y[5977]|0,g=F-m+g&0-g,g>>>0>=2147483647){P=m,C=w,Re=145;break e}if((V1(g|0)|0)==-1){V1(_|0)|0,m=0;break}else{P=g+m|0,C=w,Re=145;break e}}while(0);y[5968]=y[5968]|4,Re=143}while(0);if((Re|0)==143&&V>>>0<2147483647&&(Ue=V1(V|0)|0,ge=V1(0)|0,Ze=ge-Ue|0,je=Ze>>>0>(ce+40|0)>>>0,!((Ue|0)==-1|je^1|Ue>>>0<ge>>>0&((Ue|0)!=-1&(ge|0)!=-1)^1))&&(P=je?Ze:m,C=Ue,Re=145),(Re|0)==145){m=(y[5965]|0)+P|0,y[5965]=m,m>>>0>(y[5966]|0)>>>0&&(y[5966]=m),F=y[5863]|0;e:do if(F){for(m=23876;;){if(g=y[m>>2]|0,_=y[m+4>>2]|0,(C|0)==(g+_|0)){Re=154;break}if(w=y[m+8>>2]|0,w)m=w;else break}if((Re|0)==154&&(Be=m+4|0,(y[m+12>>2]&8|0)==0)&&C>>>0>F>>>0&g>>>0<=F>>>0){y[Be>>2]=_+P,Me=(y[5860]|0)+P|0,Ue=F+8|0,Ue=Ue&7|0?0-Ue&7:0,Be=F+Ue|0,Ue=Me-Ue|0,y[5863]=Be,y[5860]=Ue,y[Be+4>>2]=Ue|1,y[F+Me+4>>2]=40,y[5864]=y[5979];break}for(C>>>0<(y[5861]|0)>>>0&&(y[5861]=C),_=C+P|0,m=23876;;){if((y[m>>2]|0)==(_|0)){Re=162;break}if(g=y[m+8>>2]|0,g)m=g;else break}if((Re|0)==162&&!(y[m+12>>2]&8|0)){y[m>>2]=C,J=m+4|0,y[J>>2]=(y[J>>2]|0)+P,J=C+8|0,J=C+(J&7|0?0-J&7:0)|0,m=_+8|0,m=_+(m&7|0?0-m&7:0)|0,V=J+ce|0,$=m-J-ce|0,y[J+4>>2]=ce|3;t:do if((F|0)==(m|0))Me=(y[5860]|0)+$|0,y[5860]=Me,y[5863]=V,y[V+4>>2]=Me|1;else{if((y[5862]|0)==(m|0)){Me=(y[5859]|0)+$|0,y[5859]=Me,y[5862]=V,y[V+4>>2]=Me|1,y[V+Me>>2]=Me;break}if(g=y[m+4>>2]|0,(g&3|0)==1){P=g&-8,w=g>>>3;r:do if(g>>>0<256)if(g=y[m+8>>2]|0,_=y[m+12>>2]|0,(_|0)==(g|0)){y[5857]=y[5857]&~(1<<w);break}else{y[g+12>>2]=_,y[_+8>>2]=g;break}else{C=y[m+24>>2]|0,g=y[m+12>>2]|0;do if((g|0)==(m|0)){if(_=m+16|0,w=_+4|0,g=y[w>>2]|0,g)_=w;else if(g=y[_>>2]|0,!g){g=0;break}for(;;)if(T=g+20|0,w=y[T>>2]|0,w)g=w,_=T;else if(T=g+16|0,w=y[T>>2]|0,w)g=w,_=T;else break;y[_>>2]=0}else Me=y[m+8>>2]|0,y[Me+12>>2]=g,y[g+8>>2]=Me;while(0);if(!C)break;_=y[m+28>>2]|0,w=23732+(_<<2)|0;do if((y[w>>2]|0)!=(m|0)){if(Me=C+16|0,y[((y[Me>>2]|0)==(m|0)?Me:C+20|0)>>2]=g,!g)break r}else{if(y[w>>2]=g,g|0)break;y[5858]=y[5858]&~(1<<_);break r}while(0);if(y[g+24>>2]=C,_=m+16|0,w=y[_>>2]|0,w|0&&(y[g+16>>2]=w,y[w+24>>2]=g),_=y[_+4>>2]|0,!_)break;y[g+20>>2]=_,y[_+24>>2]=g}while(0);m=m+P|0,T=P+$|0}else T=$;if(m=m+4|0,y[m>>2]=y[m>>2]&-2,y[V+4>>2]=T|1,y[V+T>>2]=T,m=T>>>3,T>>>0<256){_=23468+(m<<1<<2)|0,g=y[5857]|0,m=1<<m,g&m?(g=_+8|0,m=y[g>>2]|0):(y[5857]=g|m,m=_,g=_+8|0),y[g>>2]=V,y[m+12>>2]=V,y[V+8>>2]=m,y[V+12>>2]=_;break}m=T>>>8;do if(!m)w=0;else{if(T>>>0>16777215){w=31;break}Be=(m+1048320|0)>>>16&8,Me=m<<Be,Ue=(Me+520192|0)>>>16&4,Me=Me<<Ue,w=(Me+245760|0)>>>16&2,w=14-(Ue|Be|w)+(Me<<w>>>15)|0,w=T>>>(w+7|0)&1|w<<1}while(0);if(m=23732+(w<<2)|0,y[V+28>>2]=w,g=V+16|0,y[g+4>>2]=0,y[g>>2]=0,g=y[5858]|0,_=1<<w,!(g&_)){y[5858]=g|_,y[m>>2]=V,y[V+24>>2]=m,y[V+12>>2]=V,y[V+8>>2]=V;break}m=y[m>>2]|0;r:do if((y[m+4>>2]&-8|0)!=(T|0)){for(w=T<<((w|0)==31?0:25-(w>>>1)|0);_=m+16+(w>>>31<<2)|0,g=y[_>>2]|0,!!g;)if((y[g+4>>2]&-8|0)==(T|0)){m=g;break r}else w=w<<1,m=g;y[_>>2]=V,y[V+24>>2]=m,y[V+12>>2]=V,y[V+8>>2]=V;break t}while(0);Be=m+8|0,Me=y[Be>>2]|0,y[Me+12>>2]=V,y[Be>>2]=V,y[V+8>>2]=Me,y[V+12>>2]=m,y[V+24>>2]=0}while(0);return Me=J+8|0,Y=Lt,Me|0}for(m=23876;g=y[m>>2]|0,!(g>>>0<=F>>>0&&(Me=g+(y[m+4>>2]|0)|0,Me>>>0>F>>>0));)m=y[m+8>>2]|0;T=Me+-47|0,g=T+8|0,g=T+(g&7|0?0-g&7:0)|0,T=F+16|0,g=g>>>0<T>>>0?F:g,m=g+8|0,_=P+-40|0,Ue=C+8|0,Ue=Ue&7|0?0-Ue&7:0,Be=C+Ue|0,Ue=_-Ue|0,y[5863]=Be,y[5860]=Ue,y[Be+4>>2]=Ue|1,y[C+_+4>>2]=40,y[5864]=y[5979],_=g+4|0,y[_>>2]=27,y[m>>2]=y[5969],y[m+4>>2]=y[5970],y[m+8>>2]=y[5971],y[m+12>>2]=y[5972],y[5969]=C,y[5970]=P,y[5972]=0,y[5971]=m,m=g+24|0;do Be=m,m=m+4|0,y[m>>2]=7;while((Be+8|0)>>>0<Me>>>0);if((g|0)!=(F|0)){if(C=g-F|0,y[_>>2]=y[_>>2]&-2,y[F+4>>2]=C|1,y[g>>2]=C,m=C>>>3,C>>>0<256){_=23468+(m<<1<<2)|0,g=y[5857]|0,m=1<<m,g&m?(g=_+8|0,m=y[g>>2]|0):(y[5857]=g|m,m=_,g=_+8|0),y[g>>2]=F,y[m+12>>2]=F,y[F+8>>2]=m,y[F+12>>2]=_;break}if(m=C>>>8,m?C>>>0>16777215?w=31:(Be=(m+1048320|0)>>>16&8,Me=m<<Be,Ue=(Me+520192|0)>>>16&4,Me=Me<<Ue,w=(Me+245760|0)>>>16&2,w=14-(Ue|Be|w)+(Me<<w>>>15)|0,w=C>>>(w+7|0)&1|w<<1):w=0,_=23732+(w<<2)|0,y[F+28>>2]=w,y[F+20>>2]=0,y[T>>2]=0,m=y[5858]|0,g=1<<w,!(m&g)){y[5858]=m|g,y[_>>2]=F,y[F+24>>2]=_,y[F+12>>2]=F,y[F+8>>2]=F;break}m=y[_>>2]|0;t:do if((y[m+4>>2]&-8|0)!=(C|0)){for(w=C<<((w|0)==31?0:25-(w>>>1)|0);_=m+16+(w>>>31<<2)|0,g=y[_>>2]|0,!!g;)if((y[g+4>>2]&-8|0)==(C|0)){m=g;break t}else w=w<<1,m=g;y[_>>2]=F,y[F+24>>2]=m,y[F+12>>2]=F,y[F+8>>2]=F;break e}while(0);Be=m+8|0,Me=y[Be>>2]|0,y[Me+12>>2]=F,y[Be>>2]=F,y[F+8>>2]=Me,y[F+12>>2]=m,y[F+24>>2]=0}}else Me=y[5861]|0,(Me|0)==0|C>>>0<Me>>>0&&(y[5861]=C),y[5969]=C,y[5970]=P,y[5972]=0,y[5866]=y[5975],y[5865]=-1,y[5870]=23468,y[5869]=23468,y[5872]=23476,y[5871]=23476,y[5874]=23484,y[5873]=23484,y[5876]=23492,y[5875]=23492,y[5878]=23500,y[5877]=23500,y[5880]=23508,y[5879]=23508,y[5882]=23516,y[5881]=23516,y[5884]=23524,y[5883]=23524,y[5886]=23532,y[5885]=23532,y[5888]=23540,y[5887]=23540,y[5890]=23548,y[5889]=23548,y[5892]=23556,y[5891]=23556,y[5894]=23564,y[5893]=23564,y[5896]=23572,y[5895]=23572,y[5898]=23580,y[5897]=23580,y[5900]=23588,y[5899]=23588,y[5902]=23596,y[5901]=23596,y[5904]=23604,y[5903]=23604,y[5906]=23612,y[5905]=23612,y[5908]=23620,y[5907]=23620,y[5910]=23628,y[5909]=23628,y[5912]=23636,y[5911]=23636,y[5914]=23644,y[5913]=23644,y[5916]=23652,y[5915]=23652,y[5918]=23660,y[5917]=23660,y[5920]=23668,y[5919]=23668,y[5922]=23676,y[5921]=23676,y[5924]=23684,y[5923]=23684,y[5926]=23692,y[5925]=23692,y[5928]=23700,y[5927]=23700,y[5930]=23708,y[5929]=23708,y[5932]=23716,y[5931]=23716,Me=P+-40|0,Ue=C+8|0,Ue=Ue&7|0?0-Ue&7:0,Be=C+Ue|0,Ue=Me-Ue|0,y[5863]=Be,y[5860]=Ue,y[Be+4>>2]=Ue|1,y[C+Me+4>>2]=40,y[5864]=y[5979];while(0);if(m=y[5860]|0,m>>>0>ce>>>0)return Ue=m-ce|0,y[5860]=Ue,Me=y[5863]|0,Be=Me+ce|0,y[5863]=Be,y[Be+4>>2]=Ue|1,y[Me+4>>2]=ce|3,Me=Me+8|0,Y=Lt,Me|0}return Me=tXe()|0,y[Me>>2]=12,Me=0,Y=Lt,Me|0}function li(g){g=g|0;var m=0,_=0,w=0,T=0,C=0,P=0,$=0,F=0;if(g){_=g+-8|0,T=y[5861]|0,g=y[g+-4>>2]|0,m=g&-8,F=_+m|0;do if(g&1)$=_,P=_;else{if(w=y[_>>2]|0,!(g&3)||(P=_+(0-w)|0,C=w+m|0,P>>>0<T>>>0))return;if((y[5862]|0)==(P|0)){if(g=F+4|0,m=y[g>>2]|0,(m&3|0)!=3){$=P,m=C;break}y[5859]=C,y[g>>2]=m&-2,y[P+4>>2]=C|1,y[P+C>>2]=C;return}if(_=w>>>3,w>>>0<256)if(g=y[P+8>>2]|0,m=y[P+12>>2]|0,(m|0)==(g|0)){y[5857]=y[5857]&~(1<<_),$=P,m=C;break}else{y[g+12>>2]=m,y[m+8>>2]=g,$=P,m=C;break}T=y[P+24>>2]|0,g=y[P+12>>2]|0;do if((g|0)==(P|0)){if(m=P+16|0,_=m+4|0,g=y[_>>2]|0,g)m=_;else if(g=y[m>>2]|0,!g){g=0;break}for(;;)if(w=g+20|0,_=y[w>>2]|0,_)g=_,m=w;else if(w=g+16|0,_=y[w>>2]|0,_)g=_,m=w;else break;y[m>>2]=0}else $=y[P+8>>2]|0,y[$+12>>2]=g,y[g+8>>2]=$;while(0);if(T){if(m=y[P+28>>2]|0,_=23732+(m<<2)|0,(y[_>>2]|0)==(P|0)){if(y[_>>2]=g,!g){y[5858]=y[5858]&~(1<<m),$=P,m=C;break}}else if($=T+16|0,y[((y[$>>2]|0)==(P|0)?$:T+20|0)>>2]=g,!g){$=P,m=C;break}y[g+24>>2]=T,m=P+16|0,_=y[m>>2]|0,_|0&&(y[g+16>>2]=_,y[_+24>>2]=g),m=y[m+4>>2]|0,m?(y[g+20>>2]=m,y[m+24>>2]=g,$=P,m=C):($=P,m=C)}else $=P,m=C}while(0);if(!(P>>>0>=F>>>0)&&(g=F+4|0,w=y[g>>2]|0,!!(w&1))){if(w&2)y[g>>2]=w&-2,y[$+4>>2]=m|1,y[P+m>>2]=m,T=m;else{if((y[5863]|0)==(F|0)){if(F=(y[5860]|0)+m|0,y[5860]=F,y[5863]=$,y[$+4>>2]=F|1,($|0)!=(y[5862]|0))return;y[5862]=0,y[5859]=0;return}if((y[5862]|0)==(F|0)){F=(y[5859]|0)+m|0,y[5859]=F,y[5862]=P,y[$+4>>2]=F|1,y[P+F>>2]=F;return}T=(w&-8)+m|0,_=w>>>3;do if(w>>>0<256)if(m=y[F+8>>2]|0,g=y[F+12>>2]|0,(g|0)==(m|0)){y[5857]=y[5857]&~(1<<_);break}else{y[m+12>>2]=g,y[g+8>>2]=m;break}else{C=y[F+24>>2]|0,g=y[F+12>>2]|0;do if((g|0)==(F|0)){if(m=F+16|0,_=m+4|0,g=y[_>>2]|0,g)m=_;else if(g=y[m>>2]|0,!g){_=0;break}for(;;)if(w=g+20|0,_=y[w>>2]|0,_)g=_,m=w;else if(w=g+16|0,_=y[w>>2]|0,_)g=_,m=w;else break;y[m>>2]=0,_=g}else _=y[F+8>>2]|0,y[_+12>>2]=g,y[g+8>>2]=_,_=g;while(0);if(C|0){if(g=y[F+28>>2]|0,m=23732+(g<<2)|0,(y[m>>2]|0)==(F|0)){if(y[m>>2]=_,!_){y[5858]=y[5858]&~(1<<g);break}}else if(w=C+16|0,y[((y[w>>2]|0)==(F|0)?w:C+20|0)>>2]=_,!_)break;y[_+24>>2]=C,g=F+16|0,m=y[g>>2]|0,m|0&&(y[_+16>>2]=m,y[m+24>>2]=_),g=y[g+4>>2]|0,g|0&&(y[_+20>>2]=g,y[g+24>>2]=_)}}while(0);if(y[$+4>>2]=T|1,y[P+T>>2]=T,($|0)==(y[5862]|0)){y[5859]=T;return}}if(g=T>>>3,T>>>0<256){_=23468+(g<<1<<2)|0,m=y[5857]|0,g=1<<g,m&g?(m=_+8|0,g=y[m>>2]|0):(y[5857]=m|g,g=_,m=_+8|0),y[m>>2]=$,y[g+12>>2]=$,y[$+8>>2]=g,y[$+12>>2]=_;return}g=T>>>8,g?T>>>0>16777215?w=31:(P=(g+1048320|0)>>>16&8,F=g<<P,C=(F+520192|0)>>>16&4,F=F<<C,w=(F+245760|0)>>>16&2,w=14-(C|P|w)+(F<<w>>>15)|0,w=T>>>(w+7|0)&1|w<<1):w=0,g=23732+(w<<2)|0,y[$+28>>2]=w,y[$+20>>2]=0,y[$+16>>2]=0,m=y[5858]|0,_=1<<w;e:do if(!(m&_))y[5858]=m|_,y[g>>2]=$,y[$+24>>2]=g,y[$+12>>2]=$,y[$+8>>2]=$;else{g=y[g>>2]|0;t:do if((y[g+4>>2]&-8|0)!=(T|0)){for(w=T<<((w|0)==31?0:25-(w>>>1)|0);_=g+16+(w>>>31<<2)|0,m=y[_>>2]|0,!!m;)if((y[m+4>>2]&-8|0)==(T|0)){g=m;break t}else w=w<<1,g=m;y[_>>2]=$,y[$+24>>2]=g,y[$+12>>2]=$,y[$+8>>2]=$;break e}while(0);P=g+8|0,F=y[P>>2]|0,y[F+12>>2]=$,y[P>>2]=$,y[$+8>>2]=F,y[$+12>>2]=g,y[$+24>>2]=0}while(0);if(F=(y[5865]|0)+-1|0,y[5865]=F,!(F|0)){for(g=23884;g=y[g>>2]|0,g;)g=g+8|0;y[5865]=-1}}}}function Jm(g,m){g=g|0,m=m|0;var _=0;return g?(_=ya(m,g)|0,(m|g)>>>0>65535&&(_=((_>>>0)/(g>>>0)|0|0)==(m|0)?_:-1)):_=0,g=Zm(_)|0,!g||!(y[g+-4>>2]&3)||ww(g|0,0,_|0)|0,g|0}function Qi(g,m,_,w){return g=g|0,m=m|0,_=_|0,w=w|0,_=g+_>>>0,Xr(m+w+(_>>>0<g>>>0|0)>>>0|0),_|0|0}function zc(g,m,_,w){return g=g|0,m=m|0,_=_|0,w=w|0,w=m-w-(_>>>0>g>>>0|0)>>>0,Xr(w|0),g-_>>>0|0|0}function Zfe(g){return g=g|0,(g?31-(Cu(g^g-1)|0)|0:32)|0}function Eq(g,m,_,w,T){g=g|0,m=m|0,_=_|0,w=w|0,T=T|0;var C=0,P=0,$=0,F=0,V=0,J=0,ce=0,_e=0,ve=0,ge=0;if(J=g,F=m,V=F,P=_,_e=w,$=_e,!V)return C=(T|0)!=0,$?C?(y[T>>2]=g|0,y[T+4>>2]=m&0,_e=0,T=0,Xr(_e|0),T|0):(_e=0,T=0,Xr(_e|0),T|0):(C&&(y[T>>2]=(J>>>0)%(P>>>0),y[T+4>>2]=0),_e=0,T=(J>>>0)/(P>>>0)>>>0,Xr(_e|0),T|0);C=($|0)==0;do if(P){if(!C){if(C=(Cu($|0)|0)-(Cu(V|0)|0)|0,C>>>0<=31){ce=C+1|0,$=31-C|0,m=C-31>>31,P=ce,g=J>>>(ce>>>0)&m|V<<$,m=V>>>(ce>>>0)&m,C=0,$=J<<$;break}return T?(y[T>>2]=g|0,y[T+4>>2]=F|m&0,_e=0,T=0,Xr(_e|0),T|0):(_e=0,T=0,Xr(_e|0),T|0)}if(C=P-1|0,C&P|0){$=(Cu(P|0)|0)+33-(Cu(V|0)|0)|0,ge=64-$|0,ce=32-$|0,F=ce>>31,ve=$-32|0,m=ve>>31,P=$,g=ce-1>>31&V>>>(ve>>>0)|(V<<ce|J>>>($>>>0))&m,m=m&V>>>($>>>0),C=J<<ge&F,$=(V<<ge|J>>>(ve>>>0))&F|J<<ce&$-33>>31;break}return T|0&&(y[T>>2]=C&J,y[T+4>>2]=0),(P|0)==1?(ve=F|m&0,ge=g|0|0,Xr(ve|0),ge|0):(ge=Zfe(P|0)|0,ve=V>>>(ge>>>0)|0,ge=V<<32-ge|J>>>(ge>>>0)|0,Xr(ve|0),ge|0)}else{if(C)return T|0&&(y[T>>2]=(V>>>0)%(P>>>0),y[T+4>>2]=0),ve=0,ge=(V>>>0)/(P>>>0)>>>0,Xr(ve|0),ge|0;if(!J)return T|0&&(y[T>>2]=0,y[T+4>>2]=(V>>>0)%($>>>0)),ve=0,ge=(V>>>0)/($>>>0)>>>0,Xr(ve|0),ge|0;if(C=$-1|0,!(C&$))return T|0&&(y[T>>2]=g|0,y[T+4>>2]=C&V|m&0),ve=0,ge=V>>>((Zfe($|0)|0)>>>0),Xr(ve|0),ge|0;if(C=(Cu($|0)|0)-(Cu(V|0)|0)|0,C>>>0<=30){m=C+1|0,$=31-C|0,P=m,g=V<<$|J>>>(m>>>0),m=V>>>(m>>>0),C=0,$=J<<$;break}return T?(y[T>>2]=g|0,y[T+4>>2]=F|m&0,ve=0,ge=0,Xr(ve|0),ge|0):(ve=0,ge=0,Xr(ve|0),ge|0)}while(0);if(!P)V=$,F=0,$=0;else{ce=_|0|0,J=_e|w&0,V=Qi(ce|0,J|0,-1,-1)|0,_=he()|0,F=$,$=0;do w=F,F=C>>>31|F<<1,C=$|C<<1,w=g<<1|w>>>31|0,_e=g>>>31|m<<1|0,zc(V|0,_|0,w|0,_e|0)|0,ge=he()|0,ve=ge>>31|((ge|0)<0?-1:0)<<1,$=ve&1,g=zc(w|0,_e|0,ve&ce|0,(((ge|0)<0?-1:0)>>31|((ge|0)<0?-1:0)<<1)&J|0)|0,m=he()|0,P=P-1|0;while(P|0);V=F,F=0}return P=0,T|0&&(y[T>>2]=g,y[T+4>>2]=m),ve=(C|0)>>>31|(V|P)<<1|(P<<1|C>>>31)&0|F,ge=(C<<1|0>>>31)&-2|$,Xr(ve|0),ge|0}function bw(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0,V=0;return V=m>>31|((m|0)<0?-1:0)<<1,F=((m|0)<0?-1:0)>>31|((m|0)<0?-1:0)<<1,C=w>>31|((w|0)<0?-1:0)<<1,T=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,$=zc(V^g|0,F^m|0,V|0,F|0)|0,P=he()|0,g=C^V,m=T^F,zc((Eq($,P,zc(C^_|0,T^w|0,C|0,T|0)|0,he()|0,0)|0)^g|0,(he()|0)^m|0,g|0,m|0)|0}function iXe(g,m){g=g|0,m=m|0;var _=0,w=0,T=0,C=0;return C=g&65535,T=m&65535,_=ya(T,C)|0,w=g>>>16,g=(_>>>16)+(ya(T,w)|0)|0,T=m>>>16,m=ya(T,C)|0,Xr((g>>>16)+(ya(T,w)|0)+(((g&65535)+m|0)>>>16)|0),g+m<<16|_&65535|0|0}function Vc(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0;return T=g,C=_,_=iXe(T,C)|0,g=he()|0,Xr((ya(m,C)|0)+(ya(w,T)|0)+g|g&0|0),_|0|0|0}function kF(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0,P=0,$=0,F=0,V=0;return T=Y,Y=Y+16|0,$=T|0,P=m>>31|((m|0)<0?-1:0)<<1,C=((m|0)<0?-1:0)>>31|((m|0)<0?-1:0)<<1,V=w>>31|((w|0)<0?-1:0)<<1,F=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,g=zc(P^g|0,C^m|0,P|0,C|0)|0,m=he()|0,Eq(g,m,zc(V^_|0,F^w|0,V|0,F|0)|0,he()|0,$)|0,w=zc(y[$>>2]^P|0,y[$+4>>2]^C|0,P|0,C|0)|0,_=he()|0,Y=T,Xr(_|0),w|0}function UE(g,m,_,w){g=g|0,m=m|0,_=_|0,w=w|0;var T=0,C=0;return C=Y,Y=Y+16|0,T=C|0,Eq(g,m,_,w,T)|0,Y=C,Xr(y[T+4>>2]|0),y[T>>2]|0|0}function Jfe(g,m,_){return g=g|0,m=m|0,_=_|0,(_|0)<32?(Xr(m>>_|0),g>>>_|(m&(1<<_)-1)<<32-_):(Xr(((m|0)<0?-1:0)|0),m>>_-32|0)}function dt(g,m,_){return g=g|0,m=m|0,_=_|0,(_|0)<32?(Xr(m>>>_|0),g>>>_|(m&(1<<_)-1)<<32-_):(Xr(0),m>>>_-32|0)}function Mt(g,m,_){return g=g|0,m=m|0,_=_|0,(_|0)<32?(Xr(m<<_|(g&(1<<_)-1<<32-_)>>>32-_|0),g<<_):(Xr(g<<_-32|0),0)}function Kfe(g,m){return g=+g,m=+m,g!=g?+m:m!=m?+g:+k1(+g,+m)}function Cq(g,m){return g=+g,m=+m,g!=g?+m:m!=m?+g:+Td(+g,+m)}function UF(g){return g=+g,g>=0?+Rn(g+.5):+Oi(g-.5)}function BF(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0;if((_|0)>=8192)return gw(g|0,m|0,_|0)|0,g|0;if(C=g|0,T=g+_|0,(g&3)==(m&3)){for(;g&3;){if(!_)return C|0;et[g>>0]=et[m>>0]|0,g=g+1|0,m=m+1|0,_=_-1|0}for(_=T&-4|0,w=_-64|0;(g|0)<=(w|0);)y[g>>2]=y[m>>2],y[g+4>>2]=y[m+4>>2],y[g+8>>2]=y[m+8>>2],y[g+12>>2]=y[m+12>>2],y[g+16>>2]=y[m+16>>2],y[g+20>>2]=y[m+20>>2],y[g+24>>2]=y[m+24>>2],y[g+28>>2]=y[m+28>>2],y[g+32>>2]=y[m+32>>2],y[g+36>>2]=y[m+36>>2],y[g+40>>2]=y[m+40>>2],y[g+44>>2]=y[m+44>>2],y[g+48>>2]=y[m+48>>2],y[g+52>>2]=y[m+52>>2],y[g+56>>2]=y[m+56>>2],y[g+60>>2]=y[m+60>>2],g=g+64|0,m=m+64|0;for(;(g|0)<(_|0);)y[g>>2]=y[m>>2],g=g+4|0,m=m+4|0}else for(_=T-4|0;(g|0)<(_|0);)et[g>>0]=et[m>>0]|0,et[g+1>>0]=et[m+1>>0]|0,et[g+2>>0]=et[m+2>>0]|0,et[g+3>>0]=et[m+3>>0]|0,g=g+4|0,m=m+4|0;for(;(g|0)<(T|0);)et[g>>0]=et[m>>0]|0,g=g+1|0,m=m+1|0;return C|0}function ww(g,m,_){g=g|0,m=m|0,_=_|0;var w=0,T=0,C=0,P=0;if(C=g+_|0,m=m&255,(_|0)>=67){for(;g&3;)et[g>>0]=m,g=g+1|0;for(w=C&-4|0,P=m|m<<8|m<<16|m<<24,T=w-64|0;(g|0)<=(T|0);)y[g>>2]=P,y[g+4>>2]=P,y[g+8>>2]=P,y[g+12>>2]=P,y[g+16>>2]=P,y[g+20>>2]=P,y[g+24>>2]=P,y[g+28>>2]=P,y[g+32>>2]=P,y[g+36>>2]=P,y[g+40>>2]=P,y[g+44>>2]=P,y[g+48>>2]=P,y[g+52>>2]=P,y[g+56>>2]=P,y[g+60>>2]=P,g=g+64|0;for(;(g|0)<(w|0);)y[g>>2]=P,g=g+4|0}for(;(g|0)<(C|0);)et[g>>0]=m,g=g+1|0;return C-_|0}function e0e(g){return g=+g,g>=0?+Rn(g+.5):+Oi(g-.5)}function V1(g){g=g|0;var m=0,_=0,w=0;return w=DE()|0,_=y[Mn>>2]|0,m=_+g|0,(g|0)>0&(m|0)<(_|0)|(m|0)<0?(We(m|0)|0,Ll(12),-1):(m|0)>(w|0)&&!(me(m|0)|0)?(Ll(12),-1):(y[Mn>>2]=m,_|0)}return{___divdi3:bw,___muldi3:Vc,___remdi3:kF,___uremdi3:UE,_areNeighborCells:GQe,_bitshift64Ashr:Jfe,_bitshift64Lshr:dt,_bitshift64Shl:Mt,_calloc:Jm,_cellAreaKm2:xYe,_cellAreaM2:TYe,_cellAreaRads2:Sq,_cellToBoundary:zP,_cellToCenterChild:nYe,_cellToChildPos:pYe,_cellToChildren:rYe,_cellToChildrenSize:FF,_cellToLatLng:BP,_cellToLocalIj:PYe,_cellToParent:_q,_cellToVertex:Ip,_cellToVertexes:YYe,_cellsToDirectedEdge:jQe,_cellsToLinkedMultiPolygon:MQe,_childPosToCell:fYe,_compactCells:sYe,_destroyLinkedMultiPolygon:Bfe,_directedEdgeToBoundary:NF,_directedEdgeToCells:QQe,_edgeLengthKm:EYe,_edgeLengthM:CYe,_edgeLengthRads:SYe,_emscripten_replace_memory:Zr,_free:li,_getBaseCellNumber:Dfe,_getDirectedEdgeDestination:qQe,_getDirectedEdgeOrigin:HQe,_getHexagonAreaAvgKm2:_Ye,_getHexagonAreaAvgM2:vYe,_getHexagonEdgeLengthAvgKm:bYe,_getHexagonEdgeLengthAvgM:wYe,_getIcosahedronFaces:Nfe,_getNumCells:Tq,_getPentagons:xq,_getRes0Cells:$Qe,_getResolution:tYe,_greatCircleDistanceKm:GP,_greatCircleDistanceM:gYe,_greatCircleDistanceRads:mYe,_gridDisk:FP,_gridDiskDistances:kP,_gridDistance:$Ye,_gridPathCells:LYe,_gridPathCellsSize:DYe,_gridRingUnsafe:TQe,_i64Add:Qi,_i64Subtract:zc,_isPentagon:Js,_isResClassIII:lYe,_isValidCell:yq,_isValidDirectedEdge:WQe,_isValidVertex:ZYe,_latLngToCell:Lfe,_llvm_maxnum_f64:Kfe,_llvm_minnum_f64:Cq,_llvm_round_f64:UF,_localIjToCell:IYe,_malloc:Zm,_maxFaceCount:hYe,_maxGridDiskSize:IF,_maxPolygonToCellsSize:SQe,_memcpy:BF,_memset:ww,_originToDirectedEdges:YQe,_pentagonCount:dYe,_polygonToCells:EQe,_readInt64AsDoubleFromPointer:HYe,_res0CellCount:IQe,_round:e0e,_sbrk:V1,_sizeOfCellBoundary:BYe,_sizeOfCoordIJ:jYe,_sizeOfGeoLoop:zYe,_sizeOfGeoPolygon:VYe,_sizeOfH3Index:kYe,_sizeOfLatLng:UYe,_sizeOfLinkedGeoPolygon:GYe,_uncompactCells:oYe,_uncompactCellsSize:aYe,_vertexToLatLng:XYe,establishStackSpace:Xm,stackAlloc:Wo,stackRestore:oc,stackSave:Os}}(Gn,ms,X);e.___divdi3=tt.___divdi3,e.___muldi3=tt.___muldi3,e.___remdi3=tt.___remdi3,e.___uremdi3=tt.___uremdi3,e._areNeighborCells=tt._areNeighborCells,e._bitshift64Ashr=tt._bitshift64Ashr,e._bitshift64Lshr=tt._bitshift64Lshr,e._bitshift64Shl=tt._bitshift64Shl,e._calloc=tt._calloc,e._cellAreaKm2=tt._cellAreaKm2,e._cellAreaM2=tt._cellAreaM2,e._cellAreaRads2=tt._cellAreaRads2,e._cellToBoundary=tt._cellToBoundary,e._cellToCenterChild=tt._cellToCenterChild,e._cellToChildPos=tt._cellToChildPos,e._cellToChildren=tt._cellToChildren,e._cellToChildrenSize=tt._cellToChildrenSize,e._cellToLatLng=tt._cellToLatLng,e._cellToLocalIj=tt._cellToLocalIj,e._cellToParent=tt._cellToParent,e._cellToVertex=tt._cellToVertex,e._cellToVertexes=tt._cellToVertexes,e._cellsToDirectedEdge=tt._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=tt._cellsToLinkedMultiPolygon,e._childPosToCell=tt._childPosToCell,e._compactCells=tt._compactCells,e._destroyLinkedMultiPolygon=tt._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=tt._directedEdgeToBoundary,e._directedEdgeToCells=tt._directedEdgeToCells,e._edgeLengthKm=tt._edgeLengthKm,e._edgeLengthM=tt._edgeLengthM,e._edgeLengthRads=tt._edgeLengthRads;var ma=e._emscripten_replace_memory=tt._emscripten_replace_memory;e._free=tt._free,e._getBaseCellNumber=tt._getBaseCellNumber,e._getDirectedEdgeDestination=tt._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=tt._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=tt._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=tt._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=tt._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=tt._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=tt._getIcosahedronFaces,e._getNumCells=tt._getNumCells,e._getPentagons=tt._getPentagons,e._getRes0Cells=tt._getRes0Cells,e._getResolution=tt._getResolution,e._greatCircleDistanceKm=tt._greatCircleDistanceKm,e._greatCircleDistanceM=tt._greatCircleDistanceM,e._greatCircleDistanceRads=tt._greatCircleDistanceRads,e._gridDisk=tt._gridDisk,e._gridDiskDistances=tt._gridDiskDistances,e._gridDistance=tt._gridDistance,e._gridPathCells=tt._gridPathCells,e._gridPathCellsSize=tt._gridPathCellsSize,e._gridRingUnsafe=tt._gridRingUnsafe,e._i64Add=tt._i64Add,e._i64Subtract=tt._i64Subtract,e._isPentagon=tt._isPentagon,e._isResClassIII=tt._isResClassIII,e._isValidCell=tt._isValidCell,e._isValidDirectedEdge=tt._isValidDirectedEdge,e._isValidVertex=tt._isValidVertex,e._latLngToCell=tt._latLngToCell,e._llvm_maxnum_f64=tt._llvm_maxnum_f64,e._llvm_minnum_f64=tt._llvm_minnum_f64,e._llvm_round_f64=tt._llvm_round_f64,e._localIjToCell=tt._localIjToCell,e._malloc=tt._malloc,e._maxFaceCount=tt._maxFaceCount,e._maxGridDiskSize=tt._maxGridDiskSize,e._maxPolygonToCellsSize=tt._maxPolygonToCellsSize,e._memcpy=tt._memcpy,e._memset=tt._memset,e._originToDirectedEdges=tt._originToDirectedEdges,e._pentagonCount=tt._pentagonCount,e._polygonToCells=tt._polygonToCells,e._readInt64AsDoubleFromPointer=tt._readInt64AsDoubleFromPointer,e._res0CellCount=tt._res0CellCount,e._round=tt._round,e._sbrk=tt._sbrk,e._sizeOfCellBoundary=tt._sizeOfCellBoundary,e._sizeOfCoordIJ=tt._sizeOfCoordIJ,e._sizeOfGeoLoop=tt._sizeOfGeoLoop,e._sizeOfGeoPolygon=tt._sizeOfGeoPolygon,e._sizeOfH3Index=tt._sizeOfH3Index,e._sizeOfLatLng=tt._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=tt._sizeOfLinkedGeoPolygon,e._uncompactCells=tt._uncompactCells,e._uncompactCellsSize=tt._uncompactCellsSize,e._vertexToLatLng=tt._vertexToLatLng,e.establishStackSpace=tt.establishStackSpace;var Do=e.stackAlloc=tt.stackAlloc,Rs=e.stackRestore=tt.stackRestore,Zn=e.stackSave=tt.stackSave;if(e.asm=tt,e.cwrap=O,e.setValue=A,e.getValue=v,Lr){Ut(Lr)||(Lr=s(Lr));{ri();var Dn=function($e){$e.byteLength&&($e=new Uint8Array($e)),se.set($e,p),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,Wi()},gs=function(){o(Lr,Dn,function(){throw"could not load memory initializer "+Lr})},rn=dn(Lr);if(rn)Dn(rn.buffer);else if(e.memoryInitializerRequest){var ga=function(){var $e=e.memoryInitializerRequest,qe=$e.response;if($e.status!==200&&$e.status!==0){var ft=dn(e.memoryInitializerRequestURL);if(ft)qe=ft.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+$e.status+", retrying "+Lr),gs();return}}Dn(qe)};e.memoryInitializerRequest.response?setTimeout(ga,0):e.memoryInitializerRequest.addEventListener("load",ga)}else gs()}}var La;vr=function $e(){La||De(),La||(vr=$e)};function De($e){if(rr>0||(Ke(),rr>0))return;function qe(){La||(La=!0,!b&&(vt(),ke(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),Ne()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),qe()},1)):qe()}e.run=De;function Li($e){throw e.onAbort&&e.onAbort($e),$e+="",a($e),l($e),b=!0,"abort("+$e+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=Li,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return De(),t}(typeof H2=="object"?H2:{}),Ci="number",Jr=Ci,h$=Ci,ui=Ci,hi=Ci,Zc=Ci,hr=Ci,Hjt=[["sizeOfH3Index",Ci],["sizeOfLatLng",Ci],["sizeOfCellBoundary",Ci],["sizeOfGeoLoop",Ci],["sizeOfGeoPolygon",Ci],["sizeOfLinkedGeoPolygon",Ci],["sizeOfCoordIJ",Ci],["readInt64AsDoubleFromPointer",Ci],["isValidCell",h$,[ui,hi]],["latLngToCell",Jr,[Ci,Ci,Zc,hr]],["cellToLatLng",Jr,[ui,hi,hr]],["cellToBoundary",Jr,[ui,hi,hr]],["maxGridDiskSize",Jr,[Ci,hr]],["gridDisk",Jr,[ui,hi,Ci,hr]],["gridDiskDistances",Jr,[ui,hi,Ci,hr,hr]],["gridRingUnsafe",Jr,[ui,hi,Ci,hr]],["maxPolygonToCellsSize",Jr,[hr,Zc,Ci,hr]],["polygonToCells",Jr,[hr,Zc,Ci,hr]],["cellsToLinkedMultiPolygon",Jr,[hr,Ci,hr]],["destroyLinkedMultiPolygon",null,[hr]],["compactCells",Jr,[hr,hr,Ci,Ci]],["uncompactCells",Jr,[hr,Ci,Ci,hr,Ci,Zc]],["uncompactCellsSize",Jr,[hr,Ci,Ci,Zc,hr]],["isPentagon",h$,[ui,hi]],["isResClassIII",h$,[ui,hi]],["getBaseCellNumber",Ci,[ui,hi]],["getResolution",Ci,[ui,hi]],["maxFaceCount",Jr,[ui,hi,hr]],["getIcosahedronFaces",Jr,[ui,hi,hr]],["cellToParent",Jr,[ui,hi,Zc,hr]],["cellToChildren",Jr,[ui,hi,Zc,hr]],["cellToCenterChild",Jr,[ui,hi,Zc,hr]],["cellToChildrenSize",Jr,[ui,hi,Zc,hr]],["cellToChildPos",Jr,[ui,hi,Zc,hr]],["childPosToCell",Jr,[Ci,Ci,ui,hi,Zc,hr]],["areNeighborCells",Jr,[ui,hi,ui,hi,hr]],["cellsToDirectedEdge",Jr,[ui,hi,ui,hi,hr]],["getDirectedEdgeOrigin",Jr,[ui,hi,hr]],["getDirectedEdgeDestination",Jr,[ui,hi,hr]],["isValidDirectedEdge",h$,[ui,hi]],["directedEdgeToCells",Jr,[ui,hi,hr]],["originToDirectedEdges",Jr,[ui,hi,hr]],["directedEdgeToBoundary",Jr,[ui,hi,hr]],["gridDistance",Jr,[ui,hi,ui,hi,hr]],["gridPathCells",Jr,[ui,hi,ui,hi,hr]],["gridPathCellsSize",Jr,[ui,hi,ui,hi,hr]],["cellToLocalIj",Jr,[ui,hi,ui,hi,Ci,hr]],["localIjToCell",Jr,[ui,hi,hr,Ci,hr]],["getHexagonAreaAvgM2",Jr,[Zc,hr]],["getHexagonAreaAvgKm2",Jr,[Zc,hr]],["getHexagonEdgeLengthAvgM",Jr,[Zc,hr]],["getHexagonEdgeLengthAvgKm",Jr,[Zc,hr]],["greatCircleDistanceM",Ci,[hr,hr]],["greatCircleDistanceKm",Ci,[hr,hr]],["greatCircleDistanceRads",Ci,[hr,hr]],["cellAreaM2",Jr,[ui,hi,hr]],["cellAreaKm2",Jr,[ui,hi,hr]],["cellAreaRads2",Jr,[ui,hi,hr]],["edgeLengthM",Jr,[ui,hi,hr]],["edgeLengthKm",Jr,[ui,hi,hr]],["edgeLengthRads",Jr,[ui,hi,hr]],["getNumCells",Jr,[Zc,hr]],["getRes0Cells",Jr,[hr]],["res0CellCount",Ci],["getPentagons",Jr,[Ci,hr]],["pentagonCount",Ci],["cellToVertex",Jr,[ui,hi,Ci,hr]],["cellToVertexes",Jr,[ui,hi,hr]],["vertexToLatLng",Jr,[ui,hi,hr]],["isValidVertex",h$,[ui,hi]]],qjt=0,Wjt=1,Qjt=2,Yjt=3,Xjt=4,Zjt=5,Jjt=6,Kjt=7,eHt=8,tHt=9,rHt=10,iHt=11,nHt=12,sHt=13,oHt=14,aHt=15,kc={};kc[qjt]="Success";kc[Wjt]="The operation failed but a more specific error is not available";kc[Qjt]="Argument was outside of acceptable range";kc[Yjt]="Latitude or longitude arguments were outside of acceptable range";kc[Xjt]="Resolution argument was outside of acceptable range";kc[Zjt]="Cell argument was not valid";kc[Jjt]="Directed edge argument was not valid";kc[Kjt]="Undirected edge argument was not valid";kc[eHt]="Vertex argument was not valid";kc[tHt]="Pentagon distortion was encountered";kc[rHt]="Duplicate input";kc[iHt]="Cell arguments were not neighbors";kc[nHt]="Cell arguments had incompatible resolutions";kc[sHt]="Memory allocation failed";kc[oHt]="Bounds of provided memory were insufficient";kc[aHt]="Mode or flags argument was not valid";var lHt="Unknown error";function cHt(t,e,r){var i=r&&"value"in r,n=new Error((t[e]||lHt)+" (code: "+e+(i?", value: "+r.value:"")+")");return n.code=e,n}function uHt(t,e){var r=arguments.length===2?{value:e}:{};return cHt(kc,t,r)}function hHt(t){if(t!==0)throw uHt(t)}var L1={};Hjt.forEach(function(e){L1[e[0]]=H2.cwrap.apply(H2,e)});var _Se=16,mV=8;L1.sizeOfH3Index();L1.sizeOfLatLng();var dHt=L1.sizeOfCellBoundary();L1.sizeOfGeoPolygon();L1.sizeOfGeoLoop();L1.sizeOfLinkedGeoPolygon();L1.sizeOfCoordIJ();var pHt=/[^0-9a-fA-F]/;function fHt(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||pHt.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),_Se),r=parseInt(t.substring(t.length-8),_Se);return[r,e]}function gV(t){return _Ht(H2.getValue(t,"double"))}function mHt(t){return[gV(t),gV(t+mV)]}function gHt(t){return[gV(t+mV),gV(t)]}function AHt(t,e,r){for(var i=H2.getValue(t,"i32"),n=t+mV,s=[],o=e?gHt:mHt,a=0;a<i*2;a+=2)s.push(o(n+mV*a));return r&&s.push(s[0]),s}function yHt(t,e){var r=H2._malloc(dHt),i=fHt(t),n=i[0],s=i[1];try{return hHt(L1.cellToBoundary(n,s,r)),AHt(r,e,e)}finally{H2._free(r)}}function _Ht(t){return t*180/Math.PI}function vHt(t,e){const r=e.map(s=>s.count);r.reduce((s,o)=>Math.min(s,o)),r.reduce((s,o)=>Math.max(s,o));const i=new JO({title:"{h3}",content:wHt}),n=[];e.forEach(s=>{const o=new Pl({geometry:new Hf({rings:[yHt(s.h3,!0)]}),attributes:s,symbol:bHt(s.count),popupTemplate:i});o.geometry.extent.width>50&&xHt(o),n.push(o)}),console.log(`adding ${n.length} hexbins...`),t.removeAll(),t.graphics.addMany(n)}function bHt(t){let r=[255,0,0,.5];return t>1e6?r=[0,128,0,.5]:t>5e5?r=[54,205,50,.5]:t>5e4?r=[255,255,0,.5]:t>1e3&&(r=[255,69,0,.5]),{type:"simple-fill",color:r,outline:{color:"whitesmoke",width:0}}}function wHt(t){return`${parseInt(t.graphic.attributes.count).toLocaleString()} soundings within this hexbin`}function xHt(t){const e=[],r=t.geometry;if(r.rings.length>1){console.warn("function only supports simple geometries");return}r.rings[0].forEach(i=>{i[0]<0?e.push([i[0]+360,i[1]]):e.push(i)}),r.rings=[e]}function THt({query:t}){var l;const e="MapPanel",r=xs.useRef(null),i=xs.useRef(),n=xs.useRef(),s=[-98.5833,39.8333],o=4,a=(l=t.data)==null?void 0:l.counts_by_h3;return xs.useEffect(()=>{if(!r.current)return;const c=new TPe({basemap:"oceans"}),u=new gjt({map:c,container:r.current,zoom:o,center:s});n.current=new Ajt,c.add(n.current);let d=new jjt({view:u});u.when(function(){i.current=u,u.ui.add(d,"bottom-left")})},[r.current]),xs.useEffect(()=>{a&&n.current&&vHt(n.current,a)},[a]),Po(hN,{children:[qr("div",{className:e,ref:r}),t.isLoading?qr("h3",{children:"loading data..."}):"",t.isError?Po("p",{children:["Error: ",t.error.message]}):""]})}function SHt({query:t}){const e="MetricsPanel",r=t.data;return Po("div",{className:e,children:[r?Po(hN,{children:[Po("p",{children:["Report Date: ",qr("span",{className:"emphasis",children:r.report_date})]}),Po("p",{children:["Total Count: ",qr("span",{className:"emphasis",children:parseInt(r.record_count).toLocaleString("en-US")})]}),Po("p",{children:["Archive Dates:",qr("br",{}),Po("span",{className:"emphasis",children:[r.min_entry_date," to ",r.max_entry_date]})]}),Po("p",{children:[qr("span",{className:"emphasis",children:r.order_count.count})," orders in the last 30 days"]})]}):"",t.isLoading?qr("h3",{children:"loading data..."}):"",t.isError?Po("p",{children:["Error: ",t.error.message]}):""]})}function EHt({children:t}){return qr("div",{className:"SidePanel",children:t})}function CHt({query:t}){var s,o;const e="ProvidersPanel";function r(a){if(!a)return;const l=Object.keys(a).map(c=>{const u=parseInt(a[c]);let d=Math.round(u/i*100).toString();d==="0"&&(d="<1");const p=`${u.toLocaleString("en-US")} (${d}%)`;return{provider:c,count:u,label:p}});return l.sort((c,u)=>u.count-c.count),l}const i=(s=t==null?void 0:t.data)==null?void 0:s.record_count,n=r((o=t.data)==null?void 0:o.counts_by_provider);return Po("div",{className:e,children:[n?Po(hN,{children:[qr("div",{className:"tableCaption",children:"Providers"}),qr("div",{className:"tableContainer",children:qr("table",{children:qr("tbody",{children:n.map(a=>Po("tr",{children:[qr("td",{className:"providerName",children:a.provider}),qr("td",{className:"providerLabel",children:a.label})]},a.provider))})})})]}):"",t.isLoading?qr("h3",{children:"loading data..."}):"",t.isError?Po("p",{children:["Error: ",t.error.message]}):""]})}function md(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function AF(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Spe(t){let e,r,i;t.length!==2?(e=md,r=(a,l)=>md(t(a),l),i=(a,l)=>t(a)-l):(e=t===md||t===AF?t:MHt,r=t,i=t);function n(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{const d=c+u>>>1;r(a[d],l)<0?c=d+1:u=d}while(c<u)}return c}function s(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{const d=c+u>>>1;r(a[d],l)<=0?c=d+1:u=d}while(c<u)}return c}function o(a,l,c=0,u=a.length){const d=n(a,l,c,u-1);return d>c&&i(a[d-1],l)>-i(a[d],l)?d-1:d}return{left:n,center:o,right:s}}function MHt(){return 0}function oGe(t){return t===null?NaN:+t}function*RHt(t,e){if(e===void 0)for(let r of t)r!=null&&(r=+r)>=r&&(yield r);else{let r=-1;for(let i of t)(i=e(i,++r,t))!=null&&(i=+i)>=i&&(yield i)}}const OHt=Spe(md),PHt=OHt.right;Spe(oGe).center;const Epe=PHt;function IHt(t){return t.length|0}function $Ht(t){return!(t>0)}function DHt(t){return typeof t!="object"||"length"in t?t:Array.from(t)}function LHt(t){return e=>t(...e)}function NHt(...t){const e=typeof t[t.length-1]=="function"&&LHt(t.pop());t=t.map(DHt);const r=t.map(IHt),i=t.length-1,n=new Array(i+1).fill(0),s=[];if(i<0||r.some($Ht))return s;for(;;){s.push(n.map((a,l)=>t[l][a]));let o=i;for(;++n[o]===r[o];){if(o===0)return e?s.map(e):s;n[o--]=0}}}function FHt(t,e){var r=0,i=0;return Float64Array.from(t,e===void 0?n=>r+=+n||0:n=>r+=+e(n,i++,t)||0)}function aGe(t,e){let r=0,i,n=0,s=0;if(e===void 0)for(let o of t)o!=null&&(o=+o)>=o&&(i=o-n,n+=i/++r,s+=i*(o-n));else{let o=-1;for(let a of t)(a=e(a,++o,t))!=null&&(a=+a)>=a&&(i=a-n,n+=i/++r,s+=i*(a-n))}if(r>1)return s/(r-1)}function kHt(t,e){const r=aGe(t,e);return r&&Math.sqrt(r)}function IO(t,e){let r,i;if(e===void 0)for(const n of t)n!=null&&(r===void 0?n>=n&&(r=i=n):(r>n&&(r=n),i<n&&(i=n)));else{let n=-1;for(let s of t)(s=e(s,++n,t))!=null&&(r===void 0?s>=s&&(r=i=s):(r>s&&(r=s),i<s&&(i=s)))}return[r,i]}class rE{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const r=this._partials;let i=0;for(let n=0;n<this._n&&n<32;n++){const s=r[n],o=e+s,a=Math.abs(e)<Math.abs(s)?e-(o-s):s-(o-e);a&&(r[i++]=a),e=o}return r[i]=e,this._n=i+1,this}valueOf(){const e=this._partials;let r=this._n,i,n,s,o=0;if(r>0){for(o=e[--r];r>0&&(i=o,n=e[--r],o=i+n,s=n-(o-i),!s););r>0&&(s<0&&e[r-1]<0||s>0&&e[r-1]>0)&&(n=s*2,i=o+n,n==i-o&&(o=i))}return o}}class q2 extends Map{constructor(e,r=uGe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),e!=null)for(const[i,n]of e)this.set(i,n)}get(e){return super.get(Vse(this,e))}has(e){return super.has(Vse(this,e))}set(e,r){return super.set(lGe(this,e),r)}delete(e){return super.delete(cGe(this,e))}}class Cpe extends Set{constructor(e,r=uGe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),e!=null)for(const i of e)this.add(i)}has(e){return super.has(Vse(this,e))}add(e){return super.add(lGe(this,e))}delete(e){return super.delete(cGe(this,e))}}function Vse({_intern:t,_key:e},r){const i=e(r);return t.has(i)?t.get(i):r}function lGe({_intern:t,_key:e},r){const i=e(r);return t.has(i)?t.get(i):(t.set(i,r),r)}function cGe({_intern:t,_key:e},r){const i=e(r);return t.has(i)&&(r=t.get(i),t.delete(i)),r}function uGe(t){return t!==null&&typeof t=="object"?t.valueOf():t}function Gse(t){return t}function hGe(t,...e){return dGe(t,Gse,Gse,e)}function wR(t,e,...r){return dGe(t,Gse,e,r)}function dGe(t,e,r,i){return function n(s,o){if(o>=i.length)return r(s);const a=new q2,l=i[o++];let c=-1;for(const u of s){const d=l(u,++c,s),p=a.get(d);p?p.push(u):a.set(d,[u])}for(const[u,d]of a)a.set(u,n(d,o));return e(a)}(t,0)}function UHt(t,e){return Array.from(e,r=>t[r])}function AV(t,...e){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");t=Array.from(t);let[r]=e;if(r&&r.length!==2||e.length>1){const i=Uint32Array.from(t,(n,s)=>s);return e.length>1?(e=e.map(n=>t.map(n)),i.sort((n,s)=>{for(const o of e){const a=yV(o[n],o[s]);if(a)return a}})):(r=t.map(r),i.sort((n,s)=>yV(r[n],r[s]))),UHt(t,i)}return t.sort(pGe(r))}function pGe(t=md){if(t===md)return yV;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,r)=>{const i=t(e,r);return i||i===0?i:(t(r,r)===0)-(t(e,e)===0)}}function yV(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}function Mpe(t,e,r){return(e.length!==2?AV(wR(t,e,r),([i,n],[s,o])=>md(n,o)||md(i,s)):AV(hGe(t,r),([i,n],[s,o])=>e(n,o)||md(i,s))).map(([i])=>i)}const BHt=Math.sqrt(50),zHt=Math.sqrt(10),VHt=Math.sqrt(2);function _V(t,e,r){const i=(e-t)/Math.max(0,r),n=Math.floor(Math.log10(i)),s=i/Math.pow(10,n),o=s>=BHt?10:s>=zHt?5:s>=VHt?2:1;let a,l,c;return n<0?(c=Math.pow(10,-n)/o,a=Math.round(t*c),l=Math.round(e*c),a/c<t&&++a,l/c>e&&--l,c=-c):(c=Math.pow(10,n)*o,a=Math.round(t/c),l=Math.round(e/c),a*c<t&&++a,l*c>e&&--l),l<a&&.5<=r&&r<2?_V(t,e,r*2):[a,l,c]}function vV(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];const i=e<t,[n,s,o]=i?_V(e,t,r):_V(t,e,r);if(!(s>=n))return[];const a=s-n+1,l=new Array(a);if(i)if(o<0)for(let c=0;c<a;++c)l[c]=(s-c)/-o;else for(let c=0;c<a;++c)l[c]=(s-c)*o;else if(o<0)for(let c=0;c<a;++c)l[c]=(n+c)/-o;else for(let c=0;c<a;++c)l[c]=(n+c)*o;return l}function jse(t,e,r){return e=+e,t=+t,r=+r,_V(t,e,r)[2]}function Hse(t,e,r){e=+e,t=+t,r=+r;const i=e<t,n=i?jse(e,t,r):jse(t,e,r);return(i?-1:1)*(n<0?1/-n:n)}function GA(t,e){let r;if(e===void 0)for(const i of t)i!=null&&(r<i||r===void 0&&i>=i)&&(r=i);else{let i=-1;for(let n of t)(n=e(n,++i,t))!=null&&(r<n||r===void 0&&n>=n)&&(r=n)}return r}function GHt(t,e){let r,i=-1,n=-1;if(e===void 0)for(const s of t)++n,s!=null&&(r<s||r===void 0&&s>=s)&&(r=s,i=n);else for(let s of t)(s=e(s,++n,t))!=null&&(r<s||r===void 0&&s>=s)&&(r=s,i=n);return i}function p1(t,e){let r;if(e===void 0)for(const i of t)i!=null&&(r>i||r===void 0&&i>=i)&&(r=i);else{let i=-1;for(let n of t)(n=e(n,++i,t))!=null&&(r>n||r===void 0&&n>=n)&&(r=n)}return r}function jHt(t,e){let r,i=-1,n=-1;if(e===void 0)for(const s of t)++n,s!=null&&(r>s||r===void 0&&s>=s)&&(r=s,i=n);else for(let s of t)(s=e(s,++n,t))!=null&&(r>s||r===void 0&&s>=s)&&(r=s,i=n);return i}function fGe(t,e,r=0,i=1/0,n){if(e=Math.floor(e),r=Math.floor(Math.max(0,r)),i=Math.floor(Math.min(t.length-1,i)),!(r<=e&&e<=i))return t;for(n=n===void 0?yV:pGe(n);i>r;){if(i-r>600){const l=i-r+1,c=e-r+1,u=Math.log(l),d=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*d*(l-d)/l)*(c-l/2<0?-1:1),A=Math.max(r,Math.floor(e-c*d/l+p)),v=Math.min(i,Math.floor(e+(l-c)*d/l+p));fGe(t,e,A,v,n)}const s=t[e];let o=r,a=i;for(d$(t,r,e),n(t[i],s)>0&&d$(t,r,i);o<a;){for(d$(t,o,a),++o,--a;n(t[o],s)<0;)++o;for(;n(t[a],s)>0;)--a}n(t[r],s)===0?d$(t,r,a):(++a,d$(t,a,i)),a<=e&&(r=a+1),e<=a&&(i=a-1)}return t}function d$(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function mGe(t,e=md){let r,i=!1;if(e.length===1){let n;for(const s of t){const o=e(s);(i?md(o,n)>0:md(o,o)===0)&&(r=s,n=o,i=!0)}}else for(const n of t)(i?e(n,r)>0:e(n,n)===0)&&(r=n,i=!0);return r}function bV(t,e,r){if(t=Float64Array.from(RHt(t,r)),!(!(i=t.length)||isNaN(e=+e))){if(e<=0||i<2)return p1(t);if(e>=1)return GA(t);var i,n=(i-1)*e,s=Math.floor(n),o=GA(fGe(t,s).subarray(0,s+1)),a=p1(t.subarray(s+1));return o+(a-o)*(n-s)}}function HHt(t,e,r=oGe){if(!(!(i=t.length)||isNaN(e=+e))){if(e<=0||i<2)return+r(t[0],0,t);if(e>=1)return+r(t[i-1],i-1,t);var i,n=(i-1)*e,s=Math.floor(n),o=+r(t[s],s,t),a=+r(t[s+1],s+1,t);return o+(a-o)*(n-s)}}function qHt(t,e){let r=0,i=0;if(e===void 0)for(let n of t)n!=null&&(n=+n)>=n&&(++r,i+=n);else{let n=-1;for(let s of t)(s=e(s,++n,t))!=null&&(s=+s)>=s&&(++r,i+=s)}if(r)return i/r}function qse(t,e){return bV(t,.5,e)}function*WHt(t){for(const e of t)yield*e}function gGe(t){return Array.from(WHt(t))}function QHt(t,e){const r=new q2;if(e===void 0)for(let s of t)s!=null&&s>=s&&r.set(s,(r.get(s)||0)+1);else{let s=-1;for(let o of t)(o=e(o,++s,t))!=null&&o>=o&&r.set(o,(r.get(o)||0)+1)}let i,n=0;for(const[s,o]of r)o>n&&(n=o,i=s);return i}function Wse(t,e,r){t=+t,e=+e,r=(n=arguments.length)<2?(e=t,t=0,1):n<3?1:+r;for(var i=-1,n=Math.max(0,Math.ceil((e-t)/r))|0,s=new Array(n);++i<n;)s[i]=t+i*r;return s}function iE(t,e){let r=0;if(e===void 0)for(let i of t)(i=+i)&&(r+=i);else{let i=-1;for(let n of t)(n=+e(n,++i,t))&&(r+=n)}return r}function wV(t){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");return Array.from(t).reverse()}function YHt(t){return t}var pZ=1,fZ=2,Qse=3,K9=4,vSe=1e-6;function XHt(t){return"translate("+t+",0)"}function ZHt(t){return"translate(0,"+t+")"}function JHt(t){return e=>+t(e)}function KHt(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),r=>+t(r)+e}function eqt(){return!this.__axis}function tqt(t,e){var r=[],i=null,n=null,s=6,o=6,a=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=t===pZ||t===K9?-1:1,u=t===K9||t===fZ?"x":"y",d=t===pZ||t===Qse?XHt:ZHt;function p(A){var v=i??(e.ticks?e.ticks.apply(e,r):e.domain()),b=n??(e.tickFormat?e.tickFormat.apply(e,r):YHt),S=Math.max(s,0)+a,E=e.range(),R=+E[0]+l,O=+E[E.length-1]+l,I=(e.bandwidth?KHt:JHt)(e.copy(),l),N=A.selection?A.selection():A,L=N.selectAll(".domain").data([null]),B=N.selectAll(".tick").data(v,e).order(),U=B.exit(),q=B.enter().append("g").attr("class","tick"),Z=B.select("line"),X=B.select("text");L=L.merge(L.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),B=B.merge(q),Z=Z.merge(q.append("line").attr("stroke","currentColor").attr(u+"2",c*s)),X=X.merge(q.append("text").attr("fill","currentColor").attr(u,c*S).attr("dy",t===pZ?"0em":t===Qse?"0.71em":"0.32em")),A!==N&&(L=L.transition(A),B=B.transition(A),Z=Z.transition(A),X=X.transition(A),U=U.transition(A).attr("opacity",vSe).attr("transform",function(ee){return isFinite(ee=I(ee))?d(ee+l):this.getAttribute("transform")}),q.attr("opacity",vSe).attr("transform",function(ee){var se=this.parentNode.__axis;return d((se&&isFinite(se=se(ee))?se:I(ee))+l)})),U.remove(),L.attr("d",t===K9||t===fZ?o?"M"+c*o+","+R+"H"+l+"V"+O+"H"+c*o:"M"+l+","+R+"V"+O:o?"M"+R+","+c*o+"V"+l+"H"+O+"V"+c*o:"M"+R+","+l+"H"+O),B.attr("opacity",1).attr("transform",function(ee){return d(I(ee)+l)}),Z.attr(u+"2",c*s),X.attr(u,c*S).text(b),N.filter(eqt).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===fZ?"start":t===K9?"end":"middle"),N.each(function(){this.__axis=I})}return p.scale=function(A){return arguments.length?(e=A,p):e},p.ticks=function(){return r=Array.from(arguments),p},p.tickArguments=function(A){return arguments.length?(r=A==null?[]:Array.from(A),p):r.slice()},p.tickValues=function(A){return arguments.length?(i=A==null?null:Array.from(A),p):i&&i.slice()},p.tickFormat=function(A){return arguments.length?(n=A,p):n},p.tickSize=function(A){return arguments.length?(s=o=+A,p):s},p.tickSizeInner=function(A){return arguments.length?(s=+A,p):s},p.tickSizeOuter=function(A){return arguments.length?(o=+A,p):o},p.tickPadding=function(A){return arguments.length?(a=+A,p):a},p.offset=function(A){return arguments.length?(l=+A,p):l},p}function rqt(t){return tqt(Qse,t)}var iqt={value:()=>{}};function AGe(){for(var t=0,e=arguments.length,r={},i;t<e;++t){if(!(i=arguments[t]+"")||i in r||/[\s.]/.test(i))throw new Error("illegal type: "+i);r[i]=[]}return new SU(r)}function SU(t){this._=t}function nqt(t,e){return t.trim().split(/^|\s+/).map(function(r){var i="",n=r.indexOf(".");if(n>=0&&(i=r.slice(n+1),r=r.slice(0,n)),r&&!e.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:i}})}SU.prototype=AGe.prototype={constructor:SU,on:function(t,e){var r=this._,i=nqt(t+"",r),n,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((n=(t=i[s]).type)&&(n=sqt(r[n],t.name)))return n;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(n=(t=i[s]).type)r[n]=bSe(r[n],t.name,e);else if(e==null)for(n in r)r[n]=bSe(r[n],t.name,null);return this},copy:function(){var t={},e=this._;for(var r in e)t[r]=e[r].slice();return new SU(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var r=new Array(n),i=0,n,s;i<n;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,n=s.length;i<n;++i)s[i].value.apply(e,r)},apply:function(t,e,r){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],n=0,s=i.length;n<s;++n)i[n].value.apply(e,r)}};function sqt(t,e){for(var r=0,i=t.length,n;r<i;++r)if((n=t[r]).name===e)return n.value}function bSe(t,e,r){for(var i=0,n=t.length;i<n;++i)if(t[i].name===e){t[i]=iqt,t=t.slice(0,i).concat(t.slice(i+1));break}return r!=null&&t.push({name:e,value:r}),t}var Yse="http://www.w3.org/1999/xhtml";const $O={svg:"http://www.w3.org/2000/svg",xhtml:Yse,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function DH(t){var e=t+="",r=e.indexOf(":");return r>=0&&(e=t.slice(0,r))!=="xmlns"&&(t=t.slice(r+1)),$O.hasOwnProperty(e)?{space:$O[e],local:t}:t}function oqt(t){return function(){var e=this.ownerDocument,r=this.namespaceURI;return r===Yse&&e.documentElement.namespaceURI===Yse?e.createElement(t):e.createElementNS(r,t)}}function aqt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Rpe(t){var e=DH(t);return(e.local?aqt:oqt)(e)}function lqt(){}function Ope(t){return t==null?lqt:function(){return this.querySelector(t)}}function cqt(t){typeof t!="function"&&(t=Ope(t));for(var e=this._groups,r=e.length,i=new Array(r),n=0;n<r;++n)for(var s=e[n],o=s.length,a=i[n]=new Array(o),l,c,u=0;u<o;++u)(l=s[u])&&(c=t.call(l,l.__data__,u,s))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new Ep(i,this._parents)}function uqt(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function hqt(){return[]}function yGe(t){return t==null?hqt:function(){return this.querySelectorAll(t)}}function dqt(t){return function(){return uqt(t.apply(this,arguments))}}function pqt(t){typeof t=="function"?t=dqt(t):t=yGe(t);for(var e=this._groups,r=e.length,i=[],n=[],s=0;s<r;++s)for(var o=e[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(i.push(t.call(l,l.__data__,c,o)),n.push(l));return new Ep(i,n)}function _Ge(t){return function(){return this.matches(t)}}function vGe(t){return function(e){return e.matches(t)}}var fqt=Array.prototype.find;function mqt(t){return function(){return fqt.call(this.children,t)}}function gqt(){return this.firstElementChild}function Aqt(t){return this.select(t==null?gqt:mqt(typeof t=="function"?t:vGe(t)))}var yqt=Array.prototype.filter;function _qt(){return Array.from(this.children)}function vqt(t){return function(){return yqt.call(this.children,t)}}function bqt(t){return this.selectAll(t==null?_qt:vqt(typeof t=="function"?t:vGe(t)))}function wqt(t){typeof t!="function"&&(t=_Ge(t));for(var e=this._groups,r=e.length,i=new Array(r),n=0;n<r;++n)for(var s=e[n],o=s.length,a=i[n]=[],l,c=0;c<o;++c)(l=s[c])&&t.call(l,l.__data__,c,s)&&a.push(l);return new Ep(i,this._parents)}function bGe(t){return new Array(t.length)}function xqt(){return new Ep(this._enter||this._groups.map(bGe),this._parents)}function xV(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}xV.prototype={constructor:xV,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Tqt(t){return function(){return t}}function Sqt(t,e,r,i,n,s){for(var o=0,a,l=e.length,c=s.length;o<c;++o)(a=e[o])?(a.__data__=s[o],i[o]=a):r[o]=new xV(t,s[o]);for(;o<l;++o)(a=e[o])&&(n[o]=a)}function Eqt(t,e,r,i,n,s,o){var a,l,c=new Map,u=e.length,d=s.length,p=new Array(u),A;for(a=0;a<u;++a)(l=e[a])&&(p[a]=A=o.call(l,l.__data__,a,e)+"",c.has(A)?n[a]=l:c.set(A,l));for(a=0;a<d;++a)A=o.call(t,s[a],a,s)+"",(l=c.get(A))?(i[a]=l,l.__data__=s[a],c.delete(A)):r[a]=new xV(t,s[a]);for(a=0;a<u;++a)(l=e[a])&&c.get(p[a])===l&&(n[a]=l)}function Cqt(t){return t.__data__}function Mqt(t,e){if(!arguments.length)return Array.from(this,Cqt);var r=e?Eqt:Sqt,i=this._parents,n=this._groups;typeof t!="function"&&(t=Tqt(t));for(var s=n.length,o=new Array(s),a=new Array(s),l=new Array(s),c=0;c<s;++c){var u=i[c],d=n[c],p=d.length,A=Rqt(t.call(u,u&&u.__data__,c,i)),v=A.length,b=a[c]=new Array(v),S=o[c]=new Array(v),E=l[c]=new Array(p);r(u,d,b,S,E,A,e);for(var R=0,O=0,I,N;R<v;++R)if(I=b[R]){for(R>=O&&(O=R+1);!(N=S[O])&&++O<v;);I._next=N||null}}return o=new Ep(o,i),o._enter=a,o._exit=l,o}function Rqt(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Oqt(){return new Ep(this._exit||this._groups.map(bGe),this._parents)}function Pqt(t,e,r){var i=this.enter(),n=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(n=e(n),n&&(n=n.selection())),r==null?s.remove():r(s),i&&n?i.merge(n).order():n}function Iqt(t){for(var e=t.selection?t.selection():t,r=this._groups,i=e._groups,n=r.length,s=i.length,o=Math.min(n,s),a=new Array(n),l=0;l<o;++l)for(var c=r[l],u=i[l],d=c.length,p=a[l]=new Array(d),A,v=0;v<d;++v)(A=c[v]||u[v])&&(p[v]=A);for(;l<n;++l)a[l]=r[l];return new Ep(a,this._parents)}function $qt(){for(var t=this._groups,e=-1,r=t.length;++e<r;)for(var i=t[e],n=i.length-1,s=i[n],o;--n>=0;)(o=i[n])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Dqt(t){t||(t=Lqt);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var r=this._groups,i=r.length,n=new Array(i),s=0;s<i;++s){for(var o=r[s],a=o.length,l=n[s]=new Array(a),c,u=0;u<a;++u)(c=o[u])&&(l[u]=c);l.sort(e)}return new Ep(n,this._parents).order()}function Lqt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Nqt(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Fqt(){return Array.from(this)}function kqt(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var i=t[e],n=0,s=i.length;n<s;++n){var o=i[n];if(o)return o}return null}function Uqt(){let t=0;for(const e of this)++t;return t}function Bqt(){return!this.node()}function zqt(t){for(var e=this._groups,r=0,i=e.length;r<i;++r)for(var n=e[r],s=0,o=n.length,a;s<o;++s)(a=n[s])&&t.call(a,a.__data__,s,n);return this}function Vqt(t){return function(){this.removeAttribute(t)}}function Gqt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function jqt(t,e){return function(){this.setAttribute(t,e)}}function Hqt(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function qqt(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttribute(t):this.setAttribute(t,r)}}function Wqt(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,r)}}function Qqt(t,e){var r=DH(t);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((e==null?r.local?Gqt:Vqt:typeof e=="function"?r.local?Wqt:qqt:r.local?Hqt:jqt)(r,e))}function wGe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Yqt(t){return function(){this.style.removeProperty(t)}}function Xqt(t,e,r){return function(){this.style.setProperty(t,e,r)}}function Zqt(t,e,r){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,r)}}function Jqt(t,e,r){return arguments.length>1?this.each((e==null?Yqt:typeof e=="function"?Zqt:Xqt)(t,e,r??"")):DO(this.node(),t)}function DO(t,e){return t.style.getPropertyValue(e)||wGe(t).getComputedStyle(t,null).getPropertyValue(e)}function Kqt(t){return function(){delete this[t]}}function eWt(t,e){return function(){this[t]=e}}function tWt(t,e){return function(){var r=e.apply(this,arguments);r==null?delete this[t]:this[t]=r}}function rWt(t,e){return arguments.length>1?this.each((e==null?Kqt:typeof e=="function"?tWt:eWt)(t,e)):this.node()[t]}function xGe(t){return t.trim().split(/^|\s+/)}function Ppe(t){return t.classList||new TGe(t)}function TGe(t){this._node=t,this._names=xGe(t.getAttribute("class")||"")}TGe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function SGe(t,e){for(var r=Ppe(t),i=-1,n=e.length;++i<n;)r.add(e[i])}function EGe(t,e){for(var r=Ppe(t),i=-1,n=e.length;++i<n;)r.remove(e[i])}function iWt(t){return function(){SGe(this,t)}}function nWt(t){return function(){EGe(this,t)}}function sWt(t,e){return function(){(e.apply(this,arguments)?SGe:EGe)(this,t)}}function oWt(t,e){var r=xGe(t+"");if(arguments.length<2){for(var i=Ppe(this.node()),n=-1,s=r.length;++n<s;)if(!i.contains(r[n]))return!1;return!0}return this.each((typeof e=="function"?sWt:e?iWt:nWt)(r,e))}function aWt(){this.textContent=""}function lWt(t){return function(){this.textContent=t}}function cWt(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function uWt(t){return arguments.length?this.each(t==null?aWt:(typeof t=="function"?cWt:lWt)(t)):this.node().textContent}function hWt(){this.innerHTML=""}function dWt(t){return function(){this.innerHTML=t}}function pWt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function fWt(t){return arguments.length?this.each(t==null?hWt:(typeof t=="function"?pWt:dWt)(t)):this.node().innerHTML}function mWt(){this.nextSibling&&this.parentNode.appendChild(this)}function gWt(){return this.each(mWt)}function AWt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function yWt(){return this.each(AWt)}function _Wt(t){var e=typeof t=="function"?t:Rpe(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function vWt(){return null}function bWt(t,e){var r=typeof t=="function"?t:Rpe(t),i=e==null?vWt:typeof e=="function"?e:Ope(e);return this.select(function(){return this.insertBefore(r.apply(this,arguments),i.apply(this,arguments)||null)})}function wWt(){var t=this.parentNode;t&&t.removeChild(this)}function xWt(){return this.each(wWt)}function TWt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function SWt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function EWt(t){return this.select(t?SWt:TWt)}function CWt(t){return arguments.length?this.property("__data__",t):this.node().__data__}function MWt(t){return function(e){t.call(this,e,this.__data__)}}function RWt(t){return t.trim().split(/^|\s+/).map(function(e){var r="",i=e.indexOf(".");return i>=0&&(r=e.slice(i+1),e=e.slice(0,i)),{type:e,name:r}})}function OWt(t){return function(){var e=this.__on;if(e){for(var r=0,i=-1,n=e.length,s;r<n;++r)s=e[r],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function PWt(t,e,r){return function(){var i=this.__on,n,s=MWt(e);if(i){for(var o=0,a=i.length;o<a;++o)if((n=i[o]).type===t.type&&n.name===t.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=s,n.options=r),n.value=e;return}}this.addEventListener(t.type,s,r),n={type:t.type,name:t.name,value:e,listener:s,options:r},i?i.push(n):this.__on=[n]}}function IWt(t,e,r){var i=RWt(t+""),n,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(n=0,u=a[l];n<s;++n)if((o=i[n]).type===u.type&&o.name===u.name)return u.value}return}for(a=e?PWt:OWt,n=0;n<s;++n)this.each(a(i[n],e,r));return this}function CGe(t,e,r){var i=wGe(t),n=i.CustomEvent;typeof n=="function"?n=new n(e,r):(n=i.document.createEvent("Event"),r?(n.initEvent(e,r.bubbles,r.cancelable),n.detail=r.detail):n.initEvent(e,!1,!1)),t.dispatchEvent(n)}function $Wt(t,e){return function(){return CGe(this,t,e)}}function DWt(t,e){return function(){return CGe(this,t,e.apply(this,arguments))}}function LWt(t,e){return this.each((typeof e=="function"?DWt:$Wt)(t,e))}function*NWt(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var i=t[e],n=0,s=i.length,o;n<s;++n)(o=i[n])&&(yield o)}var MGe=[null];function Ep(t,e){this._groups=t,this._parents=e}function yF(){return new Ep([[document.documentElement]],MGe)}function FWt(){return this}Ep.prototype=yF.prototype={constructor:Ep,select:cqt,selectAll:pqt,selectChild:Aqt,selectChildren:bqt,filter:wqt,data:Mqt,enter:xqt,exit:Oqt,join:Pqt,merge:Iqt,selection:FWt,order:$qt,sort:Dqt,call:Nqt,nodes:Fqt,node:kqt,size:Uqt,empty:Bqt,each:zqt,attr:Qqt,style:Jqt,property:rWt,classed:oWt,text:uWt,html:fWt,raise:gWt,lower:yWt,append:_Wt,insert:bWt,remove:xWt,clone:EWt,datum:CWt,on:IWt,dispatch:LWt,[Symbol.iterator]:NWt};function Xse(t){return typeof t=="string"?new Ep([[document.querySelector(t)]],[document.documentElement]):new Ep([[t]],MGe)}function CP(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function _F(t,e){var r=Object.create(t.prototype);for(var i in e)r[i]=e[i];return r}function dw(){}var nE=.7,LO=1/nE,xR="\\s*([+-]?\\d+)\\s*",YL="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",MA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",kWt=/^#([0-9a-f]{3,8})$/,UWt=new RegExp(`^rgb\\(${xR},${xR},${xR}\\)$`),BWt=new RegExp(`^rgb\\(${MA},${MA},${MA}\\)$`),zWt=new RegExp(`^rgba\\(${xR},${xR},${xR},${YL}\\)$`),VWt=new RegExp(`^rgba\\(${MA},${MA},${MA},${YL}\\)$`),GWt=new RegExp(`^hsl\\(${YL},${MA},${MA}\\)$`),jWt=new RegExp(`^hsla\\(${YL},${MA},${MA},${YL}\\)$`),wSe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};CP(dw,W2,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:xSe,formatHex:xSe,formatHex8:HWt,formatHsl:qWt,formatRgb:TSe,toString:TSe});function xSe(){return this.rgb().formatHex()}function HWt(){return this.rgb().formatHex8()}function qWt(){return RGe(this).formatHsl()}function TSe(){return this.rgb().formatRgb()}function W2(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=kWt.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?SSe(e):r===3?new Kl(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?e7(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?e7(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=UWt.exec(t))?new Kl(e[1],e[2],e[3],1):(e=BWt.exec(t))?new Kl(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=zWt.exec(t))?e7(e[1],e[2],e[3],e[4]):(e=VWt.exec(t))?e7(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=GWt.exec(t))?MSe(e[1],e[2]/100,e[3]/100,1):(e=jWt.exec(t))?MSe(e[1],e[2]/100,e[3]/100,e[4]):wSe.hasOwnProperty(t)?SSe(wSe[t]):t==="transparent"?new Kl(NaN,NaN,NaN,0):null}function SSe(t){return new Kl(t>>16&255,t>>8&255,t&255,1)}function e7(t,e,r,i){return i<=0&&(t=e=r=NaN),new Kl(t,e,r,i)}function Ipe(t){return t instanceof dw||(t=W2(t)),t?(t=t.rgb(),new Kl(t.r,t.g,t.b,t.opacity)):new Kl}function Q2(t,e,r,i){return arguments.length===1?Ipe(t):new Kl(t,e,r,i??1)}function Kl(t,e,r,i){this.r=+t,this.g=+e,this.b=+r,this.opacity=+i}CP(Kl,Q2,_F(dw,{brighter(t){return t=t==null?LO:Math.pow(LO,t),new Kl(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?nE:Math.pow(nE,t),new Kl(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Kl(uS(this.r),uS(this.g),uS(this.b),TV(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ESe,formatHex:ESe,formatHex8:WWt,formatRgb:CSe,toString:CSe}));function ESe(){return`#${jT(this.r)}${jT(this.g)}${jT(this.b)}`}function WWt(){return`#${jT(this.r)}${jT(this.g)}${jT(this.b)}${jT((isNaN(this.opacity)?1:this.opacity)*255)}`}function CSe(){const t=TV(this.opacity);return`${t===1?"rgb(":"rgba("}${uS(this.r)}, ${uS(this.g)}, ${uS(this.b)}${t===1?")":`, ${t})`}`}function TV(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function uS(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function jT(t){return t=uS(t),(t<16?"0":"")+t.toString(16)}function MSe(t,e,r,i){return i<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new sm(t,e,r,i)}function RGe(t){if(t instanceof sm)return new sm(t.h,t.s,t.l,t.opacity);if(t instanceof dw||(t=W2(t)),!t)return new sm;if(t instanceof sm)return t;t=t.rgb();var e=t.r/255,r=t.g/255,i=t.b/255,n=Math.min(e,r,i),s=Math.max(e,r,i),o=NaN,a=s-n,l=(s+n)/2;return a?(e===s?o=(r-i)/a+(r<i)*6:r===s?o=(i-e)/a+2:o=(e-r)/a+4,a/=l<.5?s+n:2-s-n,o*=60):a=l>0&&l<1?0:o,new sm(o,a,l,t.opacity)}function Zse(t,e,r,i){return arguments.length===1?RGe(t):new sm(t,e,r,i??1)}function sm(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}CP(sm,Zse,_F(dw,{brighter(t){return t=t==null?LO:Math.pow(LO,t),new sm(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?nE:Math.pow(nE,t),new sm(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*e,n=2*r-i;return new Kl(mZ(t>=240?t-240:t+120,n,i),mZ(t,n,i),mZ(t<120?t+240:t-120,n,i),this.opacity)},clamp(){return new sm(RSe(this.h),t7(this.s),t7(this.l),TV(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=TV(this.opacity);return`${t===1?"hsl(":"hsla("}${RSe(this.h)}, ${t7(this.s)*100}%, ${t7(this.l)*100}%${t===1?")":`, ${t})`}`}}));function RSe(t){return t=(t||0)%360,t<0?t+360:t}function t7(t){return Math.max(0,Math.min(1,t||0))}function mZ(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}const OGe=Math.PI/180,PGe=180/Math.PI,SV=18,IGe=.96422,$Ge=1,DGe=.82521,LGe=4/29,TR=6/29,NGe=3*TR*TR,QWt=TR*TR*TR;function FGe(t){if(t instanceof RA)return new RA(t.l,t.a,t.b,t.opacity);if(t instanceof O_)return kGe(t);t instanceof Kl||(t=Ipe(t));var e=_Z(t.r),r=_Z(t.g),i=_Z(t.b),n=gZ((.2225045*e+.7168786*r+.0606169*i)/$Ge),s,o;return e===r&&r===i?s=o=n:(s=gZ((.4360747*e+.3850649*r+.1430804*i)/IGe),o=gZ((.0139322*e+.0971045*r+.7141733*i)/DGe)),new RA(116*n-16,500*(s-n),200*(n-o),t.opacity)}function Jse(t,e,r,i){return arguments.length===1?FGe(t):new RA(t,e,r,i??1)}function RA(t,e,r,i){this.l=+t,this.a=+e,this.b=+r,this.opacity=+i}CP(RA,Jse,_F(dw,{brighter(t){return new RA(this.l+SV*(t??1),this.a,this.b,this.opacity)},darker(t){return new RA(this.l-SV*(t??1),this.a,this.b,this.opacity)},rgb(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,r=isNaN(this.b)?t:t-this.b/200;return e=IGe*AZ(e),t=$Ge*AZ(t),r=DGe*AZ(r),new Kl(yZ(3.1338561*e-1.6168667*t-.4906146*r),yZ(-.9787684*e+1.9161415*t+.033454*r),yZ(.0719453*e-.2289914*t+1.4052427*r),this.opacity)}}));function gZ(t){return t>QWt?Math.pow(t,1/3):t/NGe+LGe}function AZ(t){return t>TR?t*t*t:NGe*(t-LGe)}function yZ(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function _Z(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function YWt(t){if(t instanceof O_)return new O_(t.h,t.c,t.l,t.opacity);if(t instanceof RA||(t=FGe(t)),t.a===0&&t.b===0)return new O_(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*PGe;return new O_(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function Kse(t,e,r,i){return arguments.length===1?YWt(t):new O_(t,e,r,i??1)}function O_(t,e,r,i){this.h=+t,this.c=+e,this.l=+r,this.opacity=+i}function kGe(t){if(isNaN(t.h))return new RA(t.l,0,0,t.opacity);var e=t.h*OGe;return new RA(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}CP(O_,Kse,_F(dw,{brighter(t){return new O_(this.h,this.c,this.l+SV*(t??1),this.opacity)},darker(t){return new O_(this.h,this.c,this.l-SV*(t??1),this.opacity)},rgb(){return kGe(this).rgb()}}));var UGe=-.14861,$pe=1.78277,Dpe=-.29227,LH=-.90649,XL=1.97294,OSe=XL*LH,PSe=XL*$pe,ISe=$pe*Dpe-LH*UGe;function XWt(t){if(t instanceof hS)return new hS(t.h,t.s,t.l,t.opacity);t instanceof Kl||(t=Ipe(t));var e=t.r/255,r=t.g/255,i=t.b/255,n=(ISe*i+OSe*e-PSe*r)/(ISe+OSe-PSe),s=i-n,o=(XL*(r-n)-Dpe*s)/LH,a=Math.sqrt(o*o+s*s)/(XL*n*(1-n)),l=a?Math.atan2(o,s)*PGe-120:NaN;return new hS(l<0?l+360:l,a,n,t.opacity)}function jA(t,e,r,i){return arguments.length===1?XWt(t):new hS(t,e,r,i??1)}function hS(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}CP(hS,jA,_F(dw,{brighter(t){return t=t==null?LO:Math.pow(LO,t),new hS(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?nE:Math.pow(nE,t),new hS(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*OGe,e=+this.l,r=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),n=Math.sin(t);return new Kl(255*(e+r*(UGe*i+$pe*n)),255*(e+r*(Dpe*i+LH*n)),255*(e+r*(XL*i)),this.opacity)}}));function ZWt(t,e,r,i,n){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*r+(1+3*t+3*s-3*o)*i+o*n)/6}function JWt(t){var e=t.length-1;return function(r){var i=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),n=t[i],s=t[i+1],o=i>0?t[i-1]:2*n-s,a=i<e-1?t[i+2]:2*s-n;return ZWt((r-i/e)*e,o,n,s,a)}}const NH=t=>()=>t;function BGe(t,e){return function(r){return t+r*e}}function KWt(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(i){return Math.pow(t+i*e,r)}}function Lpe(t,e){var r=e-t;return r?BGe(t,r>180||r<-180?r-360*Math.round(r/360):r):NH(isNaN(t)?e:t)}function eQt(t){return(t=+t)==1?Au:function(e,r){return r-e?KWt(e,r,t):NH(isNaN(e)?r:e)}}function Au(t,e){var r=e-t;return r?BGe(t,r):NH(isNaN(t)?e:t)}const sE=function t(e){var r=eQt(e);function i(n,s){var o=r((n=Q2(n)).r,(s=Q2(s)).r),a=r(n.g,s.g),l=r(n.b,s.b),c=Au(n.opacity,s.opacity);return function(u){return n.r=o(u),n.g=a(u),n.b=l(u),n.opacity=c(u),n+""}}return i.gamma=t,i}(1);function tQt(t){return function(e){var r=e.length,i=new Array(r),n=new Array(r),s=new Array(r),o,a;for(o=0;o<r;++o)a=Q2(e[o]),i[o]=a.r||0,n[o]=a.g||0,s[o]=a.b||0;return i=t(i),n=t(n),s=t(s),a.opacity=1,function(l){return a.r=i(l),a.g=n(l),a.b=s(l),a+""}}}var rQt=tQt(JWt);function iQt(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,i=e.slice(),n;return function(s){for(n=0;n<r;++n)i[n]=t[n]*(1-s)+e[n]*s;return i}}function nQt(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function sQt(t,e){var r=e?e.length:0,i=t?Math.min(r,t.length):0,n=new Array(i),s=new Array(r),o;for(o=0;o<i;++o)n[o]=vF(t[o],e[o]);for(;o<r;++o)s[o]=e[o];return function(a){for(o=0;o<i;++o)s[o]=n[o](a);return s}}function oQt(t,e){var r=new Date;return t=+t,e=+e,function(i){return r.setTime(t*(1-i)+e*i),r}}function uu(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function aQt(t,e){var r={},i={},n;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(n in e)n in t?r[n]=vF(t[n],e[n]):i[n]=e[n];return function(s){for(n in r)i[n]=r[n](s);return i}}var eoe=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,vZ=new RegExp(eoe.source,"g");function lQt(t){return function(){return t}}function cQt(t){return function(e){return t(e)+""}}function zGe(t,e){var r=eoe.lastIndex=vZ.lastIndex=0,i,n,s,o=-1,a=[],l=[];for(t=t+"",e=e+"";(i=eoe.exec(t))&&(n=vZ.exec(e));)(s=n.index)>r&&(s=e.slice(r,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(n=n[0])?a[o]?a[o]+=n:a[++o]=n:(a[++o]=null,l.push({i:o,x:uu(i,n)})),r=vZ.lastIndex;return r<e.length&&(s=e.slice(r),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?cQt(l[0].x):lQt(e):(e=l.length,function(c){for(var u=0,d;u<e;++u)a[(d=l[u]).i]=d.x(c);return a.join("")})}function vF(t,e){var r=typeof e,i;return e==null||r==="boolean"?NH(e):(r==="number"?uu:r==="string"?(i=W2(e))?(e=i,sE):zGe:e instanceof W2?sE:e instanceof Date?oQt:nQt(e)?iQt:Array.isArray(e)?sQt:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?aQt:uu)(t,e)}function Npe(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}var $Se=180/Math.PI,toe={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function VGe(t,e,r,i,n,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*r+e*i)&&(r-=t*l,i-=e*l),(a=Math.sqrt(r*r+i*i))&&(r/=a,i/=a,l/=a),t*i<e*r&&(t=-t,e=-e,l=-l,o=-o),{translateX:n,translateY:s,rotate:Math.atan2(e,t)*$Se,skewX:Math.atan(l)*$Se,scaleX:o,scaleY:a}}var r7;function uQt(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?toe:VGe(e.a,e.b,e.c,e.d,e.e,e.f)}function hQt(t){return t==null||(r7||(r7=document.createElementNS("http://www.w3.org/2000/svg","g")),r7.setAttribute("transform",t),!(t=r7.transform.baseVal.consolidate()))?toe:(t=t.matrix,VGe(t.a,t.b,t.c,t.d,t.e,t.f))}function GGe(t,e,r,i){function n(c){return c.length?c.pop()+" ":""}function s(c,u,d,p,A,v){if(c!==d||u!==p){var b=A.push("translate(",null,e,null,r);v.push({i:b-4,x:uu(c,d)},{i:b-2,x:uu(u,p)})}else(d||p)&&A.push("translate("+d+e+p+r)}function o(c,u,d,p){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),p.push({i:d.push(n(d)+"rotate(",null,i)-2,x:uu(c,u)})):u&&d.push(n(d)+"rotate("+u+i)}function a(c,u,d,p){c!==u?p.push({i:d.push(n(d)+"skewX(",null,i)-2,x:uu(c,u)}):u&&d.push(n(d)+"skewX("+u+i)}function l(c,u,d,p,A,v){if(c!==d||u!==p){var b=A.push(n(A)+"scale(",null,",",null,")");v.push({i:b-4,x:uu(c,d)},{i:b-2,x:uu(u,p)})}else(d!==1||p!==1)&&A.push(n(A)+"scale("+d+","+p+")")}return function(c,u){var d=[],p=[];return c=t(c),u=t(u),s(c.translateX,c.translateY,u.translateX,u.translateY,d,p),o(c.rotate,u.rotate,d,p),a(c.skewX,u.skewX,d,p),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,p),c=u=null,function(A){for(var v=-1,b=p.length,S;++v<b;)d[(S=p[v]).i]=S.x(A);return d.join("")}}}var dQt=GGe(uQt,"px, ","px)","deg)"),pQt=GGe(hQt,", ",")",")");function fQt(t){return function(e,r){var i=t((e=Zse(e)).h,(r=Zse(r)).h),n=Au(e.s,r.s),s=Au(e.l,r.l),o=Au(e.opacity,r.opacity);return function(a){return e.h=i(a),e.s=n(a),e.l=s(a),e.opacity=o(a),e+""}}}const mQt=fQt(Lpe);function gQt(t,e){var r=Au((t=Jse(t)).l,(e=Jse(e)).l),i=Au(t.a,e.a),n=Au(t.b,e.b),s=Au(t.opacity,e.opacity);return function(o){return t.l=r(o),t.a=i(o),t.b=n(o),t.opacity=s(o),t+""}}function AQt(t){return function(e,r){var i=t((e=Kse(e)).h,(r=Kse(r)).h),n=Au(e.c,r.c),s=Au(e.l,r.l),o=Au(e.opacity,r.opacity);return function(a){return e.h=i(a),e.c=n(a),e.l=s(a),e.opacity=o(a),e+""}}}const yQt=AQt(Lpe);function jGe(t){return function e(r){r=+r;function i(n,s){var o=t((n=jA(n)).h,(s=jA(s)).h),a=Au(n.s,s.s),l=Au(n.l,s.l),c=Au(n.opacity,s.opacity);return function(u){return n.h=o(u),n.s=a(u),n.l=l(Math.pow(u,r)),n.opacity=c(u),n+""}}return i.gamma=e,i}(1)}jGe(Lpe);var Fpe=jGe(Au);function kpe(t,e){e===void 0&&(e=t,t=vF);for(var r=0,i=e.length-1,n=e[0],s=new Array(i<0?0:i);r<i;)s[r]=t(n,n=e[++r]);return function(o){var a=Math.max(0,Math.min(i-1,Math.floor(o*=i)));return s[a](o-a)}}function zm(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t(i/(e-1));return r}var NO=0,Q4=0,p$=0,HGe=1e3,EV,Y4,CV=0,oE=0,FH=0,ZL=typeof performance=="object"&&performance.now?performance:Date,qGe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Upe(){return oE||(qGe(_Qt),oE=ZL.now()+FH)}function _Qt(){oE=0}function MV(){this._call=this._time=this._next=null}MV.prototype=WGe.prototype={constructor:MV,restart:function(t,e,r){if(typeof t!="function")throw new TypeError("callback is not a function");r=(r==null?Upe():+r)+(e==null?0:+e),!this._next&&Y4!==this&&(Y4?Y4._next=this:EV=this,Y4=this),this._call=t,this._time=r,roe()},stop:function(){this._call&&(this._call=null,this._time=1/0,roe())}};function WGe(t,e,r){var i=new MV;return i.restart(t,e,r),i}function vQt(){Upe(),++NO;for(var t=EV,e;t;)(e=oE-t._time)>=0&&t._call.call(void 0,e),t=t._next;--NO}function DSe(){oE=(CV=ZL.now())+FH,NO=Q4=0;try{vQt()}finally{NO=0,wQt(),oE=0}}function bQt(){var t=ZL.now(),e=t-CV;e>HGe&&(FH-=e,CV=t)}function wQt(){for(var t,e=EV,r,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(r=e._next,e._next=null,e=t?t._next=r:EV=r);Y4=t,roe(i)}function roe(t){if(!NO){Q4&&(Q4=clearTimeout(Q4));var e=t-oE;e>24?(t<1/0&&(Q4=setTimeout(DSe,t-ZL.now()-FH)),p$&&(p$=clearInterval(p$))):(p$||(CV=ZL.now(),p$=setInterval(bQt,HGe)),NO=1,qGe(DSe))}}function LSe(t,e,r){var i=new MV;return e=e==null?0:+e,i.restart(n=>{i.stop(),t(n+e)},e,r),i}var xQt=AGe("start","end","cancel","interrupt"),TQt=[],QGe=0,NSe=1,ioe=2,EU=3,FSe=4,noe=5,CU=6;function kH(t,e,r,i,n,s){var o=t.__transition;if(!o)t.__transition={};else if(r in o)return;SQt(t,r,{name:e,index:i,group:n,on:xQt,tween:TQt,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:QGe})}function Bpe(t,e){var r=Qm(t,e);if(r.state>QGe)throw new Error("too late; already scheduled");return r}function ay(t,e){var r=Qm(t,e);if(r.state>EU)throw new Error("too late; already running");return r}function Qm(t,e){var r=t.__transition;if(!r||!(r=r[e]))throw new Error("transition not found");return r}function SQt(t,e,r){var i=t.__transition,n;i[e]=r,r.timer=WGe(s,0,r.time);function s(c){r.state=NSe,r.timer.restart(o,r.delay,r.time),r.delay<=c&&o(c-r.delay)}function o(c){var u,d,p,A;if(r.state!==NSe)return l();for(u in i)if(A=i[u],A.name===r.name){if(A.state===EU)return LSe(o);A.state===FSe?(A.state=CU,A.timer.stop(),A.on.call("interrupt",t,t.__data__,A.index,A.group),delete i[u]):+u<e&&(A.state=CU,A.timer.stop(),A.on.call("cancel",t,t.__data__,A.index,A.group),delete i[u])}if(LSe(function(){r.state===EU&&(r.state=FSe,r.timer.restart(a,r.delay,r.time),a(c))}),r.state=ioe,r.on.call("start",t,t.__data__,r.index,r.group),r.state===ioe){for(r.state=EU,n=new Array(p=r.tween.length),u=0,d=-1;u<p;++u)(A=r.tween[u].value.call(t,t.__data__,r.index,r.group))&&(n[++d]=A);n.length=d+1}}function a(c){for(var u=c<r.duration?r.ease.call(null,c/r.duration):(r.timer.restart(l),r.state=noe,1),d=-1,p=n.length;++d<p;)n[d].call(t,u);r.state===noe&&(r.on.call("end",t,t.__data__,r.index,r.group),l())}function l(){r.state=CU,r.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function EQt(t,e){var r=t.__transition,i,n,s=!0,o;if(r){e=e==null?null:e+"";for(o in r){if((i=r[o]).name!==e){s=!1;continue}n=i.state>ioe&&i.state<noe,i.state=CU,i.timer.stop(),i.on.call(n?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete r[o]}s&&delete t.__transition}}function CQt(t){return this.each(function(){EQt(this,t)})}function MQt(t,e){var r,i;return function(){var n=ay(this,t),s=n.tween;if(s!==r){i=r=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}n.tween=i}}function RQt(t,e,r){var i,n;if(typeof r!="function")throw new Error;return function(){var s=ay(this,t),o=s.tween;if(o!==i){n=(i=o).slice();for(var a={name:e,value:r},l=0,c=n.length;l<c;++l)if(n[l].name===e){n[l]=a;break}l===c&&n.push(a)}s.tween=n}}function OQt(t,e){var r=this._id;if(t+="",arguments.length<2){for(var i=Qm(this.node(),r).tween,n=0,s=i.length,o;n<s;++n)if((o=i[n]).name===t)return o.value;return null}return this.each((e==null?MQt:RQt)(r,t,e))}function zpe(t,e,r){var i=t._id;return t.each(function(){var n=ay(this,i);(n.value||(n.value={}))[e]=r.apply(this,arguments)}),function(n){return Qm(n,i).value[e]}}function YGe(t,e){var r;return(typeof e=="number"?uu:e instanceof W2?sE:(r=W2(e))?(e=r,sE):zGe)(t,e)}function PQt(t){return function(){this.removeAttribute(t)}}function IQt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function $Qt(t,e,r){var i,n=r+"",s;return function(){var o=this.getAttribute(t);return o===n?null:o===i?s:s=e(i=o,r)}}function DQt(t,e,r){var i,n=r+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===n?null:o===i?s:s=e(i=o,r)}}function LQt(t,e,r){var i,n,s;return function(){var o,a=r(this),l;return a==null?void this.removeAttribute(t):(o=this.getAttribute(t),l=a+"",o===l?null:o===i&&l===n?s:(n=l,s=e(i=o,a)))}}function NQt(t,e,r){var i,n,s;return function(){var o,a=r(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),l=a+"",o===l?null:o===i&&l===n?s:(n=l,s=e(i=o,a)))}}function FQt(t,e){var r=DH(t),i=r==="transform"?pQt:YGe;return this.attrTween(t,typeof e=="function"?(r.local?NQt:LQt)(r,i,zpe(this,"attr."+t,e)):e==null?(r.local?IQt:PQt)(r):(r.local?DQt:$Qt)(r,i,e))}function kQt(t,e){return function(r){this.setAttribute(t,e.call(this,r))}}function UQt(t,e){return function(r){this.setAttributeNS(t.space,t.local,e.call(this,r))}}function BQt(t,e){var r,i;function n(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&UQt(t,s)),r}return n._value=e,n}function zQt(t,e){var r,i;function n(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&kQt(t,s)),r}return n._value=e,n}function VQt(t,e){var r="attr."+t;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;var i=DH(t);return this.tween(r,(i.local?BQt:zQt)(i,e))}function GQt(t,e){return function(){Bpe(this,t).delay=+e.apply(this,arguments)}}function jQt(t,e){return e=+e,function(){Bpe(this,t).delay=e}}function HQt(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?GQt:jQt)(e,t)):Qm(this.node(),e).delay}function qQt(t,e){return function(){ay(this,t).duration=+e.apply(this,arguments)}}function WQt(t,e){return e=+e,function(){ay(this,t).duration=e}}function QQt(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?qQt:WQt)(e,t)):Qm(this.node(),e).duration}function YQt(t,e){if(typeof e!="function")throw new Error;return function(){ay(this,t).ease=e}}function XQt(t){var e=this._id;return arguments.length?this.each(YQt(e,t)):Qm(this.node(),e).ease}function ZQt(t,e){return function(){var r=e.apply(this,arguments);if(typeof r!="function")throw new Error;ay(this,t).ease=r}}function JQt(t){if(typeof t!="function")throw new Error;return this.each(ZQt(this._id,t))}function KQt(t){typeof t!="function"&&(t=_Ge(t));for(var e=this._groups,r=e.length,i=new Array(r),n=0;n<r;++n)for(var s=e[n],o=s.length,a=i[n]=[],l,c=0;c<o;++c)(l=s[c])&&t.call(l,l.__data__,c,s)&&a.push(l);return new f1(i,this._parents,this._name,this._id)}function eYt(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,r=t._groups,i=e.length,n=r.length,s=Math.min(i,n),o=new Array(i),a=0;a<s;++a)for(var l=e[a],c=r[a],u=l.length,d=o[a]=new Array(u),p,A=0;A<u;++A)(p=l[A]||c[A])&&(d[A]=p);for(;a<i;++a)o[a]=e[a];return new f1(o,this._parents,this._name,this._id)}function tYt(t){return(t+"").trim().split(/^|\s+/).every(function(e){var r=e.indexOf(".");return r>=0&&(e=e.slice(0,r)),!e||e==="start"})}function rYt(t,e,r){var i,n,s=tYt(e)?Bpe:ay;return function(){var o=s(this,t),a=o.on;a!==i&&(n=(i=a).copy()).on(e,r),o.on=n}}function iYt(t,e){var r=this._id;return arguments.length<2?Qm(this.node(),r).on.on(t):this.each(rYt(r,t,e))}function nYt(t){return function(){var e=this.parentNode;for(var r in this.__transition)if(+r!==t)return;e&&e.removeChild(this)}}function sYt(){return this.on("end.remove",nYt(this._id))}function oYt(t){var e=this._name,r=this._id;typeof t!="function"&&(t=Ope(t));for(var i=this._groups,n=i.length,s=new Array(n),o=0;o<n;++o)for(var a=i[o],l=a.length,c=s[o]=new Array(l),u,d,p=0;p<l;++p)(u=a[p])&&(d=t.call(u,u.__data__,p,a))&&("__data__"in u&&(d.__data__=u.__data__),c[p]=d,kH(c[p],e,r,p,c,Qm(u,r)));return new f1(s,this._parents,e,r)}function aYt(t){var e=this._name,r=this._id;typeof t!="function"&&(t=yGe(t));for(var i=this._groups,n=i.length,s=[],o=[],a=0;a<n;++a)for(var l=i[a],c=l.length,u,d=0;d<c;++d)if(u=l[d]){for(var p=t.call(u,u.__data__,d,l),A,v=Qm(u,r),b=0,S=p.length;b<S;++b)(A=p[b])&&kH(A,e,r,b,p,v);s.push(p),o.push(u)}return new f1(s,o,e,r)}var lYt=yF.prototype.constructor;function cYt(){return new lYt(this._groups,this._parents)}function uYt(t,e){var r,i,n;return function(){var s=DO(this,t),o=(this.style.removeProperty(t),DO(this,t));return s===o?null:s===r&&o===i?n:n=e(r=s,i=o)}}function XGe(t){return function(){this.style.removeProperty(t)}}function hYt(t,e,r){var i,n=r+"",s;return function(){var o=DO(this,t);return o===n?null:o===i?s:s=e(i=o,r)}}function dYt(t,e,r){var i,n,s;return function(){var o=DO(this,t),a=r(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),DO(this,t))),o===l?null:o===i&&l===n?s:(n=l,s=e(i=o,a))}}function pYt(t,e){var r,i,n,s="style."+e,o="end."+s,a;return function(){var l=ay(this,t),c=l.on,u=l.value[s]==null?a||(a=XGe(e)):void 0;(c!==r||n!==u)&&(i=(r=c).copy()).on(o,n=u),l.on=i}}function fYt(t,e,r){var i=(t+="")=="transform"?dQt:YGe;return e==null?this.styleTween(t,uYt(t,i)).on("end.style."+t,XGe(t)):typeof e=="function"?this.styleTween(t,dYt(t,i,zpe(this,"style."+t,e))).each(pYt(this._id,t)):this.styleTween(t,hYt(t,i,e),r).on("end.style."+t,null)}function mYt(t,e,r){return function(i){this.style.setProperty(t,e.call(this,i),r)}}function gYt(t,e,r){var i,n;function s(){var o=e.apply(this,arguments);return o!==n&&(i=(n=o)&&mYt(t,o,r)),i}return s._value=e,s}function AYt(t,e,r){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,gYt(t,e,r??""))}function yYt(t){return function(){this.textContent=t}}function _Yt(t){return function(){var e=t(this);this.textContent=e??""}}function vYt(t){return this.tween("text",typeof t=="function"?_Yt(zpe(this,"text",t)):yYt(t==null?"":t+""))}function bYt(t){return function(e){this.textContent=t.call(this,e)}}function wYt(t){var e,r;function i(){var n=t.apply(this,arguments);return n!==r&&(e=(r=n)&&bYt(n)),e}return i._value=t,i}function xYt(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,wYt(t))}function TYt(){for(var t=this._name,e=this._id,r=ZGe(),i=this._groups,n=i.length,s=0;s<n;++s)for(var o=i[s],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var u=Qm(l,e);kH(l,t,r,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new f1(i,this._parents,t,r)}function SYt(){var t,e,r=this,i=r._id,n=r.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--n===0&&s()}};r.each(function(){var c=ay(this,i),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),n===0&&s()})}var EYt=0;function f1(t,e,r,i){this._groups=t,this._parents=e,this._name=r,this._id=i}function ZGe(){return++EYt}var $y=yF.prototype;f1.prototype={constructor:f1,select:oYt,selectAll:aYt,selectChild:$y.selectChild,selectChildren:$y.selectChildren,filter:KQt,merge:eYt,selection:cYt,transition:TYt,call:$y.call,nodes:$y.nodes,node:$y.node,size:$y.size,empty:$y.empty,each:$y.each,on:iYt,attr:FQt,attrTween:VQt,style:fYt,styleTween:AYt,text:vYt,textTween:xYt,remove:sYt,tween:OQt,delay:HQt,duration:QQt,ease:XQt,easeVarying:JQt,end:SYt,[Symbol.iterator]:$y[Symbol.iterator]};function CYt(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var MYt={time:null,delay:0,duration:250,ease:CYt};function RYt(t,e){for(var r;!(r=t.__transition)||!(r=r[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return r}function OYt(t){var e,r;t instanceof f1?(e=t._id,t=t._name):(e=ZGe(),(r=MYt).time=Upe(),t=t==null?null:t+"");for(var i=this._groups,n=i.length,s=0;s<n;++s)for(var o=i[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&kH(l,t,e,c,o,r||RYt(l,e));return new f1(i,this._parents,t,e)}yF.prototype.interrupt=CQt;yF.prototype.transition=OYt;const soe=Math.PI,ooe=2*soe,uT=1e-6,PYt=ooe-uT;function JGe(t){this._+=t[0];for(let e=1,r=t.length;e<r;++e)this._+=arguments[e]+t[e]}function IYt(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return JGe;const r=10**e;return function(i){this._+=i[0];for(let n=1,s=i.length;n<s;++n)this._+=Math.round(arguments[n]*r)/r+i[n]}}class $Yt{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?JGe:IYt(e)}moveTo(e,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,r){this._append`L${this._x1=+e},${this._y1=+r}`}quadraticCurveTo(e,r,i,n){this._append`Q${+e},${+r},${this._x1=+i},${this._y1=+n}`}bezierCurveTo(e,r,i,n,s,o){this._append`C${+e},${+r},${+i},${+n},${this._x1=+s},${this._y1=+o}`}arcTo(e,r,i,n,s){if(e=+e,r=+r,i=+i,n=+n,s=+s,s<0)throw new Error(`negative radius: ${s}`);let o=this._x1,a=this._y1,l=i-e,c=n-r,u=o-e,d=a-r,p=u*u+d*d;if(this._x1===null)this._append`M${this._x1=e},${this._y1=r}`;else if(p>uT)if(!(Math.abs(d*l-c*u)>uT)||!s)this._append`L${this._x1=e},${this._y1=r}`;else{let A=i-o,v=n-a,b=l*l+c*c,S=A*A+v*v,E=Math.sqrt(b),R=Math.sqrt(p),O=s*Math.tan((soe-Math.acos((b+p-S)/(2*E*R)))/2),I=O/R,N=O/E;Math.abs(I-1)>uT&&this._append`L${e+I*u},${r+I*d}`,this._append`A${s},${s},0,0,${+(d*A>u*v)},${this._x1=e+N*l},${this._y1=r+N*c}`}}arc(e,r,i,n,s,o){if(e=+e,r=+r,i=+i,o=!!o,i<0)throw new Error(`negative radius: ${i}`);let a=i*Math.cos(n),l=i*Math.sin(n),c=e+a,u=r+l,d=1^o,p=o?n-s:s-n;this._x1===null?this._append`M${c},${u}`:(Math.abs(this._x1-c)>uT||Math.abs(this._y1-u)>uT)&&this._append`L${c},${u}`,i&&(p<0&&(p=p%ooe+ooe),p>PYt?this._append`A${i},${i},0,1,${d},${e-a},${r-l}A${i},${i},0,1,${d},${this._x1=c},${this._y1=u}`:p>uT&&this._append`A${i},${i},0,${+(p>=soe)},${d},${this._x1=e+i*Math.cos(s)},${this._y1=r+i*Math.sin(s)}`)}rect(e,r,i,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+r}h${i=+i}v${+n}h${-i}Z`}toString(){return this._}}function aoe(t=3){return new $Yt(+t)}function DYt(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function RV(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,i=t.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+t.slice(r+1)]}function FO(t){return t=RV(Math.abs(t)),t?t[1]:NaN}function LYt(t,e){return function(r,i){for(var n=r.length,s=[],o=0,a=t[0],l=0;n>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),s.push(r.substring(n-=a,n+a)),!((l+=a+1)>i));)a=t[o=(o+1)%t.length];return s.reverse().join(e)}}function NYt(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var FYt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function JL(t){if(!(e=FYt.exec(t)))throw new Error("invalid format: "+t);var e;return new Vpe({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}JL.prototype=Vpe.prototype;function Vpe(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Vpe.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function kYt(t){e:for(var e=t.length,r=1,i=-1,n;r<e;++r)switch(t[r]){case".":i=n=r;break;case"0":i===0&&(i=r),n=r;break;default:if(!+t[r])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(n+1):t}var KGe;function UYt(t,e){var r=RV(t,e);if(!r)return t+"";var i=r[0],n=r[1],s=n-(KGe=Math.max(-8,Math.min(8,Math.floor(n/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+RV(t,Math.max(0,e+s-1))[0]}function kSe(t,e){var r=RV(t,e);if(!r)return t+"";var i=r[0],n=r[1];return n<0?"0."+new Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+new Array(n-i.length+2).join("0")}const USe={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:DYt,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>kSe(t*100,e),r:kSe,s:UYt,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function BSe(t){return t}var zSe=Array.prototype.map,VSe=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function BYt(t){var e=t.grouping===void 0||t.thousands===void 0?BSe:LYt(zSe.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",n=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?BSe:NYt(zSe.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function c(d){d=JL(d);var p=d.fill,A=d.align,v=d.sign,b=d.symbol,S=d.zero,E=d.width,R=d.comma,O=d.precision,I=d.trim,N=d.type;N==="n"?(R=!0,N="g"):USe[N]||(O===void 0&&(O=12),I=!0,N="g"),(S||p==="0"&&A==="=")&&(S=!0,p="0",A="=");var L=b==="$"?r:b==="#"&&/[boxX]/.test(N)?"0"+N.toLowerCase():"",B=b==="$"?i:/[%p]/.test(N)?o:"",U=USe[N],q=/[defgprs%]/.test(N);O=O===void 0?6:/[gprs]/.test(N)?Math.max(1,Math.min(21,O)):Math.max(0,Math.min(20,O));function Z(X){var ee=L,se=B,ue,re,te;if(N==="c")se=U(X)+se,X="";else{X=+X;var j=X<0||1/X<0;if(X=isNaN(X)?l:U(Math.abs(X),O),I&&(X=kYt(X)),j&&+X==0&&v!=="+"&&(j=!1),ee=(j?v==="("?v:a:v==="-"||v==="("?"":v)+ee,se=(N==="s"?VSe[8+KGe/3]:"")+se+(j&&v==="("?")":""),q){for(ue=-1,re=X.length;++ue<re;)if(te=X.charCodeAt(ue),48>te||te>57){se=(te===46?n+X.slice(ue+1):X.slice(ue))+se,X=X.slice(0,ue);break}}}R&&!S&&(X=e(X,1/0));var H=ee.length+X.length+se.length,W=H<E?new Array(E-H+1).join(p):"";switch(R&&S&&(X=e(W+X,W.length?E-se.length:1/0),W=""),A){case"<":X=ee+X+se+W;break;case"=":X=ee+W+X+se;break;case"^":X=W.slice(0,H=W.length>>1)+ee+X+se+W.slice(H);break;default:X=W+ee+X+se;break}return s(X)}return Z.toString=function(){return d+""},Z}function u(d,p){var A=c((d=JL(d),d.type="f",d)),v=Math.max(-8,Math.min(8,Math.floor(FO(p)/3)))*3,b=Math.pow(10,-v),S=VSe[8+v/3];return function(E){return A(b*E)+S}}return{format:c,formatPrefix:u}}var i7,MP,eje;zYt({thousands:",",grouping:[3],currency:["$",""]});function zYt(t){return i7=BYt(t),MP=i7.format,eje=i7.formatPrefix,i7}function VYt(t){return Math.max(0,-FO(Math.abs(t)))}function GYt(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(FO(e)/3)))*3-FO(Math.abs(t)))}function jYt(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,FO(e)-FO(t))+1}var Fi=1e-6,tje=1e-12,on=Math.PI,ca=on/2,GSe=on/4,Cp=on*2,rh=180/on,na=on/180,Ts=Math.abs,RP=Math.atan,m1=Math.atan2,Ki=Math.cos,rje=Math.exp,OV=Math.log,bZ=Math.pow,$i=Math.sin,Pf=Math.sign||function(t){return t>0?1:t<0?-1:0},_d=Math.sqrt,Gpe=Math.tan;function ije(t){return t>1?0:t<-1?on:Math.acos(t)}function r0(t){return t>1?ca:t<-1?-ca:Math.asin(t)}function If(){}function PV(t,e){t&&HSe.hasOwnProperty(t.type)&&HSe[t.type](t,e)}var jSe={Feature:function(t,e){PV(t.geometry,e)},FeatureCollection:function(t,e){for(var r=t.features,i=-1,n=r.length;++i<n;)PV(r[i].geometry,e)}},HSe={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var r=t.coordinates,i=-1,n=r.length;++i<n;)t=r[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){loe(t.coordinates,e,0)},MultiLineString:function(t,e){for(var r=t.coordinates,i=-1,n=r.length;++i<n;)loe(r[i],e,0)},Polygon:function(t,e){qSe(t.coordinates,e)},MultiPolygon:function(t,e){for(var r=t.coordinates,i=-1,n=r.length;++i<n;)qSe(r[i],e)},GeometryCollection:function(t,e){for(var r=t.geometries,i=-1,n=r.length;++i<n;)PV(r[i],e)}};function loe(t,e,r){var i=-1,n=t.length-r,s;for(e.lineStart();++i<n;)s=t[i],e.point(s[0],s[1],s[2]);e.lineEnd()}function qSe(t,e){var r=-1,i=t.length;for(e.polygonStart();++r<i;)loe(t[r],e,1);e.polygonEnd()}function tM(t,e){t&&jSe.hasOwnProperty(t.type)?jSe[t.type](t,e):PV(t,e)}function coe(t){return[m1(t[1],t[0]),r0(t[2])]}function kO(t){var e=t[0],r=t[1],i=Ki(r);return[i*Ki(e),i*$i(e),$i(r)]}function n7(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function IV(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function wZ(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function s7(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function uoe(t){var e=_d(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function hoe(t,e){function r(i,n){return i=t(i,n),e(i[0],i[1])}return t.invert&&e.invert&&(r.invert=function(i,n){return i=e.invert(i,n),i&&t.invert(i[0],i[1])}),r}function doe(t,e){return Ts(t)>on&&(t-=Math.round(t/Cp)*Cp),[t,e]}doe.invert=doe;function nje(t,e,r){return(t%=Cp)?e||r?hoe(QSe(t),YSe(e,r)):QSe(t):e||r?YSe(e,r):doe}function WSe(t){return function(e,r){return e+=t,Ts(e)>on&&(e-=Math.round(e/Cp)*Cp),[e,r]}}function QSe(t){var e=WSe(t);return e.invert=WSe(-t),e}function YSe(t,e){var r=Ki(t),i=$i(t),n=Ki(e),s=$i(e);function o(a,l){var c=Ki(l),u=Ki(a)*c,d=$i(a)*c,p=$i(l),A=p*r+u*i;return[m1(d*n-A*s,u*r-p*i),r0(A*n+d*s)]}return o.invert=function(a,l){var c=Ki(l),u=Ki(a)*c,d=$i(a)*c,p=$i(l),A=p*n-d*s;return[m1(d*n+p*s,u*r+A*i),r0(A*r-u*i)]},o}function HYt(t){t=nje(t[0]*na,t[1]*na,t.length>2?t[2]*na:0);function e(r){return r=t(r[0]*na,r[1]*na),r[0]*=rh,r[1]*=rh,r}return e.invert=function(r){return r=t.invert(r[0]*na,r[1]*na),r[0]*=rh,r[1]*=rh,r},e}function qYt(t,e,r,i,n,s){if(r){var o=Ki(e),a=$i(e),l=i*r;n==null?(n=e+i*Cp,s=e-l/2):(n=XSe(o,n),s=XSe(o,s),(i>0?n<s:n>s)&&(n+=i*Cp));for(var c,u=n;i>0?u>s:u<s;u-=l)c=coe([o,-a*Ki(u),-a*$i(u)]),t.point(c[0],c[1])}}function XSe(t,e){e=kO(e),e[0]-=t,uoe(e);var r=ije(-e[1]);return((-e[2]<0?-r:r)+Cp-Fi)%Cp}function sje(){var t=[],e;return{point:function(r,i,n){e.push([r,i,n])},lineStart:function(){t.push(e=[])},lineEnd:If,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var r=t;return t=[],e=null,r}}}function MU(t,e){return Ts(t[0]-e[0])<Fi&&Ts(t[1]-e[1])<Fi}function o7(t,e,r,i){this.x=t,this.z=e,this.o=r,this.e=i,this.v=!1,this.n=this.p=null}function oje(t,e,r,i,n){var s=[],o=[],a,l;if(t.forEach(function(v){if(!((b=v.length-1)<=0)){var b,S=v[0],E=v[b],R;if(MU(S,E)){if(!S[2]&&!E[2]){for(n.lineStart(),a=0;a<b;++a)n.point((S=v[a])[0],S[1]);n.lineEnd();return}E[0]+=2*Fi}s.push(R=new o7(S,v,null,!0)),o.push(R.o=new o7(S,null,R,!1)),s.push(R=new o7(E,v,null,!1)),o.push(R.o=new o7(E,null,R,!0))}}),!!s.length){for(o.sort(e),ZSe(s),ZSe(o),a=0,l=o.length;a<l;++a)o[a].e=r=!r;for(var c=s[0],u,d;;){for(var p=c,A=!0;p.v;)if((p=p.n)===c)return;u=p.z,n.lineStart();do{if(p.v=p.o.v=!0,p.e){if(A)for(a=0,l=u.length;a<l;++a)n.point((d=u[a])[0],d[1]);else i(p.x,p.n.x,1,n);p=p.n}else{if(A)for(u=p.p.z,a=u.length-1;a>=0;--a)n.point((d=u[a])[0],d[1]);else i(p.x,p.p.x,-1,n);p=p.p}p=p.o,u=p.z,A=!A}while(!p.v);n.lineEnd()}}}function ZSe(t){if(e=t.length){for(var e,r=0,i=t[0],n;++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}function xZ(t){return Ts(t[0])<=on?t[0]:Pf(t[0])*((Ts(t[0])+on)%Cp-on)}function WYt(t,e){var r=xZ(e),i=e[1],n=$i(i),s=[$i(r),-Ki(r),0],o=0,a=0,l=new rE;n===1?i=ca+Fi:n===-1&&(i=-ca-Fi);for(var c=0,u=t.length;c<u;++c)if(p=(d=t[c]).length)for(var d,p,A=d[p-1],v=xZ(A),b=A[1]/2+GSe,S=$i(b),E=Ki(b),R=0;R<p;++R,v=I,S=L,E=B,A=O){var O=d[R],I=xZ(O),N=O[1]/2+GSe,L=$i(N),B=Ki(N),U=I-v,q=U>=0?1:-1,Z=q*U,X=Z>on,ee=S*L;if(l.add(m1(ee*q*$i(Z),E*B+ee*Ki(Z))),o+=X?U+q*Cp:U,X^v>=r^I>=r){var se=IV(kO(A),kO(O));uoe(se);var ue=IV(s,se);uoe(ue);var re=(X^U>=0?-1:1)*r0(ue[2]);(i>re||i===re&&(se[0]||se[1]))&&(a+=X^U>=0?1:-1)}}return(o<-Fi||o<Fi&&l<-tje)^a&1}function aje(t,e,r,i){return function(n){var s=e(n),o=sje(),a=e(o),l=!1,c,u,d,p={point:A,lineStart:b,lineEnd:S,polygonStart:function(){p.point=E,p.lineStart=R,p.lineEnd=O,u=[],c=[]},polygonEnd:function(){p.point=A,p.lineStart=b,p.lineEnd=S,u=gGe(u);var I=WYt(c,i);u.length?(l||(n.polygonStart(),l=!0),oje(u,YYt,I,r,n)):I&&(l||(n.polygonStart(),l=!0),n.lineStart(),r(null,null,1,n),n.lineEnd()),l&&(n.polygonEnd(),l=!1),u=c=null},sphere:function(){n.polygonStart(),n.lineStart(),r(null,null,1,n),n.lineEnd(),n.polygonEnd()}};function A(I,N){t(I,N)&&n.point(I,N)}function v(I,N){s.point(I,N)}function b(){p.point=v,s.lineStart()}function S(){p.point=A,s.lineEnd()}function E(I,N){d.push([I,N]),a.point(I,N)}function R(){a.lineStart(),d=[]}function O(){E(d[0][0],d[0][1]),a.lineEnd();var I=a.clean(),N=o.result(),L,B=N.length,U,q,Z;if(d.pop(),c.push(d),d=null,!!B){if(I&1){if(q=N[0],(U=q.length-1)>0){for(l||(n.polygonStart(),l=!0),n.lineStart(),L=0;L<U;++L)n.point((Z=q[L])[0],Z[1]);n.lineEnd()}return}B>1&&I&2&&N.push(N.pop().concat(N.shift())),u.push(N.filter(QYt))}}return p}}function QYt(t){return t.length>1}function YYt(t,e){return((t=t.x)[0]<0?t[1]-ca-Fi:ca-t[1])-((e=e.x)[0]<0?e[1]-ca-Fi:ca-e[1])}const JSe=aje(function(){return!0},XYt,JYt,[-on,-ca]);function XYt(t){var e=NaN,r=NaN,i=NaN,n;return{lineStart:function(){t.lineStart(),n=1},point:function(s,o){var a=s>0?on:-on,l=Ts(s-e);Ts(l-on)<Fi?(t.point(e,r=(r+o)/2>0?ca:-ca),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),t.point(s,r),n=0):i!==a&&l>=on&&(Ts(e-i)<Fi&&(e-=i*Fi),Ts(s-a)<Fi&&(s-=a*Fi),r=ZYt(e,r,s,o),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),n=0),t.point(e=s,r=o),i=a},lineEnd:function(){t.lineEnd(),e=r=NaN},clean:function(){return 2-n}}}function ZYt(t,e,r,i){var n,s,o=$i(t-r);return Ts(o)>Fi?RP(($i(e)*(s=Ki(i))*$i(r)-$i(i)*(n=Ki(e))*$i(t))/(n*s*o)):(e+i)/2}function JYt(t,e,r,i){var n;if(t==null)n=r*ca,i.point(-on,n),i.point(0,n),i.point(on,n),i.point(on,0),i.point(on,-n),i.point(0,-n),i.point(-on,-n),i.point(-on,0),i.point(-on,n);else if(Ts(t[0]-e[0])>Fi){var s=t[0]<e[0]?on:-on;n=r*s/2,i.point(-s,n),i.point(0,n),i.point(s,n)}else i.point(e[0],e[1])}function KYt(t){var e=Ki(t),r=6*na,i=e>0,n=Ts(e)>Fi;function s(u,d,p,A){qYt(A,t,r,p,u,d)}function o(u,d){return Ki(u)*Ki(d)>e}function a(u){var d,p,A,v,b;return{lineStart:function(){v=A=!1,b=1},point:function(S,E){var R=[S,E],O,I=o(S,E),N=i?I?0:c(S,E):I?c(S+(S<0?on:-on),E):0;if(!d&&(v=A=I)&&u.lineStart(),I!==A&&(O=l(d,R),(!O||MU(d,O)||MU(R,O))&&(R[2]=1)),I!==A)b=0,I?(u.lineStart(),O=l(R,d),u.point(O[0],O[1])):(O=l(d,R),u.point(O[0],O[1],2),u.lineEnd()),d=O;else if(n&&d&&i^I){var L;!(N&p)&&(L=l(R,d,!0))&&(b=0,i?(u.lineStart(),u.point(L[0][0],L[0][1]),u.point(L[1][0],L[1][1]),u.lineEnd()):(u.point(L[1][0],L[1][1]),u.lineEnd(),u.lineStart(),u.point(L[0][0],L[0][1],3)))}I&&(!d||!MU(d,R))&&u.point(R[0],R[1]),d=R,A=I,p=N},lineEnd:function(){A&&u.lineEnd(),d=null},clean:function(){return b|(v&&A)<<1}}}function l(u,d,p){var A=kO(u),v=kO(d),b=[1,0,0],S=IV(A,v),E=n7(S,S),R=S[0],O=E-R*R;if(!O)return!p&&u;var I=e*E/O,N=-e*R/O,L=IV(b,S),B=s7(b,I),U=s7(S,N);wZ(B,U);var q=L,Z=n7(B,q),X=n7(q,q),ee=Z*Z-X*(n7(B,B)-1);if(!(ee<0)){var se=_d(ee),ue=s7(q,(-Z-se)/X);if(wZ(ue,B),ue=coe(ue),!p)return ue;var re=u[0],te=d[0],j=u[1],H=d[1],W;te<re&&(W=re,re=te,te=W);var oe=te-re,le=Ts(oe-on)<Fi,fe=le||oe<Fi;if(!le&&H<j&&(W=j,j=H,H=W),fe?le?j+H>0^ue[1]<(Ts(ue[0]-re)<Fi?j:H):j<=ue[1]&&ue[1]<=H:oe>on^(re<=ue[0]&&ue[0]<=te)){var de=s7(q,(-Z+se)/X);return wZ(de,B),[ue,coe(de)]}}}function c(u,d){var p=i?t:on-t,A=0;return u<-p?A|=1:u>p&&(A|=2),d<-p?A|=4:d>p&&(A|=8),A}return aje(o,a,s,i?[0,-t]:[-on,t-on])}function eXt(t,e,r,i,n,s){var o=t[0],a=t[1],l=e[0],c=e[1],u=0,d=1,p=l-o,A=c-a,v;if(v=r-o,!(!p&&v>0)){if(v/=p,p<0){if(v<u)return;v<d&&(d=v)}else if(p>0){if(v>d)return;v>u&&(u=v)}if(v=n-o,!(!p&&v<0)){if(v/=p,p<0){if(v>d)return;v>u&&(u=v)}else if(p>0){if(v<u)return;v<d&&(d=v)}if(v=i-a,!(!A&&v>0)){if(v/=A,A<0){if(v<u)return;v<d&&(d=v)}else if(A>0){if(v>d)return;v>u&&(u=v)}if(v=s-a,!(!A&&v<0)){if(v/=A,A<0){if(v>d)return;v>u&&(u=v)}else if(A>0){if(v<u)return;v<d&&(d=v)}return u>0&&(t[0]=o+u*p,t[1]=a+u*A),d<1&&(e[0]=o+d*p,e[1]=a+d*A),!0}}}}}var X4=1e9,a7=-X4;function lje(t,e,r,i){function n(c,u){return t<=c&&c<=r&&e<=u&&u<=i}function s(c,u,d,p){var A=0,v=0;if(c==null||(A=o(c,d))!==(v=o(u,d))||l(c,u)<0^d>0)do p.point(A===0||A===3?t:r,A>1?i:e);while((A=(A+d+4)%4)!==v);else p.point(u[0],u[1])}function o(c,u){return Ts(c[0]-t)<Fi?u>0?0:3:Ts(c[0]-r)<Fi?u>0?2:1:Ts(c[1]-e)<Fi?u>0?1:0:u>0?3:2}function a(c,u){return l(c.x,u.x)}function l(c,u){var d=o(c,1),p=o(u,1);return d!==p?d-p:d===0?u[1]-c[1]:d===1?c[0]-u[0]:d===2?c[1]-u[1]:u[0]-c[0]}return function(c){var u=c,d=sje(),p,A,v,b,S,E,R,O,I,N,L,B={point:U,lineStart:ee,lineEnd:se,polygonStart:Z,polygonEnd:X};function U(re,te){n(re,te)&&u.point(re,te)}function q(){for(var re=0,te=0,j=A.length;te<j;++te)for(var H=A[te],W=1,oe=H.length,le=H[0],fe,de,Ee=le[0],Ie=le[1];W<oe;++W)fe=Ee,de=Ie,le=H[W],Ee=le[0],Ie=le[1],de<=i?Ie>i&&(Ee-fe)*(i-de)>(Ie-de)*(t-fe)&&++re:Ie<=i&&(Ee-fe)*(i-de)<(Ie-de)*(t-fe)&&--re;return re}function Z(){u=d,p=[],A=[],L=!0}function X(){var re=q(),te=L&&re,j=(p=gGe(p)).length;(te||j)&&(c.polygonStart(),te&&(c.lineStart(),s(null,null,1,c),c.lineEnd()),j&&oje(p,a,re,s,c),c.polygonEnd()),u=c,p=A=v=null}function ee(){B.point=ue,A&&A.push(v=[]),N=!0,I=!1,R=O=NaN}function se(){p&&(ue(b,S),E&&I&&d.rejoin(),p.push(d.result())),B.point=U,I&&u.lineEnd()}function ue(re,te){var j=n(re,te);if(A&&v.push([re,te]),N)b=re,S=te,E=j,N=!1,j&&(u.lineStart(),u.point(re,te));else if(j&&I)u.point(re,te);else{var H=[R=Math.max(a7,Math.min(X4,R)),O=Math.max(a7,Math.min(X4,O))],W=[re=Math.max(a7,Math.min(X4,re)),te=Math.max(a7,Math.min(X4,te))];eXt(H,W,t,e,r,i)?(I||(u.lineStart(),u.point(H[0],H[1])),u.point(W[0],W[1]),j||u.lineEnd(),L=!1):j&&(u.lineStart(),u.point(re,te),L=!1)}R=re,O=te,I=j}return B}}const poe=t=>t;var TZ=new rE,foe=new rE,cje,uje,moe,goe,Db={point:If,lineStart:If,lineEnd:If,polygonStart:function(){Db.lineStart=tXt,Db.lineEnd=iXt},polygonEnd:function(){Db.lineStart=Db.lineEnd=Db.point=If,TZ.add(Ts(foe)),foe=new rE},result:function(){var t=TZ/2;return TZ=new rE,t}};function tXt(){Db.point=rXt}function rXt(t,e){Db.point=hje,cje=moe=t,uje=goe=e}function hje(t,e){foe.add(goe*t-moe*e),moe=t,goe=e}function iXt(){hje(cje,uje)}const KSe=Db;var UO=1/0,$V=UO,KL=-UO,DV=KL,nXt={point:sXt,lineStart:If,lineEnd:If,polygonStart:If,polygonEnd:If,result:function(){var t=[[UO,$V],[KL,DV]];return KL=DV=-($V=UO=1/0),t}};function sXt(t,e){t<UO&&(UO=t),t>KL&&(KL=t),e<$V&&($V=e),e>DV&&(DV=e)}const LV=nXt;var Aoe=0,yoe=0,Z4=0,NV=0,FV=0,FM=0,_oe=0,voe=0,J4=0,dje,pje,aA,lA,om={point:aE,lineStart:eEe,lineEnd:tEe,polygonStart:function(){om.lineStart=lXt,om.lineEnd=cXt},polygonEnd:function(){om.point=aE,om.lineStart=eEe,om.lineEnd=tEe},result:function(){var t=J4?[_oe/J4,voe/J4]:FM?[NV/FM,FV/FM]:Z4?[Aoe/Z4,yoe/Z4]:[NaN,NaN];return Aoe=yoe=Z4=NV=FV=FM=_oe=voe=J4=0,t}};function aE(t,e){Aoe+=t,yoe+=e,++Z4}function eEe(){om.point=oXt}function oXt(t,e){om.point=aXt,aE(aA=t,lA=e)}function aXt(t,e){var r=t-aA,i=e-lA,n=_d(r*r+i*i);NV+=n*(aA+t)/2,FV+=n*(lA+e)/2,FM+=n,aE(aA=t,lA=e)}function tEe(){om.point=aE}function lXt(){om.point=uXt}function cXt(){fje(dje,pje)}function uXt(t,e){om.point=fje,aE(dje=aA=t,pje=lA=e)}function fje(t,e){var r=t-aA,i=e-lA,n=_d(r*r+i*i);NV+=n*(aA+t)/2,FV+=n*(lA+e)/2,FM+=n,n=lA*t-aA*e,_oe+=n*(aA+t),voe+=n*(lA+e),J4+=n*3,aE(aA=t,lA=e)}const rEe=om;function mje(t){this._context=t}mje.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:{this._context.moveTo(t,e),this._point=1;break}case 1:{this._context.lineTo(t,e);break}default:{this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,Cp);break}}},result:If};var boe=new rE,SZ,gje,Aje,K4,e5,kV={point:If,lineStart:function(){kV.point=hXt},lineEnd:function(){SZ&&yje(gje,Aje),kV.point=If},polygonStart:function(){SZ=!0},polygonEnd:function(){SZ=null},result:function(){var t=+boe;return boe=new rE,t}};function hXt(t,e){kV.point=yje,gje=K4=t,Aje=e5=e}function yje(t,e){K4-=t,e5-=e,boe.add(_d(K4*K4+e5*e5)),K4=t,e5=e}const iEe=kV;let nEe,UV,sEe,oEe;class aEe{constructor(e){this._append=e==null?_je:dXt(e),this._radius=4.5,this._=""}pointRadius(e){return this._radius=+e,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(e,r){switch(this._point){case 0:{this._append`M${e},${r}`,this._point=1;break}case 1:{this._append`L${e},${r}`;break}default:{if(this._append`M${e},${r}`,this._radius!==sEe||this._append!==UV){const i=this._radius,n=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,sEe=i,UV=this._append,oEe=this._,this._=n}this._+=oEe;break}}}result(){const e=this._;return this._="",e.length?e:null}}function _je(t){let e=1;this._+=t[0];for(const r=t.length;e<r;++e)this._+=arguments[e]+t[e]}function dXt(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return _je;if(e!==nEe){const r=10**e;nEe=e,UV=function(n){let s=1;this._+=n[0];for(const o=n.length;s<o;++s)this._+=Math.round(arguments[s]*r)/r+n[s]}}return UV}function vje(t,e){let r=3,i=4.5,n,s;function o(a){return a&&(typeof i=="function"&&s.pointRadius(+i.apply(this,arguments)),tM(a,n(s))),s.result()}return o.area=function(a){return tM(a,n(KSe)),KSe.result()},o.measure=function(a){return tM(a,n(iEe)),iEe.result()},o.bounds=function(a){return tM(a,n(LV)),LV.result()},o.centroid=function(a){return tM(a,n(rEe)),rEe.result()},o.projection=function(a){return arguments.length?(n=a==null?(t=null,poe):(t=a).stream,o):t},o.context=function(a){return arguments.length?(s=a==null?(e=null,new aEe(r)):new mje(e=a),typeof i!="function"&&s.pointRadius(i),o):e},o.pointRadius=function(a){return arguments.length?(i=typeof a=="function"?a:(s.pointRadius(+a),+a),o):i},o.digits=function(a){if(!arguments.length)return r;if(a==null)r=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);r=l}return e===null&&(s=new aEe(r)),o},o.projection(t).digits(r).context(e)}function woe(t){return{stream:UH(t)}}function UH(t){return function(e){var r=new xoe;for(var i in t)r[i]=t[i];return r.stream=e,r}}function xoe(){}xoe.prototype={constructor:xoe,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function jpe(t,e,r){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),i!=null&&t.clipExtent(null),tM(r,t.stream(LV)),e(LV.result()),i!=null&&t.clipExtent(i),t}function Hpe(t,e,r){return jpe(t,function(i){var n=e[1][0]-e[0][0],s=e[1][1]-e[0][1],o=Math.min(n/(i[1][0]-i[0][0]),s/(i[1][1]-i[0][1])),a=+e[0][0]+(n-o*(i[1][0]+i[0][0]))/2,l=+e[0][1]+(s-o*(i[1][1]+i[0][1]))/2;t.scale(150*o).translate([a,l])},r)}function bje(t,e,r){return Hpe(t,[[0,0],e],r)}function wje(t,e,r){return jpe(t,function(i){var n=+e,s=n/(i[1][0]-i[0][0]),o=(n-s*(i[1][0]+i[0][0]))/2,a=-s*i[0][1];t.scale(150*s).translate([o,a])},r)}function xje(t,e,r){return jpe(t,function(i){var n=+e,s=n/(i[1][1]-i[0][1]),o=-s*i[0][0],a=(n-s*(i[1][1]+i[0][1]))/2;t.scale(150*s).translate([o,a])},r)}var lEe=16,pXt=Ki(30*na);function cEe(t,e){return+e?mXt(t,e):fXt(t)}function fXt(t){return UH({point:function(e,r){e=t(e,r),this.stream.point(e[0],e[1])}})}function mXt(t,e){function r(i,n,s,o,a,l,c,u,d,p,A,v,b,S){var E=c-i,R=u-n,O=E*E+R*R;if(O>4*e&&b--){var I=o+p,N=a+A,L=l+v,B=_d(I*I+N*N+L*L),U=r0(L/=B),q=Ts(Ts(L)-1)<Fi||Ts(s-d)<Fi?(s+d)/2:m1(N,I),Z=t(q,U),X=Z[0],ee=Z[1],se=X-i,ue=ee-n,re=R*se-E*ue;(re*re/O>e||Ts((E*se+R*ue)/O-.5)>.3||o*p+a*A+l*v<pXt)&&(r(i,n,s,o,a,l,X,ee,q,I/=B,N/=B,L,b,S),S.point(X,ee),r(X,ee,q,I,N,L,c,u,d,p,A,v,b,S))}}return function(i){var n,s,o,a,l,c,u,d,p,A,v,b,S={point:E,lineStart:R,lineEnd:I,polygonStart:function(){i.polygonStart(),S.lineStart=N},polygonEnd:function(){i.polygonEnd(),S.lineStart=R}};function E(U,q){U=t(U,q),i.point(U[0],U[1])}function R(){d=NaN,S.point=O,i.lineStart()}function O(U,q){var Z=kO([U,q]),X=t(U,q);r(d,p,u,A,v,b,d=X[0],p=X[1],u=U,A=Z[0],v=Z[1],b=Z[2],lEe,i),i.point(d,p)}function I(){S.point=E,i.lineEnd()}function N(){R(),S.point=L,S.lineEnd=B}function L(U,q){O(n=U,q),s=d,o=p,a=A,l=v,c=b,S.point=O}function B(){r(d,p,u,A,v,b,s,o,n,a,l,c,lEe,i),S.lineEnd=I,I()}return S}}var gXt=UH({point:function(t,e){this.stream.point(t*na,e*na)}});function AXt(t){return UH({point:function(e,r){var i=t(e,r);return this.stream.point(i[0],i[1])}})}function yXt(t,e,r,i,n){function s(o,a){return o*=i,a*=n,[e+t*o,r-t*a]}return s.invert=function(o,a){return[(o-e)/t*i,(r-a)/t*n]},s}function uEe(t,e,r,i,n,s){if(!s)return yXt(t,e,r,i,n);var o=Ki(s),a=$i(s),l=o*t,c=a*t,u=o/t,d=a/t,p=(a*r-o*e)/t,A=(a*e+o*r)/t;function v(b,S){return b*=i,S*=n,[l*b-c*S+e,r-c*b-l*S]}return v.invert=function(b,S){return[i*(u*b-d*S+p),n*(A-d*b-u*S)]},v}function pw(t){return Tje(function(){return t})()}function Tje(t){var e,r=150,i=480,n=250,s=0,o=0,a=0,l=0,c=0,u,d=0,p=1,A=1,v=null,b=JSe,S=null,E,R,O,I=poe,N=.5,L,B,U,q,Z;function X(re){return U(re[0]*na,re[1]*na)}function ee(re){return re=U.invert(re[0],re[1]),re&&[re[0]*rh,re[1]*rh]}X.stream=function(re){return q&&Z===re?q:q=gXt(AXt(u)(b(L(I(Z=re)))))},X.preclip=function(re){return arguments.length?(b=re,v=void 0,ue()):b},X.postclip=function(re){return arguments.length?(I=re,S=E=R=O=null,ue()):I},X.clipAngle=function(re){return arguments.length?(b=+re?KYt(v=re*na):(v=null,JSe),ue()):v*rh},X.clipExtent=function(re){return arguments.length?(I=re==null?(S=E=R=O=null,poe):lje(S=+re[0][0],E=+re[0][1],R=+re[1][0],O=+re[1][1]),ue()):S==null?null:[[S,E],[R,O]]},X.scale=function(re){return arguments.length?(r=+re,se()):r},X.translate=function(re){return arguments.length?(i=+re[0],n=+re[1],se()):[i,n]},X.center=function(re){return arguments.length?(s=re[0]%360*na,o=re[1]%360*na,se()):[s*rh,o*rh]},X.rotate=function(re){return arguments.length?(a=re[0]%360*na,l=re[1]%360*na,c=re.length>2?re[2]%360*na:0,se()):[a*rh,l*rh,c*rh]},X.angle=function(re){return arguments.length?(d=re%360*na,se()):d*rh},X.reflectX=function(re){return arguments.length?(p=re?-1:1,se()):p<0},X.reflectY=function(re){return arguments.length?(A=re?-1:1,se()):A<0},X.precision=function(re){return arguments.length?(L=cEe(B,N=re*re),ue()):_d(N)},X.fitExtent=function(re,te){return Hpe(X,re,te)},X.fitSize=function(re,te){return bje(X,re,te)},X.fitWidth=function(re,te){return wje(X,re,te)},X.fitHeight=function(re,te){return xje(X,re,te)};function se(){var re=uEe(r,0,0,p,A,d).apply(null,e(s,o)),te=uEe(r,i-re[0],n-re[1],p,A,d);return u=nje(a,l,c),B=hoe(e,te),U=hoe(u,B),L=cEe(B,N),ue()}function ue(){return q=Z=null,X}return function(){return e=t.apply(this,arguments),X.invert=e.invert&&ee,se()}}function qpe(t){var e=0,r=on/3,i=Tje(t),n=i(e,r);return n.parallels=function(s){return arguments.length?i(e=s[0]*na,r=s[1]*na):[e*rh,r*rh]},n}function _Xt(t){var e=Ki(t);function r(i,n){return[i*e,$i(n)/e]}return r.invert=function(i,n){return[i/e,r0(n*e)]},r}function vXt(t,e){var r=$i(t),i=(r+$i(e))/2;if(Ts(i)<Fi)return _Xt(t);var n=1+r*(2*i-r),s=_d(n)/i;function o(a,l){var c=_d(n-2*i*$i(l))/i;return[c*$i(a*=i),s-c*Ki(a)]}return o.invert=function(a,l){var c=s-l,u=m1(a,Ts(c))*Pf(c);return c*i<0&&(u-=on*Pf(a)*Pf(c)),[u/i,r0((n-(a*a+c*c)*i*i)/(2*i))]},o}function BV(){return qpe(vXt).scale(155.424).center([0,33.6442])}function Sje(){return BV().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function bXt(t){var e=t.length;return{point:function(r,i){for(var n=-1;++n<e;)t[n].point(r,i)},sphere:function(){for(var r=-1;++r<e;)t[r].sphere()},lineStart:function(){for(var r=-1;++r<e;)t[r].lineStart()},lineEnd:function(){for(var r=-1;++r<e;)t[r].lineEnd()},polygonStart:function(){for(var r=-1;++r<e;)t[r].polygonStart()},polygonEnd:function(){for(var r=-1;++r<e;)t[r].polygonEnd()}}}function wXt(){var t,e,r=Sje(),i,n=BV().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s,o=BV().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,l,c={point:function(p,A){l=[p,A]}};function u(p){var A=p[0],v=p[1];return l=null,i.point(A,v),l||(s.point(A,v),l)||(a.point(A,v),l)}u.invert=function(p){var A=r.scale(),v=r.translate(),b=(p[0]-v[0])/A,S=(p[1]-v[1])/A;return(S>=.12&&S<.234&&b>=-.425&&b<-.214?n:S>=.166&&S<.234&&b>=-.214&&b<-.115?o:r).invert(p)},u.stream=function(p){return t&&e===p?t:t=bXt([r.stream(e=p),n.stream(p),o.stream(p)])},u.precision=function(p){return arguments.length?(r.precision(p),n.precision(p),o.precision(p),d()):r.precision()},u.scale=function(p){return arguments.length?(r.scale(p),n.scale(p*.35),o.scale(p),u.translate(r.translate())):r.scale()},u.translate=function(p){if(!arguments.length)return r.translate();var A=r.scale(),v=+p[0],b=+p[1];return i=r.translate(p).clipExtent([[v-.455*A,b-.238*A],[v+.455*A,b+.238*A]]).stream(c),s=n.translate([v-.307*A,b+.201*A]).clipExtent([[v-.425*A+Fi,b+.12*A+Fi],[v-.214*A-Fi,b+.234*A-Fi]]).stream(c),a=o.translate([v-.205*A,b+.212*A]).clipExtent([[v-.214*A+Fi,b+.166*A+Fi],[v-.115*A-Fi,b+.234*A-Fi]]).stream(c),d()},u.fitExtent=function(p,A){return Hpe(u,p,A)},u.fitSize=function(p,A){return bje(u,p,A)},u.fitWidth=function(p,A){return wje(u,p,A)},u.fitHeight=function(p,A){return xje(u,p,A)};function d(){return t=e=null,u}return u.scale(1070)}function Eje(t){return function(e,r){var i=Ki(e),n=Ki(r),s=t(i*n);return s===1/0?[2,0]:[s*n*$i(e),s*$i(r)]}}function bF(t){return function(e,r){var i=_d(e*e+r*r),n=t(i),s=$i(n),o=Ki(n);return[m1(e*s,i*o),r0(i&&r*s/i)]}}var Cje=Eje(function(t){return _d(2/(1+t))});Cje.invert=bF(function(t){return 2*r0(t/2)});function xXt(){return pw(Cje).scale(124.75).clipAngle(180-.001)}var Mje=Eje(function(t){return(t=ije(t))&&t/$i(t)});Mje.invert=bF(function(t){return t});function TXt(){return pw(Mje).scale(79.4188).clipAngle(180-.001)}function BH(t,e){return[t,OV(Gpe((ca+e)/2))]}BH.invert=function(t,e){return[t,2*RP(rje(e))-ca]};function SXt(){return Rje(BH).scale(961/Cp)}function Rje(t){var e=pw(t),r=e.center,i=e.scale,n=e.translate,s=e.clipExtent,o=null,a,l,c;e.scale=function(d){return arguments.length?(i(d),u()):i()},e.translate=function(d){return arguments.length?(n(d),u()):n()},e.center=function(d){return arguments.length?(r(d),u()):r()},e.clipExtent=function(d){return arguments.length?(d==null?o=a=l=c=null:(o=+d[0][0],a=+d[0][1],l=+d[1][0],c=+d[1][1]),u()):o==null?null:[[o,a],[l,c]]};function u(){var d=on*i(),p=e(HYt(e.rotate()).invert([0,0]));return s(o==null?[[p[0]-d,p[1]-d],[p[0]+d,p[1]+d]]:t===BH?[[Math.max(p[0]-d,o),a],[Math.min(p[0]+d,l),c]]:[[o,Math.max(p[1]-d,a)],[l,Math.min(p[1]+d,c)]])}return u()}function l7(t){return Gpe((ca+t)/2)}function EXt(t,e){var r=Ki(t),i=t===e?$i(t):OV(r/Ki(e))/OV(l7(e)/l7(t)),n=r*bZ(l7(t),i)/i;if(!i)return BH;function s(o,a){n>0?a<-ca+Fi&&(a=-ca+Fi):a>ca-Fi&&(a=ca-Fi);var l=n/bZ(l7(a),i);return[l*$i(i*o),n-l*Ki(i*o)]}return s.invert=function(o,a){var l=n-a,c=Pf(i)*_d(o*o+l*l),u=m1(o,Ts(l))*Pf(l);return l*i<0&&(u-=on*Pf(o)*Pf(l)),[u/i,2*RP(bZ(n/c,1/i))-ca]},s}function CXt(){return qpe(EXt).scale(109.5).parallels([30,30])}function zV(t,e){return[t,e]}zV.invert=zV;function MXt(){return pw(zV).scale(152.63)}function RXt(t,e){var r=Ki(t),i=t===e?$i(t):(r-Ki(e))/(e-t),n=r/i+t;if(Ts(i)<Fi)return zV;function s(o,a){var l=n-a,c=i*o;return[l*$i(c),n-l*Ki(c)]}return s.invert=function(o,a){var l=n-a,c=m1(o,Ts(l))*Pf(l);return l*i<0&&(c-=on*Pf(o)*Pf(l)),[c/i,n-Pf(i)*_d(o*o+l*l)]},s}function OXt(){return qpe(RXt).scale(131.154).center([0,13.9389])}var lD=1.340264,cD=-.081106,uD=893e-6,hD=.003796,VV=_d(3)/2,PXt=12;function Oje(t,e){var r=r0(VV*$i(e)),i=r*r,n=i*i*i;return[t*Ki(r)/(VV*(lD+3*cD*i+n*(7*uD+9*hD*i))),r*(lD+cD*i+n*(uD+hD*i))]}Oje.invert=function(t,e){for(var r=e,i=r*r,n=i*i*i,s=0,o,a,l;s<PXt&&(a=r*(lD+cD*i+n*(uD+hD*i))-e,l=lD+3*cD*i+n*(7*uD+9*hD*i),r-=o=a/l,i=r*r,n=i*i*i,!(Ts(o)<tje));++s);return[VV*t*(lD+3*cD*i+n*(7*uD+9*hD*i))/Ki(r),r0($i(r)/VV)]};function IXt(){return pw(Oje).scale(177.158)}function Pje(t,e){var r=Ki(e),i=Ki(t)*r;return[r*$i(t)/i,$i(e)/i]}Pje.invert=bF(RP);function $Xt(){return pw(Pje).scale(144.049).clipAngle(60)}function Ije(t,e){return[Ki(e)*$i(t),$i(e)]}Ije.invert=bF(r0);function DXt(){return pw(Ije).scale(249.5).clipAngle(90+Fi)}function $je(t,e){var r=Ki(e),i=1+Ki(t)*r;return[r*$i(t)/i,$i(e)/i]}$je.invert=bF(function(t){return 2*RP(t)});function LXt(){return pw($je).scale(250).clipAngle(142)}function Dje(t,e){return[OV(Gpe((ca+e)/2)),-t]}Dje.invert=function(t,e){return[-e,2*RP(rje(t))-ca]};function NXt(){var t=Rje(Dje),e=t.center,r=t.rotate;return t.center=function(i){return arguments.length?e([-i[1],i[0]]):(i=e(),[i[1],-i[0]])},t.rotate=function(i){return arguments.length?r([i[0],i[1],i.length>2?i[2]+90:90]):(i=r(),[i[0],i[1],i[2]-90])},r([0,0,90]).scale(159.155)}function ly(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function zH(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const Toe=Symbol("implicit");function Wpe(){var t=new q2,e=[],r=[],i=Toe;function n(s){let o=t.get(s);if(o===void 0){if(i!==Toe)return i;t.set(s,o=e.push(s)-1)}return r[o%r.length]}return n.domain=function(s){if(!arguments.length)return e.slice();e=[],t=new q2;for(const o of s)t.has(o)||t.set(o,e.push(o)-1);return n},n.range=function(s){return arguments.length?(r=Array.from(s),n):r.slice()},n.unknown=function(s){return arguments.length?(i=s,n):i},n.copy=function(){return Wpe(e,r).unknown(i)},ly.apply(n,arguments),n}function VH(){var t=Wpe().unknown(void 0),e=t.domain,r=t.range,i=0,n=1,s,o,a=!1,l=0,c=0,u=.5;delete t.unknown;function d(){var p=e().length,A=n<i,v=A?n:i,b=A?i:n;s=(b-v)/Math.max(1,p-l+c*2),a&&(s=Math.floor(s)),v+=(b-v-s*(p-l))*u,o=s*(1-l),a&&(v=Math.round(v),o=Math.round(o));var S=Wse(p).map(function(E){return v+s*E});return r(A?S.reverse():S)}return t.domain=function(p){return arguments.length?(e(p),d()):e()},t.range=function(p){return arguments.length?([i,n]=p,i=+i,n=+n,d()):[i,n]},t.rangeRound=function(p){return[i,n]=p,i=+i,n=+n,a=!0,d()},t.bandwidth=function(){return o},t.step=function(){return s},t.round=function(p){return arguments.length?(a=!!p,d()):a},t.padding=function(p){return arguments.length?(l=Math.min(1,c=+p),d()):l},t.paddingInner=function(p){return arguments.length?(l=Math.min(1,p),d()):l},t.paddingOuter=function(p){return arguments.length?(c=+p,d()):c},t.align=function(p){return arguments.length?(u=Math.max(0,Math.min(1,p)),d()):u},t.copy=function(){return VH(e(),[i,n]).round(a).paddingInner(l).paddingOuter(c).align(u)},ly.apply(d(),arguments)}function Lje(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return Lje(e())},t}function FXt(){return Lje(VH.apply(null,arguments).paddingInner(1))}function kXt(t){return function(){return t}}function Soe(t){return+t}var hEe=[0,1];function $f(t){return t}function Eoe(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:kXt(isNaN(e)?NaN:.5)}function UXt(t,e){var r;return t>e&&(r=t,t=e,e=r),function(i){return Math.max(t,Math.min(e,i))}}function BXt(t,e,r){var i=t[0],n=t[1],s=e[0],o=e[1];return n<i?(i=Eoe(n,i),s=r(o,s)):(i=Eoe(i,n),s=r(s,o)),function(a){return s(i(a))}}function zXt(t,e,r){var i=Math.min(t.length,e.length)-1,n=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)n[o]=Eoe(t[o],t[o+1]),s[o]=r(e[o],e[o+1]);return function(a){var l=Epe(t,a,1,i)-1;return s[l](n[l](a))}}function wF(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function GH(){var t=hEe,e=hEe,r=vF,i,n,s,o=$f,a,l,c;function u(){var p=Math.min(t.length,e.length);return o!==$f&&(o=UXt(t[0],t[p-1])),a=p>2?zXt:BXt,l=c=null,d}function d(p){return p==null||isNaN(p=+p)?s:(l||(l=a(t.map(i),e,r)))(i(o(p)))}return d.invert=function(p){return o(n((c||(c=a(e,t.map(i),uu)))(p)))},d.domain=function(p){return arguments.length?(t=Array.from(p,Soe),u()):t.slice()},d.range=function(p){return arguments.length?(e=Array.from(p),u()):e.slice()},d.rangeRound=function(p){return e=Array.from(p),r=Npe,u()},d.clamp=function(p){return arguments.length?(o=p?!0:$f,u()):o!==$f},d.interpolate=function(p){return arguments.length?(r=p,u()):r},d.unknown=function(p){return arguments.length?(s=p,d):s},function(p,A){return i=p,n=A,u()}}function Nje(){return GH()($f,$f)}function VXt(t,e,r,i){var n=Hse(t,e,r),s;switch(i=JL(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(s=GYt(n,o))&&(i.precision=s),eje(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=jYt(n,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=VYt(n))&&(i.precision=s-(i.type==="%")*2);break}}return MP(i)}function xF(t){var e=t.domain;return t.ticks=function(r){var i=e();return vV(i[0],i[i.length-1],r??10)},t.tickFormat=function(r,i){var n=e();return VXt(n[0],n[n.length-1],r??10,i)},t.nice=function(r){r==null&&(r=10);var i=e(),n=0,s=i.length-1,o=i[n],a=i[s],l,c,u=10;for(a<o&&(c=o,o=a,a=c,c=n,n=s,s=c);u-- >0;){if(c=jse(o,a,r),c===l)return i[n]=o,i[s]=a,e(i);if(c>0)o=Math.floor(o/c)*c,a=Math.ceil(a/c)*c;else if(c<0)o=Math.ceil(o*c)/c,a=Math.floor(a*c)/c;else break;l=c}return t},t}function Qpe(){var t=Nje();return t.copy=function(){return wF(t,Qpe())},ly.apply(t,arguments),xF(t)}function Fje(t){var e;function r(i){return i==null||isNaN(i=+i)?e:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(t=Array.from(i,Soe),r):t.slice()},r.unknown=function(i){return arguments.length?(e=i,r):e},r.copy=function(){return Fje(t).unknown(e)},t=arguments.length?Array.from(t,Soe):[0,1],xF(r)}function kje(t,e){t=t.slice();var r=0,i=t.length-1,n=t[r],s=t[i],o;return s<n&&(o=r,r=i,i=o,o=n,n=s,s=o),t[r]=e.floor(n),t[i]=e.ceil(s),t}function dEe(t){return Math.log(t)}function pEe(t){return Math.exp(t)}function GXt(t){return-Math.log(-t)}function jXt(t){return-Math.exp(-t)}function HXt(t){return isFinite(t)?+("1e"+t):t<0?0:t}function qXt(t){return t===10?HXt:t===Math.E?Math.exp:e=>Math.pow(t,e)}function WXt(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function fEe(t){return(e,r)=>-t(-e,r)}function Uje(t){const e=t(dEe,pEe),r=e.domain;let i=10,n,s;function o(){return n=WXt(i),s=qXt(i),r()[0]<0?(n=fEe(n),s=fEe(s),t(GXt,jXt)):t(dEe,pEe),e}return e.base=function(a){return arguments.length?(i=+a,o()):i},e.domain=function(a){return arguments.length?(r(a),o()):r()},e.ticks=a=>{const l=r();let c=l[0],u=l[l.length-1];const d=u<c;d&&([c,u]=[u,c]);let p=n(c),A=n(u),v,b;const S=a==null?10:+a;let E=[];if(!(i%1)&&A-p<S){if(p=Math.floor(p),A=Math.ceil(A),c>0){for(;p<=A;++p)for(v=1;v<i;++v)if(b=p<0?v/s(-p):v*s(p),!(b<c)){if(b>u)break;E.push(b)}}else for(;p<=A;++p)for(v=i-1;v>=1;--v)if(b=p>0?v/s(-p):v*s(p),!(b<c)){if(b>u)break;E.push(b)}E.length*2<S&&(E=vV(c,u,S))}else E=vV(p,A,Math.min(A-p,S)).map(s);return d?E.reverse():E},e.tickFormat=(a,l)=>{if(a==null&&(a=10),l==null&&(l=i===10?"s":","),typeof l!="function"&&(!(i%1)&&(l=JL(l)).precision==null&&(l.trim=!0),l=MP(l)),a===1/0)return l;const c=Math.max(1,i*a/e.ticks().length);return u=>{let d=u/s(Math.round(n(u)));return d*i<i-.5&&(d*=i),d<=c?l(u):""}},e.nice=()=>r(kje(r(),{floor:a=>s(Math.floor(n(a))),ceil:a=>s(Math.ceil(n(a)))})),e}function Bje(){const t=Uje(GH()).domain([1,10]);return t.copy=()=>wF(t,Bje()).base(t.base()),ly.apply(t,arguments),t}function mEe(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function gEe(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function zje(t){var e=1,r=t(mEe(e),gEe(e));return r.constant=function(i){return arguments.length?t(mEe(e=+i),gEe(e)):e},xF(r)}function Vje(){var t=zje(GH());return t.copy=function(){return wF(t,Vje()).constant(t.constant())},ly.apply(t,arguments)}function AEe(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function QXt(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function YXt(t){return t<0?-t*t:t*t}function Gje(t){var e=t($f,$f),r=1;function i(){return r===1?t($f,$f):r===.5?t(QXt,YXt):t(AEe(r),AEe(1/r))}return e.exponent=function(n){return arguments.length?(r=+n,i()):r},xF(e)}function jje(){var t=Gje(GH());return t.copy=function(){return wF(t,jje()).exponent(t.exponent())},ly.apply(t,arguments),t}function Hje(){var t=[],e=[],r=[],i;function n(){var o=0,a=Math.max(1,e.length);for(r=new Array(a-1);++o<a;)r[o-1]=HHt(t,o/a);return s}function s(o){return o==null||isNaN(o=+o)?i:e[Epe(r,o)]}return s.invertExtent=function(o){var a=e.indexOf(o);return a<0?[NaN,NaN]:[a>0?r[a-1]:t[0],a<r.length?r[a]:t[t.length-1]]},s.domain=function(o){if(!arguments.length)return t.slice();t=[];for(let a of o)a!=null&&!isNaN(a=+a)&&t.push(a);return t.sort(md),n()},s.range=function(o){return arguments.length?(e=Array.from(o),n()):e.slice()},s.unknown=function(o){return arguments.length?(i=o,s):i},s.quantiles=function(){return r.slice()},s.copy=function(){return Hje().domain(t).range(e).unknown(i)},ly.apply(s,arguments)}function qje(){var t=[.5],e=[0,1],r,i=1;function n(s){return s!=null&&s<=s?e[Epe(t,s,0,i)]:r}return n.domain=function(s){return arguments.length?(t=Array.from(s),i=Math.min(t.length,e.length-1),n):t.slice()},n.range=function(s){return arguments.length?(e=Array.from(s),i=Math.min(t.length,e.length-1),n):e.slice()},n.invertExtent=function(s){var o=e.indexOf(s);return[t[o-1],t[o]]},n.unknown=function(s){return arguments.length?(r=s,n):r},n.copy=function(){return qje().domain(t).range(e).unknown(r)},ly.apply(n,arguments)}const EZ=new Date,CZ=new Date;function $l(t,e,r,i){function n(s){return t(s=arguments.length===0?new Date:new Date(+s)),s}return n.floor=s=>(t(s=new Date(+s)),s),n.ceil=s=>(t(s=new Date(s-1)),e(s,1),t(s),s),n.round=s=>{const o=n(s),a=n.ceil(s);return s-o<a-s?o:a},n.offset=(s,o)=>(e(s=new Date(+s),o==null?1:Math.floor(o)),s),n.range=(s,o,a)=>{const l=[];if(s=n.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return l;let c;do l.push(c=new Date(+s)),e(s,a),t(s);while(c<s&&s<o);return l},n.filter=s=>$l(o=>{if(o>=o)for(;t(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;e(o,-1),!s(o););else for(;--a>=0;)for(;e(o,1),!s(o););}),r&&(n.count=(s,o)=>(EZ.setTime(+s),CZ.setTime(+o),t(EZ),t(CZ),Math.floor(r(EZ,CZ))),n.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?n.filter(i?o=>i(o)%s===0:o=>n.count(0,o)%s===0):n)),n}const GV=$l(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);GV.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?$l(e=>{e.setTime(Math.floor(e/t)*t)},(e,r)=>{e.setTime(+e+r*t)},(e,r)=>(r-e)/t):GV);GV.range;const P_=1e3,Df=P_*60,I_=Df*60,g1=I_*24,Ype=g1*7,yEe=g1*30,MZ=g1*365,$_=$l(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*P_)},(t,e)=>(e-t)/P_,t=>t.getUTCSeconds());$_.range;const jH=$l(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*P_)},(t,e)=>{t.setTime(+t+e*Df)},(t,e)=>(e-t)/Df,t=>t.getMinutes());jH.range;const HH=$l(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*Df)},(t,e)=>(e-t)/Df,t=>t.getUTCMinutes());HH.range;const qH=$l(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*P_-t.getMinutes()*Df)},(t,e)=>{t.setTime(+t+e*I_)},(t,e)=>(e-t)/I_,t=>t.getHours());qH.range;const WH=$l(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*I_)},(t,e)=>(e-t)/I_,t=>t.getUTCHours());WH.range;const OP=$l(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Df)/g1,t=>t.getDate()-1);OP.range;const TF=$l(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/g1,t=>t.getUTCDate()-1);TF.range;const Wje=$l(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/g1,t=>Math.floor(t/g1));Wje.range;function OE(t){return $l(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,r)=>{e.setDate(e.getDate()+r*7)},(e,r)=>(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*Df)/Ype)}const BO=OE(0),eN=OE(1),Qje=OE(2),Yje=OE(3),lE=OE(4),Xje=OE(5),Zje=OE(6);BO.range;eN.range;Qje.range;Yje.range;lE.range;Xje.range;Zje.range;function PE(t){return $l(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,r)=>{e.setUTCDate(e.getUTCDate()+r*7)},(e,r)=>(r-e)/Ype)}const zO=PE(0),tN=PE(1),Jje=PE(2),Kje=PE(3),cE=PE(4),eHe=PE(5),tHe=PE(6);zO.range;tN.range;Jje.range;Kje.range;cE.range;eHe.range;tHe.range;const SR=$l(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());SR.range;const ER=$l(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());ER.range;const HA=$l(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());HA.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:$l(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,r)=>{e.setFullYear(e.getFullYear()+r*t)});HA.range;const qA=$l(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());qA.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:$l(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,r)=>{e.setUTCFullYear(e.getUTCFullYear()+r*t)});qA.range;function rHe(t,e,r,i,n,s){const o=[[$_,1,P_],[$_,5,5*P_],[$_,15,15*P_],[$_,30,30*P_],[s,1,Df],[s,5,5*Df],[s,15,15*Df],[s,30,30*Df],[n,1,I_],[n,3,3*I_],[n,6,6*I_],[n,12,12*I_],[i,1,g1],[i,2,2*g1],[r,1,Ype],[e,1,yEe],[e,3,3*yEe],[t,1,MZ]];function a(c,u,d){const p=u<c;p&&([c,u]=[u,c]);const A=d&&typeof d.range=="function"?d:l(c,u,d),v=A?A.range(c,+u+1):[];return p?v.reverse():v}function l(c,u,d){const p=Math.abs(u-c)/d,A=Spe(([,,S])=>S).right(o,p);if(A===o.length)return t.every(Hse(c/MZ,u/MZ,d));if(A===0)return GV.every(Math.max(Hse(c,u,d),1));const[v,b]=o[p/o[A-1][2]<o[A][2]/p?A-1:A];return v.every(b)}return[a,l]}const[XXt,ZXt]=rHe(qA,ER,zO,Wje,WH,HH),[JXt,KXt]=rHe(HA,SR,BO,OP,qH,jH);function RZ(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function OZ(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function f$(t,e,r){return{y:t,m:e,d:r,H:0,M:0,S:0,L:0}}function eZt(t){var e=t.dateTime,r=t.date,i=t.time,n=t.periods,s=t.days,o=t.shortDays,a=t.months,l=t.shortMonths,c=m$(n),u=g$(n),d=m$(s),p=g$(s),A=m$(o),v=g$(o),b=m$(a),S=g$(a),E=m$(l),R=g$(l),O={a:j,A:H,b:W,B:oe,c:null,d:TEe,e:TEe,f:xZt,g:$Zt,G:LZt,H:vZt,I:bZt,j:wZt,L:iHe,m:TZt,M:SZt,p:le,q:fe,Q:CEe,s:MEe,S:EZt,u:CZt,U:MZt,V:RZt,w:OZt,W:PZt,x:null,X:null,y:IZt,Y:DZt,Z:NZt,"%":EEe},I={a:de,A:Ee,b:Ie,B:Ge,c:null,d:SEe,e:SEe,f:BZt,g:XZt,G:JZt,H:FZt,I:kZt,j:UZt,L:sHe,m:zZt,M:VZt,p:Ke,q:vt,Q:CEe,s:MEe,S:GZt,u:jZt,U:HZt,V:qZt,w:WZt,W:QZt,x:null,X:null,y:YZt,Y:ZZt,Z:KZt,"%":EEe},N={a:Z,A:X,b:ee,B:se,c:ue,d:wEe,e:wEe,f:gZt,g:bEe,G:vEe,H:xEe,I:xEe,j:dZt,L:mZt,m:hZt,M:pZt,p:q,q:uZt,Q:yZt,s:_Zt,S:fZt,u:sZt,U:oZt,V:aZt,w:nZt,W:lZt,x:re,X:te,y:bEe,Y:vEe,Z:cZt,"%":AZt};O.x=L(r,O),O.X=L(i,O),O.c=L(e,O),I.x=L(r,I),I.X=L(i,I),I.c=L(e,I);function L(ke,Ne){return function(Xe){var Se=[],It=-1,lt=0,qt=ke.length,er,rr,vr;for(Xe instanceof Date||(Xe=new Date(+Xe));++It<qt;)ke.charCodeAt(It)===37&&(Se.push(ke.slice(lt,It)),(rr=_Ee[er=ke.charAt(++It)])!=null?er=ke.charAt(++It):rr=er==="e"?" ":"0",(vr=Ne[er])&&(er=vr(Xe,rr)),Se.push(er),lt=It+1);return Se.push(ke.slice(lt,It)),Se.join("")}}function B(ke,Ne){return function(Xe){var Se=f$(1900,void 0,1),It=U(Se,ke,Xe+="",0),lt,qt;if(It!=Xe.length)return null;if("Q"in Se)return new Date(Se.Q);if("s"in Se)return new Date(Se.s*1e3+("L"in Se?Se.L:0));if(Ne&&!("Z"in Se)&&(Se.Z=0),"p"in Se&&(Se.H=Se.H%12+Se.p*12),Se.m===void 0&&(Se.m="q"in Se?Se.q:0),"V"in Se){if(Se.V<1||Se.V>53)return null;"w"in Se||(Se.w=1),"Z"in Se?(lt=OZ(f$(Se.y,0,1)),qt=lt.getUTCDay(),lt=qt>4||qt===0?tN.ceil(lt):tN(lt),lt=TF.offset(lt,(Se.V-1)*7),Se.y=lt.getUTCFullYear(),Se.m=lt.getUTCMonth(),Se.d=lt.getUTCDate()+(Se.w+6)%7):(lt=RZ(f$(Se.y,0,1)),qt=lt.getDay(),lt=qt>4||qt===0?eN.ceil(lt):eN(lt),lt=OP.offset(lt,(Se.V-1)*7),Se.y=lt.getFullYear(),Se.m=lt.getMonth(),Se.d=lt.getDate()+(Se.w+6)%7)}else("W"in Se||"U"in Se)&&("w"in Se||(Se.w="u"in Se?Se.u%7:"W"in Se?1:0),qt="Z"in Se?OZ(f$(Se.y,0,1)).getUTCDay():RZ(f$(Se.y,0,1)).getDay(),Se.m=0,Se.d="W"in Se?(Se.w+6)%7+Se.W*7-(qt+5)%7:Se.w+Se.U*7-(qt+6)%7);return"Z"in Se?(Se.H+=Se.Z/100|0,Se.M+=Se.Z%100,OZ(Se)):RZ(Se)}}function U(ke,Ne,Xe,Se){for(var It=0,lt=Ne.length,qt=Xe.length,er,rr;It<lt;){if(Se>=qt)return-1;if(er=Ne.charCodeAt(It++),er===37){if(er=Ne.charAt(It++),rr=N[er in _Ee?Ne.charAt(It++):er],!rr||(Se=rr(ke,Xe,Se))<0)return-1}else if(er!=Xe.charCodeAt(Se++))return-1}return Se}function q(ke,Ne,Xe){var Se=c.exec(Ne.slice(Xe));return Se?(ke.p=u.get(Se[0].toLowerCase()),Xe+Se[0].length):-1}function Z(ke,Ne,Xe){var Se=A.exec(Ne.slice(Xe));return Se?(ke.w=v.get(Se[0].toLowerCase()),Xe+Se[0].length):-1}function X(ke,Ne,Xe){var Se=d.exec(Ne.slice(Xe));return Se?(ke.w=p.get(Se[0].toLowerCase()),Xe+Se[0].length):-1}function ee(ke,Ne,Xe){var Se=E.exec(Ne.slice(Xe));return Se?(ke.m=R.get(Se[0].toLowerCase()),Xe+Se[0].length):-1}function se(ke,Ne,Xe){var Se=b.exec(Ne.slice(Xe));return Se?(ke.m=S.get(Se[0].toLowerCase()),Xe+Se[0].length):-1}function ue(ke,Ne,Xe){return U(ke,e,Ne,Xe)}function re(ke,Ne,Xe){return U(ke,r,Ne,Xe)}function te(ke,Ne,Xe){return U(ke,i,Ne,Xe)}function j(ke){return o[ke.getDay()]}function H(ke){return s[ke.getDay()]}function W(ke){return l[ke.getMonth()]}function oe(ke){return a[ke.getMonth()]}function le(ke){return n[+(ke.getHours()>=12)]}function fe(ke){return 1+~~(ke.getMonth()/3)}function de(ke){return o[ke.getUTCDay()]}function Ee(ke){return s[ke.getUTCDay()]}function Ie(ke){return l[ke.getUTCMonth()]}function Ge(ke){return a[ke.getUTCMonth()]}function Ke(ke){return n[+(ke.getUTCHours()>=12)]}function vt(ke){return 1+~~(ke.getUTCMonth()/3)}return{format:function(ke){var Ne=L(ke+="",O);return Ne.toString=function(){return ke},Ne},parse:function(ke){var Ne=B(ke+="",!1);return Ne.toString=function(){return ke},Ne},utcFormat:function(ke){var Ne=L(ke+="",I);return Ne.toString=function(){return ke},Ne},utcParse:function(ke){var Ne=B(ke+="",!0);return Ne.toString=function(){return ke},Ne}}}var _Ee={"-":"",_:" ",0:"0"},sc=/^\s*\d+/,tZt=/^%/,rZt=/[\\^$*+?|[\]().{}]/g;function Yn(t,e,r){var i=t<0?"-":"",n=(i?-t:t)+"",s=n.length;return i+(s<r?new Array(r-s+1).join(e)+n:n)}function iZt(t){return t.replace(rZt,"\\$&")}function m$(t){return new RegExp("^(?:"+t.map(iZt).join("|")+")","i")}function g$(t){return new Map(t.map((e,r)=>[e.toLowerCase(),r]))}function nZt(t,e,r){var i=sc.exec(e.slice(r,r+1));return i?(t.w=+i[0],r+i[0].length):-1}function sZt(t,e,r){var i=sc.exec(e.slice(r,r+1));return i?(t.u=+i[0],r+i[0].length):-1}function oZt(t,e,r){var i=sc.exec(e.slice(r,r+2));return i?(t.U=+i[0],r+i[0].length):-1}function aZt(t,e,r){var i=sc.exec(e.slice(r,r+2));return i?(t.V=+i[0],r+i[0].length):-1}function lZt(t,e,r){var i=sc.exec(e.slice(r,r+2));return i?(t.W=+i[0],r+i[0].length):-1}function vEe(t,e,r){var i=sc.exec(e.slice(r,r+4));return i?(t.y=+i[0],r+i[0].length):-1}function bEe(t,e,r){var i=sc.exec(e.slice(r,r+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function cZt(t,e,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(r,r+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function uZt(t,e,r){var i=sc.exec(e.slice(r,r+1));return i?(t.q=i[0]*3-3,r+i[0].length):-1}function hZt(t,e,r){var i=sc.exec(e.slice(r,r+2));return i?(t.m=i[0]-1,r+i[0].length):-1}function wEe(t,e,r){var i=sc.exec(e.slice(r,r+2));return i?(t.d=+i[0],r+i[0].length):-1}function dZt(t,e,r){var i=sc.exec(e.slice(r,r+3));return i?(t.m=0,t.d=+i[0],r+i[0].length):-1}function xEe(t,e,r){var i=sc.exec(e.slice(r,r+2));return i?(t.H=+i[0],r+i[0].length):-1}function pZt(t,e,r){var i=sc.exec(e.slice(r,r+2));return i?(t.M=+i[0],r+i[0].length):-1}function fZt(t,e,r){var i=sc.exec(e.slice(r,r+2));return i?(t.S=+i[0],r+i[0].length):-1}function mZt(t,e,r){var i=sc.exec(e.slice(r,r+3));return i?(t.L=+i[0],r+i[0].length):-1}function gZt(t,e,r){var i=sc.exec(e.slice(r,r+6));return i?(t.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function AZt(t,e,r){var i=tZt.exec(e.slice(r,r+1));return i?r+i[0].length:-1}function yZt(t,e,r){var i=sc.exec(e.slice(r));return i?(t.Q=+i[0],r+i[0].length):-1}function _Zt(t,e,r){var i=sc.exec(e.slice(r));return i?(t.s=+i[0],r+i[0].length):-1}function TEe(t,e){return Yn(t.getDate(),e,2)}function vZt(t,e){return Yn(t.getHours(),e,2)}function bZt(t,e){return Yn(t.getHours()%12||12,e,2)}function wZt(t,e){return Yn(1+OP.count(HA(t),t),e,3)}function iHe(t,e){return Yn(t.getMilliseconds(),e,3)}function xZt(t,e){return iHe(t,e)+"000"}function TZt(t,e){return Yn(t.getMonth()+1,e,2)}function SZt(t,e){return Yn(t.getMinutes(),e,2)}function EZt(t,e){return Yn(t.getSeconds(),e,2)}function CZt(t){var e=t.getDay();return e===0?7:e}function MZt(t,e){return Yn(BO.count(HA(t)-1,t),e,2)}function nHe(t){var e=t.getDay();return e>=4||e===0?lE(t):lE.ceil(t)}function RZt(t,e){return t=nHe(t),Yn(lE.count(HA(t),t)+(HA(t).getDay()===4),e,2)}function OZt(t){return t.getDay()}function PZt(t,e){return Yn(eN.count(HA(t)-1,t),e,2)}function IZt(t,e){return Yn(t.getFullYear()%100,e,2)}function $Zt(t,e){return t=nHe(t),Yn(t.getFullYear()%100,e,2)}function DZt(t,e){return Yn(t.getFullYear()%1e4,e,4)}function LZt(t,e){var r=t.getDay();return t=r>=4||r===0?lE(t):lE.ceil(t),Yn(t.getFullYear()%1e4,e,4)}function NZt(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Yn(e/60|0,"0",2)+Yn(e%60,"0",2)}function SEe(t,e){return Yn(t.getUTCDate(),e,2)}function FZt(t,e){return Yn(t.getUTCHours(),e,2)}function kZt(t,e){return Yn(t.getUTCHours()%12||12,e,2)}function UZt(t,e){return Yn(1+TF.count(qA(t),t),e,3)}function sHe(t,e){return Yn(t.getUTCMilliseconds(),e,3)}function BZt(t,e){return sHe(t,e)+"000"}function zZt(t,e){return Yn(t.getUTCMonth()+1,e,2)}function VZt(t,e){return Yn(t.getUTCMinutes(),e,2)}function GZt(t,e){return Yn(t.getUTCSeconds(),e,2)}function jZt(t){var e=t.getUTCDay();return e===0?7:e}function HZt(t,e){return Yn(zO.count(qA(t)-1,t),e,2)}function oHe(t){var e=t.getUTCDay();return e>=4||e===0?cE(t):cE.ceil(t)}function qZt(t,e){return t=oHe(t),Yn(cE.count(qA(t),t)+(qA(t).getUTCDay()===4),e,2)}function WZt(t){return t.getUTCDay()}function QZt(t,e){return Yn(tN.count(qA(t)-1,t),e,2)}function YZt(t,e){return Yn(t.getUTCFullYear()%100,e,2)}function XZt(t,e){return t=oHe(t),Yn(t.getUTCFullYear()%100,e,2)}function ZZt(t,e){return Yn(t.getUTCFullYear()%1e4,e,4)}function JZt(t,e){var r=t.getUTCDay();return t=r>=4||r===0?cE(t):cE.ceil(t),Yn(t.getUTCFullYear()%1e4,e,4)}function KZt(){return"+0000"}function EEe(){return"%"}function CEe(t){return+t}function MEe(t){return Math.floor(+t/1e3)}var J3,aHe,QH;eJt({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function eJt(t){return J3=eZt(t),aHe=J3.format,J3.parse,QH=J3.utcFormat,J3.utcParse,J3}function tJt(t){return new Date(t)}function rJt(t){return t instanceof Date?+t:+new Date(+t)}function Xpe(t,e,r,i,n,s,o,a,l,c){var u=Nje(),d=u.invert,p=u.domain,A=c(".%L"),v=c(":%S"),b=c("%I:%M"),S=c("%I %p"),E=c("%a %d"),R=c("%b %d"),O=c("%B"),I=c("%Y");function N(L){return(l(L)<L?A:a(L)<L?v:o(L)<L?b:s(L)<L?S:i(L)<L?n(L)<L?E:R:r(L)<L?O:I)(L)}return u.invert=function(L){return new Date(d(L))},u.domain=function(L){return arguments.length?p(Array.from(L,rJt)):p().map(tJt)},u.ticks=function(L){var B=p();return t(B[0],B[B.length-1],L??10)},u.tickFormat=function(L,B){return B==null?N:c(B)},u.nice=function(L){var B=p();return(!L||typeof L.range!="function")&&(L=e(B[0],B[B.length-1],L??10)),L?p(kje(B,L)):u},u.copy=function(){return wF(u,Xpe(t,e,r,i,n,s,o,a,l,c))},u}function iJt(){return ly.apply(Xpe(JXt,KXt,HA,SR,BO,OP,qH,jH,$_,aHe).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function nJt(){return ly.apply(Xpe(XXt,ZXt,qA,ER,zO,TF,WH,HH,$_,QH).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function YH(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function XH(){var t=0,e=.5,r=1,i=1,n,s,o,a,l,c=$f,u,d=!1,p;function A(b){return isNaN(b=+b)?p:(b=.5+((b=+u(b))-s)*(i*b<i*s?a:l),c(d?Math.max(0,Math.min(1,b)):b))}A.domain=function(b){return arguments.length?([t,e,r]=b,n=u(t=+t),s=u(e=+e),o=u(r=+r),a=n===s?0:.5/(s-n),l=s===o?0:.5/(o-s),i=s<n?-1:1,A):[t,e,r]},A.clamp=function(b){return arguments.length?(d=!!b,A):d},A.interpolator=function(b){return arguments.length?(c=b,A):c};function v(b){return function(S){var E,R,O;return arguments.length?([E,R,O]=S,c=kpe(b,[E,R,O]),A):[c(0),c(.5),c(1)]}}return A.range=v(vF),A.rangeRound=v(Npe),A.unknown=function(b){return arguments.length?(p=b,A):p},function(b){return u=b,n=b(t),s=b(e),o=b(r),a=n===s?0:.5/(s-n),l=s===o?0:.5/(o-s),i=s<n?-1:1,A}}function lHe(){var t=xF(XH()($f));return t.copy=function(){return YH(t,lHe())},zH.apply(t,arguments)}function cHe(){var t=Uje(XH()).domain([.1,1,10]);return t.copy=function(){return YH(t,cHe()).base(t.base())},zH.apply(t,arguments)}function uHe(){var t=zje(XH());return t.copy=function(){return YH(t,uHe()).constant(t.constant())},zH.apply(t,arguments)}function hHe(){var t=Gje(XH());return t.copy=function(){return YH(t,hHe()).exponent(t.exponent())},zH.apply(t,arguments)}function Vi(t){for(var e=t.length/6|0,r=new Array(e),i=0;i<e;)r[i]="#"+t.slice(i*6,++i*6);return r}const sJt=Vi("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),oJt=Vi("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),aJt=Vi("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),lJt=Vi("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),cJt=Vi("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),uJt=Vi("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),hJt=Vi("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),dJt=Vi("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),pJt=Vi("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),fJt=Vi("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),Xs=t=>rQt(t[t.length-1]);var dHe=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(Vi);const pHe=Xs(dHe);var fHe=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(Vi);const mHe=Xs(fHe);var gHe=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(Vi);const AHe=Xs(gHe);var yHe=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(Vi);const _He=Xs(yHe);var Coe=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(Vi);const jV=Xs(Coe);var vHe=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(Vi);const bHe=Xs(vHe);var Moe=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(Vi);const HV=Xs(Moe);var wHe=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(Vi);const xHe=Xs(wHe);var THe=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(Vi);const SHe=Xs(THe);var EHe=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(Vi);const CHe=Xs(EHe);var MHe=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(Vi);const RHe=Xs(MHe);var OHe=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(Vi);const PHe=Xs(OHe);var IHe=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Vi);const $He=Xs(IHe);var DHe=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(Vi);const LHe=Xs(DHe);var NHe=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(Vi);const FHe=Xs(NHe);var kHe=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(Vi);const UHe=Xs(kHe);var BHe=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(Vi);const zHe=Xs(BHe);var VHe=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Vi);const GHe=Xs(VHe);var jHe=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Vi);const HHe=Xs(jHe);var qHe=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(Vi);const WHe=Xs(qHe);var QHe=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Vi);const YHe=Xs(QHe);var XHe=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Vi);const ZHe=Xs(XHe);var JHe=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Vi);const KHe=Xs(JHe);var eqe=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(Vi);const tqe=Xs(eqe);var rqe=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Vi);const iqe=Xs(rqe);var nqe=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Vi);const sqe=Xs(nqe);var oqe=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Vi);const aqe=Xs(oqe);function lqe(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-t*(35.34-t*(2381.73-t*(6402.7-t*(7024.72-t*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+t*(170.73+t*(52.82-t*(131.46-t*(176.58-t*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+t*(442.36-t*(2482.43-t*(6167.24-t*(6614.94-t*2475.67)))))))+")"}const cqe=Fpe(jA(300,.5,0),jA(-240,.5,1));var uqe=Fpe(jA(-100,.75,.35),jA(80,1.5,.8)),hqe=Fpe(jA(260,.75,.35),jA(80,1.5,.8)),c7=jA();function dqe(t){(t<0||t>1)&&(t-=Math.floor(t));var e=Math.abs(t-.5);return c7.h=360*t-100,c7.s=1.5-1.5*e,c7.l=.8-.9*e,c7+""}var u7=Q2(),mJt=Math.PI/3,gJt=Math.PI*2/3;function pqe(t){var e;return t=(.5-t)*Math.PI,u7.r=255*(e=Math.sin(t))*e,u7.g=255*(e=Math.sin(t+mJt))*e,u7.b=255*(e=Math.sin(t+gJt))*e,u7+""}function fqe(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+t*(1172.33-t*(10793.56-t*(33300.12-t*(38394.49-t*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+t*(557.33+t*(1225.33-t*(3574.96-t*(1073.77+t*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+t*(3211.1-t*(15327.97-t*(27814-t*(22569.18-t*6838.66)))))))+")"}function ZH(t){var e=t.length;return function(r){return t[Math.max(0,Math.min(e-1,Math.floor(r*e)))]}}const mqe=ZH(Vi("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var gqe=ZH(Vi("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),Aqe=ZH(Vi("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),yqe=ZH(Vi("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));const _qe=Math.cos,Zpe=Math.min,qV=Math.sin,Dl=Math.sqrt,WV=Math.PI,JH=2*WV,AJt=Dl(3),vqe={draw(t,e){const r=Dl(e+Zpe(e/28,.75))*.59436,i=r/2,n=i*AJt;t.moveTo(0,r),t.lineTo(0,-r),t.moveTo(-n,-i),t.lineTo(n,i),t.moveTo(-n,i),t.lineTo(n,-i)}},Jpe={draw(t,e){const r=Dl(e/WV);t.moveTo(r,0),t.arc(0,0,r,0,JH)}},bqe={draw(t,e){const r=Dl(e/5)/2;t.moveTo(-3*r,-r),t.lineTo(-r,-r),t.lineTo(-r,-3*r),t.lineTo(r,-3*r),t.lineTo(r,-r),t.lineTo(3*r,-r),t.lineTo(3*r,r),t.lineTo(r,r),t.lineTo(r,3*r),t.lineTo(-r,3*r),t.lineTo(-r,r),t.lineTo(-3*r,r),t.closePath()}},wqe=Dl(1/3),yJt=wqe*2,xqe={draw(t,e){const r=Dl(e/yJt),i=r*wqe;t.moveTo(0,-r),t.lineTo(i,0),t.lineTo(0,r),t.lineTo(-i,0),t.closePath()}},Tqe={draw(t,e){const r=Dl(e)*.62625;t.moveTo(0,-r),t.lineTo(r,0),t.lineTo(0,r),t.lineTo(-r,0),t.closePath()}},Sqe={draw(t,e){const r=Dl(e-Zpe(e/7,2))*.87559;t.moveTo(-r,0),t.lineTo(r,0),t.moveTo(0,r),t.lineTo(0,-r)}},Eqe={draw(t,e){const r=Dl(e),i=-r/2;t.rect(i,i,r,r)}},Cqe={draw(t,e){const r=Dl(e)*.4431;t.moveTo(r,r),t.lineTo(r,-r),t.lineTo(-r,-r),t.lineTo(-r,r),t.closePath()}},_Jt=.8908130915292852,Mqe=qV(WV/10)/qV(7*WV/10),vJt=qV(JH/10)*Mqe,bJt=-_qe(JH/10)*Mqe,Rqe={draw(t,e){const r=Dl(e*_Jt),i=vJt*r,n=bJt*r;t.moveTo(0,-r),t.lineTo(i,n);for(let s=1;s<5;++s){const o=JH*s/5,a=_qe(o),l=qV(o);t.lineTo(l*r,-a*r),t.lineTo(a*i-l*n,l*i+a*n)}t.closePath()}},PZ=Dl(3),Oqe={draw(t,e){const r=-Dl(e/(PZ*3));t.moveTo(0,r*2),t.lineTo(-PZ*r,-r),t.lineTo(PZ*r,-r),t.closePath()}},wJt=Dl(3),Pqe={draw(t,e){const r=Dl(e)*.6824,i=r/2,n=r*wJt/2;t.moveTo(0,-r),t.lineTo(n,i),t.lineTo(-n,i),t.closePath()}},qp=-.5,Wp=Dl(3)/2,Roe=1/Dl(12),xJt=(Roe/2+1)*3,Iqe={draw(t,e){const r=Dl(e/xJt),i=r/2,n=r*Roe,s=i,o=r*Roe+r,a=-s,l=o;t.moveTo(i,n),t.lineTo(s,o),t.lineTo(a,l),t.lineTo(qp*i-Wp*n,Wp*i+qp*n),t.lineTo(qp*s-Wp*o,Wp*s+qp*o),t.lineTo(qp*a-Wp*l,Wp*a+qp*l),t.lineTo(qp*i+Wp*n,qp*n-Wp*i),t.lineTo(qp*s+Wp*o,qp*o-Wp*s),t.lineTo(qp*a+Wp*l,qp*l-Wp*a),t.closePath()}},$qe={draw(t,e){const r=Dl(e-Zpe(e/6,1.7))*.6189;t.moveTo(-r,-r),t.lineTo(r,r),t.moveTo(-r,r),t.lineTo(r,-r)}},TJt=[Jpe,bqe,xqe,Eqe,Rqe,Oqe,Iqe],SJt=[Jpe,Sqe,$qe,Pqe,vqe,Cqe,Tqe];function t5(t,e,r){this.k=t,this.x=e,this.y=r}t5.prototype={constructor:t5,scale:function(t){return t===1?this:new t5(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new t5(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};t5.prototype;function rN(t){return t!=null&&!Number.isNaN(t)}function uE(t,e){return+rN(e)-+rN(t)||md(t,e)}function Dqe(t,e){return+rN(e)-+rN(t)||AF(t,e)}function Lqe(t){return t!=null&&`${t}`!=""}function Nqe(t){return isFinite(t)?t:NaN}function Kpe(t){return t>0&&isFinite(t)?t:NaN}function Fqe(t){return t<0&&isFinite(t)?t:NaN}function EJt(t,e){if(t instanceof Date||(t=new Date(+t)),isNaN(t))return typeof e=="function"?e(t):e;const r=t.getUTCHours(),i=t.getUTCMinutes(),n=t.getUTCSeconds(),s=t.getUTCMilliseconds();return`${CJt(t.getUTCFullYear())}-${y_(t.getUTCMonth()+1,2)}-${y_(t.getUTCDate(),2)}${r||i||n||s?`T${y_(r,2)}:${y_(i,2)}${n||s?`:${y_(n,2)}${s?`.${y_(s,3)}`:""}`:""}Z`:""}`}function CJt(t){return t<0?`-${y_(-t,6)}`:t>9999?`+${y_(t,6)}`:y_(t,4)}function y_(t,e){return`${t}`.padStart(e,"0")}const MJt=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function kqe(t,e){return MJt.test(t+="")?new Date(t):typeof e=="function"?e(t):e}const RJt=new Map([["second",$_],["minute",jH],["hour",qH],["day",OP],["week",BO],["month",SR],["quarter",SR.every(3)],["half",SR.every(6)],["year",HA],["monday",eN],["tuesday",Qje],["wednesday",Yje],["thursday",lE],["friday",Xje],["saturday",Zje],["sunday",BO]]),OJt=new Map([["second",$_],["minute",HH],["hour",WH],["day",TF],["week",zO],["month",ER],["quarter",ER.every(3)],["half",ER.every(6)],["year",qA],["monday",tN],["tuesday",Jje],["wednesday",Kje],["thursday",cE],["friday",eHe],["saturday",tHe],["sunday",zO]]);function PJt(t){const e=RJt.get(`${t}`.toLowerCase());if(!e)throw new Error(`unknown interval: ${t}`);return e}function IJt(t){const e=OJt.get(`${t}`.toLowerCase());if(!e)throw new Error(`unknown interval: ${t}`);return e}const iN=Object.getPrototypeOf(Uint8Array),$Jt=Object.prototype.toString;function Bf(t,e,r){const i=typeof e;return i==="string"?REe(t,Uqe(e),r):i==="function"?REe(t,e,r):i==="number"||e instanceof Date||i==="boolean"?Tu(t,PP(e),r):typeof(e==null?void 0:e.transform)=="function"?OEe(e.transform(t),r):OEe(e,r)}function REe(t,e,r){return Tu(t,(r==null?void 0:r.prototype)instanceof iN?DJt(e):e,r)}function OEe(t,e){return e===void 0?WA(t):t instanceof e?t:e.prototype instanceof iN&&!(t instanceof iN)?e.from(t,efe):e.from(t)}function DJt(t){return(e,r)=>efe(t(e,r))}const Uqe=t=>e=>e[t],Bqe={transform:fw},Ym={transform:t=>t},LJt=()=>1,NJt=()=>!0,_m=t=>t==null?t:`${t}`,Ma=t=>t==null?t:+t,zqe=t=>t?t[0]:void 0,FJt=t=>t?t[1]:void 0,PP=t=>()=>t;function kJt(t){const e=+`${t}`.slice(1)/100;return(r,i)=>bV(r,e,i)}function PEe(t){return t instanceof iN?t:Tu(t,efe,Float64Array)}function efe(t){return t==null?NaN:Number(t)}function UJt(t){return Tu(t,BJt)}function BJt(t){return t instanceof Date&&!isNaN(t)?t:typeof t=="string"?kqe(t):t==null||isNaN(t=+t)?void 0:new Date(t)}function hE(t,e){return t===void 0&&(t=e),t===null?[void 0,"none"]:KH(t)?[void 0,t]:[t,void 0]}function hp(t,e){return t===void 0&&(t=e),t===null||typeof t=="number"?[void 0,t]:[t,void 0]}function Vqe(t,e,r){if(t!=null)return N1(t,e,r)}function N1(t,e,r){const i=`${t}`.toLowerCase();if(!r.includes(i))throw new Error(`invalid ${e}: ${t}`);return i}function WA(t){return t==null||t instanceof Array||t instanceof iN?t:Array.from(t)}function Tu(t,e,r=Array){return t==null?t:t instanceof r?t.map(e):r.from(t,e)}function Ooe(t,e=Array){return t instanceof e?t.slice():e.from(t)}function SF(t){return(t==null?void 0:t.toString)===$Jt}function Poe(t){return SF(t)&&(t.type!==void 0||t.domain!==void 0)}function tfe(t){return SF(t)&&typeof t.transform!="function"}function nN(t){return tfe(t)&&t.value===void 0&&t.channel===void 0}function zJt(t,e,r,i=Ym){return e===void 0&&r===void 0?(e=0,r=t===void 0?i:t):e===void 0?e=t===void 0?0:t:r===void 0&&(r=t===void 0?0:t),[e,r]}function VJt(t,e){return t===void 0&&e===void 0?[zqe,FJt]:[t,e]}function GJt({z:t,fill:e,stroke:r}={}){return t===void 0&&([t]=hE(e)),t===void 0&&([t]=hE(r)),t}function fw(t){const e=t.length,r=new Uint32Array(e);for(let i=0;i<e;++i)r[i]=i;return r}function Gqe(t,e){return Tu(e,r=>t[r])}function Ioe(t){let e;return[{transform:()=>e,label:EF(t)},r=>e=r]}function jJt(t){return t==null?[t]:Ioe(t)}function EF(t,e){return typeof t=="string"?t:t&&t.label!==void 0?t.label:e}function HJt(t,e){return{transform(r){const i=t.transform(r),n=e.transform(r);return Vm(i)||Vm(n)?Tu(i,(s,o)=>new Date((+i[o]+ +n[o])/2)):Tu(i,(s,o)=>(+i[o]+ +n[o])/2,Float64Array)},label:t.label}}function rfe(t,e){if(t!=null){if(typeof t=="number"){0<t&&t<1&&Number.isInteger(1/t)&&(t=-1/t);const r=Math.abs(t);return t<0?{floor:i=>Math.floor(i*r)/r,offset:i=>(i*r+1)/r,range:(i,n)=>Wse(Math.ceil(i*r),n*r).map(s=>s/r)}:{floor:i=>Math.floor(i/r)*r,offset:i=>i+r,range:(i,n)=>Wse(Math.ceil(i/r),n/r).map(s=>s*r)}}if(typeof t=="string")return(e==="time"?PJt:IJt)(t);if(typeof t.floor!="function")throw new Error("invalid interval; missing floor method");if(typeof t.offset!="function")throw new Error("invalid interval; missing offset method");return t}}function CF(t,e){if(t=rfe(t,e),t&&typeof t.range!="function")throw new Error("invalid interval: missing range method");return t}function qJt(t,e){if(t=CF(t,e),t&&typeof t.ceil!="function")throw new Error("invalid interval: missing ceil method");return t}function ife(t){return t===void 0||tfe(t)?t:{value:t}}function WJt(t){return t==null?null:{transform:e=>Bf(e,t,Float64Array),label:EF(t)}}function IE(t){return t&&typeof t[Symbol.iterator]=="function"}function QJt(t){for(const e of t)if(e!=null)return typeof e!="object"||e instanceof Date}function IEe(t){for(const e of t){if(e==null)continue;const r=typeof e;return r==="string"||r==="boolean"}}function Vm(t){for(const e of t)if(e!=null)return e instanceof Date}function YJt(t){for(const e of t)if(e!=null)return typeof e=="string"&&isNaN(e)&&kqe(e)}function XJt(t){for(const e of t)if(e!=null){if(typeof e!="string")return!1;if(e.trim())return!isNaN(e)}}function ZJt(t){for(const e of t)if(e!=null)return typeof e=="number"}function IZ(t,e){let r;for(const i of t)if(i!=null){if(!e(i))return!1;r=!0}return r}function KH(t){return typeof t!="string"?!1:(t=t.toLowerCase().trim(),t==="none"||t==="currentcolor"||t.startsWith("url(")&&t.endsWith(")")||t.startsWith("var(")&&t.endsWith(")")||W2(t)!==null)}function JJt(t){return typeof t=="number"&&(0<=t&&t<=1||isNaN(t))}function ap(t){return t==null||sN(t)}function sN(t){return/^\s*none\s*$/i.test(t)}function KJt(t){return/^\s*round\s*$/i.test(t)}function jqe(t="middle"){return N1(t,"frameAnchor",["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function oN(t){if(t==null)return;const e=t[0],r=t[t.length-1];return AF(e,r)}function eKt(t={},...e){let r=t;for(const i of e)for(const n in i)if(r[n]===void 0){const s=i[n];r===t?r={...r,[n]:s}:r[n]=s}return r}function tKt(t){console.warn("named iterables are deprecated; please use an object instead");const e=new Set;return Object.fromEntries(Array.from(t,r=>{const{name:i}=r;if(i==null)throw new Error("missing name");const n=`${i}`;if(n==="__proto__")throw new Error(`illegal name: ${n}`);if(e.has(n))throw new Error(`duplicate name: ${n}`);return e.add(n),[i,r]}))}function $Ee(t){return IE(t)?tKt(t):t}const mA=Symbol("position"),QA=Symbol("color"),eq=Symbol("radius"),tq=Symbol("length"),rq=Symbol("opacity"),iq=Symbol("symbol"),da=new Map([["x",mA],["y",mA],["fx",mA],["fy",mA],["r",eq],["color",QA],["opacity",rq],["symbol",iq],["length",tq]]),rKt=Math.sqrt(3),iKt=2/rKt,nKt={draw(t,e){const r=Math.sqrt(e/Math.PI),i=r*iKt,n=i/2;t.moveTo(0,i),t.lineTo(r,n),t.lineTo(r,-n),t.lineTo(0,-i),t.lineTo(-r,-n),t.lineTo(-r,n),t.closePath()}},Hqe=new Map([["asterisk",vqe],["circle",Jpe],["cross",bqe],["diamond",xqe],["diamond2",Tqe],["hexagon",nKt],["plus",Sqe],["square",Eqe],["square2",Cqe],["star",Rqe],["times",$qe],["triangle",Oqe],["triangle2",Pqe],["wye",Iqe]]);function qqe(t){return t&&typeof t.draw=="function"}function sKt(t){return qqe(t)?!0:typeof t!="string"?!1:Hqe.has(t.toLowerCase())}function nfe(t){if(t==null||qqe(t))return t;const e=Hqe.get(`${t}`.toLowerCase());if(e)return e;throw new Error(`invalid symbol: ${t}`)}function Wqe({filter:t,sort:e,reverse:r,transform:i,initializer:n,...s}={},o){if(i===void 0&&(t!=null&&(i=Yqe(t)),e!=null&&!nN(e)&&(i=$Z(i,Zqe(e))),r&&(i=$Z(i,Xqe))),o!=null&&n!=null)throw new Error("transforms cannot be applied after initializers");return{...s,...(e===null||nN(e))&&{sort:e},transform:$Z(i,o)}}function Qqe({filter:t,sort:e,reverse:r,initializer:i,...n}={},s){return i===void 0&&(t!=null&&(i=Yqe(t)),e!=null&&!nN(e)&&(i=DZ(i,Zqe(e))),r&&(i=DZ(i,Xqe))),{...n,...(e===null||nN(e))&&{sort:e},initializer:DZ(i,s)}}function $Z(t,e){return t==null?e===null?void 0:e:e==null?t===null?void 0:t:function(r,i){return{data:r,facets:i}=t.call(this,r,i),e.call(this,WA(r),i)}}function DZ(t,e){return t==null?e===null?void 0:e:e==null?t===null?void 0:t:function(r,i,n,...s){let o,a,l,c,u,d;return{data:a=r,facets:l=i,channels:o}=t.call(this,r,i,n,...s),{data:u=a,facets:d=l,channels:c}=e.call(this,a,l,{...n,...o},...s),{data:u,facets:d,channels:{...o,...c}}}}function Yqe(t){return(e,r)=>{const i=Bf(e,t);return{data:e,facets:r.map(n=>n.filter(s=>i[s]))}}}function Xqe(t,e){return{data:t,facets:e.map(r=>r.slice().reverse())}}function Zqe(t){return(typeof t=="function"&&t.length!==1?oKt:aKt)(t)}function oKt(t){return(e,r)=>{const i=(n,s)=>t(e[n],e[s]);return{data:e,facets:r.map(n=>n.slice().sort(i))}}}function aKt(t){let e,r;if({channel:e,value:t,order:r=uE}={...ife(t)},typeof r!="function")switch(`${r}`.toLowerCase()){case"ascending":r=uE;break;case"descending":r=Dqe;break;default:throw new Error(`invalid order: ${r}`)}return(i,n,s)=>{let o;if(e===void 0)o=Bf(i,t);else{if(s===void 0)throw new Error("channel sort requires an initializer");if(o=s[e],!o)return{};o=o.value}const a=(l,c)=>r(o[l],o[c]);return{data:i,facets:n.map(l=>l.slice().sort(a))}}}function lKt(t,e,r=cKt){if(t==null)return r(t);if(typeof t.reduceIndex=="function")return t;if(typeof t.reduce=="function"&&SF(t))return uKt(t);if(typeof t=="function")return hKt(t);if(/^p\d{2}$/i.test(t))return l_(kJt(t));switch(`${t}`.toLowerCase()){case"first":return pKt;case"last":return fKt;case"identity":return dKt;case"count":return LEe;case"distinct":return mKt;case"sum":return e==null?LEe:gKt;case"proportion":return NEe(e,"data");case"proportion-facet":return NEe(e,"facet");case"deviation":return l_(kHt);case"min":return l_(p1);case"min-index":return l_(jHt);case"max":return l_(GA);case"max-index":return l_(GHt);case"mean":return DEe(qHt);case"median":return DEe(qse);case"variance":return l_(aGe);case"mode":return l_(QHt)}return r(t)}function cKt(t){throw new Error(`invalid reduce: ${t}`)}function uKt(t){return console.warn("deprecated reduce interface; implement reduceIndex instead."),{...t,reduceIndex:t.reduce.bind(t)}}function hKt(t){return{reduceIndex(e,r,i){return t(Gqe(r,e),i)}}}function l_(t){return{reduceIndex(e,r){return t(e,i=>r[i])}}}function DEe(t){return{reduceIndex(e,r){const i=t(e,n=>r[n]);return Vm(r)?new Date(i):i}}}const dKt={reduceIndex(t,e){return Gqe(e,t)}},pKt={reduceIndex(t,e){return e[t[0]]}},fKt={reduceIndex(t,e){return e[t[t.length-1]]}},LEe={label:"Frequency",reduceIndex(t){return t.length}},mKt={label:"Distinct",reduceIndex(t,e){const r=new Cpe;for(const i of t)r.add(e[i]);return r.size}},gKt=l_(iE);function NEe(t,e){return t==null?{scope:e,label:"Frequency",reduceIndex:(r,i,n=1)=>r.length/n}:{scope:e,reduceIndex:(r,i,n=1)=>iE(r,s=>i[s])/n}}function aN(t,{scale:e,type:r,value:i,filter:n,hint:s},o){return Jqe(o,{scale:e,type:r,value:Bf(t,i),label:EF(i),filter:n,hint:s})}function AKt(t,e){return Object.fromEntries(Object.entries(t).map(([r,i])=>[r,aN(e,i,r)]))}function yKt(t,e){const r=Object.fromEntries(Object.entries(t).map(([i,{scale:n,value:s}])=>{const o=n==null?null:e[n];return[i,o==null?s:Tu(s,o)]}));return r.channels=t,r}function Jqe(t,e){const{scale:r,value:i}=e;if(r===!0||r==="auto")switch(t){case"fill":case"stroke":case"color":e.scale=r!==!0&&IZ(i,KH)?null:"color";break;case"fillOpacity":case"strokeOpacity":e.scale=r!==!0&&IZ(i,JJt)?null:"opacity";break;case"symbol":r!==!0&&IZ(i,sKt)?(e.scale=null,e.value=Tu(i,nfe)):e.scale="symbol";break;default:e.scale=da.has(t)?t:null;break}else if(r===!1)e.scale=null;else if(r!=null&&!da.has(r))throw new Error(`unknown scale: ${r}`);return e}function _Kt(t,e,r,i,n){const{reverse:s,reduce:o=!0,limit:a}=n;for(const l in n){if(!da.has(l))continue;let{value:c,reverse:u=s,reduce:d=o,limit:p=a}=ife(n[l]);if(u===void 0&&(u=c==="width"||c==="height"),d==null||d===!1)continue;const A=l==="fx"||l==="fy"?bKt(e,i[l]):vKt(r,l);if(!A)throw new Error(`missing channel for scale: ${l}`);const v=A.value,[b=0,S=1/0]=IE(p)?p:p<0?[p]:[0,p];if(c==null)A.domain=()=>{let E=Array.from(new Cpe(v));return u&&(E=E.reverse()),(b!==0||S!==1/0)&&(E=E.slice(b,S)),E};else{const E=c==="data"?t:c==="height"?FEe(r,"y1","y2"):c==="width"?FEe(r,"x1","x2"):$oe(r,c,c==="y"?"y2":c==="x"?"x2":void 0),R=lKt(d===!0?"max":d,E);A.domain=()=>{let O=wR(fw(v),I=>R.reduceIndex(I,E),I=>v[I]);return O=AV(O,u?xKt:wKt),(b!==0||S!==1/0)&&(O=O.slice(b,S)),O.map(zqe)}}}}function vKt(t,e){for(const r in t){const i=t[r];if(i.scale===e)return i}}function bKt(t,e){const r=t.original;if(r===t)return e;const i=e.value,n=e.value=[];for(let s=0;s<r.length;++s){const o=i[r[s][0]];for(const a of t[s])n[a]=o}return e}function FEe(t,e,r){const i=$oe(t,e),n=$oe(t,r);return Tu(n,(s,o)=>Math.abs(s-i[o]),Float64Array)}function $oe(t,e,r){let i=t[e];if(!i&&r!==void 0&&(i=t[r]),i)return i.value;throw new Error(`missing channel: ${e}`)}function wKt([t,e],[r,i]){return uE(e,i)||uE(t,r)}function xKt([t,e],[r,i]){return Dqe(e,i)||uE(t,r)}let Doe=0;function TKt(){const t=Doe;return Doe=0,t}function dD(t){console.warn(t),++Doe}const Kqe=Math.PI,Dy=2*Kqe,LZ=.618;function SKt({projection:t,inset:e=0,insetTop:r=e,insetRight:i=e,insetBottom:n=e,insetLeft:s=e}={},o){if(t==null)return;if(typeof t.stream=="function")return t;let a,l,c="frame";if(SF(t)){let N;if({type:t,domain:l,inset:N,insetTop:r=N!==void 0?N:r,insetRight:i=N!==void 0?N:i,insetBottom:n=N!==void 0?N:n,insetLeft:s=N!==void 0?N:s,clip:c=c,...a}=t,t==null)return}typeof t!="function"&&({type:t}=eWe(t));const{width:u,height:d,marginLeft:p,marginRight:A,marginTop:v,marginBottom:b}=o,S=u-p-A-s-i,E=d-v-b-r-n;if(t=t==null?void 0:t({width:S,height:E,clip:c,...a}),t==null)return;c=EKt(c,p,v,u-A,d-b);let R=p+s,O=v+r,I;if(l!=null){const[[N,L],[B,U]]=vje(t).bounds(l),q=Math.min(S/(B-N),E/(U-L));q>0?(R-=(q*(N+B)-S)/2,O-=(q*(L+U)-E)/2,I=woe({point(Z,X){this.stream.point(Z*q+R,X*q+O)}})):dD("Warning: the projection could not be fit to the specified domain; using the default scale.")}return I??(I=R===0&&O===0?tWe():woe({point(N,L){this.stream.point(N+R,L+O)}})),{stream:N=>t.stream(I.stream(c(N)))}}function eWe(t){switch(`${t}`.toLowerCase()){case"albers-usa":return z0(wXt,.7463,.4673);case"albers":return h7(Sje,.7463,.4673);case"azimuthal-equal-area":return z0(xXt,4,4);case"azimuthal-equidistant":return z0(TXt,Dy,Dy);case"conic-conformal":return h7(CXt,Dy,Dy);case"conic-equal-area":return h7(BV,6.1702,2.9781);case"conic-equidistant":return h7(OXt,7.312,3.6282);case"equal-earth":return z0(IXt,5.4133,2.6347);case"equirectangular":return z0(MXt,Dy,Kqe);case"gnomonic":return z0($Xt,3.4641,3.4641);case"identity":return{type:tWe};case"reflect-y":return{type:CKt};case"mercator":return z0(SXt,Dy,Dy);case"orthographic":return z0(DXt,2,2);case"stereographic":return z0(LXt,2,2);case"transverse-mercator":return z0(NXt,Dy,Dy);default:throw new Error(`unknown projection type: ${t}`)}}function EKt(t,e,r,i,n){if(t===!1||t==null||typeof t=="number")return s=>s;switch(t===!0&&(t="frame"),`${t}`.toLowerCase()){case"frame":return lje(e,r,i,n);default:throw new Error(`unknown projection clip type: ${t}`)}}function z0(t,e,r){return{type:({width:i,height:n,rotate:s,precision:o=.15,clip:a})=>{var c,u,d;const l=t();return o!=null&&((c=l.precision)==null||c.call(l,o)),s!=null&&((u=l.rotate)==null||u.call(l,s)),typeof a=="number"&&((d=l.clipAngle)==null||d.call(l,a)),l.scale(Math.min(i/e,n/r)),l.translate([i/2,n/2]),l},aspectRatio:r/e}}function h7(t,e,r){const{type:i,aspectRatio:n}=z0(t,e,r);return{type:s=>{const{parallels:o,domain:a,width:l,height:c}=s,u=i(s);return o!=null&&(u.parallels(o),a===void 0&&u.fitSize([l,c],{type:"Sphere"})),u},aspectRatio:n}}const tWe=PP({stream:t=>t}),CKt=PP(woe({point(t,e){this.stream.point(t,-e)}}));function NZ(t,e,r,i,n){const s=r[t]&&r[t].scale==="x",o=r[e]&&r[e].scale==="y";if(s&&o)MKt(t,e,i,n.projection);else{if(s)throw new Error(`projection requires paired x and y channels; ${t} is missing ${e}`);if(o)throw new Error(`projection requires paired x and y channels; ${e} is missing ${t}`)}}function MKt(t,e,r,i){const n=r[t],s=r[e],o=n.length,a=r[t]=new Float64Array(o).fill(NaN),l=r[e]=new Float64Array(o).fill(NaN);let c;const u=i.stream({point(d,p){a[c]=d,l[c]=p}});for(c=0;c<o;++c)u.point(n[c],s[c])}function RKt(t,e){if(typeof(t==null?void 0:t.stream)=="function")return LZ;if(SF(t)&&(t=t.type),t==null)return OKt(e)?LZ:void 0;if(typeof t!="function"){const{aspectRatio:r}=eWe(t);if(r)return r}return LZ}function OKt(t){for(const e of t)if(e.channels.geometry)return!0;return!1}function sfe(t={},e,r){const{document:i=typeof window<"u"?window.document:void 0}=t;return{document:i,className:r,projection:SKt(t,e)}}function cy(t,{document:e}){return Xse(Rpe(t).call(e.documentElement))}const kEe=new Map([["accent",oJt],["category10",sJt],["dark2",aJt],["paired",lJt],["pastel1",cJt],["pastel2",uJt],["set1",hJt],["set2",dJt],["set3",pJt],["tableau10",fJt],["brbg",Ly(dHe,pHe)],["prgn",Ly(fHe,mHe)],["piyg",Ly(gHe,AHe)],["puor",Ly(yHe,_He)],["rdbu",Ly(Coe,jV)],["rdgy",Ly(vHe,bHe)],["rdylbu",Ly(Moe,HV)],["rdylgn",Ly(wHe,xHe)],["spectral",Ly(THe,SHe)],["burd",UEe(Coe,jV)],["buylrd",UEe(Moe,HV)],["blues",Bl(XHe,ZHe)],["greens",Bl(JHe,KHe)],["greys",Bl(eqe,tqe)],["oranges",Bl(oqe,aqe)],["purples",Bl(rqe,iqe)],["reds",Bl(nqe,sqe)],["turbo",Ny(fqe)],["viridis",Ny(mqe)],["magma",Ny(gqe)],["inferno",Ny(Aqe)],["plasma",Ny(yqe)],["cividis",Ny(lqe)],["cubehelix",Ny(cqe)],["warm",Ny(uqe)],["cool",Ny(hqe)],["bugn",Bl(EHe,CHe)],["bupu",Bl(MHe,RHe)],["gnbu",Bl(OHe,PHe)],["orrd",Bl(IHe,$He)],["pubu",Bl(NHe,FHe)],["pubugn",Bl(DHe,LHe)],["purd",Bl(kHe,UHe)],["rdpu",Bl(BHe,zHe)],["ylgn",Bl(jHe,HHe)],["ylgnbu",Bl(VHe,GHe)],["ylorbr",Bl(qHe,WHe)],["ylorrd",Bl(QHe,YHe)],["rainbow",BEe(dqe)],["sinebow",BEe(pqe)]]);function Bl(t,e){return({length:r})=>r===1?[t[3][1]]:r===2?[t[3][1],t[3][2]]:(r=Math.max(3,Math.floor(r)),r>9?zm(e,r):t[r])}function Ly(t,e){return({length:r})=>r===2?[t[3][0],t[3][2]]:(r=Math.max(3,Math.floor(r)),r>11?zm(e,r):t[r])}function UEe(t,e){return({length:r})=>r===2?[t[3][2],t[3][0]]:(r=Math.max(3,Math.floor(r)),r>11?zm(i=>e(1-i),r):t[r].slice().reverse())}function Ny(t){return({length:e})=>zm(t,Math.max(2,Math.floor(e)))}function BEe(t){return({length:e})=>zm(t,Math.floor(e)+1).slice(0,-1)}function rWe(t){const e=`${t}`.toLowerCase();if(!kEe.has(e))throw new Error(`unknown ordinal scheme: ${e}`);return kEe.get(e)}function nq(t,e){const r=rWe(t),i=typeof r=="function"?r({length:e}):r;return i.length!==e?i.slice(0,e):i}function PKt(t,e="greys"){const r=new Set,[i,n]=nq(e,2);for(const s of t)if(s!=null)if(s===!0)r.add(n);else if(s===!1)r.add(i);else return;return[...r]}const zEe=new Map([["brbg",pHe],["prgn",mHe],["piyg",AHe],["puor",_He],["rdbu",jV],["rdgy",bHe],["rdylbu",HV],["rdylgn",xHe],["spectral",SHe],["burd",t=>jV(1-t)],["buylrd",t=>HV(1-t)],["blues",ZHe],["greens",KHe],["greys",tqe],["purples",iqe],["reds",sqe],["oranges",aqe],["turbo",fqe],["viridis",mqe],["magma",gqe],["inferno",Aqe],["plasma",yqe],["cividis",lqe],["cubehelix",cqe],["warm",uqe],["cool",hqe],["bugn",CHe],["bupu",RHe],["gnbu",PHe],["orrd",$He],["pubugn",LHe],["pubu",FHe],["purd",UHe],["rdpu",zHe],["ylgnbu",GHe],["ylgn",HHe],["ylorbr",WHe],["ylorrd",YHe],["rainbow",dqe],["sinebow",pqe]]);function ofe(t){const e=`${t}`.toLowerCase();if(!zEe.has(e))throw new Error(`unknown quantitative scheme: ${e}`);return zEe.get(e)}const IKt=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function VEe(t){return t!=null&&IKt.has(`${t}`.toLowerCase())}const iWe=t=>e=>t(1-e),FZ=[0,1],GEe=new Map([["number",uu],["rgb",sE],["hsl",mQt],["hcl",yQt],["lab",gQt]]);function nWe(t){const e=`${t}`.toLowerCase();if(!GEe.has(e))throw new Error(`unknown interpolator: ${e}`);return GEe.get(e)}function MF(t,e,r,{type:i,nice:n,clamp:s,zero:o,domain:a=oWe(t,r),unknown:l,round:c,scheme:u,interval:d,range:p=da.get(t)===eq?GKt(r,a):da.get(t)===tq?jKt(r,a):da.get(t)===rq?FZ:void 0,interpolate:A=da.get(t)===QA?u==null&&p!==void 0?sE:ofe(u!==void 0?u:i==="cyclical"?"rainbow":"turbo"):c?Npe:uu,reverse:v}){if(d=CF(d,i),(i==="cyclical"||i==="sequential")&&(i="linear"),v=!!v,typeof A!="function"&&(A=nWe(A)),A.length===1?(v&&(A=iWe(A),v=!1),p===void 0&&(p=Float64Array.from(a,(b,S)=>S/(a.length-1)),p.length===2&&(p=FZ)),e.interpolate((p===FZ?PP:lfe)(A))):e.interpolate(A),o){const[b,S]=IO(a);(b>0||S<0)&&(a=Ooe(a),oN(a)!==Math.sign(b)?a[a.length-1]=0:a[0]=0)}return v&&(a=wV(a)),e.domain(a).unknown(l),n&&(e.nice($Kt(n,i)),a=e.domain()),p!==void 0&&e.range(p),s&&e.clamp(s),{type:i,domain:a,range:p,scale:e,interpolate:A,interval:d}}function $Kt(t,e){return t===!0?void 0:typeof t=="number"?t:qJt(t,e)}function DKt(t,e,r){return MF(t,Qpe(),e,r)}function LKt(t,e,r){return sWe(t,e,{...r,exponent:.5})}function sWe(t,e,{exponent:r=1,...i}){return MF(t,jje().exponent(r),e,{...i,type:"pow"})}function NKt(t,e,{base:r=10,domain:i=HKt(e),...n}){return MF(t,Bje().base(r),e,{...n,domain:i})}function FKt(t,e,{constant:r=1,...i}){return MF(t,Vje().constant(r),e,i)}function kKt(t,e,{range:r,quantiles:i=r===void 0?5:(r=[...r]).length,n=i,scheme:s="rdylbu",domain:o=qKt(e),unknown:a,interpolate:l,reverse:c}){return r===void 0&&(r=l!==void 0?zm(l,n):da.get(t)===QA?nq(s,n):void 0),o.length>0&&(o=Hje(o,r===void 0?{length:n}:r).quantiles()),afe(t,e,{domain:o,range:r,reverse:c,unknown:a})}function UKt(t,e,{range:r,n:i=r===void 0?5:(r=[...r]).length,scheme:n="rdylbu",domain:s=oWe(t,e),unknown:o,interpolate:a,reverse:l}){const[c,u]=IO(s);let d;return r===void 0?(d=vV(c,u,i),d[0]<=c&&d.splice(0,1),d[d.length-1]>=u&&d.pop(),i=d.length+1,r=a!==void 0?zm(a,i):da.get(t)===QA?nq(n,i):void 0):(d=zm(uu(c,u),i+1).slice(1,-1),c instanceof Date&&(d=d.map(p=>new Date(p)))),oN(WA(s))<0&&d.reverse(),afe(t,e,{domain:d,range:r,reverse:l,unknown:o})}function afe(t,e,{domain:r=[0],unknown:i,scheme:n="rdylbu",interpolate:s,range:o=s!==void 0?zm(s,r.length+1):da.get(t)===QA?nq(n,r.length+1):void 0,reverse:a}){r=WA(r);const l=oN(r);if(!isNaN(l)&&!BKt(r,l))throw new Error(`the ${t} scale has a non-monotonic domain`);return a&&(o=wV(o)),{type:"threshold",scale:qje(l<0?wV(r):r,o===void 0?[]:o).unknown(i),domain:r,range:o}}function BKt(t,e){for(let r=1,i=t.length,n=t[0];r<i;++r){const s=AF(n,n=t[r]);if(s!==0&&s!==e)return!1}return!0}function zKt(){return{type:"identity",scale:Fje()}}function lN(t,e=Nqe){return t.length?[p1(t,({value:r})=>r===void 0?r:p1(r,e)),GA(t,({value:r})=>r===void 0?r:GA(r,e))]:[0,1]}function oWe(t,e){const r=da.get(t);return(r===eq||r===rq||r===tq?VKt:lN)(e)}function VKt(t){return[0,t.length?GA(t,({value:e})=>e===void 0?e:GA(e,Nqe)):1]}function GKt(t,e){const r=t.find(({radius:o})=>o!==void 0);if(r!==void 0)return[0,r.radius];const i=bV(t,.5,({value:o})=>o===void 0?NaN:bV(o,.25,Kpe)),n=e.map(o=>3*Math.sqrt(o/i)),s=30/GA(n);return s<1?n.map(o=>o*s):n}function jKt(t,e){const r=qse(t,({value:s})=>s===void 0?NaN:qse(s,Math.abs)),i=e.map(s=>12*s/r),n=60/GA(i);return n<1?i.map(s=>s*n):i}function HKt(t){for(const{value:e}of t)if(e!==void 0)for(let r of e){if(r>0)return lN(t,Kpe);if(r<0)return lN(t,Fqe)}return[1,10]}function qKt(t){const e=[];for(const{value:r}of t)if(r!==void 0)for(const i of r)e.push(i);return e}function lfe(t){return(e,r)=>i=>t(e+i*(r-e))}function sq(t,e,r,i,{type:n,nice:s,clamp:o,domain:a=lN(i),unknown:l,pivot:c=0,scheme:u,range:d,symmetric:p=!0,interpolate:A=da.get(t)===QA?u==null&&d!==void 0?sE:ofe(u!==void 0?u:"rdbu"):uu,reverse:v}){c=+c;let[b,S]=a;if(AF(b,S)<0&&([b,S]=[S,b],v=!v),b=Math.min(b,c),S=Math.max(S,c),typeof A!="function"&&(A=nWe(A)),d!==void 0&&(A=A.length===1?lfe(A)(...d):kpe(A,d)),v&&(A=iWe(A)),p){const E=r.apply(c),R=E-r.apply(b),O=r.apply(S)-E;R<O?b=r.invert(E-O):R>O&&(S=r.invert(E+R))}return e.domain([b,c,S]).unknown(l).interpolator(A),o&&e.clamp(o),s&&e.nice(s),{type:n,domain:[b,S],pivot:c,interpolate:A,scale:e}}function WKt(t,e,r){return sq(t,lHe(),ZKt,e,r)}function QKt(t,e,r){return aWe(t,e,{...r,exponent:.5})}function aWe(t,e,{exponent:r=1,...i}){return sq(t,hHe().exponent(r=+r),eer(r),e,{...i,type:"diverging-pow"})}function YKt(t,e,{base:r=10,pivot:i=1,domain:n=lN(e,i<0?Fqe:Kpe),...s}){return sq(t,cHe().base(r=+r),JKt,e,{domain:n,pivot:i,...s})}function XKt(t,e,{constant:r=1,...i}){return sq(t,uHe().constant(r=+r),ter(r),e,i)}const ZKt={apply(t){return t},invert(t){return t}},JKt={apply:Math.log,invert:Math.exp},KKt={apply(t){return Math.sign(t)*Math.sqrt(Math.abs(t))},invert(t){return Math.sign(t)*(t*t)}};function eer(t){return t===.5?KKt:{apply(e){return Math.sign(e)*Math.pow(Math.abs(e),t)},invert(e){return Math.sign(e)*Math.pow(Math.abs(e),1/t)}}}function ter(t){return{apply(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))},invert(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}}function lWe(t,e,r,i){return MF(t,e,r,i)}function rer(t,e,r){return lWe(t,iJt(),e,r)}function ier(t,e,r){return lWe(t,nJt(),e,r)}const RF=Symbol("ordinal");function cWe(t,e,r,{type:i,interval:n,domain:s,range:o,reverse:a,hint:l}){return n=CF(n,i),s===void 0&&(s=hWe(r,n,t)),(i==="categorical"||i===RF)&&(i="ordinal"),a&&(s=wV(s)),e.domain(s),o!==void 0&&(typeof o=="function"&&(o=o(s)),e.range(o)),{type:i,domain:s,range:o,scale:e,hint:l,interval:n}}function ner(t,e,{type:r,interval:i,domain:n,range:s,scheme:o,unknown:a,...l}){i=CF(i,r),n===void 0&&(n=hWe(e,i,t));let c;if(da.get(t)===iq)c=aer(e),s=s===void 0?ler(c):Tu(s,nfe);else if(da.get(t)===QA&&(s===void 0&&(r==="ordinal"||r===RF)&&(s=PKt(n,o),s!==void 0&&(o=void 0)),o===void 0&&s===void 0&&(o=r==="ordinal"?"turbo":"tableau10"),o!==void 0))if(s!==void 0){const u=ofe(o),d=s[0],p=s[1]-s[0];s=({length:A})=>zm(v=>u(d+p*v),A)}else s=rWe(o);if(a===Toe)throw new Error(`implicit unknown on ${t} scale is not supported`);return cWe(t,Wpe().unknown(a),e,{...l,type:r,domain:n,range:s,hint:c})}function ser(t,e,{align:r=.5,padding:i=.5,...n}){return uWe(FXt().align(r).padding(i),e,n,t)}function oer(t,e,{align:r=.5,padding:i=.1,paddingInner:n=i,paddingOuter:s=t==="fx"||t==="fy"?0:i,...o}){return uWe(VH().align(r).paddingInner(n).paddingOuter(s),e,o,t)}function uWe(t,e,r,i){let{round:n}=r;return n!==void 0&&t.round(n=!!n),t=cWe(i,t,e,r),t.round=n,t}function hWe(t,e,r){const i=new Cpe;for(const{value:n,domain:s}of t){if(s!==void 0)return s();if(n!==void 0)for(const o of n)i.add(o)}if(e!==void 0){const[n,s]=IO(i).map(e.floor,e);return e.range(n,e.offset(s))}if(i.size>1e4&&da.get(r)===mA)throw new Error(`implicit ordinal domain of ${r} scale has more than 10,000 values`);return AV(i,uE)}function jEe(t,e){let r;for(const{hint:i}of t){const n=i==null?void 0:i[e];if(n!==void 0){if(r===void 0)r=n;else if(r!==n)return}}return r}function aer(t){return{fill:jEe(t,"fill"),stroke:jEe(t,"stroke")}}function ler(t){return ap(t.fill)?SJt:TJt}function Loe(t,{label:e,inset:r=0,insetTop:i=r,insetRight:n=r,insetBottom:s=r,insetLeft:o=r,round:a,nice:l,clamp:c,zero:u,align:d,padding:p,projection:A,facet:{label:v=e}={},...b}={}){const S={};for(const[E,R]of t){const O=b[E],I=der(E,R,{round:da.get(E)===mA?a:void 0,nice:l,clamp:c,zero:u,align:d,padding:p,projection:A,...O});if(I){let{label:N=E==="fx"||E==="fy"?v:e,percent:L,transform:B,inset:U,insetTop:q=U!==void 0?U:E==="y"?i:0,insetRight:Z=U!==void 0?U:E==="x"?n:0,insetBottom:X=U!==void 0?U:E==="y"?s:0,insetLeft:ee=U!==void 0?U:E==="x"?o:0}=O||{};if(B==null)B=void 0;else if(typeof B!="function")throw new Error("invalid scale transform; not a function");I.percent=!!L,I.label=N===void 0?uer(R,I):N,I.transform=B,E==="x"||E==="fx"?(I.insetLeft=+ee,I.insetRight=+Z):(E==="y"||E==="fy")&&(I.insetTop=+q,I.insetBottom=+X),S[E]=I}}return S}function HEe(t){return Object.fromEntries(Object.entries(t).filter(([,{scale:e}])=>e).map(([e,{scale:r,type:i,interval:n,label:s}])=>(r.type=i,n!=null&&(r.interval=n),s!=null&&(r.label=s),[e,r])))}function cer(t,e){const{x:r,y:i,fx:n,fy:s}=t,o=n||s?cfe(e):e;n&&qEe(n,o),s&&WEe(s,o);const a=n||s?dWe(t,e):e;r&&qEe(r,a),i&&WEe(i,a)}function uer(t=[],e){let r;for(const{label:i}of t)if(i!==void 0){if(r===void 0)r=i;else if(r!==i)return}if(r!==void 0&&!(mWe(e)&&/^(date|time|year)$/i.test(r)))return!$E(e)&&e.percent&&(r=`${r} (%)`),{inferred:!0,toString:()=>r}}function cfe(t){const{marginTop:e,marginRight:r,marginBottom:i,marginLeft:n,width:s,height:o,facet:{marginTop:a,marginRight:l,marginBottom:c,marginLeft:u}}=t;return{marginTop:Math.max(e,a),marginRight:Math.max(r,l),marginBottom:Math.max(i,c),marginLeft:Math.max(n,u),width:s,height:o}}function dWe({fx:t,fy:e},r){const{marginTop:i,marginRight:n,marginBottom:s,marginLeft:o,width:a,height:l}=cfe(r);return{marginTop:i,marginRight:n,marginBottom:s,marginLeft:o,width:t?t.scale.bandwidth()+o+n:a,height:e?e.scale.bandwidth()+i+s:l}}function qEe(t,e){if(t.range===void 0){const{insetLeft:r,insetRight:i}=t,{width:n,marginLeft:s=0,marginRight:o=0}=e,a=s+r,l=n-o-i;t.range=[a,Math.max(a,l)],$E(t)||(t.range=fWe(t)),t.scale.range(t.range)}pWe(t)}function WEe(t,e){if(t.range===void 0){const{insetTop:r,insetBottom:i}=t,{height:n,marginTop:s=0,marginBottom:o=0}=e,a=s+r,l=n-o-i;t.range=[Math.max(a,l),a],$E(t)?t.range.reverse():t.range=fWe(t),t.scale.range(t.range)}pWe(t)}function pWe(t){t.round===void 0&&fer(t)&&her(t)<=30&&t.scale.round(!0)}function her({scale:t}){const e=t.domain().length,[r,i]=t.range(),n=t.paddingInner?t.paddingInner():1,s=t.paddingOuter?t.paddingOuter():t.padding(),o=e-n,a=Math.abs(i-r)/Math.max(1,o+s*2);return(a-Math.floor(a))*o}function fWe(t){const e=t.scale.domain().length+gWe(t);if(!(e>2))return t.range;const[r,i]=t.range;return Array.from({length:e},(n,s)=>r+s/(e-1)*(i-r))}function der(t,e=[],r={}){const i=per(t,e,r);if(r.type===void 0&&r.domain===void 0&&r.range===void 0&&r.interval==null&&t!=="fx"&&t!=="fy"&&$E({type:i})){const n=e.map(({value:s})=>s).filter(s=>s!==void 0);n.some(Vm)?dD(`Warning: some data associated with the ${t} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${K3(i)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${t} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${t} scale to "${K3(i)}".`):n.some(YJt)?dD(`Warning: some data associated with the ${t} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${K3(i)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${t} scale to "${K3(i)}".`):n.some(XJt)&&dD(`Warning: some data associated with the ${t} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${K3(i)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${t} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${t} scale to "${K3(i)}".`)}switch(r.type=i,i){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":r=d7(e,r,PEe);break;case"identity":switch(da.get(t)){case mA:r=d7(e,r,PEe);break;case iq:r=d7(e,r,mer);break}break;case"utc":case"time":r=d7(e,r,UJt);break}switch(i){case"diverging":return WKt(t,e,r);case"diverging-sqrt":return QKt(t,e,r);case"diverging-pow":return aWe(t,e,r);case"diverging-log":return YKt(t,e,r);case"diverging-symlog":return XKt(t,e,r);case"categorical":case"ordinal":case RF:return ner(t,e,r);case"cyclical":case"sequential":case"linear":return DKt(t,e,r);case"sqrt":return LKt(t,e,r);case"threshold":return afe(t,e,r);case"quantile":return kKt(t,e,r);case"quantize":return UKt(t,e,r);case"pow":return sWe(t,e,r);case"log":return NKt(t,e,r);case"symlog":return FKt(t,e,r);case"utc":return ier(t,e,r);case"time":return rer(t,e,r);case"point":return ser(t,e,r);case"band":return oer(t,e,r);case"identity":return da.get(t)===mA?zKt():{type:"identity"};case void 0:return;default:throw new Error(`unknown scale type: ${i}`)}}function K3(t){return typeof t=="symbol"?t.description:t}const QEe={toString:()=>"projection"};function per(t,e,{type:r,domain:i,range:n,scheme:s,pivot:o,projection:a}){if(t==="fx"||t==="fy")return"band";(t==="x"||t==="y")&&a!=null&&(r=QEe);for(const{type:u}of e)if(u!==void 0){if(r===void 0)r=u;else if(r!==u)throw new Error(`scale incompatible with channel: ${r} !== ${u}`)}if(r===QEe)return;if(r!==void 0)return r;if(i===void 0&&!e.some(({value:u})=>u!==void 0))return;const l=da.get(t);if(l===eq)return"sqrt";if(l===rq||l===tq)return"linear";if(l===iq)return"ordinal";if((i||n||[]).length>2)return kZ(l);if(i!==void 0)return IEe(i)?kZ(l):Vm(i)?"utc":l===QA&&(o!=null||VEe(s))?"diverging":"linear";const c=e.map(({value:u})=>u).filter(u=>u!==void 0);return c.some(IEe)?kZ(l):c.some(Vm)?"utc":l===QA&&(o!=null||VEe(s))?"diverging":"linear"}function kZ(t){switch(t){case mA:return"point";case QA:return RF;default:return"ordinal"}}function mWe({type:t}){return t==="time"||t==="utc"}function $E({type:t}){return t==="ordinal"||t==="point"||t==="band"||t===RF}function gWe({type:t}){return t==="threshold"}function fer({type:t}){return t==="point"||t==="band"}function VO(t){if(t===void 0)return!0;const e=t.domain(),r=t(e[0]);for(let i=1,n=e.length;i<n;++i)if(t(e[i])-r)return!1;return!0}function d7(t,{domain:e,...r},i){for(const n of t)n.value!==void 0&&(n.value=i(n.value));return{domain:e===void 0?e:i(e),...r}}function mer(t){return Tu(t,nfe)}function ger(t){return e=>{if(!da.has(e=`${e}`))throw new Error(`unknown scale: ${e}`);return e in t?Aer(t[e]):void 0}}function Aer({scale:t,type:e,domain:r,range:i,interpolate:n,interval:s,transform:o,percent:a,pivot:l}){if(e==="identity")return{type:"identity",apply:u=>u,invert:u=>u};const c=t.unknown?t.unknown():void 0;return{type:e,domain:Ooe(r),...i!==void 0&&{range:Ooe(i)},...o!==void 0&&{transform:o},...a&&{percent:a},...c!==void 0&&{unknown:c},...s!==void 0&&{interval:s},...n!==void 0&&{interpolate:n},...t.clamp&&{clamp:t.clamp()},...l!==void 0&&{pivot:l,symmetric:!1},...t.base&&{base:t.base()},...t.exponent&&{exponent:t.exponent()},...t.constant&&{constant:t.constant()},...t.align&&{align:t.align(),round:t.round()},...t.padding&&(t.paddingInner?{paddingInner:t.paddingInner(),paddingOuter:t.paddingOuter()}:{padding:t.padding()}),...t.bandwidth&&{bandwidth:t.bandwidth(),step:t.step()},apply:u=>t(u),...t.invert&&{invert:u=>t.invert(u)}}}function yer(t){let e,r;return(...i)=>(((r==null?void 0:r.length)!==i.length||r.some((n,s)=>n!==i[s]))&&(r=i,e=t(...i)),e)}const _er=yer(t=>new Intl.NumberFormat(t));function ver(t="en-US"){const e=_er(t);return r=>r!=null&&!isNaN(r)?e.format(r):void 0}function AWe(t){return EJt(t,"Invalid Date")}function ber(t="en-US"){const e=ver(t);return r=>(r instanceof Date?AWe:typeof r=="number"?e:_m)(r)}const ufe=ber(),dp=(typeof window<"u"?window.devicePixelRatio>1:typeof it>"u")?0:.5;let wer=0;function YEe(){return`plot-clip-${++wer}`}function xer(t,{title:e,href:r,ariaLabel:i,ariaDescription:n,ariaHidden:s,target:o,fill:a,fillOpacity:l,stroke:c,strokeWidth:u,strokeOpacity:d,strokeLinejoin:p,strokeLinecap:A,strokeMiterlimit:v,strokeDasharray:b,strokeDashoffset:S,opacity:E,mixBlendMode:R,paintOrder:O,pointerEvents:I,shapeRendering:N},{ariaLabel:L,fill:B="currentColor",fillOpacity:U,stroke:q="none",strokeOpacity:Z,strokeWidth:X,strokeLinecap:ee,strokeLinejoin:se,strokeMiterlimit:ue,paintOrder:re}){B===null&&(a=null,l=null),q===null&&(c=null,d=null),ap(B)?!ap(q)&&!ap(a)&&(q="none"):ap(q)&&!ap(c)&&(B="none");const[te,j]=hE(a,B),[H,W]=hp(l,U),[oe,le]=hE(c,q),[fe,de]=hp(d,Z),[Ee,Ie]=hp(E);sN(le)||(u===void 0&&(u=X),A===void 0&&(A=ee),p===void 0&&(p=se),v===void 0&&!KJt(p)&&(v=ue),!sN(j)&&O===void 0&&(O=re));const[Ge,Ke]=hp(u);return B!==null&&(t.fill=eh(j,"currentColor"),t.fillOpacity=A$(W,1)),q!==null&&(t.stroke=eh(le,"none"),t.strokeWidth=A$(Ke,1),t.strokeOpacity=A$(de,1),t.strokeLinejoin=eh(p,"miter"),t.strokeLinecap=eh(A,"butt"),t.strokeMiterlimit=A$(v,4),t.strokeDasharray=eh(b,"none"),t.strokeDashoffset=eh(S,"0")),t.target=_m(o),t.ariaLabel=_m(L),t.ariaDescription=_m(n),t.ariaHidden=_m(s),t.opacity=A$(Ie,1),t.mixBlendMode=eh(R,"normal"),t.paintOrder=eh(O,"normal"),t.pointerEvents=eh(I,"auto"),t.shapeRendering=eh(N,"auto"),{title:{value:e,optional:!0},href:{value:r,optional:!0},ariaLabel:{value:i,optional:!0},fill:{value:te,scale:"auto",optional:!0},fillOpacity:{value:H,scale:"auto",optional:!0},stroke:{value:oe,scale:"auto",optional:!0},strokeOpacity:{value:fe,scale:"auto",optional:!0},strokeWidth:{value:Ge,optional:!0},opacity:{value:Ee,scale:"auto",optional:!0}}}function Ter(t,e){e&&t.filter(r=>Lqe(e[r])).append("title").call(Ser,e)}function Ser(t,e){e&&t.text(r=>ufe(e[r]))}function OF(t,{target:e},{ariaLabel:r,title:i,fill:n,fillOpacity:s,stroke:o,strokeOpacity:a,strokeWidth:l,opacity:c,href:u}){r&&$n(t,"aria-label",d=>r[d]),n&&$n(t,"fill",d=>n[d]),s&&$n(t,"fill-opacity",d=>s[d]),o&&$n(t,"stroke",d=>o[d]),a&&$n(t,"stroke-opacity",d=>a[d]),l&&$n(t,"stroke-width",d=>l[d]),c&&$n(t,"opacity",d=>c[d]),u&&Mer(t,d=>u[d],e),Ter(t,i)}function Eer(t){return t===!0?t="frame":t===!1&&(t=null),Vqe(t,"clip",["frame","sphere"])}function Cer(t,e,r,i){let n;switch(e.clip){case"frame":{const{width:s,height:o,marginLeft:a,marginRight:l,marginTop:c,marginBottom:u}=r,d=YEe();n=`url(#${d})`,t=cy("svg:g",i).call(p=>p.append("svg:clipPath").attr("id",d).append("rect").attr("x",a).attr("y",c).attr("width",s-l-a).attr("height",o-c-u)).each(function(){this.appendChild(t.node()),t.node=()=>this});break}case"sphere":{const{projection:s}=i;if(!s)throw new Error('the "sphere" clip option requires a projection');const o=YEe();n=`url(#${o})`,t.append("clipPath").attr("id",o).append("path").attr("d",vje(s)({type:"Sphere"}));break}}$n(t,"aria-label",e.ariaLabel),$n(t,"aria-description",e.ariaDescription),$n(t,"aria-hidden",e.ariaHidden),$n(t,"clip-path",n)}function IP(t,e,r,i){Cer(t,e,r,i),$n(t,"fill",e.fill),$n(t,"fill-opacity",e.fillOpacity),$n(t,"stroke",e.stroke),$n(t,"stroke-width",e.strokeWidth),$n(t,"stroke-opacity",e.strokeOpacity),$n(t,"stroke-linejoin",e.strokeLinejoin),$n(t,"stroke-linecap",e.strokeLinecap),$n(t,"stroke-miterlimit",e.strokeMiterlimit),$n(t,"stroke-dasharray",e.strokeDasharray),$n(t,"stroke-dashoffset",e.strokeDashoffset),$n(t,"shape-rendering",e.shapeRendering),$n(t,"paint-order",e.paintOrder),$n(t,"pointer-events",e.pointerEvents)}function $P(t,e){Rer(t,"mix-blend-mode",e.mixBlendMode),$n(t,"opacity",e.opacity)}function Mer(t,e,r){t.each(function(i){const n=e(i);if(n!=null){const s=this.ownerDocument.createElementNS($O.svg,"a");s.setAttribute("fill","inherit"),s.setAttributeNS($O.xlink,"href",n),r!=null&&s.setAttribute("target",r),this.parentNode.insertBefore(s,this).appendChild(this)}})}function $n(t,e,r){r!=null&&t.attr(e,r)}function Rer(t,e,r){r!=null&&t.style(e,r)}function DP(t,e,{x:r,y:i},n=dp,s=dp){n+=e.dx,s+=e.dy,r!=null&&r.bandwidth&&(n+=r.bandwidth()/2),i!=null&&i.bandwidth&&(s+=i.bandwidth()/2),(n||s)&&t.attr("transform",`translate(${n},${s})`)}function eh(t,e){if((t=_m(t))!==e)return t}function A$(t,e){if((t=Ma(t))!==e)return t}const Oer=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function hfe(t){if(t===void 0)return"plot-d6a7b5";if(t=`${t}`,!Oer.test(t))throw new Error(`invalid class name: ${t}`);return t}function dfe(t,e){if(typeof e=="string")t.property("style",e);else if(e!=null)for(const r of t)Object.assign(r.style,e)}function yWe({frameAnchor:t},{width:e,height:r,marginTop:i,marginRight:n,marginBottom:s,marginLeft:o}){return[/left$/.test(t)?o:/right$/.test(t)?e-n:(o+e-n)/2,/^top/.test(t)?i:/^bottom/.test(t)?r-s:(i+r-s)/2]}function Per(t,e,r={}){let i=.5-dp,n=.5+dp,s=.5+dp,o=.5-dp;for(const{marginTop:b,marginRight:S,marginBottom:E,marginLeft:R}of e)b>i&&(i=b),S>n&&(n=S),E>s&&(s=E),R>o&&(o=R);let{margin:a,marginTop:l=a!==void 0?a:i,marginRight:c=a!==void 0?a:n,marginBottom:u=a!==void 0?a:s,marginLeft:d=a!==void 0?a:o}=r;l=+l,c=+c,u=+u,d=+d;let{width:p=640,height:A=Ier(t,e,r,{width:p,marginTopDefault:i,marginRightDefault:n,marginBottomDefault:s,marginLeftDefault:o})+Math.max(0,l-i+u-s)}=r;p=+p,A=+A;const v={width:p,height:A,marginTop:l,marginRight:c,marginBottom:u,marginLeft:d};if(t.fx||t.fy){let{margin:b,marginTop:S=b!==void 0?b:l,marginRight:E=b!==void 0?b:c,marginBottom:R=b!==void 0?b:u,marginLeft:O=b!==void 0?b:d}=r.facet??{};S=+S,E=+E,R=+R,O=+O,v.facet={marginTop:S,marginRight:E,marginBottom:R,marginLeft:O}}return v}function Ier({x:t,y:e,fy:r,fx:i},n,{projection:s,aspectRatio:o},{width:a,marginTopDefault:l,marginRightDefault:c,marginBottomDefault:u,marginLeftDefault:d}){const p=r?r.scale.domain().length:1,A=RKt(s,n);if(A){const b=i?i.scale.domain().length:1,S=(1.1*p-.1)/(1.1*b-.1)*A,E=Math.max(.1,Math.min(10,S));return Math.round((a-d-c)*E+l+u)}const v=e?$E(e)?e.scale.domain().length:Math.max(7,17/p):1;if(o!=null){if(o=+o,!(isFinite(o)&&o>0))throw new Error(`invalid aspectRatio: ${o}`);const b=XEe("y",e)/(XEe("x",t)*o),S=i?i.scale.bandwidth():1,E=r?r.scale.bandwidth():1,R=S*(a-d-c)-t.insetLeft-t.insetRight;return(b*R+e.insetTop+e.insetBottom)/E+l+u}return!!(e||r)*Math.max(1,Math.min(60,v*p))*20+!!i*30+60}function XEe(t,e){if(!e)throw new Error(`aspectRatio requires ${t} scale`);const{type:r,domain:i}=e;let n;switch(r){case"linear":case"utc":case"time":n=Number;break;case"pow":{const a=e.scale.exponent();n=l=>Math.pow(l,a);break}case"log":n=Math.log;break;case"point":case"band":return i.length;default:throw new Error(`unsupported ${t} scale for aspectRatio: ${r}`)}const[s,o]=IO(i);return Math.abs(n(o)-n(s))}function $er(t,e){const{fx:r,fy:i}=Loe(t,e),n=r==null?void 0:r.scale.domain(),s=i==null?void 0:i.scale.domain();return n&&s?NHt(n,s).map(([o,a],l)=>({x:o,y:a,i:l})):n?n.map((o,a)=>({x:o,i:a})):s?s.map((o,a)=>({y:o,i:a})):void 0}function Der(t,{x:e,y:r}){return e&&(e=new q2(e.map((i,n)=>[i,n]))),r&&(r=new q2(r.map((i,n)=>[i,n]))),t.filter(e&&r?i=>e.has(i.x)&&r.has(i.y):e?i=>e.has(i.x):i=>r.has(i.y)).sort(e&&r?(i,n)=>e.get(i.x)-e.get(n.x)||r.get(i.y)-r.get(n.y):e?(i,n)=>e.get(i.x)-e.get(n.x):(i,n)=>r.get(i.y)-r.get(n.y))}function pfe(t,{fx:e,fy:r}){const i=fw(t),n=e==null?void 0:e.value,s=r==null?void 0:r.value;return e&&r?wR(i,o=>(o.fx=n[o[0]],o.fy=s[o[0]],o),o=>n[o],o=>s[o]):e?wR(i,o=>(o.fx=n[o[0]],o),o=>n[o]):wR(i,o=>(o.fy=s[o[0]],o),o=>s[o])}function Ler(t,e,{marginTop:r,marginLeft:i}){return t&&e?({x:n,y:s})=>`translate(${t(n)-i},${e(s)-r})`:t?({x:n})=>`translate(${t(n)-i},0)`:({y:n})=>`translate(0,${e(n)-r})`}function Ner(t){const e=[],r=new Uint32Array(iE(t,i=>i.length));for(const i of t){let n=0;for(const s of t)i!==s&&(r.set(s,n),n+=s.length);e.push(r.slice(0,n))}return e}const Fer=new Map([["top",UZ],["right",VZ],["bottom",BZ],["left",zZ],["top-left",p7(UZ,zZ)],["top-right",p7(UZ,VZ)],["bottom-left",p7(BZ,zZ)],["bottom-right",p7(BZ,VZ)],["top-empty",Uer],["right-empty",Ver],["bottom-empty",Ber],["left-empty",zer],["empty",Ger]]);function ker(t){if(t==null)return null;const e=Fer.get(`${t}`.toLowerCase());if(e)return e;throw new Error(`invalid facet anchor: ${t}`)}function UZ(t,{y:e},{y:r}){return e?e.indexOf(r)===0:!0}function BZ(t,{y:e},{y:r}){return e?e.indexOf(r)===e.length-1:!0}function zZ(t,{x:e},{x:r}){return e?e.indexOf(r)===0:!0}function VZ(t,{x:e},{x:r}){return e?e.indexOf(r)===e.length-1:!0}function Uer(t,{y:e},{x:r,y:i,empty:n}){var o;if(n)return!1;const s=e==null?void 0:e.indexOf(i);if(s>0){const a=e[s-1];return(o=t.find(l=>l.x===r&&l.y===a))==null?void 0:o.empty}}function Ber(t,{y:e},{x:r,y:i,empty:n}){var o;if(n)return!1;const s=e==null?void 0:e.indexOf(i);if(s<(e==null?void 0:e.length)-1){const a=e[s+1];return(o=t.find(l=>l.x===r&&l.y===a))==null?void 0:o.empty}}function zer(t,{x:e},{x:r,y:i,empty:n}){var o;if(n)return!1;const s=e==null?void 0:e.indexOf(r);if(s>0){const a=e[s-1];return(o=t.find(l=>l.x===a&&l.y===i))==null?void 0:o.empty}}function Ver(t,{x:e},{x:r,y:i,empty:n}){var o;if(n)return!1;const s=e==null?void 0:e.indexOf(r);if(s<(e==null?void 0:e.length)-1){const a=e[s+1];return(o=t.find(l=>l.x===a&&l.y===i))==null?void 0:o.empty}}function Ger(t,e,{empty:r}){return r}function p7(t,e){return function(){return t.apply(null,arguments)&&e.apply(null,arguments)}}function GZ(t,{channels:{fx:e,fy:r},groups:i}){return e&&r?t.map(({x:n,y:s})=>{var o;return((o=i.get(n))==null?void 0:o.get(s))??[]}):e?t.map(({x:n})=>i.get(n)??[]):t.map(({y:n})=>i.get(n)??[])}function _We(t){return $E(t)&&t.interval===void 0?void 0:"tabular-nums"}function jer(t,e){return t===void 0?Vm(e)?AWe:_m:typeof t=="function"?t:(typeof t=="string"?Vm(e)?QH:MP:PP)(t)}function Her(t,e){let{label:r=t.label,tickSize:i=6,width:n=240,height:s=44+i,marginTop:o=18,marginRight:a=0,marginBottom:l=16+i,marginLeft:c=0,style:u,ticks:d=(n-c-a)/64,tickFormat:p,fontVariant:A=_We(t),round:v=!0,opacity:b,className:S}=e;const E=sfe(e);S=hfe(S),b=hp(b)[1],p===null&&(p=()=>null);const R=cy("svg",E).attr("class",`${S}-ramp`).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",n).attr("height",s).attr("viewBox",`0 0 ${n} ${s}`).call(ee=>ee.append("style").text(`.${S}-ramp {
  display: block;
  background: white;
  height: auto;
  height: intrinsic;
  max-width: 100%;
  overflow: visible;
}
.${S}-ramp text {
  white-space: pre;
}`)).call(dfe,u);let O=ee=>ee.selectAll(".tick line").attr("y1",o+l-s),I;const N=v?(ee,se)=>ee.rangeRound(se):(ee,se)=>ee.range(se),{type:L,domain:B,range:U,interpolate:q,scale:Z,pivot:X}=t;if(q){const ee=U===void 0?q:kpe(q.length===1?lfe(q):q,U);I=N(Z.copy(),zm(uu(c,n-a),Math.min(B.length+(X!==void 0),U===void 0?1/0:U.length)));const se=256,ue=E.document.createElement("canvas");ue.width=se,ue.height=1;const re=ue.getContext("2d");for(let te=0,j=se-1;te<se;++te)re.fillStyle=ee(te/j),re.fillRect(te,0,1,1);R.append("image").attr("opacity",b).attr("x",c).attr("y",o).attr("width",n-c-a).attr("height",s-o-l).attr("preserveAspectRatio","none").attr("xlink:href",ue.toDataURL())}else if(L==="threshold"){const ee=B,se=p===void 0?ue=>ue:typeof p=="string"?MP(p):p;I=N(Qpe().domain([-1,U.length-1]),[c,n-a]),R.append("g").attr("fill-opacity",b).selectAll().data(U).enter().append("rect").attr("x",(ue,re)=>I(re-1)).attr("y",o).attr("width",(ue,re)=>I(re)-I(re-1)).attr("height",s-o-l).attr("fill",ue=>ue),d=Tu(ee,(ue,re)=>re),p=ue=>se(ee[ue],ue)}else I=N(VH().domain(B),[c,n-a]),R.append("g").attr("fill-opacity",b).selectAll().data(B).enter().append("rect").attr("x",I).attr("y",o).attr("width",Math.max(0,I.bandwidth()-1)).attr("height",s-o-l).attr("fill",Z),O=()=>{};return R.append("g").attr("transform",`translate(0,${s-l})`).call(rqt(I).ticks(Array.isArray(d)?null:d,typeof p=="string"?p:void 0).tickFormat(typeof p=="function"?p:void 0).tickSize(i).tickValues(Array.isArray(d)?d:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",eh(A,"normal")).call(O).call(ee=>ee.select(".domain").remove()),r!==void 0&&R.append("text").attr("x",c).attr("y",o-6).attr("fill","currentColor").attr("font-weight","bold").text(r),R.node()}function ZEe(t,e){if(e==null)return e;const r=t(e);if(!r)throw new Error(`scale not found: ${e}`);return r}function qer(t,{opacity:e,...r}={}){if(!$E(t)&&!gWe(t))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${t.type})`);return vWe(t,r,(i,n,s,o)=>i.append("svg").attr("width",s).attr("height",o).attr("fill",n.scale).attr("fill-opacity",hp(e)[1]).append("rect").attr("width","100%").attr("height","100%"))}function Wer(t,{fill:e=(c=>(c=t.hint)==null?void 0:c.fill)()!==void 0?t.hint.fill:"none",fillOpacity:r=1,stroke:i=(u=>(u=t.hint)==null?void 0:u.stroke)()!==void 0?t.hint.stroke:ap(e)?"currentColor":"none",strokeOpacity:n=1,strokeWidth:s=1.5,r:o=4.5,...a}={},l){const[d,p]=hE(e),[A,v]=hE(i),b=ZEe(l,d),S=ZEe(l,A),E=o*o*Math.PI;return r=hp(r)[1],n=hp(n)[1],s=hp(s)[1],vWe(t,a,(R,O,I,N)=>R.append("svg").attr("viewBox","-8 -8 16 16").attr("width",I).attr("height",N).attr("fill",d==="color"?L=>b.scale(L):p).attr("fill-opacity",r).attr("stroke",A==="color"?L=>S.scale(L):v).attr("stroke-opacity",n).attr("stroke-width",s).append("path").attr("d",L=>{const B=aoe();return t.scale(L).draw(B,E),B}))}function vWe(t,e={},r){let{columns:i,tickFormat:n,fontVariant:s=_We(t),swatchSize:o=15,swatchWidth:a=o,swatchHeight:l=o,marginLeft:c=0,className:u,style:d,width:p}=e;const A=sfe(e);u=hfe(u),n=jer(n,t.domain);const v=cy("div",A).attr("class",`${u}-swatches ${u}-swatches-${i!=null?"columns":"wrap"}`);let b;return i!=null?(b=`.${u}-swatches-columns .${u}-swatch {
  display: flex;
  align-items: center;
  break-inside: avoid;
  padding-bottom: 1px;
}
.${u}-swatches-columns .${u}-swatch::before {
  flex-shrink: 0;
}
.${u}-swatches-columns .${u}-swatch-label {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}`,v.style("columns",i).selectAll().data(t.domain).enter().append("div").attr("class",`${u}-swatch`).call(r,t,a,l).call(S=>S.append("div").attr("class",`${u}-swatch-label`).attr("title",n).text(n))):(b=`.${u}-swatches-wrap {
  display: flex;
  align-items: center;
  min-height: 33px;
  flex-wrap: wrap;
}
.${u}-swatches-wrap .${u}-swatch {
  display: inline-flex;
  align-items: center;
  margin-right: 1em;
}`,v.selectAll().data(t.domain).enter().append("span").attr("class",`${u}-swatch`).call(r,t,a,l).append(function(){return this.ownerDocument.createTextNode(n.apply(this,arguments))})),v.call(S=>S.insert("style","*").text(`.${u}-swatches {
  font-family: system-ui, sans-serif;
  font-size: 10px;
  margin-bottom: 0.5em;
}
.${u}-swatch > svg {
  margin-right: 0.5em;
  overflow: visible;
}
${b}`)).style("margin-left",c?`${+c}px`:null).style("width",p===void 0?null:`${+p}px`).style("font-variant",eh(s,"normal")).call(dfe,d).node()}const Noe=new Map([["symbol",Wer],["color",wWe],["opacity",Yer]]);function Qer(t,e,r={}){return(i,n)=>{if(!Noe.has(i))throw new Error(`unknown legend type: ${i}`);if(i in t)return Noe.get(i)(t[i],bWe(e,r[i],n),s=>t[s])}}function bWe({className:t,...e},{label:r,ticks:i,tickFormat:n}={},s){return eKt(s,{className:t,...e},{label:r,ticks:i,tickFormat:n})}function wWe(t,{legend:e=!0,...r}){if(e===!0&&(e=t.type==="ordinal"?"swatches":"ramp"),t.domain!==void 0)switch(`${e}`.toLowerCase()){case"swatches":return qer(t,r);case"ramp":return Her(t,r);default:throw new Error(`unknown legend type: ${e}`)}}function Yer({type:t,interpolate:e,...r},{legend:i=!0,color:n=Q2(0,0,0),...s}){if(!e)throw new Error(`${t} opacity scales are not supported`);if(i===!0&&(i="ramp"),`${i}`.toLowerCase()!=="ramp")throw new Error(`${i} opacity legends are not supported`);return wWe({type:t,...r,interpolate:Xer(n)},{legend:i,...s})}function Xer(t){const{r:e,g:r,b:i}=Q2(t)||Q2(0,0,0);return n=>`rgba(${e},${r},${i},${n})`}function Zer(t,e,r){const i=[];for(const[n,s]of Noe){const o=r[n];if(o!=null&&o.legend&&n in t){const a=s(t[n],bWe(e,t[n],o),l=>t[l]);a!=null&&i.push(a)}}return i}class F1{constructor(e,r={},i={},n){const{facet:s="auto",facetAnchor:o,fx:a,fy:l,sort:c,dx:u=0,dy:d=0,margin:p=0,marginTop:A=p,marginRight:v=p,marginBottom:b=p,marginLeft:S=p,clip:E,channels:R}=i;if(this.data=e,this.sort=nN(c)?c:null,this.initializer=Qqe(i).initializer,this.transform=this.initializer?i.transform:Wqe(i).transform,s===null||s===!1?this.facet=null:(this.facet=N1(s===!0?"include":s,"facet",["auto","include","exclude","super"]),this.fx=a,this.fy=l),this.facetAnchor=ker(o),r=$Ee(r),R!==void 0&&(r={...$Ee(R),...r}),n!==void 0&&(r={...xer(this,i,n),...r}),this.channels=Object.fromEntries(Object.entries(r).map(([O,I])=>{const{value:N}=I;return tfe(N)&&(I={...I,value:N.value},N.scale!==void 0&&(I.scale=N.scale)),[O,I]}).filter(([O,{value:I,optional:N}])=>{if(I!=null)return!0;if(N)return!1;throw new Error(`missing channel value: ${O}`)})),this.dx=+u,this.dy=+d,this.marginTop=+A,this.marginRight=+v,this.marginBottom=+b,this.marginLeft=+S,this.clip=Eer(E),this.facet==="super"){if(a||l)throw new Error("super-faceting cannot use fx or fy");for(const O in this.channels){const{scale:I}=r[O];if(!(I!=="x"&&I!=="y"))throw new Error("super-faceting cannot use x or y")}}}initialize(e,r){let i=WA(this.data);e===void 0&&i!=null&&(e=[fw(i)]);const n=e;this.transform!=null&&({facets:e,data:i}=this.transform(i,e),i=WA(i)),e!==void 0&&(e.original=n);const s=AKt(this.channels,i);return this.sort!=null&&_Kt(i,e,s,r,this.sort),{data:i,facets:e,channels:s}}filter(e,r,i){for(const n in r){const{filter:s=rN}=r[n];if(s!==null){const o=i[n];e=e.filter(a=>s(o[a]))}}return e}project(e,r,i){NZ("x","y",e,r,i),NZ("x1","y1",e,r,i),NZ("x2","y2",e,r,i)}scale(e,r,i){const n=yKt(e,r);return i.projection&&this.project(e,n,i),n}}function xWe(...t){return t.plot=F1.prototype.plot,t}const TWe=Math.PI/180;function SWe({inset:t,insetLeft:e,insetRight:r,...i}={}){return[e,r]=CWe(t,e,r),{inset:t,insetLeft:e,insetRight:r,...i}}function EWe({inset:t,insetTop:e,insetBottom:r,...i}={}){return[e,r]=CWe(t,e,r),{inset:t,insetTop:e,insetBottom:r,...i}}function CWe(t,e,r){return t===void 0&&e===void 0&&r===void 0?dp?[1,0]:[.5,.5]:[e,r]}function MWe(t,{interval:e}){return t={...ife(t)},t.interval=rfe(t.interval===void 0?e:t.interval),t}function RWe(t,e,r,i){const{[t]:n,[`${t}1`]:s,[`${t}2`]:o}=r,{value:a,interval:l}=MWe(n,r);if(a==null||l==null&&!i)return r;const c=EF(n);if(l==null){let A;const v={transform:b=>A||(A=Bf(b,a)),label:c};return{...r,[t]:void 0,[`${t}1`]:s===void 0?v:s,[`${t}2`]:o===void 0?v:o}}let u,d;function p(A){return d!==void 0&&A===u?d:d=Tu(Bf(u=A,a),v=>l.floor(v))}return e({...r,[t]:void 0,[`${t}1`]:s===void 0?{transform:p,label:c}:s,[`${t}2`]:o===void 0?{transform:A=>p(A).map(v=>l.offset(v)),label:c}:o})}function OWe(t,e,r){const{[t]:i}=r,{value:n,interval:s}=MWe(i,r);return n==null||s==null?r:e({...r,[t]:{label:EF(i),transform:o=>{const a=Tu(Bf(o,n),c=>s.floor(c)),l=a.map(c=>s.offset(c));return a.map(Vm(a)?(c,u)=>c==null||isNaN(c=+c)||(u=l[u],u==null)||isNaN(u=+u)?void 0:new Date((c+u)/2):(c,u)=>c==null||(u=l[u],u==null)?NaN:(+c+ +u)/2)}}})}function Jer(t={}){return RWe("x",SWe,t)}function PWe(t={}){return RWe("y",EWe,t)}function Ker(t={}){return OWe("x",SWe,t)}function etr(t={}){return OWe("y",EWe,t)}const IWe={ariaLabel:"rule",fill:null,stroke:"currentColor"};class ttr extends F1{constructor(e,r={}){const{x:i,y1:n,y2:s,inset:o=0,insetTop:a=o,insetBottom:l=o}=r;super(e,{x:{value:i,scale:"x",optional:!0},y1:{value:n,scale:"y",optional:!0},y2:{value:s,scale:"y",optional:!0}},r,IWe),this.insetTop=Ma(a),this.insetBottom=Ma(l)}render(e,r,i,n,s){const{x:o,y:a}=r,{x:l,y1:c,y2:u}=i,{width:d,height:p,marginTop:A,marginRight:v,marginLeft:b,marginBottom:S}=n,{insetTop:E,insetBottom:R}=this;return cy("svg:g",s).call(IP,this,n).call(DP,this,{x:l&&o},dp,0).call(O=>O.selectAll().data(e).enter().append("line").call($P,this).attr("x1",l?I=>l[I]:(b+d-v)/2).attr("x2",l?I=>l[I]:(b+d-v)/2).attr("y1",c&&!VO(a)?I=>c[I]+E:A+E).attr("y2",u&&!VO(a)?a.bandwidth?I=>u[I]+a.bandwidth()-R:I=>u[I]-R:p-S-R).call(OF,this,i)).node()}}class rtr extends F1{constructor(e,r={}){const{x1:i,x2:n,y:s,inset:o=0,insetRight:a=o,insetLeft:l=o}=r;super(e,{y:{value:s,scale:"y",optional:!0},x1:{value:i,scale:"x",optional:!0},x2:{value:n,scale:"x",optional:!0}},r,IWe),this.insetRight=Ma(a),this.insetLeft=Ma(l)}render(e,r,i,n,s){const{x:o,y:a}=r,{y:l,x1:c,x2:u}=i,{width:d,height:p,marginTop:A,marginRight:v,marginLeft:b,marginBottom:S}=n,{insetLeft:E,insetRight:R}=this;return cy("svg:g",s).call(IP,this,n,s).call(DP,this,{y:l&&a},0,dp).call(O=>O.selectAll().data(e).enter().append("line").call($P,this).attr("x1",c&&!VO(o)?I=>c[I]+E:b+E).attr("x2",u&&!VO(o)?o.bandwidth?I=>u[I]+o.bandwidth()-R:I=>u[I]-R:d-v-R).attr("y1",l?I=>l[I]:(A+p-S)/2).attr("y2",l?I=>l[I]:(A+p-S)/2).call(OF,this,i)).node()}}function itr(t,e){let{x:r=Ym,y:i,y1:n,y2:s,...o}=PWe(e);return[n,s]=DWe(i,n,s),new ttr(t,{...o,x:r,y1:n,y2:s})}function $We(t,e){let{y:r=Ym,x:i,x1:n,x2:s,...o}=Jer(e);return[n,s]=DWe(i,n,s),new rtr(t,{...o,y:r,x1:n,x2:s})}function DWe(t,e,r){if(t===void 0){if(e===void 0){if(r!==void 0)return[0,r]}else if(r===void 0)return[0,e]}else{if(e===void 0)return r===void 0?[0,t]:[t,r];if(r===void 0)return[t,e]}return[e,r]}function LWe(t,...e){let r=e.length;for(let i=0,n=!0;i<r;++i)typeof e[i]!="function"&&(n&&(t=t.slice(),n=!1),t.splice(i,2,t[i]+e[i]+t[i+1]),e.splice(i,1),--i,--r);return i=>{let n=t[0];for(let s=0;s<r;++s)n+=e[s](i)+t[s+1];return n}}const ntr={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"},NWe="";class ffe extends F1{constructor(e,r={}){const{x:i,y:n,text:s=IE(e)&&QJt(e)?Ym:Bqe,frameAnchor:o,textAnchor:a=/right$/i.test(o)?"end":/left$/i.test(o)?"start":"middle",lineAnchor:l=/^top/i.test(o)?"top":/^bottom/i.test(o)?"bottom":"middle",lineHeight:c=1,lineWidth:u=1/0,textOverflow:d,monospace:p,fontFamily:A=p?"ui-monospace, monospace":void 0,fontSize:v,fontStyle:b,fontVariant:S,fontWeight:E,rotate:R}=r,[O,I]=hp(R,0),[N,L]=dtr(v);if(super(e,{x:{value:i,scale:"x",optional:!0},y:{value:n,scale:"y",optional:!0},fontSize:{value:N,optional:!0},rotate:{value:WJt(O),optional:!0},text:{value:s,filter:Lqe,optional:!0}},r,ntr),this.rotate=I,this.textAnchor=eh(a,"middle"),this.lineAnchor=N1(l,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+c,this.lineWidth=+u,this.textOverflow=str(d),this.monospace=!!p,this.fontFamily=_m(A),this.fontSize=L,this.fontStyle=_m(b),this.fontVariant=_m(S),this.fontWeight=_m(E),this.frameAnchor=jqe(o),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${u}`);this.splitLines=mtr(this),this.clipLine=gtr(this)}render(e,r,i,n,s){const{x:o,y:a}=r,{x:l,y:c,rotate:u,text:d,title:p,fontSize:A}=i,{rotate:v}=this,[b,S]=yWe(this,n);return cy("svg:g",s).call(IP,this,n,s).call(ctr,this,d,n).call(DP,this,{x:l&&o,y:c&&a}).call(E=>E.selectAll().data(e).enter().append("text").call($P,this).call(otr,this,d,p).attr("transform",LWe`translate(${l?R=>l[R]:b},${c?R=>c[R]:S})${u?R=>` rotate(${u[R]})`:v?` rotate(${v})`:""}`).call($n,"font-size",A&&(R=>A[R])).call(OF,this,i)).node()}}function str(t){return t==null?null:N1(t,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}function otr(t,e,r,i){if(!r)return;const{lineAnchor:n,lineHeight:s,textOverflow:o,splitLines:a,clipLine:l}=e;t.each(function(c){const u=a(ufe(r[c])??"").map(l),d=u.length,p=n==="top"?.71:n==="bottom"?1-d:(164-d*100)/200;if(d>1)for(let A=0;A<d;++A){if(!u[A])continue;const v=this.ownerDocument.createElementNS($O.svg,"tspan");v.setAttribute("x",0),v.setAttribute("y",`${(p+A)*s}em`),v.textContent=u[A],this.appendChild(v)}else p&&this.setAttribute("y",`${p*s}em`),this.textContent=u[0];if(o&&!i&&u[0]!==r[c]){const A=this.ownerDocument.createElementNS($O.svg,"title");A.textContent=r[c],this.appendChild(A)}})}function FWe(t,e={}){let{x:r,y:i,...n}=e;return e.frameAnchor===void 0&&([r,i]=VJt(r,i)),new ffe(t,{...n,x:r,y:i})}function atr(t,e={}){const{x:r=Ym,...i}=e;return new ffe(t,etr({...i,x:r}))}function ltr(t,e={}){const{y:r=Ym,...i}=e;return new ffe(t,Ker({...i,y:r}))}function ctr(t,e,r){$n(t,"text-anchor",e.textAnchor),$n(t,"font-family",e.fontFamily),$n(t,"font-size",e.fontSize),$n(t,"font-style",e.fontStyle),$n(t,"font-variant",e.fontVariant===void 0?utr(r):e.fontVariant),$n(t,"font-weight",e.fontWeight)}function utr(t){return ZJt(t)||Vm(t)?"tabular-nums":void 0}const htr=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);function dtr(t){return t==null||typeof t=="number"?[void 0,t]:typeof t!="string"?[t,void 0]:(t=t.trim().toLowerCase(),htr.has(t)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(t)?[void 0,t]:[t,void 0])}function ptr(t,e,r){const i=[];let n,s=0;for(const[o,a,l]of ftr(t)){if(n===void 0&&(n=o),s>n&&r(t,n,a)>e&&(i.push(t.slice(n,s)+(t[s-1]===NWe?"-":"")),n=o),l){i.push(t.slice(n,a)),n=void 0;continue}s=a}return i}function*ftr(t){let e=0,r=0;const i=t.length;for(;r<i;){let n=1;switch(t[r]){case NWe:case"-":++r,yield[e,r,!1],e=r;break;case" ":for(yield[e,r,!1];t[++r]===" ";);e=r;break;case"\r":t[r+1]===`
`&&++n;case`
`:yield[e,r,!0],r+=n,e=r;break;default:++r;break}}yield[e,r,!0]}const JEe={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"":31,"":31,"":47,"":47,"":82};function kWe(t,e=0,r=t.length){let i=0;for(let n=e;n<r;n=LP(t,n))i+=JEe[t[n]]??(zWe(t,n)?120:JEe.e);return i}function UWe(t,e=0,r=t.length){let i=0;for(let n=e;n<r;n=LP(t,n))i+=zWe(t,n)?200:100;return i}function mtr({monospace:t,lineWidth:e,textOverflow:r}){if(r!=null||e==1/0)return s=>s.split(/\r\n?|\n/g);const i=t?UWe:kWe,n=e*100;return s=>ptr(s,n,i)}function gtr({monospace:t,lineWidth:e,textOverflow:r}){if(r==null||e==1/0)return s=>s;const i=t?UWe:kWe,n=e*100;switch(r){case"clip-start":return s=>e3e(s,n,i,"");case"clip-end":return s=>KEe(s,n,i,"");case"ellipsis-start":return s=>e3e(s,n,i,"");case"ellipsis-middle":return s=>Atr(s,n,i,"");case"ellipsis-end":return s=>KEe(s,n,i,"")}}function QV(t,e,r,i){const n=[];let s=0;for(let o=0,a=0,l=t.length;o<l;o=a){a=LP(t,o);const c=r(t,o,a);if(s+c>e){for(s+=i;s>e&&o>0;)a=o,o=n.pop(),s-=r(t,o,a);return[o,e-s]}s+=c,n.push(o)}return[-1,0]}function KEe(t,e,r,i){t=t.trim();const n=r(i),[s]=QV(t,e,r,n);return s<0?t:t.slice(0,s).trimEnd()+i}function Atr(t,e,r,i){t=t.trim();const n=r(t);if(n<=e)return t;const s=r(i)/2,[o,a]=QV(t,e/2,r,s),[l]=QV(t,n-e/2-a+s,r,-s);return l<0?i:t.slice(0,o).trimEnd()+i+t.slice(LP(t,l)).trimStart()}function e3e(t,e,r,i){t=t.trim();const n=r(t);if(n<=e)return t;const s=r(i),[o]=QV(t,n-e+s,r,-s);return o<0?i:i+t.slice(LP(t,o)).trimStart()}const Foe=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,t3e=/\p{Extended_Pictographic}/uy;function LP(t,e){return e+=ytr(t,e)?2:1,vtr(t,e)&&(e=Foe.lastIndex),_tr(t,e)?LP(t,e+1):e}function BWe(t,e){return t.charCodeAt(e)<128}function ytr(t,e){const r=t.charCodeAt(e);if(r>=55296&&r<56320){const i=t.charCodeAt(e+1);return i>=56320&&i<57344}return!1}function _tr(t,e){return t.charCodeAt(e)===8205}function vtr(t,e){return BWe(t,e)?!1:(Foe.lastIndex=e,Foe.test(t))}function zWe(t,e){return BWe(t,e)?!1:(t3e.lastIndex=e,t3e.test(t))}const btr={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},VWe=3.5,wtr=VWe*5,GWe={draw(t,e,r){const i=e*r/wtr;t.moveTo(0,0),t.lineTo(0,-e),t.moveTo(-i,i-e),t.lineTo(0,-e),t.lineTo(i,i-e)}},xtr={draw(t,e,r){t.moveTo(-r,0),t.lineTo(0,-e),t.lineTo(r,0)}},Ttr=new Map([["arrow",GWe],["spike",xtr]]);function Str(t){return t&&typeof t.draw=="function"}function Etr(t){if(Str(t))return t;const e=Ttr.get(`${t}`.toLowerCase());if(e)return e;throw new Error(`invalid shape: ${t}`)}class jWe extends F1{constructor(e,r={}){const{x:i,y:n,r:s=VWe,length:o,rotate:a,shape:l=GWe,anchor:c="middle",frameAnchor:u}=r,[d,p]=hp(o,12),[A,v]=hp(a,0);super(e,{x:{value:i,scale:"x",optional:!0},y:{value:n,scale:"y",optional:!0},length:{value:d,scale:"length",optional:!0},rotate:{value:A,optional:!0}},r,btr),this.r=+s,this.length=p,this.rotate=v,this.shape=Etr(l),this.anchor=N1(c,"anchor",["start","middle","end"]),this.frameAnchor=jqe(u)}render(e,r,i,n,s){const{x:o,y:a}=r,{x:l,y:c,length:u,rotate:d}=i,{length:p,rotate:A,anchor:v,shape:b,r:S}=this,[E,R]=yWe(this,n);return cy("svg:g",s).call(IP,this,n,s).call(DP,this,{x:l&&o,y:c&&a}).call(O=>O.selectAll().data(e).enter().append("path").call($P,this).attr("transform",LWe`translate(${l?I=>l[I]:E},${c?I=>c[I]:R})${d?I=>` rotate(${d[I]})`:A?` rotate(${A})`:""}${v==="start"?"":v==="end"?u?I=>` translate(0,${u[I]})`:` translate(0,${p})`:u?I=>` translate(0,${u[I]/2})`:` translate(0,${p/2})`}`).attr("d",u?I=>{const N=aoe();return b.draw(N,u[I],S),N}:(()=>{const I=aoe();return b.draw(I,p,S),I})()).call(OF,this,i)).node()}}function Ctr(t,e={}){const{x:r=Ym,...i}=e;return new jWe(t,{...i,x:r})}function Mtr(t,e={}){const{y:r=Ym,...i}=e;return new jWe(t,{...i,y:r})}function mw(t,e){return arguments.length<2&&!IE(t)&&(e=t,t=null),e===void 0&&(e={}),[t,e]}function oq({anchor:t}={},e){return t===void 0?e[0]:N1(t,"anchor",e)}function HWe(t){return oq(t,["left","right"])}function qWe(t){return oq(t,["right","left"])}function WWe(t){return oq(t,["bottom","top"])}function QWe(t){return oq(t,["top","bottom"])}function YWe(){const[t,e]=mw(...arguments);return ZWe("y",HWe(e),t,e)}function Rtr(){const[t,e]=mw(...arguments);return ZWe("fy",qWe(e),t,e)}function XWe(){const[t,e]=mw(...arguments);return JWe("x",WWe(e),t,e)}function Otr(){const[t,e]=mw(...arguments);return JWe("fx",QWe(e),t,e)}function ZWe(t,e,r,{color:i="currentColor",opacity:n=1,stroke:s=i,strokeOpacity:o=n,strokeWidth:a=1,fill:l=i,fillOpacity:c=n,textAnchor:u,textStroke:d,textStrokeOpacity:p,textStrokeWidth:A,tickSize:v=t==="y"?6:0,tickPadding:b,tickRotate:S,x:E,margin:R,marginTop:O=R===void 0?20:R,marginRight:I=R===void 0?e==="right"?40:0:R,marginBottom:N=R===void 0?20:R,marginLeft:L=R===void 0?e==="left"?40:0:R,label:B,labelOffset:U,labelAnchor:q,...Z}){return v=Ma(v),b=Ma(b),S=Ma(S),q!==void 0&&(q=N1(q,"labelAnchor",["center","top","bottom"])),xWe(v&&!ap(s)?Ptr(t,e,r,{stroke:s,strokeOpacity:o,strokeWidth:a,tickSize:v,tickPadding:b,tickRotate:S,x:E,...Z}):null,ap(l)?null:$tr(t,e,r,{fill:l,fillOpacity:c,stroke:d,strokeOpacity:p,strokeWidth:A,textAnchor:u,tickSize:v,tickPadding:b,tickRotate:S,x:E,marginTop:O,marginRight:I,marginBottom:N,marginLeft:L,...Z}),!ap(l)&&B!==null?FWe([],rQe({fill:l,fillOpacity:c,...Z},function(X,ee,se,ue,re){const te=ue[t],{marginTop:j,marginRight:H,marginBottom:W,marginLeft:oe}=t==="y"&&re.inset||re,le=q??(te.bandwidth?"center":"top"),fe=U??(e==="right"?H:oe)-3;return le==="center"?(this.textAnchor=void 0,this.lineAnchor=e==="right"?"bottom":"top",this.frameAnchor=e,this.rotate=-90):(this.textAnchor=e==="right"?"end":"start",this.lineAnchor=le,this.frameAnchor=`${le}-${e}`,this.rotate=0),this.dy=le==="top"?3-j:le==="bottom"?W-3:0,this.dx=e==="right"?fe:-fe,this.ariaLabel=`${t}-axis label`,{facets:[[0]],channels:{text:{value:[B===void 0?sQe(t,te,le):B]}}}})):null)}function JWe(t,e,r,{color:i="currentColor",opacity:n=1,stroke:s=i,strokeOpacity:o=n,strokeWidth:a=1,fill:l=i,fillOpacity:c=n,textAnchor:u,textStroke:d,textStrokeOpacity:p,textStrokeWidth:A,tickSize:v=t==="x"?6:0,tickPadding:b,tickRotate:S,y:E,margin:R,marginTop:O=R===void 0?e==="top"?30:0:R,marginRight:I=R===void 0?20:R,marginBottom:N=R===void 0?e==="bottom"?30:0:R,marginLeft:L=R===void 0?20:R,label:B,labelAnchor:U,labelOffset:q,...Z}){return v=Ma(v),b=Ma(b),S=Ma(S),U!==void 0&&(U=N1(U,"labelAnchor",["center","left","right"])),xWe(v&&!ap(s)?Itr(t,e,r,{stroke:s,strokeOpacity:o,strokeWidth:a,tickSize:v,tickPadding:b,tickRotate:S,y:E,...Z}):null,ap(l)?null:Dtr(t,e,r,{fill:l,fillOpacity:c,stroke:d,strokeOpacity:p,strokeWidth:A,textAnchor:u,tickSize:v,tickPadding:b,tickRotate:S,y:E,marginTop:O,marginRight:I,marginBottom:N,marginLeft:L,...Z}),!ap(l)&&B!==null?FWe([],rQe({fill:l,fillOpacity:c,...Z},function(X,ee,se,ue,re){const te=ue[t],{marginTop:j,marginRight:H,marginBottom:W,marginLeft:oe}=t==="x"&&re.inset||re,le=U??(te.bandwidth?"center":"right"),fe=q??(e==="top"?j:W)-3;return le==="center"?(this.frameAnchor=e,this.textAnchor=void 0):(this.frameAnchor=`${e}-${le}`,this.textAnchor=le==="right"?"end":"start"),this.lineAnchor=e,this.dy=e==="top"?-fe:fe,this.dx=le==="right"?H-3:le==="left"?3-oe:0,this.ariaLabel=`${t}-axis label`,{facets:[[0]],channels:{text:{value:[B===void 0?sQe(t,te,le):B]}}}})):null)}function Ptr(t,e,r,{strokeWidth:i=1,strokeLinecap:n=null,strokeLinejoin:s=null,facetAnchor:o=e+(t==="y"?"-empty":""),frameAnchor:a=e,tickSize:l,inset:c=0,insetLeft:u=c,insetRight:d=c,dx:p=0,y:A=t==="y"?void 0:null,...v}){return NP(Mtr,t,`${t}-axis tick`,r,{strokeWidth:i,strokeLinecap:n,strokeLinejoin:s,facetAnchor:o,frameAnchor:a,y:A,...v,dx:e==="left"?+p-dp+ +u:+p+dp-d,anchor:"start",length:l,shape:e==="left"?Vtr:Gtr})}function Itr(t,e,r,{strokeWidth:i=1,strokeLinecap:n=null,strokeLinejoin:s=null,facetAnchor:o=e+(t==="x"?"-empty":""),frameAnchor:a=e,tickSize:l,inset:c=0,insetTop:u=c,insetBottom:d=c,dy:p=0,x:A=t==="x"?void 0:null,...v}){return NP(Ctr,t,`${t}-axis tick`,r,{strokeWidth:i,strokeLinejoin:s,strokeLinecap:n,facetAnchor:o,frameAnchor:a,x:A,...v,dy:e==="bottom"?+p-dp-d:+p+dp+ +u,anchor:"start",length:l,shape:e==="bottom"?Btr:ztr})}function $tr(t,e,r,{facetAnchor:i=e+(t==="y"?"-empty":""),frameAnchor:n=e,tickSize:s,tickRotate:o=0,tickPadding:a=Math.max(3,9-s)+(Math.abs(o)>60?4*Math.cos(o*TWe):0),tickFormat:l,text:c=typeof l=="function"?l:void 0,textAnchor:u=Math.abs(o)>60?"middle":e==="left"?"end":"start",lineAnchor:d=o>60?"top":o<-60?"bottom":"middle",fontVariant:p,inset:A=0,insetLeft:v=A,insetRight:b=A,dx:S=0,y:E=t==="y"?void 0:null,...R}){return NP(ltr,t,`${t}-axis tick label`,r,{facetAnchor:i,frameAnchor:n,text:c===void 0?null:c,textAnchor:u,lineAnchor:d,fontVariant:p,rotate:o,y:E,...R,dx:e==="left"?+S-s-a+ +v:+S+ +s+ +a-b},function(O,I,N){p===void 0&&(this.fontVariant=nQe(O)),c===void 0&&(N.text=iQe(O,I,l))})}function Dtr(t,e,r,{facetAnchor:i=e+(t==="x"?"-empty":""),frameAnchor:n=e,tickSize:s,tickRotate:o=0,tickPadding:a=Math.max(3,9-s)+(Math.abs(o)>=10?4*Math.cos(o*TWe):0),tickFormat:l,text:c=typeof l=="function"?l:void 0,textAnchor:u=Math.abs(o)>=10?o<0^e==="bottom"?"start":"end":"middle",lineAnchor:d=Math.abs(o)>=10?"middle":e==="bottom"?"top":"bottom",fontVariant:p,inset:A=0,insetTop:v=A,insetBottom:b=A,dy:S=0,x:E=t==="x"?void 0:null,...R}){return NP(atr,t,`${t}-axis tick label`,r,{facetAnchor:i,frameAnchor:n,text:c===void 0?null:c,textAnchor:u,lineAnchor:d,fontVariant:p,rotate:o,x:E,...R,dy:e==="bottom"?+S+ +s+ +a-b:+S-s-a+ +v},function(O,I,N){p===void 0&&(this.fontVariant=nQe(O)),c===void 0&&(N.text=iQe(O,I,l))})}function Ltr(){const[t,e]=mw(...arguments);return KWe("y",HWe(e),t,e)}function Ntr(){const[t,e]=mw(...arguments);return KWe("fy",qWe(e),t,e)}function Ftr(){const[t,e]=mw(...arguments);return eQe("x",WWe(e),t,e)}function ktr(){const[t,e]=mw(...arguments);return eQe("fx",QWe(e),t,e)}function KWe(t,e,r,{y:i=t==="y"?void 0:null,x:n=null,x1:s=e==="left"?n:null,x2:o=e==="right"?n:null,...a}){return NP($We,t,`${t}-grid`,r,{y:i,x1:s,x2:o,...tQe(a)})}function eQe(t,e,r,{x:i=t==="x"?void 0:null,y:n=null,y1:s=e==="top"?n:null,y2:o=e==="bottom"?n:null,...a}){return NP(itr,t,`${t}-grid`,r,{x:i,y1:s,y2:o,...tQe(a)})}function tQe({color:t="currentColor",opacity:e=.1,stroke:r=t,strokeOpacity:i=e,strokeWidth:n=1,...s}){return{stroke:r,strokeOpacity:i,strokeWidth:n,...s}}function rQe({fill:t,fillOpacity:e,fontFamily:r,fontSize:i,fontStyle:n,fontWeight:s,monospace:o,pointerEvents:a,shapeRendering:l},c){return[,t]=hE(t),[,e]=hp(e),{facet:"super",x:null,y:null,fill:t,fillOpacity:e,fontFamily:r,fontSize:i,fontStyle:n,fontWeight:s,monospace:o,pointerEvents:a,shapeRendering:l,initializer:c}}function NP(t,e,r,i,n,s){let o;const a=t(i,Qqe(n,function(l,c,u,d){const{[e]:p}=d;if(!p)throw new Error(`missing scale: ${e}`);let{ticks:A,tickSpacing:v,interval:b}=n;if(mWe(p)&&typeof A=="string"&&(b=A,A=void 0),l==null){if(IE(A))l=WA(A);else if(p.ticks)if(A!==void 0)l=p.ticks(A);else if(b=CF(b===void 0?p.interval:b,p.type),b!==void 0){const[S,E]=IO(p.domain());l=b.range(S,b.offset(b.floor(E)))}else{const[S,E]=IO(p.range());A=(E-S)/(v===void 0?e==="x"?80:35:v),l=p.ticks(A)}else l=p.domain();e==="y"||e==="x"?c=[fw(l)]:(o[e]={scale:e,value:Ym},c=void 0)}return s==null||s.call(this,p,A,o),{data:l,facets:c,channels:Object.fromEntries(Object.entries(o).map(([S,E])=>[S,{...E,value:Bf(l,E.value)}]))}}));return i==null?(o=a.channels,a.channels={}):o={},a.ariaLabel=r,a}function iQe(t,e,r){return{value:Utr(t,e,r)}}function Utr(t,e,r){return t.tickFormat?t.tickFormat(IE(e)?null:e,r):r===void 0?ufe:typeof r=="string"?(Vm(t.domain())?QH:MP)(r):PP(r)}const Btr={draw(t,e){t.moveTo(0,0),t.lineTo(0,e)}},ztr={draw(t,e){t.moveTo(0,0),t.lineTo(0,-e)}},Vtr={draw(t,e){t.moveTo(0,0),t.lineTo(-e,0)}},Gtr={draw(t,e){t.moveTo(0,0),t.lineTo(e,0)}};function nQe(t){return t.bandwidth&&t.interval===void 0?void 0:"tabular-nums"}function jtr(t){return Math.sign(oN(t.domain()))*Math.sign(oN(t.range()))}function sQe(t,e,r){const i=e.label;if(e.bandwidth||!(i!=null&&i.inferred))return i;const n=jtr(e);return n?t==="x"||r==="center"?t==="x"==n<0?` ${i}`:`${i} `:`${n<0?" ":" "}${i}`:i}const Htr={ariaLabel:"frame",fill:"none",stroke:"currentColor"},qtr={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square"};class Wtr extends F1{constructor(e={}){const{anchor:r=null,inset:i=0,insetTop:n=i,insetRight:s=i,insetBottom:o=i,insetLeft:a=i,rx:l,ry:c}=e;super(void 0,void 0,e,r==null?Htr:qtr),this.anchor=Vqe(r,"anchor",["top","right","bottom","left"]),this.insetTop=Ma(n),this.insetRight=Ma(s),this.insetBottom=Ma(o),this.insetLeft=Ma(a),this.rx=Ma(l),this.ry=Ma(c)}render(e,r,i,n,s){const{marginTop:o,marginRight:a,marginBottom:l,marginLeft:c,width:u,height:d}=n,{anchor:p,insetTop:A,insetRight:v,insetBottom:b,insetLeft:S,rx:E,ry:R}=this,O=c+S,I=u-a-v,N=o+A,L=d-l-b;return cy(p?"svg:line":"svg:rect",s).call(IP,this,n,s).call($P,this).call(DP,this,{}).call(p==="left"?B=>B.attr("x1",O).attr("x2",O).attr("y1",N).attr("y2",L):p==="right"?B=>B.attr("x1",I).attr("x2",I).attr("y1",N).attr("y2",L):p==="top"?B=>B.attr("x1",O).attr("x2",I).attr("y1",N).attr("y2",N):p==="bottom"?B=>B.attr("x1",O).attr("x2",I).attr("y1",L).attr("y2",L):B=>B.attr("x",O).attr("y",N).attr("width",I-O).attr("height",L-N).attr("rx",E).attr("ry",R)).node()}}function Qtr(t){return new Wtr(t)}function oQe(t={}){const{facet:e,style:r,caption:i,ariaLabel:n,ariaDescription:s}=t,o=hfe(t.className),a=t.marks===void 0?[]:r3e(t.marks),l=Ktr(e,t),c=new Map;for(const se of a){const ue=i3e(se,l,t);ue&&c.set(se,ue)}const u=new Map;l&&y$(u,[l]),y$(u,c);const d=r3e(err(a,u,t));for(const se of d){const ue=i3e(se,l,t);ue&&c.set(se,ue)}a.unshift(...d);let p=$er(u,t);if(p!==void 0){const se=l?GZ(p,l):void 0;for(const re of a){if(re.facet===null||re.facet==="super")continue;const te=c.get(re);te!==void 0&&(te.facetsIndex=re.fx!=null||re.fy!=null?GZ(p,te):se)}const ue=new Set;for(const{facetsIndex:re}of c.values())re==null||re.forEach((te,j)=>{(te==null?void 0:te.length)>0&&ue.add(j)});p.forEach(0<ue.size&&ue.size<p.length?(re,te)=>re.empty=!ue.has(te):re=>re.empty=!1);for(const re of a)if(re.facet==="exclude"){const te=c.get(re);te!==void 0&&(te.facetsIndex=Ner(te.facetsIndex))}}for(const se of da.keys())Poe(t[se])&&se!=="fx"&&se!=="fy"&&u.set(se,[]);const A=new Map;for(const se of a){if(A.has(se))throw new Error("duplicate mark; each mark must be unique");const{facetsIndex:ue,channels:re}=c.get(se)??{},{data:te,facets:j,channels:H}=se.initialize(ue,re);mfe(H,t),A.set(se,{data:te,facets:j,channels:H})}const v=Loe(y$(u,A),t),b=HEe(v),S=Per(v,a,t);cer(v,S);const{fx:E,fy:R}=b,O=E||R?dWe(v,S):S,I=E||R?arr(b,S):S,N=sfe(t,O,o),L=new Set;for(const[se,ue]of A)if(se.initializer!=null){const re=se.facet==="super"?I:O,te=se.initializer(ue.data,ue.facets,ue.channels,b,re,N);if(te.data!==void 0&&(ue.data=te.data),te.facets!==void 0&&(ue.facets=te.facets),te.channels!==void 0){Jtr(te.channels),Object.assign(ue.channels,te.channels);for(const W of Object.values(te.channels)){const{scale:oe}=W;oe!=null&&da.get(oe)!==mA&&(aQe(W,t),L.add(oe))}const{fx:j,fy:H}=te.channels;if(j!=null||H!=null){const W=c.get(se)??{channels:{}};j!=null&&(W.channels.fx=j),H!=null&&(W.channels.fy=H),W.groups=pfe(ue.data,W.channels),W.facetsIndex=ue.facets=GZ(p,W),c.set(se,W)}}}if(L.size){const se=new Map;y$(se,A,te=>L.has(te)),y$(u,A,te=>L.has(te));const ue=orr(Loe(se,t),v),re=HEe(ue);Object.assign(v,ue),Object.assign(b,re)}for(const[se,ue]of A)ue.values=se.scale(ue.channels,b,N);const{width:B,height:U}=S,q=cy("svg",N).attr("class",o).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",B).attr("height",U).attr("viewBox",`0 0 ${B} ${U}`).attr("aria-label",n).attr("aria-description",s).call(se=>se.append("style").text(`.${o} {
  display: block;
  background: white;
  height: auto;
  height: intrinsic;
  max-width: 100%;
}
.${o} text,
.${o} tspan {
  white-space: pre;
}`)).call(dfe,r).node();if(p!==void 0){const se={x:E==null?void 0:E.domain(),y:R==null?void 0:R.domain()};p=Der(p,se),Xse(q).selectAll().data(p).enter().append("g").attr("aria-label","facet").attr("transform",Ler(E,R,S)).each(function(ue){var te;let re=!0;for(const j of a){if(j.facet==="super")continue;const{channels:H,values:W,facets:oe}=A.get(j);if(!(((te=j.facetAnchor)==null?void 0:te.call(j,p,se,ue))??!ue.empty))continue;let le=null;if(oe){if(le=oe[c.has(j)?ue.i:0],le=j.filter(le,H,W),le.length===0)continue;le.fi=ue.i}const fe=j.render(le,b,W,O,N);fe!=null&&(re=!1,this.appendChild(fe))}re&&this.remove()})}for(const se of a){if(p!==void 0&&se.facet!=="super")continue;const{channels:ue,values:re,facets:te}=A.get(se);let j=null;if(te&&(j=te[0],j=se.filter(j,ue,re),j.length===0))continue;const H=se.render(j,b,re,I,N);H!=null&&q.appendChild(H)}let Z=q;const X=Zer(v,N,t);if(i!=null||X.length>0){const{document:se}=N;Z=se.createElement("figure"),Z.style.maxWidth="initial";for(const ue of X)Z.appendChild(ue);if(Z.appendChild(q),i!=null){const ue=se.createElement("figcaption");ue.appendChild(i!=null&&i.ownerDocument?i:se.createTextNode(i)),Z.appendChild(ue)}}Z.scale=ger(v),Z.legend=Qer(v,N,t);const ee=TKt();return ee>0&&Xse(q).append("text").attr("x",B).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("").append("title").text(`${ee.toLocaleString("en-US")} warning${ee===1?"":"s"}. Please check the console.`),Z}function Ytr({marks:t=[],...e}={}){return oQe({...e,marks:[...t,this]})}F1.prototype.plot=Ytr;function r3e(t){return t.flat(1/0).filter(e=>e!=null).map(Xtr)}function Xtr(t){return typeof t.render=="function"?t:new Ztr(t)}class Ztr extends F1{constructor(e){if(typeof e!="function")throw new TypeError("invalid mark; missing render function");super(),this.render=e}render(){}}function mfe(t,e){for(const r in t)aQe(t[r],e);return t}function aQe(t,e){var a;const{scale:r}=t;if(r==null)return;const{type:i,percent:n,interval:s,transform:o=n?l=>l*100:(a=rfe(s,i))==null?void 0:a.floor}=e[r]??{};o!=null&&(t.value=Tu(t.value,o))}function Jtr(t){for(const e in t)Jqe(e,t[e])}function y$(t,e,r=NJt){for(const{channels:i}of e.values())for(const n in i){const s=i[n],{scale:o}=s;if(o!=null&&r(o)){const a=t.get(o);a!==void 0?a.push(s):t.set(o,[s])}}return t}function Ktr(t,e){if(t==null)return;const{x:r,y:i}=t;if(r==null&&i==null)return;const n=WA(t.data??r??i);if(n===void 0)throw new Error("missing facet data");const s={};r!=null&&(s.fx=aN(n,{value:r,scale:"fx"})),i!=null&&(s.fy=aN(n,{value:i,scale:"fy"})),mfe(s,e);const o=pfe(n,s);return{channels:s,groups:o,data:t.data}}function i3e(t,e,r){var l;if(t.facet===null||t.facet==="super")return;const{fx:i,fy:n}=t;if(i!=null||n!=null){const c=WA(t.data??i??n);if(c===void 0)throw new Error(`missing facet data in ${t.ariaLabel}`);if(c===null)return;const u={};return i!=null&&(u.fx=aN(c,{value:i,scale:"fx"})),n!=null&&(u.fy=aN(c,{value:n,scale:"fy"})),mfe(u,r),{channels:u,groups:pfe(c,u)}}if(e===void 0)return;const{channels:s,groups:o,data:a}=e;if(t.facet!=="auto"||t.data===a)return{channels:s,groups:o};a.length>0&&(o.size>1||o.size===1&&s.fx&&s.fy&&[...o][0][1].size>1)&&((l=WA(t.data))==null?void 0:l.length)===a.length&&dD(`Warning: the ${t.ariaLabel} mark appears to use faceted data, but isnt faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function err(t,e,r){let{projection:i,x:n={},y:s={},fx:o={},fy:a={},axis:l,grid:c,facet:u={},facet:{axis:d=l,grid:p}=u,x:{axis:A=l,grid:v=A===null?null:c}=n,y:{axis:b=l,grid:S=b===null?null:c}=s,fx:{axis:E=d,grid:R=E===null?null:p}=o,fy:{axis:O=d,grid:I=O===null?null:p}=a}=r;(i||!Poe(n)&&!n3e("x",t))&&(A=v=null),(i||!Poe(s)&&!n3e("y",t))&&(b=S=null),e.has("fx")||(E=R=null),e.has("fy")||(O=I=null),A===void 0&&(A=!g7(t,"x")),b===void 0&&(b=!g7(t,"y")),E===void 0&&(E=!g7(t,"fx")),O===void 0&&(O=!g7(t,"fy")),A===!0&&(A="bottom"),b===!0&&(b="left"),E===!0&&(E=A==="top"||A===null?"bottom":"top"),O===!0&&(O=b==="right"||b===null?"left":"right");const N=[];return m7(N,I,Ntr,a),f7(N,O,Rtr,"right","left",u,a),m7(N,R,ktr,o),f7(N,E,Otr,"top","bottom",u,o),m7(N,S,Ltr,s),f7(N,b,YWe,"left","right",r,s),m7(N,v,Ftr,n),f7(N,A,XWe,"bottom","top",r,n),N}function f7(t,e,r,i,n,s,o){if(!e)return;const a=trr(e);o=rrr(a?i:e,s,o);const{line:l}=o;(r===YWe||r===XWe)&&l&&!sN(l)&&t.push(Qtr(irr(o))),t.push(r(o)),a&&t.push(r({...o,anchor:n,label:null}))}function m7(t,e,r,i){!e||sN(e)||t.push(r(nrr(e,i)))}function trr(t){return/^\s*both\s*$/i.test(t)}function rrr(t,e,{line:r=e.line,ticks:i,tickSize:n,tickSpacing:s,tickPadding:o,tickFormat:a,tickRotate:l,fontVariant:c,ariaLabel:u,ariaDescription:d,label:p=e.label,labelAnchor:A,labelOffset:v}){return{anchor:t,line:r,ticks:i,tickSize:n,tickSpacing:s,tickPadding:o,tickFormat:a,tickRotate:l,fontVariant:c,ariaLabel:u,ariaDescription:d,label:p,labelAnchor:A,labelOffset:v}}function irr(t){const{anchor:e,line:r}=t;return{anchor:e,facetAnchor:e+"-empty",stroke:r===!0?void 0:r}}function nrr(t,{stroke:e=KH(t)?t:void 0,ticks:r=srr(t)?t:void 0,tickSpacing:i,ariaLabel:n,ariaDescription:s}){return{stroke:e,ticks:r,tickSpacing:i,ariaLabel:n,ariaDescription:s}}function srr(t){switch(typeof t){case"number":return!0;case"string":return!KH(t)}return IE(t)||typeof(t==null?void 0:t.range)=="function"}function g7(t,e){const r=`${e}-axis `;return t.some(i=>{var n;return(n=i.ariaLabel)==null?void 0:n.startsWith(r)})}function n3e(t,e){for(const r of e)for(const i in r.channels)if(r.channels[i].scale===t)return!0;return!1}function orr(t,e){for(const r in t){const i=t[r],n=e[r];i.label===void 0&&n&&(i.label=n.label)}return t}function arr({fx:t,fy:e},r){const{marginTop:i,marginRight:n,marginBottom:s,marginLeft:o,width:a,height:l}=cfe(r),c=t&&s3e(t),u=e&&s3e(e);return{marginTop:e?u[0]:i,marginRight:t?a-c[1]:n,marginBottom:e?l-u[1]:s,marginLeft:t?c[0]:o,inset:{marginTop:r.marginTop,marginRight:r.marginRight,marginBottom:r.marginBottom,marginLeft:r.marginLeft},width:a,height:l}}function s3e(t){const e=t.domain();let r=t(e[0]),i=t(e[e.length-1]);return i<r&&([r,i]=[i,r]),[r,i+t.bandwidth()]}function lrr(t={}){const{y:e,y1:r,y2:i}=t;return r===void 0&&i===void 0&&e===void 0?{...t,y:Ym}:t}function crr(t={},e={}){arguments.length===1&&([t,e]=hrr(t));const{x1:r,x:i=r,y:n,...s}=e,[o,a,l,c]=prr(i,n,"y",t,s);return{...o,x1:r,x:a,y1:l,y2:c,y:HJt(l,c)}}function urr({y:t,y1:e,y2:r,...i}={}){return e===void 0&&r===void 0?crr({y:t,...i}):([e,r]=zJt(t,e,r),{...i,y1:e,y2:r})}function hrr(t){const{offset:e,order:r,reverse:i,...n}=t;return[{offset:e,order:r,reverse:i},n]}function drr(t,e=LJt,r,{offset:i,order:n,reverse:s},o){const a=GJt(o),[l,c]=jJt(t),[u,d]=Ioe(e),[p,A]=Ioe(e);return i=frr(i),n=Arr(n,i,r),[Wqe(o,(v,b)=>{const S=t==null?void 0:c(Bf(v,t)),E=Bf(v,e,Float64Array),R=Bf(v,a),O=n&&n(v,S,E,R),I=v.length,N=d(new Float64Array(I)),L=A(new Float64Array(I)),B=[];for(const U of b){const q=S?Array.from(hGe(U,Z=>S[Z]).values()):[U];O&&xrr(q,O);for(const Z of q){let X=0,ee=0;s&&Z.reverse();for(const se of Z){const ue=E[se];ue<0?X=L[se]=(N[se]=X)+ue:ue>0?ee=L[se]=(N[se]=ee)+ue:L[se]=N[se]=ee}}B.push(q)}return i&&i(B,N,L,R),{data:v,facets:b}}),l,u,p]}const prr=drr;function frr(t){if(t!=null){if(typeof t=="function")return t;switch(`${t}`.toLowerCase()){case"expand":case"normalize":return mrr;case"center":case"silhouette":return grr;case"wiggle":return cQe}throw new Error(`unknown offset: ${t}`)}}function lQe(t,e){let r=0,i=0;for(const n of t){const s=e[n];s<r&&(r=s),s>i&&(i=s)}return[r,i]}function mrr(t,e,r){for(const i of t)for(const n of i){const[s,o]=lQe(n,r);for(const a of n){const l=1/(o-s||1);e[a]=l*(e[a]-s),r[a]=l*(r[a]-s)}}}function grr(t,e,r){for(const i of t){for(const n of i){const[s,o]=lQe(n,r);for(const a of n){const l=(o+s)/2;e[a]-=l,r[a]-=l}}uQe(i,e,r)}hQe(t,e,r)}function cQe(t,e,r,i){for(const n of t){const s=new q2;let o=0;for(const a of n){let l=-1;const c=a.map(A=>Math.abs(r[A]-e[A])),u=a.map(A=>{l=i?i[A]:++l;const v=r[A]-e[A],b=s.has(l)?v-s.get(l):0;return s.set(l,v),b}),d=[0,...FHt(u)];for(const A of a)e[A]+=o,r[A]+=o;const p=iE(c);p&&(o-=iE(c,(A,v)=>(u[v]/2+d[v])*A)/p)}uQe(n,e,r)}hQe(t,e,r)}function uQe(t,e,r){const i=p1(t,n=>p1(n,s=>e[s]));for(const n of t)for(const s of n)e[s]-=i,r[s]-=i}function hQe(t,e,r){const i=t.length;if(i===1)return;const n=t.map(a=>a.flat()),s=n.map(a=>(p1(a,l=>e[l])+GA(a,l=>r[l]))/2),o=p1(s);for(let a=0;a<i;a++){const l=o-s[a];for(const c of n[a])e[c]+=l,r[c]+=l}}function Arr(t,e,r){if(t===void 0&&e===cQe)return o3e;if(t!=null){if(typeof t=="string"){switch(t.toLowerCase()){case"value":case r:return yrr;case"z":return _rr;case"sum":return vrr;case"appearance":return brr;case"inside-out":return o3e}return a3e(Uqe(t))}if(typeof t=="function")return a3e(t);if(Array.isArray(t))return wrr(t);throw new Error(`invalid order: ${t}`)}}function yrr(t,e,r){return r}function _rr(t,e,r,i){return i}function vrr(t,e,r,i){return aq(i,Mpe(fw(t),n=>iE(n,s=>r[s]),n=>i[n]))}function brr(t,e,r,i){return aq(i,Mpe(fw(t),n=>e[mGe(n,s=>r[s])],n=>i[n]))}function o3e(t,e,r,i){const n=fw(t),s=Mpe(n,u=>e[mGe(u,d=>r[d])],u=>i[u]),o=wR(n,u=>iE(u,d=>r[d]),u=>i[u]),a=[],l=[];let c=0;for(const u of s)c<0?(c+=o.get(u),a.push(u)):(c-=o.get(u),l.push(u));return aq(i,l.reverse().concat(a))}function a3e(t){return e=>Bf(e,t)}function wrr(t){return(e,r,i,n)=>aq(n,t)}function aq(t,e){if(!t)throw new Error("missing channel: z");return e=new q2(e.map((r,i)=>[r,i])),t.map(r=>e.get(r))}function xrr(t,e){for(const r of t)r.sort((i,n)=>uE(e[i],e[n]))}class Trr extends F1{constructor(e,r,i={},n){super(e,r,i,n);const{inset:s=0,insetTop:o=s,insetRight:a=s,insetBottom:l=s,insetLeft:c=s,rx:u,ry:d}=i;this.insetTop=Ma(o),this.insetRight=Ma(a),this.insetBottom=Ma(l),this.insetLeft=Ma(c),this.rx=eh(u,"auto"),this.ry=eh(d,"auto")}render(e,r,i,n,s){const{rx:o,ry:a}=this;return cy("svg:g",s).call(IP,this,n,s).call(this._transform,this,r).call(l=>l.selectAll().data(e).enter().append("rect").call($P,this).attr("x",this._x(r,i,n)).attr("width",this._width(r,i,n)).attr("y",this._y(r,i,n)).attr("height",this._height(r,i,n)).call($n,"rx",o).call($n,"ry",a).call(OF,this,i)).node()}_x(e,{x:r},{marginLeft:i}){const{insetLeft:n}=this;return r?s=>r[s]+n:i+n}_y(e,{y:r},{marginTop:i}){const{insetTop:n}=this;return r?s=>r[s]+n:i+n}_width({x:e},{x:r},{marginRight:i,marginLeft:n,width:s}){const{insetLeft:o,insetRight:a}=this,l=r&&e?e.bandwidth():s-i-n;return Math.max(0,l-o-a)}_height({y:e},{y:r},{marginTop:i,marginBottom:n,height:s}){const{insetTop:o,insetBottom:a}=this,l=r&&e?e.bandwidth():s-i-n;return Math.max(0,l-o-a)}}const Srr={ariaLabel:"bar"};class Err extends Trr{constructor(e,r={}){const{x:i,y1:n,y2:s}=r;super(e,{y1:{value:n,scale:"y"},y2:{value:s,scale:"y"},x:{value:i,scale:"x",type:"band",optional:!0}},r,Srr)}_transform(e,r,{y:i}){e.call(DP,r,{y:i},0,0)}_y({y:e},{y1:r,y2:i},{marginTop:n}){const{insetTop:s}=this;return VO(e)?n+s:o=>Math.min(r[o],i[o])+s}_height({y:e},{y1:r,y2:i},{marginTop:n,marginBottom:s,height:o}){const{insetTop:a,insetBottom:l}=this;return VO(e)?o-n-s-a-l:c=>Math.max(0,Math.abs(i[c]-r[c])-a-l)}}function Crr(t,e={x:Bqe,y2:Ym}){return new Err(t,urr(PWe(lrr(e))))}function Mrr({query:t}){var n;const e="ArchiveGrowthChart",r=xs.useRef(null),i=(n=t==null?void 0:t.data)==null?void 0:n.counts_by_year;return xs.useEffect(()=>{var o;if(!i)return;const s=oQe({x:{type:"band",tickFormat:"",label:""},y:{label:"count (thousands)",grid:!0},marks:[Crr(i,{x:"year",y:a=>a.total/1e6,fill:"provider",title:a=>`${a.provider}: ${a.percentage_of_archive?a.percentage_of_archive:"<1"}% of archive`}),$We([0],{stroke:"white",strokeWidth:2})],color:{type:"categorical",scheme:"Category10"},marginLeft:50,marginBottom:40,marginTop:20,height:1e3,style:{fontSize:"12pt",background:"slategray",color:"white"}});return(o=r.current)==null||o.append(s),()=>s.remove()},[i]),Po(hN,{children:[qr("h4",{className:"caption",children:"Archive Growth"}),qr("div",{className:e,ref:r})]})}function Rrr({query:t}){const e=t.data,r=[...e.fy_counts];let i=parseInt(r[0].count);return r.forEach((n,s)=>{if(s){parseInt(r[s-1].count);const o=parseInt(n.count);i=i+o;const a=Math.round(o/i*100);n.pct=`${a}%`,n.archiveSize=i}else n.pct="",n.archiveSize=i}),Po("div",{style:{color:"whitesmoke"},children:[qr("div",{style:{fontSize:"larger",padding:"10px"},children:"Counts by Fiscal Year"}),e?qr(hN,{children:Po("table",{style:{border:"1px solid white",borderCollapse:"collapse"},children:[qr("thead",{children:Po("tr",{children:[qr("th",{style:{border:"1px solid white",padding:"5px"},children:"Year"}),qr("th",{style:{border:"1px solid white",padding:"5px"},children:"Soundings"}),qr("th",{style:{border:"1px solid white",padding:"5px"},children:"Growth"}),Po("th",{style:{border:"1px solid white",padding:"5px"},children:["Total",qr("br",{}),"Archive"]})]})}),qr("tbody",{children:e.fy_counts.map(n=>Po("tr",{children:[qr("td",{style:{border:"1px solid white",padding:"5px"},children:n.label}),qr("td",{style:{border:"1px solid white"},children:parseInt(n.count).toLocaleString("en-US")}),qr("td",{style:{border:"1px solid white"},children:n.pct}),qr("td",{style:{border:"1px solid white"},children:n.archiveSize.toLocaleString("en-US")})]},n.label))})]})}):"",t.isLoading?qr("h3",{children:"loading data..."}):"",t.isError?Po("p",{children:["Error: ",t.error.message]}):""]})}function Orr({query:t}){const[e,r]=xs.useState("chart");function i(){r(e==="chart"?"table":"chart")}return Po("div",{children:[qr("button",{onClick:i,disabled:e==="chart",children:"Growth Chart"}),qr("button",{onClick:i,disabled:e==="table",children:"Fiscal Year Table"}),e==="chart"?qr(Mrr,{query:t}):null,e==="table"?qr(Rrr,{query:t}):null]})}class PF{constructor(){this.listeners=[],this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.push(e),this.onSubscribe(),()=>{this.listeners=this.listeners.filter(r=>r!==e),this.onUnsubscribe()}}hasListeners(){return this.listeners.length>0}onSubscribe(){}onUnsubscribe(){}}const cN=typeof window>"u"||"Deno"in window;function pf(){}function Prr(t,e){return typeof t=="function"?t(e):t}function koe(t){return typeof t=="number"&&t>=0&&t!==1/0}function dQe(t,e){return Math.max(t+(e||0)-Date.now(),0)}function r5(t,e,r){return lq(t)?typeof e=="function"?{...r,queryKey:t,queryFn:e}:{...e,queryKey:t}:t}function wb(t,e,r){return lq(t)?[{...e,queryKey:t},r]:[t||{},e]}function l3e(t,e){const{type:r="all",exact:i,fetchStatus:n,predicate:s,queryKey:o,stale:a}=t;if(lq(o)){if(i){if(e.queryHash!==gfe(o,e.options))return!1}else if(!YV(e.queryKey,o))return!1}if(r!=="all"){const l=e.isActive();if(r==="active"&&!l||r==="inactive"&&l)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||typeof n<"u"&&n!==e.state.fetchStatus||s&&!s(e))}function c3e(t,e){const{exact:r,fetching:i,predicate:n,mutationKey:s}=t;if(lq(s)){if(!e.options.mutationKey)return!1;if(r){if(HT(e.options.mutationKey)!==HT(s))return!1}else if(!YV(e.options.mutationKey,s))return!1}return!(typeof i=="boolean"&&e.state.status==="loading"!==i||n&&!n(e))}function gfe(t,e){return((e==null?void 0:e.queryKeyHashFn)||HT)(t)}function HT(t){return JSON.stringify(t,(e,r)=>Uoe(r)?Object.keys(r).sort().reduce((i,n)=>(i[n]=r[n],i),{}):r)}function YV(t,e){return pQe(t,e)}function pQe(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?!Object.keys(e).some(r=>!pQe(t[r],e[r])):!1}function fQe(t,e){if(t===e)return t;const r=h3e(t)&&h3e(e);if(r||Uoe(t)&&Uoe(e)){const i=r?t.length:Object.keys(t).length,n=r?e:Object.keys(e),s=n.length,o=r?[]:{};let a=0;for(let l=0;l<s;l++){const c=r?l:n[l];o[c]=fQe(t[c],e[c]),o[c]===t[c]&&a++}return i===s&&a===i?t:o}return e}function u3e(t,e){if(t&&!e||e&&!t)return!1;for(const r in t)if(t[r]!==e[r])return!1;return!0}function h3e(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Uoe(t){if(!d3e(t))return!1;const e=t.constructor;if(typeof e>"u")return!0;const r=e.prototype;return!(!d3e(r)||!r.hasOwnProperty("isPrototypeOf"))}function d3e(t){return Object.prototype.toString.call(t)==="[object Object]"}function lq(t){return Array.isArray(t)}function mQe(t){return new Promise(e=>{setTimeout(e,t)})}function p3e(t){mQe(0).then(t)}function Irr(){if(typeof AbortController=="function")return new AbortController}function Boe(t,e,r){return r.isDataEqual!=null&&r.isDataEqual(t,e)?t:typeof r.structuralSharing=="function"?r.structuralSharing(t,e):r.structuralSharing!==!1?fQe(t,e):e}class $rr extends PF{constructor(){super(),this.setup=e=>{if(!cN&&window.addEventListener){const r=()=>e();return window.addEventListener("visibilitychange",r,!1),window.addEventListener("focus",r,!1),()=>{window.removeEventListener("visibilitychange",r),window.removeEventListener("focus",r)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var e;(e=this.cleanup)==null||e.call(this),this.cleanup=void 0}}setEventListener(e){var r;this.setup=e,(r=this.cleanup)==null||r.call(this),this.cleanup=e(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()})}setFocused(e){this.focused=e,e&&this.onFocus()}onFocus(){this.listeners.forEach(e=>{e()})}isFocused(){return typeof this.focused=="boolean"?this.focused:typeof document>"u"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)}}const XV=new $rr;class Drr extends PF{constructor(){super(),this.setup=e=>{if(!cN&&window.addEventListener){const r=()=>e();return window.addEventListener("online",r,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",r)}}}}onSubscribe(){this.cleanup||this.setEventListener(this.setup)}onUnsubscribe(){if(!this.hasListeners()){var e;(e=this.cleanup)==null||e.call(this),this.cleanup=void 0}}setEventListener(e){var r;this.setup=e,(r=this.cleanup)==null||r.call(this),this.cleanup=e(i=>{typeof i=="boolean"?this.setOnline(i):this.onOnline()})}setOnline(e){this.online=e,e&&this.onOnline()}onOnline(){this.listeners.forEach(e=>{e()})}isOnline(){return typeof this.online=="boolean"?this.online:typeof navigator>"u"||typeof navigator.onLine>"u"?!0:navigator.onLine}}const ZV=new Drr;function Lrr(t){return Math.min(1e3*2**t,3e4)}function cq(t){return(t??"online")==="online"?ZV.isOnline():!0}class gQe{constructor(e){this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}}function RU(t){return t instanceof gQe}function AQe(t){let e=!1,r=0,i=!1,n,s,o;const a=new Promise((S,E)=>{s=S,o=E}),l=S=>{i||(A(new gQe(S)),t.abort==null||t.abort())},c=()=>{e=!0},u=()=>{e=!1},d=()=>!XV.isFocused()||t.networkMode!=="always"&&!ZV.isOnline(),p=S=>{i||(i=!0,t.onSuccess==null||t.onSuccess(S),n==null||n(),s(S))},A=S=>{i||(i=!0,t.onError==null||t.onError(S),n==null||n(),o(S))},v=()=>new Promise(S=>{n=E=>{const R=i||!d();return R&&S(E),R},t.onPause==null||t.onPause()}).then(()=>{n=void 0,i||t.onContinue==null||t.onContinue()}),b=()=>{if(i)return;let S;try{S=t.fn()}catch(E){S=Promise.reject(E)}Promise.resolve(S).then(p).catch(E=>{var R,O;if(i)return;const I=(R=t.retry)!=null?R:3,N=(O=t.retryDelay)!=null?O:Lrr,L=typeof N=="function"?N(r,E):N,B=I===!0||typeof I=="number"&&r<I||typeof I=="function"&&I(r,E);if(e||!B){A(E);return}r++,t.onFail==null||t.onFail(r,E),mQe(L).then(()=>{if(d())return v()}).then(()=>{e?A(E):b()})})};return cq(t.networkMode)?b():v().then(b),{promise:a,cancel:l,continue:()=>(n==null?void 0:n())?a:Promise.resolve(),cancelRetry:c,continueRetry:u}}const Afe=console;function Nrr(){let t=[],e=0,r=u=>{u()},i=u=>{u()};const n=u=>{let d;e++;try{d=u()}finally{e--,e||a()}return d},s=u=>{e?t.push(u):p3e(()=>{r(u)})},o=u=>(...d)=>{s(()=>{u(...d)})},a=()=>{const u=t;t=[],u.length&&p3e(()=>{i(()=>{u.forEach(d=>{r(d)})})})};return{batch:n,batchCalls:o,schedule:s,setNotifyFunction:u=>{r=u},setBatchNotifyFunction:u=>{i=u}}}const Za=Nrr();class yQe{destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),koe(this.cacheTime)&&(this.gcTimeout=setTimeout(()=>{this.optionalRemove()},this.cacheTime))}updateCacheTime(e){this.cacheTime=Math.max(this.cacheTime||0,e??(cN?1/0:5*60*1e3))}clearGcTimeout(){this.gcTimeout&&(clearTimeout(this.gcTimeout),this.gcTimeout=void 0)}}class Frr extends yQe{constructor(e){super(),this.abortSignalConsumed=!1,this.defaultOptions=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.cache=e.cache,this.logger=e.logger||Afe,this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.initialState=e.state||krr(this.options),this.state=this.initialState,this.scheduleGc()}get meta(){return this.options.meta}setOptions(e){this.options={...this.defaultOptions,...e},this.updateCacheTime(this.options.cacheTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.cache.remove(this)}setData(e,r){const i=Boe(this.state.data,e,this.options);return this.dispatch({data:i,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),i}setState(e,r){this.dispatch({type:"setState",state:e,setStateOptions:r})}cancel(e){var r;const i=this.promise;return(r=this.retryer)==null||r.cancel(e),i?i.then(pf).catch(pf):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.initialState)}isActive(){return this.observers.some(e=>e.options.enabled!==!1)}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(e=>e.getCurrentResult().isStale)}isStaleByTime(e=0){return this.state.isInvalidated||!this.state.dataUpdatedAt||!dQe(this.state.dataUpdatedAt,e)}onFocus(){var e;const r=this.observers.find(i=>i.shouldFetchOnWindowFocus());r&&r.refetch({cancelRefetch:!1}),(e=this.retryer)==null||e.continue()}onOnline(){var e;const r=this.observers.find(i=>i.shouldFetchOnReconnect());r&&r.refetch({cancelRefetch:!1}),(e=this.retryer)==null||e.continue()}addObserver(e){this.observers.indexOf(e)===-1&&(this.observers.push(e),this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.indexOf(e)!==-1&&(this.observers=this.observers.filter(r=>r!==e),this.observers.length||(this.retryer&&(this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.scheduleGc()),this.cache.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.dispatch({type:"invalidate"})}fetch(e,r){var i,n;if(this.state.fetchStatus!=="idle"){if(this.state.dataUpdatedAt&&r!=null&&r.cancelRefetch)this.cancel({silent:!0});else if(this.promise){var s;return(s=this.retryer)==null||s.continueRetry(),this.promise}}if(e&&this.setOptions(e),!this.options.queryFn){const A=this.observers.find(v=>v.options.queryFn);A&&this.setOptions(A.options)}Array.isArray(this.options.queryKey);const o=Irr(),a={queryKey:this.queryKey,pageParam:void 0,meta:this.meta},l=A=>{Object.defineProperty(A,"signal",{enumerable:!0,get:()=>{if(o)return this.abortSignalConsumed=!0,o.signal}})};l(a);const c=()=>this.options.queryFn?(this.abortSignalConsumed=!1,this.options.queryFn(a)):Promise.reject("Missing queryFn"),u={fetchOptions:r,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:c};if(l(u),(i=this.options.behavior)==null||i.onFetch(u),this.revertState=this.state,this.state.fetchStatus==="idle"||this.state.fetchMeta!==((n=u.fetchOptions)==null?void 0:n.meta)){var d;this.dispatch({type:"fetch",meta:(d=u.fetchOptions)==null?void 0:d.meta})}const p=A=>{if(RU(A)&&A.silent||this.dispatch({type:"error",error:A}),!RU(A)){var v,b,S,E;(v=(b=this.cache.config).onError)==null||v.call(b,A,this),(S=(E=this.cache.config).onSettled)==null||S.call(E,this.state.data,A,this)}this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return this.retryer=AQe({fn:u.fetchFn,abort:o==null?void 0:o.abort.bind(o),onSuccess:A=>{var v,b,S,E;if(typeof A>"u"){p(new Error("undefined"));return}this.setData(A),(v=(b=this.cache.config).onSuccess)==null||v.call(b,A,this),(S=(E=this.cache.config).onSettled)==null||S.call(E,A,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:p,onFail:(A,v)=>{this.dispatch({type:"failed",failureCount:A,error:v})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode}),this.promise=this.retryer.promise,this.promise}dispatch(e){const r=i=>{var n,s;switch(e.type){case"failed":return{...i,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:(n=e.meta)!=null?n:null,fetchStatus:cq(this.options.networkMode)?"fetching":"paused",...!i.dataUpdatedAt&&{error:null,status:"loading"}};case"success":return{...i,data:e.data,dataUpdateCount:i.dataUpdateCount+1,dataUpdatedAt:(s=e.dataUpdatedAt)!=null?s:Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const o=e.error;return RU(o)&&o.revert&&this.revertState?{...this.revertState}:{...i,error:o,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...e.state}}};this.state=r(this.state),Za.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate(e)}),this.cache.notify({query:this,type:"updated",action:e})})}}function krr(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,r=typeof e<"u",i=r?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:r?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"loading",fetchStatus:"idle"}}class Urr extends PF{constructor(e){super(),this.config=e||{},this.queries=[],this.queriesMap={}}build(e,r,i){var n;const s=r.queryKey,o=(n=r.queryHash)!=null?n:gfe(s,r);let a=this.get(o);return a||(a=new Frr({cache:this,logger:e.getLogger(),queryKey:s,queryHash:o,options:e.defaultQueryOptions(r),state:i,defaultOptions:e.getQueryDefaults(s)}),this.add(a)),a}add(e){this.queriesMap[e.queryHash]||(this.queriesMap[e.queryHash]=e,this.queries.push(e),this.notify({type:"added",query:e}))}remove(e){const r=this.queriesMap[e.queryHash];r&&(e.destroy(),this.queries=this.queries.filter(i=>i!==e),r===e&&delete this.queriesMap[e.queryHash],this.notify({type:"removed",query:e}))}clear(){Za.batch(()=>{this.queries.forEach(e=>{this.remove(e)})})}get(e){return this.queriesMap[e]}getAll(){return this.queries}find(e,r){const[i]=wb(e,r);return typeof i.exact>"u"&&(i.exact=!0),this.queries.find(n=>l3e(i,n))}findAll(e,r){const[i]=wb(e,r);return Object.keys(i).length>0?this.queries.filter(n=>l3e(i,n)):this.queries}notify(e){Za.batch(()=>{this.listeners.forEach(r=>{r(e)})})}onFocus(){Za.batch(()=>{this.queries.forEach(e=>{e.onFocus()})})}onOnline(){Za.batch(()=>{this.queries.forEach(e=>{e.onOnline()})})}}class Brr extends yQe{constructor(e){super(),this.defaultOptions=e.defaultOptions,this.mutationId=e.mutationId,this.mutationCache=e.mutationCache,this.logger=e.logger||Afe,this.observers=[],this.state=e.state||zrr(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options={...this.defaultOptions,...e},this.updateCacheTime(this.options.cacheTime)}get meta(){return this.options.meta}setState(e){this.dispatch({type:"setState",state:e})}addObserver(e){this.observers.indexOf(e)===-1&&(this.observers.push(e),this.clearGcTimeout(),this.mutationCache.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.observers=this.observers.filter(r=>r!==e),this.scheduleGc(),this.mutationCache.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.observers.length||(this.state.status==="loading"?this.scheduleGc():this.mutationCache.remove(this))}continue(){var e,r;return(e=(r=this.retryer)==null?void 0:r.continue())!=null?e:this.execute()}async execute(){const e=()=>{var B;return this.retryer=AQe({fn:()=>this.options.mutationFn?this.options.mutationFn(this.state.variables):Promise.reject("No mutationFn found"),onFail:(U,q)=>{this.dispatch({type:"failed",failureCount:U,error:q})},onPause:()=>{this.dispatch({type:"pause"})},onContinue:()=>{this.dispatch({type:"continue"})},retry:(B=this.options.retry)!=null?B:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode}),this.retryer.promise},r=this.state.status==="loading";try{var i,n,s,o,a,l,c,u;if(!r){var d,p,A,v;this.dispatch({type:"loading",variables:this.options.variables}),await((d=(p=this.mutationCache.config).onMutate)==null?void 0:d.call(p,this.state.variables,this));const U=await((A=(v=this.options).onMutate)==null?void 0:A.call(v,this.state.variables));U!==this.state.context&&this.dispatch({type:"loading",context:U,variables:this.state.variables})}const B=await e();return await((i=(n=this.mutationCache.config).onSuccess)==null?void 0:i.call(n,B,this.state.variables,this.state.context,this)),await((s=(o=this.options).onSuccess)==null?void 0:s.call(o,B,this.state.variables,this.state.context)),await((a=(l=this.mutationCache.config).onSettled)==null?void 0:a.call(l,B,null,this.state.variables,this.state.context,this)),await((c=(u=this.options).onSettled)==null?void 0:c.call(u,B,null,this.state.variables,this.state.context)),this.dispatch({type:"success",data:B}),B}catch(B){try{var b,S,E,R,O,I,N,L;throw await((b=(S=this.mutationCache.config).onError)==null?void 0:b.call(S,B,this.state.variables,this.state.context,this)),await((E=(R=this.options).onError)==null?void 0:E.call(R,B,this.state.variables,this.state.context)),await((O=(I=this.mutationCache.config).onSettled)==null?void 0:O.call(I,void 0,B,this.state.variables,this.state.context,this)),await((N=(L=this.options).onSettled)==null?void 0:N.call(L,void 0,B,this.state.variables,this.state.context)),B}finally{this.dispatch({type:"error",error:B})}}}dispatch(e){const r=i=>{switch(e.type){case"failed":return{...i,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"loading":return{...i,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!cq(this.options.networkMode),status:"loading",variables:e.variables};case"success":return{...i,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:e.error,failureCount:i.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"};case"setState":return{...i,...e.state}}};this.state=r(this.state),Za.batch(()=>{this.observers.forEach(i=>{i.onMutationUpdate(e)}),this.mutationCache.notify({mutation:this,type:"updated",action:e})})}}function zrr(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0}}class Vrr extends PF{constructor(e){super(),this.config=e||{},this.mutations=[],this.mutationId=0}build(e,r,i){const n=new Brr({mutationCache:this,logger:e.getLogger(),mutationId:++this.mutationId,options:e.defaultMutationOptions(r),state:i,defaultOptions:r.mutationKey?e.getMutationDefaults(r.mutationKey):void 0});return this.add(n),n}add(e){this.mutations.push(e),this.notify({type:"added",mutation:e})}remove(e){this.mutations=this.mutations.filter(r=>r!==e),this.notify({type:"removed",mutation:e})}clear(){Za.batch(()=>{this.mutations.forEach(e=>{this.remove(e)})})}getAll(){return this.mutations}find(e){return typeof e.exact>"u"&&(e.exact=!0),this.mutations.find(r=>c3e(e,r))}findAll(e){return this.mutations.filter(r=>c3e(e,r))}notify(e){Za.batch(()=>{this.listeners.forEach(r=>{r(e)})})}resumePausedMutations(){var e;return this.resuming=((e=this.resuming)!=null?e:Promise.resolve()).then(()=>{const r=this.mutations.filter(i=>i.state.isPaused);return Za.batch(()=>r.reduce((i,n)=>i.then(()=>n.continue().catch(pf)),Promise.resolve()))}).then(()=>{this.resuming=void 0}),this.resuming}}function Grr(){return{onFetch:t=>{t.fetchFn=()=>{var e,r,i,n,s,o;const a=(e=t.fetchOptions)==null||(r=e.meta)==null?void 0:r.refetchPage,l=(i=t.fetchOptions)==null||(n=i.meta)==null?void 0:n.fetchMore,c=l==null?void 0:l.pageParam,u=(l==null?void 0:l.direction)==="forward",d=(l==null?void 0:l.direction)==="backward",p=((s=t.state.data)==null?void 0:s.pages)||[],A=((o=t.state.data)==null?void 0:o.pageParams)||[];let v=A,b=!1;const S=L=>{Object.defineProperty(L,"signal",{enumerable:!0,get:()=>{var B;if((B=t.signal)!=null&&B.aborted)b=!0;else{var U;(U=t.signal)==null||U.addEventListener("abort",()=>{b=!0})}return t.signal}})},E=t.options.queryFn||(()=>Promise.reject("Missing queryFn")),R=(L,B,U,q)=>(v=q?[B,...v]:[...v,B],q?[U,...L]:[...L,U]),O=(L,B,U,q)=>{if(b)return Promise.reject("Cancelled");if(typeof U>"u"&&!B&&L.length)return Promise.resolve(L);const Z={queryKey:t.queryKey,pageParam:U,meta:t.options.meta};S(Z);const X=E(Z);return Promise.resolve(X).then(se=>R(L,U,se,q))};let I;if(!p.length)I=O([]);else if(u){const L=typeof c<"u",B=L?c:f3e(t.options,p);I=O(p,L,B)}else if(d){const L=typeof c<"u",B=L?c:jrr(t.options,p);I=O(p,L,B,!0)}else{v=[];const L=typeof t.options.getNextPageParam>"u";I=(a&&p[0]?a(p[0],0,p):!0)?O([],L,A[0]):Promise.resolve(R([],A[0],p[0]));for(let U=1;U<p.length;U++)I=I.then(q=>{if(a&&p[U]?a(p[U],U,p):!0){const X=L?A[U]:f3e(t.options,q);return O(q,L,X)}return Promise.resolve(R(q,A[U],p[U]))})}return I.then(L=>({pages:L,pageParams:v}))}}}}function f3e(t,e){return t.getNextPageParam==null?void 0:t.getNextPageParam(e[e.length-1],e)}function jrr(t,e){return t.getPreviousPageParam==null?void 0:t.getPreviousPageParam(e[0],e)}class _Qe{constructor(e={}){this.queryCache=e.queryCache||new Urr,this.mutationCache=e.mutationCache||new Vrr,this.logger=e.logger||Afe,this.defaultOptions=e.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[],this.mountCount=0}mount(){this.mountCount++,this.mountCount===1&&(this.unsubscribeFocus=XV.subscribe(()=>{XV.isFocused()&&(this.resumePausedMutations(),this.queryCache.onFocus())}),this.unsubscribeOnline=ZV.subscribe(()=>{ZV.isOnline()&&(this.resumePausedMutations(),this.queryCache.onOnline())}))}unmount(){var e,r;this.mountCount--,this.mountCount===0&&((e=this.unsubscribeFocus)==null||e.call(this),this.unsubscribeFocus=void 0,(r=this.unsubscribeOnline)==null||r.call(this),this.unsubscribeOnline=void 0)}isFetching(e,r){const[i]=wb(e,r);return i.fetchStatus="fetching",this.queryCache.findAll(i).length}isMutating(e){return this.mutationCache.findAll({...e,fetching:!0}).length}getQueryData(e,r){var i;return(i=this.queryCache.find(e,r))==null?void 0:i.state.data}ensureQueryData(e,r,i){const n=r5(e,r,i),s=this.getQueryData(n.queryKey);return s?Promise.resolve(s):this.fetchQuery(n)}getQueriesData(e){return this.getQueryCache().findAll(e).map(({queryKey:r,state:i})=>{const n=i.data;return[r,n]})}setQueryData(e,r,i){const n=this.queryCache.find(e),s=n==null?void 0:n.state.data,o=Prr(r,s);if(typeof o>"u")return;const a=r5(e),l=this.defaultQueryOptions(a);return this.queryCache.build(this,l).setData(o,{...i,manual:!0})}setQueriesData(e,r,i){return Za.batch(()=>this.getQueryCache().findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,r,i)]))}getQueryState(e,r){var i;return(i=this.queryCache.find(e,r))==null?void 0:i.state}removeQueries(e,r){const[i]=wb(e,r),n=this.queryCache;Za.batch(()=>{n.findAll(i).forEach(s=>{n.remove(s)})})}resetQueries(e,r,i){const[n,s]=wb(e,r,i),o=this.queryCache,a={type:"active",...n};return Za.batch(()=>(o.findAll(n).forEach(l=>{l.reset()}),this.refetchQueries(a,s)))}cancelQueries(e,r,i){const[n,s={}]=wb(e,r,i);typeof s.revert>"u"&&(s.revert=!0);const o=Za.batch(()=>this.queryCache.findAll(n).map(a=>a.cancel(s)));return Promise.all(o).then(pf).catch(pf)}invalidateQueries(e,r,i){const[n,s]=wb(e,r,i);return Za.batch(()=>{var o,a;if(this.queryCache.findAll(n).forEach(c=>{c.invalidate()}),n.refetchType==="none")return Promise.resolve();const l={...n,type:(o=(a=n.refetchType)!=null?a:n.type)!=null?o:"active"};return this.refetchQueries(l,s)})}refetchQueries(e,r,i){const[n,s]=wb(e,r,i),o=Za.batch(()=>this.queryCache.findAll(n).filter(l=>!l.isDisabled()).map(l=>{var c;return l.fetch(void 0,{...s,cancelRefetch:(c=s==null?void 0:s.cancelRefetch)!=null?c:!0,meta:{refetchPage:n.refetchPage}})}));let a=Promise.all(o).then(pf);return s!=null&&s.throwOnError||(a=a.catch(pf)),a}fetchQuery(e,r,i){const n=r5(e,r,i),s=this.defaultQueryOptions(n);typeof s.retry>"u"&&(s.retry=!1);const o=this.queryCache.build(this,s);return o.isStaleByTime(s.staleTime)?o.fetch(s):Promise.resolve(o.state.data)}prefetchQuery(e,r,i){return this.fetchQuery(e,r,i).then(pf).catch(pf)}fetchInfiniteQuery(e,r,i){const n=r5(e,r,i);return n.behavior=Grr(),this.fetchQuery(n)}prefetchInfiniteQuery(e,r,i){return this.fetchInfiniteQuery(e,r,i).then(pf).catch(pf)}resumePausedMutations(){return this.mutationCache.resumePausedMutations()}getQueryCache(){return this.queryCache}getMutationCache(){return this.mutationCache}getLogger(){return this.logger}getDefaultOptions(){return this.defaultOptions}setDefaultOptions(e){this.defaultOptions=e}setQueryDefaults(e,r){const i=this.queryDefaults.find(n=>HT(e)===HT(n.queryKey));i?i.defaultOptions=r:this.queryDefaults.push({queryKey:e,defaultOptions:r})}getQueryDefaults(e){if(!e)return;const r=this.queryDefaults.find(i=>YV(e,i.queryKey));return r==null?void 0:r.defaultOptions}setMutationDefaults(e,r){const i=this.mutationDefaults.find(n=>HT(e)===HT(n.mutationKey));i?i.defaultOptions=r:this.mutationDefaults.push({mutationKey:e,defaultOptions:r})}getMutationDefaults(e){if(!e)return;const r=this.mutationDefaults.find(i=>YV(e,i.mutationKey));return r==null?void 0:r.defaultOptions}defaultQueryOptions(e){if(e!=null&&e._defaulted)return e;const r={...this.defaultOptions.queries,...this.getQueryDefaults(e==null?void 0:e.queryKey),...e,_defaulted:!0};return!r.queryHash&&r.queryKey&&(r.queryHash=gfe(r.queryKey,r)),typeof r.refetchOnReconnect>"u"&&(r.refetchOnReconnect=r.networkMode!=="always"),typeof r.useErrorBoundary>"u"&&(r.useErrorBoundary=!!r.suspense),r}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...this.defaultOptions.mutations,...this.getMutationDefaults(e==null?void 0:e.mutationKey),...e,_defaulted:!0}}clear(){this.queryCache.clear(),this.mutationCache.clear()}}class Hrr extends PF{constructor(e,r){super(),this.client=e,this.options=r,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(r)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.length===1&&(this.currentQuery.addObserver(this),m3e(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.listeners.length||this.destroy()}shouldFetchOnReconnect(){return zoe(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return zoe(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=[],this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(e,r){const i=this.options,n=this.currentQuery;if(this.options=this.client.defaultQueryOptions(e),u3e(i,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=i.queryKey),this.updateQuery();const s=this.hasListeners();s&&g3e(this.currentQuery,n,this.options,i)&&this.executeFetch(),this.updateResult(r),s&&(this.currentQuery!==n||this.options.enabled!==i.enabled||this.options.staleTime!==i.staleTime)&&this.updateStaleTimeout();const o=this.computeRefetchInterval();s&&(this.currentQuery!==n||this.options.enabled!==i.enabled||o!==this.currentRefetchInterval)&&this.updateRefetchInterval(o)}getOptimisticResult(e){const r=this.client.getQueryCache().build(this.client,e);return this.createResult(r,e)}getCurrentResult(){return this.currentResult}trackResult(e){const r={};return Object.keys(e).forEach(i=>{Object.defineProperty(r,i,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(i),e[i])})}),r}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:e,...r}={}){return this.fetch({...r,meta:{refetchPage:e}})}fetchOptimistic(e){const r=this.client.defaultQueryOptions(e),i=this.client.getQueryCache().build(this.client,r);return i.isFetchingOptimistic=!0,i.fetch().then(()=>this.createResult(i,r))}fetch(e){var r;return this.executeFetch({...e,cancelRefetch:(r=e.cancelRefetch)!=null?r:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(e){this.updateQuery();let r=this.currentQuery.fetch(this.options,e);return e!=null&&e.throwOnError||(r=r.catch(pf)),r}updateStaleTimeout(){if(this.clearStaleTimeout(),cN||this.currentResult.isStale||!koe(this.options.staleTime))return;const r=dQe(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},r)}computeRefetchInterval(){var e;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(e=this.options.refetchInterval)!=null?e:!1}updateRefetchInterval(e){this.clearRefetchInterval(),this.currentRefetchInterval=e,!(cN||this.options.enabled===!1||!koe(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||XV.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(e,r){const i=this.currentQuery,n=this.options,s=this.currentResult,o=this.currentResultState,a=this.currentResultOptions,l=e!==i,c=l?e.state:this.currentQueryInitialState,u=l?this.currentResult:this.previousQueryResult,{state:d}=e;let{dataUpdatedAt:p,error:A,errorUpdatedAt:v,fetchStatus:b,status:S}=d,E=!1,R=!1,O;if(r._optimisticResults){const U=this.hasListeners(),q=!U&&m3e(e,r),Z=U&&g3e(e,i,r,n);(q||Z)&&(b=cq(e.options.networkMode)?"fetching":"paused",p||(S="loading")),r._optimisticResults==="isRestoring"&&(b="idle")}if(r.keepPreviousData&&!d.dataUpdatedAt&&u!=null&&u.isSuccess&&S!=="error")O=u.data,p=u.dataUpdatedAt,S=u.status,E=!0;else if(r.select&&typeof d.data<"u")if(s&&d.data===(o==null?void 0:o.data)&&r.select===this.selectFn)O=this.selectResult;else try{this.selectFn=r.select,O=r.select(d.data),O=Boe(s==null?void 0:s.data,O,r),this.selectResult=O,this.selectError=null}catch(U){this.selectError=U}else O=d.data;if(typeof r.placeholderData<"u"&&typeof O>"u"&&S==="loading"){let U;if(s!=null&&s.isPlaceholderData&&r.placeholderData===(a==null?void 0:a.placeholderData))U=s.data;else if(U=typeof r.placeholderData=="function"?r.placeholderData():r.placeholderData,r.select&&typeof U<"u")try{U=r.select(U),this.selectError=null}catch(q){this.selectError=q}typeof U<"u"&&(S="success",O=Boe(s==null?void 0:s.data,U,r),R=!0)}this.selectError&&(A=this.selectError,O=this.selectResult,v=Date.now(),S="error");const I=b==="fetching",N=S==="loading",L=S==="error";return{status:S,fetchStatus:b,isLoading:N,isSuccess:S==="success",isError:L,isInitialLoading:N&&I,data:O,dataUpdatedAt:p,error:A,errorUpdatedAt:v,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>c.dataUpdateCount||d.errorUpdateCount>c.errorUpdateCount,isFetching:I,isRefetching:I&&!N,isLoadingError:L&&d.dataUpdatedAt===0,isPaused:b==="paused",isPlaceholderData:R,isPreviousData:E,isRefetchError:L&&d.dataUpdatedAt!==0,isStale:yfe(e,r),refetch:this.refetch,remove:this.remove}}updateResult(e){const r=this.currentResult,i=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,u3e(i,r))return;this.currentResult=i;const n={cache:!0},s=()=>{if(!r)return!0;const{notifyOnChangeProps:o}=this.options;if(o==="all"||!o&&!this.trackedProps.size)return!0;const a=new Set(o??this.trackedProps);return this.options.useErrorBoundary&&a.add("error"),Object.keys(this.currentResult).some(l=>{const c=l;return this.currentResult[c]!==r[c]&&a.has(c)})};(e==null?void 0:e.listeners)!==!1&&s()&&(n.listeners=!0),this.notify({...n,...e})}updateQuery(){const e=this.client.getQueryCache().build(this.client,this.options);if(e===this.currentQuery)return;const r=this.currentQuery;this.currentQuery=e,this.currentQueryInitialState=e.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(r==null||r.removeObserver(this),e.addObserver(this))}onQueryUpdate(e){const r={};e.type==="success"?r.onSuccess=!e.manual:e.type==="error"&&!RU(e.error)&&(r.onError=!0),this.updateResult(r),this.hasListeners()&&this.updateTimers()}notify(e){Za.batch(()=>{if(e.onSuccess){var r,i,n,s;(r=(i=this.options).onSuccess)==null||r.call(i,this.currentResult.data),(n=(s=this.options).onSettled)==null||n.call(s,this.currentResult.data,null)}else if(e.onError){var o,a,l,c;(o=(a=this.options).onError)==null||o.call(a,this.currentResult.error),(l=(c=this.options).onSettled)==null||l.call(c,void 0,this.currentResult.error)}e.listeners&&this.listeners.forEach(u=>{u(this.currentResult)}),e.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function qrr(t,e){return e.enabled!==!1&&!t.state.dataUpdatedAt&&!(t.state.status==="error"&&e.retryOnMount===!1)}function m3e(t,e){return qrr(t,e)||t.state.dataUpdatedAt>0&&zoe(t,e,e.refetchOnMount)}function zoe(t,e,r){if(e.enabled!==!1){const i=typeof r=="function"?r(t):r;return i==="always"||i!==!1&&yfe(t,e)}return!1}function g3e(t,e,r,i){return r.enabled!==!1&&(t!==e||i.enabled===!1)&&(!r.suspense||t.state.status!=="error")&&yfe(t,r)}function yfe(t,e){return t.isStaleByTime(e.staleTime)}var Voe={},Wrr={get exports(){return Voe},set exports(t){Voe=t}},vQe={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GO=xs;function Qrr(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Yrr=typeof Object.is=="function"?Object.is:Qrr,Xrr=GO.useState,Zrr=GO.useEffect,Jrr=GO.useLayoutEffect,Krr=GO.useDebugValue;function eir(t,e){var r=e(),i=Xrr({inst:{value:r,getSnapshot:e}}),n=i[0].inst,s=i[1];return Jrr(function(){n.value=r,n.getSnapshot=e,jZ(n)&&s({inst:n})},[t,r,e]),Zrr(function(){return jZ(n)&&s({inst:n}),t(function(){jZ(n)&&s({inst:n})})},[t]),Krr(r),r}function jZ(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Yrr(t,r)}catch{return!0}}function tir(t,e){return e()}var rir=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?tir:eir;vQe.useSyncExternalStore=GO.useSyncExternalStore!==void 0?GO.useSyncExternalStore:rir;(function(t){t.exports=vQe})(Wrr);const iir=Voe.useSyncExternalStore,A3e=xs.createContext(void 0),bQe=xs.createContext(!1);function wQe(t,e){return t||(e&&typeof window<"u"?(window.ReactQueryClientContext||(window.ReactQueryClientContext=A3e),window.ReactQueryClientContext):A3e)}const nir=({context:t}={})=>{const e=xs.useContext(wQe(t,xs.useContext(bQe)));if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},sir=({client:t,children:e,context:r,contextSharing:i=!1})=>{xs.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]);const n=wQe(r,i);return xs.createElement(bQe.Provider,{value:!r&&i},xs.createElement(n.Provider,{value:t},e))},xQe=xs.createContext(!1),oir=()=>xs.useContext(xQe);xQe.Provider;function air(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}const lir=xs.createContext(air()),cir=()=>xs.useContext(lir);function uir(t,e){return typeof t=="function"?t(...e):!!t}const hir=(t,e)=>{(t.suspense||t.useErrorBoundary)&&(e.isReset()||(t.retryOnMount=!1))},dir=t=>{xs.useEffect(()=>{t.clearReset()},[t])},pir=({result:t,errorResetBoundary:e,useErrorBoundary:r,query:i})=>t.isError&&!e.isReset()&&!t.isFetching&&uir(r,[t.error,i]),fir=t=>{t.suspense&&typeof t.staleTime!="number"&&(t.staleTime=1e3)},mir=(t,e)=>t.isLoading&&t.isFetching&&!e,gir=(t,e,r)=>(t==null?void 0:t.suspense)&&mir(e,r),Air=(t,e,r)=>e.fetchOptimistic(t).then(({data:i})=>{t.onSuccess==null||t.onSuccess(i),t.onSettled==null||t.onSettled(i,null)}).catch(i=>{r.clearReset(),t.onError==null||t.onError(i),t.onSettled==null||t.onSettled(void 0,i)});function yir(t,e){const r=nir({context:t.context}),i=oir(),n=cir(),s=r.defaultQueryOptions(t);s._optimisticResults=i?"isRestoring":"optimistic",s.onError&&(s.onError=Za.batchCalls(s.onError)),s.onSuccess&&(s.onSuccess=Za.batchCalls(s.onSuccess)),s.onSettled&&(s.onSettled=Za.batchCalls(s.onSettled)),fir(s),hir(s,n),dir(n);const[o]=xs.useState(()=>new e(r,s)),a=o.getOptimisticResult(s);if(iir(xs.useCallback(l=>i?()=>{}:o.subscribe(Za.batchCalls(l)),[o,i]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),xs.useEffect(()=>{o.setOptions(s,{listeners:!1})},[s,o]),gir(s,a,i))throw Air(s,o,n);if(pir({result:a,errorResetBoundary:n,useErrorBoundary:s.useErrorBoundary,query:o.getCurrentQuery()}))throw a.error;return s.notifyOnChangeProps?a:o.trackResult(a)}function y3e(t,e,r){const i=r5(t,e,r);return yir(i,Hrr)}new _Qe;function _ir(){return fetch("https://order-pickup.s3.amazonaws.com/csb_statistics.json").then(t=>t.json())}function vir(){return fetch("https://order-pickup.s3.amazonaws.com/csb_counts_by_h3.json").then(t=>t.json())}function bir(){const t=y3e(["csbStatistics"],()=>_ir()),e=y3e(["h3Counts"],()=>vir());return Po("div",{className:"App",children:[qr(wir,{}),Po(EHt,{children:[qr(SHt,{query:t}),qr("hr",{}),qr(CHt,{query:t}),qr("hr",{}),qr(Orr,{query:t})]}),qr(THt,{query:e}),qr(xir,{})]})}function wir(){return qr("div",{className:"HeaderPanel",children:qr("header",{children:qr("h2",{children:"Crowdsourced Bathymetry Pointstore Dashboard"})})})}function xir(){return qr("div",{className:"FooterPanel",children:qr("footer",{})})}const Tir=new _Qe;HZ.createRoot(document.getElementById("root")).render(qr(wXe.StrictMode,{children:qr(sir,{client:Tir,children:qr(bir,{})})}));export{Eu as $,Ao as A,ps as B,k as C,zn as D,nt as E,w4e as F,Ol as G,Uhe as H,Qn as I,Pl as J,G as K,Bvr as L,fh as M,mm as N,co as O,tvt as P,y5 as Q,ur as R,s9t as S,pe as T,ns as U,Bat as V,vE as W,Ncr as X,iIe as Y,fG as Z,be as _,yt as a,Y5 as a$,Qae as a0,Jh as a1,Dbt as a2,oi as a3,Pm as a4,CN as a5,cm as a6,Ht as a7,wge as a8,OS as a9,vS as aA,Flr as aB,lRe as aC,jne as aD,XO as aE,Vor as aF,mgt as aG,br as aH,fE as aI,r1 as aJ,an as aK,St as aL,ey as aM,Je as aN,FR as aO,gt as aP,Ct as aQ,fge as aR,oue as aS,uDe as aT,$ft as aU,Ift as aV,Bo as aW,nw as aX,Xae as aY,Act as aZ,DA as a_,bG as aa,_E as ab,Ws as ac,oIt as ad,oa as ae,DN as af,CPe as ag,Asr as ah,fst as ai,xA as aj,ar as ak,jgt as al,Gf as am,vo as an,Bir as ao,QJ as ap,T2 as aq,DR as ar,n9t as as,en as at,xN as au,Ra as av,ic as aw,y2 as ax,kRe as ay,fn as az,Q as b,ct as b$,Rm as b0,DG as b1,$s as b2,Lir as b3,Op as b4,zo as b5,z as b6,Pt as b7,CO as b8,Ta as b9,ji as bA,yp as bB,Le as bC,TK as bD,jS as bE,Lj as bF,D as bG,bd as bH,P1 as bI,ht as bJ,Ft as bK,Bi as bL,qi as bM,zi as bN,Di as bO,Pr as bP,_h as bQ,Gr as bR,VA as bS,uw as bT,ae as bU,Xa as bV,Rl as bW,Yt as bX,Vr as bY,Xi as bZ,Ve as b_,jde as ba,ME as bb,Ar as bc,m2 as bd,GBe as be,Qe as bf,N_r as bg,fa as bh,k_r as bi,Qsr as bj,Jst as bk,sT as bl,D_r as bm,_z as bn,l1 as bo,En as bp,Jsr as bq,Kpr as br,Ui as bs,To as bt,B9e as bu,js as bv,WG as bw,fs as bx,AL as by,ti as bz,_A as c,vW as c$,Oe as c0,Cc as c1,pn as c2,aIe as c3,U_r as c4,B_r as c5,V_r as c6,nce as c7,vc as c8,ylt as c9,KP as cA,El as cB,wG as cC,Rcr as cD,jo as cE,qn as cF,il as cG,kA as cH,Kt as cI,Ye as cJ,BD as cK,ZD as cL,egt as cM,Jfr as cN,Kfr as cO,zD as cP,EPt as cQ,Cfr as cR,Smr as cS,xlr as cT,QD as cU,yTt as cV,xor as cW,TG as cX,ew as cY,tL as cZ,tce as c_,wr as ca,FG as cb,Zsr as cc,kt as cd,Hm as ce,Ji as cf,ki as cg,Nvr as ch,Ybt as ci,aAr as cj,xS as ck,Xgt as cl,$1 as cm,oA as cn,Ocr as co,ZG as cp,sIe as cq,iDe as cr,J$ as cs,s4e as ct,Pcr as cu,fi as cv,Rir as cw,Pe as cx,pz as cy,n6 as cz,Cir as d,vfr as d$,h2 as d0,VJ as d1,FD as d2,wS as d3,He as d4,yi as d5,NMe as d6,nd as d7,ze as d8,aue as d9,tn as dA,_9 as dB,rl as dC,i7e as dD,wd as dE,TUt as dF,alt as dG,vor as dH,Wxe as dI,bR as dJ,eO as dK,mat as dL,Jf as dM,ph as dN,Tor as dO,Fr as dP,wo as dQ,IBe as dR,tP as dS,Hr as dT,LDe as dU,NDe as dV,Mfr as dW,WO as dX,o$e as dY,F_r as dZ,wrt as d_,x4e as da,Nm as db,NG as dc,sce as dd,Kr as de,yd as df,qs as dg,xge as dh,up as di,uIe as dj,Ql as dk,Vb as dl,nh as dm,PD as dn,NR as dp,Yf as dq,e0 as dr,_at as ds,Ot as dt,r3t as du,kvr as dv,tO as dw,Sc as dx,Bze as dy,$t as dz,h as e,ayr as e$,jJe as e0,Te as e1,_G as e2,K_ as e3,xsr as e4,vsr as e5,XG as e6,Ece as e7,b_ as e8,Jur as e9,z6t as eA,pu as eB,wlr as eC,kae as eD,Nir as eE,Anr as eF,NA as eG,T$e as eH,S$e as eI,Oa as eJ,NOe as eK,bPe as eL,X9t as eM,HGt as eN,Xt as eO,_t as eP,xr as eQ,kte as eR,aW as eS,jIe as eT,WJ as eU,mse as eV,syr as eW,fyr as eX,bUe as eY,mxe as eZ,nyr as e_,Vn as ea,Bz as eb,Im as ec,xn as ed,e1r as ee,ynr as ef,np as eg,Wae as eh,Jir as ei,_L as ej,fle as ek,ln as el,Wm as em,Ofr as en,Ifr as eo,_6e as ep,lm as eq,LPt as er,eUt as es,z_r as et,Zb as eu,wlt as ev,Cl as ew,sj as ex,b1e as ey,bge as ez,rt as f,ua as f$,ryr as f0,kk as f1,PX as f2,dk as f3,nU as f4,Bm as f5,zt as f6,Ynr as f7,Zf as f8,Ode as f9,CIt as fA,Xsr as fB,Bfr as fC,Ufr as fD,a1 as fE,hO as fF,td as fG,wl as fH,pAr as fI,Nde as fJ,Pfr as fK,wke as fL,rc as fM,anr as fN,x2 as fO,um as fP,ep as fQ,V6 as fR,wfr as fS,Vge as fT,gfr as fU,JPt as fV,UG as fW,yE as fX,UFt as fY,bde as fZ,HN as f_,vf as fa,pxe as fb,st as fc,_8t as fd,v8t as fe,iw as ff,AE as fg,rP as fh,Mr as fi,Nmt as fj,mI as fk,Wlr as fl,BG as fm,Qlr as fn,$N as fo,Ylr as fp,zG as fq,ON as fr,_Ne as fs,Nst as ft,qlr as fu,xfr as fv,zat as fw,I2 as fx,kFt as fy,RIt as fz,nn as g,Nlr as g$,i1 as g0,nIe as g1,s6t as g2,$ir as g3,L1t as g4,Wnr as g5,mh as g6,$lr as g7,Su as g8,p2t as g9,j2 as gA,aH as gB,kde as gC,sH as gD,SP as gE,j$t as gF,ohe as gG,xP as gH,IA as gI,Yet as gJ,Lm as gK,aIt as gL,Fkt as gM,XJe as gN,ZJe as gO,Dhe as gP,fhe as gQ,G_r as gR,$he as gS,HS as gT,Ka as gU,Tm as gV,$4t as gW,Es as gX,Ml as gY,rce as gZ,ds as g_,aur as ga,Ayr as gb,ope as gc,wsr as gd,Zi as ge,sp as gf,$m as gg,Zhr as gh,xo as gi,XT as gj,bs as gk,pee as gl,$6t as gm,pd as gn,uh as go,U$e as gp,Sp as gq,_r as gr,ut as gs,ry as gt,dr as gu,jm as gv,I1 as gw,Ij as gx,cw as gy,nH as gz,Rr as h,wle as h$,Dye as h0,e1 as h1,Q1t as h2,NNe as h3,nvt as h4,pLe as h5,ugt as h6,Tue as h7,JO as h8,nr as h9,cr as hA,uo as hB,Fc as hC,us as hD,rs as hE,Xl as hF,UA as hG,Cs as hH,lw as hI,cz as hJ,aw as hK,tH as hL,Zpr as hM,pr as hN,E$e as hO,Eor as hP,dlr as hQ,RG as hR,Var as hS,nc as hT,lo as hU,Oar as hV,Crt as hW,Drt as hX,YT as hY,TDe as hZ,wPe as h_,Hi as ha,Y1t as hb,XMe as hc,Ii as hd,bor as he,K$e as hf,xPt as hg,qsr as hh,Uir as hi,$yr as hj,Gsr as hk,A0t as hl,bfr as hm,Kh as hn,gDe as ho,cLe as hp,Zir as hq,mmt as hr,Knr as hs,u2 as ht,s0 as hu,N4t as hv,_p as hw,Vd as hx,Fs as hy,Ni as hz,we as i,_or as i$,znr as i0,xc as i1,nue as i2,Kpt as i3,YR as i4,N0t as i5,asr as i6,TRe as i7,mG as i8,lce as i9,_De as iA,eft as iB,i2e as iC,NIt as iD,Tsr as iE,dfr as iF,_Pe as iG,mnt as iH,ssr as iI,mj as iJ,OA as iK,VN as iL,u0t as iM,_fr as iN,Hgt as iO,ysr as iP,_sr as iQ,bsr as iR,VD as iS,mp as iT,pst as iU,L7e as iV,Pn as iW,$7 as iX,TP as iY,lF as iZ,Xar as i_,RS as ia,WD as ib,kb as ic,fp as id,pot as ie,UR as ig,fot as ih,Lut as ii,bS as ij,Cnr as ik,Ksr as il,fM as im,m5 as io,zge as ip,Yar as iq,sye as ir,Zar as is,csr as it,jle as iu,oOe as iv,Ptt as iw,zar as ix,bDe as iy,xDe as iz,ne as j,D1 as j$,c2 as j0,D6 as j1,Gle as j2,Vle as j3,aDe as j4,nsr as j5,FT as j6,$c as j7,tR as j8,gpt as j9,hA as jA,sct as jB,zor as jC,Uat as jD,pi as jE,Da as jF,Gi as jG,Ds as jH,$a as jI,YM as jJ,Nmr as jK,xle as jL,Xnr as jM,ra as jN,Dnr as jO,$nr as jP,fOe as jQ,dOe as jR,Ele as jS,gor as jT,yor as jU,Aor as jV,iA as jW,mL as jX,Yl as jY,gn as jZ,Ia as j_,Qs as ja,ZT as jb,yS as jc,JD as jd,no as je,qee as jf,Qee as jg,DB as jh,kat as ji,Sl as jj,ML as jk,eit as jl,For as jm,Hat as jn,qat as jo,V2 as jp,IS as jq,od as jr,wor as js,Dor as jt,Lor as ju,US as jv,gK as jw,aR as jx,rve as jy,Dr as jz,ws as k,Gm as k$,PM as k0,Ec as k1,Pmr as k2,ese as k3,Nnr as k4,pK as k5,uj as k6,par as k7,far as k8,mar as k9,Oce as kA,LN as kB,kn as kC,C5 as kD,tj as kE,a4e as kF,Uor as kG,kor as kH,G2t as kI,q2t as kJ,Lnr as kK,Inr as kL,Pnr as kM,bp as kN,PT as kO,RPt as kP,Ile as kQ,f1e as kR,Khr as kS,p1e as kT,qle as kU,fu as kV,Xf as kW,HG as kX,m$t as kY,xu as kZ,$j as k_,gar as ka,Qf as kb,Ns as kc,Z0 as kd,ed as ke,Zue as kf,Xue as kg,QPe as kh,Eo as ki,Et as kj,Gs as kk,Nor as kl,$lt as km,NC as kn,$$e as ko,OFe as kp,pt as kq,sh as kr,S2 as ks,CG as kt,Nle as ku,J_ as kv,F2t as kw,Ko as kx,MFe as ky,y1 as kz,xe as l,Ah as l$,el as l0,T6t as l1,Mir as l2,eS as l3,Lxt as l4,yhr as l5,ghr as l6,Ahr as l7,Por as l8,Fsr as l9,Ior as lA,Hsr as lB,KA as lC,bce as lD,p$e as lE,Um as lF,wO as lG,kr as lH,Jl as lI,oH as lJ,H9e as lK,r7e as lL,tr as lM,Wn as lN,Ysr as lO,Mce as lP,twe as lQ,Ewe as lR,pL as lS,wN as lT,Wr as lU,yf as lV,gge as lW,Cor as lX,Rb as lY,Tp as lZ,fH as l_,f2 as la,Gz as lb,V7e as lc,Xhr as ld,Q2t as le,Q$ as lf,XM as lg,xK as lh,Dc as li,LR as lj,jM as lk,Gae as ll,Kcr as lm,gG as ln,iDt as lo,A$t as lp,YS as lq,vA as lr,mr as ls,jae as lt,Tfr as lu,tA as lv,I8e as lw,bE as lx,Rce as ly,Lsr as lz,$o as m,flr as m$,Nc as m0,cp as m1,Ho as m2,X9e as m3,Ror as m4,GRt as m5,xp as m6,glt as m7,l7e as m8,TO as m9,b1 as mA,Klt as mB,s1 as mC,ij as mD,VSt as mE,Mor as mF,nve as mG,Jhr as mH,wE as mI,hat as mJ,hP as mK,Lgt as mL,Enr as mM,Bgt as mN,O1t as mO,N1t as mP,KDe as mQ,q8t as mR,H8t as mS,LD as mT,iP as mU,eAt as mV,Fir as mW,kmt as mX,inr as mY,Ott as mZ,pfr as m_,VR as ma,Ane as mb,Ade as mc,Znr as md,UJe as me,$or as mf,IH as mg,NB as mh,F$t as mi,Vvr as mj,jvr as mk,Gvr as ml,EN as mm,jsr as mn,lx as mo,d1e as mp,Lg as mq,rL as mr,Ice as ms,JR as mt,Nsr as mu,_Ct as mv,$ce as mw,QIe as mx,ZR as my,X$e as mz,jt as n,t0t as n$,Wmt as n0,Tjt as n1,qnt as n2,tst as n3,t1t as n4,r1t as n5,i1t as n6,QUt as n7,YUt as n8,zUt as n9,xDt as nA,Uar as nB,Nar as nC,Dar as nD,War as nE,qar as nF,kar as nG,Hae as nH,Mft as nI,F0t as nJ,SDe as nK,jar as nL,Gar as nM,Esr as nN,Csr as nO,Ssr as nP,rnt as nQ,Afr as nR,oye as nS,ffr as nT,hd as nU,a0t as nV,Kmt as nW,Unt as nX,Kst as nY,jft as nZ,Jar as n_,nvr as na,lV as nb,p1r as nc,ZUt as nd,rF as ne,bz as nf,bve as ng,pdr as nh,Aat as ni,Pc as nj,cF as nk,gce as nl,wp as nm,vH as nn,t$e as no,n0 as np,gO as nq,Umr as nr,G2 as ns,Fmr as nt,Bmr as nu,kmr as nv,vDt as nw,TDt as nx,bDt as ny,wDt as nz,mge as o,ear as o$,YAe as o0,h0t as o1,Qar as o2,Vot as o3,ylr as o4,jee as o5,d5 as o6,XW as o7,ZW as o8,Oir as o9,Yh as oA,fxe as oB,tc as oC,Lc as oD,Ae as oE,Wg as oF,nL as oG,B5e as oH,Un as oI,kMe as oJ,WM as oK,YRe as oL,xnr as oM,vN as oN,Ket as oO,wm as oP,xG as oQ,_N as oR,knr as oS,Qor as oT,Xor as oU,Z4e as oV,sar as oW,Hht as oX,Ght as oY,Jor as oZ,Kor as o_,Pir as oa,tp as ob,Iar as oc,Iir as od,Zh as oe,o1 as of,qN as og,mu as oh,o_t as oi,Har as oj,pDe as ok,sn as ol,cs as om,Zee as on,umt as oo,hmt as op,xlt as oq,gm as or,Oor as os,Olt as ot,Eir as ou,Att as ov,kR as ow,dle as ox,kJe as oy,pyr as oz,Fn as p,iBt as p$,qor as p0,car as p1,Wor as p2,oar as p3,iar as p4,qut as p5,har as p6,Yor as p7,tar as p8,nar as p9,m7t as pA,rar as pB,Zor as pC,uar as pD,B5 as pE,uwt as pF,ext as pG,h6e as pH,u6e as pI,Sxt as pJ,Ahe as pK,sTt as pL,D6e as pM,vhe as pN,uTt as pO,ZTt as pP,gSt as pQ,NOt as pR,zz as pS,_It as pT,mde as pU,JRt as pV,eE as pW,G7t as pX,IUt as pY,vpe as pZ,eVe as p_,qht as pa,Hor as pb,sgt as pc,eP as pd,Slr as pe,Acr as pf,obt as pg,wtt as ph,ogt as pi,Tlr as pj,alr as pk,XR as pl,x5 as pm,Iee as pn,Elr as po,lar as pp,aar as pq,bjt as pr,yu as ps,K2 as pt,Sjt as pu,oPe as pv,wOe as pw,ZRe as px,Yb as py,oze as pz,wt as q,Yzt as q$,iVe as q0,sBt as q1,oVe as q2,aBt as q3,cVe as q4,cBt as q5,m6 as q6,wW as q7,sot as q8,f6e as q9,GBt as qA,mVe as qB,qBt as qC,yVe as qD,QBt as qE,bVe as qF,PH as qG,lzt as qH,Azt as qI,Mzt as qJ,Ozt as qK,Izt as qL,Mgt as qM,wu as qN,X0 as qO,v0t as qP,Far as qQ,Cle as qR,Xlr as qS,BJe as qT,Jlr as qU,Zlr as qV,Klr as qW,Qnr as qX,e4t as qY,wVe as qZ,hzt as q_,Mxt as qa,Kir as qb,AM as qc,aPe as qd,Ule as qe,gnt as qf,rsr as qg,kle as qh,isr as qi,osr as qj,Wf as qk,p5t as ql,Wle as qm,YA as qn,TN as qo,j4t as qp,Y4t as qq,g4t as qr,v4t as qs,zde as qt,k9t as qu,F9t as qv,SH as qw,U9t as qx,Hz as qy,y$t as qz,lr as r,GDe as r$,Llr as r0,Vgt as r1,iit as r2,tDt as r3,MDt as r4,VNt as r5,cFt as r6,iFt as r7,uLe as r8,ONe as r9,Ure as rA,_j as rB,Kgt as rC,kue as rD,$Ne as rE,vd as rF,i0 as rG,IN as rH,Dnt as rI,$nt as rJ,cnt as rK,sge as rL,bu as rM,yj as rN,Xtt as rO,Ytt as rP,Fnr as rQ,YW as rR,set as rS,evt as rT,lP as rU,gue as rV,IDe as rW,fft as rX,Rmt as rY,mft as rZ,FDe as r_,j1t as ra,tm as rb,YPe as rc,Igt as rd,qRe as re,klr as rf,rAt as rg,nAt as rh,Ngt as ri,xue as rj,kgt as rk,Ugt as rl,M2 as rm,Tn as rn,Fat as ro,$1t as rp,zgt as rq,M1t as rr,qgt as rs,q1t as rt,Age as ru,EPe as rv,Sue as rw,Sj as rx,N_e as ry,tAt as rz,MN as s,v_t as s$,JB as s0,cnr as s1,MDe as s2,D5 as s3,Fgt as s4,lsr as s5,Go as s6,zir as s7,MS as s8,Wsr as s9,KB as sA,Ggt as sB,p2 as sC,C_e as sD,UD as sE,aO as sF,oAt as sG,sAt as sH,J2 as sI,GG as sJ,sue as sK,w_t as sL,Cgt as sM,w1 as sN,z_t as sO,S_t as sP,E_t as sQ,u_t as sR,h_t as sS,d_t as sT,p_t as sU,f_t as sV,m_t as sW,g_t as sX,A_t as sY,y_t as sZ,__t as s_,uO as sa,MO as sb,ANe as sc,Zae as sd,gC as se,yte as sf,ocr as sg,M_t as sh,rB as si,mee as sj,Ajt as sk,Kf as sl,mO as sm,sxt as sn,uhe as so,slt as sp,SE as sq,SG as sr,usr as ss,Tnr as st,Ort as su,$A as sv,PA as sw,HPe as sx,eOe as sy,dme as sz,cn as t,Pde as t$,b_t as t0,INe as t1,YJe as t2,xm as t3,bnr as t4,Fme as t5,gIe as t6,_it as t7,xB as t8,EG as t9,SNe as tA,YE as tB,sO as tC,cle as tD,_Dt as tE,Fp as tF,ddr as tG,hdr as tH,t0r as tI,hDe as tJ,Unr as tK,gdt as tL,L6 as tM,Ute as tN,BSt as tO,llt as tP,olt as tQ,cA as tR,UUe as tS,lS as tT,OSt as tU,Snr as tV,ZUe as tW,KUe as tX,TT as tY,eD as tZ,Jnr as t_,iAt as ta,Dlr as tb,wnr as tc,Bet as td,Eme as te,K as tf,Onr as tg,u4e as th,Ylt as ti,gc as tj,Xbt as tk,az as tl,sVt as tm,plr as tn,HNe as to,Yvt as tp,QNe as tq,jvt as tr,Wx as ts,jue as tt,Gue as tu,Kar as tv,Hue as tw,s1t as tx,o1t as ty,a1t as tz,Pb as u,YDt as u0,qUe as u1,GDt as u2,XUe as u3,QUe as u4,QDt as u5,Ad as u6,ise as u7,Ic as u8,YUe as u9,eF as ua,jDt as ub,bL as uc,Vne as ud,Uj as ue,LIt as uf,_Lt as ug,yLt as uh,ALt as ui,O1 as uj,Qhr as uk,S3 as ul,prt as um,elr as un,_ue as uo,ulr as up,lcr as uq,Sfr as ur,egr as us,Hf as v,M as w,U6t as x,f as y,Fe as z};
