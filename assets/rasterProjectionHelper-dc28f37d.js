import{e6 as H,cZ as Mt,aK as F,W as j,C as G,w as S,$ as L,v as Rt,a7 as N,a9 as Pt,T as bt,jd as T,je as k,jf as ot,jg as St,jh as Et,aL as Nt,ji as it}from"./index-70df4575.js";var D;function ht(t,e,o){return!Pt(t,e,o)}function z(t,e,o){const r=ht(t,e,o);if(r&&!H())throw new bt("rasterprojectionhelper-project","projection engine is not loaded");return r}(function(t){t[t.None=0]="None",t[t.North=1]="North",t[t.South=2]="South",t[t.Both=3]="Both"})(D||(D={}));const st=(t,e,o,r=0)=>{if(o[0]===1)return[0,0];let s=1,n=-1,i=1,u=-1;for(let f=0;f<t.length;f+=2)isNaN(t[f])||(s=s>t[f]?t[f]:s,n=n>t[f]?n:t[f],i=i>t[f+1]?t[f+1]:i,u=u>t[f+1]?u:t[f+1]);const{cols:c,rows:l}=e,a=(n-s)/c/o[0],d=(u-i)/l/o[1],x=2*r;let h=0,m=!1,g=[0,0];for(let f=0;f<c-3;f++){for(let M=0;M<l-3;M++){const y=f*l*2+2*M,p=(t[y]+t[y+4]+t[y+4*l]+t[y+4*l+4])/4,w=(t[y+1]+t[y+5]+t[y+4*l+1]+t[y+4*l+5])/4,R=Math.abs((p-t[y+2*l+2])/a),P=Math.abs((w-t[y+2*l+3])/d);if(R+P>h&&(h=R+P,g=[R,P]),x&&h>x){m=!0;break}}if(m)break}return g},Gt={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},A=32,B=4,K=B,X=new Map,U=new Map,I=500;async function Lt(){H()||await Mt()}function $t(t,e,o){return z(t.spatialReference,e)?o?it(e,t.spatialReference,t):it(t.spatialReference,e,t):null}function At(t,e,o,r=null){const s=t.spatialReference;if(s.equals(e))return t;z(s,e,r);const n=o.center,i=new F({xmin:n.x-t.x/2,xmax:n.x+t.x/2,ymin:n.y-t.y/2,ymax:n.y+t.y/2,spatialReference:s}),u=j(i,e,r),c=v(e);let l;if(G(u)||S(c)&&u.width>=c){const a=L(s)/L(e);l={x:t.x*a,y:t.y*a}}else l={x:u.width,y:u.height};return l}function E(t,e=.01){return L(t)?e/L(t):0}function rt(t,e,o=null,r=!0){const s=t.spatialReference;if(s.equals(e))return t;z(s,e,o);const n=j(t,e,o);return r&&n&&mt([t],[n],s,e),n}function mt(t,e,o,r){const s=Y(o,!0),n=Y(r,!0),i=E(o,I),u=E(r,I);if(i&&S(s)&&S(n))for(let c=0;c<t.length;c++){const l=e[c];if(!l)continue;const{x:a}=t[c],{x:d}=l;d>=n[1]-u&&Math.abs(a-s[0])<i?l.x-=n[1]-n[0]:d<=n[0]+u&&Math.abs(a-s[1])<i&&(l.x+=n[1]-n[0])}}function kt(t){const{inSR:e,outSR:o,datumTransformation:r,preferPE:s}=t;if(e.equals(o)){const{points:n}=Q(t,null);return n}if(e.isWebMercator&&o.isWGS84||e.isWGS84&&o.isWebMercator)return vt(t);if(z(e,o,r)&&s){if(e.isGeographic)return at(t);const n=O(e);if(S(n))return at(t)}return Tt(t)}function Tt(t){const{points:e}=Q(t,null),{inSR:o,outSR:r,datumTransformation:s}=t,n=e.map(u=>new N(u[0],u[1],o)),i=j(n,r,s);return s&&mt(n,i,o,r),i.map(u=>u?[u.x,u.y]:[NaN,NaN])}function at(t){const{inSR:e,outSR:o,datumTransformation:r}=t,s=O(e),{points:n,mask:i}=Q(t,s);if(!e.isGeographic){const c=e.wkid?T.coordsys(e.wkid):T.fromString(e.isGeographic?k.PE_TYPE_GEOGCS:k.PE_TYPE_PROJCS,e.wkt);ot.projToGeog(c,n.length,n)}if(S(r)&&r.steps.length){let c;if(o.isGeographic&&(c=n.map(([a])=>a>179.9955?1:a<-179.9955?-1:0)),r.steps.forEach(a=>{const d=a.wkid?T.geogtran(a.wkid):T.fromString(k.PE_TYPE_GEOGTRAN,a.wkt);St.geogToGeog(d,n.length,n,null,a.isInverse?k.PE_TRANSFORM_2_TO_1:k.PE_TRANSFORM_1_TO_2)}),c)for(let a=0;a<n.length;a++){const d=c[a],x=n[a][0],h=x>179.9955?1:x<-179.9955?-1:0;d&&h&&d!==h&&(n[a][0]=d>0?x+360:x-360)}}if(!o.isGeographic){const c=O(o,!0),l=S(c)&&c.isEnvelope?[c.bbox[1],c.bbox[3]]:[-90,90];Ct(n,l);const a=o.wkid?T.coordsys(o.wkid):T.fromString(o.isGeographic?k.PE_TYPE_GEOGCS:k.PE_TYPE_PROJCS,o.wkt);ot.geogToProj(a,n.length,n)}let u=n;if(i&&n.length!==i.length){u=[];for(let c=0,l=0;c<i.length;c++)i[c]?u.push(n[l++]):u.push([NaN,NaN])}return u}function vt(t){const{cols:e,rows:o,xres:r,yres:s,usePixelCenter:n,inSR:i,outSR:u}=t;let{xmin:c,ymax:l}=t;n&&(c+=r/2,l-=s/2);const a=[],d=[],x=Math.max(e,o);for(let m=0;m<x;m++){const g=c+r*Math.min(e,m),f=l-s*Math.min(o,m),M=j(new N({x:g,y:f,spatialReference:i}),u);m<=e&&a.push(M.x),m<=o&&d.push(M.y)}const h=[];for(let m=0;m<e;m++)for(let g=0;g<o;g++)h.push([a[m],d[g]]);return h}function O(t,e=!1){let o=t.wkid||t.wkt;if(!o||t.isGeographic)return null;if(o=String(o),X.has(o)){const i=X.get(o);return e?i==null?void 0:i.gcs:i==null?void 0:i.pcs}const r=t.wkid?T.coordsys(t.wkid):T.fromString(t.isGeographic?k.PE_TYPE_GEOGCS:k.PE_TYPE_PROJCS,t.wkt),s=lt(r,E(t,1e-4)),n=lt(r,0,!0);return X.set(o,{pcs:s,gcs:n}),e?n:s}function lt(t,e=0,o=!1){const r=Et.generate(t),s=o?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!r||!(s!=null&&s.length))return null;let n=!1,i=s.find(f=>f.getInclusive()===1&&f.getKind()===1);if(!i){if(i=s.find(f=>f.getInclusive()===1&&f.getKind()===0),!i)return null;n=!0}const u=o?0:(r.getNorthPoleLocation()===2?1:0)|(r.getSouthPoleLocation()===2?2:0),c=r.isPannableRectangle(),l=i.getCoord();if(n)return{isEnvelope:n,isPannable:c,vertices:l,coef:null,bbox:[l[0][0]-e,l[0][1]-e,l[1][0]+e,l[1][1]+e],poleLocation:u};let a=0;const d=[];let[x,h]=l[0],[m,g]=l[0];for(let f=0,M=l.length;f<M;f++){a++,a===M&&(a=0);const[y,p]=l[f],[w,R]=l[a];if(R===p)d.push([y,w,p,R,2]);else{const P=(w-y)/(R-p||1e-4),C=y-P*p;p<R?d.push([P,C,p,R,0]):d.push([P,C,R,p,1])}x=x<y?x:y,h=h<p?h:p,m=m>y?m:y,g=g>p?g:p}return{isEnvelope:!1,isPannable:c,vertices:l,coef:d,bbox:[x,h,m,g],poleLocation:u}}function Q(t,e){const o=[],{cols:r,rows:s,xres:n,yres:i,usePixelCenter:u}=t;let{xmin:c,ymax:l}=t;if(u&&(c+=n/2,l-=i/2),G(e)){for(let h=0;h<r;h++)for(let m=0;m<s;m++)o.push([c+n*h,l-i*m]);return{points:o}}const a=new Uint8Array(r*s);if(e.isEnvelope){const{bbox:[h,m,g,f]}=e;for(let M=0,y=0;M<r;M++){const p=c+n*M,w=e.isPannable||p>=h&&p<=g;for(let R=0;R<s;R++,y++){const P=l-i*R;w&&P>=m&&P<=f&&(o.push([p,P]),a[y]=1)}}return{points:o,mask:a}}const d=e.coef,x=[];for(let h=0;h<s;h++){const m=l-i*h,g=[],f=[];for(let y=0;y<d.length;y++){const[p,w,R,P,C]=d[y];if(m===R&&R===P)g.push(p),g.push(w),f.push(2),f.push(2);else if(m>=R&&m<=P){const $=p*m+w;g.push($),f.push(C)}}let M=g;if(g.length>2){let y=f[0]===2?0:f[0],p=g[0];M=[];for(let w=1;w<f.length;w++)f[w]===2&&w!==f.length-1||(f[w]!==y&&(M.push(y===0?Math.min(p,g[w-1]):Math.max(p,g[w-1])),y=f[w],p=g[w]),w===f.length-1&&M.push(f[w]===0?Math.min(p,g[w]):Math.max(p,g[w])));M.sort((w,R)=>w-R)}else g[0]>g[1]&&(M=[g[1],g[0]]);x.push(M)}for(let h=0,m=0;h<r;h++){const g=c+n*h;for(let f=0;f<s;f++,m++){const M=l-i*f,y=x[f];if(y.length===2)g>=y[0]&&g<=y[1]&&(o.push([g,M]),a[m]=1);else if(y.length>2){let p=!1;for(let w=0;w<y.length;w+=2)if(g>=y[w]&&g<=y[w+1]){p=!0;break}p&&(o.push([g,M]),a[m]=1)}}}return{points:o,mask:a}}function Ct(t,e){const[o,r]=e;for(let s=0;s<t.length;s++){const n=t[s][1];(n<o||n>r)&&(t[s]=[NaN,NaN])}}function xt(t){const e=v(t[0].spatialReference);if(t.length<2||G(e))return t[0];let{xmin:o,xmax:r,ymin:s,ymax:n}=t[0];for(let i=1;i<t.length;i++){const u=t[i];r=u.xmax+e*i,s=Math.min(s,u.ymin),n=Math.max(n,u.ymax)}return new F({xmin:o,xmax:r,ymin:s,ymax:n,spatialReference:t[0].spatialReference})}function _t(t,e,o=null,r=!0){const s=t.spatialReference;if(s.equals(e))return t;const n=jt(t),i=v(s,!0),u=v(e);if(n===0||G(i)||G(u)){const l=ct(t,e,o,r);if(G(i)&&S(u)&&Math.abs(l.width-u)<E(e)&&H()){const a=O(s);if(S(a)&&a.poleLocation===D.None&&t.width<(a.bbox[2]-a.bbox[0])/2)return Ot(t,e)||l}return l}const c=t.clone().normalize();if(c.length===1&&t.xmax<i&&t.xmax-i/2>E(s)){const{xmin:l,xmax:a}=t;for(let d=0;d<=n;d++){const x=d===0?l:-i/2,h=d===n?a-i*d:i/2;c[d]=new F({xmin:x,xmax:h,ymin:t.ymin,ymax:t.ymax,spatialReference:s})}}return xt(c.map(l=>ct(l,e,o,r)).filter(S))}function Ot(t,e){const o=v(e);if(G(o))return null;let{xmin:r,ymin:s,xmax:n,ymax:i}=t;const u=t.spatialReference,c=new Rt({spatialReference:u,rings:[[[r,s],[n,s],[n,i],[r,i],[r,s]]]}),l=j(c,e);if(l.rings.length!==2||!l.rings[0].length||!l.rings[1].length)return null;const{rings:a}=l,d=E(u),x=new F({spatialReference:e});for(let h=0;h<2;h++){r=n=a[h][0][0],s=i=a[h][0][1];for(let m=0;m<a[h].length;m++)r=r>a[h][m][0]?a[h][m][0]:r,n=n<a[h][m][0]?a[h][m][0]:n,s=s>a[h][m][1]?a[h][m][1]:s,i=i<a[h][m][1]?a[h][m][1]:i;if(h===0)x.ymin=s,x.ymax=i,x.xmin=r,x.xmax=n;else if(x.ymin=Math.min(x.ymin,s),x.ymax=Math.max(x.ymax,i),Math.abs(n-o/2)<d)x.xmin=r,x.xmax=x.xmax+o;else{if(!(Math.abs(r+o/2)<d))return null;x.xmax=n+o}}return x}function ct(t,e,o=null,r=!0,s=!0){const n=t.spatialReference;if(n.equals(e)||!e)return t;z(n,e,o);const i=j(t,e,o);if(s&&e.isWebMercator&&i&&(i.ymax=Math.min(20037508342787e-6,i.ymax),i.ymin=Math.max(-20037508342787e-6,i.ymin),i.ymin>=i.ymax))return null;if(!r||!i)return i;const u=Y(n,!0),c=Y(e,!0);if(G(u)||G(c))return i;const l=E(n,.001),a=E(n,I),d=E(e,.001);if(Math.abs(i.xmin-c[0])<d&&Math.abs(i.xmax-c[1])<d){const x=Math.abs(t.xmin-u[0]),h=Math.abs(u[1]-t.xmax);if(x<l&&h>a){i.xmin=c[0];const m=[];m.push(new N(t.xmax,t.ymin,n)),m.push(new N(t.xmax,(t.ymin+t.ymax)/2,n)),m.push(new N(t.xmax,t.ymax,n));const g=m.map(f=>rt(f,e,o)).filter(f=>!isNaN(f==null?void 0:f.x)).map(f=>f.x);i.xmax=Math.max.apply(null,g)}if(h<l&&x>a){i.xmax=c[1];const m=[];m.push(new N(t.xmin,t.ymin,n)),m.push(new N(t.xmin,(t.ymin+t.ymax)/2,n)),m.push(new N(t.xmin,t.ymax,n));const g=m.map(f=>rt(f,e,o)).filter(f=>!isNaN(f==null?void 0:f.x)).map(f=>f.x);i.xmin=Math.min.apply(null,g)}}else{const x=E(e,.001);Math.abs(i.xmin-c[0])<x&&(i.xmin=c[0]),Math.abs(i.xmax-c[1])<x&&(i.xmax=c[1])}return i}function v(t,e=!1){if(!t)return null;const o=e?20037508342787e-6:20037508342788905e-9;return t.isWebMercator?2*o:t.wkid&&t.isGeographic?360:2*Gt[t.wkid]||null}function Y(t,e=!1){if(t.isGeographic)return[-180,180];const o=v(t,e);return S(o)?[-o/2,o/2]:null}function ft(t,e,o,r){let s=(t-e)/o;return s-Math.floor(s)!=0?s=Math.floor(s):r&&(s-=1),s}function jt(t,e=!1){const o=v(t.spatialReference);if(G(o))return 0;const r=e?0:-(o/2),s=E(t.spatialReference),n=!e&&Math.abs(t.xmax-o/2)<s?o/2:t.xmax,i=!e&&Math.abs(t.xmin+o/2)<s?-o/2:t.xmin;return ft(n,r,o,!0)-ft(i,r,o,!1)}function Bt(t){const e=t.storageInfo.origin.x,o=v(t.spatialReference,!0);if(G(o))return{originX:e,halfWorldWidth:null,pyramidsInfo:null};const r=o/2,{nativePixelSize:s,storageInfo:n,extent:i}=t,{maximumPyramidLevel:u,blockWidth:c,pyramidScalingFactor:l}=n;let a=s.x;const d=[],x=S(t.transform)&&t.transform.type==="gcs-shift",h=e+(x?0:r),m=x?o-e:r-e;for(let g=0;g<=u;g++){const f=(i.xmax-e)/a/c,M=f-Math.floor(f)==0?f:Math.ceil(f),y=m/a/c,p=y-Math.floor(y)==0?y:Math.ceil(y),w=Math.floor(h/a/c),R=Math.round(h/a)%c,P=(c-Math.round(m/a)%c)%c;d.push({resolutionX:a,blockWidth:c,datsetColumnCount:M,worldColumnCountFromOrigin:p,leftMargin:R,rightPadding:P,originColumnOffset:w}),a*=l}return{originX:e,halfWorldWidth:r,pyramidsInfo:d,hasGCSSShiftTransform:x}}function zt(t){if(!t||t.isGeographic)return t;const e=String(t.wkid||t.wkt);let o;return U.has(e)?o=U.get(e):(o=(t.wkid?T.coordsys(t.wkid):T.fromString(k.PE_TYPE_PROJCS,t.wkt)).getGeogcs().getCode(),U.set(e,o)),new Nt({wkid:o})}function It(t){const e=t.isAdaptive&&t.spacing==null;let o=t.spacing||[A,A],r=Z(t),s={cols:r.size[0]+1,rows:r.size[1]+1};const n=r.outofBoundPointCount>0&&r.outofBoundPointCount<r.offsets.length/2;let i=r.outofBoundPointCount===r.offsets.length/2||e&&n?[0,0]:st(r.offsets,s,o,K);const u=(i[0]+i[1])/2,c=t.projectedExtent.spatialReference,l=t.srcBufferExtent.spatialReference;if(e&&(n||u>K)&&(ht(c,l,t.datumTransformation)&&(c.isGeographic||S(O(c))),o=[B,B],r=Z({...t,spacing:o}),s={cols:r.size[0]+1,rows:r.size[1]+1},i=st(r.offsets,s,o,K)),r.error=i,o[0]>1&&(r.coefficients=ut(r.offsets,s,n)),t.includeGCSGrid&&!c.isGeographic&&!c.isWebMercator)if(l.isGeographic)r.gcsGrid={offsets:r.offsets,coefficients:r.coefficients,spacing:o};else{const a=O(c);if(S(a)&&!a.isEnvelope){const d=zt(c),x=_t(t.projectedExtent,d),{offsets:h}=Z({...t,srcBufferExtent:x,spacing:o}),m=ut(h,s,n);r.gcsGrid={offsets:h,coefficients:m,spacing:o}}}return r}function Z(t){const{projectedExtent:e,srcBufferExtent:o,pixelSize:r,datumTransformation:s,rasterTransform:n}=t,i=e.spatialReference,u=o.spatialReference,c=z(i,u),{xmin:l,ymin:a,xmax:d,ymax:x}=e,h=v(u),m=S(h)&&(t.hasWrapAround||(n==null?void 0:n.type)==="gcs-shift"),g=t.spacing||[A,A],f=g[0]*r.x,M=g[1]*r.y,y=g[0]===1,p=Math.ceil((d-l)/f-.1/g[0])+(y?0:1),w=Math.ceil((x-a)/M-.1/g[1])+(y?0:1),R=kt({cols:p,rows:w,xmin:l,ymax:x,xres:f,yres:M,inSR:i,outSR:u,datumTransformation:s,preferPE:g[0]<=B,usePixelCenter:y}),P=[];let C,$=0;const V=y?-1:NaN,{xmin:tt,xmax:q,ymax:pt,width:gt,height:yt}=o,dt=E(u,I),wt=S(h)&&tt>0&&q>h/2;let nt=!1;if(c){const _=O(i);nt=S(_)&&_.poleLocation>0}for(let _=0;_<p;_++){const J=[];for(let W=0;W<w;W++){let b=R[_*w+W];if(m&&b[0]>q&&b[0]>h/2-dt?b[0]-=h:m&&_===0&&b[0]<0&&wt&&!n&&(b[0]+=h),!b||isNaN(b[0])||isNaN(b[1]))P.push(V),P.push(V),J.push(null),$++;else{if(n){const et=n.inverseTransform(new N({x:b[0],y:b[1],spatialReference:u}));b=[et.x,et.y]}J.push(b),_>0&&m&&C[W]&&b[0]<C[W][0]&&(b[0]+=h,nt&&b[0]>q&&b[0]>h&&(b[0]-=h)),P.push((b[0]-tt)/gt),P.push((pt-b[1])/yt)}}C=J}return{offsets:P,error:null,coefficients:null,outofBoundPointCount:$,spacing:g,size:y?[p,w]:[p-1,w-1]}}function ut(t,e,o){const{cols:r,rows:s}=e,n=new Float32Array((r-1)*(s-1)*2*6),i=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),u=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let c=0;c<r-1;c++){for(let l=0;l<s-1;l++){let a=c*s*2+2*l;const d=t[a],x=t[a+1],h=t[a+2],m=t[a+3];a+=2*s;const g=t[a],f=t[a+1],M=t[a+2],y=t[a+3];let p=0,w=12*(l*(r-1)+c);for(let R=0;R<3;R++)n[w++]=i[p++]*d+i[p++]*h+i[p++]*M;p=0;for(let R=0;R<3;R++)n[w++]=i[p++]*x+i[p++]*m+i[p++]*y;p=0;for(let R=0;R<3;R++)n[w++]=u[p++]*d+u[p++]*g+u[p++]*M;p=0;for(let R=0;R<3;R++)n[w++]=u[p++]*x+u[p++]*f+u[p++]*y}if(o)for(let l=0;l<n.length;l++)isNaN(n[l])&&(n[l]=-1)}return n}function Yt(t){const e=t.clone().normalize();return e.length===1?e[0]:xt(e)}function Ft(t,e,o){const{storageInfo:r,pixelSize:s}=e;let n=0,i=!1;const{pyramidResolutions:u}=r;if(S(u)&&u.length){const x=(t.x+t.y)/2,h=u[u.length-1],m=(h.x+h.y)/2,g=(s.x+s.y)/2;if(x<=g)n=0;else if(x>=m)n=u.length,i=x/m>8;else{let M,y=g;for(let p=1;p<=u.length;p++){if(M=(u[p-1].x+u[p-1].y)/2,x<=M){x===M?n=p:o==="down"?(n=p-1,i=x/y>8):n=o==="up"||x-y>M-x||x/y>2?p:p-1;break}y=M}}const f=n===0?s:u[n-1];return i&&Math.min(f.x,f.y)*L(e.spatialReference)>19567&&(i=!1),{pyramidLevel:n,pyramidResolution:new N({x:f.x,y:f.y,spatialReference:e.spatialReference}),excessiveReading:i}}const c=Math.log(t.x/s.x)/Math.LN2,l=Math.log(t.y/s.y)/Math.LN2,a=e.storageInfo.maximumPyramidLevel||0;n=o==="down"?Math.floor(Math.min(c,l)):o==="up"?Math.ceil(Math.max(c,l)):Math.round((c+l)/2),n<0?n=0:n>a&&(i=n>a+3,n=a);const d=2**n;return{pyramidLevel:n,pyramidResolution:new N({x:d*e.nativePixelSize.x,y:d*e.nativePixelSize.y,spatialReference:e.spatialReference}),excessiveReading:i}}export{It as $,At as C,_t as J,ht as M,jt as Q,Lt as T,v as U,Bt as V,rt as j,Yt as n,Ft as o,$t as v};
