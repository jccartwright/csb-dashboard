(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();function n8e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var P8={},o8e={get exports(){return P8},set exports(t){P8=t}},_B={},Rd={},a8e={get exports(){return Rd},set exports(t){Rd=t}},us={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X4=Symbol.for("react.element"),l8e=Symbol.for("react.portal"),c8e=Symbol.for("react.fragment"),u8e=Symbol.for("react.strict_mode"),h8e=Symbol.for("react.profiler"),d8e=Symbol.for("react.provider"),p8e=Symbol.for("react.context"),f8e=Symbol.for("react.forward_ref"),m8e=Symbol.for("react.suspense"),g8e=Symbol.for("react.memo"),A8e=Symbol.for("react.lazy"),vae=Symbol.iterator;function y8e(t){return t===null||typeof t!="object"?null:(t=vae&&t[vae]||t["@@iterator"],typeof t=="function"?t:null)}var q_e={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},W_e=Object.assign,Y_e={};function xM(t,e,r){this.props=t,this.context=e,this.refs=Y_e,this.updater=r||q_e}xM.prototype.isReactComponent={};xM.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};xM.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Q_e(){}Q_e.prototype=xM.prototype;function tee(t,e,r){this.props=t,this.context=e,this.refs=Y_e,this.updater=r||q_e}var ree=tee.prototype=new Q_e;ree.constructor=tee;W_e(ree,xM.prototype);ree.isPureReactComponent=!0;var bae=Array.isArray,X_e=Object.prototype.hasOwnProperty,iee={current:null},Z_e={key:!0,ref:!0,__self:!0,__source:!0};function J_e(t,e,r){var i,s={},n=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(n=""+e.key),e)X_e.call(e,i)&&!Z_e.hasOwnProperty(i)&&(s[i]=e[i]);var a=arguments.length-2;if(a===1)s.children=r;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];s.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)s[i]===void 0&&(s[i]=a[i]);return{$$typeof:X4,type:t,key:n,ref:o,props:s,_owner:iee.current}}function _8e(t,e){return{$$typeof:X4,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function see(t){return typeof t=="object"&&t!==null&&t.$$typeof===X4}function v8e(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var wae=/\/+/g;function _V(t,e){return typeof t=="object"&&t!==null&&t.key!=null?v8e(""+t.key):e.toString(36)}function xF(t,e,r,i,s){var n=typeof t;(n==="undefined"||n==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(n){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case X4:case l8e:o=!0}}if(o)return o=t,s=s(o),t=i===""?"."+_V(o,0):i,bae(s)?(r="",t!=null&&(r=t.replace(wae,"$&/")+"/"),xF(s,e,r,"",function(c){return c})):s!=null&&(see(s)&&(s=_8e(s,r+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(wae,"$&/")+"/")+t)),e.push(s)),1;if(o=0,i=i===""?".":i+":",bae(t))for(var a=0;a<t.length;a++){n=t[a];var l=i+_V(n,a);o+=xF(n,e,r,l,s)}else if(l=y8e(t),typeof l=="function")for(t=l.call(t),a=0;!(n=t.next()).done;)n=n.value,l=i+_V(n,a++),o+=xF(n,e,r,l,s);else if(n==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function hD(t,e,r){if(t==null)return t;var i=[],s=0;return xF(t,i,"","",function(n){return e.call(r,n,s++)}),i}function b8e(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Wu={current:null},TF={transition:null},w8e={ReactCurrentDispatcher:Wu,ReactCurrentBatchConfig:TF,ReactCurrentOwner:iee};us.Children={map:hD,forEach:function(t,e,r){hD(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return hD(t,function(){e++}),e},toArray:function(t){return hD(t,function(e){return e})||[]},only:function(t){if(!see(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};us.Component=xM;us.Fragment=c8e;us.Profiler=h8e;us.PureComponent=tee;us.StrictMode=u8e;us.Suspense=m8e;us.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=w8e;us.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=W_e({},t.props),s=t.key,n=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(n=e.ref,o=iee.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)X_e.call(e,l)&&!Z_e.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:X4,type:t.type,key:s,ref:n,props:i,_owner:o}};us.createContext=function(t){return t={$$typeof:p8e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:d8e,_context:t},t.Consumer=t};us.createElement=J_e;us.createFactory=function(t){var e=J_e.bind(null,t);return e.type=t,e};us.createRef=function(){return{current:null}};us.forwardRef=function(t){return{$$typeof:f8e,render:t}};us.isValidElement=see;us.lazy=function(t){return{$$typeof:A8e,_payload:{_status:-1,_result:t},_init:b8e}};us.memo=function(t,e){return{$$typeof:g8e,type:t,compare:e===void 0?null:e}};us.startTransition=function(t){var e=TF.transition;TF.transition={};try{t()}finally{TF.transition=e}};us.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};us.useCallback=function(t,e){return Wu.current.useCallback(t,e)};us.useContext=function(t){return Wu.current.useContext(t)};us.useDebugValue=function(){};us.useDeferredValue=function(t){return Wu.current.useDeferredValue(t)};us.useEffect=function(t,e){return Wu.current.useEffect(t,e)};us.useId=function(){return Wu.current.useId()};us.useImperativeHandle=function(t,e,r){return Wu.current.useImperativeHandle(t,e,r)};us.useInsertionEffect=function(t,e){return Wu.current.useInsertionEffect(t,e)};us.useLayoutEffect=function(t,e){return Wu.current.useLayoutEffect(t,e)};us.useMemo=function(t,e){return Wu.current.useMemo(t,e)};us.useReducer=function(t,e,r){return Wu.current.useReducer(t,e,r)};us.useRef=function(t){return Wu.current.useRef(t)};us.useState=function(t){return Wu.current.useState(t)};us.useSyncExternalStore=function(t,e,r){return Wu.current.useSyncExternalStore(t,e,r)};us.useTransition=function(){return Wu.current.useTransition()};us.version="18.2.0";(function(t){t.exports=us})(a8e);const x8e=n8e(Rd);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T8e=Rd,S8e=Symbol.for("react.element"),E8e=Symbol.for("react.fragment"),C8e=Object.prototype.hasOwnProperty,M8e=T8e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,R8e={key:!0,ref:!0,__self:!0,__source:!0};function K_e(t,e,r){var i,s={},n=null,o=null;r!==void 0&&(n=""+r),e.key!==void 0&&(n=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)C8e.call(e,i)&&!R8e.hasOwnProperty(i)&&(s[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)s[i]===void 0&&(s[i]=e[i]);return{$$typeof:S8e,type:t,key:n,ref:o,props:s,_owner:M8e.current}}_B.Fragment=E8e;_B.jsx=K_e;_B.jsxs=K_e;(function(t){t.exports=_B})(o8e);const Cl=P8.jsx,O8e=P8.jsxs;var sq={},nq={},P8e={get exports(){return nq},set exports(t){nq=t}},Qd={},oq={},I8e={get exports(){return oq},set exports(t){oq=t}},e1e={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(q,X){var se=q.length;q.push(X);e:for(;0<se;){var ae=se-1>>>1,fe=q[ae];if(0<s(fe,X))q[ae]=X,q[se]=fe,se=ae;else break e}}function r(q){return q.length===0?null:q[0]}function i(q){if(q.length===0)return null;var X=q[0],se=q.pop();if(se!==X){q[0]=se;e:for(var ae=0,fe=q.length,ue=fe>>>1;ae<ue;){var Re=2*(ae+1)-1,De=q[Re],Ue=Re+1,Je=q[Ue];if(0>s(De,se))Ue<fe&&0>s(Je,De)?(q[ae]=Je,q[Ue]=se,ae=Ue):(q[ae]=De,q[Re]=se,ae=Re);else if(Ue<fe&&0>s(Je,se))q[ae]=Je,q[Ue]=se,ae=Ue;else break e}}return X}function s(q,X){var se=q.sortIndex-X.sortIndex;return se!==0?se:q.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;t.unstable_now=function(){return n.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],h=1,p=null,A=3,_=!1,w=!1,T=!1,C=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function $(q){for(var X=r(c);X!==null;){if(X.callback===null)i(c);else if(X.startTime<=q)i(c),X.sortIndex=X.expirationTime,e(l,X);else break;X=r(c)}}function L(q){if(T=!1,$(q),!w)if(r(l)!==null)w=!0,le(k);else{var X=r(c);X!==null&&W(L,X.startTime-q)}}function k(q,X){w=!1,T&&(T=!1,M(z),z=-1),_=!0;var se=A;try{for($(X),p=r(l);p!==null&&(!(p.expirationTime>X)||q&&!te());){var ae=p.callback;if(typeof ae=="function"){p.callback=null,A=p.priorityLevel;var fe=ae(p.expirationTime<=X);X=t.unstable_now(),typeof fe=="function"?p.callback=fe:p===r(l)&&i(l),$(X)}else i(l);p=r(l)}if(p!==null)var ue=!0;else{var Re=r(c);Re!==null&&W(L,Re.startTime-X),ue=!1}return ue}finally{p=null,A=se,_=!1}}var F=!1,G=null,z=-1,Z=5,J=-1;function te(){return!(t.unstable_now()-J<Z)}function re(){if(G!==null){var q=t.unstable_now();J=q;var X=!0;try{X=G(!0,q)}finally{X?Ae():(F=!1,G=null)}}else F=!1}var Ae;if(typeof O=="function")Ae=function(){O(re)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,ye=ve.port2;ve.port1.onmessage=re,Ae=function(){ye.postMessage(null)}}else Ae=function(){C(re,0)};function le(q){G=q,F||(F=!0,Ae())}function W(q,X){z=C(function(){q(t.unstable_now())},X)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(q){q.callback=null},t.unstable_continueExecution=function(){w||_||(w=!0,le(k))},t.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Z=0<q?Math.floor(1e3/q):5},t.unstable_getCurrentPriorityLevel=function(){return A},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(q){switch(A){case 1:case 2:case 3:var X=3;break;default:X=A}var se=A;A=X;try{return q()}finally{A=se}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(q,X){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var se=A;A=q;try{return X()}finally{A=se}},t.unstable_scheduleCallback=function(q,X,se){var ae=t.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?ae+se:ae):se=ae,q){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=se+fe,q={id:h++,callback:X,priorityLevel:q,startTime:se,expirationTime:fe,sortIndex:-1},se>ae?(q.sortIndex=se,e(c,q),r(l)===null&&q===r(c)&&(T?(M(z),z=-1):T=!0,W(L,se-ae))):(q.sortIndex=fe,e(l,q),w||_||(w=!0,le(k))),q},t.unstable_shouldYield=te,t.unstable_wrapCallback=function(q){var X=A;return function(){var se=A;A=X;try{return q.apply(this,arguments)}finally{A=se}}}})(e1e);(function(t){t.exports=e1e})(I8e);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t1e=Rd,Gd=oq;function mt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r1e=new Set,m$={};function gT(t,e){y3(t,e),y3(t+"Capture",e)}function y3(t,e){for(m$[t]=e,t=0;t<e.length;t++)r1e.add(e[t])}var My=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),aq=Object.prototype.hasOwnProperty,$8e=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,xae={},Tae={};function L8e(t){return aq.call(Tae,t)?!0:aq.call(xae,t)?!1:$8e.test(t)?Tae[t]=!0:(xae[t]=!0,!1)}function D8e(t,e,r,i){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function N8e(t,e,r,i){if(e===null||typeof e>"u"||D8e(t,e,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Yu(t,e,r,i,s,n,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=n,this.removeEmptyString=o}var oc={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){oc[t]=new Yu(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];oc[e]=new Yu(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){oc[t]=new Yu(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){oc[t]=new Yu(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){oc[t]=new Yu(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){oc[t]=new Yu(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){oc[t]=new Yu(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){oc[t]=new Yu(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){oc[t]=new Yu(t,5,!1,t.toLowerCase(),null,!1,!1)});var nee=/[\-:]([a-z])/g;function oee(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(nee,oee);oc[e]=new Yu(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(nee,oee);oc[e]=new Yu(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(nee,oee);oc[e]=new Yu(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){oc[t]=new Yu(t,1,!1,t.toLowerCase(),null,!1,!1)});oc.xlinkHref=new Yu("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){oc[t]=new Yu(t,1,!1,t.toLowerCase(),null,!0,!0)});function aee(t,e,r,i){var s=oc.hasOwnProperty(e)?oc[e]:null;(s!==null?s.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(N8e(e,r,s,i)&&(r=null),i||s===null?L8e(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):s.mustUseProperty?t[s.propertyName]=r===null?s.type===3?!1:"":r:(e=s.attributeName,i=s.attributeNamespace,r===null?t.removeAttribute(e):(s=s.type,r=s===3||s===4&&r===!0?"":""+r,i?t.setAttributeNS(i,e,r):t.setAttribute(e,r))))}var Wy=t1e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,dD=Symbol.for("react.element"),KE=Symbol.for("react.portal"),eC=Symbol.for("react.fragment"),lee=Symbol.for("react.strict_mode"),lq=Symbol.for("react.profiler"),i1e=Symbol.for("react.provider"),s1e=Symbol.for("react.context"),cee=Symbol.for("react.forward_ref"),cq=Symbol.for("react.suspense"),uq=Symbol.for("react.suspense_list"),uee=Symbol.for("react.memo"),F1=Symbol.for("react.lazy"),n1e=Symbol.for("react.offscreen"),Sae=Symbol.iterator;function fR(t){return t===null||typeof t!="object"?null:(t=Sae&&t[Sae]||t["@@iterator"],typeof t=="function"?t:null)}var Ro=Object.assign,vV;function DO(t){if(vV===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);vV=e&&e[1]||""}return`
`+vV+t}var bV=!1;function wV(t,e){if(!t||bV)return"";bV=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),n=i.stack.split(`
`),o=s.length-1,a=n.length-1;1<=o&&0<=a&&s[o]!==n[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==n[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==n[a]){var l=`
`+s[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{bV=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?DO(t):""}function F8e(t){switch(t.tag){case 5:return DO(t.type);case 16:return DO("Lazy");case 13:return DO("Suspense");case 19:return DO("SuspenseList");case 0:case 2:case 15:return t=wV(t.type,!1),t;case 11:return t=wV(t.type.render,!1),t;case 1:return t=wV(t.type,!0),t;default:return""}}function hq(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case eC:return"Fragment";case KE:return"Portal";case lq:return"Profiler";case lee:return"StrictMode";case cq:return"Suspense";case uq:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case s1e:return(t.displayName||"Context")+".Consumer";case i1e:return(t._context.displayName||"Context")+".Provider";case cee:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case uee:return e=t.displayName||null,e!==null?e:hq(t.type)||"Memo";case F1:e=t._payload,t=t._init;try{return hq(t(e))}catch{}}return null}function k8e(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hq(e);case 8:return e===lee?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Wv(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function o1e(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function B8e(t){var e=o1e(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var s=r.get,n=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){i=""+o,n.call(this,o)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function pD(t){t._valueTracker||(t._valueTracker=B8e(t))}function a1e(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),i="";return t&&(i=o1e(t)?t.checked?"true":"false":t.value),t=i,t!==r?(e.setValue(t),!0):!1}function I8(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function dq(t,e){var r=e.checked;return Ro({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function Eae(t,e){var r=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;r=Wv(e.value!=null?e.value:r),t._wrapperState={initialChecked:i,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function l1e(t,e){e=e.checked,e!=null&&aee(t,"checked",e,!1)}function pq(t,e){l1e(t,e);var r=Wv(e.value),i=e.type;if(r!=null)i==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?fq(t,e.type,r):e.hasOwnProperty("defaultValue")&&fq(t,e.type,Wv(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Cae(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function fq(t,e,r){(e!=="number"||I8(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var NO=Array.isArray;function LC(t,e,r,i){if(t=t.options,e){e={};for(var s=0;s<r.length;s++)e["$"+r[s]]=!0;for(r=0;r<t.length;r++)s=e.hasOwnProperty("$"+t[r].value),t[r].selected!==s&&(t[r].selected=s),s&&i&&(t[r].defaultSelected=!0)}else{for(r=""+Wv(r),e=null,s=0;s<t.length;s++){if(t[s].value===r){t[s].selected=!0,i&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function mq(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(mt(91));return Ro({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Mae(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(mt(92));if(NO(r)){if(1<r.length)throw Error(mt(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:Wv(r)}}function c1e(t,e){var r=Wv(e.value),i=Wv(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),i!=null&&(t.defaultValue=""+i)}function Rae(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function u1e(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function gq(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?u1e(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var fD,h1e=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,i,s){MSApp.execUnsafeLocalFunction(function(){return t(e,r,i,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(fD=fD||document.createElement("div"),fD.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=fD.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function g$(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var uI={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},U8e=["Webkit","ms","Moz","O"];Object.keys(uI).forEach(function(t){U8e.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),uI[e]=uI[t]})});function d1e(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||uI.hasOwnProperty(t)&&uI[t]?(""+e).trim():e+"px"}function p1e(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var i=r.indexOf("--")===0,s=d1e(r,e[r],i);r==="float"&&(r="cssFloat"),i?t.setProperty(r,s):t[r]=s}}var V8e=Ro({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Aq(t,e){if(e){if(V8e[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(mt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(mt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(mt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(mt(62))}}function yq(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _q=null;function hee(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var vq=null,DC=null,NC=null;function Oae(t){if(t=K4(t)){if(typeof vq!="function")throw Error(mt(280));var e=t.stateNode;e&&(e=TB(e),vq(t.stateNode,t.type,e))}}function f1e(t){DC?NC?NC.push(t):NC=[t]:DC=t}function m1e(){if(DC){var t=DC,e=NC;if(NC=DC=null,Oae(t),e)for(t=0;t<e.length;t++)Oae(e[t])}}function g1e(t,e){return t(e)}function A1e(){}var xV=!1;function y1e(t,e,r){if(xV)return t(e,r);xV=!0;try{return g1e(t,e,r)}finally{xV=!1,(DC!==null||NC!==null)&&(A1e(),m1e())}}function A$(t,e){var r=t.stateNode;if(r===null)return null;var i=TB(r);if(i===null)return null;r=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(mt(231,e,typeof r));return r}var bq=!1;if(My)try{var mR={};Object.defineProperty(mR,"passive",{get:function(){bq=!0}}),window.addEventListener("test",mR,mR),window.removeEventListener("test",mR,mR)}catch{bq=!1}function z8e(t,e,r,i,s,n,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(r,c)}catch(h){this.onError(h)}}var hI=!1,$8=null,L8=!1,wq=null,G8e={onError:function(t){hI=!0,$8=t}};function j8e(t,e,r,i,s,n,o,a,l){hI=!1,$8=null,z8e.apply(G8e,arguments)}function H8e(t,e,r,i,s,n,o,a,l){if(j8e.apply(this,arguments),hI){if(hI){var c=$8;hI=!1,$8=null}else throw Error(mt(198));L8||(L8=!0,wq=c)}}function AT(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function _1e(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Pae(t){if(AT(t)!==t)throw Error(mt(188))}function q8e(t){var e=t.alternate;if(!e){if(e=AT(t),e===null)throw Error(mt(188));return e!==t?null:t}for(var r=t,i=e;;){var s=r.return;if(s===null)break;var n=s.alternate;if(n===null){if(i=s.return,i!==null){r=i;continue}break}if(s.child===n.child){for(n=s.child;n;){if(n===r)return Pae(s),t;if(n===i)return Pae(s),e;n=n.sibling}throw Error(mt(188))}if(r.return!==i.return)r=s,i=n;else{for(var o=!1,a=s.child;a;){if(a===r){o=!0,r=s,i=n;break}if(a===i){o=!0,i=s,r=n;break}a=a.sibling}if(!o){for(a=n.child;a;){if(a===r){o=!0,r=n,i=s;break}if(a===i){o=!0,i=n,r=s;break}a=a.sibling}if(!o)throw Error(mt(189))}}if(r.alternate!==i)throw Error(mt(190))}if(r.tag!==3)throw Error(mt(188));return r.stateNode.current===r?t:e}function v1e(t){return t=q8e(t),t!==null?b1e(t):null}function b1e(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=b1e(t);if(e!==null)return e;t=t.sibling}return null}var w1e=Gd.unstable_scheduleCallback,Iae=Gd.unstable_cancelCallback,W8e=Gd.unstable_shouldYield,Y8e=Gd.unstable_requestPaint,ha=Gd.unstable_now,Q8e=Gd.unstable_getCurrentPriorityLevel,dee=Gd.unstable_ImmediatePriority,x1e=Gd.unstable_UserBlockingPriority,D8=Gd.unstable_NormalPriority,X8e=Gd.unstable_LowPriority,T1e=Gd.unstable_IdlePriority,vB=null,Ag=null;function Z8e(t){if(Ag&&typeof Ag.onCommitFiberRoot=="function")try{Ag.onCommitFiberRoot(vB,t,void 0,(t.current.flags&128)===128)}catch{}}var M0=Math.clz32?Math.clz32:eke,J8e=Math.log,K8e=Math.LN2;function eke(t){return t>>>=0,t===0?32:31-(J8e(t)/K8e|0)|0}var mD=64,gD=4194304;function FO(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function N8(t,e){var r=t.pendingLanes;if(r===0)return 0;var i=0,s=t.suspendedLanes,n=t.pingedLanes,o=r&268435455;if(o!==0){var a=o&~s;a!==0?i=FO(a):(n&=o,n!==0&&(i=FO(n)))}else o=r&~s,o!==0?i=FO(o):n!==0&&(i=FO(n));if(i===0)return 0;if(e!==0&&e!==i&&!(e&s)&&(s=i&-i,n=e&-e,s>=n||s===16&&(n&4194240)!==0))return e;if(i&4&&(i|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)r=31-M0(e),s=1<<r,i|=t[r],e&=~s;return i}function tke(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rke(t,e){for(var r=t.suspendedLanes,i=t.pingedLanes,s=t.expirationTimes,n=t.pendingLanes;0<n;){var o=31-M0(n),a=1<<o,l=s[o];l===-1?(!(a&r)||a&i)&&(s[o]=tke(a,e)):l<=e&&(t.expiredLanes|=a),n&=~a}}function xq(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function S1e(){var t=mD;return mD<<=1,!(mD&4194240)&&(mD=64),t}function TV(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function Z4(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-M0(e),t[e]=r}function ike(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<r;){var s=31-M0(r),n=1<<s;e[s]=0,i[s]=-1,t[s]=-1,r&=~n}}function pee(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var i=31-M0(r),s=1<<i;s&e|t[i]&e&&(t[i]|=e),r&=~s}}var fn=0;function E1e(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var C1e,fee,M1e,R1e,O1e,Tq=!1,AD=[],Cv=null,Mv=null,Rv=null,y$=new Map,_$=new Map,X1=[],ske="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function $ae(t,e){switch(t){case"focusin":case"focusout":Cv=null;break;case"dragenter":case"dragleave":Mv=null;break;case"mouseover":case"mouseout":Rv=null;break;case"pointerover":case"pointerout":y$.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":_$.delete(e.pointerId)}}function gR(t,e,r,i,s,n){return t===null||t.nativeEvent!==n?(t={blockedOn:e,domEventName:r,eventSystemFlags:i,nativeEvent:n,targetContainers:[s]},e!==null&&(e=K4(e),e!==null&&fee(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function nke(t,e,r,i,s){switch(e){case"focusin":return Cv=gR(Cv,t,e,r,i,s),!0;case"dragenter":return Mv=gR(Mv,t,e,r,i,s),!0;case"mouseover":return Rv=gR(Rv,t,e,r,i,s),!0;case"pointerover":var n=s.pointerId;return y$.set(n,gR(y$.get(n)||null,t,e,r,i,s)),!0;case"gotpointercapture":return n=s.pointerId,_$.set(n,gR(_$.get(n)||null,t,e,r,i,s)),!0}return!1}function P1e(t){var e=q2(t.target);if(e!==null){var r=AT(e);if(r!==null){if(e=r.tag,e===13){if(e=_1e(r),e!==null){t.blockedOn=e,O1e(t.priority,function(){M1e(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function SF(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=Sq(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var i=new r.constructor(r.type,r);_q=i,r.target.dispatchEvent(i),_q=null}else return e=K4(r),e!==null&&fee(e),t.blockedOn=r,!1;e.shift()}return!0}function Lae(t,e,r){SF(t)&&r.delete(e)}function oke(){Tq=!1,Cv!==null&&SF(Cv)&&(Cv=null),Mv!==null&&SF(Mv)&&(Mv=null),Rv!==null&&SF(Rv)&&(Rv=null),y$.forEach(Lae),_$.forEach(Lae)}function AR(t,e){t.blockedOn===e&&(t.blockedOn=null,Tq||(Tq=!0,Gd.unstable_scheduleCallback(Gd.unstable_NormalPriority,oke)))}function v$(t){function e(s){return AR(s,t)}if(0<AD.length){AR(AD[0],t);for(var r=1;r<AD.length;r++){var i=AD[r];i.blockedOn===t&&(i.blockedOn=null)}}for(Cv!==null&&AR(Cv,t),Mv!==null&&AR(Mv,t),Rv!==null&&AR(Rv,t),y$.forEach(e),_$.forEach(e),r=0;r<X1.length;r++)i=X1[r],i.blockedOn===t&&(i.blockedOn=null);for(;0<X1.length&&(r=X1[0],r.blockedOn===null);)P1e(r),r.blockedOn===null&&X1.shift()}var FC=Wy.ReactCurrentBatchConfig,F8=!0;function ake(t,e,r,i){var s=fn,n=FC.transition;FC.transition=null;try{fn=1,mee(t,e,r,i)}finally{fn=s,FC.transition=n}}function lke(t,e,r,i){var s=fn,n=FC.transition;FC.transition=null;try{fn=4,mee(t,e,r,i)}finally{fn=s,FC.transition=n}}function mee(t,e,r,i){if(F8){var s=Sq(t,e,r,i);if(s===null)LV(t,e,i,k8,r),$ae(t,i);else if(nke(s,t,e,r,i))i.stopPropagation();else if($ae(t,i),e&4&&-1<ske.indexOf(t)){for(;s!==null;){var n=K4(s);if(n!==null&&C1e(n),n=Sq(t,e,r,i),n===null&&LV(t,e,i,k8,r),n===s)break;s=n}s!==null&&i.stopPropagation()}else LV(t,e,i,null,r)}}var k8=null;function Sq(t,e,r,i){if(k8=null,t=hee(i),t=q2(t),t!==null)if(e=AT(t),e===null)t=null;else if(r=e.tag,r===13){if(t=_1e(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return k8=t,null}function I1e(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Q8e()){case dee:return 1;case x1e:return 4;case D8:case X8e:return 16;case T1e:return 536870912;default:return 16}default:return 16}}var av=null,gee=null,EF=null;function $1e(){if(EF)return EF;var t,e=gee,r=e.length,i,s="value"in av?av.value:av.textContent,n=s.length;for(t=0;t<r&&e[t]===s[t];t++);var o=r-t;for(i=1;i<=o&&e[r-i]===s[n-i];i++);return EF=s.slice(t,1<i?1-i:void 0)}function CF(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function yD(){return!0}function Dae(){return!1}function Xd(t){function e(r,i,s,n,o){this._reactName=r,this._targetInst=s,this.type=i,this.nativeEvent=n,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(n):n[a]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?yD:Dae,this.isPropagationStopped=Dae,this}return Ro(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=yD)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=yD)},persist:function(){},isPersistent:yD}),e}var TM={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Aee=Xd(TM),J4=Ro({},TM,{view:0,detail:0}),cke=Xd(J4),SV,EV,yR,bB=Ro({},J4,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yee,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==yR&&(yR&&t.type==="mousemove"?(SV=t.screenX-yR.screenX,EV=t.screenY-yR.screenY):EV=SV=0,yR=t),SV)},movementY:function(t){return"movementY"in t?t.movementY:EV}}),Nae=Xd(bB),uke=Ro({},bB,{dataTransfer:0}),hke=Xd(uke),dke=Ro({},J4,{relatedTarget:0}),CV=Xd(dke),pke=Ro({},TM,{animationName:0,elapsedTime:0,pseudoElement:0}),fke=Xd(pke),mke=Ro({},TM,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),gke=Xd(mke),Ake=Ro({},TM,{data:0}),Fae=Xd(Ake),yke={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_ke={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vke={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bke(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=vke[t])?!!e[t]:!1}function yee(){return bke}var wke=Ro({},J4,{key:function(t){if(t.key){var e=yke[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=CF(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?_ke[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yee,charCode:function(t){return t.type==="keypress"?CF(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?CF(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),xke=Xd(wke),Tke=Ro({},bB,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kae=Xd(Tke),Ske=Ro({},J4,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yee}),Eke=Xd(Ske),Cke=Ro({},TM,{propertyName:0,elapsedTime:0,pseudoElement:0}),Mke=Xd(Cke),Rke=Ro({},bB,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Oke=Xd(Rke),Pke=[9,13,27,32],_ee=My&&"CompositionEvent"in window,dI=null;My&&"documentMode"in document&&(dI=document.documentMode);var Ike=My&&"TextEvent"in window&&!dI,L1e=My&&(!_ee||dI&&8<dI&&11>=dI),Bae=String.fromCharCode(32),Uae=!1;function D1e(t,e){switch(t){case"keyup":return Pke.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function N1e(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var tC=!1;function $ke(t,e){switch(t){case"compositionend":return N1e(e);case"keypress":return e.which!==32?null:(Uae=!0,Bae);case"textInput":return t=e.data,t===Bae&&Uae?null:t;default:return null}}function Lke(t,e){if(tC)return t==="compositionend"||!_ee&&D1e(t,e)?(t=$1e(),EF=gee=av=null,tC=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return L1e&&e.locale!=="ko"?null:e.data;default:return null}}var Dke={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vae(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Dke[t.type]:e==="textarea"}function F1e(t,e,r,i){f1e(i),e=B8(e,"onChange"),0<e.length&&(r=new Aee("onChange","change",null,r,i),t.push({event:r,listeners:e}))}var pI=null,b$=null;function Nke(t){Y1e(t,0)}function wB(t){var e=sC(t);if(a1e(e))return t}function Fke(t,e){if(t==="change")return e}var k1e=!1;if(My){var MV;if(My){var RV="oninput"in document;if(!RV){var zae=document.createElement("div");zae.setAttribute("oninput","return;"),RV=typeof zae.oninput=="function"}MV=RV}else MV=!1;k1e=MV&&(!document.documentMode||9<document.documentMode)}function Gae(){pI&&(pI.detachEvent("onpropertychange",B1e),b$=pI=null)}function B1e(t){if(t.propertyName==="value"&&wB(b$)){var e=[];F1e(e,b$,t,hee(t)),y1e(Nke,e)}}function kke(t,e,r){t==="focusin"?(Gae(),pI=e,b$=r,pI.attachEvent("onpropertychange",B1e)):t==="focusout"&&Gae()}function Bke(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return wB(b$)}function Uke(t,e){if(t==="click")return wB(e)}function Vke(t,e){if(t==="input"||t==="change")return wB(e)}function zke(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var N0=typeof Object.is=="function"?Object.is:zke;function w$(t,e){if(N0(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var s=r[i];if(!aq.call(e,s)||!N0(t[s],e[s]))return!1}return!0}function jae(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Hae(t,e){var r=jae(t);t=0;for(var i;r;){if(r.nodeType===3){if(i=t+r.textContent.length,t<=e&&i>=e)return{node:r,offset:e-t};t=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=jae(r)}}function U1e(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?U1e(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function V1e(){for(var t=window,e=I8();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=I8(t.document)}return e}function vee(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Gke(t){var e=V1e(),r=t.focusedElem,i=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&U1e(r.ownerDocument.documentElement,r)){if(i!==null&&vee(r)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=r.textContent.length,n=Math.min(i.start,s);i=i.end===void 0?n:Math.min(i.end,s),!t.extend&&n>i&&(s=i,i=n,n=s),s=Hae(r,n);var o=Hae(r,i);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),n>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var jke=My&&"documentMode"in document&&11>=document.documentMode,rC=null,Eq=null,fI=null,Cq=!1;function qae(t,e,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Cq||rC==null||rC!==I8(i)||(i=rC,"selectionStart"in i&&vee(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),fI&&w$(fI,i)||(fI=i,i=B8(Eq,"onSelect"),0<i.length&&(e=new Aee("onSelect","select",null,e,r),t.push({event:e,listeners:i}),e.target=rC)))}function _D(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var iC={animationend:_D("Animation","AnimationEnd"),animationiteration:_D("Animation","AnimationIteration"),animationstart:_D("Animation","AnimationStart"),transitionend:_D("Transition","TransitionEnd")},OV={},z1e={};My&&(z1e=document.createElement("div").style,"AnimationEvent"in window||(delete iC.animationend.animation,delete iC.animationiteration.animation,delete iC.animationstart.animation),"TransitionEvent"in window||delete iC.transitionend.transition);function xB(t){if(OV[t])return OV[t];if(!iC[t])return t;var e=iC[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in z1e)return OV[t]=e[r];return t}var G1e=xB("animationend"),j1e=xB("animationiteration"),H1e=xB("animationstart"),q1e=xB("transitionend"),W1e=new Map,Wae="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function yb(t,e){W1e.set(t,e),gT(e,[t])}for(var PV=0;PV<Wae.length;PV++){var IV=Wae[PV],Hke=IV.toLowerCase(),qke=IV[0].toUpperCase()+IV.slice(1);yb(Hke,"on"+qke)}yb(G1e,"onAnimationEnd");yb(j1e,"onAnimationIteration");yb(H1e,"onAnimationStart");yb("dblclick","onDoubleClick");yb("focusin","onFocus");yb("focusout","onBlur");yb(q1e,"onTransitionEnd");y3("onMouseEnter",["mouseout","mouseover"]);y3("onMouseLeave",["mouseout","mouseover"]);y3("onPointerEnter",["pointerout","pointerover"]);y3("onPointerLeave",["pointerout","pointerover"]);gT("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));gT("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));gT("onBeforeInput",["compositionend","keypress","textInput","paste"]);gT("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));gT("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));gT("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var kO="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Wke=new Set("cancel close invalid load scroll toggle".split(" ").concat(kO));function Yae(t,e,r){var i=t.type||"unknown-event";t.currentTarget=r,H8e(i,e,void 0,t),t.currentTarget=null}function Y1e(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var i=t[r],s=i.event;i=i.listeners;e:{var n=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==n&&s.isPropagationStopped())break e;Yae(s,a,c),n=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==n&&s.isPropagationStopped())break e;Yae(s,a,c),n=l}}}if(L8)throw t=wq,L8=!1,wq=null,t}function eo(t,e){var r=e[Iq];r===void 0&&(r=e[Iq]=new Set);var i=t+"__bubble";r.has(i)||(Q1e(e,t,2,!1),r.add(i))}function $V(t,e,r){var i=0;e&&(i|=4),Q1e(r,t,i,e)}var vD="_reactListening"+Math.random().toString(36).slice(2);function x$(t){if(!t[vD]){t[vD]=!0,r1e.forEach(function(r){r!=="selectionchange"&&(Wke.has(r)||$V(r,!1,t),$V(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[vD]||(e[vD]=!0,$V("selectionchange",!1,e))}}function Q1e(t,e,r,i){switch(I1e(e)){case 1:var s=ake;break;case 4:s=lke;break;default:s=mee}r=s.bind(null,e,r,t),s=void 0,!bq||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),i?s!==void 0?t.addEventListener(e,r,{capture:!0,passive:s}):t.addEventListener(e,r,!0):s!==void 0?t.addEventListener(e,r,{passive:s}):t.addEventListener(e,r,!1)}function LV(t,e,r,i,s){var n=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=q2(a),o===null)return;if(l=o.tag,l===5||l===6){i=n=o;continue e}a=a.parentNode}}i=i.return}y1e(function(){var c=n,h=hee(r),p=[];e:{var A=W1e.get(t);if(A!==void 0){var _=Aee,w=t;switch(t){case"keypress":if(CF(r)===0)break e;case"keydown":case"keyup":_=xke;break;case"focusin":w="focus",_=CV;break;case"focusout":w="blur",_=CV;break;case"beforeblur":case"afterblur":_=CV;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=Nae;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=hke;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=Eke;break;case G1e:case j1e:case H1e:_=fke;break;case q1e:_=Mke;break;case"scroll":_=cke;break;case"wheel":_=Oke;break;case"copy":case"cut":case"paste":_=gke;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=kae}var T=(e&4)!==0,C=!T&&t==="scroll",M=T?A!==null?A+"Capture":null:A;T=[];for(var O=c,$;O!==null;){$=O;var L=$.stateNode;if($.tag===5&&L!==null&&($=L,M!==null&&(L=A$(O,M),L!=null&&T.push(T$(O,L,$)))),C)break;O=O.return}0<T.length&&(A=new _(A,w,null,r,h),p.push({event:A,listeners:T}))}}if(!(e&7)){e:{if(A=t==="mouseover"||t==="pointerover",_=t==="mouseout"||t==="pointerout",A&&r!==_q&&(w=r.relatedTarget||r.fromElement)&&(q2(w)||w[Ry]))break e;if((_||A)&&(A=h.window===h?h:(A=h.ownerDocument)?A.defaultView||A.parentWindow:window,_?(w=r.relatedTarget||r.toElement,_=c,w=w?q2(w):null,w!==null&&(C=AT(w),w!==C||w.tag!==5&&w.tag!==6)&&(w=null)):(_=null,w=c),_!==w)){if(T=Nae,L="onMouseLeave",M="onMouseEnter",O="mouse",(t==="pointerout"||t==="pointerover")&&(T=kae,L="onPointerLeave",M="onPointerEnter",O="pointer"),C=_==null?A:sC(_),$=w==null?A:sC(w),A=new T(L,O+"leave",_,r,h),A.target=C,A.relatedTarget=$,L=null,q2(h)===c&&(T=new T(M,O+"enter",w,r,h),T.target=$,T.relatedTarget=C,L=T),C=L,_&&w)t:{for(T=_,M=w,O=0,$=T;$;$=UT($))O++;for($=0,L=M;L;L=UT(L))$++;for(;0<O-$;)T=UT(T),O--;for(;0<$-O;)M=UT(M),$--;for(;O--;){if(T===M||M!==null&&T===M.alternate)break t;T=UT(T),M=UT(M)}T=null}else T=null;_!==null&&Qae(p,A,_,T,!1),w!==null&&C!==null&&Qae(p,C,w,T,!0)}}e:{if(A=c?sC(c):window,_=A.nodeName&&A.nodeName.toLowerCase(),_==="select"||_==="input"&&A.type==="file")var k=Fke;else if(Vae(A))if(k1e)k=Vke;else{k=Bke;var F=kke}else(_=A.nodeName)&&_.toLowerCase()==="input"&&(A.type==="checkbox"||A.type==="radio")&&(k=Uke);if(k&&(k=k(t,c))){F1e(p,k,r,h);break e}F&&F(t,A,c),t==="focusout"&&(F=A._wrapperState)&&F.controlled&&A.type==="number"&&fq(A,"number",A.value)}switch(F=c?sC(c):window,t){case"focusin":(Vae(F)||F.contentEditable==="true")&&(rC=F,Eq=c,fI=null);break;case"focusout":fI=Eq=rC=null;break;case"mousedown":Cq=!0;break;case"contextmenu":case"mouseup":case"dragend":Cq=!1,qae(p,r,h);break;case"selectionchange":if(jke)break;case"keydown":case"keyup":qae(p,r,h)}var G;if(_ee)e:{switch(t){case"compositionstart":var z="onCompositionStart";break e;case"compositionend":z="onCompositionEnd";break e;case"compositionupdate":z="onCompositionUpdate";break e}z=void 0}else tC?D1e(t,r)&&(z="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(z="onCompositionStart");z&&(L1e&&r.locale!=="ko"&&(tC||z!=="onCompositionStart"?z==="onCompositionEnd"&&tC&&(G=$1e()):(av=h,gee="value"in av?av.value:av.textContent,tC=!0)),F=B8(c,z),0<F.length&&(z=new Fae(z,t,null,r,h),p.push({event:z,listeners:F}),G?z.data=G:(G=N1e(r),G!==null&&(z.data=G)))),(G=Ike?$ke(t,r):Lke(t,r))&&(c=B8(c,"onBeforeInput"),0<c.length&&(h=new Fae("onBeforeInput","beforeinput",null,r,h),p.push({event:h,listeners:c}),h.data=G))}Y1e(p,e)})}function T$(t,e,r){return{instance:t,listener:e,currentTarget:r}}function B8(t,e){for(var r=e+"Capture",i=[];t!==null;){var s=t,n=s.stateNode;s.tag===5&&n!==null&&(s=n,n=A$(t,r),n!=null&&i.unshift(T$(t,n,s)),n=A$(t,e),n!=null&&i.push(T$(t,n,s))),t=t.return}return i}function UT(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Qae(t,e,r,i,s){for(var n=e._reactName,o=[];r!==null&&r!==i;){var a=r,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,s?(l=A$(r,n),l!=null&&o.unshift(T$(r,l,a))):s||(l=A$(r,n),l!=null&&o.push(T$(r,l,a)))),r=r.return}o.length!==0&&t.push({event:e,listeners:o})}var Yke=/\r\n?/g,Qke=/\u0000|\uFFFD/g;function Xae(t){return(typeof t=="string"?t:""+t).replace(Yke,`
`).replace(Qke,"")}function bD(t,e,r){if(e=Xae(e),Xae(t)!==e&&r)throw Error(mt(425))}function U8(){}var Mq=null,Rq=null;function Oq(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Pq=typeof setTimeout=="function"?setTimeout:void 0,Xke=typeof clearTimeout=="function"?clearTimeout:void 0,Zae=typeof Promise=="function"?Promise:void 0,Zke=typeof queueMicrotask=="function"?queueMicrotask:typeof Zae<"u"?function(t){return Zae.resolve(null).then(t).catch(Jke)}:Pq;function Jke(t){setTimeout(function(){throw t})}function DV(t,e){var r=e,i=0;do{var s=r.nextSibling;if(t.removeChild(r),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(i===0){t.removeChild(s),v$(e);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=s}while(r);v$(e)}function Ov(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Jae(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var SM=Math.random().toString(36).slice(2),sg="__reactFiber$"+SM,S$="__reactProps$"+SM,Ry="__reactContainer$"+SM,Iq="__reactEvents$"+SM,Kke="__reactListeners$"+SM,e9e="__reactHandles$"+SM;function q2(t){var e=t[sg];if(e)return e;for(var r=t.parentNode;r;){if(e=r[Ry]||r[sg]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=Jae(t);t!==null;){if(r=t[sg])return r;t=Jae(t)}return e}t=r,r=t.parentNode}return null}function K4(t){return t=t[sg]||t[Ry],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function sC(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(mt(33))}function TB(t){return t[S$]||null}var $q=[],nC=-1;function _b(t){return{current:t}}function po(t){0>nC||(t.current=$q[nC],$q[nC]=null,nC--)}function Qn(t,e){nC++,$q[nC]=t.current,t.current=e}var Yv={},Xc=_b(Yv),Dh=_b(!1),Ex=Yv;function _3(t,e){var r=t.type.contextTypes;if(!r)return Yv;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var s={},n;for(n in r)s[n]=e[n];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Nh(t){return t=t.childContextTypes,t!=null}function V8(){po(Dh),po(Xc)}function Kae(t,e,r){if(Xc.current!==Yv)throw Error(mt(168));Qn(Xc,e),Qn(Dh,r)}function X1e(t,e,r){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var s in i)if(!(s in e))throw Error(mt(108,k8e(t)||"Unknown",s));return Ro({},r,i)}function z8(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Yv,Ex=Xc.current,Qn(Xc,t),Qn(Dh,Dh.current),!0}function ele(t,e,r){var i=t.stateNode;if(!i)throw Error(mt(169));r?(t=X1e(t,e,Ex),i.__reactInternalMemoizedMergedChildContext=t,po(Dh),po(Xc),Qn(Xc,t)):po(Dh),Qn(Dh,r)}var KA=null,SB=!1,NV=!1;function Z1e(t){KA===null?KA=[t]:KA.push(t)}function t9e(t){SB=!0,Z1e(t)}function vb(){if(!NV&&KA!==null){NV=!0;var t=0,e=fn;try{var r=KA;for(fn=1;t<r.length;t++){var i=r[t];do i=i(!0);while(i!==null)}KA=null,SB=!1}catch(s){throw KA!==null&&(KA=KA.slice(t+1)),w1e(dee,vb),s}finally{fn=e,NV=!1}}return null}var oC=[],aC=0,G8=null,j8=0,$p=[],Lp=0,Cx=null,ly=1,cy="";function Sw(t,e){oC[aC++]=j8,oC[aC++]=G8,G8=t,j8=e}function J1e(t,e,r){$p[Lp++]=ly,$p[Lp++]=cy,$p[Lp++]=Cx,Cx=t;var i=ly;t=cy;var s=32-M0(i)-1;i&=~(1<<s),r+=1;var n=32-M0(e)+s;if(30<n){var o=s-s%5;n=(i&(1<<o)-1).toString(32),i>>=o,s-=o,ly=1<<32-M0(e)+s|r<<s|i,cy=n+t}else ly=1<<n|r<<s|i,cy=t}function bee(t){t.return!==null&&(Sw(t,1),J1e(t,1,0))}function wee(t){for(;t===G8;)G8=oC[--aC],oC[aC]=null,j8=oC[--aC],oC[aC]=null;for(;t===Cx;)Cx=$p[--Lp],$p[Lp]=null,cy=$p[--Lp],$p[Lp]=null,ly=$p[--Lp],$p[Lp]=null}var Nd=null,$d=null,_o=!1,u0=null;function K1e(t,e){var r=Hp(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function tle(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Nd=t,$d=Ov(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Nd=t,$d=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Cx!==null?{id:ly,overflow:cy}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=Hp(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,Nd=t,$d=null,!0):!1;default:return!1}}function Lq(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Dq(t){if(_o){var e=$d;if(e){var r=e;if(!tle(t,e)){if(Lq(t))throw Error(mt(418));e=Ov(r.nextSibling);var i=Nd;e&&tle(t,e)?K1e(i,r):(t.flags=t.flags&-4097|2,_o=!1,Nd=t)}}else{if(Lq(t))throw Error(mt(418));t.flags=t.flags&-4097|2,_o=!1,Nd=t}}}function rle(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Nd=t}function wD(t){if(t!==Nd)return!1;if(!_o)return rle(t),_o=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Oq(t.type,t.memoizedProps)),e&&(e=$d)){if(Lq(t))throw eve(),Error(mt(418));for(;e;)K1e(t,e),e=Ov(e.nextSibling)}if(rle(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(mt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){$d=Ov(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}$d=null}}else $d=Nd?Ov(t.stateNode.nextSibling):null;return!0}function eve(){for(var t=$d;t;)t=Ov(t.nextSibling)}function v3(){$d=Nd=null,_o=!1}function xee(t){u0===null?u0=[t]:u0.push(t)}var r9e=Wy.ReactCurrentBatchConfig;function t0(t,e){if(t&&t.defaultProps){e=Ro({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}var H8=_b(null),q8=null,lC=null,Tee=null;function See(){Tee=lC=q8=null}function Eee(t){var e=H8.current;po(H8),t._currentValue=e}function Nq(t,e,r){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===r)break;t=t.return}}function kC(t,e){q8=t,Tee=lC=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Oh=!0),t.firstContext=null)}function Kp(t){var e=t._currentValue;if(Tee!==t)if(t={context:t,memoizedValue:e,next:null},lC===null){if(q8===null)throw Error(mt(308));lC=t,q8.dependencies={lanes:0,firstContext:t}}else lC=lC.next=t;return e}var W2=null;function Cee(t){W2===null?W2=[t]:W2.push(t)}function tve(t,e,r,i){var s=e.interleaved;return s===null?(r.next=r,Cee(e)):(r.next=s.next,s.next=r),e.interleaved=r,Oy(t,i)}function Oy(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var k1=!1;function Mee(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function rve(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function fy(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Pv(t,e,r){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Ps&2){var s=i.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),i.pending=e,Oy(t,r)}return s=i.interleaved,s===null?(e.next=e,Cee(i)):(e.next=s.next,s.next=e),i.interleaved=e,Oy(t,r)}function MF(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,pee(t,r)}}function ile(t,e){var r=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var s=null,n=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};n===null?s=n=o:n=n.next=o,r=r.next}while(r!==null);n===null?s=n=e:n=n.next=e}else s=n=e;r={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:n,shared:i.shared,effects:i.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function W8(t,e,r,i){var s=t.updateQueue;k1=!1;var n=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?n=c:o.next=c,o=l;var h=t.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=c:a.next=c,h.lastBaseUpdate=l))}if(n!==null){var p=s.baseState;o=0,h=c=l=null,a=n;do{var A=a.lane,_=a.eventTime;if((i&A)===A){h!==null&&(h=h.next={eventTime:_,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var w=t,T=a;switch(A=e,_=r,T.tag){case 1:if(w=T.payload,typeof w=="function"){p=w.call(_,p,A);break e}p=w;break e;case 3:w.flags=w.flags&-65537|128;case 0:if(w=T.payload,A=typeof w=="function"?w.call(_,p,A):w,A==null)break e;p=Ro({},p,A);break e;case 2:k1=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,A=s.effects,A===null?s.effects=[a]:A.push(a))}else _={eventTime:_,lane:A,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(c=h=_,l=p):h=h.next=_,o|=A;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;A=a,a=A.next,A.next=null,s.lastBaseUpdate=A,s.shared.pending=null}}while(1);if(h===null&&(l=p),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else n===null&&(s.shared.lanes=0);Rx|=o,t.lanes=o,t.memoizedState=p}}function sle(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],s=i.callback;if(s!==null){if(i.callback=null,i=r,typeof s!="function")throw Error(mt(191,s));s.call(i)}}}var ive=new t1e.Component().refs;function Fq(t,e,r,i){e=t.memoizedState,r=r(i,e),r=r==null?e:Ro({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var EB={isMounted:function(t){return(t=t._reactInternals)?AT(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var i=ku(),s=$v(t),n=fy(i,s);n.payload=e,r!=null&&(n.callback=r),e=Pv(t,n,s),e!==null&&(R0(e,t,s,i),MF(e,t,s))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var i=ku(),s=$v(t),n=fy(i,s);n.tag=1,n.payload=e,r!=null&&(n.callback=r),e=Pv(t,n,s),e!==null&&(R0(e,t,s,i),MF(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=ku(),i=$v(t),s=fy(r,i);s.tag=2,e!=null&&(s.callback=e),e=Pv(t,s,i),e!==null&&(R0(e,t,i,r),MF(e,t,i))}};function nle(t,e,r,i,s,n,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,n,o):e.prototype&&e.prototype.isPureReactComponent?!w$(r,i)||!w$(s,n):!0}function sve(t,e,r){var i=!1,s=Yv,n=e.contextType;return typeof n=="object"&&n!==null?n=Kp(n):(s=Nh(e)?Ex:Xc.current,i=e.contextTypes,n=(i=i!=null)?_3(t,s):Yv),e=new e(r,n),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=EB,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=n),e}function ole(t,e,r,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,i),e.state!==t&&EB.enqueueReplaceState(e,e.state,null)}function kq(t,e,r,i){var s=t.stateNode;s.props=r,s.state=t.memoizedState,s.refs=ive,Mee(t);var n=e.contextType;typeof n=="object"&&n!==null?s.context=Kp(n):(n=Nh(e)?Ex:Xc.current,s.context=_3(t,n)),s.state=t.memoizedState,n=e.getDerivedStateFromProps,typeof n=="function"&&(Fq(t,e,n,r),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&EB.enqueueReplaceState(s,s.state,null),W8(t,r,s,i),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function _R(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(mt(309));var i=r.stateNode}if(!i)throw Error(mt(147,t));var s=i,n=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===n?e.ref:(e=function(o){var a=s.refs;a===ive&&(a=s.refs={}),o===null?delete a[n]:a[n]=o},e._stringRef=n,e)}if(typeof t!="string")throw Error(mt(284));if(!r._owner)throw Error(mt(290,t))}return t}function xD(t,e){throw t=Object.prototype.toString.call(e),Error(mt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ale(t){var e=t._init;return e(t._payload)}function nve(t){function e(M,O){if(t){var $=M.deletions;$===null?(M.deletions=[O],M.flags|=16):$.push(O)}}function r(M,O){if(!t)return null;for(;O!==null;)e(M,O),O=O.sibling;return null}function i(M,O){for(M=new Map;O!==null;)O.key!==null?M.set(O.key,O):M.set(O.index,O),O=O.sibling;return M}function s(M,O){return M=Lv(M,O),M.index=0,M.sibling=null,M}function n(M,O,$){return M.index=$,t?($=M.alternate,$!==null?($=$.index,$<O?(M.flags|=2,O):$):(M.flags|=2,O)):(M.flags|=1048576,O)}function o(M){return t&&M.alternate===null&&(M.flags|=2),M}function a(M,O,$,L){return O===null||O.tag!==6?(O=GV($,M.mode,L),O.return=M,O):(O=s(O,$),O.return=M,O)}function l(M,O,$,L){var k=$.type;return k===eC?h(M,O,$.props.children,L,$.key):O!==null&&(O.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===F1&&ale(k)===O.type)?(L=s(O,$.props),L.ref=_R(M,O,$),L.return=M,L):(L=LF($.type,$.key,$.props,null,M.mode,L),L.ref=_R(M,O,$),L.return=M,L)}function c(M,O,$,L){return O===null||O.tag!==4||O.stateNode.containerInfo!==$.containerInfo||O.stateNode.implementation!==$.implementation?(O=jV($,M.mode,L),O.return=M,O):(O=s(O,$.children||[]),O.return=M,O)}function h(M,O,$,L,k){return O===null||O.tag!==7?(O=cx($,M.mode,L,k),O.return=M,O):(O=s(O,$),O.return=M,O)}function p(M,O,$){if(typeof O=="string"&&O!==""||typeof O=="number")return O=GV(""+O,M.mode,$),O.return=M,O;if(typeof O=="object"&&O!==null){switch(O.$$typeof){case dD:return $=LF(O.type,O.key,O.props,null,M.mode,$),$.ref=_R(M,null,O),$.return=M,$;case KE:return O=jV(O,M.mode,$),O.return=M,O;case F1:var L=O._init;return p(M,L(O._payload),$)}if(NO(O)||fR(O))return O=cx(O,M.mode,$,null),O.return=M,O;xD(M,O)}return null}function A(M,O,$,L){var k=O!==null?O.key:null;if(typeof $=="string"&&$!==""||typeof $=="number")return k!==null?null:a(M,O,""+$,L);if(typeof $=="object"&&$!==null){switch($.$$typeof){case dD:return $.key===k?l(M,O,$,L):null;case KE:return $.key===k?c(M,O,$,L):null;case F1:return k=$._init,A(M,O,k($._payload),L)}if(NO($)||fR($))return k!==null?null:h(M,O,$,L,null);xD(M,$)}return null}function _(M,O,$,L,k){if(typeof L=="string"&&L!==""||typeof L=="number")return M=M.get($)||null,a(O,M,""+L,k);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case dD:return M=M.get(L.key===null?$:L.key)||null,l(O,M,L,k);case KE:return M=M.get(L.key===null?$:L.key)||null,c(O,M,L,k);case F1:var F=L._init;return _(M,O,$,F(L._payload),k)}if(NO(L)||fR(L))return M=M.get($)||null,h(O,M,L,k,null);xD(O,L)}return null}function w(M,O,$,L){for(var k=null,F=null,G=O,z=O=0,Z=null;G!==null&&z<$.length;z++){G.index>z?(Z=G,G=null):Z=G.sibling;var J=A(M,G,$[z],L);if(J===null){G===null&&(G=Z);break}t&&G&&J.alternate===null&&e(M,G),O=n(J,O,z),F===null?k=J:F.sibling=J,F=J,G=Z}if(z===$.length)return r(M,G),_o&&Sw(M,z),k;if(G===null){for(;z<$.length;z++)G=p(M,$[z],L),G!==null&&(O=n(G,O,z),F===null?k=G:F.sibling=G,F=G);return _o&&Sw(M,z),k}for(G=i(M,G);z<$.length;z++)Z=_(G,M,z,$[z],L),Z!==null&&(t&&Z.alternate!==null&&G.delete(Z.key===null?z:Z.key),O=n(Z,O,z),F===null?k=Z:F.sibling=Z,F=Z);return t&&G.forEach(function(te){return e(M,te)}),_o&&Sw(M,z),k}function T(M,O,$,L){var k=fR($);if(typeof k!="function")throw Error(mt(150));if($=k.call($),$==null)throw Error(mt(151));for(var F=k=null,G=O,z=O=0,Z=null,J=$.next();G!==null&&!J.done;z++,J=$.next()){G.index>z?(Z=G,G=null):Z=G.sibling;var te=A(M,G,J.value,L);if(te===null){G===null&&(G=Z);break}t&&G&&te.alternate===null&&e(M,G),O=n(te,O,z),F===null?k=te:F.sibling=te,F=te,G=Z}if(J.done)return r(M,G),_o&&Sw(M,z),k;if(G===null){for(;!J.done;z++,J=$.next())J=p(M,J.value,L),J!==null&&(O=n(J,O,z),F===null?k=J:F.sibling=J,F=J);return _o&&Sw(M,z),k}for(G=i(M,G);!J.done;z++,J=$.next())J=_(G,M,z,J.value,L),J!==null&&(t&&J.alternate!==null&&G.delete(J.key===null?z:J.key),O=n(J,O,z),F===null?k=J:F.sibling=J,F=J);return t&&G.forEach(function(re){return e(M,re)}),_o&&Sw(M,z),k}function C(M,O,$,L){if(typeof $=="object"&&$!==null&&$.type===eC&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case dD:e:{for(var k=$.key,F=O;F!==null;){if(F.key===k){if(k=$.type,k===eC){if(F.tag===7){r(M,F.sibling),O=s(F,$.props.children),O.return=M,M=O;break e}}else if(F.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===F1&&ale(k)===F.type){r(M,F.sibling),O=s(F,$.props),O.ref=_R(M,F,$),O.return=M,M=O;break e}r(M,F);break}else e(M,F);F=F.sibling}$.type===eC?(O=cx($.props.children,M.mode,L,$.key),O.return=M,M=O):(L=LF($.type,$.key,$.props,null,M.mode,L),L.ref=_R(M,O,$),L.return=M,M=L)}return o(M);case KE:e:{for(F=$.key;O!==null;){if(O.key===F)if(O.tag===4&&O.stateNode.containerInfo===$.containerInfo&&O.stateNode.implementation===$.implementation){r(M,O.sibling),O=s(O,$.children||[]),O.return=M,M=O;break e}else{r(M,O);break}else e(M,O);O=O.sibling}O=jV($,M.mode,L),O.return=M,M=O}return o(M);case F1:return F=$._init,C(M,O,F($._payload),L)}if(NO($))return w(M,O,$,L);if(fR($))return T(M,O,$,L);xD(M,$)}return typeof $=="string"&&$!==""||typeof $=="number"?($=""+$,O!==null&&O.tag===6?(r(M,O.sibling),O=s(O,$),O.return=M,M=O):(r(M,O),O=GV($,M.mode,L),O.return=M,M=O),o(M)):r(M,O)}return C}var b3=nve(!0),ove=nve(!1),eL={},yg=_b(eL),E$=_b(eL),C$=_b(eL);function Y2(t){if(t===eL)throw Error(mt(174));return t}function Ree(t,e){switch(Qn(C$,e),Qn(E$,t),Qn(yg,eL),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:gq(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=gq(e,t)}po(yg),Qn(yg,e)}function w3(){po(yg),po(E$),po(C$)}function ave(t){Y2(C$.current);var e=Y2(yg.current),r=gq(e,t.type);e!==r&&(Qn(E$,t),Qn(yg,r))}function Oee(t){E$.current===t&&(po(yg),po(E$))}var So=_b(0);function Y8(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var FV=[];function Pee(){for(var t=0;t<FV.length;t++)FV[t]._workInProgressVersionPrimary=null;FV.length=0}var RF=Wy.ReactCurrentDispatcher,kV=Wy.ReactCurrentBatchConfig,Mx=0,Eo=null,tl=null,Sl=null,Q8=!1,mI=!1,M$=0,i9e=0;function bc(){throw Error(mt(321))}function Iee(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!N0(t[r],e[r]))return!1;return!0}function $ee(t,e,r,i,s,n){if(Mx=n,Eo=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,RF.current=t===null||t.memoizedState===null?a9e:l9e,t=r(i,s),mI){n=0;do{if(mI=!1,M$=0,25<=n)throw Error(mt(301));n+=1,Sl=tl=null,e.updateQueue=null,RF.current=c9e,t=r(i,s)}while(mI)}if(RF.current=X8,e=tl!==null&&tl.next!==null,Mx=0,Sl=tl=Eo=null,Q8=!1,e)throw Error(mt(300));return t}function Lee(){var t=M$!==0;return M$=0,t}function Xm(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Sl===null?Eo.memoizedState=Sl=t:Sl=Sl.next=t,Sl}function ef(){if(tl===null){var t=Eo.alternate;t=t!==null?t.memoizedState:null}else t=tl.next;var e=Sl===null?Eo.memoizedState:Sl.next;if(e!==null)Sl=e,tl=t;else{if(t===null)throw Error(mt(310));tl=t,t={memoizedState:tl.memoizedState,baseState:tl.baseState,baseQueue:tl.baseQueue,queue:tl.queue,next:null},Sl===null?Eo.memoizedState=Sl=t:Sl=Sl.next=t}return Sl}function R$(t,e){return typeof e=="function"?e(t):e}function BV(t){var e=ef(),r=e.queue;if(r===null)throw Error(mt(311));r.lastRenderedReducer=t;var i=tl,s=i.baseQueue,n=r.pending;if(n!==null){if(s!==null){var o=s.next;s.next=n.next,n.next=o}i.baseQueue=s=n,r.pending=null}if(s!==null){n=s.next,i=i.baseState;var a=o=null,l=null,c=n;do{var h=c.lane;if((Mx&h)===h)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var p={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=p,o=i):l=l.next=p,Eo.lanes|=h,Rx|=h}c=c.next}while(c!==null&&c!==n);l===null?o=i:l.next=a,N0(i,e.memoizedState)||(Oh=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,r.lastRenderedState=i}if(t=r.interleaved,t!==null){s=t;do n=s.lane,Eo.lanes|=n,Rx|=n,s=s.next;while(s!==t)}else s===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function UV(t){var e=ef(),r=e.queue;if(r===null)throw Error(mt(311));r.lastRenderedReducer=t;var i=r.dispatch,s=r.pending,n=e.memoizedState;if(s!==null){r.pending=null;var o=s=s.next;do n=t(n,o.action),o=o.next;while(o!==s);N0(n,e.memoizedState)||(Oh=!0),e.memoizedState=n,e.baseQueue===null&&(e.baseState=n),r.lastRenderedState=n}return[n,i]}function lve(){}function cve(t,e){var r=Eo,i=ef(),s=e(),n=!N0(i.memoizedState,s);if(n&&(i.memoizedState=s,Oh=!0),i=i.queue,Dee(dve.bind(null,r,i,t),[t]),i.getSnapshot!==e||n||Sl!==null&&Sl.memoizedState.tag&1){if(r.flags|=2048,O$(9,hve.bind(null,r,i,s,e),void 0,null),$l===null)throw Error(mt(349));Mx&30||uve(r,e,s)}return s}function uve(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Eo.updateQueue,e===null?(e={lastEffect:null,stores:null},Eo.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function hve(t,e,r,i){e.value=r,e.getSnapshot=i,pve(e)&&fve(t)}function dve(t,e,r){return r(function(){pve(e)&&fve(t)})}function pve(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!N0(t,r)}catch{return!0}}function fve(t){var e=Oy(t,1);e!==null&&R0(e,t,1,-1)}function lle(t){var e=Xm();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:R$,lastRenderedState:t},e.queue=t,t=t.dispatch=o9e.bind(null,Eo,t),[e.memoizedState,t]}function O$(t,e,r,i){return t={tag:t,create:e,destroy:r,deps:i,next:null},e=Eo.updateQueue,e===null?(e={lastEffect:null,stores:null},Eo.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(i=r.next,r.next=t,t.next=i,e.lastEffect=t)),t}function mve(){return ef().memoizedState}function OF(t,e,r,i){var s=Xm();Eo.flags|=t,s.memoizedState=O$(1|e,r,void 0,i===void 0?null:i)}function CB(t,e,r,i){var s=ef();i=i===void 0?null:i;var n=void 0;if(tl!==null){var o=tl.memoizedState;if(n=o.destroy,i!==null&&Iee(i,o.deps)){s.memoizedState=O$(e,r,n,i);return}}Eo.flags|=t,s.memoizedState=O$(1|e,r,n,i)}function cle(t,e){return OF(8390656,8,t,e)}function Dee(t,e){return CB(2048,8,t,e)}function gve(t,e){return CB(4,2,t,e)}function Ave(t,e){return CB(4,4,t,e)}function yve(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function _ve(t,e,r){return r=r!=null?r.concat([t]):null,CB(4,4,yve.bind(null,e,t),r)}function Nee(){}function vve(t,e){var r=ef();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&Iee(e,i[1])?i[0]:(r.memoizedState=[t,e],t)}function bve(t,e){var r=ef();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&Iee(e,i[1])?i[0]:(t=t(),r.memoizedState=[t,e],t)}function wve(t,e,r){return Mx&21?(N0(r,e)||(r=S1e(),Eo.lanes|=r,Rx|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Oh=!0),t.memoizedState=r)}function s9e(t,e){var r=fn;fn=r!==0&&4>r?r:4,t(!0);var i=kV.transition;kV.transition={};try{t(!1),e()}finally{fn=r,kV.transition=i}}function xve(){return ef().memoizedState}function n9e(t,e,r){var i=$v(t);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},Tve(t))Sve(e,r);else if(r=tve(t,e,r,i),r!==null){var s=ku();R0(r,t,i,s),Eve(r,e,i)}}function o9e(t,e,r){var i=$v(t),s={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(Tve(t))Sve(e,s);else{var n=t.alternate;if(t.lanes===0&&(n===null||n.lanes===0)&&(n=e.lastRenderedReducer,n!==null))try{var o=e.lastRenderedState,a=n(o,r);if(s.hasEagerState=!0,s.eagerState=a,N0(a,o)){var l=e.interleaved;l===null?(s.next=s,Cee(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}r=tve(t,e,s,i),r!==null&&(s=ku(),R0(r,t,i,s),Eve(r,e,i))}}function Tve(t){var e=t.alternate;return t===Eo||e!==null&&e===Eo}function Sve(t,e){mI=Q8=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function Eve(t,e,r){if(r&4194240){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,pee(t,r)}}var X8={readContext:Kp,useCallback:bc,useContext:bc,useEffect:bc,useImperativeHandle:bc,useInsertionEffect:bc,useLayoutEffect:bc,useMemo:bc,useReducer:bc,useRef:bc,useState:bc,useDebugValue:bc,useDeferredValue:bc,useTransition:bc,useMutableSource:bc,useSyncExternalStore:bc,useId:bc,unstable_isNewReconciler:!1},a9e={readContext:Kp,useCallback:function(t,e){return Xm().memoizedState=[t,e===void 0?null:e],t},useContext:Kp,useEffect:cle,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,OF(4194308,4,yve.bind(null,e,t),r)},useLayoutEffect:function(t,e){return OF(4194308,4,t,e)},useInsertionEffect:function(t,e){return OF(4,2,t,e)},useMemo:function(t,e){var r=Xm();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var i=Xm();return e=r!==void 0?r(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=n9e.bind(null,Eo,t),[i.memoizedState,t]},useRef:function(t){var e=Xm();return t={current:t},e.memoizedState=t},useState:lle,useDebugValue:Nee,useDeferredValue:function(t){return Xm().memoizedState=t},useTransition:function(){var t=lle(!1),e=t[0];return t=s9e.bind(null,t[1]),Xm().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var i=Eo,s=Xm();if(_o){if(r===void 0)throw Error(mt(407));r=r()}else{if(r=e(),$l===null)throw Error(mt(349));Mx&30||uve(i,e,r)}s.memoizedState=r;var n={value:r,getSnapshot:e};return s.queue=n,cle(dve.bind(null,i,n,t),[t]),i.flags|=2048,O$(9,hve.bind(null,i,n,r,e),void 0,null),r},useId:function(){var t=Xm(),e=$l.identifierPrefix;if(_o){var r=cy,i=ly;r=(i&~(1<<32-M0(i)-1)).toString(32)+r,e=":"+e+"R"+r,r=M$++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=i9e++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},l9e={readContext:Kp,useCallback:vve,useContext:Kp,useEffect:Dee,useImperativeHandle:_ve,useInsertionEffect:gve,useLayoutEffect:Ave,useMemo:bve,useReducer:BV,useRef:mve,useState:function(){return BV(R$)},useDebugValue:Nee,useDeferredValue:function(t){var e=ef();return wve(e,tl.memoizedState,t)},useTransition:function(){var t=BV(R$)[0],e=ef().memoizedState;return[t,e]},useMutableSource:lve,useSyncExternalStore:cve,useId:xve,unstable_isNewReconciler:!1},c9e={readContext:Kp,useCallback:vve,useContext:Kp,useEffect:Dee,useImperativeHandle:_ve,useInsertionEffect:gve,useLayoutEffect:Ave,useMemo:bve,useReducer:UV,useRef:mve,useState:function(){return UV(R$)},useDebugValue:Nee,useDeferredValue:function(t){var e=ef();return tl===null?e.memoizedState=t:wve(e,tl.memoizedState,t)},useTransition:function(){var t=UV(R$)[0],e=ef().memoizedState;return[t,e]},useMutableSource:lve,useSyncExternalStore:cve,useId:xve,unstable_isNewReconciler:!1};function x3(t,e){try{var r="",i=e;do r+=F8e(i),i=i.return;while(i);var s=r}catch(n){s=`
Error generating stack: `+n.message+`
`+n.stack}return{value:t,source:e,stack:s,digest:null}}function VV(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function Bq(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var u9e=typeof WeakMap=="function"?WeakMap:Map;function Cve(t,e,r){r=fy(-1,r),r.tag=3,r.payload={element:null};var i=e.value;return r.callback=function(){J8||(J8=!0,Qq=i),Bq(t,e)},r}function Mve(t,e,r){r=fy(-1,r),r.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var s=e.value;r.payload=function(){return i(s)},r.callback=function(){Bq(t,e)}}var n=t.stateNode;return n!==null&&typeof n.componentDidCatch=="function"&&(r.callback=function(){Bq(t,e),typeof i!="function"&&(Iv===null?Iv=new Set([this]):Iv.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),r}function ule(t,e,r){var i=t.pingCache;if(i===null){i=t.pingCache=new u9e;var s=new Set;i.set(e,s)}else s=i.get(e),s===void 0&&(s=new Set,i.set(e,s));s.has(r)||(s.add(r),t=T9e.bind(null,t,e,r),e.then(t,t))}function hle(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function dle(t,e,r,i,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=fy(-1,1),e.tag=2,Pv(r,e,1))),r.lanes|=1),t)}var h9e=Wy.ReactCurrentOwner,Oh=!1;function Ru(t,e,r,i){e.child=t===null?ove(e,null,r,i):b3(e,t.child,r,i)}function ple(t,e,r,i,s){r=r.render;var n=e.ref;return kC(e,s),i=$ee(t,e,r,i,n,s),r=Lee(),t!==null&&!Oh?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Py(t,e,s)):(_o&&r&&bee(e),e.flags|=1,Ru(t,e,i,s),e.child)}function fle(t,e,r,i,s){if(t===null){var n=r.type;return typeof n=="function"&&!jee(n)&&n.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=n,Rve(t,e,n,i,s)):(t=LF(r.type,null,i,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(n=t.child,!(t.lanes&s)){var o=n.memoizedProps;if(r=r.compare,r=r!==null?r:w$,r(o,i)&&t.ref===e.ref)return Py(t,e,s)}return e.flags|=1,t=Lv(n,i),t.ref=e.ref,t.return=e,e.child=t}function Rve(t,e,r,i,s){if(t!==null){var n=t.memoizedProps;if(w$(n,i)&&t.ref===e.ref)if(Oh=!1,e.pendingProps=i=n,(t.lanes&s)!==0)t.flags&131072&&(Oh=!0);else return e.lanes=t.lanes,Py(t,e,s)}return Uq(t,e,r,i,s)}function Ove(t,e,r){var i=e.pendingProps,s=i.children,n=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qn(uC,yd),yd|=r;else{if(!(r&1073741824))return t=n!==null?n.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Qn(uC,yd),yd|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=n!==null?n.baseLanes:r,Qn(uC,yd),yd|=i}else n!==null?(i=n.baseLanes|r,e.memoizedState=null):i=r,Qn(uC,yd),yd|=i;return Ru(t,e,s,r),e.child}function Pve(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function Uq(t,e,r,i,s){var n=Nh(r)?Ex:Xc.current;return n=_3(e,n),kC(e,s),r=$ee(t,e,r,i,n,s),i=Lee(),t!==null&&!Oh?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Py(t,e,s)):(_o&&i&&bee(e),e.flags|=1,Ru(t,e,r,s),e.child)}function mle(t,e,r,i,s){if(Nh(r)){var n=!0;z8(e)}else n=!1;if(kC(e,s),e.stateNode===null)PF(t,e),sve(e,r,i),kq(e,r,i,s),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=r.contextType;typeof c=="object"&&c!==null?c=Kp(c):(c=Nh(r)?Ex:Xc.current,c=_3(e,c));var h=r.getDerivedStateFromProps,p=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";p||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&ole(e,o,i,c),k1=!1;var A=e.memoizedState;o.state=A,W8(e,i,o,s),l=e.memoizedState,a!==i||A!==l||Dh.current||k1?(typeof h=="function"&&(Fq(e,r,h,i),l=e.memoizedState),(a=k1||nle(e,r,a,i,A,l,c))?(p||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,rve(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:t0(e.type,a),o.props=c,p=e.pendingProps,A=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=Kp(l):(l=Nh(r)?Ex:Xc.current,l=_3(e,l));var _=r.getDerivedStateFromProps;(h=typeof _=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==p||A!==l)&&ole(e,o,i,l),k1=!1,A=e.memoizedState,o.state=A,W8(e,i,o,s);var w=e.memoizedState;a!==p||A!==w||Dh.current||k1?(typeof _=="function"&&(Fq(e,r,_,i),w=e.memoizedState),(c=k1||nle(e,r,c,i,A,w,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,w,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,w,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&A===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&A===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=w),o.props=i,o.state=w,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&A===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&A===t.memoizedState||(e.flags|=1024),i=!1)}return Vq(t,e,r,i,n,s)}function Vq(t,e,r,i,s,n){Pve(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return s&&ele(e,r,!1),Py(t,e,n);i=e.stateNode,h9e.current=e;var a=o&&typeof r.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=b3(e,t.child,null,n),e.child=b3(e,null,a,n)):Ru(t,e,a,n),e.memoizedState=i.state,s&&ele(e,r,!0),e.child}function Ive(t){var e=t.stateNode;e.pendingContext?Kae(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Kae(t,e.context,!1),Ree(t,e.containerInfo)}function gle(t,e,r,i,s){return v3(),xee(s),e.flags|=256,Ru(t,e,r,i),e.child}var zq={dehydrated:null,treeContext:null,retryLane:0};function Gq(t){return{baseLanes:t,cachePool:null,transitions:null}}function $ve(t,e,r){var i=e.pendingProps,s=So.current,n=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(n=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Qn(So,s&1),t===null)return Dq(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,n?(i=e.mode,n=e.child,o={mode:"hidden",children:o},!(i&1)&&n!==null?(n.childLanes=0,n.pendingProps=o):n=OB(o,i,0,null),t=cx(t,i,r,null),n.return=e,t.return=e,n.sibling=t,e.child=n,e.child.memoizedState=Gq(r),e.memoizedState=zq,t):Fee(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return d9e(t,e,o,i,a,s,r);if(n){n=i.fallback,o=e.mode,s=t.child,a=s.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==s?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Lv(s,l),i.subtreeFlags=s.subtreeFlags&14680064),a!==null?n=Lv(a,n):(n=cx(n,o,r,null),n.flags|=2),n.return=e,i.return=e,i.sibling=n,e.child=i,i=n,n=e.child,o=t.child.memoizedState,o=o===null?Gq(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},n.memoizedState=o,n.childLanes=t.childLanes&~r,e.memoizedState=zq,i}return n=t.child,t=n.sibling,i=Lv(n,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=r),i.return=e,i.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=i,e.memoizedState=null,i}function Fee(t,e){return e=OB({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function TD(t,e,r,i){return i!==null&&xee(i),b3(e,t.child,null,r),t=Fee(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function d9e(t,e,r,i,s,n,o){if(r)return e.flags&256?(e.flags&=-257,i=VV(Error(mt(422))),TD(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(n=i.fallback,s=e.mode,i=OB({mode:"visible",children:i.children},s,0,null),n=cx(n,s,o,null),n.flags|=2,i.return=e,n.return=e,i.sibling=n,e.child=i,e.mode&1&&b3(e,t.child,null,o),e.child.memoizedState=Gq(o),e.memoizedState=zq,n);if(!(e.mode&1))return TD(t,e,o,null);if(s.data==="$!"){if(i=s.nextSibling&&s.nextSibling.dataset,i)var a=i.dgst;return i=a,n=Error(mt(419)),i=VV(n,i,void 0),TD(t,e,o,i)}if(a=(o&t.childLanes)!==0,Oh||a){if(i=$l,i!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(i.suspendedLanes|o)?0:s,s!==0&&s!==n.retryLane&&(n.retryLane=s,Oy(t,s),R0(i,t,s,-1))}return Gee(),i=VV(Error(mt(421))),TD(t,e,o,i)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=S9e.bind(null,t),s._reactRetry=e,null):(t=n.treeContext,$d=Ov(s.nextSibling),Nd=e,_o=!0,u0=null,t!==null&&($p[Lp++]=ly,$p[Lp++]=cy,$p[Lp++]=Cx,ly=t.id,cy=t.overflow,Cx=e),e=Fee(e,i.children),e.flags|=4096,e)}function Ale(t,e,r){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Nq(t.return,e,r)}function zV(t,e,r,i,s){var n=t.memoizedState;n===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:s}:(n.isBackwards=e,n.rendering=null,n.renderingStartTime=0,n.last=i,n.tail=r,n.tailMode=s)}function Lve(t,e,r){var i=e.pendingProps,s=i.revealOrder,n=i.tail;if(Ru(t,e,i.children,r),i=So.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Ale(t,r,e);else if(t.tag===19)Ale(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Qn(So,i),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(r=e.child,s=null;r!==null;)t=r.alternate,t!==null&&Y8(t)===null&&(s=r),r=r.sibling;r=s,r===null?(s=e.child,e.child=null):(s=r.sibling,r.sibling=null),zV(e,!1,s,r,n);break;case"backwards":for(r=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Y8(t)===null){e.child=s;break}t=s.sibling,s.sibling=r,r=s,s=t}zV(e,!0,r,null,n);break;case"together":zV(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function PF(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Py(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),Rx|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(mt(153));if(e.child!==null){for(t=e.child,r=Lv(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=Lv(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function p9e(t,e,r){switch(e.tag){case 3:Ive(e),v3();break;case 5:ave(e);break;case 1:Nh(e.type)&&z8(e);break;case 4:Ree(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,s=e.memoizedProps.value;Qn(H8,i._currentValue),i._currentValue=s;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Qn(So,So.current&1),e.flags|=128,null):r&e.child.childLanes?$ve(t,e,r):(Qn(So,So.current&1),t=Py(t,e,r),t!==null?t.sibling:null);Qn(So,So.current&1);break;case 19:if(i=(r&e.childLanes)!==0,t.flags&128){if(i)return Lve(t,e,r);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Qn(So,So.current),i)break;return null;case 22:case 23:return e.lanes=0,Ove(t,e,r)}return Py(t,e,r)}var Dve,jq,Nve,Fve;Dve=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};jq=function(){};Nve=function(t,e,r,i){var s=t.memoizedProps;if(s!==i){t=e.stateNode,Y2(yg.current);var n=null;switch(r){case"input":s=dq(t,s),i=dq(t,i),n=[];break;case"select":s=Ro({},s,{value:void 0}),i=Ro({},i,{value:void 0}),n=[];break;case"textarea":s=mq(t,s),i=mq(t,i),n=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=U8)}Aq(r,i);var o;r=null;for(c in s)if(!i.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var a=s[c];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(m$.hasOwnProperty(c)?n||(n=[]):(n=n||[]).push(c,null));for(c in i){var l=i[c];if(a=s!=null?s[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(n||(n=[]),n.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(n=n||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(n=n||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(m$.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&eo("scroll",t),n||a===l||(n=[])):(n=n||[]).push(c,l))}r&&(n=n||[]).push("style",r);var c=n;(e.updateQueue=c)&&(e.flags|=4)}};Fve=function(t,e,r,i){r!==i&&(e.flags|=4)};function vR(t,e){if(!_o)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function wc(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,i=0;if(e)for(var s=t.child;s!==null;)r|=s.lanes|s.childLanes,i|=s.subtreeFlags&14680064,i|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)r|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=i,t.childLanes=r,e}function f9e(t,e,r){var i=e.pendingProps;switch(wee(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wc(e),null;case 1:return Nh(e.type)&&V8(),wc(e),null;case 3:return i=e.stateNode,w3(),po(Dh),po(Xc),Pee(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(wD(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,u0!==null&&(Jq(u0),u0=null))),jq(t,e),wc(e),null;case 5:Oee(e);var s=Y2(C$.current);if(r=e.type,t!==null&&e.stateNode!=null)Nve(t,e,r,i,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(mt(166));return wc(e),null}if(t=Y2(yg.current),wD(e)){i=e.stateNode,r=e.type;var n=e.memoizedProps;switch(i[sg]=e,i[S$]=n,t=(e.mode&1)!==0,r){case"dialog":eo("cancel",i),eo("close",i);break;case"iframe":case"object":case"embed":eo("load",i);break;case"video":case"audio":for(s=0;s<kO.length;s++)eo(kO[s],i);break;case"source":eo("error",i);break;case"img":case"image":case"link":eo("error",i),eo("load",i);break;case"details":eo("toggle",i);break;case"input":Eae(i,n),eo("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!n.multiple},eo("invalid",i);break;case"textarea":Mae(i,n),eo("invalid",i)}Aq(r,n),s=null;for(var o in n)if(n.hasOwnProperty(o)){var a=n[o];o==="children"?typeof a=="string"?i.textContent!==a&&(n.suppressHydrationWarning!==!0&&bD(i.textContent,a,t),s=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(n.suppressHydrationWarning!==!0&&bD(i.textContent,a,t),s=["children",""+a]):m$.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&eo("scroll",i)}switch(r){case"input":pD(i),Cae(i,n,!0);break;case"textarea":pD(i),Rae(i);break;case"select":case"option":break;default:typeof n.onClick=="function"&&(i.onclick=U8)}i=s,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=u1e(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(r,{is:i.is}):(t=o.createElement(r),r==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,r),t[sg]=e,t[S$]=i,Dve(t,e,!1,!1),e.stateNode=t;e:{switch(o=yq(r,i),r){case"dialog":eo("cancel",t),eo("close",t),s=i;break;case"iframe":case"object":case"embed":eo("load",t),s=i;break;case"video":case"audio":for(s=0;s<kO.length;s++)eo(kO[s],t);s=i;break;case"source":eo("error",t),s=i;break;case"img":case"image":case"link":eo("error",t),eo("load",t),s=i;break;case"details":eo("toggle",t),s=i;break;case"input":Eae(t,i),s=dq(t,i),eo("invalid",t);break;case"option":s=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},s=Ro({},i,{value:void 0}),eo("invalid",t);break;case"textarea":Mae(t,i),s=mq(t,i),eo("invalid",t);break;default:s=i}Aq(r,s),a=s;for(n in a)if(a.hasOwnProperty(n)){var l=a[n];n==="style"?p1e(t,l):n==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&h1e(t,l)):n==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&g$(t,l):typeof l=="number"&&g$(t,""+l):n!=="suppressContentEditableWarning"&&n!=="suppressHydrationWarning"&&n!=="autoFocus"&&(m$.hasOwnProperty(n)?l!=null&&n==="onScroll"&&eo("scroll",t):l!=null&&aee(t,n,l,o))}switch(r){case"input":pD(t),Cae(t,i,!1);break;case"textarea":pD(t),Rae(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Wv(i.value));break;case"select":t.multiple=!!i.multiple,n=i.value,n!=null?LC(t,!!i.multiple,n,!1):i.defaultValue!=null&&LC(t,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=U8)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return wc(e),null;case 6:if(t&&e.stateNode!=null)Fve(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(mt(166));if(r=Y2(C$.current),Y2(yg.current),wD(e)){if(i=e.stateNode,r=e.memoizedProps,i[sg]=e,(n=i.nodeValue!==r)&&(t=Nd,t!==null))switch(t.tag){case 3:bD(i.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&bD(i.nodeValue,r,(t.mode&1)!==0)}n&&(e.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[sg]=e,e.stateNode=i}return wc(e),null;case 13:if(po(So),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(_o&&$d!==null&&e.mode&1&&!(e.flags&128))eve(),v3(),e.flags|=98560,n=!1;else if(n=wD(e),i!==null&&i.dehydrated!==null){if(t===null){if(!n)throw Error(mt(318));if(n=e.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(mt(317));n[sg]=e}else v3(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;wc(e),n=!1}else u0!==null&&(Jq(u0),u0=null),n=!0;if(!n)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||So.current&1?ol===0&&(ol=3):Gee())),e.updateQueue!==null&&(e.flags|=4),wc(e),null);case 4:return w3(),jq(t,e),t===null&&x$(e.stateNode.containerInfo),wc(e),null;case 10:return Eee(e.type._context),wc(e),null;case 17:return Nh(e.type)&&V8(),wc(e),null;case 19:if(po(So),n=e.memoizedState,n===null)return wc(e),null;if(i=(e.flags&128)!==0,o=n.rendering,o===null)if(i)vR(n,!1);else{if(ol!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Y8(t),o!==null){for(e.flags|=128,vR(n,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=r,r=e.child;r!==null;)n=r,t=i,n.flags&=14680066,o=n.alternate,o===null?(n.childLanes=0,n.lanes=t,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,t=o.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return Qn(So,So.current&1|2),e.child}t=t.sibling}n.tail!==null&&ha()>T3&&(e.flags|=128,i=!0,vR(n,!1),e.lanes=4194304)}else{if(!i)if(t=Y8(o),t!==null){if(e.flags|=128,i=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),vR(n,!0),n.tail===null&&n.tailMode==="hidden"&&!o.alternate&&!_o)return wc(e),null}else 2*ha()-n.renderingStartTime>T3&&r!==1073741824&&(e.flags|=128,i=!0,vR(n,!1),e.lanes=4194304);n.isBackwards?(o.sibling=e.child,e.child=o):(r=n.last,r!==null?r.sibling=o:e.child=o,n.last=o)}return n.tail!==null?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=ha(),e.sibling=null,r=So.current,Qn(So,i?r&1|2:r&1),e):(wc(e),null);case 22:case 23:return zee(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?yd&1073741824&&(wc(e),e.subtreeFlags&6&&(e.flags|=8192)):wc(e),null;case 24:return null;case 25:return null}throw Error(mt(156,e.tag))}function m9e(t,e){switch(wee(e),e.tag){case 1:return Nh(e.type)&&V8(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return w3(),po(Dh),po(Xc),Pee(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Oee(e),null;case 13:if(po(So),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(mt(340));v3()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return po(So),null;case 4:return w3(),null;case 10:return Eee(e.type._context),null;case 22:case 23:return zee(),null;case 24:return null;default:return null}}var SD=!1,Vc=!1,g9e=typeof WeakSet=="function"?WeakSet:Set,Kt=null;function cC(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){jo(t,e,i)}else r.current=null}function Hq(t,e,r){try{r()}catch(i){jo(t,e,i)}}var yle=!1;function A9e(t,e){if(Mq=F8,t=V1e(),vee(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var s=i.anchorOffset,n=i.focusNode;i=i.focusOffset;try{r.nodeType,n.nodeType}catch{r=null;break e}var o=0,a=-1,l=-1,c=0,h=0,p=t,A=null;t:for(;;){for(var _;p!==r||s!==0&&p.nodeType!==3||(a=o+s),p!==n||i!==0&&p.nodeType!==3||(l=o+i),p.nodeType===3&&(o+=p.nodeValue.length),(_=p.firstChild)!==null;)A=p,p=_;for(;;){if(p===t)break t;if(A===r&&++c===s&&(a=o),A===n&&++h===i&&(l=o),(_=p.nextSibling)!==null)break;p=A,A=p.parentNode}p=_}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(Rq={focusedElem:t,selectionRange:r},F8=!1,Kt=e;Kt!==null;)if(e=Kt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Kt=t;else for(;Kt!==null;){e=Kt;try{var w=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(w!==null){var T=w.memoizedProps,C=w.memoizedState,M=e.stateNode,O=M.getSnapshotBeforeUpdate(e.elementType===e.type?T:t0(e.type,T),C);M.__reactInternalSnapshotBeforeUpdate=O}break;case 3:var $=e.stateNode.containerInfo;$.nodeType===1?$.textContent="":$.nodeType===9&&$.documentElement&&$.removeChild($.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(mt(163))}}catch(L){jo(e,e.return,L)}if(t=e.sibling,t!==null){t.return=e.return,Kt=t;break}Kt=e.return}return w=yle,yle=!1,w}function gI(t,e,r){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&t)===t){var n=s.destroy;s.destroy=void 0,n!==void 0&&Hq(e,r,n)}s=s.next}while(s!==i)}}function MB(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var i=r.create;r.destroy=i()}r=r.next}while(r!==e)}}function qq(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function kve(t){var e=t.alternate;e!==null&&(t.alternate=null,kve(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[sg],delete e[S$],delete e[Iq],delete e[Kke],delete e[e9e])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Bve(t){return t.tag===5||t.tag===3||t.tag===4}function _le(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Bve(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Wq(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=U8));else if(i!==4&&(t=t.child,t!==null))for(Wq(t,e,r),t=t.sibling;t!==null;)Wq(t,e,r),t=t.sibling}function Yq(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Yq(t,e,r),t=t.sibling;t!==null;)Yq(t,e,r),t=t.sibling}var Wl=null,s0=!1;function A_(t,e,r){for(r=r.child;r!==null;)Uve(t,e,r),r=r.sibling}function Uve(t,e,r){if(Ag&&typeof Ag.onCommitFiberUnmount=="function")try{Ag.onCommitFiberUnmount(vB,r)}catch{}switch(r.tag){case 5:Vc||cC(r,e);case 6:var i=Wl,s=s0;Wl=null,A_(t,e,r),Wl=i,s0=s,Wl!==null&&(s0?(t=Wl,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Wl.removeChild(r.stateNode));break;case 18:Wl!==null&&(s0?(t=Wl,r=r.stateNode,t.nodeType===8?DV(t.parentNode,r):t.nodeType===1&&DV(t,r),v$(t)):DV(Wl,r.stateNode));break;case 4:i=Wl,s=s0,Wl=r.stateNode.containerInfo,s0=!0,A_(t,e,r),Wl=i,s0=s;break;case 0:case 11:case 14:case 15:if(!Vc&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){s=i=i.next;do{var n=s,o=n.destroy;n=n.tag,o!==void 0&&(n&2||n&4)&&Hq(r,e,o),s=s.next}while(s!==i)}A_(t,e,r);break;case 1:if(!Vc&&(cC(r,e),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(a){jo(r,e,a)}A_(t,e,r);break;case 21:A_(t,e,r);break;case 22:r.mode&1?(Vc=(i=Vc)||r.memoizedState!==null,A_(t,e,r),Vc=i):A_(t,e,r);break;default:A_(t,e,r)}}function vle(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new g9e),e.forEach(function(i){var s=E9e.bind(null,t,i);r.has(i)||(r.add(i),i.then(s,s))})}}function vf(t,e){var r=e.deletions;if(r!==null)for(var i=0;i<r.length;i++){var s=r[i];try{var n=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Wl=a.stateNode,s0=!1;break e;case 3:Wl=a.stateNode.containerInfo,s0=!0;break e;case 4:Wl=a.stateNode.containerInfo,s0=!0;break e}a=a.return}if(Wl===null)throw Error(mt(160));Uve(n,o,s),Wl=null,s0=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){jo(s,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Vve(e,t),e=e.sibling}function Vve(t,e){var r=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(vf(e,t),im(t),i&4){try{gI(3,t,t.return),MB(3,t)}catch(T){jo(t,t.return,T)}try{gI(5,t,t.return)}catch(T){jo(t,t.return,T)}}break;case 1:vf(e,t),im(t),i&512&&r!==null&&cC(r,r.return);break;case 5:if(vf(e,t),im(t),i&512&&r!==null&&cC(r,r.return),t.flags&32){var s=t.stateNode;try{g$(s,"")}catch(T){jo(t,t.return,T)}}if(i&4&&(s=t.stateNode,s!=null)){var n=t.memoizedProps,o=r!==null?r.memoizedProps:n,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&n.type==="radio"&&n.name!=null&&l1e(s,n),yq(a,o);var c=yq(a,n);for(o=0;o<l.length;o+=2){var h=l[o],p=l[o+1];h==="style"?p1e(s,p):h==="dangerouslySetInnerHTML"?h1e(s,p):h==="children"?g$(s,p):aee(s,h,p,c)}switch(a){case"input":pq(s,n);break;case"textarea":c1e(s,n);break;case"select":var A=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!n.multiple;var _=n.value;_!=null?LC(s,!!n.multiple,_,!1):A!==!!n.multiple&&(n.defaultValue!=null?LC(s,!!n.multiple,n.defaultValue,!0):LC(s,!!n.multiple,n.multiple?[]:"",!1))}s[S$]=n}catch(T){jo(t,t.return,T)}}break;case 6:if(vf(e,t),im(t),i&4){if(t.stateNode===null)throw Error(mt(162));s=t.stateNode,n=t.memoizedProps;try{s.nodeValue=n}catch(T){jo(t,t.return,T)}}break;case 3:if(vf(e,t),im(t),i&4&&r!==null&&r.memoizedState.isDehydrated)try{v$(e.containerInfo)}catch(T){jo(t,t.return,T)}break;case 4:vf(e,t),im(t);break;case 13:vf(e,t),im(t),s=t.child,s.flags&8192&&(n=s.memoizedState!==null,s.stateNode.isHidden=n,!n||s.alternate!==null&&s.alternate.memoizedState!==null||(Uee=ha())),i&4&&vle(t);break;case 22:if(h=r!==null&&r.memoizedState!==null,t.mode&1?(Vc=(c=Vc)||h,vf(e,t),Vc=c):vf(e,t),im(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!h&&t.mode&1)for(Kt=t,h=t.child;h!==null;){for(p=Kt=h;Kt!==null;){switch(A=Kt,_=A.child,A.tag){case 0:case 11:case 14:case 15:gI(4,A,A.return);break;case 1:cC(A,A.return);var w=A.stateNode;if(typeof w.componentWillUnmount=="function"){i=A,r=A.return;try{e=i,w.props=e.memoizedProps,w.state=e.memoizedState,w.componentWillUnmount()}catch(T){jo(i,r,T)}}break;case 5:cC(A,A.return);break;case 22:if(A.memoizedState!==null){wle(p);continue}}_!==null?(_.return=A,Kt=_):wle(p)}h=h.sibling}e:for(h=null,p=t;;){if(p.tag===5){if(h===null){h=p;try{s=p.stateNode,c?(n=s.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none"):(a=p.stateNode,l=p.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=d1e("display",o))}catch(T){jo(t,t.return,T)}}}else if(p.tag===6){if(h===null)try{p.stateNode.nodeValue=c?"":p.memoizedProps}catch(T){jo(t,t.return,T)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;h===p&&(h=null),p=p.return}h===p&&(h=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:vf(e,t),im(t),i&4&&vle(t);break;case 21:break;default:vf(e,t),im(t)}}function im(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(Bve(r)){var i=r;break e}r=r.return}throw Error(mt(160))}switch(i.tag){case 5:var s=i.stateNode;i.flags&32&&(g$(s,""),i.flags&=-33);var n=_le(t);Yq(t,n,s);break;case 3:case 4:var o=i.stateNode.containerInfo,a=_le(t);Wq(t,a,o);break;default:throw Error(mt(161))}}catch(l){jo(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function y9e(t,e,r){Kt=t,zve(t)}function zve(t,e,r){for(var i=(t.mode&1)!==0;Kt!==null;){var s=Kt,n=s.child;if(s.tag===22&&i){var o=s.memoizedState!==null||SD;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||Vc;a=SD;var c=Vc;if(SD=o,(Vc=l)&&!c)for(Kt=s;Kt!==null;)o=Kt,l=o.child,o.tag===22&&o.memoizedState!==null?xle(s):l!==null?(l.return=o,Kt=l):xle(s);for(;n!==null;)Kt=n,zve(n),n=n.sibling;Kt=s,SD=a,Vc=c}ble(t)}else s.subtreeFlags&8772&&n!==null?(n.return=s,Kt=n):ble(t)}}function ble(t){for(;Kt!==null;){var e=Kt;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Vc||MB(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Vc)if(r===null)i.componentDidMount();else{var s=e.elementType===e.type?r.memoizedProps:t0(e.type,r.memoizedProps);i.componentDidUpdate(s,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var n=e.updateQueue;n!==null&&sle(e,n,i);break;case 3:var o=e.updateQueue;if(o!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}sle(e,o,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var h=c.memoizedState;if(h!==null){var p=h.dehydrated;p!==null&&v$(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(mt(163))}Vc||e.flags&512&&qq(e)}catch(A){jo(e,e.return,A)}}if(e===t){Kt=null;break}if(r=e.sibling,r!==null){r.return=e.return,Kt=r;break}Kt=e.return}}function wle(t){for(;Kt!==null;){var e=Kt;if(e===t){Kt=null;break}var r=e.sibling;if(r!==null){r.return=e.return,Kt=r;break}Kt=e.return}}function xle(t){for(;Kt!==null;){var e=Kt;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{MB(4,e)}catch(l){jo(e,r,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var s=e.return;try{i.componentDidMount()}catch(l){jo(e,s,l)}}var n=e.return;try{qq(e)}catch(l){jo(e,n,l)}break;case 5:var o=e.return;try{qq(e)}catch(l){jo(e,o,l)}}}catch(l){jo(e,e.return,l)}if(e===t){Kt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Kt=a;break}Kt=e.return}}var _9e=Math.ceil,Z8=Wy.ReactCurrentDispatcher,kee=Wy.ReactCurrentOwner,Yp=Wy.ReactCurrentBatchConfig,Ps=0,$l=null,La=null,rc=0,yd=0,uC=_b(0),ol=0,P$=null,Rx=0,RB=0,Bee=0,AI=null,xh=null,Uee=0,T3=1/0,YA=null,J8=!1,Qq=null,Iv=null,ED=!1,lv=null,K8=0,yI=0,Xq=null,IF=-1,$F=0;function ku(){return Ps&6?ha():IF!==-1?IF:IF=ha()}function $v(t){return t.mode&1?Ps&2&&rc!==0?rc&-rc:r9e.transition!==null?($F===0&&($F=S1e()),$F):(t=fn,t!==0||(t=window.event,t=t===void 0?16:I1e(t.type)),t):1}function R0(t,e,r,i){if(50<yI)throw yI=0,Xq=null,Error(mt(185));Z4(t,r,i),(!(Ps&2)||t!==$l)&&(t===$l&&(!(Ps&2)&&(RB|=r),ol===4&&Z1(t,rc)),Fh(t,i),r===1&&Ps===0&&!(e.mode&1)&&(T3=ha()+500,SB&&vb()))}function Fh(t,e){var r=t.callbackNode;rke(t,e);var i=N8(t,t===$l?rc:0);if(i===0)r!==null&&Iae(r),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(r!=null&&Iae(r),e===1)t.tag===0?t9e(Tle.bind(null,t)):Z1e(Tle.bind(null,t)),Zke(function(){!(Ps&6)&&vb()}),r=null;else{switch(E1e(i)){case 1:r=dee;break;case 4:r=x1e;break;case 16:r=D8;break;case 536870912:r=T1e;break;default:r=D8}r=Xve(r,Gve.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function Gve(t,e){if(IF=-1,$F=0,Ps&6)throw Error(mt(327));var r=t.callbackNode;if(BC()&&t.callbackNode!==r)return null;var i=N8(t,t===$l?rc:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=ek(t,i);else{e=i;var s=Ps;Ps|=2;var n=Hve();($l!==t||rc!==e)&&(YA=null,T3=ha()+500,lx(t,e));do try{w9e();break}catch(a){jve(t,a)}while(1);See(),Z8.current=n,Ps=s,La!==null?e=0:($l=null,rc=0,e=ol)}if(e!==0){if(e===2&&(s=xq(t),s!==0&&(i=s,e=Zq(t,s))),e===1)throw r=P$,lx(t,0),Z1(t,i),Fh(t,ha()),r;if(e===6)Z1(t,i);else{if(s=t.current.alternate,!(i&30)&&!v9e(s)&&(e=ek(t,i),e===2&&(n=xq(t),n!==0&&(i=n,e=Zq(t,n))),e===1))throw r=P$,lx(t,0),Z1(t,i),Fh(t,ha()),r;switch(t.finishedWork=s,t.finishedLanes=i,e){case 0:case 1:throw Error(mt(345));case 2:Ew(t,xh,YA);break;case 3:if(Z1(t,i),(i&130023424)===i&&(e=Uee+500-ha(),10<e)){if(N8(t,0)!==0)break;if(s=t.suspendedLanes,(s&i)!==i){ku(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Pq(Ew.bind(null,t,xh,YA),e);break}Ew(t,xh,YA);break;case 4:if(Z1(t,i),(i&4194240)===i)break;for(e=t.eventTimes,s=-1;0<i;){var o=31-M0(i);n=1<<o,o=e[o],o>s&&(s=o),i&=~n}if(i=s,i=ha()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*_9e(i/1960))-i,10<i){t.timeoutHandle=Pq(Ew.bind(null,t,xh,YA),i);break}Ew(t,xh,YA);break;case 5:Ew(t,xh,YA);break;default:throw Error(mt(329))}}}return Fh(t,ha()),t.callbackNode===r?Gve.bind(null,t):null}function Zq(t,e){var r=AI;return t.current.memoizedState.isDehydrated&&(lx(t,e).flags|=256),t=ek(t,e),t!==2&&(e=xh,xh=r,e!==null&&Jq(e)),t}function Jq(t){xh===null?xh=t:xh.push.apply(xh,t)}function v9e(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var s=r[i],n=s.getSnapshot;s=s.value;try{if(!N0(n(),s))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Z1(t,e){for(e&=~Bee,e&=~RB,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-M0(e),i=1<<r;t[r]=-1,e&=~i}}function Tle(t){if(Ps&6)throw Error(mt(327));BC();var e=N8(t,0);if(!(e&1))return Fh(t,ha()),null;var r=ek(t,e);if(t.tag!==0&&r===2){var i=xq(t);i!==0&&(e=i,r=Zq(t,i))}if(r===1)throw r=P$,lx(t,0),Z1(t,e),Fh(t,ha()),r;if(r===6)throw Error(mt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ew(t,xh,YA),Fh(t,ha()),null}function Vee(t,e){var r=Ps;Ps|=1;try{return t(e)}finally{Ps=r,Ps===0&&(T3=ha()+500,SB&&vb())}}function Ox(t){lv!==null&&lv.tag===0&&!(Ps&6)&&BC();var e=Ps;Ps|=1;var r=Yp.transition,i=fn;try{if(Yp.transition=null,fn=1,t)return t()}finally{fn=i,Yp.transition=r,Ps=e,!(Ps&6)&&vb()}}function zee(){yd=uC.current,po(uC)}function lx(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,Xke(r)),La!==null)for(r=La.return;r!==null;){var i=r;switch(wee(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&V8();break;case 3:w3(),po(Dh),po(Xc),Pee();break;case 5:Oee(i);break;case 4:w3();break;case 13:po(So);break;case 19:po(So);break;case 10:Eee(i.type._context);break;case 22:case 23:zee()}r=r.return}if($l=t,La=t=Lv(t.current,null),rc=yd=e,ol=0,P$=null,Bee=RB=Rx=0,xh=AI=null,W2!==null){for(e=0;e<W2.length;e++)if(r=W2[e],i=r.interleaved,i!==null){r.interleaved=null;var s=i.next,n=r.pending;if(n!==null){var o=n.next;n.next=s,i.next=o}r.pending=i}W2=null}return t}function jve(t,e){do{var r=La;try{if(See(),RF.current=X8,Q8){for(var i=Eo.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}Q8=!1}if(Mx=0,Sl=tl=Eo=null,mI=!1,M$=0,kee.current=null,r===null||r.return===null){ol=1,P$=e,La=null;break}e:{var n=t,o=r.return,a=r,l=e;if(e=rc,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,h=a,p=h.tag;if(!(h.mode&1)&&(p===0||p===11||p===15)){var A=h.alternate;A?(h.updateQueue=A.updateQueue,h.memoizedState=A.memoizedState,h.lanes=A.lanes):(h.updateQueue=null,h.memoizedState=null)}var _=hle(o);if(_!==null){_.flags&=-257,dle(_,o,a,n,e),_.mode&1&&ule(n,c,e),e=_,l=c;var w=e.updateQueue;if(w===null){var T=new Set;T.add(l),e.updateQueue=T}else w.add(l);break e}else{if(!(e&1)){ule(n,c,e),Gee();break e}l=Error(mt(426))}}else if(_o&&a.mode&1){var C=hle(o);if(C!==null){!(C.flags&65536)&&(C.flags|=256),dle(C,o,a,n,e),xee(x3(l,a));break e}}n=l=x3(l,a),ol!==4&&(ol=2),AI===null?AI=[n]:AI.push(n),n=o;do{switch(n.tag){case 3:n.flags|=65536,e&=-e,n.lanes|=e;var M=Cve(n,l,e);ile(n,M);break e;case 1:a=l;var O=n.type,$=n.stateNode;if(!(n.flags&128)&&(typeof O.getDerivedStateFromError=="function"||$!==null&&typeof $.componentDidCatch=="function"&&(Iv===null||!Iv.has($)))){n.flags|=65536,e&=-e,n.lanes|=e;var L=Mve(n,a,e);ile(n,L);break e}}n=n.return}while(n!==null)}Wve(r)}catch(k){e=k,La===r&&r!==null&&(La=r=r.return);continue}break}while(1)}function Hve(){var t=Z8.current;return Z8.current=X8,t===null?X8:t}function Gee(){(ol===0||ol===3||ol===2)&&(ol=4),$l===null||!(Rx&268435455)&&!(RB&268435455)||Z1($l,rc)}function ek(t,e){var r=Ps;Ps|=2;var i=Hve();($l!==t||rc!==e)&&(YA=null,lx(t,e));do try{b9e();break}catch(s){jve(t,s)}while(1);if(See(),Ps=r,Z8.current=i,La!==null)throw Error(mt(261));return $l=null,rc=0,ol}function b9e(){for(;La!==null;)qve(La)}function w9e(){for(;La!==null&&!W8e();)qve(La)}function qve(t){var e=Qve(t.alternate,t,yd);t.memoizedProps=t.pendingProps,e===null?Wve(t):La=e,kee.current=null}function Wve(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=m9e(r,e),r!==null){r.flags&=32767,La=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ol=6,La=null;return}}else if(r=f9e(r,e,yd),r!==null){La=r;return}if(e=e.sibling,e!==null){La=e;return}La=e=t}while(e!==null);ol===0&&(ol=5)}function Ew(t,e,r){var i=fn,s=Yp.transition;try{Yp.transition=null,fn=1,x9e(t,e,r,i)}finally{Yp.transition=s,fn=i}return null}function x9e(t,e,r,i){do BC();while(lv!==null);if(Ps&6)throw Error(mt(327));r=t.finishedWork;var s=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(mt(177));t.callbackNode=null,t.callbackPriority=0;var n=r.lanes|r.childLanes;if(ike(t,n),t===$l&&(La=$l=null,rc=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||ED||(ED=!0,Xve(D8,function(){return BC(),null})),n=(r.flags&15990)!==0,r.subtreeFlags&15990||n){n=Yp.transition,Yp.transition=null;var o=fn;fn=1;var a=Ps;Ps|=4,kee.current=null,A9e(t,r),Vve(r,t),Gke(Rq),F8=!!Mq,Rq=Mq=null,t.current=r,y9e(r),Y8e(),Ps=a,fn=o,Yp.transition=n}else t.current=r;if(ED&&(ED=!1,lv=t,K8=s),n=t.pendingLanes,n===0&&(Iv=null),Z8e(r.stateNode),Fh(t,ha()),e!==null)for(i=t.onRecoverableError,r=0;r<e.length;r++)s=e[r],i(s.value,{componentStack:s.stack,digest:s.digest});if(J8)throw J8=!1,t=Qq,Qq=null,t;return K8&1&&t.tag!==0&&BC(),n=t.pendingLanes,n&1?t===Xq?yI++:(yI=0,Xq=t):yI=0,vb(),null}function BC(){if(lv!==null){var t=E1e(K8),e=Yp.transition,r=fn;try{if(Yp.transition=null,fn=16>t?16:t,lv===null)var i=!1;else{if(t=lv,lv=null,K8=0,Ps&6)throw Error(mt(331));var s=Ps;for(Ps|=4,Kt=t.current;Kt!==null;){var n=Kt,o=n.child;if(Kt.flags&16){var a=n.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Kt=c;Kt!==null;){var h=Kt;switch(h.tag){case 0:case 11:case 15:gI(8,h,n)}var p=h.child;if(p!==null)p.return=h,Kt=p;else for(;Kt!==null;){h=Kt;var A=h.sibling,_=h.return;if(kve(h),h===c){Kt=null;break}if(A!==null){A.return=_,Kt=A;break}Kt=_}}}var w=n.alternate;if(w!==null){var T=w.child;if(T!==null){w.child=null;do{var C=T.sibling;T.sibling=null,T=C}while(T!==null)}}Kt=n}}if(n.subtreeFlags&2064&&o!==null)o.return=n,Kt=o;else e:for(;Kt!==null;){if(n=Kt,n.flags&2048)switch(n.tag){case 0:case 11:case 15:gI(9,n,n.return)}var M=n.sibling;if(M!==null){M.return=n.return,Kt=M;break e}Kt=n.return}}var O=t.current;for(Kt=O;Kt!==null;){o=Kt;var $=o.child;if(o.subtreeFlags&2064&&$!==null)$.return=o,Kt=$;else e:for(o=O;Kt!==null;){if(a=Kt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:MB(9,a)}}catch(k){jo(a,a.return,k)}if(a===o){Kt=null;break e}var L=a.sibling;if(L!==null){L.return=a.return,Kt=L;break e}Kt=a.return}}if(Ps=s,vb(),Ag&&typeof Ag.onPostCommitFiberRoot=="function")try{Ag.onPostCommitFiberRoot(vB,t)}catch{}i=!0}return i}finally{fn=r,Yp.transition=e}}return!1}function Sle(t,e,r){e=x3(r,e),e=Cve(t,e,1),t=Pv(t,e,1),e=ku(),t!==null&&(Z4(t,1,e),Fh(t,e))}function jo(t,e,r){if(t.tag===3)Sle(t,t,r);else for(;e!==null;){if(e.tag===3){Sle(e,t,r);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Iv===null||!Iv.has(i))){t=x3(r,t),t=Mve(e,t,1),e=Pv(e,t,1),t=ku(),e!==null&&(Z4(e,1,t),Fh(e,t));break}}e=e.return}}function T9e(t,e,r){var i=t.pingCache;i!==null&&i.delete(e),e=ku(),t.pingedLanes|=t.suspendedLanes&r,$l===t&&(rc&r)===r&&(ol===4||ol===3&&(rc&130023424)===rc&&500>ha()-Uee?lx(t,0):Bee|=r),Fh(t,e)}function Yve(t,e){e===0&&(t.mode&1?(e=gD,gD<<=1,!(gD&130023424)&&(gD=4194304)):e=1);var r=ku();t=Oy(t,e),t!==null&&(Z4(t,e,r),Fh(t,r))}function S9e(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),Yve(t,r)}function E9e(t,e){var r=0;switch(t.tag){case 13:var i=t.stateNode,s=t.memoizedState;s!==null&&(r=s.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(mt(314))}i!==null&&i.delete(e),Yve(t,r)}var Qve;Qve=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||Dh.current)Oh=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return Oh=!1,p9e(t,e,r);Oh=!!(t.flags&131072)}else Oh=!1,_o&&e.flags&1048576&&J1e(e,j8,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;PF(t,e),t=e.pendingProps;var s=_3(e,Xc.current);kC(e,r),s=$ee(null,e,i,t,s,r);var n=Lee();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Nh(i)?(n=!0,z8(e)):n=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Mee(e),s.updater=EB,e.stateNode=s,s._reactInternals=e,kq(e,i,t,r),e=Vq(null,e,i,!0,n,r)):(e.tag=0,_o&&n&&bee(e),Ru(null,e,s,r),e=e.child),e;case 16:i=e.elementType;e:{switch(PF(t,e),t=e.pendingProps,s=i._init,i=s(i._payload),e.type=i,s=e.tag=M9e(i),t=t0(i,t),s){case 0:e=Uq(null,e,i,t,r);break e;case 1:e=mle(null,e,i,t,r);break e;case 11:e=ple(null,e,i,t,r);break e;case 14:e=fle(null,e,i,t0(i.type,t),r);break e}throw Error(mt(306,i,""))}return e;case 0:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:t0(i,s),Uq(t,e,i,s,r);case 1:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:t0(i,s),mle(t,e,i,s,r);case 3:e:{if(Ive(e),t===null)throw Error(mt(387));i=e.pendingProps,n=e.memoizedState,s=n.element,rve(t,e),W8(e,i,null,r);var o=e.memoizedState;if(i=o.element,n.isDehydrated)if(n={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=n,e.memoizedState=n,e.flags&256){s=x3(Error(mt(423)),e),e=gle(t,e,i,r,s);break e}else if(i!==s){s=x3(Error(mt(424)),e),e=gle(t,e,i,r,s);break e}else for($d=Ov(e.stateNode.containerInfo.firstChild),Nd=e,_o=!0,u0=null,r=ove(e,null,i,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(v3(),i===s){e=Py(t,e,r);break e}Ru(t,e,i,r)}e=e.child}return e;case 5:return ave(e),t===null&&Dq(e),i=e.type,s=e.pendingProps,n=t!==null?t.memoizedProps:null,o=s.children,Oq(i,s)?o=null:n!==null&&Oq(i,n)&&(e.flags|=32),Pve(t,e),Ru(t,e,o,r),e.child;case 6:return t===null&&Dq(e),null;case 13:return $ve(t,e,r);case 4:return Ree(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=b3(e,null,i,r):Ru(t,e,i,r),e.child;case 11:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:t0(i,s),ple(t,e,i,s,r);case 7:return Ru(t,e,e.pendingProps,r),e.child;case 8:return Ru(t,e,e.pendingProps.children,r),e.child;case 12:return Ru(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(i=e.type._context,s=e.pendingProps,n=e.memoizedProps,o=s.value,Qn(H8,i._currentValue),i._currentValue=o,n!==null)if(N0(n.value,o)){if(n.children===s.children&&!Dh.current){e=Py(t,e,r);break e}}else for(n=e.child,n!==null&&(n.return=e);n!==null;){var a=n.dependencies;if(a!==null){o=n.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(n.tag===1){l=fy(-1,r&-r),l.tag=2;var c=n.updateQueue;if(c!==null){c=c.shared;var h=c.pending;h===null?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}n.lanes|=r,l=n.alternate,l!==null&&(l.lanes|=r),Nq(n.return,r,e),a.lanes|=r;break}l=l.next}}else if(n.tag===10)o=n.type===e.type?null:n.child;else if(n.tag===18){if(o=n.return,o===null)throw Error(mt(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),Nq(o,r,e),o=n.sibling}else o=n.child;if(o!==null)o.return=n;else for(o=n;o!==null;){if(o===e){o=null;break}if(n=o.sibling,n!==null){n.return=o.return,o=n;break}o=o.return}n=o}Ru(t,e,s.children,r),e=e.child}return e;case 9:return s=e.type,i=e.pendingProps.children,kC(e,r),s=Kp(s),i=i(s),e.flags|=1,Ru(t,e,i,r),e.child;case 14:return i=e.type,s=t0(i,e.pendingProps),s=t0(i.type,s),fle(t,e,i,s,r);case 15:return Rve(t,e,e.type,e.pendingProps,r);case 17:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:t0(i,s),PF(t,e),e.tag=1,Nh(i)?(t=!0,z8(e)):t=!1,kC(e,r),sve(e,i,s),kq(e,i,s,r),Vq(null,e,i,!0,t,r);case 19:return Lve(t,e,r);case 22:return Ove(t,e,r)}throw Error(mt(156,e.tag))};function Xve(t,e){return w1e(t,e)}function C9e(t,e,r,i){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Hp(t,e,r,i){return new C9e(t,e,r,i)}function jee(t){return t=t.prototype,!(!t||!t.isReactComponent)}function M9e(t){if(typeof t=="function")return jee(t)?1:0;if(t!=null){if(t=t.$$typeof,t===cee)return 11;if(t===uee)return 14}return 2}function Lv(t,e){var r=t.alternate;return r===null?(r=Hp(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function LF(t,e,r,i,s,n){var o=2;if(i=t,typeof t=="function")jee(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case eC:return cx(r.children,s,n,e);case lee:o=8,s|=8;break;case lq:return t=Hp(12,r,e,s|2),t.elementType=lq,t.lanes=n,t;case cq:return t=Hp(13,r,e,s),t.elementType=cq,t.lanes=n,t;case uq:return t=Hp(19,r,e,s),t.elementType=uq,t.lanes=n,t;case n1e:return OB(r,s,n,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case i1e:o=10;break e;case s1e:o=9;break e;case cee:o=11;break e;case uee:o=14;break e;case F1:o=16,i=null;break e}throw Error(mt(130,t==null?t:typeof t,""))}return e=Hp(o,r,e,s),e.elementType=t,e.type=i,e.lanes=n,e}function cx(t,e,r,i){return t=Hp(7,t,i,e),t.lanes=r,t}function OB(t,e,r,i){return t=Hp(22,t,i,e),t.elementType=n1e,t.lanes=r,t.stateNode={isHidden:!1},t}function GV(t,e,r){return t=Hp(6,t,null,e),t.lanes=r,t}function jV(t,e,r){return e=Hp(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function R9e(t,e,r,i,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=TV(0),this.expirationTimes=TV(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=TV(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Hee(t,e,r,i,s,n,o,a,l){return t=new R9e(t,e,r,a,l),e===1?(e=1,n===!0&&(e|=8)):e=0,n=Hp(3,null,null,e),t.current=n,n.stateNode=t,n.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mee(n),t}function O9e(t,e,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:KE,key:i==null?null:""+i,children:t,containerInfo:e,implementation:r}}function Zve(t){if(!t)return Yv;t=t._reactInternals;e:{if(AT(t)!==t||t.tag!==1)throw Error(mt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Nh(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(mt(171))}if(t.tag===1){var r=t.type;if(Nh(r))return X1e(t,r,e)}return e}function Jve(t,e,r,i,s,n,o,a,l){return t=Hee(r,i,!0,t,s,n,o,a,l),t.context=Zve(null),r=t.current,i=ku(),s=$v(r),n=fy(i,s),n.callback=e??null,Pv(r,n,s),t.current.lanes=s,Z4(t,s,i),Fh(t,i),t}function PB(t,e,r,i){var s=e.current,n=ku(),o=$v(s);return r=Zve(r),e.context===null?e.context=r:e.pendingContext=r,e=fy(n,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Pv(s,e,o),t!==null&&(R0(t,s,o,n),MF(t,s,o)),o}function tk(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Ele(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function qee(t,e){Ele(t,e),(t=t.alternate)&&Ele(t,e)}function P9e(){return null}var Kve=typeof reportError=="function"?reportError:function(t){console.error(t)};function Wee(t){this._internalRoot=t}IB.prototype.render=Wee.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(mt(409));PB(t,e,null,null)};IB.prototype.unmount=Wee.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ox(function(){PB(null,t,null,null)}),e[Ry]=null}};function IB(t){this._internalRoot=t}IB.prototype.unstable_scheduleHydration=function(t){if(t){var e=R1e();t={blockedOn:null,target:t,priority:e};for(var r=0;r<X1.length&&e!==0&&e<X1[r].priority;r++);X1.splice(r,0,t),r===0&&P1e(t)}};function Yee(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function $B(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Cle(){}function I9e(t,e,r,i,s){if(s){if(typeof i=="function"){var n=i;i=function(){var c=tk(o);n.call(c)}}var o=Jve(e,i,t,0,null,!1,!1,"",Cle);return t._reactRootContainer=o,t[Ry]=o.current,x$(t.nodeType===8?t.parentNode:t),Ox(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof i=="function"){var a=i;i=function(){var c=tk(l);a.call(c)}}var l=Hee(t,0,!1,null,null,!1,!1,"",Cle);return t._reactRootContainer=l,t[Ry]=l.current,x$(t.nodeType===8?t.parentNode:t),Ox(function(){PB(e,l,r,i)}),l}function LB(t,e,r,i,s){var n=r._reactRootContainer;if(n){var o=n;if(typeof s=="function"){var a=s;s=function(){var l=tk(o);a.call(l)}}PB(e,o,t,s)}else o=I9e(r,e,t,s,i);return tk(o)}C1e=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=FO(e.pendingLanes);r!==0&&(pee(e,r|1),Fh(e,ha()),!(Ps&6)&&(T3=ha()+500,vb()))}break;case 13:Ox(function(){var i=Oy(t,1);if(i!==null){var s=ku();R0(i,t,1,s)}}),qee(t,1)}};fee=function(t){if(t.tag===13){var e=Oy(t,134217728);if(e!==null){var r=ku();R0(e,t,134217728,r)}qee(t,134217728)}};M1e=function(t){if(t.tag===13){var e=$v(t),r=Oy(t,e);if(r!==null){var i=ku();R0(r,t,e,i)}qee(t,e)}};R1e=function(){return fn};O1e=function(t,e){var r=fn;try{return fn=t,e()}finally{fn=r}};vq=function(t,e,r){switch(e){case"input":if(pq(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var i=r[e];if(i!==t&&i.form===t.form){var s=TB(i);if(!s)throw Error(mt(90));a1e(i),pq(i,s)}}}break;case"textarea":c1e(t,r);break;case"select":e=r.value,e!=null&&LC(t,!!r.multiple,e,!1)}};g1e=Vee;A1e=Ox;var $9e={usingClientEntryPoint:!1,Events:[K4,sC,TB,f1e,m1e,Vee]},bR={findFiberByHostInstance:q2,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},L9e={bundleType:bR.bundleType,version:bR.version,rendererPackageName:bR.rendererPackageName,rendererConfig:bR.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Wy.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=v1e(t),t===null?null:t.stateNode},findFiberByHostInstance:bR.findFiberByHostInstance||P9e,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var CD=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!CD.isDisabled&&CD.supportsFiber)try{vB=CD.inject(L9e),Ag=CD}catch{}}Qd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$9e;Qd.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Yee(e))throw Error(mt(200));return O9e(t,e,null,r)};Qd.createRoot=function(t,e){if(!Yee(t))throw Error(mt(299));var r=!1,i="",s=Kve;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Hee(t,1,!1,null,null,r,!1,i,s),t[Ry]=e.current,x$(t.nodeType===8?t.parentNode:t),new Wee(e)};Qd.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(mt(188)):(t=Object.keys(t).join(","),Error(mt(268,t)));return t=v1e(e),t=t===null?null:t.stateNode,t};Qd.flushSync=function(t){return Ox(t)};Qd.hydrate=function(t,e,r){if(!$B(e))throw Error(mt(200));return LB(null,t,e,!0,r)};Qd.hydrateRoot=function(t,e,r){if(!Yee(t))throw Error(mt(405));var i=r!=null&&r.hydratedSources||null,s=!1,n="",o=Kve;if(r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(n=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),e=Jve(e,null,t,1,r??null,s,!1,n,o),t[Ry]=e.current,x$(t),i)for(t=0;t<i.length;t++)r=i[t],s=r._getVersion,s=s(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,s]:e.mutableSourceEagerHydrationData.push(r,s);return new IB(e)};Qd.render=function(t,e,r){if(!$B(e))throw Error(mt(200));return LB(null,t,e,!1,r)};Qd.unmountComponentAtNode=function(t){if(!$B(t))throw Error(mt(40));return t._reactRootContainer?(Ox(function(){LB(null,null,t,!1,function(){t._reactRootContainer=null,t[Ry]=null})}),!0):!1};Qd.unstable_batchedUpdates=Vee;Qd.unstable_renderSubtreeIntoContainer=function(t,e,r,i){if(!$B(r))throw Error(mt(200));if(t==null||t._reactInternals===void 0)throw Error(mt(38));return LB(t,e,r,!1,i)};Qd.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(r){console.error(r)}}e(),t.exports=Qd})(P8e);var Mle=nq;sq.createRoot=Mle.createRoot,sq.hydrateRoot=Mle.hydrateRoot;function u(t,e,r,i){var s,n=arguments.length,o=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,r,o):s(e,r))||o);return n>3&&o&&Object.defineProperty(e,r,o),o}const D9e="modulepreload",N9e=function(t){return"/csb-dashboard/"+t},Rle={},be=function(e,r,i){if(!r||r.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=N9e(n),n in Rle)return;Rle[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let h=s.length-1;h>=0;h--){const p=s[h];if(p.href===n&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":D9e,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((h,p)=>{c.addEventListener("load",h),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())};function F9e(t){return t&&t.release&&typeof t.release=="function"}function k9e(t){return t&&t.acquire&&typeof t.acquire=="function"}let al=class Kq{constructor(e,r,i,s=1,n=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let r;if(Kq.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):k9e(r)&&r.acquire(...e),r}release(e){e&&!Kq.test.disabled&&(this._releaseFunction?this._releaseFunction(e):F9e(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};al.test={disabled:!1};function B9e(t){t.length=0}let Th=class{constructor(e=50,r=50){this._pool=new al(Array,void 0,B9e,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return HV.acquire()}static release(e){return HV.release(e)}static prune(){HV.prune()}};const HV=new Th(100);function $Dt(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function U9e(t,e){for(const r of t)if(r!=null&&e(r))return r}function eW(t){return t!=null&&typeof t[Symbol.iterator]=="function"}const Cw=null;function E(t){return t!=null}function N(t){return t==null}function ka(t,e){return E(t)?e(t):Cw}function LDt(t){return t}function DDt(t){return t}function Pu(t,e){return DB(t,e),t}function DB(t,e){if(N(t))throw new Error(e??"value is None")}function gr(t,e){return E(t)?t:typeof e=="function"?e():e}function Ole(t,e){return E(t)?t:e}function gt(t){return E(t)&&t.destroy(),null}function Nt(t){return E(t)&&t.dispose(),null}function sn(t){return E(t)&&t.remove(),null}function tf(t){return E(t)&&t.abort(),null}function en(t){return E(t)&&t.release(),null}function V9e(t,e,r){return E(t)&&E(e)?E(r)?r(t,e):t.equals(e):t===e}function Px(t){return null}function NDt(t,e){const r=new Array;return t.forEach(i=>{const s=e(i);E(s)&&r.push(s)}),r}function FDt(t,e){const r=new Array;for(const i of t)r.push(Ed(i,null,e));return r}function kDt(t,e){for(const r of t)ka(r,e)}function Ed(t,e,r){return E(t)?r(t):e}function BDt(t){return t.filter(e=>E(e))}function pa(t,...e){let r=t;for(let i=0;i<e.length&&r;++i)r=r[e[i]];return r}function UDt(t){return t}let ts=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(eW(e)){const i=this._getOrCreateGroup(r);for(const s of e)this._isHandle(s)&&i.push(s)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&eW(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){e.forEach(r=>r.remove())}};const ebe=Symbol("Accessor-beforeDestroy");function S3(t){return F0(()=>t.forEach(e=>E(e)&&e.remove()))}function F0(t){return{remove:()=>{t&&(t(),t=void 0)}}}function zDt(t){return F0(E(t)?()=>t.destroy():void 0)}let _I=class Mw{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*Mw._m}getInt(){return this._seed=(Mw._a*this._seed+Mw._c)%Mw._m,this._seed}getFloat(){return this.getInt()/(Mw._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/Mw._m*i}};_I._m=2147483647,_I._a=48271,_I._c=0;function tL(t,e){return e?t.filter((r,i,s)=>s.findIndex(e.bind(null,r))===i):t.filter((r,i,s)=>s.indexOf(r)===i)}function Iy(t,e,r){if(N(t)&&N(e))return!0;if(N(t)||N(e)||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Qee(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function z9e(t,e,r){let i,s;return r?(i=e.filter(n=>!t.some(o=>r(o,n))),s=t.filter(n=>!e.some(o=>r(o,n)))):(i=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:i,removed:s}}function G9e(t){return t&&typeof t.length=="number"}function GDt(t,e){const r=t.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=e)i.push(t.slice(s,s+e));return i}const j9e=!!Array.prototype.fill;function jDt(t,e){if(j9e)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function H9e(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function q9e(t,e,r){const i=t.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return r?e>=t[i-1]?-1:o===e?s:s-1:o===e?s:-1}let tbe=class{constructor(){this.last=0}};const rbe=new tbe;function tW(t,e,r,i){i=i||rbe;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(t[o]===e)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(t[o]===e)return i.last=o,o;return-1}function I$(t,e,r,i){const s=r??t.length,n=tW(t,e,s,i);if(n!==-1)return t[n]=t[s-1],r==null&&t.pop(),e}const bf=new Set;function W9e(t,e,r=t.length,i=e.length,s,n){if(i===0||r===0)return r;bf.clear();for(let a=0;a<i;++a)bf.add(e[a]);s=s||rbe;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(bf.has(t[a])&&(n&&n.push(t[a]),bf.delete(t[a]),t[a]=t[r-1],--r,--a,bf.size===0||r===0))return bf.clear(),r;for(let a=0;a<o;++a)if(bf.has(t[a])&&(n&&n.push(t[a]),bf.delete(t[a]),t[a]=t[r-1],--r,--a,bf.size===0||r===0))return bf.clear(),r;return bf.clear(),r}function Y9e(t,e){let r=0;for(let i=0;i<t.length;++i){const s=t[i];e(s,i)&&(t[r]=s,r++)}t.length=r}function Q9e(t){return t?(Ple.seed=t,()=>Ple.getFloat()):Math.random}function qDt(t,e){const r=Q9e(e);for(let i=t.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=t[i];t[i]=t[s],t[s]=n}return t}const Ple=new _I;function Xee(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function WDt(t,e){const r=new Map,i=t.length;for(let s=0;s<i;s++){const n=t[s],o=e(n,s,t),a=r.get(o);a?a.push(n):r.set(o,[n])}return r}function wR(t){return t instanceof ArrayBuffer}function X9e(t){return t&&t.constructor&&t.constructor.name==="Int8Array"}function R2(t){return t&&t.constructor&&t.constructor.name==="Uint8Array"}function Z9e(t){return t&&t.constructor&&t.constructor.name==="Uint8ClampedArray"}function J9e(t){return t&&t.constructor&&t.constructor.name==="Int16Array"}function Zee(t){return t&&t.constructor&&t.constructor.name==="Uint16Array"}function K9e(t){return t&&t.constructor&&t.constructor.name==="Int32Array"}function Jee(t){return t&&t.constructor&&t.constructor.name==="Uint32Array"}function Kee(t){return t&&t.constructor&&t.constructor.name==="Float32Array"}function ete(t){return t&&t.constructor&&t.constructor.name==="Float64Array"}function MD(t){return E(t)?128+t.buffer.byteLength+64:0}const Rg=1024;function ibe(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&ibe(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function Te(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=abe(t);if(E(e))return e;if(sbe(t))return t.clone();if(nbe(t))return t.map(Te);if(obe(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=Te(t[i]);return r}function rW(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=abe(t);if(E(e))return e;if(nbe(t)){let r=!0;const i=t.map(s=>{const n=rW(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(sbe(t))return t.clone();if(!obe(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const s=t[i],n=rW(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function sbe(t){return typeof t.clone=="function"}function nbe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function obe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function Ile(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function abe(t){if(X9e(t)||R2(t)||Z9e(t)||J9e(t)||Zee(t)||K9e(t)||Jee(t)||Kee(t)||ete(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,Te(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(Te(r));return e}return null}function tte(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function eBe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&Iy(t,e):t instanceof Set?e instanceof Set&&rBe(t,e):t instanceof Map?e instanceof Map&&iBe(t,e):!!Ile(t)&&Ile(e)&&tBe(t,e))}function tBe(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function rBe(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function iBe(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const s=e.get(r);if(s!==i||s===void 0&&!e.has(r))return!1}return!0}function Zc(t){return t?t.__accessor__?t.__accessor__:t.propertyInvalidated?t:null:null}function sBe(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function DF(t,e,r){return r?rk(t,e,{policy:r,path:""}):rk(t,e,null)}function rk(t,e,r){return e?Object.keys(e).reduce((i,s)=>{let n=null,o="merge";if(r&&(n=r.path?`${r.path}.${s}`:s,o=r.policy(n)),o==="replace"||o==="replace-arrays"&&Array.isArray(i[s]))return i[s]=e[s],i;if(i[s]===void 0)return i[s]=Te(e[s]),i;let a=i[s],l=e[s];if(a===l)return i;if(Array.isArray(l)||Array.isArray(i))a=a?Array.isArray(a)?i[s]=a.concat():i[s]=[a]:i[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(r){const c=r.path;r.path=n,i[s]=rk(a,l,r),r.path=c}else i[s]=rk(a,l,null);else i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[s]=l);return i},t||{}):t}function lbe(t){return Array.isArray(t)?t:t.split(".")}function $le(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function nBe(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...$le(r));return e}return $le(t)}function cbe(t,e,r,i){const s=nBe(e);if(s.length!==1){const n=s.map(o=>i(t,o,r));return S3(n)}return i(t,s[0],r)}function rte(t){let e=!1;return()=>{e||(e=!0,t())}}function ube(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.getItemAt(s)}const i=Zc(e);return sBe(i,r)?i.get(r):e[r]}function hbe(t,e,r){if(t==null)return t;const i=ube(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:hbe(i,e,r+1)}function rL(t,e,r=0){return typeof e!="string"||e.includes(".")?hbe(t,lbe(e),r):ube(e,t)}function ik(t,e){return rL(t,e)}function Lle(t,e){return rL(e,t)!==void 0}function iL(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=Te(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function NB(t,e){const r=iL(t);let i=r[e];return i||(i=r[e]={}),i}function oBe(t,e){return DF(t,e,lBe)}const aBe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function lBe(t){return aBe.test(t)?"replace":"merge"}let cv;function Le(t){return typeof cv[t]=="function"?cv[t]=cv[t](globalThis):cv[t]}var k_e,B_e,U_e,V_e;cv=(k_e=globalThis.dojoConfig)!=null&&k_e.has||(B_e=globalThis.esriConfig)!=null&&B_e.has?{...(U_e=globalThis.dojoConfig)==null?void 0:U_e.has,...(V_e=globalThis.esriConfig)==null?void 0:V_e.has}:{},Le.add=(t,e,r,i)=>((i||cv[t]===void 0)&&(cv[t]=e),r&&Le(t)),Le.cache=cv,Le.add("esri-deprecation-warnings",!0),(()=>{var e;Le.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(Le.add("host-browser",t),Le.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),Le.add("dom",t),Le("host-browser")){const r=navigator,i=r.userAgent,s=r.appVersion,n=parseFloat(s);if(Le.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),Le.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),Le.add("khtml",s.includes("Konqueror")?n:void 0),Le.add("edge",parseFloat(i.split("Edge/")[1])||void 0),Le.add("opr",parseFloat(i.split("OPR/")[1])||void 0),Le.add("webkit",!Le("wp")&&!Le("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),Le.add("chrome",!Le("edge")&&!Le("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),Le.add("android",!Le("wp")&&parseFloat(i.split("Android ")[1])||void 0),Le.add("safari",!s.includes("Safari")||Le("wp")||Le("chrome")||Le("android")||Le("edge")||Le("opr")?void 0:parseFloat(s.split("Version/")[1])),Le.add("mac",s.includes("Macintosh")),!Le("wp")&&i.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=i.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));Le.add(o,l),Le.add("ios",l)}Le("webkit")||(!i.includes("Gecko")||Le("wp")||Le("khtml")||Le("edge")||Le.add("mozilla",n),Le("mozilla")&&Le.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&Le.add("esri-mobile",e),r&&Le.add("esri-iPhone",r),Le.add("esri-geolocation",!!navigator.geolocation)}Le.add("esri-wasm","WebAssembly"in globalThis),Le.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),Le.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),Le.add("esri-atomics","Atomics"in globalThis),Le.add("esri-workers","Worker"in globalThis),Le.add("web-feat:cache","caches"in globalThis),Le.add("esri-workers-arraybuffer-transfer",!Le("safari")||Number(Le("safari"))>=12),Le.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),Le.add("featurelayer-simplify-payload-size-factors",[1,1,4]),Le.add("featurelayer-snapshot-enabled",!0),Le.add("featurelayer-snapshot-point-min-threshold",8e4),Le.add("featurelayer-snapshot-point-max-threshold",4e5),Le.add("featurelayer-snapshot-point-coverage",.1),Le.add("featurelayer-advanced-symbols",!1),Le.add("featurelayer-pbf",!0),Le.add("featurelayer-pbf-statistics",!1),Le.add("feature-layers-workers",!0),Le.add("feature-polyline-generalization-factor",1),Le.add("mapview-transitions-duration",200),Le.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),Le.add("mapserver-pbf-version-support",10.81),Le.add("mapservice-popup-identify-max-tolerance",20),Le.add("heatmap-allow-raster-fallback",!0),Le.add("heatmap-force-raster",!1),Le("host-webworker")||Le("host-browser")&&(Le.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),Le.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{Le.add("esri-image-decode",!0,!0,!0)}).catch(()=>{Le.add("esri-image-decode",!1,!0,!0)})}return!1}),Le.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function dbe(t,e,r=!1){return fbe(t,e,r)}function sL(t,e){if(e!=null)return e[t]||pbe(t.split("."),!1,e)}function Jc(t,e,r){const i=t.split("."),s=i.pop(),n=pbe(i,!0,r);n&&s&&(n[s]=e)}function pbe(t,e,r){let i=r;for(const s of t){if(i==null)return;if(!(s in i)){if(!e)return;i[s]={}}i=i[s]}return i}function fbe(t,e,r){return e?Object.keys(e).reduce((i,s)=>{let n=i[s],o=e[s];return n===o?i:n===void 0?(i[s]=Te(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=fbe(n,o,r):i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[s]=o),i)},t||{}):t}var z_e;const ls={analysisTheme:{accentColor:[255,128,0],textColor:"white"},apiKey:void 0,applicationUrl:(z_e=globalThis.location)==null?void 0:z_e.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(dbe(ls,globalThis.esriConfig,!0),delete ls.has),!ls.assetsPath){{const t="4.26.5";ls.assetsPath=`https://js.arcgis.com/${t.slice(0,-2)}/@arcgis/core/assets`}ls.defaultAssetsPath=ls.assetsPath}const cBe=/\{([^\}]+)\}/g;function Dle(t){return t??""}function Og(t,e){return t.replace(cBe,typeof e=="object"?(r,i)=>Dle(sL(i,e)):(r,i)=>Dle(e(i)))}function mbe(t,e){return t.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function ite(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function YDt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}const Nle={info:0,warn:1,error:2,none:3};let we=class Oc{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Oc._loggers[this.module]=this;const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=Oc.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(e={}){const r=Oc._loggers;return Oc._loggers=e,r},set throttlingDisabled(e){Oc._throttlingDisabled=e}}}static getLogger(e){let r=Oc._loggers[e];return r||(r=new Oc({module:e})),r}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!Oc._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[e].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=Oc._tickCounter)return;this._loggedMessages[e].set(s,Oc._tickCounter),Oc._scheduleTickCounterIncrement()}for(const s of ls.log.interceptors)if(s(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;E(i);){const s=i[e];if(E(s))return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=ls.log.level?ls.log.level:"warn";return Nle[this._parentWithMember("level",r)]<=Nle[e]}_argsToKey(...e){return ite(JSON.stringify(e,(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]"))}static _scheduleTickCounterIncrement(){Oc._tickCounterScheduled||(Oc._tickCounterScheduled=!0,Promise.resolve().then(()=>{Oc._tickCounter++,Oc._tickCounterScheduled=!1}))}};we._loggers={},we._tickCounter=0,we._tickCounterScheduled=!1,we._throttlingDisabled=!1;var iy;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(iy||(iy={}));let uBe=class{constructor(e,r){this._observers=e,this._observer=r}remove(){Xee(this._observers,this._observer)}},gbe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return hBe;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,s=!1;const n=r.length;for(let o=0;o<n;++o){const a=r[o];if(a.destroyed)s=!0;else if(a===e){i=!0;break}}return i||(r.push(e),s&&this._removeDestroyedObservers()),new uBe(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let s=0;s<r;++s){for(;s+i<r&&e[s+i].destroyed;)++i;if(i>0){if(!(s+i<r))break;e[s]=e[s+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const hBe={remove:()=>{}};var qi;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.USER=6]="USER"})(qi||(qi={}));const iW=qi.USER+1;function uv(t){switch(t){case"defaults":return qi.DEFAULTS;case"service":return qi.SERVICE;case"portal-item":return qi.PORTAL_ITEM;case"web-scene":return qi.WEB_SCENE;case"web-map":return qi.WEB_MAP;case"user":return qi.USER;default:return null}}function sk(t){switch(t){case qi.DEFAULTS:return"defaults";case qi.SERVICE:return"service";case qi.PORTAL_ITEM:return"portal-item";case qi.WEB_SCENE:return"web-scene";case qi.WEB_MAP:return"web-map";case qi.USER:return"user"}return void 0}function dBe(t){return sk(t)}var Hs;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Hs||(Hs={}));const nk={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},BO=[];let vI=nk;function mi(t){vI.onObservableAccessed(t)}let NF=!1,FF=!1;function $y(t,e,r){if(NF)return ste(t,e,r);Abe(t);const i=e.call(r);return ybe(),i}function pBe(t,e){return $y(nk,t,e)}function ste(t,e,r){const i=NF;NF=!0,Abe(t);let s=null;try{s=e.call(r)}catch(n){FF&&we.getLogger("esri.core.accessorSupport.tracking").error(n)}return ybe(),NF=i,s}function Abe(t){vI=t,BO.push(t)}function ybe(){const t=BO.length;if(t>1){const e=BO.pop();vI=BO[t-2],e.onTrackingEnd()}else if(t===1){const e=BO.pop();vI=nk,e.onTrackingEnd()}else vI=nk}function _be(t,e){const r=e.observerObject;if(r.flags&Hs.DepTrackingInitialized)return;const i=FF;FF=!1,r.flags&Hs.AutoTracked?ste(e,e.metadata.get,t):vbe(t,e),FF=i}const fBe=[];function vbe(t,e){const r=e.observerObject;r.flags&Hs.ExplicitlyTracking||(r.flags|=Hs.ExplicitlyTracking,ste(e,()=>{const i=e.metadata.dependsOn||fBe;for(const s of i)if(typeof s!="string"||s.includes(".")){const n=lbe(s);for(let o=0,a=t;o<n.length&&a!=null&&typeof a=="object";++o)a=Fle(a,n[o],o!==n.length-1)}else Fle(t,s,!1)}),r.flags&=~Hs.ExplicitlyTracking)}function Fle(t,e,r){var n;const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const o=parseInt(i,10);if(!isNaN(o))return Array.isArray(t)?t[o]:t.getItemAt(o)}const s=(n=Zc(t))==null?void 0:n.properties.get(i);return s&&(mi(s.observerObject),_be(t,s)),r?t[i]:void 0}let kle=class{constructor(e,r,i){this.properties=e,this.propertyName=r,this.metadata=i,this.observerObject=new mBe,this._accessed=null,this._handles=null,this.observerObject.flags=Hs.Dirty|(i.nonNullable?Hs.NonNullable:0)|(i.hasOwnProperty("value")?Hs.HasDefaultValue:0)|(i.get===void 0?Hs.DepTrackingInitialized:0)|(i.dependsOn===void 0?Hs.AutoTracked:0),Ble.register(this,this.observerObject)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles(),Ble.unregister(this)}getComputed(){const e=this.observerObject;mi(e);const r=this.properties.store,i=this.propertyName,s=e.flags,n=r.get(i);if(s&Hs.Computing||~s&Hs.Dirty&&r.has(i))return n;e.flags|=Hs.Computing;const o=this.properties.host;let a;s&Hs.AutoTracked?a=$y(this,this.metadata.get,o):(vbe(o,this),a=this.metadata.get.call(o)),r.set(i,a,qi.COMPUTED);const l=r.get(i);return l===n?e.flags&=~Hs.Dirty:pBe(this.commit,this),e.flags&=~Hs.Computing,l}onObservableAccessed(e){e!==this.observerObject&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(e)||this._accessed.push(e))}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=Hs.DepTrackingInitialized;const r=this._accessed;if(r===null)return;let i=this._handles;i===null&&(i=this._handles=[]);for(let s=0;s<r.length;++s)i.push(r[s].observe(e));r.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~Hs.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}},mBe=class extends gbe{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&Hs.Overriden&&(this.flags|=Hs.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&Hs.Dirty&&this.onCommitted(),super.destroy()}};const Ble=new FinalizationRegistry(t=>{t.destroy()});let gBe=class bbe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new bbe;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,Te(i))}),r}get(e){return this._values.get(e)}originOf(){return qi.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function RD(t,e,r){return t!==void 0}function Ule(t,e,r,i){return t!==void 0&&(!(r==null&&t.observerObject.flags&Hs.NonNullable)||(i.lifecycle,iy.INITIALIZING,!1))}function ABe(t){return t&&typeof t.destroy=="function"}we.getLogger("esri.core.accessorSupport.Properties");let yBe=class{constructor(e){this.host=e,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=iy.INITIALIZING,this.store=new gBe,this._origin=qi.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const s=new kle(this,i,r[i]);this.properties.set(i,s)}this.metadatas=r}initialize(){this.lifecycle=iy.CONSTRUCTING}constructed(){this.lifecycle=iy.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,r]of this.properties){if(r.metadata.autoDestroy){const i=this.internalGet(e);i&&ABe(i)&&(i.destroy(),~r.observerObject.flags&Hs.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==iy.INITIALIZING}get(e){const r=this.properties.get(e);if(r.metadata.get)return r.getComputed();mi(r.observerObject);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.properties.get(e);if(i!==void 0&&i.observerObject.flags&Hs.HasDefaultValue)return"defaults"}return sk(r)}has(e){return!!this.properties.has(e)&&this.store.has(e)}keys(){return[...this.properties.keys()]}internalGet(e){const r=this.properties.get(e);if(RD(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.properties.get(e);RD(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const s=this.properties.get(r);if(!RD(s))return"";const n=new Set,o=$y({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(e)});let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n){if(!(l instanceof kle))continue;const c=l.properties.host,h=l.propertyName,p=Zc(c);a+=p?p.getDependsInfo(c,h,i):`${i}${h}: undefined
`}return a}setAtOrigin(e,r,i){const s=this.properties.get(e);if(RD(s))return this._setAtOrigin(s,r,i)}isOverridden(e){const r=this.properties.get(e);return r!==void 0&&!!(r.observerObject.flags&Hs.Overriden)}clearOverride(e){const r=this.properties.get(e),i=r==null?void 0:r.observerObject;i&&i.flags&Hs.Overriden&&(i.flags&=~Hs.Overriden,r.notifyChange())}override(e,r){const i=this.properties.get(e);if(!Ule(i,e,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(qV.release(n),!o)return;r=a}i.observerObject.flags|=Hs.Overriden,this._internalSet(i,r)}set(e,r){const i=this.properties.get(e);if(!Ule(i,e,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(qV.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=uv(e)}getDefaultOrigin(){return sk(this._origin)}notifyChange(e){const r=this.properties.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.properties.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.properties.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==iy.INITIALIZING?this._origin:qi.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const s=this.store,n=e.propertyName;s.has(n,i)&&tte(r,s.get(n))&&~e.observerObject.flags&Hs.Overriden&&i===s.originOf(n)||(e.invalidate(),s.set(n,r,i),e.commit(),_be(this.host,e))}_cast(e,r){const i=qV.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},_Be=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const qV=new al(_Be);function vBe(t,e){return t.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>{if(i==="")return"$";const s=sL(i,e),n=s??"";if(n===void 0)throw new Error(`could not find key "${i}" in template`);return n.toString()})}let wbe=class xbe{constructor(e,r,i){this.name=e,this.details=i,this instanceof xbe&&(this.message=(r&&vBe(r,i))??"")}toString(){return"["+this.name+"]: "+this.message}},ce=class kF extends wbe{constructor(e,r,i){if(super(e,r,i),!(this instanceof kF))return new kF(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return Te(r)}catch{return"[object]"}}))}}catch(e){throw we.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new kF(e.name,e.message,e.details)}};ce.prototype.type="error";function ok(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))ok(t,i,e[i]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(s.length-1,1)[0];return void ok(ik(t,s),n,r)}const i=t.__accessor__;i!=null&&bBe(e,i),t[e]=r}}function bBe(t,e){if(Le("esri-unknown-property-errors")&&!wBe(t,e))throw new ce("set:unknown-property",xBe(t,e))}function wBe(t,e){return e.metadatas[t]!=null}function xBe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let Tbe=class extends al{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=Px(this._set)}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const OD=[];function E3(t){OD.push(t),OD.length===1&&queueMicrotask(()=>{const e=OD.slice();OD.length=0;for(const r of e)r()})}let uy=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){E(e)&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var sW;(function(t){const e=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,A=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const _=n[h-1];if(l(_,A)<=0)break;n[c-1]=_,c=h}n[c-1]=A},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,e(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,e(n,c,h,l),yield}}t.sort=i,t.iterableSort=s})(sW||(sW={}));const Vle=sW,TBe=1.5,SBe=1.1;let Vr=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new tbe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>zle(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];e(s)&&r.push(s)}return r}getItemAt(e){if(!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,zle(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=tW(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(tW(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=W9e(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){Vle.sort(this.data,0,this.length,e)}iterableSort(e){return Vle.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const s=this.data[i];if(e.call(r,s,i))return s}}filterInPlace(e,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(e,r){const i=this.length,s=this.data;for(let n=0;n<i;++n)e.call(r,s[n],n,s)}forEach(e,r){for(let i=0;i<this.length;++i)e.call(r,this.data[i],i,this.data)}map(e,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=e.call(r,this.data[s],s,this.data);return i}reduce(e,r){let i=r;for(let s=0;s<this.length;++s)i=e(i,this.data[s],s,this.data);return i}has(e){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===e)return!0;return!1}};function zle(t){t.data.length>TBe*t.length&&(t.data.length=Math.floor(t.length*SBe))}function EBe(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return{remove:()=>t.clearTimeout(i)}}}}const FB=EBe(globalThis),Gle=new Set;function CBe(t,e,r=!1){r&&Gle.has(e)||(r&&Gle.add(e),t.warn(` DEPRECATED - ${e}`))}function nW(t,e,r={}){if(Le("esri-deprecation-warnings")){const{moduleName:i}=r;Sbe(t,`Property: ${(i?i+"::":"")+e}`,r)}}function Sbe(t,e,r={}){if(Le("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=e;i&&(a+=`
	 Replacement: ${i}`),s&&(a+=`
	 Version: ${s}`),n&&(a+=`
	 See ${n} for more details.`),CBe(t,a,o)}}function kB(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function nL(t,e,r){if(!kB(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,r);if(Array.isArray(e)){const i=e.slice();for(const s of i)t.addEventListener(s,r);return{remove(){for(const s of i)t.removeEventListener(s,r)}}}return t.addEventListener(e,r),{remove(){t.removeEventListener(e,r)}}}function Ebe(t,e,r){if(!kB(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=nL(t,e,s=>{i.remove(),r.call(t,s)});return{remove(){i.remove()}}}const MBe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function J1({key:t}){return MBe[t]||t}function Yi(t="Aborted"){return new ce("AbortError",t)}function di(t,e="Aborted"){if(da(t))throw Yi(e)}function BB(t){return E(t)?"aborted"in t?t:t.signal:t}function da(t){const e=BB(t);return E(e)&&e.aborted}function Sh(t){if(vo(t))throw t}function oW(t){if(!vo(t))throw t}function ic(t,e){const r=BB(t);if(!N(r)){if(!r.aborted)return Ebe(r,"abort",()=>e());e()}}function nte(t,e){const r=BB(t);if(!N(r))return di(r),Ebe(r,"abort",()=>e(Yi()))}function ote(t,e){const r=BB(e);return N(r)?t:new Promise((i,s)=>{let n=ic(e,()=>s(Yi()));const o=()=>n=sn(n);t.then(o,o),t.then(i,s)})}function vo(t){return(t==null?void 0:t.name)==="AbortError"}async function UC(t){try{return await t}catch(e){if(!vo(e))throw e;return}}async function s5t(t,e=we.getLogger("esri")){try{return await t}catch(r){vo(r)||e.error(r)}}function Qv(){let t=null;const e=new Promise((r,i)=>{t={promise:void 0,resolve:r,reject:i}});return t.promise=e,t}async function Vu(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),s=await Vu(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const e=t;return new Promise(r=>{const i=[];let s=e.length;s===0&&r(i),e.forEach(n=>{const o={promise:n||Promise.resolve(n)};i.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&r(i)})})})}async function aW(t){return(await Vu(t)).filter(e=>!!e.value).map(e=>e.value)}function Ix(t,e,r){const i=new AbortController;return ic(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);ic(i,()=>{o&&(clearTimeout(o),n(Yi()))})})}function Zd(t){return t&&typeof t.then=="function"}function lW(t){return Zd(t)?t:Promise.resolve(t)}function Cbe(t,e=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(Yi()),n=Qv();const A=n.promise;if(o){const _=o;o=null,_.abort()}return A}if(s=n||Qv(),n=null,e>0){const A=new AbortController;r=lW(t(...l,A.signal));const _=r;Ix(e).then(()=>{r===_&&(n?A.abort():o=A)})}else r=1,r=lW(t(...l));const c=()=>{const A=i;i=s=r=o=null,A!=null&&a(...A)},h=r,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function Xv(){let t,e;const r=new Promise((s,n)=>{t=s,e=n}),i=s=>{t(s)};return i.resolve=s=>t(s),i.reject=s=>e(s),i.timeout=(s,n)=>FB.setTimeout(()=>i.reject(n),s),i.promise=r,i}function n5t(t,e){return t.then(e,e)}async function jle(t){await Promise.resolve(),di(t)}function o5t(t){return t}function Mbe(t){return 1e3*t}function ate(t){return .001*t}let RBe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},OBe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},cW=0,uW=0;const xR={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},hW=["prepare","preRender","render","postRender","update","finish"],dW=[],$x=new Vr;let PBe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const ak={frameTasks:$x,willDispatch:!1,clearFrameTasks:IBe,dispatch:Pbe,executeFrameTasks:LBe};function EM(t){const e=new OBe(t);return dW.push(e),ak.willDispatch||(ak.willDispatch=!0,E3(Pbe)),e}function C3(t){const e=new RBe(t);return $x.push(e),lk==null&&(cW=performance.now(),lk=requestAnimationFrame(Rbe)),new PBe(e)}let lk=null;function IBe(t=!1){$x.forAll(e=>{e.removed=!0}),t&&Obe()}function $Be(t){uW=Math.max(0,t)}function Rbe(){const t=performance.now();lk=null,lk=$x.length>0?requestAnimationFrame(Rbe):null,ak.executeFrameTasks(t)}function LBe(t){const e=t-cW;cW=t;const r=uW>0?uW:1e3/60,i=Math.max(0,e-r);xR.time=t,xR.frameDuration=r-i;for(let s=0;s<hW.length;s++){const n=performance.now(),o=hW[s];$x.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(xR.elapsedFrameTime=performance.now()-t,xR.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,xR)))}),DBe[s].record(performance.now()-n)}Obe(),NBe.record(performance.now()-t)}const PD=new Vr;function Obe(){$x.forAll(t=>{t.removed&&PD.push(t)}),$x.removeUnorderedMany(PD.data,PD.length),PD.clear()}function Pbe(){for(;dW.length;){const t=dW.shift();t.isActive&&t.callback()}ak.willDispatch=!1}function u5t(t=1,e){const r=Xv(),i=()=>{da(e)?r.reject(Yi()):t===0?r():(--t,E3(()=>i()))};return i(),r.promise}const DBe=hW.map(t=>new uy(t)),NBe=new uy("total");function BF(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}let FBe=0;const kBe=0;function kh(){return++FBe}let UB=class{constructor(e){this._notify=e,this._accessed=[],this._handles=[],this._observerObject=new BBe(this._notify),Hle.register(this,this._observerObject)}destroy(){var e;this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear(),Hle.unregister(this)}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let s=0;s<r.length;++s)e.push(r[s].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},BBe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=UBe}};const Hle=new FinalizationRegistry(t=>{t.destroy()});function UBe(){}let VC=!1;const ck=[];function Ibe(t,e){let r=new UB(n),i=null,s=!1;function n(){if(!r||s)return;if(VC)return void Dbe(n);const a=i;r.clear(),VC=!0,s=!0,i=$y(r,t),s=!1,VC=!1,e(i,a),Nbe()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=$y(r,t),s=!1,{remove:o}}function $be(t,e){let r=new UB(s),i=null;function s(){e(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=$y(r,t),i):null}return o(),{remove:n}}function Lbe(t){let e=new UB(i),r=!1;function i(){e&&!r&&(VC?Dbe(i):(e.clear(),VC=!0,r=!0,$y(e,t),r=!1,VC=!1,Nbe()))}function s(){e&&(e.destroy(),e=null)}return r=!0,$y(e,t),r=!1,{remove:s}}function Dbe(t){ck.includes(t)||ck.unshift(t)}function Nbe(){for(;ck.length;)ck.pop()()}var bI;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(bI||(bI={}));let $$=class{constructor(){this.uid=kh(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,s,n){return this.pool.acquire(bI.Untracked,e,r,i,s,n,tte)}static acquireTracked(e,r,i,s){return this.pool.acquire(bI.Tracked,e,r,i,null,null,s)}notify(e,r){this.type===bI.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r)}acquire(e,r,i,s,n,o,a){this.uid=kh(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=kh(),this.removed=!0}};$$.pool=new Tbe($$);const UF=new Th,my=new Set;let uk;function hk(t){my.delete(t),my.add(t),uk||(uk=EM(GBe))}function VBe(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function zBe(t){for(const e of my.values())e.target===t&&(e.removed=!0)}function GBe(){let t=10;for(;uk&&t--;){uk=null;const e=jBe(),r=UF.acquire();for(const i of e){const s=i.uid;VBe(i),s===i.uid&&i.removed&&r.push(i)}for(const i of my)i.removed&&(r.push(i),my.delete(i));for(const i of r)$$.pool.release(i);UF.release(r),UF.release(e),pW.forEach(i=>i())}}function jBe(){const t=UF.acquire();t.length=my.size;let e=0;for(const r of my)t[e]=r,++e;return my.clear(),t}const pW=new Set;function Fbe(t){return pW.add(t),{remove(){pW.delete(t)}}}function HBe(t,e,r){let i=cbe(t,e,r,(s,n,o)=>{let a,l,c=$be(()=>rL(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=$$.acquireUntracked(h,o,p,s,n),l=a.uid),hk(a))});return{remove:rte(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,hk(a)),a=null),i=c=null})}});return i}function qBe(t,e,r){const i=cbe(t,e,r,(s,n,o)=>{let a=!1;return Ibe(()=>rL(s,n),(l,c)=>{s.__accessor__.destroyed?i.remove():a||(a=!0,tte(c,l)||o.call(s,l,c,n,s),a=!1)})});return i}function WBe(t,e,r,i=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:i?qBe(t,e,r):HBe(t,e,r)}function YBe(t,e,r){let i,s,n=$be(t,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=$$.acquireTracked(o,e,a,r),s=i.uid),hk(i))});return{remove:rte(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,hk(i)),i=null),n=null})}}function QBe(t,e,r){let i=!1;return Ibe(t,(s,n)=>{i||(i=!0,r(n,s)||e(s,n),i=!1)})}function XBe(t,e,r=!1,i=eBe){return r?QBe(t,e,i):YBe(t,e,i)}function qle(t){return BF(my,e=>e.oldValue===t)}function Ml(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function f5t(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function lte(t,e,r){const i=t.get(e);if(i!==void 0)return i;const s=r();return t.set(e,s),s}const zC=we.getLogger("esri.core.accessorSupport.ensureTypes");function ZBe(t){return t==null?t:new Date(t)}function JBe(t){return t==null?t:!!t}function oL(t){return t==null?t:t.toString()}function Dp(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function cte(t){return t==null?t:Math.round(parseFloat(t))}function kbe(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function dk(t,e){return e!=null&&t&&!(e instanceof t)}function Bbe(t){return t&&"isCollection"in t}function Wle(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function KBe(t,e){if(!e||!e.constructor||!Bbe(e.constructor))return fW(t,e)?e:new t(e);const r=Wle(t.prototype.itemType),i=Wle(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(fW(t,e),e):new t(e):e}function fW(t,e){return!!kbe(e)&&(zC.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+VB(t)+"'"),!0)}function M3(t,e){return e==null?e:Bbe(t)?KBe(t,e):dk(t,e)?fW(t,e)?e:new t(e):e}function VB(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const eUe=new WeakMap;function tUe(t){switch(t){case Number:return Dp;case rn:return cte;case Boolean:return JBe;case String:return oL;case Date:return ZBe;default:return lte(eUe,t,()=>M3.bind(null,t))}}function Oo(t,e){const r=tUe(t);return arguments.length===1?r:r(e)}function L$(t,e,r){return arguments.length===1?L$.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function rUe(t,e){return arguments.length===1?L$(Oo.bind(null,t)):L$(Oo.bind(null,t),e)}function Ube(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>Ube(t,e-1,i)):t(r)}function pk(t,e,r){if(arguments.length===2)return pk.bind(null,t,e);if(!r)return r;let i=e,s=r=Ube(t,e,r);for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function iUe(t,e,r){return arguments.length===2?pk(Oo.bind(null,t),e):pk(Oo.bind(null,t),e,r)}function Vbe(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function mW(t,e){if(arguments.length===2)return mW(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(r.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!dk(a,p))?a:(h&&i.length?(n||(n=i.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),zC.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>VB(p)).join(", ")),zC.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):zC.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function k0(t,e){if(arguments.length===2)return k0(t).call(null,e);const r={},i=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=Oo(c),i.push(VB(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!dk(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=r[c];if(!h)return zC.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!dk(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!kbe(l)){const p={};for(const A in l)A!==t.key&&(p[A]=l[A]);return h(p)}return h(l)}}let rn=class{};const g5t={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function sUe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function zbe(t){switch(t.type){case"native":return Oo(t.value);case"array":return L$(zbe(t.value));case"one-of":return nUe(t);default:return null}}function nUe(t){let e=null;return(r,i)=>AW(r,t)?r:(e==null&&(e=gW(t)),zC.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function gW(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case rn:return"integer";case Date:return"date";default:return VB(t.value)}case"array":return`array of ${gW(t.value)}`;case"one-of":{const e=t.values.map(r=>gW(r));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function AW(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case rn:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!AW(r,e.value));case"one-of":return e.values.some(r=>AW(t,r))}}function d(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),s=NB(e,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in t&&we.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=i.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=ik(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const A=ik(this,h);A&&(p=p.bind(A))}return p},s.readOnly||(s.set=c?function(p){this._override(r,p)}:function(p){ok(this,l,p)})}const o=t.type,a=t.types;s.cast||(o?s.cast=oUe(o):a&&(Array.isArray(a)?s.cast=L$(k0(a[0])):s.cast=k0(a))),oBe(s,t),t.range&&(s.cast=aUe(s.cast,t.range))}}function Gbe(t,e,r){const i=NB(t,r);i.json||(i.json={});let s=i.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function oUe(t){let e=0,r=t;if(sUe(t))return zbe(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(Vbe(i))return e===0?mW(i):pk(mW(i),e);if(e===1)return rUe(i);if(e>1)return iUe(i,e);const s=t;return s.from?s.from:Oo(s)}function aUe(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function lUe(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const s=e[i];r[i].forEach(n=>{e[n]=s}),delete e[i]}}}let Pg=class yW extends wbe{constructor(e,r,i){if(super(e,r,i),!(this instanceof yW))return new yW(e,r,i)}};Pg.prototype.type="warning";function jbe(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const _W=we.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function Yle(t,e,r){var i,s;t&&(!r&&!e.read||(i=e.read)!=null&&i.reader||((s=e.read)==null?void 0:s.enabled)===!1||hUe(t)&&Jc("read.reader",bb(t),e))}function bb(t){var r,i;const e=t.ndimArray??0;if(e>1)return uUe(t);if(e===1)return Qle(t);if("type"in t&&qbe(t.type)){const s=(i=(r=t.type.prototype)==null?void 0:r.itemType)==null?void 0:i.Type,n=Qle(typeof s=="function"?{type:s}:{types:s});return(o,a,l)=>{const c=n(o,a,l);return c&&new t.type(c)}}return ute(t)}function ute(t){return"type"in t?cUe(t.type):dUe(t.types)}function cUe(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void _W.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,i),n}:t.fromJSON}function Hbe(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(s=>Hbe(t,s,r,i-1)):t(e,void 0,r)}function uUe(t){const e=ute(t),r=Hbe.bind(null,e),i=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=r(s,o,i);let a=i,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function Qle(t){const e=ute(t);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(r,void 0,s);return n!==void 0?[n]:void 0}}function qbe(t){if(!jbe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?hte(e.Type):Wbe(e.Type))}function hUe(t){return"types"in t?Wbe(t.types):hte(t.type)}function hte(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||qbe(t))}function Wbe(t){for(const e in t.typeMap)if(!hte(t.typeMap[e]))return!1;return!0}function dUe(t){let e=null;const r=t.errorContext??"type";return(i,s,n)=>{if(i==null)return i;const o=typeof i;if(o!=="object")return void _W.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=pUe(t));const a=t.key;if(typeof a!="string")return;const l=i[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const p=`Type '${l||"unknown"}' is not supported`;return n&&n.messages&&i&&n.messages.push(new Pg(`${r}:unsupported`,p,{definition:i,context:n})),void _W.error(p)}const h=new c;return h.read(i,n),h}}function pUe(t){var r,i;const e={};for(const s in t.typeMap){const n=t.typeMap[s],o=iL(n.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(r=a.json)!=null&&r.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=n);const l=(i=a.json)==null?void 0:i.write;if(!l||!l.writer){e[s]=n;continue}const c=l.target,h=typeof c=="string"?c:t.key,p={};l.writer(s,p,h),p[h]&&(e[p[h]]=n)}return e}function fUe(t){if(t.json||(t.json={}),Zle(t.json),Jle(t.json),Xle(t.json),t.json.origins)for(const e in t.json.origins)Zle(t.json.origins[e]),Jle(t.json.origins[e]),Xle(t.json.origins[e]);return!0}function Xle(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function Zle(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Jle(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Kle(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=(t==null?void 0:t.ndimArray)??0;t&&(r===1||"type"in t&&jbe(t.type))?e.write.writer=AUe:r>1?e.write.writer=yUe(r):e.types?Array.isArray(e.types)?e.write.writer=gUe(e.types[0]):e.write.writer=mUe(e.types):e.write.writer=D$}function mUe(t){return(e,r,i,s)=>e?Ybe(e,t,s)?D$(e,r,i,s):void 0:D$(e,r,i,s)}function Ybe(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r!=null&&r.messages){const i=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new ce(`${i}:unsupported`,s,{definition:t,context:r})),we.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function gUe(t){return(e,r,i,s)=>!e||!Array.isArray(e)?D$(e,r,i,s):D$(e.filter(n=>Ybe(n,t,s)),r,i,s)}function D$(t,e,r,i){Jc(r,fk(t,i),e)}function fk(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?mk(t):t}function mk(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function AUe(t,e,r,i){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>fk(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[fk(t,i)],Jc(r,s,e)}function Qbe(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>Qbe(i,e,r-1)):fk(t,e)}function yUe(t){return(e,r,i,s)=>{let n;if(e===null)n=null;else{n=Qbe(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Jc(i,n,r)}}function vW(t,e){return dte(t,"read",e)}function Xbe(t,e){return dte(t,"write",e)}function dte(t,e,r){let i=t&&t.json;if(t&&t.json&&t.json.origins&&r){const s=r.origin&&t.json.origins[r.origin];s&&(e==="any"||e in s)&&(i=s)}return i}function _Ue(t){const e=vUe(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],s=i.types?bUe(i):e;Yle(s,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),Kle(s,i)}Yle(e,t.json,!0),Kle(e,t.json)}function vUe(t){return t.json.types?bW(t.json):t.type?Zbe(t):bW(t)}function bUe(t){return t.type?Zbe(t):bW(t)}function Zbe(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!Vbe(r);)r=r[0],e++;return{type:r,ndimArray:e}}function bW(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function wUe(t){fUe(t)&&(lUe(t),_Ue(t))}const WV=new Set,YV=new Set;function j(t){return e=>{e.prototype.declaredClass=t,TUe(e);const r=[],i=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!WV.has(s.initialize)&&(WV.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!YV.has(s.destroy)&&(YV.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);WV.clear(),YV.clear();class n extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[ebe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<i.length;h++)i[h].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=iL(e.prototype),n.prototype.declaredClass=t,n}}function xUe(t,e){return e.get==null?function(){const r=this.__accessor__.properties.get(t);if(r===void 0)return;mi(r.observerObject);const i=this.__accessor__.store;return i.has(t)?i.get(t):r.metadata.value}:function(){const r=this.__accessor__.properties.get(t);if(r!==void 0)return r.getComputed()}}function TUe(t){const e=t.prototype,r=iL(e),i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];wUe(n),i[s]={enumerable:!0,configurable:!0,get:xUe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===iy.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var Jbe,Kbe;function SUe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const Rw=Symbol("Accessor-Handles"),wW=Symbol("Accessor-Initialized");let Ke=class ewe{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}iL(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...A){if(n.prototype[a])return n.prototype[a].apply(this,A)};try{p=l.apply(this,c)}catch(A){throw this.inherited=h,A}return this.inherited=h,p}:e[a]}for(const a in r){const l=SUe(r[a]);d(l)(o.prototype,a)}return j(i)(o)}constructor(...e){if(this[Jbe]=null,this[Kbe]=!1,this.constructor===ewe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new yBe(this)}),e.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[wW]=!0}initialize(){}[ebe](){this[Rw]=gt(this[Rw])}destroy(){this.destroyed||(zBe(this),this.__accessor__.destroy())}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[wW]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return ik(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return ok(this,e,r),this}watch(e,r,i){return WBe(this,e,r,i)}own(e){this.addHandles(e)}addHandles(e,r){let i=this[Rw];N(i)&&(i=this[Rw]=new ts),i.add(e,r)}removeHandles(e){const r=this[Rw];N(r)||r.remove(e)}hasHandles(e){const r=this[Rw];return!!E(r)&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};Jbe=Rw,Kbe=wW;let VF=class twe{constructor(){this._emitter=new twe.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return S3(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([j("esri.core.Evented")],s),s};let r=class extends Ke{constructor(){super(...arguments),this._emitter=new VF.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=u([j("esri.core.Evented")],r),t.EventedAccessor=r})(VF||(VF={}));const Nn=VF;var xs;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(xs||(xs={}));function pte(t){return(e,r)=>{e[r]=t}}let fte=class extends gbe{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var ey;let EUe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const ep=new al(EUe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),CUe=()=>{};function QV(t){return t?t instanceof O2?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function XV(t){if(t&&t.length)return t[0]}function MUe(t,e,r,i){const s=Math.min(t.length-r,e.length-i);let n=0;for(;n<s&&t[r+n]===e[i+n];)n++;return n}function rwe(t,e,r,i){e&&e.forEach((s,n,o)=>{t.push(s),rwe(t,r.call(i,s,n,o),r,i)})}const y_=new Set,__=new Set,v_=new Set,ZV=new Map;let RUe=0,O2=ey=class extends Nn.EventedAccessor{static isCollection(t){return t!=null&&t instanceof ey}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new fte,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:RUe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof ey?{items:t}:t:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return mi(this._observable),this._items}set items(t){this._emitBeforeChanges(xs.ADD)||(this._splice(0,this.length,QV(t)),this._emitAfterChanges(xs.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=CUe,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const r=this.on(t,e);return{remove(){r.remove()}}}add(t,e){if(mi(this._observable),this._emitBeforeChanges(xs.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(xs.ADD),this}addMany(t,e=this._items.length){if(mi(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(xs.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,QV(t)),this._emitAfterChanges(xs.ADD),this}at(t){if(mi(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(mi(this._observable),!this.length||this._emitBeforeChanges(xs.REMOVE))return[];const t=this._splice(0,this.length)||[];return this._emitAfterChanges(xs.REMOVE),t}clone(){return mi(this._observable),this._createNewInstance({items:this._items.map(Te)})}concat(...t){mi(this._observable);const e=t.map(QV);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(mi(this._observable),!this.length||this._emitBeforeChanges(xs.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)t.call(e,r[s],s,r);this._emitAfterChanges(xs.REMOVE)}every(t,e){return mi(this._observable),this._items.every(t,e)}filter(t,e){let r;return mi(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return mi(this._observable),this._items.find(t,e)}findIndex(t,e){return mi(this._observable),this._items.findIndex(t,e)}flatten(t,e){mi(this._observable);const r=[];return rwe(r,this,t,e),new ey(r)}forEach(t,e){return mi(this._observable),this._items.forEach(t,e)}getItemAt(t){return mi(this._observable),this._items[t]}getNextIndex(t){mi(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return mi(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return mi(this._observable),this._items.indexOf(t,e)}join(t=","){return mi(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return mi(this._observable),this._items.lastIndexOf(t,e)}map(t,e){mi(this._observable);const r=this._items.map(t,e);return new ey({items:r})}reorder(t,e=this.length-1){mi(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(xs.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(xs.MOVE)}return t}}pop(){if(mi(this._observable),!this.length||this._emitBeforeChanges(xs.REMOVE))return;const t=XV(this._splice(this.length-1,1));return this._emitAfterChanges(xs.REMOVE),t}push(...t){return mi(this._observable),this._emitBeforeChanges(xs.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(xs.ADD)),this.length}reduce(t,e){mi(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){mi(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return mi(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(mi(this._observable),t<0||t>=this.length||this._emitBeforeChanges(xs.REMOVE))return;const e=XV(this._splice(t,1));return this._emitAfterChanges(xs.REMOVE),e}removeMany(t){if(mi(this._observable),!t||!t.length||this._emitBeforeChanges(xs.REMOVE))return[];const e=t instanceof ey?t.toArray():t,r=this._items,i=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=r.indexOf(o);if(a>-1){const l=1+MUe(e,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(xs.REMOVE),i}reverse(){if(mi(this._observable),this._emitBeforeChanges(xs.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(xs.MOVE),this}shift(){if(mi(this._observable),!this.length||this._emitBeforeChanges(xs.REMOVE))return;const t=XV(this._splice(0,1));return this._emitAfterChanges(xs.REMOVE),t}slice(t=0,e=this.length){return mi(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return mi(this._observable),this._items.some(t,e)}sort(t){if(mi(this._observable),!this.length||this._emitBeforeChanges(xs.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(xs.MOVE),this}splice(t,e,...r){mi(this._observable);const i=(e?xs.REMOVE:0)|(r.length?xs.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(t,e,r)||[];return this._emitAfterChanges(i),s}toArray(){return mi(this._observable),this._items.slice()}toJSON(){return mi(this._observable),this.toArray()}toLocaleString(){return mi(this._observable),this._items.toLocaleString()}toString(){return mi(this._observable),this._items.toString()}unshift(...t){return mi(this._observable),!t.length||this._emitBeforeChanges(xs.ADD)||(this._splice(0,0,t),this._emitAfterChanges(xs.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=EM(()=>this._dispatchChange())),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=ep.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,n),t+=1,l-=1,c-=1);ep.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=ep.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);ep.release(a)}}if(r&&r.length){if(s){const h=[];for(const p of r){const A=s.ensureType(p);A==null&&p!=null||h.push(A)}r=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=ep.acquire();h.target=this,h.cancellable=!0;const p=ep.acquire();p.target=this,p.cancellable=!1;for(const A of r)a?(h.reset(A),this.emit("before-add",h),h.defaultPrevented||(c?i.push(A):i.splice(t++,0,A),this._set("length",i.length),l&&(p.reset(A),this.emit("after-add",p)))):(c?i.push(A):i.splice(t++,0,A),this._set("length",i.length),p.reset(A),this.emit("after-add",p));ep.release(p),ep.release(h)}else{if(c)for(const h of r)i.push(h);else i.splice(t,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=ep.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,ep.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=ep.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),ep.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;y_.clear(),__.clear(),v_.clear();for(const{added:l,removed:c}of r){if(l)if(v_.size===0&&__.size===0)for(const h of l)y_.add(h);else for(const h of l)__.has(h)?(v_.add(h),__.delete(h)):v_.has(h)||y_.add(h);if(c)if(v_.size===0&&y_.size===0)for(const h of c)__.add(h);else for(const h of c)y_.has(h)?y_.delete(h):(v_.delete(h),__.add(h))}const i=Th.acquire();y_.forEach(l=>{i.push(l)});const s=Th.acquire();__.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=Th.acquire();if(v_.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const p=e.listeners[h];p.removed||p.callback.call(this,l)}}Th.release(i),Th.release(s),Th.release(a)}y_.clear(),__.clear(),v_.clear()}};O2.ofType=t=>{if(!t)return ey;if(ZV.has(t))return ZV.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const s=t.typeMap[i].prototype.declaredClass;e?e+=` | ${s}`:e=s}let r=class extends ey{};return u([pte({Type:t,ensureType:typeof t=="function"?Oo(t):k0(t)})],r.prototype,"itemType",void 0),r=u([j(`esri.core.Collection<${e}>`)],r),ZV.set(t,r),r},u([d()],O2.prototype,"length",void 0),u([d()],O2.prototype,"items",null),O2=ey=u([j("esri.core.Collection")],O2);const or=O2;function Lx(t,e,r=or){return e||(e=new r),e===t||(e.removeAll(),OUe(t)?e.addMany(t):t&&e.add(t)),e}function iwe(t){return t}function OUe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}let PUe=class swe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new swe;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,Te(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(e){var r;return((r=this._values.get(e))==null?void 0:r.origin)??qi.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>{var s;return((s=this._values.get(i))==null?void 0:s.origin)===e})}set(e,r,i){if((i=this._normalizeOrigin(i))===qi.DEFAULTS){const s=this._values.get(e);if(s&&s.origin!=null&&s.origin>i)return}this._values.set(e,new IUe(r,i))}delete(e,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(e))==null?void 0:i.origin)!==r||this._values.delete(e)}has(e,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(e))==null?void 0:i.origin)===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===qi.DEFAULTS?e:qi.USER}},IUe=class{constructor(e,r){this.value=e,this.origin=r}};function nwe(t,e,r){e.keys().forEach(s=>{r.set(s,e.get(s),qi.DEFAULTS)});const i=t.metadatas;Object.keys(i).forEach(s=>{t.internalGet(s)&&r.set(s,t.internalGet(s),qi.DEFAULTS)})}function $Ue(t,e,r){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&Lle(i,r))return!0}else for(const s of i)if(s===e||s.includes(".")&&s.indexOf(e)===0&&Lle(s,r))return!0;return!1}function LUe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function DUe(t,e,r,i,s){let n=vW(e[r],s);LUe(n)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))n=vW(e[o],s),$Ue(n,r,i)&&(t[o]=!0)}function NUe(t,e,r,i){const s=r.metadatas,n=dte(s[e],"any",i),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const owe={origin:"service"};function awe(t,e,r=owe){if(!e||typeof e!="object")return;const i=Zc(t),s=i.metadatas,n={};for(const o of Object.getOwnPropertyNames(e))DUe(n,s,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=vW(s[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?rL(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||NUe(t,o,i,r)}i.setDefaultOrigin("user")}function FUe(t,e,r,i=owe){var n;const s={...i,messages:[]};r(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||t.loaded?i&&i.messages&&i.messages.push(o):t.loadWarnings.push(o)})}function kUe(t,e,r,i,s){var o,a;const n={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,i,n,r,s),n}function lwe(t,e,r,i,s,n){if(!i||!i.write)return!1;const o=t.get(r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,n);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new ce("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&n&&n.messages?n.messages.push(a):a&&!n&&we.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!e.store.multipleOriginsSupported||e.store.originOf(r)===qi.DEFAULTS)&&BUe(t,r,n,i,o)||!s.ignoreOrigin&&n&&n.origin&&e.store.multipleOriginsSupported&&e.store.originOf(r)<uv(n.origin))}function BUe(t,e,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,r);return Iy(o,s)}return!1}return n===s}function UUe(t,e,r,i){const s=Zc(t),n=s.metadatas,o=Xbe(n[e],i);return!!o&&lwe(t,s,e,o,r,i)}function cwe(t,e,r){var n,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return DF(e,t.toJSON(r));const i=Zc(t),s=i.metadatas;for(const a in s){const l=Xbe(s[a],r);if(!lwe(t,i,a,l,void 0,r))continue;const c=t.get(a),h=kUe(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(h).length>0&&(e=DF(e,h),(o=(n=r==null?void 0:r.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>DF(e,h,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:a,oldOrigin:dBe(i.store.originOf(a)),newOrigin:r.origin}))}return e}const aL=t=>{let e=class extends t{constructor(...r){super(...r);const i=Zc(this),s=i.store,n=new PUe;i.store=n,nwe(i,s,n)}read(r,i){awe(this,r,i)}write(r={},i){return cwe(this,r,i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return VUe.call(this,r,i)}};return e=u([j("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function VUe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}let Qe=class extends aL(Ke){};Qe=u([j("esri.core.JSONSupport")],Qe);var B1;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(B1||(B1={}));let zUe=class{constructor(e){this.instance=e,this._resolver=Qv(),this._status=B1.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=B1.RESOLVED,this._cleanUp()},()=>{this._status=B1.REJECTED,this._cleanUp()})}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===B1.RESOLVED}isRejected(){return this._status===B1.REJECTED}isFulfilled(){return this._status!==B1.PENDING}abort(){this._resolver.reject(Yi())}when(e,r){return this._resolver.promise.then(e,r)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const e=Qv(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==i||vo(s)||this._resolver.reject(s)}),e.resolve()}};const zB=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new zUe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=u([j("esri.core.Promise")],e),e};let gk=class extends zB(Ke){};gk=u([j("esri.core.Promise")],gk);const GUe="not-loaded",jUe="loading",HUe="failed",ece="loaded",uwe=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=nte(n,l);this.destroyed&&l(new ce("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===GUe){this._set("loadStatus",jUe);const a=this._loadController=new AbortController;s({signal:a.signal}),ic(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",ece),this._loadController=null},i=>{this._set("loadStatus",HUe),this._set("loadError",i),this._loadController=null})}get loaded(){return this.loadStatus===ece}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new ce("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort()),this}};return u([d({readOnly:!0})],e.prototype,"loaded",null),u([d({readOnly:!0})],e.prototype,"loadError",void 0),u([d({clonable:!1})],e.prototype,"loadStatus",void 0),u([d({type:[Pg],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([j("esri.core.Loadable")],e),e};let UO=class extends uwe(gk){};UO=u([j("esri.core.Loadable")],UO),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=uwe,t.isLoadable=e}(UO||(UO={}));const Ly=UO;function GB(t,e,r){return Vu(t.map((i,s)=>e.apply(r,[i,s])))}async function qUe(t,e,r){return(await Vu(t.map((i,s)=>e.apply(r,[i,s])))).map(i=>i.value)}function mte(t){return{ok:!0,value:t}}function gte(t){return{ok:!1,error:t}}function WUe(t){return E(t)&&t.ok===!0?t.value:null}function YUe(t){return E(t)&&t.ok===!1?t.error:null}async function B0(t){if(N(t))return{ok:!1,error:new Error("no promise provided")};try{return mte(await t)}catch(e){return gte(e)}}async function T5t(t){try{return mte(await t)}catch(e){return Sh(e),gte(e)}}function S5t(t){if(t.ok===!0)return t.value;throw t.error}function lL(t,e){return new n1(t,e)}let n1=class extends Ke{get value(){return WUe(this._result)}get error(){return YUe(this._result)}get finished(){return E(this._result)}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=tf(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(s=>{this._result=mte(s),this._cleanup()},s=>{this._result=gte(s),this._cleanup()}),this._abortHandle=ic(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=sn(this._abortHandle),this._abortController=null}};u([d()],n1.prototype,"value",null),u([d()],n1.prototype,"error",null),u([d()],n1.prototype,"finished",null),u([d()],n1.prototype,"promise",void 0),u([d()],n1.prototype,"_result",void 0),n1=u([j("esri.core.asyncUtils.ReactiveTask")],n1);async function hwe(t,e){return await t.load(),QUe(t,e)}async function QUe(t,e){const r=[],i=(...n)=>{for(const o of n)N(o)||(Array.isArray(o)?i(...o):or.isCollection(o)?o.forEach(a=>i(a)):Ly.isLoadable(o)&&r.push(o))};e(i);let s=null;if(await qUe(r,async n=>{const o=await B0(XUe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function XUe(t){return"loadAll"in t&&typeof t.loadAll=="function"}const ZUe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,JUe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function tce(t){const e=t==null?void 0:t.match(ZUe);if(!e)return null;const[,r,i,s]=e;if(!r)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:h}=JUe;if(i)if(n=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function KUe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}const e7e=we.getLogger("esri.core.urlUtils"),CM=ls.request,rce="esri/config: esriConfig.request.proxyUrl is not set.",dwe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,pwe=/^\s*http:/i,t7e=/^\s*https:/i,r7e=/^\s*file:/i,i7e=/:\d+$/,s7e=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,n7e=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),o7e=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let GC=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(n7e);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(o7e),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const ID={},a7e=new GC(ls.applicationUrl);let zc=a7e;const l7e=c7e();let Ate=l7e;const yte=()=>zc,M5t=()=>Ate;function c7e(){const t=zc.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${zc.scheme}://${zc.host}${zc.port!=null?`:${zc.port}`:""}`}${e}`}function eu(t){if(!t)return null;const e={path:null,query:null},r=new GC(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=fwe(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function fwe(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function ice(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function N$(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=e&&e[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>ice(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):ice(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function u7e(t=!1){let e,r=CM.proxyUrl;if(typeof t=="string"){e=A7e(t);const i=jB(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw e7e.warn(rce),new ce("urlutils:proxy-not-set",rce);return e&&xW()&&(r=Tte(r)),eu(r)}function R5t(t){const e=jB(t);let r,i;if(e){const s=_te(e.proxyUrl);r=s.path,i=s.query?fwe(s.query):null}if(r){const s=eu(t);t=r+"?"+s.path;const n=N$({...i,...s.query});n&&(t=`${t}?${n}`)}return t}const TR={path:"",query:""};function _te(t){const e=t.indexOf("?");return e!==-1?(TR.path=t.slice(0,e),TR.query=t.slice(e+1)):(TR.path=t,TR.query=null),TR}function mwe(t){return t=(t=yk(t=x7e(t=_te(t).path),!0)).toLowerCase()}function h7e(t){const e={proxyUrl:t.proxyUrl,urlPrefix:mwe(t.urlPrefix)},r=CM.proxyRules,i=e.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,e),s}function jB(t){const e=CM.proxyRules,r=mwe(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function d7e(t,e){if(!t||!e)return!1;t=Ak(t),e=Ak(e);const r=tce(t),i=tce(e);return E(r)&&E(i)?r.portalHostname===i.portalHostname:!E(r)&&!E(i)&&R3(t,e,!0)}function gwe(t,e){return t=Ak(t),e=Ak(e),yk(t)===yk(e)}function Ak(t){const e=(t=O0(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function Awe(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=CM.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function R3(t,e,r=!1){if(!t||!e)return!1;const i=SW(t),s=SW(e);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function vte(t){if(typeof t=="string"){if(!Fd(t))return!0;t=SW(t)}if(R3(t,zc))return!0;const e=CM.trustedServers||[];for(let r=0;r<e.length;r++){const i=p7e(e[r]);for(let s=0;s<i.length;s++)if(R3(t,i[s]))return!0}return!1}function p7e(t){return ID[t]||(xte(t)||Ig(t)?ID[t]=[new GC(Od(t))]:ID[t]=[new GC(`http://${t}`),new GC(`https://${t}`)]),ID[t]}function Od(t,e=Ate,r){return Ig(t)?r&&r.preserveProtocolRelative?t:zc.scheme==="http"&&zc.authority===P0(t).slice(2)?`http:${t}`:`https:${t}`:xte(t)?t:Dx(t[0]==="/"?b7e(e):e,t)}function bte(t,e=Ate,r){if(t==null||!Fd(t))return t;const i=O0(t),s=i.toLowerCase(),n=O0(e).toLowerCase().replace(/\/+$/,""),o=r?O0(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(p,A,_)=>(_=p.indexOf(A,_))===-1?p.length:_;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)t=`../${t}`;else t=`./${t}`;return t}function O0(t){return t=E7e(t=S7e(t=T7e(t=Od(t=t.trim()))))}function Dx(...t){const e=t.filter(E);if(!e||!e.length)return;const r=[];if(Fd(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),_7e(e[0])&&(r[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function P0(t,e=!1){if(t==null||O3(t)||zg(t))return null;let r=t.indexOf("://");if(r===-1&&Ig(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=yk(t,!0)),t}function Fd(t){return Ig(t)||xte(t)}function O3(t){return t!=null&&t.slice(0,5)==="blob:"}function zg(t){return t!=null&&t.slice(0,5)==="data:"}function wte(t){const e=cL(t);if(!e||!e.isBase64)return null;const r=atob(e.data),i=new Uint8Array(r.length);for(let s=0;s<r.length;s++)i[s]=r.charCodeAt(s);return i.buffer}function O5t(t){return btoa(String.fromCharCode.apply(null,t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const f7e=/^data:(.*?)(;base64)?,(.*)$/;function cL(t){const e=t.match(f7e);if(!e)return null;const[,r,i,s]=e;return{mediaType:r,isBase64:!!i,data:s}}function ywe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function P5t(t){const e=wte(t);if(!e)return null;const r=cL(t);return new Blob([e],{type:r.mediaType})}function I5t(t,e){m7e(t,e)||g7e(t,e)}function m7e(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function g7e(t,e){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(t,e)}function Ig(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function xte(t){return t!=null&&dwe.test(t)}function A7e(t){return t!=null&&t7e.test(t)||zc.scheme==="https"&&Ig(t)}function y7e(t){return t!=null&&pwe.test(t)||zc.scheme==="http"&&Ig(t)}function _7e(t){return t!=null&&r7e.test(t)}function Tte(t){return Ig(t)?`https:${t}`:t.replace(pwe,"https:")}function v7e(){return zc.scheme==="http"}function xW(){return zc.scheme==="https"}function yk(t,e=!1){return Ig(t)?t.slice(2):(t=t.replace(dwe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function b7e(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function w7e(t){let e=0;if(Fd(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function $5t(t,e){if(!t)return"";const r=eu(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(e!=null&&e.length))return i;const s=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(s,"")}function x7e(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function _we(t){return t.replace(/\/+$/,"")}function T7e(t){if(/^https?:\/\//i.test(t)){const e=_te(t);t=(t=e.path.replace(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function S7e(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function E7e(t){const e=CM.httpsDomains;if(!y7e(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),i7e.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return v7e()&&i===zc.authority&&!s7e.test(t)||(xW()&&i===zc.authority||e&&e.some(s=>i===s||i.endsWith(`.${s}`))||xW()&&!jB(t))&&(t=Tte(t)),t}function TW(t,e,r){if(!(e&&r&&t&&Fd(t)))return t;const i=t.indexOf("//"),s=t.indexOf("/",i+2),n=t.indexOf(":",i+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function SW(t){return typeof t=="string"?new GC(Od(t)):(t.scheme||(t.scheme=zc.scheme),t)}function vwe(t){return C7e.test(t)}function bwe(t,e){const r=eu(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function wwe(t,e,r){const i=eu(t),s=i.query||{};return s[e]=String(r),`${i.path}?${N$(s)}`}function JV(t,e){const r=eu(t),i=r.query||{};for(const n in e)i[n]=e[n];const s=N$(i);return s?`${r.path}?${s}`:r.path}function L5t(t){if(N(t))return null;const e=t.match(xwe);return e?e[2]:null}function sce(t){if(N(t))return null;const e=t.match(xwe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}const xwe=/([^.]*)\.([^\/]*)$/,C7e=/(^data:image\/svg|\.svg$)/i;function St(t,e,r){let i,s;return e===void 0?(s=t,i=[void 0]):typeof e!="string"?(s=t,i=[void 0],r=e):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=Gbe(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let Ui=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&Jc(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function hc(){return function(t,e){return new Ui(t,{ignoreUnknown:!0,...e})}}let Ste=class{constructor(e,r,i,s){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const gi=new Ste(6378137,1/298.257223563,3e5,.006694379990137799),_g=new Ste(3396190,1/169.8944472236118,23e4),Dy=new Ste(1737400,0,0);var zp;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(zp||(zp={}));let b;const Q={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(b=2e3;b<=2045;b++)Q[b]=0;for(b=2056;b<=2065;b++)Q[b]=0;for(b=2067;b<=2135;b++)Q[b]=0;for(b=2137;b<=2154;b++)Q[b]=0;for(b=2161;b<=2170;b++)Q[b]=0;for(b=2172;b<=2193;b++)Q[b]=0;for(b=2195;b<=2198;b++)Q[b]=0;for(b=2200;b<=2203;b++)Q[b]=0;for(b=2205;b<=2217;b++)Q[b]=0;for(b=2222;b<=2224;b++)Q[b]=1;for(b=2225;b<=2250;b++)Q[b]=2;for(b=2251;b<=2253;b++)Q[b]=1;for(b=2257;b<=2264;b++)Q[b]=2;for(b=2274;b<=2279;b++)Q[b]=2;for(b=2280;b<=2282;b++)Q[b]=1;for(b=2283;b<=2289;b++)Q[b]=2;for(b=2290;b<=2292;b++)Q[b]=0;for(b=2308;b<=2313;b++)Q[b]=0;for(b=2315;b<=2491;b++)Q[b]=0;for(b=2494;b<=2866;b++)Q[b]=0;for(b=2867;b<=2869;b++)Q[b]=1;for(b=2870;b<=2888;b++)Q[b]=2;for(b=2891;b<=2895;b++)Q[b]=2;for(b=2896;b<=2898;b++)Q[b]=1;for(b=2902;b<=2908;b++)Q[b]=2;for(b=2915;b<=2920;b++)Q[b]=2;for(b=2921;b<=2923;b++)Q[b]=1;for(b=2924;b<=2930;b++)Q[b]=2;for(b=2931;b<=2962;b++)Q[b]=0;for(b=2964;b<=2968;b++)Q[b]=2;for(b=2969;b<=2973;b++)Q[b]=0;for(b=2975;b<=2991;b++)Q[b]=0;for(b=2995;b<=3051;b++)Q[b]=0;for(b=3054;b<=3079;b++)Q[b]=0;for(b=3081;b<=3088;b++)Q[b]=0;for(b=3092;b<=3101;b++)Q[b]=0;for(b=3106;b<=3138;b++)Q[b]=0;for(b=3146;b<=3151;b++)Q[b]=0;for(b=3153;b<=3166;b++)Q[b]=0;for(b=3168;b<=3172;b++)Q[b]=0;for(b=3174;b<=3203;b++)Q[b]=0;for(b=3294;b<=3358;b++)Q[b]=0;for(b=3367;b<=3403;b++)Q[b]=0;for(b=3408;b<=3416;b++)Q[b]=0;for(b=3417;b<=3438;b++)Q[b]=2;for(b=3441;b<=3446;b++)Q[b]=2;for(b=3447;b<=3450;b++)Q[b]=0;for(b=3451;b<=3459;b++)Q[b]=2;for(b=3460;b<=3478;b++)Q[b]=0;for(b=3554;b<=3559;b++)Q[b]=0;for(b=3560;b<=3570;b++)Q[b]=2;for(b=3571;b<=3581;b++)Q[b]=0;for(b=3594;b<=3597;b++)Q[b]=0;for(b=3601;b<=3604;b++)Q[b]=0;for(b=3637;b<=3639;b++)Q[b]=0;for(b=3665;b<=3667;b++)Q[b]=0;for(b=3693;b<=3695;b++)Q[b]=0;for(b=3701;b<=3727;b++)Q[b]=0;for(b=3728;b<=3739;b++)Q[b]=2;for(b=3740;b<=3751;b++)Q[b]=0;for(b=3753;b<=3760;b++)Q[b]=2;for(b=3761;b<=3773;b++)Q[b]=0;for(b=3775;b<=3777;b++)Q[b]=0;for(b=3779;b<=3781;b++)Q[b]=0;for(b=3783;b<=3785;b++)Q[b]=0;for(b=3788;b<=3791;b++)Q[b]=0;for(b=3797;b<=3802;b++)Q[b]=0;for(b=3814;b<=3816;b++)Q[b]=0;for(b=3825;b<=3829;b++)Q[b]=0;for(b=3832;b<=3841;b++)Q[b]=0;for(b=3844;b<=3852;b++)Q[b]=0;for(b=3873;b<=3885;b++)Q[b]=0;for(b=3890;b<=3893;b++)Q[b]=0;for(b=3907;b<=3912;b++)Q[b]=0;for(b=3942;b<=3950;b++)Q[b]=0;for(b=3968;b<=3970;b++)Q[b]=0;for(b=3973;b<=3976;b++)Q[b]=0;for(b=3986;b<=3989;b++)Q[b]=0;for(b=3994;b<=3997;b++)Q[b]=0;for(b=4048;b<=4051;b++)Q[b]=0;for(b=4056;b<=4063;b++)Q[b]=0;for(b=4093;b<=4096;b++)Q[b]=0;for(b=4390;b<=4398;b++)Q[b]=0;for(b=4399;b<=4413;b++)Q[b]=2;for(b=4418;b<=4433;b++)Q[b]=2;for(b=4455;b<=4457;b++)Q[b]=2;for(b=4484;b<=4489;b++)Q[b]=0;for(b=4491;b<=4554;b++)Q[b]=0;for(b=4568;b<=4589;b++)Q[b]=0;for(b=4652;b<=4656;b++)Q[b]=0;for(b=4766;b<=4800;b++)Q[b]=0;for(b=5014;b<=5016;b++)Q[b]=0;for(b=5069;b<=5072;b++)Q[b]=0;for(b=5105;b<=5130;b++)Q[b]=0;for(b=5173;b<=5188;b++)Q[b]=0;for(b=5253;b<=5259;b++)Q[b]=0;for(b=5269;b<=5275;b++)Q[b]=0;for(b=5292;b<=5311;b++)Q[b]=0;for(b=5329;b<=5331;b++)Q[b]=0;for(b=5343;b<=5349;b++)Q[b]=0;for(b=5355;b<=5357;b++)Q[b]=0;for(b=5387;b<=5389;b++)Q[b]=0;for(b=5459;b<=5463;b++)Q[b]=0;for(b=5479;b<=5482;b++)Q[b]=0;for(b=5518;b<=5520;b++)Q[b]=0;for(b=5530;b<=5539;b++)Q[b]=0;for(b=5550;b<=5552;b++)Q[b]=0;for(b=5562;b<=5583;b++)Q[b]=0;for(b=5623;b<=5625;b++)Q[b]=2;for(b=5631;b<=5639;b++)Q[b]=0;for(b=5649;b<=5653;b++)Q[b]=0;for(b=5663;b<=5680;b++)Q[b]=0;for(b=5682;b<=5685;b++)Q[b]=0;for(b=5875;b<=5877;b++)Q[b]=0;for(b=5896;b<=5899;b++)Q[b]=0;for(b=5921;b<=5940;b++)Q[b]=0;for(b=6050;b<=6125;b++)Q[b]=0;for(b=6244;b<=6275;b++)Q[b]=0;for(b=6328;b<=6348;b++)Q[b]=0;for(b=6350;b<=6356;b++)Q[b]=0;for(b=6366;b<=6372;b++)Q[b]=0;for(b=6381;b<=6387;b++)Q[b]=0;for(b=6393;b<=6404;b++)Q[b]=0;for(b=6480;b<=6483;b++)Q[b]=0;for(b=6511;b<=6514;b++)Q[b]=0;for(b=6579;b<=6581;b++)Q[b]=0;for(b=6619;b<=6624;b++)Q[b]=0;for(b=6625;b<=6627;b++)Q[b]=2;for(b=6628;b<=6632;b++)Q[b]=0;for(b=6634;b<=6637;b++)Q[b]=0;for(b=6669;b<=6692;b++)Q[b]=0;for(b=6707;b<=6709;b++)Q[b]=0;for(b=6720;b<=6723;b++)Q[b]=0;for(b=6732;b<=6738;b++)Q[b]=0;for(b=6931;b<=6933;b++)Q[b]=0;for(b=6956;b<=6959;b++)Q[b]=0;for(b=7005;b<=7007;b++)Q[b]=0;for(b=7057;b<=7070;b++)Q[b]=2;for(b=7074;b<=7082;b++)Q[b]=0;for(b=7109;b<=7118;b++)Q[b]=0;for(b=7119;b<=7127;b++)Q[b]=1;for(b=7374;b<=7376;b++)Q[b]=0;for(b=7528;b<=7586;b++)Q[b]=0;for(b=7587;b<=7645;b++)Q[b]=2;for(b=7692;b<=7696;b++)Q[b]=0;for(b=7755;b<=7787;b++)Q[b]=0;for(b=7791;b<=7795;b++)Q[b]=0;for(b=7799;b<=7801;b++)Q[b]=0;for(b=7803;b<=7805;b++)Q[b]=0;for(b=7825;b<=7831;b++)Q[b]=0;for(b=7845;b<=7859;b++)Q[b]=0;for(b=8013;b<=8032;b++)Q[b]=0;for(b=8065;b<=8068;b++)Q[b]=1;for(b=8518;b<=8529;b++)Q[b]=2;for(b=8533;b<=8536;b++)Q[b]=2;for(b=8538;b<=8540;b++)Q[b]=2;for(b=8677;b<=8679;b++)Q[b]=0;for(b=8836;b<=8840;b++)Q[b]=0;for(b=8857;b<=8859;b++)Q[b]=0;for(b=8908;b<=8910;b++)Q[b]=0;for(b=9154;b<=9159;b++)Q[b]=0;for(b=9205;b<=9218;b++)Q[b]=0;for(b=9271;b<=9273;b++)Q[b]=0;for(b=9295;b<=9297;b++)Q[b]=0;for(b=9356;b<=9360;b++)Q[b]=0;for(b=9404;b<=9407;b++)Q[b]=0;for(b=9476;b<=9482;b++)Q[b]=0;for(b=9487;b<=9494;b++)Q[b]=0;for(b=9697;b<=9699;b++)Q[b]=0;for(b=9821;b<=9865;b++)Q[b]=0;for(b=20002;b<=20032;b++)Q[b]=0;for(b=20047;b<=20049;b++)Q[b]=0;for(b=20062;b<=20092;b++)Q[b]=0;for(b=20135;b<=20138;b++)Q[b]=0;for(b=20248;b<=20258;b++)Q[b]=0;for(b=20348;b<=20358;b++)Q[b]=0;for(b=20436;b<=20440;b++)Q[b]=0;for(b=20822;b<=20824;b++)Q[b]=0;for(b=20904;b<=20932;b++)Q[b]=0;for(b=20934;b<=20936;b++)Q[b]=0;for(b=21004;b<=21032;b++)Q[b]=0;for(b=21035;b<=21037;b++)Q[b]=0;for(b=21095;b<=21097;b++)Q[b]=0;for(b=21148;b<=21150;b++)Q[b]=0;for(b=21207;b<=21264;b++)Q[b]=0;for(b=21307;b<=21364;b++)Q[b]=0;for(b=21413;b<=21423;b++)Q[b]=0;for(b=21453;b<=21463;b++)Q[b]=0;for(b=21473;b<=21483;b++)Q[b]=0;for(b=21780;b<=21782;b++)Q[b]=0;for(b=21891;b<=21894;b++)Q[b]=0;for(b=21896;b<=21899;b++)Q[b]=0;for(b=22171;b<=22177;b++)Q[b]=0;for(b=22181;b<=22187;b++)Q[b]=0;for(b=22191;b<=22197;b++)Q[b]=0;for(b=22207;b<=22222;b++)Q[b]=0;for(b=22234;b<=22236;b++)Q[b]=0;for(b=22243;b<=22250;b++)Q[b]=0;for(b=22262;b<=22265;b++)Q[b]=0;for(b=22307;b<=22322;b++)Q[b]=0;for(b=22348;b<=22357;b++)Q[b]=0;for(b=22407;b<=22422;b++)Q[b]=0;for(b=22462;b<=22465;b++)Q[b]=0;for(b=22521;b<=22525;b++)Q[b]=0;for(b=22607;b<=22622;b++)Q[b]=0;for(b=22641;b<=22646;b++)Q[b]=0;for(b=22648;b<=22657;b++)Q[b]=0;for(b=22707;b<=22722;b++)Q[b]=0;for(b=22762;b<=22765;b++)Q[b]=0;for(b=22991;b<=22994;b++)Q[b]=0;for(b=23028;b<=23038;b++)Q[b]=0;for(b=23830;b<=23853;b++)Q[b]=0;for(b=23866;b<=23872;b++)Q[b]=0;for(b=23877;b<=23884;b++)Q[b]=0;for(b=23886;b<=23894;b++)Q[b]=0;for(b=23946;b<=23948;b++)Q[b]=0;for(b=24311;b<=24313;b++)Q[b]=0;for(b=24342;b<=24347;b++)Q[b]=0;for(b=24370;b<=24374;b++)Q[b]=10;for(b=24375;b<=24381;b++)Q[b]=0;for(b=24718;b<=24721;b++)Q[b]=0;for(b=24817;b<=24821;b++)Q[b]=0;for(b=24877;b<=24882;b++)Q[b]=0;for(b=24891;b<=24893;b++)Q[b]=0;for(b=25391;b<=25395;b++)Q[b]=0;for(b=25828;b<=25838;b++)Q[b]=0;for(b=26191;b<=26195;b++)Q[b]=0;for(b=26391;b<=26393;b++)Q[b]=0;for(b=26701;b<=26722;b++)Q[b]=0;for(b=26729;b<=26799;b++)Q[b]=2;for(b=26801;b<=26803;b++)Q[b]=2;for(b=26811;b<=26813;b++)Q[b]=2;for(b=26847;b<=26870;b++)Q[b]=2;for(b=26891;b<=26899;b++)Q[b]=0;for(b=26901;b<=26923;b++)Q[b]=0;for(b=26929;b<=26946;b++)Q[b]=0;for(b=26948;b<=26998;b++)Q[b]=0;for(b=27037;b<=27040;b++)Q[b]=0;for(b=27205;b<=27232;b++)Q[b]=0;for(b=27258;b<=27260;b++)Q[b]=0;for(b=27391;b<=27398;b++)Q[b]=0;for(b=27561;b<=27564;b++)Q[b]=0;for(b=27571;b<=27574;b++)Q[b]=0;for(b=27581;b<=27584;b++)Q[b]=0;for(b=27591;b<=27594;b++)Q[b]=0;for(b=28191;b<=28193;b++)Q[b]=0;for(b=28348;b<=28358;b++)Q[b]=0;for(b=28402;b<=28432;b++)Q[b]=0;for(b=28462;b<=28492;b++)Q[b]=0;for(b=29118;b<=29122;b++)Q[b]=0;for(b=29168;b<=29172;b++)Q[b]=0;for(b=29177;b<=29185;b++)Q[b]=0;for(b=29187;b<=29195;b++)Q[b]=0;for(b=29900;b<=29903;b++)Q[b]=0;for(b=30161;b<=30179;b++)Q[b]=0;for(b=30491;b<=30494;b++)Q[b]=0;for(b=30729;b<=30732;b++)Q[b]=0;for(b=31251;b<=31259;b++)Q[b]=0;for(b=31265;b<=31268;b++)Q[b]=0;for(b=31275;b<=31279;b++)Q[b]=0;for(b=31281;b<=31297;b++)Q[b]=0;for(b=31461;b<=31469;b++)Q[b]=0;for(b=31491;b<=31495;b++)Q[b]=0;for(b=31917;b<=31922;b++)Q[b]=0;for(b=31965;b<=32e3;b++)Q[b]=0;for(b=32001;b<=32003;b++)Q[b]=2;for(b=32005;b<=32031;b++)Q[b]=2;for(b=32033;b<=32060;b++)Q[b]=2;for(b=32064;b<=32067;b++)Q[b]=2;for(b=32074;b<=32077;b++)Q[b]=2;for(b=32081;b<=32086;b++)Q[b]=0;for(b=32107;b<=32130;b++)Q[b]=0;for(b=32133;b<=32159;b++)Q[b]=0;for(b=32164;b<=32167;b++)Q[b]=2;for(b=32180;b<=32199;b++)Q[b]=0;for(b=32201;b<=32260;b++)Q[b]=0;for(b=32301;b<=32360;b++)Q[b]=0;for(b=32601;b<=32662;b++)Q[b]=0;for(b=32664;b<=32667;b++)Q[b]=2;for(b=32701;b<=32761;b++)Q[b]=0;for(b=53001;b<=53004;b++)Q[b]=0;for(b=53008;b<=53019;b++)Q[b]=0;for(b=53021;b<=53032;b++)Q[b]=0;for(b=53034;b<=53037;b++)Q[b]=0;for(b=53042;b<=53046;b++)Q[b]=0;for(b=53074;b<=53080;b++)Q[b]=0;for(b=54001;b<=54004;b++)Q[b]=0;for(b=54008;b<=54019;b++)Q[b]=0;for(b=54021;b<=54032;b++)Q[b]=0;for(b=54034;b<=54037;b++)Q[b]=0;for(b=54042;b<=54046;b++)Q[b]=0;for(b=54048;b<=54053;b++)Q[b]=0;for(b=54074;b<=54080;b++)Q[b]=0;for(b=54098;b<=54101;b++)Q[b]=0;for(b=102001;b<=102040;b++)Q[b]=0;for(b=102042;b<=102063;b++)Q[b]=0;for(b=102065;b<=102067;b++)Q[b]=0;for(b=102070;b<=102117;b++)Q[b]=0;for(b=102122;b<=102216;b++)Q[b]=0;for(b=102221;b<=102377;b++)Q[b]=0;for(b=102382;b<=102388;b++)Q[b]=0;for(b=102389;b<=102398;b++)Q[b]=2;for(b=102399;b<=102444;b++)Q[b]=0;for(b=102445;b<=102447;b++)Q[b]=2;for(b=102448;b<=102458;b++)Q[b]=0;for(b=102459;b<=102468;b++)Q[b]=2;for(b=102469;b<=102499;b++)Q[b]=0;for(b=102500;b<=102519;b++)Q[b]=1;for(b=102520;b<=102524;b++)Q[b]=0;for(b=102525;b<=102529;b++)Q[b]=2;for(b=102530;b<=102588;b++)Q[b]=0;for(b=102590;b<=102598;b++)Q[b]=0;for(b=102601;b<=102603;b++)Q[b]=0;for(b=102605;b<=102628;b++)Q[b]=0;for(b=102629;b<=102646;b++)Q[b]=2;for(b=102648;b<=102700;b++)Q[b]=2;for(b=102701;b<=102703;b++)Q[b]=0;for(b=102707;b<=102730;b++)Q[b]=2;for(b=102733;b<=102758;b++)Q[b]=2;for(b=102767;b<=102900;b++)Q[b]=0;for(b=102901;b<=102933;b++)Q[b]=2;for(b=102934;b<=102950;b++)Q[b]=13;for(b=102951;b<=102955;b++)Q[b]=0;for(b=102961;b<=102963;b++)Q[b]=0;for(b=102965;b<=102969;b++)Q[b]=0;for(b=102971;b<=102973;b++)Q[b]=0;for(b=102975;b<=102989;b++)Q[b]=0;for(b=102990;b<=102992;b++)Q[b]=1;for(b=102997;b<=103002;b++)Q[b]=0;for(b=103003;b<=103008;b++)Q[b]=2;for(b=103009;b<=103011;b++)Q[b]=0;for(b=103012;b<=103014;b++)Q[b]=2;for(b=103019;b<=103021;b++)Q[b]=0;for(b=103022;b<=103024;b++)Q[b]=2;for(b=103029;b<=103031;b++)Q[b]=0;for(b=103032;b<=103034;b++)Q[b]=2;for(b=103065;b<=103068;b++)Q[b]=0;for(b=103074;b<=103076;b++)Q[b]=0;for(b=103077;b<=103079;b++)Q[b]=1;for(b=103080;b<=103082;b++)Q[b]=0;for(b=103083;b<=103085;b++)Q[b]=2;for(b=103090;b<=103093;b++)Q[b]=0;for(b=103097;b<=103099;b++)Q[b]=0;for(b=103100;b<=103102;b++)Q[b]=2;for(b=103107;b<=103109;b++)Q[b]=0;for(b=103110;b<=103112;b++)Q[b]=2;for(b=103113;b<=103116;b++)Q[b]=0;for(b=103117;b<=103120;b++)Q[b]=2;for(b=103153;b<=103157;b++)Q[b]=0;for(b=103158;b<=103162;b++)Q[b]=2;for(b=103163;b<=103165;b++)Q[b]=0;for(b=103166;b<=103168;b++)Q[b]=1;for(b=103169;b<=103171;b++)Q[b]=2;for(b=103186;b<=103188;b++)Q[b]=0;for(b=103189;b<=103191;b++)Q[b]=2;for(b=103192;b<=103195;b++)Q[b]=0;for(b=103196;b<=103199;b++)Q[b]=2;for(b=103200;b<=103224;b++)Q[b]=0;for(b=103225;b<=103227;b++)Q[b]=1;for(b=103232;b<=103237;b++)Q[b]=0;for(b=103238;b<=103243;b++)Q[b]=2;for(b=103244;b<=103246;b++)Q[b]=0;for(b=103247;b<=103249;b++)Q[b]=2;for(b=103254;b<=103256;b++)Q[b]=0;for(b=103257;b<=103259;b++)Q[b]=2;for(b=103264;b<=103266;b++)Q[b]=0;for(b=103267;b<=103269;b++)Q[b]=2;for(b=103300;b<=103375;b++)Q[b]=0;for(b=103381;b<=103383;b++)Q[b]=0;for(b=103384;b<=103386;b++)Q[b]=1;for(b=103387;b<=103389;b++)Q[b]=0;for(b=103390;b<=103392;b++)Q[b]=2;for(b=103397;b<=103399;b++)Q[b]=0;for(b=103400;b<=103471;b++)Q[b]=2;for(b=103476;b<=103478;b++)Q[b]=0;for(b=103479;b<=103481;b++)Q[b]=2;for(b=103486;b<=103488;b++)Q[b]=0;for(b=103489;b<=103491;b++)Q[b]=2;for(b=103492;b<=103495;b++)Q[b]=0;for(b=103496;b<=103499;b++)Q[b]=2;for(b=103528;b<=103543;b++)Q[b]=0;for(b=103544;b<=103548;b++)Q[b]=2;for(b=103549;b<=103551;b++)Q[b]=0;for(b=103552;b<=103554;b++)Q[b]=1;for(b=103555;b<=103557;b++)Q[b]=2;for(b=103558;b<=103560;b++)Q[b]=0;for(b=103571;b<=103573;b++)Q[b]=0;for(b=103574;b<=103576;b++)Q[b]=2;for(b=103577;b<=103580;b++)Q[b]=0;for(b=103581;b<=103583;b++)Q[b]=2;for(b=103595;b<=103694;b++)Q[b]=0;for(b=103696;b<=103699;b++)Q[b]=0;for(b=103700;b<=103793;b++)Q[b]=2;for(b=103794;b<=103890;b++)Q[b]=0;for(b=103891;b<=103896;b++)Q[b]=2;for(b=103900;b<=103971;b++)Q[b]=2;for(b=103972;b<=103977;b++)Q[b]=0;for(b=112e3;b<=112101;b++)Q[b]=0;const M7e={102113:!0,102100:!0,3857:!0,3785:!0},R7e={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},nce='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',$D=[-20037508342788905e-9,20037508342788905e-9],LD=[-20037508342787e-6,20037508342787e-6],Twe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:$D,origin:LD,dx:1e-5},102100:{wkTemplate:nce,valid:$D,origin:LD,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:$D,origin:LD,dx:1e-5},3857:{wkTemplate:nce,valid:$D,origin:LD,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Po(t,e){return t===e||!N(t)&&!N(e)&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||Nx(t)&&Nx(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function Dv(t){return tc(t)&&t.wkid&&Twe[t.wkid]||null}function Swe(t){return!!tc(t)&&(t.wkid?Q[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function F$(t){return!(Gg(t)||jg(t))}function k$(t){return tc(t)&&t.wkid===4326}function Ewe(t){return tc(t)&&t.wkid===zp.CGCS2000}function Nx(t){return tc(t)&&t.wkid!=null&&M7e[t.wkid]===!0}function Ete(t){return tc(t)&&t.wkid===32662}function Cte(t){return t===zp.GCSMARS2000||t===zp.GCSMARS2000_SPHERE}function Gg(t){return tc(t)&&t.wkid!=null&&Cte(t.wkid)}function Mte(t){return t===zp.GCSMOON2000}function jg(t){return tc(t)&&t.wkid!=null&&Mte(t.wkid)}function O7e(t){return tc(t)&&t.wkid!=null&&R7e[t.wkid]===!0}function tc(t){return E(t)&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const P7e={wkid:4326,wkt:Og(Twe[4326].wkTemplate,{Central_Meridian:"0.0"})},I7e={wkid:102100,latestWkid:3857},$7e={wkid:32662};function Rte(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Cwe=Rte(gi),Ote=Rte(_g),Pte=Rte(Dy),Mwe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${gi.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function es(t){return E(t)&&(Gg(t)||Po(t,Ote))?_g:E(t)&&(jg(t)||Po(t,Pte))?Dy:gi}function F5t(t){return Cte(t)?_g:Mte(t)?Dy:gi}const Ite=39.37,L7e=gi.radius*Math.PI/200,Rwe=/UNIT\[([^\]]+)\]\]$/i,ux=Q,Owe=/UNIT\[([^\]]+)\]/i,D7e=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),N7e=hc()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),sm=t=>t*t,b_=t=>t*t*t,B$={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:sm(.001)},"square-centimeters":{inBaseUnits:sm(.01)},"square-decimeters":{inBaseUnits:sm(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:sm(1e3)},"square-inches":{inBaseUnits:sm(.0254)},"square-feet":{inBaseUnits:sm(.3048)},"square-yards":{inBaseUnits:sm(.9144)},"square-miles":{inBaseUnits:sm(1609.344)},"square-us-feet":{inBaseUnits:sm(1200/3937)},acres:{inBaseUnits:.0015625*sm(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*b_(.001)},"cubic-centimeters":{inBaseUnits:1e3*b_(.01)},"cubic-decimeters":{inBaseUnits:1e3*b_(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*b_(1e3)},"cubic-inches":{inBaseUnits:1e3*b_(.0254)},"cubic-feet":{inBaseUnits:1e3*b_(.3048)},"cubic-yards":{inBaseUnits:1e3*b_(.9144)},"cubic-miles":{inBaseUnits:1e3*b_(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},F7e=(()=>{const t={};for(const e in B$)for(const r in B$[e].units)t[r]=e;return t})();function k7e(t,e,r){return t*B$[r].units[e].inBaseUnits}function B7e(t,e,r){return t/B$[r].units[e].inBaseUnits}const U7e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function EW(t){const e=F7e[t];if(!e)throw new Error("unknown type");return e}function oce(t,e=null){return e=e||EW(t),B$[e].baseUnit===t}function Go(t,e,r){if(e===r)return t;const i=EW(e);if(i!==EW(r))throw new Error("incompatible units");const s=oce(e,i)?t:k7e(t,e,i);return oce(r,i)?s:B7e(s,r,i)}function k5t(t,e,r){switch(r){case"metric":return Pwe(t,e);case"imperial":return $we(t,e);default:return r}}function B5t(t,e,r){switch(r){case"metric":return Iwe(t,e);case"imperial":return Lwe(t,e);default:return r}}function Pwe(t,e){const r=Go(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function Iwe(t,e){const r=Go(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function $we(t,e){const r=Go(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function Lwe(t,e){const r=Go(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function U5t(t,e){const r=Go(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function V5t(t,e){const r=Go(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function V7e(t,e,r){return Go(t,e,"meters")/(r*Math.PI/180)}function Dwe(t){return N7e.fromJSON(t.toLowerCase())||null}function Fx(t){if(E(t)&&!F$(t))return 1;const e=tu(t);return e>1e5?1:e}function z7e(t){return tu(t)>=es(t).metersPerDegree?"meters":HB(t)}function tu(t,e=gi.metersPerDegree){return gr(G7e(t,!0),e)}function G7e(t,e=!1){const r=E(t)?t.wkid:null,i=E(t)?t.wkt:null;let s=null;if(r){if(Cte(r))return _g.metersPerDegree;if(Mte(r))return Dy.metersPerDegree;s=ux.values[ux[r]],!s&&e&&D7e.has(r)&&(s=L7e)}else i&&(kwe(i)?s=ace(Rwe.exec(i),s):Fwe(i)&&(s=ace(Owe.exec(i),s)));return s}function ace(t,e){return t&&t[1]?Nwe(t[1]):e}function Nwe(t){return parseFloat(t.split(",")[1])}function HB(t){const e=E(t)?t.wkid:null,r=E(t)?t.wkt:null;let i=null;if(e)i=ux.units[ux[e]];else if(r){const s=kwe(r)?Rwe:Fwe(r)?Owe:null;if(s){const n=s.exec(r);n&&n[1]&&(i=H7e(n[1]))}}return E(i)?Dwe(i):null}function z5t(t){const e=HB(t);return N(e)||!U7e.includes(e)?null:e}function Fwe(t){return/^GEOCCS/i.test(t)}function kwe(t){return/^PROJCS/i.test(t)}const j7e=1e-7;function H7e(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let r=e&&e[1];if(!r||!ux.units.includes(r)){const i=Nwe(t);r=null;const s=ux.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<j7e){r=ux.units[n];break}}return r}function G5t(t){const e=HB(t);if(N(e))return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const q7e={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},W7e={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},Y7e={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},Q7e=hc()(q7e),X7e=hc()(W7e),j5t=hc()(Y7e);var Tm;let Ds=Tm=class extends Qe{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Tm.WebMercator;if(t.wkid===4326)return Tm.WGS84}const e=new Tm;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return k$(this)}get isWebMercator(){return Nx(this)}get isGeographic(){return Swe(this)}get isWrappable(){return O7e(this)}get metersPerUnit(){return tu(this)}get unit(){return HB(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Tm.WGS84)return Tm.WGS84;if(this===Tm.WebMercator)return Tm.WebMercator;const t=new Tm;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=Te(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||i?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):r?s.id===e&&s.referenceServiceName===r:s.id===e}return Po(this,t)}toJSON(t){return this.write(void 0,t)}};Ds.GCS_NAD_1927=null,Ds.WGS84=null,Ds.WebMercator=null,Ds.PlateCarree=null,u([d({readOnly:!0})],Ds.prototype,"isWGS84",null),u([d({readOnly:!0})],Ds.prototype,"isWebMercator",null),u([d({readOnly:!0})],Ds.prototype,"isGeographic",null),u([d({readOnly:!0})],Ds.prototype,"isWrappable",null),u([d({type:rn,json:{write:!0}})],Ds.prototype,"latestWkid",void 0),u([d({readOnly:!0})],Ds.prototype,"metersPerUnit",null),u([d({readOnly:!0})],Ds.prototype,"unit",null),u([d({type:rn,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Ds.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Ds.prototype,"wkt",void 0),u([St("wkt"),St("web-scene","wkt")],Ds.prototype,"writeWkt",null),u([d({type:rn,json:{write:!0}})],Ds.prototype,"vcsWkid",void 0),u([d({type:rn,json:{write:!0}})],Ds.prototype,"latestVcsWkid",void 0),u([d()],Ds.prototype,"imageCoordinateSystem",void 0),Ds=Tm=u([j("esri.geometry.SpatialReference")],Ds),Ds.prototype.toJSON.isDefaultToJSON=!0,Ds.GCS_NAD_1927=new Ds({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Ds.WGS84=new Ds(P7e),Ds.WebMercator=new Ds(I7e),Ds.PlateCarree=new Ds($7e),Object.freeze&&(Object.freeze(Ds.GCS_NAD_1927),Object.freeze(Ds.WGS84),Object.freeze(Ds.WebMercator));const xt=Ds,Bwe="20230301",Uwe="2657e728c1857e6d94c324181c0788310bb0958a",Vwe="4.26",Z7e={async request(t,e){var a,l;const{default:r}=await be(()=>Promise.resolve().then(()=>pVe),void 0),i=t.options,s=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&((a=Awe(t.url))!=null&&a.after)?s:"array-buffer";const n=await r(t.url,i),o={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch((l=n.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Os;function H5t(t){Os=t}function q5t(t){const e=Os&&Os.findCredential(t);return e&&e.token?wwe(t,"token",e.token):t}Le("host-webworker");const J7e=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function zwe(t){const e=P0(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!J7e.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function Gwe(t,e,r=!1,i){return new Promise((s,n)=>{if(da(i))return void n(lce());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),s(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",n(lce())};const c=()=>{Le("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,E(i)&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};E(i)&&i.addEventListener("abort",l),Le("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function lce(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}function K7e(t){ls.request.crossOriginNoCorsDomains||(ls.request.crossOriginNoCorsDomains={});const e=ls.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[P0(r)??""]=0:(e[P0("http://"+r)??""]=0,e[P0("https://"+r)??""]=0)}function eVe(t){const e=ls.request.crossOriginNoCorsDomains;if(e){let r=P0(t);if(r)return r=r.toLowerCase(),!R3(r,yte())&&e[r]<Date.now()-36e5}return!1}async function tVe(t){var s;const e=ls.request.crossOriginNoCorsDomains,r=P0(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=eu(t);t=i.path,((s=i.query)==null?void 0:s.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function Ys(t,e){var c;const r=zg(t),i=O3(t);i||r||(t=O0(t));const s={url:t,requestOptions:{...e}};let n=Awe(t);if(n){const h=await cVe(n,s);if(h!=null)return{data:h,getHeader:$te,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"){if(Le("host-webworker")||Le("host-node"))throw g0("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(r)throw g0("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+e.responseType),s);if(e.method==="head"){if(e.body)throw g0("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw g0("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await oVe(),_k)return _k.execute(t,e);const o=new AbortController;ic(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:n0.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await hVe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let _k;const n0=ls.request,jwe="FormData"in globalThis,rVe=[499,498,403,401],iVe=["COM_0056","COM_0057","SB_0008"],sVe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],$te=()=>null,vk=Symbol();function nVe(t){const e=P0(t);e&&!Ys._corsServers.includes(e)&&Ys._corsServers.push(e)}function cce(t){const e=P0(t);return!e||e.endsWith(".arcgis.com")||Ys._corsServers.includes(e)||vte(e)}function g0(t,e,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:$te,ssl:!1};if(e instanceof ce)return e.details?(e.details=Te(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=n,e;if(e){const o=i&&(c=>i.headers.get(c)),a=i&&i.status,l=e.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=vk in e?e[vk]:e}return vo(e)?Yi():new ce(t,s,n)}async function oVe(){Le("host-webworker")?_k||(_k=await be(()=>import("./request-36680bf8.js"),[])):Ys._abortableFetch||(Ys._abortableFetch=globalThis.fetch.bind(globalThis))}async function CW(){Os||await be(()=>import("./IdentityManager-e2f71974.js"),[])}async function aVe(t){var a;const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,s=r.body;let n=null,o=null;if(jwe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:r.cacheBust&&!Ys._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:n0.priority,redirect:"follow",signal:i},(n||o)&&(t.fetchOptions.body=n||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=r.query)!=null&&a.token||n!=null&&n.get("token")),!t.hasToken&&ls.apiKey&&zwe(e)&&(r.query||(r.query={}),r.query.token=ls.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!Hwe(e)&&!da(i)){let l;r.authMode==="immediate"?(await CW(),l=await Os.getCredential(e,{signal:i}),t.credential=l):r.authMode==="no-prompt"?(await CW(),l=await Os.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=l):Os&&(l=Os.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function Hwe(t){return sVe.some(e=>e.test(t))}async function lVe(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},s=O3(e)||zg(e),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:n0.timeout;let a=!1;if(!s){t.useSSL&&(e=Tte(e)),r.cacheBust&&i.cache==="default"&&(e=wwe(e,"request.preventCache",Date.now()));let A={...r.query};t.credentialToken&&(A.token=t.credentialToken);let _=N$(A);Le("esri-url-encodes-apostrophe")&&(_=_.replace(/'/g,"%27"));const w=e.length+1+_.length;let T;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||w>n0.maxUrlLength;const C=r.useProxy||!!jB(e);if(C){const M=u7e(e);T=M.path,!a&&T.length+1+w>n0.maxUrlLength&&(a=!0),M.query&&(A={...M.query,...A})}if(i.method==="HEAD"&&(a||C)){if(a)throw w>n0.maxUrlLength?g0("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):g0("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(C)throw g0("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=JV(e,A):(i.body=N$(A),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=JV(e,A),C&&(t.useProxy=!0,e=`${T}?${e}`),A.token&&jwe&&i.body instanceof FormData&&!KUe(e)&&i.body.set("token",A.token),r.hasOwnProperty("withCredentials"))t.withCredentials=r.withCredentials;else if(!R3(e,yte())){if(vte(e))t.withCredentials=!0;else if(Os){const M=Os.findServerInfo(e);M&&M.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(i.credentials="include",eVe(e)&&await tVe(a?JV(e,A):e))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||uVe(r.headers)||!s&&!t.useProxy&&n0.proxyUrl&&!cce(e)){if(l=await Ys._abortableFetch(e,i),t.useProxy||nVe(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=uce(c,"application/xml");break;case"document":c=uce(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const A=l.headers.get("Content-Type");if(A&&/application\/json|text\/plain/i.test(A)&&c[n==="blob"?"size":"byteLength"]<=750)try{const _=await new Response(c).json();_.error&&(c=_)}catch{}}n==="image"&&c instanceof Blob&&(c=await hce(URL.createObjectURL(c),t,!0))}}else c=await l.text()}else c=await hce(e,t)}catch(A){if(A.name==="AbortError")throw p?new Error("Timeout exceeded"):Yi("Request canceled");if(!(!l&&A instanceof TypeError&&n0.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||cce(e))throw A;t.redoRequest=!0,h7e({proxyUrl:n0.proxyUrl,urlPrefix:P0(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function cVe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(s){r=g0("request:interceptor",s,e)}if((i instanceof Error||i instanceof ce)&&(r=g0("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function uVe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function uce(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function hVe(t){var n;let e,r;await aVe(t);try{do[e,r]=await lVe(t);while(!await dVe(t,e,r))}catch(o){const a=g0("request:server",o,t.params,e);throw a.details.ssl=t.useSSL,t.interceptor&&t.interceptor.error&&t.interceptor.error(a),a}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&((n=r.user)!=null&&n.username)&&!vte(i)){const o=P0(i,!0);o&&n0.trustedServers.push(o)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&K7e(r.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&Os){const o=Os.findServerInfo(s.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=Os.findCredential(a,s.userId);l&&Os._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:r,getHeader:e?o=>e==null?void 0:e.headers.get(o):$te,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function dVe(t,e,r){if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n;if(!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[vk]=r,s;r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[vk]=r,s.details=r.messages));let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o&&o.toUpperCase());const l=i.authMode;if(n===403&&(a===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&rVe.includes(n)&&!Hwe(t.params.url)&&(n!==403||o&&!iVe.includes(o)&&(a==null||a===2&&t.credentialToken))){await CW();try{const c=await Os.getCredential(t.params.url,{error:g0("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function hce(t,e,r=!1){const i=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=n0.priority,s.src=t,Gwe(s,t,r,i)}Ys._abortableFetch=null,Ys._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const pVe=Object.freeze(Object.defineProperty({__proto__:null,default:Ys},Symbol.toStringTag,{value:"Module"}));function ft(t,e,r){let i,s;return e===void 0||Array.isArray(e)?(s=t,r=e,i=[void 0]):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=Gbe(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let Sm=class extends Qe{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=xt.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof xt)return e;if(e!=null){const i=new xt;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};u([d()],Sm.prototype,"type",void 0),u([d({readOnly:!0})],Sm.prototype,"cache",null),u([d({readOnly:!0})],Sm.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Sm.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Sm.prototype,"hasZ",void 0),u([d({type:xt,json:{write:!0},value:xt.WGS84})],Sm.prototype,"spatialReference",void 0),u([ft("spatialReference")],Sm.prototype,"readSpatialReference",null),Sm=u([j("esri.geometry.Geometry")],Sm);const wb=Sm,fVe=Object.prototype.toString;function mVe(t){const e="__accessorMetadata__"in t?Oo(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return gVe.apply(this,r)}}function gVe(t,e,r,i){NB(t,e).cast=i}function AVe(t){return(e,r)=>{NB(e,t).cast=e[r]}}function Hr(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&fVe.call(t[0])==="[object Function]"?mVe(t[0]):t.length===1&&typeof t[0]=="string"?AVe(t[0]):void 0}function yVe(t,e){const r=t.x-e.x,i=t.y-e.y,s=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+s*s)}const _Ve=57.29577951308232,vVe=.017453292519943;function dce(t){return t*_Ve}function pce(t){return t*vVe}function fce(t){return t/gi.radius}function bk(t){return Math.PI/2-2*Math.atan(Math.exp(-t/gi.radius))}function MW(t){return t.wkid!=null||t.wkt!=null}const KV=[0,0];function wk(t,e,r,i,s){const n=t,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,KV,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,KV,i),[o.xmax,o.ymax]=e(n.xmax,n.ymax,KV,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let A=0;A<p.length;A++)c.push(e(p[A][0],p[A][1],[0,0],i)),p[A].length>2&&c[A].push(p[A][2]),p[A].length>3&&c[A].push(p[A][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function Nv(t,e){const r=t&&(MW(t)?t:t.spatialReference),i=e&&(MW(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!Po(i,r)||Nx(i)&&k$(r)||Nx(r)&&k$(i))}function xb(t,e){if(N(t))return null;const r=t.spatialReference,i=e&&(MW(e)?e:e.spatialReference);return Nv(r,i)?Po(r,i)?Te(t):Nx(i)?wk(t,hC,xt.WebMercator,!1,Te(t)):k$(i)?wk(t,wI,xt.WGS84,!1,Te(t)):null:null}function hC(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=pce(e);return r[0]=pce(t)*gi.radius,r[1]=gi.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function wI(t,e,r=[0,0],i=!1){const s=dce(t/gi.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=dce(Math.PI/2-2*Math.atan(Math.exp(-e/gi.radius))),r}function gy(t,e=!1,r=Te(t)){return wk(t,hC,xt.WebMercator,e,r)}function dC(t,e=!1,r=Te(t)){return wk(t,wI,xt.WGS84,e,r)}var zF;const SR=[0,0];function mce(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let mu=zF=class extends wb{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],r=n[2],i=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new xt(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)we.getLogger(this.declaredClass).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)we.getLogger(this.declaredClass).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=hC(n.longitude,n.latitude,SR);t=a[0],e=a[1]}}}else mce(r)?(s=r,r=null):mce(i)&&(s=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?we.getLogger(this.declaredClass).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&we.getLogger(this.declaredClass).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return wI(e,r,SR)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",hC(r,t,SR)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return wI(t,e,SR)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",hC(t,e,SR)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new zF;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return zF.copy(t,this),this}equals(t){if(N(t))return!1;const{x:e,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=hC(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=wI(l,c),h=n}return e===l&&r===c&&i===o&&s===a&&n.wkid===h.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=Dv(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,s=2*i;let n;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s),this._set("x",e),this}distance(t){return yVe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],mu.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],mu.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],mu.prototype,"hasZ",null),u([d({type:Number})],mu.prototype,"latitude",null),u([d({type:Number})],mu.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Hr(t=>isNaN(t)?t:Dp(t))],mu.prototype,"x",void 0),u([St("x")],mu.prototype,"writeX",null),u([ft("x")],mu.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],mu.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],mu.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],mu.prototype,"m",void 0),mu=zF=u([j("esri.geometry.Point")],mu),mu.prototype.toJSON.isDefaultToJSON=!0;const Gt=mu,ez=[0,0];function Lte(t,e){return!!E(e)&&Bc(t,e.x,e.y,e.z)}function Y5t(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!P3(t,r))return!1;return!0}function bVe(t,e){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?Bc(t,r,i,s)&&Bc(t,r,o,s)&&Bc(t,n,o,s)&&Bc(t,n,i,s)&&Bc(t,r,i,a)&&Bc(t,r,o,a)&&Bc(t,n,o,a)&&Bc(t,n,i,a):Bc(t,r,i)&&Bc(t,r,o)&&Bc(t,n,o)&&Bc(t,n,i)}function P3(t,e){return Bc(t,e[0],e[1])}function wVe(t,e){return Bc(t,e[0],e[1],e[2])}function Bc(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function xVe(t,e){return ez[1]=e.y,ez[0]=e.x,TVe(t,ez)}function TVe(t,e){return qwe(t.rings,e)}function qwe(t,e){if(!t)return!1;if(SVe(t))return gce(!1,t,e);let r=!1;for(let i=0,s=t.length;i<s;i++)r=gce(r,t[i],e);return r}function SVe(t){return!Array.isArray(t[0][0])}function gce(t,e,r){const[i,s]=r;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[p,A]=e[o];(h<s&&A>=s||A<s&&h>=s)&&c+(s-h)/(A-h)*(p-c)<i&&(n=!n)}return n}function EVe(t,e){return Lte(t,e)}function CVe(t,e){const r=t.hasZ&&e.hasZ;let i,s,n;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function MVe(t,e){const{points:r,hasZ:i}=e,s=i?wVe:P3;for(const n of r)if(s(t,n))return!0;return!1}const kx=[0,0],Bx=[0,0],Ux=[0,0],Vx=[0,0],RVe=[kx,Bx,Ux,Vx],Wwe=[[Ux,kx],[kx,Bx],[Bx,Vx],[Vx,Ux]];function OVe(t,e){return PVe(t,e.rings)}function PVe(t,e){kx[0]=t.xmin,kx[1]=t.ymax,Bx[0]=t.xmax,Bx[1]=t.ymax,Ux[0]=t.xmin,Ux[1]=t.ymin,Vx[0]=t.xmax,Vx[1]=t.ymin;for(const r of RVe)if(qwe(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(P3(t,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(P3(t,n)||Ywe(i,n,Wwe))return!0;i=n}}return!1}function IVe(t,e){kx[0]=t.xmin,kx[1]=t.ymax,Bx[0]=t.xmax,Bx[1]=t.ymax,Ux[0]=t.xmin,Ux[1]=t.ymin,Vx[0]=t.xmax,Vx[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(P3(t,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(P3(t,o)||Ywe(s,o,Wwe))return!0;s=o}}return!1}const Al=[0,0];function $Ve(t){for(let e=0;e<t.length;e++){const r=t[e];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(RW(n,o,c,h,Al)&&!(Al[0]===n[0]&&Al[1]===n[1]||Al[0]===c[0]&&Al[1]===c[1]||Al[0]===o[0]&&Al[1]===o[1]||Al[0]===h[0]&&Al[1]===h[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],h=r[l+1];if(RW(o,a,c,h,Al)&&!(Al[0]===o[0]&&Al[1]===o[1]||Al[0]===c[0]&&Al[1]===c[1]||Al[0]===a[0]&&Al[1]===a[1]||Al[0]===h[0]&&Al[1]===h[1]))return!0}}}return!1}function Ywe(t,e,r){for(let i=0;i<r.length;i++)if(RW(t,e,r[i][0],r[i][1]))return!0;return!1}function RW(t,e,r,i,s){const[n,o]=t,[a,l]=e,[c,h]=r,[p,A]=i,_=p-c,w=n-c,T=a-n,C=A-h,M=o-h,O=l-o,$=C*T-_*O;if($===0)return!1;const L=(_*M-C*w)/$,k=(T*M-O*w)/$;return L>=0&&L<=1&&k>=0&&k<=1&&(s&&(s[0]=n+L*(a-n),s[1]=o+L*(l-o)),!0)}function LVe(t){switch(t){case"esriGeometryEnvelope":case"extent":return CVe;case"esriGeometryMultipoint":case"multipoint":return MVe;case"esriGeometryPoint":case"point":return EVe;case"esriGeometryPolygon":case"polygon":return OVe;case"esriGeometryPolyline":case"polyline":return IVe}}var pp;function DVe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function w_(t,e,r){return e==null?r:r==null?e:t(e,r)}let Ga=pp=class extends wb{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,s){return DVe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?xt.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:s??xt.WGS84}}static fromBounds(t,e){return new pp({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new pp({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Gt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new pp;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&Nv(e,r)&&(t=e.isWebMercator?gy(t):dC(t,!0)),t.type==="point"?Lte(this,t):t.type==="extent"&&bVe(this,t)}equals(t){if(this===t)return!0;if(N(t))return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&Nv(e,r)&&(t=e.isWebMercator?gy(t):dC(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(N(t))return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!Po(e,r)&&Nv(e,r)&&(t=e.isWebMercator?gy(t):dC(t,!0)),LVe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=w_(Math.min,this.zmin,t.zmin),this.zmax=w_(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=w_(Math.min,this.mmin,t.mmin),this.mmax=w_(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:N(t)||!this.intersects(t)?null:(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=w_(Math.max,this.zmin,t.zmin),this.zmax=w_(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=w_(Math.max,this.mmin,t.mmin),this.mmax=w_(Math.min,this.mmax,t.mmax)),this)}toJSON(t){return this.write({},t)}_shiftCM(t=Dv(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?dC(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new xt(Og((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const s=r??Dv(i);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||Dv(o);const[p,A]=t.valid;h=this._normalizeX(this.xmin,t);const _=h.x,w=h.frameId;h=this._normalizeX(this.xmax,t);const T=h.x,C=h.frameId,M=_===T&&a>0;if(a>2*A){const O=new pp(l<c?_:T,s,A,n,o),$=new pp(p,s,l<c?T:_,n,o),L=new pp(0,s,A,n,o),k=new pp(p,s,0,n,o),F=[],G=[];O.contains(L)&&F.push(w),O.contains(k)&&G.push(w),$.contains(L)&&F.push(C),$.contains(k)&&G.push(C);for(let z=w+1;z<C;z++)F.push(z),G.push(z);e.push({extent:O,frameIds:[w]},{extent:$,frameIds:[C]},{extent:L,frameIds:F},{extent:k,frameIds:G})}else _>T||M?e.push({extent:new pp(_,s,A,n,o),frameIds:[w]},{extent:new pp(p,s,T,n,o),frameIds:[C]}):e.push({extent:new pp(_,s,T,n,o),frameIds:[w]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}_normalizeX(t,e){const[r,i]=e.valid,s=2*i;let n,o=0;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s,o=n):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s,o=-n),{x:t,frameId:o}}};u([d({readOnly:!0})],Ga.prototype,"cache",null),u([d({readOnly:!0})],Ga.prototype,"center",null),u([d({readOnly:!0})],Ga.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Ga.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Ga.prototype,"hasZ",null),u([d({readOnly:!0})],Ga.prototype,"height",null),u([d({readOnly:!0})],Ga.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Ga.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],Ga.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ga.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ga.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],Ga.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],Ga.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ga.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ga.prototype,"zmax",void 0),Ga=pp=u([j("esri.geometry.Extent")],Ga),Ga.prototype.toJSON.isDefaultToJSON=!0;const Ki=Ga;let xI;var G_e,j_e;const NVe=((G_e=globalThis.esriConfig)==null?void 0:G_e.locale)??((j_e=globalThis.dojoConfig)==null?void 0:j_e.locale);function Qwe(){var t;return NVe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function Yc(){return xI===void 0&&(xI=Qwe()),xI}const TI=[];function Dte(t){return TI.push(t),{remove(){TI.splice(TI.indexOf(t),1)}}}const OW=[];function Nte(t){return OW.push(t),{remove(){TI.splice(OW.indexOf(t),1)}}}function FVe(){const t=Qwe();xI!==t&&(xI=t,[...OW].forEach(e=>{e.call(null,t)}),[...TI].forEach(e=>{e.call(null,t)}))}var H_e;(H_e=globalThis.addEventListener)==null||H_e.call(globalThis,"languagechange",FVe);var PW;const kVe=new Ui({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let fp=PW=class extends Ke{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new PW({categories:this.categories?Te(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=xb(this.extent,xt.WGS84);E(o)&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>kVe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};u([d()],fp.prototype,"categories",void 0),u([d()],fp.prototype,"disableExtraQuery",void 0),u([d({type:Ki})],fp.prototype,"extent",void 0),u([d()],fp.prototype,"filter",void 0),u([d()],fp.prototype,"num",void 0),u([d()],fp.prototype,"query",void 0),u([d()],fp.prototype,"sortField",void 0),u([d()],fp.prototype,"sortOrder",null),u([d()],fp.prototype,"start",void 0),fp=PW=u([j("esri.portal.PortalQueryParams")],fp);const sy=fp;let Ow=class extends Ke{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],Ow.prototype,"nextQueryParams",void 0),u([d()],Ow.prototype,"queryParams",void 0),u([d()],Ow.prototype,"results",void 0),u([d()],Ow.prototype,"total",void 0),Ow=u([j("esri.portal.PortalQueryResult")],Ow);const BVe=Ow;let xA=class extends Qe{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new ce("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],xA.prototype,"created",void 0),u([d()],xA.prototype,"id",void 0),u([d()],xA.prototype,"portal",void 0),u([d()],xA.prototype,"title",void 0),u([d({readOnly:!0})],xA.prototype,"url",null),u([d()],xA.prototype,"username",void 0),xA=u([j("esri.portal.PortalFolder")],xA);const UVe=xA;let ja=class extends Qe{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const e=this.url,r=this.thumbnail;return e&&r&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${e}/info/${r}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return Pu(this.portal).request(this.url+"/categorySchema",e).then(r=>{const i=r.categorySchema||[];return i.some(s=>s.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return Pu(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let r=this.thumbnailUrl;return r&&e&&(r+=`&w=${e}`),r}toJSON(){throw new ce("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,r){let i=Oo(sy,e);const s=Pu(this.portal);return parseFloat(s.currentVersion)>5?(i=i||new sy,s.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",r)):(i=i?i.clone():new sy,i.query="group:"+this.id+(i.query?" "+i.query:""),s.queryItems(i,r))}_fetchCategorySchemaSet(e,r){const i=Pu(this.portal);return i.fetchSelf(i.authMode,!0,r).then(s=>{const n=s.contentCategorySetsGroupQuery;if(n){const o=new sy;return o.disableExtraQuery=!0,o.num=1,o.query=n,i.queryGroups(o,r)}throw new ce("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(s=>{if(s.total){const n=s.results[0],o=new sy;return o.num=1,o.query=`typekeywords:"${e}"`,n.queryItems(o,r)}throw new ce("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(s=>s.total?s.results[0].fetchData("json",r).then(n=>{const o=n&&n.categorySchema;return o&&o.length?o:[]}):[])}};u([d()],ja.prototype,"access",void 0),u([d({type:Date})],ja.prototype,"created",void 0),u([d()],ja.prototype,"description",void 0),u([d()],ja.prototype,"id",void 0),u([d()],ja.prototype,"isInvitationOnly",void 0),u([d({type:Date})],ja.prototype,"modified",void 0),u([d()],ja.prototype,"owner",void 0),u([d()],ja.prototype,"portal",void 0),u([d()],ja.prototype,"snippet",void 0),u([d()],ja.prototype,"sortField",void 0),u([d()],ja.prototype,"sortOrder",void 0),u([d()],ja.prototype,"tags",void 0),u([d()],ja.prototype,"thumbnail",void 0),u([d({readOnly:!0})],ja.prototype,"thumbnailUrl",null),u([d()],ja.prototype,"title",void 0),u([d({readOnly:!0})],ja.prototype,"url",null),ja=u([j("esri.portal.PortalGroup")],ja);const IW=ja,VVe=Object.freeze(Object.defineProperty({__proto__:null,default:IW},Symbol.toStringTag,{value:"Module"}));var $W;let Vn=$W=class extends Qe{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t&&t.data,i=t&&t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const s=UVe.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=IW.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),be(()=>Promise.resolve().then(()=>Xwe),void 0).then(({default:s})=>{r=s;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:n})}).then(s=>{let n;return s&&s.items?(n=s.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(n.map(o=>o.load())).catch(o=>o).then(()=>({items:n,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new IW({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new ce("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new ce("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new $W;return e.sourceJSON=t,e.read(t),e}};u([d()],Vn.prototype,"access",void 0),u([d({type:Date})],Vn.prototype,"created",void 0),u([d()],Vn.prototype,"culture",void 0),u([d()],Vn.prototype,"description",void 0),u([d()],Vn.prototype,"email",void 0),u([d()],Vn.prototype,"favGroupId",void 0),u([d()],Vn.prototype,"fullName",void 0),u([d({type:Date})],Vn.prototype,"modified",void 0),u([d()],Vn.prototype,"orgId",void 0),u([d()],Vn.prototype,"portal",void 0),u([d()],Vn.prototype,"preferredView",void 0),u([d()],Vn.prototype,"privileges",void 0),u([d()],Vn.prototype,"region",void 0),u([d()],Vn.prototype,"role",void 0),u([d()],Vn.prototype,"roleId",void 0),u([d()],Vn.prototype,"sourceJSON",void 0),u([d()],Vn.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Vn.prototype,"thumbnailUrl",null),u([d()],Vn.prototype,"units",void 0),u([d({readOnly:!0})],Vn.prototype,"userContentUrl",null),u([d({readOnly:!0})],Vn.prototype,"url",null),u([d()],Vn.prototype,"username",void 0),u([d()],Vn.prototype,"userType",void 0),Vn=$W=u([j("esri.portal.PortalUser")],Vn);const Fte=Vn,zVe=Object.freeze(Object.defineProperty({__proto__:null,default:Fte},Symbol.toStringTag,{value:"Module"}));var nd;let tz;const Ace={PortalGroup:()=>be(()=>Promise.resolve().then(()=>VVe),void 0),PortalItem:()=>be(()=>Promise.resolve().then(()=>Xwe),void 0),PortalUser:()=>be(()=>Promise.resolve().then(()=>zVe),void 0)};let bt=nd=class extends aL(Ly){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=ls.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){this._esriIdCredentialCreateHandle=sn(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)ls.request.trustedServers.includes(e)||ls.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=Fte.fromJSON(t),e.portal=this),e}load(t){const e=be(()=>Promise.resolve().then(()=>hze),void 0).then(({default:r})=>{di(t),tz=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{if(Os){const i=Os;this.credential=i.findCredential(this.restUrl),this.credential||this.authMode!==nd.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle=i.on("credential-create",()=>{i.findCredential(this.restUrl)&&this.signIn().catch(()=>{})}))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await be(()=>import("./ElevationLayer-b08cec75.js"),["assets/ElevationLayer-b08cec75.js","assets/ArcGISCachedService-1f1a227f.js","assets/TilemapCache-efae9634.js"])).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}fetchBasemaps(t,e){const r=new sy;return r.query=t||(ls.apiKey&&zwe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0,this.queryGroups(r,e).then(i=>{if(r.num=100,r.query='type:"Web Map" -type:"Web Application"',i.total){const s=i.results[0];return r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc",s.queryItems(r,e)}return null}).then(i=>{let s;return s=i&&i.total?i.results.filter(n=>n.type==="Web Map").map(n=>new tz({portalItem:n})):[],s})}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):da(t)?Promise.reject(Yi()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new sy;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const s of e)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(s=>s.results)}return da(t)?Promise.reject(Yi()):Promise.resolve([])}fetchRegions(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||Yc();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||Yc();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return nd._default&&!nd._default.destroyed||(nd._default=new nd),nd._default}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",s={authMode:t,query:{culture:Yc().toLowerCase()},...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(i,s)}queryPortal(t,e,r,i){const s=Oo(sy,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new BVe({nextQueryParams:l,queryParams:s,total:a.total,results:nd._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Sh(l),a)));return r&&Ace[r]?Ace[r]().then(({default:o})=>(di(i),n(o))):n()}signIn(){if(this.authMode===nd.AUTH_MODE_ANONYMOUS)return Promise.reject(new ce("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Os?Os.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const s=nd._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===nd.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return Ys(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new ce("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new nd({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new ce("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=tz.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let s=[];if(r){const n=E(i)?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};bt.AUTH_MODE_ANONYMOUS="anonymous",bt.AUTH_MODE_AUTO="auto",bt.AUTH_MODE_IMMEDIATE="immediate",u([d()],bt.prototype,"access",void 0),u([d()],bt.prototype,"allSSL",void 0),u([d()],bt.prototype,"authMode",void 0),u([d()],bt.prototype,"authorizedCrossOriginDomains",void 0),u([ft("authorizedCrossOriginDomains")],bt.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],bt.prototype,"basemapGalleryGroupQuery",void 0),u([d()],bt.prototype,"bingKey",void 0),u([d()],bt.prototype,"canListApps",void 0),u([d()],bt.prototype,"canListData",void 0),u([d()],bt.prototype,"canListPreProvisionedItems",void 0),u([d()],bt.prototype,"canProvisionDirectPurchase",void 0),u([d()],bt.prototype,"canSearchPublic",void 0),u([d()],bt.prototype,"canShareBingPublic",void 0),u([d()],bt.prototype,"canSharePublic",void 0),u([d()],bt.prototype,"canSignInArcGIS",void 0),u([d()],bt.prototype,"canSignInIDP",void 0),u([d()],bt.prototype,"colorSetsGroupQuery",void 0),u([d()],bt.prototype,"commentsEnabled",void 0),u([d({type:Date})],bt.prototype,"created",void 0),u([d()],bt.prototype,"credential",void 0),u([d()],bt.prototype,"culture",void 0),u([d()],bt.prototype,"currentVersion",void 0),u([d()],bt.prototype,"customBaseUrl",void 0),u([d()],bt.prototype,"defaultBasemap",void 0),u([ft("defaultBasemap")],bt.prototype,"readDefaultBasemap",null),u([d()],bt.prototype,"defaultDevBasemap",void 0),u([ft("defaultDevBasemap")],bt.prototype,"readDefaultDevBasemap",null),u([d({type:Ki})],bt.prototype,"defaultExtent",void 0),u([d()],bt.prototype,"defaultVectorBasemap",void 0),u([ft("defaultVectorBasemap")],bt.prototype,"readDefaultVectorBasemap",null),u([d()],bt.prototype,"description",void 0),u([d()],bt.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],bt.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],bt.prototype,"extraQuery",null),u([d()],bt.prototype,"featuredGroups",void 0),u([d()],bt.prototype,"featuredItemsGroupQuery",void 0),u([d()],bt.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],bt.prototype,"livingAtlasGroupQuery",void 0),u([d()],bt.prototype,"hasCategorySchema",void 0),u([d()],bt.prototype,"helpBase",void 0),u([d()],bt.prototype,"helperServices",void 0),u([d()],bt.prototype,"helpMap",void 0),u([d()],bt.prototype,"homePageFeaturedContent",void 0),u([d()],bt.prototype,"homePageFeaturedContentCount",void 0),u([d()],bt.prototype,"httpPort",void 0),u([d()],bt.prototype,"httpsPort",void 0),u([d()],bt.prototype,"id",void 0),u([d()],bt.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],bt.prototype,"isOrganization",null),u([d()],bt.prototype,"isPortal",void 0),u([d()],bt.prototype,"isReadOnly",void 0),u([d({readOnly:!0})],bt.prototype,"itemPageUrl",null),u([d()],bt.prototype,"layerTemplatesGroupQuery",void 0),u([d()],bt.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],bt.prototype,"modified",void 0),u([d()],bt.prototype,"name",void 0),u([d()],bt.prototype,"portalHostname",void 0),u([d()],bt.prototype,"portalMode",void 0),u([d()],bt.prototype,"portalProperties",void 0),u([d()],bt.prototype,"region",void 0),u([d({readOnly:!0})],bt.prototype,"restUrl",null),u([d()],bt.prototype,"rotatorPanels",void 0),u([d()],bt.prototype,"showHomePageDescription",void 0),u([d()],bt.prototype,"sourceJSON",void 0),u([d()],bt.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],bt.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],bt.prototype,"stylesGroupQuery3d",void 0),u([d()],bt.prototype,"supportsHostedServices",void 0),u([d()],bt.prototype,"symbolSetsGroupQuery",void 0),u([d()],bt.prototype,"templatesGroupQuery",void 0),u([d()],bt.prototype,"thumbnail",void 0),u([d({readOnly:!0})],bt.prototype,"thumbnailUrl",null),u([d()],bt.prototype,"units",void 0),u([d()],bt.prototype,"url",void 0),u([d()],bt.prototype,"urlKey",void 0),u([ft("urlKey")],bt.prototype,"readUrlKey",null),u([d()],bt.prototype,"user",void 0),u([ft("user")],bt.prototype,"readUser",null),u([d()],bt.prototype,"useStandardizedQuery",void 0),u([d()],bt.prototype,"useVectorBasemaps",void 0),u([d()],bt.prototype,"vectorBasemapGalleryGroupQuery",void 0),bt=nd=u([j("esri.portal.Portal")],bt);const zu=bt,GVe=we.getLogger("esri.assets");function jVe(t,e){return Ys(Zi(t),e)}function Zi(t){if(!ls.assetsPath)throw GVe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new ce("assets:path-not-set","config.assetsPath is not set");return Dx(ls.assetsPath,t)}let o1=class extends Ke{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){E(e)&&Fd(e)?we.getLogger(this.declaredClass).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.url;if(N(i))throw new ce("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:pa(r,"signal")})}async update(e,r){return(await be(()=>import("./resourceUtils-c348014a.js"),[])).addOrUpdateResource(this,"update",e,r)}hasPath(){return E(this.path)}_normalizePath(e,r){return N(e)?e:(e=e.replace(/^\/+/,""),E(r)&&Fd(e)&&(e=bte(e,r.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],o1.prototype,"portalItem",void 0),u([d({type:String,value:null})],o1.prototype,"path",null),u([Hr("path")],o1.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],o1.prototype,"url",null),u([d({type:String,readOnly:!0})],o1.prototype,"itemRelativeUrl",null),o1=u([j("esri.portal.PortalItemResource")],o1);const HVe=o1;let VO=class extends Ke{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],VO.prototype,"created",void 0),u([d()],VO.prototype,"rating",void 0),VO=u([j("esri.portal.PortalRating")],VO);const rz=VO;var Pw;const qVe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),WVe=new Set(["KML","GeoJson","CSV"]);let pi=Pw=class extends aL(Ly){static from(t){return M3(Pw,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?r="Locator":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replace(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"&&(r="Insights Report"),r}readExtent(t){return t&&t.length?new Ki(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=t==="map service"||t==="wms"||t==="wmts"?n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?"mediaservice":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):s=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="360 vr experience"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":"maps",s?Zi(r+s+i+".png"):null}get isLayer(){return this.type!=null&&qVe.has(this.type)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var r;const t=this.itemUrl,e=this.thumbnail;return t&&e?((r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=zu.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:E(t)?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof rz&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new rz({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:Te(this.applicationProxies),avgRating:this.avgRating,categories:Te(this.categories),created:Te(this.created),culture:this.culture,description:this.description,extent:Te(this.extent),groupCategories:Te(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:Te(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:Te(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Te(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Te(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new Pw({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const r of["tags","typeKeywords","categories"])t[r]&&(t[r]=t[r].join(", "));const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await Pu(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return Pu(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await Pu(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new rz(e)):null}fetchRelatedItems(t,e){return Pu(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},Pw)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return Pu(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>Pu(this.portal).signIn()).then(()=>{const e=t&&t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new ce("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new ce("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await Pu(e).signIn();const{copyResources:i,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!i,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new Pw({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")zg(e)?i.query={data:e}:i.query={url:Od(e)},E(r)&&(i.query.filename=r);else{const s=new FormData;E(r)?s.append("file",e,r):s.append("file",e),i.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new ce("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){return(await be(()=>import("./resourceUtils-c348014a.js"),[])).fetchResources(this,t,e)}async addResource(t,e,r){const i=await be(()=>import("./resourceUtils-c348014a.js"),[]);return t.portalItem=this,i.addOrUpdateResource(t,"add",e,r)}async removeResource(t,e){const r=await be(()=>import("./resourceUtils-c348014a.js"),[]);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new ce("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r.removeResource(this,t,e)}async removeAllResources(t){return(await be(()=>import("./resourceUtils-c348014a.js"),[])).removeAllResources(this,t)}resourceFromPath(t){return new HVe({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:Te(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Te(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Te(this.typeKeywords),url:this.url};return ibe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Pw({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([d({type:["private","shared","org","public"]})],pi.prototype,"access",void 0),u([d()],pi.prototype,"accessInformation",void 0),u([d({type:String})],pi.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],pi.prototype,"applicationProxies",void 0),u([d()],pi.prototype,"avgRating",void 0),u([d()],pi.prototype,"categories",void 0),u([d({type:Date})],pi.prototype,"created",void 0),u([d()],pi.prototype,"culture",void 0),u([d()],pi.prototype,"description",void 0),u([d({readOnly:!0})],pi.prototype,"displayName",null),u([d({type:Ki})],pi.prototype,"extent",void 0),u([ft("extent")],pi.prototype,"readExtent",null),u([d()],pi.prototype,"groupCategories",void 0),u([d({readOnly:!0})],pi.prototype,"iconUrl",null),u([d()],pi.prototype,"id",void 0),u([d({readOnly:!0})],pi.prototype,"isLayer",null),u([d({type:Boolean,readOnly:!0})],pi.prototype,"isOrgItem",void 0),u([d()],pi.prototype,"itemControl",void 0),u([d({readOnly:!0})],pi.prototype,"itemPageUrl",null),u([d({readOnly:!0})],pi.prototype,"itemUrl",null),u([d()],pi.prototype,"licenseInfo",void 0),u([d({type:Date})],pi.prototype,"modified",void 0),u([d()],pi.prototype,"name",void 0),u([d()],pi.prototype,"numComments",void 0),u([d()],pi.prototype,"numRatings",void 0),u([d()],pi.prototype,"numViews",void 0),u([d()],pi.prototype,"owner",void 0),u([d()],pi.prototype,"ownerFolder",void 0),u([d({type:zu})],pi.prototype,"portal",void 0),u([d()],pi.prototype,"screenshots",void 0),u([d()],pi.prototype,"size",void 0),u([d()],pi.prototype,"snippet",void 0),u([d()],pi.prototype,"sourceJSON",void 0),u([d({type:String})],pi.prototype,"sourceUrl",void 0),u([d({type:String})],pi.prototype,"spatialReference",void 0),u([d()],pi.prototype,"tags",void 0),u([d()],pi.prototype,"thumbnail",void 0),u([d({readOnly:!0})],pi.prototype,"thumbnailUrl",null),u([d()],pi.prototype,"title",void 0),u([d()],pi.prototype,"type",void 0),u([d()],pi.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(t,e){var r;if(WVe.has(e.type)){const i=(r=this.portal)==null?void 0:r.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],pi.prototype,"url",void 0),u([d({readOnly:!0})],pi.prototype,"userItemUrl",null),pi=Pw=u([j("esri.portal.PortalItem")],pi);const SI=pi,Xwe=Object.freeze(Object.defineProperty({__proto__:null,default:SI},Symbol.toStringTag,{value:"Module"})),yce=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,YVe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function _ce(t){return YVe[t]??!1}const zO=[],jC=new Map;function vce(t){for(const e of jC.keys())Zwe(t.pattern,e)&&jC.delete(e)}function QVe(t){return zO.includes(t)||(vce(t),zO.unshift(t)),{remove(){const e=zO.indexOf(t);e>-1&&(zO.splice(e,1),vce(t))}}}async function kte(t){const e=Yc();jC.has(t)||jC.set(t,ZVe(t,e));const r=jC.get(t);return r&&await JVe.add(r),r}function XVe(t){if(!yce.test(t))return null;const e=yce.exec(t);if(e===null)return null;const[,r,i]=e,s=r+(i?"-"+i.toUpperCase():"");return _ce(s)?s:_ce(r)?r:null}async function ZVe(t,e){const r=[];for(const i of zO)if(Zwe(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(s){r.push(s)}throw r.length?new ce("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new ce("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function Zwe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}Nte(()=>{jC.clear()});const JVe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Qv())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function KVe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,r=await kte("esri/t9n/basemaps");return r[t]||r[e]}const LW={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return Zi("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Zi("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Zi("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Zi("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return Zi("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Zi("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Zi("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Zi("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return Zi("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Zi("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Zi("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Zi("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Zi("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Zi("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Zi("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Zi("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Zi("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Zi("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Zi("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Zi("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Zi("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Zi("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Zi("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Zi("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Zi("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Zi("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Zi("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};function EI(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function I3(t){return t!=null&&"type"in t&&t.type==="group"}const eNt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function Jwe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function bce(t){return(t==null?void 0:t.type)==="voxel"}function wce(t){return(t==null?void 0:t.type)==="imagery-tile"}function Kwe(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function Bte(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function tNt(t){var e;return(t==null?void 0:t.type)==="feature"&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function eze(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function e2e(t,e){const r=Os==null?void 0:Os.findServerInfo(t);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const s=`${t.substring(0,i)}/rest/info`,n=E(e)?e.signal:null,{data:o}=await Ys(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function tze(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function t2e(t){return tze(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function rze(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function ize(t){return!!rze(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const sze=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),nze=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function oze(t){return t.layerContainerType==="basemap"?sze:t.layerContainerType==="operational-layers"?nze:null}function aze(t,e){if(e.restrictedWebMapWriting){const r=oze(e);return!E(r)||r.has(t.type)&&!Bte(t)}return!0}function lze(t,e){if(e)if(Bte(t)){const r=sL("featureCollection.layers",e),i=r&&r[0]&&r[0].layerDefinition;i&&iz(t,i)}else t.type==="stream"?iz(t,e.layerDefinition=e.layerDefinition||{}):t.type!=="group"&&iz(t,e)}function iz(t,e){"maxScale"in t&&(e.maxScale=mk(t.maxScale)??void 0),"minScale"in t&&(e.minScale=mk(t.minScale)??void 0)}function cze(t,e){if(lze(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=mk(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(Bte(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function xce(t,e,r){if(!("write"in t)||!t.write)return r&&r.messages&&r.messages.push(new ce("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(aze(t,r)){const i={};return t.write(i,r)?i:null}return E(e)&&cze(t,e=Te(e)),e}var GF;let uze=0;const r2e="esri.Basemap";let mp=GF=class extends aL(Ly){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+uze++,this.baseLayers=new or,this.referenceLayers=new or;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&we.getLogger(this.declaredClass).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(t=>{we.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var r;const t=this.baseLayers.removeAll();for(const i of t)i.destroy();const e=this.referenceLayers.removeAll();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(r=this.portalItem)==null||r.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",Lx(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=xce(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);E(n)&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=xce(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);E(n)&&(s.type!=="scene"&&(n.isReference=!0),i.push(n))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",Lx(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return hwe(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(t.loadStatus="loaded"),new GF({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=Te(r);return i.url&&Ig(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&Ig(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r}=this;di(t);const i=[];if(e){const s=e.context?e.context.url:null;if(i.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const n=e.data.id;i.push(KVe(n).then(o=>{o&&this.read({title:o},e.context)}))}}else r&&i.push(this._loadFromItem(r,t));await Promise.all(i)}async _loadLayersFromJSON(t,e,r){const i=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||i&&i.portal||null,n=i&&i.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await be(()=>import("./layersCreator-597dbcd3.js"),["assets/layersCreator-597dbcd3.js","assets/lazyLayerLoader-83bcb9ea.js","assets/portalLayers-75a427ce.js","assets/layersLoader-56a70219.js","assets/fetchService-8fe88712.js","assets/jsonContext-94bb4053.js"]),a=[];if(di(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=A=>n==="web-scene"&&A.layerType==="ArcGISSceneServiceLayer"||A.isReference,h=o(this.baseLayers,t.baseMapLayers.filter(A=>!c(A)),l);a.push(h);const p=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(p)}await Vu(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),s=eu(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:t.type==="Web Scene"?"web-scene":"web-map",portal:t.portal||zu.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||zu.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=LW[t];if(e){if(e.deprecated){let r=null;t==="dark-gray"?r="dark-gray-vector":t==="gray"?r="gray-vector":t==="streets"?r="streets-vector":t==="topo"&&(r="topo-vector"),Sbe(we.getLogger(r2e),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return GF.fromJSON(e)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:or}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],mp.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],mp.prototype,"id",void 0),u([d({type:SI})],mp.prototype,"portalItem",void 0),u([d()],mp.prototype,"referenceLayers",null),u([d({readOnly:!0})],mp.prototype,"resourceInfo",void 0),u([d({type:xt})],mp.prototype,"spatialReference",void 0),u([d()],mp.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],mp.prototype,"title",void 0),u([St("title")],mp.prototype,"writeTitle",null),mp=GF=u([j(r2e)],mp);const xk=mp,hze=Object.freeze(Object.defineProperty({__proto__:null,default:xk},Symbol.toStringTag,{value:"Module"})),Tk={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function i2e(t){return Tk[t]||Tk[t.toLowerCase()]}function Ute(t){return Tk[t]??Tk[t.toLowerCase()]}function dze(t){return[...Ute(t)]}function sz(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function s2e(t,e,r,i=1){const s=(t%360+360)%360/360,n=r<=.5?r*(e+1):r+e-r*e,o=2*r-n;return[Math.round(255*sz(o,n,s+1/3)),Math.round(255*sz(o,n,s)),Math.round(255*sz(o,n,s-1/3)),i]}function pze(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}function V(){return[0,0,0]}function In(t){return[t[0],t[1],t[2]]}function ct(t,e,r){return[t,e,r]}function Iu(t){const e=V(),r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Vte(t,e){return new Float64Array(t,e,3)}function n2e(){return V()}function o2e(){return ct(1,1,1)}function a2e(){return ct(1,0,0)}function l2e(){return ct(0,1,0)}function zte(){return ct(0,0,1)}const sc=n2e(),hg=o2e(),fze=a2e(),mze=l2e(),c2e=zte();Object.freeze(Object.defineProperty({__proto__:null,ONES:hg,UNIT_X:fze,UNIT_Y:mze,UNIT_Z:c2e,ZEROS:sc,clone:In,create:V,createView:Vte,fromArray:Iu,fromValues:ct,ones:o2e,unitX:a2e,unitY:l2e,unitZ:zte,zeros:n2e},Symbol.toStringTag,{value:"Module"}));let Gte=1e-6;function dc(){return Gte}function gze(t){Gte=t}const uL=Math.random,Aze=Math.PI/180,yze=180/Math.PI;function qB(t){return t*Aze}function _ze(t){return t*yze}function vze(t,e){return Math.abs(t-e)<=Gte*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:uL,equals:vze,getEpsilon:dc,setEpsilon:gze,toDegree:_ze,toRadian:qB},Symbol.toStringTag,{value:"Module"}));function st(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function Oe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function $e(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function ke(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Be(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function WB(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Sk(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function bze(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function u2e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function DW(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function h2e(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function d2e(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function wze(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function xze(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Me(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Q2(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function Is(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}function cl(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function Jl(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function nc(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Tze(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function qe(t,e){const r=e[0],i=e[1],s=e[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function He(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Xt(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];return t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o,t}function fo(t,e,r,i){const s=e[0],n=e[1],o=e[2];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t}function Sze(t,e,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return t[0]=e[0]*a+r[0]*l+i[0]*c+s[0]*h,t[1]=e[1]*a+r[1]*l+i[1]*c+s[1]*h,t[2]=e[2]*a+r[2]*l+i[2]*c+s[2]*h,t}function Eze(t,e,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,A=l*n;return t[0]=e[0]*c+r[0]*h+i[0]*p+s[0]*A,t[1]=e[1]*c+r[1]*h+i[1]*p+s[1]*A,t[2]=e[2]*c+r[2]*h+i[2]*p+s[2]*A,t}function Cze(t,e){e=e||1;const r=uL,i=2*r()*Math.PI,s=2*r()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=s*e,t}function Mt(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12],t[1]=r[1]*i+r[5]*s+r[9]*n+r[13],t[2]=r[2]*i+r[6]*s+r[10]*n+r[14],t}function Ph(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=i*r[0]+s*r[3]+n*r[6],t[1]=i*r[1]+s*r[4]+n*r[7],t[2]=i*r[2]+s*r[5]+n*r[8],t}function I0(t,e,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=e[0],l=e[1],c=e[2];let h=s*c-n*l,p=n*a-i*c,A=i*l-s*a,_=s*A-n*p,w=n*h-i*A,T=i*p-s*h;const C=2*o;return h*=C,p*=C,A*=C,_*=2,w*=2,T*=2,t[0]=a+h+_,t[1]=l+p+w,t[2]=c+A+T,t}function Mze(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function Rze(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function Oze(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function p2e(t,e){Oe(DD,t),Oe(ND,e),qe(DD,DD),qe(ND,ND);const r=He(DD,ND);return r>1?0:r<-1?Math.PI:Math.acos(r)}const DD=V(),ND=V();function Pze(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Hc(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Zv(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=dc();return Math.abs(r-n)<=l*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function Yy(t,e,r){const i=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Da=Be,Ize=WB,$ze=Sk,hL=Is,jte=cl,gh=st,NW=Jl,Tce=Object.freeze(Object.defineProperty({__proto__:null,abs:DW,add:ke,angle:p2e,bezier:Eze,ceil:bze,copy:Oe,cross:Xt,direction:Yy,dist:hL,distance:Is,div:$ze,divide:Sk,dot:He,equals:Zv,exactEquals:Hc,floor:u2e,hermite:Sze,inverse:Tze,len:gh,length:st,lerp:fo,max:wze,min:d2e,mul:Ize,multiply:WB,negate:nc,normalize:qe,random:Cze,rotateX:Mze,rotateY:Rze,rotateZ:Oze,round:xze,scale:Me,scaleAndAdd:Q2,set:$e,sign:h2e,sqrDist:jte,sqrLen:NW,squaredDistance:cl,squaredLength:Jl,str:Pze,sub:Da,subtract:Be,transformMat3:Ph,transformMat4:Mt,transformQuat:I0},Symbol.toStringTag,{value:"Module"}));function A0(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ns(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function Hte(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function f2e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function m2e(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function g2e(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Lze(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Dze(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Nze(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function Fze(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function kze(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function MM(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Bze(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function A2e(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function Ek(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return r*r+i*i+s*s+n*n}function qte(t){const e=t[0],r=t[1],i=t[2],s=t[3];return Math.sqrt(e*e+r*r+i*i+s*s)}function Wte(t){const e=t[0],r=t[1],i=t[2],s=t[3];return e*e+r*r+i*i+s*s}function Uze(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Vze(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function y2e(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=s*o,t[3]=n*o),t}function _2e(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function YB(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function zze(t,e){const r=uL;let i,s,n,o,a,l;e=e||1;do i=2*r()-1,s=2*r()-1,a=i*i+s*s;while(a>=1);do n=2*r()-1,o=2*r()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function Ld(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,t[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,t[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,t[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,t}function Gze(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2],c=r[3],h=c*i+a*n-l*s,p=c*s+l*i-o*n,A=c*n+o*s-a*i,_=-o*i-a*s-l*n;return t[0]=h*c+_*-o+p*-l-A*-a,t[1]=p*c+_*-a+A*-o-h*-l,t[2]=A*c+_*-l+h*-a-p*-o,t[3]=e[3],t}function jze(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function HC(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Yte(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=dc();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const Hze=f2e,qze=m2e,Wze=g2e,Yze=A2e,Qze=Ek,Xze=qte,Zze=Wte,v2e=Object.freeze(Object.defineProperty({__proto__:null,add:Hte,ceil:Lze,copy:A0,dist:Yze,distance:A2e,div:Wze,divide:g2e,dot:_2e,equals:Yte,exactEquals:HC,floor:Dze,inverse:Vze,len:Xze,length:qte,lerp:YB,max:Fze,min:Nze,mul:qze,multiply:m2e,negate:Uze,normalize:y2e,random:zze,round:kze,scale:MM,scaleAndAdd:Bze,set:ns,sqrDist:Qze,sqrLen:Zze,squaredDistance:Ek,squaredLength:Wte,str:jze,sub:Hze,subtract:f2e,transformMat4:Ld,transformQuat:Gze},Symbol.toStringTag,{value:"Module"})),Sce=new Float32Array(1);function $3(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function ze(t,e,r){return Math.min(Math.max(t,e),r)}function U0(t){return(t&t-1)==0}function rNt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function iNt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Sr(t,e,r){return t+(e-t)*r}function $r(t){return t*Math.PI/180}function Kc(t){return 180*t/Math.PI}function nz(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Zo(t){return Math.acos(ze(t,-1,1))}function rf(t){return Math.asin(ze(t,-1,1))}function qC(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const Ck=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function Jze(t){return Ck.setFloat64(0,t),Ck.getBigInt64(0)}function Kze(t){return Ck.setBigInt64(0,t),Ck.getFloat64(0)}const oz=BigInt("1000000");eGe(1);function eGe(t){const e=Jze(t=Math.abs(t)),r=Kze(e<=oz?oz:e-oz);return Math.abs(t-r)}function tGe(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function rGe(t){return b2e(Math.max(-FW,Math.min(t,FW)))}function b2e(t){return Sce[0]=t,Sce[0]}function L3(t,e,r){const i=ze((r-t)/(e-t),0,1);return i*i*(3-2*i)}function Ece(t,e){const r=st(t),i=rf(t[2]/r),s=Math.atan2(t[1]/r,t[0]/r);return $e(e,r,i,s),e}function sNt(t,e,r){return ns(t,e[0],e[1],e[2],e[3]*r)}function nNt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(qC(e,1)&&qC(r,1)&&qC(i,1))}const FW=b2e(34028234663852886e22);function FD(t){return ze(cte(t),0,255)}function kD(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}let jF=class jl{static blendColors(e,r,i,s=new jl){return s.r=Math.round(e.r+(r.r-e.r)*i),s.g=Math.round(e.g+(r.g-e.g)*i),s.b=Math.round(e.b+(r.b-e.b)*i),s.a=e.a+(r.a-e.a)*i,s._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),jl.fromArray(a,r)}return jl.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return jl.fromArray(s2e(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(e,r=new jl){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const i=e.length===4?4:8,s=(1<<i)-1;let n=+("0x"+e.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(e,r=new jl){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=i2e(e)?Ute(e):null;return i&&jl.fromArray(i,r)||jl.fromRgb(e,r)||jl.fromHex(e,r)}static fromJSON(e){return e&&new jl([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return E(e)?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return E(e)?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?jl.fromString(e,this):Array.isArray(e)?jl.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof jl||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=jl.AlphaMode.ALWAYS){const r=FD(this.r),i=FD(this.g),s=FD(this.b);return e===jl.AlphaMode.ALWAYS||this.a!==1?[r,i,s,FD(255*this.a)]:[r,i,s]}clone(){return new jl(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return E(e)&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(kD(this.r,0,255)),this.g=Math.round(kD(this.g,0,255)),this.b=Math.round(kD(this.b,0,255)),this.a=kD(this.a,0,1),this}_set(e,r,i,s){this.r=e,this.g=r,this.b=i,this.a=s}};jF.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(jF||(jF={}));const Ot=jF;function oNt(t){}function iGe(t){return()=>t}function er(t,e={}){const r=t instanceof Ui?t:new Ui(t,e),i={type:(e==null?void 0:e.ignoreUnknown)??1?r.apiValues:String,json:{type:r.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(i.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(i.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(i.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(i.nonNullable=e.nonNullable),d(i)}var kW;let HF=kW=class extends Qe{constructor(t){super(t),this.type="none"}clone(){return new kW({type:this.type})}};u([er({none:"none",stayAbove:"stay-above"})],HF.prototype,"type",void 0),HF=kW=u([j("esri.ground.NavigationConstraint")],HF);let zn=class extends Ke{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};u([d()],zn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],zn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],zn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],zn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],zn.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],zn.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],zn.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],zn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],zn.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],zn.prototype,"SHOW_POI",void 0),u([d()],zn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],zn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],zn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],zn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],zn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],zn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],zn.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],zn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],zn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],zn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],zn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],zn.prototype,"LINE_WIREFRAMES",void 0),u([d()],zn.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),zn=u([j("esri.views.3d.support.DebugFlags")],zn);const Qi=new zn;function QB(t){const e=cte(100*(1-t));return Math.max(0,Math.min(e,100))}function U$(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var BW;let Em=BW=class extends aL(Ly){constructor(t){super(t),this.opacity=1,this.shading=!Qi.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new or;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&we.getLogger(this.declaredClass).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(t=>{we.getLogger(this.declaredClass).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",Lx(t,this._get("layers")))}writeLayers(t,e,r,i){const s=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};iGe(n)().write(o,i)&&s.push(o)}else i&&i.messages&&i.messages.push(new ce("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return hwe(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await be(()=>import("./ElevationQuery-1f101113.js"),[]);di(e);const i=new r,s=this.layers.filter(Cce).toArray();return i.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await be(()=>import("./ElevationQuery-1f101113.js"),[]);di(e);const i=new r,s=this.layers.filter(Cce).toArray();return i.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:Te(this.surfaceColor),navigationConstraint:Te(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new BW({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,r){const i=e&&e.origin||"web-scene",s=e&&e.portal||null,n=e&&e.url||null;return be(()=>import("./layersCreator-597dbcd3.js"),["assets/layersCreator-597dbcd3.js","assets/lazyLayerLoader-83bcb9ea.js","assets/portalLayers-75a427ce.js","assets/layersLoader-56a70219.js","assets/fetchService-8fe88712.js","assets/jsonContext-94bb4053.js"]).then(({populateOperationalLayers:o})=>{di(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return Vu(a)}).then(()=>{})}};function sGe(t){return t&&"createElevationSampler"in t}function Cce(t){return t.type==="elevation"||sGe(t)}u([d({json:{read:!1}})],Em.prototype,"layers",null),u([St("layers")],Em.prototype,"writeLayers",null),u([d({readOnly:!0})],Em.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:rn,read:{reader:U$,source:"transparency"},write:{writer:(t,e)=>{e.transparency=QB(t)},target:"transparency"}}})],Em.prototype,"opacity",void 0),u([d({type:Boolean,nonNullable:!0,json:{read:!1}})],Em.prototype,"shading",void 0),u([d({type:Ot,json:{type:[rn],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Em.prototype,"surfaceColor",void 0),u([d({type:HF,json:{write:!0}})],Em.prototype,"navigationConstraint",void 0),Em=BW=u([j("esri.Ground")],Em);const Mk=Em;let JS=class extends or{constructor(e){super(e),this.getCollections=null}initialize(){this.own(Lbe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=E(this.getCollections)?this.getCollections():null;if(N(e))return void this.removeAll();let r=0;for(const i of e)E(i)&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new or(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction?this.itemFilterFunction:s=>!!s;for(const s of r)if(s){if(i(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};u([d()],JS.prototype,"getCollections",void 0),u([d()],JS.prototype,"getChildrenFunction",void 0),u([d()],JS.prototype,"itemFilterFunction",void 0),JS=u([j("esri.core.CollectionFlattener")],JS);const V$=JS;function nGe(t){var e,r;return!(!(t!=null&&t.loaded)||!((r=(e=t2e(t))==null?void 0:e.operations)!=null&&r.supportsEditing)||"editingEnabled"in t&&!ize(t))}const Mce=we.getLogger("esri.support.basemapUtils");function oGe(){return{}}function aGe(t){for(const e in t){const r=t[e];(r==null?void 0:r.destroyed)===!1&&r.destroy(),delete t[e]}}function lGe(t,e){let r;if(typeof t=="string"){if(!(t in LW)){const i=Object.entries(LW).filter(([s,n])=>ls.apiKey&&!n.classic||!ls.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return Mce.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${i}`),null}e&&(r=e[t]),r||(r=xk.fromId(t),e&&(e[t]=r))}else r=Oo(xk,t);return r!=null&&r.destroyed&&(Mce.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function cGe(t){return new V$({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}const Rce={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function uGe(t){let e=null;if(typeof t=="string")if(t in Rce){const r=Rce[t];e=new Mk({resourceInfo:{data:{layers:[r]}}})}else we.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Oo(Mk,t);return e}function D3(t,e,r=!1){let{hasM:i,hasZ:s}=t;Array.isArray(e)?e.length!==4||i||s?e.length===3&&r&&!i?(s=!0,i=!1):e.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=i}var UW;function Oce(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function hGe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let a1=UW=class extends wb{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):hGe(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new Ki,r=this.hasZ,i=this.hasM,s=r?3:2,n=t[0],o=Oce(Math.min),a=Oce(Math.max);let l,c,h,p,[A,_]=n,[w,T]=n;for(let C=0,M=t.length;C<M;C++){const O=t[C],[$,L]=O;if(A=o(A,$),_=o(_,L),w=a(w,$),T=a(T,L),r&&O.length>2){const k=O[2];l=o(l,k),h=a(h,k)}if(i&&O.length>s){const k=O[s];c=o(c,k),p=a(p,k)}}return e.xmin=A,e.ymin=_,e.xmax=w,e.ymax=T,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=p):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=Te(this.points)}addPoint(t){return D3(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:Te(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new UW(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new Gt(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Gt(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(D3(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([d({readOnly:!0})],a1.prototype,"cache",null),u([d()],a1.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],a1.prototype,"points",void 0),u([St("points")],a1.prototype,"writePoints",null),a1=UW=u([j("esri.geometry.Multipoint")],a1),a1.prototype.toJSON.isDefaultToJSON=!0;const dL=a1;function Qte(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function w2e(t,e,r){const i=t[0]+r*(e[0]-t[0]),s=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,s,t[2]+r*(e[2]-t[2])]:[i,s]}function cNt(t,e,r,i){const[s,n]=e,[o,a]=r[i],[l,c]=r[i+1],h=l-o,p=c-a,A=h*h+p*p,_=(s-o)*h+(n-a)*p,w=Math.min(1,Math.max(0,_/A));return t[0]=o+h*w,t[1]=a+p*w,t}function uNt(t,e,r){const i=r.rings;let s,n,o=!1,a=1/0;for(let l=0;l<i.length;l++){const c=i[l];for(let h=0,p=c.length-1;h<c.length;p=h++)s=c[h],n=c[p],s[1]>e!=n[1]>e&&t<(n[0]-s[0])*(e-s[1])/(n[1]-s[1])+s[0]&&(o=!o),a=Math.min(a,dGe(t,e,s,n))}return a===0?0:(o?1:-1)*Math.sqrt(a)}function dGe(t,e,r,i){let s=r[0],n=r[1],o=i[0]-s,a=i[1]-n;if(o!==0||a!==0){const l=((t-s)*o+(e-n)*a)/(o*o+a*a);l>1?(s=i[0],n=i[1]):l>0&&(s+=o*l,n+=a*l)}return o=t-s,a=e-n,o*o+a*a}function pGe(t,e){return w2e(t,e,.5)}function x2e(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=Qte(t[i],t[i+1]);return r}function T2e(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let s=0;s<r-1;++s){const n=Qte(t[s],t[s+1]);if(e-i<n){const o=(e-i)/n;return w2e(t[s],t[s+1],o)}i+=n}return t[r-1]}function S2e(t,e,r){const i=t.length;let s=0,n=0,o=0;for(let a=0;a<i;a++){const l=t[a],c=t[(a+1)%i];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&e&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function fGe(t){const e=t.length;return e>2&&Iy(t[0],t[e-1])}function hNt(t){if("rings"in t)for(const e of t.rings)fGe(e)||e.push(e[0].slice())}function E2e(t){if(!t||t.length<3)return 0;let e=0;const r=t.length-1;for(let i=0;i<r;i++)e+=(t[i][0]-t[i+1][0])*(t[i][1]+t[i+1][1]);return e+=(t[r][0]-t[0][0])*(t[r][1]+t[0][1]),-.5*e}function dNt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function mGe(t){return t?Xte(t.rings,t.hasZ??!1):null}function Xte(t,e){if(!t||!t.length)return null;const r=[],i=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=gGe(t[n],e,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=t[0]&&t[0].length?AGe(t[0],e):null;if(!n)return null;r[0]=n[0],r[1]=n[1],e&&n.length>2&&(r[2]=n[2])}return r}function gGe(t,e,r){let i=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let A=0;A<t.length;A++){const _=t[A],w=t[(A+1)%t.length],[T,C,M]=_,O=T-l,$=C-c,[L,k,F]=w,G=L-l,z=k-c,Z=O*z-G*$;if(o+=Z,i+=(O+G)*Z,s+=($+z)*Z,e&&_.length>2&&w.length>2){const J=M-h,te=F-h,re=O*te-G*J;n+=(J+te)*re,a+=re}T<r[0]&&(r[0]=T),T>r[1]&&(r[1]=T),C<r[2]&&(r[2]=C),C>r[3]&&(r[3]=C),e&&(M<r[4]&&(r[4]=M),M>r[5]&&(r[5]=M))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[i/(6*o)+l,s/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(p[3]=(r[4]+r[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function AGe(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],p=t[l+1];if(h&&p){r[0]=h[0],r[1]=h[1],i[0]=p[0],i[1]=p[1],e&&h.length>2&&p.length>2&&(r[2]=h[2],i[2]=p[2]);const A=Qte(r,i);if(A){s+=A;const _=pGe(h,p);n+=A*_[0],o+=A*_[1],e&&_.length>2&&(a+=A*_[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}const yGe=1e-6;function pNt(t){if(!t||!t.rings)return null;const{rings:e}=t;let r=0;for(let n=0;n<e.length;n++)r+=E2e(e[n]);if(r<yGe)return Xte(e,!1);const i=[0,0],s=e[0][0];for(let n=0;n<e.length;n++)vGe(i,s,e[n]);return i[0]*=1/r,i[1]*=1/r,i[0]+=s[0],i[1]+=s[1],i}const _Ge=1/3;function vGe(t,e,r){if(!t||!r||r.length<3)return null;const i=r[0],s=[0,0],n=[r[1][0]-i[0],r[1][1]-i[1]];let o;for(let c=2;c<r.length;c++)s[0]=r[c][0]-i[0],s[1]=r[c][1]-i[1],o=.5*_Ge*(s[0]*n[1]-s[1]*n[0]),t[0]+=o*(n[0]+s[0]),t[1]+=o*(n[1]+s[1]),n[0]=s[0],n[1]=s[1];const a=E2e(r),l=[i[0],i[1]];return l[0]-=e[0],l[1]-=e[1],l[0]*=a,l[1]*=a,t[0]+=l[0],t[1]+=l[1],t}function C2e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function M2e(t){return t.points!==void 0}function R2e(t){return t.x!==void 0&&t.y!==void 0}function O2e(t){return t.paths!==void 0}function P2e(t){return t.rings!==void 0}function I2e(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const hv=I2e(Math.min),dv=I2e(Math.max);function fNt(t,e){return O2e(e)?N3(t,e.paths,!1,!1):P2e(e)?N3(t,e.rings,!1,!1):M2e(e)?Zte(t,e.points,!1,!1,!1,!1):C2e(e)?$2e(t,e):(R2e(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function mNt(t,e){return O2e(e)?N3(t,e.paths,!0,!1):P2e(e)?N3(t,e.rings,!0,!1):M2e(e)?Zte(t,e.points,!0,!1,!0,!1):C2e(e)?$2e(t,e,!0,!1,!0,!1):(R2e(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function N3(t,e,r,i){const s=r?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,h]=e[0][0],[p,A]=e[0][0];for(let _=0;_<e.length;_++){const w=e[_];for(let T=0;T<w.length;T++){const C=w[T],[M,O]=C;if(c=hv(c,M),h=hv(h,O),p=dv(p,M),A=dv(A,O),r&&C.length>2){const $=C[2];n=hv(n,$),o=dv(o,$)}if(i&&C.length>s){const $=C[s];a=hv(n,$),l=dv(o,$)}}}return r?i?(t[0]=c,t[1]=h,t[2]=n,t[3]=a,t[4]=p,t[5]=A,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=n,t[3]=p,t[4]=A,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=h,t[2]=a,t[3]=p,t[4]=A,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=p,t[3]=A,t.length=4,t)}function $2e(t,e,r,i,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,p=e.zmax,A=e.mmin,_=e.mmax;return s?(h=h||0,p=p||0,n?(A=A||0,_=_||0,t[0]=o,t[1]=l,t[2]=h,t[3]=A,t[4]=a,t[5]=c,t[6]=p,t[7]=_,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=p,t)):n?(A=A||0,_=_||0,t[0]=o,t[1]=l,t[2]=A,t[3]=a,t[4]=c,t[5]=_,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function Zte(t,e,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!e.length||!e[0].length)return null;let c,h,p,A,[_,w]=e[0],[T,C]=e[0];for(let M=0;M<e.length;M++){const O=e[M],[$,L]=O;if(_=hv(_,$),w=hv(w,L),T=dv(T,$),C=dv(C,L),l&&O.length>2){const k=O[2];c=hv(c,k),h=dv(h,k)}if(a&&O.length>o){const k=O[o];p=hv(c,k),A=dv(h,k)}}return s?(c=c||0,h=h||0,n?(p=p||0,A=A||0,t[0]=_,t[1]=w,t[2]=c,t[3]=p,t[4]=T,t[5]=C,t[6]=h,t[7]=A,t):(t[0]=_,t[1]=w,t[2]=c,t[3]=T,t[4]=C,t[5]=h,t)):n?(p=p||0,A=A||0,t[0]=_,t[1]=w,t[2]=p,t[3]=T,t[4]=C,t[5]=A,t):(t[0]=_,t[1]=w,t[2]=T,t[3]=C,t)}function bGe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function wGe(t){return t.points!==void 0}function xGe(t){return t.x!==void 0&&t.y!==void 0}function TGe(t){return t.paths!==void 0}function SGe(t){return t.rings!==void 0}const Jte=[];function L2e(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function D2e(t,e,r,i,s,n){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:s,zmax:n}}function N2e(t,e,r,i,s,n){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:s,mmax:n}}function F2e(t,e,r,i,s,n,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function Kte(t,e=!1,r=!1){return e?r?F2e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):D2e(t[0],t[1],t[2],t[3],t[4],t[5]):r?N2e(t[0],t[1],t[2],t[3],t[4],t[5]):L2e(t[0],t[1],t[2],t[3])}function gNt(t){return t?bGe(t)?t:xGe(t)?CGe(t):SGe(t)?k2e(t):TGe(t)?B2e(t):wGe(t)?EGe(t):null:null}function EGe(t){const{hasZ:e,hasM:r,points:i}=t;return Kte(Zte(Jte,i,e??!1,r??!1),e,r)}function CGe(t){const{x:e,y:r,z:i,m:s}=t,n=s!=null;return i!=null?n?F2e(e,r,i,s,e,r,i,s):D2e(e,r,i,e,r,i):n?N2e(e,r,s,e,r,s):L2e(e,r,e,r)}function k2e(t){const{hasZ:e,hasM:r,rings:i}=t,s=N3(Jte,i,e??!1,r??!1);return s?Kte(s,e,r):null}function B2e(t){const{hasZ:e,hasM:r,paths:i}=t,s=N3(Jte,i,e??!1,r??!1);return s?Kte(s,e,r):null}var qF;function Pce(t){return!Array.isArray(t[0])}let Cm=qF=class extends wb{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,s=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new qF(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings?t.rings:null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||xt.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=mGe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new Gt;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=k2e(this);if(!e)return null;const r=new Ki(e);return r.spatialReference=t,r}get isSelfIntersecting(){return $Ve(this.rings)}writeRings(t,e){e.rings=Te(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(Pce(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new qF;return t.spatialReference=this.spatialReference,t.rings=Te(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(N(t))return!1;const e=this.spatialReference,r=t.spatialReference;if(E(e)!==E(r)||E(e)&&E(r)&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!Iy(n,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=xb(t,this.spatialReference);return xVe(this,E(e)?e:t)}isClockwise(t){let e;return e=Pce(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,S2e(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new Gt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new Gt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new Gt(r[0],r[1],r[2],r[3],this.spatialReference):new Gt(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(D3(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new Gt(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new Gt(s,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(D3(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],Cm.prototype,"cache",null),u([d({readOnly:!0})],Cm.prototype,"centroid",null),u([d({readOnly:!0})],Cm.prototype,"extent",null),u([d({readOnly:!0})],Cm.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],Cm.prototype,"rings",void 0),u([St("rings")],Cm.prototype,"writeRings",null),Cm=qF=u([j("esri.geometry.Polygon")],Cm),Cm.prototype.toJSON.isDefaultToJSON=!0;const sf=Cm;var VW;function MGe(t){return!Array.isArray(t[0])}let l1=VW=class extends wb{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths?t.paths:null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||xt.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=B2e(this);if(!e)return null;const r=new Ki(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=Te(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(MGe(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new VW;return t.spatialReference=this.spatialReference,t.paths=Te(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new Gt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new Gt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new Gt(r[0],r[1],r[2],r[3],this.spatialReference):new Gt(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(D3(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new Gt(s,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new Gt(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(D3(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],l1.prototype,"cache",null),u([d({readOnly:!0})],l1.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],l1.prototype,"paths",void 0),u([St("paths")],l1.prototype,"writePaths",null),l1=VW=u([j("esri.geometry.Polyline")],l1),l1.prototype.toJSON.isDefaultToJSON=!0;const y0=l1,U2e=hc()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Ice=hc()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function V2e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function ere(t){return t.points!==void 0}function tre(t){return t.x!==void 0&&t.y!==void 0}function rre(t){return t.paths!==void 0}function hx(t){return t.rings!==void 0}function Ny(t){return N(t)?null:t instanceof wb?t:tre(t)?Gt.fromJSON(t):rre(t)?y0.fromJSON(t):hx(t)?sf.fromJSON(t):ere(t)?dL.fromJSON(t):V2e(t)?Ki.fromJSON(t):null}function RM(t){return t?tre(t)?"esriGeometryPoint":rre(t)?"esriGeometryPolyline":hx(t)?"esriGeometryPolygon":V2e(t)?"esriGeometryEnvelope":ere(t)?"esriGeometryMultipoint":null:null}const RGe={esriGeometryPoint:Gt,esriGeometryPolyline:y0,esriGeometryPolygon:sf,esriGeometryEnvelope:Ki,esriGeometryMultipoint:dL};function OGe(t){return t&&RGe[t]||null}const yT={base:wb,key:"type",typeMap:{extent:Ki,multipoint:dL,point:Gt,polyline:y0,polygon:sf}};k0(yT);let z2e=0;const pL=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+z2e++})}};return e=u([j("esri.core.Identifiable")],e),e},ANt=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:z2e++})}};return e=u([j("esri.core.NumericIdentifiable")],e),e};let $ce=class extends pL(class{}){};$ce=u([j("esri.core.Identifiable")],$ce);async function PGe(t){const e="portalItem"in t?t:{portalItem:t},r=await be(()=>import("./portalLayers-75a427ce.js"),["assets/portalLayers-75a427ce.js","assets/lazyLayerLoader-83bcb9ea.js","assets/layersLoader-56a70219.js","assets/fetchService-8fe88712.js","assets/jsonContext-94bb4053.js"]);try{return await r.fromItem(e)}catch(i){const s=e&&e.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||ls.portalUrl;throw we.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let IGe=0,Ha=class extends Nn.EventedMixin(pL(Ly)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Ki(-180,-90,180,90,xt.WGS84),this.id=Date.now().toString(16)+"-layer-"+IGe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=xt.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await be(()=>import("./arcgisLayers-052bd26c.js"),["assets/arcgisLayers-052bd26c.js","assets/fetchService-8fe88712.js","assets/lazyLayerLoader-83bcb9ea.js"])).fromUrl(r)}static fromPortalItem(e){return PGe(e)}initialize(){this.when().catch(e=>{vo(e)||we.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,r=this.parent;"layers"in r&&r.layers.includes(e)?r.layers.remove(e):"tables"in r&&r.tables.includes(e)?r.tables.remove(e):"baseLayers"in r&&r.baseLayers.includes(e)?r.baseLayers.remove(e):"baseLayers"in r&&r.referenceLayers.includes(e)&&r.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return eu(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Ys(e,{query:{f:"json"},responseType:"json"})).data;throw new ce("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],Ha.prototype,"attributionDataUrl",void 0),u([d({type:Ki})],Ha.prototype,"fullExtent",void 0),u([d({readOnly:!0})],Ha.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],Ha.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],Ha.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],Ha.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],Ha.prototype,"opacity",void 0),u([d({clonable:!1})],Ha.prototype,"parent",void 0),u([d({readOnly:!0})],Ha.prototype,"parsedUrl",null),u([d({type:Boolean})],Ha.prototype,"popupEnabled",void 0),u([d({type:Boolean})],Ha.prototype,"attributionVisible",void 0),u([d({type:xt})],Ha.prototype,"spatialReference",void 0),u([d({type:String})],Ha.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],Ha.prototype,"type",void 0),u([d()],Ha.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],Ha.prototype,"visible",void 0),Ha=u([j("esri.layers.Layer")],Ha);const z$=Ha;function zW(t,e,r){let i,s;if(t)for(let n=0,o=t.length;n<o;n++){if(i=t.getItemAt(n),i[e]===r)return i;if((i==null?void 0:i.type)==="group"&&(s=zW(i.layers,e,r),s))return s}}const $Ge=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new or;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||we.getLogger(this.declaredClass).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const r=this.layers.removeAll();for(const i of r)this.layerRemoved(i),i.destroy();this.layers.destroy()}set layers(r){this._set("layers",Lx(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof z$){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else Zd(r)?r.then(n=>{this.destroyed||this.add(n,i)}):we.getLogger(this.declaredClass).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;let n=s.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(r){return zW(this.layers,"id",r)}findLayerByUid(r){return zW(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return u([d()],e.prototype,"layers",null),e=u([j("esri.support.LayersMixin")],e),e};function GW(t,e,r){if(t)for(let i=0,s=t.length;i<s;i++){const n=t.getItemAt(i);if(n[e]===r)return n;if((n==null?void 0:n.type)==="group"){const o=GW(n.tables,e,r);if(o)return o}}}const LGe=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new or,this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&we.getLogger(this.declaredClass).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",Lx(r,this._get("tables")))}findTableById(r){return GW(this.tables,"id",r)}findTableByUid(r){return GW(this.tables,"uid",r)}};return u([d()],e.prototype,"tables",null),e=u([j("esri.support.TablesMixin")],e),e};let Mm=class extends LGe($Ge(Nn.EventedMixin(Ke))){constructor(e){super(e),this.allLayers=new V$({getCollections:()=>{var r,i,s;return[(r=this.basemap)==null?void 0:r.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=cGe(this),this.basemap=null,this.editableLayers=new V$({getCollections:()=>[this.allLayers],itemFilterFunction:nGe}),this.ground=new Mk,this._basemapCache=oGe()}destroy(){var e,r;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(r=this.basemap)==null||r.destroy(),aGe(this._basemapCache),this._basemapCache=null}castBasemap(e){return lGe(e,this._basemapCache)}castGround(e){const r=uGe(e);return N(r)?this._get("ground"):r}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};u([d({readOnly:!0,dependsOn:[]})],Mm.prototype,"allLayers",void 0),u([d({readOnly:!0})],Mm.prototype,"allTables",void 0),u([d({type:xk})],Mm.prototype,"basemap",void 0),u([Hr("basemap")],Mm.prototype,"castBasemap",null),u([d({readOnly:!0})],Mm.prototype,"editableLayers",void 0),u([d({type:Mk,nonNullable:!0})],Mm.prototype,"ground",void 0),u([Hr("ground")],Mm.prototype,"castGround",null),Mm=u([j("esri.Map")],Mm);const G2e=Mm,Fn=t=>{let e=class extends t{clone(){var l;const r=Pu(Zc(this),"unable to clone instance of non-accessor class"),i=r.metadatas,s=r.store,n={},o=new Map;for(const c in i){const h=i[c],p=s==null?void 0:s.originOf(c),A=h.clonable;if(h.readOnly||A===!1||p!==qi.USER&&p!==qi.DEFAULTS&&p!==qi.WEB_MAP&&p!==qi.WEB_SCENE)continue;const _=this[c];let w=null;w=typeof A=="function"?A(_):A==="reference"?_:rW(_),_!=null&&w==null||(p===qi.DEFAULTS?o.set(c,w):n[c]=w)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=Zc(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,qi.DEFAULTS)}return a}};return e=u([j("esri.core.Clonable")],e),e};let Lce=class extends Fn(Ke){};Lce=u([j("esri.core.Clonable")],Lce);let Jv=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,s=0,n=!1){return(i-=s)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=e),i+s}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return ze(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,s=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(s)?i:s}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function ire(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const DGe=ire(new Jv(0,2*Math.PI)),Kv=ire(new Jv(-Math.PI,Math.PI)),sre=ire(new Jv(0,360));let TA=class extends Fn(Qe){constructor(...e){super(...e),this.position=new Gt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,r,i,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return r!=null&&(n.heading=r),i!=null&&(n.tilt=i),s!=null&&(n.fov=s),n}return e}writePosition(e,r,i,s){const n=e.clone();n.x=Dp(e.x||0),n.y=Dp(e.y||0),n.z=e.hasZ?Dp(e.z||0):e.z,r[i]=n.write({},s)}readPosition(e,r){const i=new Gt;return i.read(e,r),i.x=Dp(i.x||0),i.y=Dp(i.y||0),i.z=i.hasZ?Dp(i.z||0):i.z,i}equals(e){return!N(e)&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:Gt,json:{write:{isRequired:!0}}})],TA.prototype,"position",void 0),u([St("position")],TA.prototype,"writePosition",null),u([ft("position")],TA.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Hr(t=>sre.normalize(Dp(t)))],TA.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Hr(t=>ze(Dp(t),-180,180))],TA.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],TA.prototype,"fov",void 0),TA=u([j("esri.Camera")],TA);const nf=TA;var F3;function NGe(t,e){switch(t.type){case"range":{const r="range"in t?t.range[0]:t.minValue,i="range"in t?t.range[1]:t.maxValue;if(r!=null&&+e<r||i!=null&&+e>i)return F3.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==e))return F3.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(F3||(F3={}));const FGe=we.getLogger("esri.support.arcadeOnDemand");let az;function $g(){return az||(az=(async()=>{const t=await be(()=>import("./arcadeUtils-446895c5.js").then(e=>e.ax),["assets/arcadeUtils-446895c5.js","assets/arcadeTimeUtils-e24bc4a7.js","assets/executionError-fb3f283a.js","assets/hash-0ddfbf4b.js"]);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),az}const kGe=(t,e,r)=>nre.create(t,e,r,null,["$feature"]),BGe=(t,e,r)=>nre.create(t,e,r,null,["$feature","$view"]),UGe=(t,e,r,i)=>nre.create(t,e,r,i,["$feature","$view"]);let nre=class j2e{constructor(e,r,i,s,n,o,a){this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await $g(),h=xt.fromJSON(r);let p;try{p=a.parseScript(e,o)}catch(z){return FGe.error(new ce("arcade-bad-expression","Failed to parse arcade script",{script:e,error:z})),null}const A=n.reduce((z,Z)=>({...z,[Z]:null}),{});let _=null;E(s)&&(_=new c(s),_.immutable=!0,A.$config=null);const w=a.scriptUsesGeometryEngine(p),T=w&&a.enableGeometrySupport(),C=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),M=a.scriptIsAsync(p),O=M&&a.enableAsyncSupport(),$={vars:A,spatialReference:h,useAsync:!!O};await Promise.all([T,C,O]);const L=new Set;await a.loadDependentModules(L,p,null,M,w);const k=new c;k.immutable=!1,k.setField("scale",0);const F=a.compileScript(p,$),G=z=>("$view"in z&&z.$view&&(k.setField("scale",typeof z.$view=="object"?z.$view.scale:void 0),z.$view=k),_&&(z.$config=_),F({vars:z,spatialReference:h}));return new j2e(e,a,p,G,new l,i,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const VGe=/^([0-9])/,zGe=/[^a-z0-9_\u0080-\uffff]/gi,GGe=/_{2,}/g,jGe=/^_/,HGe=/_$/;function qGe(t){return t==null?null:t.trim().replace(zGe,"_").replace(GGe,"_").replace(jGe,"").replace(HGe,"").replace(VGe,"F$1")||null}const WGe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],YGe=["field","normalizationField"];function Dce(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(Nce(WGe,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)Nce(YGe,i,e)}}function Nce(t,e,r){if(t)for(const i of t){const s=sL(i,e),n=s&&typeof s!="function"&&r.get(s);n&&Jc(i,n.name,e)}}function H2e(t,e){var r;if(t!=null&&((r=e==null?void 0:e.fields)!=null&&r.length))if("startField"in t){const i=e.get(t.startField),s=e.get(t.endField);t.startField=(i==null?void 0:i.name)??null,t.endField=(s==null?void 0:s.name)??null}else{const i=e.get(t.startTimeField),s=e.get(t.endTimeField);t.startTimeField=(i==null?void 0:i.name)??null,t.endTimeField=(s==null?void 0:s.name)??null}}const lz=new Set;function q2e(t,e){return t&&e?(lz.clear(),G$(lz,t,e),Array.from(lz).sort()):[]}function G$(t,e,r){var i;if(r)if((i=e==null?void 0:e.fields)!=null&&i.length)if(r.includes("*"))for(const{name:s}of e.fields)t.add(s);else for(const s of r)kd(t,e,s);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const s of r)s!=null&&t.add(s)}}function kd(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function TNt(t,e){return N(e)||N(t)?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function Gu(t,e,r){var n;if(!r)return;const{arcadeUtils:i}=await $g(),s=i.extractFieldNames(r,(n=e==null?void 0:e.fields)==null?void 0:n.map(o=>o.name));for(const o of s)kd(t,e,o)}async function W2e(t,e,r){if(r&&r!=="1=1"){const i=(await be(()=>import("./WhereClause-dd0f9833.js").then(s=>s.W),["assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js"])).WhereClause.create(r,e);if(!i.isStandardized)throw new ce("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});G$(t,e,i.fieldNames)}}function QGe({displayField:t,fields:e}){return t||(e&&e.length?cz(e,"name-or-title")||cz(e,"unique-identifier")||cz(e,"type-or-category")||XGe(e):null)}function XGe(t){for(const e of t){if(!e||!e.name)continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function cz(t,e){for(const r of t)if(r&&r.valueType&&r.valueType===e)return r.name;return null}async function SNt(t,e){var i;if(!e)return;const r=(i=e.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function ZGe(t,e,r){r.onStatisticExpression?Gu(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function ENt(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],s=r.popupTemplate;i.push(JGe(t,e,s)),r.fields&&i.push(...r.fields.map(async n=>ZGe(t,e.fieldsIndex,n))),await Promise.all(i)}async function JGe(t,e,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(n=>Gu(t,e.fieldsIndex,n.expression)));const s=r==null?void 0:r.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&i.push(Gu(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(i)}async function CNt(t,e,r){e&&(e.timeInfo&&E(r)&&r.timeExtent&&G$(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&G$(t,e.fieldsIndex,[e.floorInfo.floorField]),E(r)&&E(r.where)&&await W2e(t,e.fieldsIndex,r.where))}async function MNt(t,e,r){e&&r&&await Promise.all(r.map(i=>KGe(t,e,i)))}async function KGe(t,e,r){e&&r&&(r.valueExpression?await Gu(t,e.fieldsIndex,r.valueExpression):r.field&&kd(t,e.fieldsIndex,r.field))}function RNt(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;return e?q2e(t.fieldsIndex,[e&&e.creatorField,e&&e.creationDateField,e&&e.editorField,e&&e.editDateField]):[]}async function ONt(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r&&r.length&&await Promise.all(r.map(s=>eje(t,i,s)))}async function eje(t,e,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await Gu(t,e,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{kd(t,e,o.slice(1,-1))})}await W2e(t,e,s)}function tje(t){const e=t.defaultValue;return e!==void 0&&X2e(t,e)?e:t.nullable?null:void 0}function Y2e(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function rje(t){return t===null||Y2e(t)}const ore="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function ije(t){return t===null||ore(t)}function Q2e(t){return t!=null&&typeof t=="string"}function sje(t){return t===null||Q2e(t)}function nje(){return!0}function X2e(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=t.nullable?ije:ore;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?rje:Y2e;break;case"string":case"esriFieldTypeString":r=t.nullable?sje:Q2e;break;default:r=nje}return arguments.length===1?r:r(e)}const oje=["integer","small-integer","single","double"],aje=new Set([...oje,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function XB(t){return t!=null&&aje.has(t.type)}function PNt(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}var Rk,Ok;function INt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function $Nt(t,e){return t==null||t.nullable&&e===null?null:XB(t)&&!lje(t.type,Number(e))?Rk.OUT_OF_RANGE:X2e(t,e)?t.domain?NGe(t.domain,e):null:Ok.INVALID_TYPE}function lje(t,e){const r=typeof t=="string"?Z2e(t):t;if(!r)return!1;const i=r.min,s=r.max;return r.isInteger?ore(e)&&e>=i&&e<=s:e>=i&&e<=s}function Z2e(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return cje;case"esriFieldTypeInteger":case"integer":return uje;case"esriFieldTypeSingle":case"single":return hje;case"esriFieldTypeDouble":case"double":return dje}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(Rk||(Rk={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(Ok||(Ok={}));const cje={min:-32768,max:32767,isInteger:!0},uje={min:-2147483648,max:2147483647,isInteger:!0},hje={min:-34e37,max:12e37,isInteger:!1},dje={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function LNt(t,e,r){switch(t){case F3.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case F3.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case Ok.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case Rk.OUT_OF_RANGE:{const{min:i,max:s}=Z2e(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${s}`}}}function pje(t,e){return!fje(t,e,null)}function fje(t,e,r){if(!e||!e.attributes||!t){if(E(r))for(const n of t??[])r.add(n);return!0}const i=e.attributes;let s=!1;for(const n of t)if(!(n in i)){if(s=!0,!E(r))break;r.add(n)}return s}function J2e(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let WF=class extends Qe{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],WF.prototype,"type",void 0),WF=u([j("esri.popup.content.Content")],WF);const Tb=WF;var jW;let Iw=jW=class extends Tb{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new jW({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],Iw.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],Iw.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],Iw.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Iw.prototype,"type",void 0),Iw=jW=u([j("esri.popup.content.AttachmentsContent")],Iw);const j$=Iw;var HW;let $w=HW=class extends Tb{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new HW({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?Te(this.outFields):null})}};u([d()],$w.prototype,"creator",void 0),u([d()],$w.prototype,"destroyer",void 0),u([d()],$w.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],$w.prototype,"type",void 0),$w=HW=u([j("esri.popup.content.CustomContent")],$w);const mje=$w;var qW;let KS=qW=class extends Qe{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new qW({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],KS.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],KS.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],KS.prototype,"returnType",void 0),KS=qW=u([j("esri.popup.ElementExpressionInfo")],KS);const K2e=KS;var WW;let GO=WW=class extends Tb{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new WW({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};u([d({type:K2e,json:{write:!0}})],GO.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],GO.prototype,"type",void 0),GO=WW=u([j("esri.popup.content.ExpressionContent")],GO);const are=GO,H$=hc()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});H$.toJSON.bind(H$);H$.fromJSON.bind(H$);const nm={year:"numeric",month:"numeric",day:"numeric"},ER={year:"numeric",month:"long",day:"numeric"},CR={year:"numeric",month:"short",day:"numeric"},MR={year:"numeric",month:"long",weekday:"long",day:"numeric"},gp={hour:"numeric",minute:"numeric"},wf={...gp,second:"numeric"},lre={"short-date":nm,"short-date-short-time":{...nm,...gp},"short-date-short-time-24":{...nm,...gp,hour12:!1},"short-date-long-time":{...nm,...wf},"short-date-long-time-24":{...nm,...wf,hour12:!1},"short-date-le":nm,"short-date-le-short-time":{...nm,...gp},"short-date-le-short-time-24":{...nm,...gp,hour12:!1},"short-date-le-long-time":{...nm,...wf},"short-date-le-long-time-24":{...nm,...wf,hour12:!1},"long-month-day-year":ER,"long-month-day-year-short-time":{...ER,...gp},"long-month-day-year-short-time-24":{...ER,...gp,hour12:!1},"long-month-day-year-long-time":{...ER,...wf},"long-month-day-year-long-time-24":{...ER,...wf,hour12:!1},"day-short-month-year":CR,"day-short-month-year-short-time":{...CR,...gp},"day-short-month-year-short-time-24":{...CR,...gp,hour12:!1},"day-short-month-year-long-time":{...CR,...wf},"day-short-month-year-long-time-24":{...CR,...wf,hour12:!1},"long-date":MR,"long-date-short-time":{...MR,...gp},"long-date-short-time-24":{...MR,...gp,hour12:!1},"long-date-long-time":{...MR,...wf},"long-date-long-time-24":{...MR,...wf,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":gp,"long-time":wf},q$=hc()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});q$.apiValues;q$.toJSON.bind(q$);q$.fromJSON.bind(q$);const gje={ar:"ar-u-nu-latn-ca-gregory"};let YW=new WeakMap,exe=lre["short-date-short-time"];function Aje(t){const e=t||exe;let r=YW.get(e);if(!r){const i=Yc(),s=gje[Yc()]||i;r=new Intl.DateTimeFormat(s,e),YW.set(e,r)}return r}function ZB(t){return t?lre[t]:null}function Lg(t,e){return Aje(e).format(t)}Nte(()=>{YW=new WeakMap,exe=lre["short-date-short-time"]});const yje={ar:"ar-u-nu-latn"};let YF=new WeakMap,txe={};function _je(t){const e=t||txe;if(!YF.has(e)){const r=Yc(),i=yje[Yc()]||r;YF.set(e,new Intl.NumberFormat(i,t))}return YF.get(e)}function rxe(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function Dg(t,e){return t===-0&&(t=0),_je(e).format(t)}Nte(()=>{YF=new WeakMap,txe={}});var QW;let Lw=QW=class extends Qe{constructor(t){super(t),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new QW({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(t){return this.dateFormat?Lg(t,{...ZB(this.dateFormat),...this.dateTimeFormatOptions}):Dg(t,rxe(this))}formatRasterPixelValue(t){if(t.includes("-"))return t;let e,r;return t.trim().includes(",")?(e=",",r=e+" ",this._formatDelimitedString(t,e,r,this)):t.trim().includes(";")?(e=";",r=e+" ",this._formatDelimitedString(t,e,r,this)):t.trim().includes(" ")?(e=r=" ",this._formatDelimitedString(t,e,r,this)):this.format(Number(t))}_formatDelimitedString(t,e,r,i){return t&&e&&r&&i?t.trim().split(e).map(s=>this.format(Number(s))).join(r):t}};u([er(H$)],Lw.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],Lw.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],Lw.prototype,"digitSeparator",void 0),u([d({type:rn,json:{write:!0}})],Lw.prototype,"places",void 0),Lw=QW=u([j("esri.popup.support.FieldInfoFormat")],Lw);const pC=Lw;var XW;let $f=XW=class extends Qe{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new XW({fieldName:this.fieldName,format:this.format?Te(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],$f.prototype,"fieldName",void 0),u([d({type:pC,json:{write:!0}})],$f.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],$f.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],$f.prototype,"label",void 0),u([er(new Ui({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],$f.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],$f.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],$f.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],$f.prototype,"visible",void 0),$f=XW=u([j("esri.popup.FieldInfo")],$f);const fL=$f;var ZW;let SA=ZW=class extends Tb{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new ZW(Te({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],SA.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],SA.prototype,"description",void 0),u([d({type:[fL]})],SA.prototype,"fieldInfos",void 0),u([St("fieldInfos")],SA.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],SA.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],SA.prototype,"type",void 0),SA=ZW=u([j("esri.popup.content.FieldsContent")],SA);const k3=SA;let Dw=class extends Qe{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],Dw.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],Dw.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],Dw.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Dw.prototype,"type",void 0),Dw=u([j("esri.popup.content.mixins.MediaInfo")],Dw);const cre=Dw;var JW;let eE=JW=class extends Ke{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new JW({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],eE.prototype,"fieldName",void 0),u([d()],eE.prototype,"tooltip",void 0),u([d()],eE.prototype,"value",void 0),eE=JW=u([j("esri.popup.content.support.ChartMediaInfoValueSeries")],eE);const ixe=eE;var KW;let Nw=KW=class extends Qe{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new KW({fields:Te(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],Nw.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],Nw.prototype,"normalizeField",void 0),u([d({type:[ixe],json:{read:!1}})],Nw.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],Nw.prototype,"tooltipField",void 0),Nw=KW=u([j("esri.popup.content.support.ChartMediaInfoValue")],Nw);const vje=Nw;let jO=class extends cre{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],jO.prototype,"type",void 0),u([d({type:vje,json:{write:!0}})],jO.prototype,"value",void 0),jO=u([j("esri.popup.content.mixins.ChartMediaInfo")],jO);const JB=jO,KB=hc()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var eY;let QF=eY=class extends JB{constructor(t){super(t),this.type="bar-chart"}clone(){return new eY({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:KB.write}})],QF.prototype,"type",void 0),QF=eY=u([j("esri.popup.content.BarChartMediaInfo")],QF);const sxe=QF;var tY;let XF=tY=class extends JB{constructor(t){super(t),this.type="column-chart"}clone(){return new tY({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:KB.write}})],XF.prototype,"type",void 0),XF=tY=u([j("esri.popup.content.ColumnChartMediaInfo")],XF);const nxe=XF;var rY;let HO=rY=class extends Qe{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new rY({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],HO.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],HO.prototype,"sourceURL",void 0),HO=rY=u([j("esri.popup.content.support.ImageMediaInfoValue")],HO);const bje=HO;var iY;let tE=iY=class extends cre{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new iY({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],tE.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],tE.prototype,"type",void 0),u([d({type:bje,json:{write:!0}})],tE.prototype,"value",void 0),tE=iY=u([j("esri.popup.content.ImageMediaInfo")],tE);const oxe=tE;var sY;let ZF=sY=class extends JB{constructor(t){super(t),this.type="line-chart"}clone(){return new sY({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:KB.write}})],ZF.prototype,"type",void 0),ZF=sY=u([j("esri.popup.content.LineChartMediaInfo")],ZF);const axe=ZF;var nY;let JF=nY=class extends JB{constructor(t){super(t),this.type="pie-chart"}clone(){return new nY({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:KB.write}})],JF.prototype,"type",void 0),JF=nY=u([j("esri.popup.content.PieChartMediaInfo")],JF);const lxe=JF,cxe={base:cre,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":sxe,"column-chart":nxe,"line-chart":axe,"pie-chart":lxe,image:oxe}};var oY;let Lf=oY=class extends Tb{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?oxe.fromJSON(e):e.type==="barchart"?sxe.fromJSON(e):e.type==="columnchart"?nxe.fromJSON(e):e.type==="linechart"?axe.fromJSON(e):e.type==="piechart"?lxe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new oY(Te({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],Lf.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],Lf.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Lf.prototype,"description",void 0),u([d({types:[cxe]})],Lf.prototype,"mediaInfos",void 0),u([ft("mediaInfos")],Lf.prototype,"readMediaInfos",null),u([St("mediaInfos")],Lf.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],Lf.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Lf.prototype,"type",void 0),Lf=oY=u([j("esri.popup.content.MediaContent")],Lf);const W$=Lf;var aY;let qO=aY=class extends Qe{constructor(t){super(t),this.field=null,this.order=null}clone(){return new aY({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],qO.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],qO.prototype,"order",void 0),qO=aY=u([j("esri.popup.support.RelatedRecordsInfoFieldOrder")],qO);const ure=qO;let Rm=class extends Fn(Tb){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([d({type:String,json:{write:!0}})],Rm.prototype,"description",void 0),u([d({type:Number,json:{type:rn,write:!0}})],Rm.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],Rm.prototype,"displayType",void 0),u([d({type:[ure],json:{write:!0}})],Rm.prototype,"orderByFields",void 0),u([d({type:Number,json:{type:rn,write:!0}})],Rm.prototype,"relationshipId",void 0),u([d({type:String,json:{write:!0}})],Rm.prototype,"title",void 0),u([d({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Rm.prototype,"type",void 0),Rm=u([j("esri.popup.content.RelationshipContent")],Rm);const Pk=Rm;var lY;let WO=lY=class extends Tb{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new lY({text:this.text})}};u([d({type:String,json:{write:!0}})],WO.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],WO.prototype,"type",void 0),WO=lY=u([j("esri.popup.content.TextContent")],WO);const B3=WO,wje={base:null,key:"type",typeMap:{attachment:j$,media:W$,text:B3,expression:are,field:k3,relationship:Pk}};var cY;let Fw=cY=class extends Qe{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new cY({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],Fw.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],Fw.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],Fw.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],Fw.prototype,"returnType",void 0),Fw=cY=u([j("esri.popup.ExpressionInfo")],Fw);const uxe=Fw;var uY;let YO=uY=class extends Qe{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new uY({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],YO.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],YO.prototype,"showNoDataRecords",void 0),YO=uY=u([j("esri.popup.LayerOptions")],YO);const xje=YO;var hY;let QO=hY=class extends Qe{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new hY({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?Te(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],QO.prototype,"showRelatedRecords",void 0),u([d({type:[ure],json:{write:!0}})],QO.prototype,"orderByFields",void 0),QO=hY=u([j("esri.popup.RelatedRecordsInfo")],QO);const Tje=QO;var dY;let Df=dY=class extends pL(Ke){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new dY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],Df.prototype,"active",void 0),u([d()],Df.prototype,"className",void 0),u([d()],Df.prototype,"disabled",void 0),u([d()],Df.prototype,"id",void 0),u([d()],Df.prototype,"indicator",void 0),u([d()],Df.prototype,"title",void 0),u([d()],Df.prototype,"type",void 0),u([d()],Df.prototype,"visible",void 0),Df=dY=u([j("esri.support.actions.ActionBase")],Df);const eU=Df;var pY;let KF=pY=class extends eU{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new pY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],KF.prototype,"image",void 0),KF=pY=u([j("esri.support.Action.ActionButton")],KF);const OM=KF;var fY;let XO=fY=class extends eU{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new fY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],XO.prototype,"image",void 0),u([d()],XO.prototype,"value",void 0),XO=fY=u([j("esri.support.Action.ActionToggle")],XO);const hxe=XO,Sje="esri.PopupTemplate",Eje=we.getLogger(Sje),RR="relationships/",Fce="expression/",Cje=or.ofType({key:"type",defaultKeyValue:"button",base:eU,typeMap:{button:OM,toggle:hxe}}),Mje={base:Tb,key:"type",typeMap:{media:W$,custom:mje,text:B3,attachments:j$,fields:k3,expression:are,relationship:Pk}},Rje=["attachments","fields","media","text","expression","relationship"];let qa=class extends Fn(Qe){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>k0(Mje,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Zd(e)?e:(Eje.error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,s){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(n=>Rje.includes(n.type)).map(n=>n&&n.toJSON(s)),r.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(r):n.type==="media"?this._writeMediaContent(n,r):n.type==="text"?this._writeTextContent(n,r):n.type==="relationship"&&this._writeRelationshipContent(n,r)})):r.description=e}writeFieldInfos(e,r,i,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var h;return(h=c.fieldInfos)==null?void 0:h.length});r.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(s);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,s){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),G$(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=Te(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(s=>{const n=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===s.fieldName.toLowerCase());n?n.visible=!0:r.fieldInfos.push(s)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){var n,o;const i=((n=e.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],s=[...((o=r.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=Te(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const s={description:!1,mediaInfos:!1};return i.map(n=>n.type==="media"?(n.mediaInfos||!r||s.mediaInfos||(n.mediaInfos=r,s.mediaInfos=!0),W$.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),B3.fromJSON(n)):n.type==="attachments"?j$.fromJSON(n):n.type==="fields"?k3.fromJSON(n):n.type==="expression"?are.fromJSON(n):n.type==="relationship"?Pk.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!(r!=null&&r.startsWith(RR)))return null;const s=r.replace(RR,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?Pk.fromJSON({relationshipId:n,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:s}=e;return{field:`${RR}${r}/${s}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new B3({text:e})):n.push(new k3),Array.isArray(r)&&r.length&&n.push(W$.fromJSON({mediaInfos:r})),i&&n.push(j$.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const r=e==null?void 0:e.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=n,p=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&p.push(a),l&&p.push(l),p}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,s)=>[...i,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(s=>Gu(e,r,s.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(RR)&&!r.startsWith(Fce)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const s=/\{(\w+):.+\}/,n=i.filter(o=>!(o.indexOf(`{${RR}`)===0||o.indexOf(`{${Fce}`)===0)).map(o=>o.replace(s,"{$1}"));return n?n.map(o=>o.slice(1,-1)):[]}};u([d({type:Cje})],qa.prototype,"actions",void 0),u([d()],qa.prototype,"content",void 0),u([Hr("content")],qa.prototype,"castContent",null),u([ft("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],qa.prototype,"readContent",null),u([St("content",{popupElements:{type:or.ofType(wje)},showAttachments:{type:Boolean},mediaInfos:{type:or.ofType(cxe)},description:{type:String},relatedRecordsInfo:{type:Tje}})],qa.prototype,"writeContent",null),u([d({type:[uxe],json:{write:!0}})],qa.prototype,"expressionInfos",void 0),u([d({type:[fL]})],qa.prototype,"fieldInfos",void 0),u([St("fieldInfos")],qa.prototype,"writeFieldInfos",null),u([d({type:xje})],qa.prototype,"layerOptions",void 0),u([St("layerOptions")],qa.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],qa.prototype,"lastEditInfoEnabled",void 0),u([d()],qa.prototype,"outFields",void 0),u([d()],qa.prototype,"overwriteActions",void 0),u([d()],qa.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],qa.prototype,"title",void 0),u([St("title")],qa.prototype,"writeTitle",null),qa=u([j("esri.PopupTemplate")],qa);const PM=qa,kce=new Ui({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let Oje=0,rE=class extends Qe{constructor(e){super(e),this.id="sym"+Oje++,this.type=null,this.color=new Ot([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:kce.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:kce.write}}})],rE.prototype,"type",void 0),u([d({type:Ot,json:{write:{allowNull:!0}}})],rE.prototype,"color",void 0),u([ft("color")],rE.prototype,"readColor",null),rE=u([j("esri.symbols.Symbol")],rE);const Hh=rE;var mY;let c1=mY=class extends Hh{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){if(t)for(const r in t)e[r]=t[r]}async collectRequiredFields(t,e){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const s=i.map(n=>{const o=n.valueExpressionInfo;return Gu(t,e,o.expression)});await Promise.all(s)}}}clone(){return new mY({data:Te(this.data)})}hash(){return ite(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],c1.prototype,"color",void 0),u([d({json:{write:!0}})],c1.prototype,"data",void 0),u([ft("data",["symbol"])],c1.prototype,"readData",null),u([St("data",{})],c1.prototype,"writeData",null),u([er({CIMSymbolReference:"cim"},{readOnly:!0})],c1.prototype,"type",void 0),c1=mY=u([j("esri.symbols.CIMSymbol")],c1);const IM=c1;let iE=class extends Qe{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,r,i){e||(r[i]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],iE.prototype,"enabled",void 0),u([St("enabled")],iE.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],iE.prototype,"type",void 0),iE=u([j("esri.symbols.Symbol3DLayer")],iE);const Hg=iE,Pje=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,Ije="screenUtils.toPt: input not recognized!",dxe=96;function ll(t){return t?t/72*dxe:0}function of(t){return t?72*t/dxe:0}function gs(t){if(typeof t=="string"){const e=t.match(Pje);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=i==="px"?of(r):r;return s?-n:n}return console.warn(Ije),null}return t}function af(t=0,e=0){return{x:t,y:e}}function Sn(t=0,e=0){return[t,e]}function pxe(t=0,e=0){return[t,e]}function Rl(t=0,e=0,r=0){return[t,e,r]}function zNt(t){return t}function GNt(t){return t}function jNt(t){return t}function ng(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function $je(t,e){const r=e.transparency!=null?U$(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new Ot([i[0]||0,i[1]||0,i[2]||0,r]):null}function Lje(t,e){e.color=t.toJSON().slice(0,3);const r=QB(t.a);r!==0&&(e.transparency=r)}const Qy={type:Ot,json:{type:[rn],default:null,read:{source:["color","transparency"],reader:$je},write:{target:{color:{type:[rn]},transparency:{type:rn}},writer:Lje}}},Ng={type:Number,cast:gs,json:{write:!0}};let kw=class extends Qe{constructor(e){super(e),this.color=new Ot([0,0,0,1]),this.extensionLength=0,this.size=of(1)}clone(){}cloneProperties(){return{color:Te(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],kw.prototype,"type",void 0),u([d(Qy)],kw.prototype,"color",void 0),u([d({...Ng,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],kw.prototype,"extensionLength",void 0),u([d(Ng)],kw.prototype,"size",void 0),kw=u([j("esri.symbols.edges.Edges3D")],kw);const hre=kw;var gY;let e6=gY=class extends hre{constructor(t){super(t),this.type="sketch"}clone(){return new gY(this.cloneProperties())}};u([er({sketch:"sketch"},{readOnly:!0})],e6.prototype,"type",void 0),e6=gY=u([j("esri.symbols.edges.SketchEdges3D")],e6);const Dje=e6;var AY;let t6=AY=class extends hre{constructor(t){super(t),this.type="solid"}clone(){return new AY(this.cloneProperties())}};u([er({solid:"solid"},{readOnly:!0})],t6.prototype,"type",void 0),t6=AY=u([j("esri.symbols.support.SolidEdges3D")],t6);const Nje=t6,fxe={types:{key:"type",base:hre,typeMap:{solid:Nje,sketch:Dje}},json:{write:!0}};var yY;let Bd=yY=class extends Qe{constructor(t){super(t),this.color=null}clone(){const t={color:E(this.color)?this.color.clone():null};return new yY(t)}};u([d(Qy)],Bd.prototype,"color",void 0),Bd=yY=u([j("esri.symbols.support.Symbol3DMaterial")],Bd);var _Y;let u1=_Y=class extends Hg{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new _Y({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:E(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([er({Extrude:"extrude"},{readOnly:!0})],u1.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],u1.prototype,"size",void 0),u([d({type:Bd,json:{write:!0}})],u1.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],u1.prototype,"castShadows",void 0),u([d(fxe)],u1.prototype,"edges",void 0),u1=_Y=u([j("esri.symbols.ExtrudeSymbol3DLayer")],u1);const mxe=u1;let ZO=class extends Hh{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([er({esriSLS:"simple-line"},{readOnly:!0})],ZO.prototype,"type",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],ZO.prototype,"width",void 0),ZO=u([j("esri.symbols.LineSymbol")],ZO);const Fje=ZO,kje=["begin","end","begin-end"],gxe=["arrow","circle","square","diamond","cross","x"];var vY;let Om=vY=class extends Qe{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){(i==null?void 0:i.origin)==="web-map"||(e[r]=t)}clone(){return new vY({color:Te(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],Om.prototype,"placement",void 0),u([er({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],Om.prototype,"type",void 0),u([d({type:gxe})],Om.prototype,"style",void 0),u([St("style")],Om.prototype,"writeStyle",null),u([d({type:Ot,value:null,json:{write:{allowNull:!0}}})],Om.prototype,"color",null),u([ft("color")],Om.prototype,"readColor",null),u([St("color")],Om.prototype,"writeColor",null),Om=vY=u([j("esri.symbols.LineSymbolMarker")],Om);const Bje=Om;var bY;const uz=new Ui({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let EA=bY=class extends Fje{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=gs(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=gs(n)),o}clone(){var t;return new bY({color:Te(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};u([er({esriSLS:"simple-line"},{readOnly:!0})],EA.prototype,"type",void 0),u([d({type:uz.apiValues,json:{read:uz.read,write:uz.write}})],EA.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],EA.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],EA.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":Bje}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],EA.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],EA.prototype,"miterLimit",void 0),EA=bY=u([j("esri.symbols.SimpleLineSymbol")],EA);const mf=EA;let JO=class extends Hh{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":mf}},json:{default:null,write:!0}})],JO.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],JO.prototype,"type",void 0),JO=u([j("esri.symbols.FillSymbol")],JO);const Axe=JO;let r6=class extends Qe{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],r6.prototype,"type",void 0),r6=u([j("esri.symbols.patterns.LinePattern3D")],r6);const yxe=r6,Uje=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var wY;const Vje=hc()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let KO=wY=class extends yxe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new wY(t)}};u([d({type:["style"]})],KO.prototype,"type",void 0),u([er(Vje),d({type:Uje})],KO.prototype,"style",void 0),KO=wY=u([j("esri.symbols.patterns.LineStylePattern3D")],KO);const dre=KO;let i6=class extends Qe{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],i6.prototype,"type",void 0),i6=u([j("esri.symbols.patterns.Pattern3D")],i6);const _xe=i6,zje=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var xY;let eP=xY=class extends _xe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new xY(t)}};u([d({type:["style"]})],eP.prototype,"type",void 0),u([d({type:zje,json:{read:!0,write:!0}})],eP.prototype,"style",void 0),eP=xY=u([j("esri.symbols.patterns.StylePattern3D")],eP);const vxe=eP,Gje={types:{key:"type",base:_xe,typeMap:{style:vxe}},json:{write:!0}},bxe={types:{key:"type",base:yxe,typeMap:{style:dre}},json:{write:!0}},CI=new Ot("white");new Ot("black");const jje=new Ot([255,255,255,0]);function Hje(t){return t.r===0&&t.g===0&&t.b===0}var TY;let MI=TY=class extends Bd{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:E(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new TY(t)}};u([er({multiply:"multiply",replace:"replace",tint:"tint"})],MI.prototype,"colorMixMode",void 0),MI=TY=u([j("esri.symbols.support.Symbol3DFillMaterial")],MI);function si(t=Qje){return[t[0],t[1],t[2],t[3]]}function XNt(t){return[t[0],t[1],t[2],t[3]]}function Fy(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function pre(t,e,r,i,s=si()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function wxe(t,e=si()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function tU(t,e){return new Ki({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function fre(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Fv(t,e,r){if(N(e))Fy(r,t);else if("length"in e)CY(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}}function hz(t,e,r=t){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function SY(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Pd(t){return N(t)||t[0]>=t[2]?0:t[2]-t[0]}function V0(t){return t[1]>=t[3]?0:t[3]-t[1]}function xxe(t){return Pd(t)*V0(t)}function mre(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function Txe(t,e){return rU(t,e[0],e[1])}function Bce(t,e){const r=e[3],i=.5*(t[0]+t[2]),s=Math.abs(e[0]-i),n=.5*(t[2]-t[0]);if(s>r+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=r*r}function ZNt(t,e,r){const i=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=r,p=(C,M)=>(h-l)*C+(a-c)*M+(c*l-a*h)<0,A=p(i,o),_=p(n,o),w=p(n,s),T=p(i,s);return!(A===_&&_===w&&w===T&&T===A||a<i&&c<i||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function JNt(t,e){return rU(t,e.x,e.y)}function rU(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function qje(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function iU(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function Uce(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function EY(t,e,r){if(N(e))return Fy(r,t);const i=e[0],s=e[1],n=e[2],o=e[3];return r[0]=ze(t[0],i,n),r[1]=ze(t[1],s,o),r[2]=ze(t[2],i,n),r[3]=ze(t[3],s,o),r}function Wje(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-r)-Pd(t)/2,0),n=Math.max(Math.abs(e[1]-i)-V0(t)/2,0);return Math.sqrt(s*s+n*n)}function Ik(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function lf(t){return t?Fy(t,MY):si(MY)}function CY(t){return t!=null&&t.length===4}function Yje(t){return!(Pd(t)!==0&&isFinite(t[0])||V0(t)!==0&&isFinite(t[1]))}function dx(t,e){return CY(t)&&CY(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const KNt=[-1/0,-1/0,1/0,1/0],MY=[1/0,1/0,-1/0,-1/0],Qje=[0,0,0,0];function Jo(t=Rxe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function zx(t,e,r,i,s,n,o=Jo()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function eFt(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new Ki(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function U3(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function Xje(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function Fg(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Dd(t,e,r=0,i=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<i;h++)s=Math.min(s,e[r+3*h]),n=Math.min(n,e[r+3*h+1]),o=Math.min(o,e[r+3*h+2]),a=Math.max(a,e[r+3*h]),l=Math.max(l,e[r+3*h+1]),c=Math.max(c,e[r+3*h+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function dz(t,e,r){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let h=0;h<i;h++){const p=e[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<i;h++){const p=e[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function Zje(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function _T(t){return t[0]>=t[3]?0:t[3]-t[0]}function vT(t){return t[1]>=t[4]?0:t[4]-t[1]}function Sb(t){return t[2]>=t[5]?0:t[5]-t[2]}function Sxe(t){const e=_T(t),r=Sb(t),i=vT(t);return Math.sqrt(e*e+r*r+i*i)}function _0(t,e=[0,0,0]){return e[0]=t[0]+_T(t)/2,e[1]=t[1]+vT(t)/2,e[2]=t[2]+Sb(t)/2,e}function BD(t,e=[0,0,0]){return e[0]=_T(t),e[1]=vT(t),e[2]=Sb(t),e}function gre(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function tFt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function Jje(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function v0(t,e){return!!N(e)||Jje(t,e)}function Exe(t,e,r,i,s=t){return s[0]=t[0]+e,s[1]=t[1]+r,s[2]=t[2]+i,s[3]=t[3]+e,s[4]=t[4]+r,s[5]=t[5]+i,s}function rFt(t,e,r=t){const i=t[0]+_T(t)/2,s=t[1]+vT(t)/2,n=t[2]+Sb(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=s+(t[1]-s)*e,r[2]=n+(t[2]-n)*e,r[3]=i+(t[3]-i)*e,r[4]=s+(t[4]-s)*e,r[5]=n+(t[5]-n)*e,r}function Cxe(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function Mxe(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function sU(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Fs(t){return t?sU(t,Vce):Jo(Vce)}function Are(t,e){return e||(e=si()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function iFt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function Kje(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function RY(t){return t.length===6}function yre(t){return _T(t)===0&&vT(t)===0&&Sb(t)===0}function sFt(t,e,r){if(N(t)||N(e))return t===e;if(!RY(t)||!RY(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function eHe(t,e,r,i,s,n){return zx(t,e,r,i,s,n,tHe)}const nFt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Vce=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Rxe=[0,0,0,0,0,0],tHe=Jo();function pz(t,{isPrimitive:e,width:r,depth:i,height:s}){const n=e?10:1;if(r==null&&s==null&&i==null)return[n*t[0],n*t[1],n*t[2]];const o=ct(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const rHe=zx(-.5,-.5,-.5,.5,.5,.5),iHe=zx(-.5,-.5,0,.5,.5,1),sHe=zx(-.5,-.5,0,.5,.5,.5);function nHe(t){switch(t){case"sphere":case"cube":case"diamond":return rHe;case"cylinder":case"cone":case"inverted-cone":return iHe;case"tetrahedron":return sHe;default:return}}const _re=["butt","square","round"],oHe=[..._re,"none"],Oxe=["miter","bevel","round"];var OY;let Bw=OY=class extends Qe{constructor(t){super(t),this.color=new Ot([0,0,0,1]),this.size=of(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:E(this.color)?this.color.clone():null,size:this.size,pattern:E(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new OY(t)}};u([d(Qy)],Bw.prototype,"color",void 0),u([d(Ng)],Bw.prototype,"size",void 0),u([d(bxe)],Bw.prototype,"pattern",void 0),u([d({type:_re,json:{default:"butt",write:{overridePolicy(){return{enabled:E(this.pattern)}}}}})],Bw.prototype,"patternCap",void 0),Bw=OY=u([j("esri.symbols.support.Symbol3DOutline")],Bw);var s6;let CA=s6=class extends Hg{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:E(this.edges)?this.edges.clone():null,enabled:this.enabled,material:E(this.material)?this.material.clone():null,pattern:E(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:E(this.outline)?this.outline.clone():null};return new s6(t)}static fromSimpleFillSymbol(t){var i,s,n;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new dre({style:t.outline.style}):null,r={size:((i=t.outline)==null?void 0:i.width)??0,color:(((s=t.outline)==null?void 0:s.color)??CI).clone(),pattern:e};return e&&((n=t.outline)!=null&&n.cap)&&(r.patternCap=t.outline.cap),new s6({material:new MI({color:(t.color??jje).clone()}),pattern:t.style&&t.style!=="solid"?new vxe({style:t.style}):null,outline:r})}};u([er({Fill:"fill"},{readOnly:!0})],CA.prototype,"type",void 0),u([d({type:MI,json:{write:!0}})],CA.prototype,"material",void 0),u([d(Gje)],CA.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],CA.prototype,"castShadows",void 0),u([d({type:Bw,json:{write:!0}})],CA.prototype,"outline",void 0),u([d(fxe)],CA.prototype,"edges",void 0),CA=s6=u([j("esri.symbols.FillSymbol3DLayer")],CA);const mL=CA,aHe=["none","underline","line-through"],lHe=["normal","italic","oblique"],cHe=["normal","lighter","bold","bolder"],Pxe={type:Number,cast:t=>{const e=Dp(t);return e===0?1:ze(e,.1,4)},nonNullable:!0},uHe=["left","right","center"],hHe=["baseline","top","middle","bottom"],Ixe={type:uHe,nonNullable:!0},$xe={type:hHe,nonNullable:!0};var PY;let MA=PY=class extends Qe{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return gs(t)}clone(){return new PY({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:aHe,json:{default:"none",write:!0}})],MA.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],MA.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],MA.prototype,"size",void 0),u([Hr("size")],MA.prototype,"castSize",null),u([d({type:lHe,json:{default:"normal",write:!0}})],MA.prototype,"style",void 0),u([d({type:cHe,json:{default:"normal",write:!0}})],MA.prototype,"weight",void 0),MA=PY=u([j("esri.symbols.Font")],MA);const nU=MA;function $M(t,e){const r=e&&e.url&&e.url.path;if(t&&r&&(t=Od(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const i=bte(t,e.portalItem.itemUrl);i!=null&&dHe.test(i)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(i).path)}return IY(t,e&&e.portal)}function Gx(t,e,r=Y$.YES){if(t==null)return t;!Fd(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let i=Od(t);if(e){const s=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(s){const n=IY(s,e.portal),o=IY(i,e.portal);i=bte(o,n,n),i!=null&&i!==o&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=Dxe(i,e==null?void 0:e.portal),Fd(i)&&(i=O0(i)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!Fd(i)&&!zg(i)&&r===Y$.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function vre(t,e,r){return $M(t,r)}function eb(t,e,r,i){const s=Gx(t,i);s!==void 0&&(e[r]=s)}const Lxe=/\/items\/([^\/]+)\/resources\/(.*)/,dHe=/^\.\/resources\//;function pHe(t){var e;return((e=(t==null?void 0:t.match(Lxe))??null)==null?void 0:e[1])??null}function fHe(t){const e=(t==null?void 0:t.match(Lxe))??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=sce(r);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=sce(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:n}}function Dxe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?TW(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function IY(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=yte();return R3(i,`${i.scheme}://${r}`)?TW(t,e.portalHostname,r):TW(t,r,e.portalHostname)}var Y$;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(Y$||(Y$={}));const oFt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return Y$},ensureMainOnlineDomain:Dxe,fromJSON:$M,itemIdFromResourceUrl:pHe,prefixAndFilenameFromResourceUrl:fHe,read:vre,toJSON:Gx,write:eb},Symbol.toStringTag,{value:"Module"}));var $Y;const mHe=hc()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Uw=$Y=class extends Qe{constructor(t){super(t)}readHref(t,e,r){return t?$M(t,r):e.dataURI}writeHref(t,e,r,i){t&&(zg(t)?e.dataURI=t:(e.href=Gx(t,i),Fd(e.href)&&(e.href=O0(e.href))))}clone(){return new $Y({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Uw.prototype,"href",void 0),u([ft("href")],Uw.prototype,"readHref",null),u([St("href",{href:{type:String},dataURI:{type:String}})],Uw.prototype,"writeHref",null),u([er(mHe)],Uw.prototype,"primitive",void 0),Uw=$Y=u([j("esri.symbols.support.IconSymbol3DLayerResource")],Uw);const gHe="circle";var LY;let fC=LY=class extends Ke{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new LY({x:this.x,y:this.y})}};u([d({type:Number})],fC.prototype,"x",void 0),u([d({type:Number})],fC.prototype,"y",void 0),fC=LY=u([j("esri.symbols.support.Symbol3DAnchorPosition2D")],fC);var DY;let tP=DY=class extends Qe{constructor(t){super(t),this.color=new Ot([0,0,0,1]),this.size=of(1)}clone(){const t={color:E(this.color)?this.color.clone():null,size:this.size};return new DY(t)}};u([d(Qy)],tP.prototype,"color",void 0),u([d(Ng)],tP.prototype,"size",void 0),tP=DY=u([j("esri.symbols.support.Symbol3DIconOutline")],tP);var sE;const Nxe="esri.symbols.IconSymbol3DLayer";let Pm=sE=class extends Hg{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new sE({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:E(this.material)?this.material.clone():null,outline:E(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||CI,r=zce(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||CI).clone()}:null;return new sE({size:t.size,resource:{primitive:yHe(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||Hje(t.color)?CI:t.color,r=zce(t);return new sE({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new sE({resource:{href:ywe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function zce(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=Gce(t.xoffset),s=Gce(t.yoffset);return(i||s)&&e&&r?{x:-i/e,y:s/r}:null}function Gce(t){return isFinite(t)?t:0}u([d({type:Bd,json:{write:!0}})],Pm.prototype,"material",void 0),u([d({type:Uw,json:{write:!0}})],Pm.prototype,"resource",void 0),u([er({Icon:"icon"},{readOnly:!0})],Pm.prototype,"type",void 0),u([d(Ng)],Pm.prototype,"size",void 0),u([er({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],Pm.prototype,"anchor",void 0),u([d({type:fC,json:{type:[Number],read:{reader:t=>new fC({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Pm.prototype,"anchorPosition",void 0),u([d({type:tP,json:{write:!0}})],Pm.prototype,"outline",void 0),Pm=sE=u([j(Nxe)],Pm);const AHe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function yHe(t){return AHe[t]||(we.getLogger(Nxe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const pv=Pm;let Vw=class extends Fn(Qe){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return E(e)&&e.placement===this.placement&&e.style===this.style&&(N(this.color)&&N(e.color)||E(this.color)&&E(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Vw.prototype,"type",void 0),u([d({type:kje,json:{default:"begin-end",write:!0}})],Vw.prototype,"placement",void 0),u([d({type:gxe,json:{default:"arrow",write:!0}})],Vw.prototype,"style",void 0),u([d({type:Ot,json:{type:[rn],default:null,write:!0}})],Vw.prototype,"color",void 0),Vw=u([j("esri.symbols.LineStyleMarker3D")],Vw);const NY=Vw;var n6;let Im=n6=class extends Hg{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=of(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:E(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:E(this.pattern)?this.pattern.clone():null,marker:E(this.marker)?this.marker.clone():null};return new n6(t)}static fromSimpleLineSymbol(t){var r;const e={enabled:!0,size:t.width??of(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new dre({style:t.style}):null,material:new Bd({color:(t.color||CI).clone()}),marker:t.marker?new NY({placement:t.marker.placement,style:t.marker.style,color:((r=t.marker.color)==null?void 0:r.clone())??null}):null};return new n6(e)}};u([d({type:Bd,json:{write:!0}})],Im.prototype,"material",void 0),u([er({Line:"line"},{readOnly:!0})],Im.prototype,"type",void 0),u([d({type:Oxe,json:{write:!0,default:"miter"}})],Im.prototype,"join",void 0),u([d({type:_re,json:{write:!0,default:"butt"}})],Im.prototype,"cap",void 0),u([d(Ng)],Im.prototype,"size",void 0),u([d(bxe)],Im.prototype,"pattern",void 0),u([d({types:{key:"type",base:NY,typeMap:{style:NY}},json:{write:!0}})],Im.prototype,"marker",void 0),Im=n6=u([j("esri.symbols.LineSymbol3DLayer")],Im);const gL=Im;var FY;const _He=hc()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let rP=FY=class extends Qe{clone(){return new FY({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:vre,write:eb}})],rP.prototype,"href",void 0),u([er(_He)],rP.prototype,"primitive",void 0),rP=FY=u([j("esri.symbols.support.ObjectSymbol3DLayerResource")],rP);const Fxe="sphere";var kY;let P2=kY=class extends Ke{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new kY({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],P2.prototype,"x",void 0),u([d({type:Number})],P2.prototype,"y",void 0),u([d({type:Number})],P2.prototype,"z",void 0),P2=kY=u([j("esri.symbols.support.Symbol3DAnchorPosition3D")],P2);var BY;let Pc=BY=class extends Hg{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new BY({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:E(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:Bd,json:{write:!0}})],Pc.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Pc.prototype,"castShadows",void 0),u([d({type:rP,json:{write:!0}})],Pc.prototype,"resource",void 0),u([er({Object:"object"},{readOnly:!0})],Pc.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],Pc.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],Pc.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],Pc.prototype,"depth",void 0),u([er({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],Pc.prototype,"anchor",void 0),u([d({type:P2,json:{type:[Number],read:{reader:t=>new P2({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Pc.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],Pc.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],Pc.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],Pc.prototype,"roll",void 0),u([d({readOnly:!0})],Pc.prototype,"isPrimitive",null),Pc=BY=u([j("esri.symbols.ObjectSymbol3DLayer")],Pc);const bre=Pc;var UY;let gu=UY=class extends Hg{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new UY({enabled:this.enabled,material:E(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:Bd,json:{write:!0}})],gu.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],gu.prototype,"castShadows",void 0),u([er({Path:"path"},{readOnly:!0})],gu.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],gu.prototype,"profile",void 0),u([d({type:Oxe,json:{write:!0,default:"miter"}})],gu.prototype,"join",void 0),u([d({type:oHe,json:{write:!0,default:"butt"}})],gu.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],gu.prototype,"width",void 0),u([ft("width",["width","size","height"])],gu.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],gu.prototype,"height",void 0),u([ft("height",["height","size","width"])],gu.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],gu.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],gu.prototype,"profileRotation",void 0),gu=UY=u([j("esri.symbols.PathSymbol3DLayer")],gu);const wre=gu;var VY;let mC=VY=class extends Qe{constructor(){super(...arguments),this.color=new Ot([0,0,0,1]),this.size=0}clone(){const t={color:Te(this.color),size:this.size};return new VY(t)}};u([d(Qy)],mC.prototype,"color",void 0),u([d(Ng)],mC.prototype,"size",void 0),mC=VY=u([j("esri.symbols.support.Symbol3DHalo")],mC);let RI=class extends Fn(Qe){constructor(e){super(e),this.color=null}};u([d(Qy)],RI.prototype,"color",void 0),RI=u([j("esri.symbols.support.Symbol3DTextBackground")],RI);var o6;let rh=o6=class extends Hg{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){E(t)&&E(this._userSize)&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const s={...i,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){return E(this._userSize)?this._userSize:E(this.font)&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,E(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new o6({enabled:this.enabled,font:this.font&&Te(this.font),halo:this.halo&&Te(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:E(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:Te(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new o6({font:E(t.font)?t.font.clone():new nU,halo:vHe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Bd({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new RI({color:t.backgroundColor.clone()}):null})}};function vHe(t,e){return t&&e!=null&&e>0?new mC({color:Te(t),size:e}):null}u([d({type:nU,json:{write:!0}})],rh.prototype,"font",null),u([St("font")],rh.prototype,"writeFont",null),u([d({type:mC,json:{write:!0}})],rh.prototype,"halo",void 0),u([d({...Ixe,json:{default:"center",write:!0}})],rh.prototype,"horizontalAlignment",void 0),u([d({...Pxe,json:{default:1,write:!0}})],rh.prototype,"lineHeight",void 0),u([d({type:Bd,json:{write:!0}})],rh.prototype,"material",void 0),u([d({type:RI,json:{write:!0}})],rh.prototype,"background",void 0),u([d(Ng)],rh.prototype,"size",null),u([d({type:String,json:{write:!0}})],rh.prototype,"text",void 0),u([er({Text:"text"},{readOnly:!0})],rh.prototype,"type",void 0),u([d({...$xe,json:{default:"baseline",write:!0}})],rh.prototype,"verticalAlignment",void 0),rh=o6=u([j("esri.symbols.TextSymbol3DLayer")],rh);const bT=rh;var zY;let h1=zY=class extends Hg{constructor(t){super(t),this.color=GY.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new zY({color:Te(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:Ot,nonNullable:!0,json:{type:[rn],write:(t,e,r)=>e[r]=t.toArray(Ot.AlphaMode.UNLESS_OPAQUE),default:()=>GY.clone(),defaultEquals:t=>t.toCss(!0)===GY.toCss(!0)}})],h1.prototype,"color",void 0),u([er({Water:"water"},{readOnly:!0})],h1.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],h1.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],h1.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],h1.prototype,"waveStrength",void 0),h1=zY=u([j("esri.symbols.WaterSymbol3DLayer")],h1);const GY=new Ot([0,119,190]),kxe=h1;var jY;let zw=jY=class extends Ke{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new jY({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],zw.prototype,"name",void 0),u([d({type:String})],zw.prototype,"styleUrl",void 0),u([d({type:String})],zw.prototype,"styleName",void 0),u([d({type:zu})],zw.prototype,"portal",void 0),zw=jY=u([j("esri.symbols.support.StyleOrigin")],zw);const HY=zw;var qY;let OI=qY=class extends Ke{constructor(){super(...arguments),this.url=""}clone(){return new qY({url:this.url})}};u([d({type:String})],OI.prototype,"url",void 0),OI=qY=u([j("esri.symbols.support.Thumbnail")],OI);const Bxe={icon:pv,object:bre,line:gL,path:wre,fill:mL,extrude:mxe,text:bT,water:kxe},bHe=or.ofType({base:Hg,key:"type",typeMap:Bxe,errorContext:"symbol-layer"});let $m=class extends Hh{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=r&&r.type||or;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&we.getLogger(this.declaredClass).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Lx(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const s=$M(e.styleUrl,i);return new HY({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new HY({portal:i&&i.portal||zu.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new Pg("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,s){if(e.styleUrl&&e.name){let n=Gx(e.styleUrl,s);Fd(n)&&(n=O0(n)),r.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s&&s.portal&&!gwe(e.portal.restUrl,s.portal.restUrl)?s&&s.messages&&s.messages.push(new Pg("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Hg||e&&Bxe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],$m.prototype,"color",null),u([d({type:bHe,nonNullable:!0,json:{write:!0}}),Hr(iwe)],$m.prototype,"symbolLayers",null),u([d({type:HY})],$m.prototype,"styleOrigin",void 0),u([ft("styleOrigin")],$m.prototype,"readStyleOrigin",null),u([St("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],$m.prototype,"writeStyleOrigin",null),u([d({type:OI,json:{read:!1}})],$m.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],$m.prototype,"type",void 0),$m=u([j("esri.symbols.Symbol3D")],$m);const LM=$m;let iP=class extends Qe{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],iP.prototype,"type",void 0),u([d({readOnly:!0})],iP.prototype,"visible",void 0),iP=u([j("esri.symbols.callouts.Callout3D")],iP);const Uxe=iP;var WY;let a6=WY=class extends Qe{constructor(){super(...arguments),this.color=new Ot("white")}clone(){return new WY({color:Te(this.color)})}};u([d(Qy)],a6.prototype,"color",void 0),a6=WY=u([j("esri.symbols.callouts.LineCallout3DBorder")],a6);const Vxe=a6;Object.freeze(Object.defineProperty({__proto__:null,default:Vxe},Symbol.toStringTag,{value:"Module"}));var YY;let d1=YY=class extends Uxe{constructor(t){super(t),this.type="line",this.color=new Ot([0,0,0,1]),this.size=of(1),this.border=null}get visible(){return this.size>0&&E(this.color)&&this.color.a>0}clone(){return new YY({color:Te(this.color),size:this.size,border:Te(this.border)})}};u([er({line:"line"},{readOnly:!0})],d1.prototype,"type",void 0),u([d(Qy)],d1.prototype,"color",void 0),u([d(Ng)],d1.prototype,"size",void 0),u([d({type:Vxe,json:{write:!0}})],d1.prototype,"border",void 0),u([d({readOnly:!0})],d1.prototype,"visible",null),d1=YY=u([j("esri.symbols.callouts.LineCallout3D")],d1);const wHe=d1;function xre(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||E(e.maxWorldLength)&&e.maxWorldLength<=0)}function zxe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!xre(t)}function Tre(t){return t.type==="point-3d"||t.type==="label-3d"}function Gxe(t){return t.horizontalAlignment==="center"}const jxe={types:{key:"type",base:Uxe,typeMap:{line:wHe}},json:{write:!0}};var QY;let nE=QY=class extends Qe{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new QY({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(Ng)],nE.prototype,"screenLength",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0,default:0}})],nE.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],nE.prototype,"maxWorldLength",void 0),nE=QY=u([j("esri.symbols.support.Symbol3DVerticalOffset")],nE);const Hxe=nE;var l6;const qxe=or.ofType({base:null,key:"type",typeMap:{text:bT}});let p1=l6=class extends LM{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new qxe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return zxe(this)}hasVisibleVerticalOffset(){return xre(this)}clone(){return new l6({styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail),callout:Te(this.callout),verticalOffset:Te(this.verticalOffset)})}static fromTextSymbol(t){return new l6({symbolLayers:[bT.fromTextSymbol(t)]})}};u([d({type:Hxe,json:{write:!0}})],p1.prototype,"verticalOffset",void 0),u([d(jxe)],p1.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],p1.prototype,"styleOrigin",void 0),u([d({type:qxe})],p1.prototype,"symbolLayers",void 0),u([er({LabelSymbol3D:"label-3d"},{readOnly:!0})],p1.prototype,"type",void 0),p1=l6=u([j("esri.symbols.LabelSymbol3D")],p1);const oU=p1;var c6;const Wxe=or.ofType({base:null,key:"type",typeMap:{line:gL,path:wre}}),xHe=or.ofType({base:null,key:"type",typeMap:{line:gL,path:wre}});let sP=c6=class extends LM{constructor(t){super(t),this.symbolLayers=new Wxe,this.type="line-3d"}clone(){return new c6({styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail)})}static fromSimpleLineSymbol(t){return new c6({symbolLayers:[gL.fromSimpleLineSymbol(t)]})}};u([d({type:Wxe,json:{type:xHe}})],sP.prototype,"symbolLayers",void 0),u([er({LineSymbol3D:"line-3d"},{readOnly:!0})],sP.prototype,"type",void 0),sP=c6=u([j("esri.symbols.LineSymbol3D")],sP);const aU=sP;let f1=class extends Hh{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],f1.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],f1.prototype,"type",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],f1.prototype,"xoffset",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],f1.prototype,"yoffset",void 0),u([d({type:Number,cast:t=>t==="auto"?t:gs(t),json:{write:!0}})],f1.prototype,"size",void 0),f1=u([j("esri.symbols.MarkerSymbol")],f1);const Yxe=f1;var u6;const Qxe=or.ofType({base:null,key:"type",typeMap:{fill:mL}});let nP=u6=class extends LM{constructor(t){super(t),this.symbolLayers=new Qxe,this.type="mesh-3d"}clone(){return new u6({styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail)})}static fromSimpleFillSymbol(t){return new u6({symbolLayers:[mL.fromSimpleFillSymbol(t)]})}};u([d({type:Qxe})],nP.prototype,"symbolLayers",void 0),u([er({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],nP.prototype,"type",void 0),nP=u6=u([j("esri.symbols.MeshSymbol3D")],nP);const lU=nP;function THe(t,e,r){return e.imageData?ywe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):Xxe(e.url,r)}function Xxe(t,e){var r;return EHe(e)&&!Fd(t)&&((r=e==null?void 0:e.layer)!=null&&r.parsedUrl)?Dx(e.layer.parsedUrl.path,"images",t):$M(t,e)}function SHe(t,e,r,i){if(zg(t)){const s=cL(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,r&&r.imageData===e.imageData&&r.url&&eb(r.url,e,"url",i)}else eb(t,e,"url",i)}const Zxe={json:{read:{source:["imageData","url"],reader:THe},write:{writer(t,e,r,i){SHe(t,e,this.source,i)}}}},Jxe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=Xxe(e.url,r)),i}}}};function EHe(t){var e,r;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((r=t.layer)==null?void 0:r.type)!=="stream")}var XY;let Ap=XY=class extends Axe{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),r!=null&&(s.width=gs(r)),i!=null&&(s.height=gs(i)),s}clone(){const t=new XY({color:Te(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",Te(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([er({esriPFS:"picture-fill"},{readOnly:!0})],Ap.prototype,"type",void 0),u([d(Zxe)],Ap.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],Ap.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],Ap.prototype,"yscale",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],Ap.prototype,"width",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],Ap.prototype,"height",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],Ap.prototype,"xoffset",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],Ap.prototype,"yoffset",void 0),u([d(Jxe)],Ap.prototype,"source",void 0),Ap=XY=u([j("esri.symbols.PictureFillSymbol")],Ap);const Kxe=Ap;var ZY;let Nf=ZY=class extends Yxe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=gs(e)),r!=null&&(i.height=gs(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new ZY({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",Te(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],Nf.prototype,"color",void 0),u([er({esriPMS:"picture-marker"},{readOnly:!0})],Nf.prototype,"type",void 0),u([d(Zxe)],Nf.prototype,"url",void 0),u([d(Jxe)],Nf.prototype,"source",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],Nf.prototype,"height",void 0),u([ft("height",["height","size"])],Nf.prototype,"readHeight",null),u([d({type:Number,cast:gs,json:{write:!0}})],Nf.prototype,"width",void 0),u([d({json:{write:!1}})],Nf.prototype,"size",void 0),Nf=ZY=u([j("esri.symbols.PictureMarkerSymbol")],Nf);const AL=Nf;var Gw;const eTe=or.ofType({base:null,key:"type",typeMap:{icon:pv,object:bre,text:bT}});let jw=Gw=class extends LM{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new eTe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return zxe(this)}hasVisibleVerticalOffset(){return xre(this)}clone(){return new Gw({verticalOffset:Te(this.verticalOffset),callout:Te(this.callout),styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Gw({symbolLayers:[pv.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new Gw({symbolLayers:[pv.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){var i,s;if(((s=(i=t.data)==null?void 0:i.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const r=t.data.symbol;return new Gw(r!=null&&r.callout?{symbolLayers:[pv.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[pv.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new Gw({symbolLayers:[bT.fromTextSymbol(t)]})}};u([d({type:Hxe,json:{write:!0}})],jw.prototype,"verticalOffset",void 0),u([d(jxe)],jw.prototype,"callout",void 0),u([d({type:eTe,json:{origins:{"web-scene":{write:!0}}}})],jw.prototype,"symbolLayers",void 0),u([er({PointSymbol3D:"point-3d"},{readOnly:!0})],jw.prototype,"type",void 0),jw=Gw=u([j("esri.symbols.PointSymbol3D")],jw);const fv=jw;var oP;const tTe=or.ofType({base:null,key:"type",typeMap:{extrude:mxe,fill:mL,icon:pv,line:gL,object:bre,text:bT,water:kxe}});let aP=oP=class extends LM{constructor(t){super(t),this.symbolLayers=new tTe,this.type="polygon-3d"}clone(){return new oP({styleOrigin:Te(this.styleOrigin),symbolLayers:Te(this.symbolLayers),thumbnail:Te(this.thumbnail)})}static fromJSON(t){const e=new oP;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.getItemAt(0).type==="fill"&&e.symbolLayers.getItemAt(1).type==="line"){const r=e.symbolLayers.getItemAt(0),i=e.symbolLayers.getItemAt(1);!i.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:E(i.material)?i.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new oP({symbolLayers:[mL.fromSimpleFillSymbol(t)]})}};u([d({type:tTe,json:{write:!0}})],aP.prototype,"symbolLayers",void 0),u([er({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],aP.prototype,"type",void 0),aP=oP=u([j("esri.symbols.PolygonSymbol3D")],aP);const yL=aP;var JY;const fz=new Ui({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Hw=JY=class extends Axe{constructor(...t){super(...t),this.color=new Ot([0,0,0,.25]),this.outline=new mf,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new JY({color:Te(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],Hw.prototype,"color",void 0),u([d()],Hw.prototype,"outline",void 0),u([er({esriSFS:"simple-fill"},{readOnly:!0})],Hw.prototype,"type",void 0),u([d({type:fz.apiValues,json:{read:fz.read,write:fz.write}})],Hw.prototype,"style",void 0),Hw=JY=u([j("esri.symbols.SimpleFillSymbol")],Hw);const Eb=Hw;var KY;const mz=new Ui({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Lm=KY=class extends Yxe{constructor(...t){super(...t),this.color=new Ot([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new mf}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=gs(e)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new KY({angle:this.angle,color:Te(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};u([d()],Lm.prototype,"color",void 0),u([St("color")],Lm.prototype,"writeColor",null),u([er({esriSMS:"simple-marker"},{readOnly:!0})],Lm.prototype,"type",void 0),u([d()],Lm.prototype,"size",void 0),u([d({type:mz.apiValues,json:{read:mz.read,write:mz.write}})],Lm.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],Lm.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":mf}},json:{default:null,write:!0}})],Lm.prototype,"outline",void 0),Lm=KY=u([j("esri.symbols.SimpleMarkerSymbol")],Lm);const Cb=Lm;var eQ;let to=eQ=class extends Hh{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new nU,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return gs(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new eQ({angle:this.angle,backgroundColor:Te(this.backgroundColor),borderLineColor:Te(this.borderLineColor),borderLineSize:this.borderLineSize,color:Te(this.color),font:this.font&&this.font.clone(),haloColor:Te(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:Ot,json:{write:!0}})],to.prototype,"backgroundColor",void 0),u([d({type:Ot,json:{write:!0}})],to.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0},cast:gs})],to.prototype,"borderLineSize",void 0),u([d({type:nU,json:{write:!0}})],to.prototype,"font",void 0),u([d({...Ixe,json:{write:!0}})],to.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],to.prototype,"kerning",void 0),u([d({type:Ot,json:{write:!0}})],to.prototype,"haloColor",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],to.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],to.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],to.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],to.prototype,"text",void 0),u([er({esriTS:"text"},{readOnly:!0})],to.prototype,"type",void 0),u([d({...$xe,json:{write:!0}})],to.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],to.prototype,"xoffset",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],to.prototype,"yoffset",void 0),u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],to.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],to.prototype,"width",void 0),u([d({type:Number})],to.prototype,"lineWidth",void 0),u([St("lineWidth")],to.prototype,"writeLineWidth",null),u([Hr("lineWidth")],to.prototype,"castLineWidth",null),u([d(Pxe)],to.prototype,"lineHeight",void 0),u([St("lineHeight")],to.prototype,"writeLineHeight",null),to=eQ=u([j("esri.symbols.TextSymbol")],to);const DM=to;var tQ;let Ff=tQ=class extends Hh{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=E(this.portal)?this.portal:zu.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new tQ({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=E(e)?e.cache:null,i=r?this._fetchCacheKey:null;if(E(r)){const a=i&&r.get(i);if(a)return a.clone()}const s=await CHe();di(e);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},t,e);n.catch(a=>{we.getLogger(this.declaredClass).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(E(r)&&r.set(i,o.clone()),o):null}};function CHe(){return be(()=>import("./webStyleSymbolUtils-d5bc5921.js"),[])}u([d({json:{write:!1}})],Ff.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Ff.prototype,"styleName",void 0),u([d({type:zu,json:{write:!1}})],Ff.prototype,"portal",void 0),u([d({type:String,json:{read:vre,write:eb}})],Ff.prototype,"styleUrl",void 0),u([d({type:OI,json:{read:!1}})],Ff.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],Ff.prototype,"name",void 0),u([er({styleSymbolReference:"web-style"},{readOnly:!0})],Ff.prototype,"type",void 0),u([d()],Ff.prototype,"_fetchCacheKey",null),Ff=tQ=u([j("esri.symbols.WebStyleSymbol")],Ff);const wT=Ff;function cU(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function V3(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const px={base:Hh,key:"type",typeMap:{"simple-fill":Eb,"picture-fill":Kxe,"picture-marker":AL,"simple-line":mf,"simple-marker":Cb,text:DM,"label-3d":oU,"line-3d":aU,"mesh-3d":lU,"point-3d":fv,"polygon-3d":yL,"web-style":wT,cim:IM},errorContext:"symbol"},MHe={base:Hh,key:"type",typeMap:{"picture-marker":AL,"simple-marker":Cb,text:DM,"web-style":wT,cim:IM},errorContext:"symbol"},RHe=bb({types:px}),uU={base:Hh,key:"type",typeMap:{"simple-fill":Eb,"picture-fill":Kxe,"picture-marker":AL,"simple-line":mf,"simple-marker":Cb,text:DM,"line-3d":aU,"mesh-3d":lU,"point-3d":fv,"polygon-3d":yL,"web-style":wT,cim:IM},errorContext:"symbol"},OHe={base:Hh,key:"type",typeMap:{text:DM,"label-3d":oU},errorContext:"symbol"},jce={base:Hh,key:"type",typeMap:{"line-3d":aU,"mesh-3d":lU,"point-3d":fv,"polygon-3d":yL,"web-style":wT,cim:IM},errorContext:"symbol"},PHe={base:Hh,key:"type",typeMap:{"label-3d":oU},errorContext:"symbol"},rTe=k0(px);function IHe(t){if(!t)return null;const e={};for(const r in t){const i=Ny(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function $He(t){if(!E(t))return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let ih=class extends Fn(Qe){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:kh(),configurable:!0})}normalizeCtorArgs(e,r,i,s){return e&&!e.declaredClass?e:{geometry:e,symbol:r,attributes:i,popupTemplate:s}}set aggregateGeometries(e){const r=this._get("aggregateGeometries");JSON.stringify(r)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const r=this._get("attributes");r!==e&&(this._set("attributes",e),this._notifyLayer("attributes",r,e))}set geometry(e){const r=this._get("geometry");r!==e&&(this._set("geometry",e),this._notifyLayer("geometry",r,e))}set symbol(e){const r=this._get("symbol");r!==e&&(this._set("symbol",e),this._notifyLayer("symbol",r,e))}set visible(e){const r=this._get("visible");r!==e&&(this._set("visible",e),this._notifyLayer("visible",r,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const r of[this.sourceLayer,this.layer])if(r){if("popupTemplate"in r&&r.popupTemplate)return r.popupTemplate;if(e&&"defaultPopupTemplate"in r&&E(r.defaultPopupTemplate))return r.defaultPopupTemplate}return null}getAttribute(e){var r;return(r=this.attributes)==null?void 0:r[e]}setAttribute(e,r){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=r,this._notifyLayer("attributes",i,r,e)}else this.attributes={[e]:r},this._notifyLayer("attributes",void 0,r,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:$He(this.aggregateGeometries),geometry:E(this.geometry)?this.geometry.toJSON():null,symbol:E(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){E(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,r,i,s){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:e,oldValue:r,newValue:i};e==="attributes"&&(n.attributeName=s),this.layer.graphicChanged(n)}};u([d({value:null,json:{read:IHe}})],ih.prototype,"aggregateGeometries",null),u([d({value:null})],ih.prototype,"attributes",null),u([d({value:null,types:yT,json:{read:Ny}})],ih.prototype,"geometry",null),u([d({type:Boolean})],ih.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],ih.prototype,"layer",void 0),u([d({type:PM})],ih.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],ih.prototype,"sourceLayer",void 0),u([d({value:null,types:px})],ih.prototype,"symbol",null),u([d({type:Boolean,value:!0})],ih.prototype,"visible",null),ih=u([j("esri.Graphic")],ih),function(t){t.generateUID=kh}(ih||(ih={}));const pl=ih;var rQ;let m1=rQ=class extends Qe{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new rQ({rotation:this.rotation,scale:this.scale,targetGeometry:E(this.targetGeometry)?this.targetGeometry.clone():null,camera:E(this.camera)?this.camera.clone():null})}};function gz(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:gz}}}}})],m1.prototype,"rotation",void 0),u([Hr("rotation")],m1.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:gz}}}}})],m1.prototype,"scale",void 0),u([d({types:yT,json:{read:Ny,write:!0,origins:{"web-scene":{read:Ny,write:{overridePolicy:gz}}}}})],m1.prototype,"targetGeometry",void 0),u([d({type:nf,json:{write:!0}})],m1.prototype,"camera",void 0),m1=rQ=u([j("esri.Viewpoint")],m1);const z0=m1;function hU(t){return typeof t=="string"?document.getElementById(t):t??null}function iTe(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function Hce(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function qce(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}function xe(t,e,r={}){return Sre(t,e,r,sTe)}function Nl(t,e,r={}){return Sre(t,e,r,nTe)}function Sre(t,e,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(sn(s),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(s=XBe(t,n,r.sync,r.equals),r.initial){const o=t();n(o,o)}return s}function Co(t,e,r,i={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=i.onListenerRemove)==null||h.call(i,s),s=null,n=null)}function l(h){i.once&&i.once&&sn(o),r(h)}const c=xe(t,(h,p)=>{var A;a(),kB(h)&&(s=h,n=nL(h,e,l),(A=i.onListenerAdd)==null||A.call(i,h))},{sync:i.sync,initial:!0});return o=F0(()=>{c.remove(),a()}),o}function Q$(t,e){return LHe(t,nTe,e)}function LHe(t,e,r){if(da(r))return Promise.reject(Yi());const i=t();if(e!=null&&e(i))return Promise.resolve(i);let s=null;function n(){s=sn(s)}return new Promise((o,a)=>{s=S3([ic(r,()=>{n(),a(Yi())}),Sre(t,l=>{n(),o(l)},{sync:!1,once:!0},e??sTe)])})}function sTe(t){return!0}function nTe(t){return!!t}const os={sync:!0},Cr={initial:!0},ao={sync:!0,initial:!0};let iQ=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let e;for(e of this._items);return e}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach(r=>{e(r)||this._items.delete(r)}),this}};var El;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(El||(El={}));let DHe=0;function oTe(){return DHe++}function NHe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function X$(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function Ere(t,e,r,i){if(e.type===El.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==El.INVOKE&&e.type!==El.RESPONSE)return void t.postMessage(e);let s;if(NHe(r)?(s=Wce(r.transferList),e.data=r.result):(s=Wce(i),e.data=r),s){if(Le("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case El.INVOKE:throw o;case El.RESPONSE:return void Ere(t,{type:El.RESPONSE,jobId:e.jobId,error:X$(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function Z$(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Wce(t){if(!t||!t.length)return null;if(Le("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!FHe(r));return e.length?e:null}function FHe(t){return t instanceof ArrayBuffer||t&&t.constructor&&t.constructor.name==="ArrayBuffer"}const kHe={statsWorker:()=>be(()=>import("./statsWorker-ff49edf0.js"),["assets/statsWorker-ff49edf0.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js"]),geometryEngineWorker:()=>be(()=>import("./geometryEngineWorker-8a57eda3.js"),["assets/geometryEngineWorker-8a57eda3.js","assets/geometryEngineJSON-3f330436.js","assets/geometryEngineBase-e1a33b0a.js","assets/json-48e3ea08.js"]),CSVSourceWorker:()=>be(()=>import("./CSVSourceWorker-d6d44098.js"),["assets/CSVSourceWorker-d6d44098.js","assets/json-48e3ea08.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineCapabilities-42e44ded.js","assets/clientSideDefaults-079224aa.js"]),EdgeProcessingWorker:()=>be(()=>import("./EdgeProcessingWorker-f14f4fc3.js"),[]),ElevationSamplerWorker:()=>be(()=>import("./ElevationSamplerWorker-2a800913.js"),["assets/ElevationSamplerWorker-2a800913.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/georeference-fd9fd5ec.js"]),FeatureServiceSnappingSourceWorker:()=>be(()=>import("./FeatureServiceSnappingSourceWorker-9056695d.js"),["assets/FeatureServiceSnappingSourceWorker-9056695d.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineCapabilities-42e44ded.js","assets/symbologySnappingCandidates-1ca086bd.js"]),GeoJSONSourceWorker:()=>be(()=>import("./GeoJSONSourceWorker-04cb0e85.js"),["assets/GeoJSONSourceWorker-04cb0e85.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineCapabilities-42e44ded.js","assets/geojson-990b6c4b.js","assets/clientSideDefaults-079224aa.js","assets/sourceUtils-50bc040a.js"]),LercWorker:()=>be(()=>import("./LercWorker-cf6812e8.js"),[]),MemorySourceWorker:()=>be(()=>import("./MemorySourceWorker-5a81d30a.js"),["assets/MemorySourceWorker-5a81d30a.js","assets/objectIdUtils-789e911a.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineCapabilities-42e44ded.js","assets/clientSideDefaults-079224aa.js","assets/sourceUtils-50bc040a.js"]),PBFDecoderWorker:()=>be(()=>import("./PBFDecoderWorker-39206309.js"),[]),Pipeline:()=>be(()=>import("./Pipeline-26f9de82.js").then(t=>t.P),["assets/Pipeline-26f9de82.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/StreamFeatureManager-7f8638f8.js","assets/quickselect-56c5966e.js","assets/arcadeTimeUtils-e24bc4a7.js","assets/centroid-7ed31885.js","assets/ogcFeatureUtils-8c18333a.js","assets/geojson-990b6c4b.js","assets/clientSideDefaults-079224aa.js","assets/createConnection-e04d52bf.js","assets/enums-c655c737.js","assets/TileInfoView-33538089.js","assets/number-b10bd8f5.js"]),PointCloudWorker:()=>be(()=>import("./PointCloudWorker-4a8319ca.js"),["assets/PointCloudWorker-4a8319ca.js","assets/PointCloudWorkerUtil-b417daf4.js","assets/PointCloudUniqueValueRenderer-54b47eec.js","assets/I3SBinaryReader-42f4b1a5.js"]),RasterWorker:()=>be(()=>import("./RasterWorker-a62a0cdf.js"),["assets/RasterWorker-a62a0cdf.js","assets/dataUtils-1e4194a7.js","assets/colorUtils-c0f43caf.js","assets/utils-9c10af55.js","assets/rasterProjectionHelper-dc28f37d.js"]),SceneLayerSnappingSourceWorker:()=>be(()=>import("./SceneLayerSnappingSourceWorker-0c05d6a4.js"),["assets/SceneLayerSnappingSourceWorker-0c05d6a4.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js"]),SceneLayerWorker:()=>be(()=>import("./SceneLayerWorker-9e63124e.js").then(t=>t.S),["assets/SceneLayerWorker-9e63124e.js","assets/I3SNode-7ba1c1f7.js"]),WFSSourceWorker:()=>be(()=>import("./WFSSourceWorker-5f67eab4.js"),["assets/WFSSourceWorker-5f67eab4.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineCapabilities-42e44ded.js","assets/geojson-990b6c4b.js","assets/sourceUtils-50bc040a.js","assets/wfsUtils-e907aba4.js","assets/xmlUtils-444cb4c0.js"]),WorkerTileHandler:()=>be(()=>import("./WorkerTileHandler-1b39ffa9.js"),["assets/WorkerTileHandler-1b39ffa9.js","assets/TileClipper-ae6eca9e.js","assets/StyleRepository-25ed7020.js","assets/enums-c655c737.js","assets/colorUtils-c0f43caf.js","assets/Rect-98da58d6.js","assets/TurboLine-a89220e1.js","assets/BidiEngine-836b7ef6.js"])},{CLOSE:Yce,ABORT:Qce,INVOKE:Xce,RESPONSE:OR,OPEN_PORT:Zce,ON:BHe}=El,UHe=2;let VHe=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===El.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},tb=class oE{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const s=new oE(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),oE.clients.set(s,i),r.port2}static loadWorker(e){const r=kHe[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new VHe(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:Yce}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){const s=i&&i.signal,n=i&&i.transferList;if(!this._port)return Promise.reject(new ce("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=oTe();return new Promise((a,l)=>{if(da(s))return this._processWork(),void l(Yi());const c=ic(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),sn(p.abortHandle),this._post({type:Qce,jobId:o}),l(Yi()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:Xce,jobId:o,methodName:e,abortable:s!=null},r,n)})}on(e,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:El.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),{remove(){i.port1.postMessage({type:El.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:Zce,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=UHe)return;const e=this._getNextJob();if(!e)return;const{methodName:r,data:i,invokeOptions:s,deferred:n}=e;this.invoke(r,i,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{sn(e.abortHandle),e.reject(Yi(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(e){E(this._schedule)?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=Z$(e);if(r)switch(r.type){case OR:this._onResponseMessage(r);break;case Xce:this._invokeQueue.push(r);break;case Qce:this._onAbortMessage(r);break;case Yce:this._onCloseMessage();break;case Zce:this._onOpenPortMessage(r);break;case BHe:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&oE.clients.get(this)===e&&e.destroy(),oE.clients.delete(this),e&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[r];try{if(!h&&r&&r.includes(".")){const p=r.split(".");for(let A=0;A<p.length-1;A++)c=c[p[A]],h=c[p[A+1]]}if(typeof h!="function")throw new TypeError(`${r} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:OR,jobId:i,error:X$(p)})}Zd(l)?(a.set(i,{controller:o,promise:l}),l.then(p=>{a.has(i)&&(a.delete(i),this._post({type:OR,jobId:i},p))},p=>{a.has(i)&&(a.delete(i),vo(p)||this._post({type:OR,jobId:i,error:X$(p||{message:`Error encountered at method ${r}`})}))})):this._post({type:OR,jobId:i},l)}_onOpenPortMessage(e){new oE(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,n=>{r.postMessage(n)}),s=nL(e.port,"message",n=>{var o;((o=Z$(n))==null?void 0:o.type)===El.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);n.delete(r),this._processWork(),sn(o.abortHandle),i?o.reject(ce.fromJSON(JSON.parse(i))):o.resolve(s)}_post(e,r,i){return Ere(this._port,e,r,i)}};tb.kernelInfo={revision:Uwe,version:Vwe,buildDate:Bwe},tb.clients=new Map;let zHe=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new iQ}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,r){return new Promise((i,s)=>{let n=!0;const o=a=>{di(r.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Zd(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new tb(c,r,()=>this._ongoingJobsQueue.pop()??null),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new tb(l,r,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(e,r,i))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.deferred.reject(Yi(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0}invoke(e,r,i){let s;Array.isArray(i)?(we.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:i}):s=i;const n=Qv();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return n.promise}on(e,r){return Promise.all(this._clientPromises).then(()=>S3(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(r[s]=n.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const aTe=we.getLogger("esri.intl.substitute");function Zm(t,e,r={}){const{format:i={}}=r;return Og(t,s=>GHe(s,e,i))}function GHe(t,e,r){let i,s;const n=t.indexOf(":");if(n===-1?i=t.trim():(i=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!i)return"";const o=sL(i,e);if(o==null)return"";const a=(s?r==null?void 0:r[s]:null)??(r==null?void 0:r[i]);return a?jHe(o,a):s?HHe(o,s):Cre(o)}function jHe(t,e){switch(e.type){case"date":return Lg(t,e.intlOptions);case"number":return Dg(t,e.intlOptions);default:return aTe.warn("missing format descriptor for key {key}"),Cre(t)}}function HHe(t,e){switch(e.toLowerCase()){case"dateformat":return Lg(t);case"numberformat":return Dg(t);default:return aTe.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?Lg(t):/^numberformat/i.test(e)?Dg(t):Cre(t)}}function Cre(t){switch(typeof t){case"string":return t;case"number":return Dg(t);case"boolean":return""+t;default:return t instanceof Date?Lg(t):""}}async function qHe(t,e,r,i){const s=e.exec(r);if(!s)throw new ce("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=XVe(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await Jce(t(c))}catch(p){if(c===l)throw new ce("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p});try{h=await Jce(t(l))}catch(A){throw new ce("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:A})}}return h}async function Jce(t){if(E(Kce.fetchBundleAsset))return Kce.fetchBundleAsset(t);const e=await Ys(t,{responseType:"text"});return JSON.parse(e.data)}let WHe=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return qHe(this.getAssetUrl,this.matcher,e,r)}};function YHe(t){return new WHe(t)}const Kce={};QVe(YHe({pattern:"esri/",location:Zi}));const QHe={};function XHe(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=QHe.baseUrl),e}let ZHe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},h6=class{constructor(){this._dispatcher=new ZHe,this._workerPostMessage({type:El.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){E3(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){E3(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=Z$(e);if(r&&r.type===El.OPEN){const{modulePath:i,jobId:s}=r;let n=await tb.loadWorker(i);n||(n=await be(()=>import(i),[]));const o=tb.connect(n);this._workerPostMessage({type:El.OPENED,jobId:s,data:o})}}};const sQ=we.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:JHe}=El,KHe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,version:r}=configuration.kernelInfo,{revision:t,version:n}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS API for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const i=outgoing.get(r);outgoing.delete(r),o.error?i.reject(JSON.parse(o.error)):i.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let UD,VD;const eue="Failed to create Worker. Fallback to execute module in main thread";async function eqe(){if(!Le("esri-workers")||(Le("mozilla"),0))return tue(new h6);if(!UD&&!VD)try{const e=KHe.split('"{CONFIGURATION}"').join(`'${tqe()}'`);UD=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){VD=e||{}}let t;if(UD)try{t=new Worker(UD,{name:"esri-worker-"+rqe++})}catch{sQ.warn(eue,VD),t=new h6}else sQ.warn(eue,VD),t=new h6;return tue(t)}async function tue(t){return new Promise(e=>{function r(s){const n=Z$(s);n&&n.type===JHe&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(s){s.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),sQ.warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new h6).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function tqe(){let t;if(ls.default!=null){const s={...ls};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(ls));t.assetsPath=Od(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Od(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Yc(),t.has={"esri-csp-restrictions":Le("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":Le("esri-2d-update-debug"),"featurelayer-pbf":Le("featurelayer-pbf"),"featurelayer-simplify-thresholds":Le("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":Le("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":Le("featurelayer-simplify-mobile-factor"),"esri-atomics":Le("esri-atomics"),"esri-shared-array-buffer":Le("esri-shared-array-buffer"),"esri-tiles-debug":Le("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":Le("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":Le("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":Le("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=Od(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Od(t.workers.workerPath):t.workers.workerPath=Od(Zi("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=ls.workers.loaderConfig,r=XHe({baseUrl:e==null?void 0:e.baseUrl,locale:Yc(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{version:Vwe,buildDate:Bwe,revision:Uwe}})}let rqe=0;const{ABORT:rue,INVOKE:iqe,OPEN:sqe,OPENED:nqe,RESPONSE:PR}=El;let oqe=class lTe{static async create(e){const r=await eqe();return new lTe(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),we.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,s=oTe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:nte(i,()=>{this._outJobs.delete(s),this._post({type:rue,jobId:s})})};this._outJobs.set(s,a),this._post({type:sqe,jobId:s,modulePath:e})})}_onMessage(e){const r=Z$(e);if(r)switch(r.type){case nqe:this._onOpenedMessage(r);break;case PR:this._onResponseMessage(r);break;case rue:this._onAbortMessage(r);break;case iqe:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=Z7e[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:PR,jobId:i,error:X$(h)})}Zd(c)?(a.set(i,{controller:o,promise:c}),c.then(h=>{a.has(i)&&(a.delete(i),this._post({type:PR,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),h||(h={message:"Error encountered at method"+r}),vo(h)||this._post({type:PR,jobId:i,error:X$(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:PR,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),sn(s.abortHandle),s.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),sn(n.abortHandle),i?n.reject(ce.fromJSON(JSON.parse(i))):n.resolve(s))}_post(e,r,i){return Ere(this.worker,e,r,i)}},X2=Le("esri-workers-debug")?1:Le("esri-mobile")?Math.min(navigator.hardwareConcurrency-1,3):Le("host-browser")?navigator.hardwareConcurrency-1:0;X2||(X2=Le("safari")&&Le("mac")?7:2);let iue=0;const d6=[];function aqe(){uTe()}async function zD(t,e){const r=new zHe;return await r.open(t,e),r}async function cTe(t,e={}){if(typeof t!="string")throw new ce("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(Le("host-webworker")&&!Le("esri-workers")&&(r="local"),r==="local"){let i=await tb.loadWorker(t);i||(i=await be(()=>import(t),[])),di(e.signal);const s=e.client||i;return zD([tb.connect(i)],{...e,client:s})}if(await uTe(),di(e.signal),r==="dedicated"){const i=iue++%X2;return zD([await d6[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,X2);if(i<X2){const s=new Array(i);for(let n=0;n<i;++n){const o=iue++%X2;s[n]=d6[o].open(t,e)}return zD(s,e)}}return zD(d6.map(i=>i.open(t,e)),e)}let GD=null;async function uTe(){if(GD)return GD;new AbortController;const t=[];for(let e=0;e<X2;e++){const r=oqe.create(e).then(i=>(d6[e]=i,i));t.push(r)}return GD=Promise.all(t),GD}let vg=class extends Ke{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new ts,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,r,i={}){return this._installWatch(e,r,i,xe)}addWhen(e,r,i={}){return this._installWatch(e,r,i,Nl)}addOnCollectionChange(e,r,{initial:i=!1,final:s=!1}={}){const n=++this._handleId;return this._handles.add([Co(e,"after-changes",this._createSyncUpdatingCallback(),os),Co(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>r({added:[],removed:o.toArray()}):void 0})],n),{remove:()=>this._handles.remove(n)}}addPromise(e){if(N(e))return e;const r=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(jD)||this._set("updating",!1))}},r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this._handles.remove(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,r,i={},s){const n=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,r,i);return this._handles.add(o,n),{remove:()=>this._handles.remove(n)}}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),s=xe(e,i,{sync:!0,equals:()=>!1});return this._handles.add(s,r),s}_createSyncUpdatingCallback(){return()=>{this._handles.remove(jD),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(EM(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(jD))}),jD)}}};u([d({readOnly:!0})],vg.prototype,"updating",void 0),vg=u([j("esri.core.support.WatchUpdatingTracking")],vg);const jD=-42,xT=t=>{let e=class extends t{destroy(){var r,i;this.destroyed||((r=this._get("handles"))==null||r.destroy(),(i=this._get("updatingHandles"))==null||i.destroy())}get handles(){return this._get("handles")||new ts}get updatingHandles(){return this._get("updatingHandles")||new vg}};return u([d({readOnly:!0})],e.prototype,"handles",null),u([d({readOnly:!0})],e.prototype,"updatingHandles",null),e=u([j("esri.core.HandleOwner")],e),e};let J$=class extends xT(Ke){};J$=u([j("esri.core.HandleOwner")],J$);let PI=class extends xT(or){constructor(e){super(e),this.handles.add([this.on("before-add",r=>{N(r.item)&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(or.ofType(this.itemType.Type))(e):new or(e)}};function $k(t,e){return{type:t,cast:iwe,set(r){const i=Lx(r,this._get(e),t);i.owner=this,this._set(e,i)}}}u([d()],PI.prototype,"owner",null),PI=u([j("esri.core.support.OwningCollection")],PI);var lP;const Lk=hc()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),hTe=Lk.jsonValues.slice();I$(hTe,"orthometric");const II=hc()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let kf=lP=class extends Qe{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return Lk.write(t,e,r)}readHeightModel(t,e,r){return Lk.read(t)||(r&&r.messages&&r.messages.push(lqe(t,{context:r})),null)}readHeightUnit(t,e,r){return II.read(t)||(r&&r.messages&&r.messages.push(sue(t,{context:r})),null)}readHeightUnitService(t,e,r){return Dwe(t)||II.read(t)||(r&&r.messages&&r.messages.push(sue(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new lP({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=z7e(e);return new lP({heightModel:t.heightModel,heightUnit:r,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new lP;return e.read(t,{origin:"web-scene"}),e}};function sue(t,e){return new Pg("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function lqe(t,e){return new Pg("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([d({type:Lk.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:hTe,default:"ellipsoidal"}}}})],kf.prototype,"heightModel",void 0),u([St("web-scene","heightModel")],kf.prototype,"writeHeightModel",null),u([ft(["web-scene","service"],"heightModel")],kf.prototype,"readHeightModel",null),u([d({type:II.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:II.jsonValues,write:II.write}}}})],kf.prototype,"heightUnit",void 0),u([ft("web-scene","heightUnit")],kf.prototype,"readHeightUnit",null),u([ft("service","heightUnit")],kf.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],kf.prototype,"vertCRS",void 0),u([ft("service","vertCRS",["vertCRS","ellipsoid","geoid"])],kf.prototype,"readVertCRS",null),kf=lP=u([j("esri.geometry.HeightModelInfo")],kf);const NM=kf;function ma(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function qg(t,e,r,i,s,n,o,a,l,c,h,p,A,_,w,T,C){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=p,t[11]=A,t[12]=_,t[13]=w,t[14]=T,t[15]=C,t}function cf(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function zh(t,e){if(t===e){const r=e[1],i=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function FM(t,e){return ul(t,e)||cf(t),t}function ul(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],A=e[10],_=e[11],w=e[12],T=e[13],C=e[14],M=e[15],O=r*a-i*o,$=r*l-s*o,L=r*c-n*o,k=i*l-s*a,F=i*c-n*a,G=s*c-n*l,z=h*T-p*w,Z=h*C-A*w,J=h*M-_*w,te=p*C-A*T,re=p*M-_*T,Ae=A*M-_*C;let ve=O*Ae-$*re+L*te+k*J-F*Z+G*z;return ve?(ve=1/ve,t[0]=(a*Ae-l*re+c*te)*ve,t[1]=(s*re-i*Ae-n*te)*ve,t[2]=(T*G-C*F+M*k)*ve,t[3]=(A*F-p*G-_*k)*ve,t[4]=(l*J-o*Ae-c*Z)*ve,t[5]=(r*Ae-s*J+n*Z)*ve,t[6]=(C*L-w*G-M*$)*ve,t[7]=(h*G-A*L+_*$)*ve,t[8]=(o*re-a*J+c*z)*ve,t[9]=(i*J-r*re-n*z)*ve,t[10]=(w*F-T*L+M*O)*ve,t[11]=(p*L-h*F-_*O)*ve,t[12]=(a*Z-o*te-l*z)*ve,t[13]=(r*te-i*Z+s*z)*ve,t[14]=(T*$-w*k-C*O)*ve,t[15]=(h*k-p*$+A*O)*ve,t):null}function cqe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],A=e[10],_=e[11],w=e[12],T=e[13],C=e[14],M=e[15];return t[0]=a*(A*M-_*C)-p*(l*M-c*C)+T*(l*_-c*A),t[1]=-(i*(A*M-_*C)-p*(s*M-n*C)+T*(s*_-n*A)),t[2]=i*(l*M-c*C)-a*(s*M-n*C)+T*(s*c-n*l),t[3]=-(i*(l*_-c*A)-a*(s*_-n*A)+p*(s*c-n*l)),t[4]=-(o*(A*M-_*C)-h*(l*M-c*C)+w*(l*_-c*A)),t[5]=r*(A*M-_*C)-h*(s*M-n*C)+w*(s*_-n*A),t[6]=-(r*(l*M-c*C)-o*(s*M-n*C)+w*(s*c-n*l)),t[7]=r*(l*_-c*A)-o*(s*_-n*A)+h*(s*c-n*l),t[8]=o*(p*M-_*T)-h*(a*M-c*T)+w*(a*_-c*p),t[9]=-(r*(p*M-_*T)-h*(i*M-n*T)+w*(i*_-n*p)),t[10]=r*(a*M-c*T)-o*(i*M-n*T)+w*(i*c-n*a),t[11]=-(r*(a*_-c*p)-o*(i*_-n*p)+h*(i*c-n*a)),t[12]=-(o*(p*C-A*T)-h*(a*C-l*T)+w*(a*A-l*p)),t[13]=r*(p*C-A*T)-h*(i*C-s*T)+w*(i*A-s*p),t[14]=-(r*(a*C-l*T)-o*(i*C-s*T)+w*(i*l-s*a)),t[15]=r*(a*A-l*p)-o*(i*A-s*p)+h*(i*l-s*a),t}function uqe(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],A=t[11],_=t[12],w=t[13],T=t[14],C=t[15];return(e*o-r*n)*(p*C-A*T)-(e*a-i*n)*(h*C-A*w)+(e*l-s*n)*(h*T-p*w)+(r*a-i*o)*(c*C-A*_)-(r*l-s*o)*(c*T-p*_)+(i*l-s*a)*(c*w-h*_)}function $n(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],A=e[9],_=e[10],w=e[11],T=e[12],C=e[13],M=e[14],O=e[15];let $=r[0],L=r[1],k=r[2],F=r[3];return t[0]=$*i+L*a+k*p+F*T,t[1]=$*s+L*l+k*A+F*C,t[2]=$*n+L*c+k*_+F*M,t[3]=$*o+L*h+k*w+F*O,$=r[4],L=r[5],k=r[6],F=r[7],t[4]=$*i+L*a+k*p+F*T,t[5]=$*s+L*l+k*A+F*C,t[6]=$*n+L*c+k*_+F*M,t[7]=$*o+L*h+k*w+F*O,$=r[8],L=r[9],k=r[10],F=r[11],t[8]=$*i+L*a+k*p+F*T,t[9]=$*s+L*l+k*A+F*C,t[10]=$*n+L*c+k*_+F*M,t[11]=$*o+L*h+k*w+F*O,$=r[12],L=r[13],k=r[14],F=r[15],t[12]=$*i+L*a+k*p+F*T,t[13]=$*s+L*l+k*A+F*C,t[14]=$*n+L*c+k*_+F*M,t[15]=$*o+L*h+k*w+F*O,t}function ju(t,e,r){const i=r[0],s=r[1],n=r[2];if(e===t)t[12]=e[0]*i+e[4]*s+e[8]*n+e[12],t[13]=e[1]*i+e[5]*s+e[9]*n+e[13],t[14]=e[2]*i+e[6]*s+e[10]*n+e[14],t[15]=e[3]*i+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],p=e[5],A=e[6],_=e[7],w=e[8],T=e[9],C=e[10],M=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=p,t[6]=A,t[7]=_,t[8]=w,t[9]=T,t[10]=C,t[11]=M,t[12]=o*i+h*s+w*n+e[12],t[13]=a*i+p*s+T*n+e[13],t[14]=l*i+A*s+C*n+e[14],t[15]=c*i+_*s+M*n+e[15]}return t}function dU(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ih(t,e,r,i){let s,n,o,a,l,c,h,p,A,_,w,T,C,M,O,$,L,k,F,G,z,Z,J,te,re=i[0],Ae=i[1],ve=i[2],ye=Math.sqrt(re*re+Ae*Ae+ve*ve);return ye<dc()?null:(ye=1/ye,re*=ye,Ae*=ye,ve*=ye,s=Math.sin(r),n=Math.cos(r),o=1-n,a=e[0],l=e[1],c=e[2],h=e[3],p=e[4],A=e[5],_=e[6],w=e[7],T=e[8],C=e[9],M=e[10],O=e[11],$=re*re*o+n,L=Ae*re*o+ve*s,k=ve*re*o-Ae*s,F=re*Ae*o-ve*s,G=Ae*Ae*o+n,z=ve*Ae*o+re*s,Z=re*ve*o+Ae*s,J=Ae*ve*o-re*s,te=ve*ve*o+n,t[0]=a*$+p*L+T*k,t[1]=l*$+A*L+C*k,t[2]=c*$+_*L+M*k,t[3]=h*$+w*L+O*k,t[4]=a*F+p*G+T*z,t[5]=l*F+A*G+C*z,t[6]=c*F+_*G+M*z,t[7]=h*F+w*G+O*z,t[8]=a*Z+p*J+T*te,t[9]=l*Z+A*J+C*te,t[10]=c*Z+_*J+M*te,t[11]=h*Z+w*J+O*te,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function z3(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*i,t[5]=o*s+h*i,t[6]=a*s+p*i,t[7]=l*s+A*i,t[8]=c*s-n*i,t[9]=h*s-o*i,t[10]=p*s-a*i,t[11]=A*s-l*i,t}function pU(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],p=e[10],A=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*i,t[1]=o*s-h*i,t[2]=a*s-p*i,t[3]=l*s-A*i,t[8]=n*i+c*s,t[9]=o*i+h*s,t[10]=a*i+p*s,t[11]=l*i+A*s,t}function G3(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],p=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*i,t[1]=o*s+h*i,t[2]=a*s+p*i,t[3]=l*s+A*i,t[4]=c*s-n*i,t[5]=h*s-o*i,t[6]=p*s-a*i,t[7]=A*s-l*i,t}function fU(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function hqe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function jd(t,e,r){if(e===0)return cf(t);let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<dc()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*i,t[2]=l*o*n-a*i,t[3]=0,t[4]=o*a*n-l*i,t[5]=a*a*n+s,t[6]=l*a*n+o*i,t[7]=0,t[8]=o*l*n+a*i,t[9]=a*l*n-o*i,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function dTe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dqe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pTe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fTe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=i+i,l=s+s,c=n+n,h=i*a,p=i*l,A=i*c,_=s*l,w=s*c,T=n*c,C=o*a,M=o*l,O=o*c;return t[0]=1-(_+T),t[1]=p+O,t[2]=A-M,t[3]=0,t[4]=p-O,t[5]=1-(h+T),t[6]=w+C,t[7]=0,t[8]=A+M,t[9]=w-C,t[10]=1-(h+_),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function pqe(t,e){const r=fqe,i=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=i*i+s*s+n*n+o*o;return p>0?(r[0]=2*(a*o+h*i+l*n-c*s)/p,r[1]=2*(l*o+h*s+c*i-a*n)/p,r[2]=2*(c*o+h*n+a*s-l*i)/p):(r[0]=2*(a*o+h*i+l*n-c*s),r[1]=2*(l*o+h*s+c*i-a*n),r[2]=2*(c*o+h*n+a*s-l*i)),fTe(t,e,r),t}const fqe=V();function mqe(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function mTe(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(r*r+i*i+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function gqe(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function Aqe(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,h=o+o,p=s*l,A=s*c,_=s*h,w=n*c,T=n*h,C=o*h,M=a*l,O=a*c,$=a*h,L=i[0],k=i[1],F=i[2];return t[0]=(1-(w+C))*L,t[1]=(A+$)*L,t[2]=(_-O)*L,t[3]=0,t[4]=(A-$)*k,t[5]=(1-(p+C))*k,t[6]=(T+M)*k,t[7]=0,t[8]=(_+O)*F,t[9]=(T-M)*F,t[10]=(1-(p+w))*F,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function yqe(t,e,r,i,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,h=o+o,p=a+a,A=n*c,_=n*h,w=n*p,T=o*h,C=o*p,M=a*p,O=l*c,$=l*h,L=l*p,k=i[0],F=i[1],G=i[2],z=s[0],Z=s[1],J=s[2],te=(1-(T+M))*k,re=(_+L)*k,Ae=(w-$)*k,ve=(_-L)*F,ye=(1-(A+M))*F,le=(C+O)*F,W=(w+$)*G,q=(C-O)*G,X=(1-(A+T))*G;return t[0]=te,t[1]=re,t[2]=Ae,t[3]=0,t[4]=ve,t[5]=ye,t[6]=le,t[7]=0,t[8]=W,t[9]=q,t[10]=X,t[11]=0,t[12]=r[0]+z-(te*z+ve*Z+W*J),t[13]=r[1]+Z-(re*z+ye*Z+q*J),t[14]=r[2]+J-(Ae*z+le*Z+X*J),t[15]=1,t}function _qe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,p=i*a,A=s*o,_=s*a,w=s*l,T=n*o,C=n*a,M=n*l;return t[0]=1-p-w,t[1]=h+M,t[2]=A-C,t[3]=0,t[4]=h-M,t[5]=1-c-w,t[6]=_+T,t[7]=0,t[8]=A+C,t[9]=_-T,t[10]=1-c-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function gTe(t,e,r,i,s,n,o){const a=1/(r-e),l=1/(s-i),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(s+i)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function vqe(t,e,r,i,s){const n=1/Math.tan(e/2);let o;return t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(i-s),t[10]=(s+i)*o,t[14]=2*s*i*o):(t[10]=-1,t[14]=-2*i),t}function bqe(t,e,r,i){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function ATe(t,e,r,i,s,n,o){const a=1/(e-r),l=1/(i-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(s+i)*l,t[14]=(o+n)*c,t[15]=1,t}function mU(t,e,r,i){let s,n,o,a,l,c,h,p,A,_;const w=e[0],T=e[1],C=e[2],M=i[0],O=i[1],$=i[2],L=r[0],k=r[1],F=r[2],G=dc();return Math.abs(w-L)<G&&Math.abs(T-k)<G&&Math.abs(C-F)<G?cf(t):(h=w-L,p=T-k,A=C-F,_=1/Math.sqrt(h*h+p*p+A*A),h*=_,p*=_,A*=_,s=O*A-$*p,n=$*h-M*A,o=M*p-O*h,_=Math.sqrt(s*s+n*n+o*o),_?(_=1/_,s*=_,n*=_,o*=_):(s=0,n=0,o=0),a=p*o-A*n,l=A*s-h*o,c=h*n-p*s,_=Math.sqrt(a*a+l*l+c*c),_?(_=1/_,a*=_,l*=_,c*=_):(a=0,l=0,c=0),t[0]=s,t[1]=a,t[2]=h,t[3]=0,t[4]=n,t[5]=l,t[6]=p,t[7]=0,t[8]=o,t[9]=c,t[10]=A,t[11]=0,t[12]=-(s*w+n*T+o*C),t[13]=-(a*w+l*T+c*C),t[14]=-(h*w+p*T+A*C),t[15]=1,t)}function yTe(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let h=s-r[0],p=n-r[1],A=o-r[2],_=h*h+p*p+A*A;_>0&&(_=1/Math.sqrt(_),h*=_,p*=_,A*=_);let w=l*A-c*p,T=c*h-a*A,C=a*p-l*h;return _=w*w+T*T+C*C,_>0&&(_=1/Math.sqrt(_),w*=_,T*=_,C*=_),t[0]=w,t[1]=T,t[2]=C,t[3]=0,t[4]=p*C-A*T,t[5]=A*w-h*C,t[6]=h*T-p*w,t[7]=0,t[8]=h,t[9]=p,t[10]=A,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function wqe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function xqe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function Tqe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function _Te(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Sqe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Eqe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function vTe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Mre(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],A=t[10],_=t[11],w=t[12],T=t[13],C=t[14],M=t[15],O=e[0],$=e[1],L=e[2],k=e[3],F=e[4],G=e[5],z=e[6],Z=e[7],J=e[8],te=e[9],re=e[10],Ae=e[11],ve=e[12],ye=e[13],le=e[14],W=e[15],q=dc();return Math.abs(r-O)<=q*Math.max(1,Math.abs(r),Math.abs(O))&&Math.abs(i-$)<=q*Math.max(1,Math.abs(i),Math.abs($))&&Math.abs(s-L)<=q*Math.max(1,Math.abs(s),Math.abs(L))&&Math.abs(n-k)<=q*Math.max(1,Math.abs(n),Math.abs(k))&&Math.abs(o-F)<=q*Math.max(1,Math.abs(o),Math.abs(F))&&Math.abs(a-G)<=q*Math.max(1,Math.abs(a),Math.abs(G))&&Math.abs(l-z)<=q*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(c-Z)<=q*Math.max(1,Math.abs(c),Math.abs(Z))&&Math.abs(h-J)<=q*Math.max(1,Math.abs(h),Math.abs(J))&&Math.abs(p-te)<=q*Math.max(1,Math.abs(p),Math.abs(te))&&Math.abs(A-re)<=q*Math.max(1,Math.abs(A),Math.abs(re))&&Math.abs(_-Ae)<=q*Math.max(1,Math.abs(_),Math.abs(Ae))&&Math.abs(w-ve)<=q*Math.max(1,Math.abs(w),Math.abs(ve))&&Math.abs(T-ye)<=q*Math.max(1,Math.abs(T),Math.abs(ye))&&Math.abs(C-le)<=q*Math.max(1,Math.abs(C),Math.abs(le))&&Math.abs(M-W)<=q*Math.max(1,Math.abs(M),Math.abs(W))}function Rre(t){const e=dc(),r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}function gU(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const Cqe=$n,Mqe=_Te;Object.freeze(Object.defineProperty({__proto__:null,add:Tqe,adjoint:cqe,copy:ma,determinant:uqe,equals:Mre,exactEquals:vTe,frob:xqe,fromQuat:_qe,fromQuat2:pqe,fromRotation:jd,fromRotationTranslation:fTe,fromRotationTranslationScale:Aqe,fromRotationTranslationScaleOrigin:yqe,fromScaling:hqe,fromTranslation:fU,fromXRotation:dTe,fromYRotation:dqe,fromZRotation:pTe,frustum:gTe,getRotation:gqe,getScaling:mTe,getTranslation:mqe,hasIdentityRotation:gU,identity:cf,invert:ul,invertOrIdentity:FM,isOrthoNormal:Rre,lookAt:mU,mul:Cqe,multiply:$n,multiplyScalar:Sqe,multiplyScalarAndAdd:Eqe,ortho:ATe,perspective:vqe,perspectiveFromFieldOfView:bqe,rotate:Ih,rotateX:z3,rotateY:pU,rotateZ:G3,scale:dU,set:qg,str:wqe,sub:Mqe,subtract:_Te,targetTo:yTe,translate:ju,transpose:zh},Symbol.toStringTag,{value:"Module"}));let Az,Se=null;function bTe(){return!!Se}function Rqe(){return!!Le("esri-wasm")}function wTe(){return Az||(Az=be(()=>import("./pe-wasm-67793c2f.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>Zi(`esri/geometry/support/${e}`)})).then(t=>{TTe(t)}),Az)}var nQ,qn,K$;(function(t){function e(n,o,a){Se.ensureCache.prepare();const l=I2(a),c=a===l,h=Se.ensureFloat64(l),p=Se._pe_geog_to_proj(Se.getPointer(n),o,h);return p&&K1(a,o,h,c),p}function r(n,o,a,l){switch(l){case qn.PE_TRANSFORM_P_TO_G:return i(n,o,a);case qn.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){Se.ensureCache.prepare();const c=I2(a),h=a===c,p=Se.ensureFloat64(c),A=Se._pe_proj_to_geog_center(Se.getPointer(n),o,p,l);return A&&K1(a,o,p,h),A}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=s})(nQ||(nQ={})),function(t){function e(){t.PE_BUFFER_MAX=Se.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=Se.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=Se.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=Se.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=Se.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=Se.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=Se.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=Se.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=Se.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=Se.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=Se.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=Se.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=Se.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=Se.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=Se.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=Se.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=Se.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=Se.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=Se.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=Se.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=Se.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=Se.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=Se.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=Se.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=Se.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=Se.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=Se.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=Se.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=Se.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=Se.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(qn||(qn={})),function(t){const e={},r={},i=_=>{if(_){const w=_.getType();switch(w){case qn.PE_TYPE_GEOGCS:_=Se.castObject(_,Se.PeGeogcs);break;case qn.PE_TYPE_PROJCS:_=Se.castObject(_,Se.PeProjcs);break;case qn.PE_TYPE_GEOGTRAN:_=Se.castObject(_,Se.PeGeogtran);break;default:w&qn.PE_TYPE_UNIT&&(_=Se.castObject(_,Se.PeUnit))}}return _};function s(){Se.PeFactory.prototype.initialize(null)}function n(_){return o(qn.PE_TYPE_COORDSYS,_)}function o(_,w){let T=null,C=e[_];if(C||(C={},e[_]=C),C.hasOwnProperty(String(w)))T=C[w];else{const M=Se.PeFactory.prototype.factoryByType(_,w);Se.compare(M,Se.NULL)||(T=M,C[w]=T)}return T=i(T),T}function a(_,w){let T=null,C=r[_];if(C||(C={},r[_]=C),C.hasOwnProperty(w))T=C[w];else{const M=Se.PeFactory.prototype.fromString(_,w);Se.compare(M,Se.NULL)||(T=M,C[w]=T)}return T=i(T),T}function l(_){return o(qn.PE_TYPE_GEOGCS,_)}function c(_){return o(qn.PE_TYPE_GEOGTRAN,_)}function h(_){return Se.PeFactory.prototype.getCode(_)}function p(_){return o(qn.PE_TYPE_PROJCS,_)}function A(_){return o(qn.PE_TYPE_UNIT,_)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=p,t.unit=A}(K$||(K$={}));let xTe=null;var Dk,oQ,aQ,fx,_h,e4,ky,Nk,lQ;function TTe(t){function e(n,o,a){n[o]=a(n[o])}Se=t,qn.init(),Dk.init(),_h.init(),ky.init(),Nk.init(),xTe=class extends Se.PeGCSExtent{destroy(){Se.destroy(this)}};const r=[Se.PeDatum,Se.PeGeogcs,Se.PeGeogtran,Se.PeObject,Se.PeParameter,Se.PePrimem,Se.PeProjcs,Se.PeSpheroid,Se.PeUnit];for(const n of r)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(qn.PE_NAME_MAX))});for(const n of[Se.PeGeogtran,Se.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(qn.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=Se.getValue(l,"*");a[c]=h?Se.wrapPointer(h,Se.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(Se.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return K1(a,o,n.call(this)),a}),e(Se.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=Se._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!Se.compare(l,Se.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=Se.getPointer(l);for(let p=1;p<c;p++)a.push(Se.wrapPointer(h+o*p,Se.PeGTlistExtendedGTs))}}return a}});const i=Se._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!Se.compare(l,Se.NULL)){a=[l];const c=l.getNump();if(c>1){const h=Se.getPointer(l);for(let p=1;p<c;p++)a.push(Se.wrapPointer(h+i*p,Se.PeHorizon))}}return o.set(n,a),a};e(Se.PeProjcs.prototype,"horizonGcsGenerate",s),e(Se.PeProjcs.prototype,"horizonPcsGenerate",s),Se.PeObject.prototype.toString=function(n=qn.PE_STR_OPTS_NONE){Se.ensureCache.prepare();const o=Se.getPointer(this),a=Se.ensureInt8(new Array(qn.PE_BUFFER_MAX));return Se.UTF8ToString(Se._pe_object_to_string_ext(o,n,a))}}function rA(t){if(!t)return;const e=Se.getClass(t);if(!e)return;const r=Se.getCache(e);if(!r)return;const i=Se.getPointer(t);i&&delete r[i]}function HD(t,e){const r=[],i=new Array(e);for(let s=0;s<t;s++)r.push(Se.ensureInt8(i));return r}function I2(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function K1(t,e,r,i=!1){if(i)for(let s=0;s<2*e;s++)t[s]=Se.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=Se.getValue(r,"double"),t[n][1]=Se.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=Se.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=Se._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let h=null;const p=new Se.PeInteger(c);try{const A=Se.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[A],c>1)){const _=Se.getPointer(A);for(let w=1;w<c;w++)h.push(Se.wrapPointer(_+e*w,Se.PeGTlistExtendedEntry))}}finally{Se.destroy(p)}return h}t.init=r,t.getGTlist=i})(Dk||(Dk={})),function(t){function e(r){if(r&&r.length){for(const i of r)rA(i),i.getEntries().forEach(s=>{rA(s);const n=s.getGeogtran();rA(n),n.getParameters().forEach(rA),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{rA(o);const a=o.getDatum();rA(a),rA(a.getSpheroid()),rA(o.getPrimem()),rA(o.getUnit())})});Se.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(oQ||(oQ={})),function(t){function e(r,i,s,n,o){Se.ensureCache.prepare();const a=I2(s),l=s===a,c=Se.ensureFloat64(a);let h=0;n&&(h=Se.ensureFloat64(n));const p=Se._pe_geog_to_geog(Se.getPointer(r),i,c,h,o);return p&&K1(s,i,c,l),p}t.geogToGeog=e}(aQ||(aQ={})),function(t){const e=(c,h,p,A,_,w)=>{let T,C;switch(Se.ensureCache.prepare(),c){case"dd":T=Se._pe_geog_to_dd,C=qn.PE_DD_MAX;break;case"ddm":T=Se._pe_geog_to_ddm,C=qn.PE_DDM_MAX;break;case"dms":T=Se._pe_geog_to_dms,C=qn.PE_DMS_MAX}let M=0;h&&(M=Se.getPointer(h));const O=I2(A),$=Se.ensureFloat64(O),L=HD(p,C),k=T(M,p,$,_,Se.ensureInt32(L));if(k)for(let F=0;F<p;F++)w[F]=Se.UTF8ToString(L[F]);return k},r=(c,h,p,A,_)=>{let w;switch(Se.ensureCache.prepare(),c){case"dd":w=Se._pe_dd_to_geog;break;case"ddm":w=Se._pe_ddm_to_geog;break;case"dms":w=Se._pe_dms_to_geog}let T=0;h&&(T=Se.getPointer(h));const C=A.map(L=>Se.ensureString(L)),M=Se.ensureInt32(C),O=Se.ensureFloat64(new Array(2*p)),$=w(T,p,M,O);return $&&K1(_,p,O),$};function i(c,h,p,A,_){return e("dms",c,h,p,A,_)}function s(c,h,p,A){return r("dms",c,h,p,A)}function n(c,h,p,A,_){return e("ddm",c,h,p,A,_)}function o(c,h,p,A){return r("ddm",c,h,p,A)}function a(c,h,p,A,_){return e("dd",c,h,p,A,_)}function l(c,h,p,A){return r("dd",c,h,p,A)}t.geogToDms=i,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(fx||(fx={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=Se.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=Se.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=Se.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=Se.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=Se.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,h){Se.ensureCache.prepare();let p=0;s&&(p=Se.getPointer(s));const A=I2(o),_=Se.ensureFloat64(A),w=HD(n,qn.PE_MGRS_MAX),T=Se.ensureInt32(w),C=Se._pe_geog_to_mgrs_extended(p,n,_,a,l,c,T);if(C)for(let M=0;M<n;M++)h[M]=Se.UTF8ToString(w[M]);return C}function i(s,n,o,a,l){Se.ensureCache.prepare();let c=0;s&&(c=Se.getPointer(s));const h=o.map(w=>Se.ensureString(w)),p=Se.ensureInt32(h),A=Se.ensureFloat64(new Array(2*n)),_=Se._pe_mgrs_to_geog_extended(c,n,p,a,A);return _&&K1(l,n,A),_}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(_h||(_h={})),function(t){function e(i,s,n,o,a,l,c){Se.ensureCache.prepare();let h=0;i&&(h=Se.getPointer(i));const p=I2(n),A=Se.ensureFloat64(p),_=HD(s,qn.PE_MGRS_MAX),w=Se.ensureInt32(_),T=Se._pe_geog_to_usng(h,s,A,o,a,l,w);if(T)for(let C=0;C<s;C++)c[C]=Se.UTF8ToString(_[C]);return T}function r(i,s,n,o){Se.ensureCache.prepare();let a=0;i&&(a=Se.getPointer(i));const l=n.map(A=>Se.ensureString(A)),c=Se.ensureInt32(l),h=Se.ensureFloat64(new Array(2*s)),p=Se._pe_usng_to_geog(a,s,c,h);return p&&K1(o,s,h),p}t.geogToUsng=e,t.usngToGeog=r}(e4||(e4={})),function(t){function e(){t.PE_UTM_OPTS_NONE=Se.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=Se.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=Se.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){Se.ensureCache.prepare();let c=0;s&&(c=Se.getPointer(s));const h=I2(o),p=Se.ensureFloat64(h),A=HD(n,qn.PE_UTM_MAX),_=Se.ensureInt32(A),w=Se._pe_geog_to_utm(c,n,p,a,_);if(w)for(let T=0;T<n;T++)l[T]=Se.UTF8ToString(A[T]);return w}function i(s,n,o,a,l){Se.ensureCache.prepare();let c=0;s&&(c=Se.getPointer(s));const h=o.map(w=>Se.ensureString(w)),p=Se.ensureInt32(h),A=Se.ensureFloat64(new Array(2*n)),_=Se._pe_utm_to_geog(c,n,p,a,A);return _&&K1(l,n,A),_}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(ky||(ky={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=Se.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=Se.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=Se.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=Se.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=Se.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=r,t.generate=i}(Nk||(Nk={})),function(t){function e(){return Se.PeVersion.prototype.version_string()}t.versionString=e}(lQ||(lQ={}));const Oqe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return nQ},get PeDefs(){return qn},get PeFactory(){return K$},get PeGCSExtent(){return xTe},get PeGTTransformations(){return aQ},get PeGTlistExtended(){return Dk},get PeGTlistExtendedEntry(){return oQ},get PeNotationDms(){return fx},get PeNotationMgrs(){return _h},get PeNotationUsng(){return e4},get PeNotationUtm(){return ky},get PePCSInfo(){return Nk},get PeVersion(){return lQ},_init:TTe,get _pe(){return Se},isLoaded:bTe,isSupported:Rqe,load:wTe},Symbol.toStringTag,{value:"Module"})),wFt=Math.PI/180,xFt=/SPHEROID\[([^\]]+)]/i,x_=gi.radius,xf=gi.eccentricitySquared,Pqe={a1:x_*xf,a2:x_*xf*x_*xf,a3:x_*xf*xf/2,a4:x_*xf*x_*xf*2.5,a5:x_*xf+x_*xf*xf/2,a6:1-xf},TFt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:gi.radius,f:gi.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Dy.radius,f:Dy.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:_g.radius,f:_g.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:_g.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let qD=0,yz=class cQ{static fromGE(e){const r=new cQ;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=qD++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=qD++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=qD++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=qD++}getInverse(){const e=new cQ;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},uQ=class cP{static cacheKey(e,r){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(e){const r=new cP;let i="";for(const s of e.steps){const n=yz.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const r of e.steps)r instanceof yz?this.steps.push(r):this.steps.push(new yz({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new cP;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[cP.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[cP.cacheKey(e,r)];return s===void 0?null:s}};function STe(t,e,r){if(N(e)||N(r)||r.vcsWkid||Po(e,r))return null;const i=Fx(e)/Fx(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>Iqe(s,i);case"polyline":case"esriGeometryPolyline":return s=>Lqe(s,i);case"polygon":case"esriGeometryPolygon":return s=>$qe(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>Dqe(s,i);case"extent":case"esriGeometryExtent":return s=>Nqe(s,i);default:return null}}function Iqe(t,e){t&&t.z!=null&&(t.z*=e)}function $qe(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function Lqe(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function Dqe(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function Nqe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let kv=null,t4=null,_z=null,vz={};const ETe=new fte;function AU(){return!!kv&&bTe()}function r4(t){return N(_z)&&(_z=Promise.all([wTe(),be(()=>import("./geometryEngineBase-e1a33b0a.js"),[]).then(e=>e.g),be(()=>import("./hydrated-ad302ece.js"),[])])),_z.then(([,e,{hydratedAdapter:r}])=>{di(t),t4=r,kv=e.default,kv._enableProjection(Oqe),ETe.notify()})}function TT(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:nue(t4,t,t[0].spatialReference,e,r,i):nue(t4,[t],t.spatialReference,e,r,i)[0]}function nue(t,e,r,i,s=null,n=null){if(N(r)||N(i))return e;if(jx(r,i,s))return e.map(o=>CTe(o,r,i));if(N(s)){const o=uQ.cacheKey(r,i);vz[o]!==void 0?s=vz[o]:(s=kqe(r,i,void 0),N(s)&&(s=new uQ),vz[o]=s)}if(N(kv)||N(t))throw new Ore;return E(n)?kv._project(t,e,r,i,s,n):kv._project(t,e,r,i,s)}function SFt(t,e){const r=Fqe([t],e);return E(r.pending)?{pending:r.pending,geometry:null}:E(r.geometries)?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function Fqe(t,e){if(!AU()){for(const r of t)if(E(r)&&!Po(r.spatialReference,e)&&tc(r.spatialReference)&&tc(e)&&!jx(r.spatialReference,e))return mi(ETe),{pending:r4(),geometries:null}}return{pending:null,geometries:t.map(r=>N(r)?null:Po(r.spatialReference,e)?r:tc(r.spatialReference)&&tc(e)?Bqe(r,e):null)}}function kqe(t,e,r=null){if(N(t)||N(e))return null;if(N(kv)||N(t4))throw new Ore;const i=kv._getTransformation(t4,t,e,r,r==null?void 0:r.spatialReference);return i!==null?uQ.fromGE(i):null}class Ore extends ce{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var me;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(me||(me={}));function Bqe(t,e){try{const r=TT(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=STe(r.type,t.spatialReference,e);return E(i)&&i(r),r}catch(r){if(!(r instanceof Ore))throw r;return null}}function jx(t,e,r){return!r&&(!!Po(t,e)||tc(t)&&tc(e)&&!!Lre(t,e,Nre))}async function Uqe(t,e,r,i){if(AU())return jle(i);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(!jx(s,n,o))return r4(i)}else if(!jx(t,e,r))return r4(i);return jle(i)}function EFt(t,e){switch(Lre(t,e,Nre)){case js:return"copy3";case gv:return"wgs84ToSphericalECEF";case Hx:return"wgs84ToWebMercator";case mv:return"wgs84ToPlateCarree";case yv:return"wgs84ToWGS84ECEF";case mx:return"webMercatorToWGS84";case $Te:return"webMercatorToSphericalECEF";case LTe:return"webMercatorToWGS84ECEF";case DTe:return"webMercatorToPlateCarree";case _v:return"wgs84ECEFToWGS84";case kTe:return"wgs84ECEFToSphericalECEF";case BTe:return"wgs84ECEFToWebMercator";case Av:return"sphericalECEFToWGS84";case NTe:return"sphericalECEFToWebMercator";case fQ:return"sphericalMarsPCPFToMars2000";case pQ:return"sphericalMoonPCPFToMoon2000";case FTe:return"sphericalECEFToWGS84ECEF";case dQ:return"mars2000ToSphericalPCPF";case hQ:return"moon2000ToSphericalPCPF";default:return null}}function CTe(t,e,r){return t?"x"in t?MTe(t,e,new Gt,r,0):"xmin"in t?jqe(t,e,new Ki,r,0):"rings"in t?RTe(t,e,new sf,r,0):"paths"in t?Gqe(t,e,new y0,r,0):"points"in t?zqe(t,e,new dL,r,0):null:null}function Vqe(t,e,r=e.spatialReference,i=0){return E(r)&&E(t.spatialReference)&&E(MTe(t,t.spatialReference,e,r,i))}function MTe(t,e,r,i,s){as[0]=t.x,as[1]=t.y;const n=t.z;return as[2]=n!==void 0?n:s,Dn(as,e,0,as,i,0,1)?(r.x=as[0],r.y=as[1],r.spatialReference=i,n===void 0?(r.z=void 0,r.hasZ=!1):(r.z=as[2],r.hasZ=!0),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function zqe(t,e,r,i,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!Dn(h,e,0,h,i,0,c))return null;for(let p=0;p<c;++p){const A=3*p,_=h[A],w=h[A+1];o&&a?l.push([_,w,h[A+2],n[p][3]]):o?l.push([_,w,h[A+2]]):a?l.push([_,w,n[p][2]]):l.push([_,w])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function Gqe(t,e,r,i,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];return PTe(n,o??!1,a??!1,e,l,i,s)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function CFt(t,e,r=e.spatialReference,i=0){return E(t.spatialReference)&&E(r)&&E(RTe(t,t.spatialReference,e,r,i))}function RTe(t,e,r,i,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];return PTe(n,o??!1,a??!1,e,l,i,s)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function jqe(t,e,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t;return oue(n,o,c?t.zmin:s,e,as,i)?(r.xmin=as[0],r.ymin=as[1],c&&(r.zmin=as[2]),oue(a,l,c?t.zmax:s,e,as,i)?(r.xmax=as[0],r.ymax=as[1],c&&(r.zmax=as[2]),h&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null):null}function rb(t,e,r){if(N(e)||N(r))return null;const i=new Gt({spatialReference:r});return Dn(t,e,0,as,r,0,1)?(i.x=as[0],i.y=as[1],i.z=as[2],i):null}function OTe(t,e,r){return Dn(t,e,0,as,r.spatialReference,0,1)?(r.x=as[0],r.y=as[1],r.z=as[2],r):null}function Fl(t,e,r,i=0){as[0]=t.x,as[1]=t.y;const s=t.z;return as[2]=s!==void 0?s:i,Dn(as,t.spatialReference,0,e,r,0,1)}function oue(t,e,r,i,s,n){return On[0]=t,On[1]=e,On[2]=r,Dn(On,i,0,s,n,0,1)}function Ba(t,e,r,i){return!(N(e)||N(i)||t.length<2)&&(t.length===2&&(On[0]=t[0],On[1]=t[1],On[2]=0,t=On),Dn(t,e,0,r,i,0,1))}function Hqe(t,e){as[0]=t.x,as[1]=t.y;const r=t.z;return as[2]=r!==void 0?r:0,qqe(as,t.spatialReference,e)}function qqe(t,e,r){return Wqe(t,e,r)}function Wqe(t,e,r){if(N(e))return!1;const i=ib(e,_U),s=dg[i][me.WGS84_COMPARABLE_LON_LAT];return!N(s)&&(s(t,0,On,0),r!==On&&(r[0]=On[0],r[1]=On[1],r.length>2&&(r[2]=On[2])),!0)}function Dn(t,e,r,i,s,n,o=1){const a=Lre(e,s,Nre);if(N(a))return!1;if(a===js){if(t===i&&r===n)return!0;const c=r+3*o;for(let h=r,p=n;h<c;h++,p++)i[p]=t[h];return!0}const l=r+3*o;for(let c=r,h=n;c<l;c+=3,h+=3)a(t,c,i,h);return!0}function MFt(t,e,r,i,s){Oe(as,t),ke(WD,t,e),Ba(as,r,as,s),Ba(WD,r,WD,s),Be(i,WD,as),qe(i,i)}function PTe(t,e,r,i,s,n,o=0){const a=new Array;for(const c of t)for(const h of c)a.push(h[0],h[1],e?h[2]:o);if(!Dn(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of t){const h=new Array;for(const p of c)e&&r?h.push([a[l++],a[l++],a[l++],p[3]]):e?h.push([a[l++],a[l++],a[l++]]):r?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function RFt(t,e,r,i){if(N(e)||N(i))return!1;const s=UTe(e,i,rWe);if(s.projector===js)return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],!0;if(N(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===me.WEB_MERCATOR){const a=dg[n.spatialReferenceId][me.WGS84];return!N(a)&&(a(t,0,r0,0),Hx(r0,0,r,0),r[3]=aue(r0[1],t[2],t[3],gi.radius),!0)}if(n.spatialReferenceId!==me.WGS84&&n.spatialReferenceId!==me.CGCS2000||o.spatialReferenceId!==me.PLATE_CARREE){s.projector(t,0,r,0);const a=n.metersPerUnit??1,l=o.metersPerUnit??1;r[3]=t[3]*a/l}else{const a=dg[n.spatialReferenceId][me.SPHERICAL_ECEF],l=dg[me.SPHERICAL_ECEF][me.PLATE_CARREE];let c=t[3];E(a)&&E(l)&&(c=aue(t[1],t[2],t[3],gi.radius)),s.projector(t,0,r,0),r[3]=c}return!0}function aue(t,e,r,i){const s=i+e;if(s<i/2||r>s)return Number.MAX_VALUE;const n=Math.abs(b0*t)+Math.asin(r/s);return n>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(n)}function yU(t,e,r,i){return t!=null&&(Po(e,i)?(Fy(r,t),!0):(On[0]=t[0],On[1]=t[1],On[2]=0,!!Dn(On,e,0,On,i,0,1)&&(r[0]=On[0],r[1]=On[1],On[0]=t[2],On[1]=t[3],On[2]=0,!!Dn(On,e,0,On,i,0,1)&&(r[2]=On[0],r[3]=On[1],!0))))}function OFt(t,e,r,i){if(N(e)||N(i))return!1;const s=ib(e,_U),n=ib(i,VTe);if(s===n&&s!==me.UNKNOWN||Po(e,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(s===me.SPHERICAL_ECEF){const o=st(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/gi.radius;if(n===me.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(n===me.WGS84||n===me.CGCS2000){const c=$I;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(s===me.PLATE_CARREE){if(n===me.WGS84||n===me.CGCS2000)return r[0]=$I,r[1]=$I,r[2]=1,!0;if(n===me.WEB_MERCATOR){const o=t[1]/gi.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function G0(t,e,r,i){if(N(t)||N(i))return!1;const s=ib(t,_U),n=ib(i,VTe);if(s===n&&!lue(n)&&(s!==me.UNKNOWN||Po(t,i)))return fU(r,e),!0;if(lue(n)){const o=dg[s][me.LON_LAT],a=dg[me.LON_LAT][n];return!N(o)&&!N(a)&&(o(e,0,r0,0),a(r0,0,T_,0),ITe(b0*r0[0],b0*r0[1],r),r[12]=T_[0],r[13]=T_[1],r[14]=T_[2],!0)}if((n===me.WEB_MERCATOR||n===me.PLATE_CARREE)&&(s===me.WGS84||s===me.CGCS2000&&n===me.PLATE_CARREE||s===me.SPHERICAL_ECEF||s===me.WEB_MERCATOR)){const o=dg[s][me.LON_LAT],a=dg[me.LON_LAT][n];return!N(o)&&!N(a)&&(o(e,0,r0,0),a(r0,0,T_,0),s===me.SPHERICAL_ECEF?Yqe(b0*r0[0],b0*r0[1],r):cf(r),r[12]=T_[0],r[13]=T_[1],r[14]=T_[2],!0)}return!1}function lue(t){return t===me.SPHERICAL_ECEF||t===me.SPHERICAL_MARS_PCPF||t===me.SPHERICAL_MOON_PCPF}function ITe(t,e,r){const i=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function Yqe(t,e,r){return ITe(t,e,r),zh(r,r),r}function ib(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=tu(t,1)),t.wkt===Cwe.wkt?e.spatialReferenceId=me.SPHERICAL_ECEF:k$(t)?e.spatialReferenceId=me.WGS84:Nx(t)?e.spatialReferenceId=me.WEB_MERCATOR:Ete(t)?e.spatialReferenceId=me.PLATE_CARREE:t.wkt===Mwe.wkt?e.spatialReferenceId=me.WGS84_ECEF:t.wkid===zp.CGCS2000?e.spatialReferenceId=me.CGCS2000:t.wkt===Ote.wkt?e.spatialReferenceId=me.SPHERICAL_MARS_PCPF:t.wkt===Pte.wkt?e.spatialReferenceId=me.SPHERICAL_MOON_PCPF:Gg(t)?e.spatialReferenceId=me.GCSMARS2000:jg(t)?e.spatialReferenceId=me.GCSMOON2000:e.spatialReferenceId=me.UNKNOWN):me.UNKNOWN}function js(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function mx(t,e,r,i){r[i++]=j3*(t[e++]/gi.radius),r[i++]=j3*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/gi.radius))),r[i]=t[e]}function $Te(t,e,r,i){mx(t,e,r,i),gv(r,i,r,i)}function LTe(t,e,r,i){mx(t,e,r,i),yv(r,i,r,i)}function Pre(t,e,r,i,s){const n=.4999999*Math.PI,o=ze(b0*t[e+1],-n,n),a=Math.sin(o);r[i++]=b0*t[e]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function Hx(t,e,r,i){Pre(t,e,r,i,gi)}const cue=gi.radius*Math.PI/180,$I=180/(gi.radius*Math.PI);function mv(t,e,r,i){r[i]=t[e]*cue,r[i+1]=t[e+1]*cue,r[i+2]=t[e+2]}function Z2(t,e,r,i){r[i]=t[e]*$I,r[i+1]=t[e+1]*$I,r[i+2]=t[e+2]}function DTe(t,e,r,i){mx(t,e,r,i),mv(r,i,r,i)}function Qqe(t,e,r,i){_v(t,e,r,i),mv(r,i,r,i)}function Xqe(t,e,r,i){Av(t,e,r,i),mv(r,i,r,i)}function Zqe(t,e,r,i){Z2(t,e,r,i),gv(r,i,r,i)}function Jqe(t,e,r,i){Z2(t,e,r,i),Hx(r,i,r,i)}function Kqe(t,e,r,i){Z2(t,e,r,i),yv(r,i,r,i)}function qx(t){if(N(t))return!1;const e=ib(t,_U);return!!dg[e][me.WGS84_COMPARABLE_LON_LAT]}function eWe(t,e,r,i){const s=Math.cos(r);t[0]=Math.cos(e)*s*i,t[1]=Math.sin(e)*s*i,t[2]=Math.sin(r)*i}function Ire(t,e,r,i,s){const n=s+t[e+2],o=b0*t[e+1],a=b0*t[e],l=Math.cos(o);r[i++]=Math.cos(a)*l*n,r[i++]=Math.sin(a)*l*n,r[i]=Math.sin(o)*n}function hQ(t,e,r,i){Ire(t,e,r,i,Dy.radius)}function dQ(t,e,r,i){Ire(t,e,r,i,_g.radius)}function gv(t,e,r,i){Ire(t,e,r,i,gi.radius)}function $re(t,e,r,i,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=rf(a/(l===0?1:l)),h=Math.atan2(o,n);r[i++]=j3*h,r[i++]=j3*c,r[i]=l-s}function pQ(t,e,r,i){$re(t,e,r,i,Dy.radius)}function fQ(t,e,r,i){$re(t,e,r,i,_g.radius)}function Av(t,e,r,i){$re(t,e,r,i,gi.radius)}function NTe(t,e,r,i){Av(t,e,r,i),Hx(r,i,r,i)}function FTe(t,e,r,i){Av(t,e,r,i),yv(r,i,r,i)}function tWe(t,e,r,i,s){const n=b0*t[e],o=b0*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(h+a)*c*Math.cos(n),r[i++]=(h+a)*c*Math.sin(n),r[i++]=(h*(1-s.eccentricitySquared)+a)*l}function yv(t,e,r,i){tWe(t,e,r,i,gi)}function _v(t,e,r,i){const s=Pqe,n=t[e],o=t[e+1],a=t[e+2];let l,c,h,p,A,_,w,T,C,M,O,$,L,k,F,G,z,Z,J,te,re;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,A=Math.sqrt(p),te=Math.atan2(o,n),_=a*a/p,w=c/p,k=s.a2/A,F=s.a3-s.a4/A,w>.3?(T=l/A*(1+w*(s.a1+k+_*F)/A),J=Math.asin(T),M=T*T,C=Math.sqrt(1-M)):(C=h/A*(1-_*(s.a5-k-w*F)/A),J=Math.acos(C),M=1-C*C,T=Math.sqrt(M)),O=1-gi.eccentricitySquared*M,$=gi.radius/Math.sqrt(O),L=s.a6*$,k=h-$*C,F=l-L*T,z=C*k+T*F,G=C*F-T*k,Z=G/(L/O+z),J+=Z,re=z+G*Z/2,a<0&&(J=-J),r[i++]=j3*te,r[i++]=j3*J,r[i]=re}function kTe(t,e,r,i){_v(t,e,r,i),gv(r,i,r,i)}function BTe(t,e,r,i){_v(t,e,r,i),Hx(r,i,r,i)}const dg={[me.WGS84]:{[me.CGCS2000]:null,[me.GCSMARS2000]:null,[me.GCSMOON2000]:null,[me.LON_LAT]:js,[me.WGS84_COMPARABLE_LON_LAT]:js,[me.SPHERICAL_ECEF]:gv,[me.SPHERICAL_MARS_PCPF]:null,[me.SPHERICAL_MOON_PCPF]:null,[me.UNKNOWN]:null,[me.WEB_MERCATOR]:Hx,[me.PLATE_CARREE]:mv,[me.WGS84]:js,[me.WGS84_ECEF]:yv},[me.CGCS2000]:{[me.CGCS2000]:js,[me.GCSMARS2000]:null,[me.GCSMOON2000]:null,[me.LON_LAT]:js,[me.WGS84_COMPARABLE_LON_LAT]:js,[me.SPHERICAL_ECEF]:gv,[me.SPHERICAL_MARS_PCPF]:null,[me.SPHERICAL_MOON_PCPF]:null,[me.UNKNOWN]:null,[me.WEB_MERCATOR]:null,[me.PLATE_CARREE]:mv,[me.WGS84]:null,[me.WGS84_ECEF]:yv},[me.GCSMARS2000]:{[me.CGCS2000]:null,[me.GCSMARS2000]:js,[me.GCSMOON2000]:null,[me.LON_LAT]:js,[me.WGS84_COMPARABLE_LON_LAT]:null,[me.SPHERICAL_ECEF]:null,[me.SPHERICAL_MARS_PCPF]:dQ,[me.SPHERICAL_MOON_PCPF]:null,[me.UNKNOWN]:null,[me.WEB_MERCATOR]:null,[me.PLATE_CARREE]:null,[me.WGS84]:null,[me.WGS84_ECEF]:null},[me.GCSMOON2000]:{[me.CGCS2000]:null,[me.GCSMARS2000]:null,[me.GCSMOON2000]:js,[me.LON_LAT]:js,[me.WGS84_COMPARABLE_LON_LAT]:null,[me.SPHERICAL_ECEF]:null,[me.SPHERICAL_MARS_PCPF]:null,[me.SPHERICAL_MOON_PCPF]:hQ,[me.UNKNOWN]:null,[me.WEB_MERCATOR]:null,[me.PLATE_CARREE]:null,[me.WGS84]:null,[me.WGS84_ECEF]:null},[me.WEB_MERCATOR]:{[me.CGCS2000]:null,[me.GCSMARS2000]:null,[me.GCSMOON2000]:null,[me.LON_LAT]:mx,[me.WGS84_COMPARABLE_LON_LAT]:mx,[me.SPHERICAL_ECEF]:$Te,[me.SPHERICAL_MARS_PCPF]:null,[me.SPHERICAL_MOON_PCPF]:null,[me.UNKNOWN]:null,[me.WEB_MERCATOR]:js,[me.PLATE_CARREE]:DTe,[me.WGS84]:mx,[me.WGS84_ECEF]:LTe},[me.WGS84_ECEF]:{[me.CGCS2000]:_v,[me.GCSMARS2000]:null,[me.GCSMOON2000]:null,[me.LON_LAT]:_v,[me.WGS84_COMPARABLE_LON_LAT]:_v,[me.SPHERICAL_ECEF]:kTe,[me.SPHERICAL_MARS_PCPF]:null,[me.SPHERICAL_MOON_PCPF]:null,[me.UNKNOWN]:null,[me.WEB_MERCATOR]:BTe,[me.PLATE_CARREE]:Qqe,[me.WGS84]:_v,[me.WGS84_ECEF]:js},[me.SPHERICAL_ECEF]:{[me.CGCS2000]:Av,[me.GCSMARS2000]:null,[me.GCSMOON2000]:null,[me.LON_LAT]:Av,[me.WGS84_COMPARABLE_LON_LAT]:Av,[me.SPHERICAL_ECEF]:js,[me.SPHERICAL_MARS_PCPF]:null,[me.SPHERICAL_MOON_PCPF]:null,[me.UNKNOWN]:null,[me.WEB_MERCATOR]:NTe,[me.PLATE_CARREE]:Xqe,[me.WGS84]:Av,[me.WGS84_ECEF]:FTe},[me.SPHERICAL_MARS_PCPF]:{[me.CGCS2000]:null,[me.GCSMARS2000]:fQ,[me.GCSMOON2000]:null,[me.LON_LAT]:fQ,[me.WGS84_COMPARABLE_LON_LAT]:null,[me.SPHERICAL_ECEF]:null,[me.SPHERICAL_MARS_PCPF]:js,[me.SPHERICAL_MOON_PCPF]:null,[me.UNKNOWN]:null,[me.WEB_MERCATOR]:null,[me.PLATE_CARREE]:null,[me.WGS84]:null,[me.WGS84_ECEF]:null},[me.SPHERICAL_MOON_PCPF]:{[me.CGCS2000]:null,[me.GCSMARS2000]:null,[me.GCSMOON2000]:pQ,[me.LON_LAT]:pQ,[me.WGS84_COMPARABLE_LON_LAT]:null,[me.SPHERICAL_ECEF]:null,[me.SPHERICAL_MARS_PCPF]:null,[me.SPHERICAL_MOON_PCPF]:js,[me.UNKNOWN]:null,[me.WEB_MERCATOR]:null,[me.PLATE_CARREE]:null,[me.WGS84]:null,[me.WGS84_ECEF]:null},[me.UNKNOWN]:{[me.CGCS2000]:null,[me.GCSMARS2000]:null,[me.GCSMOON2000]:null,[me.LON_LAT]:null,[me.WGS84_COMPARABLE_LON_LAT]:null,[me.SPHERICAL_ECEF]:null,[me.SPHERICAL_MARS_PCPF]:null,[me.SPHERICAL_MOON_PCPF]:null,[me.UNKNOWN]:js,[me.WEB_MERCATOR]:null,[me.PLATE_CARREE]:null,[me.WGS84]:null,[me.WGS84_ECEF]:null},[me.LON_LAT]:{[me.CGCS2000]:js,[me.GCSMARS2000]:js,[me.GCSMOON2000]:js,[me.LON_LAT]:js,[me.WGS84_COMPARABLE_LON_LAT]:js,[me.SPHERICAL_ECEF]:gv,[me.SPHERICAL_MARS_PCPF]:dQ,[me.SPHERICAL_MOON_PCPF]:hQ,[me.UNKNOWN]:null,[me.WEB_MERCATOR]:Hx,[me.PLATE_CARREE]:mv,[me.WGS84]:js,[me.WGS84_ECEF]:yv},[me.WGS84_COMPARABLE_LON_LAT]:{[me.CGCS2000]:null,[me.GCSMARS2000]:null,[me.GCSMOON2000]:null,[me.LON_LAT]:js,[me.WGS84_COMPARABLE_LON_LAT]:js,[me.SPHERICAL_ECEF]:gv,[me.SPHERICAL_MARS_PCPF]:null,[me.SPHERICAL_MOON_PCPF]:null,[me.UNKNOWN]:null,[me.WEB_MERCATOR]:null,[me.PLATE_CARREE]:mv,[me.WGS84]:js,[me.WGS84_ECEF]:yv},[me.PLATE_CARREE]:{[me.CGCS2000]:Z2,[me.GCSMARS2000]:null,[me.GCSMOON2000]:null,[me.LON_LAT]:Z2,[me.WGS84_COMPARABLE_LON_LAT]:Z2,[me.SPHERICAL_ECEF]:Zqe,[me.SPHERICAL_MARS_PCPF]:null,[me.SPHERICAL_MOON_PCPF]:null,[me.UNKNOWN]:null,[me.WEB_MERCATOR]:Jqe,[me.PLATE_CARREE]:js,[me.WGS84]:Z2,[me.WGS84_ECEF]:Kqe}};function Lre(t,e,r=Dre()){return N(t)||N(e)?null:UTe(t,e,r).projector}function UTe(t,e,r){if(N(t)||N(e)||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=ib(t,r.source),s=ib(e,r.dest);return i===me.UNKNOWN&&s===me.UNKNOWN?Po(t,e)?r.projector=js:r.projector=null:r.projector=dg[i][s],r}function Dre(){return{source:{spatialReference:null,spatialReferenceId:me.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:me.UNKNOWN,metersPerUnit:1},projector:js}}const _U={spatialReference:null,spatialReferenceId:me.UNKNOWN},VTe={spatialReference:null,spatialReferenceId:me.UNKNOWN},Nre=Dre(),rWe=Dre(),b0=$r(1),j3=Kc(1),On=V(),r0=V(),T_=V(),as=V(),WD=V();let Xy=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&E3(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*uue);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,uue));e++)this._items.push(this._allocator())}};const uue=1024;function ot(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function H3(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function Fre(t,e,r,i,s,n,o,a,l,c,h,p,A,_,w,T){return[t,e,r,i,s,n,o,a,l,c,h,p,A,_,w,T]}function zTe(t,e){return new Float64Array(t,e,16)}const Hd=ot();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Hd,clone:H3,create:ot,createView:zTe,fromValues:Fre},Symbol.toStringTag,{value:"Module"}));var $h;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})($h||($h={}));function GTe(t){return 32+t.length}function jTe(t){return 16}function HTe(t){if(!t)return 0;let e=YTe;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=GTe(i);break;case"number":e+=jTe();break;case"boolean":e+=4}}return e}function qTe(t){if(!t)return 0;if(Array.isArray(t))return iWe(t);let e=YTe;for(const r in t)t.hasOwnProperty(r)&&(e+=WTe(t[r]));return e}function iWe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=QTe;for(let i=0;i<e;i++)r+=WTe(t[i]);return r}function WTe(t){switch(typeof t){case"object":return qTe(t);case"string":return GTe(t);case"number":return jTe();case"boolean":return 4;default:return 8}}function IFt(t,e){return QTe+t.length*e}const YTe=32,QTe=32;var q3;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(q3||(q3={}));function mn(){return[1,0,0,0,1,0,0,0,1]}function sWe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function nWe(t,e,r,i,s,n,o,a,l){return[t,e,r,i,s,n,o,a,l]}function XTe(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:sWe,create:mn,createView:XTe,fromValues:nWe},Symbol.toStringTag,{value:"Module"}));function gf(){return[0,0,0,1]}function oWe(t){return[t[0],t[1],t[2],t[3]]}function aWe(t,e,r,i){return[t,e,r,i]}function ZTe(t,e){return new Float64Array(t,e,4)}const lWe=gf();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:lWe,clone:oWe,create:gf,createView:ZTe,fromValues:aWe},Symbol.toStringTag,{value:"Module"}));function Dt(){return[0,0]}function uP(t){return[t[0],t[1]]}function ki(t,e){return[t,e]}function JTe(t){const e=Dt(),r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function KTe(t,e){return new Float64Array(t,e,2)}function eSe(){return Dt()}function tSe(){return ki(1,1)}function rSe(){return ki(1,0)}function iSe(){return ki(0,1)}const Hu=eSe(),sSe=tSe(),cWe=rSe(),uWe=iSe();Object.freeze(Object.defineProperty({__proto__:null,ONES:sSe,UNIT_X:cWe,UNIT_Y:uWe,ZEROS:Hu,clone:uP,create:Dt,createView:KTe,fromArray:JTe,fromValues:ki,ones:tSe,unitX:rSe,unitY:iSe,zeros:eSe},Symbol.toStringTag,{value:"Module"}));function Zr(){return[0,0,0,0]}function _L(t){return[t[0],t[1],t[2],t[3]]}function Nr(t,e,r,i){return[t,e,r,i]}function kre(t){const e=Zr(),r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function nSe(t,e){return new Float64Array(t,e,4)}function oSe(){return Zr()}function aSe(){return Nr(1,1,1,1)}function lSe(){return Nr(1,0,0,0)}function cSe(){return Nr(0,1,0,0)}function uSe(){return Nr(0,0,1,0)}function hSe(){return Nr(0,0,0,1)}const bg=oSe(),Gp=aSe(),hWe=lSe(),dWe=cSe(),pWe=uSe(),fWe=hSe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Gp,UNIT_W:fWe,UNIT_X:hWe,UNIT_Y:dWe,UNIT_Z:pWe,ZEROS:bg,clone:_L,create:Zr,createView:nSe,fromArray:kre,fromValues:Nr,ones:aSe,unitW:hSe,unitX:lSe,unitY:cSe,unitZ:uSe,zeros:oSe},Symbol.toStringTag,{value:"Module"}));let kM=class qw{constructor(e,r,i){this._itemByteSize=e,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&E3(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=VT){return new qw(16,KTe,e)}static createVec3f64(e=VT){return new qw(24,Vte,e)}static createVec4f64(e=VT){return new qw(32,nSe,e)}static createMat3f64(e=VT){return new qw(72,XTe,e)}static createMat4f64(e=VT){return new qw(128,zTe,e)}static createQuatf64(e=VT){return new qw(32,ZTe,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const VT=4*q3.KILOBYTES,$Ft=kM.createVec2f64(),Tt=kM.createVec3f64(),Bre=kM.createVec4f64();kM.createMat3f64();const Ure=kM.createMat4f64(),LFt=kM.createQuatf64();function Q0(t){return t?{origin:In(t.origin),vector:In(t.vector)}:{origin:V(),vector:V()}}function mWe(t,e){const r=AWe.get();return r.origin=t,r.vector=e,r}function DFt(t,e=Q0()){return gWe(t.origin,t.vector,e)}function gWe(t,e,r=Q0()){return Oe(r.origin,t),Oe(r.vector,e),r}function gx(t,e,r=Q0()){return Oe(r.origin,t),Be(r.vector,e,t),r}function Vre(t,e){const r=Be(Tt.get(),e,t.origin),i=He(t.vector,r),s=He(t.vector,t.vector),n=ze(i/s,0,1),o=Be(Tt.get(),Me(Tt.get(),t.vector,n),r);return He(o,o)}function NFt(t,e,r){return mQ(t,e,0,1,r)}function FFt(t,e,r){return ke(r,t.origin,Me(r,t.vector,e))}function mQ(t,e,r,i,s){const{vector:n,origin:o}=t,a=Be(Tt.get(),e,o),l=He(n,a)/Jl(n);return Me(s,n,ze(l,r,i)),ke(s,s,t.origin)}function kFt(t,e){if(pSe(t,mWe(e.origin,e.direction),!1,Fk)){const{tA:r,pB:i,distance2:s}=Fk;if(r>=0&&r<=1)return s;if(r<0)return cl(t.origin,i);if(r>1)return cl(ke(Tt.get(),t.origin,t.vector),i)}return null}function dSe(t,e,r){return!!pSe(t,e,!0,Fk)&&(Oe(r,Fk.pA),!0)}function pSe(t,e,r,i){const n=t.origin,o=ke(Tt.get(),n,t.vector),a=e.origin,l=ke(Tt.get(),a,e.vector),c=Tt.get(),h=Tt.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=Tt.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const A=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],_=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],w=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],T=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],C=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*T-_*_;if(Math.abs(C)<1e-6)return!1;let M=(A*_-w*T)/C,O=(A+_*M)/T;r&&(M=ze(M,0,1),O=ze(O,0,1));const $=Tt.get(),L=Tt.get();return $[0]=n[0]+M*p[0],$[1]=n[1]+M*p[1],$[2]=n[2]+M*p[2],L[0]=a[0]+O*h[0],L[1]=a[1]+O*h[1],L[2]=a[2]+O*h[2],i.tA=M,i.tB=O,i.pA=$,i.pB=L,i.distance2=cl($,L),!0}const Fk={tA:0,tB:0,pA:V(),pB:V(),distance2:0},AWe=new Xy(()=>Q0());function Na(t){return t?hue(In(t.origin),In(t.direction)):hue(V(),V())}function hue(t,e){return{origin:t,direction:e}}function BFt(t,e){return Iy(t.origin,e.origin)&&Iy(t.direction,e.direction)}function qd(t,e){const r=bWe.get();return r.origin=t,r.direction=e,r}function kk(t,e=Na()){return fSe(t.origin,t.direction,e)}function yWe(t,e,r=Na()){return Oe(r.origin,t),Be(r.direction,e,t),r}function fSe(t,e,r=Na()){return Oe(r.origin,t),Oe(r.direction,e),r}function _We(t,e){const r=Xt(Tt.get(),qe(Tt.get(),t.direction),Be(Tt.get(),e,t.origin));return He(r,r)}function vWe(t,e,r){const i=He(t.direction,Be(r,e,t.origin));return ke(r,t.origin,Me(r,t.direction,i)),r}const bWe=new Xy(()=>Na());function LI(t,e){return He(t,e)/st(t)}function zre(t,e){const r=He(t,e)/(st(t)*st(e));return-Zo(r)}function mSe(t,e,r){qe(YD,t),qe(bz,e);const i=He(YD,bz),s=Zo(i),n=Xt(YD,YD,bz);return He(n,r)<0?2*Math.PI-s:s}const YD=V(),bz=V();function Io(){return Zr()}function W3(t,e=Io()){return A0(e,t)}function gSe(t,e){return Nr(t[0],t[1],t[2],e)}function wWe(t){return t}function ASe(t){t[0]=t[1]=t[2]=t[3]=0}function vU(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function Ay(t){return t[3]}function xWe(t){return t}function ySe(t,e,r,i){return Nr(t,e,r,i)}function TWe(t,e,r){return t!==r&&Oe(r,t),r[3]=t[3]+e,r}function SWe(t,e,r){return we.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:W3(t,r)}function Mb(t,e,r){if(N(e))return!1;const{origin:i,direction:s}=e,n=EWe;n[0]=i[0]-t[0],n[1]=i[1]-t[1],n[2]=i[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(r&&(r[0]=i[0]+s[0]*h,r[1]=i[1]+s[1]*h,r[2]=i[2]+s[2]*h),!0)}const EWe=V();function gQ(t,e){return Mb(t,e,null)}function CWe(t,e,r){if(Mb(t,e,r))return r;const i=BM(t,e,Tt.get());return ke(r,e.origin,Me(Tt.get(),e.direction,Is(e.origin,i)/st(e.direction))),r}function BM(t,e,r){const i=Tt.get(),s=Ure.get();Xt(i,e.origin,e.direction);const n=Ay(t);Xt(r,i,e.origin),Me(r,r,1/st(r)*n);const o=bSe(t,e.origin),a=zre(e.origin,r);return jd(s,a+o,i),Mt(r,r,s),r}function MWe(t,e,r){return Mb(t,e,r)?r:(vWe(e,t,r),_Se(t,r,r))}function _Se(t,e,r){const i=Be(Tt.get(),e,t),s=Me(Tt.get(),i,t[3]/st(i));return ke(r,s,t)}function vSe(t,e){const r=Be(Tt.get(),e,t),i=Jl(r),s=t[3]*t[3];return Math.sqrt(Math.abs(i-s))}function bSe(t,e){const r=Be(Tt.get(),e,t),i=st(r),s=Ay(t),n=s+Math.abs(s-i);return Zo(s/n)}const wz=V();function wSe(t,e,r,i){const s=Be(wz,e,t);switch(r){case $h.X:{const n=Ece(s,wz)[2];return $e(i,-Math.sin(n),Math.cos(n),0)}case $h.Y:{const n=Ece(s,wz),o=n[1],a=n[2],l=Math.sin(o);return $e(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case $h.Z:return qe(i,s);default:return}}function xSe(t,e){const r=Be(AQ,e,t);return st(r)-t[3]}function RWe(t,e,r,i){const s=xSe(t,e),n=wSe(t,e,$h.Z,AQ),o=Me(AQ,n,r-s);return ke(i,e,o)}function OWe(t,e){const r=cl(t,e),i=Ay(t);return r<=i*i}const AQ=V(),bU=Io(),PWe=Object.freeze(Object.defineProperty({__proto__:null,altitudeAt:xSe,angleToSilhouette:bSe,axisAt:wSe,clear:ASe,closestPoint:MWe,closestPointOnSilhouette:BM,containsPoint:OWe,copy:W3,create:Io,distanceToSilhouette:vSe,elevate:TWe,fromCenterAndRadius:gSe,fromRadius:vU,fromValues:ySe,getCenter:xWe,getRadius:Ay,intersectRay:Mb,intersectRayClosestSilhouette:CWe,intersectsRay:gQ,projectPoint:_Se,setAltitudeAt:RWe,setExtent:SWe,tmpSphere:bU,wrap:wWe},Symbol.toStringTag,{value:"Module"}));function Wx(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function IWe(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return $e(t,r,i,s),t}function UFt(t,e,r){r=r||t;const i=He(t,e);$e(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),qe(r,r)}function VFt(t,e,r){Math.abs(t[0])>Math.abs(t[1])?$e(e,0,1,0):$e(e,1,0,0),Xt(r,t,e),qe(e,e),Xt(e,r,t),qe(r,r)}function QD(t,e,r,i,s,n){const o=t+(e-t)*s;return o+(r+(i-r)*s-o)*n}function $We(t,e,r,i=V()){const s=st(t),n=st(e),o=He(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),h=l/n*Math.sin(r*a);return Me(J2,t,c),Me(K2,e,h),ke(i,J2,K2)}return fo(i,t,e,r)}function zFt(t,e,r,i=V(),s=V()){const n=st(t),o=st(e),a=He(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(r*l),p=Math.sin((1-r)*l),A=(1-r)*n+r*o;{const _=A/c,w=_/o*h;Me(J2,t,_/n*p),Me(K2,e,w),ke(i,J2,K2)}{const _=1/n*(-Math.cos((1-r)*l)*l*A+p*(-n+o));Me(J2,t,_);const w=1/o*(Math.cos(r*l)*l*A+h*(-n+o));Me(K2,e,w),ke(s,J2,K2),Me(s,s,1/c)}return s}return fo(i,t,e,r),Be(s,e,t),qe(s,s),s}function p6(t,e,r){t=qe(J2,t),e=qe(K2,e);const i=Zo(He(t,e));if(r){const s=Xt(LWe,t,e);if(He(s,r)<0)return-i}return i}function f6(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const s=t[i-1][0],n=t[i][0],o=(n-r)/(n-s);return o*t[i-1][1]+(1-o)*t[i][1]}}function GFt(t,e,r,i){Be(due,e,t),Be(pue,r,t),Xt(i,due,pue),qe(i,i),i[3]=-He(t,i)}const due=V(),pue=V(),LWe=V(),J2=V(),K2=V();function Hi(t=hP){return[t[0],t[1],t[2],t[3]]}function DWe(t=hP[0],e=hP[1],r=hP[2],i=hP[3]){return Gre(t,e,r,i,Bre.get())}function wU(t,e){return Gre(e[0],e[1],e[2],e[3],t)}function Gre(t,e,r,i,s=Hi()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function TSe(t,e,r){return Oe(r,t),r[3]=e,r}function vL(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function Xl(t,e,r,i=Hi()){const s=r[0]-e[0],n=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=n*c-o*l,p=o*a-s*c,A=s*l-n*a,_=h*h+p*p+A*A,w=Math.abs(_-1)>1e-5&&_>1e-12?1/Math.sqrt(_):1;return i[0]=h*w,i[1]=p*w,i[2]=A*w,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function SSe(t,e,r,i,s){const n=t.length/3;if(n<3)return!1;$e(IR,t[3*r],t[3*r+1],t[3*r+2]);let o=i,a=!1;for(;o<n-1&&!a;){const l=3*o;$e(zT,t[l],t[l+1],t[l+2]),o++,a=!Hc(IR,zT)}if(!a)return!1;for(o=Math.max(o,s),a=!1;o<n&&!a;){const l=3*o;$e($2,t[l],t[l+1],t[l+2]),o++,Be(XD,IR,zT),qe(XD,XD),Be(ZD,zT,$2),qe(ZD,ZD),a=!Hc(IR,$2)&&!Hc(zT,$2)&&Math.abs(He(XD,ZD))<NWe}return a?(Xl(IR,zT,$2,e),!0):(r!==0||i!==1||s!==2)&&SSe(t,e,0,1,2)}const NWe=.99619469809,IR=V(),zT=V(),$2=V(),XD=V(),ZD=V();function yQ(t,e,r){return e!==t&&wU(t,e),t[3]=-He(t,r),t}function _Q(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function i4(t,e,r,i){return Xt($2,e,t),vL(r,$2,i)}function jFt(t,e,r,i){return xU(t,e,Be(Tt.get(),r,e),zWe,i)}function ST(t,e,r){return!!E(e)&&xU(t,e.origin,e.direction,GWe,r)}function FWe(t,e,r){return xU(t,e.origin,e.vector,wg.NONE,r)}function kWe(t,e,r){return xU(t,e.origin,e.vector,wg.CLAMP,r)}function ESe(t,e){return Rs(t,e)>=0}function BWe(t,e){const r=He(t,e.ray.direction),i=-Rs(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function UWe(t,e){const r=He(t,e.ray.direction),i=-Rs(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function VWe(t,e,r){const i=Me(Tt.get(),t,-t[3]),s=vQ(t,Be(Tt.get(),e,i),Tt.get());return ke(r,s,i),r}function vQ(t,e,r){const i=Me(Tt.get(),t,He(t,e));return Be(r,e,i),r}function Rs(t,e){return He(t,e)+t[3]}function xU(t,e,r,i,s){const n=He(t,r);if(n===0)return!1;let o=-(He(t,e)+t[3])/n;return i&wg.CLAMP&&(o=ze(o,0,1)),!(!(i&wg.INFINITE_MIN)&&o<0||!(i&wg.INFINITE_MAX)&&o>1)&&(ke(s,e,Me(s,r,o)),!0)}function HFt(t){return t}const hP=[0,0,1,0];var wg;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(wg||(wg={}));const zWe=wg.INFINITE_MIN|wg.INFINITE_MAX,GWe=wg.INFINITE_MAX,xz=we.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let jWe=class{constructor(){this.plane=Hi(),this.origin=V(),this.basis1=V(),this.basis2=V()}};const CSe=jWe;function Zy(t=kSe){return{plane:Hi(t.plane),origin:In(t.origin),basis1:In(t.basis1),basis2:In(t.basis2)}}function HWe(t,e,r){const i=iYe.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=DWe(0,0,0,0),TU(i),i}function ET(t,e=Zy()){return jre(t.origin,t.basis1,t.basis2,e)}function qWe(t,e){Oe(e.origin,t.origin),Oe(e.basis1,t.basis1),Oe(e.basis2,t.basis2),wU(e.plane,t.plane)}function jre(t,e,r,i=Zy()){return Oe(i.origin,t),Oe(i.basis1,e),Oe(i.basis2,r),TU(i),tYe(i,"fromValues()"),i}function TU(t){i4(t.basis2,t.basis1,t.origin,t.plane)}function MSe(t,e,r){t!==r&&ET(t,r);const i=Me(Tt.get(),By(t),e);return ke(r.origin,r.origin,i),r.plane[3]-=e,r}function WWe(t,e,r){return RSe(e,r),MSe(r,Yre(t,t.origin),r),r}function RSe(t,e=Zy()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return $e(e.origin,t[0]+r,t[1]+i,0),$e(e.basis1,r,0,0),$e(e.basis2,0,i,0),Gre(0,0,1,0,e.plane),e}function Hre(t,e,r){return!!ST(t.plane,e,r)&&NSe(t,r)}function YWe(t,e,r){if(Hre(t,e,r))return r;const i=OSe(t,e,Tt.get());return ke(r,e.origin,Me(Tt.get(),e.direction,Is(e.origin,i)/st(e.direction))),r}function OSe(t,e,r){const i=Bk.get();FSe(t,e,i,Bk.get());let s=Number.POSITIVE_INFINITY;for(const n of Xre){const o=Qre(t,n,SU.get()),a=Tt.get();if(FWe(i,o,a)){const l=Yy(Tt.get(),e.origin,a),c=Math.abs(Zo(He(e.direction,l)));c<s&&(s=c,Oe(r,a))}}return s===Number.POSITIVE_INFINITY?PSe(t,e,r):r}function PSe(t,e,r){if(Hre(t,e,r))return r;const i=Bk.get(),s=Bk.get();FSe(t,e,i,s);let n=Number.POSITIVE_INFINITY;for(const o of Xre){const a=Qre(t,o,SU.get()),l=Tt.get();if(kWe(i,a,l)){const c=_We(e,l);if(!ESe(s,l))continue;c<n&&(n=c,Oe(r,l))}}return qre(t,e.origin)<n&&ISe(t,e.origin,r),r}function ISe(t,e,r){const i=VWe(t.plane,e,Tt.get()),s=mQ(fue(t,t.basis1),i,-1,1,Tt.get()),n=mQ(fue(t,t.basis2),i,-1,1,Tt.get());return Be(r,ke(Tt.get(),s,n),t.origin),r}function $Se(t,e,r){const{origin:i,basis1:s,basis2:n}=t,o=Be(Tt.get(),e,i),a=LI(s,o),l=LI(n,o),c=LI(By(t),o);return $e(r,a,l,c)}function qre(t,e){const r=$Se(t,e,Tt.get()),{basis1:i,basis2:s}=t,n=st(i),o=st(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function QWe(t,e){return Math.sqrt(qre(t,e))}function XWe(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of Xre){const s=Qre(t,i,SU.get()),n=Vre(s,e);n>r&&(r=n)}return Math.sqrt(r)}function Wre(t,e){return ESe(t.plane,e)&&NSe(t,e)}function ZWe(t,e,r,i){return eYe(t,r,i)}function Yre(t,e){const r=-t.plane[3];return LI(By(t),e)-r}function JWe(t,e,r,i){const s=Yre(t,e),n=Me(rYe,By(t),r-s);return ke(i,e,n),i}function LSe(t,e){return Hc(t.basis1,e.basis1)&&Hc(t.basis2,e.basis2)&&Hc(t.origin,e.origin)}function DSe(t,e,r){return t!==r&&ET(t,r),ul(GT,e),zh(GT,GT),Mt(r.basis1,t.basis1,GT),Mt(r.basis2,t.basis2,GT),Mt(r.plane,t.plane,GT),Mt(r.origin,t.origin,e),yQ(r.plane,r.plane,r.origin),r}function KWe(t,e,r,i){return t!==i&&ET(t,i),jd(Tz,e,r),Mt(i.basis1,t.basis1,Tz),Mt(i.basis2,t.basis2,Tz),TU(i),i}function By(t){return t.plane}function eYe(t,e,r){switch(e){case $h.X:Oe(r,t.basis1),qe(r,r);break;case $h.Y:Oe(r,t.basis2),qe(r,r);break;case $h.Z:Oe(r,By(t))}return r}function NSe(t,e){const r=Be(Tt.get(),e,t.origin),i=Jl(t.basis1),s=Jl(t.basis2),n=He(t.basis1,r),o=He(t.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function fue(t,e){const r=SU.get();return Oe(r.origin,t.origin),Oe(r.vector,e),r}function Qre(t,e,r){const{basis1:i,basis2:s,origin:n}=t,o=Me(Tt.get(),i,e.origin[0]),a=Me(Tt.get(),s,e.origin[1]);ke(r.origin,o,a),ke(r.origin,r.origin,n);const l=Me(Tt.get(),i,e.direction[0]),c=Me(Tt.get(),s,e.direction[1]);return Me(r.vector,ke(l,l,c),2),r}function tYe(t,e){Math.abs(He(t.basis1,t.basis2)/(st(t.basis1)*st(t.basis2)))>1e-6&&xz.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(He(t.basis1,By(t)))>1e-6&&xz.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-He(By(t),t.origin)-t.plane[3])>1e-6&&xz.warn(e,"Plane offset is not consistent with plane origin")}function FSe(t,e,r,i){const s=By(t);i4(s,e.direction,e.origin,r),i4(r,s,e.origin,i)}const kSe={plane:Hi(),origin:ct(0,0,0),basis1:ct(1,0,0),basis2:ct(0,1,0)},Bk=new Xy(Hi),SU=new Xy(Q0),rYe=V(),iYe=new Xy(()=>Zy()),Xre=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],GT=ot(),Tz=ot(),sYe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:CSe,UP:kSe,altitudeAt:Yre,axisAt:ZWe,closestPoint:PSe,closestPointOnSilhouette:OSe,copy:ET,copyWithoutVerify:qWe,create:Zy,distance:QWe,distance2:qre,distanceToSilhouette:XWe,elevate:MSe,equals:LSe,extrusionContainsPoint:Wre,fromAABoundingRect:RSe,fromValues:jre,intersectRay:Hre,intersectRayClosestSilhouette:YWe,normal:By,projectPoint:ISe,projectPointLocal:$Se,rotate:KWe,setAltitudeAt:JWe,setExtent:WWe,transform:DSe,updateUnboundedPlane:TU,wrap:HWe},Symbol.toStringTag,{value:"Module"})),nYe=new xt(Cwe),mue=new xt(Ote),gue=new xt(Pte),WFt=new xt(Mwe);function EU(t){return t&&(Gg(t)||Po(t,mue))?mue:t&&(jg(t)||Po(t,gue))?gue:nYe}function oYe(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function aYe(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function lYe(t){return{operations:t,value:t.create()}}function BSe(t,e,r=lYe(t)){return r.operations=t,t.copy(e,r.value),r}function cYe(t){return BSe(PWe,ySe(0,0,0,es(t).radius))}const Aue=2**50;function uYe(){return BSe(sYe,jre([0,0,0],[Aue,0,0],[0,Aue,0]))}function hYe(t,e,r){return t.operations.axisAt(t.value,e,$h.Z,r)}function dYe(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function pYe(t,e,r){return t.operations.intersectRay(t.value,e,r)}function fYe(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function mYe(t,e){return t.operations.altitudeAt(t.value,e)}function USe(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function gYe(t,e,r,i){return e!==i&&ma(i,e),$e(jT,i[12],i[13],i[14]),USe(t,jT,r,jT),i[12]=jT[0],i[13]=jT[1],i[14]=jT[2],i}function Sz(t,e,r){return t.operations.elevate(t.value,e,r.value)}const jT=V();function yue(t,e,r,i,s){return s[0]=He(t,e),s[1]=He(t,r),s[2]=He(t,i),s}function bQ(t,e,r,i,s){Oe(r,t),Oe(JD,e),qe(JD,JD),Xt(i,JD,r),Xt(s,i,r)}function VSe(t,e){return t?EU(e):e.isGeographic?xt.PlateCarree:e}const JD=V(),Zre=96;function YFt(t,e){const r=e||t.extent,i=t.width,s=tu(r&&r.spatialReference);return r&&i?r.width/i*s*Ite*Zre:0}function AYe(t,e){return t/(tu(e)*Ite*Zre)}function yYe(t){return t/(Ite*Zre)}const zSe="OBJECTID";let Y3=class extends PI{constructor(e){super(e),this.handles.add(this.on("before-add",r=>{N(r.item)||r.item.parent===this.owner&&(we.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};Y3=u([j("esri.support.AnalysesCollection")],Y3);const m6={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},Ez={xsmall:544,small:768,medium:992,large:1200};function _Ye(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function Cz(t,e){return e?m6[t].valueToClassName[e].split(" "):[]}const vYe=t=>{let e=class extends t{constructor(...r){super(...r),this._breakpointsHandles=new ts,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=Ez}initialize(){this._breakpointsHandles.add(xe(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Cr))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=gt(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=_Ye(r);if(!i){const s=JSON.stringify(Ez,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:Ez,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=Th.acquire(),i=Th.acquire();let s,n=!1;for(s in m6){const o=this[s],a=m6[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,Cz(s,o).forEach(l=>i.push(l)),Cz(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),Th.release(r),Th.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in m6)Cz(i,this[i]).forEach(s=>r.classList.remove(s))}};return u([d()],e.prototype,"breakpoints",null),u([d()],e.prototype,"orientation",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),u([d()],e.prototype,"heightBreakpoint",void 0),e=u([j("esri.views.BreakpointsOwner")],e),e};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var bYe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},L2={exports:{}},$o={},s4={exports:{}},CT={};function GSe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function wYe(t,e,r){}function xYe(t,e,r){}var TYe=/javascript\s*\:/img;function SYe(t,e){return TYe.test(e)?"":e}CT.whiteList=GSe();CT.getDefaultWhiteList=GSe;CT.onAttr=wYe;CT.onIgnoreAttr=xYe;CT.safeAttrValue=SYe;var EYe={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},$R=EYe;function CYe(t,e){t=$R.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,s=0,n=0,o="";function a(){if(!i){var h=$R.trim(t.slice(s,n)),p=h.indexOf(":");if(p!==-1){var A=$R.trim(h.slice(0,p)),_=$R.trim(h.slice(p+1));if(A){var w=e(s,o.length,A,_,h);w&&(o+=w+"; ")}}}s=n+1}for(;n<r;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return $R.trim(o)}var MYe=CYe,KD=CT,RYe=MYe;function _ue(t){return t==null}function OYe(t){var e={};for(var r in t)e[r]=t[r];return e}function jSe(t){t=OYe(t||{}),t.whiteList=t.whiteList||KD.whiteList,t.onAttr=t.onAttr||KD.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||KD.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||KD.safeAttrValue,this.options=t}jSe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=RYe(t,function(l,c,h,p,A){var _=i[h],w=!1;if(_===!0?w=_:typeof _=="function"?w=_(p):_ instanceof RegExp&&(w=_.test(p)),w!==!0&&(w=!1),p=o(h,p),!!p){var T={position:c,sourcePosition:l,source:A,isWhite:w};if(w){var C=s(h,p,T);return _ue(C)?h+":"+p:C}else{var C=n(h,p,T);if(!_ue(C))return C}}});return a};var PYe=jSe;(function(t,e){var r=CT,i=PYe;function s(o,a){var l=new i(a);return l.process(o)}e=t.exports=s,e.FilterCSS=i;for(var n in r)e[n]=r[n]})(s4,s4.exports);var Jre={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},IYe=s4.exports.FilterCSS,$Ye=s4.exports.getDefaultWhiteList,Uk=Jre;function HSe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var qSe=new IYe;function LYe(t,e,r){}function DYe(t,e,r){}function NYe(t,e,r){}function FYe(t,e,r){}function WSe(t){return t.replace(BYe,"&lt;").replace(UYe,"&gt;")}function kYe(t,e,r,i){if(r=KSe(r),e==="href"||e==="src"){if(r=Uk.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(e5.lastIndex=0,e5.test(r))return""}else if(e==="style"){if(vue.lastIndex=0,vue.test(r)||(bue.lastIndex=0,bue.test(r)&&(e5.lastIndex=0,e5.test(r))))return"";i!==!1&&(i=i||qSe,r=i.process(r))}return r=eEe(r),r}var BYe=/</g,UYe=/>/g,VYe=/"/g,zYe=/&quot;/g,GYe=/&#([a-zA-Z0-9]*);?/gim,jYe=/&colon;?/gim,HYe=/&newline;?/gim,e5=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,vue=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,bue=/u\s*r\s*l\s*\(.*/gi;function YSe(t){return t.replace(VYe,"&quot;")}function QSe(t){return t.replace(zYe,'"')}function XSe(t){return t.replace(GYe,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function ZSe(t){return t.replace(jYe,":").replace(HYe," ")}function JSe(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return Uk.trim(e)}function KSe(t){return t=QSe(t),t=XSe(t),t=ZSe(t),t=JSe(t),t}function eEe(t){return t=YSe(t),t=WSe(t),t}function qYe(){return""}function WYe(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:Uk.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return Uk.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function YYe(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var s=t.indexOf("-->",i);if(s===-1)break;r=s+3}return e}function QYe(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}$o.whiteList=HSe();$o.getDefaultWhiteList=HSe;$o.onTag=LYe;$o.onIgnoreTag=DYe;$o.onTagAttr=NYe;$o.onIgnoreTagAttr=FYe;$o.safeAttrValue=kYe;$o.escapeHtml=WSe;$o.escapeQuote=YSe;$o.unescapeQuote=QSe;$o.escapeHtmlEntities=XSe;$o.escapeDangerHtml5Entities=ZSe;$o.clearNonPrintableCharacter=JSe;$o.friendlyAttrValue=KSe;$o.escapeAttrValue=eEe;$o.onIgnoreTagStripAll=qYe;$o.StripTagBody=WYe;$o.stripCommentTag=YYe;$o.stripBlankChar=QYe;$o.cssFilter=qSe;$o.getDefaultCSSWhiteList=$Ye;var CU={},U1=Jre;function XYe(t){var e=U1.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=U1.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function ZYe(t){return t.slice(0,2)==="</"}function JYe(t,e,r){var i="",s=0,n=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var p=t.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){i+=r(t.slice(s,a)),n=a,s=a;continue}if(p===">"){i+=r(t.slice(s,n)),h=t.slice(n,a+1),c=XYe(h),i+=e(n,i.length,c,h,ZYe(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var A=1,_=t.charAt(a-A);_.trim()===""||_==="=";){if(_==="="){o=p;continue e}_=t.charAt(a-++A)}}else if(p===o){o=!1;continue}}return s<t.length&&(i+=r(t.substr(s))),i}var KYe=/[^a-zA-Z0-9\\_:.-]/gim;function eQe(t,e){var r=0,i=0,s=[],n=!1,o=t.length;function a(A,_){if(A=U1.trim(A),A=A.replace(KYe,"").toLowerCase(),!(A.length<1)){var w=e(A,_||"");w&&s.push(w)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,p;if(n===!1&&c==="="){n=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:rQe(t,l+1);continue}if(n!==!1&&l===i){if(p=t.indexOf(c,l+1),p===-1)break;h=U1.trim(t.slice(i+1,p)),a(n,h),n=!1,l=p,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(p=tQe(t,l),p===-1){h=U1.trim(t.slice(r,l)),a(h),n=!1,r=l+1;continue}else{l=p-1;continue}else if(p=iQe(t,l-1),p===-1){h=U1.trim(t.slice(r,l)),h=wue(h),a(n,h),n=!1,r=l+1;continue}else continue}return r<t.length&&(n===!1?a(t.slice(r)):a(n,wue(U1.trim(t.slice(r))))),U1.trim(s.join(" "))}function tQe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function rQe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function iQe(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function sQe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function wue(t){return sQe(t)?t.substr(1,t.length-2):t}CU.parseTag=JYe;CU.parseAttr=eQe;var nQe=s4.exports.FilterCSS,i0=$o,tEe=CU,oQe=tEe.parseTag,aQe=tEe.parseAttr,g6=Jre;function t5(t){return t==null}function lQe(t){var e=g6.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=g6.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=g6.trim(t.slice(0,-1))),{html:t,closing:r}}function cQe(t){var e={};for(var r in t)e[r]=t[r];return e}function uQe(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function rEe(t){t=cQe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=i0.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=uQe(t.whiteList||t.allowList):t.whiteList=i0.whiteList,t.onTag=t.onTag||i0.onTag,t.onTagAttr=t.onTagAttr||i0.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||i0.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||i0.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||i0.safeAttrValue,t.escapeHtml=t.escapeHtml||i0.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new nQe(t.css))}rEe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,h=e.cssFilter;r.stripBlankChar&&(t=i0.stripBlankChar(t)),r.allowCommentTag||(t=i0.stripCommentTag(t));var p=!1;r.stripIgnoreTagBody&&(p=i0.StripTagBody(r.stripIgnoreTagBody,n),n=p.onIgnoreTag);var A=oQe(t,function(_,w,T,C,M){var O={sourcePosition:_,position:w,isClosing:M,isWhite:Object.prototype.hasOwnProperty.call(i,T)},$=s(T,C,O);if(!t5($))return $;if(O.isWhite){if(O.isClosing)return"</"+T+">";var L=lQe(C),k=i[T],F=aQe(L.html,function(G,z){var Z=g6.indexOf(k,G)!==-1,J=o(T,G,z,Z);return t5(J)?Z?(z=l(T,G,z,h),z?G+'="'+z+'"':G):(J=a(T,G,z,Z),t5(J)?void 0:J):J});return C="<"+T,F&&(C+=" "+F),L.closing&&(C+=" /"),C+=">",C}else return $=n(T,C,O),t5($)?c(C):$},c);return p&&(A=p.remove(A)),A};var hQe=rEe;(function(t,e){var r=$o,i=CU,s=hQe;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(L2,L2.exports);var dQe=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):L2.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!r?s=e:e&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new L2.exports.FilterXSS(s)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?L2.exports.escapeAttrValue(e):!n&&!s?L2.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,s):L2.exports.safeAttrValue(e,r,i,s)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,s){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(bYe(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],h=i.validate(c,r);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const MU=new Map;function iEe(){MU.clear()}function pQe(t){return MU.get(t)}function fQe(t,e){MU.set(t,e)}function Mz(t){MU.delete(t)}var Yx,Q3,mQe=function(t){if("WebkitTransition"in t.style)Yx="webkitTransitionEnd",Q3="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");Yx="transitionend",Q3="animationend"}},sEe=function(t){Yx||mQe(t)},gQe=function(t,e){return e===void 0&&(e=t+"-active"),function(r){sEe(r);var i=!1,s=function(n){i||(i=!0,r.removeEventListener(Yx,s),r.removeEventListener(Q3,s),r.classList.remove(t),r.classList.remove(e))};r.classList.add(t),r.addEventListener(Yx,s),r.addEventListener(Q3,s),requestAnimationFrame(function(){r.classList.add(e)})}},AQe=function(t,e){return e===void 0&&(e=t+"-active"),function(r,i){sEe(r);var s=!1,n=function(o){s||(s=!0,r.removeEventListener(Yx,n),r.removeEventListener(Q3,n),i())};r.classList.add(t),r.addEventListener(Yx,n),r.addEventListener(Q3,n),requestAnimationFrame(function(){r.classList.add(e)})}};const yQe=we.getLogger("esri.widgets.support.widgetUtils");function nEe(t){const e=Th.acquire();for(let i=0;i<arguments.length;i++){const s=arguments[i],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const r=e.join(" ");return Th.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(r=>{var i;iEe();for(const s of r)(i=t.get(s.target))==null||i(s)});return(r,i,s)=>(t.has(r)&&yQe.error("Already observing element",r),t.set(r,i),e.observe(r,s),F0(()=>{e.unobserve(r),t.delete(r)}))})();function w0(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function xue(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function n4(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function _Qe(t,e){return(t==="enter"?gQe:AQe)(e)}const vQe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],bQe=vQe.reduce((t,e)=>(t[e]=[],t),{}),wQe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],oEe=new dQe({whiteList:bQe,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(wQe.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function xQe(t){return t==="Enter"||t===" "}const aEe="http://www.w3.org/",RU=`${aEe}2000/svg`,lEe=`${aEe}1999/xlink`;let Tue=[],Kre=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},eie=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),cEe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},TQe=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(eie(t[i],e))return i}return-1},Rz=(t,e,r,i)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(eie(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},SQe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},wQ=[],xQ=!1,uEe=t=>{(t.children||[]).forEach(uEe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},Sue=()=>{xQ=!1,wQ.forEach(uEe),wQ.length=0},Eue=t=>{wQ.push(t),xQ||(xQ=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(Sue,{timeout:16}):setTimeout(Sue,16))},Cue=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),Eue(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),Eue(t))},EQe=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")TQ(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let A=c[p];l[A]&&t.classList.add(A)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let A=c[p],_=l[A];_&&(cEe(_),r.styleApplyer(t,A,_))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),t[a]=l):r.namespace===RU?a==="href"?t.setAttributeNS(lEe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=oEe.sanitize(l):hEe(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function hEe(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let Vk,CQe=(t,e,r)=>{if(e)for(let i of e)gC(i,t,void 0,r)},dEe=(t,e,r)=>{CQe(t,e.children,r),e.text&&(t.textContent=e.text),EQe(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},gC=(t,e,r,i)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(s,r):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(i=Kre(i,{namespace:RU})),i.namespace!==void 0?s=t.domNode=a.createElementNS(i.namespace,p):(s=t.domNode=t.domNode||a.createElement(p),p==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(s,r):s.parentNode!==e&&e.appendChild(s)),n=l+1}}dEe(s,t,i)}},TQ=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},MQe=(t,e,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],h=e[l];if(l==="class")h!==c&&(TQ(t,h,!1),TQ(t,c,!0));else if(l==="classes"){let p=t.classList,A=Object.keys(c),_=A.length;for(let w=0;w<_;w++){let T=A[w],C=!!c[T];C!==!!h[T]&&(s=!0,C?p.add(T):p.remove(T))}}else if(l==="styles"){let p=Object.keys(c),A=p.length;for(let _=0;_<A;_++){let w=p[_],T=c[w];T!==h[w]&&(s=!0,T?(cEe(T),i.styleApplyer(t,w,T)):i.styleApplyer(t,w,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=t[l];p!==c&&(t["oninput-value"]?p===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&i.eventHandlerInterceptor||(i.namespace===RU?l==="href"?t.setAttributeNS(lEe,l,c):t.setAttribute(l,c):p==="string"?l==="innerHTML"?t[l]=oEe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):hEe(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}return s},RQe=(t,e,r,i,s)=>{if(r===i)return!1;i=i||Tue;let n,o=(r=r||Tue).length,a=i.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?r[l]:void 0,A=i[c];if(p!==void 0&&eie(p,A))h=Vk(p,A,s)||h,l++;else{let _=TQe(r,A,l+1);if(_>=0){for(n=l;n<_;n++)Cue(r[n]),Rz(r,n,t,"removed");h=Vk(r[_],A,s)||h,l=_+1}else gC(A,e,l<o?r[l].domNode:void 0,s),SQe(A),Rz(i,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)Cue(r[n]),Rz(r,n,t,"removed");return h};Vk=(t,e,r)=>{let i=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,s=!0,s}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=Kre(r,{namespace:RU})),t.text!==e.text&&(n=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,n=RQe(e,i,t.children,e.children,r)||n,n=MQe(i,t.properties,e.properties,r)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),s};let LR=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,Vk(i,r,e)},domNode:t.domNode});const OQe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let aE=t=>Kre(OQe,t),vv={create:(t,e)=>(e=aE(e),gC(t,document.createElement("div"),void 0,e),LR(t,e)),append:(t,e,r)=>(r=aE(r),gC(e,t,void 0,r),LR(e,r)),insertBefore:(t,e,r)=>(r=aE(r),gC(e,t.parentNode,t,r),LR(e,r)),merge:(t,e,r)=>(r=aE(r),e.domNode=t,dEe(t,e,r),LR(e,r)),replace:(t,e,r)=>(r=aE(r),gC(e,t.parentNode,t,r),t.parentNode.removeChild(t),LR(e,r))},pEe,PQe=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};pEe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let IQe=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?pEe(r.children,s=>s.domNode===i):void 0}),r},$Qe=(t,e,r)=>{let i=function(s){r("domEvent",s);let n=e(),o=PQe(s.currentTarget,n.domNode);o.reverse();let a,l=IQe(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},SQ=t=>{let e,r,i=aE(t),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,A,_)=>{let w,T=()=>w;i.eventHandlerInterceptor=$Qe(e,T,s),w=p(A,_(),i),a.push(w),l.push(_)},h=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let A=l[p]();s("rendered",void 0),a[p].update(A),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:h,scheduleRender:()=>{r||o||(r=requestAnimationFrame(h))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(p,A)=>{c(vv.append,p,A)},insertBefore:(p,A)=>{c(vv.insertBefore,p,A)},merge:(p,A)=>{c(vv.merge,p,A)},replace:(p,A)=>{c(vv.replace,p,A)},detach:p=>{for(let A=0;A<l.length;A++)if(l[A]===p)return l.splice(A,1),a.splice(A,1)[0];throw new Error("renderFunction was not found")}},e},g1=class extends Ke{constructor(){super(...arguments),this.items=new or,this._watchUpdatingTracking=new vg,this._callbacks=new Map,this._projector=SQ(),this._hiddenProjector=SQ()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const s=()=>i.render();this._callbacks.set(i,s),this._projector.append(this.surface,s)}for(const i of r.removed){const s=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(s.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);i.append(r,n),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(n);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),s=this.computeBoundingRect(r);return Math.max(i.left,s.left)<=Math.min(i.right,s.right)&&Math.max(i.top,s.top)<=Math.min(i.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(i=>{r.save(),i.renderCanvas(r),r.restore()}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([d({readOnly:!0})],g1.prototype,"surface",void 0),u([d({readOnly:!0})],g1.prototype,"items",void 0),u([d({readOnly:!0})],g1.prototype,"needsRender",null),u([d({readOnly:!0})],g1.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],g1.prototype,"updating",null),g1=u([j("esri.views.overlay.ViewOverlay")],g1);const Mue=g1;function WC(t,e,r,i){let s=null,n=1e3;typeof e=="number"?(n=e,i=r):(s=e??null,n=r);let o,a=0;const l=()=>{a=0,t.apply(i,o)},c=(...h)=>{s&&s.apply(i,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}const LQe="randomUUID"in crypto;function DQe(){if(LQe)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}const NQe={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},FQe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{t.style[e]=r}},kQe=t=>({...FQe,...t}),BQe=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},UQe=(t,e)=>t.find(e),Rue=(t,e,r=!1)=>{let i=t;return e.forEach((s,n)=>{const o=i!=null&&i.children?UQe(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==e.length-1||(i=o)}),i},VQe=t=>{let e;const r={...NQe,...t},i=kQe(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(A,_,w)=>{var M;let T;i.eventHandlerInterceptor=(O,$,L,k)=>function(F){let G;s("domEvent",F);const z=BQe(F.currentTarget,T.domNode),Z=z.some(te=>{var re;return customElements.get((re=te==null?void 0:te.tagName)==null?void 0:re.toLowerCase())});if(F.eventPhase===Event.CAPTURING_PHASE||!Z)z.reverse(),G=Rue(T.getLastRender(),z);else{const te=F.composedPath(),re=te.slice(te.indexOf(F.currentTarget),te.indexOf(T.domNode)).filter(Ae=>Ae.getRootNode()===Ae.ownerDocument).reverse();G=Rue(T.getLastRender(),re,!0)}let J;return G&&(J=r.handleInterceptedEvent(e,G,this,F)),s("domEventProcessed",F),J},(M=r.postProcessProjectionOptions)==null||M.call(r,i);const C=w();T=A(_,C,i),l.push(T),c.push(w),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(T,C)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let A=0;A<l.length;A++){const _=c[A]();s("rendered",void 0),l[A].update(_),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(p=r.modifyDoRenderImplementation(p,l,c)),e={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(A,_)=>{h(vv.append,A,_)},insertBefore:(A,_)=>{h(vv.insertBefore,A,_)},merge:(A,_)=>{h(vv.merge,A,_)},replace:(A,_)=>{h(vv.replace,A,_)},detach:A=>{for(let _=0;_<c.length;_++)if(c[_]===A)return c.splice(_,1),l.splice(_,1)[0];throw new Error("renderFunction was not found")}},e},lE={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let cE,fEe,OU,mEe=!1,zk=!1,tie=!1,_d=!1,Oue=null,EQ=!1;const ZFt=t=>{const e=new URL(t,ac.$resourcesUrl$);return e.origin!==xL.location.origin?e.href:e.pathname},zQe=t=>ac.$resourcesUrl$=t,Qx=(t,e="")=>()=>{},Pue="http://www.w3.org/1999/xlink",Iue={},GQe="http://www.w3.org/2000/svg",jQe="http://www.w3.org/1999/xhtml",HQe=t=>t!=null,rie=t=>(t=typeof t,t==="object"||t==="function"),gEe=(t,e,...r)=>{let i=null,s=null,n=null,o=!1,a=!1;const l=[],c=p=>{for(let A=0;A<p.length;A++)i=p[A],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!rie(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?Gk(null,i):i),a=o)};if(c(r),e){e.key&&(s=e.key),e.name&&(n=e.name);{const p=e.className||e.class;p&&(e.class=typeof p!="object"?p:Object.keys(p).filter(A=>p[A]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,YQe);const h=Gk(t,null);return h.$attrs$=e,l.length>0&&(h.$children$=l),h.$key$=s,h.$name$=n,h},Gk=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},qQe={},WQe=t=>t&&t.$tag$===qQe,YQe={forEach:(t,e)=>t.map($ue).forEach(e),map:(t,e)=>t.map($ue).map(e).map(QQe)},$ue=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),QQe=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),gEe(t.vtag,r,...t.vchildren||[])}const e=Gk(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},XQe=t=>xXe.map(e=>e(t)).find(e=>!!e),ZQe=(t,e)=>t!=null&&!rie(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,JQe=t=>t,JFt=(t,e,r)=>{const i=JQe(t);return{emit:s=>KQe(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s})}},KQe=(t,e,r)=>{const i=ac.ce(e,r);return t.dispatchEvent(i),i},Lue=new WeakMap,eXe=(t,e,r)=>{let i=Hk.get(t);EXe&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,Hk.set(t,i)},tXe=(t,e,r,i)=>{let s=AEe(e,r);const n=Hk.get(s);if(t=t.nodeType===11?t:xg,n)if(typeof n=="string"){t=t.head||t;let o=Lue.get(t),a;o||Lue.set(t,o=new Set),o.has(s)||(a=xg.createElement("style"),a.innerHTML=n,t.insertBefore(a,t.querySelector("link")),o&&o.add(s))}else t.adoptedStyleSheets.includes(n)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,n]);return s},rXe=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,s=Qx("attachStyles",e.$tagName$),n=tXe(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},AEe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Due=(t,e,r,i,s,n)=>{if(r!==i){let o=Bue(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=Nue(r),h=Nue(i);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):Bue(xL,a)?e=a.slice(2):e=a[2]+e.slice(3),r&&ac.rel(t,e,r,!1),i&&ac.ael(t,e,i,!1);else{const l=rie(i);if((o||l&&i!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=i;else{const h=i??"";e==="list"?o=!1:(r==null||t[e]!=h)&&(t[e]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(Pue,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(Pue,e,i):t.setAttribute(e,i))}}},iXe=/\s/,Nue=t=>t?t.split(iXe):[],yEe=(t,e,r,i)=>{const s=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||Iue,o=e.$attrs$||Iue;for(i in n)i in o||Due(s,i,n[i],void 0,r,e.$flags$);for(i in o)Due(s,i,n[i],o[i],r,e.$flags$)},jk=(t,e,r,i)=>{const s=e.$children$[r];let n=0,o,a,l;if(mEe||(tie=!0,s.$tag$==="slot"&&(cE&&i.classList.add(cE+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=xg.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=xg.createTextNode("");else{if(_d||(_d=s.$tag$==="svg"),o=s.$elm$=xg.createElementNS(_d?GQe:jQe,s.$flags$&2?"slot-fb":s.$tag$),_d&&s.$tag$==="foreignObject"&&(_d=!1),yEe(null,s,_d),HQe(cE)&&o["s-si"]!==cE&&o.classList.add(o["s-si"]=cE),s.$children$)for(n=0;n<s.$children$.length;++n)a=jk(t,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?_d=!1:o.tagName==="foreignObject"&&(_d=!0)}return o["s-hn"]=OU,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=fEe,o["s-sn"]=s.$name$||"",l=t&&t.$children$&&t.$children$[r],l&&l.$tag$===s.$tag$&&t.$elm$&&o4(t.$elm$,!1)),o},o4=(t,e)=>{ac.$flags$|=1;const r=t.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==OU&&s["s-ol"]&&(bEe(s).insertBefore(s,iie(s)),s["s-ol"].remove(),s["s-ol"]=void 0,tie=!0),e&&o4(s,e)}ac.$flags$&=-2},_Ee=(t,e,r,i,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===OU&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=jk(null,r,s,t),a&&(i[s].$elm$=a,o.insertBefore(a,iie(e))))},vEe=(t,e,r,i,s)=>{for(;e<=r;++e)(i=t[e])&&(s=i.$elm$,TEe(i),zk=!0,s["s-ol"]?s["s-ol"].remove():o4(s,!0),s.remove())},sXe=(t,e,r,i)=>{let s=0,n=0,o=0,a=0,l=e.length-1,c=e[0],h=e[l],p=i.length-1,A=i[0],_=i[p],w,T;for(;s<=l&&n<=p;)if(c==null)c=e[++s];else if(h==null)h=e[--l];else if(A==null)A=i[++n];else if(_==null)_=i[--p];else if(r5(c,A))uE(c,A),c=e[++s],A=i[++n];else if(r5(h,_))uE(h,_),h=e[--l],_=i[--p];else if(r5(c,_))(c.$tag$==="slot"||_.$tag$==="slot")&&o4(c.$elm$.parentNode,!1),uE(c,_),t.insertBefore(c.$elm$,h.$elm$.nextSibling),c=e[++s],_=i[--p];else if(r5(h,A))(c.$tag$==="slot"||_.$tag$==="slot")&&o4(h.$elm$.parentNode,!1),uE(h,A),t.insertBefore(h.$elm$,c.$elm$),h=e[--l],A=i[++n];else{for(o=-1,a=s;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===A.$key$){o=a;break}o>=0?(T=e[o],T.$tag$!==A.$tag$?w=jk(e&&e[n],r,o,t):(uE(T,A),e[o]=void 0,w=T.$elm$),A=i[++n]):(w=jk(e&&e[n],r,n,t),A=i[++n]),w&&bEe(c.$elm$).insertBefore(w,iie(c.$elm$))}s>l?_Ee(t,i[p+1]==null?null:i[p+1].$elm$,r,i,n,p):n>p&&vEe(e,s,l)},r5=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,iie=t=>t&&t["s-ol"]||t,bEe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,uE=(t,e)=>{const r=e.$elm$=t.$elm$,i=t.$children$,s=e.$children$,n=e.$tag$,o=e.$text$;let a;o===null?(_d=n==="svg"?!0:n==="foreignObject"?!1:_d,n==="slot"||yEe(t,e,_d),i!==null&&s!==null?sXe(r,i,e,s):s!==null?(t.$text$!==null&&(r.textContent=""),_Ee(r,null,e,s,0,s.length-1)):i!==null&&vEe(i,0,i.length-1),_d&&n==="svg"&&(_d=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(r.data=o)},wEe=t=>{const e=t.childNodes;let r,i,s,n,o,a;for(i=0,s=e.length;i<s;i++)if(r=e[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=e[n].nodeType,e[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===e[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&e[n].textContent.trim()!==""){r.hidden=!0;break}}wEe(r)}},h0=[],xEe=t=>{let e,r,i,s,n,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(r=e["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=e["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==e["s-hn"]&&(Fue(r,s)?(n=h0.find(h=>h.$nodeToRelocate$===r),zk=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=e:h0.push({$slotRefNode$:e,$nodeToRelocate$:r}),r["s-sr"]&&h0.map(h=>{Fue(h.$nodeToRelocate$,r["s-sn"])&&(n=h0.find(p=>p.$nodeToRelocate$===r),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):h0.some(h=>h.$nodeToRelocate$===r)||h0.push({$nodeToRelocate$:r}));e.nodeType===1&&xEe(e)}},Fue=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",TEe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(TEe)},nXe=(t,e)=>{const r=t.$hostElement$,i=t.$cmpMeta$,s=t.$vnode$||Gk(null,null),n=WQe(e)?e:gEe(null,null,e);OU=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,t.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,cE=r["s-sc"],fEe=r["s-cr"],mEe=(i.$flags$&1)!==0,zk=!1,uE(s,n);{if(ac.$flags$|=1,tie){xEe(n.$elm$);let o,a,l,c,h,p,A=0;for(;A<h0.length;A++)o=h0[A],a=o.$nodeToRelocate$,a["s-ol"]||(l=xg.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(A=0;A<h0.length;A++)if(o=h0[A],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}zk&&wEe(n.$elm$),ac.$flags$&=-2,h0.length=0}},oXe=(t,e)=>{},sie=(t,e)=>(t.$flags$|=16,oXe(t,t.$ancestorComponent$),RXe(()=>aXe(t,e))),aXe=(t,e)=>{const r=t.$hostElement$,i=Qx("scheduleUpdate",t.$cmpMeta$.$tagName$),s=r;let n;return e?n=YC(s,"componentWillLoad"):n=YC(s,"componentWillUpdate"),n=kue(n,()=>YC(s,"componentWillRender")),i(),kue(n,()=>lXe(t,s,e))},lXe=async(t,e,r)=>{const i=t.$hostElement$,s=Qx("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&rXe(t);const n=Qx("render",t.$cmpMeta$.$tagName$);cXe(t,e,i),n(),s(),uXe(t)},cXe=(t,e,r)=>{try{Oue=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(lE.hasRenderFn||lE.reflect)&&(lE.vdomRender||lE.reflect)&&(lE.hydrateServerSide||nXe(t,e))}catch(a){wL(a,t.$hostElement$)}return Oue=null,null},uXe=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=Qx("postUpdate",e),s=r;t.$ancestorComponent$,YC(s,"componentDidRender"),t.$flags$&64?(YC(s,"componentDidUpdate"),i()):(t.$flags$|=64,YC(s,"componentDidLoad"),i())},KFt=t=>{{const e=bL(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&sie(e,!1),r}},YC=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){wL(i)}},kue=(t,e)=>t&&t.then?t.then(e):e(),hXe=(t,e)=>bL(t).$instanceValues$.get(e),dXe=(t,e,r,i)=>{const s=bL(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;r=ZQe(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const p=i.$watchers$[e];p&&p.map(A=>{try{l[A](r,o,e)}catch(_){wL(_,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;sie(s,!1)}}}},pXe=(t,e,r)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),s=t.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return hXe(this,n)},set(a){dXe(this,n,a,e)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){ac.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},fXe=async(t,e,r,i,s)=>{if(!(e.$flags$&32)&&(s=t.constructor,e.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[e.$modeName$=XQe(t)]);const a=AEe(r,e.$modeName$);if(!Hk.has(a)){const l=Qx("registerStyles",r.$tagName$);eXe(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,(()=>sie(e,!0))()},mXe=t=>{},gXe=t=>{if(!(ac.$flags$&1)){const e=bL(t),r=e.$cmpMeta$,i=Qx("connectedCallback",r.$tagName$);e.$flags$&1?(SEe(t,e,r.$listeners$),mXe(e.$lazyInstance$)):(e.$flags$|=1,r.$flags$&12&&AXe(t),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),fXe(t,e,r)),i()}},AXe=t=>{const e=t["s-cr"]=xg.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},yXe=t=>{if(!(ac.$flags$&1)){const e=bL(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},e6t=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[],!Uue&&r.$flags$&1&&(r.$flags$|=8);const i=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){wXe(this,r)},connectedCallback(){gXe(this),i&&i.call(this)},disconnectedCallback(){yXe(this),s&&s.call(this)},__attachShadow(){Uue?this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)}):this.shadowRoot=this}}),t.is=r.$tagName$,pXe(t,r)},t6t=(t,e)=>e,SEe=(t,e,r,i)=>{r&&r.map(([s,n,o])=>{const a=vXe(t,s),l=_Xe(e,o),c=bXe(s);ac.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>ac.rel(a,n,l,c))})},_Xe=(t,e)=>r=>{try{lE.lazyLoad||t.$hostElement$[e](r)}catch(i){wL(i)}},vXe=(t,e)=>e&4?xg:e&8?xL:e&16?xg.body:t,bXe=t=>TXe?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,EEe=new WeakMap,bL=t=>EEe.get(t),wXe=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return SEe(t,r,e.$listeners$),EEe.set(t,r)},Bue=(t,e)=>e in t,wL=(t,e)=>(0,console.error)(t,e),Hk=new Map,xXe=[],xL=typeof window<"u"?window:{},xg=xL.document||{head:{}},r6t=xL.HTMLElement||class{},ac={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},Uue=!0,TXe=(()=>{let t=!1;try{xg.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),SXe=t=>Promise.resolve(t),EXe=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),Vue=[],CEe=[],CXe=(t,e)=>r=>{t.push(r),EQ||(EQ=!0,e&&ac.$flags$&4?MXe(CQ):ac.raf(CQ))},zue=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){wL(r)}t.length=0},CQ=()=>{zue(Vue),zue(CEe),(EQ=Vue.length>0)&&ac.raf(CQ)},MXe=t=>SXe().then(t),RXe=CXe(CEe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */const MEe="calcite-mode-auto",REe="calcite-mode-dark",OXe="calcite-mode-light",i6t={autoMode:MEe,darkMode:REe,lightMode:OXe,rtl:"calcite--rtl"};/*!
* tabbable 6.0.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var OEe=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],qk=OEe.join(","),PEe=typeof Element>"u",Xx=PEe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Wk=!PEe&&Element.prototype.getRootNode?function(t){return t.getRootNode()}:function(t){return t.ownerDocument},IEe=function(e,r,i){var s=Array.prototype.slice.apply(e.querySelectorAll(qk));return r&&Xx.call(e,qk)&&s.unshift(e),s=s.filter(i),s},$Ee=function t(e,r,i){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=Xx.call(o,qk);h&&i.filter(o)&&(r||!e.includes(o))&&s.push(o);var p=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),A=!i.shadowRootFilter||i.shadowRootFilter(o);if(p&&A){var _=t(p===!0?o.children:p.children,!0,i);i.flatten?s.push.apply(s,_):s.push({scopeParent:o,candidates:_})}else n.unshift.apply(n,o.children)}}return s},LEe=function(e,r){return e.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||e.isContentEditable)&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},PXe=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},DEe=function(e){return e.tagName==="INPUT"},IXe=function(e){return DEe(e)&&e.type==="hidden"},$Xe=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},LXe=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},DXe=function(e){if(!e.name)return!0;var r=e.form||Wk(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=i(window.CSS.escape(e.name));else try{s=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=LXe(s,e.form);return!n||n===e},NXe=function(e){return DEe(e)&&e.type==="radio"},FXe=function(e){return NXe(e)&&!DXe(e)},kXe=function(e){for(var r,i=Wk(e).host,s=!!((r=i)!==null&&r!==void 0&&r.ownerDocument.contains(i)||e.ownerDocument.contains(e));!s&&i;){var n;i=Wk(i).host,s=!!((n=i)!==null&&n!==void 0&&n.ownerDocument.contains(i))}return s},Gue=function(e){var r=e.getBoundingClientRect(),i=r.width,s=r.height;return i===0&&s===0},BXe=function(e,r){var i=r.displayCheck,s=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=Xx.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(Xx.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=Wk(e);if(l&&!l.shadowRoot&&s(l)===!0)return Gue(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(kXe(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return Gue(e);return!1},UXe=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var s=r.children.item(i);if(s.tagName==="LEGEND")return Xx.call(r,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}r=r.parentElement}return!1},Yk=function(e,r){return!(r.disabled||IXe(r)||BXe(r,e)||$Xe(r)||UXe(r))},MQ=function(e,r){return!(FXe(r)||LEe(r)<0||!Yk(e,r))},VXe=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},zXe=function t(e){var r=[],i=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=LEe(a,o),c=o?t(s.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),i.sort(PXe).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(r)},GXe=function(e,r){r=r||{};var i;return r.getShadowRoot?i=$Ee([e],r.includeContainer,{filter:MQ.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:VXe}):i=IEe(e,r.includeContainer,MQ.bind(null,r)),zXe(i)},s6t=function(e,r){r=r||{};var i;return r.getShadowRoot?i=$Ee([e],r.includeContainer,{filter:Yk.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=IEe(e,r.includeContainer,Yk.bind(null,r)),i},n6t=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return Xx.call(e,qk)===!1?!1:MQ(r,e)},jXe=OEe.concat("iframe").join(","),o6t=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return Xx.call(e,jXe)===!1?!1:Yk(r,e)};const HXe={getShadowRoot:!0};function a6t(t){const e="dir",r=`[${e}]`,i=qXe(t,r);return i?i.getAttribute(e):"ltr"}function l6t(t,e,r){const i=`[${e}]`,s=t.closest(i);return s?s.getAttribute(e):r}function NEe(t){return t.getRootNode()}function FEe(t){return t.host||null}function c6t(t,{selector:e,id:r}){function i(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=NEe(s),o=r?"getElementById"in n?n.getElementById(r):null:e?n.querySelector(e):null,a=FEe(n);return o||(a?i(a):null)}return i(t)}function qXe(t,e){function r(i){return i?i.closest(e)||r(FEe(NEe(i))):null}return r(t)}function WXe(t,e){return kEe(t,e)}function kEe(t,e){if(!t)return;const r=e(t);if(r!==void 0)return r;const{parentNode:i}=t;return kEe(i instanceof ShadowRoot?i.host:i,e)}function u6t(t,e){return!!WXe(e,r=>r===t?!0:void 0)}function YXe(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function h6t(t){if(t)return YXe(t)?t.setFocus():t.focus()}function d6t(t){(GXe(t,HXe)[0]||t).focus()}const a4=":not([slot])";function p6t(t,e,r){e&&!Array.isArray(e)&&typeof e!="string"&&(r=e,e=null);const i=e?Array.isArray(e)?e.map(s=>`[slot="${s}"]`).join(","):`[slot="${e}"]`:a4;return r!=null&&r.all?QXe(t,i,r):XXe(t,i,r)}function BEe(t,e){return t?Array.from(t.children||[]).filter(r=>r==null?void 0:r.matches(e)):[]}function QXe(t,e,r){let i=e===a4?BEe(t,a4):Array.from(t.querySelectorAll(e));i=r&&r.direct===!1?i:i.filter(n=>n.parentElement===t),i=r!=null&&r.matches?i.filter(n=>n==null?void 0:n.matches(r.matches)):i;const s=r==null?void 0:r.selector;return s?i.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):i}function XXe(t,e,r){let i=e===a4?BEe(t,a4)[0]||null:t.querySelector(e);i=r&&r.direct===!1||(i==null?void 0:i.parentElement)===t?i:null,i=r!=null&&r.matches?i!=null&&i.matches(r.matches)?i:null:i;const s=r==null?void 0:r.selector;return s?i==null?void 0:i.querySelector(s):i}function f6t(t,e,r){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[r]}function m6t(t){return(!!t).toString()}function g6t(t){return!!ZXe(t).length}function ZXe(t){return t.target.assignedElements({flatten:!0})}function A6t(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */function jue(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(REe)||t.contains(MEe)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&i(o),n=o};let n=r();i(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function JXe(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?jue():document.addEventListener("DOMContentLoaded",()=>jue(),{once:!0}))}const KXe=JXe;KXe();let UEe;function eZe(){zQe(Od(Zi(UEe)))}UEe="components/assets";const VEe=Symbol("widget"),tZe=Symbol("widget-test-data"),rZe=[],iZe={},Qk=new WeakMap;function zEe(t,e){let r=e.children;if(r&&r.length)for(let s=0;s<r.length;++s)r[s]=zEe(t,r[s]);else r=rZe;const i=e.vnodeSelector;if(nie(i)){const s=e.properties||iZe,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:sZe,afterUpdate:nZe,afterRemoved:GEe,parentWidget:t,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return e}function sZe(t,e,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=t,Qk.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),i._internalHandles.add(F0(()=>GEe(t)))}function nZe(t,e,r,{widgetProperties:i}){var n;const s=Qk.get(t);s&&(s.set(i),(n=s.afterUpdate)==null||n.call(s,s,t))}function GEe(t){var r;const e=Qk.get(t);e&&((r=e.afterRemoved)==null||r.call(e,e,t),e.destroy(),Qk.delete(t))}function nie(t){return typeof t=="function"&&t[VEe]}const Hue=new Set;function oZe(t){Hue.add(t),t.finally(()=>Hue.delete(t))}var jEe;const aZe="esri.widgets.Widget";let lZe=0;const cZe={widgetIcon:"esri-icon-checkbox-unchecked"};function HEe(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?HEe(t[r],e==null?void 0:e[r]):t[r]=e[r]);return t}const uZe=VQe({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,s,n,o)=>{const a=e==null?void 0:e(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),h=_=>a==null?void 0:a.call(n,_);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),A=o.afterRemoved;o.afterRemoved=_=>{A==null||A(_),p()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(iEe(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let Oz=!1,Wa=class extends zB(Nn.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._internalHandles=new ts,this._projector=uZe,this._readyForTrueRender=!1,this.iconClass=cZe.widgetIcon,this.key=this,this._loadLocale=Cbe(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await Vu(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{let c=await kte(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=HEe(Te(c),this.uiStrings)),this[l]=c}));for(const a of o)a.error&&we.getLogger(this.declaredClass).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),eZe();const i="esri-widget-uid-"+DQe(),s=this.render.bind(this);this._trackingTarget=new UB(()=>this.scheduleRender());const n=()=>{var p;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0};const o=s();let{properties:a}=o;a||(o.properties=a={});let{key:l,styles:c}=a;l||(a.key=i),c||(a.styles=c={}),c.display||(c.display="");let h=0;return(p=o.children)==null||p.forEach(A=>{if(nie(A.vnodeSelector))return;let{properties:_}=A;_||(A.properties=_={}),_.key||(_.key=`${this.id}--${h++}`)}),zEe(this,o)};this.render=()=>{if(Oz)return n();let o=pQe(this)??null;if(o)return o;this._trackingTarget.clear(),Oz=!0;try{o=$y(this._trackingTarget,n)}catch(a){throw console.error(a),a}finally{Oz=!1}return o&&fQe(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),oZe(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(oW)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(gt(this._trackingTarget),gt(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,Mz(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return hU(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+lZe++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(jEe=VEe,tZe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(Mz(this),this._projector.scheduleRender())}classes(...e){return nEe.apply(this,e)}renderNow(){Mz(this),this._projector.renderNow()}_postInitialize(){var r;if(this.destroyed)return;this.scheduleRender(),(r=this._delegatedEventNames)!=null&&r.length&&this._internalHandles.add(xe(()=>this.viewModel,(i,s)=>{s&&this._internalHandles.remove("delegated-events"),i&&kB(i)&&this._internalHandles.add(this._delegatedEventNames.map(n=>nL(i,n,o=>{this.emit(n,o)})),"delegated-events")},Cr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(oW),this.scheduleRender()};this._internalHandles.add([Dte(e),xe(()=>this.uiStrings,e),Nl(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var r;this._attached&&(this._projector.detach(this.render),this._attached=!1),(r=e==null?void 0:e.parentNode)==null||r.removeChild(e)}};Wa[jEe]=!0,u([d()],Wa.prototype,"_readyForTrueRender",void 0),u([d({value:null})],Wa.prototype,"container",null),u([Hr("container")],Wa.prototype,"castContainer",null),u([d()],Wa.prototype,"iconClass",void 0),u([d()],Wa.prototype,"id",null),u([d()],Wa.prototype,"label",null),u([d()],Wa.prototype,"renderable",null),u([d()],Wa.prototype,"uiStrings",void 0),u([d()],Wa.prototype,"viewModel",void 0),u([d({value:!0})],Wa.prototype,"visible",null),u([d()],Wa.prototype,"key",void 0),u([d()],Wa.prototype,"children",void 0),u([d()],Wa.prototype,"afterCreate",void 0),u([d()],Wa.prototype,"afterUpdate",void 0),u([d()],Wa.prototype,"afterRemoved",void 0),Wa=u([j(aZe)],Wa);const pc=Wa;function hZe(t,e,r){return t.units[e][r]}function PU(t,e,r,i=2,s="abbr"){return`${Dg(e,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:e>0?"never":"exceptZero"})} ${hZe(t,r,s)}`}function _6t(t,e,r,i=2,s="abbr"){const n=Pwe(e,r);return PU(t,Go(e,r,n),n,i,s)}function v6t(t,e,r,i=2,s="abbr"){const n=Iwe(e,r);return PU(t,Go(e,r,n),n,i,s)}function b6t(t,e,r,i=2,s="abbr"){const n=$we(e,r);return PU(t,Go(e,r,n),n,i,s)}function w6t(t,e,r,i=2,s="abbr"){const n=Lwe(e,r);return PU(t,Go(e,r,n),n,i,s)}const que=["B","kB","MB","GB","TB"];function dZe(t,e){let r=e===0?0:Math.floor(Math.log(e)/Math.log(q3.KILOBYTES));r=ze(r,0,que.length-1);const i=Dg(e/q3.KILOBYTES**r,{maximumFractionDigits:2});return Og(t.units.bytes[que[r]],{fileSize:i})}function pZe(t){const{exifInfo:e,exifName:r,tagName:i}=t;if(!e||!r||!i)return null;const s=e.find(n=>n.name===r);return s?fZe({tagName:i,tags:s.tags}):null}function fZe(t){const{tagName:e,tags:r}=t;if(!r||!e)return null;const i=r.find(s=>s.name===e);return i&&i.value||null}var RQ;const mZe={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let sh=RQ=class extends Qe{constructor(t){super(t),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:t}=this,e=pZe({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:t});return mZe[e]||null}clone(){return new RQ({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],sh.prototype,"contentType",void 0),u([d()],sh.prototype,"exifInfo",void 0),u([d({readOnly:!0})],sh.prototype,"orientationInfo",null),u([d({type:rn})],sh.prototype,"id",void 0),u([d({type:String})],sh.prototype,"globalId",void 0),u([d({type:String})],sh.prototype,"keywords",void 0),u([d({type:String})],sh.prototype,"name",void 0),u([d({json:{read:!1}})],sh.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],sh.prototype,"parentObjectId",void 0),u([d({type:rn})],sh.prototype,"size",void 0),u([d({json:{read:!1}})],sh.prototype,"url",void 0),sh=RQ=u([j("esri.layers.support.AttachmentInfo")],sh);const gZe=sh;var OQ;let vl=OQ=class extends Qe{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new OQ(Te({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],vl.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],vl.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],vl.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],vl.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],vl.prototype,"globalIds",void 0),u([d({json:{write:!0}})],vl.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],vl.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],vl.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],vl.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],vl.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],vl.prototype,"start",void 0),u([St("start"),St("num")],vl.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],vl.prototype,"where",void 0),vl=OQ=u([j("esri.rest.support.AttachmentQuery")],vl),vl.from=Oo(vl);const PQ=vl,AZe="esri.widgets.Feature.support.featureUtils",Wue=we.getLogger(AZe),yZe=/href=(""|'')/gi,_Ze=/(\{([^\{\r\n]+)\})/g,vZe=/\'/g,qEe=/^\s*expression\//i,bZe=/(\n)/gi,wZe=/[\u00A0-\u9999<>\&]/gim,xZe=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,TZe=/^(?:mailto:|tel:)/,WEe="relationships/",IQ=ZB("short-date-short-time");function YEe(t){if(!N(t))return t.get("sourceLayer")||t.get("layer")}async function Xk(t,e){return typeof t=="function"?t.call(null,e):t}function QEe(t=""){if(t)return!TZe.test(t.trim().toLowerCase())}function oie(t){return!!t&&qEe.test(t)}function SZe(t,e){if(!oie(e)||!t)return null;const r=e.replace(qEe,"").toLowerCase();let i=null;return t.some(s=>s.name.toLowerCase()===r&&(i=s,!0)),i}function XEe(t,e){const r=SZe(e,t==null?void 0:t.fieldName);return r?r.title||null:t?t.label||t.fieldName:null}function EZe(t,e){const r=e.get(t.toLowerCase());return`{${r&&r.fieldName||t}}`}function CZe(t){return t.replace(yZe,"")}function l4(t,e){const r=aie(e,t);return r?r.name:t}function MZe(t,e){return t&&t.map(r=>l4(r,e))}function aie(t,e){return t&&typeof t.getField=="function"&&e?t.getField(e)??null:null}function ZEe(t){return`${t}`.trim()}function ex({attributes:t,globalAttributes:e,layer:r,text:i,expressionAttributes:s,fieldInfoMap:n}){return i?$Q({formattedAttributes:e,template:IZe(i,{...e,...s,...t},r),fieldInfoMap:n}):""}function $Q({formattedAttributes:t,template:e,fieldInfoMap:r}){return ZEe(CZe(Og(Og(e,i=>EZe(i,r)),t)))}function RZe(t,e,r=!1){const i=e[t];if(typeof i=="string"){const s="%27",n=(r?encodeURIComponent(i):i).replace(vZe,s);e[t]=n}}function OZe(t,e=!1){const r={...t};return Object.keys(r).forEach(i=>RZe(i,r,e)),r}function PZe(t,e,r){const i=(e=ZEe(e))&&e[0]!=="{";return Og(t,OZe(r,i||!1))}function LQ(t,e){return t.replace(_Ze,(r,i,s)=>{const n=aie(e,s);return n?`{${n.name}}`:i})}function IZe(t,e,r){const i=LQ(t,r);return i&&i.replace(xZe,(s,n,o)=>PZe(s,n||o,e))}function $Ze(t,e){if(typeof t=="string"&&e&&e.dateFormat==null&&(e.places!=null||e.digitSeparator!=null)){const r=Number(t);if(!isNaN(r))return r}return t}function LZe(t){return(t==null?void 0:t.type)==="feature"}function Yue(t){return!!(t!=null&&t.layer)}function DZe(t){return(t==null?void 0:t.type)==="map-image"}function NZe(t,e){var c;const r=e.fieldInfos,i=e.fieldName,s=(c=JEe(r,i))==null?void 0:c.clone(),n=e.preventPlacesFormatting,o=e.layer,a=aie(o,i);if(s&&(a==null?void 0:a.type)==="date"){const h=s.format||new pC;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!Yue(o)&&LZe(o)&&o.datesInUnknownTimezone||Yue(o)&&DZe(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof t=="string"&&J2e(i)&&l?l.formatRasterPixelValue(t):typeof(t=$Ze(t,l))=="string"||t==null||l==null?TL(t):n?Dg(t,{...rxe(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(t)}function JEe(t,e){if(!t||!t.length||!e)return;const r=e.toLowerCase();let i;return t.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==r)&&(i=s,!0)),i}function FZe({fieldName:t,graphic:e,layer:r}){if(hy(t)||!r||typeof r.getFeatureType!="function")return null;const{typeIdField:i}=r;if(!i||t!==i)return null;const s=r.getFeatureType(e);return s?s.name:null}function kZe({fieldName:t,value:e,graphic:r,layer:i}){if(hy(t)||!i||typeof i.getFieldDomain!="function")return null;const s=r&&i.getFieldDomain(t,{feature:r});return s&&s.type==="coded-value"?s.getName(e):null}function BZe(t,e){const{creatorField:r,creationDateField:i,editorField:s,editDateField:n}=t;if(!e)return;const o=e[n];if(typeof o=="number"){const l=e[s];return{type:"edit",date:Lg(o,IQ),user:l}}const a=e[i];if(typeof a=="number"){const l=e[r];return{type:"create",date:Lg(a,IQ),user:l}}return null}function UZe(t,e){const r=new Map;return t&&t.forEach(i=>{const s=l4(i.fieldName,e);i.fieldName=s,r.set(s.toLowerCase(),i)}),r}function Que(t){const e=[];if(!t)return e;const{fieldInfos:r,content:i}=t;return r&&e.push(...r),i&&Array.isArray(i)&&i.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&e.push(...n)}}),e}function lie(t){return t.replace(wZe,e=>`&#${e.charCodeAt(0)};`)}function TL(t){return typeof t=="string"?t.replace(bZe,'<br class="esri-text-new-line" />'):t}function KEe(t){const{value:e,fieldName:r,fieldInfos:i,fieldInfoMap:s,layer:n,graphic:o}=t;if(e==null)return"";const a=kZe({fieldName:r,value:e,graphic:o,layer:n});if(a)return a;const l=FZe({fieldName:r,graphic:o,layer:n});if(l)return l;if(s.get(r.toLowerCase()))return NZe(e,{fieldInfos:i||Array.from(s.values()),fieldName:r,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(r)?Lg(e,IQ):TL(e)}function Pz({fieldInfos:t,attributes:e,layer:r,graphic:i,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>jZe({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:t,layer:r})),e&&Object.keys(e).forEach(a=>{const l=e[a];o[a]=KEe({fieldName:a,fieldInfos:t,fieldInfoMap:s,layer:r,value:l,graphic:i})}),o}async function eCe(t,e){var h,p;const{layer:r,graphic:i,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=t,l=n[0];if(typeof l!="number"&&typeof l!="string"){const A="Could not query required fields for the specified feature. The feature's ID is invalid.",_={layer:r,graphic:i,objectId:l,requiredFields:s};return Wue.warn(A,_),null}if(!((p=(h=t2e(r))==null?void 0:h.operations)!=null&&p.supportsQuery)){const A="The specified layer cannot be queried. The following fields will not be available.",_={layer:r,graphic:i,requiredFields:s,returnGeometry:o};return Wue.warn(A,_),null}const c=r.createQuery();return c.objectIds=n,c.outFields=s!=null&&s.length?s:[r.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await r.queryFeatures(c,e)).features[0]}async function VZe(t){var i;if(!((i=t.expressionInfos)!=null&&i.length))return!1;const e=await $g(),{arcadeUtils:{hasGeometryFunctions:r}}=e;return r(t)}async function zZe({graphic:t,popupTemplate:e,layer:r,spatialReference:i},s){if(!r||!e||(typeof r.load=="function"&&await r.load(s),!t.attributes))return;const n=t.attributes[r.objectIdField];if(n==null)return;const o=[n],a=await e.getRequiredFields(r.fieldsIndex),l=pje(a,t),c=l?[]:a,h=e.returnGeometry||await VZe(e);if(l&&!h)return;const p=await eCe({layer:r,graphic:t,outFields:c,objectIds:o,returnGeometry:h,spatialReference:i},s);p&&(p.geometry&&(t.geometry=p.geometry),p.attributes&&(t.attributes={...t.attributes,...p.attributes}))}function hy(t=""){return!!t&&t.includes(WEe)}function GZe(t){return t?`${WEe}${t.layerId}/${t.fieldName}`:""}function Xue({attributes:t,graphic:e,relatedInfo:r,fieldInfos:i,fieldInfoMap:s,layer:n}){t&&e&&r&&Object.keys(e.attributes).forEach(o=>{const a=GZe({layerId:r.relation.id.toString(),fieldName:o}),l=e.attributes[o];t[a]=KEe({fieldName:a,fieldInfos:i,fieldInfoMap:s,layer:n,value:l,graphic:e})})}function jZe({attributes:t,relatedInfo:e,fieldInfoMap:r,fieldInfos:i,layer:s}){t&&e&&(e.relatedFeatures&&e.relatedFeatures&&e.relatedFeatures.forEach(n=>Xue({attributes:t,graphic:n,relatedInfo:e,fieldInfoMap:r,fieldInfos:i,layer:s})),e.relatedStatsFeatures&&e.relatedStatsFeatures&&e.relatedStatsFeatures.forEach(n=>Xue({attributes:t,graphic:n,relatedInfo:e,fieldInfoMap:r,fieldInfos:i,layer:s})))}const Zue=t=>{if(!t)return!1;const e=t.toUpperCase();return e.includes("CURRENT_TIMESTAMP")||e.includes("CURRENT_DATE")||e.includes("CURRENT_TIME")},tCe=({layer:t,method:e,query:r,definitionExpression:i})=>{var o,a;if(!((a=(o=t.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||e==="attachments")return;const s=E(r.where)?r.where:null,n=E(r.geometry)?r.geometry:null;Zue(i)||Zue(s)||(n==null?void 0:n.type)==="extent"||r.resultType==="tile"||(r.cacheHint=!0)},HZe=({query:t,layer:e,method:r})=>{tCe({layer:e,method:r,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})},qZe=({queryPayload:t,layer:e,method:r})=>{tCe({layer:e,method:r,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})};function WZe(t,e,r){return t&&e&&r?Jue(t.allLayers,e,r)||Jue(t.allTables,e,r):null}function Jue(t,e,r){return t.find(i=>i!==e&&i.type==="feature"&&i.url===e.url&&i.layerId===r.relatedTableId)}const Kue={editing:!1,operations:{add:!0,update:!0,delete:!0}},rCe=or.ofType(gZe);let nh=class extends Ke{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...Kue},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new rCe,this.fileInfos=new or,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(xe(()=>this.graphic,()=>this._graphicChanged(),Cr))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...Kue,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const r=e.layer||e.sourceLayer;return(r==null?void 0:r.loaded)&&"capabilities"in r&&r.capabilities&&"operations"in r.capabilities&&"supportsResizeAttachments"in r.capabilities.operations&&r.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:r}=this;if(!e||typeof e.queryAttachments!="function")throw new ce("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getObjectId(),s=new PQ({objectIds:[i],returnMetadata:!0}),n=[],o=e.queryAttachments(s).then(l=>l[i]||n).catch(()=>n);this._getAttachmentsPromise=o,this.notifyChange("state");const a=await o;return r.removeAll(),a.length&&r.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(e,r=this.graphic){var l;const{_attachmentLayer:i,attachmentInfos:s,abilities:n}=this;if(!r)throw new ce("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:r});if(!e)throw new ce("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((l=n.operations)!=null&&l.add))throw new ce("invalid-abilities","addAttachment(): add abilities are required.");if(!i||typeof i.addAttachment!="function")throw new ce("invalid-layer","addAttachment(): A valid layer is required.");const o=i.addAttachment(r,e).then(c=>this._queryAttachment(c.objectId,r)),a=await o;return s.add(a),a}async deleteAttachment(e){var l;const{_attachmentLayer:r,attachmentInfos:i,graphic:s,abilities:n}=this;if(!e)throw new ce("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((l=n.operations)!=null&&l.delete))throw new ce("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!r||typeof r.deleteAttachments!="function")throw new ce("invalid-layer","deleteAttachment(): A valid layer is required.");if(!s)throw new ce("invalid-graphic","deleteAttachment(): A graphic is required.");const o=r.deleteAttachments(s,[e.id]).then(()=>e),a=await o;return i.remove(a),a}async updateAttachment(e,r=this.activeAttachmentInfo){var h;const{_attachmentLayer:i,attachmentInfos:s,graphic:n,abilities:o}=this;if(!e)throw new ce("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!r)throw new ce("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:r});if(!((h=o.operations)!=null&&h.update))throw new ce("invalid-abilities","updateAttachment(): Update abilities are required.");const a=s.findIndex(p=>p===r);if(!i||typeof i.updateAttachment!="function")throw new ce("invalid-layer","updateAttachment(): A valid layer is required.");if(!n)throw new ce("invalid-graphic","updateAttachment(): A graphic is required.");const l=i.updateAttachment(n,r.id,e).then(p=>this._queryAttachment(p.objectId)),c=await l;return s.splice(a,1,c),c}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,r){if(!e||!r)return null;const i={file:e,form:r};return this.fileInfos.add(i),i}updateFile(e,r,i=this.activeFileInfo){if(!e||!r||!i)return null;const s=this.fileInfos.findIndex(n=>i===n);return s>-1&&this.fileInfos.splice(s,1,{file:e,form:r}),this.fileInfos.items[s]}deleteFile(e){const r=this.fileInfos.find(i=>i.file===e);return r?(this.fileInfos.remove(r),r):null}async _queryAttachment(e,r){const{_attachmentLayer:i}=this;if(!e||!(i!=null&&i.queryAttachments))throw new ce("invalid-attachment-id","Could not query attachment.");const s=this._getObjectId(r),n=new PQ({objectIds:[s],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return i.queryAttachments(n).then(o=>o[s][0])}_getObjectId(e=this.graphic){return(e==null?void 0:e.getObjectId())??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,r=YEe(e);this._attachmentLayer=r?r.type==="scene"&&E(r.associatedLayer)?r.associatedLayer:r:null}};u([d()],nh.prototype,"abilities",void 0),u([Hr("abilities")],nh.prototype,"castAbilities",null),u([d()],nh.prototype,"activeAttachmentInfo",void 0),u([d()],nh.prototype,"activeFileInfo",void 0),u([d({readOnly:!0,type:rCe})],nh.prototype,"attachmentInfos",void 0),u([d()],nh.prototype,"fileInfos",void 0),u([d({type:pl})],nh.prototype,"graphic",void 0),u([d()],nh.prototype,"mode",void 0),u([d({readOnly:!0})],nh.prototype,"state",null),u([d()],nh.prototype,"filesEnabled",void 0),u([d({readOnly:!0})],nh.prototype,"supportsResizeAttachments",null),nh=u([j("esri.widgets.Attachments.AttachmentsViewModel")],nh);const cie=nh;function ehe(t){const e=t.toLowerCase();return e==="image/bmp"||e==="image/emf"||e==="image/exif"||e==="image/gif"||e==="image/x-icon"||e==="image/jpeg"||e==="image/png"||e==="image/tiff"||e==="image/x-wmf"}function YZe(t){const e=Zi("esri/themes/base/images/files/");return t?t==="text/plain"?`${e}text-32.svg`:t==="application/pdf"?`${e}pdf-32.svg`:t==="text/csv"?`${e}csv-32.svg`:t==="application/gpx+xml"?`${e}gpx-32.svg`:t==="application/x-dwf"?`${e}cad-32.svg`:t==="application/postscript"||t==="application/json"||t==="text/xml"||t==="model/vrml"?`${e}code-32.svg`:t==="application/x-zip-compressed"||t==="application/x-7z-compressed"||t==="application/x-gzip"||t==="application/x-tar"||t==="application/x-gtar"||t==="application/x-bzip2"||t==="application/gzip"||t==="application/x-compress"||t==="application/x-apple-diskimage"||t==="application/x-rar-compressed"||t==="application/zip"?`${e}zip-32.svg`:t.includes("image/")?`${e}image-32.svg`:t.includes("audio/")?`${e}sound-32.svg`:t.includes("video/")?`${e}video-32.svg`:t.includes("msexcel")||t.includes("ms-excel")||t.includes("spreadsheetml")?`${e}excel-32.svg`:t.includes("msword")||t.includes("ms-word")||t.includes("wordprocessingml")?`${e}word-32.svg`:t.includes("powerpoint")||t.includes("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}function Ll(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var QZe=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},iCe=function(t,e){for(var r=0,i=t.length;r<i;r++){var s=t[r];Array.isArray(s)?iCe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=QZe(s)),e.push(s))}},XZe=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var s=[];return iCe(r,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function pe(t,e,...r){return typeof t!="function"||nie(t)?XZe(t,e,...r):t(e,...r)}const the={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},ps="esri-attachments",zb="esri-button",Ct={base:ps,loaderContainer:`${ps}__loader-container`,loader:`${ps}__loader`,fadeIn:`${ps}--fade-in`,container:`${ps}__container`,containerList:`${ps}__container--list`,containerPreview:`${ps}__container--preview`,actions:`${ps}__actions`,deleteButton:`${ps}__delete-button`,addAttachmentButton:`${ps}__add-attachment-button`,errorMessage:`${ps}__error-message`,items:`${ps}__items`,item:`${ps}__item`,itemButton:`${ps}__item-button`,itemMask:`${ps}__item-mask`,itemMaskIcon:`${ps}__item-mask--icon`,itemImage:`${ps}__image`,itemImageResizable:`${ps}__image--resizable`,itemLabel:`${ps}__label`,itemFilename:`${ps}__filename`,itemChevronIcon:`${ps}__item-chevron-icon`,itemLink:`${ps}__item-link`,itemLinkOverlay:`${ps}__item-link-overlay`,itemLinkOverlayIcon:`${ps}__item-link-overlay-icon`,itemEditIcon:`${ps}__item-edit-icon`,itemAddIcon:`${ps}__item-add-icon`,itemAddButton:`${ps}__item-add-button`,formNode:`${ps}__form-node`,fileFieldset:`${ps}__file-fieldset`,fileLabel:`${ps}__file-label`,fileName:`${ps}__file-name`,fileInput:`${ps}__file-input`,metadata:`${ps}__metadata`,metadataFieldset:`${ps}__metadata-fieldset`,progressBar:`${ps}__progress-bar`,esriWidget:"esri-widget",esriButton:zb,buttonDisabled:`${zb}--disabled`,esriButtonSecondary:`${zb}--secondary`,esriButtonTertiary:`${zb}--tertiary`,esriButtonThird:`${zb}--third`,esriButtonSmall:`${zb}--small`,esriButtonHalf:`${zb}--half`,empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},Iz=window.CSS;let Ic=class extends pc{constructor(e,r){super(e,r),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...the},this._supportsImageOrientation=Iz&&Iz.supports&&Iz.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.viewModel||(this.viewModel=new cie),this.addHandles([Co(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),Co(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),xe(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),Cr)])}loadDependencies(){return Promise.all([be(()=>import("./calcite-icon-8ca968f8.js"),["assets/calcite-icon-8ca968f8.js","assets/icon-d40cf52f.js","assets/observers-4f67f1fb.js"])])}get abilities(){return this.viewModel.abilities}set abilities(e){this.viewModel.abilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...the,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:r}=this;return this._set("submitting",!0),this._set("error",null),r.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),r.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new ce("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){const{viewModel:r}=this;return this._set("submitting",!0),this._set("error",null),r.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),r.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new ce("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:r}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(r).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new ce("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,r=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",r}deleteFile(e){var i;const r=this.viewModel.deleteFile(e||((i=this.viewModel.activeFileInfo)==null?void 0:i.file));return this.viewModel.mode="view",r}render(){const{submitting:e,viewModel:r}=this,{state:i}=r;return pe("div",{class:this.classes(Ct.base,Ct.esriWidget)},e?this.renderProgressBar():null,i==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:r}=this;return e&&r.errorMessage?pe("div",{key:"error-message",class:Ct.errorMessage},e.message):null}renderAttachments(){const{activeFileInfo:e,mode:r,activeAttachmentInfo:i}=this.viewModel;return r==="add"?this.renderAddForm():r==="edit"?this.renderDetailsForm(i||e):this.renderAttachmentContainer()}renderLoading(){return pe("div",{class:Ct.loaderContainer,key:"loader"},pe("div",{class:Ct.loader}))}renderProgressBar(){return this.visibleElements.progressBar?pe("div",{class:Ct.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:r}=this,i=e||!r,s=this.visibleElements.cancelAddButton?pe("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Ct.esriButton,Ct.esriButtonTertiary,Ct.esriButtonSmall,Ct.esriButtonHalf,e&&Ct.buttonDisabled)},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?pe("button",{type:"submit",disabled:i,class:this.classes(Ct.esriButton,Ct.esriButtonSecondary,Ct.esriButtonSmall,Ct.esriButtonHalf,{[Ct.buttonDisabled]:i})},this.messages.add):null,o=r?pe("span",{key:"file-name",class:Ct.fileName},r.name):null,a=pe("form",{bind:this,afterCreate:n4,afterRemoved:xue,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},pe("fieldset",{class:Ct.fileFieldset},o,pe("label",{class:this.classes(Ct.fileLabel,Ct.esriButton,Ct.esriButtonSecondary)},r?this.messages.changeFile:this.messages.selectFile,pe("input",{class:Ct.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),n,s);return pe("div",{key:"add-form-container",class:Ct.formNode},a)}renderDetailsForm(e){var L,k,F;const{visibleElements:r,viewModel:i,selectedFile:s,submitting:n}=this,{abilities:o}=i,a=n||!s;let l,c,h,p;s?(l=s.type,c=s.name,h=s.size):e&&"file"in e?(l=e.file.type,c=e.file.name,h=e.file.size):e&&"contentType"in e&&(l=e.contentType,c=e.name,h=e.size,p=e.url);const A=o.editing&&((L=o.operations)!=null&&L.delete)&&r.deleteButton?pe("button",{key:"delete-button",type:"button",disabled:n,bind:this,onclick:G=>this._submitDeleteAttachment(G,e),class:this.classes(Ct.esriButton,Ct.esriButtonSmall,Ct.esriButtonTertiary,Ct.deleteButton,{[Ct.buttonDisabled]:n})},this.messages.delete):void 0,_=o.editing&&((k=o.operations)!=null&&k.update)&&r.updateButton?pe("button",{disabled:a,key:"update-button",type:"submit",class:this.classes(Ct.esriButton,Ct.esriButtonSmall,Ct.esriButtonThird,{[Ct.buttonDisabled]:a})},this.messages.update):void 0,w=this.visibleElements.cancelUpdateButton?pe("button",{disabled:n,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Ct.esriButton,Ct.esriButtonSmall,Ct.esriButtonTertiary,Ct.esriButtonThird,{[Ct.buttonDisabled]:n})},this.messages.cancel):void 0,T=o.editing&&((F=o.operations)!=null&&F.update)?pe("fieldset",{key:"file",class:Ct.fileFieldset},pe("span",{key:"file-name",class:Ct.fileName},c),pe("label",{class:this.classes(Ct.fileLabel,Ct.esriButton,Ct.esriButtonSecondary)},this.messages.changeFile,pe("input",{class:Ct.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,C=pe("fieldset",{key:"size",class:Ct.metadataFieldset},pe("label",null,dZe(this.messagesUnits,h??0))),M=pe("fieldset",{key:"content-type",class:Ct.metadataFieldset},pe("label",null,l)),O=E(p)?pe("a",{class:Ct.itemLink,href:p,rel:"noreferrer",target:"_blank"},this.renderImageMask(e,400),pe("div",{class:Ct.itemLinkOverlay},pe("span",{class:Ct.itemLinkOverlayIcon},pe("calcite-icon",{icon:"launch"})))):this.renderImageMask(e,400),$=pe("form",{bind:this,afterCreate:n4,afterRemoved:xue,"data-node-ref":"_updateAttachmentForm",onsubmit:G=>this._submitUpdateAttachment(G,e)},pe("div",{class:Ct.metadata},C,M),T,pe("div",{class:Ct.actions},A,w,_));return pe("div",{key:"edit-form-container",class:Ct.formNode},O,$)}renderImageMask(e,r){return e?"file"in e?this.renderGenericImageMask(e.file.name,e.file.type):this.renderImageMaskForAttachment(e,r):null}renderGenericImageMask(e,r){const{supportsResizeAttachments:i}=this.viewModel,s=YZe(r),n={[Ct.itemImageResizable]:i};return pe("div",{class:this.classes(Ct.itemMaskIcon,Ct.itemMask)},pe("img",{title:e,alt:e,src:s,class:this.classes(n,Ct.itemImage)}))}renderImageMaskForAttachment(e,r){const{supportsResizeAttachments:i}=this.viewModel;if(!e)return null;const{contentType:s,name:n,url:o}=e;if(!i||!ehe(s))return this.renderGenericImageMask(n,s);const a=this._getCSSTransform(e),l=a?{transform:a,"image-orientation":"none"}:{},c=`${o}${o!=null&&o.includes("?")?"&":"?"}w=${r}`,h={[Ct.itemImageResizable]:i};return pe("div",{class:this.classes(Ct.itemMask)},pe("img",{styles:l,alt:n,title:n,src:c,class:this.classes(h,Ct.itemImage)}))}renderFile(e){const{file:r}=e;return pe("li",{class:Ct.item,key:r},pe("button",{key:"details-button",bind:this,class:Ct.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(e),type:"button"},this.renderImageMask(e),pe("label",{class:Ct.itemLabel},pe("span",{class:Ct.itemFilename},r.name||this.messages.noTitle),pe("span",{"aria-hidden":"true",class:this.classes(Ct.itemChevronIcon,w0(this.container)?Ct.iconLeft:Ct.iconRight)}))))}renderAttachmentInfo({attachmentInfo:e,displayType:r}){const{viewModel:i,effectiveDisplayType:s}=this,{abilities:n,supportsResizeAttachments:o}=i,{contentType:a,name:l,url:c}=e,h=this.renderImageMask(e,r==="list"?48:400),p=n.editing?pe("span",{"aria-hidden":"true",class:this.classes(Ct.itemChevronIcon,w0(this.container)?Ct.iconLeft:Ct.iconRight)}):null,A=[h,s==="preview"&&o&&ehe(a)?null:pe("label",{class:Ct.itemLabel},pe("span",{class:Ct.itemFilename},l||this.messages.noTitle),p)],_=n.editing?pe("button",{key:"details-button",bind:this,class:Ct.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},A):pe("a",{key:"details-link",class:Ct.itemButton,href:c??void 0,target:"_blank"},A);return pe("li",{class:Ct.item,key:e},_)}renderAttachmentContainer(){var w;const{effectiveDisplayType:e,viewModel:r,visibleElements:i}=this,{attachmentInfos:s,abilities:n,fileInfos:o}=r,a=!!(s!=null&&s.length),l=!!(o!=null&&o.length),c={[Ct.containerList]:e!=="preview",[Ct.containerPreview]:e==="preview"},h=n.editing&&((w=n.operations)!=null&&w.add)&&i.addButton?pe("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Ct.esriButton,Ct.esriButtonTertiary,Ct.addAttachmentButton),type:"button"},pe("span",{"aria-hidden":"true",class:this.classes(Ct.itemAddIcon,Ct.iconPlus)}),this.messages.add):void 0,p=a?pe("ul",{key:"attachments-list",class:Ct.items},s.toArray().map(T=>this.renderAttachmentInfo({attachmentInfo:T,displayType:e}))):void 0,A=l?pe("ul",{key:"file-list",class:Ct.items},o.toArray().map(T=>this.renderFile(T))):void 0,_=l||a?void 0:pe("div",{class:Ct.empty},this.messages.noAttachments);return pe("div",{key:"attachments-container",class:this.classes(Ct.container,c)},p,A,_,h)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const r=e.target,i=r&&r.files&&r.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,r){e.preventDefault(),r&&("file"in r?this.deleteFile(r.file):r&&this.deleteAttachment(r))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,r){e.preventDefault(),r&&"file"in r?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:r}=this;r.activeFileInfo=null,r.activeAttachmentInfo=e,r.mode="edit"}_startEditFile(e){const{viewModel:r}=this;r.activeAttachmentInfo=null,r.activeFileInfo=e,r.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:r}=e;return!this._supportsImageOrientation&&r?[r.rotation?`rotate(${r.rotation}deg)`:"",r.mirrored?"scaleX(-1)":""].join(" "):""}};u([d()],Ic.prototype,"abilities",null),u([d()],Ic.prototype,"displayType",void 0),u([d({readOnly:!0})],Ic.prototype,"effectiveDisplayType",null),u([d()],Ic.prototype,"graphic",null),u([d()],Ic.prototype,"label",null),u([d(),Ll("esri/widgets/Attachments/t9n/Attachments")],Ic.prototype,"messages",void 0),u([d(),Ll("esri/core/t9n/Units")],Ic.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],Ic.prototype,"selectedFile",void 0),u([d({readOnly:!0})],Ic.prototype,"submitting",void 0),u([d({readOnly:!0})],Ic.prototype,"error",void 0),u([d({type:cie})],Ic.prototype,"viewModel",void 0),u([d()],Ic.prototype,"visibleElements",void 0),u([Hr("visibleElements")],Ic.prototype,"castVisibleElements",null),Ic=u([j("esri.widgets.Attachments")],Ic);const ZZe=Ic;let dP=class extends cie{constructor(e){super(e),this.description=null,this.title=null}};u([d()],dP.prototype,"description",void 0),u([d()],dP.prototype,"title",void 0),dP=u([j("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],dP);const uie=dP,JZe={heading:"esri-widget__heading"};function c4({level:t,class:e,...r},i){const s=KZe(t);return pe(`h${s}`,{...r,class:nEe(JZe.heading,e),role:"heading","aria-level":String(s)},i)}function KZe(t){return ze(Math.ceil(t),1,6)}const $z="esri-feature-element-info",Lz={base:$z,title:`${$z}__title`,description:`${$z}__description`};let hE=class extends pc{constructor(e,r){super(e,r),this.description=null,this.headingLevel=2,this.title=null}render(){return pe("div",{class:Lz.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?pe(c4,{level:this.headingLevel,class:Lz.title},e):null}renderDescription(){const{description:e}=this;return e?pe("div",{key:"description",class:Lz.description},e):null}};u([d()],hE.prototype,"description",void 0),u([d()],hE.prototype,"headingLevel",void 0),u([d()],hE.prototype,"title",void 0),hE=u([j("esri.widgets.Feature.support.FeatureElementInfo")],hE);const IU=hE,eJe={base:"esri-feature-attachments"};let Dm=class extends pc{constructor(e,r){super(e,r),this._featureElementInfo=null,this.attachmentsWidget=new ZZe,this.headingLevel=2,this.viewModel=new uie}initialize(){this._featureElementInfo=new IU,this.addHandles([xe(()=>{var e,r;return[(e=this.viewModel)==null?void 0:e.description,(r=this.viewModel)==null?void 0:r.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),Cr),xe(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,Cr)])}destroy(){var e;this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var r;const{attachmentsWidget:e}=this;return pe("div",{class:eJe.base},(r=this._featureElementInfo)==null?void 0:r.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var s;const{description:e,title:r,headingLevel:i}=this;(s=this._featureElementInfo)==null||s.set({description:e,title:r,headingLevel:i})}};u([d({readOnly:!0})],Dm.prototype,"attachmentsWidget",void 0),u([d()],Dm.prototype,"description",null),u([d()],Dm.prototype,"displayType",null),u([d()],Dm.prototype,"graphic",null),u([d()],Dm.prototype,"headingLevel",void 0),u([d()],Dm.prototype,"title",null),u([d({type:uie})],Dm.prototype,"viewModel",void 0),Dm=u([j("esri.widgets.Feature.FeatureAttachments")],Dm);const tJe=Dm;let A1=class extends xT(Ke){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(xe(()=>this.creator,r=>{this._destroyContent(),this._createContent(r)},Cr))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:r,destroyer:i}=this;e&&r&&(Xk(i,{graphic:r}).catch(()=>null),this._set("created",null))}async _createContent(e){const r=this.graphic;if(!r||!e)return;const i=Xk(e,{graphic:r}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const s=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",s))}};u([d({readOnly:!0})],A1.prototype,"created",void 0),u([d()],A1.prototype,"creator",void 0),u([d()],A1.prototype,"destroyer",void 0),u([d({type:pl})],A1.prototype,"graphic",void 0),u([d({readOnly:!0})],A1.prototype,"state",null),A1=u([j("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],A1);const Zk=A1;function rl(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${e}'`);return{value:iJe(t[e])}}}function rJe(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function iJe(t){return function(e,...r){rJe(e)?xQe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function sJe(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const r=e._delegatedEventNames,i=Array.isArray(t)?t:nJe(t);r.push(...i)}}function nJe(t){return t.split(",").map(e=>e.trim())}const sCe="calcite-mode-";function oJe(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replace(/\s|'|"/g,"")}function Jk(){return oJe().startsWith("dark")}function aJe(){return`${sCe}${Jk()?"dark":"light"}`}function lJe(t){cJe(t),t.classList.add(aJe())}function cJe(t){Array.from(t.classList).forEach(e=>{e.startsWith(sCe)&&t.classList.remove(e)})}function nCe(t){return t&&typeof t.render=="function"}function uJe(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}const Dz="esri-feature-content",Nz={base:Dz,loaderContainer:`${Dz}__loader-container`,loader:`${Dz}__loader`};let dE=class extends pc{constructor(e,r){super(e,r),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(s=>{QEe(s.href)&&!s.hasAttribute("target")&&s.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}renderLoading(){return pe("div",{class:Nz.loaderContainer,key:"loader"},pe("div",{class:Nz.loader}))}renderCreated(){var r;const e=(r=this.viewModel)==null?void 0:r.created;return e?e instanceof HTMLElement?pe("div",{key:e,bind:e,afterCreate:this._attachToNode}):nCe(e)?pe("div",{key:e},!e.destroyed&&e.render()):pe("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var r;const e=(r=this.viewModel)==null?void 0:r.state;return pe("div",{class:Nz.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const r=this;e.appendChild(r)}};u([d()],dE.prototype,"creator",null),u([d()],dE.prototype,"graphic",null),u([d({type:Zk})],dE.prototype,"viewModel",void 0),dE=u([j("esri.widgets.Feature.FeatureContent")],dE);const A6=dE;let RA=class extends Ke{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:r}=this,i=[];return r==null||r.forEach(s=>{if(!(!s.hasOwnProperty("visible")||s.visible))return;const n=s.clone();n.label=XEe(n,e),i.push(n)}),i}};u([d()],RA.prototype,"attributes",void 0),u([d({type:[uxe]})],RA.prototype,"expressionInfos",void 0),u([d()],RA.prototype,"description",void 0),u([d({type:[fL]})],RA.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],RA.prototype,"formattedFieldInfos",null),u([d()],RA.prototype,"title",void 0),RA=u([j("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],RA);const $U=RA,hJe=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function dJe(t){let e=null;return hJe.some(r=>(r.pattern.test(t)&&(e=r),!!e)),e}function pJe(t,e){if(typeof e!="string"||!e)return e;const r=dJe(e);if(!r)return e;const i=e.match(r.pattern),s=i&&i[2],n=Og(Og(r.label,{messages:t,hierPart:s}),{appName:r.appName}),o=r.target?` target="${r.target}"`:"",a=r.target==="_blank"?' rel="noreferrer"':"";return e.replace(r.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const i5="esri-feature-fields",DR={base:i5,fieldHeader:`${i5}__field-header`,fieldData:`${i5}__field-data`,fieldDataDate:`${i5}__field-data--date`,esriTable:"esri-widget__table"};let Bf=class extends pc{constructor(e,r){super(e,r),this._featureElementInfo=null,this.viewModel=new $U,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new IU,this.addHandles(xe(()=>{var e,r;return[(e=this.viewModel)==null?void 0:e.description,(r=this.viewModel)==null?void 0:r.title]},()=>this._setupFeatureElementInfo(),Cr))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}renderFieldInfo(e,r){const{attributes:i}=this.viewModel,s=e.fieldName,n=e.label||s,o=i?i[s]==null?"":i[s]:"",a=!(!e.format||!e.format.dateFormat),l=typeof o=="number"&&!a?this._forceLTR(o):pJe(this.messagesURIUtils,o),c={[DR.fieldDataDate]:a};return pe("tr",{key:`fields-element-info-row-${s}-${r}`},pe("th",{key:`fields-element-info-row-header-${s}-${r}`,class:DR.fieldHeader,innerHTML:n}),pe("td",{key:`fields-element-info-row-data-${s}-${r}`,class:this.classes(DR.fieldData,c),innerHTML:l}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?pe("table",{class:DR.esriTable,summary:this.messages.fieldsSummary},pe("tbody",null,e.map((r,i)=>this.renderFieldInfo(r,i)))):null}render(){var e;return pe("div",{class:DR.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){var i;const{description:e,title:r}=this;(i=this._featureElementInfo)==null||i.set({description:e,title:r})}_forceLTR(e){return`&lrm;${e}`}};u([d()],Bf.prototype,"attributes",null),u([d()],Bf.prototype,"description",null),u([d()],Bf.prototype,"expressionInfos",null),u([d()],Bf.prototype,"fieldInfos",null),u([d()],Bf.prototype,"title",null),u([d({type:$U,nonNullable:!0})],Bf.prototype,"viewModel",void 0),u([d(),Ll("esri/widgets/Feature/t9n/Feature")],Bf.prototype,"messages",void 0),u([d(),Ll("esri/widgets/support/t9n/uriUtils")],Bf.prototype,"messagesURIUtils",void 0),Bf=u([j("esri.widgets.Feature.FeatureFields")],Bf);const oCe=Bf,fJe={maximumFractionDigits:20};function mJe(t){return Dg(t,fJe)}var DQ;let Ww=DQ=class extends Qe{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,r){e[r]=t??0}clone(){return new DQ({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:Ot,json:{type:[rn],write:!0}})],Ww.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Ww.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],Ww.prototype,"value",void 0),u([St("value")],Ww.prototype,"writeValue",null),Ww=DQ=u([j("esri.renderers.visualVariables.support.ColorStop")],Ww);const gJe=Ww;function SL(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function AJe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function yJe(t,e,r,i,s,n,o,a,l,c,h,p,A,_,w,T){const C=new Float32Array(16);return C[0]=t,C[1]=e,C[2]=r,C[3]=i,C[4]=s,C[5]=n,C[6]=o,C[7]=a,C[8]=l,C[9]=c,C[10]=h,C[11]=p,C[12]=A,C[13]=_,C[14]=w,C[15]=T,C}function _Je(t,e){return new Float32Array(t,e,16)}const vJe=SL();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:vJe,clone:AJe,create:SL,createView:_Je,fromValues:yJe},Symbol.toStringTag,{value:"Module"}));const bJe=(t,e)=>{const r=qg(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return zh(r,r)},wJe=(t,e)=>{const r=qg(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return zh(r,r)},xJe=(t,e)=>{const r=1-e,i=qg(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return zh(i,i)},TJe=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),s=qg(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return zh(s,s)},SJe=(t,e)=>{const r=1-2*e,i=qg(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return zh(i,i)},EJe=(t,e)=>{const r=qg(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return zh(r,r)},CJe=(t,e)=>{const r=1-e,i=qg(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return zh(i,i)};let aCe=class lCe{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=vh(e.strength,r.strength,i),this.radius=vh(e.radius,r.radius,i),this.threshold=vh(e.threshold,r.threshold,i)}clone(){return new lCe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:DI(this.radius),strength:this.strength,threshold:this.threshold}}},cCe=class uCe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(vh(e.radius,r.radius,i))}clone(){return new uCe(this.radius)}toJSON(){return{type:"blur",radius:DI(this.radius)}}},NQ=class hCe{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=vh(e.amount,r.amount,i),this._updateMatrix()}clone(){return new hCe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||SL();switch(this.type){case"brightness":this._colorMatrix=bJe(e,this.amount);break;case"contrast":this._colorMatrix=wJe(e,this.amount);break;case"grayscale":this._colorMatrix=xJe(e,this.amount);break;case"invert":this._colorMatrix=SJe(e,this.amount);break;case"saturate":this._colorMatrix=EJe(e,this.amount);break;case"sepia":this._colorMatrix=CJe(e,this.amount)}}},dCe=class pCe{constructor(e,r,i,s){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=vh(e.offsetX,r.offsetX,i),this.offsetY=vh(e.offsetY,r.offsetY,i),this.blurRadius=vh(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(vh(e.color[0],r.color[0],i)),this.color[1]=Math.round(vh(e.color[1],r.color[1],i)),this.color[2]=Math.round(vh(e.color[2],r.color[2],i)),this.color[3]=vh(e.color[3],r.color[3],i)}clone(){return new pCe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:DI(this.offsetX),yoffset:DI(this.offsetY),blurRadius:DI(this.blurRadius),color:e}}},fCe=class mCe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=vh(e.angle,r.angle,i),this._updateMatrix()}clone(){return new mCe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||SL();this._colorMatrix=TJe(e,this.angle)}},gCe=class ACe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=vh(e.amount,r.amount,i)}clone(){return new ACe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function vh(t,e,r){return t+(e-t)*r}function DI(t){return Math.round(1e3*of(t))/1e3}function MJe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new NQ(t.type,0);case"saturate":case"brightness":case"contrast":return new NQ(t.type,1);case"opacity":return new gCe(1);case"hue-rotate":return new fCe(0);case"blur":return new cCe(0);case"drop-shadow":return new dCe(0,0,0,[...Ute("transparent")]);case"bloom":return new aCe(0,0,1)}}function RJe(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,s)=>i.type===r[s].type)}function OJe(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let s=i.length;s<r.length;s++)i.push(MJe(r[s]))}function PJe(t){const e=t[0];return!!e&&"type"in e}var rhe,ihe,FQ={};function yCe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=she(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new ce("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:she(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!RJe(e[r].effects,e[r+1].effects))throw new ce("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});OJe(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function she(t){let e;if(!t)return[];try{e=FQ.parse(t)}catch(r){throw new ce("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>IJe(r))}function IJe(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return $Je(t);case"opacity":return LJe(t);case"hue-rotate":return DJe(t);case"blur":return NJe(t);case"drop-shadow":return FJe(t);case"bloom":return kJe(t)}}catch(e){throw e.details.filter=t,e}throw new ce("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function $Je(t){let e=1;return UM(t.parameters,1),t.parameters.length===1&&(e=o0(t.parameters[0])),new NQ(t.name,e)}function LJe(t){let e=1;return UM(t.parameters,1),t.parameters.length===1&&(e=o0(t.parameters[0])),new gCe(e)}function DJe(t){let e=0;return UM(t.parameters,1),t.parameters.length===1&&(e=jJe(t.parameters[0])),new fCe(e)}function NJe(t){let e=0;return UM(t.parameters,1),t.parameters.length===1&&(e=pie(t.parameters[0]),EL(e,t.parameters[0])),new cCe(e)}function FJe(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new ce("effect:type-error","Accepts only one color",{});r=HJe(i)}else{const s=pie(i);if(Object.isFrozen(e))throw new ce("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&EL(s,i)}if(e.length<2||e.length>3)throw new ce("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new dCe(e[0],e[1],e[2]||0,r||_Ce("black"))}function kJe(t){let e=1,r=0,i=0;return UM(t.parameters,3),t.parameters[0]&&(e=o0(t.parameters[0])),t.parameters[1]&&(r=pie(t.parameters[1]),EL(r,t.parameters[1])),t.parameters[2]&&(i=o0(t.parameters[2])),new aCe(e,r,i)}function UM(t,e){if(t.length>e)throw new ce("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function LU(t){if(t.type==="color")return"<color>";if(t.unit){if(die[t.unit])return"<length>";if(hie[t.unit])return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function EL(t,e){if(t<0)throw new ce("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function BJe(t){if(t.type!=="quantity"||t.unit!==null)throw new ce("effect:type-error",`Expected <double>, Actual: ${LU(t)}`,{term:t})}function UJe(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new ce("effect:type-error",`Expected <double> or <percentage>, Actual: ${LU(t)}`,{term:t})}ihe=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:Dr},h=Dr,p="none",A=")",_=",",w="(",T="%",C="px",M="cm",O="mm",$="in",L="pt",k="pc",F="deg",G="rad",z="grad",Z="turn",J="#",te=".",re="e",Ae=/^[ \t\n\r]/,ve=/^[a-z\-]/,ye=/^[0-9a-fA-F]/,le=/^[+\-]/,W=/^[0-9]/,q=bs("none"),X=K("none",!1),se=K(")",!1),ae=K(",",!1),fe=bs("whitespace"),ue=Ci([" ","	",`
`,"\r"],!1,!1),Re=bs("function"),De=K("(",!1),Ue=bs("identifier"),Je=Ci([["a","z"],"-"],!1,!1),vt=bs("percentage"),lt=K("%",!1),Ye=bs("length"),ut=K("px",!1),ht=K("cm",!1),Jt=K("mm",!1),Pt=K("in",!1),xr=K("pt",!1),Ir=K("pc",!1),Tr=bs("angle"),Er=K("deg",!1),ei=K("rad",!1),zi=K("grad",!1),Lr=K("turn",!1),ti=bs("number"),Ft=bs("color"),yt=K("#",!1),kt=Ci([["0","9"],["a","f"],["A","F"]],!1,!1),jt=Ci(["+","-"],!1,!1),tr=Ci([["0","9"]],!1,!1),Or=K(".",!1),yi=K("e",!1),bi=function(){return[]},wi=function(he,je){return{type:"function",name:he,parameters:je||[]}},_i=function(he,je){return je.length>0?Db(he,je,3):[he]},_s=function(he){return{type:"quantity",value:he.value,unit:he.unit}},kr=function(he){return{type:"color",colorType:he.type,value:he.value}},ni=function(he){return he},qr=function(){return g()},An=function(he){return{value:he,unit:"%"}},rs=function(he){return{value:he,unit:"px"}},Us=function(he){return{value:he,unit:"cm"}},ss=function(he){return{value:he,unit:"mm"}},Ls=function(he){return{value:he,unit:"in"}},on=function(he){return{value:he,unit:"pt"}},Ze=function(he){return{value:he,unit:"pc"}},Ko=function(he){return{value:he,unit:"deg"}},bo=function(he){return{value:he,unit:"rad"}},yn=function(he){return{value:he,unit:"grad"}},Vs=function(he){return{value:he,unit:"turn"}},Ss=function(he){return{value:he,unit:null}},an=function(){return{type:"hex",value:g()}},Xi=function(he){return{type:"function",value:he}},ea=function(){return{type:"named",value:g()}},ya=function(){return parseFloat(g())},Ie=0,Ii=0,Pe=[{line:1,column:1}],Ge=0,dt=[],Xe=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function g(){return s.substring(Ii,Ie)}function K(he,je){return{type:"literal",text:he,ignoreCase:je}}function Ci(he,je,H){return{type:"class",parts:he,inverted:je,ignoreCase:H}}function vs(){return{type:"end"}}function bs(he){return{type:"other",description:he}}function Wr(he){var je,H=Pe[he];if(H)return H;for(je=he-1;!Pe[je];)je--;for(H={line:(H=Pe[je]).line,column:H.column};je<he;)s.charCodeAt(je)===10?(H.line++,H.column=1):H.column++,je++;return Pe[he]=H,H}function vi(he,je){var H=Wr(he),Qr=Wr(je);return{source:l,start:{offset:he,line:H.line,column:H.column},end:{offset:je,line:Qr.line,column:Qr.column}}}function _r(he){Ie<Ge||(Ie>Ge&&(Ge=Ie,dt=[]),dt.push(he))}function hs(he,je,H){return new e(e.buildMessage(he,je),he,je,H)}function Dr(){var he;return(he=ta())===a&&(he=Yh()),he}function ta(){var he,je;return Xe++,he=Ie,Mi(),s.substr(Ie,4)===p?(je=p,Ie+=4):(je=a,Xe===0&&_r(X)),je!==a?(Mi(),Ii=he,he=bi()):(Ie=he,he=a),Xe--,he===a&&Xe===0&&_r(q),he}function Yh(){var he,je;if(he=[],(je=_a())!==a)for(;je!==a;)he.push(je),je=_a();else he=a;return he}function _a(){var he,je,H,Qr;return he=Ie,Mi(),(je=ra())!==a?(Mi(),(H=Ac())===a&&(H=null),Mi(),s.charCodeAt(Ie)===41?(Qr=A,Ie++):(Qr=a,Xe===0&&_r(se)),Qr!==a?(Mi(),Ii=he,he=wi(je,H)):(Ie=he,he=a)):(Ie=he,he=a),he}function Ac(){var he,je,H,Qr,Lo,_n,kl,em;if(he=Ie,(je=Kn())!==a){for(H=[],Qr=Ie,Lo=Mi(),s.charCodeAt(Ie)===44?(_n=_,Ie++):(_n=a,Xe===0&&_r(ae)),_n===a&&(_n=null),kl=Mi(),(em=Kn())!==a?Qr=Lo=[Lo,_n,kl,em]:(Ie=Qr,Qr=a);Qr!==a;)H.push(Qr),Qr=Ie,Lo=Mi(),s.charCodeAt(Ie)===44?(_n=_,Ie++):(_n=a,Xe===0&&_r(ae)),_n===a&&(_n=null),kl=Mi(),(em=Kn())!==a?Qr=Lo=[Lo,_n,kl,em]:(Ie=Qr,Qr=a);Ii=he,he=_i(je,H)}else Ie=he,he=a;return he}function Kn(){var he,je;return he=Ie,(je=d_())===a&&(je=ru())===a&&(je=Yr())===a&&(je=oe()),je!==a&&(Ii=he,je=_s(je)),(he=je)===a&&(he=Ie,(je=vr())!==a&&(Ii=he,je=kr(je)),he=je),he}function Mi(){var he,je;for(Xe++,he=[],Ae.test(s.charAt(Ie))?(je=s.charAt(Ie),Ie++):(je=a,Xe===0&&_r(ue));je!==a;)he.push(je),Ae.test(s.charAt(Ie))?(je=s.charAt(Ie),Ie++):(je=a,Xe===0&&_r(ue));return Xe--,je=a,Xe===0&&_r(fe),he}function ra(){var he,je,H;return Xe++,he=Ie,(je=Qh())!==a?(s.charCodeAt(Ie)===40?(H=w,Ie++):(H=a,Xe===0&&_r(De)),H!==a?(Ii=he,he=ni(je)):(Ie=he,he=a)):(Ie=he,he=a),Xe--,he===a&&(je=a,Xe===0&&_r(Re)),he}function Qh(){var he,je,H;if(Xe++,he=Ie,je=[],ve.test(s.charAt(Ie))?(H=s.charAt(Ie),Ie++):(H=a,Xe===0&&_r(Je)),H!==a)for(;H!==a;)je.push(H),ve.test(s.charAt(Ie))?(H=s.charAt(Ie),Ie++):(H=a,Xe===0&&_r(Je));else je=a;return je!==a&&(Ii=he,je=qr()),Xe--,(he=je)===a&&(je=a,Xe===0&&_r(Ue)),he}function d_(){var he,je,H;return Xe++,he=Ie,Mi(),(je=ml())!==a?(s.charCodeAt(Ie)===37?(H=T,Ie++):(H=a,Xe===0&&_r(lt)),H!==a?(Ii=he,he=An(je)):(Ie=he,he=a)):(Ie=he,he=a),Xe--,he===a&&Xe===0&&_r(vt),he}function ru(){var he,je,H;return Xe++,he=Ie,Mi(),(je=ml())!==a?(s.substr(Ie,2)===C?(H=C,Ie+=2):(H=a,Xe===0&&_r(ut)),H!==a?(Ii=he,he=rs(je)):(Ie=he,he=a)):(Ie=he,he=a),he===a&&(he=Ie,Mi(),(je=ml())!==a?(s.substr(Ie,2)===M?(H=M,Ie+=2):(H=a,Xe===0&&_r(ht)),H!==a?(Ii=he,he=Us(je)):(Ie=he,he=a)):(Ie=he,he=a),he===a&&(he=Ie,Mi(),(je=ml())!==a?(s.substr(Ie,2)===O?(H=O,Ie+=2):(H=a,Xe===0&&_r(Jt)),H!==a?(Ii=he,he=ss(je)):(Ie=he,he=a)):(Ie=he,he=a),he===a&&(he=Ie,Mi(),(je=ml())!==a?(s.substr(Ie,2)===$?(H=$,Ie+=2):(H=a,Xe===0&&_r(Pt)),H!==a?(Ii=he,he=Ls(je)):(Ie=he,he=a)):(Ie=he,he=a),he===a&&(he=Ie,Mi(),(je=ml())!==a?(s.substr(Ie,2)===L?(H=L,Ie+=2):(H=a,Xe===0&&_r(xr)),H!==a?(Ii=he,he=on(je)):(Ie=he,he=a)):(Ie=he,he=a),he===a&&(he=Ie,Mi(),(je=ml())!==a?(s.substr(Ie,2)===k?(H=k,Ie+=2):(H=a,Xe===0&&_r(Ir)),H!==a?(Ii=he,he=Ze(je)):(Ie=he,he=a)):(Ie=he,he=a)))))),Xe--,he===a&&Xe===0&&_r(Ye),he}function Yr(){var he,je,H;return Xe++,he=Ie,(je=ml())!==a?(s.substr(Ie,3)===F?(H=F,Ie+=3):(H=a,Xe===0&&_r(Er)),H!==a?(Ii=he,he=Ko(je)):(Ie=he,he=a)):(Ie=he,he=a),he===a&&(he=Ie,(je=ml())!==a?(s.substr(Ie,3)===G?(H=G,Ie+=3):(H=a,Xe===0&&_r(ei)),H!==a?(Ii=he,he=bo(je)):(Ie=he,he=a)):(Ie=he,he=a),he===a&&(he=Ie,(je=ml())!==a?(s.substr(Ie,4)===z?(H=z,Ie+=4):(H=a,Xe===0&&_r(zi)),H!==a?(Ii=he,he=yn(je)):(Ie=he,he=a)):(Ie=he,he=a),he===a&&(he=Ie,(je=ml())!==a?(s.substr(Ie,4)===Z?(H=Z,Ie+=4):(H=a,Xe===0&&_r(Lr)),H!==a?(Ii=he,he=Vs(je)):(Ie=he,he=a)):(Ie=he,he=a)))),Xe--,he===a&&(je=a,Xe===0&&_r(Tr)),he}function oe(){var he,je;return Xe++,he=Ie,Mi(),(je=ml())!==a?(Ii=he,he=Ss(je)):(Ie=he,he=a),Xe--,he===a&&Xe===0&&_r(ti),he}function vr(){var he,je,H,Qr;if(Xe++,he=Ie,s.charCodeAt(Ie)===35?(je=J,Ie++):(je=a,Xe===0&&_r(yt)),je!==a){if(H=[],ye.test(s.charAt(Ie))?(Qr=s.charAt(Ie),Ie++):(Qr=a,Xe===0&&_r(kt)),Qr!==a)for(;Qr!==a;)H.push(Qr),ye.test(s.charAt(Ie))?(Qr=s.charAt(Ie),Ie++):(Qr=a,Xe===0&&_r(kt));else H=a;H!==a?(Ii=he,he=an()):(Ie=he,he=a)}else Ie=he,he=a;return he===a&&(he=Ie,(je=_a())!==a&&(Ii=he,je=Xi(je)),(he=je)===a&&(he=Ie,(je=Qh())!==a&&(Ii=he,je=ea()),he=je)),Xe--,he===a&&(je=a,Xe===0&&_r(Ft)),he}function ml(){var he,je,H,Qr,Lo,_n,kl;for(he=Ie,le.test(s.charAt(Ie))?(s.charAt(Ie),Ie++):Xe===0&&_r(jt),je=Ie,H=[],W.test(s.charAt(Ie))?(Qr=s.charAt(Ie),Ie++):(Qr=a,Xe===0&&_r(tr));Qr!==a;)H.push(Qr),W.test(s.charAt(Ie))?(Qr=s.charAt(Ie),Ie++):(Qr=a,Xe===0&&_r(tr));if(s.charCodeAt(Ie)===46?(Qr=te,Ie++):(Qr=a,Xe===0&&_r(Or)),Qr!==a){if(Lo=[],W.test(s.charAt(Ie))?(_n=s.charAt(Ie),Ie++):(_n=a,Xe===0&&_r(tr)),_n!==a)for(;_n!==a;)Lo.push(_n),W.test(s.charAt(Ie))?(_n=s.charAt(Ie),Ie++):(_n=a,Xe===0&&_r(tr));else Lo=a;Lo!==a?je=H=[H,Qr,Lo]:(Ie=je,je=a)}else Ie=je,je=a;if(je===a)if(je=[],W.test(s.charAt(Ie))?(H=s.charAt(Ie),Ie++):(H=a,Xe===0&&_r(tr)),H!==a)for(;H!==a;)je.push(H),W.test(s.charAt(Ie))?(H=s.charAt(Ie),Ie++):(H=a,Xe===0&&_r(tr));else je=a;if(je!==a){if(H=Ie,s.charCodeAt(Ie)===101?(Qr=re,Ie++):(Qr=a,Xe===0&&_r(yi)),Qr!==a){if(le.test(s.charAt(Ie))?(Lo=s.charAt(Ie),Ie++):(Lo=a,Xe===0&&_r(jt)),Lo===a&&(Lo=null),_n=[],W.test(s.charAt(Ie))?(kl=s.charAt(Ie),Ie++):(kl=a,Xe===0&&_r(tr)),kl!==a)for(;kl!==a;)_n.push(kl),W.test(s.charAt(Ie))?(kl=s.charAt(Ie),Ie++):(kl=a,Xe===0&&_r(tr));else _n=a;_n!==a?H=Qr=[Qr,Lo,_n]:(Ie=H,H=a)}else Ie=H,H=a;H===a&&(H=null),Ii=he,he=ya()}else Ie=he,he=a;return he}function LT(he,je){return he.map(function(H){return H[je]})}function Db(he,je,H){return[he].concat(LT(je,H))}if((o=h())!==a&&Ie===s.length)return o;throw o!==a&&Ie<s.length&&_r(vs()),hs(dt,Ge<s.length?s.charAt(Ge):null,Ge<s.length?vi(Ge,Ge+1):vi(Ge,Ge))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=r("",l.line.toString().length," "),A=a[l.line-1],_=(l.line===h.line?h.column:A.length+1)-l.column||1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+A+`
`+p+" | "+r("",l.column-1," ")+r("",_,"^")}else n+=`
 at `+c}return n},e.buildMessage=function(s,n){var o={literal:function(_){return'"'+l(_.text)+'"'},class:function(_){var w=_.parts.map(function(T){return Array.isArray(T)?c(T[0])+"-"+c(T[1]):c(T)});return"["+(_.inverted?"^":"")+w.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(_){return _.description}};function a(_){return _.charCodeAt(0).toString(16).toUpperCase()}function l(_){return _.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+a(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+a(w)})}function c(_){return _.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+a(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+a(w)})}function h(_){return o[_.type](_)}function p(_){var w,T,C=_.map(h);if(C.sort(),C.length>0){for(w=1,T=1;w<C.length;w++)C[w-1]!==C[w]&&(C[T]=C[w],T++);C.length=T}switch(C.length){case 1:return C[0];case 2:return C[0]+" or "+C[1];default:return C.slice(0,-1).join(", ")+", or "+C[C.length-1]}}function A(_){return _?'"'+l(_)+'"':"end of input"}return"Expected "+p(s)+" but "+A(n)+" found."},{SyntaxError:e,parse:i}},(rhe={get exports(){return FQ},set exports(t){FQ=t}}).exports&&(rhe.exports=ihe());const hie={deg:1,grad:.9,rad:180/Math.PI,turn:360};function VJe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&hie[t.unit]!=null))throw new ce("effect:type-error",`Expected <angle>, Actual: ${LU(t)}`,{term:t})}const die={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function zJe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&die[t.unit]!=null))throw new ce("effect:type-error",`Expected <length>, Actual: ${LU(t)}`,{term:t})}function o0(t){UJe(t);const e=t.value;return EL(e,t),t.unit==="%"?.01*e:e}function GJe(t){return BJe(t),EL(t.value,t),t.value}function jJe(t){return VJe(t),t.value*hie[t.unit]||0}function pie(t){return zJe(t),t.value*die[t.unit]||0}function HJe(t){switch(t.colorType){case"hex":return pze(t.value);case"named":return _Ce(t.value);case"function":return YJe(t.value)}}function _Ce(t){if(!i2e(t))throw new ce("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return dze(t)}const qJe=/^rgba?/i,WJe=/^hsla?/i;function YJe(t){if(UM(t.parameters,4),qJe.test(t.name))return[o0(t.parameters[0]),o0(t.parameters[1]),o0(t.parameters[2]),t.parameters[3]?o0(t.parameters[3]):1];if(WJe.test(t.name))return s2e(GJe(t.parameters[0]),o0(t.parameters[1]),o0(t.parameters[2]),t.parameters[3]?o0(t.parameters[3]):1);throw new ce("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function fie(t,e,r){var i;try{return XJe(t)}catch(s){(i=r==null?void 0:r.messages)==null||i.push(s)}return null}function mie(t,e,r,i){try{const s=QJe(t);Jc(r,s,e)}catch(s){i.messages&&i.messages.push(s)}}function QJe(t){const e=yCe(t);return e?PJe(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(s=>s.toJSON())})):null}function XJe(t){if(!t||t.length===0)return null;if(ZJe(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:nhe(r.value)});return e}return nhe(t)}function ZJe(t){const e=t[0];return!!e&&"scale"in e}function nhe(t){if(!t||!t.length)return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[iA(r,"amount")];break;case"blur":i=[iA(r,"radius","pt")];break;case"hue-rotate":i=[iA(r,"angle","deg")];break;case"drop-shadow":i=[iA(r,"xoffset","pt"),iA(r,"yoffset","pt"),iA(r,"blurRadius","pt"),JJe(r,"color")];break;case"bloom":i=[iA(r,"strength"),iA(r,"radius","pt"),iA(r,"threshold")]}const s=`${r.type}(${i.filter(Boolean).join(" ")})`;yCe(s),e.push(s)}return e.join(" ")}function iA(t,e,r){if(t[e]==null)throw new ce("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function JJe(t,e){if(t[e]==null)throw new ce("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}const y6=-3;var ty;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(ty||(ty={}));let KJe=class{constructor(e,r,i){this._namespace=e,this._storage=r,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(e,r,i,s=0){this._storage.put(this._namespace+e,r,i,s)}get(e){const r=this._storage.get(this._namespace+e);return r===void 0?++this._miss:++this._hit,r}pop(e){const r=this._storage.pop(this._namespace+e);return r===void 0?++this._miss:++this._hit,r}updateSize(e,r,i){this._storage.updateSize(this._namespace+e,r,i)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}},gie=class{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Vr,this._users=new Vr}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,r,i,s){const n=this._db.get(e);if(n&&(this._size-=n.size,this._db.delete(e),n.entry!==r&&this._notifyRemove(e,n.entry,ty.ALL)),i>this._maxSize)return void this._notifyRemove(e,r,ty.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return void console.warn("Refusing to cache entry with invalid size "+i);const o=1+Math.max(s,y6)-y6;this._db.set(e,{entry:r,size:i,lifetime:o,lives:o}),this._size+=i,this._checkSizeLimit()}updateSize(e,r,i){const s=this._db.get(e);if(s&&s.entry===r){for(this._size-=s.size;i>this._maxSize;){const n=this._notifyRemove(e,r,ty.SOME);if(!(E(n)&&n>0))return void this._db.delete(e);i=n}s.size=i,this._size+=i,this._checkSizeLimit()}}pop(e){const r=this._db.get(e);if(r)return this._size-=r.size,this._db.delete(e),++this._hit,r.entry;++this._miss}get(e){const r=this._db.get(e);if(r!==void 0)return this._db.delete(e),r.lives=r.lifetime,this._db.set(e,r),++this._hit,r.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=r[h]||0;r[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+y6-1)]=Math.round(a/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){this._db.forEach((r,i)=>{i.startsWith(e)&&(this._size-=r.size,this._db.delete(i),this._notifyRemove(i,r.entry,ty.ALL))})}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,ty.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i){let s;return this._removeFuncs.some(n=>{if(e.startsWith(n[0])){const o=n[1](r,i);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,r]of this._db){if(this._db.delete(e),r.lives<=1){this._size-=r.size;const i=this._notifyRemove(e,r.entry,ty.SOME);E(i)&&i>0&&(this._size+=i,r.lives=r.lifetime,r.size=i,this._db.set(e,r))}else--r.lives,this._db.set(e,r);if(this._size<=.9*this.maxSize)return}}},eKe=class{constructor(e,r){this._storage=new gie,this._storage.maxSize=e,r&&this._storage.registerRemoveFunc("",r)}put(e,r){this._storage.put(e,r,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}};new eKe(1e3);new Ot([128,128,128]);const tKe=new Ot("white");function rKe(t){return Pu(t.resource).href}function HT(t,e){if(!t)return null;let r=null;return V3(t)?r=iKe(t):cU(t)&&(r=t.color?new Ot(t.color):null),r?u4(r,e):null}function iKe(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{var s;i.type==="object"&&((s=i.resource)==null?void 0:s.href)!=null||(r=i.type==="water"?i.color:E(i.material)?i.material.color:null)}),r?new Ot(r):null}function u4(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new Ot(r)}function sKe(t,e,r){const i=t.symbolLayers;if(!i)return;const s=n=>{const o=E(n)?n:null;return u4(e=e??o??(r!=null?tKe:null),r)};i.forEach(n=>{var o;if(n.type!=="object"||((o=n.resource)==null?void 0:o.href)==null||e)if(n.type==="water")n.color=s(n.color);else{const a=E(n.material)?n.material.color:null,l=s(a);N(n.material)?n.material=new Bd({color:l}):n.material.color=l,r!=null&&"outline"in n&&E(n.outline)&&E(n.outline.color)&&(n.outline.color=u4(n.outline.color,r))}})}function nKe(t,e,r){(e=e??t.color)&&(t.color=u4(e,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=u4(t.outline.color,r))}function Fz(t,e,r){t&&(e||r!=null)&&(e&&(e=new Ot(e)),V3(t)?sKe(t,e,r):cU(t)&&nKe(t,e,r))}async function oKe(t,e){const r=t.symbolLayers;r&&await GB(r,async i=>aKe(i,e))}async function aKe(t,e){switch(t.type){case"extrude":cKe(t,e);break;case"icon":case"line":case"text":lKe(t,e);break;case"path":hKe(t,e);break;case"object":await uKe(t,e)}}function lKe(t,e){const r=vCe(e);E(r)&&(t.size=r)}function vCe(t){for(const e of t)if(typeof e=="number")return e;return null}function cKe(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function uKe(t,e){const{resourceSize:r,symbolSize:i}=await dKe(t),s=bCe(e,r,i);t.width=NI(e[0],i[0],r[0],s),t.depth=NI(e[1],i[1],r[1],s),t.height=NI(e[2],i[2],r[2],s)}function hKe(t,e){const r=bCe(e,hg,[t.width,void 0,t.height]);t.width=NI(e[0],t.width,1,r),t.height=NI(e[2],t.height,1,r)}function bCe(t,e,r){for(let i=0;i<3;i++){const s=t[i];switch(s){case"symbol-value":{const n=r[i];return n!=null?n/e[i]:1}case"proportional":break;default:if(s&&e[i])return s/e[i]}}return 1}async function dKe(t){const e=await be(()=>import("./symbolLayerUtils-9bf42ba0.js"),[]),r=await e.computeObjectLayerResourceSize(t,10),{width:i,height:s,depth:n}=t,o=[i,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function NI(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function pKe(t,e){const r=vCe(e);if(!N(r))switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function fKe(t,e){if(t&&e)return V3(t)?oKe(t,e):void(cU(t)&&pKe(t,e))}function mKe(t,e,r){if(t&&e!=null)if(V3(t)){const i=t.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=e;break;case"roll":s.roll=e;break;default:s.heading=e}})}else cU(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function D6t(t){return E(t)&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function gKe(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const AKe="<",yKe=">",_Ke=ZB("short-date");function vKe(t,e,r,i){let s="";e===0?s=`${AKe} `:e===r&&(s=`${yKe} `);let n=null;return n=i?Lg(t,_Ke):mJe(t),s+n}const bKe=new Ot([64,64,64]);function wKe(t,e){const r=[],i=t.length-1;return t.length===5?r.push(0,2,4):r.push(0,i),t.map((s,n)=>r.includes(n)?vKe(s,n,i,e):null)}async function xKe(t,e,r){let i=!1,s=[],n=[];if(t.stops){const c=t.stops;s=c.map(h=>h.value),i=c.some(h=>!!h.label),i&&(n=c.map(h=>h.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=i?null:wKe(s,r??!1);return(await Promise.all(s.map(async(c,h)=>({value:c,color:t.type==="opacity"?await TKe(c,t,e):(await be(()=>Promise.resolve().then(()=>Pie),void 0)).getColor(t,c),label:i?n[h]:(l==null?void 0:l[h])??""})))).reverse()}async function TKe(t,e,r=bKe){const i=new Ot(r),s=(await be(()=>Promise.resolve().then(()=>Pie),void 0)).getOpacity(e,t);return s!=null&&(i.a=s),i}var kQ;let pP=kQ=class extends Qe{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new kQ({color:this.color,ratio:this.ratio})}};u([d({type:Ot,json:{type:[rn],default:null,write:!0}})],pP.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],pP.prototype,"ratio",void 0),pP=kQ=u([j("esri.renderers.support.HeatmapColorStop")],pP);const FI=pP;function SKe(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(i=>{var s;return((s=i.color)==null?void 0:s.a)>0});let r=e.length-1;if(e&&e[0]){const i=e[r];i&&i.ratio!==1&&(e.push(new FI({ratio:1,color:i.color})),r++)}return e.map((i,s)=>{var o,a;let n="";return s===0?n=((o=t.legendOptions)==null?void 0:o.minLabel)||"low":s===r&&(n=((a=t.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:i.color,label:n,ratio:i.ratio}}).reverse()}we.getLogger("esri.renderers.support.utils");async function Xh(t,e,r){lte(t,e,()=>[]).push(...r)}async function EKe(t){var r,i;const e=new Map;if(!t)return e;if("visualVariables"in t&&t.visualVariables){const s=t.visualVariables.filter(n=>n.type==="color");for(const n of s){const o=(await xKe(n)??[]).map(a=>a.color);await Xh(e,n.field||n.valueExpression,o)}}if(t.type==="heatmap"){const s=SKe(t).map(n=>n.color);await Xh(e,t.field||t.valueExpression,s)}else if(t.type==="pie-chart"){for(const s of t.attributes)await Xh(e,s.field||s.valueExpression,[s.color]);await Xh(e,"default",[(r=t==null?void 0:t.othersCategory)==null?void 0:r.color,HT(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const s of t.attributes)await Xh(e,s.field||s.valueExpression,[s.color]);await Xh(e,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(((i=t.authoringInfo)==null?void 0:i.type)==="predominance")for(const s of t.uniqueValueInfos??[])await Xh(e,s.value.toString(),[HT(s.symbol,null)]);else{const s=(t.uniqueValueInfos??[]).map(c=>HT(c.symbol,null)),{field:n,field2:o,field3:a,valueExpression:l}=t;(n||l)&&await Xh(e,n||l,s),o&&await Xh(e,o,s),a&&await Xh(e,a,s)}else if(t.type==="class-breaks"){const s=t.classBreakInfos.map(a=>HT(a.symbol,null)),{field:n,valueExpression:o}=t;await Xh(e,n??o,s)}else t.type==="simple"&&await Xh(e,"default",[HT(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await Xh(e,"default",[HT(t.defaultSymbol,null)]),e.forEach((s,n)=>{const o=tL(s.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));e.set(n,o)}),e}var BQ;let fP=BQ=class extends Qe{constructor(t){super(t),this.name=null,this.code=null}clone(){return new BQ({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],fP.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],fP.prototype,"code",void 0),fP=BQ=u([j("esri.layers.support.CodedValue")],fP);const CKe=new Ui({inherited:"inherited",codedValue:"coded-value",range:"range"});let mP=class extends Qe{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],mP.prototype,"name",void 0),u([er(CKe)],mP.prototype,"type",void 0),mP=u([j("esri.layers.support.Domain")],mP);const DU=mP;var UQ;let gP=UQ=class extends DU{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new UQ({codedValues:Te(this.codedValues),name:this.name})}};u([d({type:[fP],json:{write:!0}})],gP.prototype,"codedValues",void 0),u([er({codedValue:"coded-value"})],gP.prototype,"type",void 0),gP=UQ=u([j("esri.layers.support.CodedValueDomain")],gP);const wCe=gP;var VQ;let _6=VQ=class extends DU{constructor(t){super(t),this.type="inherited"}clone(){return new VQ}};u([er({inherited:"inherited"})],_6.prototype,"type",void 0),_6=VQ=u([j("esri.layers.support.InheritedDomain")],_6);const xCe=_6;var zQ;let pE=zQ=class extends DU{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new zQ({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],pE.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],pE.prototype,"minValue",void 0),u([er({range:"range"})],pE.prototype,"type",void 0),pE=zQ=u([j("esri.layers.support.RangeDomain")],pE);const TCe=pE,SCe={key:"type",base:DU,typeMap:{range:TCe,"coded-value":wCe,inherited:xCe}};function Aie(t){if(!t||!t.type)return null;switch(t.type){case"range":return TCe.fromJSON(t);case"codedValue":return wCe.fromJSON(t);case"inherited":return xCe.fromJSON(t)}return null}const MKe=new Ui({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var GQ;const RKe=new Ui({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let $c=GQ=class extends Qe{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return(r==null?void 0:r.value)??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?RKe.fromJSON(r.fieldValueType):null}clone(){return new GQ({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([d({type:String,json:{write:!0}})],$c.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],$c.prototype,"defaultValue",void 0),u([d()],$c.prototype,"description",void 0),u([ft("description")],$c.prototype,"readDescription",null),u([d({types:SCe,json:{read:{reader:Aie},write:!0}})],$c.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],$c.prototype,"editable",void 0),u([d({type:rn,json:{write:!0}})],$c.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],$c.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],$c.prototype,"nullable",void 0),u([er(MKe)],$c.prototype,"type",void 0),u([d()],$c.prototype,"valueType",void 0),u([ft("valueType",["description"])],$c.prototype,"readValueType",null),u([d({type:Boolean,json:{read:!1}})],$c.prototype,"visible",void 0),$c=GQ=u([j("esri.layers.support.Field")],$c);const NU=$c;var jQ;let fE=jQ=class extends Qe{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new jQ({mapLayerId:t,gdbVersion:e})}};u([er({mapLayer:"map-layer"})],fE.prototype,"type",void 0),u([d({type:rn,json:{write:!0}})],fE.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],fE.prototype,"gdbVersion",void 0),fE=jQ=u([j("esri.layers.support.source.MapLayerSource")],fE);var HQ;let OA=HQ=class extends Qe{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:r,spatialReference:i,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:r,spatialReference:(i==null?void 0:i.clone())??void 0,geometryType:s};return new HQ(n)}};u([er({queryTable:"query-table"})],OA.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],OA.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],OA.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],OA.prototype,"oidFields",void 0),u([d({type:xt,json:{write:!0}})],OA.prototype,"spatialReference",void 0),u([er(U2e)],OA.prototype,"geometryType",void 0),OA=HQ=u([j("esri.layers.support.source.QueryTableDataSource")],OA);var qQ;let mE=qQ=class extends Qe{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new qQ({workspaceId:t,dataSourceName:e})}};u([er({raster:"raster"})],mE.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],mE.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],mE.prototype,"workspaceId",void 0),mE=qQ=u([j("esri.layers.support.source.RasterDataSource")],mE);var WQ;let Yw=WQ=class extends Qe{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:r}=this;return new WQ({workspaceId:t,gdbVersion:e,dataSourceName:r})}};u([er({table:"table"})],Yw.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Yw.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],Yw.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],Yw.prototype,"dataSourceName",void 0),Yw=WQ=u([j("esri.layers.support.source.TableDataSource")],Yw);var YQ,QQ;const OKe=hc()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let od=YQ=class extends Qe{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,r){return ohe()(t,e,r)}castLeftTableSource(t){return k0(XQ(),t)}readRightTableSource(t,e,r){return ohe()(t,e,r)}castRightTableSource(t){return k0(XQ(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:r,rightTableSource:i,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:(r==null?void 0:r.clone())??void 0,rightTableSource:(i==null?void 0:i.clone())??void 0,joinType:s};return new YQ(n)}};u([er({joinTable:"join-table"})],od.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],od.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],od.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],od.prototype,"leftTableSource",void 0),u([ft("leftTableSource")],od.prototype,"readLeftTableSource",null),u([Hr("leftTableSource")],od.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],od.prototype,"rightTableSource",void 0),u([ft("rightTableSource")],od.prototype,"readRightTableSource",null),u([Hr("rightTableSource")],od.prototype,"castRightTableSource",null),u([er(OKe)],od.prototype,"joinType",void 0),od=YQ=u([j("esri.layers.support.source.JoinTableDataSource")],od);let kz=null;function ohe(){return kz||(kz=bb({types:XQ()})),kz}let Bz=null;function XQ(){return Bz||(Bz={key:"type",base:null,typeMap:{"data-layer":a0,"map-layer":fE}}),Bz}const PKe={key:"type",base:null,typeMap:{"join-table":od,"query-table":OA,raster:mE,table:Yw}};let a0=QQ=class extends Qe{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new QQ({fields:t,dataSource:e})}};u([er({dataLayer:"data-layer"})],a0.prototype,"type",void 0),u([d({type:[NU],json:{write:!0}})],a0.prototype,"fields",void 0),u([d({types:PKe,json:{write:!0}})],a0.prototype,"dataSource",void 0),a0=QQ=u([j("esri.layers.support.source.DataLayerSource")],a0),a0.from=Oo(a0);function IKe(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function yie(t){return typeof t=="string"?eu(t):Te(t)}function $Ke(t,e,r){const i={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){i[s]=[];for(let o=0;o<n.length;o++)i[s][o]=$Ke(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r&&r[s]);i[s]=e?o:JSON.stringify(o)}else i[s]=e?n:JSON.stringify(n);else i[s]=n}return i}const s5={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new y0({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:xt.WebMercator}),minus180Line:new y0({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:xt.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new y0({paths:[[[180,-180],[180,180]]],spatialReference:xt.WGS84}),minus180Line:new y0({paths:[[[-180,-180],[-180,180]]],spatialReference:xt.WGS84})}};function tx(t,e){return Math.ceil((t-e)/(2*e))}function ECe(t,e){const r=kI(t);for(const i of r)for(const s of i)s[0]+=e;return t}function kI(t){return hx(t)?t.rings:t.paths}async function LKe(t,e,r,i){const s=yie(t),n=e[0].spatialReference,o={...i,query:{...s.query,f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:RM(e[0]),geometries:e}),cutter:JSON.stringify(r)}},a=await Ys(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=Ny(h);return p.spatialReference=n,p})}}function DKe(t){return{geometryType:RM(t[0]),geometries:t.map(e=>e.toJSON())}}function CCe(t,e,r){const i=OGe(e);return t.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}async function NKe(t,e,r){const i=typeof t=="string"?eu(t):t,s=e[0].spatialReference,n=RM(e[0]),o={...r,query:{...i.query,f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(DKe(e))}},{data:a}=await Ys(i.path+"/simplify",o);return CCe(a.geometries,n,s)}const MCe=we.getLogger("esri.geometry.support.normalizeUtils");function FKe(t){return t.type==="polygon"}function kKe(t){return t[0].type==="polygon"}function BKe(t){return t[0].type==="polyline"}function UKe(t,e){if(!(t instanceof y0||t instanceof sf)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw MCe.error(s),new ce(s)}const r=kI(t),i=[];for(const s of r){const n=[];i.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),A=(h-l)/p,_=(c-a)/p,w=p/e;if(w>1){for(let O=1;O<=w-1;O++){const $=O*e,L=_*$+a,k=A*$+l;n.push([L,k])}const T=(p+Math.floor(w-1)*e)/2,C=_*T+a,M=A*T+l;n.push([C,M])}n.push([c,h])}}return FKe(t)?new sf({rings:i,spatialReference:t.spatialReference}):new y0({paths:i,spatialReference:t.spatialReference})}function ahe(t,e,r){if(e){const i=UKe(t,1e6);t=dC(i,!0)}return r&&(t=ECe(t,r)),t}function lhe(t,e,r){if(Array.isArray(t)){const i=t[0];if(i>e){const s=tx(i,e);t[0]=i+s*(-2*e)}else if(i<r){const s=tx(i,r);t[0]=i+s*(-2*r)}}else{const i=t.x;if(i>e){const s=tx(i,e);t=t.clone().offset(s*(-2*e),0)}else if(i<r){const s=tx(i,r);t=t.clone().offset(s*(-2*r),0)}}return t}function VKe(t,e){let r=-1;for(let i=0;i<e.cutIndexes.length;i++){const s=e.cutIndexes[i],n=e.geometries[i],o=kI(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let A=0;A<l.length;A++){const _=l[A][0];h=_>h?_:h}h=Number(h.toFixed(9));const p=-360*tx(h,180);for(let A=0;A<l.length;A++){const _=n.getPoint(a,A);n.setPoint(a,A,_.clone().offset(p,0))}return!0}})}if(s===r){if(kKe(t))for(const a of kI(n))t[s]=t[s].addRing(a);else if(BKe(t))for(const a of kI(n))t[s]=t[s].addPath(a)}else r=s,t[s]=n}return t}async function RCe(t,e,r){if(!Array.isArray(t))return RCe([t],e);e&&typeof e!="string"&&MCe.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i=typeof e=="string"?e:(e==null?void 0:e.url)??ls.geometryServiceUrl;let s,n,o,a,l,c,h,p,A=0;const _=[],w=[];for(const L of t)if(N(L))w.push(L);else if(s||(s=L.spatialReference,n=Dv(s),o=s.isWebMercator,c=o?102100:4326,a=s5[c].maxX,l=s5[c].minX,h=s5[c].plus180Line,p=s5[c].minus180Line),n)if(L.type==="mesh")w.push(L);else if(L.type==="point")w.push(lhe(L.clone(),a,l));else if(L.type==="multipoint"){const k=L.clone();k.points=k.points.map(F=>lhe(F,a,l)),w.push(k)}else if(L.type==="extent"){const k=L.clone()._normalize(!1,!1,n);w.push(k.rings?new sf(k):k)}else if(L.extent){const k=L.extent,F=tx(k.xmin,l)*(2*a);let G=F===0?L.clone():ECe(L.clone(),F);k.offset(F,0),k.intersects(h)&&k.xmax!==a?(A=k.xmax>A?k.xmax:A,G=ahe(G,o),_.push(G),w.push("cut")):k.intersects(p)&&k.xmin!==l?(A=k.xmax*(2*a)>A?k.xmax*(2*a):A,G=ahe(G,o,360),_.push(G),w.push("cut")):w.push(G)}else w.push(L.clone());else w.push(L);let T=tx(A,a),C=-90;const M=T,O=new y0;for(;T>0;){const L=360*T-180;O.addPath([[L,C],[L,-1*C]]),C*=-1,T--}if(_.length>0&&M>0){const L=VKe(_,await LKe(i,_,O,r)),k=[],F=[];for(let Z=0;Z<w.length;Z++){const J=w[Z];if(J!=="cut")F.push(J);else{const te=L.shift(),re=t[Z];E(re)&&re.type==="polygon"&&re.rings&&re.rings.length>1&&te.rings.length>=re.rings.length?(k.push(te),F.push("simplify")):F.push(o?gy(te):te)}}if(!k.length)return F;const G=await NKe(i,k,r),z=[];for(let Z=0;Z<F.length;Z++){const J=F[Z];J!=="simplify"?z.push(J):z.push(o?gy(G.shift()):G.shift())}return z}const $=[];for(let L=0;L<w.length;L++){const k=w[L];if(k!=="cut")$.push(k);else{const F=_.shift();$.push(o===!0?gy(F):F)}}return $}function OCe(t){const e={};for(const r in t){if(r==="declaredClass")continue;const i=t[r];if(i!=null&&typeof i!="function")if(Array.isArray(i)){e[r]=[];for(let s=0;s<i.length;s++)e[r][s]=OCe(i[s])}else typeof i=="object"?i.toJSON&&(e[r]=JSON.stringify(i)):e[r]=i}return e}var V1;(function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"})(V1||(V1={}));const che=4294967296,zKe=new TextDecoder("utf-8"),GKe=Le("safari")||Le("ios")?6:Le("ff")?12:32;let ZQ=class v6{constructor(e,r,i=0,s=e?e.byteLength:0){this._tag=0,this._dataType=V1.unknown,this._init(e,r,i,s)}_init(e,r,i,s){this._data=e,this._dataView=r,this._pos=i,this._end=s}asUnsafe(){return this}clone(){return new v6(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const r=this._decodeVarint();if(this._tag=r>>3,this._dataType=7&r,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();if(e!==void 0)return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=this._data[this._pos]!==0;return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,r=this._pos,i=e.getUint32(r,!0)+e.getUint32(r+4,!0)*che;return this._skip(8),i}getSFixed64(){const e=this._dataView,r=this._pos,i=e.getUint32(r,!0)+e.getInt32(r+4,!0)*che;return this._skip(8),i}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),r=this._pos,i=this._toString(this._data,r,r+e);return this._skip(e),i}getBytes(){const e=this._getLength(),r=this._pos,i=this._toBytes(this._data,r,r+e);return this._skip(e),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,r,i,s){const n=this.getMessage(),o=e(n,r,i,s);return n.release(),o}processMessage(e){const r=this.getMessage(),i=e(r);return r.release(),i}getMessage(){const e=this._getLength(),r=v6.pool.acquire();return r._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),r}release(){v6.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case V1.varint:this._decodeVarint();break;case V1.fixed64:this._skip(8);break;case V1.delimited:this._skip(this._getLength());break;case V1.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let r=this._pos,i=0,s=0;if(this._end-r>=10)do{if(s=e[r++],i|=127&s,(128&s)==0||(s=e[r++],i|=(127&s)<<7,(128&s)==0)||(s=e[r++],i|=(127&s)<<14,(128&s)==0)||(s=e[r++],i|=(127&s)<<21,(128&s)==0)||(s=e[r++],i+=268435456*(127&s),(128&s)==0)||(s=e[r++],i+=34359738368*(127&s),(128&s)==0)||(s=e[r++],i+=4398046511104*(127&s),(128&s)==0)||(s=e[r++],i+=562949953421312*(127&s),(128&s)==0)||(s=e[r++],i+=72057594037927940*(127&s),(128&s)==0)||(s=e[r++],i+=9223372036854776e3*(127&s),(128&s)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;r!==this._end&&(s=e[r],(128&s)!=0);)++r,i+=(127&s)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=s*n}return this._pos=r,i}_decodeSVarint(){const e=this._data;let r=this._pos,i=0,s=0;const n=1&e[r];if(this._end-r>=10)do{if(s=e[r++],i|=127&s,(128&s)==0||(s=e[r++],i|=(127&s)<<7,(128&s)==0)||(s=e[r++],i|=(127&s)<<14,(128&s)==0)||(s=e[r++],i|=(127&s)<<21,(128&s)==0)||(s=e[r++],i+=268435456*(127&s),(128&s)==0)||(s=e[r++],i+=34359738368*(127&s),(128&s)==0)||(s=e[r++],i+=4398046511104*(127&s),(128&s)==0)||(s=e[r++],i+=562949953421312*(127&s),(128&s)==0)||(s=e[r++],i+=72057594037927940*(127&s),(128&s)==0)||(s=e[r++],i+=9223372036854776e3*(127&s),(128&s)==0))break;throw new Error("Varint too long!")}while(0);else{let o=1;for(;r!==this._end&&(s=e[r],(128&s)!=0);)++r,i+=(127&s)*o,o*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=s*o}return this._pos=r,n?-(i+1)/2:i/2}_getLength(){if(this._dataType!==V1.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,r,i){if((i=Math.min(this._end,i))-r>GKe){const o=e.subarray(r,i);return zKe.decode(o)}let s="",n="";for(let o=r;o<i;++o){const a=e[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(e,r,i){return i=Math.min(this._end,i),new Uint8Array(e.buffer,r,i-r)}};ZQ.pool=new al(ZQ,void 0,t=>{t._data=null,t._dataView=null});let j0=class b6{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,s,n]=e,o=s-r,a=n-i;return new b6([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)e(this.coords[2*(n+r)],this.coords[2*(n+r)+1]);r+=s}}clone(e){return e?(e.set(this.coords),new b6(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new b6(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}},sb=class PCe{constructor(e=null,r={},i,s){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new PCe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function jKe(t){return!(N(t.geometry)||!t.geometry.coords||!t.geometry.coords.length)}let F6t=class extends sb{},ICe=class $Ce{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new $Ce;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};const LCe=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];let B6t=class{constructor(e){this._options=e,this.geometryTypes=LCe,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new ICe}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e||!e.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||Po(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const r=Fx(this._options.sourceSpatialReference)/Fx(e.spatialReference);if(r!==1)for(const i of e.features){if(!jKe(i))continue;const s=i.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=r}}addFeature(e,r){e.features.push(r)}createFeature(){return new sb}createSpatialReference(){return{wkid:0}}createGeometry(){return new j0}addField(e,r){e.fields.push(r)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((r,i)=>r+i,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,r){e.coords[this._coordinatePtr++]=r}addCoordinatePoint(e,r){e.coords.push(r)}addLength(e,r){e.lengths.push(r)}addQueryGeometry(e,r){e.queryGeometry=r.queryGeometry,e.queryGeometryType=r.queryGeometryType}createPointGeometry(){return new j0}};const uhe=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],hhe=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],dhe=["upperLeft","lowerLeft"];function phe(t){return t>=uhe.length?null:uhe[t]}function HKe(t){return t>=hhe.length?null:hhe[t]}function fhe(t){return t>=dhe.length?null:dhe[t]}function mhe(t,e){return e>=t.geometryTypes.length?null:t.geometryTypes[e]}function qKe(t,e,r){const s=t.asUnsafe(),n=e.createPointGeometry(r);for(;s.next();)switch(s.tag()){case 3:{const o=s.getUInt32(),a=s.pos()+o;let l=0;for(;s.pos()<a;)e.addCoordinatePoint(n,s.getSInt64(),l++);break}default:s.skip()}return n}function WKe(t,e,r){const n=t.asUnsafe(),o=e.createGeometry(r),a=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;n.next();)switch(n.tag()){case 2:{const l=n.getUInt32(),c=n.pos()+l;let h=0;for(;n.pos()<c;)e.addLength(o,n.getUInt32(),h++);break}case 3:{const l=n.getUInt32(),c=n.pos()+l;let h=0;for(e.allocateCoordinates(o);n.pos()<c;)e.addCoordinate(o,n.getSInt64(),h),h++,h===a&&(h=0);break}default:n.skip()}return o}function YKe(t){const s=t.asUnsafe(),n=new j0;let o="esriGeometryPoint";for(;s.next();)switch(s.tag()){case 2:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.lengths.push(s.getUInt32());break}case 3:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.coords.push(s.getSInt64());break}case 1:o=LCe[s.getEnum()];break;default:s.skip()}return{queryGeometry:n,queryGeometryType:o}}function QKe(t){const h=t.asUnsafe();for(;h.next();)switch(h.tag()){case 1:return h.getString();case 2:return h.getFloat();case 3:return h.getDouble();case 4:return h.getSInt32();case 5:return h.getUInt32();case 6:return h.getInt64();case 7:return h.getUInt64();case 8:return h.getSInt64();case 9:return h.getBool();default:return h.skip(),null}return null}function XKe(t){const a=t.asUnsafe(),l={type:phe(0)};for(;a.next();)switch(a.tag()){case 1:l.name=a.getString();break;case 2:l.type=phe(a.getEnum());break;case 3:l.alias=a.getString();break;case 4:l.sqlType=HKe(a.getEnum());break;case 5:a.skip();break;case 6:l.defaultValue=a.getString();break;default:a.skip()}return l}function ZKe(t){const i={},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:i.name=s.getString();break;case 2:i.isSystemMaintained=s.getBool();break;default:s.skip()}return i}function JKe(t,e,r,i){const a=e.createFeature(r);let l=0;for(;t.next();)switch(t.tag()){case 1:{const c=i[l++].name;a.attributes[c]=t.processMessage(QKe);break}case 2:a.geometry=t.processMessageWithArgs(WKe,e,r);break;case 4:a.centroid=t.processMessageWithArgs(qKe,e,r);break;default:t.skip()}return a}function KKe(t){const n=[1,1,1,1],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function eet(t){const n=[0,0,0,0],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function tet(t){const s={originPosition:fhe(0)},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.originPosition=fhe(n.getEnum());break;case 2:s.scale=n.processMessage(KKe);break;case 3:s.translate=n.processMessage(eet);break;default:n.skip()}return s}function ret(t){const s={},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.shapeAreaFieldName=n.getString();break;case 2:s.shapeLengthFieldName=n.getString();break;case 3:s.units=n.getString();break;default:n.skip()}return s}function iet(t,e){const a=e.createSpatialReference();for(;t.next();)switch(t.tag()){case 1:a.wkid=t.getUInt32();break;case 5:a.wkt=t.getString();break;case 2:a.latestWkid=t.getUInt32();break;case 3:a.vcsWkid=t.getUInt32();break;case 4:a.latestVcsWkid=t.getUInt32();break;default:t.skip()}return a}function set(t,e){const T=e.createFeatureResult(),C=t.asUnsafe();T.geometryType=mhe(e,0);let M=!1;for(;C.next();)switch(C.tag()){case 1:T.objectIdFieldName=C.getString();break;case 3:T.globalIdFieldName=C.getString();break;case 4:T.geohashFieldName=C.getString();break;case 5:T.geometryProperties=C.processMessage(ret);break;case 7:T.geometryType=mhe(e,C.getEnum());break;case 8:T.spatialReference=C.processMessageWithArgs(iet,e);break;case 10:T.hasZ=C.getBool();break;case 11:T.hasM=C.getBool();break;case 12:T.transform=C.processMessage(tet);break;case 9:{const O=C.getBool();T.exceededTransferLimit=O;break}case 13:e.addField(T,C.processMessage(XKe));break;case 15:M||(e.prepareFeatures(T),M=!0),e.addFeature(T,C.processMessageWithArgs(JKe,e,T,T.fields));break;case 2:T.uniqueIdField=C.processMessage(ZKe);break;default:C.skip()}return e.finishFeatureResult(T),T}function net(t,e){const s={};let n=null;for(;t.next();)switch(t.tag()){case 4:n=t.processMessageWithArgs(YKe);break;case 1:s.featureResult=t.processMessageWithArgs(set,e);break;default:t.skip()}return E(n)&&s.featureResult&&e.addQueryGeometry(s,n),s}function oet(t,e){try{const i=new ZQ(new Uint8Array(t),new DataView(t)),s={};for(;i.next();)i.tag()===2?s.queryResult=i.processMessageWithArgs(net,e):i.skip();return s}catch(r){throw new ce("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:r})}}function aet(t,e){const r=oet(t,e),i=r.queryResult.featureResult,s=r.queryResult.queryGeometry,n=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const o=i.objectIdFieldName;for(const a of i.features)a.attributes&&(a.objectId=a.attributes[o])}return i&&(i.queryGeometry=s,i.queryGeometryType=n),i}function JQ(t,e,r){if(!r||!r.features||!r.hasZ)return;const i=STe(r.geometryType,e,t.outSpatialReference);if(!N(i))for(const s of r.features)i(s.geometry)}const ghe="Layer does not support extent calculation.";function cet(t,e){if(e&&t.type==="extent")return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&t.type==="point")return`${t.x},${t.y}`;const r=t.toJSON();return delete r.spatialReference,JSON.stringify(r)}function uet(t,e){const r=t.geometry,i=t.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const s=i;let n,o,a;if(E(r)&&(o=r.spatialReference,a=r.spatialReference.wkid||JSON.stringify(r.spatialReference),s.geometryType=RM(r),s.geometry=cet(r,t.compactGeometryEnabled),s.inSR=a),i.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(s.objectIds=i.objectIds.join(",")),i.orderByFields&&(s.orderByFields=i.orderByFields.join(",")),!i.outFields||!i.returnDistinctValues&&(e!=null&&e.returnCountOnly||e!=null&&e.returnExtentOnly||e!=null&&e.returnIdsOnly)?delete s.outFields:i.outFields.includes("*")?s.outFields="*":s.outFields=i.outFields.join(","),i.outSR?(s.outSR=i.outSR.wkid||JSON.stringify(i.outSR),n=t.outSpatialReference):r&&(i.returnGeometry||i.returnCentroid)&&(s.outSR=s.inSR,n=o),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(s.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(s.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(s.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&E(o)&&E(t.quantizationParameters)&&E(t.quantizationParameters.extent)&&o.equals(t.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(s.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(s.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(s.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const l=i.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c??"null"},${h??"null"}`),delete i.timeExtent}return t.defaultSpatialReferenceEnabled&&E(o)&&E(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function het(t,e,r,i){const s=E(e.timeExtent)&&e.timeExtent.isEmpty?{data:{features:[]}}:await CL(t,e,"json",i);return JQ(e,r,s.data),s}async function V6t(t,e,r,i){if(E(e.timeExtent)&&e.timeExtent.isEmpty)return{data:r.createFeatureResult()};const s=await det(t,e,i),n=s;return n.data=aet(s.data,r),n}function det(t,e,r){return CL(t,e,"pbf",r)}function z6t(t,e,r){return E(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):CL(t,e,"json",r,{returnIdsOnly:!0})}function G6t(t,e,r){return E(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):CL(t,e,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function j6t(t,e,r){return E(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):CL(t,e,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(i=>{const s=i.data;if(s.hasOwnProperty("extent"))return i;if(s.features)throw new Error(ghe);if(s.hasOwnProperty("count"))throw new Error(ghe);return i})}function CL(t,e,r,i={},s={}){const n=typeof t=="string"?eu(t):t,o=e.geometry?[e.geometry]:[];return i.responseType=r==="pbf"?"array-buffer":"json",RCe(o,null,i).then(a=>{const l=a&&a[0];E(l)&&((e=e.clone()).geometry=l);const c=OCe({...n.query,f:r,...s,...uet(e,s)});return Ys(Dx(n.path,"query"),{...i,query:{...c,...i.query}})})}var KQ;const eX=new Ui({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let bl=KQ=class extends Qe{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){var s;const r=xt.fromJSON(e.spatialReference),i=[];for(let n=0;n<t.length;n++){const o=t[n],a=pl.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;E(a.geometry)&&!l&&(a.geometry.spatialReference=r);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&E(h))for(const p in h){const A=h[p],_=(s=c[p])==null?void 0:s.spatialReference;E(A)&&!_&&(A.spatialReference=r)}i.push(a)}return i}writeGeometryType(t,e,r,i){if(t)return void eX.write(t,e,r,i);const{features:s}=this;if(s){for(const n of s)if(n&&E(n.geometry))return void eX.write(n.geometry.type,e,r,i)}}readQueryGeometry(t,e){if(!t)return null;const r=!!t.spatialReference,i=Ny(t);return i&&!r&&e.spatialReference&&(i.spatialReference=xt.fromJSON(e.spatialReference)),i}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&E(i.geometry)&&i.geometry.spatialReference)return void(e.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new KQ(this.cloneProperties())}cloneProperties(){return Te({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let r=0;r<e.features.length;r++){const i=e.features[r];if(i.geometry){const s=t&&t[r];i.geometry=s&&s.toJSON()||i.geometry}}return e}quantize(t){const{scale:[e,r],translate:[i,s]}=t,n=c=>Math.round((c-i)/e),o=c=>Math.round((s-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:r}=this;if(!r)return this;const{translate:[i,s],scale:[n,o]}=r,a=h=>h*n+i,l=h=>s-h*o,c=this._getHydrationFunction(t,a,l);for(const{geometry:h}of e)E(h)&&c&&c(h);return this.transform=null,this}_quantizePoints(t,e,r){let i,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=r(l[1]);c===i&&h===s||(n.push([c-i,h-s]),i=c,s=h)}else i=e(l[0]),s=r(l[1]),n.push([i,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,r){return t==="point"?i=>(i.x=e(i.x),i.y=r(i.y),i):t==="polyline"||t==="polygon"?i=>{const s=hx(i)?i.rings:i.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,r);c&&n.push(c)}return n.length>0?(hx(i)?i.rings=n:i.paths=n,i):null}:t==="multipoint"?i=>{const s=this._quantizePoints(i.points,e,r);return s&&s.length>0?(i.points=s,i):null}:t==="extent"?i=>i:null}_getHydrationFunction(t,e,r){return t==="point"?i=>{i.x=e(i.x),i.y=r(i.y)}:t==="polyline"||t==="polygon"?i=>{const s=hx(i)?i.rings:i.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,p=c.length;h<p;h++){const A=c[h];h>0?(n+=A[0],o+=A[1]):(n=A[0],o=A[1]),A[0]=e(n),A[1]=r(o)}}}:t==="extent"?i=>{i.xmin=e(i.xmin),i.ymin=r(i.ymin),i.xmax=e(i.xmax),i.ymax=r(i.ymax)}:t==="multipoint"?i=>{const s=i.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=e(n),c[1]=r(o)}}:null}};u([d({type:String,json:{write:!0}})],bl.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],bl.prototype,"exceededTransferLimit",void 0),u([d({type:[pl],json:{write:!0}})],bl.prototype,"features",void 0),u([ft("features")],bl.prototype,"readFeatures",null),u([d({type:[NU],json:{write:!0}})],bl.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:eX.read}}})],bl.prototype,"geometryType",void 0),u([St("geometryType")],bl.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],bl.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],bl.prototype,"hasZ",void 0),u([d({types:yT,json:{write:!0}})],bl.prototype,"queryGeometry",void 0),u([ft("queryGeometry")],bl.prototype,"readQueryGeometry",null),u([d({type:xt,json:{write:!0}})],bl.prototype,"spatialReference",void 0),u([St("spatialReference")],bl.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],bl.prototype,"transform",void 0),bl=KQ=u([j("esri.rest.support.FeatureSet")],bl),bl.prototype.toJSON.isDefaultToJSON=!0;const _ie=bl,Ahe={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},pet={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function fet(t,e){const r=new Date(t,e+1,1);return r.setDate(0),r.getDate()}function Ax(t,e,r){const i=new Date(t.getTime());if(e&&r){const s=pet[r],{getter:n,setter:o,multiplier:a}=s;if(r==="months"){const l=fet(i.getFullYear(),i.getMonth()+e);i.getDate()>l&&i.setDate(l)}i[o](i[n]()+e*a)}return i}function yhe(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function met(t,e,r){return t===0?0:t*Ahe[e]/Ahe[r]}var Uf;let md=Uf=class extends Qe{static get allTime(){return _he}static get empty(){return get}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(Uf.allTime)}get isEmpty(){return this.equals(Uf.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new Uf({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=E(this.start)?this.start.getTime():this.start,r=E(this.end)?this.end.getTime():this.end,i=E(t.start)?t.start.getTime():t.start,s=E(t.end)?t.end.getTime():t.end;return e===i&&r===s}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=ka(this.start,i=>yhe(i,t)),r=ka(this.end,i=>{const s=yhe(i,t);return i.getTime()===s.getTime()?s:Ax(s,1,t)});return new Uf({start:e,end:r})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Uf.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=Ed(this.start,-1/0,a=>a.getTime()),r=Ed(this.end,1/0,a=>a.getTime()),i=Ed(t.start,-1/0,a=>a.getTime()),s=Ed(t.end,1/0,a=>a.getTime());let n,o;if(i>=e&&i<=r?n=i:e>=i&&e<=s&&(n=e),r>=i&&r<=s?o=r:s>=e&&s<=r&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const a=new Uf;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return Uf.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const r=new Uf,{start:i,end:s}=this;return E(i)&&(r.start=Ax(i,t,e)),E(s)&&(r.end=Ax(s,t,e)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return _he.clone();const e=E(this.start)&&E(t.start)?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=E(this.end)&&E(t.end)?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Uf({start:e,end:r})}};u([d({type:Date,json:{write:{allowNull:!0}}})],md.prototype,"end",void 0),u([ft("end")],md.prototype,"readEnd",null),u([St("end")],md.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],md.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],md.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],md.prototype,"start",void 0),u([ft("start")],md.prototype,"readStart",null),u([St("start")],md.prototype,"writeStart",null),md=Uf=u([j("esri.TimeExtent")],md);const _he=new md,get=new md({start:void 0,end:void 0}),Wg=md;let Qw=class extends Fn(Qe){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([d({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:E(this.onFields)&&this.onFields.length>0}}}}})],Qw.prototype,"onFields",void 0),u([d({type:String,json:{write:!0}})],Qw.prototype,"operator",void 0),u([d({type:String,json:{write:!0}})],Qw.prototype,"searchTerm",void 0),u([d({type:String,json:{write:!0}})],Qw.prototype,"searchType",void 0),Qw=u([j("esri.rest.support.FullTextSearch")],Qw);const Aet=Qw;var tX;const vhe=new Ui({upperLeft:"upper-left",lowerLeft:"lower-left"});let Xw=tX=class extends Qe{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new tX(Te({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:Ki,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Xw.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],Xw.prototype,"mode",void 0),u([d({type:String,json:{read:vhe.read,write:vhe.write}})],Xw.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Xw.prototype,"tolerance",void 0),Xw=tX=u([j("esri.rest.support.QuantizationParameters")],Xw);const yet=Xw;var rX;const bhe=new Ui({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Vf=rX=class extends Qe{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=Te(t))}clone(){return new rX({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:Te(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],Vf.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],Vf.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],Vf.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],Vf.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],Vf.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:bhe.read},write:{target:"statisticType",writer:bhe.write}}})],Vf.prototype,"statisticType",void 0),u([d({type:Object})],Vf.prototype,"statisticParameters",void 0),u([St("statisticParameters")],Vf.prototype,"writeStatisticParameters",null),Vf=rX=u([j("esri.rest.support.StatisticDefinition")],Vf);const DCe=Vf;var QC;const _et=new Ui({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),vet=new Ui({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Pr=QC=class extends Qe{static from(t){return M3(QC,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const r={};for(const i in t){const s=t[i];Array.isArray(s)?r[i]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?r[i]=s.getTime():r[i]=s}e.parameterValues=r}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new QC(Te({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:E(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Pr.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],Pr.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],Pr.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Pr.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],Pr.prototype,"datumTransformation",void 0),u([Hr("datumTransformation")],Pr.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],Pr.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Pr.prototype,"distance",void 0),u([d({type:a0,json:{write:!0}})],Pr.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],Pr.prototype,"formatOf3DObjects",void 0),u([d({type:[Aet],json:{write:{enabled:!0,overridePolicy(){return{enabled:E(this.fullText)&&this.fullText.length>0}}}}})],Pr.prototype,"fullText",void 0),u([d({type:String,json:{write:!0}})],Pr.prototype,"gdbVersion",void 0),u([d({types:yT,json:{read:Ny,write:!0}})],Pr.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Pr.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],Pr.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],Pr.prototype,"having",void 0),u([d({type:Date})],Pr.prototype,"historicMoment",void 0),u([St("historicMoment")],Pr.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],Pr.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:t=>t<1?1:t>QC.MAX_MAX_RECORD_COUNT_FACTOR?QC.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],Pr.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],Pr.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Pr.prototype,"num",void 0),u([d({json:{write:!0}})],Pr.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Pr.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Pr.prototype,"outFields",void 0),u([d({type:xt,json:{name:"outSR",write:!0}})],Pr.prototype,"outSpatialReference",void 0),u([d({type:[DCe],json:{write:{enabled:!0,overridePolicy(){return{enabled:E(this.outStatistics)&&this.outStatistics.length>0}}}}})],Pr.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],Pr.prototype,"parameterValues",void 0),u([St("parameterValues")],Pr.prototype,"writeParameterValues",null),u([d({type:Gt,json:{write:!0}})],Pr.prototype,"pixelSize",void 0),u([d({type:yet,json:{write:!0}})],Pr.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],Pr.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Pr.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],Pr.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Pr.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Pr.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],Pr.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],Pr.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Pr.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Pr.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Pr.prototype,"returnZ",void 0),u([d({type:xt,json:{write:!0}})],Pr.prototype,"sourceSpatialReference",void 0),u([er(_et,{ignoreUnknown:!1,name:"spatialRel"})],Pr.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Pr.prototype,"start",void 0),u([St("start"),St("num")],Pr.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],Pr.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],Pr.prototype,"text",void 0),u([d({type:Wg,json:{write:!0}})],Pr.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Pr.prototype,"timeReferenceUnknownClient",void 0),u([er(vet,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],Pr.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],Pr.prototype,"where",void 0),u([St("where")],Pr.prototype,"writeWhere",null),Pr=QC=u([j("esri.rest.support.Query")],Pr);const Tg=Pr;async function Uz(t,e,r){const i=await bet(t,e,r);return _ie.fromJSON(i)}async function bet(t,e,r){const i=yie(t),s={...r},n=Tg.from(e),{data:o}=await het(i,n,n.sourceSpatialReference,s);return o}function lc(t,e){return t?e?4:3:e?3:2}const ML=we.getLogger("esri.layers.graphics.featureConversionUtils"),NCe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},wet=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n},whe=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2]},xet=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+3]},Tet=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2],t[r+3]=e[i+3]};function vie(t,e,r,i){if(t){if(r)return e&&i?Tet:whe;if(e&&i)return xet}else if(e&&i)return whe;return wet}function Vz({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function zz({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function Gz({scale:t,translate:e},r,i){return r*t[i]+e[i]}function q6t(t,e,r){return t?e?r?xie(t):bie(t):r?wie(t):FU(t):null}function FU(t){const e=t.coords;return{x:e[0],y:e[1]}}function FCe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function bie(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function Eet(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function wie(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function Cet(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function xie(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function Met(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function Ret(t,e,r,i){let s=FU;r&&i?s=xie:r?s=bie:i&&(s=wie);for(const n of e){const{geometry:o,attributes:a}=n,l=E(o)?s(o):null;t.push({attributes:a,geometry:l})}return t}function Tie(t,e){return t&&e?Met:t?Eet:e?Cet:FCe}function Oet(t,e,r,i,s){const n=Tie(r,i);for(const{geometry:o,attributes:a}of e){const l=E(o)?n(new j0,o):null;t.push(new sb(l,a,null,s?a[s]:void 0))}return t}function W6t(t,e,r=Tie(e.z!=null,e.m!=null)){return r(t,e)}function Pet(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:E(s)?kCe(s,r,i):null});return t}function kCe(t,e,r){if(N(t))return null;const i=lc(e,r),s=[];for(let n=0;n<t.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[n+a]);s.push(o)}return e?r?{points:s,hasZ:e,hasM:r}:{points:s,hasZ:e}:r?{points:s,hasM:r}:{points:s}}function Iet(t,e,r,i,s){const n=lc(r,i);for(const{geometry:o,attributes:a}of e){const l=E(o)?BCe(new j0,o,n):null;t.push(new sb(l,a,null,s?a[s]:void 0))}return t}function BCe(t,e,r=lc(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let s=0;for(const n of e.points)for(let o=0;o<r;o++)i[s++]=n[o];return t}function $et(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:E(s)?UCe(s,r,i):null});return t}function UCe(t,e,r){if(!t)return null;const i=lc(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let A=0;A<i;A++)p.push(s[a++]);c.push(p)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function Let(t,e,r,i,s){const n=lc(r,i);for(const{geometry:o,attributes:a}of e){const l=E(o)?VCe(new j0,o,n):null;t.push(new sb(l,a,null,s?a[s]:void 0))}return t}function VCe(t,e,r=lc(e.hasZ,e.hasM)){const{lengths:i,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return t}function Det(t,e,r,i){for(const{geometry:s,attributes:n,centroid:o}of e){const a=E(s)?zCe(s,r,i):null;if(E(o)){const l=FU(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function zCe(t,e,r){if(!t)return null;const i=lc(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let A=0;A<i;A++)p.push(s[a++]);c.push(p)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function Net(t,e,r,i,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=E(n)?GCe(new j0,n,r,i):null,c=s?a[s]:void 0;E(o)?t.push(new sb(l,a,FCe(new j0,o),c)):t.push(new sb(l,a,null,c))}return t}function GCe(t,e,r=e.hasZ,i=e.hasM){return Fet(t,e.rings,r,i),t}function Fet(t,e,r,i){const s=lc(r,i),{lengths:n,coords:o}=t;let a=0;yy(t);for(const l of e){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return t}const XC=[],BI=[];function Y6t(t,e,r,i,s){XC[0]=t;const[n]=jCe(BI,XC,e,r,i,s);return H0(XC),H0(BI),n}function jCe(t,e,r,i,s,n){if(H0(t),!r){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new sb(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return Oet(t,e,i,s,n);case"esriGeometryMultipoint":return Iet(t,e,i,s,n);case"esriGeometryPolyline":return Let(t,e,i,s,n);case"esriGeometryPolygon":return Net(t,e,i,s,n);default:ML.error("convertToFeatureSet:unknown-geometry",new ce(`Unable to parse unknown geometry type '${r}'`)),H0(t)}return t}function Q6t(t,e,r,i){BI[0]=t,HCe(XC,BI,e,r,i);const s=XC[0];return H0(XC),H0(BI),s}function ket(t,e,r){if(N(t))return null;const i=new j0;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),tre(t)?Tie(e??t.z!=null,r??t.m!=null)(i,t):hx(t)?GCe(i,t,e,r):rre(t)?VCe(i,t,lc(e,r)):ere(t)?BCe(i,t,lc(e,r)):void ML.error("convertFromGeometry:unknown-geometry",new ce(`Unable to parse unknown geometry type '${t}'`))}function Bet(t,e,r,i){const s=t&&("coords"in t?t:t.geometry);if(N(s))return null;switch(e){case"esriGeometryPoint":{let n=FU;return r&&i?n=xie:r?n=bie:i&&(n=wie),n(s)}case"esriGeometryMultipoint":return kCe(s,r,i);case"esriGeometryPolyline":return UCe(s,r,i);case"esriGeometryPolygon":return zCe(s,r,i);default:return ML.error("convertToGeometry:unknown-geometry",new ce(`Unable to parse unknown geometry type '${e}'`)),null}}function Uet(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function HCe(t,e,r,i,s){if(H0(t),N(r))return Uet(t,e);switch(r){case"esriGeometryPoint":return Ret(t,e,i,s);case"esriGeometryMultipoint":return Pet(t,e,i,s);case"esriGeometryPolyline":return $et(t,e,i,s);case"esriGeometryPolygon":return Det(t,e,i,s);default:ML.error("convertToFeatureSet:unknown-geometry",new ce(`Unable to parse unknown geometry type '${r}'`))}return t}function X6t(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:A}=t,_={features:HCe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:h,queryGeometry:Bet(p,A,!1,!1)};return i&&(_.transform=i),c&&(_.exceededTransferLimit=c),n&&(_.hasM=n),o&&(_.hasZ=o),_}function Z6t(t,e){const r=new ICe,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=t;return p&&(r.fields=p),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(n&&jCe(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),h&&(r.transform=h),r):(ML.error(new ce("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function J6t(t){const{transform:e,features:r,hasM:i,hasZ:s}=t;if(!e)return t;for(const n of r)E(n.geometry)&&The(n.geometry,n.geometry,i,s,e),E(n.centroid)&&The(n.centroid,n.centroid,i,s,e);return t.transform=null,t}function K6t(t,e){const{geometryType:r,features:i,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new j0,xhe(l.geometry,a.geometry,s,n,r,t),a.centroid&&(l.centroid=new j0,xhe(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function xhe(t,e,r,i,s,n,o=r,a=i){if(yy(t),N(e)||!e.coords.length)return null;const l=NCe[s],{coords:c,lengths:h}=e,p=lc(r,i),A=lc(r&&o,i&&a),_=vie(r,i,o,a);if(!h.length)return _(t.coords,c,0,0,Vz(n,c[0]),zz(n,c[1])),yy(t,p,0),t;let w,T,C,M,O=0,$=0,L=$;for(const k of h){if(k<l)continue;let F=0;$=L,C=w=Vz(n,c[O]),M=T=zz(n,c[O+1]),_(t.coords,c,$,O,C,M),F++,O+=p,$+=A;for(let G=1;G<k;G++,O+=p)C=Vz(n,c[O]),M=zz(n,c[O+1]),C===w&&M===T||(_(t.coords,c,$,O,C-w,M-T),$+=A,F++,w=C,T=M);F>=l&&(t.lengths.push(F),L=$)}return H0(t.coords,L),t.coords.length?t:null}function e8t(t,e,r,i,s,n,o=r,a=i){if(yy(t),!e||!e.coords.length)return null;const l=NCe[s],{coords:c,lengths:h}=e,p=lc(r,i),A=lc(r&&o,i&&a),_=vie(r,i,o,a);if(!h.length)return _(t.coords,c,0,0,c[0],c[1]),yy(t,p,0),t;let w=0;const T=n*n;for(const C of h){if(C<l){w+=C*p;continue}const M=t.coords.length/A,O=w,$=w+(C-1)*p;_(t.coords,c,t.coords.length,O,c[O],c[O+1]),iX(t.coords,c,p,T,_,O,$),_(t.coords,c,t.coords.length,$,c[$],c[$+1]);const L=t.coords.length/A-M;L>=l?t.lengths.push(L):H0(t.coords,M*A),w+=C*p}return t.coords.length?t:null}function Vet(t,e,r,i){const s=t[e],n=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let h=o,p=a,A=l-h,_=c-p;if(A!==0||_!==0){const w=((s-h)*A+(n-p)*_)/(A*A+_*_);w>1?(h=l,p=c):w>0&&(h+=A*w,p+=_*w)}return A=s-h,_=n-p,A*A+_*_}function iX(t,e,r,i,s,n,o){let a,l=i,c=0;for(let h=n+r;h<o;h+=r)a=Vet(e,h,n,o),a>l&&(c=h,l=a);l>i&&(c-n>r&&iX(t,e,r,i,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>r&&iX(t,e,r,i,s,c,o))}function t8t(t,e,r,i){if(N(e)||!e.coords||!e.coords.length)return null;const s=lc(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=s){const p=c[h],A=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,A),l=Math.max(l,A)}}return RY(t)?Kje(t,n,o,a,l):pre(n,o,a,l,t),t}function The(t,e,r,i,s){const{coords:n,lengths:o}=e,a=lc(r,i);if(!n.length)return t!==e&&yy(t),t;DB(s);const{originPosition:l,scale:c,translate:h}=s,p=Get;p.originPosition=l;const A=p.scale;A[0]=c[0]??1,A[1]=-(c[1]??1),A[2]=c[2]??1,A[3]=c[3]??1;const _=p.translate;if(_[0]=h[0]??0,_[1]=h[1]??0,_[2]=h[2]??0,_[3]=h[3]??0,!o.length){for(let T=0;T<a;++T)t.coords[T]=Gz(p,n[T],T);return t!==e&&yy(t,a,0),t}let w=0;for(let T=0;T<o.length;T++){const C=o[T];t.lengths[T]=C;for(let $=0;$<a;++$)t.coords[w+$]=Gz(p,n[w+$],$);let M=t.coords[w],O=t.coords[w+1];w+=a;for(let $=1;$<C;$++,w+=a){M+=n[w]*A[0],O+=n[w+1]*A[1],t.coords[w]=M,t.coords[w+1]=O;for(let L=2;L<a;++L)t.coords[w+L]=Gz(p,n[w+L],L)}}return t!==e&&yy(t,n.length,o.length),t}function r8t(t,e,r,i,s,n){if(yy(t),t.lengths.push(...e.lengths),r===s&&i===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=lc(r,i),a=vie(r,i,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function zet(t,e,r,i){let s=0,n=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=n+t[i*(e+a)],c=o+t[i*(e+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function i8t(t,e){const{coords:r,lengths:i}=t;let s=0,n=0;for(let o=0;o<i.length;o++){const a=i[o];n+=zet(r,s,a,e),s+=a}return Math.abs(n)}function s8t(t,e){if(N(t))return null;const r=t.clone(),i=t.coords,s=t.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=i[e*n],c=i[e*n+1];for(let h=1;h<a;h++){const p=l+i[e*(n+h)],A=c+i[e*(n+h)+1];r.coords[e*(n+h)]=p,r.coords[e*(n+h)+1]=A,l=p,c=A}n+=a}return r}function yy(t,e=0,r=0){H0(t.lengths,r),H0(t.coords,e)}function H0(t,e=0){t.length!==e&&(t.length=e)}const Get={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};var sX;let mo=sX=class extends Qe{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new sX(Te({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],mo.prototype,"cacheHint",void 0),u([d({type:a0,json:{write:!0}})],mo.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],mo.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],mo.prototype,"geometryPrecision",void 0),u([d({type:Date})],mo.prototype,"historicMoment",void 0),u([St("historicMoment")],mo.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],mo.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],mo.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],mo.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],mo.prototype,"outFields",void 0),u([d({type:xt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],mo.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],mo.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],mo.prototype,"start",void 0),u([St("start"),St("num")],mo.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],mo.prototype,"num",void 0),u([d({json:{write:!0}})],mo.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],mo.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],mo.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],mo.prototype,"where",void 0),mo=sX=u([j("esri.rest.support.RelationshipQuery")],mo),mo.from=Oo(mo);const X3=mo,n8t=Object.freeze(Object.defineProperty({__proto__:null,default:X3},Symbol.toStringTag,{value:"Module"}));var nX;let gE=nX=class extends Qe{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new nX({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],gE.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],gE.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],gE.prototype,"orderByFields",void 0),gE=nX=u([j("esri.rest.support.TopFilter")],gE);const jet=gE;var oX;const She=new Ui({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Ehe=new Ui({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Gn=oX=class extends Qe{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new oX(Te({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],Gn.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Gn.prototype,"distance",void 0),u([d({types:yT,json:{read:Ny,write:!0}})],Gn.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Gn.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],Gn.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Gn.prototype,"num",void 0),u([d({json:{write:!0}})],Gn.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Gn.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Gn.prototype,"outFields",void 0),u([d({type:xt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Gn.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],Gn.prototype,"resultType",void 0),u([d({json:{write:!0}})],Gn.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Gn.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Gn.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Gn.prototype,"start",void 0),u([St("start"),St("num")],Gn.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:She.read},write:{target:"spatialRel",writer:She.write}}})],Gn.prototype,"spatialRelationship",void 0),u([d({type:Wg,json:{write:!0}})],Gn.prototype,"timeExtent",void 0),u([d({type:jet,json:{write:!0}})],Gn.prototype,"topFilter",void 0),u([d({type:String,json:{read:Ehe.read,write:{writer:Ehe.write,overridePolicy(t){return{enabled:E(t)&&E(this.distance)&&this.distance>0}}}}})],Gn.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],Gn.prototype,"where",void 0),Gn=oX=u([j("esri.rest.support.TopFeaturesQuery")],Gn),Gn.from=Oo(Gn);const n5=Gn,Het="esri.widgets.Feature.support.relatedFeatureUtils",Che=we.getLogger(Het),Mhe=new Map;function w6(t){if(!hy(t))return null;const[e,r]=t.split("/").slice(1);return{layerId:e,fieldName:r}}function qet(t,e){if(!e.relationships)return null;let r=null;const{relationships:i}=e;return i.some(s=>s.id===parseInt(t,10)&&(r=s,!0)),r}function Wet({originRelationship:t,relationships:e,layerId:r}){let i=null;return e&&e.some(s=>(`${s.relatedTableId}`===r&&s.id===(t==null?void 0:t.id)&&(i=s),!!i)),i}function Yet(t,e){const r=e.toLowerCase();for(const i in t)if(i.toLowerCase()===r)return t[i];return null}function Qet(t,e){const r=qet(t,e);if(r)return{url:`${e.url}/${r.relatedTableId}`,sourceSpatialReference:e.spatialReference,relation:r,relatedFields:[],outStatistics:[]}}function Xet(t,e){if(!e||!t)return;const{features:r,statsFeatures:i}=t,s=r&&r.value;e.relatedFeatures=s?s.features:[];const n=i&&i.value;e.relatedStatsFeatures=n?n.features:[]}function Zet(t,e,r,i){var n;const s=new X3;return s.outFields=["*"],s.relationshipId=typeof e.id=="number"?e.id:parseInt(e.id,10),s.objectIds=[t.attributes[r.objectIdField]],((n=r.queryRelatedFeatures)==null?void 0:n.call(r,s,i))??Promise.resolve({})}function Jet(t,e,r){let i=0;const s=[];for(;i<e.length;)s.push(`${t} IN (${e.slice(i,r+i)})`),i+=r;return s.join(" OR ")}async function Ket(t,e,r,i){const s=r.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=e;if(!n||!o)return null;const p=Wet({originRelationship:o,relationships:n.relationships,layerId:s});if(p!=null&&p.relationshipTableId&&p.keyFieldInRelationshipTable){const _=(await Zet(t,p,r,i))[t.attributes[r.objectIdField]];if(!_)return null;const w=_.features.map(T=>T.attributes[n.objectIdField]);if(l!=null&&l.length&&n.supportsStatistics){const T=new Tg;T.where=Jet(n.objectIdField,w,1e3),T.outFields=a,T.outStatistics=l,T.sourceSpatialReference=h;const C={features:Promise.resolve(_),statsFeatures:Uz(c,T)};return Vu(C)}}const A=p==null?void 0:p.keyField;if(A){const _=XB(stt(n.fields,A)),w=Yet(t.attributes,o.keyField),T=_?`${A}=${w}`:`${A}='${w}'`,C=Uz(c,new Tg({where:T,outFields:e.relatedFields,sourceSpatialReference:h}),i),M=e.outStatistics&&e.outStatistics.length>0&&n.supportsStatistics?Uz(c,new Tg({where:T,outFields:e.relatedFields,outStatistics:e.outStatistics,sourceSpatialReference:h}),i):null,O={features:C};return M&&(O.statsFeatures=M),Vu(O)}return null}function ett(t,e){return Ys(t,{query:{f:"json"},signal:e&&e.signal})}function ttt({relatedInfos:t,layer:e},r){const i={};return t.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new ce("relation-required","A relation is required on a layer to retrieve related records.");throw Che.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new ce("A related table ID is required on a layer to retrieve related records.");throw Che.error(p),p}const l=`${e.url}/${a}`,c=Mhe.get(l),h=c||ett(l);c||Mhe.set(l,h),i[n]=h}),ote(Vu(i),r)}function rtt({graphic:t,relatedInfos:e,layer:r},i){const s={};return e.forEach((n,o)=>{n.layerInfo&&(s[o]=Ket(t,n,r,i))}),Vu(s)}function itt({relatedInfo:t,fieldName:e,fieldInfo:r}){var i,s;if((i=t.relatedFields)==null||i.push(e),r.statisticType){const n=new DCe({statisticType:r.statisticType,onStatisticField:e,outStatisticFieldName:e});(s=t.outStatistics)==null||s.push(n)}}function stt(t,e){if(t!=null){e=e.toLowerCase();for(const r of t)if(r&&r.name.toLowerCase()===e)return r}return null}const Rhe={chartAnimation:!0};let ba=class extends Ke{constructor(e){super(e),this.abilities={...Rhe},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...Rhe,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:r}=this,i=(e+r)%r;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:r}=this,i=r+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{mediaInfos:e,layer:r}=this,i=this.attributes??{},s=this.formattedAttributes??{},n=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return(e==null?void 0:e.map(a=>{const l=a==null?void 0:a.clone();if(!l)return null;if(l.title=ex({attributes:i,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:r,text:l.title}),l.caption=ex({attributes:i,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:r,text:l.caption}),l.altText=ex({attributes:i,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:r,text:l.altText}),l.type==="image"){const{value:c}=l;return this._setImageValue({value:c,formattedAttributes:s,layer:r}),l.value.sourceURL?l:void 0}if(l.type==="pie-chart"||l.type==="line-chart"||l.type==="column-chart"||l.type==="bar-chart"){const{value:c}=l;return this._setChartValue({value:c,chartType:l.type,attributes:i,formattedAttributes:s,layer:r,expressionAttributes:n}),l}return null}).filter(E))??[]}_setImageValue(e){const r=this.fieldInfoMap??new Map,{value:i,formattedAttributes:s,layer:n}=e,{linkURL:o,sourceURL:a}=i;if(a){const l=LQ(a,n);i.sourceURL=$Q({formattedAttributes:s,template:l,fieldInfoMap:r})}if(o){const l=LQ(o,n);i.linkURL=$Q({formattedAttributes:s,template:l,fieldInfoMap:r})}}_setChartValue(e){const{value:r,attributes:i,formattedAttributes:s,chartType:n,layer:o,expressionAttributes:a}=e,{popupTemplate:l,relatedInfos:c}=this,{fields:h,normalizeField:p}=r,A=o;if(r.fields=MZe(h,A),p&&(r.normalizeField=l4(p,A)),!h.some(w=>!!(s[w]!=null||hy(w)&&(c!=null&&c.size))))return;const _=(l==null?void 0:l.fieldInfos)??[];h.forEach(w=>{if(hy(w))return void(r.series=[...r.series,...this._getRelatedChartInfos({fieldInfos:_,fieldName:w,formattedAttributes:s,chartType:n,value:r})]);const T=this._getChartOption({value:r,attributes:i,chartType:n,formattedAttributes:s,expressionAttributes:a,fieldName:w,fieldInfos:_});r.series.push(T)})}_getRelatedChartInfos(e){var _;const{fieldInfos:r,fieldName:i,formattedAttributes:s,chartType:n,value:o}=e,a=[],l=w6(i),c=l&&((_=this.relatedInfos)==null?void 0:_.get(l.layerId.toString()));if(!c)return a;const{relatedFeatures:h,relation:p}=c;if(!p||!h)return a;const{cardinality:A}=p;return h.forEach(w=>{const{attributes:T}=w;T&&Object.keys(T).forEach(C=>{C===l.fieldName&&a.push(this._getChartOption({value:o,attributes:T,formattedAttributes:s,fieldName:i,chartType:n,relatedFieldName:C,hasMultipleRelatedFeatures:(h==null?void 0:h.length)>1,fieldInfos:r}))})}),A==="one-to-many"||A==="many-to-many"?a:[a[0]]}_getTooltip({label:e,value:r,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${r}`}_getChartOption(e){var F;const{value:r,attributes:i,formattedAttributes:s,expressionAttributes:n,fieldName:o,relatedFieldName:a,fieldInfos:l,chartType:c,hasMultipleRelatedFeatures:h}=e,p=this.layer,A=this.fieldInfoMap??new Map,{normalizeField:_,tooltipField:w}=r,T=_?hy(_)?i[w6(_).fieldName]:i[_]:null,C=oie(o)&&n&&n[o]!==void 0?n[o]:a&&i[a]!==void 0?i[a]:i[o]!==void 0?i[o]:s[o],M=new ixe({fieldName:o,value:C===void 0?null:C&&T?C/T:C});if(hy(o)){const G=A.get(o.toLowerCase()),z=w&&A.get(w.toLowerCase()),Z=(G==null?void 0:G.fieldName)??o,J=h&&w?w6(w).fieldName:(z==null?void 0:z.fieldName)??w,te=h&&J?i[J]:s[J]??(G==null?void 0:G.label)??(G==null?void 0:G.fieldName)??a,re=h&&a?i[a]:s[Z];return M.tooltip=this._getTooltip({label:te,value:re,chartType:c}),M}const O=JEe(l,o),$=l4(o,p),L=w&&s[w]!==void 0?s[w]:XEe(O||new fL({fieldName:$}),(F=this.popupTemplate)==null?void 0:F.expressionInfos),k=s[$];return M.tooltip=this._getTooltip({label:L,value:k,chartType:c}),M}};u([d()],ba.prototype,"abilities",void 0),u([Hr("abilities")],ba.prototype,"castAbilities",null),u([d()],ba.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],ba.prototype,"activeMediaInfo",null),u([d()],ba.prototype,"attributes",void 0),u([d()],ba.prototype,"description",void 0),u([d()],ba.prototype,"fieldInfoMap",void 0),u([d()],ba.prototype,"formattedAttributes",void 0),u([d()],ba.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],ba.prototype,"formattedMediaInfos",null),u([d()],ba.prototype,"isAggregate",void 0),u([d()],ba.prototype,"layer",void 0),u([d({readOnly:!0})],ba.prototype,"formattedMediaInfoCount",null),u([d()],ba.prototype,"mediaInfos",void 0),u([d()],ba.prototype,"popupTemplate",void 0),u([d()],ba.prototype,"relatedInfos",void 0),u([d()],ba.prototype,"title",void 0),ba=u([j("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],ba);const rx=ba;var Ohe=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],ntt=[].concat(Ohe.slice(30,39),Ohe.slice(28,30).reverse()),ott=[{name:"default",colors:ntt},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const Phe="en-us",Sie=new Map([["ar",()=>be(()=>import("./ar-bb1fe5ab.js"),["assets/ar-bb1fe5ab.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.a)],["bg-bg",()=>be(()=>import("./bg_BG-184a2bfa.js"),["assets/bg_BG-184a2bfa.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.b)],["bs-ba",()=>be(()=>import("./bs_BA-f32cc344.js"),["assets/bs_BA-f32cc344.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.b)],["ca-es",()=>be(()=>import("./ca_ES-d17ee95b.js"),["assets/ca_ES-d17ee95b.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.c)],["cs-cz",()=>be(()=>import("./cs_CZ-bcd1e782.js"),["assets/cs_CZ-bcd1e782.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.c)],["da-dk",()=>be(()=>import("./da_DK-27b1b06e.js"),["assets/da_DK-27b1b06e.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["de-de",()=>be(()=>import("./de_DE-c0a1d8dd.js"),["assets/de_DE-c0a1d8dd.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["de-ch",()=>be(()=>import("./de_CH-be7b4255.js"),["assets/de_CH-be7b4255.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["el-gr",()=>be(()=>import("./el_GR-05fb9ec0.js"),["assets/el_GR-05fb9ec0.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["en-us",()=>be(()=>import("./en_US-170979d8.js"),["assets/en_US-170979d8.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["en-ca",()=>be(()=>import("./en_CA-170979d8.js"),["assets/en_CA-170979d8.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["es-es",()=>be(()=>import("./es_ES-d0b66640.js"),["assets/es_ES-d0b66640.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["et-ee",()=>be(()=>import("./et_EE-56dd74d3.js"),["assets/et_EE-56dd74d3.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["fi-fi",()=>be(()=>import("./fi_FI-91d58cb9.js"),["assets/fi_FI-91d58cb9.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.f)],["fr-fr",()=>be(()=>import("./fr_FR-a11503e0.js"),["assets/fr_FR-a11503e0.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.f)],["he-il",()=>be(()=>import("./he_IL-90db98c4.js"),["assets/he_IL-90db98c4.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["hr-hr",()=>be(()=>import("./hr_HR-fac8bb29.js"),["assets/hr_HR-fac8bb29.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["hu-hu",()=>be(()=>import("./hu_HU-e8803856.js"),["assets/hu_HU-e8803856.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["id-id",()=>be(()=>import("./id_ID-86e57d06.js"),["assets/id_ID-86e57d06.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.i)],["it-it",()=>be(()=>import("./it_IT-2d4485ba.js"),["assets/it_IT-2d4485ba.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.i)],["ja-jp",()=>be(()=>import("./ja_JP-77c6c16d.js"),["assets/ja_JP-77c6c16d.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.j)],["ko-kr",()=>be(()=>import("./ko_KR-e155b9ab.js"),["assets/ko_KR-e155b9ab.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.k)],["lt-lt",()=>be(()=>import("./lt_LT-fde47ae9.js"),["assets/lt_LT-fde47ae9.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.l)],["lv-lv",()=>be(()=>import("./lv_LV-359be050.js"),["assets/lv_LV-359be050.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.l)],["nb-no",()=>be(()=>import("./nb_NO-30d57c1a.js"),["assets/nb_NO-30d57c1a.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.n)],["nl-nl",()=>be(()=>import("./nl_NL-cb904b48.js"),["assets/nl_NL-cb904b48.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.n)],["pl-pl",()=>be(()=>import("./pl_PL-58c54c9f.js"),["assets/pl_PL-58c54c9f.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["pt-br",()=>be(()=>import("./pt_BR-d2e10248.js"),["assets/pt_BR-d2e10248.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["pt-pt",()=>be(()=>import("./pt_PT-65a41842.js"),["assets/pt_PT-65a41842.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["ro-ro",()=>be(()=>import("./ro_RO-15e90e9f.js"),["assets/ro_RO-15e90e9f.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.r)],["ru-ru",()=>be(()=>import("./ru_RU-a74d21e5.js"),["assets/ru_RU-a74d21e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.r)],["sk-sk",()=>be(()=>import("./sk_SK-a928dbd1.js"),["assets/sk_SK-a928dbd1.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sl-sl",()=>be(()=>import("./sl_SL-1a3c3078.js"),["assets/sl_SL-1a3c3078.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sr-rs",()=>be(()=>import("./sr_RS-0b18b911.js"),["assets/sr_RS-0b18b911.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sv-se",()=>be(()=>import("./sv_SE-ce7e3f84.js"),["assets/sv_SE-ce7e3f84.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["th-th",()=>be(()=>import("./th_TH-1448f333.js"),["assets/th_TH-1448f333.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.t)],["tr-tr",()=>be(()=>import("./tr_TR-dd92f630.js"),["assets/tr_TR-dd92f630.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.t)],["uk-ua",()=>be(()=>import("./uk_UA-fe4434ed.js"),["assets/uk_UA-fe4434ed.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.u)],["vi-vn",()=>be(()=>import("./vi_VN-41938633.js"),["assets/vi_VN-41938633.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.v)],["zh-cn",()=>be(()=>import("./zh_Hans-524a1291.js"),["assets/zh_Hans-524a1291.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)],["zh-hk",()=>be(()=>import("./zh_Hant-0e1f08e5.js"),["assets/zh_Hant-0e1f08e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)],["zh-tw",()=>be(()=>import("./zh_Hant-0e1f08e5.js"),["assets/zh_Hant-0e1f08e5.js","assets/_commonjsHelpers-2f3e7994.js","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)]]);function att(t){const e=t.split("-")[0].toLowerCase();let r=null;for(const i of Sie.keys())if(i.startsWith(e)){r=i;break}return r}function ltt(t){return t?Sie.has(t.toLowerCase())?t.toLowerCase():att(t)||Phe:Phe}let qT=null,NR=null;async function ctt(t=Yc()){if(t=ltt(t),qT&&t===NR)return qT;qT=be(()=>import("./index-a1a574a3.js"),["assets/index-a1a574a3.js","assets/_commonjsHelpers-2f3e7994.js"]).then(e=>e.i),NR=t;try{const[e,r]=await Promise.all([qT,Sie.get(NR)()]);NR===t&&(e.am4core.options.defaultLocale=r.default),e.am4core.options.suppressWarnings=!0,e.am4core.options.autoDispose=!0}catch{return qT=null,NR=null,null}return qT}function utt(t,e="default"){const r=ott.find(i=>i.name===e);return r?r.colors.map(i=>t.color(i)):null}const nu="esri-feature-media",wo={base:nu,mediaContainer:`${nu}__container`,mediaItemContainer:`${nu}__item-container`,mediaItem:`${nu}__item`,mediaItemTitle:`${nu}__item-title`,mediaItemCaption:`${nu}__item-caption`,mediaPrevious:`${nu}__previous`,mediaPreviousIconLTR:`${nu}__previous-icon`,mediaPreviousIconRTL:`${nu}__previous-icon--rtl`,mediaNext:`${nu}__next`,mediaNextIconLTR:`${nu}__next-icon`,mediaNextIconRTL:`${nu}__next-icon--rtl`,mediaChart:`${nu}__chart`,mediaButton:`${nu}__button`,mediaIcon:`${nu}__icon`,iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},jz=.05,Hz=.95,qz=15,sA="color",S_="tooltip",FR="value",Ihe="default-line-value";let oh=class extends pc{constructor(e,r){super(e,r),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.viewModel=new rx,this.messages=null,this._getChartDependencies=async i=>{const s=await ctt(),{destroyed:n,viewModel:o}=this;if(n||!o||!i)return;const{activeMediaInfo:a}=o,l=await this._getRendererColors(s);this._renderChart({chartDiv:i,mediaInfo:a,chartsModule:s,colorMap:l})}}initialize(){this._featureElementInfo=new IU,this.addHandles([xe(()=>{var e,r;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(r=this.viewModel)==null?void 0:r.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),Cr),xe(()=>{var e,r;return[(e=this.viewModel)==null?void 0:e.description,(r=this.viewModel)==null?void 0:r.title]},()=>this._setupFeatureElementInfo(),Cr)])}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return pe("div",{bind:this,class:wo.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?pe("div",{key:"media-element-container",class:wo.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:r}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:s}=this.viewModel,{value:n,refreshInterval:o,altText:a,title:l,type:c}=e,{sourceURL:h,linkURL:p}=n,A=QEe(p??void 0)?"_blank":"_self",_=A==="_blank"?"noreferrer":"",w=o?r:null,T=w?w.timestamp:0,C=w?w.sourceURL:h,M=pe("img",{alt:a||l,key:`media-${c}-${i}-${s}-${T}`,src:C??void 0});return(p?pe("a",{title:l,href:p,rel:_,target:A},M):null)||M}renderChartMediaInfo(e){const{activeMediaInfoIndex:r,formattedMediaInfoCount:i}=this.viewModel;return pe("div",{key:`media-${e.type}-${r}-${i}`,bind:this,class:wo.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const r=e.title?pe("div",{key:"media-title",class:wo.mediaItemTitle,innerHTML:e.title}):null,i=e.caption?pe("div",{key:"media-caption",class:wo.mediaItemCaption,innerHTML:e.caption}):null;return pe("div",{key:"media-container",class:wo.mediaItemContainer},pe("div",{key:"media-item-container",class:wo.mediaItem},this.renderMediaInfoType()),r,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const r=e==="previous",i=r?this.messages.previous:this.messages.next,s=r?this.classes(wo.mediaButton,wo.mediaPrevious):this.classes(wo.mediaButton,wo.mediaNext),n=r?this.classes(wo.mediaIcon,wo.mediaPreviousIconLTR,wo.iconLeftTriangleArrow):this.classes(wo.mediaIcon,wo.mediaNextIconLTR,wo.iconRightTriangleArrow),o=r?this.classes(wo.mediaIcon,wo.mediaPreviousIconRTL,wo.iconRightTriangleArrow):this.classes(wo.mediaIcon,wo.mediaNextIconRTL,wo.iconLeftTriangleArrow),a=r?"media-previous":"media-next",l=r?this._previous:this._next;return pe("button",{type:"button",key:a,title:i,"aria-label":i,tabIndex:0,class:s,bind:this,onclick:l},pe("span",{"aria-hidden":"true",class:n}),pe("span",{"aria-hidden":"true",class:o}))}_setupFeatureElementInfo(){var i;const{description:e,title:r}=this;(i=this._featureElementInfo)==null||i.set({description:e,title:r})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){const{isAggregate:e,layer:r}=this.viewModel;return e&&(r!=null&&r.featureReduction)&&"renderer"in r.featureReduction?r.featureReduction.renderer:r==null?void 0:r.renderer}async _getRendererColors(e){const{am4core:r}=e,i=new Map,s=this._getRenderer(),n="default";if(!s)return i;const o=await EKe(s);return o.delete(n),Array.from(o.values()).every(a=>(a==null?void 0:a.length)===1)&&(i.set(Ihe,r.color({r:50,g:50,b:50,a:1})),Array.from(o.keys()).forEach(a=>{var l;a&&i.set(a,r.color((l=o.get(a))==null?void 0:l[0].toCss(!0)))})),i}_handleMediaKeyup(e){const r=J1(e);r==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),r==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:r}=this.viewModel,{chartsModule:i,chartDiv:s,mediaInfo:n,colorMap:o}=e,{value:a,type:l}=n,{am4core:c}=i,h=utt(c);function p(w){w instanceof c.ColorSet&&h&&(w.list=h)}Jk()&&c.useTheme(i.am4themes_dark);const A=window.matchMedia("(prefers-reduced-motion: reduce)");r.chartAnimation&&!A.matches?c.useTheme(i.am4themes_animated):c.unuseTheme(i.am4themes_animated),c.useTheme(p);const _=l==="pie-chart"?this._createPieChart(e):this._createXYChart(e);s.setAttribute("aria-label",n.altText||n.title),_.data=a.series.map(w=>({[S_]:w.tooltip,[FR]:w.value,[sA]:o.get(w.fieldName)})).filter(w=>l!=="pie-chart"||w.value!=null&&w.value>0)}_customizeChartTooltip(e,r){e&&(e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=r.color("#ffffff"),e.background.fill=r.color({r:0,g:0,b:0,a:.7}))}_createPieChart(e){const{chartDiv:r,chartsModule:i}=e,{am4core:s,am4charts:n}=i,o=s.create(r,n.PieChart);o.rtl=w0(this.container);const a=o.series.push(new n.PieSeries);return a.labels.template.disabled=!0,a.ticks.template.disabled=!0,a.dataFields.value=FR,a.dataFields.category=S_,this._customizeChartTooltip(a.tooltip,s),a.slices.template.propertyFields.fill=sA,a.slices.template.propertyFields.stroke=sA,o}_getMinSeriesValue(e){let r=0;return e.forEach(i=>r=Math.min(i.value,r)),r}_createColumnChart(e,r){const{chartsModule:i,mediaInfo:s}=r,{value:n}=s,{am4core:o,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=S_,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dy=-c.contentHeight});const h=e.yAxes.push(new a.ValueAxis),p=h.renderer.labels.template;h.renderer.minLabelPosition=jz,h.renderer.maxLabelPosition=Hz,h.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(h.tooltip,o),p.wrap=!0;const A=e.series.push(new a.ColumnSeries);A.dataFields.valueY=FR,A.dataFields.categoryX=S_,A.columns.template.propertyFields.fill=sA,A.columns.template.propertyFields.stroke=sA,e.cursor=new a.XYCursor,n.series.length>qz&&(e.scrollbarX=new o.Scrollbar)}_createBarChart(e,r){const{chartsModule:i,mediaInfo:s}=r,{value:n}=s,{am4core:o,am4charts:a}=i,l=e.yAxes.push(new a.CategoryAxis);l.dataFields.category=S_,l.renderer.inversed=!0,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dx=c.contentWidth});const h=e.xAxes.push(new a.ValueAxis),p=h.renderer.labels.template;h.renderer.minLabelPosition=jz,h.renderer.maxLabelPosition=Hz,h.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(h.tooltip,o),p.wrap=!0;const A=e.series.push(new a.ColumnSeries);A.dataFields.valueX=FR,A.dataFields.categoryY=S_,A.columns.template.propertyFields.fill=sA,A.columns.template.propertyFields.stroke=sA,e.cursor=new a.XYCursor,n.series.length>qz&&(e.scrollbarY=new o.Scrollbar)}_createLineChart(e,r){const{chartsModule:i,mediaInfo:s,colorMap:n}=r,{value:o}=s,{am4core:a,am4charts:l}=i,c=e.xAxes.push(new l.CategoryAxis);c.dataFields.category=S_,c.renderer.labels.template.disabled=!0;const h=c.tooltip;this._customizeChartTooltip(h,a),h.events.on("sizechanged",()=>{h.dy=-h.contentHeight});const p=e.yAxes.push(new l.ValueAxis),A=p.renderer.labels.template;p.renderer.minLabelPosition=jz,p.renderer.maxLabelPosition=Hz,p.min=this._getMinSeriesValue(o.series),this._customizeChartTooltip(p.tooltip,a),A.wrap=!0;const _=e.series.push(new l.LineSeries);_.dataFields.categoryX=S_,_.dataFields.valueY=FR,_.strokeWidth=1;const w=n.get(Ihe);w&&(_.stroke=w);const T=_.bullets.push(new l.CircleBullet);T.propertyFields.fill=sA,T.propertyFields.stroke=sA,e.cursor=new l.XYCursor,o.series.length>qz&&(e.scrollbarX=new a.Scrollbar)}_createXYChart(e){const{chartDiv:r,chartsModule:i,mediaInfo:s}=e,{type:n}=s,{am4core:o,am4charts:a}=i,l=o.create(r,a.XYChart);return l.rtl=w0(this.container),n==="column-chart"&&this._createColumnChart(l,e),n==="bar-chart"&&this._createBarChart(l,e),n==="line-chart"&&this._createLineChart(l,e),l}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const r=Date.now();this._refreshIntervalInfo={timestamp:r,sourceURL:e&&this._getImageSource(e,r)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:r,value:i}=e;if(!r)return;const s=6e4*r;this._updateMediaInfoTimestamp(i.sourceURL);const n=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},s);this._refreshTimer=n}_getImageSource(e,r){const i=e.includes("?")?"&":"?",[s,n=""]=e.split("#");return`${s}${i}timestamp=${r}${n?"#":""}${n}`}};u([d()],oh.prototype,"attributes",null),u([d()],oh.prototype,"activeMediaInfoIndex",null),u([d()],oh.prototype,"description",null),u([d()],oh.prototype,"fieldInfoMap",null),u([d()],oh.prototype,"layer",null),u([d()],oh.prototype,"mediaInfos",null),u([d()],oh.prototype,"popupTemplate",null),u([d()],oh.prototype,"relatedInfos",null),u([d()],oh.prototype,"title",null),u([d({type:rx})],oh.prototype,"viewModel",void 0),u([d(),Ll("esri/widgets/Feature/t9n/Feature")],oh.prototype,"messages",void 0),oh=u([j("esri.widgets.Feature.FeatureMedia")],oh);const qCe=oh;var aX;let AP=aX=class extends Qe{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new aX({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],AP.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],AP.prototype,"maxValue",void 0),AP=aX=u([j("esri.renderer.support.AuthoringInfoClassBreakInfo")],AP);var lX;let z1=lX=class extends Qe{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new lX({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:Te(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],z1.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],z1.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],z1.prototype,"label",void 0),u([d({type:[AP],json:{write:!0}})],z1.prototype,"classBreakInfos",void 0),z1=lX=u([j("esri.renderers.support.AuthoringInfoFieldInfo")],z1);var cX;const o5=new Ui({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),a5=new Ui({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),$he={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},Lhe=["high-to-low","above-and-below","centered-on","extremes"],Dhe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],Nhe=["seconds","minutes","hours","days","months","years"];let ah=cX=class extends Qe{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new cX({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:$he,json:{write:!0}})],ah.prototype,"endTime",void 0),u([Hr("endTime")],ah.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],ah.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],ah.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],ah.prototype,"minSliderValue",void 0),u([d({types:$he,json:{write:!0}})],ah.prototype,"startTime",void 0),u([Hr("startTime")],ah.prototype,"castStartTime",null),u([d({type:o5.apiValues,value:null,json:{type:o5.jsonValues,read:o5.read,write:o5.write}})],ah.prototype,"style",null),u([d({type:Dhe,value:null,json:{type:Dhe,origins:{"web-scene":{type:Lhe,write:{writer:(t,e)=>{Lhe.includes(t)&&(e.theme=t)}}}},write:!0}})],ah.prototype,"theme",null),u([d({type:a5.apiValues,json:{type:a5.jsonValues,read:a5.read,write:a5.write}})],ah.prototype,"type",void 0),u([d({type:Nhe,json:{type:Nhe,write:!0}})],ah.prototype,"units",void 0),ah=cX=u([j("esri.renderers.support.AuthoringInfoVisualVariable")],ah);const htt=ah;let x6=class extends Qe{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],x6.prototype,"type",void 0),x6=u([j("esri.rest.support.ColorRamp")],x6);const Eie=x6;var uX;let Zw=uX=class extends Eie{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new uX({fromColor:Te(this.fromColor),toColor:Te(this.toColor),algorithm:this.algorithm})}};u([er({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],Zw.prototype,"algorithm",void 0),u([d({type:Ot,json:{type:[rn],write:!0}})],Zw.prototype,"fromColor",void 0),u([d({type:Ot,json:{type:[rn],write:!0}})],Zw.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],Zw.prototype,"type",void 0),Zw=uX=u([j("esri.rest.support.AlgorithmicColorRamp")],Zw);const Cie=Zw;var hX;let yP=hX=class extends Eie{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new hX({colorRamps:Te(this.colorRamps)})}};u([d({type:[Cie],json:{write:!0}})],yP.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],yP.prototype,"type",void 0),yP=hX=u([j("esri.rest.support.MultipartColorRamp")],yP);const WCe=yP,dtt={key:"type",base:Eie,typeMap:{algorithmic:Cie,multipart:WCe}};function ptt(t){return t&&t.type?t.type==="algorithmic"?Cie.fromJSON(t):t.type==="multipart"?WCe.fromJSON(t):null:null}var dX;const Gb=new Ui({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),l5=new Ui({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Fhe=new Ui({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),khe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],ftt=["high-to-low","above-and-below","above","below","90-10"],mtt=["flow-line","wave-front"],gtt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let xo=dX=class extends Qe{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?ptt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new dX({classificationMethod:this.classificationMethod,colorRamp:Te(this.colorRamp),fadeRatio:Te(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:Te(this.field1),field2:Te(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:Gb.apiValues,value:null,json:{type:Gb.jsonValues,read:Gb.read,write:Gb.write,origins:{"web-document":{default:"manual",type:Gb.jsonValues,read:Gb.read,write:Gb.write}}}})],xo.prototype,"classificationMethod",null),u([d({types:dtt,json:{write:!0}})],xo.prototype,"colorRamp",void 0),u([ft("colorRamp")],xo.prototype,"readColorRamp",null),u([d({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],xo.prototype,"fadeRatio",void 0),u([d({type:[String],value:null,json:{write:!0}})],xo.prototype,"fields",null),u([d({type:z1,value:null,json:{write:!0}})],xo.prototype,"field1",null),u([d({type:z1,value:null,json:{write:!0}})],xo.prototype,"field2",null),u([d({type:mtt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],xo.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],xo.prototype,"focus",null),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],xo.prototype,"isAutoGenerated",void 0),u([d({type:Number,value:null,json:{type:rn,write:!0}})],xo.prototype,"numClasses",null),u([d({type:khe,json:{type:khe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],xo.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],xo.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],xo.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],xo.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],xo.prototype,"standardDeviationInterval",null),u([d({type:l5.apiValues,value:null,json:{type:l5.jsonValues,read:l5.read,write:l5.write,origins:{"web-scene":{type:Fhe.jsonValues,write:{writer:Fhe.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],xo.prototype,"type",null),u([d({type:[htt],json:{write:!0}})],xo.prototype,"visualVariables",void 0),u([d({type:gtt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],xo.prototype,"univariateSymbolStyle",null),u([d({type:ftt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],xo.prototype,"univariateTheme",null),xo=dX=u([j("esri.renderers.support.AuthoringInfo")],xo);const Mie=xo,Wz=new Ui({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let _P=class extends Qe{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const r=new Set;return await this.collectRequiredFields(r,e),Array.from(r).sort()}getSymbol(e,r){}async getSymbolAsync(e,r){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:Mie,json:{write:!0}})],_P.prototype,"authoringInfo",void 0),u([d({type:Wz.apiValues,readOnly:!0,json:{type:Wz.jsonValues,read:!1,write:{writer:Wz.write,ignoreOrigin:!0}}})],_P.prototype,"type",void 0),_P=u([j("esri.renderers.Renderer")],_P);const Jy=_P;function Att(t){var e,r;return((r=(e=t.match(ytt))==null?void 0:e[1])==null?void 0:r.replace(/\\'/g,"'"))??null}const ytt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var pX;let ZC=pX=class extends Qe{constructor(){super(...arguments),this.title=null}clone(){return new pX({title:this.title})}};u([d({type:String,json:{write:!0}})],ZC.prototype,"title",void 0),ZC=pX=u([j("esri.renderers.support.LegendOptions")],ZC);var fX;let T6=fX=class extends ZC{constructor(){super(...arguments),this.showLegend=null}clone(){return new fX({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],T6.prototype,"showLegend",void 0),T6=fX=u([j("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],T6);const YCe=T6,Yz=new Ui({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let zf=class extends Qe{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(we.getLogger(this.declaredClass).error(".field: field must be a string value"),null):oL(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],zf.prototype,"index",void 0),u([d({type:Yz.apiValues,readOnly:!0,json:{read:Yz.read,write:Yz.write}})],zf.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],zf.prototype,"field",void 0),u([Hr("field")],zf.prototype,"castField",null),u([d({type:String,json:{write:!0}})],zf.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],zf.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],zf.prototype,"arcadeRequired",null),u([d({type:YCe,json:{write:!0}})],zf.prototype,"legendOptions",void 0),zf=u([j("esri.renderers.visualVariables.VisualVariable")],zf);const RL=zf;var mX;let Jw=mX=class extends RL{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new mX({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],Jw.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],Jw.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Jw.prototype,"normalizationField",void 0),u([d({type:[gJe],json:{write:!0}})],Jw.prototype,"stops",null),Jw=mX=u([j("esri.renderers.visualVariables.ColorVariable")],Jw);const QCe=Jw;var gX;let y1=gX=class extends Qe{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return U$(e.transparency)}writeOpacity(t,e,r){e[r]=QB(t)}clone(){return new gX({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],y1.prototype,"label",void 0),u([d({type:Number,json:{type:rn,write:{target:"transparency"}}})],y1.prototype,"opacity",void 0),u([ft("opacity",["transparency"])],y1.prototype,"readOpacity",null),u([St("opacity")],y1.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],y1.prototype,"value",void 0),y1=gX=u([j("esri.renderers.visualVariables.support.OpacityStop")],y1);const _tt=y1;var AX;let Kw=AX=class extends RL{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new AX({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],Kw.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],Kw.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Kw.prototype,"normalizationField",void 0),u([d({type:[_tt],json:{write:!0}})],Kw.prototype,"stops",null),Kw=AX=u([j("esri.renderers.visualVariables.OpacityVariable")],Kw);const XCe=Kw;var yX;let PA=yX=class extends RL{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,r,i){if(i&&i.messages){const s=`visualVariables[${this.index}]`;i.messages.push(new ce("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:i}))}}clone(){return new yX({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],PA.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],PA.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],PA.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],PA.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],PA.prototype,"valueExpressionTitle",void 0),u([St("web-scene","valueExpressionTitle")],PA.prototype,"writeValueExpressionTitleWebScene",null),PA=yX=u([j("esri.renderers.visualVariables.RotationVariable")],PA);const ZCe=PA;var _X;let AE=_X=class extends Qe{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new _X({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],AE.prototype,"label",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],AE.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],AE.prototype,"value",void 0),AE=_X=u([j("esri.renderers.visualVariables.support.SizeStop")],AE);const yE=AE;var vX;let S6=vX=class extends YCe{constructor(){super(...arguments),this.customValues=null}clone(){return new vX({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],S6.prototype,"customValues",void 0),S6=vX=u([j("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],S6);const vtt=S6;var _y,il;function bv(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function h4(t){return t!=null&&!isNaN(t)&&isFinite(t)}function JCe(t){return t.valueExpression?_y.Expression:t.field&&typeof t.field=="string"?_y.Field:_y.Unknown}function btt(t,e){const r=e||JCe(t),i=t.valueUnit||"unknown";return r===_y.Unknown?il.Constant:t.stops?il.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?il.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?il.Proportional:il.Additive:il.Identity:il.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(_y||(_y={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(il||(il={}));const Z3={inches:Go(1,"meters","inches"),feet:Go(1,"meters","feet"),"us-feet":Go(1,"meters","us-feet"),yards:Go(1,"meters","yards"),miles:Go(1,"meters","miles"),"nautical-miles":Go(1,"meters","nautical-miles"),millimeters:Go(1,"meters","millimeters"),centimeters:Go(1,"meters","centimeters"),decimeters:Go(1,"meters","decimeters"),meters:Go(1,"meters","meters"),kilometers:Go(1,"meters","kilometers"),"decimal-degrees":1/V7e(1,"meters",gi.radius)},nb=we.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),Bhe=new pl,E6=Math.PI,KCe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function e3e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(w=>w.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void nb.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const w=i.stops;return w&&w[0]&&w[0].color}if(typeof a!="number")if(h){if(N(r)||N(r.arcade))return void nb.error("Use of arcade expressions requires an arcade context");const w={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},T=r.arcade.arcadeUtils,C=T.getViewInfo(w),M=T.createExecContext(n,C);if(!p){const O=T.createSyntaxTree(i.valueExpression);p=T.createFunction(O),i.cache.compiledFunc=p}a=T.executeFunction(p,M)}else o&&(a=o[l]);const A=i.normalizationField,_=o!=null&&A!=null?parseFloat(o[A]):void 0;if(a!=null&&(!A||s||!isNaN(_)&&_!==0)){isNaN(_)||s||(a/=_);const w=Oie(a,c);if(w){const T=w[0],C=w[1],M=T===C?i.stops[T].color:Ot.blendColors(i.stops[T].color,i.stops[C].color,w[2],E(r)?r.color:void 0);return new Ot(M)}}}function t3e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(w=>w.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void nb.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const w=i.stops;return w&&w[0]&&w[0].opacity}if(typeof a!="number")if(h){if(N(r)||N(r.arcade))return void nb.error("Use of arcade expressions requires an arcade context");const w={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},T=r.arcade.arcadeUtils,C=T.getViewInfo(w),M=T.createExecContext(n,C);if(!p){const O=T.createSyntaxTree(i.valueExpression);p=T.createFunction(O),i.cache.compiledFunc=p}a=T.executeFunction(p,M)}else o&&(a=o[l]);const A=i.normalizationField,_=o!=null&&A!=null?parseFloat(o[A]):void 0;if(a!=null&&(!A||s||!isNaN(_)&&_!==0)){isNaN(_)||s||(a/=_);const w=Oie(a,c);if(w){const T=w[0],C=w[1];if(T===C)return i.stops[T].opacity;{const M=i.stops[T].opacity;return M+(i.stops[C].opacity-M)*w[2]}}}}function r3e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(_=>_.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void nb.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=i.field,{hasExpression:h}=i.cache;let p=i.cache.compiledFunc,A=0;if(!c&&!h)return A;if(h){if(N(r)||N(r.arcade))return void nb.error("Use of arcade expressions requires an arcade context");const _={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},w=r.arcade.arcadeUtils,T=w.getViewInfo(_),C=w.createExecContext(a,T);if(!p){const M=w.createSyntaxTree(i.valueExpression);p=w.createFunction(M),i.cache.compiledFunc=p}A=w.executeFunction(p,C)}else l&&(A=l[c]||0);return A=typeof A!="number"||isNaN(A)?null:n+o*A,A}function wtt(t,e,r){const i=typeof e=="number",s=i?null:e,n=s&&s.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=E(r)?r.scale:void 0,p=E(r)?r.view:void 0;o=h==null||p==="3d"?xtt(t):h}else if(!i)switch(t.inputValueType){case _y.Expression:{if(N(r)||N(r.arcade))return void nb.error("Use of arcade expressions requires an arcade context");const h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},p=r.arcade.arcadeUtils,A=p.getViewInfo(h),_=p.createExecContext(s,A);if(!l){const w=p.createSyntaxTree(t.valueExpression);l=p.createFunction(w),t.cache.compiledFunc=l}o=p.executeFunction(l,_);break}case _y.Field:n&&(o=n[t.field]);break;case _y.Unknown:o=null}if(!h4(o))return null;if(i||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return h4(c)&&c!==0?o/c:null}function xtt(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function kU(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void nb.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=s3e(wtt(i,e,r),i,e,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function Bh(t,e,r){return t==null?null:bv(t)?kU(t,e,r):h4(t)?t:null}function i3e(t,e,r){return h4(r)&&t>r?r:h4(e)&&t<e?e:t}function Ttt(t,e,r,i){return t+((Bh(e.minSize,r,i)||e.minDataValue)??0)}function Stt(t,e,r){const i=t.stops;let s=i&&i.length&&i[0].size;return s==null&&(s=t.minSize),Bh(s,e,r)}function Ett(t,e,r,i){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=Bh(e.minSize,r,i),o=Bh(e.maxSize,r,i),a=E(i)?i.shape:void 0;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?E6*(n/2)**2:n*n,h=c+s*((l?E6*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/E6):Math.sqrt(h)}return n+s*(o-n)}function Ctt(t,e,r,i){const s=E(i)?i.shape:void 0,n=t/e.minDataValue,o=Bh(e.minSize,r,i),a=Bh(e.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,i3e(l,o,a)}function Mtt(t,e,r,i,s){var l,c,h;const[n,o,a]=Oie(t,s);if(n===o)return Bh((l=e.stops)==null?void 0:l[n].size,r,i);{const p=Bh((c=e.stops)==null?void 0:c[n].size,r,i);return p+(Bh((h=e.stops)==null?void 0:h[o].size,r,i)-p)*a}}function Rtt(t,e,r,i){const s=(E(i)&&i.resolution?i.resolution:1)*Z3[e.valueUnit],n=Bh(e.minSize,r,i),o=Bh(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/E6)/s:a==="radius"||a==="distance"?2*t/s:t/s,i3e(l,n,o)}function s3e(t,e,r,i,s){switch(e.transformationType){case il.Additive:return Ttt(t,e,r,i);case il.Constant:return Stt(e,r,i);case il.ClampedLinear:return Ett(t,e,r,i);case il.Proportional:return Ctt(t,e,r,i);case il.Stops:return Mtt(t,e,r,i,s);case il.RealWorldSize:return Rtt(t,e,r,i);case il.Identity:return t;case il.Unknown:return null}}function Ott(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const s={scale:e,view:r};let n=Bh(t.minSize,Bhe,s),o=Bh(t.maxSize,Bhe,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function Rie(t,e,r){if(!t.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=e3e(l,e,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=t3e(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=r3e(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=kU(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function Oie(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((s,n)=>t<s?(i=n,!0):(r=n,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function Ptt(t,e,r){const i=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":kU(s,e,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}const Pie=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Ptt,getColor:e3e,getOpacity:t3e,getRotationAngle:r3e,getSize:kU,getSizeForValue:s3e,getSizeFromNumberOrVariable:Bh,getSizeRangeAtScale:Ott,getVisualVariableValues:Rie,viewScaleRE:KCe},Symbol.toStringTag,{value:"Module"}));var bX;const c5=new Ui({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),wX=new Ui({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Uhe(t){if(t!=null)return typeof t=="string"||typeof t=="number"?gs(t):t.type==="size"?bv(t)?t:(delete(t={...t}).type,new Es(t)):void 0}function Vhe(t,e,r){if(typeof t!="object")return t;const i=new Es;return i.read(t,r),i}let Es=bX=class extends RL{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&KCe.test(this.valueExpression)}}set expression(t){we.getLogger(this.declaredClass).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){bv(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),bv(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return JCe(this)}set maxDataValue(t){t&&this.stops&&(we.getLogger(this.declaredClass).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(we.getLogger(this.declaredClass).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return Uhe(t)}readMaxSize(t,e,r){return Vhe(t,e,r)}set minDataValue(t){t&&this.stops&&(we.getLogger(this.declaredClass).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(we.getLogger(this.declaredClass).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return Uhe(t)}readMinSize(t,e,r){return Vhe(t,e,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value):t&&(we.getLogger(this.declaredClass).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return btt(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,r,i){if(t==="$view.scale"){if(i&&i.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;i.messages.push(new ce("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:i}))}}else e[r]=t}readValueUnit(t){return t?wX.read(t):null}clone(){return new bX({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:bv(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:bv(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===il.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===il.Stops){const t=this.stops;if(!t)return this;const e=t.map(i=>i.size).reverse(),r=t.length;for(let i=0;i<r;i++)t[i].size=e[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],Es.prototype,"cache",null),u([d({type:c5.apiValues,json:{type:c5.jsonValues,origins:{"web-map":{read:!1}},read:c5.read,write:c5.write}})],Es.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],Es.prototype,"expression",null),u([d()],Es.prototype,"index",null),u([d({type:String,readOnly:!0})],Es.prototype,"inputValueType",null),u([d({type:vtt,json:{write:!0}})],Es.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],Es.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],Es.prototype,"maxSize",null),u([Hr("maxSize")],Es.prototype,"castMaxSize",null),u([ft("maxSize")],Es.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],Es.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],Es.prototype,"minSize",null),u([Hr("minSize")],Es.prototype,"castMinSize",null),u([ft("minSize")],Es.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],Es.prototype,"normalizationField",void 0),u([d({readOnly:!0})],Es.prototype,"arcadeRequired",null),u([d({type:String})],Es.prototype,"scaleBy",void 0),u([d({type:[yE],value:null,json:{write:!0}})],Es.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],Es.prototype,"target",void 0),u([d({type:String,readOnly:!0})],Es.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],Es.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Es.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],Es.prototype,"valueExpression",void 0),u([ft("valueExpression",["valueExpression","expression"])],Es.prototype,"readValueExpression",null),u([St("web-scene","valueExpression")],Es.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Es.prototype,"valueRepresentation",void 0),u([d({type:wX.apiValues,json:{write:wX.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Es.prototype,"valueUnit",void 0),u([ft("valueUnit")],Es.prototype,"readValueUnit",null),Es=bX=u([j("esri.renderers.visualVariables.SizeVariable")],Es);const BU=Es,Itt={color:QCe,size:BU,opacity:XCe,rotation:ZCe},$tt=new Ui({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),Ltt=/^\[([^\]]+)\]$/i;let C6=class extends Ke{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(r=>!!r))&&e.length){for(const r of e)switch(r.type){case"color":this.colorVariables.push(r);break;case"opacity":this.opacityVariables.push(r);break;case"rotation":this.rotationVariables.push(r);break;case"size":this.sizeVariables.push(r)}this.sizeVariables.length&&this.sizeVariables.some(r=>!!r.target)&&e.sort((r,i)=>{let s=null;return s=r.target===i.target?0:r.target?1:-1,s});for(let r=0;r<e.length;r++)e[r].index=r;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,r,i){const{rotationExpression:s,rotationType:n}=r,o=s&&s.match(Ltt),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=$tt.read(l.type),h=Itt[c];h||(we.getLogger(this.declaredClass).warn(`Unknown variable type: ${c}`),i&&i.messages&&i.messages.push(new Pg("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:i})));const p=new h;return p.read(l,i),p})}writeVariables(e,r){const i=[];for(const s of e){const n=s.toJSON(r);n&&i.push(n)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],C6.prototype,"visualVariables",null),C6=u([j("esri.renderers.visualVariables.VisualVariableFactory")],C6);const Dtt=C6,Ntt={base:RL,key:"type",typeMap:{opacity:XCe,color:QCe,rotation:ZCe,size:BU}},VM=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new Dtt}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,s){return this._vvFactory.readVariables(r,i,s)}writeVisualVariables(r,i,s,n){i[s]=this._vvFactory.writeVariables(r,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const s=this.visualVariables;return s?s.filter(n=>n.type===r&&(typeof i=="string"?n.target===i:i!==!1||!n.target)):[]}async collectVVRequiredFields(r,i){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&kd(r,i,n.field),n.normalizationField&&kd(r,i,n.normalizationField),n.valueExpression&&(Ftt(n.valueExpression,r,i)||await Gu(r,i,n.valueExpression)))}};return u([d({types:[Ntt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([ft("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([St("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([j("esri.renderers.mixins.VisualVariablesMixin")],e),e};function Ftt(t,e,r){const i=Att(t);return!!E(i)&&(kd(e,r,i),!0)}const kR={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function ktt(t,e=kR){var a,l;if(!t)return{symbol:null};const{retainId:r=kR.retainId,ignoreDrivers:i=kR.ignoreDrivers,hasLabelingContext:s=kR.hasLabelingContext,retainCIM:n=kR.retainCIM}=e;let o=null;if(V3(t)||t instanceof wT)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new ce("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=n?t.clone():fv.fromCIMSymbol(t)}else if(t instanceof mf)o=aU.fromSimpleLineSymbol(t);else if(t instanceof Cb)o=fv.fromSimpleMarkerSymbol(t);else if(t instanceof AL)o=fv.fromPictureMarkerSymbol(t);else if(t instanceof Eb)o=e.geometryType&&e.geometryType==="mesh"?lU.fromSimpleFillSymbol(t):yL.fromSimpleFillSymbol(t);else{if(!(t instanceof DM))return{error:new ce("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=s?oU.fromTextSymbol(t):fv.fromTextSymbol(t)}if(r&&o&&o.type!=="cim"&&(o.id=t.id),i&&V3(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}function Kk(t,e,r,i){const s=n3e(t,{},{context:i,isLabelSymbol:!1});E(s)&&(e[r]=s)}function zhe(t,e,r,i){const s=n3e(t,{},{context:i,isLabelSymbol:!0});E(s)&&(e[r]=s)}function Ghe(t){return t instanceof LM||t instanceof wT}function n3e(t,e,r){if(N(t))return null;const{context:i,isLabelSymbol:s}=r,n=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(n==="web-scene"&&!Ghe(t)){const a=ktt(t,{retainCIM:!0,hasLabelingContext:s});return E(a.symbol)?a.symbol.write(e,i):(o==null||o.push(new ce("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!Jwe(i==null?void 0:i.layer))&&Ghe(t)?(o==null||o.push(new ce("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function d8t(t,e){return RHe(t,null,e)}const zM={types:uU,json:{write:{writer:Kk},origins:{"web-scene":{types:jce,write:{writer:Kk},read:{reader:bb({types:jce})}}}}},o3e={types:{base:Hh,key:"type",typeMap:{"simple-fill":px.typeMap["simple-fill"],"picture-fill":px.typeMap["picture-fill"],"polygon-3d":px.typeMap["polygon-3d"]}},json:{write:{writer:Kk},origins:{"web-scene":{type:yL,write:{writer:Kk}}}}},M6={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var xX;let _1=xX=class extends Qe{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new xX({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([d({type:String,json:{write:!0}})],_1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],_1.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],_1.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],_1.prototype,"maxValue",void 0),u([d(zM)],_1.prototype,"symbol",void 0),_1=xX=u([j("esri.renderers.support.ClassBreakInfo")],_1);const e9=_1;var TX;const a3e="log",R6="percent-of-total",O6="field",u5=new Ui({esriNormalizeByLog:a3e,esriNormalizeByPercentOfTotal:R6,esriNormalizeByField:O6}),Btt=Oo(e9);let wa=TX=class extends VM(Jy){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,r){if(!Array.isArray(t))return;let i=e.minValue;return t.map(s=>{const n=new e9;return n.read(s,r),n.minValue==null&&(n.minValue=i),n.maxValue==null&&(n.maxValue=n.minValue),i=n.maxValue,n})}writeClassBreakInfos(t,e,r,i){const s=t.map(n=>n.write({},i));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[r]=s}castField(t){return t==null?t:typeof t=="function"?(we.getLogger(this.declaredClass).error(".field: field must be a string value"),null):oL(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,r=this.normalizationTotal!=null;return e||r?(t=e&&O6||r&&R6||null,e&&r&&we.getLogger(this.declaredClass).warn("warning: both normalizationField and normalizationTotal are set!")):t!==O6&&t!==R6||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,r){let i=null;i=typeof t=="number"?new e9({minValue:t,maxValue:e,symbol:rTe(r)}):Btt(Te(t)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const s=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(t,e){return this.valueExpression&&(N(e)||N(e.arcade))&&we.getLogger(this.declaredClass).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let r=e;this.valueExpression&&(N(e)||N(e.arcade))&&(r={...r,arcade:await $g()});const i=this.getBreakIndex(t,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(t,e){if(this.valueExpression&&(N(e)||N(e.arcade)))return void we.getLogger(this.declaredClass).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(t,e);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(N(e)||N(e.arcade))){const s=await $g(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this.getBreakIndex(t,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((i,s)=>i+s.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new TX({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:Te(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:Te(this.visualVariables),legendOptions:Te(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Gu(t,e,this.valueExpression)];kd(t,e,this.field),kd(t,e,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=gr(e,{}),{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=n.arcadeUtils;if(!a){const h=l.createSyntaxTree(o);a=l.createFunction(h),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(t){const e=this.field,r=t.attributes,i=this.normalizationType;let s=parseFloat(r[e]);if(i){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if(i===a3e)s=Math.log(s)*Math.LOG10E;else if(i!==R6||n==null||isNaN(n)){if(i===O6&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=t&&(e?t<=i[1]:t<i[1]))return r}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let r=1;r<e;r++)if(t[r-1].maxValue!==t[r].minValue)return!1;return!0}};u([d(o3e)],wa.prototype,"backgroundFillSymbol",void 0),u([d({type:[e9]})],wa.prototype,"classBreakInfos",void 0),u([ft("classBreakInfos")],wa.prototype,"readClassBreakInfos",null),u([St("classBreakInfos")],wa.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],wa.prototype,"defaultLabel",void 0),u([d(zM)],wa.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],wa.prototype,"field",void 0),u([Hr("field")],wa.prototype,"castField",null),u([d({type:Boolean})],wa.prototype,"isMaxInclusive",void 0),u([d({type:ZC,json:{write:!0}})],wa.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],wa.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],wa.prototype,"normalizationField",void 0),u([d({type:Number,cast:t=>Dp(t),json:{write:!0}})],wa.prototype,"normalizationTotal",void 0),u([d({type:u5.apiValues,value:null,json:{type:u5.jsonValues,read:u5.read,write:u5.write}})],wa.prototype,"normalizationType",null),u([er({classBreaks:"class-breaks"})],wa.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],wa.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],wa.prototype,"valueExpressionTitle",void 0),wa=TX=u([j("esri.renderers.ClassBreaksRenderer")],wa);const l3e=wa;let Utt=class{constructor(e,r){this._storage=new gie,this._storage.maxSize=e,r&&this._storage.registerRemoveFunc("",r)}put(e,r,i){this._storage.put(e,r,i,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}};const jhe="esri.renderers.support.DictionaryLoader",Vtt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let Iie=class{constructor(e,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new Utt(100),this._dictionaryPromise=null,this.url=e,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(_){if(vo(_))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const _ of this._symbolFields){const w=this.fieldMap[_];if(w&&e.attributes[w]!=null){const T=""+e.attributes[w];s[_]=T}else s[_]=""}const n=i==null?void 0:i(s,r);if(!n||typeof n!="string")return null;const o=ite(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const _ of l)if(_)if(_.includes("po:")){const w=_.substr(3).split("|");if(w.length===3){const T=w[0],C=w[1];let M=w[2];if(C==="DashTemplate")M=M.split(" ").map(O=>Number(O));else if(C==="Color"){const O=new Ot(M).toRgba();M=[O[0],O[1],O[2],255*O[3]]}else M=Number(M);h.push({primitiveName:T,propertyName:C,value:M})}}else if(_.includes("|")){for(const w of _.split("|"))if(this._itemNames.has(w)){c.push(w);break}}else this._itemNames.has(_)&&c.push(_);const p=!E(e.geometry)||!e.geometry.hasZ&&e.geometry.type==="point",A=this._cimPartsToCIMSymbol(c,h,p,r);return this._symbolCache.put(o,A,1),A}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void we.getLogger(jhe).error("no valid URL!");const r=Ys(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:E(e)?e.signal:null}),[{data:i}]=await Promise.all([r,$g()]);if(!i)throw this._dictionaryPromise=null,new ce("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=i.expression,n=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const c=this.config;for(const h in c)o[h]=c[h]}if(n.configuration)for(const c of n.configuration)o.hasOwnProperty(c.name)||(o[c.name]=c.value);const a=[];if(E(e)&&e.fields&&this.fieldMap)for(const c of this._symbolFields){const h=this.fieldMap[c],p=e.fields.filter(A=>A.name===h);p.length>0&&a.push({...p[0],name:c})}const l=UGe(s,E(e)?e.spatialReference:null,a,o).then(c=>{const h={scale:0};return(p,A)=>{if(N(c))return null;const _=c.repurposeFeature({geometry:null,attributes:p});return h.scale=E(A)?A.scale??void 0:void 0,c.evaluate({$feature:_,$view:h})}}).catch(c=>(we.getLogger(jhe).error("Creating dictinoary expression failed:",c),null));return this._dictionaryPromise=l,l}async _cimPartsToCIMSymbol(e,r,i,s){const n=new Array(e.length);for(let l=0;l<e.length;l++)n[l]=this._getSymbolPart(e[l],s);const o=await Promise.all(n),a=this.fieldMap;if(a)for(const l of o)c3e(l,a);return new IM({data:this._combineSymbolParts(o,r,i)})}async _getSymbolPart(e,r){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(n=>n.data);const i=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),s=Ys(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(e,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(e),n}}_combineSymbolParts(e,r,i){if(!e||e.length===0)return null;const s={...e[0]};if(e.length>1){s.symbolLayers=[];for(const n of e){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return i&&(s.callout=Vtt),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:r}}};function c3e(t,e){if(!t)return;const r=t.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const s=r[i];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&ztt(s,e)}}function ztt(t,e){const r=t.markerGraphics;if(r)for(const i of r){if(!i)continue;const s=i.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":c3e(s,e);break;case"CIMTextSymbol":s.fieldMap=e}}}const m8t=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:Iie},Symbol.toStringTag,{value:"Module"}));var SX;let Gf=SX=class extends VM(Jy){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new Iie(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,r,i){i!=null&&i.origin||super.writeVisualVariables(t,e,r,i)}clone(){return new SX({config:Te(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:Te(this.fieldMap),url:Te(this.url),visualVariables:Te(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Gu(t,e,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];e.has(i)&&t.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:Iie})],Gf.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Gf.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],Gf.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Gf.prototype,"scaleExpression",void 0),u([St("scaleExpression")],Gf.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],Gf.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],Gf.prototype,"url",void 0),u([St("visualVariables")],Gf.prototype,"writeVisualVariables",null),Gf=SX=u([j("esri.renderers.DictionaryRenderer")],Gf);const Gtt=Gf;var EX;let IA=EX=class extends Qe{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(we.getLogger(this.declaredClass).error(".field: field must be a string value"),null):oL(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new EX({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:Ot,json:{type:[Number],write:!0}})],IA.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],IA.prototype,"field",void 0),u([Hr("field")],IA.prototype,"castField",null),u([d({type:String,json:{write:!0}})],IA.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],IA.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],IA.prototype,"valueExpressionTitle",void 0),IA=EX=u([j("esri.renderers.support.AttributeColorInfo")],IA);const u3e=IA;var CX;let P6=CX=class extends Qe{constructor(){super(...arguments),this.unit=null}clone(){return new CX({unit:this.unit})}};u([d({type:String,json:{write:!0}})],P6.prototype,"unit",void 0),P6=CX=u([j("esri.renderers.support.DotDensityLegendOptions")],P6);const jtt=P6;var MX;let lh=MX=class extends VM(Jy){constructor(t){super(t),this.attributes=null,this.backgroundColor=new Ot([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new mf,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new Eb({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,r)=>e+r.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new MX({attributes:Te(this.attributes),backgroundColor:Te(this.backgroundColor),dotBlendingEnabled:Te(this.dotBlendingEnabled),dotShape:Te(this.dotShape),dotSize:Te(this.dotSize),dotValue:Te(this.dotValue),legendOptions:Te(this.legendOptions),outline:Te(this.outline),referenceScale:Te(this.referenceScale),visualVariables:Te(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(r=>r.field||r.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const r of this.attributes??[])r.valueExpression&&await Gu(t,e,r.valueExpression),r.field&&t.add(r.field)}};u([d({type:[u3e],json:{write:!0}})],lh.prototype,"attributes",void 0),u([d({type:Ot,json:{write:!0}})],lh.prototype,"backgroundColor",void 0),u([d({type:Boolean,json:{write:!0}})],lh.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],lh.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0}})],lh.prototype,"dotSize",void 0),u([d({type:jtt,json:{write:!0}})],lh.prototype,"legendOptions",void 0),u([d({type:mf,json:{default:null,write:!0}})],lh.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],lh.prototype,"dotValue",void 0),u([d({type:Number,json:{write:!0}})],lh.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],lh.prototype,"seed",void 0),u([er({dotDensity:"dot-density"})],lh.prototype,"type",void 0),lh=MX=u([j("esri.renderers.DotDensityRenderer")],lh);const Htt=lh;let _E=class extends Fn(Qe){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],_E.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],_E.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],_E.prototype,"title",void 0),_E=u([j("esri.renderers.support.HeatmapLegendOptions")],_E);const $ie=2.4;function qtt(t){return of(t*$ie)}function Wtt(t){return ll(t)/$ie}function Ytt(t,e,r,i){let{color:s,ratio:n}=e,{color:o,ratio:a}=r;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=ze((i-n)/(a-n),0,1);YB(t,s.toArray(),o.toArray(),l)}function A8t(t){const r=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return r;let i=t[0],s=t[0],n=1;const o=Zr();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)i=s,s=t[n++];Ytt(o,i,s,l),r.set(o,4*a)}return r}function y8t(t,e,r,i){const{radius:s,fieldOffset:n,field:o}=e,a=Math.round(ll(s)),l=new Float64Array(r*i);let c,h=Number.NEGATIVE_INFINITY;const p=Xtt(o,n),A=new Set;for(const _ of t){const w=_.getCursor();for(;w.next();){const T=w.getObjectId();if(A.has(T))continue;A.add(T);const C=w.readLegacyPointGeometry(),M=128;if(C.x<-M||C.x>=r+M||C.y<-M||C.y>i+M)continue;const O=+p(w),$=Math.max(0,Math.round(C.x)-a),L=Math.max(0,Math.round(C.y)-a),k=Math.min(i,Math.round(C.y)+a),F=Math.min(r,Math.round(C.x)+a);for(let G=L;G<k;G++)for(let z=$;z<F;z++){const Z=G*r+z,J=Qtt(C.x-z,C.y-G,a);c=l[Z]+=J*O,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function Qtt(t,e,r){const i=Math.sqrt(t**2+e**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function _8t(t,e){return typeof t=="function"?t:t?typeof e=="string"?r=>-1*+r[t]:r=>+r[t]+e:()=>1}function Xtt(t,e){return t!=null?typeof e=="string"?r=>-1*+r.readAttribute(t):r=>+r.readAttribute(t)+e:r=>1}var RX;const h3e="esri.renderers.HeatmapRenderer",Ztt=we.getLogger(h3e);function Hhe(t){if(t!=null){const{maxDensity:e,minDensity:r,radius:i}=t;if(e!=null||r!=null||i!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let Ya=RX=class extends Jy{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new FI({ratio:0,color:new Ot("rgba(255, 140, 0, 0)")}),new FI({ratio:.75,color:new Ot("rgba(255, 140, 0, 1)")}),new FI({ratio:.9,color:new Ot("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return Hhe(t)}get blurRadius(){return Wtt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",qtt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/($ie**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||Zc(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,EM(()=>{nW(Ztt,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=Hhe(t),super.read(t,e)}getSymbol(){return new Cb}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await kd(t,e,r),i&&typeof i=="string"&&await Gu(t,e,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new RX({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:Te(this.colorStops),field:this.field,legendOptions:Te(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:Mie,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ya.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ya.prototype,"blurRadius",null),u([d({type:[FI],json:{write:!0}})],Ya.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],Ya.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],Ya.prototype,"fieldOffset",void 0),u([d({type:_E,json:{write:!0}})],Ya.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],Ya.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ya.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],Ya.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ya.prototype,"minPixelIntensity",null),u([d({type:Number,cast:gs,json:{write:!0}})],Ya.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],Ya.prototype,"referenceScale",void 0),u([er({heatmap:"heatmap"})],Ya.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Ya.prototype,"valueExpression",void 0),u([d({type:String})],Ya.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],Ya.prototype,"_pixelIntensityToDensity",null),Ya=RX=u([j(h3e)],Ya);const d3e=Ya;let D2=class extends Fn(Qe){constructor(){super(...arguments),this.color=new Ot([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:Ot,json:{write:!0}})],D2.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],D2.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],D2.prototype,"threshold",void 0),D2=u([j("esri.renderers.support.OthersCategory")],D2);let I6=class extends Fn(Qe){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],I6.prototype,"title",void 0),I6=u([j("esri.renderers.support.PieChartLegendOptions")],I6);let ad=class extends VM(Fn(Jy)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Ot([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new D2,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new Cb({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(E)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,r)=>e+r.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,r)=>e+JSON.stringify(r),"")}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r);for(const i of this.attributes)i.valueExpression&&await Gu(e,r,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[u3e],json:{write:!0}})],ad.prototype,"attributes",void 0),u([d({type:Eb,json:{default:null,write:!0}})],ad.prototype,"backgroundFillSymbol",void 0),u([d({type:Ot,json:{write:!0}})],ad.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],ad.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],ad.prototype,"holePercentage",void 0),u([d({type:D2,json:{write:!0}})],ad.prototype,"othersCategory",void 0),u([d({type:I6,json:{write:!0}})],ad.prototype,"legendOptions",void 0),u([d({type:mf,json:{default:null,write:!0}})],ad.prototype,"outline",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],ad.prototype,"size",void 0),u([er({pieChart:"pie-chart"})],ad.prototype,"type",void 0),ad=u([j("esri.renderers.PieChartRenderer")],ad);const Jtt=ad;var OX;let e2=OX=class extends VM(Jy){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new OX({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:Te(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],e2.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],e2.prototype,"label",void 0),u([d(zM)],e2.prototype,"symbol",void 0),u([er({simple:"simple"})],e2.prototype,"type",void 0),e2=OX=u([j("esri.renderers.SimpleRenderer")],e2);const J3=e2,Ktt=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function PX(t){return t instanceof Ke}function qhe(t){return t instanceof or?Object.keys(t.items):PX(t)?Zc(t).keys():t?Object.keys(t):[]}function h5(t,e){return t instanceof or?t.items[e]:t[e]}function ert(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function UI(t){return t?t.declaredClass:null}function p3e(t,e){const r=t.diff;if(r&&typeof r=="function")return r(t,e);const i=qhe(t),s=qhe(e);if(i.length===0&&s.length===0)return;if(!i.length||!s.length||ert(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(p=>!i.includes(p)),o=i.filter(p=>!s.includes(p)),a=i.filter(p=>s.includes(p)&&h5(t,p)!==h5(e,p)).concat(n,o).sort(),l=UI(t);if(l&&Ktt.includes(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=PX(t)&&PX(e);for(const p of a){const A=h5(t,p),_=h5(e,p);let w;if((h||typeof A!="function"&&typeof _!="function")&&A!==_&&(A!=null||_!=null)){if(r&&r[p]&&typeof r[p]=="function")w=r[p](A,_);else if(A instanceof Date&&_ instanceof Date){if(A.getTime()===_.getTime())continue;w={type:"complete",oldValue:A,newValue:_}}else w=typeof A=="object"&&typeof _=="object"&&UI(A)===UI(_)?p3e(A,_):{type:"complete",oldValue:A,newValue:_};E(w)&&(E(c)?c.diff[p]=w:c={type:"partial",diff:{[p]:w}})}}return c}function trt(t,e){if(N(t))return!1;const r=e.split(".");let i=t;for(const s of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const n=i.diff[s];if(!n)return!1;i=n}}return!0}function x8t(t,e){for(const r of e)if(trt(t,r))return!0;return!1}function rrt(t,e){if(!(typeof t=="function"||typeof e=="function"||N(t)&&N(e)))return N(t)||N(e)||typeof t=="object"&&typeof e=="object"&&UI(t)!==UI(e)?{type:"complete",oldValue:t,newValue:e}:p3e(t,e)}function d5(t){if(N(t))return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const r of e.added)if(!d5(r))return!1;for(const r of e.removed)if(!d5(r))return!1;for(const r of e.changed)if(!d5(r))return!1;return!0}case"partial":for(const e in t.diff)if(!d5(t.diff[e]))return!1;return!0}}let vE=class extends Fn(Qe){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([d(M6)],vE.prototype,"value",void 0),u([d(M6)],vE.prototype,"value2",void 0),u([d(M6)],vE.prototype,"value3",void 0),vE=u([j("esri.renderers.support.UniqueValue")],vE);const JC=vE;let v1=class extends Fn(Qe){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const r=typeof(e=Array.isArray(e)?e:[e])[0];return r==="string"||r==="number"?e.map(i=>new JC({value:i})):r==="object"?e[0]instanceof JC?e:e.map(i=>new JC(i)):null}};u([d({type:String,json:{write:!0}})],v1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],v1.prototype,"label",void 0),u([d(zM)],v1.prototype,"symbol",void 0),u([d({type:[JC],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new JC({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const r=[];for(const i of t){const s=[i.value,i.value2,i.value3].filter(E).map(n=>n.toString());r.push(s)}e.values=r}}}})],v1.prototype,"values",void 0),u([Hr("values")],v1.prototype,"castValues",null),v1=u([j("esri.renderers.support.UniqueValueClass")],v1);const f3e=v1;let vP=class extends Fn(Qe){constructor(e){super(e),this.heading=null,this.classes=null}};u([d({type:String,json:{write:!0}})],vP.prototype,"heading",void 0),u([d({type:[f3e],json:{write:!0}})],vP.prototype,"classes",void 0),vP=u([j("esri.renderers.support.UniqueValueGroup")],vP);const IX=vP;var $X;let t2=$X=class extends Qe{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new $X({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${t}`}};u([d({type:String,json:{write:!0}})],t2.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],t2.prototype,"label",void 0),u([d(zM)],t2.prototype,"symbol",void 0),u([d(M6)],t2.prototype,"value",void 0),t2=$X=u([j("esri.renderers.support.UniqueValueInfo")],t2);const VI=t2,irt=()=>!!Le("enable-feature:force-wosr"),C8t=()=>!!Le("enable-feature:direct-3d-object-feature-layer-display"),M8t=()=>!!Le("enable-feature:SceneLayer-editing");let Qz={};async function srt(t,e){try{return{data:(await lrt(t,e)).data,baseUrl:w7e(t),styleUrl:t}}catch(r){return Sh(r),null}}function nrt(t,e,r){const i=E(e.portal)?e.portal:zu.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${t}`;return Qz[n]||(Qz[n]=ort(t,i,r).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),Qz[n]}function ort(t,e,r){return e.load(r).then(()=>{const i=new sy({disableExtraQuery:!0,query:`owner:${Whe} AND type:${Yhe} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{var o;let s=null;const n=t.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===Yhe&&a.owner===Whe){s=a;break}}if(!s)throw new ce("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(r)})}function art(t,e,r){return t&&E(t.styleUrl)?srt(t.styleUrl,r):t&&E(t.styleName)?nrt(t.styleName,e,r):Promise.reject(new ce("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function R8t(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function O8t(t,e){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!irt()){for(const r of t.formatInfos)if(r.type==="gltf")return r.href}return t.webRef}function lrt(t,e){const r={responseType:"json",query:{f:"json"},...e};return Ys(O0(t),r)}const Whe="esri_en",Yhe="Style",P8t="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var bP;const m3e="esri.renderers.UniqueValueRenderer",E_=we.getLogger(m3e),Qhe="uvInfos-watcher",Xhe="uvGroups-watcher",crt=",",urt=Oo(VI);function hrt(t){const{field1:e,field2:r,field3:i,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!r);return[{classes:(n??[]).map(l=>{var M;const{symbol:c,label:h,value:p,description:A}=l,[_,w,T]=a?((M=p==null?void 0:p.toString())==null?void 0:M.split(s||""))||[]:[p],C=[];return(e||o)&&C.push(_),r&&C.push(w),i&&C.push(T),{symbol:c,label:h,values:[C],description:A}})}]}let ro=bP=class extends VM(Jy){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,r){if(!e&&!r)return;if(!e||!r)return{type:"complete",oldValue:e,newValue:r};let i=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<r.length;n++){const o=e.find(a=>a.value===r[n].value);o?rrt(o,r[n])?(s.changed.push({type:"complete",oldValue:o,newValue:r[n]}),i=!0):s.unchanged.push({oldValue:o,newValue:r[n]}):(s.added.push(r[n]),i=!0)}for(let n=0;n<e.length;n++)r.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),i=!0);return i?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:oL(t)}writeField(t,e,r,i){typeof t=="string"?e[r]=t:i&&i.messages?i.messages.push(new ce("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):E_.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,r){return r.portal||zu.getDefault()}readStyleOrigin(t,e,r){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const i=$M(e.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(t,e,r,i){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=Gx(t.styleUrl,i))}set uniqueValueGroups(t){this.styleOrigin?E_.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?E_.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var i;if(this.styleOrigin)return void E_.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof t=="object"?urt(t):new VI({value:t,symbol:rTe(e)}),(i=this.uniqueValueInfos)==null||i.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void E_.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e){for(let r=0;r<e.length;r++)if(e[r].value===t+""){delete this._valueInfoMap[t],e.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let r=e;return this.valueExpression&&(N(e)||N(e.arcade))&&(r={...r,arcade:await $g()}),this._getUniqueValueInfo(t,r)}getSymbol(t,e){if(this.valueExpression&&(N(e)||N(e.arcade)))return void E_.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(t,e);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(N(r)||N(r.arcade))){const s=await $g(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this._getUniqueValueInfo(t,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var i;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=(i=this.uniqueValueInfos)==null?void 0:i.reduce((s,n)=>s+n.getMeshHash(),"");return`${t}.${e}.${r}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new bP({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:Te(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:Te(this.visualVariables),legendOptions:Te(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:Te(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=Te(this.uniqueValueInfos),r=Te(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(Te(this.styleOrigin))),Object.freeze(e),Object.freeze(r)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",r),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Gu(t,e,this.valueExpression)];kd(t,e,this.field),kd(t,e,this.field2),kd(t,e,this.field3),await Promise.all(r)}populateFromStyle(){return art(this.styleOrigin,{portal:this.portal}).then(t=>{var r;const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(i=>{const s=new wT({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==t.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const n=new VI({value:i.name,symbol:s});e.push(n),this._valueInfoMap[i.name]=n}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((r=this.uniqueValueInfos)!=null&&r.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",crt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Qhe);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const r of t)e.push(xe(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(i,s)=>{i!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,Qhe)}}_watchUniqueValueGroups(){this.removeHandles(Xhe);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const r of t){e.push(xe(()=>({classes:r.classes}),(i,s)=>{i!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const i of r.classes??[])e.push(xe(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,Xhe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:r,field3:i,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!r);for(const l of n)for(const c of l.classes??[]){const{symbol:h,label:p,values:A,description:_}=c;for(const w of A??[]){const{value:T,value2:C,value3:M}=w,O=[T];r&&O.push(C),i&&O.push(M);const $=a?O.join(s||""):O[0];t.push(new VI({symbol:h,label:p,value:$,description:_}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:r,valueExpression:i,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!i||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!r),a=n.map(c=>{var M;const{symbol:h,label:p,value:A,description:_}=c,[w,T,C]=o?((M=A==null?void 0:A.toString())==null?void 0:M.split(s||""))||[]:[A];return new f3e({symbol:h,label:p,description:_,values:[new JC({value:w,value2:T,value3:C})]})}),l=[new IX({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=gr(e,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(t,a.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(t){const e=this.field,r=t.attributes;let i;if(typeof e!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(r[e]),s&&o.push(r[s]),n&&o.push(r[n]),i=o.join(this.fieldDelimiter||"")}else typeof e=="function"?i=e(t):e&&(i=r[e]);return this._valueInfoMap[i+""]}static fromPortalStyle(t,e){const r=new bP(e&&e.properties);r._set("styleOrigin",Object.freeze({styleName:t})),r._set("portal",e&&e.portal||zu.getDefault());const i=r.populateFromStyle();return i.catch(s=>{E_.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),i}static fromStyleUrl(t,e){const r=new bP(e&&e.properties);r._set("styleOrigin",Object.freeze({styleUrl:t}));const i=r.populateFromStyle();return i.catch(s=>{E_.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),i}};u([d({readOnly:!0})],ro.prototype,"_cache",null),u([er({uniqueValue:"unique-value"})],ro.prototype,"type",void 0),u([d(o3e)],ro.prototype,"backgroundFillSymbol",void 0),u([d({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],ro.prototype,"field",null),u([Hr("field")],ro.prototype,"castField",null),u([St("field")],ro.prototype,"writeField",null),u([d({type:String,value:null,json:{write:!0}})],ro.prototype,"field2",null),u([d({type:String,value:null,json:{write:!0}})],ro.prototype,"field3",null),u([d({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],ro.prototype,"orderByClassesEnabled",void 0),u([d({type:String,value:null,json:{write:!0}})],ro.prototype,"valueExpression",null),u([d({type:String,json:{write:!0}})],ro.prototype,"valueExpressionTitle",void 0),u([d({type:ZC,json:{write:!0}})],ro.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],ro.prototype,"defaultLabel",void 0),u([d(dbe({...zM},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],ro.prototype,"defaultSymbol",null),u([d({type:String,value:null,json:{write:!0}})],ro.prototype,"fieldDelimiter",null),u([d({type:zu,readOnly:!0})],ro.prototype,"portal",void 0),u([ft("portal",["styleName"])],ro.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],ro.prototype,"styleOrigin",void 0),u([ft("styleOrigin",["styleName","styleUrl"])],ro.prototype,"readStyleOrigin",null),u([St("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],ro.prototype,"writeStyleOrigin",null),u([d({type:[IX],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,r)=>(e.uniqueValueGroups||hrt(e)).map(i=>IX.fromJSON(i,r))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ro.prototype,"uniqueValueGroups",null),u([d({type:[VI],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ro.prototype,"uniqueValueInfos",null),ro=bP=u([j(m3e)],ro);const OL=ro,UU={key:"type",base:Jy,typeMap:{heatmap:d3e,simple:J3,"unique-value":OL,"class-breaks":l3e,"dot-density":Htt,dictionary:Gtt,"pie-chart":Jtt},errorContext:"renderer"},drt={key:"type",base:Jy,typeMap:{simple:J3,"unique-value":OL,"class-breaks":l3e,heatmap:d3e},errorContext:"renderer"},prt=bb({types:UU});function t9(t,e,r){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new Pg("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:r})),null):prt(t,e,r):null}let frt=class g3e{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(iW),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const r=new g3e,i=this._originStores[qi.DEFAULTS];i&&i.forEach((s,n)=>{r.set(n,Te(s),qi.DEFAULTS)});for(let s=qi.SERVICE;s<iW;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||r.set(a,Te(o),s)})}return r}get(e,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(e):void 0}keys(e){const r=e==null?this._values:this._originStores[e];return r?[...r.keys()]:[]}set(e,r,i=qi.USER){let s=this._originStores[i];if(s||(s=new Map,this._originStores[i]=s),s.set(e,r),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const n=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,i),n!==r}return!1}delete(e,r=qi.USER){const i=this._originStores[r];if(!i)return;const s=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===r){this._values.delete(e);for(let n=r-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(e)}revert(e,r){for(;r>0&&!this.has(e,r);)--r;const i=this._originStores[r],s=i&&i.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,r),n!==s}originOf(e){return this._propertyOriginMap.get(e)||qi.DEFAULTS}forEach(e){this._values.forEach(e)}};const A3e=t=>{let e=class extends t{constructor(...r){super(...r);const i=Zc(this),s=i.store,n=new frt;i.store=n,nwe(i,s,n)}read(r,i){awe(this,r,i)}getAtOrigin(r,i){const s=Xz(this),n=uv(i);if(typeof r=="string")return s.get(r,n);const o={};return r.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(r){return sk(this.originIdOf(r))}originIdOf(r){return Xz(this).originOf(r)}revert(r,i){const s=Xz(this),n=uv(i),o=Zc(this);let a;a=typeof r=="string"?r==="*"?s.keys(n):[r]:r,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=u([j("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function Xz(t){return Zc(t).store}let Zhe=class extends A3e(Ke){};Zhe=u([j("esri.core.ReadOnlyMultiOriginJSONSupport")],Zhe);const mrt=t=>{let e=class extends t{constructor(...r){super(...r)}clear(r,i="user"){return Zz(this).delete(r,uv(i))}write(r={},i){return cwe(this,r=r||{},i),r}setAtOrigin(r,i,s){Zc(this).setAtOrigin(r,i,uv(s))}removeOrigin(r){const i=Zz(this),s=uv(r),n=i.keys(s);for(const o of n)i.originOf(o)===s&&i.set(o,i.get(o,s),qi.USER)}updateOrigin(r,i){const s=Zz(this),n=uv(i),o=this.get(r);for(let a=n+1;a<iW;++a)s.delete(r,a);s.set(r,o,n)}toJSON(r){return this.write({},r)}};return e=u([j("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function Zz(t){return Zc(t).store}const y3e=t=>{let e=class extends mrt(A3e(t)){constructor(...r){super(...r)}};return e=u([j("esri.core.MultiOriginJSONSupport")],e),e};let Jhe=class extends y3e(Ke){};Jhe=u([j("esri.core.MultiOriginJSONSupport")],Jhe);async function grt(t,e){const{WhereClause:r}=await be(()=>import("./WhereClause-dd0f9833.js").then(i=>i.W),["assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js"]);return r.create(t,e)}function Art(t,e){return E(t)?E(e)?`(${t}) AND (${e})`:t:e}var LX;let r2=LX=class extends Qe{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new LX({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],r2.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],r2.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],r2.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],r2.prototype,"title",void 0),r2=LX=u([j("esri.form.ExpressionInfo")],r2);const yrt=r2;let i2=class extends Qe{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],i2.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],i2.prototype,"label",void 0),u([d()],i2.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],i2.prototype,"visibilityExpression",void 0),i2=u([j("esri.form.elements.Element")],i2);const K3=i2;var DX;let $6=DX=class extends Qe{constructor(t){super(t),this.type=null}clone(){return new DX({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],$6.prototype,"type",void 0),$6=DX=u([j("esri.form.elements.inputs.AttachmentInput")],$6);const _rt=$6;var NX;let s2=NX=class extends K3{constructor(t){super(t),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new NX({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],s2.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],s2.prototype,"editable",void 0),u([d({type:_rt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],s2.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],s2.prototype,"type",void 0),s2=NX=u([j("esri.form.elements.AttachmentElement")],s2);const Khe=s2;let L6=class extends Qe{constructor(e){super(e),this.type=null}};u([d()],L6.prototype,"type",void 0),L6=u([j("esri.form.elements.inputs.Input")],L6);const GM=L6;let wP=class extends GM{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],wP.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],wP.prototype,"minLength",void 0),wP=u([j("esri.form.elements.inputs.TextInput")],wP);const Lie=wP;var FX;let D6=FX=class extends Lie{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new FX({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],D6.prototype,"type",void 0),D6=FX=u([j("esri.form.elements.inputs.BarcodeScannerInput")],D6);const vrt=D6;var kX;let bE=kX=class extends GM{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new kX({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],bE.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],bE.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],bE.prototype,"type",void 0),bE=kX=u([j("esri.form.elements.inputs.ComboBoxInput")],bE);const brt=bE;var BX;function ede(t){return t!=null?new Date(t):null}function tde(t){return t?t.getTime():null}let jf=BX=class extends GM{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return ede(e.max)}writeMax(t,e){e.max=tde(t)}readMin(t,e){return ede(e.min)}writeMin(t,e){e.min=tde(t)}clone(){return new BX({includeTime:this.includeTime,max:this.max,min:this.min})}};u([d({type:Boolean,json:{write:!0}})],jf.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],jf.prototype,"max",void 0),u([ft("max")],jf.prototype,"readMax",null),u([St("max")],jf.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],jf.prototype,"min",void 0),u([ft("min")],jf.prototype,"readMin",null),u([St("min")],jf.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],jf.prototype,"type",void 0),jf=BX=u([j("esri.form.elements.inputs.DateTimePickerInput")],jf);const wrt=jf;var UX;let wE=UX=class extends GM{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new UX({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],wE.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],wE.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],wE.prototype,"type",void 0),wE=UX=u([j("esri.form.elements.inputs.RadioButtonsInput")],wE);const xrt=wE;var VX;let xE=VX=class extends GM{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new VX({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],xE.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],xE.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],xE.prototype,"type",void 0),xE=VX=u([j("esri.form.elements.inputs.SwitchInput")],xE);const Trt=xE;var zX;let N6=zX=class extends Lie{constructor(t){super(t),this.type="text-area"}clone(){return new zX({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],N6.prototype,"type",void 0),N6=zX=u([j("esri.form.elements.inputs.TextAreaInput")],N6);const Srt=N6;var GX;let F6=GX=class extends Lie{constructor(t){super(t),this.type="text-box"}clone(){return new GX({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],F6.prototype,"type",void 0),F6=GX=u([j("esri.form.elements.inputs.TextBoxInput")],F6);const Ert=F6,Crt={base:GM,key:"type",typeMap:{"barcode-scanner":vrt,"combo-box":brt,"datetime-picker":wrt,"radio-buttons":xrt,switch:Trt,"text-area":Srt,"text-box":Ert}};var jX;const _3e="esri.form.elements.FieldElement",rde=we.getLogger(_3e);let yp=jX=class extends K3{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return nW(rde,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){nW(rde,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new jX({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:SCe,json:{read:{reader:Aie},write:!0}})],yp.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],yp.prototype,"editable",null),u([d({type:String,json:{write:!0}})],yp.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],yp.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],yp.prototype,"hint",void 0),u([d({types:Crt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],yp.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],yp.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],yp.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],yp.prototype,"valueExpression",void 0),yp=jX=u([j(_3e)],yp);const ide=yp;var HX;let $A=HX=class extends K3{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new HX({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:Te(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],$A.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],$A.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],$A.prototype,"editable",void 0),u([d({type:[ure],json:{write:!0}})],$A.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],$A.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],$A.prototype,"type",void 0),$A=HX=u([j("esri.form.elements.RelationshipElement")],$A);const sde=$A;function v3e(t){return{typesWithGroup:{base:K3,key:"type",typeMap:{attachment:Khe,field:ide,group:t,relationship:sde}},typesWithoutGroup:{base:K3,key:"type",typeMap:{attachment:Khe,field:ide,relationship:sde}}}}function b3e(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>i[s.type]).map(s=>i[s.type].fromJSON(s))}function w3e(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>i[s.type]).map(s=>s.toJSON())}function x3e(t,e,r=!0){return t?t.map(i=>k0(r?e.typesWithGroup:e.typesWithoutGroup,i)):null}var qX;let Jm=qX=class extends K3{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return x3e(t,Jz,!1)}readElements(t,e){return b3e(e.formElements,Jz,!1)}writeElements(t,e){e.formElements=w3e(t,Jz,!1)}clone(){return new qX({description:this.description,elements:Te(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],Jm.prototype,"elements",void 0),u([Hr("elements")],Jm.prototype,"castElements",null),u([ft("elements",["formElements"])],Jm.prototype,"readElements",null),u([St("elements")],Jm.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],Jm.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],Jm.prototype,"type",void 0),Jm=qX=u([j("esri.form.elements.GroupElement")],Jm);const Jz=v3e(Jm),Mrt=Jm;var WX;const Kz=v3e(Mrt);let Hf=WX=class extends Qe{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return x3e(t,Kz)}readElements(t,e){return b3e(e.formElements,Kz)}writeElements(t,e){e.formElements=w3e(t,Kz)}clone(){return new WX({description:this.description,expressionInfos:Te(this.expressionInfos),elements:Te(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([d({type:String,json:{write:!0}})],Hf.prototype,"description",void 0),u([d({json:{write:!0}})],Hf.prototype,"elements",void 0),u([Hr("elements")],Hf.prototype,"castElements",null),u([ft("elements",["formElements"])],Hf.prototype,"readElements",null),u([St("elements")],Hf.prototype,"writeElements",null),u([d({type:[yrt],json:{write:!0}})],Hf.prototype,"expressionInfos",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Hf.prototype,"preserveFieldValuesWhenHidden",void 0),u([d({type:String,json:{write:!0}})],Hf.prototype,"title",void 0),Hf=WX=u([j("esri.form.FormTemplate")],Hf);const Rrt=Hf;function nde(t,e,r){if(t.hasM==null||t.hasZ)for(const i of e)for(const s of i)s.length>2&&(s[2]*=r)}function Ort(t,e,r){if(!t&&!e||!r)return;const i=Fx(r);ode(t,r,i),ode(e,r,i)}function ode(t,e,r){if(t)for(const i of t)Prt(i.geometry,e,r)}function Prt(t,e,r){if(N(t)||!t.spatialReference||Po(t.spatialReference,e))return;const i=Fx(t.spatialReference)/r;if(i!==1){if("x"in t)t.z!=null&&(t.z*=i);else if("rings"in t)nde(t,t.rings,i);else if("paths"in t)nde(t,t.paths,i);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=i)}}let Irt=0;const T3e="esri.layers.graphics.sources.MemorySource",eG=we.getLogger(T3e);let QA=class extends Ly.LoadableMixin(zB(xT(or))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const r=E(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(r)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var r;const e=(r=this.layer)==null?void 0:r.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,r={}){await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);JQ(e,this.layer.spatialReference,i);const s=_ie.fromJSON(i);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,r={}){if(this._requiresClientGraphicMapping())throw new ce("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);return JQ(e,this.layer.spatialReference,i),i}queryFeatureCount(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,r))}queryObjectIds(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,r))}queryExtent(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,r)).then(i=>({count:i.count,extent:Ki.fromJSON(i.extent)}))}querySnapping(e,r={}){return this.load(r).then(()=>this._connection.invoke("querySnapping",e,r))}async _applyEdits(e){if(!this._connection)throw new ce("feature-layer-source:edit-failure","Memory source not loaded");const r=this.layer.objectIdField;let i=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[r]!=null?h.attributes[r]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const p=o(h);p!=null&&s.push(p)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(n.push(this._serializeFeature(h)),a){const p=o(h);p!=null&&a.set(p,h)}}Ort(i?i.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:n,deletes:s});return this.fullExtent=l,i&&i.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,r){if(this._layerOrSourceGeometryType!=="mesh"||N(e))return;const i=[];for(const{geometry:s}of e)!E(s)||s.type!=="mesh"||s.hasExtent||s.loaded||i.push(s.load({signal:r}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,r){if(this._idToClientGraphic){if(e)for(const i of r.updateResults){if(!i.success)continue;const s=e.get(i.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const i of r.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const r=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:r?new ce("feature-layer-source:edit-failure",r.description,{code:r.code}):null}}_prepareAddFeatures(e){const r=new Map,i=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);!s&&E(a.geometry)&&(s=a.geometry.type),i[o]=l,r.set(`${l.uid}`,a)}const n=this;return{features:i,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=r.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,n._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const r=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[r];i!=null&&this._idToClientGraphic.set(i,e)}get _layerOrSourceGeometryType(){var e,r;return((e=this.layer)==null?void 0:e.geometryType)??((r=this.sourceJSON)==null?void 0:r.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:r}=e,i=this._geometryForSerialization(e),s=(Irt++).toString();return i?{uid:s,geometry:i.toJSON(),attributes:r}:{uid:s,attributes:r}}_geometryForSerialization(e){const{geometry:r}=e;return N(r)?null:this._geometryRequiresClientGraphicMapping(r)?r.extent?sf.fromExtent(r.extent):null:r}async _startWorker(e){this._connection=await cTe("MemorySourceWorker",{strategy:Le("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:r,spatialReference:i,objectIdField:s,hasM:n,hasZ:o,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",_=>{eG.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),_.preventDefault()}));const h={features:c.features,fields:r&&r.map(_=>_.toJSON()),geometryType:Ice.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:l?null:i&&i.toJSON(),timeInfo:a?a.toJSON():null},p=await this._connection.invoke("load",h,{signal:e});for(const _ of p.warnings)eG.warn(_.message,{layer:this.layer,warning:_});p.featureErrors.length&&eG.warn(`Encountered ${p.featureErrors.length} validation errors while loading features`,p.featureErrors);const A=p.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(A.geometryType=Ice.toJSON(c.inferredGeometryType)),this.sourceJSON=A,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(p.assignedObjectIds)}};u([pte({Type:pl,ensureType:Oo(pl)})],QA.prototype,"itemType",void 0),u([d()],QA.prototype,"type",void 0),u([d({constructOnly:!0})],QA.prototype,"layer",void 0),u([d({readOnly:!0})],QA.prototype,"_workerGeometryType",null),u([d()],QA.prototype,"sourceJSON",void 0),QA=u([j(T3e)],QA);function $rt(t){return"portalItem"in t}const Lrt=t=>{let e=class extends t{get apiKey(){var r;return this._isOverridden("apiKey")?this._get("apiKey"):$rt(this)?(r=this.portalItem)==null?void 0:r.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],e.prototype,"apiKey",null),e=u([j("esri.layers.mixins.APIKeyMixin")],e),e},S3e={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},E3e=Object.values(S3e),C3e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${E3e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Drt=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${E3e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Nrt=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function k8t(t){return!!C3e.test(t)}function jM(t){if(N(t))return null;const e=eu(t),r=e.path.match(C3e)||e.path.match(Drt);if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:Die(a!==-1?s.slice(a+1):s),serverType:S3e[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function Frt(t){const e=eu(t).path.match(Nrt);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function Die(t){return(t=t.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function krt(t,e){const r=[];if(t){const i=jM(t);E(i)&&i.title&&r.push(i.title)}if(e){const i=Die(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function M3e(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(s);return n&&o}function Brt(t,e){return t&&_we(bwe(t,e))}function Urt(t){let{url:e}=t;if(!e)return{url:e};e=bwe(e,t.logger);const r=eu(e),i=jM(r.path);let s;if(E(i))i.sublayer!=null&&t.layer.layerId==null&&(s=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const n=Frt(r.path);E(n)&&(e=n.serviceUrl,s=n.sublayerId)}return{url:_we(e),layerId:s}}function Vrt(t,e,r,i,s){eb(e,i,"url",s),i.url&&t.layerId!=null&&(i.url=Dx(i.url,r,t.layerId.toString()))}function B8t(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return r&&(i||s||n)}const zrt=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=jM(this.url);if(E(r)&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",Brt(r,we.getLogger(this.declaredClass)))}};return u([d()],e.prototype,"title",null),u([d({type:String})],e.prototype,"url",null),e=u([j("esri.layers.mixins.ArcGISService")],e),e},ade={read:{reader:fie},write:{allowNull:!0,writer:mie}},R3e=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":ade,"portal-item":ade}}})],e.prototype,"effect",void 0),e=u([j("esri.layers.mixins.BlendLayer")],e),e},Grt=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([j("esri.layers.mixins.CustomParametersMixin")],e),e},jrt=new Nn.EventEmitter,O3e="esri.layers.mixins.EditBusLayer",P3e=Symbol(O3e);function U8t(t){return t!=null&&typeof t=="object"&&P3e in t}const Hrt=t=>{var e;let r=class extends t{constructor(...i){super(...i),this[e]=!0,this.when().then(()=>{this.own([jrt.on("edits",s=>{var h,p,A;const n="layer"in s?s.layer:null,o="layer"in s?(h=s.layer)==null?void 0:h.url:s.serviceUrl,a="layer"in s?(p=s.layer)==null?void 0:p.layerId:s.layerId,l=s.event;if(n===this||o!==this.url)return;if(a!=null&&this.layerId!=null&&a===this.layerId)return void this.emit("edits",Te(l));const c=(A=l.editedFeatures)==null?void 0:A.find(({layerId:_})=>_===this.layerId);if(c){const{adds:_,updates:w,deletes:T}=c.editedFeatures,C={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:_?_.map(({attributes:M})=>({objectId:this.objectIdField&&M[this.objectIdField],globalId:this.globalIdField&&M[this.globalIdField]})):[],deletedFeatures:T?T.map(({attributes:M})=>({objectId:this.objectIdField&&M[this.objectIdField],globalId:this.globalIdField&&M[this.globalIdField]})):[],updatedFeatures:w?w.map(({current:{attributes:M}})=>({objectId:this.objectIdField&&M[this.objectIdField],globalId:this.globalIdField&&M[this.globalIdField]})):[],editedFeatures:Te(l.editedFeatures),exceededTransferLimit:!1};this.emit("edits",C)}})])},()=>{})}};return e=P3e,r=u([j(O3e)],r),r};var YX;const tG=new Ui({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),rG=new Ui({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Nm=YX=class extends Qe{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Tg({geometry:Te(r),objectIds:Te(n),spatialRelationship:i,timeExtent:Te(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:r,timeExtent:i,objectIds:s,units:n,distance:o}=this;return new YX({geometry:Te(e),objectIds:Te(s),spatialRelationship:r,timeExtent:Te(i),where:t,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],Nm.prototype,"where",void 0),u([d({types:yT,json:{write:!0}})],Nm.prototype,"geometry",void 0),u([d({type:tG.apiValues,json:{name:"spatialRel",read:{reader:tG.read},write:{allowNull:!1,writer:tG.write,overridePolicy(){return{enabled:E(this.geometry)}}}}})],Nm.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Nm.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],Nm.prototype,"objectIds",void 0),u([d({type:rG.apiValues,json:{read:rG.read,write:{writer:rG.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Nm.prototype,"units",void 0),u([d({type:Wg,json:{write:!0}})],Nm.prototype,"timeExtent",void 0),Nm=YX=u([j("esri.layers.support.FeatureFilter")],Nm);const qrt=Nm;var QX;const lde={read:{reader:fie},write:{writer:mie,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},cde={read:{reader:fie},write:{writer:mie,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},ude={name:"showExcludedLabels",default:!0};let n2=QX=class extends Qe{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var i,s;const r=super.write(t,e);if(e!=null&&e.origin){if(r.filter){const n=Object.keys(r.filter);if(n.length>1||n[0]!=="where")return(i=e.messages)==null||i.push(new ce("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in r)return(s=e.messages)==null||s.push(new ce("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return r}clone(){return new QX({filter:E(this.filter)?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:qrt,json:{write:{allowNull:!0,writer(t,e,r,i){const s=t==null?void 0:t.write({},i);s&&Object.keys(s).length!==0?Jc(r,s,e):Jc(r,null,e)}}}})],n2.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":lde,"portal-item":lde}}})],n2.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":cde,"portal-item":cde}}})],n2.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":ude,"portal-item":ude}}})],n2.prototype,"excludedLabelsVisible",void 0),n2=QX=u([j("esri.layers.support.FeatureEffect")],n2);const Wrt=n2,hde={write:{allowNull:!0}},Yrt=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:Wrt,json:{origins:{"web-map":hde,"portal-item":hde}}})],e.prototype,"featureEffect",void 0),e=u([j("esri.layers.mixins.FeatureEffectLayer")],e),e};function Qrt(t){if(!t)return t;const{start:e,end:r}=t;return new Wg({start:E(e)?Ax(e,-e.getTimezoneOffset(),"minutes"):e,end:E(r)?Ax(r,-r.getTimezoneOffset(),"minutes"):r})}function Xrt(t){if(!t)return t;const{start:e,end:r}=t;return new Wg({start:E(e)?Ax(e,e.getTimezoneOffset(),"minutes"):e,end:E(r)?Ax(r,r.getTimezoneOffset(),"minutes"):r})}var XX;let xP=XX=class extends Qe{constructor(t){super(t)}async collectRequiredFields(t,e){return Gu(t,e,this.expression)}clone(){return new XX({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([d({type:String,json:{write:!0}})],xP.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],xP.prototype,"title",void 0),xP=XX=u([j("esri.layers.support.FeatureExpressionInfo")],xP);const dde=xP;function Zrt(t){return!!t&&Z3[t]!=null}function Jrt(t){return 1/(Z3[t]||1)}function Krt(){const t=Object.keys(Z3);return t.sort(),t}const eit=Krt();var ZX;const p5=hc()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),pde=new Ui({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let LA=ZX=class extends Qe{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):E(t)||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new ZX({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&V9e(this.featureExpressionInfo,t.featureExpressionInfo)}};u([d({type:dde,json:{write:!0}})],LA.prototype,"featureExpressionInfo",void 0),u([ft("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],LA.prototype,"readFeatureExpressionInfo",null),u([St("featureExpressionInfo",{featureExpressionInfo:{type:dde},"featureExpression.value":{type:[0]}})],LA.prototype,"writeFeatureExpressionInfo",null),u([d({type:p5.apiValues,nonNullable:!0,json:{type:p5.jsonValues,read:p5.read,write:{writer:p5.write,isRequired:!0}}})],LA.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],LA.prototype,"offset",void 0),u([d({type:eit,json:{type:String,read:pde.read,write:pde.write}})],LA.prototype,"unit",null),LA=ZX=u([j("esri.layers.support.ElevationInfo")],LA);const I3e=LA,tit={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},Nie={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,r){e[r]=!t}}}},Fie={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},rit={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:eb}}},iit={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},sit={value:null,type:I3e,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function V8t(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const $3e={write:!0,read:!0},JX={type:Number,json:{origins:{"web-document":$3e,"portal-item":{write:!0}}}},nit={...JX,json:{...JX.json,origins:{"web-document":{...$3e,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,r)=>r&&r.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?U$(e.layerDefinition.drawingInfo.transparency):void 0:U$(e.drawingInfo.transparency)}}},z8t={type:Wg,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:r}=this.layer,i=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;t&&(s=Xrt(s));let n=r?i&&s?i.intersection(s):i||s:s;if(!n||n.isEmpty||n.isAllTime)return n;e&&(n=n.offset(-e.value,e.unit)),t&&(n=Qrt(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},G8t={type:Ki,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const r=Ki.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(r.spatialReference=xt.fromJSON(e.spatialReference)),r}}}},read:!1}},oit={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},ait={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},lit={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},L3e={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},fde=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Chihuahua"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class MT extends Error{}class cit extends MT{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class uit extends MT{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class hit extends MT{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class TP extends MT{}class D3e extends MT{constructor(e){super(`Invalid unit ${e}`)}}class Np extends MT{}class C_ extends MT{constructor(){super("Zone is an abstract class")}}const Ut="numeric",q0="short",Ud="long",r9={year:Ut,month:Ut,day:Ut},N3e={year:Ut,month:q0,day:Ut},dit={year:Ut,month:q0,day:Ut,weekday:q0},F3e={year:Ut,month:Ud,day:Ut},k3e={year:Ut,month:Ud,day:Ut,weekday:Ud},B3e={hour:Ut,minute:Ut},U3e={hour:Ut,minute:Ut,second:Ut},V3e={hour:Ut,minute:Ut,second:Ut,timeZoneName:q0},z3e={hour:Ut,minute:Ut,second:Ut,timeZoneName:Ud},G3e={hour:Ut,minute:Ut,hourCycle:"h23"},j3e={hour:Ut,minute:Ut,second:Ut,hourCycle:"h23"},H3e={hour:Ut,minute:Ut,second:Ut,hourCycle:"h23",timeZoneName:q0},q3e={hour:Ut,minute:Ut,second:Ut,hourCycle:"h23",timeZoneName:Ud},W3e={year:Ut,month:Ut,day:Ut,hour:Ut,minute:Ut},Y3e={year:Ut,month:Ut,day:Ut,hour:Ut,minute:Ut,second:Ut},Q3e={year:Ut,month:q0,day:Ut,hour:Ut,minute:Ut},X3e={year:Ut,month:q0,day:Ut,hour:Ut,minute:Ut,second:Ut},pit={year:Ut,month:q0,day:Ut,weekday:q0,hour:Ut,minute:Ut},Z3e={year:Ut,month:Ud,day:Ut,hour:Ut,minute:Ut,timeZoneName:q0},J3e={year:Ut,month:Ud,day:Ut,hour:Ut,minute:Ut,second:Ut,timeZoneName:q0},K3e={year:Ut,month:Ud,day:Ut,weekday:Ud,hour:Ut,minute:Ut,timeZoneName:Ud},eMe={year:Ut,month:Ud,day:Ut,weekday:Ud,hour:Ut,minute:Ut,second:Ut,timeZoneName:Ud};class PL{get type(){throw new C_}get name(){throw new C_}get ianaName(){return this.name}get isUniversal(){throw new C_}offsetName(e,r){throw new C_}formatOffset(e,r){throw new C_}offset(e){throw new C_}equals(e){throw new C_}get isValid(){throw new C_}}let iG=null;class VU extends PL{static get instance(){return iG===null&&(iG=new VU),iG}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return rMe(e,r,i)}formatOffset(e,r){return GI(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let k6={};function fit(t){return k6[t]||(k6[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),k6[t]}const mit={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function git(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,h]=i;return[o,s,n,a,l,c,h]}function Ait(t,e){const r=t.formatToParts(e),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=mit[n];n==="era"?i[a]=o:Ts(a)||(i[a]=parseInt(o,10))}return i}let f5={};class Uy extends PL{static create(e){return f5[e]||(f5[e]=new Uy(e)),f5[e]}static resetCache(){f5={},k6={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Uy.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return rMe(e,r,i,this.name)}formatOffset(e,r){return GI(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=fit(this.name);let[s,n,o,a,l,c,h]=i.formatToParts?Ait(i,r):git(i,r);a==="BC"&&(s=-Math.abs(s)+1);const A=Uie({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let _=+r;const w=_%1e3;return _-=w>=0?w:1e3+w,(A-_)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let mde={};function yit(t,e={}){const r=JSON.stringify([t,e]);let i=mde[r];return i||(i=new Intl.ListFormat(t,e),mde[r]=i),i}let KX={};function eZ(t,e={}){const r=JSON.stringify([t,e]);let i=KX[r];return i||(i=new Intl.DateTimeFormat(t,e),KX[r]=i),i}let tZ={};function _it(t,e={}){const r=JSON.stringify([t,e]);let i=tZ[r];return i||(i=new Intl.NumberFormat(t,e),tZ[r]=i),i}let rZ={};function vit(t,e={}){const{base:r,...i}=e,s=JSON.stringify([t,i]);let n=rZ[s];return n||(n=new Intl.RelativeTimeFormat(t,e),rZ[s]=n),n}let SP=null;function bit(){return SP||(SP=new Intl.DateTimeFormat().resolvedOptions().locale,SP)}function wit(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,s;try{i=eZ(t).resolvedOptions(),s=t}catch{const l=t.substring(0,r);i=eZ(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=i;return[s,n,o]}}function xit(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function Tit(t){const e=[];for(let r=1;r<=12;r++){const i=Oi.utc(2016,r,1);e.push(t(i))}return e}function Sit(t){const e=[];for(let r=1;r<=7;r++){const i=Oi.utc(2016,11,13+r);e.push(t(i))}return e}function m5(t,e,r,i,s){const n=t.listingMode(r);return n==="error"?null:n==="en"?i(e):s(e)}function Eit(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class Cit{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=_it(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):Bie(e,3);return Ia(r,this.padTo)}}}class Mit{constructor(e,r,i){this.opts=i;let s;if(e.zone.isUniversal){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&Uy.create(a).valid?(s=a,this.dt=e):(s="UTC",i.timeZoneName?this.dt=e:this.dt=e.offset===0?e:Oi.fromMillis(e.ts+e.offset*60*1e3))}else e.zone.type==="system"?this.dt=e:(this.dt=e,s=e.zone.name);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=eZ(r,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class Rit{constructor(e,r,i){this.opts={style:"long",...i},!r&&tMe()&&(this.rtf=vit(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):qit(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class no{static fromOpts(e){return no.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,s=!1){const n=e||Oa.defaultLocale,o=n||(s?"en-US":bit()),a=r||Oa.defaultNumberingSystem,l=i||Oa.defaultOutputCalendar;return new no(o,a,l,n)}static resetCache(){SP=null,KX={},tZ={},rZ={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return no.create(e,r,i)}constructor(e,r,i,s){const[n,o,a]=wit(e);this.locale=n,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=xit(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=Eit(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:no.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1,i=!0){return m5(this,e,i,nMe,()=>{const s=r?{month:e,day:"numeric"}:{month:e},n=r?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=Tit(o=>this.extract(o,s,"month"))),this.monthsCache[n][e]})}weekdays(e,r=!1,i=!0){return m5(this,e,i,lMe,()=>{const s=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=r?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=Sit(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][e]})}meridiems(e=!0){return m5(this,void 0,e,()=>cMe,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Oi.utc(2016,11,13,9),Oi.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(e,r=!0){return m5(this,e,r,uMe,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[Oi.utc(-40,1,1),Oi.utc(2017,1,1)].map(s=>this.extract(s,i,"era"))),this.eraCache[e]})}extract(e,r,i){const s=this.dtFormatter(e,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new Cit(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new Mit(e,this.intl,r)}relFormatter(e={}){return new Rit(this.intl,this.isEnglish(),e)}listFormatter(e={}){return yit(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let sG=null;class qc extends PL{static get utcInstance(){return sG===null&&(sG=new qc(0)),sG}static instance(e){return e===0?qc.utcInstance:new qc(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new qc(GU(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${GI(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${GI(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return GI(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class Oit extends PL{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function ev(t,e){if(Ts(t)||t===null)return e;if(t instanceof PL)return t;if(Pit(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?VU.instance:r==="utc"||r==="gmt"?qc.utcInstance:qc.parseSpecifier(r)||Uy.create(t)}else return yx(t)?qc.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new Oit(t)}let gde=()=>Date.now(),Ade="system",yde=null,_de=null,vde=null,bde=60,wde;class Oa{static get now(){return gde}static set now(e){gde=e}static set defaultZone(e){Ade=e}static get defaultZone(){return ev(Ade,VU.instance)}static get defaultLocale(){return yde}static set defaultLocale(e){yde=e}static get defaultNumberingSystem(){return _de}static set defaultNumberingSystem(e){_de=e}static get defaultOutputCalendar(){return vde}static set defaultOutputCalendar(e){vde=e}static get twoDigitCutoffYear(){return bde}static set twoDigitCutoffYear(e){bde=e%100}static get throwOnInvalid(){return wde}static set throwOnInvalid(e){wde=e}static resetCaches(){no.resetCache(),Uy.resetCache()}}function Ts(t){return typeof t>"u"}function yx(t){return typeof t=="number"}function zU(t){return typeof t=="number"&&t%1===0}function Pit(t){return typeof t=="string"}function Iit(t){return Object.prototype.toString.call(t)==="[object Date]"}function tMe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function $it(t){return Array.isArray(t)?t:[t]}function xde(t,e,r){if(t.length!==0)return t.reduce((i,s)=>{const n=[e(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function Lit(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function eM(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function dy(t,e,r){return zU(t)&&t>=e&&t<=r}function Dit(t,e){return t-e*Math.floor(t/e)}function Ia(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function G1(t){if(!(Ts(t)||t===null||t===""))return parseInt(t,10)}function jb(t){if(!(Ts(t)||t===null||t===""))return parseFloat(t)}function kie(t){if(!(Ts(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function Bie(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function IL(t){return t%4===0&&(t%100!==0||t%400===0)}function zI(t){return IL(t)?366:365}function i9(t,e){const r=Dit(e-1,12)+1,i=t+(e-r)/12;return r===2?IL(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function Uie(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(e.getUTCFullYear()-1900)),+e}function s9(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function iZ(t){return t>99?t:t>Oa.twoDigitCutoffYear?1900+t:2e3+t}function rMe(t,e,r,i=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function GU(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function iMe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new Np(`Invalid unit value ${t}`);return e}function n9(t,e){const r={};for(const i in t)if(eM(t,i)){const s=t[i];if(s==null)continue;r[e(i)]=iMe(s)}return r}function GI(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${Ia(r,2)}:${Ia(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${Ia(r,2)}${Ia(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function jU(t){return Lit(t,["hour","minute","second","millisecond"])}const Nit=["January","February","March","April","May","June","July","August","September","October","November","December"],sMe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Fit=["J","F","M","A","M","J","J","A","S","O","N","D"];function nMe(t){switch(t){case"narrow":return[...Fit];case"short":return[...sMe];case"long":return[...Nit];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const oMe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],aMe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],kit=["M","T","W","T","F","S","S"];function lMe(t){switch(t){case"narrow":return[...kit];case"short":return[...aMe];case"long":return[...oMe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const cMe=["AM","PM"],Bit=["Before Christ","Anno Domini"],Uit=["BC","AD"],Vit=["B","A"];function uMe(t){switch(t){case"narrow":return[...Vit];case"short":return[...Uit];case"long":return[...Bit];default:return null}}function zit(t){return cMe[t.hour<12?0:1]}function Git(t,e){return lMe(e)[t.weekday-1]}function jit(t,e){return nMe(e)[t.month-1]}function Hit(t,e){return uMe(e)[t.year<0?0:1]}function qit(t,e,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&n){const p=t==="days";switch(e){case 1:return p?"tomorrow":`next ${s[t][0]}`;case-1:return p?"yesterday":`last ${s[t][0]}`;case 0:return p?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],h=i?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function Tde(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const Wit={D:r9,DD:N3e,DDD:F3e,DDDD:k3e,t:B3e,tt:U3e,ttt:V3e,tttt:z3e,T:G3e,TT:j3e,TTT:H3e,TTTT:q3e,f:W3e,ff:Q3e,fff:Z3e,ffff:K3e,F:Y3e,FF:X3e,FFF:J3e,FFFF:eMe};class Gc{static create(e,r={}){return new Gc(e,r)}static parseFormat(e){let r=null,i="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&n.push({literal:s,val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:!1,val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s,val:i}),n}static macroTokenToFormatOpts(e){return Wit[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTime(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTimeParts(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).formatToParts()}formatInterval(e,r={}){return this.loc.dtFormatter(e.start,{...this.opts,...r}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return Ia(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(_,w)=>this.loc.extract(e,_,w),o=_=>e.isOffsetFixed&&e.offset===0&&_.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,_.format):"",a=()=>i?zit(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(_,w)=>i?jit(e,_):n(w?{month:_}:{month:_,day:"numeric"},"month"),c=(_,w)=>i?Git(e,_):n(w?{weekday:_}:{weekday:_,month:"long",day:"numeric"},"weekday"),h=_=>{const w=Gc.macroTokenToFormatOpts(_);return w?this.formatWithSystemDefault(e,w):_},p=_=>i?Hit(e,_):n({era:_},"era"),A=_=>{switch(_){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(_)}};return Tde(Gc.parseFormat(r),A)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=i(c);return h?this.num(l.get(h),c.length):c},n=Gc.parseFormat(r),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return Tde(n,s(a))}}class x0{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const hMe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function HM(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function qM(...t){return e=>t.reduce(([r,i,s],n)=>{const[o,a,l]=n(e,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function WM(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const s=r.exec(t);if(s)return i(s)}return[null,null]}function dMe(...t){return(e,r)=>{const i={};let s;for(s=0;s<t.length;s++)i[t[s]]=G1(e[r+s]);return[i,null,r+s]}}const pMe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Yit=`(?:${pMe.source}?(?:\\[(${hMe.source})\\])?)?`,Vie=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,fMe=RegExp(`${Vie.source}${Yit}`),zie=RegExp(`(?:T${fMe.source})?`),Qit=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Xit=/(\d{4})-?W(\d\d)(?:-?(\d))?/,Zit=/(\d{4})-?(\d{3})/,Jit=dMe("weekYear","weekNumber","weekDay"),Kit=dMe("year","ordinal"),est=/(\d{4})-(\d\d)-(\d\d)/,mMe=RegExp(`${Vie.source} ?(?:${pMe.source}|(${hMe.source}))?`),tst=RegExp(`(?: ${mMe.source})?`);function KC(t,e,r){const i=t[e];return Ts(i)?r:G1(i)}function rst(t,e){return[{year:KC(t,e),month:KC(t,e+1,1),day:KC(t,e+2,1)},null,e+3]}function YM(t,e){return[{hours:KC(t,e,0),minutes:KC(t,e+1,0),seconds:KC(t,e+2,0),milliseconds:kie(t[e+3])},null,e+4]}function $L(t,e){const r=!t[e]&&!t[e+1],i=GU(t[e+1],t[e+2]),s=r?null:qc.instance(i);return[{},s,e+3]}function LL(t,e){const r=t[e]?Uy.create(t[e]):null;return[{},r,e+1]}const ist=RegExp(`^T?${Vie.source}$`),sst=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function nst(t){const[e,r,i,s,n,o,a,l,c]=t,h=e[0]==="-",p=l&&l[0]==="-",A=(_,w=!1)=>_!==void 0&&(w||_&&h)?-_:_;return[{years:A(jb(r)),months:A(jb(i)),weeks:A(jb(s)),days:A(jb(n)),hours:A(jb(o)),minutes:A(jb(a)),seconds:A(jb(l),l==="-0"),milliseconds:A(kie(c),p)}]}const ost={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Gie(t,e,r,i,s,n,o){const a={year:e.length===2?iZ(G1(e)):G1(e),month:sMe.indexOf(r)+1,day:G1(i),hour:G1(s),minute:G1(n)};return o&&(a.second=G1(o)),t&&(a.weekday=t.length>3?oMe.indexOf(t)+1:aMe.indexOf(t)+1),a}const ast=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function lst(t){const[,e,r,i,s,n,o,a,l,c,h,p]=t,A=Gie(e,s,i,r,n,o,a);let _;return l?_=ost[l]:c?_=0:_=GU(h,p),[A,new qc(_)]}function cst(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const ust=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,hst=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,dst=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Sde(t){const[,e,r,i,s,n,o,a]=t;return[Gie(e,s,i,r,n,o,a),qc.utcInstance]}function pst(t){const[,e,r,i,s,n,o,a]=t;return[Gie(e,a,r,i,s,n,o),qc.utcInstance]}const fst=HM(Qit,zie),mst=HM(Xit,zie),gst=HM(Zit,zie),Ast=HM(fMe),gMe=qM(rst,YM,$L,LL),yst=qM(Jit,YM,$L,LL),_st=qM(Kit,YM,$L,LL),vst=qM(YM,$L,LL);function bst(t){return WM(t,[fst,gMe],[mst,yst],[gst,_st],[Ast,vst])}function wst(t){return WM(cst(t),[ast,lst])}function xst(t){return WM(t,[ust,Sde],[hst,Sde],[dst,pst])}function Tst(t){return WM(t,[sst,nst])}const Sst=qM(YM);function Est(t){return WM(t,[ist,Sst])}const Cst=HM(est,tst),Mst=HM(mMe),Rst=qM(YM,$L,LL);function Ost(t){return WM(t,[Cst,gMe],[Mst,Rst])}const Pst="Invalid Duration",AMe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Ist={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...AMe},tp=146097/400,WT=146097/4800,$st={years:{quarters:4,months:12,weeks:tp/7,days:tp,hours:tp*24,minutes:tp*24*60,seconds:tp*24*60*60,milliseconds:tp*24*60*60*1e3},quarters:{months:3,weeks:tp/28,days:tp/4,hours:tp*24/4,minutes:tp*24*60/4,seconds:tp*24*60*60/4,milliseconds:tp*24*60*60*1e3/4},months:{weeks:WT/7,days:WT,hours:WT*24,minutes:WT*24*60,seconds:WT*24*60*60,milliseconds:WT*24*60*60*1e3},...AMe},o2=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Lst=o2.slice(0).reverse();function M_(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Cs(i)}function Dst(t){return t<0?Math.floor(t):Math.ceil(t)}function yMe(t,e,r,i,s){const n=t[s][r],o=e[r]/n,a=Math.sign(o)===Math.sign(i[s]),l=!a&&i[s]!==0&&Math.abs(o)<=1?Dst(o):Math.trunc(o);i[s]+=l,e[r]-=l*n}function Nst(t,e){Lst.reduce((r,i)=>Ts(e[i])?r:(r&&yMe(t,e,r,e,i),i),null)}function Fst(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class Cs{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?$st:Ist;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||no.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return Cs.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new Np(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Cs({values:n9(e,Cs.normalizeUnit),loc:no.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(yx(e))return Cs.fromMillis(e);if(Cs.isDuration(e))return e;if(typeof e=="object")return Cs.fromObject(e);throw new Np(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=Tst(e);return i?Cs.fromObject(i,r):Cs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=Est(e);return i?Cs.fromObject(i,r):Cs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new Np("need to specify a reason the Duration is invalid");const i=e instanceof x0?e:new x0(e,r);if(Oa.throwOnInvalid)throw new hit(i);return new Cs({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new D3e(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?Gc.create(this.loc,i).formatDurationFromString(this,e):Pst}toHuman(e={}){const r=o2.map(i=>{const s=this.values[i];return Ts(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Bie(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(s+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(s+=".SSS"));let n=i.toFormat(s);return e.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=Cs.fromDurationLike(e),i={};for(const s of o2)(eM(r.values,s)||eM(this.values,s))&&(i[s]=r.get(s)+this.get(s));return M_(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=Cs.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=iMe(e(this.values[i],i));return M_(this,{values:r},!0)}get(e){return this[Cs.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...n9(e,Cs.normalizeUnit)};return M_(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:s,conversionAccuracy:i};return M_(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Nst(this.matrix,e),M_(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=Fst(this.normalize().shiftToAll().toObject());return M_(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Cs.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of o2)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;yx(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in s)o2.indexOf(c)>o2.indexOf(o)&&yMe(this.matrix,s,c,r,o)}else yx(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return M_(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return M_(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of o2)if(!r(this.values[i],e.values[i]))return!1;return!0}}const YT="Invalid Interval";function kst(t,e){return!t||!t.isValid?Bo.invalid("missing or invalid start"):!e||!e.isValid?Bo.invalid("missing or invalid end"):e<t?Bo.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Bo{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new Np("need to specify a reason the Interval is invalid");const i=e instanceof x0?e:new x0(e,r);if(Oa.throwOnInvalid)throw new uit(i);return new Bo({invalid:i})}static fromDateTimes(e,r){const i=VR(e),s=VR(r),n=kst(i,s);return n??new Bo({start:i,end:s})}static after(e,r){const i=Cs.fromDurationLike(r),s=VR(e);return Bo.fromDateTimes(s,s.plus(i))}static before(e,r){const i=Cs.fromDurationLike(r),s=VR(e);return Bo.fromDateTimes(s.minus(i),s)}static fromISO(e,r){const[i,s]=(e||"").split("/",2);if(i&&s){let n,o;try{n=Oi.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=Oi.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return Bo.fromDateTimes(n,a);if(o){const c=Cs.fromISO(s,r);if(c.isValid)return Bo.after(n,c)}else if(l){const c=Cs.fromISO(i,r);if(c.isValid)return Bo.before(a,c)}}return Bo.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+1}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?Bo.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(VR).filter(o=>this.contains(o)).sort(),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push(Bo.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(e){const r=Cs.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Bo.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:Bo.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return Bo.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(Bo.fromDateTimes(r,l.time)),r=null);return Bo.merge(s)}difference(...e){return Bo.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:YT}toLocaleString(e=r9,r={}){return this.isValid?Gc.create(this.s.loc.clone(r),e).formatInterval(this):YT}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:YT}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:YT}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:YT}toFormat(e,{separator:r="  "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:YT}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):Cs.invalid(this.invalidReason)}mapEndpoints(e){return Bo.fromDateTimes(e(this.s),e(this.e))}}class g5{static hasDST(e=Oa.defaultZone){const r=Oi.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return Uy.isValidZone(e)}static normalizeZone(e){return ev(e,Oa.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||no.create(r,i,n)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||no.create(r,i,n)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||no.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||no.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return no.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return no.create(r,null,"gregory").eras(e)}static features(){return{relative:tMe()}}}function Ede(t,e){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(Cs.fromMillis(i).as("days"))}function Bst(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=Ede(l,c);return(h-h%7)/7}],["days",Ede]],s={},n=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s)):t=a);return[t,s,a,o]}function Ust(t,e,r,i){let[s,n,o,a]=Bst(t,e,r);const l=e-s,c=r.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=Cs.fromObject(n,i);return c.length>0?Cs.fromMillis(l,i).shiftTo(...c).plus(h):h}const jie={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},Cde={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Vst=jie.hanidec.replace(/[\[|\]]/g,"").split("");function zst(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(jie.hanidec)!==-1)e+=Vst.indexOf(t[r]);else for(const s in Cde){const[n,o]=Cde[s];i>=n&&i<=o&&(e+=i-n)}}return parseInt(e,10)}else return e}function Tf({numberingSystem:t},e=""){return new RegExp(`${jie[t||"latn"]}${e}`)}const Gst="missing Intl.DateTimeFormat.formatToParts support";function Gs(t,e=r=>r){return{regex:t,deser:([r])=>e(zst(r))}}const jst=String.fromCharCode(160),_Me=`[ ${jst}]`,vMe=new RegExp(_Me,"g");function Hst(t){return t.replace(/\./g,"\\.?").replace(vMe,_Me)}function Mde(t){return t.replace(/\./g,"").replace(vMe," ").toLowerCase()}function Sf(t,e){return t===null?null:{regex:RegExp(t.map(Hst).join("|")),deser:([r])=>t.findIndex(i=>Mde(r)===Mde(i))+e}}function Rde(t,e){return{regex:t,deser:([,r,i])=>GU(r,i),groups:e}}function nG(t){return{regex:t,deser:([e])=>e}}function qst(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Wst(t,e){const r=Tf(e),i=Tf(e,"{2}"),s=Tf(e,"{3}"),n=Tf(e,"{4}"),o=Tf(e,"{6}"),a=Tf(e,"{1,2}"),l=Tf(e,"{1,3}"),c=Tf(e,"{1,6}"),h=Tf(e,"{1,9}"),p=Tf(e,"{2,4}"),A=Tf(e,"{4,6}"),_=C=>({regex:RegExp(qst(C.val)),deser:([M])=>M,literal:!0}),T=(C=>{if(t.literal)return _(C);switch(C.val){case"G":return Sf(e.eras("short",!1),0);case"GG":return Sf(e.eras("long",!1),0);case"y":return Gs(c);case"yy":return Gs(p,iZ);case"yyyy":return Gs(n);case"yyyyy":return Gs(A);case"yyyyyy":return Gs(o);case"M":return Gs(a);case"MM":return Gs(i);case"MMM":return Sf(e.months("short",!0,!1),1);case"MMMM":return Sf(e.months("long",!0,!1),1);case"L":return Gs(a);case"LL":return Gs(i);case"LLL":return Sf(e.months("short",!1,!1),1);case"LLLL":return Sf(e.months("long",!1,!1),1);case"d":return Gs(a);case"dd":return Gs(i);case"o":return Gs(l);case"ooo":return Gs(s);case"HH":return Gs(i);case"H":return Gs(a);case"hh":return Gs(i);case"h":return Gs(a);case"mm":return Gs(i);case"m":return Gs(a);case"q":return Gs(a);case"qq":return Gs(i);case"s":return Gs(a);case"ss":return Gs(i);case"S":return Gs(l);case"SSS":return Gs(s);case"u":return nG(h);case"uu":return nG(a);case"uuu":return Gs(r);case"a":return Sf(e.meridiems(),0);case"kkkk":return Gs(n);case"kk":return Gs(p,iZ);case"W":return Gs(a);case"WW":return Gs(i);case"E":case"c":return Gs(r);case"EEE":return Sf(e.weekdays("short",!1,!1),1);case"EEEE":return Sf(e.weekdays("long",!1,!1),1);case"ccc":return Sf(e.weekdays("short",!0,!1),1);case"cccc":return Sf(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Rde(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return Rde(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return nG(/[a-z_+-/]{1,256}?/i);default:return _(C)}})(t)||{invalidReason:Gst};return T.token=t,T}const Yst={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function Qst(t,e){const{type:r,value:i}=t;if(r==="literal")return{literal:!0,val:i};const s=e[r];let n=Yst[r];if(typeof n=="object"&&(n=n[s]),n)return{literal:!1,val:n}}function Xst(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function Zst(t,e,r){const i=t.match(e);if(i){const s={};let n=1;for(const o in r)if(eM(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function Jst(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return Ts(t.z)||(r=Uy.create(t.z)),Ts(t.Z)||(r||(r=new qc(t.Z)),i=t.Z),Ts(t.q)||(t.M=(t.q-1)*3+1),Ts(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Ts(t.u)||(t.S=kie(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),r,i]}let oG=null;function Kst(){return oG||(oG=Oi.fromMillis(1555555555555)),oG}function ent(t,e){if(t.literal)return t;const r=Gc.macroTokenToFormatOpts(t.val),i=xMe(r,e);return i==null||i.includes(void 0)?t:i}function bMe(t,e){return Array.prototype.concat(...t.map(r=>ent(r,e)))}function wMe(t,e,r){const i=bMe(Gc.parseFormat(r),t),s=i.map(o=>Wst(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:i,invalidReason:n.invalidReason};{const[o,a]=Xst(s),l=RegExp(o,"i"),[c,h]=Zst(e,l,a),[p,A,_]=h?Jst(h):[null,null,void 0];if(eM(h,"a")&&eM(h,"H"))throw new TP("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:h,result:p,zone:A,specificOffset:_}}}function tnt(t,e,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=wMe(t,e,r);return[i,s,n,o]}function xMe(t,e){return t?Gc.create(e,t).formatDateTimeParts(Kst()).map(s=>Qst(s,t)):null}const TMe=[0,31,59,90,120,151,181,212,243,273,304,334],SMe=[0,31,60,91,121,152,182,213,244,274,305,335];function qp(t,e){return new x0("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function EMe(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function CMe(t,e,r){return r+(IL(t)?SMe:TMe)[e-1]}function MMe(t,e){const r=IL(t)?SMe:TMe,i=r.findIndex(n=>n<e),s=e-r[i];return{month:i+1,day:s}}function sZ(t){const{year:e,month:r,day:i}=t,s=CMe(e,r,i),n=EMe(e,r,i);let o=Math.floor((s-n+10)/7),a;return o<1?(a=e-1,o=s9(a)):o>s9(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:n,...jU(t)}}function Ode(t){const{weekYear:e,weekNumber:r,weekday:i}=t,s=EMe(e,1,4),n=zI(e);let o=r*7+i-s-3,a;o<1?(a=e-1,o+=zI(a)):o>n?(a=e+1,o-=zI(e)):a=e;const{month:l,day:c}=MMe(a,o);return{year:a,month:l,day:c,...jU(t)}}function aG(t){const{year:e,month:r,day:i}=t,s=CMe(e,r,i);return{year:e,ordinal:s,...jU(t)}}function Pde(t){const{year:e,ordinal:r}=t,{month:i,day:s}=MMe(e,r);return{year:e,month:i,day:s,...jU(t)}}function rnt(t){const e=zU(t.weekYear),r=dy(t.weekNumber,1,s9(t.weekYear)),i=dy(t.weekday,1,7);return e?r?i?!1:qp("weekday",t.weekday):qp("week",t.week):qp("weekYear",t.weekYear)}function int(t){const e=zU(t.year),r=dy(t.ordinal,1,zI(t.year));return e?r?!1:qp("ordinal",t.ordinal):qp("year",t.year)}function RMe(t){const e=zU(t.year),r=dy(t.month,1,12),i=dy(t.day,1,i9(t.year,t.month));return e?r?i?!1:qp("day",t.day):qp("month",t.month):qp("year",t.year)}function OMe(t){const{hour:e,minute:r,second:i,millisecond:s}=t,n=dy(e,0,23)||e===24&&r===0&&i===0&&s===0,o=dy(r,0,59),a=dy(i,0,59),l=dy(s,0,999);return n?o?a?l?!1:qp("millisecond",s):qp("second",i):qp("minute",r):qp("hour",e)}const lG="Invalid DateTime",Ide=864e13;function A5(t){return new x0("unsupported zone",`the zone "${t.name}" is not supported`)}function cG(t){return t.weekData===null&&(t.weekData=sZ(t.c)),t.weekData}function BR(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Oi({...r,...e,old:r})}function PMe(t,e,r){let i=t-e*60*1e3;const s=r.offset(i);if(e===s)return[i,e];i-=(s-e)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function $de(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function B6(t,e,r){return PMe(Uie(t),e,r)}function Lde(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:i,month:s,day:Math.min(t.c.day,i9(i,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Cs.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=Uie(n);let[l,c]=PMe(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function UR(t,e,r,i,s,n){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0){const l=e||a,c=Oi.fromObject(t,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return Oi.invalid(new x0("unparsable",`the input "${s}" can't be parsed as ${i}`))}function y5(t,e,r=!0){return t.isValid?Gc.create(no.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function uG(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=Ia(t.c.year,r?6:4),e?(i+="-",i+=Ia(t.c.month),i+="-",i+=Ia(t.c.day)):(i+=Ia(t.c.month),i+=Ia(t.c.day)),i}function Dde(t,e,r,i,s,n){let o=Ia(t.c.hour);return e?(o+=":",o+=Ia(t.c.minute),(t.c.second!==0||!r)&&(o+=":")):o+=Ia(t.c.minute),(t.c.second!==0||!r)&&(o+=Ia(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=Ia(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=Ia(Math.trunc(-t.o/60)),o+=":",o+=Ia(Math.trunc(-t.o%60))):(o+="+",o+=Ia(Math.trunc(t.o/60)),o+=":",o+=Ia(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const IMe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},snt={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},nnt={ordinal:1,hour:0,minute:0,second:0,millisecond:0},$Me=["year","month","day","hour","minute","second","millisecond"],ont=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],ant=["year","ordinal","hour","minute","second","millisecond"];function Nde(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new D3e(t);return e}function Fde(t,e){const r=ev(e.zone,Oa.defaultZone),i=no.fromObject(e),s=Oa.now();let n,o;if(Ts(t.year))n=s;else{for(const c of $Me)Ts(t[c])&&(t[c]=IMe[c]);const a=RMe(t)||OMe(t);if(a)return Oi.invalid(a);const l=r.offset(s);[n,o]=B6(t,l,r)}return new Oi({ts:n,zone:r,loc:i,o})}function kde(t,e,r){const i=Ts(r.round)?!0:r.round,s=(o,a)=>(o=Bie(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,r.units[r.units.length-1])}function Bde(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class Oi{constructor(e){const r=e.zone||Oa.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new x0("invalid input"):null)||(r.isValid?null:A5(r));this.ts=Ts(e.ts)?Oa.now():e.ts;let s=null,n=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[s,n]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);s=$de(this.ts,a),i=Number.isNaN(s.year)?new x0("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=e.loc||no.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new Oi({})}static local(){const[e,r]=Bde(arguments),[i,s,n,o,a,l,c]=r;return Fde({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=Bde(arguments),[i,s,n,o,a,l,c]=r;return e.zone=qc.utcInstance,Fde({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=Iit(e)?e.valueOf():NaN;if(Number.isNaN(i))return Oi.invalid("invalid input");const s=ev(r.zone,Oa.defaultZone);return s.isValid?new Oi({ts:i,zone:s,loc:no.fromObject(r)}):Oi.invalid(A5(s))}static fromMillis(e,r={}){if(yx(e))return e<-Ide||e>Ide?Oi.invalid("Timestamp out of range"):new Oi({ts:e,zone:ev(r.zone,Oa.defaultZone),loc:no.fromObject(r)});throw new Np(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(yx(e))return new Oi({ts:e*1e3,zone:ev(r.zone,Oa.defaultZone),loc:no.fromObject(r)});throw new Np("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=ev(r.zone,Oa.defaultZone);if(!i.isValid)return Oi.invalid(A5(i));const s=Oa.now(),n=Ts(r.specificOffset)?i.offset(s):r.specificOffset,o=n9(e,Nde),a=!Ts(o.ordinal),l=!Ts(o.year),c=!Ts(o.month)||!Ts(o.day),h=l||c,p=o.weekYear||o.weekNumber,A=no.fromObject(r);if((h||a)&&p)throw new TP("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new TP("Can't mix ordinal dates with month/day");const _=p||o.weekday&&!h;let w,T,C=$de(s,n);_?(w=ont,T=snt,C=sZ(C)):a?(w=ant,T=nnt,C=aG(C)):(w=$Me,T=IMe);let M=!1;for(const z of w){const Z=o[z];Ts(Z)?M?o[z]=T[z]:o[z]=C[z]:M=!0}const O=_?rnt(o):a?int(o):RMe(o),$=O||OMe(o);if($)return Oi.invalid($);const L=_?Ode(o):a?Pde(o):o,[k,F]=B6(L,n,i),G=new Oi({ts:k,zone:i,o:F,loc:A});return o.weekday&&h&&e.weekday!==G.weekday?Oi.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${G.toISO()}`):G}static fromISO(e,r={}){const[i,s]=bst(e);return UR(i,s,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,s]=wst(e);return UR(i,s,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,s]=xst(e);return UR(i,s,r,"HTTP",r)}static fromFormat(e,r,i={}){if(Ts(e)||Ts(r))throw new Np("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=no.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=tnt(o,e,r);return h?Oi.invalid(h):UR(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return Oi.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,s]=Ost(e);return UR(i,s,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new Np("need to specify a reason the DateTime is invalid");const i=e instanceof x0?e:new x0(e,r);if(Oa.throwOnInvalid)throw new cit(i);return new Oi({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=xMe(e,no.fromObject(r));return i?i.map(s=>s?s.val:null).join(""):null}static expandFormat(e,r={}){return bMe(Gc.parseFormat(e),no.fromObject(r)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?cG(this).weekYear:NaN}get weekNumber(){return this.isValid?cG(this).weekNumber:NaN}get weekday(){return this.isValid?cG(this).weekday:NaN}get ordinal(){return this.isValid?aG(this.c).ordinal:NaN}get monthShort(){return this.isValid?g5.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?g5.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?g5.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?g5.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return IL(this.year)}get daysInMonth(){return i9(this.year,this.month)}get daysInYear(){return this.isValid?zI(this.year):NaN}get weeksInWeekYear(){return this.isValid?s9(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:s}=Gc.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(e=0,r={}){return this.setZone(qc.instance(e),r)}toLocal(){return this.setZone(Oa.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=ev(e,Oa.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(r||i){const n=e.offset(this.ts),o=this.toObject();[s]=B6(o,n,e)}return BR(this,{ts:s,zone:e})}else return Oi.invalid(A5(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return BR(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=n9(e,Nde),i=!Ts(r.weekYear)||!Ts(r.weekNumber)||!Ts(r.weekday),s=!Ts(r.ordinal),n=!Ts(r.year),o=!Ts(r.month)||!Ts(r.day),a=n||o,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new TP("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new TP("Can't mix ordinal dates with month/day");let c;i?c=Ode({...sZ(this.c),...r}):Ts(r.ordinal)?(c={...this.toObject(),...r},Ts(r.day)&&(c.day=Math.min(i9(c.year,c.month),c.day))):c=Pde({...aG(this.c),...r});const[h,p]=B6(c,this.o,this.zone);return BR(this,{ts:h,o:p})}plus(e){if(!this.isValid)return this;const r=Cs.fromDurationLike(e);return BR(this,Lde(this,r))}minus(e){if(!this.isValid)return this;const r=Cs.fromDurationLike(e).negate();return BR(this,Lde(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=Cs.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?Gc.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):lG}toLocaleString(e=r9,r={}){return this.isValid?Gc.create(this.loc.clone(r),e).formatDateTime(this):lG}toLocaleParts(e={}){return this.isValid?Gc.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=uG(this,o);return a+="T",a+=Dde(this,o,r,i,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?uG(this,e==="extended"):null}toISOWeekDate(){return y5(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Dde(this,o==="extended",r,e,i,n):null}toRFC2822(){return y5(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return y5(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?uG(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||e)&&(i&&(s+=" "),r?s+="z":e&&(s+="ZZ")),y5(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():lG}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return Cs.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=$it(r).map(Cs.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=Ust(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(Oi.now(),e,r)}until(e){return this.isValid?Bo.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||Oi.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),kde(r,this.plus(i),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?kde(e.base||Oi.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(Oi.isDateTime))throw new Np("min requires all arguments be DateTimes");return xde(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(Oi.isDateTime))throw new Np("max requires all arguments be DateTimes");return xde(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=no.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return wMe(o,e,r)}static fromStringExplain(e,r,i={}){return Oi.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return r9}static get DATE_MED(){return N3e}static get DATE_MED_WITH_WEEKDAY(){return dit}static get DATE_FULL(){return F3e}static get DATE_HUGE(){return k3e}static get TIME_SIMPLE(){return B3e}static get TIME_WITH_SECONDS(){return U3e}static get TIME_WITH_SHORT_OFFSET(){return V3e}static get TIME_WITH_LONG_OFFSET(){return z3e}static get TIME_24_SIMPLE(){return G3e}static get TIME_24_WITH_SECONDS(){return j3e}static get TIME_24_WITH_SHORT_OFFSET(){return H3e}static get TIME_24_WITH_LONG_OFFSET(){return q3e}static get DATETIME_SHORT(){return W3e}static get DATETIME_SHORT_WITH_SECONDS(){return Y3e}static get DATETIME_MED(){return Q3e}static get DATETIME_MED_WITH_SECONDS(){return X3e}static get DATETIME_MED_WITH_WEEKDAY(){return pit}static get DATETIME_FULL(){return Z3e}static get DATETIME_FULL_WITH_SECONDS(){return J3e}static get DATETIME_HUGE(){return K3e}static get DATETIME_HUGE_WITH_SECONDS(){return eMe}}function VR(t){if(Oi.isDateTime(t))return t;if(t&&t.valueOf&&yx(t.valueOf()))return Oi.fromJSDate(t);if(t&&typeof t=="object")return Oi.fromObject(t);throw new Np(`Unknown datetime argument: ${t}, of type ${typeof t}`)}function lnt(t,e="system"){if(!t||!fde.has(t.timeZone))return e;const r=fde.get(t.timeZone);return unt(t.timeZone)||t.respectsDaylightSaving?r:cnt(r)}function cnt(t){const e=Oi.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${qc.instance(-r).formatOffset(0,"narrow")}`}function unt(t){return t.startsWith("UTC")}let b1=class extends Fn(Qe){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,r){const{timeZone:i,respectsDaylightSaving:s}=r;return{timeZone:i,respectsDaylightSaving:s}}readTimeZone(e,r){return"timeZoneIANA"in r?r.timeZoneIANA:lnt(r)}writeTimeZone(e,r){r.timeZoneIANA=e}equals(e){return!(N(e)||N(this.timeZone)||N(e.timeZone))&&this.timeZone===e.timeZone}};u([d()],b1.prototype,"legacy",void 0),u([ft("legacy",["timeZone"])],b1.prototype,"readLegacy",null),u([d({type:String,nonNullable:!0})],b1.prototype,"timeZone",void 0),u([ft("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],b1.prototype,"readTimeZone",null),u([St("timeZone")],b1.prototype,"writeTimeZone",null),b1=u([j("esri.time.TimeReference")],b1);const tM=b1;let DA=class extends Fn(Qe){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};u([d()],DA.prototype,"creatorField",void 0),u([d()],DA.prototype,"creationDateField",void 0),u([d()],DA.prototype,"editorField",void 0),u([d()],DA.prototype,"editDateField",void 0),u([d()],DA.prototype,"realm",void 0),u([d({type:tM})],DA.prototype,"dateFieldsTimeReference",void 0),DA=u([j("esri.layers.support.EditFieldsInfo")],DA);const hnt=DA;let Km=class extends Fn(Qe){constructor(e){super(e)}};u([d({constructOnly:!0,json:{write:!0}})],Km.prototype,"name",void 0),u([d({constructOnly:!0,json:{write:!0}})],Km.prototype,"fields",void 0),u([d({constructOnly:!0,json:{write:!0}})],Km.prototype,"isAscending",void 0),u([d({constructOnly:!0,json:{write:!0}})],Km.prototype,"indexType",void 0),u([d({constructOnly:!0,json:{write:!0}})],Km.prototype,"isUnique",void 0),u([d({constructOnly:!0,json:{write:!0}})],Km.prototype,"description",void 0),Km=u([j("esri.layers.support.FeatureIndex")],Km);const nZ=new Ui({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function dnt(t,e,r,i){const s=await Rb(t);if(await Hie(t,e,i),!s.addAttachment)throw new ce(i,"Layer source does not support addAttachment capability");return s.addAttachment(e,r)}function Hie(t,e,r){const{attributes:i}=e,{objectIdField:s}=t;return t.get("capabilities.data.supportsAttachment")?e?i?s&&i[s]?Promise.resolve():Promise.reject(new ce(r,`feature is missing the identifying attribute ${s}`)):Promise.reject(new ce(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new ce(r,"A feature is required to add/delete/update attachments")):Promise.reject(new ce(r,"this layer doesn't support attachments"))}async function pnt(t,e,r,i,s){const n=await Rb(t);if(await Hie(t,e,s),!n.updateAttachment)throw new ce(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,r,i)}async function fnt(t,e,r){const i=await be(()=>import("./editingSupport-2d4c6c0d.js"),["assets/editingSupport-2d4c6c0d.js","assets/assetEditingSupport-2cebf928.js"]),s=await t.load();return i.applyEdits(s,s.source,e,r)}async function mnt(t,e,r,i){const s=await Rb(t);if(await Hie(t,e,i),!s.deleteAttachments)throw new ce(i,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,r)}async function gnt(t,e,r){const i=(await t.load({signal:e==null?void 0:e.signal})).source;if(!i.fetchRecomputedExtents)throw new ce(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(e)}async function Ant(t,e,r,i){var _,w;e=PQ.from(e),await t.load();const s=t.source,n=t.capabilities;if(!((_=n==null?void 0:n.data)!=null&&_.supportsAttachment))throw new ce(i,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:p,where:A}=e;if(!((w=n==null?void 0:n.operations)!=null&&w.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(h==null?void 0:h.length)>0||c||p||A))throw new ce(i,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||A))throw new ce(i,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new ce(i,"Layer source does not support queryAttachments capability",e);return s.queryAttachments(e)}async function ynt(t,e,r,i){const s=await Rb(t);if(!s.queryObjectIds)throw new ce(i,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(Tg.from(e)??t.createQuery(),r)}async function _nt(t,e,r,i){const s=await Rb(t);if(!s.queryFeatureCount)throw new ce(i,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(Tg.from(e)??t.createQuery(),r)}async function vnt(t,e,r,i){const s=await Rb(t);if(!s.queryExtent)throw new ce(i,"Layer source does not support queryExtent capability");return s.queryExtent(Tg.from(e)??t.createQuery(),r)}async function bnt(t,e,r,i){const s=await Rb(t);if(!s.queryRelatedFeatures)throw new ce(i,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(X3.from(e),r)}async function wnt(t,e,r,i){const s=await Rb(t);if(!s.queryRelatedFeaturesCount)throw new ce(i,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(X3.from(e),r)}async function xnt(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:r,updates:i}=await e.refresh();if(E(i)&&(t.sourceJSON={...t.sourceJSON,...i},t.read(i,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await grt(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function Tnt(t){const e=new Tg,r=t.get("capabilities.data"),i=t.get("capabilities.query");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function LMe(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeGlobalID")return i.name}}function DMe(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeOID")return i.name}}function Snt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function Rb(t){return(await t.load()).source}async function Ent(t,e){if(!Os||Os.findCredential(t))return;let r;try{const i=await e2e(t,e);i&&(r=await Os.checkSignInStatus(`${i}/sharing`))}catch{}if(r)try{const i=E(e)?e.signal:null;await Os.getCredential(t,{signal:i})}catch{}}async function Cnt(t,e){var s;const r=(s=t.parsedUrl)==null?void 0:s.path;if(!r)return;const i=t.editFieldsInfo;(t.userHasUpdateItemPrivileges||t.userHasFullEditingPrivileges&&t.capabilities.operations.supportsEditing||i!=null&&i.creatorField||i!=null&&i.editorField)&&await Ent(r,e)}function Mnt(t){var e;return!((e=t.sourceJSON)!=null&&e.isMultiServicesView)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}let TE=class extends Fn(Qe){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],TE.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],TE.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:t=>Q7e.read(t)||X7e.read(t)}})],TE.prototype,"units",void 0),TE=u([j("esri.layers.support.GeometryFieldsInfo")],TE);const Rnt=TE;var oZ;let SE=oZ=class extends Qe{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new or}clone(){return new oZ({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],SE.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],SE.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],SE.prototype,"viewAllLevelIds",void 0),SE=oZ=u([j("esri.layers.support.LayerFloorInfo")],SE);const Ont=SE,Ude=new Ui({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Vde=new Ui({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let _p=class extends Fn(Qe){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:Ude.read,write:Ude.write}})],_p.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],_p.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],_p.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],_p.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],_p.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],_p.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],_p.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],_p.prototype,"relationshipTableId",void 0),u([d({json:{read:Vde.read,write:Vde.write}})],_p.prototype,"role",void 0),_p=u([j("esri.layers.support.Relationship")],_p);const Pnt=_p,Int={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function Ur(t,e,r){return!!(t&&t.hasOwnProperty(e)?t[e]:r)}function _5(t,e,r){return t&&t.hasOwnProperty(e)?t[e]:r}function $nt(t){var r;const e=(r=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:r.map(i=>i.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function DL(t,e){var i;const r=(i=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:i.map(s=>s.toLowerCase());return!!(r!=null&&r.includes(e.toLowerCase()))}function NMe(t,e){return{analytics:Lnt(t),attachment:Dnt(t),data:Nnt(t),metadata:Fnt(t),operations:knt(t.capabilities,t,e),query:Bnt(t,e),queryRelated:Unt(t),queryTopFeatures:Vnt(t),editing:znt(t)}}function Lnt(t){return{supportsCacheHint:DL(t.advancedQueryCapabilities,"queryAnalytics")}}function Dnt(t){const e=t.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:DL(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:Ur(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(i=>{const s=Int[i.name];s&&(r[s]=!!i.isEnabled)}),r}function Nnt(t){return{isVersioned:Ur(t,"isDataVersioned",!1),supportsAttachment:Ur(t,"hasAttachments",!1),supportsM:Ur(t,"hasM",!1),supportsZ:Ur(t,"hasZ",!1)}}function Fnt(t){return{supportsAdvancedFieldProperties:Ur(t,"supportsFieldDescriptionProperty",!1)}}function knt(t,e,r){const i=t?t.toLowerCase().split(",").map(A=>A.trim()):[],s=r?jM(r):null,n=i.includes(E(s)&&s.serverType==="MapServer"?"data":"query"),o=i.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&i.includes("create"),l=o&&i.includes("delete"),c=o&&i.includes("update");const h=i.includes("changetracking"),p=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:Ur(e,"supportsCalculate",!1),supportsTruncate:Ur(e,"supportsTruncate",!1),supportsValidateSql:Ur(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:n,supportsQueryAnalytics:Ur(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:Ur(p,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Ur(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Ur(e,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:Ur(e,"supportsExceedsLimitStatistics",!1)}}function Bnt(t,e){const r=t.advancedQueryCapabilities,i=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||n>=Le("mapserver-pbf-version-support"),l=M3e(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{supportsStatistics:Ur(r,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:Ur(r,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Ur(r,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:$nt(r),supportsCentroid:Ur(r,"supportsReturningGeometryCentroid",!1),supportsDistance:Ur(r,"supportsQueryWithDistance",!1),supportsDistinct:Ur(r,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:Ur(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Ur(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:Ur(r,"supportsHavingClause",!1),supportsOrderBy:Ur(r,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:Ur(r,"supportsPagination",!1),supportsQuantization:Ur(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Ur(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Ur(t,"supportsReturningQueryGeometry",!1),supportsResultType:Ur(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Ur(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Ur(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Ur(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Ur(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Ur(i,"allowOthersToQuery",!0),supportsHistoricMoment:Ur(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:Ur(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:Ur(r,"supportsQueryWithCacheHint",!1)||DL(r,"query"),supportsDefaultSpatialReference:Ur(r,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:Ur(r,"supportsFullTextSearch",!1),maxRecordCountFactor:_5(t,"maxRecordCountFactor",void 0),maxRecordCount:_5(t,"maxRecordCount",void 0),standardMaxRecordCount:_5(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:_5(t,"tileMaxRecordCount",void 0)}}function Unt(t){const e=t.advancedQueryCapabilities,r=Ur(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Ur(e,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:DL(e,"queryRelated")}}function Vnt(t){return{supportsCacheHint:DL(t.advancedQueryCapabilities,"queryTopFilter")}}function znt(t){const e=t.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Ur(t,"allowGeometryUpdates",!0),supportsGlobalId:Ur(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Ur(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Ur(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Ur(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Ur(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Ur(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Ur(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Ur(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Ur(e,"allowOthersToUpdate",!0)}}const Gnt=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=xt.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(or.ofType(Km)),this.version=void 0}readCapabilitiesFromService(r,i){return NMe(i,this.url)}get effectiveCapabilities(){var o;const r=this.capabilities;if(!r)return null;const i=Te(r),{operations:s,editing:n}=i;return(o=this.sourceJSON)!=null&&o.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),i):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,i):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),i)}readEditingInfo(r,i){const{editingInfo:s}=i;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}readIsTableFromService(r,i){return i.type==="Table"}readMinScale(r,i){return i.effectiveMinScale||r||0}readMaxScale(r,i){return i.effectiveMaxScale||r||0}readGlobalIdFieldFromService(r,i){return LMe(i)}readObjectIdFieldFromService(r,i){return DMe(i)}readServiceDefinitionExpression(r,i){return i.definitionQuery||i.definitionExpression}set url(r){const i=Urt({layer:this,url:r,nonStandardUrlAllowed:!0,logger:we.getLogger(this.declaredClass)});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){Vrt(this,r,null,i,n)}readVersion(r,i){return Snt(i)}};return u([d({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([ft("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([d({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([d({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([d({type:tM})],e.prototype,"dateFieldsTimeReference",void 0),u([d({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([d({readOnly:!0,type:hnt})],e.prototype,"editFieldsInfo",void 0),u([d({readOnly:!0})],e.prototype,"editingInfo",void 0),u([ft("editingInfo")],e.prototype,"readEditingInfo",null),u([d((()=>{const r=Te(sit),i=r.json.origins;return i["web-map"]={read:!1,write:!1},i["portal-item"]={read:!1,write:!1},r})())],e.prototype,"elevationInfo",void 0),u([d({type:Ont,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],e.prototype,"floorInfo",void 0),u([d({type:Ki,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([d()],e.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:Rnt,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:nZ.read}}}})],e.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([d({readOnly:!0,type:NM})],e.prototype,"heightModelInfo",void 0),u([d({type:Date})],e.prototype,"historicMoment",void 0),u([d({readOnly:!0})],e.prototype,"isTable",void 0),u([ft("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([d(ait)],e.prototype,"minScale",void 0),u([ft("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([d(lit)],e.prototype,"maxScale",void 0),u([ft("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([d({type:String})],e.prototype,"globalIdField",void 0),u([ft("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([d({type:String})],e.prototype,"objectIdField",void 0),u([ft("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([d({type:tM})],e.prototype,"preferredTimeReference",void 0),u([d({type:[Pnt],readOnly:!0})],e.prototype,"relationships",void 0),u([d()],e.prototype,"sourceJSON",void 0),u([d({type:Boolean})],e.prototype,"returnM",void 0),u([d({type:Boolean})],e.prototype,"returnZ",void 0),u([d({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([ft("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([d({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([d({type:xt,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([d({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([d({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([d({type:or.ofType(Km),readOnly:!0})],e.prototype,"indexes",void 0),u([d(rit)],e.prototype,"url",null),u([St("url")],e.prototype,"writeUrl",null),u([d({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([ft("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([j("esri.layers.mixins.FeatureLayerBase")],e),e};let EE=class extends Fn(Qe){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([d({type:String,json:{write:!0}})],EE.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],EE.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],EE.prototype,"returnType",void 0),EE=u([j("esri.layers.support.ExpressionInfo")],EE);const qie=EE;var aZ;let NA=aZ=class extends Qe{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new aZ({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:Te(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([d({type:Boolean,json:{write:!0}})],NA.prototype,"isAutoGenerated",void 0),u([d({type:String,json:{write:!0}})],NA.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],NA.prototype,"alias",void 0),u([d({type:String,json:{write:!0}})],NA.prototype,"onStatisticField",void 0),u([d({type:qie,json:{write:!0}})],NA.prototype,"onStatisticExpression",void 0),u([d({type:String,json:{write:!0}})],NA.prototype,"statisticType",void 0),NA=aZ=u([j("esri.layers.support.AggregateField")],NA);const Zx=NA;let Bv=class extends Qe{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Bv.prototype,"type",void 0),Bv=u([j("esri.layers.support.FeatureReduction")],Bv);const Wie="__begin__",Yie="__end__",jnt=new RegExp(Wie,"ig"),Hnt=new RegExp(Yie,"ig"),zde=new RegExp("^"+Wie,"i"),Gde=new RegExp(Yie+"$","i"),o9='"',qnt=o9+" + ",Wnt=" + "+o9;function Ynt(t){return t.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function Qnt(t){return t.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function HU(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=Ynt(t.labelExpression),e.type="conventional"),e}function Xnt(t){const e=HU(t);if(!e)return null;switch(e.type){case"conventional":return lZ(e.expression);case"arcade":return e.expression}return null}function Znt(t){const e=HU(t);if(!e)return null;switch(e.type){case"conventional":return Knt(e.expression);case"arcade":return Qie(e.expression)}return null}function lZ(t){let e;return t?(e=Og(t,r=>Wie+'$feature["'+r+'"]'+Yie),e=zde.test(e)?e.replace(zde,""):o9+e,e=Gde.test(e)?e.replace(Gde,""):e+o9,e=e.replace(jnt,qnt).replace(Hnt,Wnt)):e='""',e}const Jnt=/^\s*\{([^}]+)\}\s*$/i;function Knt(t){const e=t==null?void 0:t.match(Jnt);return e&&e[1].trim()||null}const eot=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,tot=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,rot=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function Qie(t){if(!t)return null;let e=eot.exec(t)||tot.exec(t);return e?e[1]||e[3]:(e=rot.exec(t),e?e[2]:null)}var cZ;let w1=cZ=class extends Qe{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?lZ(e.value):t}writeExpression(t,e,r){this.value!=null&&(t=lZ(this.value)),t!=null&&(e[r]=t)}clone(){return new cZ({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],w1.prototype,"expression",void 0),u([ft("expression",["expression","value"])],w1.prototype,"readExpression",null),u([St("expression")],w1.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],w1.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],w1.prototype,"value",void 0),w1=cZ=u([j("esri.layers.support.LabelExpressionInfo")],w1);const FMe=w1,kMe=[252,146,31,255],Z8t=[153,153,153,255],iot={type:"esriSMS",style:"esriSMSCircle",size:6,color:kMe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},sot={type:"esriSLS",style:"esriSLSSolid",width:.75,color:kMe},not={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},oot={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},aot={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},lot={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},cot={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},J8t=Cb.fromJSON(iot),K8t=mf.fromJSON(sot),ekt=Eb.fromJSON(not),uot=DM.fromJSON(oot);Cb.fromJSON(aot);mf.fromJSON(lot);Eb.fromJSON(cot);var uZ;const v5=new Ui({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function b5(t,e,r){return{enabled:!Jwe(r==null?void 0:r.layer)}}function BMe(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function hot(t){return(t==null?void 0:t.type)==="map-image"}function UMe(t){var e,r;return!!hot(t)&&!!((r=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&r.supportsArcadeExpressionForLabeling)}function dot(t){return BMe(t)||UMe(t==null?void 0:t.layer)}let Do=uZ=class extends Qe{static evaluateWhere(t,e){const r=(i,s,n)=>{switch(s){case"=":return i==n;case"<>":return i!=n;case">":return i>n;case">=":return i>=n;case"<":return i<n;case"<=":return i<=n}return!1};try{if(t==null)return!0;const i=t.split(" ");if(i.length===3)return r(e[i[0]],i[1],i[2]);if(i.length===7){const s=r(e[i[0]],i[1],i[2]),n=i[3],o=r(e[i[4]],i[5],i[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=uot,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const r=e.labelExpressionInfo;if(!r||!r.value&&!r.expression)return t}writeLabelExpression(t,e,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=Qnt(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=Qie(this.labelExpressionInfo.expression);i&&(t="["+i+"]")}}t!=null&&(e[r]=t)}writeLabelExpressionInfo(t,e,r,i){if(t==null&&this.labelExpression!=null&&BMe(i))t=new FMe({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(i);s.expression&&(e[r]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return HU(this)}getLabelExpressionArcade(){return Xnt(this)}getLabelExpressionSingleField(){return Znt(this)}hash(){return JSON.stringify(this)}clone(){return new uZ({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:Te(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:Te(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],Do.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:b5}}}}})],Do.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:b5}}}}})],Do.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(t,e,r){return this.labelExpressionInfo&&(r==null?void 0:r.origin)==="service"&&UMe(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],Do.prototype,"labelExpression",void 0),u([ft("labelExpression")],Do.prototype,"readLabelExpression",null),u([St("labelExpression")],Do.prototype,"writeLabelExpression",null),u([d({type:FMe,json:{write:{overridePolicy:(t,e,r)=>dot(r)?{allowNull:!0}:{enabled:!1}}}})],Do.prototype,"labelExpressionInfo",void 0),u([St("labelExpressionInfo")],Do.prototype,"writeLabelExpressionInfo",null),u([d({type:v5.apiValues,json:{type:v5.jsonValues,read:v5.read,write:v5.write}})],Do.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Do.prototype,"labelPosition",void 0),u([d({type:Number})],Do.prototype,"maxScale",void 0),u([St("maxScale")],Do.prototype,"writeMaxScale",null),u([d({type:Number})],Do.prototype,"minScale",void 0),u([St("minScale")],Do.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:b5}}}}})],Do.prototype,"repeatLabel",void 0),u([d({type:Number,cast:gs,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:b5}}}}})],Do.prototype,"repeatLabelDistance",void 0),u([d({types:OHe,json:{origins:{"web-scene":{types:PHe,write:zhe,default:null}},write:zhe,default:null}})],Do.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],Do.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],Do.prototype,"where",void 0),Do=uZ=u([j("esri.layers.support.LabelClass")],Do);const qU=Do;var hZ;const hG=bb({types:uU}),pot="esri.layers.support.FeatureReductionBinning";let Au=hZ=class extends Bv{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,r){const i=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Jc(r,i,e)}readRenderer(t,e,r){var s;const i=(s=e.drawingInfo)==null?void 0:s.renderer;return i?t9(i,e,r)??void 0:e.defaultSymbol?e.types&&e.types.length?new OL({defaultSymbol:hG(e.defaultSymbol,e,r),field:e.typeIdField,uniqueValueInfos:e.types.map(n=>({id:n.id,symbol:hG(n.symbol,n,r)}))}):new J3({symbol:hG(e.defaultSymbol,e,r)}):null}clone(){return new hZ({fields:Te(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:Te(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:Te(this.popupTemplate),renderer:Te(this.renderer)})}};u([er({binning:"binning"})],Au.prototype,"type",void 0),u([er({geohash:"geohash"})],Au.prototype,"binType",void 0),u([d({type:Number,range:{min:1,max:9},json:{write:!0}})],Au.prototype,"fixedBinLevel",void 0),u([d({type:[qU],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Au.prototype,"labelingInfo",void 0),u([d(Fie)],Au.prototype,"labelsVisible",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Au.prototype,"maxScale",void 0),u([d(Nie)],Au.prototype,"popupEnabled",void 0),u([d({type:PM,json:{name:"popupInfo",write:!0}})],Au.prototype,"popupTemplate",void 0),u([d({type:[Zx],json:{write:!0}})],Au.prototype,"fields",void 0),u([St("fields")],Au.prototype,"writeFields",null),u([d({types:UU,json:{write:{target:"drawingInfo.renderer"}}})],Au.prototype,"renderer",void 0),u([ft("renderer",["drawingInfo.renderer"])],Au.prototype,"readRenderer",null),Au=hZ=u([j(pot)],Au);const VMe=Au;var dZ;const dG=bb({types:uU}),fot="esri.layers.support.FeatureReductionCluster";function jde(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let xa=dZ=class extends Qe{constructor(t){super(t),this.type="cluster",this.clusterRadius=gs("80px"),this.clusterMinSize=gs("12px"),this.clusterMaxSize=gs("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,r){var s,n;const i=(s=e.drawingInfo)==null?void 0:s.renderer;return(n=i==null?void 0:i.authoringInfo)!=null&&n.isAutoGenerated?null:i?jde(i)?null:t9(i,e,r)??void 0:e.defaultSymbol?e.types&&e.types.length?new OL({defaultSymbol:dG(e.defaultSymbol,e,r),field:e.typeIdField,uniqueValueInfos:e.types.map(o=>({id:o.id,symbol:dG(o.symbol,o,r)}))}):new J3({symbol:dG(e.defaultSymbol,e,r)}):null}readSymbol(t,e,r){var s,n,o;const i=(s=e.drawingInfo)==null?void 0:s.renderer;return(n=i==null?void 0:i.authoringInfo)!=null&&n.isAutoGenerated?null:i&&jde(i)?(o=t9(i,e,r))==null?void 0:o.symbol:null}writeSymbol(t,e,r,i){var n,o;const s=(o=(n=this.renderer)==null?void 0:n.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||s){const a=new J3({symbol:t});e.drawingInfo={renderer:a.write({},i)}}}writeFields(t,e,r){const i=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Jc(r,i,e)}readFields(t,e,r){return t.filter(i=>!i.isAutoGenerated).map(i=>Zx.fromJSON(i))}clone(){return new dZ({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:Te(this.labelingInfo),labelsVisible:this.labelsVisible,fields:Te(this.fields),maxScale:this.maxScale,renderer:Te(this.renderer),symbol:Te(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:Te(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],xa.prototype,"type",void 0),u([d({type:Number,cast:t=>t==="auto"?t:gs(t),json:{write:!0}})],xa.prototype,"clusterRadius",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],xa.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:gs,json:{write:!0}})],xa.prototype,"clusterMaxSize",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],xa.prototype,"maxScale",void 0),u([d(Nie)],xa.prototype,"popupEnabled",void 0),u([d({type:PM,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],xa.prototype,"popupTemplate",void 0),u([d({types:UU,json:{write:{target:"drawingInfo.renderer"}}})],xa.prototype,"renderer",void 0),u([ft("renderer",["drawingInfo.renderer"])],xa.prototype,"readRenderer",null),u([d({types:MHe})],xa.prototype,"symbol",void 0),u([ft("symbol",["drawingInfo.renderer"])],xa.prototype,"readSymbol",null),u([St("symbol")],xa.prototype,"writeSymbol",null),u([d({type:[qU],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],xa.prototype,"labelingInfo",void 0),u([d(Fie)],xa.prototype,"labelsVisible",void 0),u([d({type:[Zx],json:{write:!0}})],xa.prototype,"fields",void 0),u([St("fields")],xa.prototype,"writeFields",null),u([ft("fields")],xa.prototype,"readFields",null),xa=dZ=u([j(fot)],xa);const zMe=xa;var pZ;let U6=pZ=class extends Bv{constructor(t){super(t),this.type="selection"}clone(){return new pZ}};u([d({type:["selection"]})],U6.prototype,"type",void 0),U6=pZ=u([j("esri.layers.support.FeatureReductionSelection")],U6);const Hde=U6,qde={key:"type",base:Bv,typeMap:{cluster:zMe,binning:VMe}},mot={types:{key:"type",base:Bv,typeMap:{selection:Hde,cluster:zMe,binning:VMe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:qde},"portal-item":{types:qde},"web-scene":{types:{key:"type",base:Bv,typeMap:{selection:Hde}}}}}},QT={Base64:0,Hex:1,String:2,Raw:3},e3=8,GMe=(1<<e3)-1;function wv(t,e){const r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function got(t){const e=[];for(let r=0,i=t.length*e3;r<i;r+=e3)e[r>>5]|=(t.charCodeAt(r/e3)&GMe)<<r%32;return e}function Aot(t){const e=[];for(let r=0,i=32*t.length;r<i;r+=e3)e.push(String.fromCharCode(t[r>>5]>>>r%32&GMe));return e.join("")}function yot(t){const e="0123456789abcdef",r=[];for(let i=0,s=4*t.length;i<s;i++)r.push(e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15));return r.join("")}function _ot(t){const e="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?i.push(e):i.push(r.charAt(o>>6*(3-a)&63))}return i.join("")}function vot(t,e){return t<<e|t>>>32-e}function WU(t,e,r,i,s,n){return wv(vot(wv(wv(e,t),wv(i,n)),s),r)}function xc(t,e,r,i,s,n,o){return WU(e&r|~e&i,t,e,s,n,o)}function Tc(t,e,r,i,s,n,o){return WU(e&i|r&~i,t,e,s,n,o)}function Sc(t,e,r,i,s,n,o){return WU(e^r^i,t,e,s,n,o)}function Ec(t,e,r,i,s,n,o){return WU(r^(e|~i),t,e,s,n,o)}function bot(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let r=1732584193,i=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=r,l=i,c=s,h=n;r=xc(r,i,s,n,t[o+0],7,-680876936),n=xc(n,r,i,s,t[o+1],12,-389564586),s=xc(s,n,r,i,t[o+2],17,606105819),i=xc(i,s,n,r,t[o+3],22,-1044525330),r=xc(r,i,s,n,t[o+4],7,-176418897),n=xc(n,r,i,s,t[o+5],12,1200080426),s=xc(s,n,r,i,t[o+6],17,-1473231341),i=xc(i,s,n,r,t[o+7],22,-45705983),r=xc(r,i,s,n,t[o+8],7,1770035416),n=xc(n,r,i,s,t[o+9],12,-1958414417),s=xc(s,n,r,i,t[o+10],17,-42063),i=xc(i,s,n,r,t[o+11],22,-1990404162),r=xc(r,i,s,n,t[o+12],7,1804603682),n=xc(n,r,i,s,t[o+13],12,-40341101),s=xc(s,n,r,i,t[o+14],17,-1502002290),i=xc(i,s,n,r,t[o+15],22,1236535329),r=Tc(r,i,s,n,t[o+1],5,-165796510),n=Tc(n,r,i,s,t[o+6],9,-1069501632),s=Tc(s,n,r,i,t[o+11],14,643717713),i=Tc(i,s,n,r,t[o+0],20,-373897302),r=Tc(r,i,s,n,t[o+5],5,-701558691),n=Tc(n,r,i,s,t[o+10],9,38016083),s=Tc(s,n,r,i,t[o+15],14,-660478335),i=Tc(i,s,n,r,t[o+4],20,-405537848),r=Tc(r,i,s,n,t[o+9],5,568446438),n=Tc(n,r,i,s,t[o+14],9,-1019803690),s=Tc(s,n,r,i,t[o+3],14,-187363961),i=Tc(i,s,n,r,t[o+8],20,1163531501),r=Tc(r,i,s,n,t[o+13],5,-1444681467),n=Tc(n,r,i,s,t[o+2],9,-51403784),s=Tc(s,n,r,i,t[o+7],14,1735328473),i=Tc(i,s,n,r,t[o+12],20,-1926607734),r=Sc(r,i,s,n,t[o+5],4,-378558),n=Sc(n,r,i,s,t[o+8],11,-2022574463),s=Sc(s,n,r,i,t[o+11],16,1839030562),i=Sc(i,s,n,r,t[o+14],23,-35309556),r=Sc(r,i,s,n,t[o+1],4,-1530992060),n=Sc(n,r,i,s,t[o+4],11,1272893353),s=Sc(s,n,r,i,t[o+7],16,-155497632),i=Sc(i,s,n,r,t[o+10],23,-1094730640),r=Sc(r,i,s,n,t[o+13],4,681279174),n=Sc(n,r,i,s,t[o+0],11,-358537222),s=Sc(s,n,r,i,t[o+3],16,-722521979),i=Sc(i,s,n,r,t[o+6],23,76029189),r=Sc(r,i,s,n,t[o+9],4,-640364487),n=Sc(n,r,i,s,t[o+12],11,-421815835),s=Sc(s,n,r,i,t[o+15],16,530742520),i=Sc(i,s,n,r,t[o+2],23,-995338651),r=Ec(r,i,s,n,t[o+0],6,-198630844),n=Ec(n,r,i,s,t[o+7],10,1126891415),s=Ec(s,n,r,i,t[o+14],15,-1416354905),i=Ec(i,s,n,r,t[o+5],21,-57434055),r=Ec(r,i,s,n,t[o+12],6,1700485571),n=Ec(n,r,i,s,t[o+3],10,-1894986606),s=Ec(s,n,r,i,t[o+10],15,-1051523),i=Ec(i,s,n,r,t[o+1],21,-2054922799),r=Ec(r,i,s,n,t[o+8],6,1873313359),n=Ec(n,r,i,s,t[o+15],10,-30611744),s=Ec(s,n,r,i,t[o+6],15,-1560198380),i=Ec(i,s,n,r,t[o+13],21,1309151649),r=Ec(r,i,s,n,t[o+4],6,-145523070),n=Ec(n,r,i,s,t[o+11],10,-1120210379),s=Ec(s,n,r,i,t[o+2],15,718787259),i=Ec(i,s,n,r,t[o+9],21,-343485551),r=wv(r,a),i=wv(i,l),s=wv(s,c),n=wv(n,h)}return[r,i,s,n]}function jMe(t,e=QT.Hex){const r=e||QT.Base64,i=bot(got(t),t.length*e3);switch(r){case QT.Raw:return i;case QT.Hex:return yot(i);case QT.String:return Aot(i);case QT.Base64:return _ot(i)}}var fZ;let EP=fZ=class extends BU{writeLevels(t,e,r){for(const i in t){const s=this.levels[i];return void(e.stops=s)}}clone(){return new fZ({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:bv(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:bv(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:Te(this.levels)})}};u([d()],EP.prototype,"levels",void 0),u([St("levels")],EP.prototype,"writeLevels",null),EP=fZ=u([j("esri.views.2d.engine.LevelDependentSizeVariable")],EP);const wot=we.getLogger("esri.views.2d.layers.support.clusterUtils");Le.add("esri-cluster-arcade-enabled",!0);const xot=Le("esri-cluster-arcade-enabled"),Tot=(t,e,r,i,s)=>{const n=e.clone();if(!Mot(n))return n;if(n.authoringInfo||(n.authoringInfo=new Mie),n.authoringInfo.isAutoGenerated=!0,"visualVariables"in n){const o=(n.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=Sot(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=Hb(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=zR(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=Hb(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=Hb(t,l.field,"avg","number"):l.valueExpression&&(l.field=zR(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),N(a)&&!Eot(o)&&s&&(o.push(Cot(r,i)),n.dynamicClusterSize=!0),n.visualVariables=o}switch(n.type){case"simple":break;case"pie-chart":for(const o of n.attributes)o.field?o.field=Hb(t,o.field,"sum","number"):o.valueExpression&&(o.field=zR(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":n.field?n.field=Hb(t,n.field,"mode","string"):n.valueExpression&&(n.field=zR(t,n.valueExpression,"mode","string"),n.valueExpression=null);break;case"class-breaks":n.normalizationField?(n.field=Hb(t,n.field,"avg_norm","number",n.normalizationField),n.normalizationField=null):n.field?n.field=Hb(t,n.field,"avg","number"):n.valueExpression&&(n.field=zR(t,n.valueExpression,"avg","number"),n.valueExpression=null)}return n},Sot=t=>{for(const e of t)if(e.type==="size")return e;return null},Eot=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},Cot=(t,e)=>{const r=[new yE({value:0,size:0}),new yE({value:1})];if(N(e))return new BU({field:"cluster_count",stops:[...r,new yE({value:2,size:0})]});const i=Object.keys(e).reduce((s,n)=>({...s,[n]:[...r,new yE({value:Math.max(2,e[n].minValue),size:t.clusterMinSize}),new yE({value:Math.max(3,e[n].maxValue),size:t.clusterMaxSize})]}),{});return new EP({field:"cluster_count",levels:i})},Mot=t=>{const e=r=>wot.error(new ce("Unsupported-renderer",r,{renderer:t}));switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const r=t.normalizationType;if(r!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!xot){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(r=>!(!("valueExpression"in r)||!r.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function Rot(t,e,r){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const i=r,s="field",n=e.toLowerCase()+",norm:"+s+","+i.toLowerCase();return"cluster_avg_"+jMe(n)}}}function zR(t,e,r,i){const s=jMe(e),n=r==="mode"?`cluster_type_${s}`:r==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new Zx({name:n,isAutoGenerated:!0,onStatisticExpression:new qie({expression:e,returnType:i}),statisticType:r})),n}function Hb(t,e,r,i,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=Rot(r,e,s);return t.some(o=>o.name===n)||(r==="avg_norm"?t.push(new Zx({name:n,isAutoGenerated:!0,onStatisticExpression:new qie({expression:`$feature.${e} / $feature.${s}`,returnType:i}),statisticType:"avg"})):t.push(new Zx({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:r}))),n}const Oot=t=>{let e=class extends t{constructor(...r){super(...r),this.own(this.watch("renderer",()=>{if(this.featureReduction){const i=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",i)}},!0))}set featureReduction(r){const i=this._normalizeFeatureReduction(r);this._set("featureReduction",i)}set renderer(r){}_normalizeFeatureReduction(r){var a;if((r==null?void 0:r.type)!=="cluster")return r;const i=r.clone(),s=[new Zx({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(i.fields??[]).filter(l=>!l.isAutoGenerated);if(r.renderer&&!((a=r.renderer.authoringInfo)!=null&&a.isAutoGenerated))return i.fields=[...s,...n],i;if(r.symbol)return i.fields=[...s,...n],i.renderer=null,i;if(!this.renderer)return r;const o=Tot(s,this.renderer,r,null,!1);return i.fields=[...s,...n],i.renderer=o,i}};return u([d(mot)],e.prototype,"featureReduction",null),e=u([j("esri.layers.mixins.FeatureReductionLayer")],e),e},Pot={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}},Iot=t=>{let e=class extends t{constructor(){super(...arguments),this.title=null}writeListMode(r,i,s,n){(n&&n.layerContainerType==="ground"||r&&UUe(this,s,{},n))&&(i[s]=r)}writeOperationalLayerType(r,i,s,n){!r||n&&n.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r??"Layer"}read(r,i){i&&(i.layer=this),FUe(this,r,s=>super.read(r,s),i)}write(r,i){var o,a;if(i!=null&&i.origin){const l=`${i.origin}/${i.layerContainerType||"operational-layers"}`,c=Pot[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(h=!1),!h)return(o=i.messages)==null||o.push(new ce("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(r,{...i,layer:this}),n=!!i&&!!i.messages&&!!i.messages.filter(l=>l instanceof ce&&l.name==="web-document-write:property-required").length;return O3(s==null?void 0:s.url)?((a=i==null?void 0:i.messages)==null||a.push(new ce("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([d(L3e)],e.prototype,"listMode",void 0),u([St("listMode")],e.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],e.prototype,"operationalLayerType",void 0),u([St("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([d(JX)],e.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([St("title"),St(["web-scene"],"title")],e.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],e.prototype,"visible",void 0),e=u([j("esri.layers.mixins.OperationalLayer")],e),e};var mZ;const pG=new Ui({asc:"ascending",desc:"descending"});let CE=mZ=class extends Qe{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new mZ({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],CE.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],CE.prototype,"valueExpression",void 0),u([d({type:pG.apiValues,json:{read:pG.read,write:pG.write}})],CE.prototype,"order",void 0),CE=mZ=u([j("esri.layers.support.OrderByInfo")],CE);const HMe=CE;function $ot(t,e,r){if(!t)return null;const i=t.find(n=>!!n.field);if(!i)return null;const s=new HMe;return s.read(i,r),[s]}function Lot(t,e,r,i){const s=t.find(n=>!!n.field);s&&Jc(r,[s.toJSON()],e)}const Dot=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[HMe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:$ot},write:{target:"layerDefinition.orderBy",writer:Lot}}})],e.prototype,"orderBy",void 0),e=u([j("esri.layers.mixins.OrderedLayer")],e),e};async function Not(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return dC(t);const r=xt.WGS84;return await Uqe(e,r),TT(t,r)}function tkt(t,e){if(!Fot(t,e)){const r=t.typeKeywords;r?r.push(e):t.typeKeywords=[e]}}function Fot(t,e){var r;return!!((r=t.typeKeywords)!=null&&r.includes(e))}function rkt(t,e){const r=t.typeKeywords;if(r){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}async function ikt(t){const e=t.clone().normalize();let r;if(e.length>1)for(const i of e)r?i.width>r.width&&(r=i):r=i;else r=e[0];return Not(r)}const skt={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"};function Wde(t){var l;const{portal:e,isOrgItem:r,itemControl:i}=t,s=(l=e.user)==null?void 0:l.privileges;let n=!s||s.includes("features:user:edit"),o=!!r&&!!(s!=null&&s.includes("features:user:fullEdit"));const a=i==="update"||i==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}const kot=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=gt(this.portalItem)}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,s){if(i.itemId)return new SI({id:i.itemId,portal:s&&s.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const s=await be(()=>import("./layersLoader-56a70219.js"),["assets/layersLoader-56a70219.js","assets/fetchService-8fe88712.js","assets/jsonContext-94bb4053.js"]);return di(i),await s.load({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(s){throw vo(s)||we.getLogger(this.declaredClass).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(Sh(i),!0)))}async _setUserPrivileges(r,i){if(!ls.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(i);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(r,i);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){Sh(s)}}async _fetchUserPrivileges(r,i){let s=this.portalItem;if(!r||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(i);const n=r===s.id;if(n&&s.portal.user)return Wde(s);let o,a;if(n)o=s.portal.url;else try{o=await e2e(this.url,i)}catch(p){Sh(p)}if(!o||!d7e(o,s.portal.url))return this._fetchFallbackUserPrivileges(i);try{const p=E(i)?i.signal:null;a=await(Os==null?void 0:Os.getCredential(`${o}/sharing`,{prompt:!1,signal:p}))}catch(p){Sh(p)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(n?await s.reload():(s=new SI({id:r,portal:{url:o}}),await s.load(i)),s.portal.user)return Wde(s)}catch(p){Sh(p)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(r){let i=!0;try{i=await this._fetchUserHasEditingPrivileges(r)}catch(s){Sh(s)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const i=this.url?Os==null?void 0:Os.findCredential(this.url):null;if(!i)return!0;const s=w5.credential===i?w5.user:await this._fetchEditingUser(r);return w5.credential=i,w5.user=s,N(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(r){var h,p;const i=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(i)return i;const s=Os.findServerInfo(this.url??"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=zu.getDefault();if(o&&o.loaded&&O0(o.restUrl)===O0(n))return o.user;const a=`${n}/community/self`,l=E(r)?r.signal:null,c=await B0(Ys(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?Fte.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const s=i&&i.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||zu.getDefault());return s&&n&&!gwe(n.restUrl,s.restUrl)?(i.messages&&i.messages.push(new ce("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return u([d({type:SI})],e.prototype,"portalItem",null),u([ft("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([St("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([d({clonable:!1})],e.prototype,"resourceReferences",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([j("esri.layers.mixins.PortalLayer")],e),e},w5={credential:null,user:null};let CP=class extends Ke{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([d()],CP.prototype,"updating",void 0),u([d()],CP.prototype,"status",void 0),CP=u([j("esri.layers.support.PublishingInfo")],CP);const Bot=CP,qMe="esri.layers.mixins.PublishableLayer",Uot=Symbol(qMe),Vot=t=>{var e;let r=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const i=this._get("publishingInfo");if(i)return i;const s=new Bot;return this._checkPublishingStatus(s),s}_checkPublishingStatus(i){let o=0;const a=async c=>{let h;i.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(i.status==="publishing"&&this.refresh(),l.remove()),i.status=h,i.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return e=Uot,u([d({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=u([j(qMe)],r),r},d4=new or,jI=new WeakMap;function zot(t){WMe(t)&&d4.push(t)}function Got(t){WMe(t)&&d4.includes(t)&&d4.remove(t)}function WMe(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function YMe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:YMe(e,t%e):0}let fG=0,x5=0;function jot(){const t=Date.now();for(const e of d4)e.refreshInterval&&t-(jI.get(e)??0)+5>=6e4*e.refreshInterval&&(jI.set(e,t),e.refresh(t))}Lbe(()=>{const t=Date.now();let e=0;for(const r of d4)e=YMe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?jI.get(r)||jI.set(r,t):jI.delete(r);if(e!==x5){if(x5=e,clearInterval(fG),x5===0)return void(fG=0);fG=setInterval(jot,x5)}});function Hot(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const qot=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=Cbe(()=>this.hasDataChanged()),this.when().then(()=>{zot(this)},()=>{})}destroy(){Got(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){UC(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{we.getLogger(this.declaredClass).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([d()],e.prototype,"refreshParameters",null),e=u([j("esri.layers.mixins.RefreshableLayer")],e),e},QMe=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&Wot(r,i.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===r.minScale&&s.maxScale===r.maxScale?s:r}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([d({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([j("esri.layers.mixins.ScaleRangeLayer")],e),e};function Wot(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}const XMe=hc()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let MP=class extends Fn(Qe){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return met(this.value,this.unit,"milliseconds")}};u([er(XMe,{nonNullable:!0})],MP.prototype,"unit",void 0),u([d({type:Number,json:{write:!0},nonNullable:!0})],MP.prototype,"value",void 0),MP=u([j("esri.TimeInterval")],MP);const a9=MP;function Yde(t,e){return a9.fromJSON({value:t,unit:e})}let Lc=class extends Fn(Qe){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,r){if(!r.timeExtent||!Array.isArray(r.timeExtent)||r.timeExtent.length!==2)return null;const i=new Date(r.timeExtent[0]),s=new Date(r.timeExtent[1]);return new Wg({start:i,end:s})}writeFullTimeExtent(e,r){e&&E(e.start)&&E(e.end)?r.timeExtent=[e.start.getTime(),e.end.getTime()]:r.timeExtent=null}readInterval(e,r){return r.timeInterval&&r.timeIntervalUnits?Yde(r.timeInterval,r.timeIntervalUnits):r.defaultTimeInterval&&r.defaultTimeIntervalUnits?Yde(r.defaultTimeInterval,r.defaultTimeIntervalUnits):null}writeInterval(e,r){r.timeInterval=(e==null?void 0:e.toJSON().value)??null,r.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};u([d({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Lc.prototype,"cumulative",void 0),u([d({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Lc.prototype,"endField",void 0),u([d({type:Wg,json:{write:{enabled:!0,allowNull:!0}}})],Lc.prototype,"fullTimeExtent",void 0),u([ft("fullTimeExtent",["timeExtent"])],Lc.prototype,"readFullTimeExtent",null),u([St("fullTimeExtent")],Lc.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Lc.prototype,"hasLiveData",void 0),u([d({type:a9,json:{write:{enabled:!0,allowNull:!0}}})],Lc.prototype,"interval",void 0),u([ft("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Lc.prototype,"readInterval",null),u([St("interval")],Lc.prototype,"writeInterval",null),u([d({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Lc.prototype,"startField",void 0),u([d({type:tM,json:{write:{enabled:!0,allowNull:!0}}})],Lc.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Lc.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Lc.prototype,"useTime",void 0),Lc=u([j("esri.layers.support.TimeInfo")],Lc);const ZMe=Lc,Yot=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const s=i.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=XMe.fromJSON(s.timeOffsetUnits);return n&&o?new a9({value:n,unit:o}):null}set timeInfo(r){H2e(r,this.fieldsIndex),this._set("timeInfo",r)}};return u([d({type:Wg,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([d({type:a9})],e.prototype,"timeOffset",void 0),u([ft("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([d({value:null,type:ZMe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=u([j("esri.layers.mixins.TemporalLayer")],e),e},Qde=new Ui({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let x1=class extends Fn(Qe){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],x1.prototype,"name",void 0),u([d({json:{write:!0}})],x1.prototype,"description",void 0),u([d({json:{read:Qde.read,write:Qde.write}})],x1.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],x1.prototype,"prototype",void 0),u([d({json:{write:!0}})],x1.prototype,"thumbnail",void 0),x1=u([j("esri.layers.support.FeatureTemplate")],x1);const Xie=x1;let FA=class extends Fn(Qe){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const r={};for(const i of Object.keys(e))r[i]=Aie(e[i]);return r}writeDomains(e,r){var s;const i={};for(const n of Object.keys(e))e[n]&&(i[n]=(s=e[n])==null?void 0:s.toJSON());r.domains=i}};u([d({json:{write:!0}})],FA.prototype,"id",void 0),u([d({json:{write:!0}})],FA.prototype,"name",void 0),u([d({json:{write:!0}})],FA.prototype,"domains",void 0),u([ft("domains")],FA.prototype,"readDomains",null),u([St("domains")],FA.prototype,"writeDomains",null),u([d({type:[Xie],json:{write:!0}})],FA.prototype,"templates",void 0),FA=u([j("esri.layers.support.FeatureType")],FA);const JMe=FA;function Qot(t){return t.type==="date"||t.type==="esriFieldTypeDate"}function Xde(t){return t.type==="oid"||t.type==="esriFieldTypeOID"}function Zde(t){return t.type==="global-id"||t.type==="esriFieldTypeGlobalID"}let Xot=class{constructor(e=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;this.fields=e;const r=[];for(const i of e){const s=i==null?void 0:i.name,n=Kde(i==null?void 0:i.name);if(s&&n){const o=Jde(s);this._fieldsMap.set(s,i),this._fieldsMap.set(o,i),this._normalizedFieldsMap.set(n,i),r.push(o),Qot(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):XB(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),Xde(i)||Zde(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)Xde(e)||Zde(e)||e.nullable||tje(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}has(e){return this.get(e)!=null}get(e){if(!e)return;let r=this._fieldsMap.get(e);return r||(r=this._fieldsMap.get(Jde(e))??this._normalizedFieldsMap.get(Kde(e)),r&&this._fieldsMap.set(e,r),r)}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const r=this.get(e);if(r)return r.name??void 0}};function Jde(t){return t.trim().toLowerCase()}function Kde(t){var e;return((e=qGe(t))==null?void 0:e.toLowerCase())??""}function Zot(){return{fields:{type:[NU],value:null},fieldsIndex:{readOnly:!0,get(){return new Xot(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!t||!t.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const r of t)((e=this.fieldsIndex)==null?void 0:e.has(r))||we.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${r} found in outFields`,{layer:this,outFields:t});return q2e(this.fieldsIndex,t)}}}}const mG=we.getLogger("esri.layers.support.labelingInfo"),Jot=/\[([^\[\]]+)\]/gi;function epe(t,e,r){return t?t.map(i=>{const s=new qU;if(s.read(i,r),s.labelExpression){const n=e.fields||e.layerDefinition&&e.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(Jot,(o,a)=>`[${Kot(a,n)}]`)}return s}):null}function Kot(t,e){if(!e)return t;const r=t.toLowerCase();for(let i=0;i<e.length;i++){const s=e[i].name;if(s.toLowerCase()===r)return s}return t}const eat={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function hkt(t,e){const r=Te(t);return r.some(i=>tat(i,e))?[]:r}function tat(t,e){const r=t.labelPlacement,i=eat[e];if(!t.symbol)return mG.warn("No ILabelClass symbol specified."),!0;if(!i)return mG.error(new ce("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!i.includes(r)){const s=i[0];r&&mG.warn(`Found invalid label placement type ${r} for ${e}. Defaulting to ${s}`),t.labelPlacement=s}return!1}const qf=[];function rat(t,e){if(M3e(t.url??""))return!0;const{wkid:r}=e;for(const i of qf){if((t.version??0)>=i[0])return!0;if(typeof i[1]=="function"&&(i[1]=i[1]()),i[1].has(r))return!1}return!0}qf.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102901;e<=102955;e++)t.add(e);return t}]),qf.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),qf.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),qf.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),qf.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),qf.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),qf.push([10.61,()=>new Set([102497])]),qf.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]),qf.push([10.51,()=>{const t=new Set([7683,7881,7886,7899,8888,9e3]);for(let e=8013;e<=8032;e++)t.add(e);for(let e=9053;e<=9057;e++)t.add(e);for(let e=104017;e<=104018;e++)t.add(e);for(let e=104971;e<=104974;e++)t.add(e);return t}]),qf.push([10.5,()=>{const t=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let e=4087;e<=4088;e++)t.add(e);for(let e=5896;e<=5899;e++)t.add(e);for(let e=7005;e<=7007;e++)t.add(e);for(let e=7057;e<=7070;e++)t.add(e);for(let e=7073;e<=7082;e++)t.add(e);for(let e=7109;e<=7128;e++)t.add(e);for(let e=7844;e<=7859;e++)t.add(e);return t}]);async function iat(t,e,r){const i=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const s=await B0(i.populateFromStyle());if(di(r),s.ok===!1){const n=s.error;e&&e.messages&&e.messages.push(new Pg("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}const sat=["oid","global-id"],nat=["oid","global-id","guid"];function oat({displayField:t,editFieldsInfo:e,fields:r,objectIdField:i,title:s},n){if(!r)return null;const o=dat({editFieldsInfo:e,fields:r,objectIdField:i},n);if(!o.length)return null;const a=mat({titleBase:s,fields:r,displayField:t}),l=fat();return new PM({title:a,content:l,fieldInfos:o})}const aat=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],lat=(t,{editFieldsInfo:e,objectIdField:r,visibleFieldNames:i})=>i?i.has(t.name):!KMe(t.name,e)&&(!r||t.name!==r)&&!sat.includes(t.type)&&!aat.some(s=>s.test(t.name));function cat(t,e){const r=t;return e&&(t=t.filter(i=>!e.includes(i.type))),t===r&&(t=t.slice()),t.sort(uat),t}function uat(t,e){return t.type==="oid"?-1:e.type==="oid"?1:tpe(t)?-1:tpe(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function KMe(t,e){if(!t||!e)return!1;const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=e;return[r&&r.toLowerCase(),i&&i.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(t.toLowerCase())}function hat(t,e){return t.editable&&!nat.includes(t.type)&&!KMe(t.name,e)}function dat({editFieldsInfo:t,fields:e,objectIdField:r},i){return cat(e??[],(i==null?void 0:i.ignoreFieldTypes)||gat).map(s=>new fL({fieldName:s.name,isEditable:hat(s,t),label:s.alias,format:pat(s),visible:lat(s,{editFieldsInfo:t,objectIdField:r,visibleFieldNames:i==null?void 0:i.visibleFieldNames})}))}function pat(t){switch(t.type){case"small-integer":case"integer":case"single":return new pC({digitSeparator:!0,places:0});case"double":return new pC({digitSeparator:!0,places:2});case"date":return new pC({dateFormat:"long-month-day-year"});default:return t.type==="string"&&J2e(t.name)?new pC({digitSeparator:!0,places:0}):null}}function fat(){return[new k3,new j$]}function mat(t){const e=QGe(t),{titleBase:r}=t;return e?`${r}: {${e.trim()}}`:r??""}function tpe(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const gat=["geometry","blob","raster","guid","xml"],ou="FeatureLayer",eRe="esri.layers.FeatureLayer",Aat=we.getLogger(eRe);function T5(t,e){return new ce("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function rpe(t){return t&&t instanceof or}const gG=Zot();function AG(t,e,r){const i=!!(r!=null&&r.writeLayerSchema);return{enabled:i,ignoreOrigin:i}}let rr=class extends Gnt(Oot(Yrt(Vot(Hrt(R3e(Dot(Yot(QMe(qot(zrt(Iot(kot(y3e(Grt(Lrt(Fn(z$))))))))))))))))){constructor(...e){super(...e),this._handles=new ts,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=xt.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=gt(this._handles)}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}load(e){var s;const r=E(e)?e.signal:null;if((s=this.portalItem)!=null&&s.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(r).then(n=>this.initLayerProperties(n))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(Sh).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const n=await this._fetchFirstLayerId(r);n!=null&&(this.layerId=n)}if(!this.url&&!this._hasMemorySource())throw new ce("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(r))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>Cnt(this,e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,r){return r=r.layerDefinition||r,NMe(r,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var e;return!(this.loaded&&!((e=this.capabilities)!=null&&e.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,r){return this._readEditingEnabled(r,!1)}readEditingEnabledFromWebMap(e,r,i){return this._readEditingEnabled(r,!0,i)}writeEditingEnabled(e,r){this._writeEditingEnabled(e,r,!1)}writeEditingEnabledToWebMap(e,r,i,s){this._writeEditingEnabled(e,r,!0,s)}get effectiveEditingEnabled(){return Mnt(this)}readIsTable(e,r){return(r=(r==null?void 0:r.layerDefinition)??r).type==="Table"||!r.geometryType}writeIsTable(e,r,i,s){s!=null&&s.writeLayerSchema&&Jc(i,e?"Table":"Feature Layer",r)}readGlobalIdField(e,r){return LMe(r.layerDefinition||r)}readObjectIdField(e,r){return DMe(r.layerDefinition||r)}get parsedUrl(){const e=eu(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=Dx(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=Dx(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){Dce(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,r,i){var n;const s=(n=(r=r.layerDefinition||r).drawingInfo)==null?void 0:n.renderer;if(s){const o=t9(s,r,i)??void 0;return o||Aat.error("Failed to create renderer",{rendererDefinition:r.drawingInfo.renderer,layer:this,context:i}),o}if(r.defaultSymbol)return r.types&&r.types.length?new OL({defaultSymbol:yG(r.defaultSymbol,r,i),field:r.typeIdField,uniqueValueInfos:r.types.map(o=>({id:o.id,symbol:yG(o.symbol,o,i)}))}):new J3({symbol:yG(r.defaultSymbol,r,i)})}set source(e){const r=this._get("source");r!==e&&(rpe(r)&&this._resetMemorySource(r),rpe(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof or?new QA({layer:this,items:e}):e:null}readSource(e,r){const i=_ie.fromJSON(r.featureSet);return new QA({layer:this,items:(i==null?void 0:i.features)??[]})}readTemplates(e,r){const i=r.editFieldsInfo,s=i&&i.creatorField,n=i&&i.editorField;return e=e&&e.map(o=>Xie.fromJSON(o)),this._fixTemplates(e,s),this._fixTemplates(e,n),e}readTitle(e,r){var n;const i=((n=r.layerDefinition)==null?void 0:n.name)??r.name,s=r.title||r.layerDefinition&&r.layerDefinition.title;if(i){const o=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?krt(this.url,i):i;let a=i;if(!a&&this.url){const l=jM(this.url);E(l)&&(a=l.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&o&&o!==a&&(a=o+" - "+a),Die(a)):void 0}if(this.sublayerTitleMode==="item-title"&&s)return s}readTitleFromWebMap(e,r){return r.title||r.layerDefinition&&r.layerDefinition.name}readTypeIdField(e,r){let i=(r=r.layerDefinition||r).typeIdField;if(i&&r.fields){i=i.toLowerCase();const s=r.fields.find(n=>n.name.toLowerCase()===i);s&&(i=s.name)}return i}readTypes(e,r){e=(r=r.layerDefinition||r).types;const i=r.editFieldsInfo,s=i&&i.creatorField,n=i&&i.editorField;return e&&e.map(o=>(o=JMe.fromJSON(o),this._fixTemplates(o.templates,s),this._fixTemplates(o.templates,n),o))}readVisible(e,r){return r.layerDefinition&&r.layerDefinition.defaultVisibility!=null?!!r.layerDefinition.defaultVisibility:r.visibility!=null?!!r.visibility:void 0}async addAttachment(e,r){return dnt(this,e,r,ou)}async updateAttachment(e,r,i){return pnt(this,e,r,i,ou)}async applyEdits(e,r){return fnt(this,e,r)}on(e,r){return super.on(e,r)}createPopupTemplate(e){return oat(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:r}=await ote(be(()=>import("./FeatureLayerSource-71914b65.js"),["assets/FeatureLayerSource-71914b65.js","assets/assetEditingSupport-2cebf928.js","assets/clientSideDefaults-079224aa.js","assets/QueryEngineCapabilities-42e44ded.js","assets/QueryTask-3d6cd9f2.js","assets/executeForIds-4ff99141.js"]),e);return new r({layer:this}).load({signal:e})}createQuery(){const e=Tnt(this);e.dynamicDataSource=this.dynamicDataSource;const r=E(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,i=Art(this.definitionExpression,r);return e.where=i||"1=1",e}async deleteAttachments(e,r){return mnt(this,e,r,ou)}async fetchRecomputedExtents(e){return gnt(this,e,ou)}getFeatureType(e){const{typeIdField:r,types:i}=this;if(!r||!e)return null;const s=e.attributes?e.attributes[r]:void 0;if(s==null)return null;let n=null;return i==null||i.some(o=>{const{id:a}=o;return a!=null&&(a.toString()===s.toString()&&(n=o),!!n)}),n}getFieldDomain(e,r){const i=r&&r.feature,s=this.getFeatureType(i);if(s){const n=s.domains&&s.domains[e];if(n&&n.type!=="inherited")return n}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,r){return Ant(this,e,r,ou)}async queryFeatures(e,r){const i=await this.load(),s=await i.source.queryFeatures(Tg.from(e)??i.createQuery(),r);if(s!=null&&s.features)for(const n of s.features)n.layer=n.sourceLayer=i;return s}async queryObjectIds(e,r){return ynt(this,e,r,ou)}async queryFeatureCount(e,r){return _nt(this,e,r,ou)}async queryExtent(e,r){return vnt(this,e,r,ou)}async queryRelatedFeatures(e,r){return bnt(this,e,r,ou)}async queryRelatedFeaturesCount(e,r){return wnt(this,e,r,ou)}async queryTopFeatures(e,r){var o;const{source:i,capabilities:s}=await this.load();if(!i.queryTopFeatures||!((o=s==null?void 0:s.query)!=null&&o.supportsTopFeaturesQuery))throw new ce(ou,"Layer source does not support queryTopFeatures capability");const n=await i.queryTopFeatures(n5.from(e),r);if(n!=null&&n.features)for(const a of n.features)a.layer=a.sourceLayer=this;return n}async queryTopObjectIds(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopObjectIds||!(s!=null&&s.query.supportsTopFeaturesQuery))throw new ce(ou,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(n5.from(e),r)}async queryTopFeaturesExtent(e,r){var n;const{source:i,capabilities:s}=await this.load();if(!i.queryTopExtents||!((n=s==null?void 0:s.query)!=null&&n.supportsTopFeaturesQuery))throw new ce(ou,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(n5.from(e),r)}async queryTopFeatureCount(e,r){var n;const{source:i,capabilities:s}=await this.load();if(!i.queryTopCount||!((n=s==null?void 0:s.query)!=null&&n.supportsTopFeaturesQuery))throw new ce(ou,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(n5.from(e),r)}read(e,r){const i=e.featureCollection;if(i){const s=i.layers;s&&s.length===1&&(super.read(s[0],r),i.showLegend!=null&&super.read({showLegend:i.showLegend},r))}super.read(e,r),r&&r.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,r){r={...r,origin:(r==null?void 0:r.origin)??void 0,writeLayerSchema:(r==null?void 0:r.writeLayerSchema)??this._hasMemorySource()};const{origin:i,layerContainerType:s,messages:n}=r;if(this.dynamicDataSource)return n==null||n.push(T5(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&s!=="tables")return n==null||n.push(T5(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return n==null||n.push(T5(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&s==="tables")return n==null||n.push(T5(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,r)}clone(){if(this._hasMemorySource())throw new ce(ou,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){var r;return!!this.loaded&&(((r=this.source)==null?void 0:r.type)==="memory"||rat(this,e))}async save(e){return(await be(()=>import("./featureLayerUtils-bfc243d2.js"),["assets/featureLayerUtils-bfc243d2.js","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/fetchService-8fe88712.js","assets/jsonContext-94bb4053.js"])).save(this,e)}async saveAs(e,r){return(await be(()=>import("./featureLayerUtils-bfc243d2.js"),["assets/featureLayerUtils-bfc243d2.js","assets/originUtils-1469eeaf.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/fetchService-8fe88712.js","assets/jsonContext-94bb4053.js"])).saveAs(this,e,r)}_readEditingEnabled(e,r,i){var n;let s=(n=e.layerDefinition)==null?void 0:n.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,r&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&s?this._hasEditingCapability(s):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(r=>r.trim()).includes("editing")}_writeEditingEnabled(e,r,i,s){var n,o;if(!e){const a=(o=(n=this.capabilities)==null?void 0:n.operations)!=null&&o.supportsSync?"Query,Sync":"Query";Jc("layerDefinition.capabilities",a,r),i&&!(s!=null&&s.writeLayerSchema)&&(r.capabilities=a)}}_getLayerDomain(e){const r=this.fieldsIndex.get(e);return r?r.domain:null}_fetchFirstLayerId(e){return Ys(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(r=>{const i=r.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async initLayerProperties(e){var r;return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(r=this.portalItem)==null?void 0:r.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Dce(this.renderer,this.fieldsIndex),H2e(this.timeInfo,this.fieldsIndex),iat(this,{origin:"service"})}async hasDataChanged(){return xnt(this)}async fetchPublishingStatus(){const e=this.source;return e!=null&&e.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){var r,i;const e=((r=this.parsedUrl)==null?void 0:r.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||(i=this.fields)!=null&&i.some(s=>s.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,r){e&&e.forEach(i=>{const s=i.prototype&&i.prototype.attributes;s&&r&&delete s[r]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new ce("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new ce("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(r=>{r.layer=this,r.sourceLayer=this}),this._handles.add([e.on("after-add",r=>{r.item.layer=this,r.item.sourceLayer=this}),e.on("after-remove",r=>{r.item.layer=null,r.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(r=>{r.layer=null,r.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([ft("service","capabilities")],rr.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],rr.prototype,"charts",void 0),u([d({readOnly:!0})],rr.prototype,"createQueryVersion",null),u([d({json:{read:{source:"layerDefinition.copyrightText"}}})],rr.prototype,"copyright",void 0),u([d({json:{read:{source:"layerDefinition.displayField"}}})],rr.prototype,"displayField",void 0),u([d({types:px,readOnly:!0})],rr.prototype,"defaultSymbol",void 0),u([d({type:a0})],rr.prototype,"dynamicDataSource",void 0),u([d({type:Boolean})],rr.prototype,"editingEnabled",null),u([ft(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],rr.prototype,"readEditingEnabled",null),u([ft("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],rr.prototype,"readEditingEnabledFromWebMap",null),u([St(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],rr.prototype,"writeEditingEnabled",null),u([St("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],rr.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],rr.prototype,"effectiveEditingEnabled",null),u([d({...gG.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:AG}}}}})],rr.prototype,"fields",void 0),u([d(gG.fieldsIndex)],rr.prototype,"fieldsIndex",void 0),u([d({type:Rrt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],rr.prototype,"formTemplate",void 0),u([d({json:{read:{source:"layerDefinition.extent"}}})],rr.prototype,"fullExtent",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:AG,writer(t,e,r){const i=t?nZ.toJSON(t):null;i&&Jc(r,i,e)}}}},read:{source:"layerDefinition.geometryType",reader:nZ.read}}})],rr.prototype,"geometryType",void 0),u([d({json:{read:{source:"layerDefinition.hasM"}}})],rr.prototype,"hasM",void 0),u([d({json:{read:{source:"layerDefinition.hasZ"}}})],rr.prototype,"hasZ",void 0),u([d(oit)],rr.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],rr.prototype,"infoFor3D",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],rr.prototype,"isTable",void 0),u([ft("service","isTable",["type","geometryType"]),ft("isTable",["layerDefinition.type","layerDefinition.geometryType"])],rr.prototype,"readIsTable",null),u([St("web-map","isTable")],rr.prototype,"writeIsTable",null),u([d(Fie)],rr.prototype,"labelsVisible",void 0),u([d({type:[qU],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:epe},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:epe},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],rr.prototype,"labelingInfo",void 0),u([d((()=>{const t=Te(nit);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,r,i){Jc(i,QB(e),r)}}},t})())],rr.prototype,"opacity",void 0),u([d(iit)],rr.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const t=Te(L3e.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],rr.prototype,"listMode",void 0),u([ft("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],rr.prototype,"readGlobalIdField",null),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:AG}}}}})],rr.prototype,"objectIdField",void 0),u([ft("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],rr.prototype,"readObjectIdField",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],rr.prototype,"operationalLayerType",void 0),u([d(gG.outFields)],rr.prototype,"outFields",void 0),u([d({readOnly:!0})],rr.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],rr.prototype,"path",void 0),u([d(Nie)],rr.prototype,"popupEnabled",void 0),u([d({type:PM,json:{name:"popupInfo",write:!0}})],rr.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],rr.prototype,"defaultPopupTemplate",null),u([d({types:UU,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:drt,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(t,e,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}})],rr.prototype,"renderer",null),u([ft("service","renderer",["drawingInfo.renderer","defaultSymbol"]),ft("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],rr.prototype,"readRenderer",null),u([d((()=>{const t=Te(tit);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],rr.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],rr.prototype,"source",null),u([Hr("source")],rr.prototype,"castSource",null),u([ft("portal-item","source",["featureSet"]),ft("web-map","source",["featureSet"])],rr.prototype,"readSource",null),u([d({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],rr.prototype,"spatialReference",void 0),u([d({type:Number})],rr.prototype,"subtypeCode",void 0),u([d({type:[Xie]})],rr.prototype,"templates",void 0),u([ft("templates",["editFieldsInfo","creatorField","editorField","templates"])],rr.prototype,"readTemplates",null),u([d({type:ZMe})],rr.prototype,"timeInfo",void 0),u([d()],rr.prototype,"title",void 0),u([ft("service","title",["name"]),ft("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],rr.prototype,"readTitle",null),u([ft("web-map","title",["layerDefinition.name","title"])],rr.prototype,"readTitleFromWebMap",null),u([d({type:String})],rr.prototype,"sublayerTitleMode",void 0),u([d({json:{read:!1}})],rr.prototype,"type",void 0),u([d({type:String})],rr.prototype,"typeIdField",void 0),u([ft("service","typeIdField"),ft("typeIdField",["layerDefinition.typeIdField"])],rr.prototype,"readTypeIdField",null),u([d({type:[JMe]})],rr.prototype,"types",void 0),u([ft("service","types",["types"]),ft("types",["layerDefinition.types"])],rr.prototype,"readTypes",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],rr.prototype,"visible",void 0),u([ft("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],rr.prototype,"readVisible",null),rr=u([j(eRe)],rr);const yG=bb({types:uU}),tRe=rr,pkt=Object.freeze(Object.defineProperty({__proto__:null,default:tRe},Symbol.toStringTag,{value:"Module"})),yat=["$datastore","$map","$layer","$aggregatedfeatures"],_at="esri.widgets.Feature.support.arcadeFeatureUtils",vat=we.getLogger(_at);function bat(t){return typeof t=="string"?TL(lie(t)):Array.isArray(t)?wat(t):(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?xat(t):t}function wat(t){return`<ul class="esri-widget__list">${t.map(e=>`<li>${typeof e=="string"?TL(lie(e)):e}</li>`).join("")}</ul>`}function xat(t){return`<table class="esri-widget__table">${t.keys().map(e=>{const r=t.field(e);return`<tr><th>${e}</th><td>${typeof r=="string"?TL(lie(r)):r}</td></tr>`}).join("")}</table>`}function Tat({aggregatedFeatures:t,arcadeUtils:e,featureSetVars:r,context:i,viewInfo:s,map:n,graphic:o,interceptor:a}){r.forEach(l=>{const c=l.toLowerCase(),h=s.sr,p={map:n,spatialReference:h,interceptor:a};if(c==="$map"&&(i.vars[c]=e.convertMapToFeatureSetCollection(p)),c==="$layer"&&(i.vars[c]=e.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:h,interceptor:a})),c==="$datastore"&&(i.vars[c]=e.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:h,interceptor:a})),c==="$aggregatedfeatures"){const A=o.layer,{fields:_,objectIdField:w,geometryType:T,spatialReference:C,displayField:M}=A,O=new tRe({fields:_,objectIdField:w,geometryType:T,spatialReference:C,displayField:M,...A.type==="feature"?{templates:A.templates,typeIdField:A.typeIdField,types:A.types}:null,source:t});i.vars[c]=e.convertFeatureLayerToFeatureSet({layer:O,spatialReference:C,interceptor:a})}})}function rRe(){return be(()=>import("./arcadeUtils-446895c5.js").then(t=>t.ax),["assets/arcadeUtils-446895c5.js","assets/arcadeTimeUtils-e24bc4a7.js","assets/executionError-fb3f283a.js","assets/hash-0ddfbf4b.js"])}function Sat(t){return"createQuery"in t&&"queryFeatures"in t}async function Eat({graphic:t,view:e}){const{isAggregate:r,layer:i}=t;if(!r||!i||(e==null?void 0:e.type)!=="2d")return[];const s=await e.whenLayerView(i);if(!Sat(s))return[];const n=s.createQuery(),o=t.getObjectId();n.aggregateIds=o!=null?[o]:[];const{features:a}=await s.queryFeatures(n);return a}async function iRe({expressionInfo:t,arcadeUtils:e,interceptor:r,spatialReference:i,map:s,graphic:n,view:o}){if(!t||!t.expression)return null;const a=e.createSyntaxTree(t.expression),l=yat.filter(_=>e.hasVariable(a,_)),[c]=await Promise.all([Eat({graphic:n,view:o}),e.loadScriptDependencies(a,!0,l)]),h=e.getViewInfo({spatialReference:i}),p=e.createExecContext(n,h);p.interceptor=r,p.useAsync=!0,Tat({aggregatedFeatures:c,arcadeUtils:e,featureSetVars:l,context:p,viewInfo:h,map:s,graphic:n,interceptor:r});const A=e.createFunction(a,p);return e.executeAsyncFunction(A,p).catch(_=>vat.error("arcade-execution-error",{error:_,graphic:n,expressionInfo:t}))}async function Cat({expressionInfos:t,spatialReference:e,graphic:r,interceptor:i,map:s,view:n}){if(!t||!t.length)return{};const o=await rRe(),a={};for(const h of t)a[`expression/${h.name}`]=iRe({expressionInfo:h,arcadeUtils:o,interceptor:i,spatialReference:e,map:s,graphic:r,view:n});const l=await Vu(a),c={};for(const h in l)c[h]=bat(l[h].value);return c}const Mat=1;let ld=class extends xT(Ke){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:r}=this;r&&r.abort(),this._abortController=null},this._createVM=()=>{var s,n;const r=(s=this.contentElement)==null?void 0:s.type;(n=this.contentElementViewModel)==null||n.destroy();const i=r==="fields"?new $U:r==="media"?new rx:r==="text"?new Zk:null;this._set("contentElementViewModel",i)},this._compile=async()=>{this._cancelQuery();const r=new AbortController;this._abortController=r,await this._compileExpression(),this._abortController===r&&(this._abortController=null)},this._compileThrottled=WC(this._compile,Mat,this),this._compileExpression=async()=>{const{expressionInfo:r,graphic:i,interceptor:s,spatialReference:n,map:o,view:a,_abortController:l}=this;if(!(r&&i&&n&&o))return void this._set("contentElement",null);const c=await rRe();if(l!==this._abortController)return;const h=await iRe({arcadeUtils:c,expressionInfo:r,graphic:i,interceptor:s,map:o,spatialReference:n,view:a});if(!h||h.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const p=await h.castAsJsonAsync(l==null?void 0:l.signal),A=p==null?void 0:p.type,_=A==="media"?W$.fromJSON(p):A==="text"?B3.fromJSON(p):A==="fields"?k3.fromJSON(p):null;this._set("contentElement",_)},this.handles.add([xe(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),Cr),xe(()=>[this.contentElement],()=>this._createVM(),Cr)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:r,contentElementViewModel:i}=this;return e?"loading":r||i?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}};u([d()],ld.prototype,"_abortController",void 0),u([d({type:K2e})],ld.prototype,"expressionInfo",void 0),u([d({type:pl})],ld.prototype,"graphic",void 0),u([d({readOnly:!0})],ld.prototype,"contentElement",void 0),u([d({readOnly:!0})],ld.prototype,"contentElementViewModel",void 0),u([d()],ld.prototype,"interceptor",void 0),u([d()],ld.prototype,"spatialReference",null),u([d({readOnly:!0})],ld.prototype,"state",null),u([d()],ld.prototype,"map",null),u([d()],ld.prototype,"view",void 0),ld=u([j("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],ld);const Zie=ld,S5={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let V6=class extends pc{constructor(e,r){super(e,r),this._contentWidget=null,this.viewModel=new Zie}initialize(){this.addHandles(xe(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),Cr))}destroy(){this._destroyContentWidget()}renderLoading(){return pe("div",{key:"loading-container",class:S5.loadingSpinnerContainer},pe("span",{class:this.classes(S5.iconLoading,S5.spinner)}))}render(){var r;const{state:e}=this.viewModel;return pe("div",{class:S5.base},e==="loading"?this.renderLoading():e==="disabled"?null:(r=this._contentWidget)==null?void 0:r.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:r}=this.viewModel,i=r==null?void 0:r.type;this._destroyContentWidget();const s=e?i==="fields"?new oCe({viewModel:e}):i==="media"?new qCe({viewModel:e}):i==="text"?new A6({viewModel:e}):null:null;this._contentWidget=s,this.scheduleRender()}};u([d({type:Zie})],V6.prototype,"viewModel",void 0),V6=u([j("esri.widgets.Feature.FeatureExpression")],V6);const Rat=V6,_G=100;let cn=class extends Fn(pL(xT(Ke))){constructor(e){super(e),this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:r}=this;r&&r.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:r}=this;r&&r.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:r}=this;r&&r.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const r=new AbortController;this._queryAbortController=r,await UC(this._query()),this._queryAbortController===r&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._cancelQueryFeatureCount();const r=new AbortController;this._queryFeatureCountAbortController=r,await UC(this._queryFeatureCount()),this._queryFeatureCountAbortController===r&&(this._queryFeatureCountAbortController=null)},this._queryPageController=async()=>{const r=new AbortController;this._queryPageAbortController=r,await UC(this._queryPage()),this._queryPageAbortController===r&&(this._queryPageAbortController=null)},this._queryThrottled=WC(this._queryController,_G,this),this._queryFeatureCountThrottled=WC(this._queryFeatureCountController,_G,this),this._queryPageThrottled=WC(this._queryPageController,_G,this),this._query=async()=>{const{_queryAbortController:r,relatedFeatures:i}=this;this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.removeAll(),i.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:r==null?void 0:r.signal})))},this.handles.add([xe(()=>[this.displayCount,this.graphic,this.layer,this.map,this.orderByFieldsFixedCasing,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryThrottled(),Cr),xe(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageThrottled()),xe(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountThrottled())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:r,featureCount:i}=this,s=1,n=Math.ceil(i/r)||1;this._set("featurePage",Math.min(Math.max(e,s),n))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:r}=this;return e&&(r!=null&&r.loaded)?e.map(i=>{const s=i.clone(),n=l4(i.field,r);return s.field=n,s}):e??[]}get supportsCacheHint(){var e,r,i;return!!((i=(r=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:r.queryRelated)!=null&&i.supportsCacheHint)}get canQuery(){var r,i;const e=(i=(r=this.layer)==null?void 0:r.capabilities)==null?void 0:i.queryRelated;return!!(this.relatedLayer&&this.relationship&&typeof this.relationshipId=="number"&&typeof this.objectId=="number"&&(e!=null&&e.supportsCount)&&(e!=null&&e.supportsPagination))}get itemDescriptionFieldName(){var e,r;return((r=(e=this.orderByFieldsFixedCasing)==null?void 0:e[0])==null?void 0:r.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,r;return(this.objectIdField&&((r=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:r[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new or}get relatedLayer(){const{layer:e,map:r,relationship:i}=this;return e!=null&&e.loaded&&r&&i?WZe(r,e,i)??null:null}get relationship(){var i;const{relationshipId:e,layer:r}=this;return typeof e=="number"?((i=r==null?void 0:r.relationships)==null?void 0:i.find(({id:s})=>s===e))??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new or}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:r,_queryPageAbortController:i,canQuery:s}=this;return r?"loading":e||i?"querying":s?"ready":"disabled"}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.forEach(r=>!r.destroyed&&r.destroy()),this.relatedFeatureViewModels.removeAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:r,relationshipId:i,objectId:s,_queryFeatureCountAbortController:n,canQuery:o,supportsCacheHint:a}=this;if(await(e==null?void 0:e.load()),await(r==null?void 0:r.load()),!o||!e||!r)return void this._set("featureCount",0);const l=r.createQuery(),c=new X3({cacheHint:a,relationshipId:i,returnGeometry:!1,objectIds:[s],where:Ole(l.where,void 0)}),h=await e.queryRelatedFeaturesCount(c,{signal:n==null?void 0:n.signal});this._set("featureCount",h[s]||0)}_sliceFeatures(e){const{showAllEnabled:r,displayCount:i}=this;return r?e:i?e.slice(0,i):[]}async _queryPage(){const{relatedFeatures:e,featurePage:r,showAllEnabled:i,_queryPageAbortController:s}=this;!i||r<2||e.addMany(await this._queryRelatedFeatures({signal:s==null?void 0:s.signal}))}async _queryRelatedFeatures(e){var F;const{orderByFieldsFixedCasing:r,showAllEnabled:i,featuresPerPage:s,displayCount:n,layer:o,relationshipId:a,featurePage:l,featureCount:c,relatedLayer:h,supportsCacheHint:p}=this,{canQuery:A,objectId:_}=this;if(!A||!o||!h)return[];const w=i?((l-1)*s+c)%c:0,T=i?s:n,C=h.objectIdField,M=[...r==null?void 0:r.map(G=>G.field),C].filter(E),O=r==null?void 0:r.map(G=>`${G.field} ${G.order}`),$=h.createQuery(),L=new X3({orderByFields:O,start:w,num:T,outFields:M,cacheHint:p,relationshipId:a,returnGeometry:!1,objectIds:[_],where:Ole($.where,void 0)}),k=((F=(await o.queryRelatedFeatures(L,{signal:e==null?void 0:e.signal}))[_])==null?void 0:F.features)||[];return k.forEach(G=>{G.sourceLayer=h,G.layer=h}),k}};u([d()],cn.prototype,"_queryAbortController",void 0),u([d()],cn.prototype,"_queryPageAbortController",void 0),u([d()],cn.prototype,"_queryFeatureCountAbortController",void 0),u([d({value:1})],cn.prototype,"featurePage",null),u([d()],cn.prototype,"featuresPerPage",void 0),u([d({readOnly:!0})],cn.prototype,"orderByFieldsFixedCasing",null),u([d({readOnly:!0})],cn.prototype,"supportsCacheHint",null),u([d({readOnly:!0})],cn.prototype,"canQuery",null),u([d()],cn.prototype,"description",void 0),u([d({readOnly:!0})],cn.prototype,"itemDescriptionFieldName",null),u([d({value:3})],cn.prototype,"displayCount",null),u([d({type:pl})],cn.prototype,"graphic",void 0),u([d()],cn.prototype,"layer",void 0),u([d()],cn.prototype,"map",void 0),u([d({readOnly:!0})],cn.prototype,"objectId",null),u([d({readOnly:!0})],cn.prototype,"objectIdField",null),u([d()],cn.prototype,"orderByFields",void 0),u([d({readOnly:!0})],cn.prototype,"relatedFeatures",null),u([d({readOnly:!0})],cn.prototype,"relatedLayer",null),u([d({readOnly:!0})],cn.prototype,"relationship",null),u([d()],cn.prototype,"featureCount",void 0),u([d({readOnly:!0})],cn.prototype,"relatedFeatureViewModels",null),u([d()],cn.prototype,"relationshipId",void 0),u([d()],cn.prototype,"showAllEnabled",void 0),u([d()],cn.prototype,"state",null),u([d()],cn.prototype,"title",void 0),cn=u([j("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],cn);const Jie=cn,RP="esri-feature",vG=`${RP}-relationship`,nA={base:vG,esriWidget:"esri-widget",listContainer:`${vG}__list`,listContainerQuerying:`${vG}__list--querying`,featureObserver:`${RP}__feature-observer`,stickySpinnerContainer:`${RP}__sticky-loading-container`,loadingSpinnerContainer:`${RP}__loading-container`,spinner:`${RP}__loading-spinner`,iconLoading:"esri-icon-loading-indicator esri-rotating"},ipe={title:!0,description:!0};let yu=class extends pc{constructor(e,r){super(e,r),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i!=null&&i.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Jie,this.messages=null,this.messagesCommon=null,this.visibleElements={...ipe},this._increaseFeaturePage=()=>{const{state:i,showAllEnabled:s,relatedFeatures:n,featuresPerPage:o,featurePage:a}=this.viewModel;i==="ready"&&s&&n.length>=o*a&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new IU,this.addHandles([xe(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),Cr),xe(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),Co(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Promise.all([be(()=>import("./calcite-list-8bff3543.js"),["assets/calcite-list-8bff3543.js","assets/interactive-573cbe88.js","assets/observers-4f67f1fb.js","assets/utils3-1ce076c1.js","assets/loadable-25ad9e4e.js","assets/debounce-31e0cfcc.js","assets/t9n-54eb0626.js","assets/icon-d40cf52f.js","assets/loader-4670b2b6.js","assets/guid-9426053f.js","assets/scrim-085bbb7c.js"]),be(()=>import("./calcite-list-item-a7054e37.js"),["assets/calcite-list-item-a7054e37.js","assets/interactive-573cbe88.js","assets/utils3-1ce076c1.js","assets/loadable-25ad9e4e.js","assets/icon-d40cf52f.js","assets/observers-4f67f1fb.js"]),be(()=>import("./calcite-icon-8ca968f8.js"),["assets/calcite-icon-8ca968f8.js","assets/icon-d40cf52f.js","assets/observers-4f67f1fb.js"]),be(()=>import("./calcite-notice-49a9979c.js"),["assets/calcite-notice-49a9979c.js","assets/observers-4f67f1fb.js","assets/loadable-25ad9e4e.js","assets/t9n-54eb0626.js","assets/icon-d40cf52f.js"])])}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=gt(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:r,displayCount:i}=this.viewModel;return!e&&!!r&&(r>i||i===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:r}=this.viewModel;return Zm(r===1?e==null?void 0:e.numberRecord:e==null?void 0:e.numberRecords,{number:r})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...ipe,...e}}renderStickyLoading(){return this.viewModel.state==="querying"?pe("div",{key:"sticky-loader",class:nA.stickySpinnerContainer},this.renderLoadingIcon()):null}renderLoadingIcon(){return pe("span",{class:this.classes(nA.iconLoading,nA.spinner)})}renderLoading(){return pe("div",{key:"loading-container",class:nA.loadingSpinnerContainer},this.renderLoadingIcon())}renderShowAllIconNode(){return pe("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}renderChevronIconNode(){const e=w0(this.container)?"chevron-left":"chevron-right";return pe("calcite-icon",{scale:"s",icon:e,slot:"content-end"})}renderRelatedFeature(e){var n,o;const{itemDescriptionFieldName:r}=this.viewModel,i=e.title;e.description=r&&((n=e.formattedAttributes)==null?void 0:n.global[r]);const s=e.state==="loading";return pe("calcite-list-item",{key:e.uid,label:s?`${(o=this.messagesCommon)==null?void 0:o.loading}`:i,description:s?"":e.description??"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this.renderChevronIconNode())}renderShowAllListItem(){var e;return this.displayShowAllButton?pe("calcite-list-item",{key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,description:this.featureCountDescription,onCalciteListItemSelect:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null}renderNoRelatedFeaturesMessage(){var e;return pe("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},pe("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}renderFeatureObserver(){return pe("div",{key:"feature-observer",class:nA.featureObserver,bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return pe("calcite-list",null,e.toArray().map(r=>this.renderRelatedFeature(r)),this.renderShowAllListItem())}renderRelatedFeatures(){const{displayListItems:e}=this,{state:r}=this.viewModel;return pe("div",{key:"list-container",class:this.classes(nA.listContainer,{[nA.listContainerQuerying]:r==="querying"})},e?this.renderList():r==="ready"?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}renderRelationshipNotFound(){var e;return pe("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},pe("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}render(){var r;const{state:e}=this.viewModel;return pe("div",{class:this.classes(nA.base,nA.esriWidget)},(r=this._featureElementInfo)==null?void 0:r.render(),e==="loading"?this.renderLoading():e==="disabled"?this.renderRelationshipNotFound():this.renderRelatedFeatures())}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,r="related-feature-viewmodels";this.removeHandles(r),e==null||e.forEach(i=>{this.addHandles(xe(()=>[i.title,i.state],()=>this.scheduleRender(),Cr),r)}),this.scheduleRender()}_setupFeatureElementInfo(){var n;const{headingLevel:e,visibleElements:r}=this,i=r.description&&this.description,s=r.title&&this.title;(n=this._featureElementInfo)==null||n.set({description:i,title:s,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:r}=this.viewModel;await Ix(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&r&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};u([d()],yu.prototype,"_relatedFeatureIntersectionObserverNode",void 0),u([d({readOnly:!0})],yu.prototype,"displayShowAllButton",null),u([d({readOnly:!0})],yu.prototype,"displayListItems",null),u([d()],yu.prototype,"description",null),u([d({readOnly:!0})],yu.prototype,"featureCountDescription",null),u([d()],yu.prototype,"headingLevel",void 0),u([d()],yu.prototype,"title",null),u([d({type:Jie})],yu.prototype,"viewModel",void 0),u([d(),Ll("esri/widgets/Feature/t9n/Feature")],yu.prototype,"messages",void 0),u([d(),Ll("esri/t9n/common")],yu.prototype,"messagesCommon",void 0),u([d()],yu.prototype,"visibleElements",void 0),u([Hr("visibleElements")],yu.prototype,"castVisibleElements",null),yu=u([j("esri.widgets.Feature.FeatureRelationship")],yu);const spe=yu;let Oat=class{constructor(e,r){this.preLayerQueryCallback=e,this.preRequestCallback=r,this.preLayerQueryCallback||(this.preLayerQueryCallback=i=>{}),this.preRequestCallback||(this.preLayerQueryCallback=i=>{})}};var OP;const Pat=1,npe="content-view-models",ope="relationship-view-models",ape={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let jn=OP=class extends pL(Ke){constructor(t){super(t),this._handles=new ts,this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=WC(this._graphicChanged,Pat,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...ape},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:r}=this;return e.type==="attachments"&&!!r.attachmentsContent||e.type==="custom"&&!!r.customContent||e.type==="fields"&&!!r.fieldsContent||e.type==="media"&&!!r.mediaContent||e.type==="text"&&!!r.textContent||e.type==="expression"&&!!r.expressionContent||e.type==="relationship"&&!!r.relationshipContent},this._handles.add(xe(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),Cr))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return E(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return UZe(Que(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return YEe(this.graphic)}castAbilities(t){return{...ape,...t}}get isTable(){var t;return((t=this._sourceLayer)==null?void 0:t.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._set("graphic",t?t.clone():null)}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get map(){var t;return((t=this.view)==null?void 0:t.map)||null}set map(t){this._override("map",t)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(t,e){const r=this.contentViewModels[t];r instanceof rx&&r.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof rx&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof rx&&e.previous()}async updateGeometry(){var o,a;const{graphic:t,spatialReference:e,_sourceLayer:r}=this;await(r==null?void 0:r.load());const i=r==null?void 0:r.objectIdField;if(!i||!t||!r)return;const s=(o=t==null?void 0:t.attributes)==null?void 0:o[i];if(s==null)return;const n=[s];if(!t.geometry){const l=(a=await eCe({layer:r,graphic:t,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:e}))==null?void 0:a.geometry;l&&(t.geometry=l)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:t}=this;if(!t)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(r){vo(r)||(this._error=r,we.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:r,graphic:t,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:t}=this;t&&t.abort(),this._featureAbortController=null}_compileContentElement(t,e){return t.type==="attachments"?this._compileAttachments(t,e):t.type==="custom"?this._compileCustom(t,e):t.type==="fields"?this._compileFields(t,e):t.type==="media"?this._compileMedia(t,e):t.type==="text"?this._compileText(t,e):t.type==="expression"?this._compileExpression(t,e):t.type==="relationship"?this._compileRelationship(t,e):void 0}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map((e,r)=>this._compileContentElement(e,r)).filter(E):typeof t=="string"?this._compileText(new B3({text:t}),0).text:t}_destroyContentViewModels(){var t,e;(t=this._handles)==null||t.remove(ope),(e=this._handles)==null||e.remove(npe),this.contentViewModels.forEach(r=>r&&!r.destroyed&&r.destroy()),this._set("contentViewModels",[])}_matchesFeature(t,e){var s;const r=(s=t==null?void 0:t.graphic)==null?void 0:s.getObjectId(),i=e==null?void 0:e.getObjectId();return E(r)&&E(i)&&r===i}_setRelatedFeaturesViewModels({relatedFeatureViewModels:t,relatedFeatures:e,map:r}){const{view:i,spatialReference:s}=this;e==null||e.filter(Boolean).forEach(n=>{t.find(o=>this._matchesFeature(o,n))||t.add(new OP({abilities:{relationshipContent:!1},map:r,view:i,spatialReference:s,graphic:n}))}),t.forEach(n=>{(e==null?void 0:e.find(a=>this._matchesFeature(n,a)))||t.remove(n)})}_setExpressionContentVM(t,e){const r=this.formattedAttributes,{contentElement:i,contentElementViewModel:s}=t,n=i==null?void 0:i.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:i,contentElementIndex:e,formattedAttributes:r}),s.set(this._createFieldsVMParams(i,e))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:i,contentElementIndex:e,formattedAttributes:r}),s.set(this._createMediaVMParams(i,e))),n==="text"&&s.set(this._createTextVMParams(i)))}_compileRelationship(t,e){const{displayCount:r,orderByFields:i,relationshipId:s,title:n,description:o}=t,{_sourceLayer:a,graphic:l,map:c}=this,h=new Jie({displayCount:r,graphic:l,orderByFields:i,relationshipId:s,layer:a,map:c,...this._compileTitleAndDesc({title:n,description:o})});return this.contentViewModels[e]=h,this._handles.add(Co(()=>h.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(h)),ope),t}_compileExpression(t,e){const{expressionInfo:r}=t,{graphic:i,map:s,spatialReference:n,view:o}=this,a=new Zie({expressionInfo:r,graphic:i,interceptor:OP.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[e]=a,this._handles.add(xe(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,e),Cr),npe),t}_compileAttachments(t,e){const{graphic:r}=this,{description:i,title:s}=t;return this.contentViewModels[e]=new uie({graphic:r,...this._compileTitleAndDesc({title:s,description:i})}),t}_compileCustom(t,e){const{graphic:r}=this,{creator:i,destroyer:s}=t;return this.contentViewModels[e]=new Zk({graphic:r,creator:i,destroyer:s}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:r,_sourceLayer:i,graphic:s,formattedAttributes:n}=this,o=s==null?void 0:s.attributes,a=this._expressionAttributes,l=n.global;return{title:ex({attributes:o,fieldInfoMap:r,globalAttributes:l,expressionAttributes:a,layer:i,text:t}),description:ex({attributes:o,fieldInfoMap:r,globalAttributes:l,expressionAttributes:a,layer:i,text:e})}}_createFieldsVMParams(t,e){var c;const r=this._effectivePopupTemplate,i=this.formattedAttributes,s={...i==null?void 0:i.global,...i==null?void 0:i.content[e]},n=(c=(t==null?void 0:t.fieldInfos)||(r==null?void 0:r.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>oie(h)||hy(h)||s.hasOwnProperty(h)),o=r==null?void 0:r.expressionInfos,{description:a,title:l}=t;return{attributes:s,expressionInfos:o,fieldInfos:n,...this._compileTitleAndDesc({title:l,description:a})}}_compileFields(t,e){const r=t.clone(),i=new $U(this._createFieldsVMParams(t,e));return this.contentViewModels[e]=i,r.fieldInfos=i.formattedFieldInfos.slice(0),r}_createMediaVMParams(t,e){const{abilities:r,graphic:i,_fieldInfoMap:s,_effectivePopupTemplate:n,relatedInfos:o,_sourceLayer:a,_expressionAttributes:l}=this,c=this.formattedAttributes,h=(i==null?void 0:i.attributes)??{},{description:p,mediaInfos:A,title:_}=t;return{abilities:{chartAnimation:r.chartAnimation},activeMediaInfoIndex:t.activeMediaInfoIndex||0,attributes:h,isAggregate:i==null?void 0:i.isAggregate,layer:a,fieldInfoMap:s,formattedAttributes:{...c==null?void 0:c.global,...c==null?void 0:c.content[e]},expressionAttributes:l,mediaInfos:A,popupTemplate:n,relatedInfos:o,...this._compileTitleAndDesc({title:_,description:p})}}_compileMedia(t,e){const r=t.clone(),i=new rx(this._createMediaVMParams(t,e));return r.mediaInfos=i.formattedMediaInfos.slice(0),this.contentViewModels[e]=i,r}_createTextVMParams(t){var n;const{graphic:e,_fieldInfoMap:r,_sourceLayer:i,_expressionAttributes:s}=this;if(t&&t.text){const o=(e==null?void 0:e.attributes)??{},a=((n=this.formattedAttributes)==null?void 0:n.global)??{};t.text=ex({attributes:o,fieldInfoMap:r,globalAttributes:a,expressionAttributes:s,layer:i,text:t.text})}return{graphic:e,creator:t.text}}_compileText(t,e){const r=t.clone();return this.contentViewModels[e]=new Zk(this._createTextVMParams(r)),r}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:r}=this;if(!t)return;const{lastEditInfoEnabled:i}=t,s=e==null?void 0:e.editFieldsInfo;return i&&s?BZe(s,r==null?void 0:r.attributes):void 0}_compileTitle(t){var a;const{_fieldInfoMap:e,_sourceLayer:r,graphic:i,_expressionAttributes:s}=this,n=(i==null?void 0:i.attributes)??{},o=((a=this.formattedAttributes)==null?void 0:a.global)??{};return ex({attributes:n,fieldInfoMap:e,globalAttributes:o,expressionAttributes:s,layer:r,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const r=t==null?void 0:t.title;return Xk(r,{graphic:e})}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const r=t==null?void 0:t.content;return Xk(r,{graphic:e})}async _queryFeature(t){const{_featureAbortController:e,_sourceLayer:r,graphic:i,_effectivePopupTemplate:s}=this,n=this.map,o=this.view,a=this.spatialReference;if(e!==this._featureAbortController||!i)return;await zZe({graphic:i,popupTemplate:s,layer:r,spatialReference:a},t);const{content:{value:l},title:{value:c}}=await Vu({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:h}}=await Vu({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:Cat({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:a,graphic:i,map:n,interceptor:OP.interceptor,view:o})});e===this._featureAbortController&&i&&(this._expressionAttributes=h,this._graphicExpressionAttributes={...i.attributes,...h},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:r}){const{_effectivePopupTemplate:i,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;r.content[e]=Pz({fieldInfos:i==null?void 0:i.fieldInfos,graphic:s,attributes:{...l,...t.attributes},layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:r}){if(t.fieldInfos){const{graphic:i,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;r.content[e]=Pz({fieldInfos:t.fieldInfos,graphic:i,attributes:{...a,...t.attributes},layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(t){const{_effectivePopupTemplate:e,graphic:r,relatedInfos:i,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=e==null?void 0:e.fieldInfos,l={global:Pz({fieldInfos:a,graphic:r,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:i}),content:[]};return Array.isArray(t)&&t.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:r}=this;return this._queryRelatedInfos(e,Que(r),t)}async _queryRelatedInfos(t,e,r){const{relatedInfos:i,_sourceLayer:s}=this;i.clear();const n=E(s==null?void 0:s.associatedLayer)?await(s==null?void 0:s.associatedLayer.load(r)):s;if(!n||!t)return;const o=e.filter(c=>c&&hy(c.fieldName));if(!o||!o.length)return;e.forEach(c=>this._configureRelatedInfo(c,n));const a=await ttt({relatedInfos:i,layer:n},r);Object.keys(a).forEach(c=>{var A;const h=i.get(c.toString()),p=(A=a[c])==null?void 0:A.value;h&&p&&(h.layerInfo=p.data)});const l=await rtt({graphic:t,relatedInfos:i,layer:n},r);Object.keys(l).forEach(c=>{var h;Xet((h=l[c])==null?void 0:h.value,i.get(c.toString()))})}_configureRelatedInfo(t,e){const{relatedInfos:r}=this,i=w6(t.fieldName);if(!i)return;const{layerId:s,fieldName:n}=i;if(!s)return;const o=r.get(s.toString())||Qet(s,e);o&&(itt({relatedInfo:o,fieldName:n,fieldInfo:t}),this.relatedInfos.set(s,o))}};jn.interceptor=new Oat(HZe,qZe),u([d()],jn.prototype,"_error",void 0),u([d()],jn.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],jn.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],jn.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],jn.prototype,"_sourceLayer",null),u([d()],jn.prototype,"abilities",void 0),u([Hr("abilities")],jn.prototype,"castAbilities",null),u([d({readOnly:!0})],jn.prototype,"content",void 0),u([d({readOnly:!0})],jn.prototype,"contentViewModels",void 0),u([d()],jn.prototype,"description",void 0),u([d({type:Boolean})],jn.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],jn.prototype,"isTable",null),u([d({readOnly:!0})],jn.prototype,"state",null),u([d({readOnly:!0})],jn.prototype,"formattedAttributes",void 0),u([d({type:pl,value:null})],jn.prototype,"graphic",null),u([d({readOnly:!0})],jn.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],jn.prototype,"relatedInfos",void 0),u([d()],jn.prototype,"spatialReference",null),u([d({readOnly:!0})],jn.prototype,"title",void 0),u([d()],jn.prototype,"map",null),u([d({readOnly:!0})],jn.prototype,"waitingForContent",null),u([d()],jn.prototype,"view",void 0),jn=OP=u([j("esri.widgets.FeatureViewModel")],jn);const Kie=jn,Bl="esri-feature",go={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:Bl,container:`${Bl}__size-container`,title:`${Bl}__title`,main:`${Bl}__main-container`,btn:`${Bl}__button`,icon:`${Bl}__icon`,content:`${Bl}__content`,contentNode:`${Bl}__content-node`,contentElement:`${Bl}__content-element`,text:`${Bl}__text`,lastEditedInfo:`${Bl}__last-edited-info`,fields:`${Bl}__fields`,fieldHeader:`${Bl}__field-header`,fieldData:`${Bl}__field-data`,fieldDataDate:`${Bl}__field-data--date`,loadingSpinnerContainer:`${Bl}__loading-container`,spinner:`${Bl}__loading-spinner`},sRe=t=>{let e=class extends t{constructor(){super(...arguments),this.renderNodeContent=r=>nCe(r)&&!r.destroyed?pe("div",{class:go.contentNode,key:r},r.render()):r instanceof HTMLElement?pe("div",{class:go.contentNode,key:r,bind:r,afterCreate:this._attachToNode}):uJe(r)?pe("div",{class:go.contentNode,key:r,bind:r.domNode,afterCreate:this._attachToNode}):null}_attachToNode(r){const i=this;r.appendChild(i)}};return e=u([j("esri.widgets.Feature.ContentMixin")],e),e};var gZ;const lpe={title:!0,content:!0,lastEditedInfo:!0},cpe="relationship-handles";let Qa=gZ=class extends sRe(pc){constructor(t,e){super(t,e),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...lpe},this.viewModel=new Kie}initialize(){this.addHandles(xe(()=>{var t;return(t=this.viewModel)==null?void 0:t.contentViewModels},()=>this._setupContentWidgets(),Cr))}loadDependencies(){return be(()=>import("./calcite-notice-49a9979c.js"),["assets/calcite-notice-49a9979c.js","assets/observers-4f67f1fb.js","assets/loadable-25ad9e4e.js","assets/t9n-54eb0626.js","assets/icon-d40cf52f.js"])}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get isTable(){return this.viewModel.isTable}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get title(){return this.viewModel.title}castVisibleElements(t){return{...lpe,...t}}get map(){return this.viewModel.map}set map(t){this.viewModel.map=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{state:t}=this.viewModel,e=pe("div",{class:go.container,key:"container"},this.renderTitle(),t==="error"?this.renderError():t==="loading"?this.renderLoading():this.renderContentContainer());return pe("div",{class:this.classes(go.base,go.esriWidget)},e)}setActiveMedia(t,e){return this.viewModel.setActiveMedia(t,e)}nextMedia(t){return this.viewModel.nextMedia(t)}previousMedia(t){return this.viewModel.previousMedia(t)}renderError(){const{messagesCommon:t,messages:e,visibleElements:r}=this;return pe("calcite-notice",{open:!0,kind:"danger",icon:"exclamation-mark-circle",scale:"s"},r.title?pe("div",{key:"error-title",slot:"title"},t.errorMessage):null,pe("div",{key:"error-message",slot:"message"},e.loadingError))}renderLoading(){return pe("div",{key:"loading-container",class:go.loadingSpinnerContainer},pe("span",{class:this.classes(go.iconLoading,go.spinner)}))}renderContentContainer(){const{visibleElements:t}=this;return t.content?pe("div",{class:go.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:t,title:e}=this;return t.title?pe(c4,{level:this.headingLevel,class:go.title,innerHTML:e}):null}renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?pe("div",{class:go.contentNode,key:`${e}-content-elements`},t.map(this.renderContentElement,this)):null;if(typeof t=="string"){const r=this._contentWidgets[0];return!r||r.destroyed?null:pe("div",{class:go.contentNode,key:`${e}-content`},r.render())}return this.renderNodeContent(t)}renderContentElement(t,e){var i;const{visibleElements:r}=this;if(typeof r.content!="boolean"&&!((i=r.content)!=null&&i[t.type]))return null;switch(t.type){case"attachments":return this.renderAttachments(e);case"custom":return this.renderCustom(t,e);case"fields":return this.renderFields(e);case"media":return this.renderMedia(e);case"text":return this.renderText(t,e);case"expression":return this.renderExpression(e);case"relationship":return this.renderRelationship(e);default:return null}}renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:r,attachmentInfos:i}=e.viewModel;return r==="loading"||i.length>0?pe("div",{key:this._buildKey("attachments-element",t),class:this.classes(go.contentElement)},e.render()):null}renderRelationship(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?pe("div",{key:this._buildKey("relationship-element",t),class:go.contentElement},e.render()):null}renderExpression(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:pe("div",{key:this._buildKey("expression-element",t),class:go.contentElement},e.render())}renderCustom(t,e){const{creator:r}=t,i=this._contentWidgets[e];return!i||i.destroyed?null:r?pe("div",{key:this._buildKey("custom-element",e),class:go.contentElement},i.render()):null}renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:pe("div",{key:this._buildKey("fields-element",t),class:go.contentElement},e.render())}renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:pe("div",{key:this._buildKey("media-element",t),class:go.contentElement},e.render())}renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:r}=this.viewModel;if(!r||!t.lastEditedInfo)return null;const{date:i,user:s}=r,n=r.type==="edit"?s?e.lastEditedByUser:e.lastEdited:s?e.lastCreatedByUser:e.lastCreated,o=Zm(n,{date:i,user:s});return pe("div",{key:"edit-info-element",class:this.classes(go.lastEditedInfo,go.contentElement)},o)}renderText(t,e){const r=t.text,i=this._contentWidgets[e];return!i||i.destroyed?null:r?pe("div",{key:this._buildKey("text-element",e),class:this.classes(go.contentElement,go.text)},i.render()):null}_buildKey(t,...e){return`${t}__${this.get("viewModel.graphic.uid")||"0"}-${e.join("-")}`}_destroyContentWidget(t){t&&(t.viewModel=null,!t.destroyed&&t.destroy())}_destroyContentWidgets(){this.removeHandles(cpe),this._contentWidgets.forEach(t=>this._destroyContentWidget(t)),this._contentWidgets=[]}_addFeatureRelationshipHandles(t){const{flowItems:e,visibleElements:r}=this;this.addHandles([Co(()=>t,"select-record",({featureViewModel:i})=>{e&&(i.abilities={relationshipContent:!0},e.push(new gZ({flowItems:e,viewModel:i,visibleElements:r})))}),Co(()=>t,"show-all-records",()=>{if(!e)return;const{viewModel:i}=t;i.showAllEnabled=!0;const s=new spe({visibleElements:{title:!1,description:!1},viewModel:i});this._addFeatureRelationshipHandles(s),e.push(s)})],cpe)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:t,visibleElements:e}=this,r=this.get("viewModel.content"),{contentViewModels:i}=this.viewModel;if(Array.isArray(r))r.forEach((s,n)=>{if(s.type==="attachments"&&(this._contentWidgets[n]=new tJe({displayType:s.displayType,headingLevel:e.title?t+1:t,viewModel:i[n]})),s.type==="fields"&&(this._contentWidgets[n]=new oCe({viewModel:i[n]})),s.type==="media"&&(this._contentWidgets[n]=new qCe({viewModel:i[n]})),s.type==="text"&&(this._contentWidgets[n]=new A6({viewModel:i[n]})),s.type==="custom"&&(this._contentWidgets[n]=new A6({viewModel:i[n]})),s.type==="expression"&&(this._contentWidgets[n]=new Rat({viewModel:i[n]})),s.type==="relationship"){const o=new spe({viewModel:i[n]});this._addFeatureRelationshipHandles(o),this._contentWidgets[n]=o}},this);else{const s=i[0];s&&!s.destroyed&&(this._contentWidgets[0]=new A6({viewModel:s}))}this.scheduleRender()}};u([d()],Qa.prototype,"graphic",null),u([d()],Qa.prototype,"defaultPopupTemplateEnabled",null),u([d()],Qa.prototype,"flowItems",void 0),u([d()],Qa.prototype,"headingLevel",void 0),u([d({readOnly:!0})],Qa.prototype,"isTable",null),u([d()],Qa.prototype,"label",null),u([d(),Ll("esri/widgets/Feature/t9n/Feature")],Qa.prototype,"messages",void 0),u([d(),Ll("esri/t9n/common")],Qa.prototype,"messagesCommon",void 0),u([d(),Ll("esri/widgets/support/t9n/uriUtils")],Qa.prototype,"messagesURIUtils",void 0),u([d()],Qa.prototype,"spatialReference",null),u([d({readOnly:!0})],Qa.prototype,"title",null),u([d()],Qa.prototype,"visibleElements",void 0),u([Hr("visibleElements")],Qa.prototype,"castVisibleElements",null),u([d()],Qa.prototype,"map",null),u([d()],Qa.prototype,"view",null),u([d({type:Kie})],Qa.prototype,"viewModel",void 0),Qa=gZ=u([j("esri.widgets.Feature")],Qa);const Iat=Qa;var nRe;const z6=Symbol("anchorHandles");let a2=class extends Nn.EventedAccessor{constructor(e){super(e),this[nRe]=new ts,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[z6].add([Nl(()=>ka(this.screenLocationEnabled?this.view:null,r=>[r.size,r.type==="3d"?r.camera:r.viewpoint]),()=>this.notifyChange("screenLocation")),xe(()=>this.screenLocation,(r,i)=>{E(r)&&E(i)&&this.emit("view-change")})])}destroy(){this.view=null,this[z6]=gt(this[z6])}get screenLocation(){var s;const{location:e,view:r,screenLocationEnabled:i}=this;return i&&E(e)&&E(r)&&r.ready?(s=r.toScreen)==null?void 0:s.call(r,e):null}};nRe=z6,u([d()],a2.prototype,"location",void 0),u([d()],a2.prototype,"screenLocation",null),u([d()],a2.prototype,"screenLocationEnabled",void 0),u([d()],a2.prototype,"view",void 0),a2=u([j("esri.widgets.support.AnchorElementViewModel")],a2);const oRe=a2,$at="esri.widgets.CompassViewModel";let G6=class extends oRe{constructor(e){super(e),this.visible=!1}};u([d()],G6.prototype,"visible",void 0),G6=u([j($at)],G6);const aRe=G6,bG="esri-spinner",wG={base:bG,spinnerStart:`${bG}--start`,spinnerFinish:`${bG}--finish`};let l2=class extends pc{constructor(e,r){super(e,r),this._animationDelay=500,this._animationPromise=null,this.viewModel=new aRe}initialize(){this.addHandles(xe(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:r,promise:i}=e??{};r&&(this.viewModel.location=r),this.visible=!0;const s=()=>this.hide();i&&i.catch(()=>{}).then(s)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:r}=this.viewModel,i=!!r,s=e&&i,n=!e&&i,o={[wG.spinnerStart]:s,[wG.spinnerFinish]:n},a=this._getPositionStyles();return pe("div",{class:this.classes(wG.base,o),styles:a})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const r=Ix(this._animationDelay);this._animationPromise=r,r.catch(()=>{}).then(()=>{this._animationPromise===r&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:r}=this.viewModel;if(N(r)||N(e))return{};const{padding:i}=r;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};u([d()],l2.prototype,"location",null),u([d()],l2.prototype,"view",null),u([d({type:aRe})],l2.prototype,"viewModel",void 0),u([d()],l2.prototype,"visible",null),l2=u([j("esri.widgets.Spinner")],l2);const Lat=l2,YU={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},ix=new OM({id:"zoom-to-feature",title:"{messages.zoom}",className:YU.iconZoom}),upe=new OM({id:"remove-selected-feature",title:"{messages.remove}",className:YU.iconTrash}),AC=new OM({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:YU.iconZoom}),yC=new OM({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:YU.iconBrowseClusteredFeatures}),Dat="esri.widgets.Popup.PopupViewModel",l9=we.getLogger(Dat),Nat=t=>{const{event:e,view:r}=t,{action:i}=e,s=r&&r.popup;if(!i)return Promise.reject(new ce("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new ce("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=i;if(!o)return Promise.reject(new ce("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new ce("trigger-action:invalid-action","Action is disabled"));if(o===ix.id)return kat(s.viewModel).catch(oW);if(o===AC.id)return Bat(s.viewModel);if(o===yC.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===upe.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new ce(`trigger-action:${upe.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):r.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function lRe(t){const{selectedFeature:e,location:r,view:i}=t;return i?i.type==="3d"?e??r??null:t.get("selectedFeature.geometry")||r:null}function N2(t){var e,r;return!!t&&t.isAggregate&&((r=(e=t.sourceLayer)==null?void 0:e.featureReduction)==null?void 0:r.type)==="cluster"}async function Fat(t,e){if((e==null?void 0:e.type)!=="3d"||!t||t.declaredClass!=="esri.Graphic")return!0;const r=e.getViewForGraphic(t);if(r&&"whenGraphicBounds"in r){let i;try{i=await r.whenGraphicBounds(t,{useViewElevation:!0})}catch{}return!i||!i.boundingBox||i.boundingBox[0]===i.boundingBox[3]&&i.boundingBox[1]===i.boundingBox[4]&&i.boundingBox[2]===i.boundingBox[5]}return!0}async function kat(t){var h;const{location:e,selectedFeature:r,view:i,zoomFactor:s}=t,n=lRe(t);if(!i||!n){const p=new ce("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:i});throw l9.error(p),p}const o=i.scale/s,a=(h=t.selectedFeature)==null?void 0:h.geometry,l=a??e,c=E(l)&&l.type==="point"&&await Fat(r,i);ix.active=!0,ix.disabled=!0;try{await t.zoomTo({target:{target:n,scale:c?o:void 0}})}catch{const A=new ce("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:r});l9.error(A)}finally{ix.active=!1,ix.disabled=!1,t.zoomToLocation=null,c&&(t.location=l)}}async function Bat(t){const{selectedFeature:e,view:r}=t;if((r==null?void 0:r.type)!=="2d"){const o=new ce("zoomToCluster:invalid-view","View must be 2d MapView.",{view:r});throw l9.error(o),o}if(!e||!N2(e)){const o=new ce("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw l9.error(o),o}const[i,s]=await ese(r,e);AC.active=!0,AC.disabled=!0;const{extent:n}=await i.queryExtent(s);await t.zoomTo({target:n}),AC.active=!1,AC.disabled=!1}async function Uat(t){const{view:e,selectedFeature:r}=t;if(!e||!r)return;const[i,s]=await ese(e,r),{extent:n}=await i.queryExtent(s);t.selectedClusterBoundaryFeature.geometry=n,e.graphics.add(t.selectedClusterBoundaryFeature)}async function Vat(t){var o;const{selectedFeature:e,view:r}=t;if(!r||!e)return;const[i,s]=await ese(r,e);yC.active=!0,yC.disabled=!0;const{features:n}=await i.queryFeatures(s);yC.active=!1,yC.disabled=!1,(o=r.popup)==null||o.open({features:[e].concat(n),featureMenuOpen:!0})}async function ese(t,e){const r=await t.whenLayerView(e.sourceLayer),i=r.createQuery(),s=e.getObjectId();return i.aggregateIds=s!=null?[s]:[],[r,i]}function zat(t){const e=t.features.filter(r=>N2(r));e.length&&(t.features=e)}function cRe(t){var e;if(N(t))return null;switch(t.type){case"point":return t;case"extent":return t.center;case"polygon":return t.centroid;case"multipoint":case"polyline":return(e=t.extent)==null?void 0:e.center;default:return null}}const wr="esri-popup",GR=`${wr}__header`,qb=`${wr}--is-docked`,rt={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:wr,widget:"esri-widget",main:`${wr}__main-container`,loadingContainer:`${wr}__loading-container`,isCollapsible:`${wr}--is-collapsible`,isCollapsed:`${wr}--is-collapsed`,shadow:`${wr}--shadow`,isDocked:qb,isDockedTopLeft:`${qb}-top-left`,isDockedTopCenter:`${qb}-top-center`,isDockedTopRight:`${qb}-top-right`,isDockedBottomLeft:`${qb}-bottom-left`,isDockedBottomCenter:`${qb}-bottom-center`,isDockedBottomRight:`${qb}-bottom-right`,alignTopCenter:`${wr}--aligned-top-center`,alignBottomCenter:`${wr}--aligned-bottom-center`,alignTopLeft:`${wr}--aligned-top-left`,alignBottomLeft:`${wr}--aligned-bottom-left`,alignTopRight:`${wr}--aligned-top-right`,alignBottomRight:`${wr}--aligned-bottom-right`,isFeatureMenuOpen:`${wr}--feature-menu-open`,isActionsMenuOpen:`${wr}--actions-menu-open`,hasFeatureUpdated:`${wr}--feature-updated`,header:GR,headerButtons:`${GR}-buttons`,headerContainer:`${GR}-container`,headerContainerButton:`${GR}-container--button`,headerTitle:`${GR}-title`,content:`${wr}__content`,contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:`${wr}__footer`,footerHasPagination:`${wr}__footer--has-pagination`,footerHasActions:`${wr}__footer--has-actions`,footerHasActionsMenu:`${wr}__footer--has-actions-menu`,button:`${wr}__button`,buttonDisabled:`${wr}__button--disabled`,buttonDock:`${wr}__button--dock`,icon:`${wr}__icon`,iconDock:`${wr}__icon--dock-icon`,inlineActionsContainer:`${wr}__inline-actions-container`,actionsMenuButton:`${wr}__actions-menu-button`,actions:`${wr}__actions`,action:`${wr}__action`,actionImage:`${wr}__action-image`,actionText:`${wr}__action-text`,actionToggle:`${wr}__action-toggle`,actionToggleOn:`${wr}__action-toggle--on`,actionExit:`${wr}__action--exit`,actionSelectFeature:`${wr}__action--select-feature`,pointer:`${wr}__pointer`,pointerDirection:`${wr}__pointer-direction`,navigation:`${wr}__navigation`,paginationPrevious:`${wr}__pagination-previous`,paginationNext:`${wr}__pagination-next`,paginationPreviousIconLTR:`${wr}__pagination-previous-icon`,paginationPreviousIconRTL:`${wr}__pagination-previous-icon--rtl`,paginationNextIconLTR:`${wr}__pagination-next-icon`,paginationNextIconRTL:`${wr}__pagination-next-icon--rtl`,featureMenu:`${wr}__feature-menu`,featureMenuList:`${wr}__feature-menu-list`,featureMenuItem:`${wr}__feature-menu-item`,featureMenuViewport:`${wr}__feature-menu-viewport`,featureMenuHeader:`${wr}__feature-menu-header`,featureMenuNote:`${wr}__feature-menu-note`,featureMenuSelected:`${wr}__feature-menu-item--selected`,featureMenuButton:`${wr}__feature-menu-button`,featureMenuTitle:`${wr}__feature-menu-title`,featureMenuObserver:`${wr}__feature-menu-observer`,featureMenuLoader:`${wr}__feature-menu-loader`,collapseButton:`${wr}__collapse-button`,collapseIcon:`${wr}__collapse-icon`};var Jx;(function(t){t[t.size=22]="size",t[t.lineWidth=50]="lineWidth",t[t.maxSize=120]="maxSize",t[t.maxOutlineSize=80]="maxOutlineSize",t[t.tallSymbolWidth=20]="tallSymbolWidth"})(Jx||(Jx={}));function uRe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function Gat(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function jat(t,e,r,i,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function Hat(t,e){return new Float32Array(t,e,6)}function hRe(t,e,r,i){const s=e[i],n=e[i+1];t[i]=r[0]*s+r[2]*n+r[4],t[i+1]=r[1]*s+r[3]*n+r[5]}function qat(t,e,r,i=0,s=0,n=2){const o=s||e.length/n;for(let a=i;a<o;a++)hRe(t,e,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:Gat,create:uRe,createView:Hat,fromValues:jat,transform:hRe,transformMany:qat},Symbol.toStringTag,{value:"Module"}));function Wat(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Yat(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Qat(t,e,r,i,s,n,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t}function dRe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=r*n-i*s;return l?(l=1/l,t[0]=n*l,t[1]=-i*l,t[2]=-s*l,t[3]=r*l,t[4]=(s*a-n*o)*l,t[5]=(i*o-r*a)*l,t):null}function Xat(t){return t[0]*t[3]-t[1]*t[2]}function pRe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1],p=r[2],A=r[3],_=r[4],w=r[5];return t[0]=i*c+n*h,t[1]=s*c+o*h,t[2]=i*p+n*A,t[3]=s*p+o*A,t[4]=i*_+n*w+a,t[5]=s*_+o*w+l,t}function tse(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*c,t[1]=s*h+o*c,t[2]=i*-c+n*h,t[3]=s*-c+o*h,t[4]=a,t[5]=l,t}function fRe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i*c,t[1]=s*c,t[2]=n*h,t[3]=o*h,t[4]=a,t[5]=l,t}function rse(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=i*c+n*h+a,t[5]=s*c+o*h+l,t}function Zat(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function Jat(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function ise(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Kat(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function elt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function tlt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function mRe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function rlt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function ilt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function slt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function nlt(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],p=e[3],A=e[4],_=e[5],w=dc();return Math.abs(r-l)<=w*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=w*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=w*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=w*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-A)<=w*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-_)<=w*Math.max(1,Math.abs(a),Math.abs(_))}const olt=pRe,alt=mRe;Object.freeze(Object.defineProperty({__proto__:null,add:tlt,copy:Wat,determinant:Xat,equals:nlt,exactEquals:slt,frob:elt,fromRotation:Zat,fromScaling:Jat,fromTranslation:ise,identity:Yat,invert:dRe,mul:olt,multiply:pRe,multiplyScalar:rlt,multiplyScalarAndAdd:ilt,rotate:tse,scale:fRe,set:Qat,str:Kat,sub:alt,subtract:mRe,translate:rse},Symbol.toStringTag,{value:"Module"}));const hpe=Le("android");Le("chrome")||hpe&&hpe>=4;SQ();function wkt(t){return t=t||globalThis.location.hostname,clt.some(e=>(t==null?void 0:t.match(e))!=null)}function llt(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(gRe)!=null||e.match(yRe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(ARe)!=null||e.match(_Re)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const gRe=/^devext.arcgis.com$/,ARe=/^qaext.arcgis.com$/,yRe=/^[\w-]*\.mapsdevext.arcgis.com$/,_Re=/^[\w-]*\.mapsqa.arcgis.com$/,clt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,gRe,ARe,/^jsapps.esri.com$/,yRe,_Re];Jx.size;Jx.maxSize;Jx.maxOutlineSize;Jx.lineWidth;Jx.tallSymbolWidth;function vRe(t){return t&&"opacity"in t?t.opacity*vRe(t.parent):1}async function ult(t,e){if(!t)return;const r=t.sourceLayer,i=(E(e)&&e.useSourceLayer?r:t.layer)??r,s=vRe(i);if(E(t.symbol)&&(!E(e)||e.ignoreGraphicSymbol!==!0)){const C=t.symbol.type==="web-style"?await gKe(t.symbol,{...e,cache:E(e)?e.webStyleCache:null}):t.symbol.clone();return Fz(C,null,s),C}const n=(E(e)?e.renderer:null)??(i&&"renderer"in i?i.renderer:null);let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(t,e):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...e,cache:E(e)?e.webStyleCache:null}):o.clone(),!(n&&"visualVariables"in n&&n.visualVariables&&n.visualVariables.length))return Fz(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(N(e)||N(e.arcade))){const C={...e};C.arcade=await $g(),e=C}const a=await be(()=>Promise.resolve().then(()=>Pie),void 0),l=[],c=[],h=[],p=[];for(const C of n.visualVariables)switch(C.type){case"color":l.push(C);break;case"opacity":c.push(C);break;case"rotation":p.push(C);break;case"size":C.target||h.push(C)}const A=!!l.length&&l[l.length-1],_=A?a.getColor(A,t,e):null,w=!!c.length&&c[c.length-1];let T=w?a.getOpacity(w,t,e):null;if(s!=null&&(T=T!=null?T*s:s),Fz(o,_,T),h.length){const C=a.getAllSizes(h,t,e);await fKe(o,C)}for(const C of p)mKe(o,a.getRotationAngle(C,t,e),C.axis);return o}let Vy=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const s=e[i],n=new Tbe(s,void 0,void 0,2,2);this._properties[i]={pool:n,acquired:[]}}this._afterDispatchHandle=Fbe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)qle(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const s of r.acquired)qle(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}};const hlt=Le("mac")?"Meta":"Ctrl",QU={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)QU[t]=String.fromCharCode(t);for(let t=1;t<25;t++)QU[111+t]=`F${t}`;for(let t=65;t<91;t++)QU[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function dlt(t){if(t.key!==void 0)return J1(t);const e=QU[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function plt(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let flt=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const dpe=we.getLogger("esri.views.input.InputHandler");let fl=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?dpe.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof e=="string"?new flt(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const A=p.indexOf(h);p.splice(A,1),o(),this._manager&&this._manager.updateDependencies()}},l=new mlt(n,i,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new glt(e,{onEmit:(i,s,n,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,s,n,o)},onRemove:i=>{var s;delete this._outgoing[i.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!0)}stopCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):dpe.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var i;const r=this._incoming[e.type];if(r){for(const s of r)if(s.match.matches(e)&&((i=s.callback)==null||i.call(s,e),e.shouldStopPropagation()))break}}},mlt=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},glt=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},Alt=class extends fl{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s}=e;r===this._value&&this._x===i&&this._y===s||(this._value=r,this._x=i,this._y=s,this._onChange(r,i,s))}},c9=class{constructor(e){this._observable=new fte,this._value=e}get(){return mi(this._observable),this._value}set(e){e!==this._value&&(this._value=e,this._observable.notify())}},ylt=class extends fl{get multiTouchActive(){return this._multiTouchActive.get()}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=new c9(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.set(this._activeTouchPointerIds.size>1)}},Fm=class extends Ke{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=hlt,this._latestPointerType="mouse",this._propertiesPool=new Vy({latestPointerLocation:blt},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}installHandlers(e,r,i=Uv.INTERNAL){if(this._nameToGroup[e])return void we.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void we.getLogger(this.declaredClass).error("Can't register a group of zero handlers");const s={name:e,handlers:r.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,p)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,p,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{var s;i.removed=!0,(s=i.uninstallCallback)==null||s.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):we.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const s=this._handlers[i];s.priorityIndex=i,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const s=this._handlersPriority[i];s.priorityIndex=i;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)plt(a)||r.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(N(s)||s.x!==r||s.y!==i){const n=this._propertiesPool.get("latestPointerLocation");n.x=r,n.y=i,this._set("latestPointerLocation",n)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const n=r;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,s=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,s)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const s=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=r.native;n("Alt",!(!o||!o.altKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new Alt((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new ylt,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Uv.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Uv.INTERNAL)}_setPointerCapture(e,r,i,s){const n=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,s){this._emitInputEvent(0,e,r,i,s)}_emitInputEvent(e,r,i,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new _lt(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new iQ,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var r,i;const e=Pu(this._currentPropagation);for(;e.events.length>0;){const{event:s,priorityIndex:n}=e.events.pop(),o=s.data&&s.data.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[n];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!s.shouldStopPropagation()&&((i=(r=e.currentHandler).eventCallback)==null||i.call(r,s)),s.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(s.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:s,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}_pausePropagation(e){const r=new iQ;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const s of r.handler.incomingEventMatches){if(i.eventType!==s.eventType)continue;const n=i.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===i.keyModifiers.length!=(n.length===s.keyModifiers.length))return i.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let s=0;for(;s<r.length&&this._compareHandlerPriority(i,r[s])>=0;)s++;r.splice(s,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};u([d({readOnly:!0})],Fm.prototype,"hasPendingInputs",null),u([d({constructOnly:!0})],Fm.prototype,"eventSource",void 0),u([d({constructOnly:!0})],Fm.prototype,"recognizers",void 0),u([d()],Fm.prototype,"_latestPointerType",void 0),u([d()],Fm.prototype,"latestPointerType",null),u([d()],Fm.prototype,"multiTouchActive",null),u([d({readOnly:!0})],Fm.prototype,"latestPointerLocation",void 0),Fm=u([j("esri.views.input.InputManager")],Fm);let _lt=class{constructor(e,r,i,s,n){this.type=e,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=j1.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=j1.STOPPED}shouldStopPropagation(){return(this._propagationState&j1.STOPPED)!=0}async(e){this._propagationState|=j1.PAUSED;const r=(i,s)=>{this._propagationState&=~j1.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&j1.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var j1;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(j1||(j1={}));const Uv={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let vlt=class{};const blt=vlt;function ppe(t){return t&&typeof t.highlight=="function"}function wlt(t){return t&&typeof t.maskOccludee=="function"}function Lkt(t,e,r){return N(t)||t>r&&(e===0||t<e)}function Dkt(t,e){return E(t)&&t>0||E(e)&&e>0}function Nkt(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}const sse=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return DB(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return u([d()],e.prototype,"goToOverride",void 0),u([d()],e.prototype,"view",void 0),e=u([j("esri.widgets.support.GoTo")],e),e},HI=or.ofType({key:"type",defaultKeyValue:"button",base:eU,typeMap:{button:OM,toggle:hxe}}),xlt=()=>[ix.clone()],Tlt=()=>[AC.clone(),yC.clone()];let ji=class extends sse(oRe){get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}constructor(e){super(e),this._handles=new ts,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new HI,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new pl({symbol:new Eb({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this._handles.add([xe(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),xe(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),xe(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),xe(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.animation)==null?void 0:r.state},e=>this._animationStateChange(e)),xe(()=>this.location,e=>this._locationChange(e)),xe(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),xe(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),xe(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),xe(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>Nat({event:e,view:this.view})),Nl(()=>!this.waitingForResult,()=>this._waitingForResultChange(),os),xe(()=>{var e,r;return[this.features,(e=this.view)==null?void 0:e.map,(r=this.view)==null?void 0:r.spatialReference]},()=>this._updateFeatureVMs()),xe(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),Nl(()=>!this.visible,()=>this.browseClusterEnabled=!1),xe(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new HI;e.removeAll();const{actions:r,defaultActions:i,defaultPopupTemplateEnabled:s,includeDefaultActions:n,selectedFeature:o}=this,a=n?i.concat(r):r,l=o&&(typeof o.getEffectivePopupTemplate=="function"&&o.getEffectivePopupTemplate(s)||o.popupTemplate),c=l&&l.actions,h=l&&l.overwriteActions?c:c?c.concat(a):a;return h&&h.filter(Boolean).forEach(p=>e.add(p)),e}get defaultActions(){const e=this._get("defaultActions")||new HI;return e.removeAll(),e.addMany(N2(this.selectedFeature)?Tlt():xlt()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const r=e||[];this._set("features",r);const{pendingPromisesCount:i,promiseCount:s,selectedFeatureIndex:n}=this,o=s&&r.length;o&&i&&n===-1?this.selectedFeatureIndex=0:o&&n!==-1||(this.selectedFeatureIndex=r.length?0:-1)}get location(){return this._get("location")||null}set location(e){var s,n,o;let r=e;const i=(n=(s=this.view)==null?void 0:s.spatialReference)==null?void 0:n.isWebMercator;e&&((o=e==null?void 0:e.spatialReference)!=null&&o.isWGS84)&&i&&(r=gy(e)),this._set("location",r)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(r=>{this._pendingPromises.add(r);const i=n=>{this._pendingPromises.has(r)&&this._updateFeatures(n),this._updatePendingPromises(r)},s=()=>this._updatePendingPromises(r);r.then(i,s)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:r}=this;return r===-1?null:e[r]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:r}=this;e=isNaN(e)||e<-1||!r?-1:(e+r)%r,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,r=lRe(this);return r&&e?this.callGoTo({target:{target:r,scale:e.scale}}):Promise.reject(new ce("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:r,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,r){const{view:i}=this;if(!i||!e)throw new ce("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return i.fetchPopupFeatures(e,{event:r&&r.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:r&&r.signal})}open(e){const r={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=r;delete r.fetchFeatures,i&&this._setFetchFeaturesPromises(r.location);const s=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const n of s)delete r[n];this.set(r)}triggerAction(e){const r=this.allActions.getItemAt(e);r&&!r.disabled&&this.emit("trigger-action",{action:r})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){zat(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:r}=this;(e==null?void 0:e.type)==="2d"?N2(r)?(await Uat(this),await Vat(this)):we.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",r):we.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",r)}_animationStateChange(e){this.zoomToLocation||(ix.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var r;const e=(r=this.view)==null?void 0:r.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),this._selectedClusterFeature&&e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(N2(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:r,updateLocationEnabled:i}=this;i&&e&&(!r||r.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:r,featurePage:i,featuresPerPage:s,featureViewModels:n}=this;if(i===null)return;const o=((i-1)*s+r)%r,a=o+s;n.slice(o,a).forEach((l,c)=>{l&&!l.graphic&&(l.graphic=e[o+c])})}async _selectedFeatureChange(e){const{location:r,updateLocationEnabled:i,view:s}=this;if(e&&s){if(this.browseClusterEnabled)return this._selectedClusterFeature&&(s.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),N2(e)?void 0:(e.symbol=await ult(e),this._selectedClusterFeature=e,void s.graphics.add(this._selectedClusterFeature));!i&&r||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{var o;const n=(o=s.center)==null?void 0:o.clone();n&&(this.location=n)}):this.location=cRe(e.geometry)}}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(r=>{const{clientOnlyGraphics:i,promisesPerLayerView:s}=r,n=Promise.resolve(i),o=s.map(a=>a.promise);this.promises=[n,...o]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:r,featureViewModels:i}=this;if(N2(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!r||!r.length)return;const s=i.slice(0),n=[];r.forEach((o,a)=>{var c,h;if(!o)return;let l=null;if(s.some((p,A)=>(p&&p.graphic===o&&(l=p,s.splice(A,1)),!!l)),l)n[a]=l;else{const p=new Kie({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(c=this.view)==null?void 0:c.spatialReference,graphic:o===e?o:null,map:(h=this.view)==null?void 0:h.map,view:this.view});n[a]=p}}),s.forEach(o=>o&&!o.destroyed&&o.destroy()),this._set("featureViewModels",n)}_getScreenPoint(e){const{view:r}=this;return r&&e&&typeof r.toScreen=="function"?r.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:r,autoOpenEnabled:i}=this;if(r.remove(e),i&&this.view){const s=this.view.on("click",n=>{n.pointerType==="mouse"&&n.button!==0||this._fetchFeaturesAndOpen(n)},Uv.WIDGET);r.add(s,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,r){this._cancelFetchingFeatures();const i=new AbortController,{signal:s}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const n=this.fetchFeatures(e,{signal:s,event:r});return n.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),n}_fetchFeaturesAndOpen(e){const{screenPoint:r,mapPoint:i}=e,{view:s}=this;this._fetchFeaturesWithController(r,e).then(n=>{var h;const{clientOnlyGraphics:o,promisesPerLayerView:a,location:l}=n,c=[Promise.resolve(o),...a.map(p=>p.promise)];return(h=s==null?void 0:s.popup)==null||h.open({location:l||i,promises:c}),n})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,r){return await e.when(),e.whenLayerView(r)}_getHighlightLayer(e){const{layer:r,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:r}_getHighlightTarget(e,r){const i=r.type==="imagery"?void 0:"objectIdField"in r?r.objectIdField||zSe:null,s=e.attributes;return s&&i&&s[i]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:r,view:i,activeFeature:s,visible:n}=this;if(!(s&&i&&r&&n))return;const o=this._getHighlightLayer(s);if(!(o&&o instanceof z$))return;const a=this._getLayerView(i,o);this._highlightActiveFeaturePromise=a;const l=await a;if(!(l&&ppe(l)&&this._highlightActiveFeaturePromise===a&&this.activeFeature&&this.highlightEnabled))return;const c=l.highlight(this._getHighlightTarget(s,o));this._handles.add(c,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:r,highlightEnabled:i,view:s,visible:n}=this;if(!(r&&s&&i&&n))return;const o=this._getHighlightLayer(r);if(!(o&&o instanceof z$))return;const a=this._getLayerView(s,o);this._highlightSelectedFeaturePromise=a;const l=await a;if(!(l&&ppe(l)&&this._highlightSelectedFeaturePromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const c=l.highlight(this._getHighlightTarget(r,o));this._handles.add(c,e)}_updateFeatures(e){const{features:r}=this;if(!e||!e.length)return;if(!r.length)return void(this.features=e);const i=e.filter(s=>!r.includes(s));this.features=r.concat(i)}};u([d()],ji.prototype,"featurePage",void 0),u([d()],ji.prototype,"isLoadingFeature",null),u([d({type:HI})],ji.prototype,"actions",void 0),u([d({readOnly:!0})],ji.prototype,"active",null),u([d()],ji.prototype,"activeFeature",void 0),u([d({readOnly:!0})],ji.prototype,"allActions",null),u([d({type:Boolean})],ji.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],ji.prototype,"autoCloseEnabled",void 0),u([d()],ji.prototype,"autoOpenEnabled",void 0),u([d()],ji.prototype,"browseClusterEnabled",void 0),u([d()],ji.prototype,"content",void 0),u([d({type:HI,readOnly:!0})],ji.prototype,"defaultActions",null),u([d({readOnly:!0})],ji.prototype,"featureCount",null),u([d()],ji.prototype,"features",null),u([d()],ji.prototype,"featuresPerPage",void 0),u([d()],ji.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],ji.prototype,"featureViewModels",void 0),u([d()],ji.prototype,"highlightEnabled",void 0),u([d()],ji.prototype,"includeDefaultActions",void 0),u([d({type:Gt})],ji.prototype,"location",null),u([d({readOnly:!0})],ji.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],ji.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],ji.prototype,"waitingForResult",null),u([d({readOnly:!0})],ji.prototype,"promiseCount",null),u([d()],ji.prototype,"promises",null),u([d({value:null,readOnly:!0})],ji.prototype,"selectedFeature",null),u([d({value:-1})],ji.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],ji.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],ji.prototype,"state",null),u([d()],ji.prototype,"title",void 0),u([d()],ji.prototype,"updateLocationEnabled",void 0),u([d()],ji.prototype,"view",void 0),u([d()],ji.prototype,"visible",void 0),u([d()],ji.prototype,"zoomFactor",void 0),u([d()],ji.prototype,"zoomToLocation",void 0),u([d()],ji.prototype,"centerAtLocation",null),ji=u([j("esri.widgets.Popup.PopupViewModel")],ji);const bRe=ji,fpe="selected-index",Slt=0,mpe="popup-spinner",gpe={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Ape="esri-popup";function oA(t,e){return e===void 0?`${Ape}__${t}`:`${Ape}__${t}-${e}`}const ype={closeButton:!0,featureNavigation:!0};let br=class extends sRe(pc){constructor(e,r){super(e,r),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new ts,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverNode=null,this._featureMenuViewportNode=null,this._rootFlowItemNode=null,this._featureMenuIntersectionObserverCallback=([i])=>{i!=null&&i.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=WC(()=>this._displaySpinner(),Slt),this._exitRelatedRecordsActions=new WeakMap,this._featureSelectionActions=new WeakMap,this._flowItems=new or,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureMenuOpen=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new bRe,this.visibleElements={...ype},this._handleOpenRelatedFeature=i=>{this._openRelatedFeature(i)},this._addSelectedFeatureIndexHandle(),this.addHandles([xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},()=>this._positionContainer()),xe(()=>{var i;return[(i=this.viewModel)==null?void 0:i.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},(i,s)=>{!!i!=!!s&&this.reposition()}),xe(()=>{var i,s,n,o,a,l;return[(s=(i=this.viewModel)==null?void 0:i.view)==null?void 0:s.padding,(o=(n=this.viewModel)==null?void 0:n.view)==null?void 0:o.size,(a=this.viewModel)==null?void 0:a.active,(l=this.viewModel)==null?void 0:l.location,this.alignment]},()=>this.reposition()),xe(()=>this.spinnerEnabled,i=>this._spinnerEnabledChange(i)),xe(()=>{var i,s;return(s=(i=this.viewModel)==null?void 0:i.view)==null?void 0:s.size},(i,s)=>this._updateDockEnabledForViewSize(i,s)),xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.view},(i,s)=>this._viewChange(i,s)),xe(()=>{var i,s;return(s=(i=this.viewModel)==null?void 0:i.view)==null?void 0:s.ready},(i,s)=>this._viewReadyChange(i??!1,s??!1)),xe(()=>{var i,s;return[(i=this.viewModel)==null?void 0:i.waitingForResult,(s=this.viewModel)==null?void 0:s.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),xe(()=>this.selectedFeatureWidget,()=>this._destroyFlowItemWidgets()),xe(()=>{var i,s,n,o;return[(s=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:s.title,(o=(n=this.selectedFeatureWidget)==null?void 0:n.viewModel)==null?void 0:o.state]},()=>this._setTitleFromFeatureWidget()),xe(()=>{var i,s,n,o;return[(s=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:s.content,(o=(n=this.selectedFeatureWidget)==null?void 0:n.viewModel)==null?void 0:o.state]},()=>this._setContentFromFeatureWidget()),Nl(()=>!this.collapsed,()=>{var i,s;((s=(i=this.viewModel)==null?void 0:i.view)==null?void 0:s.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),Co(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},"change",()=>this._watchActions()),xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},()=>this._watchActions(),Cr),xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.featureViewModels},()=>this._featureMenuViewportScrollTop()),Co(()=>this._flowItems,"change",()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()}),xe(()=>{var i,s,n,o;return[(s=(i=this._activeFlowItemWidget)==null?void 0:i.viewModel)==null?void 0:s.state,(o=(n=this._activeFlowItemWidget)==null?void 0:n.viewModel)==null?void 0:o.title]},()=>this.scheduleRender())])}loadDependencies(){return Promise.all([be(()=>import("./calcite-flow-36b146b1.js"),["assets/calcite-flow-36b146b1.js","assets/observers-4f67f1fb.js"]),be(()=>import("./calcite-flow-item-d286dfc0.js"),["assets/calcite-flow-item-d286dfc0.js","assets/interactive-573cbe88.js","assets/loadable-25ad9e4e.js","assets/t9n-54eb0626.js","assets/observers-4f67f1fb.js","assets/guid-9426053f.js","assets/action-b70fe9c6.js","assets/icon-d40cf52f.js","assets/loader-4670b2b6.js","assets/tooltip-179a3504.js","assets/debounce-31e0cfcc.js","assets/scrim-085bbb7c.js"]),be(()=>import("./calcite-action-164dd21f.js"),["assets/calcite-action-164dd21f.js","assets/action-b70fe9c6.js","assets/guid-9426053f.js","assets/interactive-573cbe88.js","assets/loadable-25ad9e4e.js","assets/t9n-54eb0626.js","assets/observers-4f67f1fb.js","assets/icon-d40cf52f.js","assets/loader-4670b2b6.js"]),be(()=>import("./calcite-tooltip-62471781.js"),["assets/calcite-tooltip-62471781.js","assets/tooltip-179a3504.js","assets/debounce-31e0cfcc.js","assets/guid-9426053f.js"]),be(()=>import("./calcite-icon-8ca968f8.js"),["assets/calcite-icon-8ca968f8.js","assets/icon-d40cf52f.js","assets/observers-4f67f1fb.js"])])}destroy(){var e,r;this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(r=this._featureMenuIntersectionObserver)==null||r.disconnect()}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:e,viewModel:r}=this;if(!e)return!!(r!=null&&r.content);const i=e.viewModel;if(i!=null&&i.waitingForContent||(i==null?void 0:i.state)==="error")return!0;const s=i==null?void 0:i.content;return Array.isArray(s)?!!s.length:!!s}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation!=null}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:e}=this;return e.getItemAt(e.length-1)||null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get autoOpenEnabled(){return this.viewModel.autoOpenEnabled}set autoOpenEnabled(e){this.viewModel.autoOpenEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||gpe}set dockOptions(e){var l,c;const r={...gpe},i=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.breakpoints,s={};i&&(s.width=i.xsmall,s.height=i.xsmall);const n={...r,...e},o={...r.breakpoint,...s},{breakpoint:a}=n;typeof a=="object"?n.breakpoint={...o,...a}:a&&(n.breakpoint=o),this._set("dockOptions",n),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,visibleElements:r,headingLevel:i,_flowItems:s}=this,{selectedFeatureViewModel:n}=this.viewModel,o={...r,title:!1};return n?(e?(e.viewModel=n,e.visibleElements=o):this._feature=new Iat({flowItems:s,headingLevel:i+1,viewModel:n,visibleElements:o}),this._feature):null}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}castVisibleElements(e){return{...ype,...e}}blur(){const{active:e}=this.viewModel;e||we.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,r){return this.viewModel.fetchFeatures(e,r)}focus(){const{active:e}=this.viewModel;e||we.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var n,o;this._handles.remove(fpe);const r=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,s={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:r};((o=(n=this.viewModel)==null?void 0:n.view)==null?void 0:o.widthBreakpoint)==="xsmall"&&(s.collapsed=!0),this.set(s),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var T,C,M,O;const{actionsMenuOpen:e,dockEnabled:r,featureMenuVisible:i,dividedActions:s,currentAlignment:n,currentDockPosition:o}=this,{active:a}=this.viewModel,{menuActions:l}=s,c=a&&l.length>1&&e,h=a&&r,p=a&&!r,A=(C=(T=this.selectedFeature)==null?void 0:T.layer)==null?void 0:C.title,_=(O=(M=this.selectedFeature)==null?void 0:M.layer)==null?void 0:O.id,w={[rt.alignTopCenter]:n==="top-center",[rt.alignBottomCenter]:n==="bottom-center",[rt.alignTopLeft]:n==="top-left",[rt.alignBottomLeft]:n==="bottom-left",[rt.alignTopRight]:n==="top-right",[rt.alignBottomRight]:n==="bottom-right",[rt.isDocked]:h,[rt.shadow]:p,[rt.isDockedTopLeft]:o==="top-left",[rt.isDockedTopCenter]:o==="top-center",[rt.isDockedTopRight]:o==="top-right",[rt.isDockedBottomLeft]:o==="bottom-left",[rt.isDockedBottomCenter]:o==="bottom-center",[rt.isDockedBottomRight]:o==="bottom-right",[rt.isFeatureMenuOpen]:i,[rt.isActionsMenuOpen]:c};return pe("div",{class:this.classes(rt.base,w),role:"presentation","data-layer-title":A,"data-layer-id":_,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},a?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return pe("span",{"aria-hidden":"true",class:this.classes(rt.icon,rt.iconLoading,rt.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?pe("div",{key:oA("loading-container"),role:"presentation",class:rt.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=w0(this.container),r={[rt.iconRightTriangleArrow]:e,[rt.paginationPreviousIconRTL]:e,[rt.iconLeftTriangleArrow]:!e,[rt.paginationPreviousIconLTR]:!e};return pe("span",{"aria-hidden":"true",class:this.classes(rt.icon,r)})}renderPreviousButton(){const{messages:e}=this;return pe("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(rt.button,rt.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=w0(this.container),r={[rt.iconLeftTriangleArrow]:e,[rt.paginationNextIconRTL]:e,[rt.iconRightTriangleArrow]:!e,[rt.paginationNextIconLTR]:!e};return pe("span",{"aria-hidden":"true",class:this.classes(rt.icon,r)})}renderNextButton(){const{messages:e}=this;return pe("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(rt.button,rt.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:r,messagesCommon:i}=this,{featureCount:s,selectedFeatureIndex:n}=this.viewModel;return pe("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(rt.button,rt.featureMenuButton),"aria-haspopup":"true","aria-controls":r,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(s,n))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:[]}renderDockIcon(){const{dockEnabled:e}=this,r=this._wouldDockTo(),i={[rt.iconUndock]:e,[rt.iconDock]:!e,[rt.iconDockToRight]:!e&&(r==="top-right"||r==="bottom-right"),[rt.iconDockToLeft]:!e&&(r==="top-left"||r==="bottom-left"),[rt.iconDockToTop]:!e&&r==="top-center",[rt.iconDockToBottom]:!e&&r==="bottom-center"};return pe("span",{"aria-hidden":"true",class:this.classes(i,rt.icon)})}renderDockButton(){var n,o,a;const{dockEnabled:e,messages:r}=this,i=(o=(n=this.viewModel)==null?void 0:n.view)==null?void 0:o.widthBreakpoint,s=e?r.undock:r.dock;return i!=="xsmall"&&((a=this.dockOptions)!=null&&a.buttonEnabled)?pe("div",{role:"button","aria-label":s,title:s,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(rt.button,rt.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:r,collapsible:i,contentCollapsed:s,messagesCommon:n}=this,o={[rt.headerContainerButton]:i},a=pe(c4,{level:this.headingLevel,class:rt.headerTitle,innerHTML:e??""}),l=i?pe("button",{key:`${e}--collapsible`,id:r,title:s?n.expand:n.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(rt.headerContainer,o),"aria-expanded":s?"false":"true",onclick:this._toggleCollapsed,type:"button"},a,pe("calcite-icon",{class:rt.collapseIcon,key:"collapse-icon",icon:s?"chevron-down":"chevron-up",scale:"m"})):pe("div",{key:e??"title",id:r,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(rt.headerContainer,o)},a);return e?l:null}renderCloseIcon(){return pe("span",{"aria-hidden":"true",class:this.classes(rt.icon,rt.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:r}=this;return e.closeButton?pe("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:rt.button,"aria-label":r.close,title:r.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return pe("header",{class:rt.header},this.renderTitle(),pe("div",{class:rt.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:r,contentCollapsed:i,_flowItems:s}=this,{content:n}=this.viewModel,o=s.toArray(),a={[rt.contentHasFlows]:!!o.length};return r&&!i?pe("div",{key:n??"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:this.classes(rt.content,a)},pe("calcite-flow",{bind:this},pe("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:n4,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),o.map(l=>this.renderFlowItem(l))),o.map(l=>this.renderFlowItemTooltips(l))):null}renderFlowItem(e){const{messages:r}=this,i=Jk(),s="graphic"in e&&!e.isTable;return pe("calcite-flow-item",{bind:this,class:this.classes({[rt.calciteThemeDark]:!i,[rt.calciteThemeLight]:i}),heading:e.title??"",description:this._getFlowItemDescription(e),onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${e.viewModel.uid}`},pe("calcite-action",{class:rt.actionExit,icon:"move-up",label:r==null?void 0:r.exitRelatedRecords,text:r==null?void 0:r.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:n=>this._storeExitRelatedRecordsAction(e,n),onclick:this._destroyFlowItemWidgets}),s?pe("calcite-action",{class:rt.actionSelectFeature,icon:"zoom-to-object",label:r==null?void 0:r.selectFeature,text:r==null?void 0:r.selectFeature,slot:"header-actions-end",bind:this,afterCreate:n=>this._storeFeatureSelectionAction(e,n),onclick:()=>this._handleOpenRelatedFeature(e)}):null,pe("div",{class:this.classes(rt.contentFlowItem,{[rt.calciteThemeDark]:i,[rt.calciteThemeLight]:!i})},e.render()))}renderFlowItemTooltips(e){const{messages:r,_exitRelatedRecordsActions:i,_featureSelectionActions:s}=this,n=Jk(),o=s.get(e);return[pe("calcite-tooltip",{class:this.classes({[rt.calciteThemeDark]:!n,[rt.calciteThemeLight]:n}),key:`exit-related-records-tooltip-${e.viewModel.uid}`,label:r==null?void 0:r.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:i.get(e),placement:"top"},r==null?void 0:r.exitRelatedRecords),o?pe("calcite-tooltip",{class:this.classes({[rt.calciteThemeDark]:!n,[rt.calciteThemeLight]:n}),key:`select-related-record-tooltip-${e.viewModel.uid}`,label:r==null?void 0:r.selectFeature,overlayPositioning:"fixed",referenceElement:o,placement:"top"},r==null?void 0:r.selectFeature):null]}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:r,actionsMenuOpen:i,dividedActions:s,messagesCommon:n}=this,o=i?n.close:n.open,{menuActions:a}=s;return a.length?pe("div",{key:oA("actions-menu-button"),class:this.classes(rt.button,rt.actionsMenuButton),role:"button",id:r,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},pe("span",{"aria-hidden":"true",class:rt.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:r,actionsMenuOpen:i,dividedActions:s}=this,{menuActions:n}=s;return n.length&&i?pe("ul",{id:e,role:"menu","aria-labelledby":r,key:oA("actions"),class:rt.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},n.toArray().map(o=>this.renderAction({action:o,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return e.length?e.toArray().map(r=>this.renderAction({action:r,type:"inline"})):[]}renderInlineActionsContainer(){const{inlineActions:e,menuActions:r}=this.dividedActions,i=!!e.length,s=!!r.length;return i||s?pe("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":s.toString(),class:rt.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?pe("section",{key:oA("navigation"),class:this.classes(rt.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:r}=this,{inlineActions:i,menuActions:s}=r,n=!!i.length,o=!!s.length,a={[rt.footerHasPagination]:e,[rt.footerHasActions]:n,[rt.footerHasActionsMenu]:o};return e||n?pe("div",{key:oA("feature-buttons"),class:this.classes(rt.footer,a)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:r,isLoadingFeature:i}=this.viewModel,s=Zm(e.selectedFeatures,{total:r.length});return pe("section",{key:oA("menu"),class:rt.featureMenu},pe("strong",{class:rt.featureMenuHeader},s),pe("nav",{bind:this,class:rt.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:n4},this.renderFeatureMenu(),pe("div",{class:rt.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?pe("div",{class:rt.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:pe("div",{key:oA("pointer"),class:rt.pointer,role:"presentation"},pe("div",{class:this.classes(rt.pointerDirection,rt.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:r,currentDockPosition:i,titleId:s,contentId:n,collapsible:o,hasContent:a,contentCollapsed:l,visibleElements:c}=this,{title:h}=this.viewModel,p=r==="bottom-left"||r==="bottom-center"||r==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",A=r==="top-left"||r==="top-center"||r==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",_={[rt.shadow]:e,[rt.isCollapsible]:o,[rt.isCollapsed]:l};return pe("div",{class:this.classes(rt.main,rt.widget,_),tabIndex:c.closeButton?void 0:-1,role:"dialog","aria-labelledby":h?s:"","aria-describedby":a&&!l?n:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),A?this.renderFooter():null,A?this.renderFeatureMenuContainer():null)}renderContent(){var r;const e=(r=this.viewModel)==null?void 0:r.content;return e?typeof e=="string"?pe("div",{class:go.contentNode,key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return pe("span",{key:"text",class:rt.actionText},e)}renderActionIcon(e){const r=this._getActionClass(e),i=this._getActionImage(e),s={[rt.iconLoading]:e.active,[rt.rotating]:e.active,[rt.icon]:!!r,[rt.actionImage]:!e.active&&!!i};return r&&(s[r]=!e.active),pe("span",{key:"icon","aria-hidden":"true",class:this.classes(rt.icon,s),styles:this._getIconStyles(i)})}renderAction(e){const{action:r,type:i}=e,s=this._getActionTitle(r),n={[rt.action]:r.type!=="toggle",[rt.actionToggle]:r.type==="toggle",[rt.actionToggleOn]:r.type==="toggle"&&r.value,[rt.buttonDisabled]:r.disabled},o=[this.renderActionIcon(r),this.renderActionText(s)],a=i==="menu-item"?pe("li",{key:r.uid,role:"menuitem",tabIndex:0,title:s,"aria-label":s,class:this.classes(rt.button,n),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":r.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o):pe("div",{key:r.uid,role:"button",tabIndex:0,title:s,"aria-label":s,class:this.classes(rt.button,n),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":r.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return r.visible?a:null}renderFeatureMenuItem(e,r){const{messages:i,messagesCommon:s}=this,{selectedFeatureIndex:n,selectedFeatureViewModel:o}=this.viewModel,a=e===o,l={[rt.featureMenuSelected]:a},c=a?pe("span",{key:oA(`feature-menu-selected-feature-${n}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:rt.iconCheckMark}):null,h=pe("span",{innerHTML:e.title||s.untitled});return pe("li",{role:"menuitem",tabIndex:-1,key:oA(`feature-menu-feature-${n}`),class:this.classes(l,rt.featureMenuItem),bind:this,"data-feature-index":r,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},pe("span",{class:rt.featureMenuTitle},h,c))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:r}=this.viewModel;return r.length>1?pe("ol",{class:rt.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},r.filter(i=>!!i.graphic).map((i,s)=>this.renderFeatureMenuItem(i,s))):null}_storeFeatureSelectionAction(e,r){this._featureSelectionActions.set(e,r),this.scheduleRender()}_storeExitRelatedRecordsAction(e,r){this._exitRelatedRecordsActions.set(e,r),this.scheduleRender()}_getFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const r=e.graphic,i=r==null?void 0:r.geometry;if(N(i)||N(r))return;this._destroyFlowItemWidgets(),await this.viewModel.zoomTo({target:i});const s=cRe(i);this.open({features:[r],location:E(s)?s:void 0})}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_handleBackClick(){const e=this._flowItems.pop();e&&(this._exitRelatedRecordsActions.delete(e),this._featureSelectionActions.delete(e),"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_getActionTitle(e){const{messages:r,selectedFeature:i,messagesCommon:s}=this,{id:n}=e,o=i==null?void 0:i.attributes,a=e.title??"",l=n==="zoom-to-feature"?Zm(a,{messages:r}):n==="remove-selected-feature"?Zm(a,{messages:s}):n==="zoom-to-clustered-features"||n==="browse-clustered-features"?Zm(a,{messages:r}):e.title;return l&&o?Zm(l,o):l??""}_getActionClass(e){const{selectedFeature:r}=this,i=r==null?void 0:r.attributes,{className:s,image:n}=e,o=n||s?s:rt.iconDefaultAction;return o&&i?Zm(o,i):o??""}_getActionImage(e){const{selectedFeature:r}=this,i=r==null?void 0:r.attributes,{image:s}=e;return s&&i?Zm(s,i):s??""}_createFeatureUpdatedAnimation(){return _Qe("enter",rt.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:r}=this;if(typeof e!="number")return null;const i=Math.round(e);return Math.max(r?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const r="actions";this._handles.remove(r),e&&e.forEach(i=>{this._handles.add(xe(()=>[i.uid,i.active,i.className,i.disabled,i.id,i.title,i.image,i.visible],()=>this.scheduleRender()),r)})}_divideActions(){const{allActions:e}=this.viewModel,r=e.filter(o=>o.visible),i=this._getInlineActionCount(),s=i===null,n=i===0;return{inlineActions:s?r.slice(0):n?new or:r.slice(0,i),menuActions:s?new or:n?r.slice(0):r.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var i,s;const{selectedFeatureWidget:e,messagesCommon:r}=this;e&&(this.viewModel.title=((i=e.viewModel)==null?void 0:i.state)==="error"?r.errorMessage:((s=e.viewModel)==null?void 0:s.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){J1(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){J1(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:r}=this,i=e.currentTarget["data-feature-index"];r.activeFeature=r.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const r=J1(e),{_featureMenuNode:i}=this,s=e.currentTarget["data-feature-index"];if(!i)return;const n=i.querySelectorAll("li"),o=n.length;r!=="ArrowUp"?r!=="ArrowDown"?r!=="Home"?r!=="End"||(e.stopPropagation(),n[n.length-1].focus()):(e.stopPropagation(),n[0].focus()):(e.stopPropagation(),n[(s+1+o)%o].focus()):(e.stopPropagation(),n[(s-1+o)%o].focus())}_handleActionMenuItemKeyup(e){const r=J1(e),{_actionsMenuNode:i}=this,s=e.currentTarget.dataset.actionUid,{menuActions:n}=this.dividedActions,o=n.findIndex(c=>c.uid===s);if(!i)return;const a=i.querySelectorAll("li"),l=a.length;r!=="ArrowUp"?r!=="ArrowDown"?r!=="Home"?r!=="End"||(e.stopPropagation(),a[a.length-1].focus()):(e.stopPropagation(),a[0].focus()):(e.stopPropagation(),a[(o+1+l)%l].focus()):(e.stopPropagation(),a[(o-1+l)%l].focus())}_handleMainKeyup(e){const r=J1(e);r==="ArrowLeft"&&(e.stopPropagation(),this.previous()),r==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const r=this.get("viewModel.view");this._createSpinner(r)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:r,waitingForResult:i}=this.viewModel;i&&r?e.show({location:r}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e!=null&&e.shouldFocus&&(await Q$(()=>{var r;return((r=this.viewModel)==null?void 0:r.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=xe(()=>{var r;return(r=this.viewModel)==null?void 0:r.selectedFeatureIndex},(r,i)=>this._selectedFeatureIndexUpdated(r,i));this._handles.add(e,fpe)}_selectedFeatureIndexUpdated(e,r){const{featureCount:i}=this;i&&e!==r&&e!==-1&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,r){return e.x>-1&&e.y>-1&&e.x<=r.width&&e.y<=r.height}_isOutsideView(e){const{popupHeight:r,popupWidth:i,screenLocation:s,side:n,view:o}=e;if(isNaN(i)||isNaN(r)||!o||!s)return!1;const a=o.padding;return n==="right"&&s.x+i/2>o.width-a.right||n==="left"&&s.x-i/2<a.left||n==="top"&&s.y-r<a.top||n==="bottom"&&s.y+r>o.height-a.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:r,_containerNode:i,_mainContainerNode:s,viewModel:n}=this,{screenLocation:o,view:a}=n;if(N(o)||!a||!i)return"top-center";if(!this._isScreenLocationWithinView(o,a))return this._get("currentAlignment")||"top-center";function l(L){return parseInt(L.replace(/[^-\d\.]/g,""),10)}const c=s?window.getComputedStyle(s,null):null,h=c?l(c.getPropertyValue("max-height")):0,p=c?l(c.getPropertyValue("height")):0,{height:A,width:_}=i.getBoundingClientRect(),w=_+r,T=Math.max(A,h,p)+r,C=this._isOutsideView({popupHeight:T,popupWidth:w,screenLocation:o,side:"right",view:a}),M=this._isOutsideView({popupHeight:T,popupWidth:w,screenLocation:o,side:"left",view:a}),O=this._isOutsideView({popupHeight:T,popupWidth:w,screenLocation:o,side:"top",view:a}),$=this._isOutsideView({popupHeight:T,popupWidth:w,screenLocation:o,side:"bottom",view:a});return M?O?"bottom-right":"top-right":C?O?"bottom-left":"top-left":O?$?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:r}=this;return r||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const r=["left","right"];return w0(this.container)&&r.reverse(),e.replace(/leading/gi,r[0]).replace(/trailing/gi,r[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var a;if(e!=="auto")return e;const r=(a=this.viewModel)==null?void 0:a.view,i=w0(this.container)?"top-left":"top-right";if(!r)return i;const s=r.padding||{left:0,right:0,top:0,bottom:0},n=r.width-s.left-s.right,{breakpoints:o}=r;return o&&n<=o.xsmall?"bottom-center":i}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:r}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),s=this._calculatePositionStyle(r,i);s&&Object.assign(this._containerNode.style,s)}_calculateFullWidth(e){const{currentAlignment:r,_pointerOffsetInPx:i}=this;return r==="top-left"||r==="bottom-left"||r==="top-right"||r==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,r,i,s){const{currentAlignment:n,_pointerOffsetInPx:o}=this;if(!i)return;const{padding:a}=i,l=s/2,c=i.height-r,h=i.width-e;return n==="bottom-center"?{top:r+o-a.top,left:e-l-a.left}:n==="top-left"?{bottom:c+o-a.bottom,right:h+o-a.right}:n==="bottom-left"?{top:r+o-a.top,right:h+o-a.right}:n==="top-right"?{bottom:c+o-a.bottom,left:e+o-a.left}:n==="bottom-right"?{top:r+o-a.top,left:e+o-a.left}:n==="top-center"?{bottom:c+o-a.bottom,left:e-l-a.left}:void 0}_calculatePositionStyle(e,r){const{dockEnabled:i,view:s}=this;if(!s)return;if(i)return{left:"",top:"",right:"",bottom:""};if(N(e)||!r)return;const n=this._calculateFullWidth(r),o=this._calculateAlignmentPosition(e.x,e.y,s,n);return o?{top:o.top!==void 0?`${o.top}px`:"auto",left:o.left!==void 0?`${o.left}px`:"auto",bottom:o.bottom!==void 0?`${o.bottom}px`:"auto",right:o.right!==void 0?`${o.right}px`:"auto"}:void 0}_viewChange(e,r){e&&r&&(this.close(),this.clear())}_viewReadyChange(e,r){if(e){const i=this.get("viewModel.view");this._wireUpView(i)}else r&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:r}=this;r&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,r,i){const[s,n]=e,[o,a]=r,{width:l=0,height:c=0}=i??{};return s<=l&&o>l||s>l&&o<=l||n<=c&&a>c||n>c&&a<=c}_updateDockEnabledForViewSize(e,r){if(!e||!r)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},s=i.left+i.right,n=i.top+i.bottom,o=[],a=[];o[0]=e[0]-s,o[1]=e[1]-n,a[0]=r[0]-s,a[1]=r[1]-n;const{dockOptions:l}=this,c=l.breakpoint;this._dockingThresholdCrossed(o,a,c)&&this._setDockEnabledForViewSize(l),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const r=e.querySelectorAll("li");r.length&&r[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const r=e.querySelectorAll("li");r.length&&r[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:r}=this;if(!r)return;const i=r.active&&!e;r.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var l,c;const r=e.breakpoint,i=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.ui;if(!i)return!1;const{width:s,height:n}=i;if(isNaN(s)||isNaN(n)||!r)return!1;const o=r.hasOwnProperty("width")&&s<=(r.width??0),a=r.hasOwnProperty("height")&&n<=(r.height??0);return o||a}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,r){return this.featureNavigationVisible?Zm(this.messages.pageText,{index:r+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:r}=this;e&&(r&&r.ui&&r.ui.remove(e,mpe),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new Lat({view:e}),e.ui.add(this._spinner,{key:mpe,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const r=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,s=i.findIndex(o=>o.uid===r),n=i.getItemAt(s);n&&n.type==="toggle"&&(n.value=!n.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(s)}_selectFeature(e){const r=e.currentTarget["data-feature-index"];isNaN(r)||(this.viewModel.selectedFeatureIndex=r),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],br.prototype,"actionsMenuId",null),u([d({readOnly:!0})],br.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],br.prototype,"featureMenuId",null),u([d({readOnly:!0})],br.prototype,"titleId",null),u([d({readOnly:!0})],br.prototype,"contentId",null),u([d({readOnly:!0})],br.prototype,"hasContent",null),u([d({readOnly:!0})],br.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],br.prototype,"collapsible",null),u([d({readOnly:!0})],br.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],br.prototype,"contentCollapsed",null),u([d({readOnly:!0})],br.prototype,"dividedActions",null),u([d({readOnly:!0,dependsOn:["_flowItems.length"]})],br.prototype,"_activeFlowItemWidget",null),u([d()],br.prototype,"actions",null),u([d()],br.prototype,"actionsMenuOpen",null),u([d()],br.prototype,"alignment",void 0),u([d()],br.prototype,"autoCloseEnabled",null),u([d()],br.prototype,"autoOpenEnabled",null),u([d()],br.prototype,"defaultPopupTemplateEnabled",null),u([d()],br.prototype,"content",null),u([d()],br.prototype,"collapsed",void 0),u([d()],br.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],br.prototype,"currentAlignment",null),u([d({readOnly:!0})],br.prototype,"currentDockPosition",null),u([d()],br.prototype,"dockOptions",null),u([d()],br.prototype,"dockEnabled",void 0),u([d({readOnly:!0})],br.prototype,"featureCount",null),u([d()],br.prototype,"featureMenuOpen",void 0),u([d()],br.prototype,"features",null),u([d()],br.prototype,"goToOverride",null),u([d()],br.prototype,"headingLevel",void 0),u([d()],br.prototype,"highlightEnabled",null),u([d()],br.prototype,"location",null),u([d()],br.prototype,"label",null),u([d()],br.prototype,"maxInlineActions",void 0),u([d(),Ll("esri/widgets/Popup/t9n/Popup")],br.prototype,"messages",void 0),u([d(),Ll("esri/t9n/common")],br.prototype,"messagesCommon",void 0),u([d()],br.prototype,"promises",null),u([d({readOnly:!0})],br.prototype,"selectedFeature",null),u([d()],br.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],br.prototype,"selectedFeatureWidget",null),u([d()],br.prototype,"spinnerEnabled",void 0),u([d()],br.prototype,"title",null),u([d()],br.prototype,"updateLocationEnabled",null),u([d()],br.prototype,"view",null),u([d({type:bRe}),sJe(["triggerAction","trigger-action"])],br.prototype,"viewModel",void 0),u([d()],br.prototype,"visible",null),u([d()],br.prototype,"visibleElements",void 0),u([Hr("visibleElements")],br.prototype,"castVisibleElements",null),u([rl()],br.prototype,"_close",null),u([rl()],br.prototype,"_toggleDockEnabled",null),u([rl()],br.prototype,"_toggleFeatureMenu",null),u([rl()],br.prototype,"_toggleActionsMenu",null),u([rl()],br.prototype,"_triggerAction",null),u([rl()],br.prototype,"_selectFeature",null),u([rl()],br.prototype,"_next",null),u([rl()],br.prototype,"_previous",null),br=u([j("esri.widgets.Popup")],br);const _pe=br,xG=[0,0];function Elt(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return xG[0]=r.left+((e==null?void 0:e.pageXOffset)??0),xG[1]=r.top+((e==null?void 0:e.pageYOffset)??0),xG}function vpe(t){t&&(iTe(t),t.parentNode&&t.parentNode.removeChild(t))}function Clt(t){const e=document.createElement("div");return t.appendChild(e),e}const jR=16,E5=750,Mlt=512,Rlt=2,Olt=t=>{let e=class extends t{constructor(...r){var i;super(...r),this._freqInfo={freq:jR,time:E5},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,r.length!==0&&((i=r[0])==null?void 0:i.popup)!==void 0||(this.popup=new _pe({view:this})),this.handles.add([xe(()=>this.cursor,s=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",s)}),xe(()=>this.interacting,s=>{const{surface:n}=this;n&&n.setAttribute("data-interacting",s.toString())})])}initialize(){this.handles.add(xe(()=>this.ui,(r,i)=>this._handleUIChange(r,i))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=gt(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),s=hU(r);if(s||typeof r!="string"||we.getLogger(this.declaredClass).error("#container",`element with id '${r}' not found`),i===s)return;const n="dom-size";if(this.handles.remove(n),this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(vpe(this.root),this._set("root",null)),this.userContent&&(qce(this.userContent,i),vpe(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",qce(s,o),s.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",s.insertBefore(a,s.firstChild),this._set("root",a);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,a.appendChild(l),this._set("surface",l);const c=new Mue;a.appendChild(c.surface),this._set("overlay",c),xe(()=>c.needsRender,h=>{h&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=C3({render:()=>{var p;return(p=this.overlay)==null?void 0:p.render()}}):this._overlayRenderTaskHandle=sn(this._overlayRenderTaskHandle)}),this.forceDOMReadyCycle(),this.handles.add(xe(()=>this.size,h=>{const[p,A]=h,_="esri-view-surface--inset-outline";p>=document.body.clientWidth||A>=document.body.clientHeight?l.classList.add(_):l.classList.remove(_)},Cr),n),this._set("container",s),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}set popup(r){const i=this._get("popup");i&&i!==r&&i.destroy(),this._set("popup",r)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n?n[0]:0,i-=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n?n[0]:0,i+=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){i&&(this.handles.remove("ui"),i.destroy()),r&&this._wireUI(r),this._set("ui",r)}_wireUI(r){this.handles.remove("ui"),r&&(r.view=this,this.handles.add([xe(()=>this.root,i=>{r.container=i?Clt(i):null},Cr),xe(()=>this.popup,(i,s)=>{const n="popup",o="manual";s&&r.remove(s,n),i&&(i.view=r.view,r.add(i,{key:n,position:o}))},Cr)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=jR,r.time=E5,this.handles.add([(()=>{const i=()=>{r.freq=jR,r.time=E5};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),C3({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=jR,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?jR:Math.min(E5,n.freq*Rlt),!s&&n.freq>=Mlt&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=r&&Elt(r);return!!s&&(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d()],e.prototype,"container",null),u([d({readOnly:!0})],e.prototype,"focused",null),u([d({readOnly:!0})],e.prototype,"height",void 0),u([d({type:_pe})],e.prototype,"popup",null),u([d({type:Mue})],e.prototype,"overlay",void 0),u([d({readOnly:!0})],e.prototype,"position",void 0),u([d({readOnly:!0})],e.prototype,"resizing",void 0),u([d({readOnly:!0})],e.prototype,"root",void 0),u([d({value:null,readOnly:!0})],e.prototype,"size",null),u([d({readOnly:!0})],e.prototype,"surface",void 0),u([d({readOnly:!0})],e.prototype,"suspended",void 0),u([d()],e.prototype,"ui",void 0),u([d({readOnly:!0})],e.prototype,"userContent",void 0),u([d({readOnly:!0})],e.prototype,"width",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),e=u([j("esri.views.DOMContainer")],e),e},nse=we.getLogger("esri.layers.support.ElevationSampler");let wRe=class{queryElevation(e){return xRe(e.clone(),this)}on(){return Dlt}projectIfRequired(e,r){return TRe(e,r)}},Plt=class extends wRe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const s=e.tile.extent;this.extent=tU(s,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=tu(r.spatialReference),o=r.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return!N(r)&&this.containsAt(r.x,r.y)}containsAt(e,r){return rU(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return nse.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return gr(this.tile.sample(e,r),this.noDataValue)}},Vkt=class extends wRe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?e.map(o=>new Plt(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=tU(si(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){for(const i of this.samplers)if(i.containsAt(e,r))return i.elevationAt(e,r);return nse.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue}};function xRe(t,e){const r=TRe(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":Ilt(t,r,e);break;case"polyline":$lt(t,r,e);break;case"multipoint":Llt(t,r,e)}return t}function TRe(t,e){if(N(t))return null;const r=t.spatialReference;if(r.equals(e))return t;const i=xb(t,e);return i||nse.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function Ilt(t,e,r){t.z=r.elevationAt(e.x,e.y)}function $lt(t,e,r){og.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];og.x=c[0],og.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(og.x,og.y)}}t.hasZ=!0}function Llt(t,e,r){og.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];og.x=o[0],og.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(og.x,og.y)}t.hasZ=!0}const og=new Gt,Dlt={remove(){}};var AZ;let km=AZ=class extends Qe{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new AZ({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],km.prototype,"cols",void 0),u([d({type:rn,json:{write:!0}})],km.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],km.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],km.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],km.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],km.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],km.prototype,"scale",void 0),km=AZ=u([j("esri.layers.support.LOD")],km);const d0=km;let Nlt=class{constructor(e,r,i,s,n){this.id=e,this.level=r,this.row=i,this.col=s,this.extent=n}};var T1;const bpe=new Ui({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Xa=T1=class extends Qe{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:s=xt.WebMercator,numLODs:n=24}=t;if(!tc(s)){const p=[];if(r)for(let A=0;A<r.length;A++){const _=r[A];p.push(new d0({level:A,scale:_,resolution:_}))}else{let A=5e-4;for(let _=n-1;_>=0;_--)p.unshift(new d0({level:_,scale:A,resolution:A})),A*=2}return new T1({dpi:96,lods:p,origin:new Gt(0,0,s),size:[i,i],spatialReference:s})}const o=Dv(s),a=t.origin?new Gt({x:t.origin.x,y:t.origin.y,spatialReference:s}):new Gt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(tu(s)*39.37*l),h=[];if(r)for(let p=0;p<r.length;p++){const A=r[p],_=A*c;h.push(new d0({level:p,scale:A,resolution:_}))}else{let p=Swe(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const A=Math.ceil(n/e);h.push(new d0({level:0,scale:p,resolution:p*c}));for(let _=1;_<A;_++){const w=p/2**e,T=w*c;h.push(new d0({level:_,scale:w,resolution:T})),p=w}}return new T1({dpi:l,lods:h,origin:a,size:[i,i],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=Dv(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return Gt.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],s=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(n=>{i.push(n.scale),e=n.scale>e?n.scale:e,r=n.scale<r?n.scale:r,s[n.level]=n})),this._set("scales",i),this._set("minScale",e),this._set("maxScale",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const s=e[i],n=e[i+1];if(s<=t)return i;if(n===t)return i+1;if(s>t&&n<t)return i+Math.log(s/t)/Math.log(s/n)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=r;else if(Po(e.spatialReference,this.spatialReference))n=e.x,o=e.y,i=r;else{const c=xb(e,this.spatialReference);if(N(c))return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new Nlt(null,0,0,0,si())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=T1.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===T1.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=si()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return T1.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*e;r.push(new d0({level:n.level,scale:n.scale,resolution:o}))}return new T1({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};u([d({type:Number,json:{write:!0}})],Xa.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],Xa.prototype,"dpi",void 0),u([d({type:String,json:{read:bpe.read,write:bpe.write,origins:{"web-scene":{read:!1,write:!1}}}})],Xa.prototype,"format",void 0),u([d({readOnly:!0})],Xa.prototype,"isWrappable",null),u([d({type:Gt,json:{write:!0}})],Xa.prototype,"origin",void 0),u([ft("origin")],Xa.prototype,"readOrigin",null),u([d({type:[d0],value:null,json:{write:!0}})],Xa.prototype,"lods",null),u([d({readOnly:!0})],Xa.prototype,"minScale",void 0),u([d({readOnly:!0})],Xa.prototype,"maxScale",void 0),u([d({readOnly:!0})],Xa.prototype,"scales",void 0),u([d({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Xa.prototype,"size",void 0),u([ft("size",["rows","cols"])],Xa.prototype,"readSize",null),u([St("size",{cols:{type:rn},rows:{type:rn}})],Xa.prototype,"writeSize",null),u([d({type:xt,json:{write:!0}})],Xa.prototype,"spatialReference",void 0),Xa=T1=u([j("esri.layers.support.TileInfo")],Xa),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Xa||(Xa={}));const j6=Xa,Flt=12;let Eh=class _u{constructor(e){const r=_u.checkUnsupported(e);if(E(r))throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=qx(this.spatialReference)||Gg(this.spatialReference)||jg(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new _u(this.toTileInfo())}toTileInfo(){return new j6({dpi:this.dpi,origin:new Gt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new d0({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=fce(e[0]),r[1]=bk(e[1]),r[2]=fce(e[2]),r[3]=bk(e[3])):this._isGCS&&(r[0]=$r(e[0]),r[1]=$r(e[1]),r[2]=$r(e[2]),r[3]=$r(e[3]))}getExtentGeometry(e,r,i,s=new Ki){return this.getExtent(e,r,i,om),s.spatialReference=this.spatialReference,s.xmin=om[0],s.ymin=om[1],s.xmax=om[2],s.ymax=om[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof _u)){if(_u.checkUnsupported(e))return!1;e=new _u(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!qC(e.origin[0],this.origin[0],s)||!qC(e.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*Flt,qC(i,e.levels[r].resolution,s))}rootTilesInExtent(e,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(N(e)||n[0]===0||n[1]===0)return s;_u.computeRowColExtent(e,n,this.origin,om);let o=om[1],a=om[3],l=om[0],c=om[2];const h=c-l,p=a-o;if(h*p>i){const A=Math.floor(Math.sqrt(i));p>A&&(o=o+Math.floor(.5*p)-Math.floor(.5*A),a=o+A),h>A&&(l=l+Math.floor(.5*h)-Math.floor(.5*A),c=l+A)}for(let A=o;A<a;A++)for(let _=l;_<c;_++)s.push([0,A,_]);return E(r)&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,r,i,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-e[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-e[1]-n)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!tGe(s.resolution,i/2**s.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new ce("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return N(e)?ose():e.lods.length<1?new ce("tilingscheme:generic","Tiling scheme must have at least one level"):_u.isPowerOfTwo(e)?_u.hasGapInLevels(e)?new ce("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):_u.tileSizeSupported(e)?_u.hasOriginPerLODs(e)?new ce("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new ce("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new ce("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],s=e[3]-e[1],n=tu(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,h=new _u(new j6({size:[a,a],origin:new Gt({x:e[0]-.5*(o-i),y:e[3]+.5*(o-s)}),lods:[new d0({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:r}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const r=new _u(_u.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const s=256/r,n=new _u(new j6({size:[r,r],origin:new Gt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new d0({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function ose(){return new ce("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Eh.WebMercatorAuxiliarySphereTileInfo=new j6({size:[256,256],origin:new Gt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:xt.WebMercator}),spatialReference:xt.WebMercator,lods:[new d0({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Eh.WebMercatorAuxiliarySphere=Eh.makeWebMercatorAuxiliarySphere(19);const om=si(),_C=64,PP=512,klt=2.5,p4=rGe(FW/10),SRe=2,ERe=si();Eh.WebMercatorAuxiliarySphere.getExtent(0,0,0,ERe);const Blt=si([-180,-90,180,90]),Ult="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Vlt="Surface extent is too large for tile resolution at level 0.",zlt=3;let Glt=zlt;function yZ(t){return t<4?3:Glt}let S1=class extends Nn.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=p4}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||N(e.extent)||N(e.spatialReference))return null;const r=tU(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){var e;return gr((e=this.view.basemapTerrain)==null?void 0:e.spatialReference,xt.WGS84)}elevationAt(e,r){var i;if(N(this.extent)||!Bc(this.extent,e,r)){const s=E(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return we.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return gr((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,r,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return xRe(e.clone(),this)}};u([d({readOnly:!0})],S1.prototype,"demResolution",void 0),u([d({readOnly:!0})],S1.prototype,"extent",null),u([d({readOnly:!0})],S1.prototype,"noDataValue",void 0),u([d()],S1.prototype,"spatialReference",null),u([d({constructOnly:!0})],S1.prototype,"view",void 0),S1=u([j("esri.views.support.GroundViewElevationSampler")],S1);const jlt=S1;let E1=class extends Ke{constructor(e){super(e),this._handles=new ts,this.view=null,this.layerViews=new or}initialize(){this._handles.add(Nl(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground},e=>e.load())),this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new jlt({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this._handles.remove("updating"),this._handles.add(this.layerViews.map(e=>xe(()=>e.updating,()=>this._updateUpdating(),os)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],E1.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],E1.prototype,"updating",null),u([d({constructOnly:!0})],E1.prototype,"view",void 0),u([d({type:or,readOnly:!0})],E1.prototype,"layerViews",void 0),u([d({readOnly:!0})],E1.prototype,"suspended",null),E1=u([j("esri.views.GroundView")],E1);const Hlt=E1,qlt=t=>{let e=class extends t{async fetchPopupFeatures(r,i){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,i),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:aW([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(r,i,s){return i.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:E(s)?s.event:void 0,signal:E(s)?s.signal:void 0,defaultPopupTemplateEnabled:!!E(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(r,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(E(i)&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(r,i){const s=await this.popupHitTest(r),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),E(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return E(r)&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const s=[],n=new Map,o=i.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return e=u([j("esri.views.PopupView")],e),e};let _x=class extends PI{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([pte({Type:pl,ensureType:Oo(pl)})],_x.prototype,"itemType",void 0),_x=u([j("esri.support.GraphicsCollection")],_x);let C1=class extends Ke{constructor(e){super(e),this.view=null,this.baseLayerViews=new or,this.referenceLayerViews=new or,this._loadingHandle=xe(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap},r=>{r&&r.load().catch(()=>{})},Cr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var r,i;if(this.view&&this.view.suspended)return!1;const e=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};u([d({constructOnly:!0})],C1.prototype,"view",void 0),u([d({readOnly:!0})],C1.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],C1.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],C1.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],C1.prototype,"updating",null),C1=u([j("esri.views.BasemapView")],C1);function Wlt(t){return"tryRecycleWith"in t}let Ylt=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=Qv(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,ic(this._controller.signal,()=>{const s=new ce("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!Wlt(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==r)continue;const o=this.layerView.tryRecycleWith(n,{signal:i});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(di(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>ic(this._controller.signal,()=>h(Yi())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let a,l;if(await r.load({signal:e}),"prefetchResources"in r&&await((s=r.prefetchResources)==null?void 0:s.call(r,{signal:e})),Xlt(r))a=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new ce("layer:view-not-supported","No layerview implementation was found");const p=await this.layerViewImporter.importLayerView(r);di(e),a="default"in p?new p.default({layer:r,view:i}):new p({layer:r,view:i})}const c=()=>{l=sn(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=ic(e,c),di(e);try{await a.when()}catch(p){throw c(),p}if(!((o=(n=this._map)==null?void 0:n.allLayers)==null?void 0:o.includes(r)))return c(),void this._deferred.reject(new ce("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=a,r.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:r,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){r.emit("layerview-create-error",{view:i,error:a}),i.emit("layerview-create-error",{layer:r,error:a}),this.done=!0,this._deferred.reject(new ce("layerview:create-error","layerview creation failed",{layer:r,error:a}))}}},vp=class extends Ke{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new vg,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const r=(i=this.view.map)==null?void 0:i.allLayers;if(r)for(const s of r)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>(N(this._workPromise)&&(this._workPromise=Qv(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(EM(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,h;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),N(this._workPromise))return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,s=[],n=this.view.ready,o=p=>{if(!N(p)){for(const A of p)if(A){i.add(A);const _=this._layerLayerViewInfoMap.get(A);_&&n?_.start():_||this._recyclingInfoMap.has(A)||s.push(A),"layers"in A&&A.layers&&o(A.layers)}}};for(const p of this._rootCollectionNames)o(this.get(p));for(const[p,A]of this._layerLayerViewInfoMap)if(!i.has(p)){this._layerLayerViewInfoMap.delete(A.layer);const _=A.tryRecycle(s);_?(this._recyclingInfoMap.set(A.layer,A),_.then(()=>{this._recyclingInfoMap.delete(A.layer),this._layerLayerViewInfoMap.set(A.layer,A),this._reschedule()}).catch(()=>{this._recyclingInfoMap.delete(A.layer),A.destroy(),this._reschedule()})):A.destroy()}for(const[p,A]of this._recyclingInfoMap)i.has(p)||(this._recyclingInfoMap.delete(A.layer),A.destroy());for(const p of s)this._createLayerView(p);this._refreshCollections();const a=[(l=r==null?void 0:r.ground)==null?void 0:l.layers,(c=r==null?void 0:r.basemap)==null?void 0:c.baseLayers,(h=r==null?void 0:r.basemap)==null?void 0:h.referenceLayers,r==null?void 0:r.layers].filter(p=>!!p);i.forEach(p=>"layers"in p&&a.push(p.layers)),this.addHandles(a.map(p=>this._watchUpdatingTracking.addOnCollectionChange(()=>p,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([Co(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),xe(()=>{const e=this.view,r=e==null?void 0:e.map;return[r==null?void 0:r.basemap,r==null?void 0:r.ground,r==null?void 0:r.layers,e==null?void 0:e.ready]},()=>this._reschedule(),ao)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,E(this._workPromise)&&(this._workPromise.reject(Yi()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return E(this._workPromise)||this._watchUpdatingTracking.updating||Ml(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new ce("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=n,a.parent=i,r.getItemAt(s)!==a&&r.splice(s,0,a),n.layers&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<r.length&&r.splice(s,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new Ylt(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(vo(i)||i.name==="cancelled:layerview-create")||we.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],vp.prototype,"_workPromise",void 0),u([d({readOnly:!0})],vp.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],vp.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],vp.prototype,"_rootCollectionNames",null),u([d()],vp.prototype,"layerViewImporter",void 0),u([d()],vp.prototype,"supportsGround",void 0),u([d({readOnly:!0})],vp.prototype,"updating",null),u([d({readOnly:!0})],vp.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],vp.prototype,"view",void 0),vp=u([j("esri.views.LayerViewManager")],vp);const Qlt=vp;function Xlt(t){return"createLayerView"in t&&t.createLayerView!=null}let cd=class extends Ke{constructor(e){super(e),this.factor=1.5,this.offset=af(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],cd.prototype,"factor",void 0),u([d({nonNullable:!0})],cd.prototype,"offset",void 0),u([d()],cd.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],cd.prototype,"size",void 0),u([d()],cd.prototype,"maskUrl",void 0),u([d()],cd.prototype,"maskEnabled",void 0),u([d()],cd.prototype,"overlayUrl",void 0),u([d()],cd.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],cd.prototype,"version",null),u([d({type:Boolean})],cd.prototype,"visible",void 0),cd=u([j("esri.views.Magnifier")],cd);const CRe=cd;let Zlt=class{constructor(){this._tasks=new Array,this._running=new c9(!1)}get length(){return this._tasks.length}get running(){return this._running.get()}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return this._running.set(!0),new Promise((s,n)=>this._tasks.push(new wpe(s,n,e,r,i)))}unshift(e,r,i){return this._running.set(!0),new Promise((s,n)=>this._tasks.unshift(new wpe(s,n,e,r,i)))}_process(e){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const s=da(r.signal);if(s&&!r.abortCallback)r.reject(Yi());else{const n=s?(i=r.abortCallback)==null?void 0:i.call(r,Yi()):r.callback(e);Zd(n)?n.then(r.resolve,r.reject):r.resolve(n)}}catch(s){r.reject(s)}return this._running.set(this._tasks.length>0),!0}cancelAll(){const e=Yi();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0,this._running.set(!1)}},wpe=class{constructor(e,r,i,s,n){this.resolve=e,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}},IP=class extends Ke{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],IP.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],IP.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),IP=u([j("esri.views.support.DebugFlags")],IP);const Jlt=new IP;var Ei;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Ei||(Ei={}));function Klt(){return new u9.Scheduler}var Dl,ir;(function(t){t[t.YIELD=1]="YIELD"})(Dl||(Dl={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.TEST_PRIO=1]="TEST_PRIO"}(ir||(ir={}));const tg=0,xpe=new Map([[ir.RESOURCE_CONTROLLER_IMMEDIATE,tg],[ir.RESOURCE_CONTROLLER,4],[ir.SLIDE,tg],[ir.STREAM_DATA_LOADER,tg],[ir.ELEVATION_QUERY,tg],[ir.TERRAIN_SURFACE,1],[ir.SURFACE_GEOMETRY_UPDATES,1],[ir.LOD_RENDERER,2],[ir.GRAPHICS_CORE,2],[ir.I3S_CONTROLLER,2],[ir.POINT_CLOUD_LAYER,2],[ir.FEATURE_TILE_FETCHER,2],[ir.OVERLAY,4],[ir.STAGE,4],[ir.GRAPHICS_DECONFLICTOR,4],[ir.FILTER_VISIBILITY,4],[ir.SCALE_VISIBILITY,4],[ir.FRUSTUM_VISIBILITY,4],[ir.CLOUDS_GENERATOR,4],[ir.POINT_OF_INTEREST_FREQUENT,6],[ir.POINT_OF_INTEREST_INFREQUENT,30],[ir.LABELER,8],[ir.FEATURE_QUERY_ENGINE,8],[ir.FEATURE_TILE_TREE,16],[ir.FEATURE_TILE_TREE_ACTIVE,tg],[ir.ELEVATION_ALIGNMENT,12],[ir.TEXT_TEXTURE_ATLAS,12],[ir.TEXTURE_UNLOAD,12],[ir.LINE_OF_SIGHT_TOOL,16],[ir.LINE_OF_SIGHT_TOOL_INTERACTIVE,tg],[ir.SNAPPING,tg],[ir.SHADOW_ACCUMULATOR,30]]);function Tpe(t){return xpe.has(t)?xpe.get(t):typeof t=="number"?t:1}const Spe=6.5,Epe=1,ect=30,Cpe=1e3/30,Mpe=100,Rpe=.9;var u9,Wb;(function(t){class e{get updating(){return this._updating.get()}_updatingChanged(){this._updating.set(this._tasks.some(n=>n.needsUpdate))}constructor(){this._updating=new c9(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new uy("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Ei.INTERACTING,this._tasks=new Vr,this._runQueue=new Vr,this._load=0,this._idleStateCallbacks=new Vr,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=xe(()=>Jlt.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Cr);for(const o of Object.keys(ir))this.performanceInfo.tasks.set(ir[o],new uy(ir[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:Spe,INTERACTING_BUDGET:Cpe,IDLE_BUDGET:Mpe,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),sn(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=Tpe(n),l=new r(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new uy(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Ei.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Ei.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Ei.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=Spe,a=n.frameDuration,l=Epe;switch(this.state){case Ei.IDLE:o=0,a=Math.max(Mpe,n.frameDuration),l=ect;break;case Ei.INTERACTING:a=Math.max(Cpe,n.frameDuration);case Ei.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==Ei.IDLE&&a<Epe&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Ei.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Ei.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return Wb.SCHEDULED;let o=Wb.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=Wb.READY:o!==Wb.READY&&(o=Wb.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Rpe+n*(1-Rpe)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===tg&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==tg&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===Dl.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){we.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,ir.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(ir))this._frameTaskTimes.set(ir[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.get()}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new Zlt,this._handles=new ts,this.schedulePriority=this._basePriority,this._task=new c9(E(a)?a:this._queue),this._handles.add(Nl(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(jc),this._scheduler.removeTask(this),this.schedule=rM.schedule,this.reschedule=rM.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=Tpe(n);this._basePriority!==tg&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Ei.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(u9||(u9={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Wb||(Wb={}));const jc=(()=>{const t=new u9.Budget;return t.enabled=!1,t})();let tct=class{remove(){}processQueue(){}schedule(e,r,i){try{if(da(r)){const s=Yi();return i?Promise.resolve(i(s)):Promise.reject(s)}return lW(e(jc))}catch(s){return Promise.reject(s)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const rM=new tct;let vC=class extends Ke{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r==null?void 0:r.registerTask(ir.TEXTURE_UNLOAD))??rM}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,r,i){const s=this.makeUid(e);let n=this._textureRequests.get(s);if(!n){const o=r();n={referenceCount:0,texture:o,textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(o),this._stage.loadImmediate(o)),this._textureRequests.set(s,n)}return n.referenceCount++,{uid:s,texture:n.texture,release:()=>this._release(s)}}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||(this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){var r;e.onRemove&&e.onRemove(),e.texture?(r=this._stage)==null||r.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return E(r)?`${e}.${r}px`:e}};u([d()],vC.prototype,"_frameTask",void 0),u([d()],vC.prototype,"updating",null),vC=u([j("esri.views.3d.support.TextureCollection")],vC);var Ope;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(Ope||(Ope={}));const MRe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],RRe={};function ORe(t){return!!RRe[t]}function rct(t){for(const e of t)if(!ORe(e))return!1;return!0}MRe.forEach(t=>{RRe[t]=!0});let ict=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,s){const n=Array.isArray(e)?e:e.split(",");if(!rct(n))return n.some(ORe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s??Uv.DEFAULT;const l=this._createUniqueGroupName(),c=new sct(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const s=this._handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},sct=class extends fl{constructor(e,r,i,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:af(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:A=>e.async(A),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:A=>e.async(A),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(af(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:h,timestamp:p}=e,A={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:A,pointerType:o,button:a,buttons:c,radius:r.radius,angle:Kc(r.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:_=>e.async(_),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:s}=e.data,{cancelable:n,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:A}=e;return{type:r,x:i,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:A,eventId:l,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:_=>e.async(_),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:s,native:n,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,h=e.data.action,p={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:A,timestamp:_}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:_,eventId:o,cancelable:A,stopPropagation:()=>e.stopPropagation(),async:w=>e.async(w),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:s}=e,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:s}=e.data,{cancelable:n,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var f4,Ppe,Ipe;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(f4||(f4={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Ppe||(Ppe={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Ipe||(Ipe={}));function nct(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return we.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function _Z(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(f4.USER)&&t.getEditableFlag(f4.MANAGER)}function Bm(t){return af(t.x,t.y)}function s9t(t){return Sn(t.x,t.y)}function PRe(t,e){var i;const r=(i=t instanceof HTMLElement?t:t.surface)==null?void 0:i.getBoundingClientRect();return r?af(e.clientX-r.left,e.clientY-r.top):af(0,0)}function $pe(t,e){return e instanceof Event?PRe(t,e):Bm(e)}function Lpe(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let oct=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":Dpe(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Npe(e))break;const s=Bm(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(N(n))break;const o=n.manipulator,a=n.tool;!(E(o)&&E(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,r),E(o)&&E(a)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&N(r.activeTool)&&(this._revertToNullActiveTool=!0,r.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!Npe(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=ka(s,({manipulator:h})=>h),o=ka(s,({tool:h})=>h);if(N(n)||N(o))break;const a=Bm(e);a.x=ze(a.x,0,r.view.width),a.y=ze(a.y,0,r.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const s=Bm(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(act(e)||r.forEachTool(c=>{if((!E(n)||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),N(n))break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const s=Bm(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=E(n)?n.manipulator:null;if(N(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const s=Bm(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=E(n)?n.manipulator:null;if(N(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const s=Bm(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=E(n)?n.manipulator:null;if(N(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:Bm(r)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,r){const i=ka(this._grabbedManipulators.get(e.pointerId),({manipulator:s})=>s);N(i)||i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Bm(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(e){let r=null;return Ml(e,({manipulator:i})=>!(N(i)||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:s})=>{r.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{i.add(s)}),e(s=>{s.hasGrabbedManipulators=r.has(s),s.hasHoveredManipulators=i.has(s);const n=this._grabbedManipulators.values(),o=U9e(n,({tool:a})=>a===s);s.firstGrabbedManipulator=E(o)?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},s=!0,n){const o=(a,l)=>a===e&&(N(n)||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(e,r,i){let s=null;return i(n=>{if(n.manipulators==null||!_Z(n))return!1;const o=n.manipulators.intersect(e,r);return!N(o)&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(af(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!Dpe(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Bm(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,s){let n=this._intersect(e,i,s);const o=ka(this._hoveredManipulators.get(r),({manipulator:a})=>a);E(n)&&!n.manipulator.interactive&&(n=null),E(n)&&o===n.manipulator||(E(o)&&(o.hovering=!1),E(n)?(n.manipulator.hovering=!0,this._hoveredManipulators.set(r,n)):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function Dpe(t){return t==="mouse"}function Npe(t){return t.pointerType!=="mouse"||t.button===0}function act(t){return!!t.native.shiftKey}const Fpe="attached",TG="tools";let kA=class extends J${constructor(e){super(e),this._manipulatorState=new oct,this.tools=new or,this.cursor=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.handles.add([this.view.on(MRe,e=>{this._handleInputEvent(e)},Uv.TOOL),...nct(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(E(e)&&!this.view.ready)return void we.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),E(r)&&r.deactivate(),E(e)&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const s=_Z(i);!N(this.activeTool)&&s||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(r=>r.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}attach(){var e;this.view.type==="3d"?(this._set("textures",new vC(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([xe(()=>{const{state:r}=this.view;return"camera"in r&&r.camera},()=>this._forEachManipulator(r=>r.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",r=>this._forEachManipulator(i=>i.onElevationChange(r))),F0(()=>this._set("textures",gt(this.textures)))],Fpe)):this.handles.add(xe(()=>this.view.extent,()=>this._forEachManipulator(r=>r.onViewChange())))}detach(){E(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(Fpe)}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};E(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(s=>{!r&&s.visible&&s.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),!r&&E(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(TG),this._forEachTool(e=>{if(e instanceof Ke){const r=xe(()=>[e.cursor,e.visible,e.editable],()=>{_Z(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(r,TG)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],TG)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var r;(r=e.setEditableFlag)==null||r.call(e,f4.MANAGER,N(this.activeTool)||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;N(e)&&this._forEachTool(r=>!(!E(r.cursor)||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(N(e)||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}};u([d({constructOnly:!0,nonNullable:!0})],kA.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],kA.prototype,"textures",void 0),u([d({value:null})],kA.prototype,"activeTool",null),u([d({readOnly:!0,type:or})],kA.prototype,"tools",void 0),u([d({readOnly:!0})],kA.prototype,"cursor",void 0),u([d({readOnly:!0})],kA.prototype,"updating",null),kA=u([j("esri.views.ToolViewManager")],kA);const lct=kA;let ME=class extends Ke{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":cct.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return uct[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],ME.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],ME.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],ME.prototype,"axisThreshold",null),ME=u([j("esri.views.input.gamepad.GamepadInputDevice")],ME);const cct=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),uct={standard:.15,spacemouse:.025,unknown:0},ase=ME;let $P=class extends Ke{constructor(...e){super(...e),this.devices=new or,this.enabledFocusMode="document"}};u([d({type:or.ofType(ase),readOnly:!0})],$P.prototype,"devices",void 0),u([d({type:["document","view","none"]})],$P.prototype,"enabledFocusMode",void 0),$P=u([j("esri.views.input.gamepad.GamepadSettings")],$P);const hct=$P;let H6=class extends Ke{constructor(){super(...arguments),this.gamepad=new hct}};u([d({readOnly:!0})],H6.prototype,"gamepad",void 0),H6=u([j("esri.views.input.Input")],H6);const dct=H6;let M1=class extends Ke{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],M1.prototype,"enabled",void 0),u([d({type:ase})],M1.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],M1.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],M1.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],M1.prototype,"velocityFactor",void 0),M1=u([j("esri.views.navigation.gamepad.GamepadSettings")],M1);const IRe=M1;let c2=class extends Ke{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new IRe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],c2.prototype,"browserTouchPanEnabled",void 0),u([d({type:IRe,nonNullable:!0})],c2.prototype,"gamepad",void 0),u([d({type:Boolean})],c2.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],c2.prototype,"mouseWheelZoomEnabled",void 0),c2=u([j("esri.views.navigation.Navigation")],c2);const $Re=c2;function d9t(t,e,r){const i=LRe(t),s=e,n=pct(i,s,r);if(i){const o=NM.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new ce("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new ce("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!fct(t)||n===Ah.Unsupported)return new ce("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case Ah.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new ce("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new ce("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case Ah.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new ce("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new ce("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case Ah.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new ce("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new ce("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function pct(t,e,r){if(!kpe(t)||!kpe(e))return Ah.Unsupported;if(t==null||e==null)return Ah.Ok;if(!r&&t.heightUnit!==e.heightUnit)return Ah.Units;if(t.heightModel!==e.heightModel)return Ah.HeightModel;switch(t.heightModel){case"gravity-related-height":return Ah.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Ah.Ok:Ah.CRS;default:return Ah.Unsupported}}var Ah;function kpe(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function fct(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!FRe(t)}function LRe(t){var i;const e=t.url?jM(t.url):void 0;return!(((i=t.spatialReference)==null?void 0:i.vcsWkid)==null&&E(e)&&e.serverType==="ImageServer")&&DRe(t)&&t.heightModelInfo?t.heightModelInfo:FRe(t)?NM.deriveUnitFromSR(gct,t.spatialReference):null}function DRe(t){return"heightModelInfo"in t}function NRe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function FRe(t){return NRe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):kRe(t)}function mct(t){return t.layers!=null||kRe(t)||NRe(t)||DRe(t)}function kRe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Ah||(Ah={}));const gct=new NM({heightModel:"gravity-related-height"});var _t;function Bpe(t){return t==="global"?_t.Global:_t.Local}function SG(t){return t===_t.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(_t||(_t={}));let vZ,EG=null;async function Act(t){EG||(EG=be(()=>Promise.resolve().then(()=>NEt),void 0).then(e=>vZ=e)),await EG,di(t)}async function BRe(t,e,r,i){if(!t)return null;const s=t.spatialReference;return AU()||jx(s,e)?TT(t,e):vZ?vZ.projectGeometry(t,e,r,i):(await Promise.race([Act(i),r4(i)]),BRe(t,e,r,i))}let un=class extends Ke{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=tf(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return E(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return N(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,s,n,o;const e=(i=this.map)==null?void 0:i.call(this),r=[];return E(this.priorityCollection)&&r.push(this.priorityCollection),r.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);E(a)&&(i=a)}if(E(i)&&i.length===1)break}if(r&&(N(i)||i.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(i);return{spatialReference:E(s)?s.spatialReference:null,viewingMode:E(s)?s.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,s,n,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:(s=(i=this.map)==null?void 0:i.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){var i,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))!=null&&i.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const o of e)if(mct(o)){const a=LRe(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(E(s.fullExtent)?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)i.push({extent:l,layer:s})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(N(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),s=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:E(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(E(this._projectExtentTask.task)&&(this._projectExtentTask.task=tf(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:s.clone(),task:lL(async n=>{try{const o=await BRe(i.extent,s,i.layer.portalItem,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(da(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(N(e))return r;const i=[],s=(n,o)=>E(n)?E(o)?n===o&&n:n:o;for(const n of e)for(const o of r){if(!n.spatialReference.equals(o.spatialReference))continue;const a=s(n.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:n.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return N(e)||e.length<1?E(r)?{spatialReference:r,viewingMode:null}:null:(E(r)&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==_t.Local)&&(e=e.filter(({viewingMode:i})=>i!==_t.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const s of r){const n=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(E(n)){const o=E(n.constraints)?n.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)(!this.requiresExtentInSpatialReference||N(this.userSpatialReference)||a.equals(this.userSpatialReference))&&i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const r={layers:[],preloading:-1,updating:!1};for(const s of e)if(this._collectCollection(s,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(()=>{}),"loading"):e.loadStatus:"loaded"}};u([d()],un.prototype,"required",void 0),u([d({constructOnly:!0})],un.prototype,"map",void 0),u([d({constructOnly:!0})],un.prototype,"getSpatialReferenceSupport",void 0),u([d()],un.prototype,"defaultSpatialReference",void 0),u([d()],un.prototype,"userSpatialReference",void 0),u([d()],un.prototype,"sourcePreloadCount",void 0),u([d()],un.prototype,"priorityCollection",void 0),u([d()],un.prototype,"requiresExtentInSpatialReference",void 0),u([d()],un.prototype,"suspended",void 0),u([d({readOnly:!0})],un.prototype,"ready",null),u([d({readOnly:!0})],un.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],un.prototype,"spatialReference",null),u([d({readOnly:!0})],un.prototype,"extent",null),u([d({readOnly:!0})],un.prototype,"heightModelInfo",null),u([d({readOnly:!0})],un.prototype,"vcsWkid",null),u([d({readOnly:!0})],un.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],un.prototype,"viewingMode",null),u([d({readOnly:!0})],un.prototype,"tileInfo",null),u([d({readOnly:!0})],un.prototype,"mapCollections",null),u([d({readOnly:!0})],un.prototype,"_allLayers",null),u([d({readOnly:!0})],un.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],un.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],un.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],un.prototype,"_extentCandidatesTask",null),u([d()],un.prototype,"_extentTask",null),u([d()],un.prototype,"_projectExtentTask",void 0),un=u([j("esri.views.support.DefaultsFromMap")],un);var q6;let Mr=q6=class extends xT(Nn.EventedMixin(zB(Ke))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new V$({getCollections:()=>{var e,r,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new _x,this.analyses=new Y3,this.typeSpecificPreconditionsReady=!0,this.layerViews=new or,this.magnifier=new CRe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new tM,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new dct,this.navigation=new $Re,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new ict(this),this.persistableViewModels=new or,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(xe(()=>this.preconditionsReady,e=>{var r,i;e?(this._currentSpatialReference=this.spatialReference,q6.views.add(this)):(this._currentSpatialReference=null,q6.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((r=this.toolViewManager)==null||r.detach(),E(this.analysisViewManager)&&this.analysisViewManager.detach(),(i=this.layerViewManager)==null||i.clear(),this._teardown()):e&&!this.ready&&(this._startup(),E(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},os))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,Q$(()=>this.ready)))),this.basemapView=new C1({view:this}),this.layerViewManager=new Qlt({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new lct({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([xe(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),xe(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),xe(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([xe(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(e&&!this.spatialReference&&r){if(E(t))return;const s=F0(()=>t=tf(t));t=lL(async n=>{try{await Ix(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}we.getLogger(this.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=gt(this.graphics),this.analyses=gt(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),gt(this.analysisViewManager),this.toolViewManager=gt(this.toolViewManager),this.layerViewManager=gt(this.layerViewManager),this.basemapView=gt(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const t=this.map;this.map=null,t==null||t.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return we.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new un({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Ly.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(we.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:t}),t=null),Ly.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){var e,r;let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&((r=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&r.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!Po(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return E(t)?t:this._cursor||"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){return this.layerViewManager.whenLayerView(t)}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}importLayerView(t){throw new ce("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return E(this.getSpatialReferenceSupport({spatialReference:t}))}when(t,e){return this.isResolved()&&!this.ready&&we.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(Nl(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Mr.views=new or,u([d()],Mr.prototype,"_userSpatialReference",void 0),u([d()],Mr.prototype,"activeTool",null),u([d({readOnly:!0})],Mr.prototype,"allLayerViews",void 0),u([d()],Mr.prototype,"groundView",void 0),u([d()],Mr.prototype,"animation",null),u([d()],Mr.prototype,"basemapView",void 0),u([d()],Mr.prototype,"center",null),u([d({readOnly:!0})],Mr.prototype,"_defaultsFromMapSettings",null),u([d()],Mr.prototype,"defaultsFromMap",null),u([d()],Mr.prototype,"fatalError",void 0),u([d({type:Ki})],Mr.prototype,"extent",null),u([d($k(_x,"graphics"))],Mr.prototype,"graphics",void 0),u([d($k(Y3,"analyses"))],Mr.prototype,"analyses",void 0),u([d({readOnly:!0,type:NM})],Mr.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Mr.prototype,"interacting",null),u([d({readOnly:!0})],Mr.prototype,"navigating",null),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Mr.prototype,"preconditionsReady",null),u([d({readOnly:!0})],Mr.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:or,readOnly:!0})],Mr.prototype,"layerViews",void 0),u([d()],Mr.prototype,"resolution",null),u([d({type:CRe})],Mr.prototype,"magnifier",void 0),u([d({value:null,type:G2e})],Mr.prototype,"map",null),u([d()],Mr.prototype,"padding",void 0),u([d({readOnly:!0})],Mr.prototype,"ready",void 0),u([d({type:xt})],Mr.prototype,"spatialReference",null),u([d()],Mr.prototype,"spatialReferenceWarningDelay",void 0),u([d()],Mr.prototype,"stationary",null),u([d({readOnly:!0})],Mr.prototype,"supportsGround",void 0),u([d({type:Wg})],Mr.prototype,"timeExtent",void 0),u([d({type:tM,nonNullable:!0})],Mr.prototype,"timeReference",void 0),u([d()],Mr.prototype,"tools",null),u([d()],Mr.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],Mr.prototype,"type",void 0),u([d({type:Number})],Mr.prototype,"scale",void 0),u([d({readOnly:!0})],Mr.prototype,"updating",void 0),u([d({readOnly:!0})],Mr.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],Mr.prototype,"initialExtent",null),u([d()],Mr.prototype,"cursor",null),u([d({readOnly:!0})],Mr.prototype,"input",void 0),u([d({type:$Re,nonNullable:!0})],Mr.prototype,"navigation",void 0),u([d()],Mr.prototype,"layerViewManager",void 0),u([d()],Mr.prototype,"analysisViewManager",void 0),u([d()],Mr.prototype,"width",void 0),u([d()],Mr.prototype,"height",void 0),u([d({readOnly:!0})],Mr.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],Mr.prototype,"size",null),u([d({readOnly:!0})],Mr.prototype,"suspended",void 0),u([d({readOnly:!0})],Mr.prototype,"viewEvents",void 0),u([d({readOnly:!0})],Mr.prototype,"persistableViewModels",void 0),u([d()],Mr.prototype,"_isValid",void 0),u([d()],Mr.prototype,"_readyCycleForced",void 0),u([d()],Mr.prototype,"_currentSpatialReference",void 0),Mr=q6=u([j("esri.views.View")],Mr);const yct=Mr;let R1=class extends gk{constructor(e){super(e),this.state="running",this.target=null,this._dfd=null}initialize(){this.addResolvingPromise(new Promise((e,r)=>this._dfd={resolve:e,reject:r}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._dfd)==null||e.reject(new ce("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._dfd)==null||e.resolve())}update(e,r){r||(r=Zd(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};u([d({readOnly:!0})],R1.prototype,"done",null),u([d({readOnly:!0,type:String})],R1.prototype,"state",void 0),u([d()],R1.prototype,"target",void 0),R1=u([j("esri.views.ViewAnimation")],R1),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(R1||(R1={}));const iM=R1,HR=()=>be(()=>import("./TileLayerView3D-1f6e59f0.js"),["assets/TileLayerView3D-1f6e59f0.js","assets/LayerView3D-deb29fb7.js","assets/TiledLayerView3D-e6d8c0be.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js","assets/MapServiceLayerViewHelper-aee1195b.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-a1334aa5.js","assets/popupUtils-709e372e.js","assets/drapedUtils-b1ddf686.js"]),Upe=()=>be(()=>import("./ElevationLayerView3D-3c3c7f9d.js"),["assets/ElevationLayerView3D-3c3c7f9d.js","assets/LayerView3D-deb29fb7.js","assets/TiledLayerView3D-e6d8c0be.js","assets/LayerView-1d2a8e3f.js"]),Vpe={"base-dynamic":()=>be(()=>import("./BaseDynamicLayerView3D-d6c0c573.js"),["assets/BaseDynamicLayerView3D-d6c0c573.js","assets/DynamicLayerView3D-262e6c1a.js","assets/LayerView3D-deb29fb7.js","assets/projectExtentUtils-e466aaef.js","assets/ImageMaterial-dd97e8ad.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js"]),"base-elevation":Upe,"base-tile":HR,"bing-maps":HR,"building-scene":()=>be(()=>import("./BuildingSceneLayerView3D-0d9ee580.js"),["assets/BuildingSceneLayerView3D-0d9ee580.js","assets/BuildingGroupSublayer-bb1dcb97.js","assets/BuildingComponentSublayer-88507751.js","assets/capabilities-a18453f6.js","assets/I3SIndexInfo-4f5f840b.js","assets/I3SLayerDefinitions-c8f87536.js","assets/I3SUtil-f379a97b.js","assets/I3SBinaryReader-42f4b1a5.js","assets/popupUtils-709e372e.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/I3SMeshView3D-cfce8bdd.js","assets/I3SOverrides-efab6ed3.js","assets/I3SNode-7ba1c1f7.js","assets/RenderTexture-62ef66c1.js","assets/FeatureLayerView3D-1d64023c.js","assets/FeatureLayerViewBase3D-dde536c9.js","assets/FeatureLikeLayerView3D-3d0f4951.js","assets/dehydratedFeatureComparison-405974ca.js","assets/queryForSymbologySnapping-b8dd966f.js","assets/elevationInfoUtils-be5b121e.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineResult-9a9d9eff.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/projectExtentUtils-e466aaef.js","assets/LayerView3D-deb29fb7.js","assets/EventedSet-4fe850fc.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js","assets/SceneModification-90838091.js","assets/persistable-34ad666e.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-237a258b.js","assets/SceneLayerWorker-9e63124e.js","assets/I3SQueryFeatureStore-19deabc6.js","assets/DefinitionExpressionSceneLayerView-a4f265da.js"]),csv:()=>be(()=>import("./CSVLayerView3D-ba5b386d.js"),["assets/CSVLayerView3D-ba5b386d.js","assets/FeatureLayerViewBase3D-dde536c9.js","assets/FeatureLikeLayerView3D-3d0f4951.js","assets/dehydratedFeatureComparison-405974ca.js","assets/queryForSymbologySnapping-b8dd966f.js","assets/elevationInfoUtils-be5b121e.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/projectExtentUtils-e466aaef.js","assets/LayerView3D-deb29fb7.js","assets/EventedSet-4fe850fc.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js"]),dimension:()=>be(()=>import("./DimensionLayerView3D-1d5bd3ab.js"),["assets/DimensionLayerView3D-1d5bd3ab.js","assets/LayerView3D-deb29fb7.js","assets/LayerView-1d2a8e3f.js"]),elevation:Upe,feature:()=>be(()=>import("./FeatureLayerView3D-1d64023c.js"),["assets/FeatureLayerView3D-1d64023c.js","assets/FeatureLayerViewBase3D-dde536c9.js","assets/FeatureLikeLayerView3D-3d0f4951.js","assets/dehydratedFeatureComparison-405974ca.js","assets/queryForSymbologySnapping-b8dd966f.js","assets/elevationInfoUtils-be5b121e.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/projectExtentUtils-e466aaef.js","assets/LayerView3D-deb29fb7.js","assets/EventedSet-4fe850fc.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js"]),geojson:()=>be(()=>import("./GeoJSONLayerView3D-6546a9e8.js"),["assets/GeoJSONLayerView3D-6546a9e8.js","assets/FeatureLayerViewBase3D-dde536c9.js","assets/FeatureLikeLayerView3D-3d0f4951.js","assets/dehydratedFeatureComparison-405974ca.js","assets/queryForSymbologySnapping-b8dd966f.js","assets/elevationInfoUtils-be5b121e.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/projectExtentUtils-e466aaef.js","assets/LayerView3D-deb29fb7.js","assets/EventedSet-4fe850fc.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js"]),graphics:()=>be(()=>import("./GraphicsLayerView3D-73ce6784.js"),["assets/GraphicsLayerView3D-73ce6784.js","assets/LayerView3D-deb29fb7.js","assets/queryForSymbologySnapping-b8dd966f.js","assets/elevationInfoUtils-be5b121e.js","assets/GraphicsProcessor-80e900f2.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/projectExtentUtils-e466aaef.js","assets/LayerView-1d2a8e3f.js"]),group:()=>be(()=>import("./GroupLayerView-ea9e6b3c.js"),["assets/GroupLayerView-ea9e6b3c.js","assets/LayerView-1d2a8e3f.js"]),imagery:()=>be(()=>import("./ImageryLayerView3D-3937edaf.js"),["assets/ImageryLayerView3D-3937edaf.js","assets/DynamicLayerView3D-262e6c1a.js","assets/LayerView3D-deb29fb7.js","assets/projectExtentUtils-e466aaef.js","assets/ImageMaterial-dd97e8ad.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js","assets/popupUtils-709e372e.js"]),"integrated-mesh":()=>be(()=>import("./IntegratedMeshLayerView3D-a7d84da1.js"),["assets/IntegratedMeshLayerView3D-a7d84da1.js","assets/I3SMeshView3D-cfce8bdd.js","assets/I3SOverrides-efab6ed3.js","assets/I3SNode-7ba1c1f7.js","assets/I3SUtil-f379a97b.js","assets/I3SBinaryReader-42f4b1a5.js","assets/RenderTexture-62ef66c1.js","assets/FeatureLayerView3D-1d64023c.js","assets/FeatureLayerViewBase3D-dde536c9.js","assets/FeatureLikeLayerView3D-3d0f4951.js","assets/dehydratedFeatureComparison-405974ca.js","assets/queryForSymbologySnapping-b8dd966f.js","assets/elevationInfoUtils-be5b121e.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/projectExtentUtils-e466aaef.js","assets/LayerView3D-deb29fb7.js","assets/EventedSet-4fe850fc.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js","assets/SceneModification-90838091.js","assets/persistable-34ad666e.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-237a258b.js","assets/SceneLayerWorker-9e63124e.js"]),"line-of-sight":()=>be(()=>import("./LineOfSightLayerView3D-4611f9b4.js"),["assets/LineOfSightLayerView3D-4611f9b4.js","assets/LayerView3D-deb29fb7.js","assets/LayerView-1d2a8e3f.js"]),"map-image":()=>be(()=>import("./MapImageLayerView3D-35f56e0e.js"),["assets/MapImageLayerView3D-35f56e0e.js","assets/DynamicLayerView3D-262e6c1a.js","assets/LayerView3D-deb29fb7.js","assets/projectExtentUtils-e466aaef.js","assets/ImageMaterial-dd97e8ad.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js","assets/ExportImageParameters-72ecf3b6.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-a1334aa5.js","assets/MapServiceLayerViewHelper-aee1195b.js","assets/popupUtils-709e372e.js","assets/drapedUtils-b1ddf686.js"]),media:()=>be(()=>import("./MediaLayerView3D-d6183b95.js"),["assets/MediaLayerView3D-d6183b95.js","assets/MediaElementView-3790ea10.js","assets/normalizeUtilsSync-c116c157.js","assets/LayerView3D-deb29fb7.js","assets/ImageMaterial-dd97e8ad.js","assets/LayerView-1d2a8e3f.js"]),"ogc-feature":()=>be(()=>import("./OGCFeatureLayerView3D-ea85817a.js"),["assets/OGCFeatureLayerView3D-ea85817a.js","assets/FeatureLayerViewBase3D-dde536c9.js","assets/FeatureLikeLayerView3D-3d0f4951.js","assets/dehydratedFeatureComparison-405974ca.js","assets/queryForSymbologySnapping-b8dd966f.js","assets/elevationInfoUtils-be5b121e.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/projectExtentUtils-e466aaef.js","assets/LayerView3D-deb29fb7.js","assets/EventedSet-4fe850fc.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js"]),"open-street-map":HR,"oriented-imagery":()=>be(()=>import("./FeatureLayerView3D-1d64023c.js"),["assets/FeatureLayerView3D-1d64023c.js","assets/FeatureLayerViewBase3D-dde536c9.js","assets/FeatureLikeLayerView3D-3d0f4951.js","assets/dehydratedFeatureComparison-405974ca.js","assets/queryForSymbologySnapping-b8dd966f.js","assets/elevationInfoUtils-be5b121e.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/projectExtentUtils-e466aaef.js","assets/LayerView3D-deb29fb7.js","assets/EventedSet-4fe850fc.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js"]),"point-cloud":()=>be(()=>import("./PointCloudLayerView3D-3f9a17f4.js").then(t=>t.P),["assets/PointCloudLayerView3D-3f9a17f4.js","assets/LayerView3D-deb29fb7.js","assets/I3SUtil-f379a97b.js","assets/I3SBinaryReader-42f4b1a5.js","assets/PointCloudWorkerUtil-b417daf4.js","assets/PointCloudUniqueValueRenderer-54b47eec.js","assets/PopupSceneLayerView-445a8e49.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js"]),voxel:()=>be(()=>import("./VoxelLayerView3D-bc3f7d9b.js"),["assets/VoxelLayerView3D-bc3f7d9b.js","assets/LayerView3D-deb29fb7.js","assets/PopupSceneLayerView-445a8e49.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js"]),route:()=>be(()=>import("./RouteLayerView3D-6c9441db.js"),["assets/RouteLayerView3D-6c9441db.js","assets/Stop-d8fc8c6f.js","assets/LayerView3D-deb29fb7.js","assets/GraphicsProcessor-80e900f2.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/projectExtentUtils-e466aaef.js","assets/EventedSet-4fe850fc.js","assets/LayerView-1d2a8e3f.js"]),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?be(()=>import("./SceneLayerView3D-05e395fd.js"),["assets/SceneLayerView3D-05e395fd.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/floorFilterUtils-080a7cd2.js","assets/I3SMeshView3D-cfce8bdd.js","assets/I3SOverrides-efab6ed3.js","assets/I3SNode-7ba1c1f7.js","assets/I3SUtil-f379a97b.js","assets/I3SBinaryReader-42f4b1a5.js","assets/RenderTexture-62ef66c1.js","assets/FeatureLayerView3D-1d64023c.js","assets/FeatureLayerViewBase3D-dde536c9.js","assets/FeatureLikeLayerView3D-3d0f4951.js","assets/dehydratedFeatureComparison-405974ca.js","assets/queryForSymbologySnapping-b8dd966f.js","assets/elevationInfoUtils-be5b121e.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineResult-9a9d9eff.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/projectExtentUtils-e466aaef.js","assets/LayerView3D-deb29fb7.js","assets/EventedSet-4fe850fc.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js","assets/SceneModification-90838091.js","assets/persistable-34ad666e.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-237a258b.js","assets/SceneLayerWorker-9e63124e.js","assets/SceneLayerView-ca07fdcf.js","assets/DefinitionExpressionSceneLayerView-a4f265da.js","assets/I3SQueryFeatureStore-19deabc6.js","assets/PopupSceneLayerView-445a8e49.js"]):be(()=>import("./SceneLayerGraphicsView3D-04b9dff2.js"),["assets/SceneLayerGraphicsView3D-04b9dff2.js","assets/I3SOverrides-efab6ed3.js","assets/I3SNode-7ba1c1f7.js","assets/I3SUtil-f379a97b.js","assets/I3SBinaryReader-42f4b1a5.js","assets/RenderTexture-62ef66c1.js","assets/FeatureLayerView3D-1d64023c.js","assets/FeatureLayerViewBase3D-dde536c9.js","assets/FeatureLikeLayerView3D-3d0f4951.js","assets/dehydratedFeatureComparison-405974ca.js","assets/queryForSymbologySnapping-b8dd966f.js","assets/elevationInfoUtils-be5b121e.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/projectExtentUtils-e466aaef.js","assets/LayerView3D-deb29fb7.js","assets/EventedSet-4fe850fc.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js","assets/SceneLayerView-ca07fdcf.js","assets/DefinitionExpressionSceneLayerView-a4f265da.js","assets/PopupSceneLayerView-445a8e49.js"]),stream:()=>be(()=>import("./StreamLayerView3D-f482787d.js"),["assets/StreamLayerView3D-f482787d.js","assets/StreamFeatureManager-7f8638f8.js","assets/createConnection-e04d52bf.js","assets/EventedSet-4fe850fc.js","assets/FeatureLikeLayerView3D-3d0f4951.js","assets/dehydratedFeatureComparison-405974ca.js","assets/queryForSymbologySnapping-b8dd966f.js","assets/elevationInfoUtils-be5b121e.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/projectExtentUtils-e466aaef.js","assets/LayerView3D-deb29fb7.js","assets/LayerView-1d2a8e3f.js"]),tile:HR,"imagery-tile":()=>be(()=>import("./ImageryTileLayerView3D-3532e659.js"),["assets/ImageryTileLayerView3D-3532e659.js","assets/LayerView3D-deb29fb7.js","assets/TiledLayerView3D-e6d8c0be.js","assets/rasterProjectionHelper-dc28f37d.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js","assets/drapedUtils-b1ddf686.js"]),"vector-tile":()=>be(()=>import("./VectorTileLayerView3D-96471a96.js"),["assets/VectorTileLayerView3D-96471a96.js","assets/Rect-98da58d6.js","assets/rasterizingUtils-b487cee1.js","assets/StyleRepository-25ed7020.js","assets/enums-c655c737.js","assets/colorUtils-c0f43caf.js","assets/TileClipper-ae6eca9e.js","assets/TileInfoView-33538089.js","assets/number-b10bd8f5.js","assets/GeometryUtils-0258f920.js","assets/LayerView3D-deb29fb7.js","assets/TiledLayerView3D-e6d8c0be.js","assets/LayerView-1d2a8e3f.js"]),wcs:()=>be(()=>import("./ImageryTileLayerView3D-3532e659.js"),["assets/ImageryTileLayerView3D-3532e659.js","assets/LayerView3D-deb29fb7.js","assets/TiledLayerView3D-e6d8c0be.js","assets/rasterProjectionHelper-dc28f37d.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js","assets/drapedUtils-b1ddf686.js"]),"web-tile":HR,wfs:()=>be(()=>import("./WFSLayerView3D-b4189946.js"),["assets/WFSLayerView3D-b4189946.js","assets/FeatureLayerViewBase3D-dde536c9.js","assets/FeatureLikeLayerView3D-3d0f4951.js","assets/dehydratedFeatureComparison-405974ca.js","assets/queryForSymbologySnapping-b8dd966f.js","assets/elevationInfoUtils-be5b121e.js","assets/hash-0ddfbf4b.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-57c5e626.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/FeatureStore-00ace637.js","assets/BoundsStore-ed029c75.js","assets/projectExtentUtils-e466aaef.js","assets/LayerView3D-deb29fb7.js","assets/EventedSet-4fe850fc.js","assets/popupUtils-709e372e.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js"]),wms:()=>be(()=>import("./WMSLayerView3D-8648edcb.js"),["assets/WMSLayerView3D-8648edcb.js","assets/DynamicLayerView3D-262e6c1a.js","assets/LayerView3D-deb29fb7.js","assets/projectExtentUtils-e466aaef.js","assets/ImageMaterial-dd97e8ad.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js","assets/ExportWMSImageParameters-4003c65f.js"]),wmts:()=>be(()=>import("./WMTSLayerView3D-613c447b.js"),["assets/WMTSLayerView3D-613c447b.js","assets/LayerView3D-deb29fb7.js","assets/TiledLayerView3D-e6d8c0be.js","assets/LayerView-1d2a8e3f.js","assets/RefreshableLayerView-158cf695.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function _ct(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new ce(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const zpe={hasLayerViewModule:t=>E(Vpe[t.type]),importLayerView:t=>{const e=Vpe[t.type];if(N(e))throw _ct(t);return e(t)}},Gpe="analyses-owner-handles";var bC,F2;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(bC||(bC={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(F2||(F2={}));let u2=class extends J${constructor(e){super(e),this._allAnalysisViews=new or,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=jpe(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Yi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Yi()),this._attachedToViewResolver=jpe()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(N(r)||r.state.list===F2.REMOVED)throw new ce("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),Gpe)}_disconnectOwners(){this.handles.remove(Gpe),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const r=e.on("after-add",s=>this._addAnalysis(s.item)),i=e.on("after-remove",s=>this._removeAnalysis(s.item));return{remove:()=>{r.remove(),i.remove();for(const s of e)this._removeAnalysis(s)}}}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:bC.PENDING,list:F2.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=lL(s=>this._createAnalysisViewPromise(i,s))}else r.state.list=F2.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=F2.REMOVED,this._scheduleUpdate()):we.getLogger(this.declaredClass).error("Trying to remove analysis which was not added")}_scheduleUpdate(){E(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=EM(()=>this._update()))}_update(){this._scheduledUpdateHandle=sn(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===F2.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case bC.PENDING:e.createAnalysisViewTask=tf(e.createAnalysisViewTask);break;case bC.CREATED:E(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=gt(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,s=i.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,N(n.module))try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(da(r))throw this._creatingViewCount-=1,Yi("AnalysisView creation aborted");const o=new n.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(da(r))throw this._creatingViewCount-=1,o.destroy(),Yi("AnalysisView creation aborted");return e.view=o,e.state.view=bC.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return be(()=>import("./AreaMeasurementAnalysisView3D-b6ce9781.js").then(r=>r.A),["assets/AreaMeasurementAnalysisView3D-b6ce9781.js","assets/analysisThemeUtils-633a7f54.js","assets/Segment-114c5551.js","assets/LineVisualElement-65b3ee4b.js","assets/elevationInfoUtils-be5b121e.js","assets/geometryEngine-a37dadce.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-ad302ece.js","assets/EditGeometryOperations-51b6afb3.js"]);case"dimension":return be(()=>import("./DimensionAnalysisView3D-6328aff6.js").then(r=>r.D),["assets/DimensionAnalysisView3D-6328aff6.js","assets/LineVisualElement-65b3ee4b.js","assets/LengthDimension-421fb334.js","assets/Segment-114c5551.js","assets/elevationInfoUtils-be5b121e.js","assets/analysisViewUtils-10447232.js","assets/ImageMaterial-dd97e8ad.js","assets/Factory-c6ba9512.js","assets/RightAngleQuadVisualElement-cface06c.js","assets/VisualElementResources-52343f6b.js","assets/PointVisualElement-249aef80.js","assets/colorUtils-c0f43caf.js","assets/EditGeometryOperations-51b6afb3.js","assets/QueryEngineResult-9a9d9eff.js","assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js","assets/utils-0de650ba.js","assets/generateRendererUtils-55300279.js","assets/json-48e3ea08.js","assets/dehydratedFeatureComparison-405974ca.js","assets/RenderTexture-62ef66c1.js"]);case"direct-line-measurement":return be(()=>import("./DirectLineMeasurementAnalysisView3D-75c9fea2.js").then(r=>r.D),["assets/DirectLineMeasurementAnalysisView3D-75c9fea2.js","assets/analysisThemeUtils-633a7f54.js","assets/Segment-114c5551.js","assets/LineVisualElement-65b3ee4b.js","assets/elevationInfoUtils-be5b121e.js","assets/geometryEngine-a37dadce.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-ad302ece.js","assets/RightAngleQuadVisualElement-cface06c.js","assets/VisualElementResources-52343f6b.js"]);case"line-of-sight":return be(()=>import("./LineOfSightAnalysisView3D-ef0334da.js"),["assets/LineOfSightAnalysisView3D-ef0334da.js","assets/LineVisualElement-65b3ee4b.js","assets/LineOfSightAnalysisTarget-e12aa148.js","assets/persistable-34ad666e.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-237a258b.js","assets/elevationInfoUtils-be5b121e.js","assets/analysisViewUtils-10447232.js","assets/ImageMaterial-dd97e8ad.js","assets/PointVisualElement-249aef80.js","assets/VisualElementResources-52343f6b.js"]);case"slice":return be(()=>import("./SliceAnalysisView3D-6037c934.js").then(r=>r.S),["assets/SliceAnalysisView3D-6037c934.js","assets/LineVisualElement-65b3ee4b.js","assets/persistable-34ad666e.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-237a258b.js","assets/BuildingComponentSublayer-88507751.js","assets/capabilities-a18453f6.js","assets/I3SIndexInfo-4f5f840b.js","assets/I3SLayerDefinitions-c8f87536.js","assets/I3SUtil-f379a97b.js","assets/I3SBinaryReader-42f4b1a5.js","assets/popupUtils-709e372e.js","assets/analysisViewUtils-10447232.js","assets/ImageMaterial-dd97e8ad.js","assets/Factory-c6ba9512.js"])}}};function jpe(){const t=Xv();return t.promise.catch(()=>{}),t}u([d()],u2.prototype,"updating",null),u([d({constructOnly:!0})],u2.prototype,"view",void 0),u([d()],u2.prototype,"_allAnalysisViews",void 0),u([d()],u2.prototype,"_creatingViewCount",void 0),u2=u([j("esri.views.3d.analysis.AnalysisViewManager3D")],u2);const vct=u2;let BA=class extends Ke{constructor(e){super(e),this.collision=new LP,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===_t.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==_t.Local?this._set("altitude",e):we.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?ze(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return ze(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===_t.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=CG)=>(i.min=Tl.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?f6([[4e3,Tl.max],[1e4,$r(88)],[6e6,$r(88)]]):()=>Tl.max;return(r,i=CG)=>(i.min=Tl.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?f6([[4e3,Tl.max],[5e4,$r(88)],[6e6,$r(88)],[2e7,Tl.min]]):f6([[3e5,Tl.max],[3e6,$r(88)],[6e6,$r(88)],[2e7,Tl.min]]);return(r,i=CG)=>(i.min=Tl.min,i.max=e(r),i)}};function bct(t){return{min:-2e5,max:4*t.radius}}u([d()],BA.prototype,"altitude",null),u([d({readOnly:!0})],BA.prototype,"collision",void 0),u([d()],BA.prototype,"distance",void 0),u([d({readOnly:!0})],BA.prototype,"minimumPoiDistance",void 0),u([d()],BA.prototype,"tilt",void 0),u([d({constructOnly:!0})],BA.prototype,"mode",void 0),BA=u([j("esri.views.3d.state.Constraints")],BA);const Hpe=bct(gi),Tl={min:$r(.5),max:$r(179.5)},CG={min:0,max:0};let LP=class extends Ke{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],LP.prototype,"enabled",void 0),u([d({type:Number})],LP.prototype,"elevationMargin",void 0),LP=u([j("esri.views.3d.state.Constraints.CollisionConstraint")],LP);let wC=class extends Ke{constructor(){super(...arguments),this.min=Hpe.min,this.max=Hpe.max}};u([d({type:Number})],wC.prototype,"min",void 0),u([d({type:Number})],wC.prototype,"max",void 0),wC=u([j("esri.views.3d.constraints.AltitudeConstraint")],wC);let XA=class extends Ke{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};u([d({type:Number,value:1e-8})],XA.prototype,"near",null),u([Hr("near")],XA.prototype,"castNear",null),u([d({type:Number,value:1e-8})],XA.prototype,"far",null),u([Hr("far")],XA.prototype,"castFar",null),u([d({type:["auto","manual"]})],XA.prototype,"mode",void 0),XA=u([j("esri.views.3d.constraints.ClipDistanceConstraint")],XA);const bZ={min:Kc(Tl.min),max:Kc(Tl.max)};let k2=class extends Ke{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return ze(e,bZ.min,bZ.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],k2.prototype,"mode",void 0),u([d({type:Number,value:bZ.max})],k2.prototype,"max",null),u([Hr("max")],k2.prototype,"castMax",null),k2=u([j("esri.views.3d.constraints.TiltConstraint")],k2);let B2=class extends Ke{constructor(){super(...arguments),this.tilt=new k2,this.altitude=new wC,this.clipDistance=new XA}};u([d({type:k2})],B2.prototype,"tilt",void 0),u([d({type:wC})],B2.prototype,"altitude",void 0),u([d({type:XA})],B2.prototype,"clipDistance",void 0),B2=u([j("esri.views.3d.constraints.Constraints")],B2);var wZ;let bp=wZ=class extends Qe{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new wZ(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],bp.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],bp.prototype,"date",void 0),u([ft("date",["datetime"])],bp.prototype,"readDate",null),u([St("date")],bp.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],bp.prototype,"directShadowsEnabled",void 0),u([ft("directShadowsEnabled",["directShadows"])],bp.prototype,"readDirectShadowsEnabled",null),u([St("directShadowsEnabled")],bp.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],bp.prototype,"displayUTCOffset",void 0),u([St("displayUTCOffset")],bp.prototype,"writeDisplayUTCOffset",null),bp=wZ=u([j("esri.webscene.SunLighting")],bp);const m4=bp;var RE;let Um=RE=class extends Nn.EventedMixin(m4){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new RE(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=RE.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;E(t)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=RE.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(MG.target=this,MG.timezoneOffset=s,this.emit("timezone-will-change",MG)),E(t))return!!isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new RE({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],Um.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],Um.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],Um.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],Um.prototype,"defaultDate",null),u([d({type:Date})],Um.prototype,"date",null),Um=RE=u([j("esri.views.3d.environment.SunLighting")],Um),function(t){function e({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}t.calculateTimezoneOffset=e}(Um||(Um={}));const MG={target:null,timezoneOffset:0},O1=Um;var xZ;let DP=xZ=class extends Qe{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new xZ(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],DP.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],DP.prototype,"directShadowsEnabled",void 0),DP=xZ=u([j("esri.webscene.VirtualLighting")],DP);const XU=DP;var W6;let OE=W6=class extends Nn.EventedMixin(XU){constructor(t){super(t),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.cameraTrackingEnabled=!0}clone(){return new W6({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new W6(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],OE.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],OE.prototype,"waterReflectionEnabled",void 0),u([d({type:Boolean})],OE.prototype,"cameraTrackingEnabled",void 0),OE=W6=u([j("esri.views.3d.environment.VirtualLighting")],OE);const NP=OE,wct={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:O1,virtual:NP}};var TZ;let qI=TZ=class extends Ke{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new TZ({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],qI.prototype,"quality",null),qI=TZ=u([j("esri.views.3d.environment.SceneViewAtmosphere")],qI);var SZ;let FP=SZ=class extends Qe{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new SZ({cloudCover:this.cloudCover})}};u([er({sunny:"sunny"})],FP.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],FP.prototype,"cloudCover",void 0),FP=SZ=u([j("esri.views.3d.environment.SunnyWeather")],FP);const EZ=FP;var CZ;let kP=CZ=class extends Qe{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new CZ({cloudCover:this.cloudCover})}};u([er({cloudy:"cloudy"})],kP.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],kP.prototype,"cloudCover",void 0),kP=CZ=u([j("esri.views.3d.environment.CloudyWeather")],kP);const xct=kP;var MZ;let BP=MZ=class extends Qe{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new MZ({fogStrength:this.fogStrength})}};u([er({foggy:"foggy"})],BP.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],BP.prototype,"fogStrength",void 0),BP=MZ=u([j("esri.views.3d.environment.FoggyWeather")],BP);const Tct=BP;var RZ;let PE=RZ=class extends Qe{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new RZ({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([er({rainy:"rainy"})],PE.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],PE.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],PE.prototype,"precipitation",void 0),PE=RZ=u([j("esri.views.3d.environment.RainyWeather")],PE);const Sct=PE;var OZ;let h2=OZ=class extends Qe{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new OZ({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([er({snowy:"snowy"})],h2.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],h2.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],h2.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],h2.prototype,"snowCover",void 0),h2=OZ=u([j("esri.views.3d.environment.SnowyWeather")],h2);const Ect=h2,URe={key:"type",base:EZ,typeMap:{sunny:EZ,cloudy:xct,rainy:Sct,snowy:Ect,foggy:Tct}},Cct=Object.keys(URe.typeMap);function Mct(t,e){return!!Cct.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const Pp=1e4,Rct={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:m4,virtual:XU}};let Y6=class extends Qe{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],Y6.prototype,"type",void 0),Y6=u([j("esri.webscene.background.Background")],Y6);const VRe=Y6;var PZ;const Oct={...Qy,nonNullable:!0};let UP=PZ=class extends VRe{constructor(t){super(t),this.type="color",this.color=new Ot([0,0,0,1])}clone(){return new PZ(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([er({color:"color"},{readOnly:!0})],UP.prototype,"type",void 0),u([d(Oct)],UP.prototype,"color",void 0),UP=PZ=u([j("esri.webscene.background.ColorBackground")],UP);const zRe=UP,qpe={base:VRe,key:"type",typeMap:{color:zRe}};function Pct(t){return(e,r,i)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,i),n}}}const Ict={types:qpe,json:{read:Pct(qpe),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var IZ;const GRe="esri.webscene.Environment",$ct=we.getLogger(GRe),Wpe=(t,e,r)=>({enabled:!r||!r.isPresentation});let P1=IZ=class extends Qe{constructor(t){super(t),this.lighting=new m4,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){Mct(t==null?void 0:t.type,$ct)&&this._set("weather",t)}clone(){return new IZ(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?XU.prototype.clone.call(this.lighting):m4.prototype.clone.call(this.lighting),background:Te(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:Rct,nonNullable:!0,json:{write:!0}})],P1.prototype,"lighting",void 0),u([d(Ict)],P1.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Wpe}}})],P1.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Wpe}}})],P1.prototype,"starsEnabled",void 0),u([d({types:URe,nonNullable:!0,json:{write:!0},value:new EZ})],P1.prototype,"weather",null),P1=IZ=u([j(GRe)],P1);const jRe=P1;var VP;let IE=VP=class extends jRe{constructor(t){super(t),this.atmosphere=new qI,this.lighting=new O1,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new VP({...e,lighting:e.lighting?e.lighting.type==="virtual"?NP.fromWebsceneLighting(e.lighting):O1.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){var e,r;return t?t instanceof O1||t instanceof NP?t:t instanceof m4?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new O1({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof XU?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new NP({...t.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):k0(wct,t):new O1}clone(){return new VP({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Te(this.background)})}cloneWithWebsceneEnvironment(t){return new VP({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Te(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):O1.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):NP.fromWebsceneLighting(t.lighting);default:return t.lighting,O1.fromWebsceneLighting(t.lighting)}}};u([d({type:qI,json:{read:!1},nonNullable:!0})],IE.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],IE.prototype,"lighting",void 0),u([Hr("lighting")],IE.prototype,"castLighting",null),IE=VP=u([j("esri.views.3d.environment.SceneViewEnvironment")],IE);const $E=IE;var sa;(function(t){t[t.Simple=0]="Simple",t[t.Realistic=1]="Realistic",t[t.Panoramic=2]="Panoramic",t[t.None=3]="None"})(sa||(sa={}));function ga(t,e){return t[0]=e[0],t[1]=e[1],t}function Kr(t,e,r){return t[0]=e,t[1]=r,t}function l0(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function ag(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function HRe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function qRe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Lct(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Dct(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Nct(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function Fct(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function kct(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Ch(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Bct(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function Kx(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function h9(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function lse(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function WRe(t){const e=t[0],r=t[1];return e*e+r*r}function cse(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Uct(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function g4(t,e){const r=e[0],i=e[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function Uo(t,e){return t[0]*e[0]+t[1]*e[1]}function Vct(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function LE(t,e,r,i){const s=e[0],n=e[1];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t}function zct(t,e){e=e||1;const r=2*uL()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function $Z(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s,t[1]=r[1]*i+r[3]*s,t}function d2(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s+r[4],t[1]=r[1]*i+r[3]*s+r[5],t}function Gct(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[3]*s+r[6],t[1]=r[1]*i+r[4]*s+r[7],t}function jct(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[4]*s+r[12],t[1]=r[1]*i+r[5]*s+r[13],t}function Hct(t,e,r,i){const s=e[0]-r[0],n=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=s*a-n*o+r[0],t[1]=s*o+n*a+r[1],t}function qct(t,e){const r=t[0],i=t[1],s=e[0],n=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Wct(t){return"vec2("+t[0]+", "+t[1]+")"}function YRe(t,e){return t[0]===e[0]&&t[1]===e[1]}function QRe(t,e){const r=t[0],i=t[1],s=e[0],n=e[1],o=dc();return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))}function Yct(t,e,r,i,s){let n=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const Qct=lse,Xct=ag,Zct=HRe,Jct=qRe,XRe=Kx,Kct=h9,eut=WRe;Object.freeze(Object.defineProperty({__proto__:null,add:l0,angle:qct,ceil:Lct,copy:ga,cross:Vct,dist:XRe,distance:Kx,div:Jct,divide:qRe,dot:Uo,equals:QRe,exactEquals:YRe,floor:Dct,inverse:Uct,len:Qct,length:lse,lerp:LE,max:Fct,min:Nct,mul:Zct,multiply:HRe,negate:cse,normalize:g4,projectAndScale:Yct,random:zct,rotate:Hct,round:kct,scale:Ch,scaleAndAdd:Bct,set:Kr,sqrDist:Kct,sqrLen:eut,squaredDistance:h9,squaredLength:WRe,str:Wct,sub:Xct,subtract:ag,transformMat2:$Z,transformMat2d:d2,transformMat3:Gct,transformMat4:jct},Symbol.toStringTag,{value:"Module"}));function use(t){return ze((t-1e5)/(1e6-1e5),0,1)}const LZ=1e4,tut=.085,A4=1e5;let rut=class{};const ys=rut;function I(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(I||(I={}));var B;(function(t){t.POSITION="position",t.NORMAL="normal",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.NORMALCOMPRESSED="normalCompressed",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced"})(B||(B={}));var co;function Sg(t,e){switch(e.textureCoordinateType){case co.Default:return t.attributes.add(B.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(I`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case co.Compressed:return t.attributes.add(B.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(I`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case co.Atlas:return t.attributes.add(B.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(B.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(I`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case co.None:return void t.vertex.code.add(I`void forwardTextureCoordinates() {}`);case co.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(co||(co={}));function qh(t){t.code.add(I`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Wd(t){t.include(qh),t.code.add(I`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function ZU(t){t.fragment.code.add(I`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var As;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(As||(As={}));let kn=class{constructor(e,r,i,s,n=null){this.name=e,this.type=r,this.arraySize=n,this.bind={[As.Pass]:null,[As.Draw]:null},E(i)&&E(s)&&(this.bind[i]=s)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Fr=class extends kn{constructor(e,r){super(e,"vec3",As.Pass,(i,s,n)=>i.setUniform3fv(e,r(s,n)))}},nt=class extends kn{constructor(e,r){super(e,"float",As.Pass,(i,s,n)=>i.setUniform1f(e,r(s,n)))}};function Ky(t){t.uniforms.add(new Fr("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function Yg(t){t.uniforms.add(new Fr("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function iut(t,e){e.useLegacyTerrainShading?t.uniforms.add(new nt("lightingFixedFactor",(r,i)=>i.lighting.noonFactor*(1-i.lighting.globalFactor))):t.constants.add("lightingFixedFactor","float",0)}function d9(t,e){const r=t.fragment;Ky(r),Yg(r),iut(r,e),r.code.add(I`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Bi=class extends kn{constructor(e,r){super(e,"vec2",As.Pass,(i,s,n)=>i.setUniform2fv(e,r(s,n)))}},hi=class extends kn{constructor(e,r){super(e,"vec4",As.Pass,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}},nn=class extends kn{constructor(e,r){super(e,"mat4",As.Pass,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};const ZRe=we.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let JRe=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){ZRe.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==e[n]&&s.add(n);for(const n of Object.keys(e))i[n]!==e[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${e[n]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},Di=class extends JRe{constructor(){super(...arguments),this.vertex=new Ype,this.fragment=new Ype,this.attributes=new out,this.varyings=new aut,this.extensions=new DZ,this.constants=new KRe}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),s=this.varyings.generateSource(),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?cut:lut,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(e,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];E(a)&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];E(a)&&i.set(o.name,a)});const s=Array.from(i.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](r,o,a,l)}}},sut=class{constructor(){this._entries=new Map}add(e){if(!Array.isArray(e))return this._add(e);for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(N(e))ZRe.error(`Trying to add null Uniform from ${new Error().stack}.`);else{if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new ce(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}}generateSource(){return Array.from(this._entries.values()).map(e=>E(e.arraySize)?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},nut=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},Ype=class extends JRe{constructor(){super(...arguments),this.uniforms=new sut,this.code=new nut,this.constants=new KRe}get builder(){return this}},out=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`attribute ${r[1]} ${r[0]};`)}},aut=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(){return this._entries.map(e=>`varying ${e[1]} ${e[0]};`)}},DZ=class NZ{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?NZ.ALLOWLIST_VERTEX:NZ.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};DZ.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],DZ.ALLOWLIST_VERTEX=[];let KRe=class No{constructor(){this._entries=new Set}add(e,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=No._numberToFloatStr(i);break;case"int":s=No._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${No._numberToFloatStr(i[0])},                            ${No._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${No._numberToFloatStr(i[0])},                            ${No._numberToFloatStr(i[1])},                            ${No._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${No._numberToFloatStr(i[0])},                            ${No._numberToFloatStr(i[1])},                            ${No._numberToFloatStr(i[2])},                            ${No._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${No._numberToIntStr(i[0])},                             ${No._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${No._numberToIntStr(i[0])},                             ${No._numberToIntStr(i[1])},                             ${No._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${No._numberToIntStr(i[0])},                             ${No._numberToIntStr(i[1])},                             ${No._numberToIntStr(i[2])},                             ${No._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>No._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const lut=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,cut=`precision highp float;
precision highp sampler2D;`,hse="Size",JU="InvSize";function Qp(t,e,r=!1,i=0){if(t.hasWebGL2Context){const s=I`vec2(textureSize(${e}, ${I.int(i)}))`;return r?"(1.0 / "+s+")":s}return r?e+JU:e+hse}function Wc(t,e,r,i=null,s=0){if(t.hasWebGL2Context)return I`texelFetch(${e}, ivec2(${r}), ${I.int(s)})`;let n=I`texture2D(${e}, ${r} * `;return n+=i?I`(${i}))`:I`${e+JU})`,n}var is;(function(t){t[t.None=0]="None",t[t.Size=1]="Size",t[t.InvSize=2]="InvSize"})(is||(is={}));let mr=class extends kn{constructor(e,r){super(e,"sampler2D",As.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};function $0(t,e,r=is.None){const i=[new mr(t,e)];if(r&is.Size){const s=t+hse;i.push(new Bi(s,(n,o)=>{const a=e(n,o);return E(a)?Kr(Qpe,a.descriptor.width,a.descriptor.height):Hu}))}if(r&is.InvSize){const s=t+JU;i.push(new Bi(s,(n,o)=>{const a=e(n,o);return E(a)?Kr(Qpe,1/a.descriptor.width,1/a.descriptor.height):Hu}))}return i}const Qpe=Dt(),WI=ct(parseFloat(5802e-9 .toFixed(6)),parseFloat(13558e-9 .toFixed(6)),parseFloat(331e-7 .toFixed(6))),RG=3,OG=ct(RG*parseFloat(65e-8 .toFixed(6)),RG*parseFloat(1881e-9 .toFixed(6)),RG*parseFloat(85e-9 .toFixed(6))),uut=3996e-9,hut=ct(parseFloat(Number(WI[0]+OG[0]).toFixed(6)),parseFloat(Number(WI[1]+OG[1]).toFixed(6)),parseFloat(Number(WI[2]+OG[2]).toFixed(6)));function dut(t){const e=new Di;e.attributes.add(B.POSITION,"vec2"),e.include(Sg,{textureCoordinateType:co.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add([new nn("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new nn("inverseViewMatrix",(s,n)=>FM(put,n.camera.viewMatrix))]),r.code.add(I`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add([new Bi("radii",s=>s.radii),new Fr("cameraPosition",(s,n)=>n.camera.eye),new hi("heightParameters",s=>s.heightParameters),new nt("innerFadeDistance",s=>s.innerFadeDistance),new nt("altitudeFade",s=>s.altitudeFade),new mr("depthTex",s=>s.depthTex),new nt("hazeStrength",s=>s.hazeStrength)]),i.constants.add("betaRayleigh","vec3",WI),i.constants.add("betaCombined","vec3",hut),i.constants.add("betaMie","float",uut),i.constants.add("scaleHeight","float",tut*A4),Ky(i),e.include(ZU),t.haze&&(i.include(Wd),i.uniforms.add(new Bi("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(I`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(I`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(I`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(I`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?I`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?I``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":I`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?I`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:I`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?I`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:I`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${t.haze?I`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:I`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":I`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `),e}const put=ot(),fut=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:WI,build:dut},Symbol.toStringTag,{value:"Module"}));let Ni=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var qs,Ar,tt,kg,fr,T0,sM,qt,Bs,Zn,Bt,pr,nr,At,cr,yr,Uc,Li,Cd,Ra,En,$i;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(qs||(qs={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Ar||(Ar={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(tt||(tt={})),function(t){t[t.ADD=32774]="ADD",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(kg||(kg={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(fr||(fr={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(T0||(T0={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(sM||(sM={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(qt||(qt={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Bs||(Bs={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(Zn||(Zn={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Bt||(Bt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(pr||(pr={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(nr||(nr={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(At||(At={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(cr||(cr={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(yr||(yr={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Uc||(Uc={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Li||(Li={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Cd||(Cd={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Ra||(Ra={})),function(t){t[t.TEXTURE=0]="TEXTURE",t[t.RENDER_BUFFER=1]="RENDER_BUFFER",t[t.CUBEMAP=2]="CUBEMAP"}(En||(En={})),function(t){t[t.NONE=0]="NONE",t[t.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",t[t.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",t[t.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",t[t.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}($i||($i={}));const PG=33984;var fa,gd;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(fa||(fa={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(gd||(gd={}));const Xpe=33306;var Hn,Zpe,Jpe,Kpe,p9,FZ,efe;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Hn||(Hn={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Zpe||(Zpe={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Jpe||(Jpe={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(Kpe||(Kpe={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(p9||(p9={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(FZ||(FZ={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(efe||(efe={}));let Vi=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=Nt(this._program),this._pipeline=this._configuration=null}reload(e){Nt(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,r=null,i){e.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Ar.TRIANGLES}getPipelineState(e,r){return this._pipeline}initializeConfiguration(e,r){}};const Pi=new Map([[B.POSITION,0],[B.NORMAL,1],[B.UV0,2],[B.COLOR,3],[B.SIZE,4],[B.TANGENT,4],[B.AUXPOS1,5],[B.SYMBOLCOLOR,5],[B.AUXPOS2,6],[B.FEATUREATTRIBUTE,6],[B.INSTANCEFEATUREATTRIBUTE,6],[B.INSTANCECOLOR,7],[B.OBJECTANDLAYERIDCOLOR,7],[B.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[B.MODEL,8],[B.MODELNORMAL,12],[B.MODELORIGINHI,11],[B.MODELORIGINLO,15]]),mut=we.getLogger("esri.views.webgl.checkWebGLError");function gut(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const eOe=!!Le("enable-feature:webgl-debug");function vd(){return eOe}function kZ(){return eOe}function tv(t){if(vd()){const e=t.getError();if(e){const r=gut(t,e),i=new Error().stack;mut.error(new ce("webgl-error","WebGL error occured",{message:r,stack:i}))}}}let Fi=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Vr({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(As.Pass,this),this.bindDraw=r.generateBind(As.Draw,this),this._fragmentUniforms=vd()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if(N(r)||r.glName==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,r)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(r,e.unit)}),E(this._fragmentUniforms)&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var $s,eT,Wn,vy,Bu,zy,Vv,nM,ms,tT,ny;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})($s||($s={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(eT||(eT={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(Wn||(Wn={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(vy||(vy={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Bu||(Bu={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(zy||(zy={})),function(t){t[t.STRETCH=1]="STRETCH",t[t.PAD=2]="PAD"}(Vv||(Vv={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(nM||(nM={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(ms||(ms={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(tT||(tT={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(ny||(ny={}));function X0(t,e,r=kg.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function Aa(t,e,r,i,s=kg.ADD,n=kg.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const dse={face:T0.BACK,mode:sM.CCW},tOe={face:T0.FRONT,mode:sM.CCW},KU=t=>t===$s.Back?dse:t===$s.Front?tOe:null,qu={zNear:0,zFar:1},zr={r:!0,g:!0,b:!0,a:!0};function Aut(t){return Sut.intern(t)}function yut(t){return Eut.intern(t)}function _ut(t){return Cut.intern(t)}function vut(t){return Mut.intern(t)}function but(t){return Rut.intern(t)}function wut(t){return Out.intern(t)}function xut(t){return Put.intern(t)}function Tut(t){return Iut.intern(t)}function Rr(t){return $ut.intern(t)}let e_=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function t_(t){return"["+t.join(",")+"]"}const Sut=new e_(rOe,t=>({__tag:"Blending",...t}));function rOe(t){return t?t_([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const Eut=new e_(iOe,t=>({__tag:"Culling",...t}));function iOe(t){return t?t_([t.face,t.mode]):null}const Cut=new e_(sOe,t=>({__tag:"PolygonOffset",...t}));function sOe(t){return t?t_([t.factor,t.units]):null}const Mut=new e_(nOe,t=>({__tag:"DepthTest",...t}));function nOe(t){return t?t_([t.func]):null}const Rut=new e_(oOe,t=>({__tag:"StencilTest",...t}));function oOe(t){return t?t_([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const Out=new e_(aOe,t=>({__tag:"DepthWrite",...t}));function aOe(t){return t?t_([t.zNear,t.zFar]):null}const Put=new e_(lOe,t=>({__tag:"ColorWrite",...t}));function lOe(t){return t?t_([t.r,t.g,t.b,t.a]):null}const Iut=new e_(cOe,t=>({__tag:"StencilWrite",...t}));function cOe(t){return t?t_([t.mask]):null}const $ut=new e_(Lut,t=>({blending:Aut(t.blending),culling:yut(t.culling),polygonOffset:_ut(t.polygonOffset),depthTest:vut(t.depthTest),stencilTest:but(t.stencilTest),depthWrite:wut(t.depthWrite),colorWrite:xut(t.colorWrite),stencilWrite:Tut(t.stencilWrite)}));function Lut(t){return t?t_([rOe(t.blending),iOe(t.culling),sOe(t.polygonOffset),nOe(t.depthTest),oOe(t.stencilTest),aOe(t.depthWrite),lOe(t.colorWrite),cOe(t.stencilWrite)]):null}let Dut=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,r,i,s){return(i||e!==r)&&(s(e),this._pipelineInvalid=!0),e}},Nut=class extends ys{constructor(){super(...arguments),this.heightParameters=Zr(),this.radii=Dt(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1}},BZ=class uOe extends Vi{initializeProgram(e){return new Fi(e.rctx,uOe.shader.get().build(this.configuration),Pi)}initializePipeline(){return this.configuration.haze?Rr({blending:Aa(tt.ONE,tt.ZERO,tt.ONE_MINUS_SRC_COLOR,tt.ONE),colorWrite:zr}):Rr({blending:Aa(tt.SRC_ALPHA,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),depthTest:{func:Bs.LEQUAL},colorWrite:zr})}};BZ.shader=new Ni(fut,()=>be(()=>import("./ChapmanAtmosphere.glsl-baacfd26.js"),[]));let fc=class extends ys{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function ie(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,r,{get(){return this[i]},set(h){if(this[i]!==h&&(this[i]=h,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+h<<l&c,typeof h!="number"&&typeof h!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof h)}})}}}let hOe=class extends fc{constructor(){super(...arguments),this.haze=!1}};u([ie()],hOe.prototype,"haze",void 0);let hl=class{constructor(e,r,i,s,n,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new hl(B.POSITION,3,qt.FLOAT,0,12);new hl(B.POSITION,3,qt.FLOAT,0,20),new hl(B.UV0,2,qt.FLOAT,12,20);new hl(B.POSITION,3,qt.FLOAT,0,32),new hl(B.NORMAL,3,qt.FLOAT,12,32),new hl(B.UV0,2,qt.FLOAT,24,32);new hl(B.POSITION,3,qt.FLOAT,0,16),new hl(B.COLOR,4,qt.UNSIGNED_BYTE,12,16);const pse=[new hl(B.POSITION,2,qt.FLOAT,0,8)],QM=[new hl(B.POSITION,2,qt.FLOAT,0,16),new hl(B.UV0,2,qt.FLOAT,8,16)];function tfe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Ol(t,e){return t.vertexBuffers[e].size/Fut(t.layout[e])}function Fut(t){return t[0].stride}function fse(t,e,r,i,s=0){const n=t.gl,o=t.capabilities.instancing;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function mse(t,e,r,i){const s=t.gl,n=t.capabilities.instancing;t.bindBuffer(r);for(const o of i){const a=e.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(fr.ARRAY_BUFFER)}function dOe(t){switch(t){case At.ALPHA:case At.LUMINANCE:case At.RED:case At.RED_INTEGER:case cr.R8:case cr.R8I:case cr.R8UI:case cr.R8_SNORM:case Uc.STENCIL_INDEX8:return 1;case At.LUMINANCE_ALPHA:case At.RG:case At.RG_INTEGER:case cr.RGBA4:case cr.R16F:case cr.R16I:case cr.R16UI:case cr.RG8:case cr.RG8I:case cr.RG8UI:case cr.RG8_SNORM:case cr.RGB565:case cr.RGB5_A1:case Uc.DEPTH_COMPONENT16:return 2;case At.DEPTH_COMPONENT:case At.RGB:case At.RGB_INTEGER:case cr.RGB8:case cr.RGB8I:case cr.RGB8UI:case cr.RGB8_SNORM:case cr.SRGB8:case Uc.DEPTH_COMPONENT24:return 3;case At.DEPTH_STENCIL:case At.RGBA:case At.RGBA_INTEGER:case cr.RGBA8:case cr.R32F:case cr.R11F_G11F_B10F:case cr.RG16F:case cr.R32I:case cr.R32UI:case cr.RG16I:case cr.RG16UI:case cr.RGBA8I:case cr.RGBA8UI:case cr.RGBA8_SNORM:case cr.SRGB8_ALPHA8:case cr.RGB9_E5:case cr.RGB10_A2UI:case cr.RGB10_A2:case Uc.DEPTH_STENCIL:case Uc.DEPTH_COMPONENT32F:case Uc.DEPTH24_STENCIL8:return 4;case Uc.DEPTH32F_STENCIL8:return 5;case cr.RGB16F:case cr.RGB16I:case cr.RGB16UI:return 6;case cr.RG32F:case cr.RG32I:case cr.RG32UI:case cr.RGBA16F:case cr.RGBA16I:case cr.RGBA16UI:return 8;case cr.RGB32F:case cr.RGB32I:case cr.RGB32UI:return 12;case cr.RGBA32F:case cr.RGBA32I:case cr.RGBA32UI:return 16;case Hn.COMPRESSED_RGB_S3TC_DXT1_EXT:case Hn.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Hn.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Hn.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Hn.COMPRESSED_R11_EAC:case Hn.COMPRESSED_SIGNED_R11_EAC:case Hn.COMPRESSED_RGB8_ETC2:case Hn.COMPRESSED_SRGB8_ETC2:case Hn.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Hn.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Hn.COMPRESSED_RG11_EAC:case Hn.COMPRESSED_SIGNED_RG11_EAC:case Hn.COMPRESSED_RGBA8_ETC2_EAC:case Hn.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function rT(t){if(N(t))return 0;if("descriptor"in t)return t.glName?rT(t.descriptor):0;const e=t.internalFormat||"pixelFormat"in t&&t.pixelFormat;if(!e)return 0;const r="hasMipmap"in t&&t.hasMipmap?1.3:1,i=t.width*t.height;return dOe(e)*i*r}const Yb=we.getLogger("esri.views.webgl.VertexArrayObject");let uf=class{constructor(e,r,i,s,n=null){this._context=e,this._locations=r,this._layout=i,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,e.instanceCounter.increment(fa.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].size,E(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){var r,i,s;if(!this._context)return void((this._glName||e&&Object.getOwnPropertyNames(this._buffers).length>0)&&Yb.warn("Leaked WebGL VAO"));if(this._glName){const n=(i=(r=this._context)==null?void 0:r.capabilities)==null?void 0:i.vao;n?(n.deleteVertexArray(this._glName),this._glName=null):Yb.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const n in this._buffers)(s=this._buffers[n])==null||s.dispose(),delete this._buffers[n];this._indexBuffer=Nt(this._indexBuffer)}this._context.instanceCounter.decrement(fa.VertexArrayObject,this),this._context=Px(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||Yb.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||Yb.error("Vertex buffer is uninitialized!");const a=r[n];a||Yb.error("Vertex element descriptor is empty!"),fse(this._context,this._locations,o,a)}E(i)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:r}=this;e||Yb.error("Vertex buffer dictionary is empty!");for(const i in e){const s=e[i];s||Yb.error("Vertex buffer is uninitialized!");const n=r[i];mse(this._context,this._locations,s,n)}E(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},Z0=class extends uf{};var sr;function kut(t,e,r={}){const i=pOe(t);for(;i.length>1;){const s=f9(e,i.shift(),r);if(E(s))return s}return But(e,i.shift(),r)}function pOe(t){const e=Le("esri-force-webgl");if(e===sr.WEBGL1||e===sr.WEBGL2)return[e];switch(t){case"2d":return Le("mac")&&Le("chrome")?[sr.WEBGL1,sr.WEBGL2]:[sr.WEBGL2,sr.WEBGL1];case"3d":return[sr.WEBGL2,sr.WEBGL1]}}function But(t,e,r={}){if(!window.WebGLRenderingContext)return rfe(t,Uut),null;const i=f9(t,e,r);return N(i)&&rfe(t,Vut),i}function f9(t,e,r={}){const i=e===sr.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of i){try{s=t.getContext(n,r)}catch{}if(s)break}return s}function rfe(t,e){const r=t.parentNode;r&&(r.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>")}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(sr||(sr={}));const Uut='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',Vut=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,am=we.getLogger("esri.views.webgl.BufferObject");let Wi=class DE{static createIndex(e,r,i){return new DE(e,fr.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new DE(e,fr.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){if(e.type!==sr.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new DE(e,fr.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=Li.STREAM_READ,i){if(e.type!==sr.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new DE(e,fr.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(e,r=Li.STREAM_DRAW,i){if(e.type!==sr.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new DE(e,fr.PIXEL_UNPACK_BUFFER,r,i)}constructor(e,r,i,s){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(fa.BufferObject,this),this._glName=this._context.gl.createBuffer(),tv(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===fr.ELEMENT_ARRAY_BUFFER?this._indexType===qt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===fr.ELEMENT_ARRAY_BUFFER||this.bufferType===fr.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(fa.BufferObject,this),this._context=Px(this._context)):this._glName&&am.warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&am.error("Buffer size needs to be positive!"),this.bufferType===fr.ELEMENT_ARRAY_BUFFER&&E(r))switch(this._indexType=r,r){case qt.UNSIGNED_SHORT:e*=2;break;case qt.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===fr.ELEMENT_ARRAY_BUFFER&&(Zee(e)&&(r/=2,this._indexType=qt.UNSIGNED_SHORT),Jee(e)&&(r/=4,this._indexType=qt.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;E(r)?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,e,this.usage),tv(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,s){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.byteSize)&&am.error("offset is out of range!"),i>=s&&am.error("end must be bigger than start!"),(r+(s-i))*e.BYTES_PER_ELEMENT>this.byteSize&&am.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===sr.WEBGL2)o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,s-i);else{const a=i===0&&s===e.length?e:e.subarray(i,s);o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,a)}tv(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,r=0,i,s){if(this._context.type!==sr.WEBGL2)return void am.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void am.error("Problem getting subdata: offset and length were less than zero!");const n=zut(e)?e.BYTES_PER_ELEMENT:1;if(n*((i??0)+(s??0))>e.byteLength)return void am.error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s??0)>this.byteSize&&am.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,fr.COPY_READ_BUFFER),o.getBufferSubData(fr.COPY_READ_BUFFER,r,e,i,s),this._context.unbindBuffer(fr.COPY_READ_BUFFER)}async getSubDataAsync(e,r=0,i,s){this._context.type===sr.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,r,i,s)):am.error("Get buffer subdata is supported in WebGL2 only!")}};function zut(t){return G9e(t)}const IG={target:nr.TEXTURE_2D,samplingMode:Bt.LINEAR,wrapMode:pr.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},ife=4;let Wt=class{constructor(e,r,i=null){this._context=e,this.type="texture",this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,e.instanceCounter.increment(fa.Texture,this),this._descriptor={...IG,...r};for(const s in IG)this._descriptor[s]===void 0&&(this._descriptor[s]=IG[s]);if(e.type!==sr.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),Qb(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===nr.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(fa.Texture,this))}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===nr.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=nr.TEXTURE_CUBE_MAP_POSITIVE_X;r<=nr.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){if(!this._context||!this._context.gl)return;const i=this._context.gl;this._glName||(this._glName=i.createTexture()),e===void 0&&(e=null);const s=this._descriptor,n=r??s.target,o=Qb(n);e===null&&(s.width=s.width||ife,s.height=s.height||ife,o&&(s.depth=s.depth??1));const a=this._context.bindTexture(this,Wt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(Wt.TEXTURE_UNIT_FOR_UPDATES),Wt._validateTexture(this._context,s),this._configurePixelStorage(),tv(i);const l=s.pixelFormat;let c=s.internalFormat??this._deriveInternalFormat(l,s.dataType);if($G(e)){let h=e.width,p=e.height;const A=1;e instanceof HTMLVideoElement&&(h=e.videoWidth,p=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,c,s.hasMipmap,h,p,A),this._texImage(n,0,c,h,p,A,e),tv(i),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=h),s.height===void 0&&(s.height=p),o&&s.depth===void 0&&(s.depth=A)}else{const{width:h,height:p,depth:A}=s;if(h==null||p==null)throw new Error("Width and height must be specified!");if(o&&A==null)throw new Error("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,c,s.hasMipmap,h,p,A),i.DEPTH24_STENCIL8&&c===i.DEPTH_STENCIL&&(c=i.DEPTH24_STENCIL8),Q6(e)){const _=e.levels,w=sfe(n,h,p,A),T=Math.min(w-1,_.length-1);E(this._context.gl2)?i.texParameteri(s.target,this._context.gl2.TEXTURE_MAX_LEVEL,T):s.hasMipmap=s.hasMipmap&&w===_.length;const C=c;if(!jut(C))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((M,O,$,L)=>{const k=_[Math.min(M,_.length-1)];this._compressedTexImage(n,M,C,O,$,L,k)},T)}else E(e)?(this._texImage(n,0,c,h,p,A,e),tv(i),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((_,w,T,C)=>{this._texImage(n,_,c,w,T,C,null),tv(i)})}Wt._applySamplingMode(i,this._descriptor),Wt._applyWrapMode(i,this._descriptor),Wt._applyAnisotropicFilteringParameters(this._context,this._descriptor),tv(i),this._context.bindTexture(a,Wt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._context.gl,c=this._descriptor,{pixelFormat:h,dataType:p,target:A,isImmutable:_}=c,w=c.internalFormat??this._deriveInternalFormat(h,p);if(_&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const T=this._context.bindTexture(this,Wt.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||s>c.width||n>c.height||r+s>c.width||i+n>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(N(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,a)}if($G(o)?E(this._context.gl2)?this._context.gl2.texSubImage2D(A,e,r,i,s,n,h,p,o):l.texSubImage2D(A,e,r,i,h,p,o):Q6(o)?l.compressedTexSubImage2D(A,e,r,i,s,n,w,o.levels[e]):l.texSubImage2D(A,e,r,i,s,n,h,p,o),a){if(N(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,0)}this._context.bindTexture(T,Wt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl2;if(N(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:p,dataType:A,isImmutable:_,target:w}=h,T=h.internalFormat??this._deriveInternalFormat(p,A);if(_&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");Qb(w)||console.warn("Attempting to set 3D texture data on a non-3D texture");const C=this._context.bindTexture(this,Wt.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(Wt.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||n>h.width||o>h.height||a>h.depth||r+n>h.width||i+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),Q6(l))l=l.levels[e],c.compressedTexSubImage3D(w,e,r,i,s,n,o,a,T,l);else{const M=l;c.texSubImage3D(w,e,r,i,s,n,o,a,p,A,M)}this._context.bindTexture(C,Wt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,Wt._validateTexture(this._context,e)}e.samplingMode===Bt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Bt.LINEAR_MIPMAP_NEAREST):e.samplingMode===Bt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Bt.NEAREST_MIPMAP_NEAREST);const r=this._context.bindTexture(this,Wt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(Wt.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(e.target),this._context.bindTexture(r,Wt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,Wt._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,r=this._descriptor;this._samplingModeDirty&&(Wt._applySamplingMode(e,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(Wt._applyWrapMode(e,r),this._wrapModeDirty=!1)}_deriveInternalFormat(e,r){if(this._context.type===sr.WEBGL1)return e;switch(r){case yr.FLOAT:switch(e){case At.RGBA:return cr.RGBA32F;case At.RGB:return cr.RGB32F;default:throw new Error("Unable to derive format")}case yr.UNSIGNED_BYTE:switch(e){case At.RGBA:return cr.RGBA8;case At.RGB:return cr.RGB8}default:return e}}_configurePixelStorage(){const e=this._context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,r,i,s,n,o){const a=this._context.gl2;if(N(a))throw new Error("Immutable textures are not supported in WebGL1");if(!Gut(r))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?sfe(e,s,n,o):1;if(Qb(e)){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,s,n,o)}else a.texStorage2D(e,l,r,s,n);this._wasImmutablyAllocated=!0}_texImage(e,r,i,s,n,o,a){const l=this._context.gl;let c=null;const h=this._context.type===sr.WEBGL2,p=Qb(e),{isImmutable:A,pixelFormat:_,dataType:w}=this._descriptor;if(h&&(c=l),h||!$G(a))if(A){if(E(a)){const T=a;if(p){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texSubImage3D(e,r,0,0,0,s,n,o,_,w,T)}else l.texSubImage2D(e,r,0,0,s,n,_,w,T)}}else{const T=a;if(p){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texImage3D(e,r,i,s,n,o,0,_,w,T)}else l.texImage2D(e,r,i,s,n,0,_,w,T)}else l.texImage2D(e,0,i,_,w,a)}_compressedTexImage(e,r,i,s,n,o,a){const l=this._context.gl;let c=null;const h=Qb(e),p=this._descriptor.isImmutable;if(h){if(this._context.type!==sr.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}if(p){if(E(a))if(h){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,s,n,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,s,n,i,a)}else if(h){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,s,n,o,0,a)}else l.compressedTexImage2D(e,r,i,s,n,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===nr.TEXTURE_3D;if(i==null||s==null||l&&n==null)throw new Error("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,s,n),o&&(i!==1||s!==1||l&&n!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}static _validateTexture(e,r){(r.width!=null&&r.width<0||r.height!=null&&r.height<0||r.depth!=null&&r.depth<0)&&console.error("Negative dimension parameters are not allowed!");const i=e.type===sr.WEBGL2,s=r.width!=null&&U0(r.width)&&r.height!=null&&U0(r.height);i||!r.isImmutable&&!Qb(r.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),i||s||(typeof r.wrapMode=="number"?r.wrapMode!==pr.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):r.wrapMode.s===pr.CLAMP_TO_EDGE&&r.wrapMode.t===pr.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),r.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,r){let i=r.samplingMode,s=r.samplingMode;i===Bt.LINEAR_MIPMAP_NEAREST||i===Bt.LINEAR_MIPMAP_LINEAR?(i=Bt.LINEAR,r.hasMipmap||(s=Bt.LINEAR)):i!==Bt.NEAREST_MIPMAP_NEAREST&&i!==Bt.NEAREST_MIPMAP_LINEAR||(i=Bt.NEAREST,r.hasMipmap||(s=Bt.NEAREST)),e.texParameteri(r.target,e.TEXTURE_MAG_FILTER,i),e.texParameteri(r.target,e.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(e,r){typeof r.wrapMode=="number"?(e.texParameteri(r.target,e.TEXTURE_WRAP_S,r.wrapMode),e.texParameteri(r.target,e.TEXTURE_WRAP_T,r.wrapMode)):(e.texParameteri(r.target,e.TEXTURE_WRAP_S,r.wrapMode.s),e.texParameteri(r.target,e.TEXTURE_WRAP_T,r.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,r){const i=e.capabilities.textureFilterAnisotropic;i&&e.gl.texParameterf(r.target,i.TEXTURE_MAX_ANISOTROPY,r.maxAnisotropy??1)}};function Gut(t){return t in cr}function jut(t){return t in Hn}function Q6(t){return E(t)&&"type"in t&&t.type==="compressed"}function Hut(t){return E(t)&&"byteLength"in t}function $G(t){return E(t)&&!Q6(t)&&!Hut(t)}function Qb(t){return t===nr.TEXTURE_3D||t===nr.TEXTURE_2D_ARRAY}function sfe(t,e,r,i=1){let s=Math.max(e,r);return t===nr.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}Wt.TEXTURE_UNIT_FOR_UPDATES=0;function mc(t,e=pse,r=Pi,i=-1,s=1){let n=null;return e===QM?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new Z0(t,r,{geometry:e},{geometry:Wi.createVertex(t,Li.STATIC_DRAW,n)})}function qut(t,e=pse,r=Pi){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new Z0(t,r,{geometry:e},{geometry:Wi.createVertex(t,Li.STATIC_DRAW,i)})}const fOe=4;function mOe(t,e=fOe){return new Wt(t,{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.NEAREST,width:e,height:e})}function Wut(t,e,r=fOe){const i=new Uint8Array(r*r*4);for(let s=0;s<i.length;s+=4)i[s+0]=255*e[0],i[s+1]=255*e[1],i[s+2]=255*e[2],i[s+3]=255*e[3];return new Wt(t,{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.NEAREST,width:r,height:r},i)}function gOe(t){return new Wt(t,{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}let LG=class{constructor(e,r){this._view=e,this.type=sa.Realistic,this._handles=new ts,this._passParameters=new Nut,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=gi.radius,this._fadeHaze=0,this._updateRadius(gi.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([xe(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds()),xe(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds())]);const s=new hOe;s.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(BZ,s),s.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(BZ,s),this._vao=mc(i,QM)}destroy(){this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._vao.dispose(),this._handles.destroy()}render(e){this._render(e,this._atmosphereTechnique,e.offscreenRenderingHelper.depthTexture)}renderHaze(e,r){this._fadeHaze=r,this._render(e,this._atmosphereHazeTechnique,e.offscreenRenderingHelper.linearDepthTexture)}_render(e,r,i){if(N(i))return;this._update(e.bindParameters.camera),this._passParameters.depthTex=i;const s=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);e.offscreenRenderingHelper.renderDepthDetached(()=>this._renderCommon(s,e))}_renderCommon(e,r){N(this._vao)||(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(Ar.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=gi.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(gi.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,Kr(this._passParameters.radii,e,e+A4),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-LZ)*LZ)}_update(e){if(N(e))return;const r=Jl(e.eye),i=Math.sqrt(r),s=r-this._passParameters.radii[1]*this._passParameters.radii[1],n=ze((i-this._passParameters.radii[0])/A4,0,1);ns(this._passParameters.heightParameters,i,r,s,n),this._passParameters.altitudeFade=use(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Sr(Sr(.6,1,L3(9500,10500,i-gi.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function Ks(){return new Float32Array(3)}function m9(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ji(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function AOe(t,e){return new Float32Array(t,e,3)}function gse(){return Ks()}function yOe(){return Ji(1,1,1)}function _Oe(){return Ji(1,0,0)}function vOe(){return Ji(0,1,0)}function bOe(){return Ji(0,0,1)}const Yut=gse(),Qut=yOe(),Xut=_Oe(),Zut=vOe(),Jut=bOe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Qut,UNIT_X:Xut,UNIT_Y:Zut,UNIT_Z:Jut,ZEROS:Yut,clone:m9,create:Ks,createView:AOe,fromValues:Ji,ones:yOe,unitX:_Oe,unitY:vOe,unitZ:bOe,zeros:gse},Symbol.toStringTag,{value:"Module"}));function wOe(t){t.extensions.add("GL_EXT_shader_texture_lod"),t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(I`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function Ase(t,e){switch(t.include(Sg,e),t.fragment.code.add(I`
  struct TextureLookupParameter {
    vec2 uv;
    ${e.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),e.textureCoordinateType){case co.Default:case co.Compressed:return void t.fragment.code.add(I`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case co.Atlas:return t.include(wOe),void t.fragment.code.add(I`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:e.textureCoordinateType;case co.None:case co.COUNT:return}}let Vd=class extends kn{constructor(e,r){super(e,"vec3",As.Draw,(i,s,n,o)=>i.setUniform3fv(e,r(s,n,o)))}},y4=class extends kn{constructor(e,r){super(e,"vec2",As.Draw,(i,s,n,o)=>i.setUniform2fv(e,r(s,n,o)))}},NL=class extends kn{constructor(e,r){super(e,"sampler2D",As.Draw,(i,s,n)=>i.bindTexture(e,r(s,n)))}};function zv(t,e,r=is.None){const i=[new NL(t,e)];if(r&is.Size){const s=t+hse;i.push(new y4(s,(n,o)=>{const a=e(n,o);return E(a)?Kr(nfe,a.descriptor.width,a.descriptor.height):Hu}))}if(r&is.InvSize){const s=t+JU;i.push(new y4(s,(n,o)=>{const a=e(n,o);return E(a)?Kr(nfe,1/a.descriptor.width,1/a.descriptor.height):Hu}))}return i}const nfe=Dt();let Ob=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return vy.LOADED}},yse=class extends Ob{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=en(this._texture),this._textureNormal=en(this._textureNormal),this._textureEmissive=en(this._textureEmissive),this._textureOcclusion=en(this._textureOcclusion),this._textureMetallicRoughness=en(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?vy.LOADED:vy.LOADING}get textureBindParameters(){return new xOe(E(this._texture)?this._texture.glTexture:null,E(this._textureNormal)?this._textureNormal.glTexture:null,E(this._textureEmissive)?this._textureEmissive.glTexture:null,E(this._textureOcclusion)?this._textureOcclusion.glTexture:null,E(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){(N(this._texture)||e!==this._texture.id)&&(this._texture=en(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(N(e))return void r(null);const i=this._textureRepository.acquire(e);if(Zd(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return en(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}},xOe=class extends ys{constructor(e=null,r=null,i=null,s=null,n=null){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n}};const iBt=Ji(0,.6,.2);var Qt;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(Qt||(Qt={}));function _se(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===Qt.Normal&&i&&t.include(Ase,e),e.pbrMode!==Qt.Schematic)if(e.pbrMode!==Qt.Disabled){if(e.pbrMode===Qt.Normal){r.code.add(I`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.supportsTextureAtlas?e.hasWebGL2Context?is.None:is.Size:is.None,n=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(n===As.Pass?$0("texMetallicRoughness",o=>o.textureMetallicRoughness,s):zv("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),r.code.add(I`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(n===As.Pass?$0("texEmission",o=>o.textureEmissive,s):zv("texEmission",o=>o.textureEmissive,s)),r.code.add(I`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(n===As.Pass?$0("texOcclusion",o=>o.textureOcclusion,s):zv("texOcclusion",o=>o.textureOcclusion,s)),r.code.add(I`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(I`float getBakedOcclusion() { return 1.0; }`),r.uniforms.add(n===As.Pass?[new Fr("emissionFactor",o=>o.emissiveFactor),new Fr("mrrFactors",o=>o.mrrFactors)]:[new Vd("emissionFactor",o=>o.emissiveFactor),new Vd("mrrFactors",o=>o.mrrFactors)]),r.code.add(I`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${i?I`vtc.uv = vuv0;`:""}
      ${e.hasMetallicRoughnessTextureTransform?I`vtc.uv = metallicRoughnessUV;`:""}
      ${e.hasMetallicRoughnessTexture?e.supportsTextureAtlas?I`
                vtc.size = ${Qp(e,"texMetallicRoughness")};
                applyMetallnessAndRoughness(vtc);`:I`applyMetallnessAndRoughness(vtc);`:""}
      ${e.hasEmissiveTextureTransform?I`vtc.uv = emissiveUV;`:""}
      ${e.hasEmissionTexture?e.supportsTextureAtlas?I`
                vtc.size = ${Qp(e,"texEmission")};
                applyEmission(vtc);`:I`applyEmission(vtc);`:""}
      ${e.hasOcclusionTextureTransform?I`vtc.uv = occlusionUV;`:""}
      ${e.hasOcclusionTexture?e.supportsTextureAtlas?I`
                vtc.size = ${Qp(e,"texOcclusion")};
                applyOcclusion(vtc);`:I`applyOcclusion(vtc);`:""}
    }
  `)}}else r.code.add(I`float getBakedOcclusion() { return 1.0; }`);else r.code.add(I`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function vse(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new Fr("lightingAmbientSH0",(s,n)=>$e(ofe,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(I`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add([new hi("lightingAmbientSH_R",(s,n)=>ns(aA,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new hi("lightingAmbientSH_G",(s,n)=>ns(aA,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new hi("lightingAmbientSH_B",(s,n)=>ns(aA,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),r.code.add(I`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add([new Fr("lightingAmbientSH0",(s,n)=>$e(ofe,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new hi("lightingAmbientSH_R1",(s,n)=>ns(aA,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new hi("lightingAmbientSH_G1",(s,n)=>ns(aA,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new hi("lightingAmbientSH_B1",(s,n)=>ns(aA,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new hi("lightingAmbientSH_R2",(s,n)=>ns(aA,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new hi("lightingAmbientSH_G2",(s,n)=>ns(aA,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new hi("lightingAmbientSH_B2",(s,n)=>ns(aA,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),r.code.add(I`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==Qt.Normal&&e.pbrMode!==Qt.Schematic||r.code.add(I`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const ofe=V(),aA=Zr();function FL(t){t.vertex.code.add(I`const float PI = 3.141592653589793;`),t.fragment.code.add(I`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Yn,iT;function Kut(t){return E(t)&&E(t.cubeMap)}function bse(t){return E(t)&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(Yn||(Yn={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(iT||(iT={}));let eht=class{constructor(){this.readChannels=iT.RG,this.renderingStage=Yn.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=V(),this.isCameraPositionFinal=!0,this.parallax=new afe,this.parallaxNew=new afe,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:na.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:bh.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:ob.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===na.FADE_OUT||this.fadeInOut.stage===na.FADE_IN||this.fadeIn.stage===bh.FADE_IN||this.fadeInOutHeight.stage!==ob.FINISHED||this.renderingStage===Yn.FADING_TEXTURE_CHANNELS}};var bh,na,ob;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(bh||(bh={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(na||(na={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(ob||(ob={}));let afe=class{constructor(){this.anchorPointClouds=V(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=ot()}},by=class extends kn{constructor(e,r){super(e,"bool",As.Pass,(i,s,n)=>i.setUniform1b(e,r(s,n)))}},tht=class extends kn{constructor(e,r){super(e,"samplerCube",As.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};function TOe(t){const e=t.fragment;e.uniforms.add([new nn("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new nn("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new Fr("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new Fr("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new nt("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new nt("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new nt("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===na.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new nt("crossFadeAnchorFactor",(r,i)=>ze(i.cloudsFade.crossFade.factor,0,1)),new tht("cubeMap",(r,i)=>E(i.cloudsFade.data)&&E(i.cloudsFade.data.cubeMap)?i.cloudsFade.data.cubeMap.colorTexture:null),new by("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new by("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===iT.RG),new by("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===Yn.FADING_TEXTURE_CHANNELS)]),e.constants.add("planetRadius","float",gi.radius),e.code.add(I`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(I`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(I`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),Ky(e),Yg(e),e.code.add(I`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(I`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(I`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(I`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(I`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Qg(t){t.code.add(I`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function rht(){const t=new Di;t.attributes.add(B.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add([new nn("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new nn("inverseViewMatrix",(i,s)=>FM(iht,s.camera.viewMatrix))]),e.code.add(I`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(Qg),r.include(qh),t.include(vse,{pbrMode:Qt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(FL),t.include(ZU),t.include(d9,{useLegacyTerrainShading:!1}),t.include(TOe,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1}),r.uniforms.add([new Fr("cameraPosition",(i,s)=>s.camera.eye)]),r.code.add(I`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const iht=ot(),sht=Object.freeze(Object.defineProperty({__proto__:null,build:rht},Symbol.toStringTag,{value:"Module"}));let SOe=class EOe extends Vi{constructor(e){super(e,new fc,()=>this.destroy())}initializeProgram(e){return new Fi(e.rctx,EOe.shader.get().build(),Pi)}initializePipeline(){return Rr({blending:Aa(tt.ONE,tt.ZERO,tt.SRC_ALPHA,tt.ONE),depthTest:{func:Bs.LEQUAL},colorWrite:zr})}};SOe.shader=new Ni(sht,()=>be(()=>import("./CloudsComposition.glsl-0fe686c3.js"),[]));let p2=class extends Ke{constructor(e){super(e),this._technique=new SOe(e),this._vao=mc(e.rctx)}destroy(){this._technique=en(this._technique),this._vao=Nt(this._vao)}render(e){const r=e.bindParameters.cloudsFade;if(N(this._vao)||N(r.data))return;if(!this._technique.compiled)return void this.requestRender();const i=e.rctx.bindTechnique(this._technique,nht,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Ar.TRIANGLE_STRIP,0,4)}};u([d({constructOnly:!0})],p2.prototype,"rctx",void 0),u([d({constructOnly:!0})],p2.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],p2.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],p2.prototype,"requestRender",void 0),p2=u([j("esri.views.3d.environment.CloudsComposition")],p2);const nht=new ys;function hf(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function oht(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function wse(t,e,r,i,s,n,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function xse(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function df(t,e){if(t===e){const r=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function RT(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=h*o-a*c,A=-h*n+a*l,_=c*n-o*l;let w=r*p+i*A+s*_;return w?(w=1/w,t[0]=p*w,t[1]=(-h*i+s*c)*w,t[2]=(a*i-s*o)*w,t[3]=A*w,t[4]=(h*r-s*l)*w,t[5]=(-a*r+s*n)*w,t[6]=_*w,t[7]=(-c*r+i*l)*w,t[8]=(o*r-i*n)*w,t):null}function aht(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=s*c-i*h,t[2]=i*a-s*o,t[3]=a*l-n*h,t[4]=r*h-s*l,t[5]=s*n-r*a,t[6]=n*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*n,t}function lht(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function oM(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],A=r[0],_=r[1],w=r[2],T=r[3],C=r[4],M=r[5],O=r[6],$=r[7],L=r[8];return t[0]=A*i+_*o+w*c,t[1]=A*s+_*a+w*h,t[2]=A*n+_*l+w*p,t[3]=T*i+C*o+M*c,t[4]=T*s+C*a+M*h,t[5]=T*n+C*l+M*p,t[6]=O*i+$*o+L*c,t[7]=O*s+$*a+L*h,t[8]=O*n+$*l+L*p,t}function g9(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],A=r[0],_=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=A*i+_*o+c,t[7]=A*s+_*a+h,t[8]=A*n+_*l+p,t}function Tse(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],A=Math.sin(r),_=Math.cos(r);return t[0]=_*i+A*o,t[1]=_*s+A*a,t[2]=_*n+A*l,t[3]=_*o-A*i,t[4]=_*a-A*s,t[5]=_*l-A*n,t[6]=c,t[7]=h,t[8]=p,t}function Sse(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function cht(t,e,r){const i=r[0],s=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function uht(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function hht(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function dht(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function pht(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Ese(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,p=i*a,A=s*o,_=s*a,w=s*l,T=n*o,C=n*a,M=n*l;return t[0]=1-p-w,t[3]=h-M,t[6]=A+C,t[1]=h+M,t[4]=1-c-w,t[7]=_-T,t[2]=A-C,t[5]=_+T,t[8]=1-c-p,t}function COe(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],p=h*o-a*c,A=-h*n+a*l,_=c*n-o*l,w=r*p+i*A+s*_;if(!w)return null;const T=1/w;return t[0]=p*T,t[1]=(-h*i+s*c)*T,t[2]=(a*i-s*o)*T,t[3]=A*T,t[4]=(h*r-s*l)*T,t[5]=(-a*r+s*n)*T,t[6]=_*T,t[7]=(-c*r+i*l)*T,t[8]=(o*r-i*n)*T,t}function aM(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],A=e[10],_=e[11],w=e[12],T=e[13],C=e[14],M=e[15],O=r*a-i*o,$=r*l-s*o,L=r*c-n*o,k=i*l-s*a,F=i*c-n*a,G=s*c-n*l,z=h*T-p*w,Z=h*C-A*w,J=h*M-_*w,te=p*C-A*T,re=p*M-_*T,Ae=A*M-_*C;let ve=O*Ae-$*re+L*te+k*J-F*Z+G*z;return ve?(ve=1/ve,t[0]=(a*Ae-l*re+c*te)*ve,t[1]=(l*J-o*Ae-c*Z)*ve,t[2]=(o*re-a*J+c*z)*ve,t[3]=(s*re-i*Ae-n*te)*ve,t[4]=(r*Ae-s*J+n*Z)*ve,t[5]=(i*J-r*re-n*z)*ve,t[6]=(T*G-C*F+M*k)*ve,t[7]=(C*L-w*G-M*$)*ve,t[8]=(w*F-T*L+M*O)*ve,t):null}function fht(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function mht(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function ght(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function Aht(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function MOe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function yht(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function _ht(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function vht(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function bht(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=e[0],A=e[1],_=e[2],w=e[3],T=e[4],C=e[5],M=e[6],O=e[7],$=e[8],L=dc();return Math.abs(r-p)<=L*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(i-A)<=L*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(s-_)<=L*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(n-w)<=L*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(o-T)<=L*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(a-C)<=L*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(l-M)<=L*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(c-O)<=L*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(h-$)<=L*Math.max(1,Math.abs(h),Math.abs($))}function Cse(t){const e=dc(),r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}const wht=oM,xht=MOe;Object.freeze(Object.defineProperty({__proto__:null,add:Aht,adjoint:aht,copy:oht,determinant:lht,equals:bht,exactEquals:vht,frob:ght,fromMat2d:pht,fromMat4:hf,fromQuat:Ese,fromRotation:hht,fromScaling:dht,fromTranslation:uht,identity:xse,invert:RT,isOrthoNormal:Cse,mul:wht,multiply:oM,multiplyScalar:yht,multiplyScalarAndAdd:_ht,normalFromMat4:aM,normalFromMat4Legacy:COe,projection:fht,rotate:Tse,scale:Sse,scaleByVec2:cht,set:wse,str:mht,sub:xht,subtract:MOe,translate:g9,transpose:df},Symbol.toStringTag,{value:"Module"}));var Nu;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Nu||(Nu={}));let X6=class extends fc{constructor(){super(...arguments),this.steps=Nu.SIXTEEN,this.writeTextureChannels=iT.RG}};u([ie({count:Nu.COUNT})],X6.prototype,"steps",void 0),u([ie({constValue:Le("esri-mobile")?1024:2048})],X6.prototype,"cubeMapSize",void 0),u([ie()],X6.prototype,"writeTextureChannels",void 0);let zP=class{constructor(e,r,i,s,n,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const lfe=new zP([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Nu.SIXTEEN),ql={sunny:lfe,cloudy:new zP([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Nu.TWOHUNDRED,.6),rainy:new zP([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Nu.TWOHUNDRED,.4),snowy:new zP([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Nu.HUNDRED,.65),foggy:new zP([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Nu.SIXTEEN),default:lfe},Ip=Le("esri-mobile")?64:128,Tht=Ip/128,Kf=Math.ceil(Math.sqrt(Ip)),p0=(Ip+2)*Kf,Sht=1e5,DG=128,Eht=p0/1560;function Af(t,e=!0){t.attributes.add(B.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(I`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?I`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let _4=class extends kn{constructor(e,r){super(e,"mat3",As.Draw,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}},ROe=class extends ys{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=ql.default.raymarchingSteps,this.weatherTile=Dt()}},OOe=class extends ys{constructor(){super(...arguments),this.viewMatrix=mn()}};function Cht(t){const e=new Di;e.include(Af,!1);const r=e.fragment;return r.uniforms.add([new nt("cloudRadius",i=>i.cloudRadius),new nt("power",i=>Sr(35,120,i.absorption)),new nt("sigmaE",i=>1+i.absorption),new nt("density",i=>Sr(0,.3,i.density)),new nt("cloudSize",i=>Sr(0,.02,Math.max(.01,1-i.cloudSize))),new nt("detailSize",i=>Sr(0,.2,Math.max(.01,1-i.detailSize))),new nt("smoothness",i=>Sr(0,.5,1-i.smoothness)),new nt("cloudHeight",i=>Sr(0,1500,i.cloudHeight)),new nt("coverage",i=>i.coverage),new _4("view",i=>i.viewMatrix),new mr("cloudShapeTexture",i=>E(i.noiseTexture)?i.noiseTexture.textureAtlas:null),new Bi("cloudVariables",i=>Kr(Mht,i.coverage,i.absorption))]),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(I`
    const int STEPS = ${t.steps===Nu.SIXTEEN?I`16`:t.steps===Nu.HUNDRED?I`100`:I`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(I`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${I.float(p0)};
      const float dataWidth = ${I.float(p0)};
      const float tileRows = ${I.float(Kf)};
      const vec3 atlasDimensions = vec3(${I.float(Ip)}, ${I.float(Ip)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${I.float(Tht)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${I.float(Eht)} * p) / ${I.float(p0)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),r.code.add(I`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(I`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(I`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(I`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(I`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const Mht=Dt(),Rht=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:OOe,CloudsPassParameters:ROe,build:Cht},Symbol.toStringTag,{value:"Module"}));let POe=class IOe extends Vi{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Fi(e.rctx,IOe.shader.get().build(this.configuration),Pi)}initializePipeline(){return Rr({blending:X0(tt.CONSTANT_COLOR,tt.ONE_MINUS_CONSTANT_COLOR,kg.ADD,this.configuration.writeTextureChannels===iT.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Bs.LEQUAL},colorWrite:zr})}};POe.shader=new Ni(Rht,()=>be(()=>import("./Clouds.glsl-06e6f0a4.js"),[]));var Id;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Id||(Id={}));let UZ=class extends fc{constructor(){super(...arguments),this.mode=Id.Full}};u([ie({count:Id.COUNT})],UZ.prototype,"mode",void 0);let $Oe=class extends ys{constructor(){super(...arguments),this.weatherTile=ki(0,0)}};function Oht(t){const e=new Di;return e.include(Af,!1),e.fragment.code.add(I`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Id.Full&&e.fragment.code.add(I`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${I.float(Kf)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${I.float(8)});

      float worley0 = worley(p, ${I.float(2)} * 2.0);
      float worley1 = worley(p, ${I.float(2)} * 8.0);
      float worley2 = worley(p, ${I.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${I.float(2)});
      float worley1 = worley(p, ${I.float(2)} * 2.0);
      float worley2 = worley(p, ${I.float(2)} * 4.0);
      float worley3 = worley(p, ${I.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Bi("weatherTile",r=>r.weatherTile)),e.fragment.code.add(I`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${I.float(DG)});

      // Get global coordinates of p
      p += weatherTile * ${I.float(DG)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${I.float(Sht)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(I`void main() {`),t.mode===Id.Full&&e.fragment.code.add(I`
        float padWidth = 1.0;
        float paddedSize = ${I.float(Ip)} + 2.0 * padWidth;
        float tileCount = ${I.float(Kf)} * ${I.float(Kf)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${I.float(Ip)};
          }

          if (startPadY) {
            pixel.y += ${I.float(Ip)};
          }

          if (endPadX) {
            pixel.x -= ${I.float(Ip)};
          }

          if (endPadY) {
            pixel.y -= ${I.float(Ip)};
          }

          uv = vec2(pixel.xy / ${I.float(Ip)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${I.float(Ip)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${I.float(Kf)} * ${I.float(Kf)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${I.float(Kf)} * ${I.float(Kf)});
        p = p_;
        p.z /= (${I.float(Kf)} * ${I.float(Kf)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(I`
      vec2 mapUV = ${I.float(DG)} * (gl_FragCoord.xy / ${I.float(p0)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===Id.Full?I`gl_FragColor.ba = vec2(0.0, map);`:I`gl_FragColor = vec4(map);`};
    }
  `),e}const Pht=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:$Oe,build:Oht},Symbol.toStringTag,{value:"Module"}));let VZ=class LOe extends Vi{initializeProgram(e){return new Fi(e.rctx,LOe.shader.get().build(this.configuration),Pi)}initializePipeline(){return Rr({blending:this.configuration.mode===Id.Full?X0(tt.ONE,tt.ZERO):Aa(tt.ZERO,tt.ONE,tt.ONE,tt.ZERO),depthTest:{func:Bs.ALWAYS},colorWrite:zr})}};VZ.shader=new Ni(Pht,()=>be(()=>import("./NoiseTextureAtlas.glsl-de733298.js"),[]));let NE=class{constructor(e,r){this._context=e,this._desc=r,this.type="renderbuffer",this._context.instanceCounter.increment(fa.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==sr.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n)}else i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const e=this._desc.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}resize(e,r){const i=this._desc;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(fa.Renderbuffer,this),this._context=Px(this._context))}},Jn=class FE{constructor(e,r,i=null,s=null){if(this._context=e,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._depthStencilTexture=null,this._initialized=!1,this._desc={...r},e.instanceCounter.increment(fa.FramebufferObject,this),E(i)){Array.isArray(i)||(i=[i]);for(let n=0;n<i.length;++n){const o=i[n],a=gd.COLOR_ATTACHMENT0+n;let l;ufe(o)?(UA(o)?(l=o.descriptor,this._colorAttachments.set(a,o)):(l=o,this._colorAttachments.set(a,new Wt(this._context,l))),C5(l,this._desc)):(cfe(o)?(l=o.descriptor,this._colorAttachments.set(a,o)):(l=o,this._colorAttachments.set(a,new NE(this._context,l))),NG(l,this._desc)),this._validateColorAttachmentPoint(a)}}if(E(s)){let n,o;if(ufe(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),UA(s)?(o=s.descriptor,this._depthStencilTexture=s):(o=s,this._depthStencilTexture=new Wt(this._context,o)),C5(o,this._desc);else{cfe(s)?(o=s.descriptor,n=s):(o=s,n=new NE(this._context,o));const a=this._desc.depthStencilTarget??$i.DEPTH_STENCIL_RENDER_BUFFER;a===$i.STENCIL_RENDER_BUFFER?this._stencilAttachment=n:a===$i.DEPTH_RENDER_BUFFER||a===$i.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=n:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=a,NG(o,this._desc)}}}dispose(){if(!this._desc)return;const e=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(fa.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const e=this._colorAttachments.get(gd.COLOR_ATTACHMENT0);return e&&UA(e)?e:null}get colorAttachment(){return this._colorAttachments.get(gd.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width??0}get height(){return this._desc.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[r,i])=>e+rT(i),0)+rT(this.depthStencilAttachment)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&UA(r)?r:null}attachColorTexture(e,r=gd.COLOR_ATTACHMENT0){e&&(this._validateColorAttachmentPoint(r),C5(e.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e))}detachColorTexture(e=gd.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(UA(r)){const i=r;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),i}}setColorTextureTarget(e,r=gd.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);UA(i)&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencilTexture(e){if(N(e))return;const r=e.descriptor;r.pixelFormat!==At.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==yr.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),C5(r,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==$i.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=$i.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,Xpe)),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,Xpe)),this._depthStencilTexture=null,e}attachDepthStencilBuffer(e){if(N(e))return;const r=e.descriptor;if(r.internalFormat!==Uc.DEPTH_STENCIL&&r.internalFormat!==Uc.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),NG(r,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=r.internalFormat===Uc.DEPTH_STENCIL?$i.DEPTH_STENCIL_RENDER_BUFFER:$i.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,s=this._desc.depthStencilTarget===$i.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(Ra.FRAMEBUFFER,s,i.RENDERBUFFER,e.glName)}this._depthAttachment=e}detachDepthStencilBuffer(){const e=this._context.gl,r=this._depthAttachment;if(r&&this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===$i.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(Ra.FRAMEBUFFER,i,e.RENDERBUFFER,null)}return this._depthAttachment=null,r}detachAll(){this._colorAttachments.forEach((e,r)=>this._detachColorAttachment(r)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(e,r,i,s,n,o,a){(e<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==nr.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||(c==null?void 0:c.width)==null||(c==null?void 0:c.height)==null||e+i>l.width||r+s>l.height||n+i>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,Wt.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(Wt.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(nr.TEXTURE_2D,0,n,o,e,r,i,s),h.bindTexture(p,Wt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,s,n,o,a)}async readPixelsAsync(e,r,i,s,n,o,a){if(this._context.type!==sr.WEBGL2)return vd()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,r,i,s,n,o,a);const l=this._context.gl,c=Wi.createPixelPack(this._context,Li.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,s,n,o,0),this._context.unbindBuffer(fr.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){const i=this._desc;if(i.width!==e||i.height!==r){if(i.width=e,i.height=r,!this._initialized)return this._colorAttachments.forEach(s=>{s&&s.resize(e,r)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(e,r));this._colorAttachments.forEach(s=>{s&&s.resize(e,r)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(e,r):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(e,r),this._stencilAttachment&&this._stencilAttachment.resize(e,r)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(e=Ra.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=this._context,s=r.createFramebuffer(),n=this._desc,o=n.colorTarget??En.RENDER_BUFFER,a=n.width??1,l=n.height??1;if(r.bindFramebuffer(e,s),this._colorAttachments.size===0)if(o===En.TEXTURE||o===En.CUBEMAP)this._colorAttachments.set(gd.COLOR_ATTACHMENT0,Iht(i,n,this.descriptor.colorTarget===En.CUBEMAP?nr.TEXTURE_CUBE_MAP:nr.TEXTURE_2D));else{const h=new NE(i,{internalFormat:cr.RGBA4,width:a,height:l});this._colorAttachments.set(gd.COLOR_ATTACHMENT0,h)}this._colorAttachments.forEach((h,p)=>{h&&(UA(h)?this._framebufferTexture2D(h.glName,p,hfe(h),e):r.framebufferRenderbuffer(e,p,r.RENDERBUFFER,h.glName))});const c=n.depthStencilTarget??$i.NONE;switch(c){case $i.DEPTH_RENDER_BUFFER:case $i.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new NE(i,{internalFormat:n.depthStencilTarget===$i.DEPTH_RENDER_BUFFER?Uc.DEPTH_COMPONENT16:Uc.DEPTH_STENCIL,width:a,height:l}));const h=c===$i.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(e,h,r.RENDERBUFFER,this._depthAttachment.glName);break}case $i.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new NE(i,{internalFormat:Uc.STENCIL_INDEX8,width:a,height:l})),r.framebufferRenderbuffer(e,r.STENCIL_ATTACHMENT,r.RENDERBUFFER,this._stencilAttachment.glName);break;case $i.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){i.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const h={target:nr.TEXTURE_2D,pixelFormat:At.DEPTH_STENCIL,dataType:yr.UNSIGNED_INT_24_8,samplingMode:Bt.NEAREST,wrapMode:pr.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new Wt(i,h)}this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,hfe(this._depthStencilTexture),e)}vd()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(e,r=gd.COLOR_ATTACHMENT0,i=nr.TEXTURE_2D,s=Ra.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,e,n)}_detachColorAttachment(e){vd()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const r=this._context.gl,i=this._colorAttachments.get(e);return UA(i)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)):this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(Ra.FRAMEBUFFER,e,r.RENDERBUFFER,null)),this._colorAttachments.delete(e),i}_disposeColorAttachments(){this._colorAttachments.forEach((e,r)=>{this._detachColorAttachment(r),e.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===$i.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(Ra.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(Ra.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(e){if(FE._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const s=this._context.gl;FE._MAX_COLOR_ATTACHMENTS=s.getParameter(i.MAX_COLOR_ATTACHMENTS)}else FE._MAX_COLOR_ATTACHMENTS=1}const r=e-gd.COLOR_ATTACHMENT0;r+1>FE._MAX_COLOR_ATTACHMENTS&&we.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${FE._MAX_COLOR_ATTACHMENTS} color attachments`)}};function UA(t){return t!=null&&"type"in t&&t.type==="texture"}function cfe(t){return t!=null&&"type"in t&&t.type==="renderbuffer"}function ufe(t){return UA(t)||t!=null&&"pixelFormat"in t}function Iht(t,e,r){return new Wt(t,{target:r,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.NEAREST,wrapMode:pr.CLAMP_TO_EDGE,width:e.width,height:e.height})}function C5(t,e){t.target!==nr.TEXTURE_2D&&t.target!==nr.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Color attachment texture must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}function NG(t,e){e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}function hfe(t){return t.descriptor.target===nr.TEXTURE_CUBE_MAP?nr.TEXTURE_CUBE_MAP_POSITIVE_X:nr.TEXTURE_2D}Jn._MAX_COLOR_ATTACHMENTS=-1;let GP=class extends Ke{constructor(e){super(e),this._needsRender=!0,this._passParameters=new $Oe,this._frameBuffer=new Jn(e.context.renderContext.rctx,{colorTarget:En.TEXTURE,width:p0,height:p0},{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:Bt.LINEAR,hasMipmap:!1,width:p0,height:p0}),this._vao=mc(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return E(this._texture)?E(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Id.WeatherMap)):E(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(Id.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(ga(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=en(this._fullTechniqueCached),this._weatherMapTechniqueCached=en(this._weatherMapTechniqueCached),this._frameBuffer=Nt(this._frameBuffer),this._vao=Nt(this._vao)}get _fullTechnique(){if(N(this._fullTechniqueCached)){const e=new UZ;e.mode=Id.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(VZ,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(N(this._weatherMapTechniqueCached)){const e=new UZ;e.mode=Id.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(VZ,e)}return this._weatherMapTechniqueCached}_render(e){if(N(this._vao)||N(this._frameBuffer))return null;const r=e===Id.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,s=i.getViewport();i.setViewport(0,0,p0,p0),i.bindFramebuffer(this._frameBuffer);const n=i.bindTechnique(r,this._passParameters,null);return i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([d({constructOnly:!0})],GP.prototype,"context",void 0),u([d({readOnly:!0})],GP.prototype,"_techniqueRepository",null),GP=u([j("esri.views.3d.environment.NoiseTextureAtlas")],GP);function DOe(t){t.include(Wd),t.uniforms.add([new mr("geometryDepthTexture",(e,r)=>r.multipassGeometry.linearDepthTexture),new Bi("nearFar",(e,r)=>r.camera.nearFar)]),t.code.add(I`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let $ht=class{constructor(){this.enabled=!1}};function Yd(t,e){e.hasMultipassTerrain&&(t.fragment.include(Wd),t.fragment.uniforms.add(new mr("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new Bi("nearFar",(r,i)=>i.camera.nearFar)),t.fragment.uniforms.add(new Bi("inverseViewport",(r,i)=>i.inverseViewport)),t.fragment.code.add(I`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let Lht=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function Dht(t,e){const r=t.fragment;r.include(Wd),r.uniforms.add(new Bi("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new mr("depthMap",(i,s)=>s.linearDepthTexture)),r.uniforms.add(new nn("proj",(i,s)=>s.ssr.camera.projectionMatrix)),r.uniforms.add(new nt("invResolutionHeight",(i,s)=>1/s.ssr.camera.height)),r.uniforms.add(new nn("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),r.code.add(I`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let Nht=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=ot()}};function e7(t){return t?{ray:Na(t.ray),c0:t.c0,c1:t.c1}:{ray:Na(),c0:0,c1:Number.MAX_VALUE}}function Fht(t,e=e7()){return kk(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function kht(t,e,r=e7()){const i=st(t.vector);return fSe(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function bBt(t,e){return NOe(t,t.c0,e)}function wBt(t,e){return NOe(t,t.c1,e)}function NOe(t,e,r){return ke(r,t.ray.origin,Me(r,t.ray.direction,e))}new Xy(()=>e7());function v4(t){return t?[Hi(t[0]),Hi(t[1]),Hi(t[2]),Hi(t[3]),Hi(t[4]),Hi(t[5])]:[Hi(),Hi(),Hi(),Hi(),Hi(),Hi()]}function FOe(){return[V(),V(),V(),V(),V(),V(),V(),V()]}function A9(t,e){for(let r=0;r<ab.NUM;r++)wU(t[r],e[r])}function kOe(t,e,r,i=Ght){const s=$n(Ure.get(),e,t);ul(s,s);for(let n=0;n<zZ.NUM;++n){const o=Ld(Bre.get(),zht[n],s);$e(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}BOe(r,i)}function BOe(t,e){Xl(e[zt.FAR_BOTTOM_LEFT],e[zt.NEAR_BOTTOM_LEFT],e[zt.NEAR_TOP_LEFT],t[Ms.LEFT]),Xl(e[zt.NEAR_BOTTOM_RIGHT],e[zt.FAR_BOTTOM_RIGHT],e[zt.FAR_TOP_RIGHT],t[Ms.RIGHT]),Xl(e[zt.FAR_BOTTOM_LEFT],e[zt.FAR_BOTTOM_RIGHT],e[zt.NEAR_BOTTOM_RIGHT],t[Ms.BOTTOM]),Xl(e[zt.NEAR_TOP_LEFT],e[zt.NEAR_TOP_RIGHT],e[zt.FAR_TOP_RIGHT],t[Ms.TOP]),Xl(e[zt.NEAR_BOTTOM_LEFT],e[zt.NEAR_BOTTOM_RIGHT],e[zt.NEAR_TOP_RIGHT],t[Ms.NEAR]),Xl(e[zt.FAR_BOTTOM_RIGHT],e[zt.FAR_BOTTOM_LEFT],e[zt.FAR_TOP_LEFT],t[Ms.FAR])}function xv(t,e){for(let r=0;r<ab.NUM;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function Bht(t,e){return VOe(t,Fht(e,zOe.get()))}function xBt(t,e){for(let r=0;r<ab.NUM;r++){const i=t[r];if(!UWe(i,e))return!1}return!0}function Uht(t,e,r){return VOe(t,kht(e,r,zOe.get()))}function UOe(t,e){for(let r=0;r<ab.NUM;r++)if(Rs(t[r],e)>0)return!1;return!0}function VOe(t,e){for(let r=0;r<ab.NUM;r++)if(!BWe(t[r],e))return!1;return!0}var Ms,zt;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(Ms||(Ms={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(zt||(zt={}));const Vht={bottom:[zt.FAR_BOTTOM_RIGHT,zt.NEAR_BOTTOM_RIGHT,zt.NEAR_BOTTOM_LEFT,zt.FAR_BOTTOM_LEFT],near:[zt.NEAR_BOTTOM_LEFT,zt.NEAR_BOTTOM_RIGHT,zt.NEAR_TOP_RIGHT,zt.NEAR_TOP_LEFT],far:[zt.FAR_BOTTOM_RIGHT,zt.FAR_BOTTOM_LEFT,zt.FAR_TOP_LEFT,zt.FAR_TOP_RIGHT],right:[zt.NEAR_BOTTOM_RIGHT,zt.FAR_BOTTOM_RIGHT,zt.FAR_TOP_RIGHT,zt.NEAR_TOP_RIGHT],left:[zt.FAR_BOTTOM_LEFT,zt.NEAR_BOTTOM_LEFT,zt.NEAR_TOP_LEFT,zt.FAR_TOP_LEFT],top:[zt.FAR_TOP_LEFT,zt.NEAR_TOP_LEFT,zt.NEAR_TOP_RIGHT,zt.FAR_TOP_RIGHT]};var ab,zZ;(function(t){t[t.NUM=6]="NUM"})(ab||(ab={})),function(t){t[t.NUM=8]="NUM"}(zZ||(zZ={}));const zht=[Nr(-1,-1,-1,1),Nr(1,-1,-1,1),Nr(1,1,-1,1),Nr(-1,1,-1,1),Nr(-1,-1,1,1),Nr(1,-1,1,1),Nr(1,1,1,1),Nr(-1,1,1,1)],zOe=new Xy(e7),Ght=FOe();function jht(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function Hht(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function qht(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function Wht(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var GZ;let hr=GZ=class extends Ke{constructor(t={}){super(t),this._center=V(),this._up=V(),this._viewUp=V(),this._viewForward=V(),this._viewRight=V(),this._ray=Na(),this._viewport=Nr(0,0,1,1),this._padding=Nr(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=ki(1,1e3),this._viewDirty=!0,this._viewMatrix=ot(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=ot(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=ot(),this._frustumDirty=!0,this._frustum=v4(),this._fullViewport=Zr(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return Be(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){ma(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=MM(Zr(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&Yte(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[ii.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[ii.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[ii.RIGHT]+this._padding[ii.LEFT]}set fullWidth(t){this.width=t-(this._padding[ii.RIGHT]+this._padding[ii.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[ii.TOP]+this._padding[ii.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[ii.TOP]+this._padding[ii.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[ii.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[ii.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){HC(this._padding,t)||(this._viewport[0]+=t[ii.LEFT]-this._padding[ii.LEFT],this._viewport[1]+=t[ii.BOTTOM]-this._padding[ii.BOTTOM],this._viewport[2]-=t[ii.RIGHT]+t[ii.LEFT]-(this._padding[ii.RIGHT]+this._padding[ii.LEFT]),this._viewport[3]-=t[ii.TOP]+t[ii.BOTTOM]-(this._padding[ii.TOP]+this._padding[ii.BOTTOM]),A0(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&($n(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,s=gTe(ot(),-i*(1+2*this._padding[ii.LEFT]/t),i*(1+2*this._padding[ii.RIGHT]/t),-r*(1+2*this._padding[ii.BOTTOM]/e),r*(1+2*this._padding[ii.TOP]/e),this.near,this.far),n=this._get("projectionMatrix");return n&&Mre(n,s)?n:s}get inverseProjectionMatrix(){return ul(ot(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||ot()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return qht(this._fov,this.width,this.height)}set fovX(t){this._fov=jht(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Wht(this._fov,this.width,this.height)}set fovY(t){this._fov=Hht(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Is(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(ul(this._viewInverseTransposeMatrix,this.viewMatrix),zh(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){Oe(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,A0(this._viewport,t.viewport),this.notifyChange("_viewport"),A0(this._padding,t.padding),this.notifyChange("_padding"),ga(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(ma(this._viewMatrix,t.viewMatrix),Oe(this._viewRight,t.viewRight),Oe(this._viewUp,t.viewUp),Oe(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(A9(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(ma(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),A0(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new GZ().copyFrom(this)}equals(t){return Hc(this.eye,t.eye)&&Hc(this.center,t.center)&&Hc(this.up,t.up)&&HC(this._viewport,t.viewport)&&HC(this._padding,t.padding)&&YRe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||Ek(t.padding,this._padding)>=.5||Ek(this.screenViewport,t.screenViewport)>=.5)return!1;Da(Ul,t.eye,t.center),Da(FG,this.eye,this.center);const e=He(Ul,FG),r=NW(Ul),i=NW(FG),s=5e-4;return e*e>=(1-1e-10)*r*i&&jte(t.eye,this.eye)<Math.max(r,i)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(LI(this.viewForward,Be(Ul,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Sn()){return t[0]=(this.padding[ii.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[ii.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[ii.LEFT]+this.width*e,t[1]=this.padding[ii.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==ri&&Oe(ri,t),ri[3]=1,Ld(ri,ri,this.projectionMatrix);const r=Math.abs(ri[3]);Me(ri,ri,1/r);const i=this.fullViewport;e[0]=Sr(0,i[0]+i[2],.5+.5*ri[0]),e[1]=Sr(0,i[1]+i[3],.5+.5*ri[1]),e[2]=.5*(ri[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;ri[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],ri[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],ri[2]=(2*t[2]-1)*t[3],ri[3]=t[3],this.inverseProjectionMatrix!=null&&(Ld(ri,ri,this.inverseProjectionMatrix),e[0]=ri[0],e[1]=ri[1],e[2]=ri[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,kG),this.renderToScreen(kG,e),e}projectToRenderScreen(t,e){if(ri[0]=t[0],ri[1]=t[1],ri[2]=t[2],ri[3]=1,Ld(ri,ri,this.viewProjectionMatrix),ri[3]===0)return null;Me(ri,ri,1/Math.abs(ri[3]));const r=this.fullViewport;return"x"in e?(e.x=Sr(0,r[0]+r[2],.5+.5*ri[0]),e.y=Sr(0,r[1]+r[3],.5+.5*ri[1])):(e[0]=Sr(0,r[0]+r[2],.5+.5*ri[0]),e[1]=Sr(0,r[1]+r[3],.5+.5*ri[1]),e.length>2&&(e[2]=.5*(ri[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,kG),e)}unprojectFromRenderScreen(t,e){if($n(M5,this.projectionMatrix,this.viewMatrix),!ul(M5,M5))return null;const r=this.fullViewport;return ri[0]=2*(t[0]-r[0])/r[2]-1,ri[1]=2*(t[1]-r[1])/r[3]-1,ri[2]=2*t[2]-1,ri[3]=1,Ld(ri,ri,M5),ri[3]===0?null:(e[0]=ri[0]/ri[3],e[1]=ri[1]/ri[3],e[2]=ri[2]/ri[3],e)}constrainWindowSize(t,e,r,i){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-r/2,0),a=Math.max(this.fullHeight-n-i/2,0),l=-Math.min(s-r/2,0),c=-Math.min(this.fullHeight-n-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-s-r/2,0),i-c- -Math.min(n-i/2,0)]}computeUp(t){t===_t.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){Be(Ul,this.center,this.eye);const t=st(this.center);t<1?($e(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(He(Ul,this.center))>.9999*st(Ul)*t||(Xt(this._up,Ul,this.center),Xt(this._up,this._up,Ul),qe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Yy(Ul,this.eye,this.center),Math.abs(Ul[2])<=.9999&&(Me(Ul,Ul,Ul[2]),$e(this._up,-Ul[0],-Ul[1],1-Ul[2]),qe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Hc(t,e)||(Oe(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):we.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(kOe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(mU(this._viewMatrix,this.eye,this.center,this.up),$e(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),$e(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),$e(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([d()],hr.prototype,"_center",void 0),u([d()],hr.prototype,"_up",void 0),u([d()],hr.prototype,"_viewport",void 0),u([d()],hr.prototype,"_padding",void 0),u([d()],hr.prototype,"_fov",void 0),u([d()],hr.prototype,"_nearFar",void 0),u([d()],hr.prototype,"_pixelRatio",void 0),u([d()],hr.prototype,"pixelRatio",null),u([d()],hr.prototype,"eye",null),u([d()],hr.prototype,"center",null),u([d()],hr.prototype,"up",null),u([d({readOnly:!0})],hr.prototype,"nearFar",null),u([d()],hr.prototype,"near",null),u([d()],hr.prototype,"far",null),u([d()],hr.prototype,"viewport",null),u([d({readOnly:!0})],hr.prototype,"screenViewport",null),u([d()],hr.prototype,"x",null),u([d()],hr.prototype,"y",null),u([d()],hr.prototype,"width",null),u([d()],hr.prototype,"height",null),u([d()],hr.prototype,"fullWidth",null),u([d()],hr.prototype,"fullHeight",null),u([d({readOnly:!0})],hr.prototype,"_aspect",null),u([d()],hr.prototype,"padding",null),u([d({readOnly:!0})],hr.prototype,"projectionMatrix",null),u([d({readOnly:!0})],hr.prototype,"inverseProjectionMatrix",null),u([d()],hr.prototype,"fov",null),u([d()],hr.prototype,"fovX",null),u([d()],hr.prototype,"fovY",null),hr=GZ=u([j("esri.views.3d.webgl-engine.lib.Camera")],hr);const ri=Zr(),M5=ot(),Ul=V(),FG=V(),kG=Rl();var ii;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(ii||(ii={}));var et;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(et||(et={}));var lr;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(lr||(lr={}));let Mse=class{constructor(e=V()){this.intensity=e}},GOe=class{constructor(e=V(),r=ct(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},y9=class{constructor(e=V(),r=ct(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}},jOe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function Yht(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function BG(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function t3(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function HOe(t){return(t+1)*(t+1)}function Qht(t){return ze(Math.floor(Math.sqrt(t)-1),0,2)}function qOe(t,e,r){const i=t[0],s=t[1],n=t[2],o=r||[];return o.length=HOe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function Xht(t,e){const r=HOe(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function Zht(t,e){const r=Qht(e.r.length);for(const i of t)nc(jZ,i.direction),qOe(jZ,r,oy),Yht(oy,Z6),BG(oy,i.intensity[0],XT),t3(e.r,XT),BG(oy,i.intensity[1],XT),t3(e.g,XT),BG(oy,i.intensity[2],XT),t3(e.b,XT);return e}function Jht(t,e){qOe(jZ,0,oy);for(const r of t)e.r[0]+=oy[0]*Z6[0]*r.intensity[0]*4*Math.PI,e.g[0]+=oy[0]*Z6[0]*r.intensity[1]*4*Math.PI,e.b[0]+=oy[0]*Z6[0]*r.intensity[2]*4*Math.PI;return e}function Kht(t,e,r,i){Xht(e,i),$e(r.intensity,0,0,0);let s=!1;const n=edt,o=tdt,a=rdt;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof y9&&!s?(Oe(r.direction,l.direction),Oe(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof y9||l instanceof GOe?n.push(l):l instanceof Mse?o.push(l):l instanceof jOe&&a.push(l);Zht(n,i),Jht(o,i);for(const l of a)t3(i.r,l.r),t3(i.g,l.g),t3(i.b,l.b)}const edt=[],tdt=[],rdt=[],oy=[0],XT=[0],jZ=V(),Z6=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let dfe=class{constructor(){this.color=V(),this.intensity=1}},idt=class{constructor(){this.direction=V(),this.ambient=new dfe,this.diffuse=new dfe}};const WOe=.4;let UG=class{constructor(){this._shOrder=2,this._legacy=new idt,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new jOe,this._mainLight=new y9(V(),ct(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){Kht(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Oe(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,Me(this._legacy.diffuse.color,this._mainLight.intensity,r),Oe(R5,this._legacy.diffuse.color),Me(R5,R5,WOe*this.globalFactor),ke(this._legacy.ambient.color,this._legacy.ambient.color,R5)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),this._mainLight.direction=In(e.mainLight.direction),this._mainLight.intensity=In(e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(fo(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=Sr(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=Sr(e.mainLight.specularStrength,r.mainLight.specularStrength,i),Oe(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=Sr(e.globalFactor,r.globalFactor,i),this.noonFactor=Sr(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=Sr(e.sh.r[s],r.sh.r[s],i),this._sphericalHarmonics.g[s]=Sr(e.sh.g[s],r.sh.g[s],i),this._sphericalHarmonics.b[s]=Sr(e.sh.b[s],r.sh.b[s],i);else for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=r.sh.r[s],this._sphericalHarmonics.g[s]=r.sh.g[s],this._sphericalHarmonics.b[s]=r.sh.b[s]}};const R5=V();let t7=class{constructor(e,r,i){this.shadowMap=e,this.ssaoHelper=r,this.slicePlane=i,this.slot=et.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=lr.NONE,this._camera=new hr,this._inverseViewport=Dt(),this.oldLighting=new UG,this.newLighting=new UG,this._fadedLighting=new UG,this._lighting=this.newLighting,this.ssr=new Nht,this.multipassTerrain=new Lht,this.multipassGeometry=new $ht,this.overlays=[],this.cloudsFade=new eht}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},vu=class extends Ke{constructor(e){super(e),this._handles=new ts,this._techniques=new Array,this._techniqueConfiguration=new X6,this._bindParameters=new t7(null,null,null),this._passParameters=new ROe,this._drawParameters=new OOe,this._weatherTile=Dt(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Sr(ql.default.coverage[0],ql.default.coverage[1],.5),this.density=Sr(ql.default.density[0],ql.default.density[1],.5),this.absorption=Sr(ql.default.absorption[0],ql.default.absorption[1],.5),this.cloudSize=Sr(ql.default.cloudSize[0],ql.default.cloudSize[1],.5),this.detailSize=Sr(ql.default.detailSize[0],ql.default.detailSize[1],.5),this.smoothness=Sr(ql.default.smoothness[0],ql.default.smoothness[1],.5),this.cloudHeight=Sr(ql.default.cloudHeight[0],ql.default.cloudHeight[1],.5),this.raymarchingSteps=ql.default.raymarchingSteps,this._viewMatrix=ot(),this._dirty=!1,this.running=!1}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===iT.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new POe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;Kr(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let s=0,n=0;if(E(this.view.environment)&&this.view.environment.lighting.type!=="virtual"&&E(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),QRe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){this._vao=mc(this.context.renderContext.rctx);const e=es(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(ir.CLOUDS_GENERATOR,this),xe(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Cr)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>en(e)),this._frameBufferCube=Nt(this._frameBufferCube),this._techniques.length=0,this._vao=Nt(this._vao),this._passParameters.noiseTexture=gt(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Nu.SIXTEEN:return 1;case Nu.HUNDRED:return 4;case Nu.COUNT:case Nu.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(E(this._passParameters.noiseTexture))this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new GP({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return E(this._passParameters.noiseTexture.textureAtlas)}_ensureFrameBufferCube(e){if(N(this._frameBufferCube)){const r={target:nr.TEXTURE_CUBE_MAP,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:Bt.LINEAR,hasMipmap:!1,width:e,height:e};this._frameBufferCube=new Jn(this.context.renderContext.rctx,{colorTarget:En.CUBEMAP,width:e,height:e},r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=Nt(this._frameBufferCube)}applyPreset(e,r){const i=e.median,s=n=>{const o=Sr(n[0],n[1],i);return r<.5?Sr(n[0],o,2*r):Sr(o,n[1],2*(r-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){if(N(this._vao))return this._dirty=this.running=!1,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Yn.FINISHED_RENDERING,void e.madeProgress();this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),ga(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return Dl.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Yn.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,s=i.bindTechnique(r,this._passParameters,this._bindParameters);i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const n=i.getViewport(),o=r.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;i.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);i.bindFramebuffer(c);const h=sdt[this._faceIndex],p=ndt[this._faceIndex];yTe(this._viewMatrix,odt,h,p),hf(this._drawParameters.viewMatrix,this._viewMatrix);const A=nr.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(A),s.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(n.x,n.y,n.width,n.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Yn.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Dl.YIELD}};u([d({constructOnly:!0})],vu.prototype,"context",void 0),u([d({constructOnly:!0})],vu.prototype,"view",void 0),u([d({constructOnly:!0})],vu.prototype,"requestRender",void 0),u([d()],vu.prototype,"coverage",void 0),u([d()],vu.prototype,"density",void 0),u([d()],vu.prototype,"absorption",void 0),u([d()],vu.prototype,"cloudSize",void 0),u([d()],vu.prototype,"detailSize",void 0),u([d()],vu.prototype,"smoothness",void 0),u([d()],vu.prototype,"cloudHeight",void 0),u([d()],vu.prototype,"raymarchingSteps",void 0),u([d()],vu.prototype,"running",void 0),vu=u([j("esri.views.3d.environment.CloudsGenerator")],vu);const sdt=[Ji(1,0,0),Ji(-1,0,0),Ji(0,1,0),Ji(0,-1,0),Ji(0,0,1)],ndt=[Ji(0,1,0),Ji(0,1,0),Ji(0,0,-1),Ji(0,0,1),Ji(0,1,0)],odt=gse();let Rse=class extends ys{constructor(){super(...arguments),this.fogColor=V(),this.hazeColor=V(),this.fogStrength=4e-6,this.hazeStrength=4e-6,this.atmosphereC=1,this.fogAmount=0,this.hazeAmount=0}};function adt(t){const e=new Di;e.attributes.add(B.POSITION,"vec2"),e.include(Sg,{textureCoordinateType:co.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add([new nn("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new nn("inverseViewMatrix",(s,n)=>FM(ldt,n.camera.viewMatrix))]),r.code.add(I`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new nt("atmosphereC",s=>s.atmosphereC)),i.uniforms.add(new Fr("cameraPosition",(s,n)=>n.camera.eye)),i.uniforms.add(new Bi("nearFar",(s,n)=>n.camera.nearFar)),i.uniforms.add(new mr("depthTex",s=>s.depthTexture)),i.uniforms.add(new nt("fogStrength",s=>t.haze?s.hazeStrength:s.fogStrength)),i.uniforms.add(new nt("fogAmount",s=>t.haze?s.hazeAmount:s.fogAmount)),i.uniforms.add(new Fr("fogColor",s=>t.haze?s.hazeColor:s.fogColor)),e.include(ZU),i.include(Wd),i.code.add(I`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(I`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(I`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${t.haze?I`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),e}const ldt=ot(),YOe=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:Rse,build:adt},Symbol.toStringTag,{value:"Module"}));let QOe=class XOe extends Vi{initializeProgram(e){return new Fi(e.rctx,XOe.shader.get().build(this.configuration),Pi)}initializePipeline(){return this.configuration.haze?Rr({blending:Aa(tt.ONE,tt.ZERO,tt.ONE_MINUS_SRC_COLOR,tt.ONE),colorWrite:zr}):Rr({blending:Aa(tt.SRC_ALPHA,tt.ZERO,tt.ONE_MINUS_SRC_ALPHA,tt.ONE),colorWrite:zr})}};QOe.shader=new Ni(YOe,()=>be(()=>import("./FogHaze.glsl-91a13a0c.js"),[]));let Ose=class extends fc{constructor(){super(...arguments),this.haze=!1}};u([ie()],Ose.prototype,"haze",void 0);const cdt=.95,udt=1;let jP=class extends Ke{constructor(e){super(e),this._passParameters=new Rse;const r=e.context.renderContext.rctx;this._vao=mc(r,QM),this._technique=e.context.techniqueRepository.acquire(QOe,new Ose);const i=es(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+A4}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(n,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Ar.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;qe(pfe,i.eye);const s=Math.max(0,He(pfe,e.bindParameters.lighting.mainLight.direction)),n=r.color;Me(ffe,n,.1),fo(this._passParameters.fogColor,ffe,n,s);const o=st(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-L3(cdt*Pp,udt*Pp,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],jP.prototype,"context",void 0),u([d({constructOnly:!0})],jP.prototype,"view",void 0),jP=u([j("esri.views.3d.environment.Fog")],jP);let hdt=class{constructor(){this.color=V(),this.strength=0,this.amount=0}};const pfe=V(),ffe=V();let $a=class extends fc{constructor(){super(...arguments),this.hasWebGL2Context=!1}};u([ie({constValue:!0})],$a.prototype,"hasSliceHighlight",void 0),u([ie({constValue:!1})],$a.prototype,"hasSliceInVertexProgram",void 0),u([ie({constValue:!1})],$a.prototype,"instancedDoublePrecision",void 0),u([ie({constValue:!1})],$a.prototype,"useLegacyTerrainShading",void 0),u([ie({constValue:!1})],$a.prototype,"hasModelTransformation",void 0),u([ie({constValue:As.Pass})],$a.prototype,"pbrTextureBindType",void 0),u([ie()],$a.prototype,"hasWebGL2Context",void 0);var Bg;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Bg||(Bg={}));let Pse=class extends $a{constructor(){super(...arguments),this.geometry=Bg.Cone}};u([ie({count:Bg.COUNT})],Pse.prototype,"geometry",void 0);var ee;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(ee||(ee={}));function kL(t){t.attributes.add(B.POSITION,"vec3"),t.vertex.code.add(I`vec3 positionModel() { return position; }`)}function _9({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(I`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(I`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let Xg=class extends kn{constructor(e,r){super(e,"mat3",As.Pass,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}};function r3(t,e){t.include(kL);const r=t.vertex;r.include(_9,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add([new Fr("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new Fr("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Xg("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new nn("transformProjFromView",i=>i.transformProjFromView),new _4("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Vd("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Vd("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)]),r.code.add(I`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(I`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?I`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:I`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Fr("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(I`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(I`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let ZOe=class extends ys{constructor(){super(...arguments),this.transformWorldFromViewTH=V(),this.transformWorldFromViewTL=V(),this.transformViewFromCameraRelativeRS=mn(),this.transformProjFromView=ot()}},JOe=class extends ys{constructor(){super(...arguments),this.transformWorldFromModelRS=mn(),this.transformWorldFromModelTH=Ks(),this.transformWorldFromModelTL=Ks()}};function lb(t){t.varyings.add("linearDepth","float")}function sT(t){t.vertex.uniforms.add(new Bi("nearFar",(e,r)=>r.camera.nearFar))}function r7(t){t.vertex.code.add(I`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function XM(t,e){const{vertex:r}=t;switch(e.output){case ee.Color:if(e.receiveShadows)return lb(t),void r.code.add(I`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case ee.Depth:case ee.Shadow:case ee.ShadowHighlight:case ee.ShadowExcludeHighlight:return t.include(r3,e),lb(t),sT(t),r7(t),void r.code.add(I`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(I`void forwardLinearDepth() {}`)}function Fu(t,e){if(r7(t),e.hasModelTransformation)return t.vertex.code.add(I`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),void t.vertex.code.add(I`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.vertex.code.add(I`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(I`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let Ise=class extends ys{constructor(){super(...arguments),this.texV=Dt(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new KOe}},KOe=class{constructor(){this.center=V(),this.v1=V(),this.v2=V()}};function ddt(t){const e=new Di,{vertex:r,fragment:i}=e;if(Ky(r),t.geometry===Bg.Underground)e.attributes.add(B.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add([new Fr("cameraPosition",(s,n)=>n.camera.eye),new nt("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)]),r.code.add(I`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(I`void main() {
gl_FragColor = color;
}`);else{e.include(Fu,t),e.attributes.add(B.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===Bg.Cylinder;r.uniforms.add([new nn("proj",(a,l)=>l.camera.projectionMatrix),new nn("view",(a,l)=>l.camera.viewMatrix)]),s||(e.varyings.add("innerFactor","float"),r.uniforms.add(new Fr("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new Fr("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new Fr("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new Bi("texV",a=>a.texV)),r.uniforms.add(new nt("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;r.code.add(I`
		void main(void) {
      ${s?I`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:I`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${I.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${I.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new mr("tex",a=>a.texture)),s||i.uniforms.add(new nt("altitudeFade",a=>a.altitudeFade)),i.code.add(I`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?I`gl_FragColor = atmosphereColor;`:I`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const pdt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:KOe,SimpleAtmospherePassParameters:Ise,build:ddt},Symbol.toStringTag,{value:"Module"}));let v9=class ePe extends Vi{initializeProgram(e){return new Fi(e.rctx,ePe.shader.get().build(this.configuration),Pi)}initializePipeline(){return this.configuration.geometry===Bg.Cylinder?Rr({blending:Aa(tt.SRC_ALPHA,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),culling:dse,depthTest:{func:Bs.LEQUAL},colorWrite:zr}):Rr({blending:Aa(tt.SRC_ALPHA,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),depthTest:{func:Bs.LEQUAL},colorWrite:zr})}};v9.shader=new Ni(pdt,()=>be(()=>import("./SimpleAtmosphere.glsl-e8c4b879.js"),[]));const tPe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Wh(t,e=0){const r=t.stride;return t.fieldNames.filter(i=>{const s=t.fields.get(i).optional;return!(s&&s.glPadding)}).map(i=>{const s=t.fields.get(i),n=s.constructor.ElementCount,o=fdt(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new hl(i,n,o,a,r,l,e)})}function fdt(t){const e=mdt[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const mdt={u8:qt.UNSIGNED_BYTE,u16:qt.UNSIGNED_SHORT,u32:qt.UNSIGNED_INT,i8:qt.BYTE,i16:qt.SHORT,i32:qt.INT,f32:qt.FLOAT};let $se=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};$se.ElementCount=9;let Lse=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};Lse.ElementCount=16;let r_=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};r_.ElementCount=1;let i_=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,Kr(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};i_.ElementCount=2;let s_=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,$e(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=s}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};s_.ElementCount=3;let n_=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,ns(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};n_.ElementCount=4;let Dse=class rPe extends r_{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}static fromTypedArray(e,r){return new rPe(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Dse.ElementType="f32";let o_=class HZ extends i_{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(HZ,e,r)}static fromTypedArray(e,r){return new HZ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};o_.ElementType="f32";let ks=class qZ extends s_{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(qZ,e,r)}static fromTypedArray(e,r){return new qZ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ks.ElementType="f32";let Gh=class WZ extends n_{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(WZ,e,r)}static fromTypedArray(e,r){return new WZ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Gh.ElementType="f32";let cb=class YZ extends $se{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(YZ,e,r)}static fromTypedArray(e,r){return new YZ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};cb.ElementType="f32";let Nse=class QZ extends $se{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(QZ,e,r)}static fromTypedArray(e,r){return new QZ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Nse.ElementType="f64";let Fse=class XZ extends Lse{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(XZ,e,r)}static fromTypedArray(e,r){return new XZ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Fse.ElementType="f32";let b4=class ZZ extends Lse{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(ZZ,e,r)}static fromTypedArray(e,r){return new ZZ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};b4.ElementType="f64";let kse=class JZ extends r_{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(JZ,e,r)}static fromTypedArray(e,r){return new JZ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};kse.ElementType="f64";let Bse=class KZ extends i_{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(KZ,e,r)}static fromTypedArray(e,r){return new KZ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Bse.ElementType="f64";let cc=class eJ extends s_{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(eJ,e,r)}static fromTypedArray(e,r){return new eJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};cc.ElementType="f64";let i7=class tJ extends n_{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(tJ,e,r)}static fromTypedArray(e,r){return new tJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};i7.ElementType="f64";let lM=class rJ extends r_{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(rJ,e,r)}static fromTypedArray(e,r){return new rJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};lM.ElementType="u8";let s7=class iJ extends i_{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(iJ,e,r)}static fromTypedArray(e,r){return new iJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};s7.ElementType="u8";let w4=class sJ extends s_{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(sJ,e,r)}static fromTypedArray(e,r){return new sJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};w4.ElementType="u8";let uc=class nJ extends n_{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(nJ,e,r)}static fromTypedArray(e,r){return new nJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};uc.ElementType="u8";let n7=class oJ extends r_{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(oJ,e,r)}static fromTypedArray(e,r){return new oJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};n7.ElementType="u16";let Use=class aJ extends i_{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(aJ,e,r)}static fromTypedArray(e,r){return new aJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Use.ElementType="u16";let o7=class lJ extends s_{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(lJ,e,r)}static fromTypedArray(e,r){return new lJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};o7.ElementType="u16";let BL=class cJ extends n_{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(cJ,e,r)}static fromTypedArray(e,r){return new cJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};BL.ElementType="u16";let a7=class uJ extends r_{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(uJ,e,r)}static fromTypedArray(e,r){return new uJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};a7.ElementType="u32";let Vse=class hJ extends i_{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(hJ,e,r)}static fromTypedArray(e,r){return new hJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Vse.ElementType="u32";let iPe=class dJ extends s_{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(dJ,e,r)}static fromTypedArray(e,r){return new dJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};iPe.ElementType="u32";let sPe=class pJ extends n_{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(pJ,e,r)}static fromTypedArray(e,r){return new pJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};sPe.ElementType="u32";let zse=class fJ extends r_{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(fJ,e,r)}static fromTypedArray(e,r){return new fJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};zse.ElementType="i8";let l7=class mJ extends i_{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(mJ,e,r)}static fromTypedArray(e,r){return new mJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};l7.ElementType="i8";let nPe=class gJ extends s_{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(gJ,e,r)}static fromTypedArray(e,r){return new gJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};nPe.ElementType="i8";let oPe=class AJ extends n_{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(AJ,e,r)}static fromTypedArray(e,r){return new AJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};oPe.ElementType="i8";let aPe=class yJ extends r_{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(yJ,e,r)}static fromTypedArray(e,r){return new yJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};aPe.ElementType="i16";let c7=class _J extends i_{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(_J,e,r)}static fromTypedArray(e,r){return new _J(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};c7.ElementType="i16";let lPe=class vJ extends s_{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(vJ,e,r)}static fromTypedArray(e,r){return new vJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};lPe.ElementType="i16";let cPe=class bJ extends n_{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(bJ,e,r)}static fromTypedArray(e,r){return new bJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};cPe.ElementType="i16";let uPe=class wJ extends r_{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(wJ,e,r)}static fromTypedArray(e,r){return new wJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};uPe.ElementType="i32";let hPe=class xJ extends i_{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(xJ,e,r)}static fromTypedArray(e,r){return new xJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};hPe.ElementType="i32";let dPe=class TJ extends s_{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(TJ,e,r)}static fromTypedArray(e,r){return new TJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dPe.ElementType="i32";let pPe=class SJ extends n_{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(SJ,e,r)}static fromTypedArray(e,r){return new SJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};pPe.ElementType="i32";function fPe(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}function gdt(t){switch(t){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0}}function Adt(t){switch(t){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1}}function ydt(t){switch(t){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303}}let mfe=class mPe{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fieldNames){const s=e.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new mPe(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r,i,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}}},_dt=class gPe{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,r){return this._appendField(e,o_,r),this}vec2f64(e,r){return this._appendField(e,Bse,r),this}vec3f(e,r){return this._appendField(e,ks,r),this}vec3f64(e,r){return this._appendField(e,cc,r),this}vec4f(e,r){return this._appendField(e,Gh,r),this}vec4f64(e,r){return this._appendField(e,i7,r),this}mat3f(e,r){return this._appendField(e,cb,r),this}mat3f64(e,r){return this._appendField(e,Nse,r),this}mat4f(e,r){return this._appendField(e,Fse,r),this}mat4f64(e,r){return this._appendField(e,b4,r),this}vec4u8(e,r){return this._appendField(e,uc,r),this}f32(e,r){return this._appendField(e,Dse,r),this}f64(e,r){return this._appendField(e,kse,r),this}u8(e,r){return this._appendField(e,lM,r),this}u16(e,r){return this._appendField(e,n7,r),this}i8(e,r){return this._appendField(e,zse,r),this}vec2i8(e,r){return this._appendField(e,l7,r),this}vec2i16(e,r){return this._appendField(e,c7,r),this}vec2u8(e,r){return this._appendField(e,s7,r),this}vec4u16(e,r){return this._appendField(e,BL,r),this}u32(e,r){return this._appendField(e,a7,r),this}_appendField(e,r,i){const s=r.ElementCount*fPe(r.ElementType),n=this.stride;this.fields.set(e,{size:s,constructor:r,offset:n,optional:i}),this.stride+=s,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.includes(e)}createBuffer(e){return new mfe(this,e)}createView(e){return new mfe(this,e)}clone(){const e=new gPe;return e.stride=this.stride,e.fields=new Map,this.fields.forEach((r,i)=>e.fields.set(i,r)),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}};function gn(){return new _dt}let Rt=class{constructor(e,r,i=!1,s=r){this.data=e,this.size=r,this.exclusive=i,this.stride=s}};var EJ;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function r(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=s,t.subtract=n})(EJ||(EJ={}));var Xn;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Xn||(Xn={}));function jh(t,e=!1){return t<=Rg?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function vdt(t){return length<=Rg?Array.from(t):new Float64Array(t)}function Xp(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function uo(t,e=!1){return t<=Rg?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function gfe(t){return length<=Rg?Array.from(t):new Float32Array(t)}function Afe(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function bdt(t){if(t.length<Rg)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return Uint16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}const Cc=Zr();let wdt=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function Zt(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new wdt(`${e} at ${r}`)}}function ZT(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function yfe(t,e,r,i){let s,n=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],h=(i[2]-t[2])/e[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function O5(t,e,r,i,s,n=Dt()){const o=(i[s]-r[s])*(e[0]-t[0])-(i[0]-r[0])*(e[s]-t[s]),a=(i[0]-r[0])*(t[s]-r[s])-(i[s]-r[s])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function _fe(t,e,r,i,s){Cc[0]=t[0],Cc[1]=t[1],Cc[2]=t[2],Cc[3]=1,Ld(Cc,Cc,e),s.length>2&&(s[2]=-Cc[2]),Ld(Cc,Cc,r),Zt(Cc[3]!==0),s[0]=Cc[0]/Cc[3],s[1]=Cc[1]/Cc[3],s[2]=Cc[2]/Cc[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function xdt(t,e){return Math.log(t)/Math.log(e)}function Tdt(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function APe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}let yPe=class _Pe{constructor(e,r,i,s){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.indices=i,this.position=s,this._children=void 0,Zt(e.length>=1),Zt(i.length%this._numIndexPerPrimitive==0),Zt(i.length>=e.length*this._numIndexPerPrimitive),Zt(s.size===3||s.size===4);const{data:n,size:o}=s,a=e.length;let l=o*i[this._numIndexPerPrimitive*e[0]];Xb.clear(),Xb.push(l);const c=ct(n[l],n[l+1],n[l+2]),h=In(c);for(let _=0;_<a;++_){const w=this._numIndexPerPrimitive*e[_];for(let T=0;T<this._numIndexPerPrimitive;++T){l=o*i[w+T],Xb.push(l);let C=n[l];c[0]=Math.min(C,c[0]),h[0]=Math.max(C,h[0]),C=n[l+1],c[1]=Math.min(C,c[1]),h[1]=Math.max(C,h[1]),C=n[l+2],c[2]=Math.min(C,c[2]),h[2]=Math.max(C,h[2])}}this.bbMin=c,this.bbMax=h;const p=fo(V(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let A=this.radius*this.radius;for(let _=0;_<Xb.length;++_){l=Xb.getItemAt(_);const w=n[l]-p[0],T=n[l+1]-p[1],C=n[l+2]-p[2],M=w*w+T*T+C*C;if(M<=A)continue;const O=Math.sqrt(M),$=.5*(O-this.radius);this.radius=this.radius+$,A=this.radius*this.radius;const L=$/O;p[0]+=w*L,p[1]+=T*L,p[2]+=C*L}this.center=p,Xb.clear()}getChildren(){if(this._children||cl(this.bbMin,this.bbMax)<=1)return this._children;const e=fo(V(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<r;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let A=o*this.indices[p],_=n[A],w=n[A+1],T=n[A+2];for(let C=1;C<this._numIndexPerPrimitive;++C){A=o*this.indices[p+C];const M=n[A],O=n[A+1],$=n[A+2];M<_&&(_=M),O<w&&(w=O),$<T&&(T=$)}_<e[0]&&(h|=1),w<e[1]&&(h|=2),T<e[2]&&(h|=4),i[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<r;++c){const h=i[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new _Pe(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){Xb.prune()}};const Xb=new Vr({deallocator:null});let UL=class{constructor(){this.id=kh()}unload(){}};function Sdt(t){return t?{p0:In(t.p0),p1:In(t.p1),p2:In(t.p2)}:{p0:V(),p1:V(),p2:V()}}function vfe(t,e,r){const i=e[0]-t[0],s=e[1]-t[1],n=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-s*n)}function Edt(t,e,r){return Be(VG,e,t),Be(bfe,r,t),st(Xt(VG,VG,bfe))/2}new Xy(Q0);new Xy(()=>Sdt());const VG=V(),bfe=V();function Cdt(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;$e(r,0,0,0),$e(Mp,0,0,0);let n=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a+0]*i,c=e[a+1]*i,h=e[a+2]*i;$e(Pa,s[l+0],s[l+1],s[l+2]),$e(ay,s[c+0],s[c+1],s[c+2]),$e(P5,s[h+0],s[h+1],s[h+2]);const p=Edt(Pa,ay,P5);p?(ke(Pa,Pa,ay),ke(Pa,Pa,P5),Me(Pa,Pa,1/3*p),ke(r,r,Pa),n+=p):(ke(Mp,Mp,Pa),ke(Mp,Mp,ay),ke(Mp,Mp,P5),o+=3)}return(o!==0||n!==0)&&(n!==0?(Me(r,r,1/n),!0):o!==0&&(Me(r,Mp,1/o),!0))}function Mdt(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;$e(r,0,0,0);let n=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*i;n!==l&&(r[0]+=s[l+0],r[1]+=s[l+1],r[2]+=s[l+2],o++),n=l}return o>1&&Me(r,r,1/o),o>0}function Rdt(t,e,r,i){if(!t)return!1;$e(i,0,0,0),$e(Mp,0,0,0);let s=0,n=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(r?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,A=h<l?h+1:0,_=(e?e[p]:p)*o,w=(e?e[A]:A)*o;Pa[0]=a[_],Pa[1]=a[_+1],Pa[2]=a[_+2],ay[0]=a[w],ay[1]=a[w+1],ay[2]=a[w+2],Me(Pa,ke(Pa,Pa,ay),.5);const T=hL(Pa,ay);T>0?(ke(i,i,Me(Pa,Pa,T)),s+=T):s===0&&(ke(Mp,Mp,Pa),n++)}return s!==0?(Me(i,i,1/s),!0):n!==0&&(Me(i,Mp,1/n),!0)}const Pa=V(),ay=V(),P5=V(),Mp=V();function i3(t){if(Array.isArray(t)){if(t.length<Rg)return t;for(const e of t)if(e>=65536)return new Uint32Array(t);return new Uint16Array(t)}if(t.length<Rg)return Array.from(t);if(t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return t;for(const e of t)if(e>=65536)return t;return new Uint16Array(t)}function vPe(t){const e=3*t;return e<=Rg?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}let H1=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const bPe=[0],s3=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function cM(t){if(t===1)return bPe;if(t<Rg)return Array.from(new Uint16Array(s3.buffer,0,t));if(t<s3.length)return new Uint16Array(s3.buffer,0,t);if(t>H1.length){const e=Math.max(2*H1.length,t);H1=new Uint32Array(e);for(let r=0;r<H1.length;r++)H1[r]=r}return new Uint32Array(H1.buffer,0,t)}function KBt(t){if(t===1)return bPe;if(t<Rg)return Array.from(new Uint16Array(s3.buffer,0,t));if(t<s3.length)return new Uint16Array(s3.slice(0,t));if(t>H1.length){const e=new Uint32Array(t);for(let r=0;r<e.length;r++)e[r]=r;return e}return new Uint32Array(H1.slice(0,t))}let b9=class{constructor(e){this.channel=e,this.id=kh()}};function CJ(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function Odt(t,e){const r=t.length;for(let i=0;i<r;++i)xC[0]=t[i],e[i]=xC[0];return e}function Pdt(t,e){const r=t.length;for(let i=0;i<r;++i)xC[0]=t[i],xC[1]=t[i]-xC[0],e[i]=xC[1];return e}const xC=new Float32Array(2);function MJ(t,e){return N(t)&&(t=[]),t.push(e),t}function RJ(t,e){if(N(t))return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function Idt(t,e,r,i,s){I5[0]=t.get(e,0),I5[1]=t.get(e,1),I5[2]=t.get(e,2),CJ(I5,Zb,3),r.set(s,0,Zb[0]),i.set(s,0,Zb[1]),r.set(s,1,Zb[2]),i.set(s,1,Zb[3]),r.set(s,2,Zb[4]),i.set(s,2,Zb[5])}const I5=V(),Zb=new Float32Array(6);let Mo=class wPe extends UL{constructor(e,r,i=[],s=null,n=Xn.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=s,this.type=n,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=$dt(this._vertexAttributes),c=cM(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,c)}else for(const[l,c]of i)c&&(this._indices.set(l,i3(c)),l===B.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const r=new wPe(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,s)=>{i.exclusive=!1,r._vertexAttributes.set(s,i)}),this._indices.forEach((i,s)=>r._indices.set(s,i)),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let r=this._vertexAttributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:bdt(r.data)},this._vertexAttributes.set(e,r)),r}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return N(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Xn.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Xn.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(E(this._transformation)&&Mt(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.indices.get(B.POSITION),i=this.vertexAttributes.get(B.POSITION);return Cdt(i,r,e)}_computeAttachmentOriginLines(e){const r=this.vertexAttributes.get(B.POSITION),i=this.indices.get(B.POSITION);return Rdt(r,i,i&&Ldt(this.material.parameters,r,i),e)}_computeAttachmentOriginPoints(e){const r=this.indices.get(B.POSITION),i=this.vertexAttributes.get(B.POSITION);return Mdt(i,r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(B.POSITION),r=this.vertexAttributes.get(B.POSITION);if(!e||e.length===0||!r)return null;const i=this.type===Xn.Mesh?3:1;Zt(e.length%i==0,"Indexing error: "+e.length+" not divisible by "+i);const s=cM(e.length/i);return new yPe(s,i,e,r)}get transformation(){return gr(this._transformation,Hd)}set transformation(e){this._transformation=e&&e!==Hd?H3(e):null}get shaderTransformation(){return E(this._shaderTransformer)?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return E(this._shaderTransformer)}addHighlight(){const e=new b9(zy.Highlight);return this.highlights=MJ(this.highlights,e),e}removeHighlight(e){this.highlights=RJ(this.highlights,e)}};function $dt(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function Ldt(t,e,r){return!(!("isClosed"in t)||!t.isClosed)&&(r?r.length>2:e.data.length>6)}const JT=EJ,zG=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],Ddt=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],Ndt=[0,0,1,0,1,1,0,1],Fdt=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],xPe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)xPe[6*t+e]=t;const f2=new Array(36);for(let t=0;t<6;t++)f2[6*t+0]=0,f2[6*t+1]=1,f2[6*t+2]=2,f2[6*t+3]=2,f2[6*t+4]=3,f2[6*t+5]=0;function kdt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=zG[i][0]*e[0],r[3*i+1]=zG[i][1]*e[1],r[3*i+2]=zG[i][2]*e[2];return new Mo(t,[[B.POSITION,new Rt(r,3,!0)],[B.NORMAL,new Rt(Ddt,3)],[B.UV0,new Rt(Ndt,2)]],[[B.POSITION,Fdt],[B.NORMAL,xPe],[B.UV0,f2]])}const GG=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],Bdt=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],Udt=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],Vdt=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function zdt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=GG[i][0]*e[0],r[3*i+1]=GG[i][1]*e[1],r[3*i+2]=GG[i][2]*e[2];return new Mo(t,[[B.POSITION,new Rt(r,3,!0)],[B.NORMAL,new Rt(Bdt,3)]],[[B.POSITION,Udt],[B.NORMAL,Vdt]])}const J6=Ji(-.5,0,-.5),K6=Ji(.5,0,-.5),e8=Ji(0,0,.5),t8=Ji(0,.5,0),KT=Ks(),eS=Ks(),n3=Ks(),o3=Ks(),a3=Ks();Be(KT,J6,t8),Be(eS,J6,K6),Xt(n3,KT,eS),qe(n3,n3),Be(KT,K6,t8),Be(eS,K6,e8),Xt(o3,KT,eS),qe(o3,o3),Be(KT,e8,t8),Be(eS,e8,J6),Xt(a3,KT,eS),qe(a3,a3);const jG=[J6,K6,e8,t8],Gdt=[0,-1,0,n3[0],n3[1],n3[2],o3[0],o3[1],o3[2],a3[0],a3[1],a3[2]],jdt=[0,1,2,3,1,0,3,2,1,3,0,2],Hdt=[0,0,0,1,1,1,2,2,2,3,3,3];function qdt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=jG[i][0]*e[0],r[3*i+1]=jG[i][1]*e[1],r[3*i+2]=jG[i][2]*e[2];return new Mo(t,[[B.POSITION,new Rt(r,3,!0)],[B.NORMAL,new Rt(Gdt,3)]],[[B.POSITION,jdt],[B.NORMAL,Hdt]])}function tUt(t,e,r,i,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),h=Math.max(2,Math.floor(i)),p=(c+1)*(h+1),A=uo(3*p),_=uo(3*p),w=uo(2*p),T=[];let C=0;for(let L=0;L<=h;L++){const k=[],F=L/h,G=a+F*l,z=Math.cos(G);for(let Z=0;Z<=c;Z++){const J=Z/c,te=n+J*o,re=Math.cos(te)*z,Ae=Math.sin(G),ve=-Math.sin(te)*z;A[3*C]=re*e,A[3*C+1]=Ae*e,A[3*C+2]=ve*e,_[3*C]=re,_[3*C+1]=Ae,_[3*C+2]=ve,w[2*C]=J,w[2*C+1]=F,k.push(C),++C}T.push(k)}const M=new Array;for(let L=0;L<h;L++)for(let k=0;k<c;k++){const F=T[L][k],G=T[L][k+1],z=T[L+1][k+1],Z=T[L+1][k];L===0?(M.push(F),M.push(z),M.push(Z)):L===h-1?(M.push(F),M.push(G),M.push(z)):(M.push(F),M.push(G),M.push(z),M.push(z),M.push(Z),M.push(F))}const O=[[B.POSITION,M],[B.NORMAL,M]],$=[[B.POSITION,new Rt(A,3,!0)],[B.NORMAL,new Rt(_,3,!0)]];return s.uv&&($.push([B.UV0,new Rt(w,2,!0)]),O.push([B.UV0,M])),s.offset&&(O[0][0]=B.OFFSET,$[0][0]=B.OFFSET,O.push([B.POSITION,new Array(M.length).fill(0)]),$.push([B.POSITION,new Rt(Float64Array.from(s.offset),3,!0)])),new Mo(t,$,O)}function Wdt(t,e,r,i){const{vertexAttributes:s,indices:n}=TPe(e,r,i);return new Mo(t,s,n)}function TPe(t,e,r){const i=t;let s,n;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=i*(1+Math.sqrt(5))/2;s=[-i,h,0,i,h,0,-i,-h,0,i,-h,0,0,-i,h,0,i,h,0,-i,-h,0,i,-h,h,0,-i,h,0,i,-h,0,-i,-h,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<s.length;h+=3)JT.scale(s,h,t/JT.length(s,h));let o={};function a(h,p){h>p&&([h,p]=[p,h]);const A=h.toString()+"."+p.toString();if(o[A])return o[A];let _=s.length;return s.length+=3,JT.add(s,3*h,s,3*p,s,_),JT.scale(s,_,t/JT.length(s,_)),_/=3,o[A]=_,_}for(let h=0;h<e;h++){const p=n.length,A=new Array(4*p);for(let _=0;_<p;_+=3){const w=n[_],T=n[_+1],C=n[_+2],M=a(w,T),O=a(T,C),$=a(C,w),L=4*_;A[L]=w,A[L+1]=M,A[L+2]=$,A[L+3]=T,A[L+4]=O,A[L+5]=M,A[L+6]=C,A[L+7]=$,A[L+8]=O,A[L+9]=M,A[L+10]=O,A[L+11]=$}n=A,o={}}const l=gfe(s);for(let h=0;h<l.length;h+=3)JT.normalize(l,h);const c=[[B.POSITION,n],[B.NORMAL,n]];return{vertexAttributes:[[B.POSITION,new Rt(gfe(s),3,!0)],[B.NORMAL,new Rt(l,3,!0)]],indices:c}}function OJ(t,e,r,i,s,n,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],h=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const p=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],A=E(s)&&s.length===2?s:[1,1],_=[[B.POSITION,new Rt(c,3,!0)],[B.NORMAL,new Rt(h,3,!0)],[B.UV0,new Rt(o,o.length)],[B.COLOR,new Rt(p,4,!0)],[B.SIZE,new Rt(A,2)]];if(n!=null){const w=[n[0],n[1],n[2],n[3]];_.push([B.AUXPOS1,new Rt(w,4)])}if(a!=null){const w=[a[0],a[1],a[2],a[3]];_.push([B.AUXPOS2,new Rt(w,4)])}return new Mo(t,_,null,null,Xn.Point,l)}const Ydt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function rUt(t,e=Ydt){const r=new Array(12);for(let h=0;h<4;h++)for(let p=0;p<3;p++)r[3*h+p]=e[h][p];const i=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[B.POSITION,i],[B.NORMAL,n],[B.UV0,i],[B.COLOR,n]],c=[[B.POSITION,new Rt(r,3,!0)],[B.NORMAL,new Rt(s,3,!0)],[B.UV0,new Rt(o,2,!0)],[B.COLOR,new Rt(a,4,!0)]];return new Mo(t,c,l)}function wfe(t,e,r,i,s,n=!0,o=!0){let a=0;const l=r,c=e;let h=Ji(0,a,0),p=Ji(0,a+c,0),A=Ji(0,-1,0),_=Ji(0,1,0);s&&(a=c,p=Ji(0,0,0),h=Ji(0,a,0),A=Ji(0,1,0),_=Ji(0,-1,0));const w=[p,h],T=[A,_],C=i+2,M=Math.sqrt(c*c+l*l);if(s)for(let z=i-1;z>=0;z--){const Z=z*(2*Math.PI/i),J=Ji(Math.cos(Z)*l,a,Math.sin(Z)*l);w.push(J);const te=Ji(c*Math.cos(Z)/M,-l/M,c*Math.sin(Z)/M);T.push(te)}else for(let z=0;z<i;z++){const Z=z*(2*Math.PI/i),J=Ji(Math.cos(Z)*l,a,Math.sin(Z)*l);w.push(J);const te=Ji(c*Math.cos(Z)/M,l/M,c*Math.sin(Z)/M);T.push(te)}const O=new Array,$=new Array;if(n){for(let z=3;z<w.length;z++)O.push(1),O.push(z-1),O.push(z),$.push(0),$.push(0),$.push(0);O.push(w.length-1),O.push(2),O.push(1),$.push(0),$.push(0),$.push(0)}if(o){for(let z=3;z<w.length;z++)O.push(z),O.push(z-1),O.push(0),$.push(z),$.push(z-1),$.push(1);O.push(0),O.push(2),O.push(w.length-1),$.push(1),$.push(2),$.push(T.length-1)}const L=uo(3*C);for(let z=0;z<C;z++)L[3*z]=w[z][0],L[3*z+1]=w[z][1],L[3*z+2]=w[z][2];const k=uo(3*C);for(let z=0;z<C;z++)k[3*z]=T[z][0],k[3*z+1]=T[z][1],k[3*z+2]=T[z][2];const F=[[B.POSITION,O],[B.NORMAL,$]],G=[[B.POSITION,new Rt(L,3,!0)],[B.NORMAL,new Rt(k,3,!0)]];return new Mo(t,G,F)}function Qdt(t,e,r,i,s,n,o){const a=s?m9(s):Ji(1,0,0),l=n?m9(n):Ji(0,0,0);o=o??!0;const c=Ks();qe(c,a);const h=Ks();Me(h,c,Math.abs(e));const p=Ks();Me(p,h,-.5),ke(p,p,l);const A=Ji(0,1,0);Math.abs(1-He(c,A))<.2&&$e(A,0,0,1);const _=Ks();Xt(_,c,A),qe(_,_),Xt(A,_,c);const w=2*i+(o?2:0),T=i+(o?2:0),C=uo(3*w),M=uo(3*T),O=uo(2*w),$=new Array(3*i*(o?4:2)),L=new Array(3*i*(o?4:2));o&&(C[3*(w-2)+0]=p[0],C[3*(w-2)+1]=p[1],C[3*(w-2)+2]=p[2],O[2*(w-2)]=0,O[2*(w-2)+1]=0,C[3*(w-1)+0]=C[3*(w-2)+0]+h[0],C[3*(w-1)+1]=C[3*(w-2)+1]+h[1],C[3*(w-1)+2]=C[3*(w-2)+2]+h[2],O[2*(w-1)]=1,O[2*(w-1)+1]=1,M[3*(T-2)+0]=-c[0],M[3*(T-2)+1]=-c[1],M[3*(T-2)+2]=-c[2],M[3*(T-1)+0]=c[0],M[3*(T-1)+1]=c[1],M[3*(T-1)+2]=c[2]);const k=(te,re,Ae)=>{$[te]=re,L[te]=Ae};let F=0;const G=Ks(),z=Ks();for(let te=0;te<i;te++){const re=te*(2*Math.PI/i);Me(G,A,Math.sin(re)),Me(z,_,Math.cos(re)),ke(G,G,z),M[3*te+0]=G[0],M[3*te+1]=G[1],M[3*te+2]=G[2],Me(G,G,r),ke(G,G,p),C[3*te+0]=G[0],C[3*te+1]=G[1],C[3*te+2]=G[2],O[2*te+0]=te/i,O[2*te+1]=0,C[3*(te+i)+0]=C[3*te+0]+h[0],C[3*(te+i)+1]=C[3*te+1]+h[1],C[3*(te+i)+2]=C[3*te+2]+h[2],O[2*(te+i)+0]=te/i,O[2*te+1]=1;const Ae=(te+1)%i;k(F++,te,te),k(F++,te+i,te),k(F++,Ae,Ae),k(F++,Ae,Ae),k(F++,te+i,te),k(F++,Ae+i,Ae)}if(o){for(let te=0;te<i;te++){const re=(te+1)%i;k(F++,w-2,T-2),k(F++,te,T-2),k(F++,re,T-2)}for(let te=0;te<i;te++){const re=(te+1)%i;k(F++,te+i,T-1),k(F++,w-1,T-1),k(F++,re+i,T-1)}}const Z=[[B.POSITION,$],[B.NORMAL,L],[B.UV0,$]],J=[[B.POSITION,new Rt(C,3,!0)],[B.NORMAL,new Rt(M,3,!0)],[B.UV0,new Rt(O,2,!0)]];return new Mo(t,J,Z)}function iUt(t,e,r,i,s,n,o=Ji(0,0,0)){const a=e.length,l=uo(r.length*a*3+(6*i.length||0)),c=uo(r.length*a*3+(i?6:0)),h=new Array,p=new Array;let A=0,_=0;const w=Ks(),T=Ks(),C=Ks(),M=Ks(),O=Ks(),$=Ks(),L=Ks(),k=V(),F=Ks(),G=Ks(),z=Ks(),Z=Ks(),J=Ks(),te=Hi();$e(F,0,1,0),Be(T,r[1],r[0]),qe(T,T),n?(ke(k,r[0],o),qe(C,k)):$e(C,0,0,1),w9(T,C,F,F,O,C,xfe),Oe(M,C),Oe(Z,O);for(let X=0;X<i.length;X++)Me($,O,i[X][0]),Me(k,C,i[X][2]),ke($,$,k),ke($,$,r[0]),l[A++]=$[0],l[A++]=$[1],l[A++]=$[2];c[_++]=-T[0],c[_++]=-T[1],c[_++]=-T[2];for(let X=0;X<s.length;X++)h.push(s[X][0]>0?s[X][0]:-s[X][0]-1+i.length),h.push(s[X][1]>0?s[X][1]:-s[X][1]-1+i.length),h.push(s[X][2]>0?s[X][2]:-s[X][2]-1+i.length),p.push(0),p.push(0),p.push(0);let re=i.length;const Ae=i.length-1;for(let X=0;X<r.length;X++){let se=!1;X>0&&(Oe(w,T),X<r.length-1?(Be(T,r[X+1],r[X]),qe(T,T)):se=!0,ke(G,w,T),qe(G,G),ke(z,r[X-1],M),vL(r[X],G,te),ST(te,qd(z,w),k)?(Be(k,k,r[X]),qe(C,k),Xt(O,G,C),qe(O,O)):w9(G,M,Z,F,O,C,xfe),Oe(M,C),Oe(Z,O)),n&&(ke(k,r[X],o),qe(J,k));for(let ae=0;ae<a;ae++)if(Me($,O,e[ae][0]),Me(k,C,e[ae][1]),ke($,$,k),qe(L,$),c[_++]=L[0],c[_++]=L[1],c[_++]=L[2],ke($,$,r[X]),l[A++]=$[0],l[A++]=$[1],l[A++]=$[2],!se){const fe=(ae+1)%a;h.push(re+ae),h.push(re+a+ae),h.push(re+fe),h.push(re+fe),h.push(re+a+ae),h.push(re+a+fe);for(let ue=0;ue<6;ue++){const Re=h.length-6;p.push(h[Re+ue]-Ae)}}re+=a}const ve=r[r.length-1];for(let X=0;X<i.length;X++)Me($,O,i[X][0]),Me(k,C,i[X][1]),ke($,$,k),ke($,$,ve),l[A++]=$[0],l[A++]=$[1],l[A++]=$[2];const ye=_/3;c[_++]=T[0],c[_++]=T[1],c[_++]=T[2];const le=re-a;for(let X=0;X<s.length;X++)h.push(s[X][0]>=0?re+s[X][0]:-s[X][0]-1+le),h.push(s[X][2]>=0?re+s[X][2]:-s[X][2]-1+le),h.push(s[X][1]>=0?re+s[X][1]:-s[X][1]-1+le),p.push(ye),p.push(ye),p.push(ye);const W=[[B.POSITION,h],[B.NORMAL,p]],q=[[B.POSITION,new Rt(l,3,!0)],[B.NORMAL,new Rt(c,3,!0)]];return new Mo(t,q,W)}function sUt(t,e,r,i){Zt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Zt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),Zt(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),Zt(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const s=jh(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let h=0;h<e.length;h++){for(let p=0;p<3;p++)s[o++]=e[h][p];h>0&&(n[a++]=h-1,n[a++]=h)}const l=[],c=[];if(l.push([B.POSITION,n]),c.push([B.POSITION,new Rt(s,3,!0)]),r){const h=uo(3*r.length);let p=0;for(let A=0;A<e.length;A++)for(let _=0;_<3;_++)h[p++]=r[A][_];l.push([B.NORMAL,n]),c.push([B.NORMAL,new Rt(h,3,!0)])}return i&&(c.push([B.COLOR,new Rt(i,4)]),l.push([B.COLOR,cM(i.length/4)])),new Mo(t,c,l,null,Xn.Line)}function Xdt(t,e=t){const r=t.vertexAttributes,i=r.get(B.POSITION).data,s=r.get(B.NORMAL).data;if(s){const n=e.getMutableAttribute(B.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(i){const n=e.getMutableAttribute(B.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];n[o+1]=-i[o+2],n[o+2]=a}}}function HG(t,e,r,i,s){return!(Math.abs(He(e,t))>s)&&(Xt(r,t,e),qe(r,r),Xt(i,r,t),qe(i,i),!0)}function w9(t,e,r,i,s,n,o){return HG(t,e,s,n,o)||HG(t,r,s,n,o)||HG(t,i,s,n,o)}const xfe=.99619469809;let Zdt=class{constructor(e,r){this.type=sa.Panoramic,this._configuration=new Pse,this._passParameters=new Ise,this._configuration.geometry=Bg.Cylinder,this._technique=r.techniqueRepository.acquire(v9,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=Ol(this._vao,"geometry"),this._passParameters.texture=new Wt(i,{pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:Bt.LINEAR,flipped:!0,width:1,height:512},tPe)}destroy(){this._passParameters.texture=Nt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);Jdt(Tfe,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",Tfe),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Ar.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=TPe(1,2,!1),i=r.indices[0][1],s=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const n=s.data,o=Sfe.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,n[c]),a.set(l,1,n[c+1]),a.set(l,2,n[c+2])}return new Z0(e,Pi,{geometry:Wh(Sfe)},{geometry:Wi.createVertex(e,Li.STATIC_DRAW,o.buffer)})}};function Jdt(t,e){ma(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const Tfe=ot(),Sfe=gn().vec3f(B.POSITION);var Gy;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(Gy||(Gy={}));let PJ=class extends fc{constructor(){super(...arguments),this.type=Gy.Rain}};u([ie({count:Gy.COUNT})],PJ.prototype,"type",void 0);function Kdt(t){const e=new Di;return e.attributes.add(B.POSITION,"vec3"),e.attributes.add(B.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Fr("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new Fr("offset",(r,i)=>ept(r,i))),e.vertex.uniforms.add(new nt("width",r=>r.width)),e.vertex.uniforms.add(new nn("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new nn("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new nt("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(I`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===Gy.Rain?I`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:I`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add([new nt("opacity",r=>r.opacity),new Fr("particleColor",(r,i)=>tpt(i,t))]),e.fragment.code.add(I`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===Gy.Rain?I`d = 0.35 * smoothstep(0.5, 0.0, d);`:I`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function ept(t,e){const r=e.camera.eye,i=.5*t.width,s=1/t.width,n=u2e(IJ,$e(IJ,(r[0]+i)*s,(r[1]+i)*s,(r[2]+i)*s));return Da(n,r,Me(n,n,t.width))}function tpt(t,e){const r=e.type===Gy.Rain?ipt:rpt,i=Me(IJ,r,spt),s=t.camera.eye;qe(Efe,s);const n=Math.max(0,He(Efe,t.lighting.mainLight.direction));return fo(i,i,r,n)}const IJ=V(),Efe=V(),rpt=ct(1,1,1),ipt=ct(.85,.85,.85),spt=.7,npt=Object.freeze(Object.defineProperty({__proto__:null,build:Kdt},Symbol.toStringTag,{value:"Module"}));let opt=class extends ys{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},$J=class SPe extends Vi{initializeProgram(e){return new Fi(e.rctx,SPe.shader.get().build(this.configuration),r8)}initializePipeline(){return Rr({blending:Aa(tt.ONE,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),depthTest:{func:Bs.LEQUAL},colorWrite:zr})}};$J.shader=new Ni(npt,()=>be(()=>import("./Precipitation.glsl-eeb2e4a3.js"),[]));const r8=new Map([[B.POSITION,0],[B.INSTANCEFEATUREATTRIBUTE,1]]);let EPe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return E(r)?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},apt=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},m2=class extends Ke{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new opt,this._animation=new EPe,this._updatingTracking=new vg,this._passParameters.time=0,this._passParameters.radius=es(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=en(this._snowTechniqueCached),this._rainTechniqueCached=en(this._rainTechniqueCached),this._vao=Nt(this._vao),this._instanceIdBuffer=Nt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(N(this._rainTechniqueCached)){const e=new PJ;e.type=Gy.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire($J,e)}return this._rainTechniqueCached}get _snowTechnique(){if(N(this._snowTechniqueCached)){const e=new PJ;e.type=Gy.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire($J,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){var l;const s=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),N(s)||N(this._vao)||N(this._instanceIdBuffer)||(E(e.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?Sr(0,o,2*r):Sr(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*ate(this._animation.time)%1e5;const a=n.bindTechnique(s,this._passParameters,e.bindParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),fse(n,r8,this._instanceIdBuffer,Cfe,0),(l=n.capabilities.instancing)==null||l.drawArraysInstanced(Ar.TRIANGLES,0,3,this._numParticles*r),mse(n,r8,this._instanceIdBuffer,Cfe)}_ensureResources(e){N(this._vao)&&(this._vao=this._createVertexArrayObject(e)),N(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return Wi.createVertex(e,Li.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Z0(e,r8,{geometry:Wh(lpt)},{geometry:Wi.createVertex(e,Li.STATIC_DRAW,r)})}};u([d({constructOnly:!0})],m2.prototype,"context",void 0),u([d({constructOnly:!0})],m2.prototype,"view",void 0),u([d({readOnly:!0})],m2.prototype,"updating",null),u([d()],m2.prototype,"_updatingTracking",void 0),m2=u([j("esri.views.3d.environment.Precipitation")],m2);const lpt=gn().vec3f(B.POSITION),Cfe=Wh(gn().f32(B.INSTANCEFEATUREATTRIBUTE),1),cpt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),$5=128,Mfe=-LZ,Rfe=0,qG=50,upt=()=>1-511/512,hpt=f6([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let dpt=class{constructor(e,r){this.view=e,this.type=sa.Simple,this._passParameters=new Ise,this._vaoCount=0,this._texV1=1,this._isMars=Gg(e.spatialReference);const i=es(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Mfe)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Rfe)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Rfe/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const s=r.renderContext.rctx;this._cameraChangeHandle=xe(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),ao),this._vao=this._createRibbon(s),this._vaoCount=Ol(this._vao,"geometry"),this._fadeVao=mc(s),this._fadeVaoCount=Ol(this._fadeVao,"geometry");const n=this._isMars?cpt:tPe;this._passParameters.texture=new Wt(s,{pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:Bt.LINEAR,flipped:!0,width:1,height:512},n);const o=new Pse;o.geometry=Bg.Cone,this._coneTechnique=this._techniqueRepository.acquire(v9,o),o.geometry=Bg.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(v9,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=Nt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._vao),i.drawArrays(Ar.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(Ar.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=V(),i=this._planetRadius,s=st(e.eye),n=s-i;if(n<0){const _=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=_}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(qG,n),a=i+Mfe;this._passParameters.innerScale=ppt(i+o,i,a)-1,this._passParameters.altitudeFade=use(n),Me(r,e.eye,(i+qG)/s),Ofe(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=upt(),h=hpt(n);let p=this._texV0+c*this._texVScale,A=this._texV0+l*h*this._texVScale;if(n>qG){Ofe(e.eye,e.center,e.up,i,this._passParameters.silhouette);const _=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),w=ze((_-1.5)/(l-1.5),0,1);p=this._texV0+w*c*this._texVScale,A=this._texV0+Sr(this._texV1,l*h,w)*this._texVScale}Kr(this._passParameters.texV,p,A)}_createRibbon(e){const r=uo(3+3*$5*3),i=new Uint32Array(3*$5*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<$5;o++){const a=9*o+3;r[a+0]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===$5-1?1:l+3,h=15*o;i[h+0]=l,i[h+1]=l+1,i[h+2]=c+1,i[h+3]=c+1,i[h+4]=c,i[h+5]=l,i[h+6]=l+1,i[h+7]=l+2,i[h+8]=c+2,i[h+9]=c+2,i[h+10]=c+1,i[h+11]=l+1,i[h+12]=l,i[h+13]=c,i[h+14]=0}const s=Pfe.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new Z0(e,Pi,{geometry:Wh(Pfe)},{geometry:Wi.createVertex(e,Li.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,r,i,s){return ke(tS,s.center,s.v2),Me(L5,tS,this._outerRimFactor),mU(WG,r,tS,i),_fe(tS,WG,e.projectionMatrix,e.viewport,tS),_fe(L5,WG,e.projectionMatrix,e.viewport,L5),Is(tS,L5)/e.height}};function Ofe(t,e,r,i,s){const n=st(t),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.v1,c=s.v2;return Me(s.center,t,a/n),Xt(l,t,e),Jl(l)<1&&Xt(l,t,r),Me(l,l,o/st(l)),Xt(c,l,t),Me(c,c,o/st(c)),o}const WG=ot(),tS=V(),L5=V();function ppt(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const Pfe=gn().vec3f(B.POSITION);let CPe=class MPe extends Vi{initializeProgram(e){return new Fi(e.rctx,MPe.shader.get().build(this.configuration),Pi)}initializePipeline(){return Rr({blending:Aa(tt.ONE,tt.ZERO,tt.ONE_MINUS_SRC_COLOR,tt.ONE),colorWrite:zr})}};CPe.shader=new Ni(YOe,()=>be(()=>import("./FogHaze.glsl-91a13a0c.js"),[]));const fpt=.7,mpt=1;let HP=class extends Ke{constructor(e){super(e),this._passParameters=new Rse;const r=e.context.renderContext.rctx;this._vao=mc(r,QM);const i=es(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+A4;const s=new Ose;s.haze=!0,this._hazeTechnique=e.context.techniqueRepository.acquire(CPe,s)}destroy(){this._hazeTechnique.release(),this._vao.dispose()}set strength(e){this._passParameters.hazeStrength=e}get strength(){return this._passParameters.hazeStrength}render(e,r){if(this.view.basemapTerrain.baseOpacity===0||(this._update(e,r),this._passParameters.hazeAmount<=0))return;const i=this._hazeTechnique;if(!i.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderSimpleHaze(n,e)})}_renderSimpleHaze(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Ar.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;qe(Ife,i.eye);const s=Math.max(0,He(Ife,e.bindParameters.lighting.mainLight.direction)),n=Apt;Me($fe,n,0),fo(this._passParameters.hazeColor,$fe,n,s);const o=st(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.hazeAmount=(1-L3(fpt*Pp,mpt*Pp,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],HP.prototype,"context",void 0),u([d({constructOnly:!0})],HP.prototype,"view",void 0),HP=u([j("esri.views.3d.environment.SimpleHaze")],HP);let gpt=class{constructor(){this.strength=0,this.amount=0}};const Apt=ct(.24,.44,.8),Ife=V(),$fe=V();function Gse(t){const e=I`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,r=I`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;t.vertex.code.add(e),t.vertex.code.add(r),t.fragment.code.add(e),t.fragment.code.add(r)}function ypt(){const t=new Di;return t.attributes.add(B.POSITION,"vec3"),t.attributes.add(B.COLOR,"vec4"),t.attributes.add(B.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add([new nn("transform",(e,r)=>_pt(e,r)),new hi("viewport",(e,r)=>r.camera.fullViewport),new nt("pixelRatio",(e,r)=>r.camera.pixelRatio)]),t.include(Gse),t.vertex.code.add(I`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(I`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),t}function _pt(t,e){return ma(R_,e.camera.projectionMatrix),R_[10]=24e-8-1,R_[11]=-1,R_[14]=(24e-8-2)*e.camera.near,$n(R_,R_,e.camera.viewMatrix),$n(R_,R_,t.modelMatrix)}const R_=ot(),vpt=Object.freeze(Object.defineProperty({__proto__:null,build:ypt},Symbol.toStringTag,{value:"Module"}));let bpt=class extends ys{constructor(){super(...arguments),this.modelMatrix=ot()}},RPe=class OPe extends Vi{constructor(e){super(e,new fc,()=>this.destroy())}initializeProgram(e){return new Fi(e.rctx,OPe.shader.get().build(),Pi)}initializePipeline(){return Rr({blending:Aa(tt.SRC_ALPHA,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),depthTest:{func:Bs.LEQUAL},colorWrite:zr})}};RPe.shader=new Ni(vpt,()=>be(()=>import("./Stars.glsl-44804587.js"),[]));let I1=class extends Ke{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return E(this._loadDataTask)&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new bpt,this._updatingTracking=new vg}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=tf(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=en(this._technique),this._vao=Nt(this._vao)}render(e){const{rctx:r}=e;if(this._ensureResources(r),N(this._technique)||N(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,this._renderParameter,e.bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Ar.POINTS,0,this._numPoints)}_ensureResources(e){if(E(this._technique)||N(rS))return;this._technique=new RPe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=rS.byteLength/Lfe;const r=new Float32Array(rS,0,2*this._numPoints),i=new Uint8Array(rS,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),Cr)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),s=ma(this._renderParameter.modelMatrix,Tpt);G3(s,s,-i*Math.PI),$n(s,xpt,s),G3(s,s,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,s){const n=Dfe.createBuffer(s),o=n.position,a=n.color,l=n.size;for(let c=0;c<s;c++){const h=r[2*c+0],p=r[2*c+1];o.set(c,0,-Math.cos(h)*Math.sin(p)),o.set(c,1,-Math.sin(h)*Math.sin(p)),o.set(c,2,-Math.cos(p));const A=this._unpackUint8Attributes(i[c]),_=this._hexToRGB(wpt[A[1]]);a.set(c,0,255*_[0]),a.set(c,1,255*_[1]),a.set(c,2,255*_[2]),a.set(c,3,255),l.set(c,A[0])}return new Z0(e,Pi,{geometry:Wh(Dfe)},{geometry:Wi.createVertex(e,Li.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(E(rS))return null;const e=lL(async r=>{const{data:i}=await jVe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),rS=i});return e.promise.catch(r=>{vo(r)||we.getLogger(this.declaredClass).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new ce("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/Lfe;if(r%1!=0||r>5e4||r<5e3)throw new ce("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],I1.prototype,"view",void 0),u([d({constructOnly:!0})],I1.prototype,"requestRender",void 0),u([d({readOnly:!0})],I1.prototype,"updating",null),u([d()],I1.prototype,"_loadDataTask",void 0),u([d()],I1.prototype,"_updatingTracking",void 0),I1=u([j("esri.views.3d.environment.Stars")],I1);const wpt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],xpt=Fre(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Tpt=Fre(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Lfe=9,Dfe=gn().vec3f(B.POSITION).vec4u8(B.COLOR).f32(B.SIZE);let rS=null;function Spt(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function x9(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function jse(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>dc()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function Hse(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*h+o*a+s*c-n*l,t[1]=s*h+o*l+n*a-i*c,t[2]=n*h+o*c+i*l-s*a,t[3]=o*h-i*a-s*l-n*c,t}function Ept(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-i*a,t}function Cpt(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-n*a,t[1]=s*l+o*a,t[2]=n*l+i*a,t[3]=o*l-s*a,t}function Mpt(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=s*l-i*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function Rpt(t,e){const r=e[0],i=e[1],s=e[2];return t[0]=r,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),t}function i8(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,h,p,A,_=r[0],w=r[1],T=r[2],C=r[3];return c=s*_+n*w+o*T+a*C,c<0&&(c=-c,_=-_,w=-w,T=-T,C=-C),1-c>dc()?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-i)*l)/h,A=Math.sin(i*l)/h):(p=1-i,A=i),t[0]=p*s+A*_,t[1]=p*n+A*w,t[2]=p*o+A*T,t[3]=p*a+A*C,t}function Opt(t){const e=uL,r=e(),i=e(),s=e(),n=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function Ppt(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-s*a,t[3]=n*a,t}function nT(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function PPe(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+o]-e[3*o+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[o]=(e[3*o+s]+e[3*s+o])*i}return t}function Ipt(t,e,r,i){const s=.5*Math.PI/180;e*=s,r*=s,i*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),h=Math.cos(i);return t[0]=n*l*h-o*a*c,t[1]=o*a*h+n*l*c,t[2]=o*l*c-n*a*h,t[3]=o*l*h+n*a*c,t}function $pt(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const qse=A0,Lpt=ns,Dpt=Hte,Npt=Hse,Fpt=MM,kpt=_2e,Bpt=YB,IPe=qte,Upt=IPe,$Pe=Wte,Vpt=$Pe,Wse=y2e,zpt=HC,Gpt=Yte;function jpt(t,e,r){const i=He(e,r);return i<-.999999?(Xt(lm,Hpt,e),gh(lm)<1e-6&&Xt(lm,qpt,e),qe(lm,lm),x9(t,lm,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Xt(lm,e,r),t[0]=lm[0],t[1]=lm[1],t[2]=lm[2],t[3]=1+i,Wse(t,t))}const lm=V(),Hpt=ct(1,0,0),qpt=ct(0,1,0);function Wpt(t,e,r,i,s,n){return i8(Nfe,e,s,n),i8(Ffe,r,i,n),i8(t,Nfe,Ffe,2*n*(1-n)),t}const Nfe=gf(),Ffe=gf();function Ypt(t,e,r,i){const s=Qpt;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],Wse(t,PPe(t,s))}const Qpt=mn();Object.freeze(Object.defineProperty({__proto__:null,add:Dpt,calculateW:Rpt,conjugate:nT,copy:qse,dot:kpt,equals:Gpt,exactEquals:zpt,fromEuler:Ipt,fromMat3:PPe,getAxisAngle:jse,identity:Spt,invert:Ppt,len:Upt,length:IPe,lerp:Bpt,mul:Npt,multiply:Hse,normalize:Wse,random:Opt,rotateX:Ept,rotateY:Cpt,rotateZ:Mpt,rotationTo:jpt,scale:Fpt,set:Lpt,setAxes:Ypt,setAxisAngle:x9,slerp:i8,sqlerp:Wpt,sqrLen:Vpt,squaredLength:$Pe,str:$pt},Symbol.toStringTag,{value:"Module"}));function VL(t=Zpt){return[t[0],t[1],t[2],t[3]]}function gUt(t,e,r=VL()){return Oe(r,t),r[3]=e,r}function kfe(t,e,r=VL()){return Xt(r,t,e),qe(r,r),r[3]=-p2e(t,e),r}function AUt(t,e,r=VL()){return x9(D5,t,Bfe(t)),x9(Ufe,e,Bfe(e)),Hse(D5,Ufe,D5),Xpt(r,Kc(jse(r,D5)))}function yUt(t){return t}function Bfe(t){return $r(t[3])}function Xpt(t,e){return t[3]=e,t}const Zpt=[0,0,1,0],D5=gf(),Ufe=gf();VL();function Jpt(t,e,r){const i=t.parallax.anchorPointClouds;t.fadeIn.stage===bh.FINISHED&&(t.fadeIn.factor=0,Oe(i,lg),t.fadeIn.stage=bh.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=na.FINISHED),t.fadeIn.stage===bh.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(bse(t.data)&&t.renderingStage!==Yn.RENDERING||t.renderingStage===Yn.FADING_TEXTURE_CHANNELS)&&(Oe(i,lg),t.fadeIn.stage=bh.FADE_IN,t.startTime=e,t.renderingStage===Yn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Yn.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===bh.FADE_IN?t.fadeIn.factor=r?ze((e-t.startTime)/(LPe*r),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===bh.FADE_IN&&(t.fadeIn.stage=bh.FINISHED,t.fadeIn.factor=1)}function Kpt(t,e,r){const{fadeInOut:i,crossFade:s}=t;i.stage===na.FINISHED&&(t.startTime=e,i.factor=1,i.stage=na.FADE_OUT),i.factor>0&&i.stage===na.FADE_OUT?i.factor=r?1-ze((e-t.startTime)/(sft*r),0,1):0:(i.factor<=0&&i.stage===na.FADE_OUT&&(i.factor=0,Oe(t.parallax.anchorPointClouds,lg)),i.factor<=0&&i.stage===na.FADE_OUT&&t.isCameraPositionFinal&&(i.factor=0,i.stage=na.SWITCH,t.crossFade.enabled=!1,s.factor=1),i.stage===na.SWITCH&&(bse(t.data)&&t.renderingStage!==Yn.RENDERING||t.renderingStage===Yn.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,i.factor=0,i.stage=na.FADE_IN,Oe(t.parallax.anchorPointClouds,lg),t.crossFade.enabled=!1,s.factor=1,t.renderingStage===Yn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Yn.SWITCH_CHANNELS)),i.factor<1&&i.stage===na.FADE_IN?i.factor=r?ze((e-t.startTime)/(LPe*r),0,1):1:i.factor>=1&&i.stage===na.FADE_IN&&(i.stage=na.FINISHED,i.factor=1))}function eft(t,e,r,i){const{crossFade:s}=t,n=t.parallax.anchorPointClouds;t.crossFade.enabled&&!i||(Oe(t.parallaxNew.anchorPointClouds,lg),t.startTime=e,s.factor=0,t.crossFade.enabled=!0),s.factor<1&&t.crossFade.enabled?s.factor=r?ze((e-t.startTime)/(nft*r),0,1):1:s.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,s.factor=1,Oe(n,t.parallaxNew.anchorPointClouds),t.renderingStage===Yn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Yn.SWITCH_CHANNELS))}function Vfe(t,e,r,i){const s=t.fadeInOutHeight,n=s.stage===ob.FINISHED?r:t.startTimeHeightFade;if(i!==0){const o=(r-n)/(oft*i);s.factor+=e?-o:o}else s.factor=e?0:1;t.startTimeHeightFade=r,s.factor=ze(s.factor,0,1),s.stage=ob.HEIGHT_FADE}function tft(t,e,r,i,s){t.renderingStage===Yn.FINISHED_RENDERING&&(t.renderingStage=Yn.FADING_TEXTURE_CHANNELS);const n=st(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=n-gi.radius>Pp?1:0),t.isCameraPositionFinal=Zv(t.cameraPositionLastFrame,e.eye),qe(lg,e.eye),Me(lg,lg,gi.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&Oe(o.anchorPointClouds,lg);const a=st(Be(ift,o.anchorPointClouds,lg));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==bh.FINISHED?Jpt(t,i,s):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==na.FINISHED?Kpt(t,i,s):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===Yn.FADING_TEXTURE_CHANNELS?eft(t,i,s,(r!==Ei.IDLE||!bse(t.data))&&t.renderingStage!==Yn.FADING_TEXTURE_CHANNELS):l=!1;const c=n-gi.radius;if((c>1.7*Pp||c<-Pp)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>Pp||c<-.35*Pp)&&t.fadeInOutHeight.factor<1?Vfe(t,!1,i,s):c<Pp&&c>-.35*Pp&&t.fadeInOutHeight.factor>0?Vfe(t,!0,i,s):t.fadeInOutHeight.stage=ob.FINISHED,t.renderingStage===Yn.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=Yn.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-gi.radius*gi.radius,0))/n,kfe(zfe,o.anchorPointClouds,iS),Ih(o.transform,Hd,iS[3],iS),l){const{parallaxNew:h}=t;kfe(zfe,h.anchorPointClouds,iS),Ih(h.transform,Hd,iS[3],iS)}Oe(t.cameraPositionLastFrame,e.eye)}function rft(t){return t.crossFade.enabled||t.fadeInOut.stage!==na.FINISHED||t.fadeIn.stage!==bh.FINISHED||t.fadeInOutHeight.stage!==ob.FINISHED||t.renderingStage!==Yn.FINISHED}const zfe=ct(0,0,1),iS=VL(),lg=V(),ift=V(),LPe=1,sft=.5,nft=1.3,oft=1;let ZM=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){var i;return(i=this._outer.get(e))==null?void 0:i.get(r)}set(e,r,i){const s=this._outer.get(e);s?s.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var so;function Gfe(t=Le("enable-feature:high-quality-idle")){const e=new ZM;return t&&(e.set(Ei.INTERACTING,so.Antialiasing,!0),e.set(Ei.IDLE,so.Antialiasing,!0),e.set(Ei.INTERACTING,so.HighQualityTransparency,!0),e.set(Ei.IDLE,so.HighQualityTransparency,!0),e.set(Ei.INTERACTING,so.RealisticAtmosphere,!0),e.set(Ei.IDLE,so.RealisticAtmosphere,!0),e.set(Ei.IDLE,so.SSAO,!0),e.set(Ei.IDLE,so.WaterReflection,!0),e.set(Ei.IDLE,so.PhysicalPixelRendering,!0)),e.set(Ei.ANIMATING,so.ShadowMapUpdate,!0),e.set(Ei.INTERACTING,so.ShadowMapUpdate,!0),e.set(Ei.IDLE,so.ShadowMapUpdate,!0),e.set(Ei.IDLE,so.HighQualityVoxel,!0),e}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighQualityVoxel=2]="HighQualityVoxel",t[t.RealisticAtmosphere=3]="RealisticAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.ShadowMapUpdate=6]="ShadowMapUpdate",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(so||(so={}));var l3;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(l3||(l3={}));var qP;const aft=[et.POSTPROCESSING_ENVIRONMENT_OPAQUE,et.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Ta=qP=class extends Ke{constructor(t){super(t),this._context=null,this._atmosphere=null,this._hqAtmosphere=null,this._oldWeatherParameters=new YG,this._newWeatherParameters=new YG,this._fadedWeatherParameters=new YG,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(aft,this)}destroy(){var t;this.removeHandles(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return E(this._hqAtmosphere)&&this.view._stage.renderer.isFeatureEnabled(so.RealisticAtmosphere)?this._hqAtmosphere:this._atmosphere}get _atmosphereType(){return E(this.atmosphere)?this.atmosphere.type:sa.None}get canRender(){var t;return!!((t=this.view.basemapTerrain)!=null&&t.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._atmosphereType===sa.Realistic}updateAnimation(t){return!!E(this._precipitation)&&this._precipitation.update(t)}get updating(){return E(this._stars)&&this._stars.updating||E(this._clouds)&&this._clouds.running}get weatherVisible(){return st(this.view.state.camera.eye)-es(this.view.spatialReference).radius<=Pp}get _stars(){var i;const t=this.view,e=((i=t.environment)==null?void 0:i.starsEnabled)??!1,r=this._get("_stars");return!e||N(this._context)?(gt(r),null):E(r)?r:new I1({view:t,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||N(this._context))return gt(t),null;const e=this.view,r=this._context;return E(t)&&t.context===r?t:(gt(t),new m2({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||N(this._context))return gt(t),null;if(E(t))return t;const e=this.view,r=this._context;return gt(t),new vu({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||N(this._context))return gt(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=es(this.view.spatialReference).radius;return E(t)&&t.viewingMode===e&&t.planetRadius===i?t:(gt(t),new p2({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||N(this._context))return gt(t),null;if(E(t))return t;const e=this.view,r=this._context;return new jP({context:r,view:e})}get _simpleHaze(){const t=this._get("_simpleHaze");if(!this.weatherEnabled||N(this._context))return gt(t),null;if(E(t))return t;const e=this.view,r=this._context;return new HP({context:r,view:e})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([Nl(()=>{var r;return(r=this.view)==null?void 0:r.basemapTerrain},()=>this._updateBasemapTerrain(),ao),xe(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),r=>this._updateAtmosphere(r),ao),xe(()=>this._stars,e),xe(()=>this._precipitation,e),xe(()=>this._clouds,()=>this._updateWeather(),Cr),xe(()=>this._fog,()=>this._updateFogHaze(),Cr),xe(()=>this._simpleHaze,()=>this._updateFogHaze(),Cr),xe(()=>this.view.state.mode,()=>{this._setNeedsRender()},os),xe(()=>this._atmosphereType,()=>this._updateBasemapTerrain(),ao),xe(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},ao)])}uninitializeRenderContext(){this._context=null,this._atmosphere=gt(this._atmosphere),this._hqAtmosphere=gt(this._hqAtmosphere),this._set("_stars",gt(this._stars)),this._set("_precipitation",gt(this._precipitation)),this._set("_clouds",gt(this._clouds)),this._set("_cloudsComposition",gt(this._cloudsComposition)),this._set("_fog",gt(this._fog)),this._set("_simpleHaze",gt(this._simpleHaze))}prepareRender(t){t.bindParameters.cloudsFade.data=Kut(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&(tft(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===Yn.FINISHED&&E(this._clouds)&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){if(t.output===ee.Color)switch(t.bindParameters.slot){case et.POSTPROCESSING_ENVIRONMENT_OPAQUE:E(this._stars)&&this._stars.render(t),E(this.atmosphere)&&(this.atmosphere.render(t),E(this._cloudsComposition)&&E(t.bindParameters.cloudsFade.data)&&(this.weatherVisible&&E(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),rft(t.bindParameters.cloudsFade)&&E(this._context)&&this._context.requestRender());break;case et.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(E(this.atmosphere)&&(this.atmosphere.renderHaze(t,this._weatherParameters.haze.amount),this._weatherParameters.haze.amount>0&&this._atmosphereType!==sa.Realistic&&E(this._simpleHaze)&&this._simpleHaze.render(t,this._weatherParameters.haze),this._weatherParameters.fog.amount>0&&E(this._fog)&&this._fog.render(t,this._weatherParameters.fog),E(this._precipitation))){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(t,e.precipitation,e.type)}}}updateLightSources(t,e,r,i){if(E(this._context)){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=r,s.bindParameters.newLighting.set(t),i===l3.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return N(t)?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===bh.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===na.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;N(t)||N(this._clouds)||(this._clouds.applyPreset(ql[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){E(this._context)&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(N(this._fog)||N(this._simpleHaze)||N(t)||N(this._context))return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=Sr(3e-5,.005,t.weatherAdjustment**3),Oe(this._newWeatherParameters.fog.color,jfe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===sa.Realistic?1:0,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Sr(4e-6,2e-4,(t.effect??0)**3),Oe(this._newWeatherParameters.fog.color,lft),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Sr(4e-6,2e-4,(t.effect??0)**3),Oe(this._newWeatherParameters.fog.color,jfe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===sa.Realistic?1:0,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.haze.strength=4e-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(E(this._atmosphere)?this._atmosphere.type===e:e===sa.None)return;this._atmosphere=gt(this._atmosphere),this._hqAtmosphere=gt(this._hqAtmosphere);const r=this._getAtmosphereClass(e);r&&E(this._context)&&(this._atmosphere=new r(this.view,this._context),e===sa.Simple&&(this._hqAtmosphere=new LG(this.view,this._context))),this._setNeedsRender(),this._updateBasemapTerrain()}_getAtmosphereClass(t){switch(t){case sa.Realistic:return LG;case sa.Panoramic:return Zdt;case sa.Simple:return dpt;default:case sa.None:return null}}_selectAtmosphereType(t){const{enabled:e,quality:r,viewingMode:i}=t;return!e||jg(this.view.spatialReference)?sa.None:i===_t.Local?sa.Panoramic:E(this._context)&&r==="high"&&LG.isSupported(this._context)&&F$(this.view.spatialReference)?sa.Realistic:sa.Simple}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=this._atmosphereType===sa.Simple)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),stubGetAtmosphereClass:t=>{Hfe=qP.prototype._getAtmosphereClass,qP.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{qP.prototype._getAtmosphereClass=Hfe}}}};u([d({constructOnly:!0})],Ta.prototype,"view",void 0),u([d({readOnly:!0})],Ta.prototype,"atmosphere",null),u([d({readOnly:!0})],Ta.prototype,"_atmosphereType",null),u([d({type:Boolean,readOnly:!0})],Ta.prototype,"updating",null),u([d({readOnly:!0})],Ta.prototype,"weatherVisible",null),u([d()],Ta.prototype,"_context",void 0),u([d()],Ta.prototype,"_atmosphere",void 0),u([d()],Ta.prototype,"_hqAtmosphere",void 0),u([d({readOnly:!0})],Ta.prototype,"_stars",null),u([d({readOnly:!0})],Ta.prototype,"_precipitation",null),u([d({readOnly:!0})],Ta.prototype,"_clouds",null),u([d({readOnly:!0})],Ta.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],Ta.prototype,"_fog",null),u([d({readOnly:!0})],Ta.prototype,"_simpleHaze",null),u([d({readOnly:!0})],Ta.prototype,"weatherEnabled",null),u([d({readOnly:!0})],Ta.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],Ta.prototype,"_weatherUpdateParameters",null),Ta=qP=u([j("esri.views.3d.environment.EnvironmentRenderer")],Ta);let YG=class{constructor(){this.fog=new hdt,this.haze=new gpt}copyFrom(e){this.fog.amount=e.fog.amount,this.haze.amount=e.haze.amount,this.fog.strength=e.fog.strength,this.haze.strength=e.haze.strength,Oe(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=Sr(e.fog.amount,r.fog.amount,i),this.haze.amount=Sr(e.haze.amount,r.haze.amount,i),this.fog.strength=Sr(e.fog.strength,r.fog.strength,i),this.haze.strength=Sr(e.haze.strength,r.haze.strength,i),fo(this.fog.color,e.fog.color,r.fog.color,i)}};const lft=ct(.5,.5,.5),jfe=ct(1.5,1.5,1.5);let Hfe;function qfe(t,e,r){if(N(e.longitude)||N(e.latitude)||N(r.longitude)||N(r.latitude))throw new Error("Invalid points: no lon/lat");return cft(t,e.longitude,e.latitude,r.longitude,r.latitude)}function cft(t,e,r,i,s){const n=$r(r),o=$r(s),a=n-o,l=$r(e)-$r(i),c=Math.sin(a/2),h=Math.sin(l/2),p=2*rf(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*t;return Math.round(1e4*p)/1e4}function uft(t,e,r){const i=e.spatialReference,s=es(i),n=new Gt(e.x,t.y,i),o=new Gt(r.x,t.y,i),a=new Gt(t.x,e.y,i),l=new Gt(t.x,r.y,i);return{lon:qfe(s.radius,n,o),lat:qfe(s.radius,a,l)}}function hft(t,e,r){const i=e/r,s=$r(t),n=Math.sin(i/2),o=Math.cos(s),a=2*rf(Math.sqrt(n*n/(o*o)));return Kc(a)}function dft(t,e){let r=t/15;return e||(r=Math.round(r)),r}function Wfe(t,e){const r=t==null?void 0:t[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=dft(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}var Yfe,Qfe,Xfe,LJ={},pft={get exports(){return LJ},set exports(t){LJ=t}};Yfe=pft,Qfe=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function A(W){return W.valueOf()/l-.5+c}function _(W){return new Date((W+.5-c)*l)}function w(W){return A(W)-h}var T=23.4397*a;function C(W,q){return n(e(W)*r(T)-i(q)*e(T),r(W))}function M(W,q){return s(e(q)*r(T)+r(q)*e(T)*e(W))}function O(W,q,X){return n(e(W),r(W)*e(q)-i(X)*r(q))}function $(W,q,X){return s(e(q)*e(X)+r(q)*r(X)*r(W))}function L(W,q){return a*(280.16+360.9856235*W)-q}function k(W){return a*(357.5291+.98560028*W)}function F(W){return a*(1.9148*e(W)+.02*e(2*W)+3e-4*e(3*W))}function G(W,q){return W+q+102.9372*a+t}function z(W,q){var X=k(W),se=G(X,F(X));return q||(q={dec:0,ra:0}),q.dec=M(se,0),q.ra=C(se,0),q}var Z={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(W,q,X,se){var ae=a*-X,fe=a*q,ue=w(W),Re=z(ue,p),De=L(ue,ae)-Re.ra;return se||(se={azimuth:0,altitude:0}),se.azimuth=O(De,fe,Re.dec),se.altitude=$(De,fe,Re.dec),se}},J=[[-.83,"sunrise","sunset"]];Z.addTime=function(W,q,X){J.push([W,q,X])};var te=9e-4;function re(W,q){return Math.round(W-te-q/(2*t))}function Ae(W,q,X){return te+(W+q)/(2*t)+X}function ve(W,q,X){return h+W+.0053*e(q)-.0069*e(2*X)}function ye(W,q,X){return o((e(W)-e(q)*e(X))/(r(q)*r(X)))}function le(W){var q=a*(134.963+13.064993*W),X=a*(93.272+13.22935*W),se=a*(218.316+13.176396*W)+6.289*a*e(q),ae=5.128*a*e(X),fe=385001-20905*r(q);return{ra:C(se,ae),dec:M(se,ae),dist:fe}}return Z.getTimes=function(W,q,X){var se=a*-X,ae=a*q,fe=re(w(W),se),ue=Ae(0,se,fe),Re=k(ue),De=F(Re),Ue=G(Re,De),Je=M(Ue,0),vt=ve(ue,Re,Ue);function lt(Tr){return ve(Ae(ye(Tr,ae,Je),se,fe),Re,Ue)}function Ye(Tr){var Er=(e(Tr)-e(ae)*e(Je))/(r(ae)*r(Je));return Er<-1?Z.PolarException.MIDNIGHT_SUN:Er>1?Z.PolarException.POLAR_NIGHT:Z.PolarException.NORMAL}var ut,ht,Jt,Pt,xr,Ir={solarNoon:_(vt),nadir:_(vt-.5),polarException:Z.PolarException.NORMAL};for(ut=0,ht=J.length;ut<ht;ut+=1)xr=vt-((Pt=lt((Jt=J[ut])[0]*a))-vt),Ir[Jt[1]]=_(xr),Ir[Jt[2]]=_(Pt);return Ir.polarException=Ye(J[0][0]*a),Ir},Z.getMoonPosition=function(W,q,X){var se=a*-X,ae=a*q,fe=w(W),ue=le(fe),Re=L(fe,se)-ue.ra,De=$(Re,ae,ue.dec);return De+=.017*a/i(De+10.26*a/(De+5.1*a)),{azimuth:O(Re,ae,ue.dec),altitude:De,distance:ue.dist}},Z.getMoonFraction=function(W){var q=w(W),X=z(q),se=le(q),ae=149598e3,fe=o(e(X.dec)*e(se.dec)+r(X.dec)*r(se.dec)*r(X.ra-se.ra)),ue=n(ae*e(fe),se.dist-ae*r(fe));return(1+r(ue))/2},Z},(Xfe=Qfe())!==void 0&&(Yfe.exports=Xfe);const oT=LJ,rg={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function fft(t,e,r,i,s,n){$e(n.ambient.color,1,1,1),n.ambient.intensity=rg.global.ambient,$e(n.direct.color,1,1,1),n.direct.intensity=rg.global.direct;const o=e[2],a=ze((Math.abs(o)-rg.local.altitude)/(rg.global.altitude-rg.local.altitude),0,1);let l;if(n.globalFactor=a,E(t)&&(l=oT.getTimes(t,e[1],e[0])),a<1){let c;if(E(t))c=bft(t,l,i);else{const h=FPe(i);c={direct:{intensity:rg.local.directAtNoon*h.direct,color:ct(1,1,1)},ambient:{intensity:rg.local.ambientAtNoon*h.ambient,color:ct(1,1,1)},timeOfDay:"early afternoon"}}fo(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=Sr(c.ambient.intensity,n.ambient.intensity,a),fo(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=Sr(c.direct.intensity,n.direct.intensity,a),n.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,n.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}n.noonFactor=E(t)?vft(t,l):1,E(t)?mft(t,e,r,n.direct.directionToLightSource):DPe(s,r,n.direct.directionToLightSource)}function DPe(t,e,r){e===_t.Global?qe(QG,t.eye):$e(QG,0,0,1),Me(XG,t.viewForward,-1);const i=p6(XG,QG),s=Math.max(i-2*ZG,0),n=.85*s/(s+1),o=Math.max(ZG,i-ZG-n);jd(Jfe,-o,t.viewRight),Mt(r,XG,Jfe),ke(r,r,Me(wft,t.viewRight,xft)),qe(r,r)}function mft(t,e,r,i){const s=_ft,n=cf(yft);if(r===_t.Global)oT.getPosition(t,0,0,s),$e(i,0,0,-1),z3(n,n,-s.azimuth),pU(n,n,-s.altitude),Mt(i,i,n);else{const o=rg.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=ze(c,0,1),c<1?(oT.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),$e(i,0,-1,0),G3(n,n,-s.azimuth),z3(n,n,-s.altitude),Mt(i,i,n)}}function gft(t,e){if(e===_t.Global)return!0;const r=rg.planarDirection;return Math.abs(t)<r.localAltitude}const Aft=ct(.5773502691896258,-.5773502691896258,.5773502691896258);let NPe=class{constructor(){this.ambient={color:ct(1,1,1),intensity:.55},this.direct={color:ct(1,1,1),intensity:.55,directionToLightSource:In(Aft)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const yft=ot(),_ft={azimuth:0,altitude:0};function vft(t,e){const r=t.valueOf();let i,s;e.polarException===oT.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=i+432e6):e.polarException===oT.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=i+(s-i)/2;return 1-ze(Math.abs(r-n)/432e5,0,1)}function FPe(t){switch(t){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function Zfe(t,e){const r=(t[0]+t[1]+t[2])/3;for(let i=0;i<3;i++)t[i]=t[i]+(r-t[i])*e;return t}function bft(t,e,r){const i=t.valueOf();let s,n;e.polarException===oT.PolarException.MIDNIGHT_SUN?(s=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===oT.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,A=s-p/2,_=s+p/2,w=n-p/2,T=n+p/2,C=rg.local,M=[.01,C.ambientAtNight],O=[.8,.8,1],$=[.01,.01,.01],L=[C.directAtTwilight,C.ambientAtTwilight],k=[1,.6,.5],F=[.8,.8,1],G=[.9*C.directAtNoon,C.ambientAtNoon],z=[1,.98,.98],Z=[.98,.98,1],J=[C.directAtNoon,C.ambientAtNoon],te=[1,1,1],re=[1,1,1],Ae=G,ve=z,ye=Z,le=L,W=k,q=F;let X,se,ae=[0,0],fe=[0,0,0],ue=[0,0,0];i<A||i>T?(ae=M,fe=$,ue=O,se="night"):i<_?(X=_-A,ae=yl(i-A,X,M,L),fe=yl(i-A,X,$,k),ue=yl(i-A,X,O,F),se="sun rising"):i<c?(X=c-_,ae=yl(i-_,X,L,G),fe=yl(i-_,X,k,z),ue=yl(i-_,X,F,Z),se="early morning"):i<a?(X=a-c,ae=yl(i-c,X,G,J),fe=yl(i-c,X,z,te),ue=yl(i-c,X,Z,re),se="late morning"):i<h?(X=h-a,ae=yl(i-a,X,J,Ae),fe=yl(i-a,X,te,ve),ue=yl(i-a,X,re,ye),se="early afternoon"):i<w?(X=w-h,ae=yl(i-h,X,Ae,le),fe=yl(i-h,X,ve,W),ue=yl(i-h,X,ye,q),se="late afternoon"):i<T&&(X=T-w,ae=yl(i-w,X,le,M),fe=yl(i-w,X,W,$),ue=yl(i-w,X,q,O),se="sun setting");let Re=0;switch(r){case"rainy":case"foggy":case"snowy":Re=.5}Re>0&&(fe=Zfe(fe,Re),ue=Zfe(ue,Re));const De=ct(fe[0],fe[1],fe[2]),Ue=ct(ue[0],ue[1],ue[2]),Je=FPe(r);return{direct:{intensity:ae[0]*Je.direct,color:De},ambient:{intensity:ae[1]*Je.ambient,color:Ue},timeOfDay:se}}function yl(t,e,r,i){const s=[];for(let n=0;n<r.length;n++)s[n]=(i[n]-r[n])*t/e+r[n];return s}const Jfe=ot(),QG=V(),XG=V(),wft=V(),ZG=.25,xft=.2;let Wf=class extends Nn.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new ts,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new y9,this._ambientLight=new Mse,this._moonLight=new GOe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,r,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(r=this._view)==null?void 0:r.state)==null?void 0:i.viewingMode)===_t.Global&&F$(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Ta({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this._viewHandles.add([xe(()=>e.environment.lighting,s=>this._updateLightingHandler(s),os),xe(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),os),xe(()=>e.stationary,()=>this._interactingStationaryHandler()),xe(()=>e.environment.lighting.directShadowsEnabled,r,os),xe(()=>e.environment.lighting.ambientOcclusionEnabled,r,os),xe(()=>e.environment.lighting.waterReflectionEnabled,r,os),xe(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},r,os),xe(()=>e.spatialReference,()=>this._resetReferencePosition(!0),os),xe(()=>e.environment.weather.type,()=>this._updateLighting(null,l3.Faded),os),xe(()=>this.weatherEnabled,()=>this._updateLighting(null,l3.Faded),os),xe(()=>e.viewingMode,()=>this._resetReferencePosition(!0),ao),xe(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),ao),xe(()=>e.state.camera,i,ao),xe(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=gt(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;(r==null?void 0:r.type)!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if((r==null?void 0:r.type)!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!qx(i)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),E(this._referencePosWGS84Comparable)){const s=Wfe(this._referencePosWGS84Comparable,Kfe);E(s)&&(r.autoUpdate(null,s),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=F$(this._view.spatialReference);if(i&&!qx(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return N(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=V()),i?Hqe(s,this._referencePosWGS84Comparable):$e(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=l3.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const s=this._referencePosWGS84Comparable,n=E(s)?Tft:Sft,o=this.weatherVisible?i.environment.weather.type:"disabled";E(s)?fft(e,s,i.state.viewingMode,o,i.state.camera,n):i.environment.lighting.type==="virtual"&&DPe(i.state.camera,i.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;Me(a.intensity,l.color,l.intensity*Math.PI),Oe(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;Me(c.intensity,n.ambient.color,n.ambient.intensity);const h=this._moonLight;fo(h.intensity,Cft,Mft,n.globalFactor);const p=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));Me(h.intensity,h.intensity,p),Oe(h.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,h],n.noonFactor,n.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||N(e))return!1;const i=Eft;i.setTime((r||this._view.environment.lighting.date).getTime());const s=Wfe(e,Kfe);if(N(s))return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=i.getUTCHours()-(s.hours-n.hours),a=i.getUTCMinutes()-(s.minutes-n.minutes),l=i.getUTCSeconds()-(s.seconds-n.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=Ed(this._referencePosWGS84Comparable,!0,n=>gft(n[2],this._view.state.viewingMode)),i=this._view.environment.background,s=i instanceof zRe?{type:"color",color:kre(Ot.toUnitRGBA(i.color))}:{type:"color",color:Nr(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=Ix(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const n=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=Ix(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};u([d({type:Boolean,readOnly:!0})],Wf.prototype,"updating",null),u([d()],Wf.prototype,"disableQueries",void 0),u([d()],Wf.prototype,"_disableWeather",void 0),u([d()],Wf.prototype,"weatherEnabled",null),u([d()],Wf.prototype,"weatherVisible",null),u([d()],Wf.prototype,"referencePositionWGS84Comparable",null),u([d()],Wf.prototype,"_renderer",void 0),u([d()],Wf.prototype,"_referencePosWGS84Comparable",void 0),Wf=u([j("esri.views.3d.environment.SceneViewEnvironmentManager")],Wf);const Tft=new NPe,Sft=new NPe,Eft=new Date,Kfe={hours:0,minutes:0,seconds:0},Cft=ct(.22,.22,.33),Mft=ct(.22,.22,.22);var Ws;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Ws||(Ws={}));var Jr;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(Jr||(Jr={}));var Ua;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(Ua||(Ua={}));function x4(t,e){return(t&e)!=0}function T9(t,e,r,i,s,n){t!==0&&(r?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):i!=null?(n.min-=Math.max(0,(e-n.min)*(1-i)),n.max+=Math.max(0,(e-n.max)*(1-i))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const ub={selection:Ws.NONE,interactionType:Jr.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Ua.TUMBLE};function kPe(t,e,r,i){return e=e||t.viewForward,Oe(i,e),Me(i,i,Math.sign(He(e,r))),i}function Rft(t,e,r,i){return Lft(t,e,r,Ift(i,e,r,!0))}function Oft(t,e,r,i){const s=He(r,Be(t,i,e));return ke(t,e,Me(t,r,s))}const Pft={dir:V(),len:0,clip:Dt()};function Ift(t,e,r,i){const s=Pft;return t?(r&&i&&(s.len=Is(e,r)),Oe(s.dir,t)):i?(s.len=Is(e,r),Be(s.dir,r,e),Me(s.dir,s.dir,1/s.len)):(Be(s.dir,r,e),qe(s.dir,s.dir)),s}function $ft(t,e,r){const i=He(t,r.dir),s=-Rs(t,e);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function Lft(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!$ft(t[s],e,i))return!1;return!0}function Dft(t,e,r=ub){const i=Yse(t,e,r);if(i===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+i,o=kPe(e,r.interactionDirection,kft(t,e,Math.sign(i),zft),Vft),a=Oe(Gft,e.viewForward),l=s.intersectInfiniteManifold(qd(e.eye,o),n,JG);return e.eye=E(l)?l:s.setAltitude(JG,n,e.eye),e.center=Oft(JG,e.eye,a,e.center),!0}function Yse(t,e,r=ub){if(!Nft(t,r)||!t.state.constraints.altitude)return 0;const i=Bft(t.state.constraints.altitude,Uft);Fft(t,r,i);const s=t.renderCoordsHelper.getAltitude(e.eye),n=ze(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function Nft(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==Jr.TUMBLE||!x4(e.selection,Ws.TILT))}function Fft(t,e,r){const i=e.interactionType;if(i===Jr.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Jr.TUMBLE||i===Jr.ZOOM,c=Yse(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,T9(c,h,l,a,.05*h,r)}function kft(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),Me(i,i,r),i}function Bft(t,e){return e.min=t.min,e.max=t.max,e}const Uft={min:0,max:0},Vft=V(),zft=V(),Gft=V(),JG=V();function Qse(t,e,r=ub){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;N5.min=0,N5.max=i,Hft(t,r,N5);const s=Xse(t,e),n=N5.max-s;return n>=-1e-6?0:n}function jft(t,e,r=ub){const i=Qse(t,e,r);if(i===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=Xse(t,e)+i,o=Oe(Wft,e.eye),a=kPe(e,r.interactionDirection,qft(e,s.renderLocation,Xft),Qft);if(!Mb(gSe(s.renderLocation,n),qd(e.eye,a),F5))return!1;e.eye=F5;const l=Be(Yft,e.eye,o);e.center=ke(F5,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,F5);return E(h)&&(e.center=h),!0}function Hft(t,e,r){const i=e.interactionType;if(i===Jr.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Jr.ZOOM||i===Jr.PAN,c=Qse(t,o),h=c===0?0:Xse(t,o);r.min=s,r.max=n,T9(c,h,l,a,.05*h,r)}function Xse(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?Is(e.eye,r.renderLocation):0}function qft(t,e,r){return Yy(r,t.eye,e)}const N5={min:0,max:0},Wft=V(),Yft=V(),Qft=V(),Xft=V(),F5=V();var pn,dl;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(pn||(pn={}));let Zft=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=dl.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(dl||(dl={}));let Jft=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},Kft=class extends Jft{constructor(e,r,i,s){super(e,r,i),this.center=E(s)?In(s):null}},BPe=class{constructor(e){this.layerUid=e}},u7=class extends BPe{constructor(e,r){super(e),this.graphicUid=r}};function J0(t){return E(t)&&E(t.dist)}function e0e(t){return(e,r,i)=>(fo(t0e,e,r,i),!Wre(t,t0e))}function h7(t){return J0(t)&&t.intersector===pn.OBJECT&&!!t.target}function d7(t){return J0(t)&&t.intersector===pn.HUD&&!!t.target&&"center"in t.target&&E(t.target.center)}const t0e=V();let e0t=class{constructor(){this._transform=ot(),this._transformInverse=new k5({value:this._transform},ul,ot),this._transformInverseTranspose=new k5(this._transformInverse,zh,ot),this._transformTranspose=new k5({value:this._transform},zh,ot),this._transformInverseRotation=new k5({value:this._transform},COe,mn)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){ma(this._transform,e)}multiplyTransform(e){$n(this._transform,this._transform,e)}set(e){ma(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},k5=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},t0t=class{constructor(e=0){this.offset=e,this.tmpVertex=V()}applyToVertex(e,r,i){const s=e+this.localOrigin[0],n=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=e+s*a,this.tmpVertex[1]=r+n*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(e){for(let n=0;n<3;++n)O_[n]=e[0+n]+this.localOrigin[n],B5[n]=e[3+n]+this.localOrigin[n],sS[n]=O_[n];const r=this.applyToVertex(O_[0],O_[1],O_[2]);for(let n=0;n<3;++n)e[n]=r[n],e[n+3]=r[n];const i=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)e[a+0]=Math.min(e[a+0],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)sS[o]=n&1<<o?B5[o]:O_[o];i(sS)}let s=0;for(let n=0;n<3;++n)O_[n]*B5[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if(!(s&n)){for(let o=0;o<3;++o)s[o]?sS[o]=0:sS[o]=n&1<<o?O_[o]:B5[o];i(sS)}}for(let n=0;n<3;++n)e[n+0]-=this.localOrigin[n],e[n+3]-=this.localOrigin[n];return e}};const O_=V(),B5=V(),sS=V();let r0t=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=V(),this._mbs=Io(),this._obb={center:V(),halfSize:Ks(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,r,i){const s=e,n=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=e+s*a,this._tmpVertex[1]=r+n*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(e){const r=e[0],i=e[1],s=e[2]+this.componentLocalOriginLength,n=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=r*n<0?0:Math.min(Math.abs(r),Math.abs(n)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return e[0]-=r<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=s<0?this._totalOffset:0,e[3]+=n>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const A=Math.max(Math.abs(r),Math.abs(n)),_=Math.max(Math.abs(i),Math.abs(o)),w=Math.max(Math.abs(s),Math.abs(a)),T=Math.sqrt(A*A+_*_+w*w),C=this._totalOffset/T,M=this._totalOffset/p;return e[0]+=r*(r>0?C:M),e[1]+=i*(i>0?C:M),e[2]+=s*(s>0?C:M),e[3]+=n*(n<0?C:M),e[4]+=o*(o<0?C:M),e[5]+=a*(a<0?C:M),e}applyToMbs(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/r;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/r,this._mbs}applyToObb(e){const r=e.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,I0(this._obb.halfSize,e.halfSize,e.quaternion),ke(this._obb.halfSize,this._obb.halfSize,e.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,Be(this._obb.halfSize,this._obb.halfSize,e.center),nT(n0e,e.quaternion),I0(this._obb.halfSize,this._obb.halfSize,n0e),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},i0t=class{constructor(e=0){this.offset=e,this.sphere=Io(),this.tmpVertex=V()}applyToVertex(e,r,i){const s=this.objectTransform.transform;let n=s[0]*e+s[4]*r+s[8]*i+s[12],o=s[1]*e+s[5]*r+s[9]*i+s[13],a=s[2]*e+s[6]*r+s[10]*i+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const s=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*s,r[1]+=r[1]*s,r[2]+=r[2]*s}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/r;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const r0e=new i0t;function DJ(t){return E(t)?(r0e.offset=t,r0e):null}const i0e=new r0t;function s0t(t){return E(t)?(i0e.offset=t,i0e):null}const s0e=new t0t;function n0t(t){return E(t)?(s0e.offset=t,s0e):null}const rv="terrain",n0e=gf(),uM=1e-5;let o0t=class{constructor(e){this.options=new Zft,this._results=new a0t,this.transform=new e0t,this.tolerance=uM,this.verticalOffset=null,this._ray=Na(),this._rayEnd=V(),this._rayBeginTransformed=V(),this._rayEndTransformed=V(),this.viewingMode=e??_t.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(yWe(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&kk(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===_t.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,ke(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,s,n){this.point=r,this.filterPredicate=s,this.tolerance=i??uM;const o=DJ(this.verticalOffset);if(E(e)&&e.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();E(c)?(E(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.transformation,s=DJ(this.verticalOffset);for(const n of r){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(i,n.shaderTransformation),Mt(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Mt(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;E(s)&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,p,A,_,w)=>{if(c>=0){if(E(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const T=A?this._results.hud:this._results,C=A?M=>{const O=new Kft(e,a,p,w);M.set(pn.HUD,O,c,h,Hd,_)}:M=>M.set(pn.OBJECT,{object:e,geometryId:a,triangleNr:p},c,h,l,_);if((T.min.drapedLayerOrder==null||_>=T.min.drapedLayerOrder)&&(T.min.dist==null||c<T.min.dist)&&C(T.min),this.options.store!==dl.MIN&&(T.max.drapedLayerOrder==null||_<T.max.drapedLayerOrder)&&(T.max.dist==null||c>T.max.dist)&&C(T.max),this.options.store===dl.ALL)if(A){const M=new NJ(this._ray);C(M),this._results.hud.all.push(M)}else{const M=new c3(this._ray);C(M),this._results.all.push(M)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?gr(r.dist,0)-gr(i.dist,0):r.drapedLayerOrder!==i.drapedLayerOrder?gr(r.drapedLayerOrder,Number.MAX_VALUE)-gr(i.drapedLayerOrder,Number.MAX_VALUE):gr(i.drapedLayerGraphicOrder,Number.MIN_VALUE)-gr(r.drapedLayerGraphicOrder,Number.MIN_VALUE))}};function pf(t){return new o0t(t)}let a0t=class{constructor(){this.min=new c3(Na()),this.max=new c3(Na()),this.hud={min:new NJ(Na()),max:new NJ(Na()),all:new Array},this.ground=new c3(Na()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},c3=class{get ray(){return this._ray}get distanceInRenderSpace(){return E(this.dist)?(Me(U5,this.ray.direction,this.dist),st(U5)):null}getIntersectionPoint(e){return!!J0(this)&&(Me(U5,this.ray.direction,this.dist),ke(e,this.ray.origin,U5),!0)}getTransformedNormal(e){return Oe(qR,this.normal),qR[3]=0,Ld(qR,qR,this.transformation),Oe(e,qR),qe(e,e)}constructor(e){this.intersector=pn.OBJECT,this.normal=V(),this.transformation=ot(),this._ray=Na(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=pn.OBJECT,kk(e,this._ray)}set(e,r,i,s,n,o,a){this.intersector=e,this.dist=i,Oe(this.normal,gr(s,c2e)),ma(this.transformation,gr(n,Hd)),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){kk(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Oe(this.normal,e.normal),ma(this.transformation,e.transformation)}},NJ=class extends c3{constructor(){super(...arguments),this.intersector=pn.HUD}};function Zse(t){return new c3(t)}const U5=V(),qR=Zr();function UPe(t,e,r,i){return E(t.renderCoordsHelper.fromRenderCoords(e.eye,S9,i))&&Txe(r,S9)}function p7(t,e){return t.elevationProvider?gr(t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground"),0):0}function OT(t,e,r,i){const s=t.state.camera.clone();e&&r&&i&&(s.eye=e,s.center=r,s.up=i),l0t(t,s.ray,P_)||Oe(P_,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(cl(s.eye,P_)<o){const a=n.collision.enabled;Oe(Jb,s.viewForward),Me(Jb,Jb,o),a?s.eye=Be(S9,P_,Jb):ke(P_,s.eye,Jb);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(Be(Jb,P_,s.eye),s.eye=l.setAltitude(S9,h,s.eye),ke(P_,s.eye,Jb))}return s.center=P_,s}function o0e(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=p7(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,r,t.renderDataExtent,i,u0t),o=n*n;return cl(e,r)>o}function l0t(t,e,r){let i=a0e[t.viewingMode];i||(i=pf(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,a0e[t.viewingMode]=i);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||o0e(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||o0e(t,e.origin,r))||!!s&&c0t(e,r,es(t.spatialReference).radius)}function c0t(t,e,r){const i=He(t.origin,t.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return Me(e,t.direction,s/st(t.direction)),ke(e,e,t.origin),!0}const a0e={},S9=V(),P_=V(),Jb=V(),u0t={near:0,far:0};function JM(t,e,r=Wp.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const s=p7(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=st(e.eye);if(Be(V5,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(h0t,o,e.eye),r===Wp.EYE_AND_CENTER)e.center=ke(V5,e.eye,V5);else if(r===Wp.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=Me(V5,e.center,l)}return!0}var Wp;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Wp||(Wp={}));const V5=V(),h0t=V();function hb(t,e,r){t.worldUpAtPosition(e,l0e),Be(KG,r,e);const i=st(KG);return i===0?0:Zo(He(KG,l0e)/i)}const l0e=V(),KG=V();function VPe(t,e,r=ub,i=!0){WR.eyeCenterDistance=0,WR.requiresTwoSteps=!1;const s=Jse(t,e,r,void 0,WR);if(s===0)return!1;switch(jd(z5,-s,e.viewRight),r.tiltMode){case Ua.LOOK_AROUND:Mt(I_,e.viewForward,z5),Me(I_,I_,WR.eyeCenterDistance),e.center=ke(iv,e.eye,I_);break;case Ua.TUMBLE:Be(I_,e.center,e.eye),Mt(I_,I_,z5),e.eye=Be(iv,e.center,I_);break;default:r.tiltMode}return e.up=Mt(iv,e.up,z5),!WR.requiresTwoSteps||!i||VPe(t,e,r,!1)}function Jse(t,e,r=ub,i=ub,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,b0t);return v0t(t,r,o),i.interactionType===Jr.TUMBLE&&x4(i.selection,Ws.ALTITUDE)&&zPe(t,i.interactionStartCamera,o),r.tiltMode===Ua.LOOK_AROUND||i.tiltMode===Ua.LOOK_AROUND?p0t(t,e,o,s):d0t(t,e,o)}function d0t(t,e,r){const i=hb(t.renderCoordsHelper,e.center,e.eye),s=i-ze(i,r.min,r.max);return T4(s)?s:0}function p0t(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return m0t(t,e,r,i);case"local":return f0t(t,e,r,i)}}function f0t(t,e,r,i){const s=hb(t.renderCoordsHelper,e.center,e.eye),n=ze(s,r.min,r.max),o=s-n;if(!T4(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function m0t(t,e,r,i){const s=g0t(t,e,w0t),n=ze(s.tiltAtCenter,r.min,r.max);if(!T4(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=A0t(s),a=y0t(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=_0t(s,o)),i&&(i.eyeCenterDistance=FJ(s,o)),a}function g0t(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+es(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,i,iv);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,E(n)?(r.eyeCenterDistance=Is(e.eye,n),r.tiltAtCenter=hb(t.renderCoordsHelper,n,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=hb(t.renderCoordsHelper,e.center,e.eye):(BM(vU(bU,s),e.ray,iv),r.eyeCenterDistance=Is(e.eye,iv),r.tiltAtCenter=Zo(-He(e.viewForward,qe(iv,iv)))),r.radius=s,r.eyeRadius=st(e.eye),r.constraints=t.state.constraints,r}function T4(t){return Math.abs(t)>1e-9}function A0t(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let s=i,n=e.clampTilt(r,i);const o=FJ(t,n);if(e.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&T4(n-s);){const l=(s+n)/2,c=FJ(t,l);T4(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function FJ(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-ze(e,0,Math.PI),i=rf(t.radius/t.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return n*t.eyeRadius}function y0t(t,e){const r=rf(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=rf(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function _0t(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function v0t(t,e,r){if(e.interactionType===Jr.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=e;if(!i)return;const{min:n,max:o}=r,a=Jse(t,i,ub,e),l=a===0?0:hb(t.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,e.interactionType===Jr.TUMBLE?(x4(e.selection,Ws.ALTITUDE)&&zPe(t,i,r),T9(a,l,!0,s,c0e,r)):T9(a,l,!1,s,c0e,r)}function zPe(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const s=Jl(e.center),n=Math.sqrt(s),o=e.distance,a=es(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-Zo(p),r.max)),r.max=Math.min(r.max,Math.PI-Zo(h))}const I_=V(),z5=ot(),iv=V(),c0e=$r(5),b0t={min:0,max:0},w0t={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},WR={eyeCenterDistance:0,requiresTwoSteps:!1};function x0t(t){return t}const f7=t=>t*t,Kse=t=>1-f7(1-t),T0t=t=>t<.5?f7(2*t)/2:(Kse(2*(t-.5))+1)/2,ene=t=>t*t*t,GPe=t=>1-ene(1-t),jPe=t=>t<.5?ene(2*t)/2:(GPe(2*(t-.5))+1)/2,tne=t=>t*t*t*t,HPe=t=>1-tne(1-t),S0t=t=>t<.5?tne(2*t)/2:(HPe(2*(t-.5))+1)/2,rne=t=>t*t*t*t*t,qPe=t=>1-rne(1-t),E0t=t=>t<.5?rne(2*t)/2:(qPe(2*(t-.5))+1)/2,ine=t=>1-Math.cos(t*Math.PI/2),WPe=t=>1-ine(1-t),C0t=t=>t<.5?ine(2*t)/2:(WPe(2*(t-.5))+1)/2,sne=t=>2**(10*(t-1)),zL=t=>1-sne(1-t),M0t=t=>t<.5?sne(2*t)/2:(zL(2*(t-.5))+1)/2,nne=t=>-(Math.sqrt(1-t*t)-1),YPe=t=>1-nne(1-t),R0t=t=>t<.5?nne(2*t)/2:(YPe(2*(t-.5))+1)/2;function yf(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function _f(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const O0t=_f(yf(1),1),P0t=_f(yf(1),0),QPe=_f(yf(1),.5),I0t=_f(yf(2),1),$0t=_f(yf(2),0),L0t=_f(yf(2),.5),D0t=_f(yf(3),1),N0t=_f(yf(3),0),F0t=_f(yf(3),.5),k0t=_f(yf(4),1),B0t=_f(yf(4),0),U0t=_f(yf(4),.5),V0t={linear:x0t,"in-quad":f7,"out-quad":Kse,"in-out-quad":T0t,"in-coast-quad":O0t,"out-coast-quad":P0t,"in-out-coast-quad":QPe,"in-cubic":ene,"out-cubic":GPe,"in-out-cubic":jPe,"in-coast-cubic":I0t,"out-coast-cubic":$0t,"in-out-coast-cubic":L0t,"in-quart":tne,"out-quart":HPe,"in-out-quart":S0t,"in-coast-quart":D0t,"out-coast-quart":N0t,"in-out-coast-quart":F0t,"in-quint":rne,"out-quint":qPe,"in-out-quint":E0t,"in-coast-quint":k0t,"out-coast-quint":B0t,"in-out-coast-quint":U0t,"in-sine":ine,"out-sine":WPe,"in-out-sine":C0t,"in-expo":sne,"out-expo":zL,"in-out-expo":M0t,"in-circ":nne,"out-circ":YPe,"in-out-circ":R0t};function lo(t,e,r=H0t,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<q0t;a++){let l=0;for(const c of j0t)if(x4(r.selection,c.type)){const h=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(s=!0,l+=h)}if(l===0)break}const n=x4(r.selection,Ws.COLLISION),o=z0t(r.interactionType,t);return n&&JM(t,i,o)&&(s=!0),s&&i.computeUp(t.state.viewingMode),s}function z0t(t,e){switch(t){case Jr.PAN:return Wp.EYE_AND_CENTER;case Jr.ASCEND:return e.state.isGlobal?Wp.EYE_AND_CENTER_SCALE:Wp.EYE_AND_CENTER;default:return Wp.EYE}}function f0(t){const e=Math.min(1,t/150);return jPe(e)}function G0t(t,e,r){return Jse(t,e,r)*e.distance}const j0t=[{type:Ws.TILT,error:G0t,apply:VPe},{type:Ws.ALTITUDE,error:Yse,apply:Dft},{type:Ws.DISTANCE,error:Qse,apply:jft}],H0t={selection:Ws.ALL,interactionType:Jr.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Ua.TUMBLE},q0t=5,Zh=V(),Xu=V(),$_=V(),Vl=V(),Kb=V(),W0t=V(),Jh={upward:ct(0,0,1),forward:ct(0,1,0),sideway:ct(1,0,0)},u0e=mn();let h0e=class{constructor(e=_t.Global){this.viewingMode=e,this.center=V(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=In(Jh.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===_t.Global){const n=(st(this.center)+st(e.center))/2;r.pan=p6(this.center,e.center)*n}else r.pan=Is(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===_t.Global?$We(e.center,r.center,i.pan,this.center):fo(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?Sr(e.distance,r.distance,i.zoom):e.distance,this.pitch=Sr(e.pitch,r.pitch,i.rotate);let s=e.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=Sr(s,n,i.rotate)}copyFrom(e){Oe(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,Oe(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,u0e);Oe(this.center,e.center),Be(Vl,e.center,e.eye),Ph(Vl,Vl,r),Ph(Kb,e.up,r),this.distance=st(Vl),this.distance!==0&&(Vl[0]/=this.distance,Vl[1]/=this.distance,Vl[2]/=this.distance),this.pitch=this._eyeUpToPitch(Vl),this.yaw=this._eyeUpToYaw(Vl,Kb),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,u0e);df(r,r),this._axisAngleVec3(Jh.sideway,this.pitch-Math.PI/2,Jh.forward,Vl),this._axisAngleVec3(Jh.upward,this.yaw,Vl),this._axisAngleVec3(Jh.sideway,this.pitch-Math.PI/2,Jh.upward,Kb),this._axisAngleVec3(Jh.upward,this.yaw,Kb),Me(Vl,Vl,this.distance),Ph(Vl,Vl,r),Ph(Kb,Kb,r),e.center=this.center,e.eye=Be(Vl,this.center,Vl),e.up=Kb}_axisAngleVec3(e,r,i,s=i){const n=Math.cos(r),o=Math.sin(r);return Me(Zh,i,n),Xt(Xu,e,i),Me(Xu,Xu,o),Me($_,e,(1-n)*He(e,i)),ke(s,ke(s,Zh,Xu),$_)}_lookAtOrientation(e,r=mn()){return this._upAtLookAt(e,$_),Xt(Zh,this.lookAtDirection,$_),qe(Zh,Zh),Zh[0]===0&&Zh[1]===0&&Zh[2]===0&&Oe(Zh,Jh.sideway),Xt(Xu,$_,Zh),qe(Xu,Xu),r[0]=Zh[0],r[1]=Xu[0],r[2]=$_[0],r[3]=Zh[1],r[4]=Xu[1],r[5]=$_[1],r[6]=Zh[2],r[7]=Xu[2],r[8]=$_[2],r}_upAtLookAt(e,r){return this.viewingMode===_t.Local?Oe(r,Jh.upward):qe(r,e)}_eyeUpToPitch(e){return Math.PI-p6(Jh.upward,e)}_eyeUpToYaw(e,r){const i=W0t;return Math.abs(r[2])<.5?(Oe(i,r),e[2]>0&&Me(i,i,-1)):Oe(i,e),Xt(Xu,i,Jh.upward),qe(Xu,Xu),p6(Jh.sideway,Xu,Jh.upward)}};const E9={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let Y0t=class XPe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:E9.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new XPe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:E9.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},Q0t=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),n.hasPan&&!isNaN(r.pan)&&isFinite(n.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/n.compared.pan:r.pan=1,n.hasRotate&&!isNaN(r.rotate)&&isFinite(n.compared.rotate)?r.rotate=(s+l.compared.rotate*r.rotate)/n.compared.rotate:r.rotate=1,n.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-h)/(p-h)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},ej=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const n=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}};function X0t(t,e,r){const i=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function Z0t(t,e,r){const i=1/e,s=Math.log(t.compared.sourceZoom*i),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function J0t(t,e,r){const i=e-t.compared.sourceZoom,s=1/i,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function K0t(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function emt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function tmt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function rmt(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function imt(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function smt(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function nmt(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function omt(t,e,r){const i=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*s*n*a+t.halfWindowSize*i*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function amt(t,e,r){const i=e-t.compared.targetZoom,s=1/i,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function lmt(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function cmt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function umt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function hmt(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),s=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?s*(e-i):s*(e+i)}function dmt(t,e){let r=pmt(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?K0t:X0t,a=s?emt:Z0t,l=s?tmt:J0t,c=n?lmt:nmt,h=n?cmt:omt,p=n?umt:amt,A=L=>o(t,L,i)+rmt(t,L,i)+c(t,L,i),_=L=>a(t,L,i)+imt(t,L,i)+h(t,L,i),w=L=>l(t,L,i)+smt(t,L,i)+p(t,L,i);let T=A(r);const C=hmt(t);let M;const O=e.maximumIterations||20,$=e.maximumDistance!=null?e.maximumDistance:1/0;for(M=0;M<O;M++){const k=(_(r)+1e-6)/w(r);if(isNaN(k)||r>=$&&k<0){if(!isFinite($))return null;r=$,T=A(r);break}if(r-=k,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const F=A(r);if(Math.abs(F-T)/T<=.005)break;T=F}return T>C*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function pmt(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let fmt=class extends Q0t{constructor(e,r){super(),this._preallocSegments=[new ej,new ej,new ej],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r&&r.apex&&(i=dmt(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=Kse(i.zoom):e===this._descensionSegment&&(i.zoom=f7(i.zoom)),i}_updateWithApex(e,r){const[i,s,n]=this._preallocSegments,o=(r==null?void 0:r.ascensionFactor)??.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const mmt={zoom:0,pan:0,rotate:0};let gmt=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new Y0t(e),this.path=new fmt}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(Mbe(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing?i.easing:this._time>=1e3?QPe:zL}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,mmt);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const s=r.minDuration!=null?r.minDuration:E9.minDuration/i,n=r.maxDuration!=null?r.maxDuration:E9.maxDuration/i;return Math.min(Math.max(s,e),n)}};const Amt=V();let ymt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new gmt(()=>new h0e(e)),this._current=new h0e(e)}update(e,r,i){const s=this._animation.definition.source,n=this._animation.definition.target,o=Be(Amt,r.center,e.center),a=st(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),Oe(s.lookAtDirection,o),Oe(n.lookAtDirection,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new hr,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+Mbe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};var Tn;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(Tn||(Tn={}));let ry=class extends Ke{constructor(e){super(e),this.state=Tn.Ready}get active(){return this.state===Tn.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Tn.Stopped,!0)}finishController(){this.state=Tn.Finished}get steppingFinished(){return!1}};u([d({constructOnly:!0})],ry.prototype,"view",void 0),u([d({readOnly:!0})],ry.prototype,"active",null),u([d()],ry.prototype,"state",void 0),u([d({readOnly:!0})],ry.prototype,"isInteractive",null),ry=u([j("esri.views.3d.state.controllers.CameraController")],ry);let S4=class extends ry{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Yi()),this._asyncResult=null),this.state===Tn.Finished||this.state===Tn.Stopped?(DB(e),this.state===Tn.Finished?e.resolve():e.reject(Yi())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Tn.Running,E(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!E(this.viewAnimation)||this.state!==Tn.Ready&&this.state!==Tn.Running||(this.viewAnimation.state===iM.State.FINISHED?this.finish():this.viewAnimation.state===iM.State.STOPPED&&(this.state=Tn.Stopped))}onControllerEnd(){E(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===Tn.Finished?this.viewAnimation.finish():this.state===Tn.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Tn.Finished?this._asyncResult.resolve():this._asyncResult.reject(Yi()))}finish(){this.finishController()}};S4=u([j("esri.views.3d.state.controllers.AnimationController")],S4);let py=class extends S4{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new ymt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new iM}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);G5.copyFrom(this.view.state.camera);const s=pf(this.view.state.viewingMode);this.intersectionHelper.intersectRay(G5.ray,s,d0e)&&(G5.center=d0e),this.animation.update(G5,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?V0t[e.easing]:e.easing}}};u([d({constructOnly:!0})],py.prototype,"mode",void 0),u([d({readOnly:!0})],py.prototype,"isInteractive",null),py=u([j("esri.views.3d.state.controllers.PointToPointAnimationController")],py);const G5=new hr,d0e=V();function m7(t=vmt){return[t[0],t[1],t[2],t[3]]}function E4(t,e){return _mt(t[0],t[1],t[2],e,Bre.get())}function _mt(t,e,r,i,s=m7()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function one(t,e,r){return Xt(r,t,e),qe(r,r),r[3]=zre(t,e),r}const vmt=[0,0,1,0];function ZPe(t,e,r){return bmt(t,t.screenToRender(e,Tt.get()),r)}function bmt(t,e,r){const i=ga(Tt.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const s=ga(Tt.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,Tt.get());return N(n)?null:(Be(r.direction,n,r.origin),r)}function KM(t,e,r){return ane(t,t.screenToRender(e,Tt.get()),r)}function ane(t,e,r){Oe(r.origin,t.eye);const i=$e(Tt.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(i,Tt.get());return N(s)?null:(Be(r.direction,s,r.origin),r)}function lne(t,e,r,i){const s=KM(e,r,wmt);return Mb(t,s,i)}const wmt=Na();var hM;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(hM||(hM={}));const JPe=30,C9=[1,3e8],g7=80,KPe=8,eIe=200,tIe=1508e5,rIe=5,iIe=50,xmt=5,Tmt=10,tj=90,PT={exclude:new Set([rv])};function vx(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function kJ(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function db(t,e,r){const i=jd(Ure.get(),r[3],r);N(i)||vTe(i,Hd)||(Be(fs,t.eye,e),Mt(fs,fs,i),t.eye=ke(fs,fs,e),Be(fs,t.center,e),Mt(fs,fs,i),t.center=ke(fs,fs,e),t.up=Mt(fs,t.up,i))}function Smt(t,e,r,i){return ST(t,ZPe(e,r,hne),i)}function BJ(t,e,r,i){return ST(t,KM(e,r,hne),i)}function cne(t,e,r,i){const s=Tt.get();let n=1-r;Be(s,e,t.eye);const o=st(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(Me(s,s,n),t.eye=ke(fs,t.eye,s),t.center=fo(fs,t.center,e,n))}function sIe(t,e,r){e.getScreenCenter(p0e),lne(t,e,p0e,fs)&&(e.center=fs);const i=e.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=Me(Tt.get(),e.viewForward,s);e.eye=Be(fs,e.center,n)}const p0e=Sn();function rj(t,e){$e(e,0,0,0);for(const r of t)ke(e,e,r);Me(e,e,1/t.length)}function s8(t,e,r,i){return Math.sin(t/st(e))*(r+i.radius)}function f0e(t,e,r,i){return s8(Math.PI/2,e,r,i)+(t-Math.PI/2)}var Fa;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(Fa||(Fa={}));const m0e={Elevation:3e4,Angle:$r(16)},j5={Pole:.95,Angle:$r(18),Tilt:45},nIe=$r(80);function oIe(t,e,r,i,s,n){const o=V(),a=Io();let l=!0,c=!0;return t.intersectScreen(r,o,n)?a[3]=st(o):(c=!1,e.aboveGround&&s!==hM.Ellipsoid?a[3]=Math.max(st(e.center),.9*i.radius):a[3]=st(e.eye)-e.relativeElevation,s===hM.Silhouette?C4(a,e,r,o):l=lne(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function A7(t,e,r){return st(t.eye)-r.radius>m0e.Elevation?Fa.Horizontal:(KM(t,e,x0e),-Math.sign(t.relativeElevation)*(.5*Math.PI+zre(t.eye,x0e.direction))<m0e.Angle?Fa.Vertical:Fa.Horizontal)}function aIe(t,e,r){Be(ij,r,e),t.eye=Be(fs,t.eye,ij),t.center=Be(fs,t.center,ij)}const ij=V();function C4(t,e,r,i){const s=KM(e,r,hne);return!N(s)&&(BM(t,s,H5),Mb(t,s,i)?!(cl(H5,s.origin)<cl(i,s.origin))||(Oe(i,H5),!1):(Be(nS,e.eye,e.center),qe(nS,nS),TSe(nS,-He(qe(nS,nS),H5),g0e),ST(g0e,s,i),!1))}const H5=V(),nS=V(),g0e=Hi();function lIe(t,e,r,i,s,n){let o=0;if(Xt(O9,t,e),Be(Q5,t,e),st(t)<=s||!i.aboveGround){Xt(r,Q5,i.eye);const a=He(t,e)/(st(t)*st(e));if(a<.9999)o=Zo(a);else{const c=st(Xt(V(),t,e))/(st(t)*st(e));o=rf(c)}const l=Math.cos(ze(Kv.normalize($r(n)),0,nIe));o=-o-Math.max(0,st(e)-s)/(l*s)}else Be(A0e,i.eye,i.center),Xt(r,Q5,A0e),o=-st(Q5)/s;return qe(r,r),Me(r,r,st(O9)),o}const A0e=V();function y0e(t,e,r,i){let s,n;const o=Math.cos(ze(Kv.normalize($r(i)),0,nIe));return s=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):Zo(e/r),n=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):Zo(t/r),(n-s)*r}function Emt(t,e,r,i,s,n,o,a,l,c){const h=y0e(t[2],e[2],n[3],a),p=l?y0e(t[0],e[0],n[3],180):e[0]-t[0],A=Math.sin(o)*p-Math.cos(o)*h,_=Math.cos(o)*p+Math.sin(o)*h;qe(fs,s);const w=l?A/Math.sqrt(Math.abs(n[3]**2-He(r,fs)**2)):A/n[3],T=_/Math.sqrt(Math.abs(n[3]**2-He(r,i)**2));Kr(c,w,T)}function cIe(t,e,r,i,s,n,o,a,l,c){Xt(O9,t,e),bQ(n.up,n.eye,q5,W5,Y5),bQ([0,0,1],n.eye,wy,Gv,pIe),Oe(r,Gv),Oe(i,wy),qe(r,r),Me(r,r,st(O9)),yue(t,qe(W5,W5),qe(Y5,Y5),qe(q5,q5),_0e),yue(e,W5,Y5,q5,v0e),Emt(_0e,v0e,t,wy,Gv,o,a,l,c,s)}function Cmt(t,e,r,i,s,n,o){jd(M9,s,i),jd(R9,o,n),$n(TC,M9,R9),Be(e,t,r),Mt(e,e,TC),ke(e,e,r)}function uIe(t,e,r,i,s,n){jd(M9,i,r),jd(R9,n,s),$n(TC,M9,R9),Be(fs,t.eye,e),Mt(fs,fs,TC),t.eye=ke(fs,fs,e),Be(fs,t.center,e),Mt(fs,fs,TC),t.center=ke(fs,fs,e),Be(fs,t.up,e),Mt(fs,fs,TC),t.up=ke(fs,fs,e)}function une(t,e,r,i,s,n){return(Math.abs(i)>Math.PI-j5.Angle||Math.abs(i)<j5.Angle)&&(Math.abs(t[2])<r*j5.Pole||Math.abs(e)>r)&&n.aboveGround&&s<j5.Tilt}function hIe(t,e,r,i,s,n){if(n)one(r,i,b0e),db(e,t,b0e);else{const o=lIe(r,i,w0e,e,t[3],s);db(e,t,E4(w0e,o))}}function dIe(t,e,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,h;Oe(ew,i),X5.copyFrom(e);for(let p=0;p<a&&cl(r,ew)>l&&(c=cl(r,ew),cIe(r,ew,Gv,wy,YR,X5,t,s,n,o),uIe(X5,t,wy,YR[1],Gv,YR[0]),Cmt(ew,ew,t,wy,YR[1],Gv,YR[0]),h=cl(r,ew),h<c||p===0);p++)e.copyFrom(X5)}function Mmt(t,e,r,i,s,n,o){une(r,He(e.up,r),t[3],-Kv.normalize($r(s)),n,e)?dIe(t,e,r,i,-Kv.normalize($r(s)),n,o):hIe(t,e,r,i,n,o)}function Rmt(t,e,r,i,s,n){const{eye:o}=t;bQ([0,0,1],o,wy,Gv,pIe);const a=e.translation[0]*r.pan,l=s.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-He(t.center,wy)**2/st(t.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(Ih(i.pan.matrix,i.pan.matrix,h,wy),i.pan.enabled=!0,s.mode){case"pan":Ih(i.pan.matrix,i.pan.matrix,p,Gv),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function Omt(t,e,r,i,s){const{eye:n,viewRight:o}=t,a=Xt(Tt.get(),o,n),l=e.translation[0]*r.pan;switch(l!==0&&(Ih(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(Ih(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function Pmt(t,e,r,i,s,n,o,a,l){une(t.center,He(t.up,t.center),st(t.center),-Kv.normalize($r(n)),o,e)?Rmt(e,r,i,a,l,-Kv.normalize($r(s))):Omt(e,r,i,a,l)}const wy=V(),Gv=V(),pIe=V(),q5=V(),W5=V(),Y5=V(),_0e=V(),v0e=V(),YR=Dt(),b0e=m7(),M9=ot(),R9=ot(),TC=ot(),ew=V(),fs=V(),Q5=V(),X5=new hr,O9=V(),w0e=V(),hne={origin:V(),direction:V()},x0e={origin:V(),direction:V()},T0e=.6,sj=4,Imt=60;let P9=class extends py{constructor(){super(...arguments),this._zoomLocation=V(),this._tmpCamera=new hr,this._tmpViewDir=V(),this._tmpRayDir={origin:V(),direction:V()},this._targetOnSphere=V(),this._tmpCenter=V(),this._constraintOptions={selection:Ws.ALL_EXCEPT_COLLISION,interactionType:Jr.ZOOM,interactionFactor:null,interactionStartCamera:new hr,interactionDirection:null,tiltMode:Ua.TUMBLE},this._sphere=Io()}initialize(){this._intersector=pf(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s));let n=!1,o=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?PT:{})&&(n=e>0,o=!0),this._tmpCamera.copyFrom(i.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:Oe(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:zL}}_updateCamera(e,r,i,s,n){const o=es(this.view.spatialReference),a=A7(e,s,o),l=Math.abs(this.view.camera.position.z);qe(J5,e.eye),Me(J5,J5,-1),KM(e,s,this._tmpRayDir),qe(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=ze(Math.min(KPe,1/Math.abs(He(J5,this._tmpRayDir.direction)))*l,eIe,tIe);if(a===Fa.Horizontal){let h=T0e**r;this._sphere[3]=st(i),Be(this._tmpViewDir,e.center,e.eye);const p=Math.min(st(this._tmpViewDir),c);let A=p*h;if(h<=1&&A<sj&&(A=sj,h=A/p),Math.abs(p-A)<1e-6)return;const _=st(e.center);if(this._sphere[3]!==_){const w=this._sphere[3]+h*(_-this._sphere[3]);e.center=Me(Z5,e.center,w/_)}Me(this._tmpViewDir,this._tmpViewDir,-h),e.eye=ke(Z5,e.center,this._tmpViewDir),lo(this.view,e,this._constraintOptions),cl(i,e.center)>1e-12&&lne(this._sphere,e,s,this._targetOnSphere)&&Mmt(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let h=T0e**Math.abs(r);const p=r>0?1:-1;Be(this._tmpViewDir,i,e.eye);const A=st(this._tmpViewDir),_=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,Imt);let w=E(_)?_:c;w=n&&r>0?Math.min(w,A):w,Me(this._tmpRayDir.direction,this._tmpRayDir.direction,w),ke(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let T=w*h;const C=Math.max(sj,1.01*e.nearFar[0]);if(r>0&&T<C&&(T=C,h=T/w),Math.abs(w-T)<1e-6)return;Me(this._tmpRayDir.direction,this._tmpRayDir.direction,p*(1-h)),e.eye=ke(Z5,e.eye,this._tmpRayDir.direction),e.center=ke(Z5,e.center,this._tmpRayDir.direction)}JM(this.view,e)}};P9=u([j("esri.views.3d.state.controllers.global.ZoomStepController")],P9);const Z5=V(),J5=V(),$mt=.6,Lmt=4,Dmt=60;let I9=class extends py{constructor(){super(...arguments),this._zoomLocation=V(),this._tmpCamera=new hr,this._tmpRayDir=V(),this._tmpCenter=V(),this._constraintOptions={selection:Ws.ALL,interactionType:Jr.ZOOM,interactionFactor:null,interactionStartCamera:new hr,interactionDirection:null,tiltMode:Ua.TUMBLE}}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s)),this._tmpCamera.copyFrom(i.camera);const n=pf(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?PT:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:Oe(this._zoomLocation,this._tmpCamera.center);const a=$mt**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r[0],r[1],this.view.state.camera,Dmt);Be(K5,this._tmpCamera.eye,this._zoomLocation),qe(K5,K5);const c=ze(Math.min(KPe,1/Math.abs(He(Nmt,K5)))*Math.abs(this.view.camera.position.z),eIe,tIe);if(l=E(l)?l:c,l){const h=V();Be(h,this._zoomLocation,this._tmpCamera.eye),(l<st(h)||!o)&&(qe(h,h),ke(this._zoomLocation,this._tmpCamera.eye,Me(h,h,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:zL}}_updateCamera(e,r,i){Be(this._tmpRayDir,i,e.eye);const s=st(this._tmpRayDir);let n=s*r;const o=r<=1,a=Math.max(Lmt,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,r=n/s),Math.abs(s-n)<1e-6||(Me(this._tmpRayDir,this._tmpRayDir,r),e.eye=Be(S0e,i,this._tmpRayDir),e.center=fo(S0e,e.center,i,1-r),lo(this.view,e,this._constraintOptions)))}};I9=u([j("esri.views.3d.state.controllers.local.ZoomStepController")],I9);const S0e=V(),Nmt=ct(0,0,1),K5=V();function Fmt(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function dne(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let kmt=class extends fl{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(Fmt(r,"primary")){const i=this._view.state.isGlobal?new P9({view:this._view,mode:"animation"}):new I9({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Sn(r.x,r.y)),e.stopPropagation()}}};function Bmt(t,e,r){return t===_t.Global?new Vmt(r):new Umt(e,r)}let Umt=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=es(r),this._unitInMeters=tu(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,s,n){var $;n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=($=this._elevationProvider)==null?void 0:$.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(i=E(i)?i:new Ki({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},p=Math.max(h.x,h.y,h.z);Be(tw,r,e),oS[0]=tw[0]>0?i.xmax:i.xmin,oS[1]=tw[1]>0?i.ymax:i.ymin,oS[2]=tw[2]>0?p/2:-p/2,Be(oS,oS,e),qe(tw,tw);const A=1.1*He(oS,tw)*this._unitInMeters,_=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),w=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),T=w*jmt*this._unitInMeters,C=w*Hmt*this._unitInMeters,M=ze((o-C)/(T-C),0,1)**3,O=Math.min(Sr(_,A,M),_)*Math.max(Math.log(Math.abs(l)),1);return fIe(Math.min(O,Math.max(34064e4,p))/this._unitInMeters,zmt,this._unitInMeters,n)}},Vmt=class{constructor(e){this._referenceEllipsoid=es(e)}compute(e,r,i,s,n){n||(n={near:0,far:0});const o=st(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),h=Math.max(c,Math.abs(a)),p=Math.sqrt(h*(h+2*l)),A=o+this._referenceEllipsoid.radius;return fIe(1.2*Sr(p,A,use(h)),ze(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,n)}};function fIe(t,e,r,i){const s=Gmt/r;return t/e>s?(i.far=t,i.near=i.far/e):(i.near=s,i.far=i.near*e),i}const zmt=2e4,Gmt=2,jmt=.001,Hmt=1e-4,oS=V(),tw=V();let n8=class extends Ke{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;E(e.spatialReference)&&UPe(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>JM(this.view,e,Wp.EYE_AND_CENTER))}};u([d({constructOnly:!0})],n8.prototype,"view",void 0),n8=u([j("esri.views.3d.state.ElevationCollisionConstraint")],n8);let WP=class extends Ke{constructor(e){super(e),this.nearFarHeuristic=Bmt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([xe(()=>{var e,r,i,s;return[(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.near,(s=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),xe(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),xe(()=>this.view.renderDataExtent,()=>this._updateNearFar(),os),xe(()=>{var e,r,i,s;return[(r=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:r.min,(s=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),os),xe(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.max},()=>this._updateTiltMax(),os),xe(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.mode},()=>this._updateTilt(),os),xe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),os),xe(()=>{var e,r,i,s,n,o;return[(i=(r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.navigationConstraint)==null?void 0:i.type,(o=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),os)]),this.view.state.isLocal&&this.addHandles(xe(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Cr)),this._updateNearFar(),this.view.state.viewingMode!==_t.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new n8({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var r;const e=(r=this.view.constraints)==null?void 0:r.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,p7(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){var s,n,o;const e=(o=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:o.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(Ws.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==_t.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt($r(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(Kc(i))}}_updateLocalSurfaceDistance(e){if(N(e))return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,s=3*r/Math.atan(i.camera.fov/2);s!==i.constraints.distance&&(i.constraints.distance=s)}_reapplyConstraints(e=Ws.ALL){this.view.state.updateCamera(r=>lo(this.view,r,{selection:e,interactionType:Jr.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Ua.TUMBLE}))}};u([d({constructOnly:!0})],WP.prototype,"view",void 0),u([d({readOnly:!0})],WP.prototype,"surfaceCollisionConstraint",void 0),WP=u([j("esri.views.3d.state.ConstraintsManager")],WP);let sv=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=v4(),this._points=FOe(),this.lines=new Array(12),this._origin=V(),this._direction=V(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:V(),endpoint:null}}update(e){kOe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),Oe(this._origin,e.eye),Oe(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)Oe(this._points[r],e[r]);BOe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return xv(this.frustum,e)}intersectsRay(e){return Bht(this.frustum,e)}intersectsLineSegment(e,r){return Uht(this.frustum,e,r)}intersectsPoint(e){return UOe(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;nj(this.lines[r],e[r],e[i]),nj(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),nj(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function nj(t,e,r){t.origin=e,t.endpoint=r,Yy(t.direction,e,r)}sv.planePointIndices=Vht,sv.nearFarLineIndices=[[zt.NEAR_BOTTOM_LEFT,zt.FAR_BOTTOM_LEFT],[zt.NEAR_BOTTOM_RIGHT,zt.FAR_BOTTOM_RIGHT],[zt.NEAR_TOP_RIGHT,zt.FAR_TOP_RIGHT],[zt.NEAR_TOP_LEFT,zt.FAR_TOP_LEFT]];let YI=class extends ry{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e),this._handles=new ts}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Tn.Running,this._handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this._handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){E(e.spatialReference)&&!UPe(this.view,this.desiredCamera,e.extent,e.spatialReference)||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),JM(this.view,e,Wp.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Tn.Stopped)})}};u([d({constructOnly:!0})],YI.prototype,"desiredCamera",null),YI=u([j("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],YI);const qmt=V(),eN=V();function pne(){return{direction:V(),up:V()}}function mIe(t,e,r,i,s){let n=qe(qmt,t),o=He(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(He(e,i)),o<.99?(Oe(n,e),a&&Me(n,n,-1)):n=null);let l=0;if(n){Me(eN,i,He(i,n)),Be(n,n,eN);const h=He(n,s)/(st(n)*st(s));Xt(eN,n,s),l=(He(eN,i)>0?1:-1)*Kc(Zo(h))}const c=Kc(Zo(-He(i,t)/st(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const gIe=ct(0,1,0),AIe=ct(0,0,1),QR=ot(),lA=V(),cA=V();function yIe(t,e,r,i=pne()){const{direction:s,up:n}=i;return pTe(QR,-$r(e)),z3(QR,QR,$r(r)),Mt(s,AIe,QR),Me(s,s,-1),Mt(n,gIe,QR),i}function Wmt(t,e,r,i){return mIe(e,r,i,AIe,gIe)}function Ymt(t,e,r,i){const s=yIe(t,r,i),n=V();return Me(n,s.direction,-e),ke(n,n,t),{up:s.up,eye:n,heading:r,tilt:i}}function Qmt(t){return Kc(t)}function Xmt(t){return $r(t)}function _Ie(t,e,r,i,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return Fl(e,lA,n),Fl(e,cA,n),lA[0]-=r/2,cA[0]+=r/2,lA[1]-=i/2,cA[1]+=i/2,Ba(lA,n,lA,o),Ba(cA,n,cA,o),s?(s.xmin=lA[0],s.ymin=lA[1],s.xmax=cA[0],s.ymax=cA[1],s.spatialReference=o):s=new Ki(lA[0],lA[1],cA[0],cA[1],o),s}const Zmt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Wmt,eyeForCenterWithHeadingTilt:Ymt,eyeTiltToLookAtTilt:Xmt,headingTiltToDirectionUp:yIe,lookAtTiltToEyeTilt:Qmt,toExtent:_Ie},Symbol.toStringTag,{value:"Module"})),vIe=ct(0,0,1),bIe=qe(V(),ct(1,1,1)),Jmt=new Jv(-180,180),XR=ot(),q1=V(),aS=V();function wIe(t,e,r,i=pne()){Xt(q1,t,vIe),He(q1,q1)===0&&Xt(q1,t,bIe),jd(XR,-$r(e),t),Ih(XR,XR,-$r(r),q1);const{up:s,direction:n}=i;return Xt(s,q1,t),qe(s,s),Mt(s,s,XR),qe(n,t),nc(n,n),Mt(n,n,XR),i}function Kmt(t,e,r,i){const s=q1,n=aS;return qe(s,t),Xt(aS,s,vIe),He(aS,aS)===0&&Xt(aS,s,bIe),Xt(n,aS,s),mIe(e,r,i,s,n)}function egt(t,e,r,i){const s={eye:V(),up:null,tilt:i,heading:r},n=q1;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=$r(r),l=$r(i),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),A=Math.cos(l),_=st(n);let w;if(Math.abs(l)<1e-8)w=o+_;else{const le=_/p,W=rf(o/le),q=Math.PI-l-W;w=le*Math.sin(q)}const T=A*o,C=o*o*(p*p),M=h*h*C,O=w-T,$=O*O,L=M*(M+$-n[1]*n[1]);if(L<0)return Me(s.eye,n,w/_),s.tilt=0,tN(s,t);const k=Math.sqrt(L),F=n[1]*O,G=M+$;let z;if(z=h>0?-k+F:k+F,Math.abs(G)<1e-8)return _<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):Me(s.eye,n,w/_),s.tilt=0,oj(s.eye),tN(s,t);s.eye[1]=z/G;const Z=c*c*C,J=p*o,te=h*J*s.eye[1],re=s.eye[1]*s.eye[1],Ae=1-re,ve=Math.sqrt(Ae),ye=M*re+Z-2*te*ve*O+Ae*$;return Math.abs(ye)<1e-8?(Me(s.eye,n,w/_),s.tilt=0,oj(s.eye),tN(s,t)):(s.eye[0]=(Ae*(w*n[0]-T*n[0])-J*ve*(n[0]*s.eye[1]*h+n[2]*c))/ye,s.eye[2]=(Ae*(w*n[2]-T*n[2])-J*ve*(n[2]*s.eye[1]*h-n[0]*c))/ye,Me(s.eye,s.eye,w),oj(s.eye),tN(s,t))}function oj(t){const e=t[1];t[1]=-t[2],t[2]=e}function tN(t,e){const r=wIe(e,t.heading,t.tilt);return t.up=r.up,t}function tgt(t,e,r){const i=st(e),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),n=rf(r/(s/Math.sin(t)));return Kc(t-n)}function rgt(t,e,r){const i=$r(t),s=st(e);return rf(r/(s/Math.sin(i)))+i}function xIe(t,e,r,i,s){let n,o,a,l;const c=e.latitude,h=es(t.spatialReference).radius,p=e.longitude,A=hft(c,r,h)/2;n=p-A,o=p+A;const _=$r(c),w=(1+Math.sin(_))/(1-Math.sin(_)),T=(w+1)*Math.tan(i/h/2),C=T*T;function M($){const L=Math.PI/2;return($=DGe.normalize($,-L))>L&&($=Math.PI-$),$}if(a=1.5*Math.PI-2*Math.atan(.5*(T+Math.sqrt(4*w+C))),l=a+i/h,a=M(a),l=M(l),l<a){const $=l;l=a,a=$}if(a=Math.max(Kc(a),-90),l=Math.min(Kc(l),90),o=Jmt.monotonic(n,o),o-n>180){const $=(o-n-180)/2;n+=$,o-=$}const O=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:xt.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=O):s=new Ki(n,a,o,l,O),t.spatialReference&&t.spatialReference.isWebMercator&&gy(s,!1,s),s}const igt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Kmt,eyeForCenterWithHeadingTilt:egt,eyeTiltToLookAtTilt:rgt,headingTiltToDirectionUp:wIe,lookAtTiltToEyeTilt:tgt,toExtent:xIe},Symbol.toStringTag,{value:"Module"}));function $9(t){return t.type==="point"}let TIe=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function SIe(t){return"array"in t}function pg(t,e,r="ground"){if($9(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(SIe(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,gr(e.spatialReference,t.spatialReference),r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function L9(t,e){return t!=null&&(e==null||(e===_t.Local?!t.isGeographic||t.isWGS84||t.wkid===zp.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===zp.CGCS2000||t.wkid===zp.GCSMARS2000||t.wkid===zp.GCSMARS2000_SPHERE||t.wkid===zp.GCSMOON2000))}const EIe=we.getLogger("esri.views.3d.support.cameraUtils"),CIe=39.37,MIe=96,UJ=1,sgt=8,ngt=5,RIe=1,E0e=V(),ogt={heading:0,tilt:0},nv=new Gt,agt=new Jv(-20037508342788905e-9,20037508342788905e-9),lgt=new Jv(-180,180);var Pl;function GL(t){return t.spatialReference||xt.WGS84}function eR(t){return t.viewingMode==="global"?igt:Zmt}function cgt(t,e,r,i,s){return eR(t).headingTiltToDirectionUp(e,r,i,s)}function ZA(t,e){if(N(e))return null;const r=t.renderSpatialReference,i=eR(t).headingTiltToDirectionUp,s=V();if(!Fl(e.position,s,r))return null;const n=i(s,e.heading,e.tilt);Me(n.direction,n.direction,t.state.camera.distance),ke(n.direction,n.direction,s);const o=OT(t,s,n.direction,n.up);return o.fov=$r(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Pl||(Pl={}));const lS=V();function dM(t,e,r){const i=t.renderSpatialReference,s=y7(t,e.eye,e.viewForward,e.up,ogt);let n=GL(t);return Ba(e.eye,i,lS,n)||(n=xt.WGS84,Ba(e.eye,i,lS,n)),N(r)?new nf(new Gt(lS,n),s.heading,s.tilt,Kc(e.fov)):(r.position.x=lS[0],r.position.y=lS[1],r.position.z=lS[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=Kc(e.fov),r)}function fne(t,e,r){const i=t.state.camera,s=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===_t.Global&&r!=null&&(e*=Math.cos($r(r))),e/=t.renderCoordsHelper.unitInMeters,s/(MIe*CIe/e)/Math.tan(i.fovX/2)}function aT(t,e,r){const i=t.state.camera,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=MIe*CIe/(n/s);return t.renderCoordsHelper.viewingMode===_t.Global&&r!=null&&(o/=Math.cos($r(r))),o*=t.renderCoordsHelper.unitInMeters,o}function OIe(t,e,r,i,s,n){return PIe(t,e,fne(t,r,e.latitude),i,s,n)}function PIe(t,e,r,i,s,n){if(bx(n)){const a=new tR(n.signal);return M4(t,i.heading,i.tilt,e,r,s,a),void a.resolver.promise.then(l=>{const c=N9(t,l,i.fov);if(!N(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=M4(t,i.heading,i.tilt,e,r,s);return N9(t,o,i.fov,n)}function y7(t,e,r,i,s){return eR(t).directionToHeadingTilt(e,r,i,s)}function ugt(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,nv,t.spatialReference)&&t.elevationProvider&&gr(pg(t.elevationProvider,nv),0)>(nv.z??0)-RIe)}async function hgt(t,e,r){if(!t.renderCoordsHelper.fromRenderCoords(e,nv,t.spatialReference)||!t.elevationProvider)return!1;const i=nv.z??0,s=await t.elevationProvider.queryElevation(nv.x,nv.y,i,nv.spatialReference,"ground",r);return gr(s,0)>i-RIe}async function dgt(t,e,r){const i=V();if(e)if(e instanceof Gt){if(Fl(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const s=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",r);return E(s)&&t.renderCoordsHelper.setAltitude(i,s),i}}else Oe(i,e);else Oe(i,t.state.camera.center);return i}function pgt(t,e){const r=V();if(e&&e instanceof Gt){if(Fl(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const i=pg(t.elevationProvider,e);E(i)&&t.renderCoordsHelper.setAltitude(r,i)}}else Oe(r,e||t.state.camera.center);return r}function M4(t,e,r,i,s,n,o){const a=i&&i instanceof Gt?i:null;if(bx(o))return dgt(t,i,o.signal).then(c=>{VJ(t,e,r,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=pgt(t,i);return VJ(t,e,r,a,l,s,n,o)}function VJ(t,e,r,i,s,n,o,a){if(N(i)){const p=t.renderSpatialReference;if(i=rb(s,p,GL(t)),N(i))return null}n=Math.max(n,t.state.constraints.minimumPoiDistance);const l=ggt(t,e,r,s,n,o),c=(0,eR(t).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===Pl.ADJUST&&t.viewingMode==="global"&&r>0){const p=()=>{const _=IIe(t,s,n,ygt(t,n,r,s));return o=r-_<1?Pl.LOCKED:Pl.ADJUST,VJ(t,e,_,i,s,n,o,a)},A=t.map.ground.navigationConstraint;if(!A||A.type==="stay-above"){if(ugt(t,c.eye))return p();if(bx(a))return hgt(t,c.eye,a.signal).then(_=>_?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:In(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||bx(a)?{center:V(),eye:V(),up:V(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=In(s),h.heading=c.heading,h.tilt=c.tilt,bx(a)&&a.resolver.resolve(h),h}function QI(t,e,r,i,s,n=null){let o,a,l;if(t.state.isGlobal){if(!L9(e.spatialReference,_t.Global))return bx(n)&&n.resolver.reject(),null;const C=new Gt(e.xmin,e.ymin,e.spatialReference),M=new Gt(e.xmax,e.ymax,e.spatialReference),O=e.spatialReference.isGeographic?lgt:agt;o=new Gt({x:O.center(C.x,M.x),y:(M.y+C.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const $=es(e.spatialReference),L=uft(o,C,M);a=L.lon,l=L.lat,O.diff(C.x,M.x)>O.range/2&&(a+=$.halfCircumference),a=Math.min(a,$.halfCircumference),l=Math.min(l,$.halfCircumference)}else{const C=gr(t.renderSpatialReference,e.spatialReference);C.equals(e.spatialReference)||(e=TT(e,C)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const M=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new Gt({x:e.xmin+.5*a,y:e.ymin+.5*l,z:M,spatialReference:C})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,h=t.state.camera,p=1/Math.tan(h.fovX/2),A=1/Math.tan(h.fovY/2),_=1/Math.tan(h.fov/2),w=Math.max(.5*a*p,.5*l*A,.5*c*_)/UJ;if(bx(n)){const C=new tR(n.signal);return M4(t,r,i,o,w,s,C),void C.resolver.promise.then(M=>{const O=N9(t,M,t.camera.fov);if(!N(O))return n.resolver.resolve(O);n.resolver.reject()},M=>n.resolver.reject(M))}const T=M4(t,r,i,o,w,s);return N9(t,T,t.camera.fov,n)}function fgt(t,e,r){const i=t.renderSpatialReference,s=rb(r,i,GL(t));if(N(s))return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=hL(e.eye,r),l=2*a*n*UJ,c=2*a*o*UJ;return t.viewingMode==="global"?xIe(t,s,l,c):_Ie(t,s,l,c)}function mgt(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>sgt)return!0;const s=t.renderSpatialReference,n=GL(t),o=rb(e,s,n),a=rb(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(N(o)||N(a))return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>ngt}function ggt(t,e,r,i,s,n){let o=0;return n===Pl.ADJUST&&mgt(t,i,s)?(e=0,o=Agt(t,s,r,i)):o=mne(t,i,s,r),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:r=IIe(t,i,s,o)}}const D9=.7;function Agt(t,e,r,i){const s=mne(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-D9)+n.max*D9;return Math.min(s,o)}function ygt(t,e,r,i){let s=mne(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-D9)+s*D9}function IIe(t,e,r,i){return eR(t).lookAtTiltToEyeTilt(i,e,r)}function mne(t,e,r,i){return eR(t).eyeTiltToLookAtTilt(i,e,r)}function N9(t,e,r,i){if(N(e))return null;const s=t.renderSpatialReference,n=rb(e.eye,s,GL(t));return N(n)?null:E(i)?(i.position=n,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):new nf(n,e.heading,e.tilt,r)}function _gt(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(e);EIe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function $Ie(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(e);EIe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function LIe(t,e){return Ba(e.center,t.renderSpatialReference,E0e,xt.WGS84),aT(t,e.distance,E0e[1])}let tR=class{constructor(e){this.signal=e,this.resolver=Xv()}};function bx(t){return t&&"resolver"in t}const vgt=.66;function DIe(t){return 360-sre.normalize(t)}function _7(t){return sre.normalize(360-t)}function ZR(t){return E(t)&&t.resolver&&t.resolver.reject(),null}function bgt(t,e){return E(t)&&t.resolver&&t.resolver.resolve(e),e}function NIe(t,e,r,i=null){if(!e)return ZR(i);const s=t.spatialReference||xt.WGS84;if(E(e.camera)){const c=xb(e.camera.position,s);if(N(c))return ZR(i);const h=e.camera.clone();return h.position=c,bgt(i,h)}if(N(e.targetGeometry))return ZR(i);const n=e.get("targetGeometry.spatialReference");if(n&&!Nv(n,s))return ZR(i);const o=dM(t,t.state.camera);let a=Pl.ADJUST;if(e.rotation!=null&&(o.heading=DIe(e.rotation),a=Pl.LOCKED),r!=null&&(o.tilt=r),e.targetGeometry.type==="point"){const c=e.targetGeometry;let h;const p=e.targetGeometry.clone();return h=e.scale!=null?fne(t,e.scale,c.latitude):t.state.camera.distance,PIe(t,p,h,o,a,i)}const l=e.targetGeometry.extent;return l?QI(t,l,o.heading,o.tilt,a,i):ZR(i)}function wgt(t,e,r=null){return N(r)&&(r=new z0),yne(t,null,e.clone(),r)}async function xgt(t,e,r){const i=$gt(t,e);if(!i)throw new ce("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new nf({fov:t.camera.fov}),n=new z0({camera:s});if(i.target instanceof z0)return rw(await Egt(t,i.target,i,r,n));if(i.target instanceof nf)return rw(kIe(t,i.target,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof Ki){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return rw(o||c?await zJ(t,i,i.target.center,s,r,n):await Ogt(t,i,i.target,s,r,n))}const a={boundingBox:Fs(),hasZ:!1,screenSpaceObjects:[]},l=o?Tgt(t,i):void 0;if(await FIe(t,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(_0(a.boundingBox,oo),bd.x=oo[0],bd.y=oo[1],bd.z=oo[2],bd.spatialReference=t.spatialReference,isFinite(bd.z)&&a.hasZ?c=yre(a.boundingBox):(bd.z=void 0,c=Yje(Are(a.boundingBox,Dgt))),o||c)return rw(await zJ(t,i,bd,s,r,n));const h=Lgt(t,a.screenSpaceObjects);return rw(await Igt(t,i,bd,a.boundingBox,h,s,r,n))}return i.position?rw(Mgt(t,i,s,n)):rw(await Rgt(t,i,s,r,n))}function gne(t,e){return e.scale==null&&e.zoom!=null?$Ie(t,e.zoom):e.scale}function Tgt(t,e){const r=gne(t,e);return r?yYe(r):void 0}function Ane(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=DIe(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function yne(t,e,r,i){const s=t.spatialReference||xt.WGS84;return e=E(e)?e:ZA(t,r),N(e)||(i.targetGeometry=rb(e.center,t.renderSpatialReference,s),i.scale=LIe(t,e),i.rotation=_7(r.heading),i.camera=r),i}function F9(t,e,r){var a,l;const i=()=>new ce("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw i();if(!Nv(e.spatialReference,t.spatialReference))throw new ce("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=t.spatialReference)==null?void 0:a.wkid})`,{geometry:e});const s=[];if(!e.hasZ&&t.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&E(t.basemapTerrain.spatialReference)&&Nv(c,t.basemapTerrain.spatialReference)&&t.elevationProvider?oo[2]=gr(pg(t.elevationProvider,c),0):oo[2]=0}(0,Ngt[e.type])(e,c=>{s.push(c[0],c[1],c[2])},oo);const n=s.length/3;if(n===0)throw i();const o=new Array(s.length);if(Dn(s,e.spatialReference,0,o,t.spatialReference,0,n)){e.hasZ&&(r.hasZ=!0);for(let c=0;c<o.length;c+=3)e.hasZ?(oo[0]=o[c+0],oo[1]=o[c+1],oo[2]=o[c+2]):(oo[0]=o[c+0],oo[1]=o[c+1]),Fg(r.boundingBox,oo)}}async function Sgt(t,e,r,i){const s=await B0(t.whenViewForGraphic(e));if(s.ok===!1||N(s.value)||!("whenGraphicBounds"in s.value))return void F9(t,e.geometry,i);const n=s.value,o=await B0(n.whenGraphicBounds(e,{minDemResolution:r}));if(o.ok===!1)return void F9(t,e.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;U3(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function FIe(t,e,r,i){var s;if(Array.isArray(e)&&e.length===2){const n=e[0],o=e[1];if(typeof n=="number"&&typeof o=="number")return bd.x=n,bd.y=o,bd.z=void 0,bd.spatialReference=(s=t.spatialReference)!=null&&s.isGeographic?t.spatialReference:xt.WGS84,void F9(t,bd,i)}e&&typeof e.map=="function"?await Vu(e.map(n=>FIe(t,n,r,i))):e instanceof wb?F9(t,e,i):e instanceof pl&&await Sgt(t,e,r,i)}async function Egt(t,e,r,i,s){if(E(e.camera))return kIe(t,e.camera,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=E(e.targetGeometry)?e.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=_7(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=gne(t,r);n!=null&&(s.scale=n);const o=new tR(i);return NIe(t,s,r.tilt,o),s.camera=await o.resolver.promise,s}function kIe(t,e,r){const i=t.spatialReference,s=xb(e.position,i);return N(s)?null:((e=e.clone()).fov=t.camera.fov,e.position=s,yne(t,null,e,r))}function Cgt(t,e,r,i,s,n){const o=t.renderSpatialReference;return Fl(r,iN,o),Fl(e,aj,o),n.targetGeometry=new Gt(e),s.position=new Gt(r),Be(k9,aj,iN),y7(t,iN,k9,i.up,s),n.scale=aT(t,Is(iN,aj),n.targetGeometry.latitude),n.rotation=_7(s.heading),n.camera=s,n}async function zJ(t,e,r,i,s,n){if(N(r))throw new ce("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=OT(t);if(e.position)return Cgt(t,n.targetGeometry,e.position,o,i,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=Me(oo,o.viewForward,-l);o.eye=ke(oo,o.center,c),n.scale=aT(t,l,r.latitude)}dM(t,o,i);const a=Ane(i,e)?Pl.LOCKED:Pl.ADJUST;if(!e.zoomFactor){const l=gne(t,e);l==null?(Fl(r,oo,t.renderSpatialReference),UOe(o.frustum,oo)?n.scale=aT(t,Is(o.eye,oo),r.latitude):n.scale=LIe(t,o)):n.scale=l;const c=new tR(s);OIe(t,n.targetGeometry,n.scale,i,a,c),n.camera=await c.resolver.promise}return n}function Mgt(t,e,r,i){const s=OT(t);return Oe(k9,s.viewForward),y7(t,s.eye,k9,s.up,lj),r.position=new Gt(e.position),r.heading=e.heading!=null?e.heading:lj.heading,r.tilt=e.tilt!=null?e.tilt:lj.tilt,yne(t,null,r,i)}async function Rgt(t,e,r,i,s){const n=OT(t);return zJ(t,e,rb(n.center,t.renderSpatialReference,t.spatialReference),r,i,s)}async function Ogt(t,e,r,i,s,n){n.targetGeometry=r.clone();const o=OT(t);dM(t,o,i);const a=Ane(i,e)?Pl.LOCKED:Pl.ADJUST,l=new tR(s);return QI(t,r,i.heading,i.tilt,a,l),n.camera=await l.resolver.promise,n}function Pgt(t,e,r,i,s){let n=0;r.z!=null?n=r.z:t.basemapTerrain&&t.elevationProvider&&(n=pg(t.elevationProvider,r)),$e(oo,r.x,r.y,n),G0(t.spatialReference,oo,C0e,t.renderSpatialReference),hf(rN,C0e),df(rN,rN),Fs(JR);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let w=0;w<o.length;w++){const T=o[w];let C=i[T[2]];isFinite(C)||(C=n),$e(oo,i[T[0]],i[T[1]],C),Ba(oo,t.spatialReference,oo,t.renderSpatialReference),Fg(JR,Ph(oo,oo,rN))}const a=_T(JR),l=Sb(JR),c=vT(JR),h=1/Math.tan(e.fovX/2),p=1/Math.tan(e.fovY/2),A=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,_=.5*l*p+.5*Math.max(a,c);return Math.max(A,_)/s}async function Igt(t,e,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=OT(t),c=Pgt(t,l,r,i,s);dM(t,l,n);const h=Ane(n,e)?Pl.LOCKED:Pl.ADJUST;a.scale=aT(t,c,a.targetGeometry.latitude);const p=new tR(o);return OIe(t,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function $gt(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};if("declaredClass"in e||Array.isArray(e))r.target=e;else{for(const i in e)r[i]=e[i];e.center&&!r.target&&(r.target=e.center)}return r}function rw(t){return t&&E(t.camera)&&(t.rotation=_7(t.camera.heading)),t}function Lgt(t,e){const r=vgt;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(t.width,t.height)*2}const oo=V(),C0e=ot(),rN=mn(),JR=Jo(),Dgt=si(),k9=V(),iN=V(),aj=V(),lj={heading:0,tilt:0},bd=new Gt,Ngt={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,s=t.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e($e(r,t.xmin,t.ymin,t.zmin)),e($e(r,t.xmax,t.ymin,t.zmin)),e($e(r,t.xmin,t.ymax,t.zmin)),e($e(r,t.xmax,t.ymax,t.zmin)),e($e(r,t.xmin,t.ymin,t.zmax)),e($e(r,t.xmax,t.ymin,t.zmax)),e($e(r,t.xmin,t.ymax,t.zmax)),e($e(r,t.xmax,t.ymax,t.zmax))):(e($e(r,t.xmin,t.ymin,r[2])),e($e(r,t.xmax,t.ymin,r[2])),e($e(r,t.xmin,t.ymax,r[2])),e($e(r,t.xmax,t.ymax,r[2])))},mesh(t,e,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(i)for(let s=0;s<i.length;s+=3)e($e(r,i[s+0],i[s+1],i[s+2]))}};let Fgt=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;E(this.options.signal)&&ic(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,r){return this._promise.then(e,r)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&E(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(Yi())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await Q$(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,xgt(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(!N(r))if(this.options.animate){if(N(this._animationController))return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var n;const r=!!(this.target instanceof z0&&this.target.camera||this.target instanceof nf),i=e.camera;if(N(i))return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this.reject(new ce("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const s=ZA(this.view,i);return N(s)?(this.reject(new ce("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(N(i))return void this.reject(new ce("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||N(r.viewAnimation)||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;e.isFullySpecified?(s=new YI({view:this.view,desiredCamera:e.camera}),JM(this.view,e.camera,Wp.EYE_AND_CENTER)):lo(this.view,e.camera),r.begin(e.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof py&&E(a.viewAnimation)&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):E(r.viewAnimation)&&r.viewAnimation.target===e.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!N(this.view.state))switch(r.state){case Tn.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Tn.Ready:case Tn.Rejected:case Tn.Running:case Tn.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof py&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new py({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(E(r)&&r.stop(),this.reject(new ce("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},Fo=class extends Ke{get camera(){const e=this._get("camera");if(!this.ready)return e;const r=dM(this.view,this.view.state.camera,cj);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){var r,i;this._updatePropertyBeforeReady("camera",e)||((r=this.view.elevationProvider)==null||r.enableElevationCache(!0),this.setStateCamera(ZA(this.view,e),{applyConstraints:!1})||we.getLogger(this.declaredClass).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=dM(this.view,this.view.state.contentCamera,cj);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=ZA(this.view,e);N(r)?this.view.state.contentCamera=null:(this._updateElevation(r),this.view.state.contentCamera=r)}installContentCameraReset(e){if(this.removeHandles(uj),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,s=Iu(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([xe(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(uj),this.test.contentCameraResetState.clear())}),xe(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),xe(()=>this.view.state.camera,o=>{const a=cl(s,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],uj),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var r;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():we.getLogger(this.declaredClass).error("#center=","Invalid center",e):we.getLogger(this.declaredClass).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):we.getLogger(this.declaredClass).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=fgt(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return E(r)?r:this._get("extent")}set extent(e){var r;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||we.getLogger(this.declaredClass).error("#extent=","Invalid extent",e):we.getLogger(this.declaredClass).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):we.getLogger(this.declaredClass).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return aT(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||we.getLogger(this.declaredClass).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,s=this._get("padding"),n=Math.round(r[ii.TOP]/i),o=Math.round(r[ii.RIGHT]/i),a=Math.round(r[ii.BOTTOM]/i),l=Math.round(r[ii.LEFT]/i);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,sN),this.view.state.updateCamera(r=>r.padding=sN))}_paddingToArray(e,r,i){e?ns(i,e.top||0,e.right||0,e.bottom||0,e.left||0):ns(i,0,0,0,0);for(let s=0;s<4;s++)i[s]=Math.round(i[s]*r)}get screenCenter(){const e=this.padding;return af((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?wgt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var r;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||we.getLogger(this.declaredClass).error("#viewpoint=","Invalid viewpoint",e);else{const i=E(e.camera)?e.camera.position:e.targetGeometry,s=E(i)&&i.spatialReference;we.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e)}else we.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?_gt(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||we.getLogger(this.declaredClass).error("#zoom=","Invalid zoom",e)}get _pixelRatio(){var e;return E(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRendering?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,(e=this.view)==null?void 0:e.qualitySettings.maximumPixelRatio)}get _rasterPixelRatio(){return E(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,r;return((r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer.isFeatureEnabled(so.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var r,i;const e=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled(so.PhysicalPixelRendering,Ei.IDLE)||e.isFeatureEnabled(so.PhysicalPixelRendering,Ei.INTERACTING)||e.isFeatureEnabled(so.PhysicalPixelRendering,Ei.ANIMATING))}constructor(e){super(e),this._propertiesPool=new Vy({frustum:sv},this),this._cameraSetByUser=!1,this._gotoOperation=null,this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._cameraChangeTime=0,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(r){this.viewStateManager._updatingIgnoreRenderState=r},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||E(this.renderState)}}}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Co(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),xe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,r)=>this._cameraChangedHandler(e,r),os)]),Nl(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([C3({prepare:()=>this._prepareFrame()}),xe(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(nN)}),Co(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=gt(this._propertiesPool)}init(){this.constraintsManager=new WP({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===_t.Local&&this.addHandles(Nl(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(nN),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),nN)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(nN),this.constraintsManager=gt(this.constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return E(this._gotoOperation)&&this._gotoOperation.abort(i.animate),this._gotoOperation=new Fgt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(OT(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r==null?void 0:r.cameraController;i&&(r.updateCamera(s=>i.stepController(e,s)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){E(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:s}of Bgt){const n=e.has(i),o=this._isOverridden(i);!n&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(n||o)&&s.forEach(a=>e.add(a))}return r}_setInitialView(e){if(N(e)||this._cameraSetByUser)return;if(e instanceof nf)return void this.setStateCamera(ZA(this.view,e),{applyConstraints:!1});if(e instanceof z0){if(e.targetGeometry instanceof Ki){const n=QI(this.view,e.targetGeometry,0,.5,Pl.LOCKED);return void(E(n)&&this.setStateCamera(ZA(this.view,n),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,i)}const r=QI(this.view,e,0,.5,Pl.LOCKED);E(r)&&this.setStateCamera(ZA(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&kgt.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!N(e)&&(e instanceof z0?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof nf?this.isCompatible(e.position):e.spatialReference&&Nv(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Ugt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=L_){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=M4(this.view,s,n,e,r,Pl.ADJUST);return N(o)?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),s=QI(this.view,e,r,i,Pl.ADJUST,cj);return s?ZA(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,s=r.location.latitude;if(s==null)return null;const n=fne(this.view,e,s);return this._centerPointAtDistanceToCamera(i,n)}_zoomToCamera(e){return this._scaleToCamera($Ie(this.view,e))}_viewpointToCamera(e){return ZA(this.view,NIe(this.view,e))}setStateCamera(e,r){return!(N(e)||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&lo(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new YI({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._pixelRatio,s=Math.round(e.clientWidth*i),n=Math.round(e.clientHeight*i);if(s!==0&&n!==0&&(r.width===s&&r.height===n||(r.width=s,r.height=n),this.view.state)){const o=this.view.state.camera;o.fullWidth===s&&o.fullHeight===n&&o.pixelRatio===i||(L_.copyFrom(o),L_.pixelRatio!==i&&(this._paddingToArray(this.padding,i,sN),L_.padding=sN),L_.fullWidth=s,L_.fullHeight=n,L_.pixelRatio=i,this.view.state.camera=L_),this._updateViewState()}}_updateElevation(e){var n;const r=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=((n=this.view.renderCoordsHelper)==null?void 0:n.getAltitude(e.eye))??0,s=r?p7(this.view,e.eye):0;e.relativeElevation=i-s}_updateViewState(){E(this.test.renderState)?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Ei.ANIMATING:this.view.interacting?this.view.state.mode=Ei.INTERACTING:(this.view.state.mode===Ei.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=Vgt?this.view.state.mode=Ei.INTERACTING:this.view.state.mode=Ei.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio,this.view.state.contentPixelRatio=Math.min(this._pixelRatio,this.view.qualitySettings.maximumPixelRatio)}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([d({type:nf,dependsOn:["view.state.camera","ready"]})],Fo.prototype,"camera",null),u([d({type:nf,dependsOn:["view.state.contentCamera","ready"]})],Fo.prototype,"contentCamera",null),u([d({type:Gt})],Fo.prototype,"center",null),u([d({type:Ki})],Fo.prototype,"extent",null),u([d({readOnly:!0})],Fo.prototype,"frustum",null),u([d({readOnly:!0})],Fo.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],Fo.prototype,"ready",void 0),u([d({type:Number})],Fo.prototype,"scale",null),u([d()],Fo.prototype,"padding",null),u([d({readOnly:!0})],Fo.prototype,"screenCenter",null),u([d({constructOnly:!0})],Fo.prototype,"view",void 0),u([d({type:z0})],Fo.prototype,"viewpoint",null),u([d({type:Number})],Fo.prototype,"zoom",null),u([d({readOnly:!0})],Fo.prototype,"_pixelRatio",null),u([d({readOnly:!0})],Fo.prototype,"_rasterPixelRatio",null),u([d({readOnly:!0})],Fo.prototype,"_usePhysicalPixelRendering",null),u([d({readOnly:!0})],Fo.prototype,"_usePhysicalPixelRenderingAny",null),u([d()],Fo.prototype,"_windowDevicePixelRatio",void 0),u([d()],Fo.prototype,"_devicePixelRatioOverride",void 0),Fo=u([j("esri.views.3d.state.ViewStateManager")],Fo);const kgt=["camera","viewpoint","extent","scale","center","zoom"],Bgt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Ugt={heading:0,tilt:0},cj=new nf,L_=new hr,sN=Zr(),nN="pending-initial-view",uj="content-camera-reset",Vgt=300,M0e=100;let fg=class extends ry{constructor(){super(...arguments),this.startCamera=new hr,this.currentCamera=new hr,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<M0e}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=Tn.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),M0e),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([d({readOnly:!0})],fg.prototype,"isInteractive",null),u([d()],fg.prototype,"_lastInteraction",void 0),fg=u([j("esri.views.3d.state.controllers.InteractiveController")],fg);var yh;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(yh||(yh={}));let XI=class extends fg{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=yh.CENTER,this._rotScale=0,this._lastPoint=Dt(),this._tmpWorldUp=V(),this._tmpViewDir=V(),this._tmpRotCurPoint=Dt(),this._tmpTransf=ot(),this._tmpAxis=V(),this._tmpPivotPoint=V(),this._pivotPos=V(),this._constraintOptions={selection:Ws.ALL,interactionType:Jr.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Ua.TUMBLE}}initialize(){this._rotScale=this.pivot===yh.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case yh.EYE:Oe(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Jr.LOOK_AROUND,this._constraintOptions.tiltMode=Ua.LOOK_AROUND,this._constraintOptions.selection=Ws.NONE;break;case yh.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?PT:{});r||Oe(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Jr.TUMBLE,this._constraintOptions.tiltMode=Ua.TUMBLE,this._constraintOptions.selection=Ws.ALL&~Ws.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,vx(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,s=V();Be(s,this._pivotPos,i.eye);const n=st(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,R0e);let a=Math.max(Math.min(xmt,1/Math.abs(He(R0e,i.viewForward)))*o,Tmt);r&&(a=Math.min(n,a));const l=es(this.view.spatialReference),c=Sn(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),h=A7(this.startCamera,c,l);let p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*tj,tj),A=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,tj);(E(p)||E(A))&&(p=gr(p,A),A=N(A)||h===Fa.Horizontal?p:A,a=p>A?A:p,a=r?Math.min(a,n):a),qe(s,s),Oe(this._pivotPos,ke(this._tmpPivotPoint,i.eye,Me(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case yh.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case yh.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}lo(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),vx(e,r,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;Be(this._tmpViewDir,i,s);const a=st(this._tmpViewDir),l=Zo(He(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===yh.EYE){n*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;n=c-Math.max(-h,Math.min(h,c+n))}return n=ze(n+l,Tl.min,Tl.max)-l,Xt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===yh.CENTER&&(o=-o),jd(this._tmpTransf,o,this._tmpWorldUp),Ih(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),Mt(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Mt(hj,e.up,this._tmpTransf),ke(hj,s,this._tmpViewDir),ga(this._lastPoint,this._tmpRotCurPoint),hj}};u([d()],XI.prototype,"pivot",void 0),XI=u([j("esri.views.3d.state.controllers.RotateController")],XI);const hj=V(),R0e=V();let dj=class extends fl{constructor(e,r,i,s){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!dne(e.data,this.pointerAction))return;const i=Sn(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new XI({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},GJ=class extends fg{constructor(){super(...arguments),this._pickPoint=V(),this._tmpP0=Dt(),this._panAxisAngle=m7(),this._tmpRayDir=V(),this._tmpRayDirPick=V(),this._targetOnSphere=V(),this._navMode=Fa.Horizontal,this._tmpRay={origin:V(),direction:V()},this.dragBeginPoint=Sn(),this._normalizedAnchorPoint=Dt(),this._constraintOptions={selection:Ws.ALL_EXCEPT_COLLISION,interactionType:Jr.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Ua.TUMBLE},this._sphere=Io(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;ga(this.dragBeginPoint,e),vx(this.startCamera,e,this._normalizedAnchorPoint);const r=es(this.view.spatialReference),i=oIe(this._intersectionHelper,this.startCamera,e,r,hM.Ellipsoid,this.view.map.ground.opacity===0?PT:{});if(this._navMode=A7(this.startCamera,e,r),this._navMode===Fa.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=gr(i.scenePickPoint,this._pickPoint),this._sphere=i.sphere;else{let s;KM(this.startCamera,e,this._tmpRay),qe(this._tmpRay.direction,this._tmpRay.direction),E(i.scenePickPoint)&&(Be(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=st(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,O0e);let o=ze(Math.min(JPe,1/Math.abs(He(O0e,this._tmpRay.direction)))*n,C9[0],C9[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,g7);o=E(a)?a:o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,Me(this._tmpRay.direction,this._tmpRay.direction,o),ke(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Fa.Horizontal){Be(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=st(this._tmpRayDir);vx(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;if(this._hasPickPoint&&s<r){const o=1-(1-s/r)*(1-this._sphere[3]/st(this.currentCamera.center));this.currentCamera.center=Me(oN,this.currentCamera.center,o)}Me(this._tmpRayDir,this._tmpRayDir,-s/r),this.currentCamera.eye=ke(oN,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=f0(Kx(this.dragBeginPoint,e)),lo(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(C4(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),one(this._pickPoint,this._targetOnSphere,this._panAxisAngle),db(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=st(this._tmpRay.direction);vx(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;Me(this._tmpRayDir,this._tmpRay.direction,1-s/r),this.currentCamera.eye=ke(oN,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=ke(oN,this.currentCamera.center,this._tmpRayDir)}JM(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};GJ=u([j("esri.views.3d.state.controllers.global.ZoomController")],GJ);const oN=V(),O0e=V();let jJ=class extends fg{constructor(){super(...arguments),this._tmpP=V(),this._tmpDir=V(),this._tmpN=V(),this._tmpP0=Dt(),this._tmpPoi=V(),this._tmpRayDir=V(),this.dragBeginPoint=Sn(),this._normalizedAnchorPoint=Dt(),this._constraintOptions={selection:Ws.ALL,interactionType:Jr.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:V(),tiltMode:Ua.TUMBLE},this._plane=Hi()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;ga(this.dragBeginPoint,e),vx(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?PT:{});Be(this._tmpDir,this._tmpP,this.startCamera.eye);const i=st(this._tmpDir);qe(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=ze(Math.min(JPe,1/Math.abs(He(zgt,this._tmpDir)))*s,C9[0],C9[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,g7);n=E(o)?o:n,n=r?Math.min(n,i):n,Me(this._tmpDir,this._tmpDir,n),ke(this._tmpP,this.startCamera.eye,this._tmpDir),Be(this._tmpN,this.startCamera.eye,this.startCamera.center),qe(this._tmpN,this._tmpN),this._tmpN[1]<0&&nc(this._tmpN,this._tmpN),vL(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;Smt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||Oe(this._tmpPoi,this.currentCamera.center),vx(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);ga(this._normalizedAnchorPoint,this._tmpP0),Be(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=st(this._tmpRayDir);let s=i*(1-r);this._constraintOptions.interactionDirection&&(Oe(this._constraintOptions.interactionDirection,this._tmpRayDir),Me(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const n=this.view.state.constraints.minimumPoiDistance;r>=0&&s<n&&(s=n,r=-(s-i)/i),Math.abs(i-s)<1e-6||(Me(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=ke(iw,this.currentCamera.eye,this._tmpRayDir),fo(iw,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?iw[2]=Math.max(this.startCamera.center[2],iw[2]):iw[2]=Math.min(this.startCamera.center[2],iw[2]),this.currentCamera.center=iw,this._constraintOptions.interactionFactor=f0(Kx(this.dragBeginPoint,e)),lo(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};jJ=u([j("esri.views.3d.state.controllers.local.ZoomController")],jJ);const iw=V(),zgt=ct(0,0,1);let Ggt=class extends fl{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!dne(e.data,this.pointerAction))return;const i=Sn(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new GJ({view:this._view}):this._cameraController=new jJ({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function Ef(t){let e=t*t;return t<0&&(e*=-1),e}function P0e(t,e,r){const i=r,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=Ef(s.axes[0]),i.translation[1]=Ef(s.axes[1]),i.translation[2]=Ef(s.buttons[7])-Ef(s.buttons[6]),i.heading=Ef(s.axes[2]),i.tilt=Ef(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*Ef(s.axes[0]),i.translation[1]=1.2*Ef(s.axes[1]),i.translation[2]=2*-Ef(s.axes[2]),i.heading=1.2*Ef(s.axes[5]),i.tilt=1.2*Ef(s.axes[3])),i.tilt*=o,Me(i.translation,i.translation,a),i}function I0e(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function pj(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let sx=class extends fg{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new hr,this._headingStart=0,this._constraintOptions={selection:Ws.ALL,interactionType:Jr.NONE,interactionStartCamera:new hr,interactionFactor:0,interactionDirection:null,tiltMode:Ua.LOOK_AROUND}}handleEventGamepad(e){const r=P0e(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||pj(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,I0e(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=I0e(this._keysButtonState,this._transformation);pj(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,sw),this._applyDisabledMovementTypes(sw),this._applyPan(sw.pan),this._applyRotate(sw.rotate),this._applyZoom(sw.zoom),this._applyAscend(sw.ascend),this._constraintOptions.interactionType=Jr.NONE,this._constraintOptions.selection=Ws.COLLISION,lo(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;Be(au,r.center,r.eye),Mt(au,au,e.matrix),r.center=ke(au,au,r.eye),r.up=Mt(au,r.up,e.matrix),this._constraintOptions.interactionType=Jr.LOOK_AROUND,this._constraintOptions.selection=Ws.ALL_EXCEPT_COLLISION,lo(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=Mt(au,r.eye,e.matrix),r.center=Mt(au,r.center,e.matrix),this.view.state.isGlobal&&(r.up=Mt(au,r.up,e.matrix)),this._constraintOptions.interactionType=Jr.PAN,this._constraintOptions.selection=Ws.ALL,lo(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=ke(au,this.currentCamera.eye,Me(Tt.get(),r,e)),Oe(KR,r),nc(KR,KR),this._constraintOptions.interactionDirection=KR,this._constraintOptions.interactionType=Jr.ZOOM,this._constraintOptions.selection=Ws.ALL_EXCEPT_COLLISION,lo(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Tt.get());if(this._constraintOptions.interactionDirection=Oe(KR,r),this.view.state.isGlobal){const i=st(this.currentCamera.eye),s=(i+e)/i;this.currentCamera.eye=Me(au,this.currentCamera.eye,s),this.currentCamera.center=Me(au,this.currentCamera.center,s)}else{const i=Me(Tt.get(),r,e);this.currentCamera.eye=ke(au,this.currentCamera.eye,i),this.currentCamera.center=ke(au,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=Jr.ASCEND,this._constraintOptions.selection=Ws.COLLISION,lo(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Ws.ALL_EXCEPT_COLLISION,lo(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){Xgt(i);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,r,i):this._calculateControlTransformationGlobal(s,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,au)}_calculateControlTransformationLocal(e,r,i){const{viewRight:s,viewForward:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=$e(Tt.get(),n[0],n[1],0);qe(l,l);const c=o.translation[0]*e.pan;if(c!==0){const T=Me(Tt.get(),s,c);ju(i.pan.matrix,i.pan.matrix,T),i.pan.enabled=!0}switch(a.mode){case"pan":{const T=-o.translation[1]*e.pan;if(T!==0){const C=Me(Tt.get(),l,T);ju(i.pan.matrix,i.pan.matrix,C),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;i.ascend=h;const p=-o.heading*e.rotate;p!==0&&(Ih(i.rotate.matrix,i.rotate.matrix,p,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Tt.get())),i.rotate.enabled=!0);const A=o.tilt*e.rotate,_=hb(this.view.renderCoordsHelper,r.center,r.eye),w=ze(_+A,Tl.min,Tl.max)-_;w&&(Ih(i.rotate.matrix,i.rotate.matrix,w,s),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:s,viewRight:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=Xt(Tt.get(),n,s);qe(l,l),nc(l,l),Pmt(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(sw.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;i.ascend=h;const p=-o.heading*e.rotate;p!==0&&(Ih(i.rotate.matrix,i.rotate.matrix,p,this._tmpCamera.eye),i.rotate.enabled=!0);const A=o.tilt*e.rotate,_=this._clampTiltDeltaGlobalToValidRange(A,r.ray,c);_!==0&&(Ih(i.rotate.matrix,i.rotate.matrix,_,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const s=es(this.view.spatialReference),n=s8(Tl.min,r.origin,i,s);let o=0,a=0;const l=Tt.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=hb(this.view.renderCoordsHelper,l,r.origin);o=s8(c,r.origin,i,s),a=s8(Tl.max,r.origin,i,s)}else{BM(vU(bU,i+s.radius),r,l);const c=Zo(-He(r.direction,qe(l,l)));o=f0e(c,r.origin,i,s),a=f0e(Tl.max,r.origin,i,s)}return ze(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=r+Math.abs(n-r);return s.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:s}=this.view.state,{direction:n}=cgt(this.view,r,0,BIe,Qgt),o=i.intersectManifoldClosestSilhouette(qd(r,n),e,Tt.get()),a=Is(r,o),l=i.intersectManifoldClosestSilhouette(qd(r,Yy(Tt.get(),r,s.center)),e,Tt.get()),c=Is(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:s,isGlobal:n}=i,o=r.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,Tt.get());if(n){const a=Be(Tt.get(),e,o),l=st(a);Me(a,a,1/l);const c=qe(Tt.get(),e),h=Zo(He(c,a));return l*Math.sin(Math.min(Hgt,h))}{const a=Oe(Tt.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),Is(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:qgt}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+es(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=Tt.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=s.width/2,h=$0e*s.width,p=$0e*s.width,A=l*Math.tan(.5*s.fovX)/c,_=A/i,w=A/this._computeHeadingRotateRadius(o),T=a-r;return{pan:(n?_:A)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*T-T),zoom:2**(h*e/c)*l-l,rotate:ze(w*p,Wgt,Ygt)*e}}_applyDisabledMovementTypes(e){!E(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&cf(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&cf(e.rotate.matrix))}static activatesFor(e,r){const i=P0e(r,e.navigation.gamepad,jgt);return!(r.action==="end"||pj(i))}};u([d({constructOnly:!0})],sx.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],sx.prototype,"disableMovements",void 0),sx=u([j("esri.views.3d.state.controllers.GamepadKeyboardController")],sx);const jgt={translation:[0,0,0],heading:0,tilt:0,zoom:0},BIe=80,Hgt=$r(BIe),$0e=.75,qgt=5,Wgt=$r(30),Ygt=$r(80),sw={zoom:0,ascend:0,pan:{enabled:!1,matrix:ot()},rotate:{enabled:!1,matrix:ot()}},au=V(),KR=V(),Qgt=pne();function Xgt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,cf(t.pan.matrix),t.rotate.enabled=!1,cf(t.rotate.matrix)}let Zgt=class extends fl{constructor(e){super(!0),this._view=e,this._watchHandles=new ts,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([xe(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Cr),xe(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||sx.activatesFor(this._view,e.data)){if(!i){const s=new sx({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var ph;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(ph||(ph={}));let Jgt=class extends fl{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:_t.Local},this._keyToNumber={[r.left]:ph.LEFT,[r.right]:ph.RIGHT,[r.forward]:ph.FORWARD,[r.backward]:ph.BACKWARD,[r.up]:ph.UP,[r.down]:ph.DOWN,[r.headingLeft]:ph.HEADINGLEFT,[r.headingRight]:ph.HEADINGRIGHT,[r.tiltUp]:ph.TILTUP,[r.tiltDown]:ph.TILTDOWN,[r.zoomIn]:ph.ZOOMIN,[r.zoomOut]:ph.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new sx({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},Kgt=class extends fl{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new P9({view:this._view,mode:"interaction"}):new I9({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Sn(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},B9=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},lT=class extends S4{constructor(){super(...arguments),this._beginCamera=new hr,this._elapsedTimeSec=0,this.constraintOptions={selection:Ws.ALL,interactionType:Jr.PAN,interactionFactor:0,interactionStartCamera:new hr,interactionDirection:null,tiltMode:Ua.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new iM}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),lo(this.view,r,this.constraintOptions)}};lT=u([j("esri.views.3d.state.controllers.momentum.MomentumController")],lT);let ZI=class extends lT{constructor(e){super(e),this.interactionType=Jr.PAN,this._tmpPan=V()}momentumStep(e,r){const i=this.momentum.value(e);Me(this._tmpPan,this.momentum.direction,i),r.eye=Be(L0e,r.eye,this._tmpPan),r.center=Be(L0e,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([d({constructOnly:!0})],ZI.prototype,"momentum",void 0),ZI=u([j("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],ZI);const L0e=V(),eAt=V(),aN=V();let o8=class extends lT{constructor(e){super(e),this.interactionType=Jr.PAN}momentumStep(e,r){const i=this.momentum.value1(e),s=this.momentum.value2(e);Oe(aN,r.eye),qe(aN,aN),Xt(this.momentum.axis2,aN,this.momentum.axis1),uIe(r,eAt,this.momentum.axis1,i,this.momentum.axis2,s)}};u([d({constructOnly:!0})],o8.prototype,"momentum",void 0),o8=u([j("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],o8);let U2=class extends lT{set center(e){this._set("center",In(e))}set axis(e){this._set("axis",In(e))}constructor(e){super(e),this.interactionType=Jr.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);db(r,this.center,E4(this.axis,i))}};u([d({constructOnly:!0})],U2.prototype,"momentum",void 0),u([d({constructOnly:!0})],U2.prototype,"center",null),u([d({constructOnly:!0})],U2.prototype,"axis",null),U2=u([j("esri.views.3d.state.controllers.momentum.MomentumController")],U2);let SC=class extends lT{set zoomCenter(e){this._set("zoomCenter",In(e))}constructor(e){super(e),this.interactionType=Jr.ZOOM,this.constraintOptions.interactionDirection=V()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;Oe(i,r.eye);const s=this.momentum.valueDelta(0,e);cne(r,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),Yy(i,r.eye,i)}};u([d({constructOnly:!0})],SC.prototype,"momentum",void 0),u([d({constructOnly:!0})],SC.prototype,"zoomCenter",null),SC=u([j("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],SC);let g2=class extends lT{set screenCenter(e){this._set("screenCenter",Sn(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",In(e))}constructor(e){super(e),this.interactionType=Jr.ZOOM,this.radius=0,this._tmpSceneCenter=V(),this._tmpZoomAxisAngle=m7(),this._sphere=Io()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);sIe(this._sphere,r,i),this.constraintOptions.interactionType=Jr.ZOOM,lo(this.view,r,this.constraintOptions),C4(this._sphere,r,this.screenCenter,this._tmpSceneCenter),one(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),db(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Jr.PAN}};u([d({constructOnly:!0})],g2.prototype,"momentum",void 0),u([d({constructOnly:!0})],g2.prototype,"screenCenter",null),u([d({constructOnly:!0})],g2.prototype,"sceneCenter",null),u([d({constructOnly:!0})],g2.prototype,"radius",void 0),g2=u([j("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],g2);let m0=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},v7=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},tAt=class extends v7{constructor(e,r,i,s,n){super(e,r,i),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},UIe=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new m0(.6),this._screen=[new m0(.4),new m0(.4)],this._scene=[new m0(.6),new m0(.6),new m0(.6)],this._tmpDirection=V()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){$e(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=st(this._tmpDirection);s>0&&Me(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new tAt(e,r,i,n==null?0:s/n,this._tmpDirection)}},D0e=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const N0e=1e-5;let rAt=class extends v7{constructor(e,r,i,s,n,o=0,a){super(e,r,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},iAt=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=V(),this._tmpAxis2=V(),this._tmpAngles=Dt(),this._time=new m0(.3),this._screen=[new m0(.4),new m0(.4)],this._angle1=new D0e(.6),this._angle2=new D0e(.6),this._axis1=V(),this._axis2=V(),this._lastScene=V()}addMomentumDirectRotation(e,r,i,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=lIe(this._lastScene,r,this._tmpAxis2,s,n,o);this._angle2.update(0),Jl(this._tmpAxis2)<N0e?a=0:qe(this._axis1,this._tmpAxis2),this._angle1.update(a),Oe(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;cIe(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),Jl(this._tmpAxis2)<N0e?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),qe(this._axis1,this._tmpAxis1),qe(this._axis2,this._tmpAxis2)),Oe(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=i==null||s==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new rAt(e,r,i,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},VIe=class{constructor(e=2.5,r=.01,i=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new m0(.8),this.time=new m0(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=ze(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new v7(e,r,i)}},zIe=class extends VIe{constructor(e=3,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){const i=this.value.lastValue;if(i!=null){let s=e-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=i+s}super.add(e,r)}},sAt=class extends v7{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),s=super.value(e+r)-i;return Math.exp(s)}},GIe=class extends VIe{constructor(e=2.5,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new sAt(e,r,i)}},HJ=class extends fg{constructor(){super(...arguments),this._smoothRotation=new B9(.05),this._rotationAxis=V(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Hi(),this._beginRadius=0,this._smoothScaling=new B9(.05),this._zoomCenterScreen=Sn(),this._zoomMomentumEstimator=new GIe,this._rotationMomentumEstimator=new zIe,this._panSphericalMomentumEstimator=new iAt,this._panPlanarMomentumEstimator=new UIe,this._adjustedSphere=Io(),this._tmp3d=V(),this._tmpScreenPointArray=Sn(),this._beginScreenPoint=Sn(),this._beginScenePoint=V(),this._screenPickPoint=Sn(),this._scenePickPoint=V(),this._mode=Fa.Horizontal,this._sphere=Io(),this._pointerCount=0,this._tmpInteractionDirection=V(),this._constraintOptions={selection:Ws.ALL,interactionType:Jr.NONE,interactionFactor:0,interactionStartCamera:new hr,interactionDirection:null,tiltMode:Ua.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var n;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panPlanarMomentumEstimator.enabled=r,this._panSphericalMomentumEstimator.enabled=r,this._beginHeading=-Kv.normalize($r(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),ng(e.center,this._screenPickPoint),ga(this._beginScreenPoint,this._screenPickPoint);const i=es(this.view.spatialReference),s=oIe(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,hM.Silhouette,this.view.map.ground.opacity===0?PT:{});N(s.scenePickPoint)||(this._scenePickPoint=s.scenePickPoint,this._sphere=s.sphere,Oe(this._beginScenePoint,this._scenePickPoint),this._mode=A7(this.startCamera,this._screenPickPoint,i),this._mode===Fa.Vertical&&this._preparePlanarPanMode(e,s.hasGeometryIntersection),(n=this._constraintOptions.interactionStartCamera)==null||n.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===Fa.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===Fa.Horizontal?new g2({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new SC({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new U2({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===Fa.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new o8({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new ZI({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,r){const i=nc(this._tmp3d,this.startCamera.viewForward);vL(this._scenePickPoint,i,this._panningPlane);const s=Sn(this._screenPickPoint[0],0),n=V(),o=st(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],C4(this._adjustedSphere,this.startCamera,s,n);const a=Rl();this.startCamera.projectToRenderScreen(n,a);const l=V(),c=V(),h=V();Be(l,this._scenePickPoint,this.currentCamera.eye);const p=st(l);qe(l,l);const A=rIe*Math.max(Math.abs(this.view.camera.position.z),iIe),_=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,g7);let w=E(_)?_:A;w=r?Math.min(w,p):w,Oe(h,ke(c,this.currentCamera.eye,Me(c,l,w))),this._panningPlane[3]=-He(this._panningPlane,h),this.startCamera.center=ke(c,this.startCamera.eye,Me(c,this.startCamera.viewForward,w));const T=ng(e.center,this._tmpScreenPointArray);BJ(this._panningPlane,this.startCamera,T,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),sIe(this._sphere,this.currentCamera,this._smoothScaling.value),ng(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Jr.ZOOM,this._constraintOptions.interactionFactor=f0(e.radius-this._beginRadius),lo(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=ng(e.center,this._tmpScreenPointArray);C4(this._sphere,this.currentCamera,r,this._tmp3d),une(this._beginScenePoint,He(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(dIe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(hIe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Jr.PAN,this._constraintOptions.interactionFactor=f0(Kx(this._screenPickPoint,r)),lo(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){qe(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||nc(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+kJ(e.angle-r),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),db(this.currentCamera,this._sphere,E4(this._rotationAxis,n)),this._constraintOptions.interactionType=Jr.TUMBLE,this._constraintOptions.interactionFactor=f0(e.radius*i),lo(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=ng(e.center,this._tmpScreenPointArray);BJ(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(aIe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Jr.PAN,this._constraintOptions.interactionFactor=f0(Kx(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),lo(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),cne(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Jr.ZOOM,this._constraintOptions.interactionFactor=f0(e.radius-this._beginRadius),lo(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){Oe(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||nc(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=kJ(i);const s=r+i,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),db(this.currentCamera,this._sphere,E4(this._rotationAxis,o)),this._constraintOptions.interactionType=Jr.TUMBLE,this._constraintOptions.interactionFactor=f0(e.radius*o),lo(this.view,this.currentCamera,this._constraintOptions)}};HJ=u([j("esri.views.3d.state.controllers.global.PinchAndPanController")],HJ);const F0e=ct(0,0,1),nAt={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let qJ=class extends fg{constructor(){super(...arguments),this._rotationValueSmooth=new B9(.05),this._scalingValueSmooth=new B9(.05),this._planeHorizontal=Hi(),this._planeVertical=Hi(),this._rotationMomentumEstimator=new zIe,this._panMomentumEstimator=new UIe(300,12,.9),this._zoomMomentumEstimator=new GIe,this._beginRadius=0,this._beginCenter=V(),this._beginAngle=0,this._tmpPoints=[],this._panMode=Fa.Horizontal,this._beginCenterScreen=Sn(),this._tmpCentroid3d=V(),this._tmpCentroid2d=Sn(),this._tmp2d=Sn(),this._pointerCount=0,this._constraintOptions={selection:Ws.ALL,interactionType:Jr.NONE,interactionFactor:0,interactionStartCamera:new hr,interactionDirection:null,tiltMode:Ua.TUMBLE}}begin(e){var w;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),ng(e.center,this._beginCenterScreen),TSe(F0e,0,this._planeHorizontal);const i=V(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?PT:{}),n=V();nc(n,this.startCamera.viewForward);const o=V();Oe(o,F0e);const a=He(n,o),l=rf(a<0?-a:a);this._panMode=l>=nAt.ANGLE_THRESHOLD?Fa.Horizontal:Fa.Vertical;const c=Math.min(rIe,1/Math.abs(He(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),iIe);yQ(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||_Q(this._planeHorizontal,this._planeHorizontal);const h=V(),p=V(),A=V();Be(h,i,this.currentCamera.eye);const _=st(h);if(qe(h,h),this._panMode===Fa.Vertical){Me(o,o,a),Be(this._planeVertical,n,o),qe(this._planeVertical,this._planeVertical),yQ(this._planeVertical,this._planeVertical,i);const T=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,g7);let C=E(T)?T:c;C=s?Math.min(C,_):C,Oe(A,ke(p,this.currentCamera.eye,Me(p,h,C))),this._planeVertical[3]=-He(this._planeVertical,A),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),rj(this._tmpPoints,this._beginCenter)}else{const T=s?_:c;Oe(A,ke(p,this.currentCamera.eye,Me(p,h,T))),this._planeHorizontal[3]=-He(this._planeHorizontal,A),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),rj(this._tmpPoints,this._beginCenter)}(w=this._constraintOptions.interactionStartCamera)==null||w.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===Fa.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(r){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),cne(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Jr.ZOOM,this._constraintOptions.interactionFactor=f0(Math.abs(e.radius-this._beginRadius)),lo(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),rj(this._tmpPoints,this._tmpCentroid3d),ng(e.center,this._tmpCentroid2d),aIe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Jr.PAN,this._constraintOptions.interactionFactor=f0(Kx(this._beginCenterScreen,this._tmpCentroid2d)),lo(this.view,this.currentCamera,this._constraintOptions),r){const n=this._planeHorizontal,o=s,a=this._rotationValueSmooth.value,l=a+kJ(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const h=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(h,.001*e.timestamp),db(this.currentCamera,o,E4(n,h)),this._constraintOptions.interactionType=Jr.TUMBLE,this._constraintOptions.interactionFactor=f0(Math.abs(e.radius*h)),lo(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new SC({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new U2({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new ZI({view:this.view,momentum:s}):null}_computePlanePoints(e,r,i,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=V()),BJ(r,i,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};qJ=u([j("esri.views.3d.state.controllers.local.PinchAndPanController")],qJ);let k0e=class extends fl{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!dne(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,s=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new HJ({view:this._view}):new qJ({view:this._view})}},oAt=class extends fl{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},jIe=class extends fl{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},aAt=class extends jIe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},lAt=class extends jIe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},cAt=class extends fl{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){var s,n,o;const r=this._invert?-1:1,i=Sn(0,e.data.delta*r);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new XI({view:this._view,pivot:yh.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(n=this._cameraController)==null||n.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function B0e(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value?r.value:1:0),axes:e.axes.map(r=>dAt(r,t.axisThreshold))}:{buttons:[],axes:[]}}function uAt(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function hAt(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function dAt(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let pAt=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,B0e(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new ase(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=C3({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=B0e(n),l=i||hAt(a);o&&(o.timestamp===s.timestamp||!o.active&&l||uAt(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&e(s)}}_emitGamepadEvent(e,r,i){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const U0e=Le("edge"),fAt=Le("chrome"),mAt=Le("ff"),gAt=Le("safari"),V0e="esri-view-surface",cS={touchNone:`${V0e}--touch-none`,touchPan:`${V0e}--touch-pan`};let HIe=class qIe{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new pAt(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=gt(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(fj[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&fj[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(fj[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,r){r?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?cS.touchNone:cS.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?cS.touchPan:cS.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(cS.touchNone),this._element.classList.remove(cS.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=PRe(this._element,e);return qIe.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const i=dlt(r);i&&e==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:U0e&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}U0e?i*=.7:fAt||gAt?i*=.6:mAt&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};HIe.test={disableSubpixelCoordinates:!1};const fj={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let AAt=class extends fl{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function WIe(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function yAt(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function _At(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:af()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[$,L]=t,[k,F]=[L.x-$.x,L.y-$.y];return e.radius=Math.sqrt(k*k+F*F)/2,e.center.x=($.x+L.x)/2,e.center.y=($.y+L.y)/2,e}let r=0,i=0;for(let $=0;$<t.length;$++)r+=t[$].x,i+=t[$].y;r/=t.length,i/=t.length;const s=t.map($=>$.x-r),n=t.map($=>$.y-i);let o=0,a=0,l=0,c=0,h=0,p=0,A=0;for(let $=0;$<s.length;$++){const L=s[$],k=n[$],F=L*L,G=k*k;o+=F,a+=G,l+=L*k,c+=F*L,h+=G*k,p+=L*G,A+=k*F}const _=.5*(c+p),w=.5*(h+A),T=o*a-l*l,C=(_*a-w*l)/T,M=(o*w-l*_)/T,O=af(C+r,M+i);return{radius:Math.sqrt(C*C+M*M+(o+a)/t.length),center:O}}function JI(t){const{native:e}=t,{pointerId:r,button:i,pointerType:s}=e;return s==="mouse"?`${r}:${i}`:`${s}`}let vAt=class extends fl{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:s,pointers:bAt(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=lN(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,s);const n=a8(s,YIe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=lN(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=lN(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=a8(i,r)-e,i.lastAngle=a8(i,r)-e})}_emitEvent(e,r,i){const s=lN(this._activePointerMap);this._drag.emit(this._createPayload(e,r,s,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,s=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function YIe(t){const e=[];return t.forEach(r=>{e.push(af(r.event.x,r.event.y))}),_At(e)}function lN(t){const e=YIe(t);let r=0;return t.forEach(i=>{let s=a8(i,e),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s;const o=s-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function bAt(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function a8(t,e){const r=t.event,i=r.x-e.center.x,s=r.y-e.center.y;return Math.atan2(s,i)}var z0e;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(z0e||(z0e={}));const Tv={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let wAt=class extends fl{constructor(e=Tv.maximumDoubleClickDelay,r=Tv.maximumDoubleClickDistance,i=Tv.maximumDoubleTouchDelay,s=Tv.maximumDoubleTouchDistance,n=FB){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=sn(e.doubleClickTimer))}get hasPendingInputs(){return Ml(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=sn(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:s}=e.native;return i==="mouse"?`${r}:${s}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,s=this._getPointerId(r);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;WIe(o,r)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=JI(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,s=JI(r),n=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},xAt=class extends fl{constructor(e=Tv.maximumDoubleClickDelay,r=Tv.maximumDoubleClickDistance,i=Tv.maximumDoubleTouchDelay,s=Tv.maximumDoubleTouchDistance,n=FB){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=JI(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=JI(r),s=this._pointerState.get(i);if(s&&s.downButton===r.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;WIe(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=JI(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const eO={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let TAt=class extends fl{constructor(e=eO.maximumClickDelay,r=eO.movementUntilMouseDrag,i=eO.movementUntilPenDrag,s=eO.movementUntilTouchDrag,n=eO.holdDelay,o=FB){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=sn(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):yAt(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),s.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},SAt=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var r,i;this._startEvent=e,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},EAt=class extends fl{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new SAt({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:T,y:C}of r.pointers.values())i=Math.max(i,T),s=Math.min(s,T),n=Math.max(n,C),o=Math.min(o,C);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:T,y:C}of e.pointers.values())a=Math.max(a,T),l=Math.min(l,T),c=Math.max(c,C),h=Math.min(h,C);const p=i-s,A=n-o,_=a-l,w=c-h;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(_-p)<=this._maxDelta&&Math.abs(w-A)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}},Yf=class extends Ke{constructor(){super(...arguments),this._handles=new ts}destroy(){this._handles=gt(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return!!((e=this._inputManager)!=null&&e.hasPendingInputs)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=gt(this._inputManager)}connect(){const e=this.view;this._source=new HIe(this.view.surface,e.input);const r=[new xAt,new TAt,new wAt,new vAt(this.view.navigation),new EAt],i=new Fm({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new AAt],Uv.INTERNAL),this._modeDragPan=new k0e(e,"primary"),this._modeDragRotate=new dj(e,"secondary",yh.CENTER),this._modeDragZoom=new Ggt(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new oAt(e),new kmt(e),new Zgt(e),new Jgt(e,s.pan),new Kgt(e),new lAt(e,s.resetTilt),new aAt(e,s.resetHeading),new dj(e,"primary",yh.EYE,[s.lookAround]),new dj(e,"secondary",yh.CENTER,[s.lookAround]),new k0e(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new cAt(e)],Uv.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(xe(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},Cr))}_updateMode(){var s;const e=this.mode,r=this.primaryDragAction,i=(s=WJ.get(e))==null?void 0:s.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],Yf.prototype,"view",void 0),u([d({value:"pan"})],Yf.prototype,"primaryDragAction",null),u([d({value:"default"})],Yf.prototype,"mode",null),u([d({readOnly:!0})],Yf.prototype,"hasPendingInputs",null),u([d()],Yf.prototype,"latestPointerType",null),u([d()],Yf.prototype,"latestPointerLocation",null),u([d()],Yf.prototype,"multiTouchActive",null),u([d()],Yf.prototype,"_inputManager",void 0),Yf=u([j("esri.views.3d.input.SceneInputManager")],Yf);const WJ=new Map,mj=new Map,gj=new Map;mj.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),mj.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),gj.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),gj.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),WJ.set("default",mj),WJ.set("pro",gj);const CAt=Yf;let wd,u3,YJ=!1,QJ=!1,XJ=!1,ZJ=!1,KI=null;function MAt(t,e){if(!QJ||!u3)return;QIe();const r=u3;let i=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];i+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,h=(n+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),XIe(a,l,c,h,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function RAt(t){XJ=Qi.DECONFLICTOR_SHOW_VISIBLE,ZJ=Qi.DECONFLICTOR_SHOW_INVISIBLE,YJ=XJ||ZJ,QJ=Qi.DECONFLICTOR_SHOW_GRID,KI=null,YJ||QJ?KI=()=>OAt(t):wd&&(wd.parentElement.removeChild(wd),wd=null)}function QIe(){KI&&(KI(),KI=null)}function OAt(t){wd==null&&(wd=document.createElement("canvas"),wd.setAttribute("id","canvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(wd));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:s,height:n}=r,o=s*i,a=n*i;wd.setAttribute("width",`${o}px`),wd.setAttribute("height",`${a}px`),wd.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),u3=wd.getContext("2d"),u3.clearRect(0,0,s,n),u3.font="12px Arial"}function XIe(t,e,r,i,s){QIe();const n=wd.height,o=u3;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-r),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.closePath()}function PAt(t,e){YJ&&(e&&XJ||!e&&ZJ)&&XIe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var sl,Mh;(function(t){t[t.GRAPHIC=0]="GRAPHIC",t[t.LABEL=1]="LABEL",t[t._COUNT=2]="_COUNT"})(sl||(sl={})),function(t){t[t.USER_SETTING=0]="USER_SETTING",t[t.SCALE_RANGE=1]="SCALE_RANGE",t[t.FILTER=2]="FILTER",t[t.DECONFLICTION=3]="DECONFLICTION",t[t._COUNT=4]="_COUNT"}(Mh||(Mh={}));function ZIe(t,e){return new t$e(t,i$e,e)}function IAt(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=i$e;return new t$e(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:Aj.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:Aj.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:Aj.minPixelSize},e)}function $At(t){return Math.abs(t*t*t)}function JIe(t,e,r){const i=r.parameters,s=r.paddingPixelsOverride;return tO.scale=Math.min(i.divisor/(e-i.offset),1),tO.factor=$At(t),tO.minPixelSize=i.minPixelSize,tO.paddingPixels=s,tO}function KIe(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function _ne(t,e){return Math.max(Sr(t*e.scale,t,e.factor),KIe(t,e))}function LAt(t,e,r){const i=JIe(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,_ne(1,i)}function G0e(t,e,r,i){i.scale=LAt(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function e$e(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,KIe(t[1],e)/Math.max(1e-5,t[1])),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function DAt(t,e,r,i){return _ne(t,JIe(e,r,i))}let t$e=class r$e{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,r,i,s=NAt(),n){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===_t.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new r$e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,r),h=this._coverageCompensation(e,r,c),{tiltAngle:p,scaleFallOffFactor:A}=c,_=Math.sin(p)*l,w=.5*Math.PI-p-a*(.5-s*h),T=_/Math.cos(w),C=w+a*n*h,M=(T-A*(_/Math.cos(C)))/(1-A);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=M,i.divisor=T-M,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(e,r,i=j0e){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=j0e){const s=this._description.curvatureDependent,n=1+e.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=ze((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return i.tiltAngle=Sr(h.tiltAngle,p.tiltAngle,c),i.scaleFallOffFactor=Sr(h.scaleFallOffFactor,p.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}};const i$e={curvatureDependent:{min:{curvature:$r(10),tiltAngle:$r(12),scaleFallOffFactor:.5},max:{curvature:$r(70),tiltAngle:$r(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},Aj={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function NAt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const tO={scale:0,factor:0,minPixelSize:0,paddingPixels:0},j0e={tiltAngle:0,scaleFallOffFactor:0};function FAt(t){return t instanceof Float32Array&&t.length>=16}function kAt(t){return Array.isArray(t)&&t.length>=16}function BAt(t){return FAt(t)||kAt(t)}function vne(t){t.vertex.code.add(I`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(I`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(I`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(I`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(I`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(I`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(I`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function UAt(t){t.uniforms.add(new hi("screenSizePerspective",e=>s$e(e.screenSizePerspective)))}function b7(t){t.uniforms.add(new hi("screenSizePerspectiveAlignment",e=>s$e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function s$e(t){return ns(VAt,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const VAt=Zr();let n$e=class extends kn{constructor(e,r){super(e,"mat4",As.Draw,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};function W0(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",sc):t.uniforms.add(new Vd("cameraPosition",(r,i)=>$e(o$e,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function Uh(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add([new nn("proj",(i,s)=>s.camera.projectionMatrix),new n$e("view",(i,s)=>ju(H0e,s.camera.viewMatrix,i.origin)),new Vd("localOrigin",i=>i.origin)]);const r=i=>$e(o$e,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add([new nn("proj",(i,s)=>s.camera.projectionMatrix),new nn("view",(i,s)=>ju(H0e,s.camera.viewMatrix,r(s))),new Fr("localOrigin",(i,s)=>r(s))])}const H0e=SL(),o$e=V();function pM(t){t.uniforms.add(new nn("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function a$e(t,e){const r=t.vertex;e.hasVerticalOffset?(l$e(r),e.hasScreenSizePerspective&&(t.include(vne),b7(r),W0(t.vertex,e)),r.code.add(I`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?I`vec3 worldNormal = normalize(worldPos + localOrigin);`:I`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?I`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:I`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(I`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const zAt=Zr();function l$e(t){t.uniforms.add(new hi("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return ns(zAt,n*a,o,i,s)}))}var Ad;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Ad||(Ad={}));var Du;function c$e(t,e){t.include(vne),t.attributes.add(B.POSITION,"vec3"),t.attributes.add(B.NORMAL,"vec3"),t.attributes.add(B.AUXPOS1,"vec4");const r=t.vertex;Uh(r,e),W0(r,e),r.uniforms.add([new hi("viewport",(i,s)=>s.camera.fullViewport),new nt("polygonOffset",i=>i.shaderPolygonOffset),new nt("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1),new nt("renderTransparentlyOccludedHUD",(i,s)=>s.renderTransparentlyOccludedHUD===Ad.Occluded?1:s.renderTransparentlyOccludedHUD===Ad.NotOccluded?0:.75),new mr("hudVisibilityTexture",(i,s)=>s.hudVisibilityTexture)]),e.hasVerticalOffset&&l$e(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(I`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(I`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.isDraped&&!e.hasVerticalOffset||pM(r),e.isDraped||(r.uniforms.add(new nt("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(I`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===Du.Screen&&r.uniforms.add(new nt("pixelRatio",(i,s)=>s.camera.pixelRatio)),e.hasScreenSizePerspective&&b7(r),r.code.add(I`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===Du.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?I`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==Du.Screen?I`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===Du.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===Du.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.code.add(I`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(Du||(Du={}));const cN=Jo();function u$e(t,e,r,i,s,n){if(t.visible)if(t.boundingInfo){Zt(t.type===Xn.Mesh);const o=e.tolerance;h$e(t.boundingInfo,r,i,o,s,n)}else{const o=t.indices.get(B.POSITION),a=t.vertexAttributes.get(B.POSITION);jL(r,i,0,o.length/3,o,a,void 0,s,n)}}const GAt=V();function h$e(t,e,r,i,s,n){if(N(t))return;const o=p$e(e,r,GAt);if(Cxe(cN,t.bbMin),Mxe(cN,t.bbMax),E(s)&&s.applyToAabb(cN),wne(cN,e,o,i)){const{primitiveIndices:a,indices:l,position:c}=t,h=a?a.length:l.length/3;if(h>WAt){const p=t.getChildren();if(p!==void 0){for(const A of p)h$e(A,e,r,i,s,n);return}}jL(e,r,0,h,l,c,a,s,n)}}const d$e=V();function jL(t,e,r,i,s,n,o,a,l){if(o)return jAt(t,e,r,i,s,n,o,a,l);const{data:c,stride:h}=n,p=t[0],A=t[1],_=t[2],w=e[0]-p,T=e[1]-A,C=e[2]-_;for(let M=r,O=3*r;M<i;++M){let $=h*s[O++],L=c[$++],k=c[$++],F=c[$];$=h*s[O++];let G=c[$++],z=c[$++],Z=c[$];$=h*s[O++];let J=c[$++],te=c[$++],re=c[$];E(a)&&([L,k,F]=a.applyToVertex(L,k,F,M),[G,z,Z]=a.applyToVertex(G,z,Z,M),[J,te,re]=a.applyToVertex(J,te,re,M));const Ae=G-L,ve=z-k,ye=Z-F,le=J-L,W=te-k,q=re-F,X=T*q-W*C,se=C*le-q*w,ae=w*W-le*T,fe=Ae*X+ve*se+ye*ae;if(Math.abs(fe)<=Number.EPSILON)continue;const ue=p-L,Re=A-k,De=_-F,Ue=ue*X+Re*se+De*ae;if(fe>0){if(Ue<0||Ue>fe)continue}else if(Ue>0||Ue<fe)continue;const Je=Re*ye-ve*De,vt=De*Ae-ye*ue,lt=ue*ve-Ae*Re,Ye=w*Je+T*vt+C*lt;if(fe>0){if(Ye<0||Ue+Ye>fe)continue}else if(Ye>0||Ue+Ye<fe)continue;const ut=(le*Je+W*vt+q*lt)/fe;ut>=0&&l(ut,bne(Ae,ve,ye,le,W,q,d$e),M,!1)}}function jAt(t,e,r,i,s,n,o,a,l){const{data:c,stride:h}=n,p=t[0],A=t[1],_=t[2],w=e[0]-p,T=e[1]-A,C=e[2]-_;for(let M=r;M<i;++M){const O=o[M];let $=3*O,L=h*s[$++],k=c[L++],F=c[L++],G=c[L];L=h*s[$++];let z=c[L++],Z=c[L++],J=c[L];L=h*s[$];let te=c[L++],re=c[L++],Ae=c[L];E(a)&&([k,F,G]=a.applyToVertex(k,F,G,M),[z,Z,J]=a.applyToVertex(z,Z,J,M),[te,re,Ae]=a.applyToVertex(te,re,Ae,M));const ve=z-k,ye=Z-F,le=J-G,W=te-k,q=re-F,X=Ae-G,se=T*X-q*C,ae=C*W-X*w,fe=w*q-W*T,ue=ve*se+ye*ae+le*fe;if(Math.abs(ue)<=Number.EPSILON)continue;const Re=p-k,De=A-F,Ue=_-G,Je=Re*se+De*ae+Ue*fe;if(ue>0){if(Je<0||Je>ue)continue}else if(Je>0||Je<ue)continue;const vt=De*le-ye*Ue,lt=Ue*ve-le*Re,Ye=Re*ye-ve*De,ut=w*vt+T*lt+C*Ye;if(ue>0){if(ut<0||Je+ut>ue)continue}else if(ut>0||Je+ut<ue)continue;const ht=(W*vt+q*lt+X*Ye)/ue;ht>=0&&l(ht,bne(ve,ye,le,W,q,X,d$e),O,!1)}}const q0e=V(),W0e=V();function bne(t,e,r,i,s,n,o){return $e(q0e,t,e,r),$e(W0e,i,s,n),Xt(o,q0e,W0e),qe(o,o),o}function p$e(t,e,r){return $e(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function wne(t,e,r,i){return xne(t,e,r,i,1/0)}function xne(t,e,r,i,s){const n=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-i-e[1])*r[1],h=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(t[2]-i-e[2])*r[2],A=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(p,A)),!(l<0)&&(a=Math.max(a,Math.min(p,A)),!(a>l)&&a<s)}function f$e(t,e,r,i,s){let n=(r.screenLength||0)*t.pixelRatio;E(s)&&(n=DAt(n,i,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return ze(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function m$e(t,e){const r=e?m$e(e):{};for(const i in t){let s=t[i];s&&s.forEach&&(s=qAt(s)),s==null&&i in r||(r[i]=s)}return r}function HAt(t,e){let r=!1;for(const i in e){const s=e[i];s!==void 0&&(Array.isArray(s)?t[i]===null?(t[i]=s.slice(),r=!0):Qee(t[i],s)&&(r=!0):t[i]!==s&&(r=!0,t[i]=s))}return r}function qAt(t){const e=[];return t.forEach(r=>e.push(r)),e}const g$e={multiply:1,ignore:2,replace:3,tint:4},WAt=1e3;let Pb=class extends UL{constructor(e,r){super(),this.type=Xn.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Pi,this._pp0=ct(0,0,1),this._pp1=ct(0,0,0),this._parameters=m$e(e,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){HAt(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){E(this.repository)&&this.repository.materialChanged(this)}intersectDraped(e,r,i,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,r,i,this._pp0,this._pp1,n)}},A$e=class extends apt{constructor(e,r,i){super(r,i),this.camera=e}};var xn;(function(t){t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(xn||(xn={}));let rR=class extends ys{constructor(){super(...arguments),this.renderOccluded=xn.Occlude}},y$e=class{constructor(){this.factor=new Y0e,this.factorAlignment=new Y0e}},Y0e=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function rVt(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l)n[i]=e[t[l]],i+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let h=0;h<s;h++)n[i]=c,i+=o}}function YAt(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length;i*=n;for(let a=0;a<o;++a){const l=2*t[a];s[i]=e[l],s[i+1]=e[l+1],i+=n}}function _$e(t,e,r,i,s){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let h=0;h<s;++h)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}}function fM(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l){const c=4*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let h=0;h<s;++h)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}}function Q0e(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<r;++n)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=s}function w7(t,e,r,i,s,n=1){if(!r)return void _$e(t,e,i,s,n);const o=i.typedBuffer,a=i.typedBufferStride,l=t.length,c=r[0],h=r[1],p=r[2],A=r[4],_=r[5],w=r[6],T=r[8],C=r[9],M=r[10],O=r[12],$=r[13],L=r[14];s*=a;let k=0,F=0,G=0;const z=gU(r)?Z=>{k=e[Z]+O,F=e[Z+1]+$,G=e[Z+2]+L}:Z=>{const J=e[Z],te=e[Z+1],re=e[Z+2];k=c*J+A*te+T*re+O,F=h*J+_*te+C*re+$,G=p*J+w*te+M*re+L};if(n===1)for(let Z=0;Z<l;++Z)z(3*t[Z]),o[s]=k,o[s+1]=F,o[s+2]=G,s+=a;else for(let Z=0;Z<l;++Z){z(3*t[Z]);for(let J=0;J<n;++J)o[s]=k,o[s+1]=F,o[s+2]=G,s+=a}}function Tne(t,e,r,i,s,n=1){if(!r)return void _$e(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],p=o[1],A=o[2],_=o[4],w=o[5],T=o[6],C=o[8],M=o[9],O=o[10],$=!Rre(o),L=1e-6,k=1-L;s*=l;let F=0,G=0,z=0;const Z=gU(o)?J=>{F=e[J],G=e[J+1],z=e[J+2]}:J=>{const te=e[J],re=e[J+1],Ae=e[J+2];F=h*te+_*re+C*Ae,G=p*te+w*re+M*Ae,z=A*te+T*re+O*Ae};if(n===1)if($)for(let J=0;J<c;++J){Z(3*t[J]);const te=F*F+G*G+z*z;if(te<k&&te>L){const re=1/Math.sqrt(te);a[s]=F*re,a[s+1]=G*re,a[s+2]=z*re}else a[s]=F,a[s+1]=G,a[s+2]=z;s+=l}else for(let J=0;J<c;++J)Z(3*t[J]),a[s]=F,a[s+1]=G,a[s+2]=z,s+=l;else for(let J=0;J<c;++J){if(Z(3*t[J]),$){const te=F*F+G*G+z*z;if(te<k&&te>L){const re=1/Math.sqrt(te);F*=re,G*=re,z*=re}}for(let te=0;te<n;++te)a[s]=F,a[s+1]=G,a[s+2]=z,s+=l}}function QAt(t,e,r,i,s,n=1){if(!r)return void fM(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],p=o[1],A=o[2],_=o[4],w=o[5],T=o[6],C=o[8],M=o[9],O=o[10],$=!Rre(o),L=1e-6,k=1-L;if(s*=l,n===1)for(let F=0;F<c;++F){const G=4*t[F],z=e[G],Z=e[G+1],J=e[G+2],te=e[G+3];let re=h*z+_*Z+C*J,Ae=p*z+w*Z+M*J,ve=A*z+T*Z+O*J;if($){const ye=re*re+Ae*Ae+ve*ve;if(ye<k&&ye>L){const le=1/Math.sqrt(ye);re*=le,Ae*=le,ve*=le}}a[s]=re,a[s+1]=Ae,a[s+2]=ve,a[s+3]=te,s+=l}else for(let F=0;F<c;++F){const G=4*t[F],z=e[G],Z=e[G+1],J=e[G+2],te=e[G+3];let re=h*z+_*Z+C*J,Ae=p*z+w*Z+M*J,ve=A*z+T*Z+O*J;if($){const ye=re*re+Ae*Ae+ve*ve;if(ye<k&&ye>L){const le=1/Math.sqrt(ye);re*=le,Ae*=le,ve*=le}}for(let ye=0;ye<n;++ye)a[s]=re,a[s+1]=Ae,a[s+2]=ve,a[s+3]=te,s+=l}}function Sne(t,e,r,i,s,n=1){const o=i.typedBuffer,a=i.typedBufferStride,l=t.length;if(s*=a,r!==e.length||r!==4)if(n!==1)if(r!==4)for(let c=0;c<l;++c){const h=3*t[c];for(let p=0;p<n;++p)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const h=4*t[c];for(let p=0;p<n;++p)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}else{if(r===4){for(let c=0;c<l;++c){const h=4*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}return}for(let c=0;c<l;++c){const h=3*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}}else{o[s]=e[0],o[s+1]=e[1],o[s+2]=e[2],o[s+3]=e[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),h=a/4,p=c[s/=4];s+=h;const A=l*n;for(let _=1;_<A;++_)c[s]=p,s+=h}}function v$e(t,e,r,i,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(i*=o,s===1)for(let a=0;a<r;++a)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<s;++l)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o}function b$e(t,e,r,i,s,n){for(const o of e.fieldNames){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)switch(o){case B.POSITION:{Zt(a.size===3);const c=s.getField(o,ks);Zt(!!c,`No buffer view for ${o}`),c&&w7(l,a.data,r,c,n);break}case B.NORMAL:{Zt(a.size===3);const c=s.getField(o,ks);Zt(!!c,`No buffer view for ${o}`),c&&Tne(l,a.data,i,c,n);break}case B.UV0:{Zt(a.size===2);const c=s.getField(o,o_);Zt(!!c,`No buffer view for ${o}`),c&&YAt(l,a.data,c,n);break}case B.COLOR:case B.SYMBOLCOLOR:{Zt(a.size===3||a.size===4);const c=s.getField(o,uc);Zt(!!c,`No buffer view for ${o}`),c&&Sne(l,a.data,a.size,c,n);break}case B.TANGENT:{Zt(a.size===4);const c=s.getField(o,Gh);Zt(!!c,`No buffer view for ${o}`),c&&QAt(l,a.data,i,c,n);break}case B.PROFILERIGHT:case B.PROFILEUP:case B.PROFILEVERTEXANDNORMAL:case B.FEATUREVALUE:{Zt(a.size===4);const c=s.getField(o,Gh);Zt(!!c,`No buffer view for ${o}`),c&&fM(l,a.data,c,n)}}else if(o===B.OBJECTANDLAYERIDCOLOR&&E(t.objectAndLayerIdColor)){const c=t.indices.get(B.POSITION);if(Zt(!!c,`No buffer view for ${o}`),c){const h=c.length,p=s.getField(o,uc);v$e(t.objectAndLayerIdColor,p,h,n)}}}}function R4(t,e,r=0){const i=ze(t,0,JAt);for(let s=0;s<4;s++)e[r+s]=Math.floor(256*KAt(i*XAt[s]))}function Ene(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*ZAt[i];return r}const XAt=[1,256,65536,16777216],ZAt=[1/256,1/65536,1/16777216,1/4294967296],JAt=Ene(new Uint8ClampedArray([255,255,255,255]));function KAt(t){return t-Math.floor(t)}async function jy(t,e){const{data:r}=await Ys(t,{responseType:"image",...e});return r}let Cne=class extends ys{constructor(){super(...arguments),this.color=Nr(1,1,1,1)}};function eyt(){const t=new Di;return t.include(Af),t.fragment.uniforms.add([new mr("tex",e=>e.texture),new hi("uColor",e=>e.color)]),t.fragment.code.add(I`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),t}const tyt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Cne,build:eyt},Symbol.toStringTag,{value:"Module"}));function ryt(){if(N(yj)){const t=e=>Zi(`esri/libs/basisu/${e}`);yj=be(()=>import("./basis_transcoder-e0466ff6.js"),["assets/basis_transcoder-e0466ff6.js","assets/_commonjsHelpers-2f3e7994.js"]).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return yj}let yj;var V2;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(V2||(V2={}));let L0=null,uN=null;async function w$e(){return N(uN)&&(uN=ryt(),L0=await uN),uN}function iyt(t,e){if(N(L0))return t.byteLength;const r=new L0.BasisFile(new Uint8Array(t)),i=T$e(r)?x$e(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function syt(t,e){if(N(L0))return t.byteLength;const r=new L0.KTX2File(new Uint8Array(t)),i=S$e(r)?x$e(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function x$e(t,e,r,i,s){const n=dOe(e?Hn.COMPRESSED_RGBA8_ETC2_EAC:Hn.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*n*o)}function T$e(t){return t.getNumImages()>=1&&!t.isUASTC()}function S$e(t){return t.getFaces()>=1&&t.isETC1S()}async function nyt(t,e,r){N(L0)&&(L0=await w$e());const i=new L0.BasisFile(new Uint8Array(r));if(!T$e(i))return null;i.startTranscoding();const s=E$e(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function oyt(t,e,r){N(L0)&&(L0=await w$e());const i=new L0.KTX2File(new Uint8Array(r));if(!S$e(i))return null;i.startTranscoding();const s=E$e(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function E$e(t,e,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,p]=l?i?[V2.ETC2_RGBA,Hn.COMPRESSED_RGBA8_ETC2_EAC]:[V2.ETC1_RGB,Hn.COMPRESSED_RGB8_ETC2]:c?i?[V2.BC3_RGBA,Hn.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[V2.BC1_RGB,Hn.COMPRESSED_RGB_S3TC_DXT1_EXT]:[V2.RGBA32,At.RGBA],A=e.hasMipmap?r:Math.min(1,r),_=[];for(let M=0;M<A;M++)_.push(new Uint8Array(o(M,h))),a(M,h,_[M]);const w=_.length>1,T=w?Bt.LINEAR_MIPMAP_LINEAR:Bt.LINEAR,C={...e,samplingMode:T,hasMipmap:w,internalFormat:p,width:s,height:n};return new Wt(t,C,{type:"compressed",levels:_})}const rO=we.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),ayt=542327876,lyt=131072,cyt=4;function Mne(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function uyt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const hyt=Mne("DXT1"),dyt=Mne("DXT3"),pyt=Mne("DXT5"),fyt=31,myt=0,gyt=1,Ayt=2,yyt=3,_yt=4,vyt=7,byt=20,wyt=21;function xyt(t,e,r){const{textureData:i,internalFormat:s,width:n,height:o}=Pu(Tyt(r,e.hasMipmap??!1));return e.samplingMode=i.levels.length>1?Bt.LINEAR_MIPMAP_LINEAR:Bt.LINEAR,e.hasMipmap=i.levels.length>1,e.internalFormat=s,e.width=n,e.height=o,new Wt(t,e,i)}function Tyt(t,e){const r=new Int32Array(t,0,fyt);if(r[myt]!==ayt)return rO.error("Invalid magic number in DDS header"),null;if(!(r[byt]&cyt))return rO.error("Unsupported format, must contain a FourCC code"),null;const i=r[wyt];let s,n;switch(i){case hyt:s=8,n=Hn.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case dyt:s=16,n=Hn.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case pyt:s=16,n=Hn.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return rO.error("Unsupported FourCC code:",uyt(i)),null}let o=1,a=r[_yt],l=r[yyt];!(3&a)&&!(3&l)||(rO.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,A;r[Ayt]&lyt&&e!==!1&&(o=Math.max(1,r[vyt])),o===1||U0(a)&&U0(l)||(rO.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let _=r[gyt]+4;const w=[];for(let T=0;T<o;++T)A=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(t,_,A),w.push(p),_+=A,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:w},internalFormat:n,width:c,height:h}}let IT=class l8 extends UL{constructor(e,r){super(),this._data=e,this.type=Xn.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new Nn,this._passParameters=new Cne,this.params=r||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:pr.REPEAT,t:pr.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||Vv.STRETCH,this.estimatedTexMemRequired=l8._estimateTexMemRequired(this._data,this.params),this._startPreload()}_startPreload(){const e=this._data;N(e)||(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(O3(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){zg(e.src)||O3(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static _getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static _estimateTexMemRequired(e,r){if(N(e))return 0;if(wR(e)||R2(e))return r.encoding===ny.KTX2_ENCODING?syt(e,!!r.mipmap):r.encoding===ny.BASIS_ENCODING?iyt(e,!!r.mipmap):e.byteLength;const{width:i,height:s}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?l8._getDataDimensions(e):r;return(r.mipmap?4/3:1)*i*s*(r.components||4)||0}dispose(){this._data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(e){return{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?Bt.LINEAR_MIPMAP_LINEAR:Bt.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.maxAnisotropy??(this.params.mipmap?e.parameters.maxMaxAnisotropy:1)}}get glTexture(){return this._glTexture}load(e,r){if(E(this._glTexture))return this._glTexture;if(E(this._loadingPromise))return this._loadingPromise;const i=this._data;return N(i)?(this._glTexture=new Wt(e,this._createDescriptor(e),null),this._glTexture):typeof i=="string"?this._loadFromURL(e,r,i):i instanceof Image?this._loadFromImageElement(e,r,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,r,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i,r):(wR(i)||R2(i))&&this.params.encoding===ny.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,i)):(wR(i)||R2(i))&&this.params.encoding===ny.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,i)):(wR(i)||R2(i))&&this.params.encoding===ny.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,i)):R2(i)?this._loadFromPixelData(e,i):wR(i)?this._loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e,r,i){if(!(this._data instanceof HTMLVideoElement)||N(this._glTexture)||this._data.readyState<e$.HAVE_CURRENT_DATA||i===this._data.currentTime)return i;if(E(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this._data),this._drawStretchedTexture(e,r,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this._data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this._data):this._glTexture.setData(this._data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this._data.currentTime}_loadFromDDSData(e,r){return this._glTexture=xyt(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>oyt(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>nyt(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){Zt(this.params.width>0&&this.params.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this.params.components===1?At.LUMINANCE:this.params.components===3?At.RGB:At.RGBA,i.width=this.params.width,i.height=this.params.height,this._glTexture=new Wt(e,i,r),this._glTexture}_loadFromURL(e,r,i){return this._loadAsync(async s=>{const n=await jy(i,{signal:s});return di(s),this._loadFromImage(e,n,r)})}_loadFromImageElement(e,r,i){return i.complete?this._loadFromImage(e,i,r):this._loadAsync(async s=>{const n=await Gwe(i,i.src,!1,s);return di(s),this._loadFromImage(e,n,r)})}_loadFromVideoElement(e,r,i){return i.readyState>=e$.HAVE_CURRENT_DATA?this._loadFromImage(e,i,r):this._loadFromVideoElementAsync(e,r,i)}_loadFromVideoElementAsync(e,r,i){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{i.removeEventListener("loadeddata",l),i.removeEventListener("error",c),sn(h)},l=()=>{i.readyState>=e$.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(e,i,r)))},c=p=>{a(),o(p||new ce("Failed to load video"))};i.addEventListener("loadeddata",l),i.addEventListener("error",c);const h=ic(s,()=>c(Yi()))}))}_loadFromImage(e,r,i){const s=l8._getDataDimensions(r);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(e);return n.pixelFormat=this.params.components===3?At.RGB:At.RGBA,!this._requiresPowerOfTwo(e,n)||U0(s.width)&&U0(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new Wt(e,n,r),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(e,r,s,n,i),this._glTexture)}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}_requiresPowerOfTwo(e,r){const i=pr.CLAMP_TO_EDGE,s=typeof r.wrapMode=="number"?r.wrapMode===i:r.wrapMode.s===i&&r.wrapMode.t===i;return e.type===sr.WEBGL1&&(r.hasMipmap||!s)}_makePowerOfTwoTexture(e,r,i,s,n){const{width:o,height:a}=i,l=$3(o),c=$3(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case Vv.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new Wt(e,s),h.updateData(0,0,0,o,a,r);break;case Vv.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(e,r,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(e,r,i,s){const n=new Wt(e,i),o=new Jn(e,{colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE},n),a=new Wt(e,{target:nr.TEXTURE_2D,pixelFormat:i.pixelFormat,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:Bt.LINEAR,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},r),l=mc(e),c=e.getBoundFramebufferObject();return this._drawStretchedTexture(e,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),e.bindFramebuffer(c),n}_drawStretchedTexture(e,r,i,s,n,o){this._passParameters.texture=n,e.bindFramebuffer(i);const a=e.getViewport();e.setViewport(0,0,o.descriptor.width,o.descriptor.height),e.bindTechnique(r,this._passParameters,null),e.bindVAO(s),e.drawArrays(Ar.TRIANGLE_STRIP,0,Ol(s,"geometry")),e.bindFramebuffer(null),e.setViewport(a.x,a.y,a.width,a.height),this._passParameters.texture=null}unload(){if(E(this._powerOfTwoStretchInfo)){const{framebuffer:e,vao:r,sourceTexture:i}=this._powerOfTwoStretchInfo;r.dispose(!0),i.dispose(),e.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(E(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),E(this._loadingController)){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};var e$;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(e$||(e$={}));const O4=128,Rne=.5;function C$e(t,e=O4,r=e*Rne,i=0){const s=Syt(t,e,r,i);return new IT(s,{mipmap:!1,wrap:{s:pr.CLAMP_TO_EDGE,t:pr.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function Syt(t,e=O4,r=e*Rne,i=0){switch(t){case"circle":default:return Eyt(e,r);case"square":return Cyt(e,r);case"cross":return Ryt(e,r,i);case"x":return Oyt(e,r,i);case"kite":return Myt(e,r);case"triangle":return Pyt(e,r);case"arrow":return Iyt(e,r)}}function Eyt(t,e){const r=t/2-.5;return HL(t,O$e(r,r,e/2))}function Cyt(t,e){return M$e(t,e,!1)}function Myt(t,e){return M$e(t,e,!0)}function Ryt(t,e,r=0){return R$e(t,e,!1,r)}function Oyt(t,e,r=0){return R$e(t,e,!0,r)}function Pyt(t,e){return HL(t,P$e(t/2,e,e/2))}function Iyt(t,e){const r=e,i=e/2,s=t/2,n=.8*r,o=O$e(s,(t-e)/2-n,Math.sqrt(n*n+i*i)),a=P$e(s,r,i);return HL(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function M$e(t,e,r){return r&&(e/=Math.SQRT2),HL(t,(i,s)=>{let n=i-.5*t+.25,o=.5*t-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function R$e(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const s=.5*e;return HL(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(r){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function O$e(t,e,r){return(i,s)=>{const n=i-t,o=s-e;return Math.sqrt(n*n+o*o)-r}}function P$e(t,e,r){const i=Math.sqrt(e*e+r*r);return(s,n)=>{const o=Math.abs(s-t)-r,a=n-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function HL(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let s=0;s<t;s++){const n=s+t*i;let o=e(s,i);o=o/t+.5,R4(o,r,4*n)}return r}let sVt=class extends ys{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function $yt(t,e){I$e(t,e,[new Fr("slicePlaneOrigin",(r,i)=>N$e(e,r,i)),new Fr("slicePlaneBasis1",(r,i)=>{var s;return U9(e,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new Fr("slicePlaneBasis2",(r,i)=>{var s;return U9(e,r,i,(s=i.slicePlane)==null?void 0:s.basis2)})])}function ho(t,e){I$e(t,e,[new Vd("slicePlaneOrigin",(r,i)=>N$e(e,r,i)),new Vd("slicePlaneBasis1",(r,i)=>{var s;return U9(e,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new Vd("slicePlaneBasis2",(r,i)=>{var s;return U9(e,r,i,(s=i.slicePlane)==null?void 0:s.basis2)})])}function I$e(t,e,r){if(!e.hasSlicePlane){const o=I`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}t.extensions.add("GL_OES_standard_derivatives"),e.hasSliceInVertexProgram&&t.vertex.uniforms.add(r),t.fragment.uniforms.add(r);const i=I`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=I`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?I`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:I`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(n)}function $$e(t,e,r){return t.instancedDoublePrecision?$e(Lyt,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function L$e(t,e){return E(t)?Be(V9,e.origin,t):e.origin}function D$e(t,e,r){return t.hasSliceTranslatedView?E(e)?ju(Dyt,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function N$e(t,e,r){if(N(r.slicePlane))return sc;const i=$$e(t,e,r),s=L$e(i,r.slicePlane),n=D$e(t,i,r);return E(n)?Mt(V9,s,n):s}function U9(t,e,r,i){if(N(i)||N(r.slicePlane))return sc;const s=$$e(t,e,r),n=L$e(s,r.slicePlane),o=D$e(t,s,r);return E(o)?(ke(iO,i,n),Mt(V9,n,o),Mt(iO,iO,o),Be(iO,iO,V9)):i}const Lyt=V(),V9=V(),iO=V(),Dyt=ot();function x7(t,e){const r=e.output===ee.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(B.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):t.attributes.add(B.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(I`
     void forwardObjectAndLayerIdColor() {
      ${r?i?I`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:I`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:I``} }`),t.fragment.code.add(I`
      void outputObjectAndLayerIdColor() {
        ${r?I`gl_FragColor = objectAndLayerIdColorVarying;`:I``} }`)}function Nyt(t,e){const{vertex:r,fragment:i}=t;e.hasMultipassGeometry&&r.include(DOe),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(I`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?I`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&i.include(Wd),e.hasMultipassTerrain&&i.uniforms.add([...$0("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture,e.hasWebGL2Context?is.None:is.InvSize),new Bi("nearFar",(s,n)=>n.camera.nearFar)]),i.include(qh),i.code.add(I`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${e.hasMultipassTerrain?I`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${Wc(e,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const Fyt=Nr(1,1,0,1),F$e=Nr(1,0,1,1);function a_(t,e){t.fragment.uniforms.add($0("depthTex",(r,i)=>i.highlightDepthTexture,e.hasWebGL2Context?is.None:is.InvSize)),t.fragment.constants.add("occludedHighlightFlag","vec4",Fyt).add("unoccludedHighlightFlag","vec4",F$e),t.fragment.code.add(I`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${Wc(e,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)}let T7=class extends kn{constructor(e,r,i){super(e,"vec4",As.Pass,(s,n,o)=>s.setUniform4fv(e,r(n,o)),i)}},Kl=class extends kn{constructor(e,r,i){super(e,"float",As.Pass,(s,n,o)=>s.setUniform1fv(e,r(n,o)),i)}},One=class extends rR{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=ct(1,1,1),this.vvSizeMaxSize=ct(100,100,100),this.vvSizeOffset=ct(0,0,0),this.vvSizeFactor=ct(1,1,1),this.vvSizeValue=ct(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=mn()}};const D0=8;function h3(t,e){e.hasVvInstancing&&(e.vvSize||e.vvColor)&&t.attributes.add(B.INSTANCEFEATUREATTRIBUTE,"vec4");const r=t.vertex;e.vvSize?(r.uniforms.add(new Fr("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new Fr("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new Fr("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new Fr("vvSizeFactor",i=>i.vvSizeFactor)),r.uniforms.add(new Xg("vvSymbolRotationMatrix",i=>i.vvSymbolRotationMatrix)),r.uniforms.add(new Fr("vvSymbolAnchor",i=>i.vvSymbolAnchor)),r.code.add(I`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(I`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?I`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(I`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",D0),e.hasVvInstancing&&r.uniforms.add([new Kl("vvColorValues",i=>i.vvColorValues,D0),new T7("vvColorColors",i=>i.vvColorColors,D0)]),r.code.add(I`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${e.hasVvInstancing?I`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):r.code.add(I`vec4 vvColor() { return vec4(1.0); }`)}const z9=.1,Il=.001;function kyt(t){const e=new Di,r=t.signedDistanceFieldEnabled;if(e.include(Gse),e.include(c$e,t),e.include(ho,t),t.occlusionPass)return e.include(Nyt,t),e;const{vertex:i,fragment:s}=e;e.include(vne),s.include(qh),s.include(Qg),e.include(h3,t),e.include(x7,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),i.uniforms.add([new hi("viewport",(c,h)=>h.camera.fullViewport),new Bi("screenOffset",(c,h)=>Kr(k$e,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new Bi("anchorPosition",c=>G9(c)),new hi("materialColor",c=>c.color),new nt("pixelRatio",(c,h)=>h.camera.pixelRatio)]),r&&(i.uniforms.add(new hi("outlineColor",c=>c.outlineColor)),s.uniforms.add([new hi("outlineColor",c=>X0e(c)?c.outlineColor:bg),new nt("outlineSize",c=>X0e(c)?c.outlineSize:0)])),t.hasScreenSizePerspective&&(UAt(i),b7(i)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(B.UV0,"vec2"),e.attributes.add(B.COLOR,"vec4"),e.attributes.add(B.SIZE,"vec2"),e.attributes.add(B.AUXPOS2,"vec4"),i.code.add(I`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?I`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:I`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=I`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?r?I`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:I`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:I`posProj += quadOffset;`;t.vvColor&&i.uniforms.add([new T7("vvColorColors",c=>c.vvColorColors,D0),new Kl("vvColorValues",c=>c.vvColorValues,D0)]),i.uniforms.add(new Bi("textureCoordinateScaleFactor",c=>E(c.texture)&&E(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:sSe)),i.code.add(I`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===ee.ObjectAndLayerIdColor?I`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${I.float(Il)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${I.float(Il)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?I`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new mr("tex",c=>c.texture));const a=t.debugDrawLabelBorder?I`(isBorder > 0.0 ? 0.0 : ${I.float(z9)})`:I.float(z9),l=I`
    ${t.debugDrawLabelBorder?I`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?I`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${I.float(O4)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${I.float(Il)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:I`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?I`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===ee.Alpha&&s.code.add(I`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),t.output===ee.ObjectAndLayerIdColor&&s.code.add(I`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===ee.Color&&s.code.add(I`
    void main() {
      ${l}
      ${t.transparencyPassType===lr.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),t.output===ee.Highlight&&(e.include(a_,t),s.code.add(I`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?I`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function X0e(t){return t.outlineColor[3]>0&&t.outlineSize>0}function G9(t,e=k$e){return t.textureIsSignedDistanceField?Byt(t.anchorPosition,t.distanceFieldBoundingBox,e):ga(e,t.anchorPosition),e}function Byt(t,e,r){E(e)?Kr(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):Kr(r,0,0)}const k$e=Dt(),Uyt=Object.freeze(Object.defineProperty({__proto__:null,build:kyt,calculateAnchorPosForRendering:G9},Symbol.toStringTag,{value:"Module"})),zd=Aa(tt.SRC_ALPHA,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),Vyt=X0(tt.ONE,tt.ONE),B$e=X0(tt.ZERO,tt.ONE_MINUS_SRC_ALPHA);function l_(t){return t===lr.FrontFace?null:t===lr.Alpha?B$e:Vyt}function S7(t){return t===lr.FrontFace?qu:null}const E7=5e5,C7={factor:-1,units:-2};function M7(t){return t?C7:null}function Ib(t,e=Bs.LESS){return t===lr.NONE||t===lr.FrontFace?e:Bs.LEQUAL}let U$e=class V$e extends Vi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2,r.spherical=e.viewingMode===_t.Global}initializeProgram(e){return new Fi(e.rctx,V$e.shader.get().build(this.configuration),Pi)}_setPipelineState(e){const r=this.configuration,i=e===lr.NONE,s=e===lr.FrontFace,n=this.configuration.hasPolygonOffset?zyt:null,o=(i||s)&&r.output!==ee.Highlight&&(r.depthEnabled||r.occlusionPass)?qu:null;return Rr({blending:r.output===ee.Color||r.output===ee.Alpha||r.output===ee.Highlight?i?Gyt:l_(e):null,depthTest:{func:Bs.LEQUAL},depthWrite:o,colorWrite:zr,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?Ar.POINTS:Ar.TRIANGLES}};U$e.shader=new Ni(Uyt,()=>be(()=>import("./HUDMaterial.glsl-ce81b482.js"),[]));const zyt={factor:0,units:-4},Gyt=X0(tt.ONE,tt.ONE_MINUS_SRC_ALPHA);let io=class extends $a{constructor(){super(...arguments),this.output=ee.Color,this.screenCenterOffsetUnitsEnabled=Du.World,this.transparencyPassType=lr.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};u([ie({count:ee.COUNT})],io.prototype,"output",void 0),u([ie({count:Du.COUNT})],io.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([ie({count:lr.COUNT})],io.prototype,"transparencyPassType",void 0),u([ie()],io.prototype,"spherical",void 0),u([ie()],io.prototype,"occlusionTestEnabled",void 0),u([ie()],io.prototype,"signedDistanceFieldEnabled",void 0),u([ie()],io.prototype,"vvSize",void 0),u([ie()],io.prototype,"vvColor",void 0),u([ie()],io.prototype,"hasVerticalOffset",void 0),u([ie()],io.prototype,"hasScreenSizePerspective",void 0),u([ie()],io.prototype,"debugDrawLabelBorder",void 0),u([ie()],io.prototype,"binaryHighlightOcclusionEnabled",void 0),u([ie()],io.prototype,"hasSlicePlane",void 0),u([ie()],io.prototype,"hasPolygonOffset",void 0),u([ie()],io.prototype,"depthEnabled",void 0),u([ie()],io.prototype,"pixelSnappingEnabled",void 0),u([ie()],io.prototype,"isDraped",void 0),u([ie()],io.prototype,"hasMultipassGeometry",void 0),u([ie()],io.prototype,"hasMultipassTerrain",void 0),u([ie()],io.prototype,"cullAboveGround",void 0),u([ie()],io.prototype,"occlusionPass",void 0),u([ie()],io.prototype,"objectAndLayerIdColorInstanced",void 0),u([ie({constValue:!0})],io.prototype,"hasSliceInVertexProgram",void 0),u([ie({constValue:!1})],io.prototype,"hasVvInstancing",void 0);let mM=class extends Pb{constructor(e){super(e,new Kyt),this._configuration=new io}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Du.Screen:Du.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=r.slot===et.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===ee.Color||e===ee.Alpha),e===ee.Color&&(this._configuration.debugDrawLabelBorder=!!Qi.LABELS_SHOW_BORDER),e===ee.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!i.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(hf(vj,r),E(e.shaderTransformer)){const O=e.shaderTransformer(K0e);l=O[0],c=O[5],qyt(vj)}const h=e.vertexAttributes.get(B.POSITION),p=e.vertexAttributes.get(B.SIZE),A=e.vertexAttributes.get(B.NORMAL),_=e.vertexAttributes.get(B.AUXPOS1);Zt(h.size>=3);const w=i.point,T=i.camera,C=G9(a);l*=T.pixelRatio,c*=T.pixelRatio;const M=this.parameters.centerOffsetUnits==="screen";for(let O=0;O<h.data.length/h.size;O++){const $=O*h.size;$e(zl,h.data[$],h.data[$+1],h.data[$+2]),Mt(zl,zl,r);const L=O*p.size;D_[0]=p.data[L]*l,D_[1]=p.data[L+1]*c,Mt(zl,zl,T.viewMatrix);const k=O*_.size;if($e(Kh,_.data[k+0],_.data[k+1],_.data[k+2]),!M&&(zl[0]+=Kh[0],zl[1]+=Kh[1],Kh[2]!==0)){const G=Kh[2];qe(Kh,zl),Be(zl,zl,Me(Kh,Kh,G))}const F=O*A.size;if($e(sO,A.data[F],A.data[F+1],A.data[F+2]),this._normalAndViewAngle(sO,vj,T,bj),this._applyVerticalOffsetTransformationView(zl,bj,T,_j),T.applyProjection(zl,Mc),Mc[0]>-1){Mc[0]=Math.floor(Mc[0]),Mc[1]=Math.floor(Mc[1]),M&&(Kh[0]||Kh[1])&&(Mc[0]+=Kh[0],Kh[1]!==0&&(Mc[1]+=_ne(Kh[1],_j.factorAlignment)),T.unapplyProjection(Mc,zl)),Mc[0]+=this.parameters.screenOffset[0],Mc[1]+=this.parameters.screenOffset[1],e$e(D_,_j.factor,D_);const G=Xyt*T.pixelRatio;let z=0;if(a.textureIsSignedDistanceField&&(z=a.outlineSize*T.pixelRatio/2),w&&Z0e(w,Mc[0],Mc[1],D_,G,z,a,C)){const Z=i.ray;if(Mt(J0e,zl,ul(Qyt,T.viewMatrix)),Mc[0]=w[0],Mc[1]=w[1],T.unprojectFromRenderScreen(Mc,zl)){const J=V();Oe(J,Z.direction);const te=1/st(J);Me(J,J,te),o(Is(Z.origin,zl)*te,J,-1,!0,1,J0e)}}}}}intersectDraped(e,r,i,s,n,o){const a=e.vertexAttributes.get(B.POSITION),l=e.vertexAttributes.get(B.SIZE),c=this.parameters,h=G9(c);let p=1,A=1;if(E(e.shaderTransformer)){const w=e.shaderTransformer(K0e);p=w[0],A=w[5]}p*=e.screenToWorldRatio,A*=e.screenToWorldRatio;const _=Zyt*e.screenToWorldRatio;for(let w=0;w<a.data.length/a.size;w++){const T=w*a.size,C=a.data[T],M=a.data[T+1],O=w*l.size;D_[0]=l.data[O]*p,D_[1]=l.data[O+1]*A;let $=0;c.textureIsSignedDistanceField&&($=c.outlineSize*e.screenToWorldRatio/2),Z0e(s,C,M,D_,_,$,c,h)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new t_t(this)}_normalAndViewAngle(e,r,i,s){return BAt(r)&&(r=hf(Yyt,r)),Ph(s.normal,e,r),Mt(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=He(z$e,Jyt),s}_updateScaleInfo(e,r,i){const s=this.parameters;E(s.screenSizePerspective)?G0e(i,r,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),E(s.screenSizePerspectiveAlignment)?G0e(i,r,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,bj);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,r,i,s,n){return this._applyCenterOffsetNDC(e,r,i,s),E(n)&&Oe(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(e,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return Oe(n,e);const c=ze(Math.abs(r.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return Me(n,e,l>0?h:1/h),n}_applyVerticalGroundOffsetView(e,r,i,s){const n=st(e),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(n),l=Me(zl,r.normal,o*a);return ke(s,e,l),s}_applyVerticalOffsetTransformationView(e,r,i,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=st(e);this._updateScaleInfo(s,c,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=st(e),a=gr(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=f$e(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),Me(r.normal,r.normal,l),ke(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==e&&Oe(i,e),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(qe(sO,i),ke(i,i,Me(sO,sO,r[2])))),i}_applyCenterOffsetNDC(e,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&Oe(s,e),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(e,r,i,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&Oe(s,e),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}requiresSlot(e,r){if(r===ee.Color||r===ee.Alpha||r===ee.Highlight||r===ee.ObjectAndLayerIdColor){if(e===et.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:s}=this.parameters;return e===(i?et.LABEL_MATERIAL:et.HUD_MATERIAL)||s&&e===et.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new jyt(e)}calculateRelativeScreenBounds(e,r,i=si()){return Hyt(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}},jyt=class extends yse{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(U$e,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function Hyt(t,e,r,i=Wyt){return ga(i,t.anchorPosition),i[0]*=-e[0],i[1]*=-e[1],i[0]+=t.screenOffset[0]*r,i[1]+=t.screenOffset[1]*r,i}function qyt(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+r*r+i*i),p=1/Math.sqrt(s*s+n*n+o*o),A=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=r*h,t[2]=i*h,t[3]=s*p,t[4]=n*p,t[5]=o*p,t[6]=a*A,t[7]=l*A,t[8]=c*A,t}function Z0e(t,e,r,i,s,n,o,a){let l=e-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,h=r-s-(a[1]>0?i[1]*a[1]:0),p=h+i[1]+2*s;const A=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&E(A)&&(l+=i[0]*A[0],h+=i[1]*A[1],c-=i[0]*(1-A[2]),p-=i[1]*(1-A[3]),l-=n,c+=n,h-=n,p+=n),t[0]>l&&t[0]<c&&t[1]>h&&t[1]<p}const _j=new y$e,Wyt=Dt(),zl=V(),sO=V(),Mc=Zr(),z$e=V(),J0e=V(),vj=mn(),Yyt=mn(),Qyt=ot(),Kh=V(),bj={normal:z$e,cosAngle:0},K0e=ot(),Xyt=1,Zyt=2,D_=[0,0],Jyt=ct(0,0,1);let Kyt=class extends xOe{constructor(){super(...arguments),this.renderOccluded=xn.Occlude,this.color=Nr(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=ki(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Nr(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const G$e=gn().vec3f(B.POSITION).vec3f(B.NORMAL).vec2f(B.UV0).vec4u8(B.COLOR).vec2f(B.SIZE).vec4f(B.AUXPOS1).vec4f(B.AUXPOS2),e_t=G$e.clone().vec4u8(B.OBJECTANDLAYERIDCOLOR);let t_t=class{constructor(e){this._material=e,this.vertexBufferLayout=Le("enable-feature:objectAndLayerId-rendering")?e_t:G$e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(B.POSITION).length}write(e,r,i,s,n){w7(i.indices.get(B.POSITION),i.vertexAttributes.get(B.POSITION).data,e,s.position,n,6),Tne(i.indices.get(B.NORMAL),i.vertexAttributes.get(B.NORMAL).data,r,s.normal,n,6);const o=i.vertexAttributes.get(B.UV0).data;let a,l,c,h;if(o==null||o.length<4){const M=this._material.parameters;a=0,l=0,c=M.texCoordScale[0],h=M.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let p=i.indices.get(B.POSITION).length,A=n;const _=s.uv0;for(let M=0;M<p;++M)_.set(A,0,a),_.set(A,1,l),A+=1,_.set(A,0,c),_.set(A,1,l),A+=1,_.set(A,0,c),_.set(A,1,h),A+=1,_.set(A,0,c),_.set(A,1,h),A+=1,_.set(A,0,a),_.set(A,1,h),A+=1,_.set(A,0,a),_.set(A,1,l),A+=1;Sne(i.indices.get(B.COLOR),i.vertexAttributes.get(B.COLOR).data,4,s.color,n,6);const w=i.indices.get(B.SIZE),T=i.vertexAttributes.get(B.SIZE).data;p=w.length;const C=s.size;A=n;for(let M=0;M<p;++M){const O=T[2*w[M]],$=T[2*w[M]+1];for(let L=0;L<6;++L)C.set(A,0,O),C.set(A,1,$),A+=1}if(i.indices.get(B.AUXPOS1)&&i.vertexAttributes.get(B.AUXPOS1)?fM(i.indices.get(B.AUXPOS1),i.vertexAttributes.get(B.AUXPOS1).data,s.auxpos1,n,6):Q0e(s.auxpos1,n,6*p),i.indices.get(B.AUXPOS2)&&i.vertexAttributes.get(B.AUXPOS2)?fM(i.indices.get(B.AUXPOS2),i.vertexAttributes.get(B.AUXPOS2).data,s.auxpos2,n,6):Q0e(s.auxpos2,n,6*p),E(i.objectAndLayerIdColor)&&i.indices.get(B.POSITION)){const M=i.indices.get(B.POSITION).length,O=s.getField(B.OBJECTANDLAYERIDCOLOR,uc);v$e(i.objectAndLayerIdColor,O,M,n,6)}}};const cm=V(),uS=Zr(),nO=Zr(),wj=V(),r_t=ot(),i_t=Io(),xj=Na(),s_t=V(),n_t=si();class o_t{constructor(){this.aabr=si(),this.distance=0,this.culled=!1,this.visible=!1}}class a_t{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var mh;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(mh||(mh={}));class j$e{constructor(){this.camera=new hr,this.slicePlane=Zy(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),ET(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let EC=class extends Ke{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new j$e,this._state=mh.Idle,this._active=new Map,this._visible=new Map,this._iterators=new h_t,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==mh.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/mh.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case mh.Idle:this._startUpdate(),t.madeProgress();case mh.Process:if(this._state=mh.Process,!this._processActiveGraphics(t))return;case mh.Sort:if(this._state=mh.Sort,!this._sortVisibleGraphics(t))return;case mh.Deconflict:if(this._state=mh.Deconflict,!this._deconflictVisibleGraphics(t))return;default:MAt(this,this._visible),this._state=mh.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(N(t)||t.type!=="object3d")return!1;const e=t.stageObject;if((e?e.geometries.length:0)!==1)return!1;const r=e==null?void 0:e.geometries[0];return(r==null?void 0:r.material)instanceof mM}_startUpdate(){RAt(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new o_t,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),l_t(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=FM(r_t,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?i_t:null;let s=0;for(E(i)&&(Mt(i,sc,this._runningViewState.camera.viewMatrix),i[3]=es(this.view.spatialReference).radius,s=vSe(i,sc));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===sl.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!r||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),PAt(n,a)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=eme(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=eme(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=c_t(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(sl.GRAPHIC,Mh.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);lf(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(N(a)){if(a=f_t,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,cm)||E(r)&&this._isCulledByHorizon(a,r,i))return void(n.culled=!0);!Qi.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}N(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,r){const i=this._runningViewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;Mt(cm,a,i.viewMatrix);const l=n.vertexAttributes,c=l.get(B.NORMAL).data,h=l.get(B.AUXPOS1).data;o.applyShaderOffsetsView(cm,c,s.transformation,h,i,r.scaleInfo,cm),ns(uS,cm[0],cm[1],cm[2],1),Ld(nO,uS,i.projectionMatrix),Me(r.positionNDC,nO,1/nO[3]),o.applyShaderOffsetsNDC(r.positionNDC,h,i,r.positionNDC,wj),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(wj[2]),r.distance=wj[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),ns(nO,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),Ld(uS,nO,e),MM(uS,uS,1/uS[3]),$e(r.positionView,cm[0],cm[1],cm[2])}_isCulledByHorizon(t,e,r){return Oe(xj.direction,t.positionView),$e(xj.origin,0,0,0),!!Mb(e,xj,s_t)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&Wre(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:s}){const n=this._runningViewState.camera,o=e.getScreenSize(d_t);e$e(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=Ik(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,n_t),Sr(0,n.fullWidth,.5+.5*i[0]),Sr(0,n.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(Pd(a),V0(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}Fv(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let s=Math.floor(r.aabr[1]/this._accBinsSizeY);s<=Math.floor(r.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[i][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,iU(l.aabr,r.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)i.push(new Vr)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(Mh.DECONFLICTION,e,this.visibilityGroup),this.visibilityGroup===sl.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function l_t(t,e){const r=t.graphics3DGraphic;r.destroyed||r.clearVisibilityFlag(Mh.DECONFLICTION,e)}function*eme(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*c_t(t,e,r){e.clear(),t.forEach((s,n)=>{const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.hasVisibilityFlag(Mh.DECONFLICTION,r),o.prio=s.info?s.info[r].distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((s,n)=>s.visible!==n.visible?s.visible?-1:1:s.prio!==n.prio?s.prio-n.prio:s.id-n.id);for(let s=i.next();!s.done;s=i.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}u([d({constructOnly:!0})],EC.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],EC.prototype,"updating",null),EC=u([j("esri.views.3d.layers.graphics.Deconflictor")],EC);class u_t{}class h_t{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new Vr({allocator:s=>s||new u_t})}}const d_t=Dt();class p_t{constructor(){this.positionView=V(),this.positionNDC=V(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new y$e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const f_t=new p_t,m_t=2e3;let c8=class extends EC{constructor(e){super(e),this.visibilityGroup=sl.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Dl.YIELD;const r=performance.now();if(e.state!==Ei.IDLE&&r-this._lastDeconfliction<m_t)return Dl.YIELD;super.runTask(e),this.state===mh.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([d({constructOnly:!0})],c8.prototype,"parent",void 0),c8=u([j("esri.views.3d.layers.graphics.LabelDeconflictor")],c8);let JJ=class extends EC{constructor(){super(...arguments),this._handles=new ts,this._contexts=new Map,this._viewState=new j$e,this.visibilityGroup=sl.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([xe(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.state)==null?void 0:r.camera},()=>{this._updateViewState(),this.setDirty()}),xe(()=>{var e,r,i;return(i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity},(e,r)=>{e!==1&&r!==1||this.setDirty()}),xe(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Cr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(ir.GRAPHICS_DECONFLICTOR,this),this._labels=new c8({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&Tj(e));r.setVisibilityFlag(Mh.DECONFLICTION,i,sl.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;E(e)&&DSe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=E(e)}_slicePlaneChanged(){Ml(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const s=i.graphic.uid,n=new a_t(i,e.symbolCreationContext.slicePlaneEnabled);r.set(s,n),Tj(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,r){const i=r.graphic.uid,s=e.get(i);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=Tj(e);i||g_t(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(s=>s.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!r||!r.length)return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function Tj(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function g_t(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.clearVisibilityFlag(Mh.DECONFLICTION))}JJ=u([j("esri.views.3d.layers.graphics.GraphicsDeconflictor")],JJ);const Pne=(t,e,r)=>[e,r],gM=(t,e,r)=>[e,r,t[2]],Ine=(t,e,r)=>[e,r,t[2],t[3]];function gVt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:E(t.extent)?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function A_t({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function y_t({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function H$e({scale:t,translate:e},r){return r*t[0]+e[0]}function q$e({scale:t,translate:e},r){return e[1]-r*t[1]}function W$e(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=t.scale;let o=H$e(t,r[0][0]),a=q$e(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=e(c,o,a)}return i}function Y$e(t,e,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=W$e(t,e,r[s]);return i}function __t(t,e,r,i){return W$e(t,r?i?Ine:gM:i?gM:Pne,e)}function v_t(t,e,r,i){return Y$e(t,r?i?Ine:gM:i?gM:Pne,e)}function b_t(t,e,r,i){return Y$e(t,r?i?Ine:gM:i?gM:Pne,e)}function AVt(t,e,r,i,s){return e.x=A_t(t,r.x),e.y=y_t(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m)),e}function Q$e(t,e,r,i,s){return E(r)&&(e.points=__t(t,r.points,i,s)),e}function X$e(t,e,r,i,s){return N(r)||(e.x=H$e(t,r.x),e.y=q$e(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m))),e}function Z$e(t,e,r,i,s){return E(r)&&(e.rings=b_t(t,r.rings,i,s)),e}function J$e(t,e,r,i,s){return E(r)&&(e.paths=v_t(t,r.paths,i,s)),e}let yVt=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function vVt(t){return E(t.geometry)}let bVt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function xVt(t){var n;const e=U2e.fromJSON(t.geometryType),r=xt.fromJSON(t.spatialReference),i=t.transform,s=t.features.map(o=>{const a=w_t(o,e,r,t.objectIdFieldName),l=a.geometry;if(E(l)&&i)switch(l.type){case"point":a.geometry=X$e(i,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=Q$e(i,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=Z$e(i,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=J$e(i,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:s,spatialReference:r,fields:((n=t.fields)==null?void 0:n.map(o=>NU.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function w_t(t,e,r,i){return{uid:kh(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:x_t(t.geometry,e,r),visible:!0}}function x_t(t,e,r){if(N(t))return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function c_(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function T_t(t){if(N(t))return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)r+=n.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(s.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=MD(t.vertexAttributes.position),e+=MD(t.vertexAttributes.normal),e+=MD(t.vertexAttributes.uv),e+=MD(t.vertexAttributes.tangent)}return e}function TVt(t){let e=32;return e+=HTe(t.attributes),e+=3,e+=8+T_t(t.geometry),e}function S_t(t){if(N(t))return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function SVt(t){if(N(t))return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function EVt(t,e){switch(Fs(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)dz(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)dz(e,t.rings[r],!!t.hasZ);break;case"multipoint":dz(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function E_t(t,e){switch(lf(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)hz(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)hz(e,t.rings[r]);break;case"multipoint":hz(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function CVt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function K$e(t){return"declaredClass"in t}function tme(t){return"declaredClass"in t}function C_t(t){return"declaredClass"in t}function M_t(t,e){return t?C_t(t)?t:new pl({layer:e,sourceLayer:e,visible:t.visible,symbol:Te(t.symbol),attributes:Te(t.attributes),geometry:e4e(t.geometry)}):null}function e4e(t){return N(t)?null:K$e(t)?t:Ny(R_t(t))}function R_t(t){const{wkid:e,wkt:r,latestWkid:i}=t.spatialReference,s={wkid:e,wkt:r,latestWkid:i};switch(t.type){case"point":{const{x:n,y:o,z:a,m:l}=t;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=t;return{rings:rme(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=t;return{paths:rme(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:A,hasZ:_,hasM:w}=t;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:A,hasZ:_,hasM:w,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=t;return{points:r4e(n)?t4e(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function rme(t){return O_t(t)?t.map(e=>t4e(e)):t}function t4e(t){return t.map(e=>Array.from(e))}function O_t(t){for(const e of t)if(e.length!==0)return r4e(e);return!1}function r4e(t){return t.length>0&&(Kee(t[0])||ete(t[0]))}function P_t(t,e){if(!t)return null;let r;if(tme(t)){if(e==null)return t.clone();if(tme(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=c_(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function MVt(t){const{wkid:e,wkt:r,latestWkid:i}=t,s={wkid:e,wkt:r,latestWkid:i};return xt.fromJSON(s)}const Sj=we.getLogger("esri.layers.support.labelFormatUtils"),Ej={type:"simple",evaluate:()=>null},I_t={getAttribute:(t,e)=>t.field(e)};async function i4e(t,e,r){if(!t||!t.symbol||!e)return Ej;const i=t.where,s=HU(t),n=i?await be(()=>import("./WhereClause-dd0f9833.js").then(a=>a.W),["assets/WhereClause-dd0f9833.js","assets/executionError-fb3f283a.js"]):null;let o;if(s.type==="arcade"){const a=await kGe(s.expression,r,e);if(N(a))return Ej;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{Sj.error(new ce("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>Qie(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=e.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":s4e(p,h)})};if(i){let a;try{a=n.WhereClause.create(i,e)}catch(c){return Sj.error(new ce("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),Ej}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:I_t;try{if(a.testFeature(c,h))return l(c)}catch(p){Sj.error(new ce("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:p}))}return null}}return o}function s4e(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=t;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const s=+t,n="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(n<=s&&s<=o)return r.name}}let i=t;return e.type==="date"||e.type==="esriFieldTypeDate"?i=Lg(i,ZB("short-date")):XB(e)&&(i=Dg(+i)),i||""}const RVt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:i4e,formatField:s4e},Symbol.toStringTag,{value:"Module"}));let n4e=class{constructor(e=null,r="center",i="center",s=null,n=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",h=0,p=0){this.verticalOffset=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=s,this.translation=n,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=p}};function $ne(t,e){if(t.type==="point")return N_(t,e,!1);if(K$e(t))switch(t.type){case"extent":return N_(t.center,e,!1);case"polygon":return N_(t.centroid,e,!1);case"polyline":return N_(ime(t),e,!0);case"mesh":return N_(t.origin,e,!1)}else switch(t.type){case"extent":return N_($_t(t),e,!0);case"polygon":return N_(L_t(t),e,!0);case"polyline":return N_(ime(t),e,!0)}}function ime(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=T2e(e,x2e(e)/2);return c_(r[0],r[1],r[2],t.spatialReference)}function $_t(t){return c_(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function L_t(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=Xte(t.rings,!!t.hasZ);return c_(r[0],r[1],r[2],t.spatialReference)}function N_(t,e,r){const i=r?t:P_t(t);return e&&t?Vqe(t,i,e)?i:null:i}function PVt(t,e,r,i=0){if(t){e||(e=si());const s=t;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),ns(e,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),e}return null}function o4e(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(B.AUXPOS1);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[r]))}}function t$(t,e){const r=_L(Gp);return E(t)&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),E(e)?r[3]=e:E(t)&&t.length>3&&(r[3]=t[3]),r}function IVt(t,e,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)E(t)&&t[o]!=null?n[o]=t[o]:E(r)&&r[o]!=null?n[o]=r[o]:n[o]=s[o];return E(e)?n[3]=e:E(i)?n[3]=i:n[3]=s[3],n}function sme(t=hg,e,r,i=1){const s=new Array(3);if(N(e)||N(r))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const h=l!=null,p=a===0&&!n&&!h,A=r[a];l==="symbol-value"||p?c=A!==0?e[a]/A:1:h&&l!=="proportional"&&isFinite(l)&&(c=A!==0?l/A:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return Iu(s)}function D_t(t){return t.isPrimitive!=null}function R7(t){return j9(D_t(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function j9(t){if(Array.isArray(t)){for(const e of t)if(!j9(e))return!1;return!0}return t==null||t>=0}function N_t(t,e,r,i=ot()){const s=t||0,n=e||0,o=r||0;return s!==0&&G3(i,i,-s/180*Math.PI),n!==0&&z3(i,i,n/180*Math.PI),o!==0&&pU(i,i,o/180*Math.PI),i}function Lne(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=tu(e),s=_T(t)*i,n=vT(t)*i,o=Sb(t)*(e.isGeographic?1:i);return s===0&&n===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(s,n,o)}function a4e(t,e,r,i,s,n,o,a,l,c,h){const p=j_t[h.mode];let A,_,w=0;if(Dn(t,e,r,i,l.spatialReference,s,a))return p.requiresAlignment(h)?(w=p.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,h),A=n,_=o):(A=i,_=s),Dn(A,l.spatialReference,_,n,c.spatialReference,o,a)?w:void 0}function iR(t,e,r,i,s){const n=($9(t)?t.z:SIe(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=gr(pg(e,t,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=gr(pg(e,t,"ground"),0),a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=gr(pg(e,t,"scene"),0),a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=gr(pg(e,t,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function F_t(t,e,r,i){return iR(t,e,r,i,CC),CC.z}function qL(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?Ln.UPDATE:t.onTheGroundChanged}function ff(t){return t==="relative-to-ground"||t==="relative-to-scene"}function pb(t){return t!=="absolute-height"}function k_t(t,e,r,i,s){iR(e,r,s,i,CC),o4e(t,CC.verticalDistanceToGround);const n=CC.sampledElevation,o=ma(H_t,t.transformation);return hN[0]=e.x,hN[1]=e.y,hN[2]=CC.z,G0(e.spatialReference,hN,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function B_t(t,e,r,i,s,n){let o=0;const a=n.spatialReference;e*=3,i*=3;for(let l=0;l<s;++l){const c=t[e+0],h=t[e+1],p=t[e+2],A=gr(n.getElevation(c,h,p,a,"ground"),0);o+=A,r[i+0]=c,r[i+1]=h,r[i+2]=A,e+=3,i+=3}return o/s}function U_t(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;e*=3,i*=3;for(let A=0;A<s;++A){const _=t[e+0],w=t[e+1],T=t[e+2],C=gr(n.getElevation(_,w,T,p,"ground"),0);l+=C,r[i+0]=_,r[i+1]=w,r[i+2]=h==null?T+C+c:C+c,e+=3,i+=3}return l/s}function V_t(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;e*=3,i*=3;for(let A=0;A<s;++A){const _=t[e+0],w=t[e+1],T=t[e+2],C=gr(n.getElevation(_,w,T,p,"scene"),0);l+=C,r[i+0]=_,r[i+1]=w,r[i+2]=h==null?T+C+c:C+c,e+=3,i+=3}return l/s}function z_t(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function G_t(t,e,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let h=0;h<s;++h){const p=t[e+0],A=t[e+1],_=t[e+2];r[i+0]=p,r[i+1]=A,r[i+2]=c==null?_+l:l,e+=3,i+=3}return 0}let WL=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Ln;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Ln||(Ln={}));const j_t={"absolute-height":{applyElevationAlignmentBuffer:G_t,requiresAlignment:z_t},"on-the-ground":{applyElevationAlignmentBuffer:B_t,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:U_t,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:V_t,requiresAlignment:()=>!0}},H_t=ot(),CC=new WL,hN=V();function Dne(t){return E(t.mapPositions)}function l4e(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!Dne(l))continue;const{update:c,averageGeometrySampledElevation:h}=u4e(l,e,r,i,s);a+=h,c&&n.geometryVertexAttrsUpdated(l)}return a/o.length}function P4(t,e,r,i,s){var p;const n=t.stageObject,o=e.centerPointInElevationSR;let a=0;(p=n.metadata)!=null&&p.usesVerticalDistanceToGround?(i(o,Lu),o4e(n,Lu.verticalDistanceToGround),a=Lu.sampledElevation):(i(o,Lu),e.mode!=="absolute-height"&&(a=Lu.sampledElevation));const l=ma(q_t,n.transformation),c=$e(c4e,l[12],l[13],l[14]);Qi.TESTS_DISABLE_OPTIMIZATIONS?($u[0]=o.x,$u[1]=o.y,$u[2]=Lu.z,G0(o.spatialReference,$u,l,s.spatialReference)&&(n.transformation=l)):s.setAltitudeOfTransformation(Lu.z,l);const h=Nne/s.unitInMeters;return(Math.abs(l[12]-c[0])>=h||Math.abs(l[13]-c[1])>=h||Math.abs(l[14]-c[2])>=h)&&(n.transformation=l),a}const q_t=ot();function W_t(t,e,r,i,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(N(n))return 0;const o=e.centerPointInElevationSR;i(o,Lu);const a=e.mode!=="absolute-height"?Lu.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,h=Q_t;l.getGlobalTransform(c,h);const p=$e(c4e,h[12],h[13],h[14]);Qi.TESTS_DISABLE_OPTIMIZATIONS?($u[0]=o.x,$u[1]=o.y,$u[2]=Lu.z,G0(o.spatialReference,$u,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(Lu.z,h);const A=Nne/s.unitInMeters;return(Qi.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-p[0])>=A||Math.abs(h[13]-p[1])>=A||Math.abs(h[14]-p[2])>=A)&&l.setGlobalTransform(c,h),a}function Y_t(t,e,r,i,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const p of o){if(!Dne(p))continue;const A=p.vertexAttributes.get(B.POSITION);if(A!==l){const{update:_,averageGeometrySampledElevation:w}=u4e(p,e,r,i,s);c=w,l=A,h=_}h&&n.geometryVertexAttrsUpdated(p),a+=c}return a/o.length}const Nne=.01,$u=V(),rp=V(),hS=V(),Q_t=ot(),c4e=V(),Lu=new WL;function u4e(t,e,r,i,s){let n=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;rp[0]=o[12],rp[1]=o[13],rp[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(B.POSITION),c=l.data,h=l.size,p=c.length/h,A=new TIe(t.mapPositions,r);let _=0,w=0;for(let T=0;T<p;T++){if(hS[0]=c[_],hS[1]=c[_+1],hS[2]=c[_+2],i(A,Lu),a&&(w+=Lu.sampledElevation),Qi.TESTS_DISABLE_OPTIMIZATIONS)c[_]=A.array[A.offset],c[_+1]=A.array[A.offset+1],c[_+2]=Lu.z,Dn(c,r,_,c,s.spatialReference,_,1),c[_]-=rp[0],c[_+1]-=rp[1],c[_+2]-=rp[2],n=!0;else{$u[0]=c[_]+rp[0],$u[1]=c[_+1]+rp[1],$u[2]=c[_+2]+rp[2],s.setAltitude($u,Lu.z),c[_]=$u[0]-rp[0],c[_+1]=$u[1]-rp[1],c[_+2]=$u[2]-rp[2];const C=Nne/s.unitInMeters;(Math.abs(hS[0]-c[_])>=C||Math.abs(hS[1]-c[_+1])>=C||Math.abs(hS[2]-c[_+2])>=C)&&(n=!0)}_+=h,A.offset+=3}return w/=p,{update:n,averageGeometrySampledElevation:w}}const X_t=we.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Z_t(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function LVt(t){const e=t&&t.expression;if(typeof e=="string"){const r=p4e(e);if(r!=null)return{cachedResult:r}}return null}async function DVt(t,e,r,i){const s=t&&t.expression;if(typeof s!="string")return null;const n=p4e(s);if(n!=null)return{cachedResult:n};const o=await $g();di(r);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function h4e(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function Fne(t,e){if(t!=null&&!d4e(t)){if(!e||!t.arcade)return void X_t.errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=e4e(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function J_t(t){if(t!=null){if(d4e(t))return t.cachedResult;const e=t.arcade;let r=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function NVt(t,e=!1){let r=t&&t.featureExpressionInfo;const i=r&&r.expression;return e||i==="0"||(r=null),r??null}const K_t={cachedResult:0};function d4e(t){return t.cachedResult!=null}function p4e(t){return t==="0"?0:null}let K0=class f4e{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Jrt(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=J_t(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Zrt(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=gr(e.offset,0)}updateFeatureExpressionInfoContext(e,r,i){if(N(e))return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&E(r)&&E(i)?(this._featureExpressionInfoContext=Z_t(e),Fne(this._featureExpressionInfoContext,h4e(s.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new f4e;return E(e)&&r.setFromElevationInfo(e),r}},e1t=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};var jr;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(jr||(jr={}));let t1t=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},Zg=class{get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}constructor(e,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e,r){this._stageLayer=r,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.add(this.stageObject)}destroy(){const e=this._stage;this._stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries)),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=this._stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),E(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(e,r){if(N(this._edgeState))return;const i=nme(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this._resetEdgeObject(r),this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){N(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stage!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),E(this._edgeState))){const r=this._stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,s){if(this.elevationAligner==null)return;E(i)&&Fne(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>iR(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r),this._resetEdgeObject(s)}alignWithAbsoluteElevation(e,r,i){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,r),this._resetEdgeObject(i)}getCenterObjectSpace(e=V()){return Oe(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=Jo()){const r=this.stageObject.boundingVolumeObjectSpace;return Cxe(e,r.min),Mxe(e,r.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.transformation;e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(uA)&&(Mt(uA,uA,this.stageObject.transformation),ke(e.render.origin,e.render.origin,uA),e.render.num++)}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=r1t,l=yre(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];F_[0]=o[p[0]],F_[1]=o[p[1]],F_[2]=o[p[2]],Mt(F_,F_,this.stageObject.transformation),nw[3*h+0]=F_[0],nw[3*h+1]=F_[1],nw[3*h+2]=F_[2]}if(!e(nw,0,l))return null;Fs(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],nw[h+p]),o[p+3]=Math.max(o[p+3],nw[h+p]);c&&i.push({location:nw.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){_0(o,uA);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(r.useViewElevation)p=gr(r.service.getElevation(uA[0],uA[1],h),0);else try{const A=Lne(o,r.service.spatialReference,r);p=gr(await r.service.queryElevation(uA[0],uA[1],s,A,h),0)}catch{}Exe(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(e,r){e===zy.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===zy.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}_resetEdgeObject(e){if(N(this._edgeState))return;const r=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(N(i))return;const s=nme(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function nme(t){return t.isVisible()?t.parameters.transparent?jr.TRANSPARENT:jr.OPAQUE:jr.INVISIBLE}const nw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],F_=V(),uA=V(),r1t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let m4e=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=gr(e,0)}};var Qo;(function(t){t[t.Recreate_Symbol=0]="Recreate_Symbol",t[t.Recreate_Graphics=1]="Recreate_Graphics",t[t.Fast_Update=2]="Fast_Update"})(Qo||(Qo={}));let kne=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Sd.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===Sd.LOADED?(e&&e(),gr(this._loader,Promise.resolve())):this._loadStatus===Sd.FAILED?(r&&r(this._loadError),gr(this._loader,Promise.resolve())):(N(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Sd.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=Sd.FAILED,!vo(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){E(this._abortController)?this._abortController=tf(this._abortController):this._loadStatus===Sd.LOADING&&(this._loadStatus=Sd.FAILED),this._loader=null}};var Sd;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Sd||(Sd={}));const g4e=3,KJ=3,A4e=10;let y4e=class{constructor(e,r=null){this.geometry=e,this.textures=r}};function dN(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),tL(e)}function ome(t){const e=new Array;return t.levels.forEach(r=>{r.components.forEach(i=>{E(i.textures)&&e.push(...i.textures)})}),tL(e)}function _4e(t){const e=t.components.map(r=>r.geometry);return tL(e)}function ame(t){const e=[];return t.levels.forEach(r=>{r.components.forEach(i=>{e.push(i.geometry)})}),tL(e)}function i1t(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function v4e(t,e){const r=(i,s,n=!1)=>({levels:i.map(o=>{const a=s(o.tesselation);return n&&Xdt(a),{components:[new y4e(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>Wdt(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>kdt(e,1));case"cone":return r(Cj,i=>wfe(e,1,.5,i,!1),!0);case"inverted-cone":return r(Cj,i=>wfe(e,1,.5,i,!0),!0);case"cylinder":return r(Cj,i=>Qdt(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>qdt(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>zdt(e,1),!0);default:return}}const Cj=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function s1t(t){return t.type==="fill"}function n1t(t){return t.type==="extrude"}function o1t(t){return t&&t.enabled&&(n1t(t)||s1t(t))&&E(t.edges)}function a1t(t){return t&&t.enabled&&t.edges||null}function b4e(t,e){return l1t(a1t(t),e)}function l1t(t,e){if(N(t))return null;const r=E(t.color)?kre(Ot.toUnitRGBA(t.color)):Nr(0,0,0,0),i=ll(t.size),s=ll(t.extensionLength);switch(t.type){case"solid":return c1t({color:r,size:i,extensionLength:s,...e});case"sketch":return u1t({color:r,size:i,extensionLength:s,...e});default:return}}function c1t(t){return{...h1t,...t,type:"solid"}}function u1t(t){return{...d1t,...t,type:"sketch"}}const h1t={color:Nr(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:jr.OPAQUE,hasSlicePlane:!1},d1t={color:Nr(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:jr.OPAQUE,hasSlicePlane:!1},Bne={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function GVt(t){return t.type==="web-style"?Bne:Une(t.symbolLayers.toArray().map(e=>w4e(t,e)))}function Une(t){let e=0,r=0,i=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)N(a)||(e+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:e,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:s,memory:o,numComplexities:n}}function jVt(t){const e=Une(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const lme={};function w4e(t,e){const r=x4e(t,e),i=o1t(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:E(e.outline)&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return e.resource&&e.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...p1t(e.resource&&e.resource.primitive||Fxe),memory:r};case"path":{let s=0,n=0;switch(e.profile){case"circle":s=A4e;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":n=g4e;break;case"miter":case"bevel":n=1;break;default:return}const o=2*s,a=s*n*2;let l=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":l+=2*(s-1);break;case"round":l+=2*(s*(KJ-1)*2+s);break;default:return}return{primitivesPerFeature:l,primitivesPerCoordinate:a+o,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function x4e(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?lu.EXTRUDE_EDGES:lu.EXTRUDE;case"fill":return E(e.outline)&&e.outline.size>0?lu.FILL_OUTLINE:lu.FILL;case"water":return lu.FILL;case"line":return e.join==="round"?lu.LINE_ROUND:lu.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return lu.PATH_ROUND_CIRCLE;case"quad":return lu.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return lu.PATH_MITER_CIRCLE;case"quad":return lu.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?lu.OBJECT_POINT:lu.OBJECT_POLYGON;case"icon":case"text":return r?lu.ICON_POINT:lu.ICON_POLYGON;default:return}}function p1t(t){let e=lme[t];if(e)return e;const r=v4e(t,null);return e={primitivesPerFeature:_4e(r.levels[0]).reduce((i,s)=>i+s.indices.get(B.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},lme[t]=e,e}const lu={ICON_POINT:{bytesPerFeature:3293.7707557538765,bytesPerFeatureLabel:1020.2764,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2213.51585392203,bytesPerFeatureLabel:1008.84664,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:4745.397589234022,bytesPerFeatureLabel:1006.5440666666666,bytesPerCoordinate:3.8971910718981526,resourceBytes:0,draped:{bytesPerFeature:3711.9299672493826,bytesPerFeatureLabel:991.1003999999999,bytesPerCoordinate:3.916858016273668}},OBJECT_POINT:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855,resourceBytes:0,draped:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855}},LINE_MITER:{bytesPerFeature:5757.019675077085,bytesPerFeatureLabel:998.6150266666667,bytesPerCoordinate:24.456810187064043,resourceBytes:0,draped:{bytesPerFeature:4101.480288021862,bytesPerFeatureLabel:1007.7540599999999,bytesPerCoordinate:18.25629912730874}},LINE_ROUND:{bytesPerFeature:5770.95297166408,bytesPerFeatureLabel:1017.77396,bytesPerCoordinate:24.60919037084966,resourceBytes:0,draped:{bytesPerFeature:4089.5796612121826,bytesPerFeatureLabel:987.8320266666666,bytesPerCoordinate:18.43599029126731}},PATH_MITER_CIRCLE:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863,resourceBytes:0,draped:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863}},PATH_ROUND_CIRCLE:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177,resourceBytes:0,draped:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177}},PATH_MITER_QUAD:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994,resourceBytes:0,draped:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994}},PATH_ROUND_QUAD:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293,resourceBytes:0,draped:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293}},FILL:{bytesPerFeature:6141.501452970723,bytesPerFeatureLabel:1008.2056066666665,bytesPerCoordinate:9.669541106191478,resourceBytes:0,draped:{bytesPerFeature:4615.812654782311,bytesPerFeatureLabel:1004.2114200000001,bytesPerCoordinate:7.378043214430644}},FILL_OUTLINE:{bytesPerFeature:9038.575581319641,bytesPerFeatureLabel:1017.9996066666668,bytesPerCoordinate:14.96569682175086,resourceBytes:0,draped:{bytesPerFeature:6369.386021594582,bytesPerFeatureLabel:1008.9863733333334,bytesPerCoordinate:10.25287774000214}},EXTRUDE:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849,resourceBytes:0,draped:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849}},EXTRUDE_EDGES:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031,resourceBytes:0,draped:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031}}},dS=we.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Jg=class extends kne{constructor(e,r,i,s){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=dS,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new K0,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=cme(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this._ignoreDrivers)return!1;const r=this._drivenProperties,i=cme(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(r,i,s)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&dS.warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const s=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(dS.warnOncePerTick(`${s} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(dS.warnOncePerTick(`${s} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(E(r)&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const s=e;if(!isFinite(s.x)||!isFinite(s.y))return dS.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return f1t}_defaultElevationInfoZ(){return m1t}_updateElevationContext(){E(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r){const i=e.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=gr(this._elevationContext.meterUnitOffset,gr(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?K_t:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=ume){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(E(e)?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=ume){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return t$(null,i);const s=E(e)?Ot.toUnitRGB(e):hg;return t$(s,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=t$(i,s);return E(r)&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return w4e(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==Ln.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,r,i){let s=Ln.UPDATE;return e.forEach(n=>{const o=r(n);if(E(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=Ln.RECREATE}),s}applyRendererDiff(e,r){return Qo.Recreate_Symbol}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const r=this._fastUpdates.visualVariables,i=r.size?xy(r.size.field,e):0,s=r.color?xy(r.color.field,e):0,n=r.opacity?xy(r.opacity.field,e):0;return Nr(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&dS.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var r,i,s,n,o,a,l,c,h,p,A,_;return{size:((s=(i=(r=this._fastUpdates)==null?void 0:r.visualVariables)==null?void 0:i.size)==null?void 0:s.field)??null,color:((a=(o=(n=this._fastUpdates)==null?void 0:n.visualVariables)==null?void 0:o.color)==null?void 0:a.field)??null,opacity:((h=(c=(l=this._fastUpdates)==null?void 0:l.visualVariables)==null?void 0:c.opacity)==null?void 0:h.field)??null,rotation:((_=(A=(p=this._fastUpdates)==null?void 0:p.visualVariables)==null?void 0:A.rotation)==null?void 0:_.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function xy(t,e){const r=t!=null?e.attributes[t]:0;return r!=null&&isFinite(r)?r:0}function cme(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const f1t={mode:"on-the-ground",offset:0,unit:"meters"},m1t={mode:"absolute-height",offset:0,unit:"meters"},ume={hasIntrinsicColor:!1};let u_=class extends UL{get geometries(){return this._geometries}get transformation(){return this._transformation}set transformation(e){ma(this._transformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}constructor(e={}){super(),this.type=Xn.Object,this._geometries=new Array,this._transformation=ot(),this._bvObjectSpace=new hme,this._bvWorldSpace=new hme,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=e.castShadow==null||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new T4e);const r=e.geometries;E(r)&&(this._geometries=Array.from(r))}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Zt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new b9(zy.MaskOccludee);for(const r of this._geometries)r.occludees=MJ(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=RJ(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new b9(zy.Highlight);for(const r of this._geometries)r.highlights=MJ(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=RJ(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return $n(r,this.transformation,e.transformation)}_getCombinedShaderTransformation(e){return $n(ot(),this.transformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(const s of this._geometries){const n=s.boundingInfo;E(n)&&(dme(n,this._bvObjectSpace,s.shaderTransformation),dme(n,this._bvWorldSpace,this._getCombinedShaderTransformation(s)))}fo(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),fo(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=V(),r=V(),i=Wx(this.transformation);for(const s of this._geometries){const n=s.boundingInfo;if(N(n))continue;const o=s.shaderTransformation,a=Wx(o);Mt(e,n.center,o);const l=Is(e,this._bvObjectSpace.bounds),c=n.radius*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),Mt(r,e,this.transformation);const h=Is(r,this._bvWorldSpace.bounds),p=c*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_invalidateBoundingVolume(){this._bvDirty=!0,E(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,r){E(this._parentLayer)&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},T4e=class{constructor(){this.min=ct(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=ct(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},hme=class extends T4e{constructor(){super(...arguments),this.bounds=Io()}init(){$e(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),$e(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),ASe(this.bounds)}};function dme(t,e,r){const i=t.bbMin,s=t.bbMax;if(gU(r)){const n=$e(g1t,r[12],r[13],r[14]);ke(ed,i,n),ke(Cf,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],ed[o]),e.max[o]=Math.max(e.max[o],Cf[o])}else if(Mt(ed,i,r),Hc(i,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],ed[n]),e.max[n]=Math.max(e.max[n],ed[n]);else{Mt(Cf,s,r);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],ed[n],Cf[n]),e.max[n]=Math.max(e.max[n],ed[n],Cf[n]);for(let n=0;n<3;++n){Oe(ed,i),Oe(Cf,s),ed[n]=s[n],Cf[n]=i[n],Mt(ed,ed,r),Mt(Cf,Cf,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],ed[o],Cf[o]),e.max[o]=Math.max(e.max[o],ed[o],Cf[o])}}}const g1t=V(),ed=V(),Cf=V();function Vne(t,e,r,i,s,n){const o=t.clippingExtent;if(Fl(e,Sv,t.elevationProvider.spatialReference),E(o)&&!gre(o,Sv))return null;Fl(e,Sv,t.renderCoordsHelper.spatialReference);const a=t.localOriginFactory.getOrigin(Sv),l=new u_({castShadow:!1,metadata:{layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0}});return r.shaderTransformer=n,r.localOrigin=a,l.addGeometry(r),{object:l,sampledElevation:k_t(l,e,t.elevationProvider,t.renderCoordsHelper,i)}}function I4(t,e,r){const i=t.elevationContext,s=r.spatialReference;Fl(e,Sv,s),i.centerPointInElevationSR=c_(Sv[0],Sv[1],e.hasZ?Sv[2]:0,E(s)?s:null)}function $4(t){switch(t.type){case"point":return t;case"polygon":case"extent":return $ne(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=T2e(e,x2e(e)/2);return c_(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const Sv=V();function zne(){return new Float32Array(2)}function A1t(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Fp(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function y1t(t,e){return new Float32Array(t,e,2)}function S4e(){return zne()}function E4e(){return Fp(1,1)}function C4e(){return Fp(1,0)}function M4e(){return Fp(0,1)}const R4e=S4e(),O4e=E4e(),_1t=C4e(),v1t=M4e();Object.freeze(Object.defineProperty({__proto__:null,ONES:O4e,UNIT_X:_1t,UNIT_Y:v1t,ZEROS:R4e,clone:A1t,create:zne,createView:y1t,fromValues:Fp,ones:E4e,unitX:C4e,unitY:M4e,zeros:S4e},Symbol.toStringTag,{value:"Module"}));function b1t(t){const e=new Di;e.include(Gse),e.include(c$e,t),e.include(ho,t),e.attributes.add(B.UV0,"vec2");const{vertex:r,fragment:i}=e;return r.uniforms.add([new hi("viewport",(s,n)=>n.camera.fullViewport),new nt("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new Bi("pixelToNDC",(s,n)=>Kr(fme,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new nt("borderSize",(s,n)=>E(s.borderColor)?n.camera.pixelRatio:0),new Bi("screenOffset",(s,n)=>Kr(fme,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&b7(r),r.code.add(I`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?I`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?I`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:I`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?I`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:I`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?I`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:I`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add([new hi("uColor",s=>pme(s.color)),new hi("borderColor",s=>pme(s.borderColor))]),t.hasMultipassGeometry&&(i.include(DOe,t),i.uniforms.add(new Bi("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(I`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?I`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:I`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function pme(t){return E(t)?t:bg}const fme=Dt(),w1t=Object.freeze(Object.defineProperty({__proto__:null,build:b1t},Symbol.toStringTag,{value:"Module"}));let P4e=class I4e extends Vi{initializeConfiguration(e,r){r.spherical=e.viewingMode===_t.Global}initializeProgram(e){return new Fi(e.rctx,I4e.shader.get().build(this.configuration),Pi)}setPipelineState(e){const r=e?Bs.ALWAYS:Bs.LESS;return this.configuration.depthHudEnabled?Rr({depthTest:{func:r},depthWrite:qu}):Rr({blending:Aa(tt.ONE,tt.SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:zr})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};P4e.shader=new Ni(w1t,()=>be(()=>import("./LineCallout.glsl-027fa21c.js"),[]));let wp=class extends $a{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Du.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};u([ie({count:Du.COUNT})],wp.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([ie()],wp.prototype,"spherical",void 0),u([ie()],wp.prototype,"occlusionTestEnabled",void 0),u([ie()],wp.prototype,"hasVerticalOffset",void 0),u([ie()],wp.prototype,"hasScreenSizePerspective",void 0),u([ie()],wp.prototype,"depthHudEnabled",void 0),u([ie()],wp.prototype,"depthHudAlignStartEnabled",void 0),u([ie()],wp.prototype,"hasSlicePlane",void 0),u([ie()],wp.prototype,"hasMultipassGeometry",void 0),u([ie({constValue:!0})],wp.prototype,"hasSliceInVertexProgram",void 0),u([ie({constValue:!1})],wp.prototype,"isDraped",void 0);let pN=class eK extends Pb{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new $4e),this._configuration=new wp,this._uniqueMaterialIdentifier=eK.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,r){const i=(r==null?void 0:r.slot)!==et.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=E(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=E(this.parameters.screenSizePerspective),this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Du.Screen:Du.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,r){if(r===ee.Color)switch(e){case et.LINE_CALLOUTS:case et.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new x1t(e)}createBufferWriter(){return new S1t}validateParameters(e){const r=eK.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},x1t=class extends Ob{beginSlot(e){return this.ensureTechnique(P4e,e)}},$4e=class extends rR{constructor(){super(...arguments),this.screenOffset=Hu,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const T1t=gn().vec3f(B.POSITION).vec3f(B.NORMAL).vec2f(B.UV0).vec4f(B.AUXPOS1),mme=[Fp(0,0),Fp(1,0),Fp(0,1),Fp(1,0),Fp(1,1),Fp(0,1)];let S1t=class{constructor(){this.vertexBufferLayout=T1t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(B.POSITION).length}write(e,r,i,s,n){w7(i.indices.get(B.POSITION),i.vertexAttributes.get(B.POSITION).data,e,s.position,n,6),Tne(i.indices.get(B.NORMAL),i.vertexAttributes.get(B.NORMAL).data,r,s.normal,n,6),fM(i.indices.get(B.AUXPOS1),i.vertexAttributes.get(B.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<mme.length;++o)s.uv0.setVec(n+o,mme[o])}},L4e=class D4e extends Jg{constructor(e,r){super(e,null,r,M1t),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new pN(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.screenOffset=e.screenOffset||Hu,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){const e=new $4e,r=this.symbol,i=r.callout;if(e.color=E(i.color)?Ot.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=ll(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;e.verticalOffset={screenLength:ll(o),minWorldLength:a||0,maxWorldLength:E(l)?l:1/0}}e.borderColor=E(i.border)&&E(i.border.color)?Ot.toUnitRGBA(i.border.color):null;const s=r.symbolLayers.getItemAt(0).type==="object",n=r.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return C1t}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,s=this.setGraphicElevationContext(i,new K0,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!Gxe(l)))return null;const a=$ne(i.geometry);return N(a)?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){E(this._material)&&this._material.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=qL(D4e.elevationModeChangeTypes,i,s);return n!==Ln.UPDATE||e.forEach(o=>{const a=r(o);E(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return N(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,E(r.metadata)?r.metadata.elevationOffset:0),r.needsElevationUpdates=ff(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Bne.memory}}_createVertexData(e){const{translation:r,centerOffset:i}=e,s=new Rt(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),n=new Rt(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[B.POSITION,s],[B.NORMAL,new Rt([0,0,1],3,!0)],[B.AUXPOS1,n]]}_getOrCreateMaterial(e){const r=this._perInstanceMaterialParameters(e),i=pN.uniqueMaterialIdentifier(r);if(E(this._material)&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(E(e.materialCollection)){let s=e.materialCollection.get(i);return N(s)&&(s=new pN(r),e.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new pN(r),isUnique:!0}}_createAs3DShape(e,r,i,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(i),l=new Mo(a.material,this._createVertexData(i),E1t,null,Xn.Point,o),c=Vne(this._context,e,l,r,s);if(N(c))return null;const h=new Zg(this,c.object,[l],a.isUnique?[a.material]:null,null,P4,r);return h.metadata=new m4e(i.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=ff(r.mode),I4(h,e,this._context.elevationProvider),h}};L4e.elevationModeChangeTypes={definedChanged:Ln.UPDATE,staysOnTheGround:Ln.UPDATE,onTheGroundChanged:Ln.RECREATE};const Mj=[0],E1t=[[B.POSITION,Mj],[B.NORMAL,Mj],[B.AUXPOS1,Mj]],C1t={mode:"relative-to-ground",offset:0},M1t={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let R1t=class{constructor(e,r,i=V(),s=Zr(),n=Dt(),o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},O1t=class extends e1t{};const gme=we.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function P1t(t,e){if(!Tre(t))return gme.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=I1t[t.callout.type];return r?new r(t,e):(gme.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const I1t={line:L4e},Ame=new al(Array,t=>sU(t,Rxe),null,10,5),$1t=si();let L1t=class{get labelLayers(){return this._labelLayers}get extent(){return this._extent}constructor(e,r,i,s,n){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._labelLayers=new Array,this._auxiliaryLayers=new Array,this._visibilityFlags=D1t(sl._COUNT,Mh._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++r.referenced,this._featureExpressionFeature=n?h4e(n,e,s):null;for(const o of i)E(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}initialize(e,r){this._layer=r,this._stage=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e,r),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this.layers=null,this._auxiliaryLayers=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers.length=0}addLabelGraphic(e,r,i){this._labelLayers.push(e),e.initialize(r,i),e.setVisibility(this.isVisible(sl.LABEL))}addAuxiliaryGraphic(e){this._auxiliaryLayers.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=sl.GRAPHIC,r){for(let i=0;i<=e;i++){const s=this._visibilityFlags[i];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==r)return!1}return!0}hasVisibilityFlag(e,r){return this._visibilityFlags[r][e]!=null}setVisibilityFlag(e,r,i){const s=this.isVisible(i);this._visibilityFlags[i][e]=r;const n=this.isVisible(i);if(s===n)return!1;if(i===sl.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(sl.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(e,r=sl.GRAPHIC){return this.setVisibilityFlag(e,void 0,r)}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(N(r))return!1;this._extent=si(),E_t(r,this._extent);const i=r.spatialReference;if(!Po(i,e)&&!yU(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return E(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===r||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=r),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(e,r,i){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=sf.fromExtent(s.type==="mesh"?s.extent:s)),ket(s,r,i)}get usedMemory(){let e=HTe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(N(i))return;const s=r.type==="draped"?i.memory.draped:i.memory;e+=s.bytesPerFeature,s.bytesPerCoordinate&&(e+=S_t(this.graphic.geometry)*s.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:V(),num:0},draped:{origin:Dt(),num:0}};for(const r of this.layers)N(r)||r.computeAttachmentOrigin(e);return e.render.num>1&&Me(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Ch(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Fs(n.boundingBox):n.boundingBox=Fs(),n.requiresDrapedElevation=!1,await GB(this.layers,async o=>{if(N(o))return;const a=o.type==="draped"?r:e,l=Ame.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&U3(n.boundingBox,l),Ame.release(l)}),Zje(n.boundingBox)||SY(Are(n.boundingBox,$1t))?n:null}needsElevationUpdates(){for(const e of this.layers)if(E(e)&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;for(const e of this._labelLayers)if(e&&e.needsElevationUpdates)return!0;return!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._forEachGraphicList(this._auxiliaryLayers,e)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}};function D1t(t,e){const r=new Array(t);for(let i=0;i<r.length;i++)r[i]=new Array(e);return r}var yme,_me,vme,fb={},N1t={get exports(){return fb},set exports(t){fb=t}};yme=N1t,_me=function(){function t(W,q,X){X=X||2;var se,ae,fe,ue,Re,De,Ue,Je=q&&q.length,vt=Je?q[0]*X:W.length,lt=e(W,0,vt,X,!0),Ye=[];if(!lt||lt.next===lt.prev)return Ye;if(Je&&(lt=l(W,q,lt,X)),W.length>80*X){se=fe=W[0],ae=ue=W[1];for(var ut=X;ut<vt;ut+=X)(Re=W[ut])<se&&(se=Re),(De=W[ut+1])<ae&&(ae=De),Re>fe&&(fe=Re),De>ue&&(ue=De);Ue=(Ue=Math.max(fe-se,ue-ae))!==0?1/Ue:0}return i(lt,Ye,X,se,ae,Ue),Ye}function e(W,q,X,se,ae){var fe,ue;if(ae===le(W,q,X,se)>0)for(fe=q;fe<X;fe+=se)ue=Ae(fe,W[fe],W[fe+1],ue);else for(fe=X-se;fe>=q;fe-=se)ue=Ae(fe,W[fe],W[fe+1],ue);if(ue&&k(ue,ue.next)){var Re=ue.next;ve(ue),ue=Re}return ue}function r(W,q){if(!W)return W;q||(q=W);var X,se=W;do if(X=!1,se.steiner||!k(se,se.next)&&L(se.prev,se,se.next)!==0)se=se.next;else{var ae=se.prev;if(ve(se),(se=q=ae)===se.next)break;X=!0}while(X||se!==q);return q}function i(W,q,X,se,ae,fe,ue){if(W){!ue&&fe&&w(W,se,ae,fe);for(var Re,De,Ue=W;W.prev!==W.next;)if(Re=W.prev,De=W.next,fe?n(W,se,ae,fe):s(W))q.push(Re.i/X),q.push(W.i/X),q.push(De.i/X),ve(W),W=De.next,Ue=De.next;else if((W=De)===Ue){ue?ue===1?i(W=o(r(W),q,X),q,X,se,ae,fe,2):ue===2&&a(W,q,X,se,ae,fe):i(r(W),q,X,se,ae,fe,1);break}}}function s(W){var q=W.prev,X=W,se=W.next;if(L(q,X,se)>=0)return!1;for(var ae=W.next.next;ae!==W.prev;){if(O(q.x,q.y,X.x,X.y,se.x,se.y,ae.x,ae.y)&&L(ae.prev,ae,ae.next)>=0)return!1;ae=ae.next}return!0}function n(W,q,X,se){var ae=W.prev,fe=W,ue=W.next;if(L(ae,fe,ue)>=0)return!1;for(var Re=ae.x<fe.x?ae.x<ue.x?ae.x:ue.x:fe.x<ue.x?fe.x:ue.x,De=ae.y<fe.y?ae.y<ue.y?ae.y:ue.y:fe.y<ue.y?fe.y:ue.y,Ue=ae.x>fe.x?ae.x>ue.x?ae.x:ue.x:fe.x>ue.x?fe.x:ue.x,Je=ae.y>fe.y?ae.y>ue.y?ae.y:ue.y:fe.y>ue.y?fe.y:ue.y,vt=C(Re,De,q,X,se),lt=C(Ue,Je,q,X,se),Ye=W.prevZ,ut=W.nextZ;Ye&&Ye.z>=vt&&ut&&ut.z<=lt;){if(Ye!==W.prev&&Ye!==W.next&&O(ae.x,ae.y,fe.x,fe.y,ue.x,ue.y,Ye.x,Ye.y)&&L(Ye.prev,Ye,Ye.next)>=0||(Ye=Ye.prevZ,ut!==W.prev&&ut!==W.next&&O(ae.x,ae.y,fe.x,fe.y,ue.x,ue.y,ut.x,ut.y)&&L(ut.prev,ut,ut.next)>=0))return!1;ut=ut.nextZ}for(;Ye&&Ye.z>=vt;){if(Ye!==W.prev&&Ye!==W.next&&O(ae.x,ae.y,fe.x,fe.y,ue.x,ue.y,Ye.x,Ye.y)&&L(Ye.prev,Ye,Ye.next)>=0)return!1;Ye=Ye.prevZ}for(;ut&&ut.z<=lt;){if(ut!==W.prev&&ut!==W.next&&O(ae.x,ae.y,fe.x,fe.y,ue.x,ue.y,ut.x,ut.y)&&L(ut.prev,ut,ut.next)>=0)return!1;ut=ut.nextZ}return!0}function o(W,q,X){var se=W;do{var ae=se.prev,fe=se.next.next;!k(ae,fe)&&F(ae,se,se.next,fe)&&J(ae,fe)&&J(fe,ae)&&(q.push(ae.i/X),q.push(se.i/X),q.push(fe.i/X),ve(se),ve(se.next),se=W=fe),se=se.next}while(se!==W);return r(se)}function a(W,q,X,se,ae,fe){var ue=W;do{for(var Re=ue.next.next;Re!==ue.prev;){if(ue.i!==Re.i&&$(ue,Re)){var De=re(ue,Re);return ue=r(ue,ue.next),De=r(De,De.next),i(ue,q,X,se,ae,fe),void i(De,q,X,se,ae,fe)}Re=Re.next}ue=ue.next}while(ue!==W)}function l(W,q,X,se){var ae,fe,ue,Re=[];for(ae=0,fe=q.length;ae<fe;ae++)(ue=e(W,q[ae]*se,ae<fe-1?q[ae+1]*se:W.length,se,!1))===ue.next&&(ue.steiner=!0),Re.push(M(ue));for(Re.sort(c),ae=0;ae<Re.length;ae++)X=r(X=p(Re[ae],X),X.next);return X}function c(W,q){return W.x-q.x}function h(W){if(W.next.prev===W)return W;let q=W;for(;;){const X=q.next;if(X.prev===q||X===q||X===W)break;q=X}return q}function p(W,q){var X=A(W,q);if(!X)return q;var se=re(X,W),ae=r(X,X.next);let fe=h(se);return r(fe,fe.next),ae=h(ae),h(q===X?ae:q)}function A(W,q){var X,se=q,ae=W.x,fe=W.y,ue=-1/0;do{if(fe<=se.y&&fe>=se.next.y&&se.next.y!==se.y){var Re=se.x+(fe-se.y)*(se.next.x-se.x)/(se.next.y-se.y);if(Re<=ae&&Re>ue){if(ue=Re,Re===ae){if(fe===se.y)return se;if(fe===se.next.y)return se.next}X=se.x<se.next.x?se:se.next}}se=se.next}while(se!==q);if(!X)return null;if(ae===ue)return X;var De,Ue=X,Je=X.x,vt=X.y,lt=1/0;se=X;do ae>=se.x&&se.x>=Je&&ae!==se.x&&O(fe<vt?ae:ue,fe,Je,vt,fe<vt?ue:ae,fe,se.x,se.y)&&(De=Math.abs(fe-se.y)/(ae-se.x),J(se,W)&&(De<lt||De===lt&&(se.x>X.x||se.x===X.x&&_(X,se)))&&(X=se,lt=De)),se=se.next;while(se!==Ue);return X}function _(W,q){return L(W.prev,W,q.prev)<0&&L(q.next,W,W.next)<0}function w(W,q,X,se){var ae=W;do ae.z===null&&(ae.z=C(ae.x,ae.y,q,X,se)),ae.prevZ=ae.prev,ae.nextZ=ae.next,ae=ae.next;while(ae!==W);ae.prevZ.nextZ=null,ae.prevZ=null,T(ae)}function T(W){var q,X,se,ae,fe,ue,Re,De,Ue=1;do{for(X=W,W=null,fe=null,ue=0;X;){for(ue++,se=X,Re=0,q=0;q<Ue&&(Re++,se=se.nextZ);q++);for(De=Ue;Re>0||De>0&&se;)Re!==0&&(De===0||!se||X.z<=se.z)?(ae=X,X=X.nextZ,Re--):(ae=se,se=se.nextZ,De--),fe?fe.nextZ=ae:W=ae,ae.prevZ=fe,fe=ae;X=se}fe.nextZ=null,Ue*=2}while(ue>1);return W}function C(W,q,X,se,ae){return(W=1431655765&((W=858993459&((W=252645135&((W=16711935&((W=32767*(W-X)*ae)|W<<8))|W<<4))|W<<2))|W<<1))|(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q=32767*(q-se)*ae)|q<<8))|q<<4))|q<<2))|q<<1))<<1}function M(W){var q=W,X=W;do(q.x<X.x||q.x===X.x&&q.y<X.y)&&(X=q),q=q.next;while(q!==W);return X}function O(W,q,X,se,ae,fe,ue,Re){return(ae-ue)*(q-Re)-(W-ue)*(fe-Re)>=0&&(W-ue)*(se-Re)-(X-ue)*(q-Re)>=0&&(X-ue)*(fe-Re)-(ae-ue)*(se-Re)>=0}function $(W,q){return W.next.i!==q.i&&W.prev.i!==q.i&&!Z(W,q)&&(J(W,q)&&J(q,W)&&te(W,q)&&(L(W.prev,W,q.prev)||L(W,q.prev,q))||k(W,q)&&L(W.prev,W,W.next)>0&&L(q.prev,q,q.next)>0)}function L(W,q,X){return(q.y-W.y)*(X.x-q.x)-(q.x-W.x)*(X.y-q.y)}function k(W,q){return W.x===q.x&&W.y===q.y}function F(W,q,X,se){var ae=z(L(W,q,X)),fe=z(L(W,q,se)),ue=z(L(X,se,W)),Re=z(L(X,se,q));return ae!==fe&&ue!==Re||!(ae!==0||!G(W,X,q))||!(fe!==0||!G(W,se,q))||!(ue!==0||!G(X,W,se))||!(Re!==0||!G(X,q,se))}function G(W,q,X){return q.x<=Math.max(W.x,X.x)&&q.x>=Math.min(W.x,X.x)&&q.y<=Math.max(W.y,X.y)&&q.y>=Math.min(W.y,X.y)}function z(W){return W>0?1:W<0?-1:0}function Z(W,q){var X=W;do{if(X.i!==W.i&&X.next.i!==W.i&&X.i!==q.i&&X.next.i!==q.i&&F(X,X.next,W,q))return!0;X=X.next}while(X!==W);return!1}function J(W,q){return L(W.prev,W,W.next)<0?L(W,q,W.next)>=0&&L(W,W.prev,q)>=0:L(W,q,W.prev)<0||L(W,W.next,q)<0}function te(W,q){var X=W,se=!1,ae=(W.x+q.x)/2,fe=(W.y+q.y)/2;do X.y>fe!=X.next.y>fe&&X.next.y!==X.y&&ae<(X.next.x-X.x)*(fe-X.y)/(X.next.y-X.y)+X.x&&(se=!se),X=X.next;while(X!==W);return se}function re(W,q){var X=new ye(W.i,W.x,W.y),se=new ye(q.i,q.x,q.y),ae=W.next,fe=q.prev;return W.next=q,q.prev=W,X.next=ae,ae.prev=X,se.next=X,X.prev=se,fe.next=se,se.prev=fe,se}function Ae(W,q,X,se){var ae=new ye(W,q,X);return se?(ae.next=se.next,ae.prev=se,se.next.prev=ae,se.next=ae):(ae.prev=ae,ae.next=ae),ae}function ve(W){W.next.prev=W.prev,W.prev.next=W.next,W.prevZ&&(W.prevZ.nextZ=W.nextZ),W.nextZ&&(W.nextZ.prevZ=W.prevZ)}function ye(W,q,X){this.i=W,this.x=q,this.y=X,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function le(W,q,X,se){for(var ae=0,fe=q,ue=X-se;fe<X;fe+=se)ae+=(W[ue]-W[fe])*(W[fe+1]+W[ue+1]),ue=fe;return ae}return t.deviation=function(W,q,X,se){var ae=q&&q.length,fe=ae?q[0]*X:W.length,ue=Math.abs(le(W,0,fe,X));if(ae)for(var Re=0,De=q.length;Re<De;Re++){var Ue=q[Re]*X,Je=Re<De-1?q[Re+1]*X:W.length;ue-=Math.abs(le(W,Ue,Je,X))}var vt=0;for(Re=0;Re<se.length;Re+=3){var lt=se[Re]*X,Ye=se[Re+1]*X,ut=se[Re+2]*X;vt+=Math.abs((W[lt]-W[ut])*(W[Ye+1]-W[lt+1])-(W[lt]-W[Ye])*(W[ut+1]-W[lt+1]))}return ue===0&&vt===0?0:Math.abs((vt-ue)/ue)},t.flatten=function(W){for(var q=W[0][0].length,X={vertices:[],holes:[],dimensions:q},se=0,ae=0;ae<W.length;ae++){for(var fe=0;fe<W[ae].length;fe++)for(var ue=0;ue<q;ue++)X.vertices.push(W[ae][fe][ue]);ae>0&&(se+=W[ae-1].length,X.holes.push(se))}return X},t},(vme=_me())!==void 0&&(yme.exports=vme);const O7=we.getLogger("esri.views.3d.support.buffer.math");function YL(t,e,r){if(t.count!==e.count)return void O7.error("source and destination buffers need to have the same number of elements");const i=t.count,s=r[0],n=r[1],o=r[2],a=r[4],l=r[5],c=r[6],h=r[8],p=r[9],A=r[10],_=r[12],w=r[13],T=r[14],C=t.typedBuffer,M=t.typedBufferStride,O=e.typedBuffer,$=e.typedBufferStride;for(let L=0;L<i;L++){const k=L*M,F=L*$,G=O[F],z=O[F+1],Z=O[F+2];C[k]=s*G+a*z+h*Z+_,C[k+1]=n*G+l*z+p*Z+w,C[k+2]=o*G+c*z+A*Z+T}}function mb(t,e,r){if(t.count!==e.count)return void O7.error("source and destination buffers need to have the same number of elements");const i=t.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],A=r[8],_=t.typedBuffer,w=t.typedBufferStride,T=e.typedBuffer,C=e.typedBufferStride;for(let M=0;M<i;M++){const O=M*w,$=M*C,L=T[$],k=T[$+1],F=T[$+2];_[O]=s*L+a*k+h*F,_[O+1]=n*L+l*k+p*F,_[O+2]=o*L+c*k+A*F}}function tK(t,e,r){const i=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,h=l*a;s[c]=r*o[h],s[c+1]=r*o[h+1],s[c+2]=r*o[h+2]}}function Gne(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],A=n[c+2],_=h*h+p*p+A*A;if(_>0){const w=1/Math.sqrt(_);i[l]=w*h,i[l+1]=w*p,i[l+2]=w*A}}}function F1t(t,e,r){const i=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,h=l*a;s[c]=o[h]>>r,s[c+1]=o[h+1]>>r,s[c+2]=o[h+2]>>r}}Object.freeze(Object.defineProperty({__proto__:null,normalize:Gne,scale:tK,shiftRight:F1t,transformMat3:mb,transformMat4:YL},Symbol.toStringTag,{value:"Module"}));function k1t(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function bme(t,e,r,i,s,n=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:s,draped:n}}function P7(t,e){if(!t||t.symbol)return null;const r=e&&e.renderer;return t&&E(r)&&r.getObservationRenderer?r.getObservationRenderer(t):r}function B1t(t,e){if(E(t.symbol))return t.symbol;const r=P7(t,e);return E(r)&&r.type!=="dot-density"?r.getSymbol(t,e):null}function rzt(t,e){const r=P7(t,e),i=B1t(t,e);if(N(i))return null;const s={renderer:r,symbol:i};if(N(r)||!("visualVariables"in r)||!r.visualVariables)return s;const n=Rie(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function U1t(t,e){if(E(t.symbol))return t.symbol;const r=P7(t,e);return E(r)?r.getSymbolAsync(t,e):null}async function izt(t,e){const r=P7(t,e),i=await U1t(t,e);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=Rie(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=Ot.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function V1t(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function z1t(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function wme(t){const e=[[B.POSITION,t.indices]],r=[[B.POSITION,new Rt(t.attributeData.position,3,!0)]];return E(t.attributeData.color)&&(r.push([B.COLOR,new Rt(t.attributeData.color,4,!0)]),e.push([B.COLOR,new Array(t.indices.length).fill(0)])),E(t.attributeData.uvMapSpace)&&(r.push([B.UVMAPSPACE,new Rt(t.attributeData.uvMapSpace,4,!0)]),e.push([B.UVMAPSPACE,t.indices])),E(t.attributeData.boundingRect)&&(r.push([B.BOUNDINGRECT,new Rt(t.attributeData.boundingRect,9,!0)]),e.push([B.BOUNDINGRECT,t.indices])),new Mo(t.material,r,e,t.mapPositions,Xn.Mesh,t.attributeData.objectAndLayerIdColor)}function xme(t){const e=[[B.POSITION,t.indices],[B.UV0,t.indices]],r=[[B.POSITION,new Rt(t.attributeData.position,3,!0)],[B.UV0,new Rt(t.attributeData.uv0,2,!0)]];return new Mo(t.material,r,e,t.mapPositions)}function L4(t){switch(t.type){case"extent":if(t instanceof Ki)return sf.fromExtent(t);break;case"polygon":return t}return null}let I7=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function rK(t,e,r){const i=Array.isArray(t),s=i?t.length/e:t.byteLength/(4*e),n=i?t:new Uint32Array(t,0,s*e),o=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let h=0;if(c)for(let F=0;F<c.length-1;F++){const G=c[F+1]-c[F];G>h&&(h=G)}else h=s;const p=Math.floor(1.1*h)+1;(um==null||um.length<2*p)&&(um=new Uint32Array($3(2*p)));for(let F=0;F<2*p;F++)um[F]=0;let A=0;const _=!!c&&!!a,w=_?l:s;let T=vPe(s/3);const C=new Uint32Array(l),M=1.96;let O=o!==0?Math.ceil(4*M*M/(o*o)*o*(1-o)):w,$=1,L=c?c[1]:w;for(let F=0;F<w;F++){if(F===O){const re=1-A/F;if(re+M*Math.sqrt(re*(1-re)/F)<o)return null;O*=2}if(F===L){for(let re=0;re<2*p;re++)um[re]=0;if(a)for(let re=c[$-1];re<c[$];re++)C[re]=T[a[re]];L=c[++$]}const G=_?a[F]:F,z=G*e,Z=H1t(n,z,e);let J=Z%p,te=A;for(;um[2*J+1]!==0;){if(um[2*J]===Z){const re=um[2*J+1]-1;if(G1t(n,z,re*e,e)){te=T[re];break}}J++,J>=p&&(J-=p)}te===A&&(um[2*J]=Z,um[2*J+1]=G+1,A++),T[G]=te}if(o!==0&&1-A/s<o)return null;if(_){for(let F=c[$-1];F<C.length;F++)C[F]=T[a[F]];T=i3(C)}const k=i?new Array(A):new Uint32Array(A*e);A=0;for(let F=0;F<w;F++)T[F]===A&&(j1t(n,(_?a[F]:F)*e,k,A*e,e),A++);if(a&&!_){const F=new Uint32Array(l);for(let G=0;G<F.length;G++)F[G]=T[a[G]];T=i3(F)}return{buffer:Array.isArray(k)?k:k.buffer,indices:T,uniqueCount:A}}function G1t(t,e,r,i){for(let s=0;s<i;s++)if(t[e+s]!==t[r+s])return!1;return!0}function j1t(t,e,r,i,s){for(let n=0;n<s;n++)r[i+n]=t[e+n]}function H1t(t,e,r){let i=0;for(let s=0;s<r;s++)i=t[e+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let um=null;function nzt(t){const e=QL(t.rings,t.hasZ,Ug.CCW_IS_HOLE),r=new Array;let i=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,h=Xp(e.position,3*c,3*l),p=a.holeIndices.map(_=>_-c),A=new Uint32Array(fb(h,p,3));r.push({position:h,faces:A}),i+=h.length,s+=A.length}const n=q1t(r,i,s),o=Array.isArray(n.position)?rK(n.position,3,{originalIndices:n.faces}):rK(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function q1t(t,e,r){if(t.length===1)return t[0];const i=jh(e),s=new Uint32Array(r);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:i,faces:s}}function QL(t,e,r){const i=t.length,s=new Array(i),n=new Array(i),o=new Array(i);let a=0,l=0,c=0,h=0;for(let _=0;_<i;++_)h+=t[_].length;const p=jh(3*h);let A=0;for(let _=i-1;_>=0;_--){const w=t[_],T=r===Ug.CCW_IS_HOLE&&W1t(w);if(T&&i!==1)s[a++]=w;else{let C=w.length;for(let O=0;O<a;++O)C+=s[O].length;const M={index:A,pathLengths:new Array(a+1),count:C,holeIndices:new Array(a)};M.pathLengths[0]=w.length,w.length>0&&(o[c++]={index:A,count:w.length}),A=T?fN(w,w.length-1,-1,p,A,w.length,e):fN(w,0,1,p,A,w.length,e);for(let O=0;O<a;++O){const $=s[O];M.holeIndices[O]=A,M.pathLengths[O+1]=$.length,$.length>0&&(o[c++]={index:A,count:$.length}),A=fN($,0,1,p,A,$.length,e)}a=0,M.count>0&&(n[l++]=M)}}for(let _=0;_<a;++_){const w=s[_];w.length>0&&(o[c++]={index:A,count:w.length}),A=fN(w,0,1,p,A,w.length,e)}return n.length=l,o.length=c,{position:p,polygons:n,outlines:o}}function fN(t,e,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,e+=r}return s/3}function W1t(t){return!S2e(t,!1,!1)}var Ug;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Ug||(Ug={}));var r$,H9,iK;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(r$||(r$={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(H9||(H9={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(iK||(iK={}));var dn,kp,dr,i$,Pn,Ho,Ql;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(dn||(dn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(kp||(kp={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(dr||(dr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(i$||(i$={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(Pn||(Pn={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Ho||(Ho={})),function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"}(Ql||(Ql={}));let Y1t=class{constructor(e,r){this.vec3=e,this.id=r}};function s$(t,e,r,i){return new Y1t(ct(t,e,r),i)}var Ou;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Ou||(Ou={}));let Tme=class{get extent(){return this._extent}constructor(e,r){this.index=e,this.renderTargets=r,this._extent=si(),this.resolution=0,this.renderLocalOrigin=s$(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Q1t,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const r=e===Ou.ColorAndWater?this.renderTargets.getTarget(Pn.Color):e===Ou.Highlight?this.renderTargets.getTarget(Pn.Highlight):e===Ou.ObjectAndLayerIdColor?this.renderTargets.getTarget(Pn.ObjectAndLayerIdColor):this.renderTargets.getTarget(Pn.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(Pn.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(Pn.Color):null}getNormalTexture(e){const r=e===Ou.ColorAndWater?this.renderTargets.getTarget(Pn.Water):null;return r?r.getTexture():null}draw(e,r){const i=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==Pn.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=e.drawTarget(this,s,r):this.validTargets[s.type]=!1;return i^this.computeRenderTargetValidityBitfield()?nM.CHANGED:nM.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[Pn.Color]|+e[Pn.ColorNoRasterImage]<<1|+e[Pn.Highlight]<<2|+e[Pn.Water]<<3|+e[Pn.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Ik(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Ik(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Fy(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===dn.INNER?0:this.resolution,0,this.resolution,this.resolution)}},Q1t=class{constructor(){this.extents=[si(),si(),si()],this.numViews=0}},N4e=class{constructor(e,r){this._size=zne(),this._fbo=null,this._fbo=new Jn(e,{colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE},{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:Bt.LINEAR_MIPMAP_LINEAR,hasMipmap:r,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Nt(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(e,r){this._size[0]=e,this._size[1]=r,this._fbo.resize(this._size[0],this._size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){const e=this._fbo.colorTexture;e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},pS=class{constructor(e,r,i,s=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new N4e(e,s)}},X1t=class{constructor(e){this.renderTargets=[new pS(e,ee.Color,Pn.Color),new pS(e,ee.Color,Pn.ColorNoRasterImage),new pS(e,ee.Highlight,Pn.Highlight,!1),new pS(e,ee.Normal,Pn.Water),new pS(e,ee.Color,Pn.Occluded)],Le("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new pS(e,ee.ObjectAndLayerIdColor,Pn.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,r,i){if(e)r.lastUsed=i;else if(i-r.lastUsed>Z1t)r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0;else if(r.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,r)=>e+r.fbo.gpuMemoryUsage,0)}};const Z1t=1e3;let F4e=class{constructor(e){this._context=e,this._perConstructorInstances=new ZM,this._frameCounter=0,this._keepAliveFrameCount=Sme}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=K1t){const i=r.key;let s=this._perConstructorInstances.get(e,i);if(N(s)){const n=new e(this._context,r,()=>this.release(n));s=new J1t(n),this._perConstructorInstances.set(e,i,s)}return++s.refCount,s.technique}releaseAndAcquire(e,r,i){if(E(i)){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(N(e)||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);N(r)||(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Sme&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(r,i))}),await Promise.all(e)}},J1t=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const Sme=-1,K1t=new fc;let k4e=class{constructor(e,r,i,s){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new ZM}dispose(){this._textureRepository.destroy()}acquire(e,r,i){if(this._ownMaterial(e),!e.requiresSlot(r,i))return null;let s=this._id2glMaterialRef.get(i,e.id);if(N(s)){const n=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});s=new evt(n),this._id2glMaterialRef.set(i,e.id,s)}return s.ref(),s.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);E(i)&&(i.unref(),i.referenced||(Nt(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){E(e.repository)&&e.repository!==this&&we.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},evt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,Zt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const tvt={orderedRepackingEnabled:!1},rvt={rootOrigin:null},ivt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let sK=class nK{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Ca,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),Ca.clearPool(),oK[0]=null,ow.prune(),A2.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=Ca.acquire();for(let s=0;s<r;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}Ca.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=Ca.acquire();for(const s of e){const n=E(r)?r:W3(this._objectToBoundingSphere(s),lvt);YP(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}Ca.release(i),this._shrink()}update(e,r){if(!YP(r[3])&&this._isDegenerate(e))return;const i=avt(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const s=qd(e,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,s){const n=qd(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=Rj(e,r),h=p=>{if(--n,!s(p))return;const A=this._objectToBoundingSphere(p);if(!xv(i,A))return;const _=W1(e,r,A),w=_-A[3],T=_+A[3];w<o&&(o=w,a=T,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!xv(i,p.bounds)||(Me(ip,c,p.halfSize),ke(ip,ip,p.bounds),W1(e,r,ip)>a))return!1;const A=p.node;return A.terminals.forAll(_=>h(_)),A.residents!==null&&A.residents.forAll(_=>h(_)),!0},e,r),l}forEachInDepthRange(e,r,i,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:T=>{i===nK.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,T.near),c=Math.min(c,T.far)):(l=Math.max(l,-T.far),c=Math.min(c,-T.near))}};h.setRange(s);const p=W1(r,i,e),A=Rj(r,i),_=Rj(r,-i),w=T=>{if(!a(T))return;const C=this._objectToBoundingSphere(T),M=C,O=W1(r,i,M)-p,$=O-C[3],L=O+C[3];$>c||L<l||!xv(o,C)||n(T,h)};this._forEachNodeDepthOrdered(this._root,T=>{if(!xv(o,T.bounds)||(Me(ip,A,T.halfSize),ke(ip,ip,T.bounds),W1(r,i,ip)-p>c)||(Me(ip,_,T.halfSize),ke(ip,ip,T.bounds),W1(r,i,ip)-p<l))return!1;const C=T.node;return C.terminals.forAll(M=>w(M)),C.residents!==null&&C.residents.forAll(M=>w(M)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize))}forEachNeighbor(e,r){const i=Ay(r),s=r,n=l=>{const c=this._objectToBoundingSphere(l),h=Ay(c),p=i+h;return!(cl(c,s)-p*p<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=Ay(l.bounds),h=i+c;if(cl(l.bounds,s)-h*h>0)return!1;const p=l.node;return p.terminals.forAll(a),o&&p.residents!==null&&p.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return mN(r.bounds,2*-r.halfSize,xd),mN(r.bounds,2*r.halfSize,Td),yfe(e.origin,e.direction,xd,Td)}_intersectsNodeWithOffset(e,r,i){return mN(r.bounds,2*-r.halfSize,xd),mN(r.bounds,2*r.halfSize,Td),i.applyToMinMax(xd,Td),yfe(e.origin,e.direction,xd,Td)}_intersectsObject(e,r){const i=this._objectToBoundingSphere(r);return!(i[3]>0)||gQ(i,e)}_intersectsObjectWithOffset(e,r,i){const s=this._objectToBoundingSphere(r);return!(s[3]>0)||gQ(i.applyToBoundingSphere(s),e)}_forEachNode(e,r){let i=Ca.acquire().init(e);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push(Ca.acquire().init(i).advance(n));Ca.release(i)}}_forEachNodeDepthOrdered(e,r,i,s=nK.DepthOrder.FRONT_TO_BACK){let n=Ca.acquire().init(e);const o=[n];for(ovt(i,s,Mme);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=Mme[a];n.node.children[l]&&o.push(Ca.acquire().init(n).advance(l))}Ca.release(n)}}_remove(e,r,i){ow.clear();const s=i.advanceTo(r,(n,o)=>{ow.push(n.node),ow.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(e),s.length===0)for(let n=ow.length-2;n>=0;n-=2){const o=ow.data[n],a=ow.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new Vr({shrink:!0})),!0)}_add(e,r){r.advanceTo(this._objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const s=Ca.acquire().init(e);this._add(r.getItemAt(i),s),Ca.release(s)}}_grow(e,r){if(r!==0&&(Eme(e,r,i=>this._objectToBoundingSphere(i),hA),YP(hA[3])&&!this._fitsInsideTree(hA)))if(this._nodeIsEmpty(this._root.node))W3(hA,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(hA);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(hA,i):this._growRootAsSubNode(i),Ca.release(i)}}_rebuildTree(e,r){Oe(Pj,r.bounds),Pj[3]=r.halfSize,Eme([e,Pj],2,s=>s,Ij);const i=Ca.acquire().init(this._root);this._root.initFrom(null,Ij,Ij[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),Ca.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(i[l]-r),h=i[l]+r-(n[l]+o),p=Math.max(0,Math.ceil(c/(2*o))),A=Math.max(0,Math.ceil(h/(2*o)))+1,_=2**Math.ceil(Math.log(p+A)*Math.LOG2E);s=Math.max(s,_),gN[l].min=p,gN[l].max=A}for(let l=0;l<3;l++){let c=gN[l].min,h=gN[l].max;const p=(s-(c+h))/2;c+=Math.ceil(p),h+=Math.floor(p);const A=n[l]-o-c*o*2;Oj[l]=A+(h+c)*o}const a=s*o;return Oj[3]=a*U4e,Ca.acquire().initFrom(null,Oj,a,0)}_growRootAsSubNode(e){const r=this._root.node;Oe(hA,this._root.bounds),hA[3]=this._root.halfSize,this._root.init(e),e.advanceTo(hA,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&e==null;)i=s++,e=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(e){return!YP(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}},Ca=class kE{constructor(){this.bounds=Io(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,s=this.depth){return this.node=E(e)?e:kE.createEmptyNode(),E(r)&&W3(r,this.bounds),this.halfSize=i,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*U4e}advance(e){let r=this.node.children[e];r||(r=kE.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=B4e[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Vr({shrink:!0}),residents:new Vr({shrink:!0})}}static acquire(){return kE._pool.acquire()}static release(e){kE._pool.release(e)}static clearPool(){kE._pool.prune()}};function svt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function nvt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function mN(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function Eme(t,e,r,i){if(e===1){const s=r(t[0]);W3(s,i)}else{xd[0]=1/0,xd[1]=1/0,xd[2]=1/0,Td[0]=-1/0,Td[1]=-1/0,Td[2]=-1/0;for(let s=0;s<e;s++){const n=r(t[s]);YP(n[3])&&(svt(xd,n),nvt(Td,n))}fo(i,xd,Td,.5),i[3]=Math.max(Td[0]-xd[0],Td[1]-xd[1],Td[2]-xd[2])/2}}function ovt(t,e,r){if(!A2.length)for(let i=0;i<8;++i)A2.push({index:0,distance:0});for(let i=0;i<8;++i){const s=B4e[i];A2.data[i].index=i,A2.data[i].distance=W1(t,e,s)}A2.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=A2.data[i].index}function Rj(t,e){let r,i=1/0;for(let s=0;s<8;++s){const n=W1(t,e,Cme[s]);n<i&&(i=n,r=Cme[s])}return r}function W1(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function YP(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Ca._pool=new al(Ca),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(sK||(sK={}));const B4e=[ct(-1,-1,-1),ct(1,-1,-1),ct(-1,1,-1),ct(1,1,-1),ct(-1,-1,1),ct(1,-1,1),ct(-1,1,1),ct(1,1,1)],Cme=[ct(-1,-1,-1),ct(-1,-1,1),ct(-1,1,-1),ct(-1,1,1),ct(1,-1,-1),ct(1,-1,1),ct(1,1,-1),ct(1,1,1)],U4e=Math.sqrt(3),oK=[null];function avt(t){return oK[0]=t,oK}const Oj=Io(),ip=V(),xd=V(),Td=V(),ow=new Vr,lvt=Io(),hA=Io(),Pj=Io(),Ij=Io(),gN=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],A2=new Vr,Mme=[0,0,0,0,0,0,0,0],S0=sK;var jv;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(jv||(jv={}));let V4e=class extends UL{get objects(){return this._objects}constructor(e,r=""){super(),this.apiLayerUid=r,this.type=Xn.Layer,this.events=new Nn,this.sliceable=!1,this._objects=new Vr,this._objectsAdded=new Vr,this._stageHandles=new ts,this.apiLayerUid=r,this.visible=(e==null?void 0:e.visible)??!0,this.pickable=(e==null?void 0:e.pickable)??!0,this.updatePolicy=(e==null?void 0:e.updatePolicy)??jv.ASYNC,this._disableOctree=(e==null?void 0:e.disableOctree)??!1}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const r of ivt)this._stageHandles.add(this.events.on(r,i=>e.handleEvent(r,i)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),E(this._octree)&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),E(this._octree)&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),E(this._octree)&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),E(this._octree)){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){E(this._stage)&&this.updatePolicy!==jv.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){E(this._octree)&&!this._objectsAdded.includes(e)&&this._octree.update(e,r)}getSpatialQueryAccelerator(){return N(this._octree)&&this._objects.length>50&&!this._disableOctree?(this._octree=new S0(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):E(this._octree)&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=gt(this._octree),this._objectsAdded.clear()}};function q9(t){return E(t)&&t.type===Xn.Layer}var Zp,cT;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Zp||(Zp={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(cT||(cT={}));let Za=class extends $a{constructor(){super(...arguments),this.output=ee.Color,this.transparencyPassType=lr.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Zp.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=cT.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([ie({count:ee.COUNT})],Za.prototype,"output",void 0),u([ie({count:lr.COUNT})],Za.prototype,"transparencyPassType",void 0),u([ie()],Za.prototype,"occluder",void 0),u([ie()],Za.prototype,"hasSlicePlane",void 0),u([ie()],Za.prototype,"writeDepth",void 0),u([ie({count:Zp.COUNT})],Za.prototype,"space",void 0),u([ie()],Za.prototype,"hideOnShortSegments",void 0),u([ie()],Za.prototype,"hasCap",void 0),u([ie({count:cT.COUNT})],Za.prototype,"anchor",void 0),u([ie()],Za.prototype,"hasTip",void 0),u([ie()],Za.prototype,"vvSize",void 0),u([ie()],Za.prototype,"vvColor",void 0),u([ie()],Za.prototype,"vvOpacity",void 0),u([ie()],Za.prototype,"hasOccludees",void 0),u([ie()],Za.prototype,"hasMultipassTerrain",void 0),u([ie()],Za.prototype,"cullAboveGround",void 0),u([ie({constValue:!0})],Za.prototype,"hasVvInstancing",void 0),u([ie({constValue:!0})],Za.prototype,"hasSliceTranslatedView",void 0);const Rme=8;function z4e(t,e){const r=t.vertex;r.uniforms.add(new nt("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(B.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new Fr("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new Fr("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new Fr("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new Fr("vvSizeFactor",i=>i.vvSizeFactor)),r.code.add(I`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(B.SIZE,"float"),r.code.add(I`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(B.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add([new Kl("vvOpacityValues",i=>i.vvOpacityValues,Rme),new Kl("vvOpacityOpacities",i=>i.vvOpacityOpacities,Rme)]),r.code.add(I`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(I`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.attributes.add(B.COLORFEATUREATTRIBUTE,"float"),r.constants.add("vvColorNumber","int",D0),r.uniforms.add(new Kl("vvColorValues",i=>i.vvColorValues,D0)),r.uniforms.add(new T7("vvColorColors",i=>i.vvColorColors,D0)),r.code.add(I`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(t.attributes.add(B.COLOR,"vec4"),r.code.add(I`vec4 getColor(){
return applyOpacity(color);
}`))}function Hy(t,e){switch(t.fragment.include(qh),e.output){case ee.Shadow:case ee.ShadowHighlight:case ee.ShadowExcludeHighlight:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(I`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case ee.Depth:t.fragment.code.add(I`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}}let G4e=class{constructor(e){this._rctx=e,this._cache=new Map}destroy(){this._cache.forEach(e=>Nt(e.stippleTexture)),this._cache.clear()}_acquire(e){if(N(e))return null;const r=this._patternId(e),i=this._cache.get(r);if(i)return i.refCount++,i;const{encodedData:s,paddedPixels:n}=uvt(e),o=new cvt(new Wt(this._rctx,{width:n,height:1,internalFormat:At.RGBA,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE},s));return this._cache.set(r,o),o}release(e){if(N(e))return;const r=this._patternId(e),i=this._cache.get(r);i&&(i.refCount--,i.refCount===0&&(E(i.stippleTexture)&&i.stippleTexture.dispose(),this._cache.delete(r)))}swap(e,r){const i=this._acquire(r);return this.release(e),i}_patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}},cvt=class extends ys{constructor(e){super(),this.stippleTexture=e,this.refCount=1}};function uvt(t){const e=jne(t),r=1/t.pixelRatio,i=j4e(t),s=H4e(t),n=(Math.floor(.5*(s-1))+.5)*r,o=[];let a=1;for(const _ of e){for(let w=0;w<_;w++){const T=a*(Math.min(w,_-1-w)+.5)*r/n*.5+.5;o.push(T)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=i+q4e,p=new Uint8Array(4*h);let A=4;for(const _ of c)R4(_,p,A),A+=4;return p.copyWithin(0,A-4,A),p.copyWithin(A,4,8),{encodedData:p,paddedPixels:h}}function jne(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function j4e(t){if(N(t))return 1;const e=jne(t);return Math.floor(e.reduce((r,i)=>r+i))}function H4e(t){return jne(t).reduce((e,r)=>Math.max(e,r))}const q4e=2;function hvt(t){return N(t)?bg:t.length===4?t:ns(dvt,t[0],t[1],t[2],1)}const dvt=Zr();function W4e(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?pvt(t,e):fvt(t)}function pvt(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:s}=t;s.include(qh),e.draped||(W0(i,e),i.uniforms.add(new nt("worldToScreenPerDistanceRatio",(o,a)=>1/a.camera.perScreenPixelRatio)),i.code.add(I`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),i.code.add(I`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${gvt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(I`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(I`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),i.uniforms.add(new nt("pixelRatio",(o,a)=>a.camera.pixelRatio)),i.code.add(I`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?I`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",q4e);const n=e.hasWebGL2Context?is.None:is.Size;s.uniforms.add($0("stipplePatternTexture",o=>o.stippleTexture,n)),s.uniforms.add([new nt("stipplePatternSDFNormalizer",o=>mvt(o.stipplePattern)),new nt("stipplePatternPixelSizeInv",o=>1/Hne(o))]),s.code.add(I`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${Qp(e,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `),s.code.add(I`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?I`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:I`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?I`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?I`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:I`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?I`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:I`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(s.uniforms.add(new hi("stippleOffColor",o=>hvt(o.stippleOffColor))),s.code.add(I`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(I`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function fvt(t){t.fragment.code.add(I`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function mvt(t){return E(t)?(Math.floor(.5*(H4e(t)-1))+.5)/t.pixelRatio:1}function Hne(t){const e=t.stipplePattern;return E(e)?j4e(t.stipplePattern)/e.pixelRatio:1}const gvt=I.float(.4),D4=64,qne=D4/2,Y4e=qne/5,Avt=D4/Y4e,yvt=.25;function _vt(t,e){return t.fromData(`${e}-marker`,()=>C$e(e,D4,qne,Y4e))}function Q4e(t,e){const r=t.vertex;t.constants.add("markerSizePerLineWidth","float",Avt),r.uniforms.add(new nt("pixelRatio",(i,s)=>s.camera.pixelRatio)),N(r.uniforms.get("markerScale"))&&r.constants.add("markerScale","float",1),r.code.add(I`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Zp.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new nt("perRenderPixelRatio",(i,s)=>s.camera.perRenderPixelRatio)),r.code.add(I`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))}var Jp;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Jp||(Jp={}));let hn=class extends $a{constructor(){super(...arguments),this.output=ee.Color,this.capType=Jp.BUTT,this.transparencyPassType=lr.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};u([ie({count:ee.COUNT})],hn.prototype,"output",void 0),u([ie({count:Jp.COUNT})],hn.prototype,"capType",void 0),u([ie({count:lr.COUNT})],hn.prototype,"transparencyPassType",void 0),u([ie()],hn.prototype,"occluder",void 0),u([ie()],hn.prototype,"hasSlicePlane",void 0),u([ie()],hn.prototype,"hasPolygonOffset",void 0),u([ie()],hn.prototype,"writeDepth",void 0),u([ie()],hn.prototype,"draped",void 0),u([ie()],hn.prototype,"stippleEnabled",void 0),u([ie()],hn.prototype,"stippleOffColorEnabled",void 0),u([ie()],hn.prototype,"stippleScaleWithLineWidth",void 0),u([ie()],hn.prototype,"stipplePreferContinuous",void 0),u([ie()],hn.prototype,"roundJoins",void 0),u([ie()],hn.prototype,"applyMarkerOffset",void 0),u([ie()],hn.prototype,"vvSize",void 0),u([ie()],hn.prototype,"vvColor",void 0),u([ie()],hn.prototype,"vvOpacity",void 0),u([ie()],hn.prototype,"falloffEnabled",void 0),u([ie()],hn.prototype,"innerColorEnabled",void 0),u([ie()],hn.prototype,"hasOccludees",void 0),u([ie()],hn.prototype,"hasMultipassTerrain",void 0),u([ie()],hn.prototype,"cullAboveGround",void 0),u([ie()],hn.prototype,"wireframe",void 0),u([ie({constValue:!0})],hn.prototype,"stippleRequiresClamp",void 0),u([ie({constValue:!0})],hn.prototype,"stippleRequiresStretchMeasure",void 0),u([ie({constValue:!0})],hn.prototype,"hasVvInstancing",void 0),u([ie({constValue:!0})],hn.prototype,"hasSliceTranslatedView",void 0),u([ie()],hn.prototype,"objectAndLayerIdColorInstanced",void 0);const W9=1;function vvt(t){const e=new Di,{vertex:r,fragment:i}=e,s=t.hasMultipassTerrain&&(t.output===ee.Color||t.output===ee.Alpha);e.include(FL),e.include(z4e,t),e.include(W4e,t);const n=t.applyMarkerOffset&&!t.draped;n&&(r.uniforms.add(new nt("markerScale",_=>_.markerScale)),e.include(Q4e,{space:Zp.World})),t.output===ee.Depth&&e.include(Hy,t),e.include(x7,t),Uh(r,t),r.uniforms.add([new nn("inverseProjectionMatrix",(_,w)=>w.camera.inverseProjectionMatrix),new Bi("nearFar",(_,w)=>w.camera.nearFar),new nt("miterLimit",_=>_.join!=="miter"?0:_.miterLimit),new hi("viewport",(_,w)=>w.camera.fullViewport)]),r.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(B.POSITION,"vec3"),e.attributes.add(B.SUBDIVISIONFACTOR,"float"),e.attributes.add(B.UV0,"vec2"),e.attributes.add(B.AUXPOS1,"vec3"),e.attributes.add(B.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),lb(e),s&&e.varyings.add("depth","float");const o=t.capType===Jp.ROUND,a=t.stippleEnabled&&t.stippleScaleWithLineWidth||o;a&&e.varyings.add("vLineWidth","float");const l=t.stippleEnabled&&t.stippleScaleWithLineWidth;l&&e.varyings.add("vLineSizeInv","float");const c=t.innerColorEnabled||o;c&&e.varyings.add("vLineDistance","float");const h=t.stippleEnabled&&o,p=t.falloffEnabled||h;p&&e.varyings.add("vLineDistanceNorm","float"),o&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),r.code.add(I`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(I`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r7(e),r.code.add(I`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new nt("pixelRatio",(_,w)=>w.camera.pixelRatio)),r.code.add(I`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${a?I`vLineWidth = lineWidth;`:""}
      ${l?I`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&r.code.add(I`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(I`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||o)&&r.code.add(I`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${o?I`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(I`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?r.code.add(I`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?I`min(1.0, subdivisionFactor * ${I.float((W9+2)/(W9+1))})`:I`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(I`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const A=t.capType!==Jp.BUTT;return r.code.add(I`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${A?I`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(I`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${p||c?I`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?I`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${p?I`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),o&&r.code.add(I`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?r.uniforms.add(new nt("worldToScreenRatio",(_,w)=>1/w.screenToPCSRatio)):r.code.add(I`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(I`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.code.add(I`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(I`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new nt("stipplePatternPixelSize",_=>Hne(_))),r.code.add(I`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(I`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&e.include(Yd,t),e.include(ho,t),i.include(Qg),i.code.add(I`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?i.code.add(I`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(o&&i.code.add(I`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${I.float(Il)}) {
        discard;
      }
    `),h?i.code.add(I`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${I.float(Il)}, stippleCoverage);
      `):i.code.add(I`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new hi("intrinsicColor",_=>_.color)),t.output!==ee.ObjectAndLayerIdColor&&i.code.add(I`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(I`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(i.uniforms.add(new hi("innerColor",_=>gr(_.innerColor,_.color))),i.uniforms.add(new nt("innerWidth",(_,w)=>_.innerWidth*w.camera.pixelRatio)),i.code.add(I`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(I`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(i.uniforms.add(new nt("falloff",_=>_.falloff)),i.code.add(I`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(I`
    ${t.output===ee.ObjectAndLayerIdColor?I`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${I.float(Il)}) {
      discard;
    }

    ${t.output===ee.Alpha?I`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===ee.Color?I`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===ee.Color&&t.transparencyPassType===lr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${t.output===ee.Highlight?I`gl_FragColor = vec4(1.0);`:""}
    ${t.output===ee.Depth?I`outputDepth(linearDepth);`:""}
    ${t.output===ee.ObjectAndLayerIdColor?I`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const bvt=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:W9,build:vvt},Symbol.toStringTag,{value:"Module"})),Wne={func:Bs.LESS},Y9={func:Bs.ALWAYS},Vg={mask:255},X4e={mask:0},wvt=t=>({function:{func:Bs.NOTEQUAL,ref:t,mask:t},operation:{fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.KEEP}}),xvt=t=>({function:{func:Bs.ALWAYS,ref:t,mask:t},operation:{fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.REPLACE}}),$b={function:{func:Bs.ALWAYS,ref:Bu.OutlineVisualElementMask,mask:Bu.OutlineVisualElementMask},operation:{fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.ZERO}},gb={function:{func:Bs.ALWAYS,ref:Bu.OutlineVisualElementMask,mask:Bu.OutlineVisualElementMask},operation:{fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.REPLACE}},Z4e={function:{func:Bs.EQUAL,ref:Bu.OutlineVisualElementMask,mask:Bu.OutlineVisualElementMask},operation:{fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.KEEP}},J4e={function:{func:Bs.NOTEQUAL,ref:Bu.OutlineVisualElementMask,mask:Bu.OutlineVisualElementMask},operation:{fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.KEEP}},K4e=new Map([[B.POSITION,0],[B.SUBDIVISIONFACTOR,1],[B.UV0,2],[B.AUXPOS1,3],[B.AUXPOS2,4],[B.COLOR,5],[B.COLORFEATUREATTRIBUTE,5],[B.SIZE,6],[B.SIZEFEATUREATTRIBUTE,6],[B.OPACITYFEATUREATTRIBUTE,7],[B.OBJECTANDLAYERIDCOLOR,8]]);let eLe=class tLe extends Vi{initializeProgram(e){return new Fi(e.rctx,tLe.shader.get().build(this.configuration),K4e)}_makePipelineState(e,r){const i=this.configuration,s=e===lr.NONE,n=e===lr.FrontFace;return Rr({blending:i.output===ee.Color||i.output===ee.Alpha?s?zd:l_(e):null,depthTest:{func:Ib(e)},depthWrite:s?i.writeDepth?qu:null:S7(e),colorWrite:zr,stencilWrite:i.hasOccludees?Vg:null,stencilTest:i.hasOccludees?r?gb:$b:null,polygonOffset:s||n?i.hasPolygonOffset?Ome:null:C7})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?Ome:null;this._occluderPipelineTransparent=Rr({blending:zd,polygonOffset:r,depthTest:Y9,depthWrite:null,colorWrite:zr,stencilWrite:null,stencilTest:J4e}),this._occluderPipelineOpaque=Rr({blending:zd,polygonOffset:r,depthTest:Y9,depthWrite:null,colorWrite:zr,stencilWrite:X4e,stencilTest:Z4e}),this._occluderPipelineMaskWrite=Rr({blending:null,polygonOffset:r,depthTest:Wne,depthWrite:null,colorWrite:null,stencilWrite:Vg,stencilTest:gb})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Ar.LINES:Ar.TRIANGLE_STRIP}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===et.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===et.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};eLe.shader=new Ni(bvt,()=>be(()=>import("./RibbonLine.glsl-808710ca.js"),[]));const Ome={factor:0,units:-4};var fh;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(fh||(fh={}));let MC=class extends Pb{constructor(e){super(e,new Svt),this._configuration=new hn,this._vertexAttributeLocations=K4e,this._layout=this.createLayout()}isClosed(e,r){return iLe(this.parameters,e,r)}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===et.DRAPED_MATERIAL;const i=E(this.parameters.stipplePattern)&&e!==ee.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&E(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!E(this.parameters.markerParameters)&&Cvt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&E(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===xn.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(B.POSITION).data,l=e.vertexAttributes.get(B.SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const T=e.vertexAttributes.get(B.SIZEFEATUREATTRIBUTE).data[0];c*=ze(this.parameters.vvSizeOffset[0]+T*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else l&&(c*=l.data[0]);const h=s[0],p=s[1],A=(c/2+4)*e.screenToWorldRatio;let _=Number.MAX_VALUE,w=0;for(let T=0;T<a.length-5;T+=3){const C=a[T],M=a[T+1],O=h-C,$=p-M,L=a[T+3]-C,k=a[T+4]-M,F=ze((L*O+k*$)/(L*L+k*k),0,1),G=L*F-O,z=k*F-$,Z=G*G+z*z;Z<_&&(_=Z,w=T/3)}_<A*A&&n(o.dist,o.normal,w,!1)}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!APe(r))return void we.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(B.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const O=a.get(B.SIZEFEATUREATTRIBUTE).data[0];c*=ze(this.parameters.vvSizeOffset[0]+O*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a.has(B.SIZE)&&(c*=a.get(B.SIZE).data[0]);const h=i.camera,p=Mvt;ga(p,i.point);const A=c*h.pixelRatio/2+4*h.pixelRatio;$e(oO[0],p[0]-A,p[1]+A,0),$e(oO[1],p[0]+A,p[1]+A,0),$e(oO[2],p[0]+A,p[1]-A,0),$e(oO[3],p[0]-A,p[1]-A,0);for(let O=0;O<4;O++)if(!h.unprojectFromRenderScreen(oO[O],dA[O]))return;Xl(h.eye,dA[0],dA[1],Lj),Xl(h.eye,dA[1],dA[2],Dj),Xl(h.eye,dA[2],dA[3],Nj),Xl(h.eye,dA[3],dA[0],Fj);let _=Number.MAX_VALUE,w=0;const T=rLe(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let O=0;O<T;O+=3){cu[0]=l[O]+r[12],cu[1]=l[O+1]+r[13],cu[2]=l[O+2]+r[14];const $=(O+3)%l.length;if(uu[0]=l[$]+r[12],uu[1]=l[$+1]+r[13],uu[2]=l[$+2]+r[14],Rs(Lj,cu)<0&&Rs(Lj,uu)<0||Rs(Dj,cu)<0&&Rs(Dj,uu)<0||Rs(Nj,cu)<0&&Rs(Nj,uu)<0||Rs(Fj,cu)<0&&Rs(Fj,uu)<0)continue;if(h.projectToRenderScreen(cu,lw),h.projectToRenderScreen(uu,cw),lw[2]<0&&cw[2]>0){Be(hm,cu,uu);const k=h.frustum,F=-Rs(k[Ms.NEAR],cu)/He(hm,k[Ms.NEAR]);Me(hm,hm,F),ke(cu,cu,hm),h.projectToRenderScreen(cu,lw)}else if(lw[2]>0&&cw[2]<0){Be(hm,uu,cu);const k=h.frustum,F=-Rs(k[Ms.NEAR],uu)/He(hm,k[Ms.NEAR]);Me(hm,hm,F),ke(uu,uu,hm),h.projectToRenderScreen(uu,cw)}else if(lw[2]<0&&cw[2]<0)continue;lw[2]=0,cw[2]=0;const L=Vre(gx(lw,cw,$me),p);L<_&&(_=L,Oe(Pme,cu),Oe(Ime,uu),w=O/3)}const C=i.rayBegin,M=i.rayEnd;if(_<A*A){let O=Number.MAX_VALUE;if(dSe(gx(Pme,Ime,$me),gx(C,M,Rvt),aw)){Be(aw,aw,C);const $=st(aw);Me(aw,aw,1/$),O=$/Is(C,M)}o(O,aw,w,!1)}}createLayout(){const e=gn().vec3f(B.POSITION).f32(B.SUBDIVISIONFACTOR).vec2f(B.UV0).vec3f(B.AUXPOS1).vec3f(B.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(B.SIZEFEATUREATTRIBUTE):e.f32(B.SIZE),this.parameters.vvColorEnabled?e.f32(B.COLORFEATUREATTRIBUTE):e.vec4f(B.COLOR),this.parameters.vvOpacityEnabled&&e.f32(B.OPACITYFEATUREATTRIBUTE),Le("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(B.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new Evt(this._layout,this.parameters)}requiresSlot(e,r){return r===ee.Color||r===ee.Alpha||r===ee.Highlight||r===ee.Depth||r===ee.ObjectAndLayerIdColor?e===et.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===xn.OccludeAndTransparentStencil?e===et.OPAQUE_MATERIAL||e===et.OCCLUDER_MATERIAL||e===et.TRANSPARENT_OCCLUDER_MATERIAL:r===ee.Color||r===ee.Alpha?e===(this.parameters.writeDepth?et.TRANSPARENT_MATERIAL:et.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===et.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Tvt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),E(e.markerParameters)&&(e.markerScale=e.markerParameters.width/e.width)}},Tvt=class extends Ob{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==ee.Color&&this._output!==ee.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,r)),this._stipplePattern=r),this.ensureTechnique(eLe,e)}},Svt=class extends One{constructor(){super(...arguments),this.width=0,this.color=Gp,this.join="miter",this.cap=Jp.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},Evt=class{constructor(e,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=W9+i}}_isClosed(e){return rLe(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.indices.get(B.POSITION).length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,r,i,s,n){var ye;const o=Ovt,a=Pvt,l=Ivt,c=i.vertexAttributes.get(B.POSITION).data,h=i.indices&&i.indices.get(B.POSITION),p=(ye=i.vertexAttributes.get(B.DISTANCETOSTART))==null?void 0:ye.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let A=1,_=0;this._parameters.vvSizeEnabled?_=i.vertexAttributes.get(B.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(B.SIZE)&&(A=i.vertexAttributes.get(B.SIZE).data[0]);let w=[1,1,1,1],T=0;this._parameters.vvColorEnabled?T=i.vertexAttributes.get(B.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(B.COLOR)&&(w=i.vertexAttributes.get(B.COLOR).data);const C=Le("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let M=0;this._parameters.vvOpacityEnabled&&(M=i.vertexAttributes.get(B.OPACITYFEATUREATTRIBUTE).data[0]);const O=c.length/3,$=new Float32Array(s.buffer),L=Le("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,k=this.vertexBufferLayout.stride/4;let F=n*k;const G=F;let z=0;const Z=p?(le,W,q)=>z=p[q]:(le,W,q)=>z+=Is(le,W),J=Le("enable-feature:objectAndLayerId-rendering"),te=(le,W,q,X,se,ae,fe)=>{if($[F++]=W[0],$[F++]=W[1],$[F++]=W[2],$[F++]=X,$[F++]=fe,$[F++]=se,$[F++]=le[0],$[F++]=le[1],$[F++]=le[2],$[F++]=q[0],$[F++]=q[1],$[F++]=q[2],this._parameters.vvSizeEnabled?$[F++]=_:$[F++]=A,this._parameters.vvColorEnabled)$[F++]=T;else{const ue=Math.min(4*ae,w.length-4);$[F++]=w[ue],$[F++]=w[ue+1],$[F++]=w[ue+2],$[F++]=w[ue+3]}this._parameters.vvOpacityEnabled&&($[F++]=M),J&&(E(C)&&(L[4*F]=C[0],L[4*F+1]=C[1],L[4*F+2]=C[2],L[4*F+3]=C[3]),F++)};F+=k,$e(a,c[0],c[1],c[2]),e&&Mt(a,a,e);const re=this._isClosed(i);if(re){const le=c.length-3;$e(o,c[le],c[le+1],c[le+2]),e&&Mt(o,o,e)}else $e(l,c[3],c[4],c[5]),e&&Mt(l,l,e),te(a,a,l,1,fh.LEFT_CAP_START,0,0),te(a,a,l,1,fh.RIGHT_CAP_START,0,0),Oe(o,a),Oe(a,l);const Ae=re?0:1,ve=re?O:O-1;for(let le=Ae;le<ve;le++){const W=(le+1)%O*3;$e(l,c[W],c[W+1],c[W+2]),e&&Mt(l,l,e),Z(o,a,le),te(o,a,l,0,fh.LEFT_JOIN_END,le,z),te(o,a,l,0,fh.RIGHT_JOIN_END,le,z);const q=this.numJoinSubdivisions;for(let X=0;X<q;++X){const se=(X+1)/(q+1);te(o,a,l,se,fh.LEFT_JOIN_END,le,z),te(o,a,l,se,fh.RIGHT_JOIN_END,le,z)}te(o,a,l,1,fh.LEFT_JOIN_START,le,z),te(o,a,l,1,fh.RIGHT_JOIN_START,le,z),Oe(o,a),Oe(a,l)}re?($e(l,c[3],c[4],c[5]),e&&Mt(l,l,e),z=Z(o,a,ve),te(o,a,l,0,fh.LEFT_JOIN_END,Ae,z),te(o,a,l,0,fh.RIGHT_JOIN_END,Ae,z)):(z=Z(o,a,ve),te(o,a,a,0,fh.LEFT_CAP_END,ve,z),te(o,a,a,0,fh.RIGHT_CAP_END,ve,z)),$j($,G+k,$,G,k),F=$j($,F-k,$,F,k),this._parameters.wireframe&&this._addWireframeVertices(s,G,F,k)}_addWireframeVertices(e,r,i,s){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=$j(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function $j(t,e,r,i,s){for(let n=0;n<s;n++)r[i++]=t[e++];return i}function rLe(t,e,r){return iLe(t,e.get(B.POSITION).data,r?r.get(B.POSITION):null)}function iLe(t,e,r){return!!t.isClosed&&(r?r.length>2:e.length>6)}function Cvt(t){return t.anchor===cT.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const cu=V(),uu=V(),hm=V(),aw=V(),Mvt=V(),lw=Rl(),cw=Rl(),Pme=V(),Ime=V(),$me=Q0(),Rvt=Q0(),Ovt=V(),Pvt=V(),Ivt=V(),oO=[Rl(),Rl(),Rl(),Rl()],dA=[V(),V(),V(),V()],Lj=Hi(),Dj=Hi(),Nj=Hi(),Fj=Hi();let Yne=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+kh()}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const h=rvt.rootOrigin;if(E(h))return this._origins.set(this._rootOriginId,s$(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(e);const p=s$(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const i=this._gridSize,s=Math.round(e[0]/i),n=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(Be(Va,e,r.vec3),Va[0]=Math.abs(Va[0]),Va[1]=Math.abs(Va[1]),Va[2]=Math.abs(Va[2]),Va[0]<c&&Va[1]<c&&Va[2]<c){if(l){const h=Math.max(...Va);if(Be(Va,e,l.vec3),Va[0]=Math.abs(Va[0]),Va[1]=Math.abs(Va[1]),Va[2]=Math.abs(Va[2]),Math.max(...Va)<h)return l}return r}return l||(l=s$(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=Nr(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new MC({width:2,color:r}),s.add(this._material);const _=new V4e({pickable:!1}),w=new u_({castShadow:!1});s.add(w),_.add(w),s.add(_),this._objects.set(n,w)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,p=.5*this._gridSize;for(let _=0;_<l;_++)c[3*_+0]=e[0]+(1&a[_]?p:-p),c[3*_+1]=e[1]+(2&a[_]?p:-p),c[3*_+2]=e[2]+(4&a[_]?p:-p),_>0&&h.push(_-1,_);Dn(c,this._originSR,0,c,i.renderSpatialReference,0,l);const A=new Mo(this._material,[[B.POSITION,new Rt(c,3,!0)]],[[B.POSITION,h]],null,Xn.Line);s.add(A),o.addGeometry(A)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const Va=V();let sLe=class{constructor(e,r,i,s=null){this.rctx=e,this.sliceHelper=s,this.lastFrameCamera=new hr,this.output=ee.Color,this.renderOccludedMask=Lme,this.bindParameters=new t7(r,i,E(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=Lme}},$vt=class extends sLe{constructor(e,r,i,s,n){super(e,i,s,n),this.offscreenRenderingHelper=r,this.sliceHelper=n,this.time=0}};const Lme=xn.Occlude|xn.OccludeAndTransparent|xn.OccludeAndTransparentStencil;let QP=class extends hr{constructor(){super(...arguments),this._projectionMatrix=ot()}get projectionMatrix(){return this._projectionMatrix}};u([d()],QP.prototype,"_projectionMatrix",void 0),u([d({readOnly:!0})],QP.prototype,"projectionMatrix",null),QP=u([j("esri.views.3d.webgl-engine.lib.CascadeCamera")],QP);var AM;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(AM||(AM={}));let AN=class{constructor(){this.camera=new QP,this.lightMat=ot()}},Qne=class{get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return ns(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,r){this._rctx=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._projectionView=ot(),this._projectionViewInverse=ot(),this._modelViewLight=ot(),this._splitSchemeLambda=0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Zr(),this._cascades=[new AN,new AN,new AN,new AN],this._lastOrigin=null,this._maxTextureSize=Math.min(Le("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(e){this._maxNumCascades=ze(Math.floor(e),1,4)}get maxCascades(){return this._maxNumCascades}set enabled(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&E(this._depthTexture)}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)Bj[e]=this._cascades[e];return Bj.length=this._numCascades,Bj}start(e,r,i){Zt(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(i);this._computeCascadeDistances(n,s),this._setupMatrices(e,r);const{viewMatrix:o,projectionMatrix:a}=e;for(let l=0;l<this._numCascades;++l)this._constructCascade(l,a,o,r);this._lastOrigin=null,this.clear()}finish(e){Zt(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!Hc(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||V(),Oe(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){ju(Ume,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)Vme[16*r+i]=Ume[i]}}return Vme}takeCascadeSnapshotTo(e,r){Zt(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const s=this._rctx,n=s.bindTexture(i,Wt.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(nr.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),s.bindTexture(n,Wt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(qs.COLOR_BUFFER_BIT|qs.DEPTH_BUFFER_BIT)}_computeTextureSize(e,r){const i=.5*Math.log(e*e+r*r)*Math.LOG2E,s=.35,n=2**Math.round(i+s);return Math.min(this._maxTextureSize,2*n)}_ensureDepthTexture(){if(E(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const e={target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:Bt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new Wt(this._rctx,e),this._fbo=new Jn(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:$i.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(e){let r=this._snapshots[e];if(E(r)&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(e);const i={target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:Bt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return r=new Wt(this._rctx,i),this._snapshots[e]=r,r}_discardDepthTexture(){this._fbo=Nt(this._fbo),this._depthTexture=Nt(this._depthTexture)}_discardSnapshot(e){this._snapshots[e]=Nt(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,r,i,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);Zt(l<c);for(let _=0;_<8;++_){ns(Dme,_%4==0||_%4==3?-1:1,_%4==0||_%4==1?-1:1,_<4?l:c,1);const w=Rp[_];Ld(w,Dme,this._projectionViewInverse),w[0]/=w[3],w[1]/=w[3],w[2]/=w[3]}nc(kj,Rp[0]),n.camera.viewMatrix=ju(Lvt,this._modelViewLight,kj);for(let _=0;_<8;++_)Mt(Rp[_],Rp[_],n.camera.viewMatrix);let h=Rp[0][2],p=Rp[0][2];for(let _=1;_<8;++_)h=Math.min(h,Rp[_][2]),p=Math.max(p,Rp[_][2]);h-=200,p+=200,n.camera.near=-p,n.camera.far=-h,kvt(i,s,h,p,n.camera),$n(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const A=this._textureSize/2;n.camera.viewport=[e%2==0?0:A,Math.floor(e/2)===0?0:A,A,A]}_setupMatrices(e,r){$n(this._projectionView,e.projectionMatrix,e.viewMatrix),ul(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===_t.Global?e.eye:$e(kj,0,0,1);mU(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r){this._numCascades=Math.min(1+Math.floor(xdt(e/r,4)),this._maxNumCascades);const i=(e-r)/this._numCascades,s=(e/r)**(1/this._numCascades);let n=r,o=r;for(let a=0;a<this._numCascades+1;++a)this._cascadeDistances[a]=Sr(n,o,this._splitSchemeLambda),n*=s,o+=i}get gpuMemoryUsage(){var e;return this._snapshots.reduce((r,i)=>r+rT(i),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){const e=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(r){e._splitSchemeLambda=r},get splitSchemeLambda(){return e._splitSchemeLambda}}}};const Lvt=ot(),Dme=Zr(),Rp=[];for(let t=0;t<8;++t)Rp.push(Zr());const Nme=Dt(),Fme=Dt(),Dvt=Dt(),kme=Dt(),Bme=Dt(),kj=V(),Bj=[],Ume=ot(),Vme=new Float32Array(64),td=Dt(),fS=Dt(),uw=[Dt(),Dt(),Dt(),Dt()],ia=Dt(),Uj=Dt(),k_=Dt(),aO=Dt(),mS=Dt(),gS=Dt(),yN=Dt();function Nvt(t,e,r,i,s,n,o,a){Kr(td,0,0);for(let k=0;k<4;++k)l0(td,td,t[k]);Ch(td,td,.25),Kr(fS,0,0);for(let k=4;k<8;++k)l0(fS,fS,t[k]);Ch(fS,fS,.25),LE(uw[0],t[4],t[5],.5),LE(uw[1],t[5],t[6],.5),LE(uw[2],t[6],t[7],.5),LE(uw[3],t[7],t[4],.5);let l=0,c=h9(uw[0],td);for(let k=1;k<4;++k){const F=h9(uw[k],td);F<c&&(c=F,l=k)}ag(ia,uw[l],t[l+4]);const h=ia[0];let p,A;ia[0]=-ia[1],ia[1]=h,ag(Uj,fS,td),Uo(Uj,ia)<0&&cse(ia,ia),LE(ia,ia,Uj,r),g4(ia,ia),p=A=Uo(ag(k_,t[0],td),ia);for(let k=1;k<8;++k){const F=Uo(ag(k_,t[k],td),ia);F<p?p=F:F>A&&(A=F)}ga(i,td),Ch(k_,ia,p-e),l0(i,i,k_);let _=-1,w=1,T=0,C=0;for(let k=0;k<8;++k){ag(aO,t[k],i),g4(aO,aO);const F=ia[0]*aO[1]-ia[1]*aO[0];F>0?F>_&&(_=F,T=k):F<w&&(w=F,C=k)}ZT(_>0,"leftArea"),ZT(w<0,"rightArea"),Ch(mS,ia,p),l0(mS,mS,td),Ch(gS,ia,A),l0(gS,gS,td),yN[0]=-ia[1],yN[1]=ia[0];const M=O5(i,t[C],gS,l0(k_,gS,yN),1,s),O=O5(i,t[T],gS,k_,1,n),$=O5(i,t[T],mS,l0(k_,mS,yN),1,o),L=O5(i,t[C],mS,k_,1,a);ZT(M,"rayRay"),ZT(O,"rayRay"),ZT($,"rayRay"),ZT(L,"rayRay")}function Ri(t,e){return 3*e+t}const zme=Dt();function Zu(t,e){return Kr(zme,t[e],t[e+3]),zme}const hu=Dt(),Vt=mn();function Fvt(t,e,r,i,s){ag(hu,r,i),Ch(hu,hu,.5),Vt[0]=hu[0],Vt[1]=hu[1],Vt[2]=0,Vt[3]=hu[1],Vt[4]=-hu[0],Vt[5]=0,Vt[6]=hu[0]*hu[0]+hu[1]*hu[1],Vt[7]=hu[0]*hu[1]-hu[1]*hu[0],Vt[8]=1,Vt[Ri(0,2)]=-Uo(Zu(Vt,0),t),Vt[Ri(1,2)]=-Uo(Zu(Vt,1),t);let n=Uo(Zu(Vt,0),r)+Vt[Ri(0,2)],o=Uo(Zu(Vt,1),r)+Vt[Ri(1,2)],a=Uo(Zu(Vt,0),i)+Vt[Ri(0,2)],l=Uo(Zu(Vt,1),i)+Vt[Ri(1,2)];n=-(n+a)/(o+l),Vt[Ri(0,0)]+=Vt[Ri(1,0)]*n,Vt[Ri(0,1)]+=Vt[Ri(1,1)]*n,Vt[Ri(0,2)]+=Vt[Ri(1,2)]*n,n=1/(Uo(Zu(Vt,0),r)+Vt[Ri(0,2)]),o=1/(Uo(Zu(Vt,1),r)+Vt[Ri(1,2)]),Vt[Ri(0,0)]*=n,Vt[Ri(0,1)]*=n,Vt[Ri(0,2)]*=n,Vt[Ri(1,0)]*=o,Vt[Ri(1,1)]*=o,Vt[Ri(1,2)]*=o,Vt[Ri(2,0)]=Vt[Ri(1,0)],Vt[Ri(2,1)]=Vt[Ri(1,1)],Vt[Ri(2,2)]=Vt[Ri(1,2)],Vt[Ri(1,2)]+=1,n=Uo(Zu(Vt,1),e)+Vt[Ri(1,2)],o=Uo(Zu(Vt,2),e)+Vt[Ri(2,2)],a=Uo(Zu(Vt,1),r)+Vt[Ri(1,2)],l=Uo(Zu(Vt,2),r)+Vt[Ri(2,2)],n=-.5*(n/o+a/l),Vt[Ri(1,0)]+=Vt[Ri(2,0)]*n,Vt[Ri(1,1)]+=Vt[Ri(2,1)]*n,Vt[Ri(1,2)]+=Vt[Ri(2,2)]*n,n=Uo(Zu(Vt,1),e)+Vt[Ri(1,2)],o=Uo(Zu(Vt,2),e)+Vt[Ri(2,2)],a=-o/n,Vt[Ri(1,0)]*=a,Vt[Ri(1,1)]*=a,Vt[Ri(1,2)]*=a,s[0]=Vt[0],s[1]=Vt[1],s[2]=0,s[3]=Vt[2],s[4]=Vt[3],s[5]=Vt[4],s[6]=0,s[7]=Vt[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Vt[6],s[13]=Vt[7],s[14]=0,s[15]=Vt[8]}function kvt(t,e,r,i,s){const n=1/Rp[0][3],o=1/Rp[4][3];Zt(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(Zo(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,Nvt(Rp,a,l,Nme,Fme,Dvt,kme,Bme),Fvt(Nme,Fme,kme,Bme,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function Bvt(t){return J0(t)&&t.intersector===pn.TERRAIN&&!!t.target}let Uvt=class extends u7{constructor(e,r,i){super(e,r),this.triangleNr=i}};function nLe(t){return J0(t)&&t.intersector===pn.OVERLAY&&!!t.target}let aK=class{constructor(){this.adds=new Vr,this.removes=new Vr,this.updates=new Vr({allocator:e=>e||new Vvt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},Vvt=class{},zvt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var wn,la;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(wn||(wn={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(la||(la={}));function oLe(t){const e=new Map,r=i=>{let s=e.get(i);return s||(s=new zvt,e.set(i,s)),s};return t.removes.forAll(i=>{Vj(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{Vj(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{Vj(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function Vj(t){return t.geometry.indexCount>=1}let Gvt=class{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createProgram()}_createProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,r=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,r,new Map([]))}_createIndexbuffer(){return Wi.createIndex(this._rctx,Li.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,fr.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Ar.POINTS,1,qt.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},aLe=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}destroy(){this._map.forEach((e,r)=>{E(e)&&this._repository.release(this._material,r)})}load(e,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(E(s)){if(s.ensureResources(e)===vy.LOADED)return s;this._repository.requestRender()}return null}};function jvt(t){const e=I`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;t.vertex.code.add(e)}function XL(t,e){switch(e.normalType){case cs.CompressedAttribute:t.include(jvt),t.attributes.add(B.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(I`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`);break;case cs.Attribute:t.attributes.add(B.NORMAL,"vec3"),t.vertex.code.add(I`vec3 normalModel() {
return normal;
}`);break;case cs.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(I`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case cs.COUNT:case cs.Ground:}}var cs;(function(t){t[t.Attribute=0]="Attribute",t[t.CompressedAttribute=1]="CompressedAttribute",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(cs||(cs={}));function $7(t,e){switch(e.normalType){case cs.Attribute:case cs.CompressedAttribute:t.include(XL,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add([new _4("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new Xg("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)]),t.vertex.code.add(I`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case cs.Ground:t.include(r3,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(I`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?I`normalize(vPositionWorldCameraRelative);`:I`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case cs.ScreenDerivative:t.vertex.code.add(I`void forwardNormal() {}`);break;default:e.normalType;case cs.COUNT:}}let lLe=class extends ZOe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=mn()}},cLe=class extends JOe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=mn(),this.toMapSpace=Zr()}},lK=class extends cLe{constructor(e=V()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},sR=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(B.POSITION).length}write(e,r,i,s,n){b$e(i,this.vertexBufferLayout,e,r,s,n)}};const Hvt=gn().vec3f(B.POSITION),qvt=gn().vec3f(B.POSITION).vec2f(B.UV0),uLe=gn().vec3f(B.POSITION).vec4u8(B.COLOR);gn().vec3f(B.POSITION).vec4u8(B.OBJECTANDLAYERIDCOLOR);gn().vec3f(B.POSITION).vec2f(B.UV0).vec4u8(B.OBJECTANDLAYERIDCOLOR);const Wvt=gn().vec3f(B.POSITION).vec4u8(B.COLOR).vec4u8(B.OBJECTANDLAYERIDCOLOR);let Xne=class extends Pb{intersect(e,r,i,s,n,o){return u$e(e,i,s,n,void 0,o)}};function Yvt(t){t.fragment.code.add(I`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Qvt(t){t.fragment.code.add(I`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function Gme(t){t.fragment.uniforms.add(new mr("texWaveNormal",e=>e.waveNormal)),t.fragment.uniforms.add(new mr("texWavePerturbation",e=>e.wavePertubation)),t.fragment.uniforms.add([new hi("waveParams",e=>ns(Xvt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Bi("waveDirection",e=>Kr(Zvt,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))]),t.include(Yvt),t.fragment.code.add(I`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const Xvt=Zr(),Zvt=Dt();function N4(t,e){e.spherical?t.vertex.code.add(I`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(I`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(I`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(I`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}let ZL=class extends kn{constructor(e,r){super(e,"int",As.Pass,(i,s,n)=>i.setUniform1i(e,r(s,n)))}},Jvt=class extends kn{constructor(e,r,i){super(e,"mat4",As.Draw,(s,n,o)=>s.setUniformMatrix4fv(e,r(n,o)),i)}},Kvt=class extends kn{constructor(e,r,i){super(e,"mat4",As.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,r(n,o)),i)}},hLe=class extends ys{constructor(){super(...arguments),this.origin=V()}};function L7(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Kvt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),dLe(t,e))}function uT(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Jvt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),dLe(t,e))}function dLe(t,e){const r=t.fragment;r.include(qh),r.uniforms.add([...$0("shadowMapTex",(i,s)=>s.shadowMap.depthTexture,e.hasWebGL2Context?is.None:is.Size),new ZL("numCascades",(i,s)=>s.shadowMap.numCascades),new hi("cascadeDistances",(i,s)=>s.shadowMap.cascadeDistances)]),r.code.add(I`
    int chooseCascade(float depth, out mat4 mat) {
      vec4 distance = cascadeDistances;

      // choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float textureSize, sampler2D _depthTex) {
      float halfPixelSize = 0.5 / textureSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * textureSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= numCascades) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      vec2 textureSize = ${Qp(e,"shadowMapTex")};

      return filterShadow(uv, lvpos, textureSize.x, shadowMapTex);
    }
  `)}function ebt(t){const e=t.fragment.code;e.add(I`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(I`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(I`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function Zne(t,e){const r=t.fragment.code;t.include(FL),e.pbrMode!==Qt.Normal&&e.pbrMode!==Qt.Schematic&&e.pbrMode!==Qt.Terrain&&e.pbrMode!==Qt.TerrainWithWater||(r.add(I`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(I`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==Qt.Normal&&e.pbrMode!==Qt.Schematic||(t.include(ebt),r.add(I`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(I`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(I`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(I`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function tbt(t,e){const r=t.fragment.code;t.include(FL),r.add(I`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(I`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(I`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(I`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(I`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function pLe(t,e){t.include(tbt,e),t.include(ZU),t.include(Qvt),e.hasCloudsReflections&&t.include(TOe,e),e.hasScreenSpaceReflections&&t.include(Dht,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(I`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add([new nt("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new nt("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)]),r.code.add(I`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(I`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add([new nn("view",(i,s)=>s.ssr.camera.viewMatrix),new mr("lastFrameColorTexture",(i,s)=>s.ssr.lastFrameColorTexture),new nt("fadeFactor",(i,s)=>s.ssr.fadeFactor)]),r.code.add(I`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactor;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(I`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(I`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(I`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(I`return waterRenderedColor;
}`)}function rbt(t){const e=new Di,{vertex:r,fragment:i}=e;Uh(r,t),e.include(Fu,t),e.attributes.add(B.POSITION,"vec3"),e.attributes.add(B.UV0,"vec2");const s=new hi("waterColor",n=>n.color);if(t.output===ee.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(I`
        void main(void) {
          if (waterColor.a < ${I.float(Il)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(s),i.code.add(I`void main() {
gl_FragColor = waterColor;
}`),e;switch(t.output!==ee.Color&&t.output!==ee.Alpha||(e.include(N4,t),e.include(XM,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.uniforms.add(s),r.code.add(I`
      void main(void) {
        if (waterColor.a < ${I.float(Il)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===ee.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Yd,t),t.output){case ee.Alpha:e.include(ho,t),i.uniforms.add(s),i.code.add(I`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case ee.Color:e.include(d9,t),e.include(vse,{pbrMode:Qt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(Gme),e.include(ho,t),e.include(uT,t),e.include(pLe,t),i.uniforms.add([s,new nt("timeElapsed",n=>n.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")]),W0(i,t),i.include(Qg),Ky(i),Yg(i),i.code.add(I`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?I`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${t.transparencyPassType===lr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case ee.Normal:e.include(N4,t),e.include(Gme,t),e.include(ho,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(s),r.code.add(I`
        void main(void) {
          if (waterColor.a < ${I.float(Il)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new nt("timeElapsed",n=>n.timeElapsed)),i.code.add(I`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case ee.Highlight:e.include(a_,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(I`
      void main(void) {
        if (waterColor.a < ${I.float(Il)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(ho,t),i.code.add(I`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const ibt=Object.freeze(Object.defineProperty({__proto__:null,build:rbt},Symbol.toStringTag,{value:"Module"}));let fLe=class mLe extends Vi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2,r.spherical=e.viewingMode===_t.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Fi(e.rctx,mLe.shader.get().build(this.configuration),Pi)}_setPipelineState(e){const r=this.configuration,i=e===lr.NONE,s=e===lr.FrontFace;return Rr({blending:r.output!==ee.Normal&&r.output!==ee.Highlight&&r.transparent?i?zd:l_(e):null,depthTest:{func:Ib(e)},depthWrite:i?r.writeDepth?qu:null:S7(e),colorWrite:zr,polygonOffset:i||s?null:M7(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};fLe.shader=new Ni(ibt,()=>be(()=>import("./WaterSurface.glsl-881603cc.js"),[]));let Ja=class extends $a{constructor(){super(...arguments),this.output=ee.Color,this.transparencyPassType=lr.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([ie({count:ee.COUNT})],Ja.prototype,"output",void 0),u([ie({count:lr.COUNT})],Ja.prototype,"transparencyPassType",void 0),u([ie()],Ja.prototype,"spherical",void 0),u([ie()],Ja.prototype,"receiveShadows",void 0),u([ie()],Ja.prototype,"hasSlicePlane",void 0),u([ie()],Ja.prototype,"transparent",void 0),u([ie()],Ja.prototype,"enableOffset",void 0),u([ie()],Ja.prototype,"writeDepth",void 0),u([ie()],Ja.prototype,"hasScreenSpaceReflections",void 0),u([ie()],Ja.prototype,"doublePrecisionRequiresObfuscation",void 0),u([ie()],Ja.prototype,"hasCloudsReflections",void 0),u([ie()],Ja.prototype,"isDraped",void 0),u([ie()],Ja.prototype,"hasMultipassTerrain",void 0),u([ie()],Ja.prototype,"cullAboveGround",void 0),u([ie({constValue:Qt.Water})],Ja.prototype,"pbrMode",void 0),u([ie({constValue:!0})],Ja.prototype,"useCustomDTRExponentForWater",void 0),u([ie({constValue:!0})],Ja.prototype,"highStepCount",void 0),u([ie({constValue:!1})],Ja.prototype,"useFillLights",void 0);let sbt=class extends Ob{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const r=E(e.cloudsFade.data);r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===ee.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(fLe,e)}},gLe=class extends Xne{constructor(e){super(e,new ALe),this._configuration=new Ja,this.animation=new EPe}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<E7,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<nbt;const i=this.animation.advance(e);return this.setParameters({timeElapsed:ate(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(e,r){switch(r){case ee.Normal:return e===et.DRAPED_WATER;case ee.Color:if(this.parameters.isDraped)return e===et.DRAPED_MATERIAL;break;case ee.Alpha:break;case ee.Highlight:return e===et.OPAQUE_MATERIAL||e===et.DRAPED_MATERIAL;default:return!1}let i=et.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?et.TRANSPARENT_MATERIAL:et.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new sbt(e)}createBufferWriter(){return new sR(qvt)}},ALe=class extends rR{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=ki(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Nr(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}};const nbt=35e3;let Jne=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function jme(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;)r=!1,t.forEach(i=>{const s=e.get(i.to);s&&(i.to=s.to,e.delete(s.from),t.removeUnordered(s),r=!0)})}let Hme=class extends Jne{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return E(this.geometry.highlights)&&this.isVisible}get hasOccludees(){return E(this.geometry.occludees)}},obt=class{constructor(){this.first=0,this.count=0}},abt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Vr({allocator:e=>e||new Jne,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=_N(),this.drawCommandsHighlight=_N(),this.drawCommandsOccludees=_N(),this.drawCommandsShadowHighlightRest=_N()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=r,s.to=i,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),s=this.holes.front();return E(this.vao)&&this.holes.length===1&&s.to===Math.floor(this.vao.size/e)?(i.first=0,void(i.count=s.from)):(i.first=1/0,i.count=0,this._instances.forEach(n=>{i.first=Math.min(i.first,n.from),i.count=Math.max(i.count,n.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,s)=>i.from===s.from?i.to-s.to:i.from-s.from);for(const i of r)i.isVisible&&(qme(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),qme(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function lbt(t){return E(t.vao)}function _N(){return new Vr({allocator:t=>t||new obt,deallocator:t=>t})}function qme(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(cbt(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function cbt(t,e){return t.first+t.count>=e.from}let ubt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const hbt=y6+1;let dbt=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=e.newCache(`VaoCache ${kh()}`,pbt)}dispose(){this._cache.destroy()}newVao(e){const r=e.toString(),i=this._cache.pop(r);if(E(i)){const n=i.pop();return i.length>0&&this._cache.put(r,i,e*i.length,hbt),n}const s=new Z0(this._rctx,this._locations,{geometry:this._layout},{geometry:Wi.createVertex(this._rctx,Li.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(e),s}deleteVao(e){if(N(e))return null;const r=e.size,i=r.toString(),s=this._cache.pop(i);return E(s)?(s.push(e),this._cache.put(i,s,r*s.length,-1)):this._cache.put(i,[e],r,-1),null}};function pbt(t,e){if(e===ty.ALL)return void t.forEach(s=>s.dispose());const r=t.pop(),i=t.length*r.size;return r.dispose(),i}let yLe=class{constructor(e,r,i){this._rctx=e,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new aLe(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new dbt(e,i.vertexAttributeLocations,Wh(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new Gvt(this._rctx))}dispose(){var e;this._glMaterials.destroy(),this._dataByOrigin.forEach(r=>r.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof gLe}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==xn.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,s)=>i+s.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){var s;const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const n of e){const o=n.renderGeometry,a=(s=this._dataByOrigin.get(o.localOrigin.id))==null?void 0:s.findBuffer(o.id);if(N(a))return;const l=a.instances.get(o.id);if(n.updateType&(la.GEOMETRY|la.TRANSFORMATION)){const c=xN(r.elementCount(l.geometry.geometry)*i),h=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(o,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i)}n.updateType&(la.HIGHLIGHT|la.OCCLUDEE|la.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){var s;const i=new ZM;for(const n of e){const o=n.localOrigin;if(N(o))continue;let a=i.get(o.id,null);N(a)&&(a=new Wme(o.vec3),i.set(o.id,null,a)),a.changes.push(n)}for(const n of r){const o=n.localOrigin;if(N(o))continue;const a=(s=this._dataByOrigin.get(o.id))==null?void 0:s.findBuffer(n.id);if(N(a))continue;let l=i.get(o.id,a);N(l)&&(l=new Wme(o.vec3),i.set(o.id,a,l)),l.changes.push(n)}return i}_addAndRemoveGeometries(e,r){const{_bufferWriter:i,_dataByOrigin:s}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),h=E(c)?c.changes:[];o.delete(l,null);let p=s.get(l);if(a.forEach((A,_)=>{if(o.delete(l,_),N(_))return void Zt(!1,"No VAO for removed geometries");if(_.instances.size===A.changes.length)return this._vaoCache.deleteVao(_.vao),I$(p.buffers,_),void(p.buffers.length===0&&h.length===0&&s.delete(l));const w=_.numElements,T=_.vao.size/4,C=h.reduce((L,k)=>L+i.elementCount(k.geometry),0),M=A.changes.reduce((L,k)=>L+i.elementCount(k.geometry),0),O=Math.min((w+C-M)*n,wN),$=O>T;O>Q9&&O<T/2?(A.changes.forEach(({id:L})=>_.deleteInstance(L)),_.instances.forEach(({geometry:L})=>h.push(L)),this._vaoCache.deleteVao(_.vao),I$(p.buffers,_)):$?this._applyAndRebuild(_,h,A):this._applyRemoves(_,A)}),h.length>0)for(N(p)&&(p=new ubt(c.origin),s.set(l,p)),p.buffers.forEach(A=>this._applyAdds(A,h));h.length>0;)p.buffers.push(this._applyAndRebuild(new abt,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,Ml(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(E(i))for(const w of i.changes)e.deleteInstance(w.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(wN/o);let l=e.numElements;for(;r.length>0;){const w=r.pop(),T=s.elementCount(w.geometry);if(l+T>a&&l>0){r.push(w);break}l+=T;const C=new Hme(w,0,0);Zt(e.instances.get(w.id)==null),e.addInstance(w.id,C)}const c=l*o,h=xN(c),p=s.vertexBufferLayout.createView(h.buffer);let A=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((w,T)=>{this._writeGeometry(w.geometry,p,A);const C=A;A+=s.elementCount(w.geometry.geometry),e.updateInstance(T,C,A),e.updateDrawState(w)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Qme(c)),e.vao.vertexBuffers.geometry.setSubData(h,0,0,A*o),e.holes.clear();const _=e.holes.pushNew();return _.from=A,_.to=Math.floor(e.vao.size/n),e.updateDrawCommands(n),e}_applyRemoves(e,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=dm.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const p=dm.pushNew();p.from=c.from,p.to=c.to}jme(dm);const i=this._bufferWriter.vertexBufferLayout.stride/4,s=dm.reduce((a,l)=>Math.max(a,l.numElements),0)*i,n=xN(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;dm.forAll(a=>o.setSubData(n,a.from*i,0,a.numElements*i)),e.holes.pushArray(dm.data,dm.length),dm.forAll((a,l)=>dm.data[l]=null),dm.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0)return;if(!lbt(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=e.numElements,o=r.reduce((M,O)=>M+i.elementCount(O.geometry),0),a=Math.min((n+o)*s,wN),l=4*a;if(e.vao.size<Qme(wN-Q9)&&l>e.vao.size)return void this._applyAndRebuild(e,r,null);jme(e.holes);const c=new Array;for(const M of r){const O=i.elementCount(M.geometry),$=fbt(e.holes,O);c.push($)}const h=e.vao.vertexBuffers.geometry;let p=0,A=0,_=0;const w=xN(a),T=i.vertexBufferLayout.createView(w.buffer);r.forEach((M,O)=>{const $=c[O];if(N($))return;if(_!==$){const F=_-A;F>0&&h.setSubData(w,A*s,0,F*s),A=$,p=0}const L=i.elementCount(M.geometry);this._writeGeometry(M,T,p),p+=L,_=$+L;const k=new Hme(M,$,$+L);Zt(e.instances.get(M.id)==null),e.addInstance(M.id,k),e.drawCommandsDirty=!0});const C=_-A;C>0&&h.setSubData(w,A*s,0,C*s),Y9e(r,(M,O)=>N(c[O]))}_writeGeometry(e,r,i){const s=e.localOrigin.vec3;Tdt(Yme,-s[0],-s[1],-s[2]);const n=$n(mbt,Yme,e.transformation);ul(vN,n),zh(vN,vN),this._bufferWriter.write(n,vN,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,r){return this.material.requiresSlot(e,r)}render(e,r){var c;if(!this.requiresSlot(r.slot,e))return!1;const i=e===ee.Highlight||e===ee.ShadowHighlight;if(i&&!this._hasHighlights)return!1;const s=e===ee.ShadowExcludeHighlight,n=!(i||s),o=this._rctx;let a;const l=()=>{if(E(a))return a;const h=this._glMaterials.load(o,r.slot,e);return N(h)?null:(a=h.beginSlot(r),N(a)?null:(o.bindTechnique(a,this.material.parameters,r),a))};(c=this._appleAmdDriverHelper)==null||c.resetIndicesType();for(const h of this._dataByOrigin.values())for(const p of h.buffers){if(i&&!p.hasHighlights)continue;const A=(i?p.drawCommandsHighlight:s&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,_=n&&p.drawCommandsOccludees||null;if(A!=null&&A.length||_!=null&&_.length){const w=l();if(N(w))return!1;w.program.bindDraw(new lK(h.origin),r,this.material.parameters),w.ensureAttributeLocations(p.vao),o.bindVAO(p.vao),A!=null&&A.length&&(w.bindPipelineState(o,r.slot,!1),A.forAll(T=>o.drawArrays(w.primitiveType,T.first,T.count))),_!=null&&_.length&&(w.bindPipelineState(o,r.slot,!0),_.forAll(T=>o.drawArrays(w.primitiveType,T.first,T.count)))}}return E(a)}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},Wme=class{constructor(e){this.origin=e,this.changes=new Array}};function fbt(t,e){let r;if(!t.some(s=>!(s.numElements<e)&&(r=s,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const Yme=ot(),mbt=ot(),vN=ot(),dm=new Vr({allocator:t=>t||new Jne,deallocator:null}),Q9=65536,bN=4*Q9,_Le=16777216,wN=_Le/4;let zj=new Float32Array(Q9);function xN(t){return zj.length<t&&(zj=new Float32Array(t)),zj}function Qme(t){const e=4*t;return e<bN?bN:Math.max(Math.min(Math.ceil(1.5*e/bN)*bN,_Le),e)}let pd=class extends Ke{constructor(e){super(e),this._pending=new gbt,this._changes=new aK,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Vr,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Ml(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=oLe(this._changes);let r=!1,i=!1,s=!1;return e.forEach((n,o)=>{let a=this._materialRenderers.get(o);if(!a&&n.adds.length>0&&(a=new yLe(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),r=!0,i=!0,s=!0),!a)return;const l=i||a.hasHighlights,c=s||a.hasWater;a.modify(n),i=i||l!==a.hasHighlights,s=s||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),r=!0)}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Ml(this._materialRenderers,n=>n.hasHighlights)),s&&(this._hasWater=Ml(this._materialRenderers,n=>n.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const n of i)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of i)this._pending.adds.add(n);s&&this.notifyChange("updating"),r===wn.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===wn.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case la.TRANSFORMATION:case la.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case la.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=i.updateAnimation(e)||r),r}render(e){this._sortedMaterialRenderers.forAll(r=>{r.material.shouldRender(e)&&r.render(e.output,e.bindParameters)})}intersect(e,r,i,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,i,r,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((r,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push(r)}),this._sortedMaterialRenderers.sort((r,i)=>{const s=i.material.renderPriority-r.material.renderPriority;return s!==0?s:r.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],Gj[0]=i[0]-s,Gj[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,Gj,(l,c,h)=>{Abt(r,h,e.material.renderPriority,o,n,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(N(this.drapeSource.notifyGraphicGeometryChanged))return;let r;for(const i of e){const s=i.graphicUid;E(s)&&s!==r&&(this.drapeSource.notifyGraphicGeometryChanged(s),r=s)}}_notifyGraphicVisibilityChanged(e){if(N(this.drapeSource.notifyGraphicVisibilityChanged))return;let r;for(const i of e){const s=i.graphicUid;E(s)&&s!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(s),r=s)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return N(e.localOrigin)&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],pd.prototype,"drapeSource",void 0),u([d()],pd.prototype,"updating",null),u([d()],pd.prototype,"rctx",null),u([d()],pd.prototype,"rendererContext",void 0),u([d()],pd.prototype,"_materialRepository",null),u([d()],pd.prototype,"_localOriginFactory",null),u([d({readOnly:!0})],pd.prototype,"isEmpty",null),u([d()],pd.prototype,"_materialRenderers",void 0),u([d()],pd.prototype,"_geometries",void 0),pd=u([j("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],pd);let gbt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function Abt(t,e,r,i,s,n,o){const a=new Uvt(n,o,e),l=c=>{c.set(pn.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==dl.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===dl.ALL){const c=Zse(s.ray);l(c),s.results.all.push(c)}}const Gj=Dt(),jj=4;function ybt(){const t=new Di,e=t.fragment;t.include(Af);const r=(jj+1)/2,i=1/(2*r*r);return e.include(Wd),e.uniforms.add([new mr("depthMap",s=>s.depthTexture),new NL("tex",s=>s.colorTexture),new y4("blurSize",s=>s.blurSize),new nt("projScale",(s,n)=>{const o=Is(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new Bi("nearFar",(s,n)=>n.camera.nearFar)]),e.code.add(I`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture2D(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${I.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(I`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${I.int(jj)}; r <= ${I.int(jj)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      gl_FragColor = vec4(b / w_total);
    }
  `),t}const _bt=Object.freeze(Object.defineProperty({__proto__:null,build:ybt},Symbol.toStringTag,{value:"Module"}));let vLe=class bLe extends Vi{initializeProgram(e){return new Fi(e.rctx,bLe.shader.get().build(),Pi)}initializePipeline(){return Rr({colorWrite:zr})}};vLe.shader=new Ni(_bt,()=>be(()=>import("./SSAOBlur.glsl-b888d0b5.js"),[]));const vbt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function D7(t){t.fragment.uniforms.add(new hi("projInfo",(e,r)=>bbt(r))),t.fragment.uniforms.add(new Bi("zScale",(e,r)=>wLe(r))),t.fragment.code.add(I`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function bbt(t){const e=t.camera.projectionMatrix;return e[11]===0?ns(Xme,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):ns(Xme,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const Xme=Zr();function wLe(t){return t.camera.projectionMatrix[11]===0?Kr(Zme,0,1):Kr(Zme,1,0)}const Zme=Dt(),Jme=16;function wbt(){const t=new Di,e=t.fragment;return t.include(Af),e.include(Wd),t.include(D7),e.uniforms.add(new nt("radius",(r,i)=>Kne(i.camera))),e.code.add(I`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),e.code.add(I`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add([new Bi("nearFar",(r,i)=>i.camera.nearFar),new mr("normalMap",r=>r.normalTexture),new mr("depthMap",r=>r.depthTexture),new Bi("zScale",(r,i)=>wLe(i)),new nt("projScale",r=>r.projScale),new mr("rnm",r=>r.noiseTexture),new Bi("rnmScale",(r,i)=>Kr(Kme,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new nt("intensity",r=>r.intensity),new Bi("screenSize",(r,i)=>Kr(Kme,i.camera.fullWidth,i.camera.fullHeight))]),e.code.add(I`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        gl_FragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture2D(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${I.int(Jme)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${I.int(Jme)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      gl_FragColor = vec4(A);
    }
  `),t}function Kne(t){return Math.max(10,20*t.computeRenderPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Kme=Dt(),xbt=Object.freeze(Object.defineProperty({__proto__:null,build:wbt,getRadius:Kne},Symbol.toStringTag,{value:"Module"}));let xLe=class TLe extends Vi{initializeProgram(e){return new Fi(e.rctx,TLe.shader.get().build(),Pi)}initializePipeline(){return Rr({colorWrite:zr})}};xLe.shader=new Ni(xbt,()=>be(()=>import("./SSAO.glsl-5478455f.js"),[]));let Tbt=class extends ys{constructor(){super(...arguments),this.projScale=1}},Sbt=class extends Tbt{constructor(){super(...arguments),this.intensity=1}},Ebt=class extends ys{},Cbt=class extends Ebt{constructor(){super(...arguments),this.blurSize=Dt()}};const XP=2;let SLe=class{constructor(e,r,i,s){this._view=e,this._techniqueRepository=r,this._rctx=i,this._requestRender=s,this._quadVAO=null,this._passParameters=new Sbt,this._drawParameters=new Cbt}dispose(){this.enabled=!1,this._quadVAO=Nt(this._quadVAO)}disposeOffscreenBuffers(){ka(this._ssaoFBO,e=>e.resize(0,0)),ka(this._blur0FBO,e=>e.resize(0,0)),ka(this._blur1FBO,e=>e.resize(0,0))}set enabled(e){e?this._enable():this._disable()}get enabled(){return E(this._enableTime)}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return E(this._blur1FBO)?this._blur1FBO.colorTexture:null}render(e,r,i,s){if(N(this._enableTime)||N(i)||N(s)||N(this._ssaoFBO)||N(this._blur0FBO)||N(this._blur1FBO))return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const n=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=s,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*Mbt/Kne(o)**6*l;const c=o.fullViewport,h=c[2],p=c[3],A=h/XP,_=p/XP;this._ssaoFBO.resize(h,p),this._blur0FBO.resize(A,_),this._blur1FBO.resize(A,_),N(this._quadVAO)&&(this._quadVAO=mc(this._rctx)),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,p),n.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),n.bindVAO(this._quadVAO);const w=Ol(this._quadVAO,"geometry");n.drawArrays(Ar.TRIANGLE_STRIP,0,w);const T=n.bindTechnique(this._blurTechnique,this._passParameters,e);n.setViewport(0,0,A,_),n.bindFramebuffer(this._blur0FBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,Kr(this._drawParameters.blurSize,0,XP/p),T.bindDraw(this._drawParameters,e,this._passParameters),n.setViewport(0,0,A,_),n.drawArrays(Ar.TRIANGLE_STRIP,0,w),n.bindFramebuffer(this._blur1FBO),this._drawParameters.colorTexture=this._blur0FBO.colorTexture,Kr(this._drawParameters.blurSize,XP/h,0),T.bindDraw(this._drawParameters,e,this._passParameters),n.drawArrays(Ar.TRIANGLE_STRIP,0,w),n.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(E(this._enableTime))return;const e={target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.LINEAR,wrapMode:pr.CLAMP_TO_EDGE,width:0,height:0},r={colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE};this._ssaoFBO=new Jn(this._rctx,r,e),this._blur0FBO=new Jn(this._rctx,r,e),this._blur1FBO=new Jn(this._rctx,r,e);const i=Uint8Array.from(atob(vbt),s=>s.charCodeAt(0));this._passParameters.noiseTexture=new Wt(this._rctx,{target:nr.TEXTURE_2D,pixelFormat:At.RGB,dataType:yr.UNSIGNED_BYTE,hasMipmap:!0,width:32,height:32},i),N(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(xLe)),N(this._blurTechnique)&&(this._blurTechnique=this._techniqueRepository.acquire(vLe)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=Nt(this._passParameters.noiseTexture),this._blur1FBO=Nt(this._blur1FBO),this._blur0FBO=Nt(this._blur0FBO),this._ssaoFBO=Nt(this._ssaoFBO)}get gpuMemoryUsage(){return(E(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(E(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(E(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}};const Mbt=.5;let eoe=class ELe extends Vi{initializeProgram(e){return new Fi(e.rctx,ELe.shader.get().build(),Pi)}initializePipeline(){return this.configuration.hasAlpha?Rr({blending:Aa(tt.SRC_ALPHA,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),colorWrite:zr}):Rr({colorWrite:zr})}};eoe.shader=new Ni(tyt,()=>be(()=>import("./TextureOnly.glsl-6dfc1834.js"),[]));let toe=class extends fc{constructor(){super(...arguments),this.hasAlpha=!1}};u([ie()],toe.prototype,"hasAlpha",void 0);let Qf=class extends Ke{get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new ts,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Vr,this._passParameters=new Cne,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new hr,this.worldToPCSRatio=1,this.events=new Nn,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const r=e.waterTextureRepository;this._stippleTextureRepository=new G4e(e.renderingContext),this._shaderTechniqueRepository=new F4e({rctx:this._rctx,viewingMode:_t.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:r}),this._renderContext=new sLe(this._rctx,new Qne(this._rctx,this.view.state.viewingMode),new SLe(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([xe(()=>r.updating,()=>this.events.emit("content-changed"),ao),xe(()=>this.spatialReference,i=>this._localOriginFactory=new Yne(i),ao),Co(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new k4e(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&X9)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=et.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=gOe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=lr.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Mse(ct(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(ir.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=en(this._debugTextureTechnique),this._passParameters.texture=Nt(this._passParameters.texture),this._bindParameters.highlightDepthTexture=Nt(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=gt(this._shaderTechniqueRepository),this._temporaryFBO=Nt(this._temporaryFBO),this._quadVAO=Nt(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||Ml(this._renderers,e=>e.updating)}get hasOverlays(){return E(this._overlays)&&E(this._overlayRenderTarget)}get gpuMemoryUsage(){return E(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,pd)}createDrapeSourceRenderer(e,r,i){const s=this._renderers.get(e);E(s)&&s.destroy();const n=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(xe(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(N(e))return;const r=this._renderers.get(e);N(r)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),r.destroy())}collectUnusedRenderTargetMemory(e){let r=!1;if(E(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const[s,n]=this.overlays,o=s.validTargets[i.type]||!n.validTargets[i.type];r=this._overlayRenderTarget.validateUsageForTarget(o,i,e)||r}return r}get overlays(){return gr(this._overlays,[])}ensureDrapeTargets(e){E(this._overlays)&&this._overlays.forEach(r=>r.hasTargetWithoutRasterImage=BF(e,i=>i.drapeTargetType===iK.WithoutRasterImage))}ensureDrapeSources(e){E(this._overlays)&&this._overlays.forEach(r=>{r.hasDrapedFeatureSource=BF(e,i=>i.drapeSourceType===r$.Features),r.hasDrapedRasterSource=BF(e,i=>i.drapeSourceType===r$.RasterImage)})}ensureOverlays(e,r){N(this._overlays)&&(this._overlayRenderTarget=new X1t(this._rctx),this._overlays=[new Tme(dn.INNER,this._overlayRenderTarget),new Tme(dn.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Nt(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||r(s))&&n.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(E(this._overlays)&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(jc,e=>e.updatePolicy===jv.SYNC)}get isEmpty(){return!Qi.OVERLAY_DRAW_DEBUG_TEXTURE&&!Ml(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,r,i){const s=e.canvasGeometries;if(s.numViews===0)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const n=r.output;if(this.isEmpty||n===ee.Highlight&&!this.hasHighlights||n===ee.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const o=r.fbo;if(!o.isValid())return!1;const a=2*e.resolution,l=e.resolution;o.resize(a,l);const c=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*i,this._renderContext.output=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=n===ee.Normal?et.DRAPED_WATER:et.DRAPED_MATERIAL,e.applyViewport(this._rctx),o.bind(c),e.index===dn.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(qs.COLOR_BUFFER_BIT)),r.type===Pn.Occluded&&(this._renderContext.renderOccludedMask=X9),Qi.OVERLAY_DRAW_DEBUG_TEXTURE&&r.type!==Pn.Occluded)for(let h=0;h<s.numViews;h++)this._setViewParameters(s.extents[h],e),this._drawDebugTexture(e.resolution,Obt[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:h,renderer:p})=>{if(r.type===Pn.ColorNoRasterImage&&h.drapeSourceType===r$.RasterImage)return;const{fullOpacity:A}=h,_=E(A)&&A<1&&n===ee.Color;_&&(this.bindTemporaryFramebuffer(this._rctx,a,l),c.clearSafe(qs.COLOR_BUFFER_BIT));for(let w=0;w<s.numViews;w++)this._setViewParameters(s.extents[w],e),p.render(this._renderContext);_&&E(this._temporaryFBO)&&(o.bind(c),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),A,e.index))}),c.bindFramebuffer(null),o.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,i){N(this._temporaryFBO)&&(this._temporaryFBO=new N4e(e,!1)),this._temporaryFBO.resize(r,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,s){var o;let n=0;for(const a of this._renderers.values())n=((o=a.intersect)==null?void 0:o.call(a,e,r,i,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((r,i)=>{const s=e.indexOf(i.layer),n=s>=0,o=this._renderers.size*(i.renderGroup??(n?H9.MapLayer:H9.ViewLayer))+(n?s:0);this._sortedRenderers.push(new Rbt(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],ATe(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),fU(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Ml(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Ml(this._renderers,r=>r.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Ml(this._renderers,r=>r.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,e,r);const i=this._rctx;i.bindTechnique(this._debugTextureTechnique,this._passParameters,null),i.bindVAO(this._quadVAO),i.drawArrays(Ar.TRIANGLE_STRIP,0,Ol(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,r,i){if($e(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const s=new Uint8Array(e*r*4);let n=0;for(let a=0;a<r;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),h=Math.floor(a/10);c<2||h<2||10*c>e-20||10*h>r-20?(s[n++]=255,s[n++]=255,s[n++]=255,s[n++]=255):(s[n++]=255,s[n++]=255,s[n++]=255,s[n++]=1&c&&1&h?1&l^1&a?0:255:1&c^1&h?0:128)}this._passParameters.texture=new Wt(this._rctx,{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.NEAREST,width:e,height:r},s);const o=new toe;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(eoe,o),this._quadVAO=mc(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([d()],Qf.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([d({autoDestroy:!0})],Qf.prototype,"_shaderTechniqueRepository",void 0),u([d({autoDestroy:!0})],Qf.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],Qf.prototype,"view",void 0),u([d()],Qf.prototype,"worldToPCSRatio",void 0),u([d()],Qf.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],Qf.prototype,"updating",null),u([d()],Qf.prototype,"isEmpty",null),Qf=u([j("esri.views.3d.terrain.OverlayRenderer")],Qf);let Rbt=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const Obt=[[1,.5,.5],[.5,.5,1]],roe=-2,X9=xn.OccludeAndTransparent;function ioe(t,e,r,i){const s=QL(t.rings,!!t.hasZ,Ug.CCW_IS_HOLE),n=jh(s.position.length),o=a4e(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,r,i),a=o!=null;return new $bt(s.position,n,RLe(s.polygons,s.position,n),MLe(s.outlines,s.position,n),a,o)}function CLe(t,e){const r=QL(t.rings,!1,Ug.CCW_IS_HOLE),i=Dn(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=roe;return{position:r.position,polygons:RLe(r.polygons,r.position),outlines:MLe(r.outlines,r.position),projectionSuccess:i}}function MLe(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:s})=>{const n=3*i,o=3*s;return E(r)?new OLe(i,s,Xp(e,n,o),Xp(r,n,o)):new soe(i,s,Xp(e,n,o))})}function RLe(t,e,r=null){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,h=o.map(A=>A-s),p=E(r)?new Pbt(s,n,Xp(e,3*s,3*n),Xp(r,l,c),h,a):new Ibt(s,n,Xp(e,3*s,3*n),h,a);i.push(p)}return i}let soe=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},OLe=class extends soe{constructor(e,r,i,s){super(e,r,i),this.mapPositions=s}},Pbt=class extends OLe{constructor(e,r,i,s,n,o){super(e,r,i,s),this.holeIndices=n,this.pathLengths=o}},Ibt=class extends soe{constructor(e,r,i,s,n){super(e,r,i),this.holeIndices=s,this.pathLengths=n}},$bt=class{constructor(e,r,i,s,n,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function PLe(t,e){const r=t.fragment;switch(r.code.add(I`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Cn.None:r.code.add(I`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Cn.View:r.code.add(I`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Cn.WindingOrder:r.code.add(I`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Cn.COUNT:}}var Cn;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Cn||(Cn={}));function ILe(t){t.vertex.code.add(I`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let Lbt=class extends fc{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function $Le(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(B.MODELORIGINHI,"vec3"),t.attributes.add(B.MODELORIGINLO,"vec3"),t.attributes.add(B.MODEL,"mat3"),t.attributes.add(B.MODELNORMAL,"mat3"));const r=t.vertex;e.instancedDoublePrecision&&(r.include(_9,e),r.uniforms.add(new Vd("viewOriginHi",(i,s)=>Odt($e(TN,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),TN))),r.uniforms.add(new Vd("viewOriginLo",(i,s)=>Pdt($e(TN,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),TN)))),r.code.add(I`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(I`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?I`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(I`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===ee.Normal&&(pM(r),r.code.add(I`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&r.code.add(I`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([ie()],Lbt.prototype,"instancedDoublePrecision",void 0);const TN=V();var qo;function Dbt(t){switch(t){case"multiply":default:return qo.Multiply;case"ignore":return qo.Ignore;case"replace":return qo.Replace;case"tint":return qo.Tint}}function LLe(t,e,r){if(N(t)||e===qo.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=ze(Math.round(t[3]*Z9),0,Z9),s=i===0||e===qo.Tint?0:e===qo.Replace?Nbt:Fbt;r[0]=ze(Math.round(t[0]*AS),0,AS),r[1]=ze(Math.round(t[1]*AS),0,AS),r[2]=ze(Math.round(t[2]*AS),0,AS),r[3]=i+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(qo||(qo={}));const AS=255,Z9=85,Nbt=Z9,Fbt=2*Z9;function DLe(t){t.vertex.code.add(I`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${I.int(qo.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${I.int(qo.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${I.int(qo.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${I.int(qo.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function NLe(t,e){e.hasSymbolColors?(t.include(DLe),t.attributes.add(B.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(I`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new ZL("colorMixMode",r=>g$e[r.colorMixMode])),t.vertex.code.add(I`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function $T(t,e){e.hasVertexColors?(t.attributes.add(B.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(I`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(I`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(I`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function kbt(t){t.fragment.code.add(I`
    #define discardOrAdjustAlpha(color) { if (color.a < ${I.float(Il)}) { discard; } }
  `)}let wx=class extends kn{constructor(e,r){super(e,"float",As.Draw,(i,s,n)=>i.setUniform1f(e,r(s,n)))}};function xx(t,e){FLe(t,e,new nt("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function Bbt(t,e){FLe(t,e,new wx("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function FLe(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==ms.Mask&&e.alphaDiscardMode!==ms.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case ms.Blend:return t.include(kbt);case ms.Opaque:i.code.add(I`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case ms.Mask:i.code.add(I`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case ms.MaskBlend:t.fragment.code.add(I`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function kLe(t,e){const{vertex:r,fragment:i}=t,s=e.hasModelTransformation;s&&r.uniforms.add(new nn("model",o=>E(o.modelTransformation)?o.modelTransformation:Hd));const n=e.hasColorTexture&&e.alphaDiscardMode!==ms.Opaque;switch(e.output){case ee.Depth:case ee.Shadow:case ee.ShadowHighlight:case ee.ShadowExcludeHighlight:case ee.ObjectAndLayerIdColor:Uh(r,e),t.include(Fu,e),t.include(Sg,e),t.include(h3,e),t.include(Hy,e),t.include(ho,e),t.include(x7,e),sT(t),t.varyings.add("depth","float"),n&&i.uniforms.add(new mr("tex",o=>o.texture)),r.code.add(I`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(xx,e),i.code.add(I`
          void main(void) {
            discardBySlice(vpos);
            ${n?I`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?I`colorUV`:I`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===ee.ObjectAndLayerIdColor?I`outputObjectAndLayerIdColor();`:I`outputDepth(depth);`}
          }
        `);break;case ee.Normal:Uh(r,e),t.include(Fu,e),t.include(XL,e),t.include($7,e),t.include(Sg,e),t.include(h3,e),n&&i.uniforms.add(new mr("tex",o=>o.texture)),t.varyings.add("vPositionView","vec3"),r.code.add(I`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${e.normalType===cs.Attribute?I`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(ho,e),t.include(xx,e),i.code.add(I`
          void main() {
            discardBySlice(vpos);
            ${n?I`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?I`colorUV`:I`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===cs.ScreenDerivative?I`
                vec3 normal = screenDerivativeNormal(vPositionView);`:I`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case ee.Highlight:Uh(r,e),t.include(Fu,e),t.include(Sg,e),t.include(h3,e),n&&i.uniforms.add(new mr("tex",o=>o.texture)),r.code.add(I`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(ho,e),t.include(xx,e),t.include(a_,e),i.code.add(I`
          void main() {
            discardBySlice(vpos);
            ${n?I`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?I`colorUV`:I`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function BLe(t,e){const r=t.fragment;if(e.hasVertexTangents?(t.attributes.add(B.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Cn.WindingOrder?r.code.add(I`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(I`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(t.extensions.add("GL_OES_standard_derivatives"),r.code.add(I`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),e.textureCoordinateType!==co.None){t.include(Ase,e);const i=e.supportsTextureAtlas?e.hasWebGL2Context?is.None:is.Size:is.None;r.uniforms.add(e.pbrTextureBindType===As.Pass?$0("normalTexture",s=>s.textureNormal,i):zv("normalTexture",s=>s.textureNormal,i)),r.code.add(I`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${e.supportsTextureAtlas?I`vtc.size = ${Qp(e,"normalTexture")};`:""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function JL(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add($0("ssaoTex",(i,s)=>s.ssaoHelper.colorTexture,e.hasWebGL2Context?is.None:is.InvSize)),r.constants.add("blurSizePixelsInverse","float",1/XP),r.code.add(I`
      float evaluateAmbientOcclusionInverse() {
        vec2 ssaoTextureSizeInverse = ${Qp(e,"ssaoTex",!0)};
        return texture2D(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
      }

      float evaluateAmbientOcclusion() {
        return 1.0 - evaluateAmbientOcclusionInverse();
      }
    `)):r.code.add(I`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function KL(t){t.constants.add("ambientBoostFactor","float",WOe)}function nR(t){t.uniforms.add(new nt("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function hT(t,e){const r=t.fragment;switch(t.include(JL,e),e.pbrMode!==Qt.Disabled&&t.include(Zne,e),t.include(vse,e),t.include(FL),r.code.add(I`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===Qt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),KL(r),nR(r),Ky(r),r.code.add(I`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?I`normalize(vPosWorld)`:I`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Yg(r),r.code.add(I`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case Qt.Disabled:case Qt.WaterOnIntegratedMesh:case Qt.Water:t.include(d9,e),r.code.add(I`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case Qt.Normal:case Qt.Schematic:r.code.add(I`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(I`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new by("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(I`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add([new nt("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new nt("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)]),r.code.add(I`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(I`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===Qt.Schematic?I`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:I`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case Qt.Terrain:case Qt.TerrainWithWater:t.include(d9,e),r.code.add(I`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case Qt.COUNT:}}function Uu(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function ULe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function u8(t,e,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function Ubt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:ULe,create:Uu,createView:Ubt,fromValues:u8},Symbol.toStringTag,{value:"Module"}));function Vbt(t){t.vertex.uniforms.add(new Xg("colorTextureTransformMatrix",e=>E(e.colorTextureTransformMatrix)?e.colorTextureTransformMatrix:Uu())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(I`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function zbt(t){t.vertex.uniforms.add(new Xg("normalTextureTransformMatrix",e=>E(e.normalTextureTransformMatrix)?e.normalTextureTransformMatrix:Uu())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(I`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Gbt(t){t.vertex.uniforms.add(new Xg("emissiveTextureTransformMatrix",e=>E(e.emissiveTextureTransformMatrix)?e.emissiveTextureTransformMatrix:Uu())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(I`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function jbt(t){t.vertex.uniforms.add(new Xg("occlusionTextureTransformMatrix",e=>E(e.occlusionTextureTransformMatrix)?e.occlusionTextureTransformMatrix:Uu())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(I`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Hbt(t){t.vertex.uniforms.add(new Xg("metallicRoughnessTextureTransformMatrix",e=>E(e.metallicRoughnessTextureTransformMatrix)?e.metallicRoughnessTextureTransformMatrix:Uu())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(I`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function F4(t){t.include(Qg),t.code.add(I`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${I.int(qo.Multiply)}) {
        return allMixed;
      }
      if (mode == ${I.int(qo.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${I.int(qo.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${I.int(qo.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${I.int(qo.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function qbt(t){const e=new Di,{vertex:r,fragment:i,varyings:s}=e;return Uh(r,t),e.include(kL),s.add("vpos","vec3"),e.include(h3,t),e.include($Le,t),e.include(a$e,t),t.hasColorTextureTransform&&e.include(Vbt),t.output!==ee.Color&&t.output!==ee.Alpha||(t.hasNormalTextureTransform&&e.include(zbt),t.hasEmissionTextureTransform&&e.include(Gbt),t.hasOcclusionTextureTransform&&e.include(jbt),t.hasMetallicRoughnessTextureTransform&&e.include(Hbt),W0(r,t),e.include(XL,t),e.include(Fu,t),t.normalType===cs.Attribute&&t.offsetBackfaces&&e.include(ILe),e.include(BLe,t),e.include($7,t),t.instancedColor&&e.attributes.add(B.INSTANCECOLOR,"vec4"),s.add("localvpos","vec3"),e.include(Sg,t),e.include(XM,t),e.include(NLe,t),e.include($T,t),r.uniforms.add(new hi("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),t.hasMultipassTerrain&&s.add("depth","float"),t.hasModelTransformation&&r.uniforms.add(new nn("model",n=>E(n.modelTransformation)?n.modelTransformation:Hd)),r.code.add(I`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${I.float(Il)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${t.normalType===cs.Attribute?I`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${t.hasModelTransformation?"model,":""} vpos);
          ${t.normalType===cs.Attribute&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?I`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?I`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?I`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?I`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?I`forwardMetallicRoughnessUV();`:""}
      }
    `)),t.output===ee.Alpha&&(e.include(ho,t),e.include(xx,t),e.include(Yd,t),i.uniforms.add([new nt("opacity",n=>n.opacity),new nt("layerOpacity",n=>n.layerOpacity)]),t.hasColorTexture&&i.uniforms.add(new mr("tex",n=>n.texture)),i.include(F4),i.code.add(I`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?I`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?I`colorUV`:I`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:I`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?I`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:I`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),t.output===ee.Color&&(e.include(ho,t),e.include(hT,t),e.include(JL,t),e.include(xx,t),e.include(t.instancedDoublePrecision?L7:uT,t),e.include(Yd,t),W0(i,t),i.uniforms.add([r.uniforms.get("localOrigin"),new Fr("ambient",n=>n.ambient),new Fr("diffuse",n=>n.diffuse),new nt("opacity",n=>n.opacity),new nt("layerOpacity",n=>n.layerOpacity)]),t.hasColorTexture&&i.uniforms.add(new mr("tex",n=>n.texture)),e.include(_se,t),e.include(Zne,t),i.include(F4),e.include(PLe,t),KL(i),nR(i),Yg(i),i.code.add(I`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?I`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?I`colorUV`:I`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:I`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===cs.ScreenDerivative?I`
                vec3 normal = screenDerivativeNormal(localvpos);`:I`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===Qt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?I`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:I`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?I`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:I`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?I`normalize(posWorld);`:I`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?I`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===Qt.Normal||t.pbrMode===Qt.Schematic?I`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?I`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:I`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===lr.Color?I`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),e.include(kLe,t),e}const Wbt=Object.freeze(Object.defineProperty({__proto__:null,build:qbt},Symbol.toStringTag,{value:"Module"}));let Ybt=class extends lLe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=ct(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=$s.Back,this.emissiveFactor=ct(0,0,0),this.instancedDoublePrecision=!1,this.normalType=cs.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=ct(.2,.2,.2),this.diffuse=ct(.8,.8,.8),this.externalColor=Nr(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=V(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=mn(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=eT.Less,this.textureAlphaMode=ms.Blend,this.textureAlphaCutoff=z9,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=xn.Occlude}},Qbt=class extends cLe{constructor(){super(...arguments),this.origin=V(),this.slicePlaneLocalOrigin=this.origin}},noe=class VLe extends Vi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2,r.spherical=e.viewingMode===_t.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?co.Default:co.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,VLe.shader)}_initializeProgram(e,r){return new Fi(e.rctx,r.get().build(this.configuration),Pi)}_convertDepthTestFunction(e){return e===eT.Lequal?Bs.LEQUAL:Bs.LESS}_makePipeline(e,r){const i=this.configuration,s=e===lr.NONE,n=e===lr.FrontFace;return Rr({blending:i.output!==ee.Color&&i.output!==ee.Alpha||!i.transparent?null:s?zd:l_(e),culling:Xbt(i)?KU(i.cullFace):null,depthTest:{func:Ib(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(s||n)&&i.writeDepth?qu:null,colorWrite:zr,stencilWrite:i.hasOccludees?Vg:null,stencilTest:i.hasOccludees?r?gb:$b:null,polygonOffset:s||n?null:M7(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};function Xbt(t){return t.cullFace!==$s.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}noe.shader=new Ni(Wbt,()=>be(()=>import("./DefaultMaterial.glsl-6c01d09f.js"),[]));let Br=class extends $a{constructor(){super(...arguments),this.output=ee.Color,this.alphaDiscardMode=ms.Opaque,this.doubleSidedMode=Cn.None,this.pbrMode=Qt.Disabled,this.cullFace=$s.None,this.transparencyPassType=lr.NONE,this.normalType=cs.Attribute,this.textureCoordinateType=co.None,this.customDepthTest=eT.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};u([ie({count:ee.COUNT})],Br.prototype,"output",void 0),u([ie({count:ms.COUNT})],Br.prototype,"alphaDiscardMode",void 0),u([ie({count:Cn.COUNT})],Br.prototype,"doubleSidedMode",void 0),u([ie({count:Qt.COUNT})],Br.prototype,"pbrMode",void 0),u([ie({count:$s.COUNT})],Br.prototype,"cullFace",void 0),u([ie({count:lr.COUNT})],Br.prototype,"transparencyPassType",void 0),u([ie({count:cs.COUNT})],Br.prototype,"normalType",void 0),u([ie({count:co.COUNT})],Br.prototype,"textureCoordinateType",void 0),u([ie({count:eT.COUNT})],Br.prototype,"customDepthTest",void 0),u([ie()],Br.prototype,"spherical",void 0),u([ie()],Br.prototype,"hasVertexColors",void 0),u([ie()],Br.prototype,"hasSymbolColors",void 0),u([ie()],Br.prototype,"hasVerticalOffset",void 0),u([ie()],Br.prototype,"hasSlicePlane",void 0),u([ie()],Br.prototype,"hasSliceHighlight",void 0),u([ie()],Br.prototype,"hasColorTexture",void 0),u([ie()],Br.prototype,"hasMetallicRoughnessTexture",void 0),u([ie()],Br.prototype,"hasEmissionTexture",void 0),u([ie()],Br.prototype,"hasOcclusionTexture",void 0),u([ie()],Br.prototype,"hasNormalTexture",void 0),u([ie()],Br.prototype,"hasScreenSizePerspective",void 0),u([ie()],Br.prototype,"hasVertexTangents",void 0),u([ie()],Br.prototype,"hasOccludees",void 0),u([ie()],Br.prototype,"hasMultipassTerrain",void 0),u([ie()],Br.prototype,"hasModelTransformation",void 0),u([ie()],Br.prototype,"offsetBackfaces",void 0),u([ie()],Br.prototype,"vvSize",void 0),u([ie()],Br.prototype,"vvColor",void 0),u([ie()],Br.prototype,"receiveShadows",void 0),u([ie()],Br.prototype,"receiveAmbientOcclusion",void 0),u([ie()],Br.prototype,"textureAlphaPremultiplied",void 0),u([ie()],Br.prototype,"instanced",void 0),u([ie()],Br.prototype,"instancedColor",void 0),u([ie()],Br.prototype,"objectAndLayerIdColorInstanced",void 0),u([ie()],Br.prototype,"instancedDoublePrecision",void 0),u([ie()],Br.prototype,"doublePrecisionRequiresObfuscation",void 0),u([ie()],Br.prototype,"writeDepth",void 0),u([ie()],Br.prototype,"transparent",void 0),u([ie()],Br.prototype,"enableOffset",void 0),u([ie()],Br.prototype,"cullAboveGround",void 0),u([ie()],Br.prototype,"snowCover",void 0),u([ie()],Br.prototype,"hasColorTextureTransform",void 0),u([ie()],Br.prototype,"hasEmissionTextureTransform",void 0),u([ie()],Br.prototype,"hasNormalTextureTransform",void 0),u([ie()],Br.prototype,"hasOcclusionTextureTransform",void 0),u([ie()],Br.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([ie({constValue:!0})],Br.prototype,"hasVvInstancing",void 0),u([ie({constValue:!1})],Br.prototype,"useCustomDTRExponentForWater",void 0),u([ie({constValue:!1})],Br.prototype,"supportsTextureAtlas",void 0),u([ie({constValue:!0})],Br.prototype,"useFillLights",void 0);function Zbt(t){const e=new Di,{vertex:r,fragment:i,varyings:s}=e;return Uh(r,t),e.include(kL),s.add("vpos","vec3"),e.include(h3,t),e.include($Le,t),e.include(a$e,t),t.output!==ee.Color&&t.output!==ee.Alpha||(W0(e.vertex,t),e.include(XL,t),e.include(Fu,t),t.offsetBackfaces&&e.include(ILe),t.instancedColor&&e.attributes.add(B.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.hasMultipassTerrain&&s.add("depth","float"),e.include(Sg,t),e.include(XM,t),e.include(NLe,t),e.include($T,t),r.uniforms.add(new hi("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),r.code.add(I`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${I.float(Il)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?I`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===ee.Alpha&&(e.include(ho,t),e.include(xx,t),e.include(Yd,t),i.uniforms.add([new nt("opacity",n=>n.opacity),new nt("layerOpacity",n=>n.layerOpacity)]),t.hasColorTexture&&i.uniforms.add(new mr("tex",n=>n.texture)),i.include(F4),i.code.add(I`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?I`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?I`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?I`colorUV`:I`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:I`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?I`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:I`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),t.output===ee.Color&&(e.include(ho,t),e.include(hT,t),e.include(JL,t),e.include(xx,t),e.include(t.instancedDoublePrecision?L7:uT,t),e.include(Yd,t),W0(e.fragment,t),Ky(i),KL(i),nR(i),i.uniforms.add([r.uniforms.get("localOrigin"),r.uniforms.get("view"),new Fr("ambient",n=>n.ambient),new Fr("diffuse",n=>n.diffuse),new nt("opacity",n=>n.opacity),new nt("layerOpacity",n=>n.layerOpacity)]),t.hasColorTexture&&i.uniforms.add(new mr("tex",n=>n.texture)),e.include(_se,t),e.include(Zne,t),i.include(F4),e.extensions.add("GL_OES_standard_derivatives"),Yg(i),i.code.add(I`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?I`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?I`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?I`colorUV`:I`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:I`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===Qt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?I`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:I`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?I`albedo = mix(albedo, vec3(1), 0.9);`:I``}
        ${I`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===Qt.Normal||t.pbrMode===Qt.Schematic?t.spherical?I`vec3 normalGround = normalize(vpos + localOrigin);`:I`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:I``}
        ${t.pbrMode===Qt.Normal||t.pbrMode===Qt.Schematic?I`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?I`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:I`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===lr.Color?I`gl_FragColor = premultiplyAlpha(gl_FragColor);`:I``}
      }
    `)),e.include(kLe,t),e}const Jbt=Object.freeze(Object.defineProperty({__proto__:null,build:Zbt},Symbol.toStringTag,{value:"Module"}));let zLe=class GLe extends noe{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=cs.Attribute,r.doubleSidedMode=Cn.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,GLe.shader)}};zLe.shader=new Ni(Jbt,()=>be(()=>import("./RealisticTree.glsl-64212b5b.js"),[]));let qy=class extends Pb{constructor(e){super(e,twt),this.supportsEdges=!0,this._configuration=new Br,this._vertexBufferLayout=rwt(this.parameters)}isVisibleForOutput(e){return e!==ee.Shadow&&e!==ee.ShadowExcludeHighlight&&e!==ee.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{instanced:r,hasVertexColors:i,hasSymbolColors:s,vvColorEnabled:n}=e,o=E(r)&&r.includes("color"),a=e.colorMixMode==="replace",l=e.opacity>0,c=e.externalColor&&e.externalColor[3]>0;return i&&(o||n||s)?!!a||l:i?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=!!this.parameters.instanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.hasVerticalOffset=E(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=E(this.parameters.screenSizePerspective),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,E(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?$s.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=E(this.parameters.modelTransformation),e!==ee.Color&&e!==ee.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Cn.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Cn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Cn.WindingOrder:Cn.None,this._configuration.instancedColor=E(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Qt.Schematic:Qt.Normal:Qt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<E7,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return E(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,s,n,o){if(E(this.parameters.verticalOffset)){const a=i.camera;$e(qj,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case _t.Global:l=qe(ege,qj);break;case _t.Local:l=Oe(ege,nwt)}let c=0;const h=Be(owt,qj,a.eye),p=st(h),A=Me(h,h,1/p);let _=null;this.parameters.screenSizePerspective&&(_=He(l,A)),c+=f$e(a,p,this.parameters.verticalOffset,_??0,this.parameters.screenSizePerspective),Me(l,l,c),Ph(Hj,l,i.transform.inverseRotation),s=Be(iwt,s,Hj),n=Be(swt,n,Hj)}u$e(e,i,s,n,DJ(i.verticalOffset),o)}requiresSlot(e,r){return r===ee.Color||r===ee.Alpha||r===ee.Depth||r===ee.Normal||r===ee.Shadow||r===ee.ShadowHighlight||r===ee.ShadowExcludeHighlight||r===ee.Highlight||r===ee.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?et.TRANSPARENT_MATERIAL:et.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:et.OPAQUE_MATERIAL)||e===et.DRAPED_MATERIAL:!1}createGLMaterial(e){return new Kbt(e)}createBufferWriter(){return new sR(this._vertexBufferLayout)}},Kbt=class extends yse{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==ee.Color&&this._output!==ee.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return $e(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?zLe:noe,e)}},ewt=class extends Ybt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const twt=new ewt;function rwt(t){const e=gn().vec3f(B.POSITION).vec3f(B.NORMAL),r=t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId;return t.hasVertexTangents&&e.vec4f(B.TANGENT),r&&e.vec2f(B.UV0),t.hasVertexColors&&e.vec4u8(B.COLOR),t.hasSymbolColors&&e.vec4u8(B.SYMBOLCOLOR),Le("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(B.OBJECTANDLAYERIDCOLOR),e}const iwt=V(),swt=V(),nwt=ct(0,0,1),ege=V(),Hj=V(),qj=V(),owt=V(),awt=["polygon","extent"];let lwt=class extends Jg{constructor(e,r,i,s){super(e,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=R7(this._getSymbolSize());if(a)throw new ce("graphics3dextrudesymbollayer:invalid-size",a)}const e=pa(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(e),i=Iu(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?$s.None:$s.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new qy(o),this._bottomMaterial=new qy({...o,cullFace:$s.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,awt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new K0);return this._createAs3DShape(r,e.renderingInfo,i,s,r.uid)}layerOpacityChanged(e,r){const i=pa(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(a=>{const l=r(a);E(l)&&l.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,pb)}slicePlaneEnabledChanged(e,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(i=>{const s=r(i);E(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?V1t(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?Qo.Recreate_Symbol:Qo.Recreate_Graphics}async queryForSnapping(e,r,i,s){const n=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/Fx(r),{objectId:o,target:a}=e,l=Te(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:h}=e,p=Te(c),A=Te(h);return p.z=(p.z??0)+n,A.z=(A.z??0)+n,[bme(o,l,1/0,p,A)]}case"vertex":return[k1t(o,l,1/0),bme(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,s,n){const o=L4(e.geometry);if(N(o))return null;if(o.rings.length===0||!o.rings.some(Ae=>Ae.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=ioe(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=$ne(o);if(N(l))return null;const c=new Array,h=Jo(),p=ot(),A=V(),_=this._context.renderCoordsHelper.viewingMode===_t.Global;_||this._context.renderCoordsHelper.worldUpAtPosition(null,A),G0(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const w=ot();ul(w,p);const T=mn();aM(T,w);const{polygons:C,mapPositions:M,position:O}=a,$=O.length/3,L=new Float64Array(3*$*6),k=new Float64Array(3*$*6),F=new Float64Array(3*$*6),G=new Float64Array(1*$*6);let z=0;for(let Ae=0;Ae<C.length;++Ae){const ve=C[Ae],ye=ve.count;if(this._context.clippingExtent&&(Fs(h),Dd(h,ve.mapPositions),!v0(h,this._context.clippingExtent)))continue;const le=fb(ve.mapPositions,ve.holeIndices,3);if(le.length===0)continue;const W=3*ye*2+le.length,q=new Array(W),X=new Array(le.length),se=6*ye,ae=3*L.BYTES_PER_ELEMENT,fe=new cc(L.buffer,z*ae,ae,(z+se)*ae),ue=3*k.BYTES_PER_ELEMENT,Re=new cc(k.buffer,z*ue,ue,(z+se)*ue),De=new Float64Array(F.buffer,3*z*F.BYTES_PER_ELEMENT,3*se),Ue=new Float64Array(G.buffer,1*z*G.BYTES_PER_ELEMENT,1*se),Je=this._getExtrusionSize(r);cwt(O,M,le,ve,fe.typedBuffer,De,Re.typedBuffer,Ue,q,X,Je,A,_),YL(fe,fe,w),mb(Re,Re,T),z+=6*ye;const vt=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),lt=new fwt(fe.typedBuffer,De,Re.typedBuffer,Ue);c.push(tge(this._material,q,q.length-X.length,lt,i,vt)),c.push(tge(this._bottomMaterial,X,0,lt,i,vt))}if(c.length===0)return null;const Z=new u_({geometries:c,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});Z.transformation=p;const J=b4e(this.symbolLayer,{opacity:this._getLayerOpacity()}),te=E(J)?{baseMaterial:this._material,edgeMaterials:[J],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,re=new Zg(this,Z,c,null,null,dwt,s,te);return re.alignedSampledElevation=a.sampledElevation,re.needsElevationUpdates=pb(s.mode),re}};function tge(t,e,r,i,s,n){const o=new Array(e.length).fill(0),a=[[B.POSITION,new Rt(i.positions,3,!0)],[B.NORMAL,new Rt(i.normals,3,!0)],[B.COLOR,new Rt(s,4,!0)],[B.SIZE,new Rt(i.heights,1,!0)]],l=[[B.POSITION,e],[B.NORMAL,e],[B.COLOR,o]];return new Mo(t,a,l,i.elevation,Xn.Mesh,n,r)}function cwt(t,e,r,i,s,n,o,a,l,c,h,p,A){const _=r.length/3;let w=0,T=2*i.count;uwt(t,e,i.index,i.count,r,0,_,s,n,o,a,l,c,T,h,p,A);let C=2*i.count;T=0,rge(s,n,a,o,w,i.pathLengths[0],i.count,C,l,T,h),C+=4*i.pathLengths[0],T+=2*i.pathLengths[0],w+=i.pathLengths[0];for(let M=1;M<i.pathLengths.length;++M)rge(s,n,a,o,w,i.pathLengths[M],i.count,C,l,T,h),C+=4*i.pathLengths[M],T+=2*i.pathLengths[M],w+=i.pathLengths[M]}function uwt(t,e,r,i,s,n,o,a,l,c,h,p,A,_,w,T,C){Oe(du,T);const M=w>0?1:-1;let O=3*r,$=0,L=3*$,k=i,F=3*k;for(let Z=0;Z<i;++Z)C&&(du[0]=t[O+0],du[1]=t[O+1],du[2]=t[O+2],qe(du,du)),a[L+0]=t[O+0],a[L+1]=t[O+1],a[L+2]=t[O+2],l[L+0]=e[O+0],l[L+1]=e[O+1],l[L+2]=e[O+2],c[L+0]=-M*du[0],c[L+1]=-M*du[1],c[L+2]=-M*du[2],h[$]=0,a[F+0]=t[O+0]+w*du[0],a[F+1]=t[O+1]+w*du[1],a[F+2]=t[O+2]+w*du[2],l[F+0]=e[O+0],l[F+1]=e[O+1],l[F+2]=e[O+2],c[F+0]=M*du[0],c[F+1]=M*du[1],c[F+2]=M*du[2],h[k]=w,L+=3,F+=3,O+=3,$+=1,k+=1;O=3*n,L=0,F=3*_;const G=w<0?lge:age,z=w<0?age:lge;for(let Z=0;Z<o;++Z)A[L+0]=s[O+G[0]],A[L+1]=s[O+G[1]],A[L+2]=s[O+G[2]],p[F+0]=s[O+z[0]]+i,p[F+1]=s[O+z[1]]+i,p[F+2]=s[O+z[2]]+i,L+=3,F+=3,O+=3}function SN(t,e,r,i,s,n,o){i[n]=i[o],o*=3,t[(n*=3)+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],r[n+0]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const lO=V();function rge(t,e,r,i,s,n,o,a,l,c,h){let p=s,A=s+1,_=s+o,w=s+o+1,T=a,C=a+1,M=a+2*n,O=a+2*n+1;h<0&&(p=s+o+1,w=s),c*=3;for(let $=0;$<n;++$)$===n-1&&(h>0?(A=s,w=s+o):(A=s,p=s+o)),hwt(t,p,A,_,lO),SN(t,e,i,r,lO,T,p),SN(t,e,i,r,lO,C,A),SN(t,e,i,r,lO,M,_),SN(t,e,i,r,lO,O,w),l[c++]=T,l[c++]=M,l[c++]=O,l[c++]=T,l[c++]=O,l[c++]=C,p++,A++,_++,w++,T+=2,C+=2,M+=2,O+=2}const Wj=V(),ige=V(),sge=V(),nge=V(),oge=V();function hwt(t,e,r,i,s){e*=3,r*=3,i*=3,$e(Wj,t[e++],t[e++],t[e++]),$e(ige,t[r++],t[r++],t[r++]),$e(sge,t[i++],t[i++],t[i++]),Be(nge,ige,Wj),Be(oge,sge,Wj),Xt(s,oge,nge),qe(s,s)}const yS=V();function dwt(t,e,r,i,s){const n=t.stageObject,o=n.geometries,a=o.length,l=e.mode!=="absolute-height";let c=0;const h=n.transformation,p=FM(ot(),h);for(let A=0;A<a;A+=2){const _=o[A];if(!Dne(_))continue;const w=_.getMutableAttribute(B.POSITION).data,T=_.vertexAttributes.get(B.SIZE).data,C=new TIe(_.mapPositions),M=w.length/3;let O=0,$=!1,L=0;for(let k=0;k<M;k++){yS[0]=w[O],yS[1]=w[O+1],yS[2]=w[O+2],i(C,EN),l&&(L+=EN.sampledElevation),Qi.TESTS_DISABLE_OPTIMIZATIONS?($e(Ju,C.array[C.offset+0],C.array[C.offset+1],EN.z+T[O/3]),E(r)&&s.toRenderCoords(Ju,r,Ju),Mt(Ju,Ju,p)):($e(Ju,w[O+0],w[O+1],w[O+2]),Mt(Ju,Ju,h),s.setAltitude(Ju,EN.z+T[O/3]),Mt(Ju,Ju,p)),w[O]=Ju[0],w[O+1]=Ju[1],w[O+2]=Ju[2];const F=pwt/s.unitInMeters;(Math.abs(yS[0]-w[O])>=F||Math.abs(yS[1]-w[O+1])>=F||Math.abs(yS[2]-w[O+2])>=F)&&($=!0),C.offset+=3,O+=3}$&&(_.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o[A]),o[A+1].invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o[A+1])),c+=L/M}return c/a}const Ju=V(),du=V(),EN=new WL,age=[0,2,1],lge=[0,1,2],pwt=.01;let fwt=class{constructor(e,r,i,s){this.positions=e,this.elevation=r,this.normals=i,this.heights=s}};function mwt(t,e,r,i,s){if(N(t))return null;const n=t.referencesGeometry()&&s?gwt(e,i,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...r,$feature:o})}catch(a){return we.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const Yj=new Map;function gwt(t,e,r){const{transform:i,hasZ:s,hasM:n}=r;Yj.has(e)||Yj.set(e,Awt(e));const o=Yj.get(e)(t.geometry,i,s,n);return{...t,geometry:o}}function Awt(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,s,n)=>X$e(i,e,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>Z$e(i,e,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>J$e(i,e,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>Q$e(i,e,r,s,n);default:return we.getLogger("esri.views.2d.support.arcadeOnDemand").error(new ce("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const RGt=1.2,ywt=bg;let N7=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,wn.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,la.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,wn.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=V()){return $e(e,0,0,0)}getBoundingBoxObjectSpace(e=Jo()){return Fs(e)}addObjectState(e,r){e===zy.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.geometry.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,la.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,la.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(_S)&&(e.draped.origin[0]+=_S[0],e.draped.origin[1]+=_S[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,s,n){Fs(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,cge,i),Xje(n,cge)}if(r){let o;_0(n,_S);const a=Lne(n,r.service.spatialReference,r);try{o=await r.service.queryElevation(_S[0],_S[1],s,a,"ground")}catch{}E(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,r,i,s){if(this.boundingBox)sU(pm,this.boundingBox);else{const n=e.boundingSphere,o=n[3];pm[0]=n[0]-o,pm[1]=n[1]-o,pm[2]=n[2]-o,pm[3]=n[0]+o,pm[4]=n[1]+o,pm[5]=n[2]+o}return r(pm,0,2),this.calculateRelativeScreenBounds&&s.push({location:_0(pm),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Are(pm,i)}};const cge=si(),pm=Jo(),_S=V();let jLe=class{constructor(e,r,i,s=2048){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(e+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(N(this._metricsCached)){const e=cK(uge,CN,CN).getContext("2d");this._setFontProperties(e,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((w,T)=>{const C=e.measureText(w),M=C.width,O=M+r;this._textWidths.push(M),this._lineWidths.push(O),o=Math.max(o,O),a=Math.max(a,C.actualBoundingBoxAscent),l=Math.max(l,C.actualBoundingBoxDescent),T===0&&(s=C),T===this._lines.length-1&&(n=C)});const c=e.font;let h=dge.get(c);if(!h){const w=e.measureText(vwt);h=new wwt(w.actualBoundingBoxAscent,w.actualBoundingBoxDescent),dge.set(c,h)}a=Math.max(a,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const p=a+l,A=this._hasBackground?s.actualBoundingBoxAscent:a,_=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new bwt(a-A,l-_,p,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*_wt}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(N(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case Hv.Left:return this._backgroundHorizontalPadding;case Hv.Center:return(this.displayWidth-this._lineWidths[e])/2;case Hv.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,r=0,i=0){e.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,r+p,i),this._renderLineDecoration(e,r+p,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+p,i,this._textWidths[c]),i+=this._lineSpacing}if(Qi.TEXT_SHOW_BASELINE){e.strokeStyle=hge,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this._baselinePosition;this._drawLine(e,[s,p],[s+this.displayWidth,p]),c+=this._lineSpacing}}if(Qi.TEXT_SHOW_BORDER&&(e.strokeStyle=hge,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=ze(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+s),e.arcTo(r,i,r+s,i,s),e.lineTo(r+n-s,i),e.arcTo(r+n,i,r+n,i+s,s),e.lineTo(r+n,i+o-s),e.arcTo(r+n,i+o,r+n-s,i+o,s),e.lineTo(r+s,i+o),e.arcTo(r,i+o,r,i+o-s,s),e.closePath()):e.rect(r,i,n,o)}_renderHalo(e,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=cK(uge,Math.max(o,CN),Math.max(a,CN)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this._baselinePosition;for(let A=0;A<this._lines.length;++A){const _=this._getLineXOffset(A);this._renderLineDecoration(c,s+_,p,this._textWidths[A],!0),p+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of HLe)this._fillText(e,n,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const s=2*this._haloSize;i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(p*s),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(e,r){e.font=this._parameters.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,s){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(e,r,i,s){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,p),e.lineTo(l,p),e.lineTo(l,h),e.stroke()}};const HLe=[];for(let e=0;e<360;e+=360/16)HLe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var Hv;function cK(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(Hv||(Hv={}));const uge={canvas:null},_wt=.2,CN=512,hge="rgb(255, 0, 255, 0.5)",vwt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let bwt=class{constructor(e,r,i,s,n){this.paddingTop=e,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=s,this.baselinePosition=n}},wwt=class{constructor(e,r){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=r}};const dge=new Map,xwt=Object.freeze({left:0,center:.5,right:1}),h8=Object.freeze({"bottom-left":ki(0,0),bottom:ki(.5,0),"bottom-right":ki(1,0),left:ki(0,.5),center:ki(.5,.5),right:ki(1,.5),"top-left":ki(0,1),top:ki(.5,1),"top-right":ki(1,1)});function qLe(t){switch(t){case"left":return Hv.Left;case"right":return Hv.Right;default:return Hv.Center}}function pge(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Twt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Swt(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function Ewt(t){return t==="middle"?"center":t}var Zl,fge;function cO(t){return t!=null}function vS(t){return typeof t=="number"}function F7(t){return typeof t=="string"}function Cwt(t){return t==null||F7(t)}function Wo(t,e){t&&t.push(e)}function Mwt(t,e,r,i=ot()){const s=t||0,n=e||0,o=r||0;return s!==0&&G3(i,i,-s/180*Math.PI),n!==0&&z3(i,i,n/180*Math.PI),o!==0&&pU(i,i,o/180*Math.PI),i}function B_(t,e,r,i,s){const n=t.minSize,o=t.maxSize;if(t.expression)return Wo(s,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=i.symbolSize[r];return e.minSize[r]=a,e.maxSize[r]=a,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=Zl.DefinedSize,!0}if(cO(t.field))return cO(t.stops)?t.stops.length===2&&vS(t.stops[0].size)&&vS(t.stops[1].size)?(mge(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=Zl.DefinedSize,!0):(Wo(s,"Could not convert size info: stops only supported with 2 elements"),!1):vS(n)&&vS(o)&&cO(t.minDataValue)&&cO(t.maxDataValue)?(mge(n,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=Zl.DefinedSize,!0):Z3[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/Z3[t.valueUnit],e.type[r]=Zl.DefinedSize,!0):t.valueUnit==="unknown"?(Wo(s,"Could not convert size info: proportional size not supported"),!1):(Wo(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!cO(t.field)){if(t.stops&&t.stops[0]&&vS(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=Zl.DefinedSize,!0;if(vS(n))return e.minSize[r]=n,e.maxSize[r]=n,e.offset[r]=n,e.factor[r]=0,e.type[r]=Zl.DefinedSize,!0}return Wo(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function mge(t,e,r,i,s,n){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-r*o,s.factor[n]=o}function Rwt(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return Wo(i,"Could not convert size info: unsupported property"),null;if(!Cwt(t.field))return Wo(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Wo(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size={field:t.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[Zl.Undefined,Zl.Undefined,Zl.Undefined]};let s;switch(t.axis){case"width":return s=B_(t,e.size,0,r,i),s?e:null;case"height":return s=B_(t,e.size,2,r,i),s?e:null;case"depth":return s=B_(t,e.size,1,r,i),s?e:null;case"width-and-depth":return s=B_(t,e.size,0,r,i),s&&B_(t,e.size,1,r,i),s?e:null;case null:case void 0:case"all":return s=B_(t,e.size,0,r,i),s=s&&B_(t,e.size,1,r,i),s=s&&B_(t,e.size,2,r,i),s?e:null;default:return Wo(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function Owt(t,e,r){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===Zl.DefinedSize&&(n*=e.modelSize[s],t.type[s]=Zl.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let i;if(t.type[0]!==Zl.Undefined)i=0;else if(t.type[1]!==Zl.Undefined)i=1;else{if(t.type[2]===Zl.Undefined)return Wo(r,"No size axis contains a valid size or scale"),!1;i=2}for(let s=0;s<3;++s)t.type[s]===Zl.Undefined&&(t.minSize[s]=t.minSize[i],t.maxSize[s]=t.maxSize[i],t.offset[s]=t.offset[i],t.factor[s]=t.factor[i],t.type[s]=t.type[i]);return!0}function gge(t,e,r){t[4*e+0]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function Pwt(t,e,r){if(t.normalizationField)return Wo(r,"Could not convert color info: unsupported property"),null;if(F7(t.field)){if(!t.stops)return Wo(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Wo(r,"Could not convert color info: too many color stops"),null;e.color={field:t.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.color.values[s]=n.value,gge(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return Wo(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,gge(e.color.colors,s,i)}}return e}function Iwt(t,e,r){if(t.normalizationField)return Wo(r,"Could not convert opacity info: unsupported property"),null;if(F7(t.field)){if(!t.stops)return Wo(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Wo(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity={field:t.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Wo(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=i}}return e}function Qj(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function $wt(t,e,r){if(!F7(t.field))return Wo(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Wo(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return Qj(t,e.rotation,0),e;case"roll":return Qj(t,e.rotation,1),e;case null:case void 0:case"heading":return Qj(t,e.rotation,2),e;default:return Wo(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}function WLe(t,e,r){if(!t)return null;const i=!e.supportedTypes||!!e.supportedTypes.size,s=!e.supportedTypes||!!e.supportedTypes.color,n=!e.supportedTypes||!!e.supportedTypes.rotation,o=!!e.supportedTypes&&!!e.supportedTypes.opacity,a=t.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return Wo(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return i?Rwt(c,l,e,r):l;case"color":return s?Pwt(c,l,r):l;case"opacity":return o?Iwt(c,l,r):null;case"rotation":return n?$wt(c,l,r):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(t.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!Owt(a.size,e,r)?null:a:null}function ooe(t){return t&&t.size!=null}function k4(t,e){if(!t)return{enabled:!1};if(Qi.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const r=WLe(t.visualVariables,e);return r?{enabled:!0,visualVariables:r,materialParameters:YLe(r,e),requiresShaderTransformation:ooe(r)}:{enabled:!1}}function B4(t,e,r){if(!e||!t.enabled)return!1;const i=t.visualVariables,s=WLe(e.visualVariables,r);return!!s&&!!(MN(i.size,s.size,"size")&&MN(i.color,s.color,"color")&&MN(i.rotation,s.rotation,"rotation")&&MN(i.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=YLe(s,r),t.requiresShaderTransformation=ooe(s),!0)}function MN(t,e,r){if(!!t!=!!e||t&&t.field!==e.field)return!1;if(t&&r==="rotation"){const i=t,s=e;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}function YLe(t,e){const r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},i=ooe(t);return t&&t.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=t.size.minSize,r.vvSizeMaxSize=t.size.maxSize,r.vvSizeOffset=t.size.offset,r.vvSizeFactor=t.size.factor):t&&i&&(r.vvSizeValue=e.transformation.scale),t&&i&&(r.vvSymbolAnchor=e.transformation.anchor,r.vvSymbolRotationMatrix=mn(),cf(n$),Mwt(e.transformation.rotation[2],e.transformation.rotation[0],e.transformation.rotation[1],n$),hf(r.vvSymbolRotationMatrix,n$)),t&&t.color&&(r.vvColorEnabled=!0,r.vvColorValues=t.color.values,r.vvColorColors=t.color.colors),t&&t.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=t.opacity.values,r.vvOpacityOpacities=t.opacity.opacityValues),r}function uK(t,e,r){if(!t.vvSizeEnabled)return r;ma(U_,r);const i=t.vvSymbolRotationMatrix;qg(n$,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),$n(U_,U_,n$);for(let s=0;s<3;++s){const n=t.vvSizeOffset[s]+e[0]*t.vvSizeFactor[s];Age[s]=ze(n,t.vvSizeMinSize[s],t.vvSizeMaxSize[s])}return dU(U_,U_,Age),ju(U_,U_,t.vvSymbolAnchor),U_}function Lwt(t,e,r){if(!e.vvSizeEnabled)return $e(t,1,1,1);for(let i=0;i<3;++i){const s=e.vvSizeOffset[i]+r[0]*e.vvSizeFactor[i];t[i]=ze(s,e.vvSizeMinSize[i],e.vvSizeMaxSize[i])}return t}(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Zl||(Zl={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(fge||(fge={}));const U_=ot(),Age=V(),n$=ot();let yM=class{constructor(e,r={}){this.geometry=e,this.boundingSphere=Zr(),this.screenToWorldRatio=1,this._transformation=ot(),this._shaderTransformationDirty=!0,this.id=kh(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.boundingInfo=r.boundingInfo,this.shaderTransformer=r.shaderTransformer,this.castShadow=!!r.castShadow&&r.castShadow}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,r,i=Wx(e)){N(this.boundingInfo)||(Mt(r,this.boundingInfo.center,e),r[3]=this.boundingInfo.radius*i)}get hasShaderTransformation(){return E(this.shaderTransformer)}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return N(this.shaderTransformer)?this.transformation:(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=ot()),ma(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const Dwt=ot(),yge=ct(0,0,1),Nwt=16,Fwt=1.5,nx=Rne,kwt=[nx/2,nx/2,1-nx/2,1-nx/2],Bwt=[O4*nx,O4*nx];let hK=class QLe extends Jg{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,s){super(e,r,i,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(E(i))this._prepareResourcesPrimitive(r,i);else{const s=rKe(this.symbolLayer),n=cL(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(n.data),e):await this._prepareResourcesHref(r,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=R7(this._getIconSize());if(e)throw new ce("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?ll(e.size):Nwt);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){const r=this._getGraphicHash(e);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:Vv.PAD};i=new IT(n.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_computeSize(e,r){const i=e.width/e.height;return i>1?[r,Math.round(r/i)]:[Math.round(r*i),r]}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(Uwt(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;e.verticalOffset={screenLength:ll(i),minWorldLength:s||0,maxWorldLength:E(n)?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(Xj(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,E(this._context.sharedResources.textures)){const n=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>C$e(r));this._texture=n.texture,this._releaseTexture=n,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=kwt;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/nx,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(E(this._context.sharedResources.textures)){const o=await B0(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw Sh(o.error),new ce("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){const s=new IM({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await be(()=>import("./CIMSymbolRasterizer-56bc53d7.js"),["assets/CIMSymbolRasterizer-56bc53d7.js","assets/cimAnalyzer-8f03d8e4.js","assets/BidiEngine-836b7ef6.js","assets/TileClipper-ae6eca9e.js","assets/enums-c655c737.js","assets/number-b10bd8f5.js","assets/_commonjsHelpers-2f3e7994.js","assets/imageutils-961feb6c.js","assets/rasterizingUtils-b487cee1.js"])).CIMSymbolRasterizer;di(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,A=await BGe(p,this._context.layer.spatialReference,n);a=(_,w,T)=>{const C=mwt(A,_,{$view:T},"esriGeometryPoint",w);return C!==null?C:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];di(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||gHe}_getOutlineSize(){let e=0;const r=this.symbolLayer;return E(r.outline)&&r.outline.size!=null?Math.max(ll(r.outline.size),0):(e=Xj(this._getPrimitive())?Fwt:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),r=this.symbolLayer,i=pa(r,"outline","color");if(E(i)){const s=Ot.toUnitRGB(i),n=i.a*e;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(Xj(this._getPrimitive()))return ywt;const e=N(this._getPrimitive()),r=pa(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?ki((r.x||0)+.5,.5-(r.y||0)):e in h8?h8[e]:h8.center}_createMaterialAndAddToStage(e,r){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=k4(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let i=E(e.textureId)?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new mM(e),this._cimSymbolMaterials.set(gr(e.textureId,0),i),r.add(i)),i}return this._material=new mM(e),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=en(this._releaseTexture)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const s=e.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[i]=ll(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(r),A={textureId:p.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(A,this._context.stage),s=[p.params.width,p.params.height]}else s=this._size,i=this._material;const n=$4(r.geometry);if(N(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=ki(s[0]*l,s[1]*l),h=this.setGraphicElevationContext(r,new K0);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,i,a,c,e.layer.uid):this._createAs3DShape(r,n,i,a,c,h,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=qL(QLe.elevationModeChangeTypes,i,s);if(n!==Ln.UPDATE)return n;const o=ff(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!B4(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return Qo.Recreate_Symbol;E(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return Qo.Fast_Update}_defaultElevationInfoNoZ(){return Vwt}_createAs3DShape(e,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=l?T=>uK(this._fastUpdates.materialParameters,l,T):void 0,h=this._context.layer.uid,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),A=OJ(i,yge,null,s,n,zwt,null,l,p),_=Vne(this._context,r,A,o,a,c);if(N(_))return null;const w=new Zg(this,_.object,[A],null,null,P4,o);return w.alignedSampledElevation=_.sampledElevation,w.needsElevationUpdates=ff(o.mode)||o.mode==="absolute-height",w.getScreenSize=this._createScreenSizeGetter(n,c),w.calculateRelativeScreenBounds=T=>i.calculateRelativeScreenBounds(w.getScreenSize(),1,T),I4(w,r,this._context.elevationProvider),w}_createAsOverlay(e,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=Zr();Fl(r,a,this._context.overlaySR),a[2]=roe;const l=this._context.clippingExtent;if(E(l)&&!gre(l,a))return null;const c=this.getFastUpdateAttrValues(e),h=c?T=>uK(this._fastUpdates.materialParameters,c,T):void 0,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),A=OJ(i,yge,a,s,n,null,null,c,p),_=new yM(A,{layerUid:o,graphicUid:e.uid,shaderTransformer:h});a[3]=0,A0(_.boundingSphere,a);const w=new N7(this,[_],null,this._context.drapeSourceRenderer);return w.getScreenSize=this._createScreenSizeGetter(n,h),w.calculateRelativeScreenBounds=T=>i.calculateRelativeScreenBounds(w.getScreenSize(),1,T),w}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates.enabled){const s=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(o=Dt())=>{const a=r(Dwt);return o[0]=a[0]*s+i,o[1]=a[5]*n+i,o}}{const s=e[0]/this._symbolTextureRatio+i,n=e[1]/this._symbolTextureRatio+i;return(o=Dt())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],r=ct(e,e,e),i=of(1),s=e*i;return{modelSize:r,symbolSize:ct(s,s,s),unitInMeters:i,transformation:{anchor:sc,scale:hg,rotation:sc}}}_getGraphicHash(e){let r="";for(const i of this._cimRequiredFields)r+=i+e.attributes[i];return r}_forEachMaterial(e){E(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function Uwt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function Xj(t){return!N(t)&&(t==="cross"||t==="x")}hK.PRIMITIVE_SIZE=Bwt,hK.elevationModeChangeTypes={definedChanged:Ln.UPDATE,staysOnTheGround:Ln.NONE,onTheGroundChanged:Ln.RECREATE};const Vwt={mode:"relative-to-ground",offset:0},zwt=Nr(0,0,0,1);function dK(t){switch(t){case"butt":return Jp.BUTT;case"square":return Jp.SQUARE;case"round":return Jp.ROUND;default:return null}}function Gwt(t){return t==="diamond"?"kite":t}function pK(t,e,r=null){const i=[],s=[],n=e.mapPositions;jwt(e,s,i);const o=s[0][1].data,a=i[0][1].length,l=new Array(a).fill(0);return Hwt(e,s,i,l),Ywt(e,s,i,l),qwt(e,s,i,l),Wwt(e,s,i,l),Qwt(e,s,i,l),Xwt(e,s,i,l),Zwt(e,s,i,o),new Mo(t,s,i,n,Xn.Line,r)}function jwt(t,e,r){const{attributeData:{position:i},removeDuplicateStartEnd:s}=t,n=Jwt(i)&&s,o=i.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?i.slice(0,i.length-3):i;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;e.push([B.POSITION,new Rt(l,3,n)]),r.push([B.POSITION,a])}function Hwt(t,e,r,i){if(E(t.attributeData.colorFeature))return;const s=t.attributeData.color;e.push([B.COLOR,new Rt(gr(s,Gp),4)]),r.push([B.COLOR,i])}function qwt(t,e,r,i){if(!E(t.attributeData.normal))return;const s=t.attributeData.normal;e.push([B.NORMAL,new Rt(s,3)]),r.push([B.NORMAL,i])}function Wwt(t,e,r,i){const s=t.attributeData.colorFeature;N(s)||(e.push([B.COLORFEATUREATTRIBUTE,new Rt([s],1,!0)]),r.push([B.COLOR,i]))}function Ywt(t,e,r,i){if(E(t.attributeData.sizeFeature))return;const s=t.attributeData.size;e.push([B.SIZE,new Rt([gr(s,1)],1,!0)]),r.push([B.SIZE,i])}function Qwt(t,e,r,i){const s=t.attributeData.sizeFeature;N(s)||(e.push([B.SIZEFEATUREATTRIBUTE,new Rt([s],1,!0)]),r.push([B.SIZEFEATUREATTRIBUTE,i]))}function Xwt(t,e,r,i){const s=t.attributeData.opacityFeature;N(s)||(e.push([B.OPACITYFEATUREATTRIBUTE,new Rt([s],1,!0)]),r.push([B.OPACITYFEATUREATTRIBUTE,i]))}function Zwt(t,e,r,i){if(N(t.overlayInfo)||t.overlayInfo.renderCoordsHelper.viewingMode!==_t.Global||!t.overlayInfo.spatialReference.isGeographic)return;const s=jh(i.length),n=es(t.overlayInfo.spatialReference);for(let A=0;A<s.length;A+=3)Pre(i,A,s,A,n);const o=i.length/3,a=uo(o+1);let l=Kwt,c=e2t,h=0,p=0;$e(l,s[p++],s[p++],s[p++]),a[0]=0;for(let A=1;A<o+1;++A)A===o&&(p=0),$e(c,s[p++],s[p++],s[p++]),h+=XRe(l,c),a[A]=h,[l,c]=[c,l];e.push([B.DISTANCETOSTART,new Rt(a,1,!0)]),r.push([B.DISTANCETOSTART,r[0][1]])}function Jwt(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const Kwt=V(),e2t=V();function DGt(t,e){if(N(t)||t.length===0)return[];const r=[];return t.forEach(i=>{const s=i.length,n=jh(3*s);i.forEach((a,l)=>{n[3*l+0]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function t2t(t,e,r,i){const s=t.type==="polygon"?Ug.CCW_IS_HOLE:Ug.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=QL(n,!!t.hasZ,s),l=jh(o.length),c=a4e(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),h=c!=null;return{lines:h?XLe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function r2t(t,e){const r=t.type==="polygon"?Ug.CCW_IS_HOLE:Ug.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=QL(i,!1,r),o=Dn(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=roe;return{lines:o?XLe(n,s):[],projectionSuccess:o}}function XLe(t,e,r=null){const i=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;i.push({position:Xp(e,3*s,3*n),mapPositions:E(r)?Xp(r,o,a):void 0})}return i}function i2t(t){const e=new Di,r=t.hasMultipassTerrain&&(t.output===ee.Color||t.output===ee.Alpha),i=t.space===Zp.World;t.hasTip&&i&&e.extensions.add("GL_OES_standard_derivatives"),e.include(z4e,t),e.include(Q4e,t),t.output===ee.Depth&&e.include(Hy,t);const{vertex:s,fragment:n}=e;return n.include(qh),Uh(s,t),e.attributes.add(B.POSITION,"vec3"),e.attributes.add(B.UV0,"vec2"),e.attributes.add(B.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),lb(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add([new Bi("nearFar",(o,a)=>a.camera.nearFar),new hi("viewport",(o,a)=>a.camera.fullViewport)]),s.code.add(I`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(I`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(B.NORMAL,"vec3"),pM(s),s.constants.add("tiltThreshold","float",.7),s.code.add(I`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(I`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(I`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===cT.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Zp.Screen&&(s.uniforms.add(new nn("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(I`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(I`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new nt("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(I`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),s.uniforms.add(new nt("pixelRatio",(o,a)=>a.camera.pixelRatio)),r7(e),s.code.add(I`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&s.code.add(I`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(I`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(I`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Zp.Screen&&s.code.add(I`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(I`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(Yd,t),e.include(ho,t),n.uniforms.add([new hi("intrinsicColor",o=>o.color),new mr("tex",o=>o.texture)]),n.include(Qg),e.constants.add("texelSize","float",1/D4),n.code.add(I`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",qne/D4),e.constants.add("relativeTipLineWidth","float",yvt),n.code.add(I`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",Il),n.code.add(I`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===ee.ObjectAndLayerIdColor?I`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===ee.Alpha?I`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===ee.Color?I`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===ee.Color&&t.transparencyPassType===lr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${t.output===ee.Highlight?I`gl_FragColor = vec4(1.0);`:""}
    ${t.output===ee.Depth?I`outputDepth(linearDepth);`:""}
  }
  `),e}const s2t=Object.freeze(Object.defineProperty({__proto__:null,build:i2t},Symbol.toStringTag,{value:"Module"})),ZLe=new Map([[B.POSITION,0],[B.UV0,2],[B.AUXPOS1,3],[B.NORMAL,4],[B.COLOR,5],[B.COLORFEATUREATTRIBUTE,5],[B.SIZE,6],[B.SIZEFEATUREATTRIBUTE,6],[B.OPACITYFEATUREATTRIBUTE,7]]);let JLe=class KLe extends Vi{initializeProgram(e){return new Fi(e.rctx,KLe.shader.get().build(this.configuration),ZLe)}_makePipelineState(e,r){const i=this.configuration,s=e===lr.NONE;return Rr({blending:i.output===ee.Color||i.output===ee.Alpha?s?zd:l_(e):null,depthTest:{func:Ib(e)},depthWrite:s?i.writeDepth?qu:null:S7(e),colorWrite:zr,stencilWrite:i.hasOccludees?Vg:null,stencilTest:i.hasOccludees?r?gb:$b:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Rr({blending:zd,depthTest:Y9,depthWrite:null,colorWrite:zr,stencilWrite:null,stencilTest:J4e}),this._occluderPipelineOpaque=Rr({blending:zd,depthTest:Y9,depthWrite:null,colorWrite:zr,stencilWrite:X4e,stencilTest:Z4e}),this._occluderPipelineMaskWrite=Rr({blending:null,depthTest:Wne,depthWrite:null,colorWrite:null,stencilWrite:Vg,stencilTest:gb})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===et.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===et.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};JLe.shader=new Ni(s2t,()=>be(()=>import("./LineMarker.glsl-a21afb55.js"),[]));let n2t=class extends Pb{constructor(e){super(e,new a2t),this._vertexAttributeLocations=ZLe,this._configuration=new Za,this._layout=this.createLayout()}dispose(){}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===et.DRAPED_MATERIAL?Zp.Draped:this.parameters.worldSpace?Zp.World:Zp.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Jp.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===xn.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=gn().vec3f(B.POSITION).vec2f(B.UV0).vec3f(B.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(B.NORMAL),this.parameters.vvSizeEnabled?e.f32(B.SIZEFEATUREATTRIBUTE):e.f32(B.SIZE),this.parameters.vvColorEnabled?e.f32(B.COLORFEATUREATTRIBUTE):e.vec4f(B.COLOR),this.parameters.vvOpacityEnabled&&e.f32(B.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new l2t(this._layout,this.parameters)}requiresSlot(e,r){return r===ee.Color||r===ee.Alpha||r===ee.Highlight||r===ee.Depth?e===et.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===xn.OccludeAndTransparentStencil?e===et.OPAQUE_MATERIAL||e===et.OCCLUDER_MATERIAL||e===et.TRANSPARENT_OCCLUDER_MATERIAL:r===ee.Color||r===ee.Alpha?e===(this.parameters.writeDepth?et.TRANSPARENT_MATERIAL:et.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===et.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new o2t(e)}},o2t=class extends yse{_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(JLe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==ee.Color&&this._output!==ee.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},a2t=class extends One{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Jp.BUTT,this.anchor=cT.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}},l2t=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,s,n){const o=i.vertexAttributes.get(B.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(B.NORMAL);this._parameters.worldSpace&&E(c)&&(l=c.data);let h=1,p=0;this._parameters.vvSizeEnabled?p=i.vertexAttributes.get(B.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(B.SIZE)&&(h=i.vertexAttributes.get(B.SIZE).data[0]);let A=[1,1,1,1],_=0;this._parameters.vvColorEnabled?_=i.vertexAttributes.get(B.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(B.COLOR)&&(A=i.vertexAttributes.get(B.COLOR).data);let w=0;this._parameters.vvOpacityEnabled&&(w=i.vertexAttributes.get(B.OPACITYFEATUREATTRIBUTE).data[0]);const T=new Float32Array(s.buffer);let C=n*(this.vertexBufferLayout.stride/4);const M=(k,F,G,z)=>{if(T[C++]=k[0],T[C++]=k[1],T[C++]=k[2],T[C++]=G[0],T[C++]=G[1],T[C++]=F[0],T[C++]=F[1],T[C++]=F[2],this._parameters.worldSpace&&(T[C++]=l[0],T[C++]=l[1],T[C++]=l[2]),this._parameters.vvSizeEnabled?T[C++]=p:T[C++]=h,this._parameters.vvColorEnabled)T[C++]=_;else{const Z=Math.min(4*z,A.length-4);T[C++]=A[Z+0],T[C++]=A[Z+1],T[C++]=A[Z+2],T[C++]=A[Z+3]}this._parameters.vvOpacityEnabled&&(T[C++]=w)};let O;(function(k){k[k.ASCENDING=1]="ASCENDING",k[k.DESCENDING=-1]="DESCENDING"})(O||(O={}));const $=(k,F)=>{const G=$e(c2t,o[3*k],o[3*k+1],o[3*k+2]),z=u2t;let Z=k+F;do $e(z,o[3*Z],o[3*Z+1],o[3*Z+2]),Z+=F;while(Zv(G,z)&&Z>=0&&Z<a);e&&(Mt(G,G,e),Mt(z,z,e)),M(G,z,[-1,-1],k),M(G,z,[1,-1],k),M(G,z,[1,1],k),M(G,z,[-1,-1],k),M(G,z,[1,1],k),M(G,z,[-1,1],k)},L=this._parameters.placement;L!=="begin"&&L!=="begin-end"||$(0,O.ASCENDING),L!=="end"&&L!=="begin-end"||$(a-1,O.DESCENDING)}};const c2t=V(),u2t=V(),Gl={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},h2t={dash:Gl.dash,"dash-dot":[...Gl.dash,...Gl.dot],dot:Gl.dot,"long-dash":Gl["long-dash"],"long-dash-dot":[...Gl["long-dash"],...Gl.dot],"long-dash-dot-dot":[...Gl["long-dash"],...Gl.dot,...Gl.dot],none:null,"short-dash":Gl["short-dash"],"short-dash-dot":[...Gl["short-dash"],...Gl["short-dot"]],"short-dash-dot-dot":[...Gl["short-dash"],...Gl["short-dot"],...Gl["short-dot"]],"short-dot":Gl["short-dot"],solid:null},d2t=8;function p2t(t,e=2){return N(t)?t:{pattern:t.slice(),pixelRatio:e}}function UGt(t,e=2){return{pattern:[t,t],pixelRatio:e}}function eDe(t){return E(t)&&t.type==="style"?f2t(t.style):null}function f2t(t){return E(t)?p2t(h2t[t],d2t):null}const m2t=["polyline","polygon","extent"];let tDe=class rDe extends Jg{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=k4(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:of(1))<0)throw new ce("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=E(this.symbolLayer.marker)&&E(this._context.sharedResources.textures)?_vt(this._context.sharedResources.textures,Gwt(this.symbolLayer.marker.style)):null}_getMaterialParameters(e,r=!1){var n;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:dK(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:eDe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return ka(this.symbolLayer.material,e=>e.color)}get _markerColor(){return ka(this.symbolLayer.marker,e=>e.color)}get _lineMaterial(){return N(this._lineMaterialCached)&&(this._lineMaterialCached=new MC(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return N(this._ringMaterialCached)&&(this._ringMaterialCached=new MC(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return N(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new MC({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return N(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new MC({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return N(this._markerMaterialCached)&&E(this.symbolLayer.marker)&&E(this._markerTexture)&&(this._markerMaterialCached=new n2t({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=en(this._markerTexture)}_getDrivenSize(e){return this._drivenProperties.size&&e.size?ll(z1t(e.size)):1}_getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?xy(this._fastUpdates.visualVariables.size.field,e):null}_getDrivenColor(e){const r=Nr(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}_getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?xy(this._fastUpdates.visualVariables.color.field,e):null}_getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?xy(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,m2t,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new K0);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!B4(this._fastUpdates,r,this._vvConvertOptions))return Qo.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return Qo.Fast_Update}prepareSymbolLayerPatch(e){var n,o;if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};((n=r.size)==null?void 0:n.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=dK(gr(r.cap.newValue,"butt")),delete r.cap);const s=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r))}_forEachMaterial(e){E(this._lineMaterialCached)&&e(this._lineMaterialCached),E(this._ringMaterialCached)&&e(this._ringMaterialCached),E(this._wireframeLineMaterialCached)&&e(this._wireframeLineMaterialCached),E(this._wireframeRingMaterialCached)&&e(this._wireframeRingMaterialCached),E(this._markerMaterialCached)&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,r=!1){const i=e.parameters.color,s=pa(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=Nr(i[0],i[1],i[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=qL(rDe.elevationModeChangeTypes,i,s);if(n!==Ln.UPDATE)return n;const o=ff(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof Ki)return sf.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const s=e.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=Jo(),c=t2t(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),h=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let _=0;_<c.lines.length;_++){const w=c.lines[_],T=w.position,C=w.mapPositions;if(E(this._context.clippingExtent)&&(Fs(l),Dd(l,C),!v0(l,this._context.clippingExtent)))continue;const M=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,e,T,C,n.type,o$.ELEVATED,i);a.push(M),Qi.LINE_WIREFRAMES&&a.push(M.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),E(this._markerMaterial)&&a.push(M.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const p=new u_({geometries:a,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),A=new Zg(this,p,a,null,null,Y_t,r);return A.alignedSampledElevation=c.sampledElevation,A.needsElevationUpdates=ff(r.mode),A}_createGeometry(e,r,i,s,n,o,a){const l=n==="polygon",c=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,h=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid});return pK(e,{overlayInfo:o===o$.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:l,mapPositions:s,attributeData:{position:i,size:h?null:this._getDrivenSize(r.renderingInfo),color:c?null:this._getDrivenColor(r.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(r.graphic),colorFeature:this._getColorFeatureAttributeData(r.graphic),opacityFeature:this._getOpacityFeatureAttributeData(r.graphic)}},p)}_createAsOverlay(e,r){const i=e.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=Qi.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;E(a)&&(a.renderPriority=this._renderPriority-.001),E(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=Jo(),p=Fs(),A=r2t(s,this._context.overlaySR),_=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(A,n,_,"LineSymbol3DLayer");for(const w of A.lines){if(Fs(h),Dd(h,w.position),!v0(h,this._context.clippingExtent))continue;U3(p,h);const T=M=>{const O=this._createGeometry(M,e,w.position,void 0,s.type,o$.DRAPED,i.uid),$=new yM(O,{layerUid:r,graphicUid:i.uid});return c.push($),$};if(E(l)){const M=T(l),O=this.symbolLayer.marker.placement;O!=="begin"&&O!=="begin-end"||Dd(h,w.position,0,1),O!=="end"&&O!=="begin-end"||Dd(h,w.position,w.position.length-3,1),this._updateBoundingSphere(M,h)}const C=T(o);if(this._updateBoundingSphere(C,h),Qi.LINE_WIREFRAMES){const M=T(a);this._updateBoundingSphere(M,h)}}return new N7(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(e,r){ns(e.boundingSphere,.5*(r[0]+r[3]),.5*(r[1]+r[4]),0,.5*Math.sqrt((r[3]-r[0])*(r[3]-r[0])+(r[4]-r[1])*(r[4]-r[1])))}get _patternHidesLine(){const e=this.symbolLayer.pattern;return E(e)&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=gr(e,of(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?ll(1):1:ll(e)}_prepareMaterialPatch(e,r,i){var a;const s=r.material;if(N(s))return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(s.type==="collection")return;const n=s.type==="complete"?ka(s.newValue,l=>l.color):((a=s.diff.color)==null?void 0:a.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(_L(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete r.material}_prepareMarkerPatch(e,r){const i=r.marker;if(N(i)||i.type!=="partial"||E(i.diff.style)||E(i.diff.placement)||E(i.diff.color)&&i.diff.color.type!=="complete")return{changed:!1,useMaterialColor:N(this._markerColor)};const s=i.diff.color;if(N(s))return delete r.marker,{changed:!1,useMaterialColor:N(this._markerColor)};const n=s.newValue;return N(n)?(delete r.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterialCached,e),delete r.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(e,r,i){N(r)||i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var o$;tDe.elevationModeChangeTypes={definedChanged:Ln.RECREATE,staysOnTheGround:Ln.NONE,onTheGroundChanged:Ln.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(o$||(o$={}));let uO=null,J9=!0;function Zj(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(J9)try{return new ImageData(t,e)}catch{J9=!1}return iDe(t,e,r)}function g2t(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(J9)try{return new ImageData(t,e,r)}catch{J9=!1}const s=iDe(e,r,i);return s.data.set(t,0),s}function A2t(){return uO||(uO=document.createElement("canvas"),uO.width=1,uO.height=1),uO}function iDe(t,e,r){return r||(r=A2t()),r.getContext("2d").createImageData(t,e)}var BE;const Jj=new WeakMap;let y2t=0,Vm=BE=class extends Qe{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const s={type:"image-element",src:Gx(t.src,i),crossOrigin:t.crossOrigin};e[r]=s}else if(t instanceof HTMLCanvasElement){const s=t.getContext("2d").getImageData(0,0,t.width,t.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};e[r]=n}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:Gx(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(t)};e[r]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(Jj.has(this.data)||Jj.set(this.data,++y2t),e(Jj.get(this.data))):e()}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new BE(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return g2t(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new BE({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new BE({data:t}):M3(BE,t)}};u([d({type:String,json:{write:eb}})],Vm.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],Vm.prototype,"data",null),u([St("data")],Vm.prototype,"writeData",null),u([ft("data")],Vm.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Vm.prototype,"transparent",null),u([d({json:{write:!0}})],Vm.prototype,"wrap",void 0),u([d({readOnly:!0})],Vm.prototype,"contentHash",null),Vm=BE=u([j("esri.geometry.support.MeshTexture")],Vm);const a$=Vm;var fK;let Xf=fK=class extends Qe{constructor(t){super(t),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=E(t)?t.get(this):null;if(r)return r;const i=new fK(this.clonePropertiesWithDeduplication(e));return E(t)&&t.set(this,i),i}clonePropertiesWithDeduplication(t){return{color:E(this.color)?this.color.clone():null,colorTexture:E(this.colorTexture)?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:E(this.normalTexture)?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:E(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:E(this.normalTextureTransform)?this.normalTextureTransform:null}}};u([d({type:Ot,json:{write:!0}})],Xf.prototype,"color",void 0),u([d({type:a$,json:{write:!0}})],Xf.prototype,"colorTexture",void 0),u([d({type:a$,json:{write:!0}})],Xf.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],Xf.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],Xf.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],Xf.prototype,"doubleSided",void 0),u([d()],Xf.prototype,"colorTextureTransform",void 0),u([d()],Xf.prototype,"normalTextureTransform",void 0),Xf=fK=u([j("esri.geometry.support.MeshMaterial")],Xf);const aoe=Xf;var mK;let xp=mK=class extends aoe{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=E(t)?t.get(this):null;if(r)return r;const i=new mK(this.clonePropertiesWithDeduplication(e));return E(t)&&t.set(this,i),i}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:E(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:E(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:E(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:E(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(t):null,occlusionTextureTransform:E(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:E(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:E(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};u([d({type:Ot,json:{write:!0}})],xp.prototype,"emissiveColor",void 0),u([d({type:a$,json:{write:!0}})],xp.prototype,"emissiveTexture",void 0),u([d({type:a$,json:{write:!0}})],xp.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],xp.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],xp.prototype,"roughness",void 0),u([d({type:a$,json:{write:!0}})],xp.prototype,"metallicRoughnessTexture",void 0),u([d()],xp.prototype,"occlusionTextureTransform",void 0),u([d()],xp.prototype,"emissiveTextureTransform",void 0),u([d()],xp.prototype,"metallicRoughnessTextureTransform",void 0),xp=mK=u([j("esri.geometry.support.MeshMaterialMetallicRoughness")],xp);const sDe=xp;var d8;const nDe="esri.geometry.support.MeshVertexAttributes",bS=we.getLogger(nDe);let sp=d8=class extends Qe{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return UE(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},bS)}castPosition(t){return t&&t instanceof Float32Array&&bS.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),UE(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},bS)}castUv(t){return UE(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},bS)}castNormal(t){return UE(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},bS)}castTangent(t){return UE(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},bS)}clone(){const t={position:Te(this.position),uv:Te(this.uv),normal:Te(this.normal),tangent:Te(this.tangent),color:Te(this.color)};return new d8(t)}clonePositional(){const t={position:Te(this.position),normal:Te(this.normal),tangent:Te(this.tangent),uv:this.uv,color:this.color};return new d8(t)}};function Kj(t,e,r,i){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):t}function UE(t,e,r,i,s){if(!t)return t;if(t instanceof e)return Kj(t,i,e,s);for(const n of r)if(t instanceof n)return Kj(new e(t),i,e,s);if(Array.isArray(t))return Kj(new e(t),i,e,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function hO(t,e,r){e[r]=_2t(t)}function _2t(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}u([d({json:{write:hO}})],sp.prototype,"color",void 0),u([Hr("color")],sp.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:hO}})],sp.prototype,"position",void 0),u([Hr("position")],sp.prototype,"castPosition",null),u([d({json:{write:hO}})],sp.prototype,"uv",void 0),u([Hr("uv")],sp.prototype,"castUv",null),u([d({json:{write:hO}})],sp.prototype,"normal",void 0),u([Hr("normal")],sp.prototype,"castNormal",null),u([d({json:{write:hO}})],sp.prototype,"tangent",void 0),u([Hr("tangent")],sp.prototype,"castTangent",null),sp=d8=u([j(nDe)],sp);var ZP;const oDe="esri.geometry.support.MeshComponent",v2t=we.getLogger(oDe);let VA=ZP=class extends Qe{static from(t){return M3(ZP,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return UE(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},v2t)}castMaterial(t){return M3(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?sDe:aoe,t)}clone(){return new ZP({faces:Te(this.faces),shading:this.shading,material:Te(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:Te(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new ZP(r)}};u([d({json:{write:!0}})],VA.prototype,"faces",void 0),u([Hr("faces")],VA.prototype,"castFaces",null),u([d({type:aoe,json:{write:!0}})],VA.prototype,"material",void 0),u([Hr("material")],VA.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],VA.prototype,"shading",void 0),u([d({type:Boolean})],VA.prototype,"trustSourceNormals",void 0),VA=ZP=u([j(oDe)],VA);const b2t=VA,k7=we.getLogger("esri.geometry.support.meshUtils.normalProjection");function w2t(t,e,r,i,s){return U7(i)?(B7(Ty.TO_PCPF,ks.fromTypedArray(t),cc.fromTypedArray(e),cc.fromTypedArray(r),i,ks.fromTypedArray(s)),s):(k7.error("Cannot convert spatial reference to PCPF"),s)}function VGt(t,e,r,i,s){return U7(i)?(B7(Ty.FROM_PCPF,ks.fromTypedArray(t),cc.fromTypedArray(e),cc.fromTypedArray(r),i,ks.fromTypedArray(s)),s):(k7.error("Cannot convert to spatial reference from PCPF"),s)}function zGt(t,e,r){return Dn(t,e,0,r,EU(e),0,t.length/3),r}function GGt(t,e,r){return Dn(t,EU(r),0,e,r,0,t.length/3),e}function x2t(t,e,r){if(N(t))return e;const i=cc.fromTypedArray(t),s=cc.fromTypedArray(e);return YL(s,i,r),e}function T2t(t,e,r){if(N(t))return e;aM(Ma,r);const i=ks.fromTypedArray(t),s=ks.fromTypedArray(e);return mb(s,i,Ma),Cse(Ma)||Gne(s,s),e}function S2t(t,e,r){if(N(t))return e;aM(Ma,r);const i=ks.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),s=ks.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT);if(mb(s,i,Ma),Cse(Ma)||Gne(s,s),t!==e)for(let n=3;n<t.length;n+=4)e[n]=t[n];return e}function E2t(t,e,r,i,s){if(!U7(i))return k7.error("Cannot convert spatial reference to PCPF"),s;B7(Ty.TO_PCPF,ks.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),cc.fromTypedArray(e),cc.fromTypedArray(r),i,ks.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function jGt(t,e,r,i,s){if(!U7(i))return k7.error("Cannot convert to spatial reference from PCPF"),s;B7(Ty.FROM_PCPF,ks.fromTypedArray(t,16),cc.fromTypedArray(e),cc.fromTypedArray(r),i,ks.fromTypedArray(s,16));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function B7(t,e,r,i,s,n){if(!e)return;const o=r.count,a=EU(s);if(aDe(s))for(let l=0;l<o;l++)i.getVec(l,RN),e.getVec(l,fm),G0(a,RN,ON,a),hf(Ma,ON),t===Ty.FROM_PCPF&&df(Ma,Ma),Ph(fm,fm,Ma),n.setVec(l,fm);else for(let l=0;l<o;l++){i.getVec(l,RN),e.getVec(l,fm),G0(a,RN,ON,a),hf(Ma,ON);const c=bk(r.get(l,1));let h=Math.cos(c);t===Ty.TO_PCPF&&(h=1/h),Ma[0]*=h,Ma[1]*=h,Ma[2]*=h,Ma[3]*=h,Ma[4]*=h,Ma[5]*=h,t===Ty.FROM_PCPF&&df(Ma,Ma),Ph(fm,fm,Ma),qe(fm,fm),n.setVec(l,fm)}return n}function U7(t){return aDe(t)||C2t(t)}function aDe(t){return t.isWGS84||Ewe(t)||Gg(t)||jg(t)}function C2t(t){return t.isWebMercator}var Ty;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(Ty||(Ty={}));const RN=V(),fm=V(),ON=ot(),Ma=mn();let lDe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=ny.KTX2_ENCODING}};function Tx(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function M2t(t){return new Promise((e,r)=>{const i=new Blob([t]),s=new FileReader;s.onload=()=>{const n=s.result;e(JSON.parse(n))},s.onerror=n=>{r(n)},s.readAsText(i)})}async function R2t(t,e){return e===ny.KTX2_ENCODING?new lDe(t):new Promise((r,i)=>{const s=new Blob([t],{type:e}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=h=>{URL.revokeObjectURL(n),i(h),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}function cg(t){if(N(t))return null;const e=E(t.offset)?t.offset:R4e,r=E(t.rotation)?t.rotation:0,i=E(t.scale)?t.scale:O4e,s=u8(1,0,0,0,1,0,e[0],e[1],1),n=u8(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=u8(i[0],0,0,0,i[1],0,0,0,1),a=Uu();return oM(a,n,o),oM(a,s,a),a}function O2t(t){const e=new Di,{vertex:r,fragment:i}=e;return e.include(Fu,t),e.include($T,t),e.include(W4e,t),Uh(r,t),t.stippleEnabled&&(e.attributes.add(B.UV0,"vec2"),e.attributes.add(B.AUXPOS1,"vec3"),r.uniforms.add(new hi("viewport",(s,n)=>n.camera.fullViewport))),e.attributes.add(B.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(I`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(r.code.add(I`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?r.uniforms.add(new nt("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):r.code.add(I`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(I`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?r.code.add(I`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(I`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new nt("stipplePatternPixelSize",s=>Hne(s))),r.code.add(I`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(I`}`),t.output===ee.Highlight&&e.include(a_,t),e.include(ho,t),i.uniforms.add(new nt("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new hi("constantColor",s=>s.color)),i.code.add(I`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===ee.ObjectAndLayerIdColor?I`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${I.float(Il)}) {
      discard;
    }

    ${t.output===ee.Color?I`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===ee.Highlight?I`outputHighlight();`:""}
  }
  `),e}const P2t=Object.freeze(Object.defineProperty({__proto__:null,build:O2t},Symbol.toStringTag,{value:"Module"}));let cDe=class uDe extends Vi{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==ee.Highlight}initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2}initializeProgram(e){return new Fi(e.rctx,uDe.shader.get().build(this.configuration),Pi)}initializePipeline(){const e=this.configuration,r=Aa(tt.SRC_ALPHA,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>Rr({blending:n,depthTest:Wne,depthWrite:o,colorWrite:zr,stencilWrite:e.hasOccludees?Vg:null,stencilTest:e.hasOccludees?s?gb:$b:null});return e.output===ee.Color?(this._occludeePipelineState=i(!0,e.transparent||this._stippleEnabled?r:null,qu),i(!1,e.transparent||this._stippleEnabled?r:null,qu)):i(!1)}get primitiveType(){return Ar.LINES}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};cDe.shader=new Ni(P2t,()=>be(()=>import("./NativeLine.glsl-8f5b0ca9.js"),[]));let ud=class extends $a{constructor(){super(...arguments),this.output=ee.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};u([ie({count:ee.COUNT})],ud.prototype,"output",void 0),u([ie()],ud.prototype,"hasSlicePlane",void 0),u([ie()],ud.prototype,"hasVertexColors",void 0),u([ie()],ud.prototype,"transparent",void 0),u([ie()],ud.prototype,"draped",void 0),u([ie()],ud.prototype,"stippleEnabled",void 0),u([ie()],ud.prototype,"stippleOffColorEnabled",void 0),u([ie()],ud.prototype,"stipplePreferContinuous",void 0),u([ie()],ud.prototype,"hasOccludees",void 0),u([ie({constValue:!1})],ud.prototype,"stippleRequiresClamp",void 0),u([ie({constValue:!1})],ud.prototype,"stippleScaleWithLineWidth",void 0),u([ie({constValue:!1})],ud.prototype,"stippleRequiresStretchMeasure",void 0);var K9;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(K9||(K9={}));let _ge=class extends Pb{constructor(e){super(e,new L2t),this._configuration=new ud}getConfiguration(e,r){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===et.DRAPED_MATERIAL;const i=E(this.parameters.stipplePattern);return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&E(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!APe(r))return void we.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(B.POSITION).data,l=i.camera,c=N2t;ga(c,i.point);const h=2;$e(dO[0],c[0]-h,c[1]+h,0),$e(dO[1],c[0]+h,c[1]+h,0),$e(dO[2],c[0]+h,c[1]-h,0),$e(dO[3],c[0]-h,c[1]-h,0);for(let T=0;T<4;T++)if(!l.unprojectFromRenderScreen(dO[T],pA[T]))return;Xl(l.eye,pA[0],pA[1],eH),Xl(l.eye,pA[1],pA[2],tH),Xl(l.eye,pA[2],pA[3],rH),Xl(l.eye,pA[3],pA[0],iH);let p=Number.MAX_VALUE,A=0;for(let T=0;T<a.length-5;T+=3){if(Dc[0]=a[T]+r[12],Dc[1]=a[T+1]+r[13],Dc[2]=a[T+2]+r[14],Nc[0]=a[T+3]+r[12],Nc[1]=a[T+4]+r[13],Nc[2]=a[T+5]+r[14],Rs(eH,Dc)<0&&Rs(eH,Nc)<0||Rs(tH,Dc)<0&&Rs(tH,Nc)<0||Rs(rH,Dc)<0&&Rs(rH,Nc)<0||Rs(iH,Dc)<0&&Rs(iH,Nc)<0)continue;if(l.projectToRenderScreen(Dc,dw),l.projectToRenderScreen(Nc,pw),dw[2]<0&&pw[2]>0){Be(mm,Dc,Nc);const M=l.frustum,O=-Rs(M[Ms.NEAR],Dc)/He(mm,M[Ms.NEAR]);Me(mm,mm,O),ke(Dc,Dc,mm),l.projectToRenderScreen(Dc,dw)}else if(dw[2]>0&&pw[2]<0){Be(mm,Nc,Dc);const M=l.frustum,O=-Rs(M[Ms.NEAR],Nc)/He(mm,M[Ms.NEAR]);Me(mm,mm,O),ke(Nc,Nc,mm),l.projectToRenderScreen(Nc,pw)}else if(dw[2]<0&&pw[2]<0)continue;dw[2]=0,pw[2]=0;const C=Vre(gx(dw,pw,wge),c);C<p&&(p=C,Oe(vge,Dc),Oe(bge,Nc),A=T/3)}const _=i.rayBegin,w=i.rayEnd;if(p<h*h){let T=Number.MAX_VALUE;if(dSe(gx(vge,bge,wge),gx(_,w,D2t),hw)){Be(hw,hw,_);const C=st(hw);Me(hw,hw,1/C),T=C/Is(_,w)}o(T,hw,A,!1)}}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(B.POSITION).data,l=e.vertexAttributes.get(B.SIZE),c=l?l.data[0]:0,h=s[0],p=s[1],A=((c+1)/2+4)*e.screenToWorldRatio;let _=Number.MAX_VALUE,w=0;for(let T=0;T<a.length-5;T+=3){const C=a[T],M=a[T+1],O=h-C,$=p-M,L=a[T+3]-C,k=a[T+4]-M,F=ze((L*O+k*$)/(L*L+k*k),0,1),G=L*F-O,z=k*F-$,Z=G*G+z*z;Z<_&&(_=Z,w=T/3)}_<A*A&&n(o.dist,o.normal,w,!1)}requiresSlot(e,r){return!(r!==ee.Color&&r!==ee.Highlight&&r!==ee.ObjectAndLayerIdColor||e!==et.OPAQUE_MATERIAL&&e!==et.DRAPED_MATERIAL)}createGLMaterial(e){return new I2t(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?uLe:Hvt;return N(this.parameters.stipplePattern)?new sR(e):new $2t(e.clone().vec3f(B.AUXPOS1).vec2f(B.UV0))}},I2t=class extends Ob{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===ee.Color&&this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,r)),this._stipplePattern=r),this.ensureTechnique(cDe,e)}},$2t=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(B.POSITION).length}write(e,r,i,s,n){b$e(i,this.vertexBufferLayout,e,r,s,n),this._writeAuxpos1(e,i,s,n),this._writeUV0(e,i,s,n)}_writeAuxpos1(e,r,i,s){const n=i.getField(B.AUXPOS1,ks),o=r.indices.get(B.POSITION),a=r.vertexAttributes.get(B.POSITION).data,l=e,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const A of[1,0]){const _=3*o[p+A],w=a[_],T=a[_+1],C=a[_+2],M=l[0]*w+l[4]*T+l[8]*C+l[12],O=l[1]*w+l[5]*T+l[9]*C+l[13],$=l[2]*w+l[6]*T+l[10]*C+l[14];h[s]=M,h[s+1]=O,h[s+2]=$,s+=c}}_writeUV0(e,r,i,s){var $;const n=i.getField(B.UV0,o_),o=r.indices.get(B.POSITION),a=r.vertexAttributes.get(B.POSITION).data,l=($=r.vertexAttributes.get(B.DISTANCETOSTART))==null?void 0:$.data,c=n.typedBufferStride,h=n.typedBuffer;let p=0;h[s*=c]=K9.START,h[s+1]=p,s+=c;const A=3*o[0],_=$e(Dc,a[A],a[A+1],a[A+2]);e&&Mt(_,_,e);const w=Nc,T=o.length-1;let C=1;const M=l?(L,k,F)=>p=l[F]:(L,k,F)=>p+=Is(L,k);for(let L=1;L<T;L+=2){const k=3*o[L];$e(w,a[k],a[k+1],a[k+2]),e&&Mt(w,w,e),M(_,w,C++);for(let F=0;F<2;++F)h[s]=1-F,h[s+1]=p,s+=c;Oe(_,w)}const O=3*o[T];$e(w,a[O],a[O+1],a[O+2]),e&&Mt(w,w,e),M(_,w,C),h[s]=K9.END,h[s+1]=p}},L2t=class extends rR{constructor(){super(...arguments),this.color=Gp,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const Dc=V(),Nc=V(),mm=V(),hw=V(),dw=Rl(),pw=Rl(),vge=V(),bge=V(),wge=Q0(),D2t=Q0(),N2t=V(),dO=[Rl(),Rl(),Rl(),Rl()],pA=[V(),V(),V(),V()],eH=Hi(),tH=Hi(),rH=Hi(),iH=Hi(),F2t=["mesh"];class k2t extends Jg{constructor(e,r,i,s){super(e,r,i,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Qi.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new _ge({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new _ge({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),e=>e.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,F2t,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new K0),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._materials.forEach(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{const n=r(s);E(n)&&n.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,pb)}slicePlaneEnabledChanged(e,r){return this._materials.forEach(i=>{i.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{const s=r(i);E(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach(r=>r.material.setParameters({usePBR:e})),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return N(e)?"-":e instanceof Ot?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_materialProperties(e,r,i){const s=this._materialPropertiesDefault(e,i);if(!r.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=r.material,p=this._colorOrTextureUid(n),A=this._colorOrTextureUid(o),_=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${A},ntmuid:${_},ds:${l},ac:${c},am:${h}`,r.material instanceof sDe){const{metallic:w,roughness:T,metallicRoughnessTexture:C,emissiveColor:M,emissiveTexture:O,occlusionTexture:$}=r.material,L=this._colorOrTextureUid(C),k=this._colorOrTextureUid(M),F=this._colorOrTextureUid(O),G=this._colorOrTextureUid($);s.metallic=w,s.roughness=T,s.metallicRoughnessTexture=C,s.emissiveColor=M,s.emissiveTexture=O,s.occlusionTexture=$,s.colorTextureTransform=r.material.colorTextureTransform,s.normalTextureTransform=r.material.normalTextureTransform,s.emissiveTextureTransform=r.material.emissiveTextureTransform,s.occlusionTextureTransform=r.material.occlusionTextureTransform,s.metallicRoughnessTextureTransform=r.material.metallicRoughnessTextureTransform,s.uid=`${s.uid},mrm:${w},mrr:${T},mrt:${L},emuid:${k},etmuid:${F},otmuid:${G}`}return s}_setInternalColorValueParameters(e,r){r.diffuse=Ot.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,ms.Opaque);return E(r)?r.id:null}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const s=`${e.contentHash}/${r}`;let n=this._textures.get(s);return n||(n=new IT(Tx(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!Tx(i)&&r!==ms.Opaque,encoding:Tx(i)&&E(i.encoding)?i.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return pr.CLAMP_TO_EDGE;case"mirror":return pr.MIRRORED_REPEAT;default:return pr.REPEAT}}_setInternalMaterialParameters(e,r){if(E(e.color)&&this._setInternalColorValueParameters(e.color,r),E(e.colorTexture)){const i=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);E(i)?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.params.preMultiplyAlpha):r.textureId=void 0}E(e.normalTexture)&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),E(e.emissiveColor)&&(r.emissiveFactor=Ot.toUnitRGB(e.emissiveColor)),E(e.emissiveTexture)&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),E(e.occlusionTexture)&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),E(e.metallicRoughnessTexture)&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=cg(e.colorTextureTransform),r.normalTextureTransformMatrix=cg(e.normalTextureTransform),r.occlusionTextureTransformMatrix=cg(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=cg(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=cg(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const r=this._drivenProperties.color;let i=E(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(r)e.externalColor=Gp;else{const s=E(this.symbolLayer.material)?this.symbolLayer.material.color:null;E(s)?e.externalColor=Ot.toUnitRGBA(s):(i=null,e.externalColor=Gp)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(N(r))return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){var w,T,C;const i=(w=r.material)==null?void 0:w.color,s=(T=r.material)==null?void 0:T.colorTexture,n=(C=r.material)==null?void 0:C.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(e)||E(i)&&i.a<1||E(s)&&s.transparent||o),l=this._materialProperties(e,r,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,A={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:sc,diffuse:hg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:$s.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(A.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),r.material&&(A.doubleSided=r.material.doubleSided,A.cullFace=r.material.doubleSided?$s.None:$s.Back,A.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(A),this._setMaterialTransparentParameter(A,h),this._setInternalMaterialParameters(l,A);const _=new qy(A);return h.material=_,this._materials.set(l.uid,h),this._context.stage.add(_),_}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?ms.MaskBlend:ms.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?ms.Opaque:r.alphaMode==="mask"?ms.Mask:ms.Blend}_addDebugNormals(e,r){const i=r.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let _=0;_<i;_++){const w=r[_],T=w.vertexAttributes.get(B.POSITION),C=w.vertexAttributes.get(B.NORMAL),M=w.indices.get(B.POSITION),O=w.indices.get(B.NORMAL),$=T.data,L=C.data;for(let k=0;k<M.length;k++){const F=3*M[k],G=3*O[k];for(let z=0;z<3;z++)o.push($[F+z]);for(let z=0;z<3;z++)o.push($[F+z]+L[G+z]*n);if(a.push(a.length),a.push(a.length),k%3==0){this._calculateFaceNormal($,M,k,TS),this._getFaceVertices($,M,k,_l,wS,xS),ke(_l,_l,wS),ke(_l,_l,xS),Me(_l,_l,1/3);for(let z=0;z<3;z++)l.push(_l[z]);for(let z=0;z<3;z++)l.push(_l[z]+TS[z]*n);c.push(c.length),c.push(c.length)}}}const h=r[0].transformation,p=new Mo(this._debugVertexNormalMaterial,[[B.POSITION,new Rt(o,3,!0)]],[[B.POSITION,a]],null,Xn.Line);r.push(p),p.transformation=h;const A=new Mo(this._debugFaceNormalMaterial,[[B.POSITION,new Rt(l,3,!0)]],[[B.POSITION,c]],null,Xn.Line);A.transformation=h,r.push(A)}_createAs3DShape(e,r,i,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r,s);if(N(o))return null;const{geometries:a,objectTransformation:l}=o;Qi.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new u_({geometries:a,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});c.transformation=l;const h=b4e(this.symbolLayer,{opacity:this._getLayerOpacity()}),p=E(h)?new t1t(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,A=new Zg(this,c,a,null,null,P4,i,p);A.needsElevationUpdates=pb(i.mode),A.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c);const{elevationProvider:_,renderCoordsHelper:w}=this._context,T=(C,M)=>iR(C,_,i,w,M);return A.alignedSampledElevation=P4(A,i,_.spatialReference,T,w),A}_getCenterPointInElevationSR(e){const r=c_(0,0,0,E(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);return OTe([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,s){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,s);case"flat":return this._createComponentNormalsFlat(e,s);case"smooth":return this._createComponentNormalsSmooth(e,s)}}_createComponentNormalsSource(e,r,i,s){if(N(r))return this._createComponentNormalsFlat(e,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(e,s,o,TS);for(let a=0;a<3;a++){const l=3*s[o+a];_l[0]=r[l+0],_l[1]=r[l+1],_l[2]=r[l+2],He(TS,_l)<0&&(r[l+0]=-r[l+0],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return new sH(r,s,n)}_createComponentNormalsFlat(e,r){const i=uo(r.length),s=new Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(e,r,n,TS);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return new sH(i,s,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,TS);for(let l=0;l<3;l++){const c=r[o+l];let h=i[c];h||(h={normal:V(),count:0},i[c]=h),ke(h.normal,h.normal,a),h.count++}}const s=uo(3*r.length),n=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(qe(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new sH(s,n,!1)}_getFaceVertices(e,r,i,s,n,o){const a=3*r[i+0],l=3*r[i+1],c=3*r[i+2];s[0]=e[a+0],s[1]=e[a+1],s[2]=e[a+2],n[0]=e[l+0],n[1]=e[l+1],n[2]=e[l+2],o[0]=e[c+0],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,s){return this._getFaceVertices(e,r,i,_l,wS,xS),Be(wS,wS,_l),Be(xS,xS,_l),Xt(_l,wS,xS),qe(s,_l),s}_getOrCreateComponents(e){return gr(e.components,B2t)}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const s=r.reprojection===fd.ECEF?r.transformBeforeProject:null;if(E(s)&&(i=x2t(i,new Float64Array(i.length),s)),r.reprojection===fd.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=E(s)?i:new Float64Array(i.length);return Dn(i,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(e,r,i){let s=e.vertexAttributes.normal;if(N(s))return null;const n=i.reprojection===fd.ECEF?i.transformBeforeProject:null;if(E(n)&&(s=T2t(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===fd.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=E(n)?s:new Float32Array(s.length);return w2t(s,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let s=e.vertexAttributes.tangent;if(N(s))return null;const n=i.reprojection===fd.ECEF?i.transformBeforeProject:null;if(E(n)&&(s=S2t(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===fd.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=E(n)?s:new Float32Array(s.length);return E2t(s,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const r=this._getVertexOpacityAndColor(e),i=Dbt(pa(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return LLe(r,i,s),s}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(E(s)&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(E(o)&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(E(n)&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),h=this._createSymbolColorBuffer(r),p=this._createNormalBuffer(e,l,a),A=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:A,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===fd.NONE&&E(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(e,l,p,A),geometryTransformation:a.reprojection===fd.NONE&&E(a.geometryTransformation)?a.geometryTransformation:ot()}}_computeReprojectionInfo(e){const r=E(e.transform),i=r&&e.transform.geographic||this._context.renderCoordsHelper.viewingMode===_t.Local?fd.NONE:fd.ECEF;if(r){if(i===fd.NONE){const n=ot();return G0(e.spatialReference,e.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:n,geometryTransformation:H3(e.transform.localMatrix),needsBufferCopy:!1}}const s=fU(ot(),e.transform.origin);return $n(s,s,e.transform.localMatrix),{reprojection:i,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;PN[0]=o.x,PN[1]=o.y,PN[2]=o.z;const a=ot();G0(e.spatialReference,PN,a,n);const l=cc.fromTypedArray(r);if(ul(xge,a),YL(l,l,xge),E(i)||E(s)){if(hf(pO,a),df(pO,pO),E(i)){const c=ks.fromTypedArray(i);mb(c,c,pO)}if(E(s)){const c=ks.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);mb(c,c,pO)}}return a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces?r.faces:cM(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let s;const n=r.length/3;return E(i)&&!e.spatialReference.equals(i)?(s=new Float64Array(r.length),Dn(e.vertexAttributes.position,e.spatialReference,0,s,i,0,n)):s=r,Fs(nH),Dd(nH,s,0,n),!v0(nH,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!jx(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,r);if(N(s))return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:p,geometryTransformation:A}=s,_=this._getOrCreateComponents(e),w=new Array;let T=!1;for(const C of _){if(!this._validateFaces(e,C))return null;const M=this._getOrCreateFaces(e,C);if(M.length===0)continue;const O=this._createComponentNormals(n,c,C,M);O.didFlipNormals&&(T=!0);const $=[[B.POSITION,new Rt(n,3,!0)],[B.NORMAL,new Rt(O.normals,3,!0)]],L=[[B.POSITION,M],[B.NORMAL,O.indices]];E(a)&&($.push([B.COLOR,new Rt(a,4,!0)]),L.push([B.COLOR,M])),E(l)&&($.push([B.SYMBOLCOLOR,new Rt(l,4,!0)]),L.push([B.SYMBOLCOLOR,new Array(M.length).fill(0)])),E(o)&&($.push([B.UV0,new Rt(o,2,!0)]),L.push([B.UV0,M])),E(h)&&($.push([B.TANGENT,new Rt(h,4,!0)]),L.push([B.TANGENT,M]));const k=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),F=this._getOrCreateMaterial(e,C),G=new Mo(F,$,L,null,Xn.Mesh,k);G.transformation=A,w.push(G)}return T&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:w,objectTransformation:p}}}let sH=class{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}};const PN=V(),_l=V(),wS=V(),xS=V(),TS=V(),xge=ot(),pO=mn(),nH=Jo(),B2t=[new b2t];var fd;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(fd||(fd={}));let U2t=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){Fne(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>iR(o,e,this.elevationContext,r,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r);E(n)&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=V()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,gm),Mt(e,this._lodRenderer.baseBoundingSphere.center,gm)}getBoundingBoxObjectSpace(e=Jo()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,gm);const r=this._lodRenderer.baseBoundingBox;Fs(e);for(let i=0;i<8;++i)$e(np,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),Mt(np,np,gm),Fg(e,np);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,gm),e.render.origin[0]+=gm[12],e.render.origin[1]+=gm[13],e.render.origin[2]+=gm[14],e.render.num++}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=V2t,l=yre(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,gm);for(let h=0;h<l;h++){const p=a[h];np[0]=o[p[0]],np[1]=o[p[1]],np[2]=o[p[2]],Mt(np,np,gm),fw[3*h+0]=np[0],fw[3*h+1]=np[1],fw[3*h+2]=np[2]}if(!e(fw,0,l))return null;Fs(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],fw[h+p]),o[p+3]=Math.max(o[p+3],fw[h+p]);c&&i.push({location:fw.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&(_0(o,oH),this.elevationContext.mode!=="absolute-height")){let h;const p=Lne(o,r.service.spatialReference,r);try{h=await r.service.queryElevation(oH[0],oH[1],s,p,"ground")}catch{}E(h)&&Exe(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,r){if(e===zy.Highlight){const i=new b9(e);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const fw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],np=V(),oH=V(),V2t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],gm=ot();function z2t(t){const e=new Array;return t.stageResources.geometries.forEach(r=>{const i=t.stageResources.textures;e.push(new y4e(r,i))}),{components:e,minScreenSpaceRadius:gr(t.lodThreshold,0),pivotOffset:t.pivotOffset}}function G2t(t){return{levels:t.map(e=>z2t(e))}}function j2t(t,e,r){if(t.count!==e.count)return void O7.error("source and destination buffers need to have the same number of elements");const i=t.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],A=r[8],_=r[9],w=r[10],T=r[11],C=r[12],M=r[13],O=r[14],$=r[15],L=t.typedBuffer,k=t.typedBufferStride,F=e.typedBuffer,G=e.typedBufferStride;for(let z=0;z<i;z++){const Z=z*k,J=z*G,te=F[J],re=F[J+1],Ae=F[J+2],ve=F[J+3];L[Z]=s*te+l*re+A*Ae+C*ve,L[Z+1]=n*te+c*re+_*Ae+M*ve,L[Z+2]=o*te+h*re+w*Ae+O*ve,L[Z+3]=a*te+p*re+T*Ae+$*ve}}function hDe(t,e,r){if(t.count!==e.count)return void O7.error("source and destination buffers need to have the same number of elements");const i=t.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],A=r[8],_=t.typedBuffer,w=t.typedBufferStride,T=e.typedBuffer,C=e.typedBufferStride;for(let M=0;M<i;M++){const O=M*w,$=M*C,L=T[$],k=T[$+1],F=T[$+2],G=T[$+3];_[O]=s*L+a*k+h*F,_[O+1]=n*L+l*k+p*F,_[O+2]=o*L+c*k+A*F,_[O+3]=G}}function H2t(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],A=n[c+2],_=h*h+p*p+A*A;if(_>0){const w=1/Math.sqrt(_);i[l]=w*h,i[l+1]=w*p,i[l+2]=w*A}}}function gK(t,e,r){const i=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,h=l*a;s[c]=r*o[h],s[c+1]=r*o[h+1],s[c+2]=r*o[h+2],s[c+3]=r*o[h+3]}}function q2t(t,e,r){const i=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,h=l*a;s[c]=o[h]>>r,s[c+1]=o[h+1]>>r,s[c+2]=o[h+2]>>r,s[c+3]=o[h+3]>>r}}Object.freeze(Object.defineProperty({__proto__:null,normalize:H2t,scale:gK,shiftRight:q2t,transformMat3:hDe,transformMat4:j2t},Symbol.toStringTag,{value:"Module"}));function W2t(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)i[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:W2t},Symbol.toStringTag,{value:"Module"}));function Y2t(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)i[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:Y2t},Symbol.toStringTag,{value:"Module"}));function Q2t(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=n[c],l+=s,c+=o}function p8(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,copy:Q2t,makeDense:p8},Symbol.toStringTag,{value:"Module"}));function dDe(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=n[c],i[l+1]=n[c+1],l+=s,c+=o}function pDe(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;if(Adt(e.elementType)){const h=ydt(e.elementType);if(gdt(e.elementType))for(let p=0;p<a;++p)i[l]=Math.max(n[c]/h,-1),i[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let p=0;p<a;++p)i[l]=n[c]/h,i[l+1]=n[c+1]/h,l+=s,c+=o}else dDe(t,e,r);return t}function X2t(t,e,r,i){const s=t.typedBuffer,n=t.typedBufferStride,o=(i==null?void 0:i.count)??t.count;let a=((i==null?void 0:i.dstIndex)??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:dDe,fill:X2t,normalizeIntegerBuffer:pDe},Symbol.toStringTag,{value:"Module"}));function V7(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=n[c],i[l+1]=n[c+1],i[l+2]=n[c+2],l+=s,c+=o}function Z2t(t,e,r,i,s){const n=t.typedBuffer,o=t.typedBufferStride,a=(s==null?void 0:s.count)??t.count;let l=((s==null?void 0:s.dstIndex)??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:V7,fill:Z2t},Symbol.toStringTag,{value:"Module"}));function fDe(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=r?r.count:e.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=n[c],i[l+1]=n[c+1],i[l+2]=n[c+2],i[l+3]=n[c+3],l+=s,c+=o}function mDe(t,e,r,i,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=(n==null?void 0:n.count)??t.count;let c=((n==null?void 0:n.dstIndex)??0)*a;for(let h=0;h<l;++h)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:fDe,fill:mDe},Symbol.toStringTag,{value:"Module"}));function z2(t,e){return new t(new ArrayBuffer(e*t.ElementCount*fPe(t.ElementType)))}let gDe=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return zg(e)?(di(r),wte(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(N(this._streamDataRequester))return(await Ys(r,{responseType:J2t[e]})).data;const s=await B0(this._streamDataRequester.request(r,e,i));if(s.ok===!0)return s.value;throw Sh(s.error),new ce("",`Request for resource failed: ${s.error}`)}};const J2t={image:"image",binary:"array-buffer",json:"json"};function K2t(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function ext(t,e={}){return{data:t,parameters:{wrap:{s:pr.REPEAT,t:pr.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let _M=class{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new ce(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new _M(this.major,this.minor,this._context)}static parse(e,r=""){const[i,s]=e.split("."),n=/^\s*\d+\s*$/;if(!i||!i.match||!i.match(n))throw new ce((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s||!s.match||!s.match(n))throw new ce((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(s,10);return new _M(o,a,r)}},Tge=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var l$,Sge;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(l$||(l$={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Sge||(Sge={}));const ADe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},txt={pbrMetallicRoughness:ADe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},rxt={ESRI_externalColorMixMode:"tint"},Ege=(t={})=>{const e={...ADe,...t.pbrMetallicRoughness},r=ixt({...rxt,...t.extras});return{...txt,...t,pbrMetallicRoughness:e,extras:r}};function ixt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const sxt={magFilter:Bt.LINEAR,minFilter:Bt.LINEAR_MIPMAP_LINEAR,wrapS:pr.REPEAT,wrapT:pr.REPEAT},nxt=t=>({...sxt,...t});function oxt(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(e=s||"",r=n||"","")),{dirPart:e,filePart:r}}const IN={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let axt=class $1{constructor(e,r,i,s){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=oxt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new ce("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new ce("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new ce("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(zg(r)){const o=cL(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new $1(e,r,l)}catch{}const a=wte(r);if($1._isGLBData(a))return this._fromGLBData(e,r,a)}if(r.endsWith(".gltf")){const o=await e.loadJSON(r,i);return new $1(e,r,o)}const s=await e.loadBinary(r,i);if($1._isGLBData(s))return this._fromGLBData(e,r,s);const n=await e.loadJSON(r,i);return new $1(e,r,n)}static _isGLBData(e){if(e==null)return!1;const r=new Tge(e);return r.remainingBytes()>=4&&r.readUint32()===IN.MAGIC}static async _fromGLBData(e,r,i){const s=await $1._parseGLBData(i);return new $1(e,r,s.json,s.binaryData)}static async _parseGLBData(e){const r=new Tge(e);if(r.remainingBytes()<12)throw new ce("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),s=r.readUint32(),n=r.readUint32();if(i!==IN.MAGIC)throw new ce("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<n)throw new ce("gltf-loader-error","GLB binary data is smaller than header specifies.");if(s!==2)throw new ce("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),h=r.readUint32();if(l===0){if(h!==IN.CHUNK_TYPE_JSON)throw new ce("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new ce("gltf-loader-error","No JSON data found.");o=await M2t(r.readUint8Array(c))}else if(l===1){if(h!==IN.CHUNK_TYPE_BIN)throw new ce("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else we.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new ce("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new ce("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,r);if(s.byteLength!==i.byteLength)throw new ce("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,r){if(!this.json.accessors)throw new ce("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if((i==null?void 0:i.bufferView)==null)throw new ce("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[l$.MAT2,l$.MAT3,l$.MAT4])throw new ce("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const s=this.json.bufferViews[i.bufferView],n=await this.getBuffer(s.buffer,r),o=uxt[i.type],a=hxt[i.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case qt.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case qt.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case qt.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case qt.UNSIGNED_BYTE:return p8(this._wrapAccessor(lM,i));case qt.UNSIGNED_SHORT:return p8(this._wrapAccessor(n7,i));case qt.UNSIGNED_INT:return p8(this._wrapAccessor(a7,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new ce("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==qt.FLOAT)throw new ce("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+qt[i.componentType]);if(i.componentCount!==3)throw new ce("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(ks,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new ce("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==qt.FLOAT)throw new ce("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+qt[i.componentType]);if(i.componentCount!==3)throw new ce("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(ks,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new ce("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==qt.FLOAT)throw new ce("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+qt[i.componentType]);if(i.componentCount!==4)throw new ce("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new Gh(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new ce("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new ce("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===qt.FLOAT)return this._wrapAccessor(o_,i);if(!i.normalized)throw new ce("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return dxt(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new ce("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new ce("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===qt.FLOAT)return this._wrapAccessor(Gh,i);if(i.componentType===qt.UNSIGNED_BYTE)return this._wrapAccessor(uc,i);if(i.componentType===qt.UNSIGNED_SHORT)return this._wrapAccessor(BL,i)}else if(i.componentCount===3){if(i.componentType===qt.FLOAT)return this._wrapAccessor(ks,i);if(i.componentType===qt.UNSIGNED_BYTE)return this._wrapAccessor(w4,i);if(i.componentType===qt.UNSIGNED_SHORT)return this._wrapAccessor(o7,i)}throw new ce("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+qt[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){var n,o,a,l,c,h,p,A,_,w;let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const T=e.material!=null?Ege(this.json.materials[e.material]):Ege(),C=T.pbrMetallicRoughness,M=this.hasVertexColors(e),O=this.getTexture(C.baseColorTexture,r),$=this.getTexture(T.normalTexture,r),L=i?this.getTexture(T.occlusionTexture,r):void 0,k=i?this.getTexture(T.emissiveTexture,r):void 0,F=i?this.getTexture(C.metallicRoughnessTexture,r):void 0,G=e.material!=null?e.material:-1;s={alphaMode:T.alphaMode,alphaCutoff:T.alphaCutoff,color:C.baseColorFactor,doubleSided:!!T.doubleSided,colorTexture:await O,normalTexture:await $,name:T.name,id:G,occlusionTexture:await L,emissiveTexture:await k,emissiveFactor:T.emissiveFactor,metallicFactor:C.metallicFactor,roughnessFactor:C.roughnessFactor,metallicRoughnessTexture:await F,hasVertexColors:M,ESRI_externalColorMixMode:T.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=C==null?void 0:C.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=T.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(h=(c=T.occlusionTexture)==null?void 0:c.extensions)==null?void 0:h.KHR_texture_transform,emissiveTextureTransform:(A=(p=T.emissiveTexture)==null?void 0:p.extensions)==null?void 0:A.KHR_texture_transform,metallicRoughnessTextureTransform:(w=(_=C==null?void 0:C.metallicRoughnessTexture)==null?void 0:_.extensions)==null?void 0:w.KHR_texture_transform}}return s}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new ce("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,s=this.json.textures[i],n=nxt(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(i,s,r);return lte(this._textureCache,i,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>{throw new ce("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${p}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:h(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:h(n.wrapT),minFilter:n.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return lxt;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?r=$n(ot(),i,s.matrix):s.translation||s.rotation||s.scale?(r=H3(i),s.translation&&ju(r,r,s.translation),s.rotation&&($N[3]=jse($N,s.rotation),Ih(r,r,$N[3],$N)),s.scale&&dU(r,r,s.scale)):r=H3(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return Od(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=_M.parse(this.json.asset.version,"glTF");cxt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new ce("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(r,i);return this._textureLoaders.set(e,n),n}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new ce("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),s=this.json.images[i];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),r);return new lDe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),r)}if(s.bufferView==null)throw new ce("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new ce("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r);if(n.byteStride!=null)throw new ce("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return R2t(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await aW(Array.from(this._bufferLoaders.values())),r=await aW(Array.from(this._textureLoaders.values()));return e.reduce((i,s)=>i+((s==null?void 0:s.byteLength)??0),0)+r.reduce((i,s)=>i+(s?Tx(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const lxt=dTe(ot(),Math.PI/2),cxt=new _M(2,0,"glTF"),$N=gf(),uxt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},hxt={[qt.BYTE]:1,[qt.UNSIGNED_BYTE]:1,[qt.SHORT]:2,[qt.UNSIGNED_SHORT]:2,[qt.FLOAT]:4,[qt.UNSIGNED_INT]:4};function dxt(t){switch(t.componentType){case qt.BYTE:return new l7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case qt.UNSIGNED_BYTE:return new s7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case qt.SHORT:return new c7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case qt.UNSIGNED_SHORT:return new Use(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case qt.UNSIGNED_INT:return new Vse(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case qt.FLOAT:return new o_(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let pxt=0;async function yDe(t,e,r={},i=!0){const s=await axt.load(t,e,r),n="gltf_"+pxt++,o={lods:[],materials:new Map,textures:new Map,meta:fxt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await mxt(s,async(h,p,A,_)=>{const w=l.get(A)??0;l.set(A,w+1);const T=h.mode!==void 0?h.mode:Ar.TRIANGLES,C=T===Ar.TRIANGLES||T===Ar.TRIANGLE_STRIP||T===Ar.TRIANGLE_FAN?T:null;if(N(C))return void we.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Ar[T]+"). Skipping primitive.");if(!s.hasPositions(h))return void we.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const M=s.getPositionData(h,r),O=s.getMaterial(h,r,i),$=s.hasNormals(h)?s.getNormalData(h,r):null,L=s.hasTangents(h)?s.getTangentData(h,r):null,k=s.hasTextureCoordinates(h)?s.getTextureCoordinates(h,r):null,F=s.hasVertexColors(h)?s.getVertexColors(h,r):null,G=s.getIndexData(h,r),z={transform:H3(p),attributes:{position:await M,normal:$?await $:null,texCoord0:k?await k:null,color:F?await F:null,tangent:L?await L:null},indices:await G,primitiveType:C,material:Axt(o,await O,n)};let Z=null;E(o.meta)&&E(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(Z=o.meta.ESRI_lod.thresholds[A]),o.lods[A]=o.lods[A]||{parts:[],name:_,lodThreshold:Z},o.lods[A].parts[w]=z});for(const h of o.lods)h.parts=h.parts.filter(p=>!!p);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function fxt(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const s=i.extras;E(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function mxt(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),gxt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=r.nodes[a],h=t.getNodeTransform(a);if(c.weights!=null&&we.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const p=r.meshes[c.mesh];for(const A of p.primitives)n.push(e(A,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function gxt(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function Axt(t,e,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=ext(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:yxt.includes(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=K2t({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(s,n)}return s}const yxt=[Bt.LINEAR_MIPMAP_LINEAR,Bt.LINEAR_MIPMAP_NEAREST];function _xt(t,e=cM){return typeof t=="number"?e(t):Zee(t)||R2(t)?new Uint32Array(t):t}function vxt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=vPe(r);if(typeof t=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)if(n%2==0){const o=t[n],a=t[n+1],l=t[n+2];i[s++]=o,i[s++]=a,i[s++]=l}else{const o=t[n+1],a=t[n],l=t[n+2];i[s++]=o,i[s++]=a,i[s++]=l}}return i}function bxt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let s=0;for(let n=0;n<r;++n)i[s++]=0,i[s++]=n+1,i[s++]=n+2;return i}{const s=t[0];let n=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}}let wxt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},xxt=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new wxt,this.numberOfVertices=0}};const zA=we.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function _De(t,e){const r=await Txt(t,e),i=await Rxt(r.textureDefinitions??{},e);let s=0;for(const n in i)if(i.hasOwnProperty(n)){const o=i[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:s+qTe(r)}}async function Txt(t,e){const r=E(e)&&e.streamDataRequester;if(r)return Sxt(t,r,e);const i=await B0(Ys(t,e));if(i.ok===!0)return i.value.data;Sh(i.error),vDe(i.error)}async function Sxt(t,e,r){const i=await B0(e.request(t,"json",r));if(i.ok===!0)return i.value;Sh(i.error),vDe(i.error.details.url)}function vDe(t){throw new ce("",`Request for object resource failed: ${t}`)}function Ext(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(zA.warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(zA.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(zA.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(zA.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else zA.warn("Indexed geometries must specify faces"),i=!1;break}default:zA.warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(zA.warn("Geometry requires material"),i=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(zA.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function Cxt(t,e){const r=new Array,i=new Array,s=new Array,n=new ZM,o=t.resource,a=_M.parse(o.version||"1.0","wosr");Pxt.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},p=t.textures;let A=0;const _=new Map;for(let w=0;w<c.length;w++){const T=c[w];if(!Ext(T))continue;const C=Oxt(T),M=T.params.vertexAttributes,O=[];for(const te in M){const re=M[te],Ae=re.values;O.push([te,new Rt(Ae,re.valuesPerElement,!0)])}const $=[];if(T.params.topology!=="PerAttributeArray"){const te=T.params.faces;for(const re in te)$.push([re,te[re].values])}const L=C.texture,k=p&&p[L];if(k&&!_.has(L)){const{image:te,params:re}=k,Ae=new IT(te,re);i.push(Ae),_.set(L,Ae)}const F=_.get(L),G=F?F.id:void 0,z=C.material;let Z=n.get(z,L);if(N(Z)){const te=h[z.substring(z.lastIndexOf("/")+1)].params;te.transparency===1&&(te.transparency=0);const re=k&&k.alphaChannelUsage,Ae=te.transparency>0||re==="transparency"||re==="maskAndTransparency",ve=k?bDe(k.alphaChannelUsage):void 0,ye={ambient:Iu(te.diffuse),diffuse:Iu(te.diffuse),opacity:1-(te.transparency||0),transparent:Ae,textureAlphaMode:ve,textureAlphaCutoff:.33,textureId:G,initTextureTransparent:!0,doubleSided:!0,cullFace:$s.None,colorMixMode:te.externalColorMixMode||"tint",textureAlphaPremultiplied:!!k&&!!k.params.preMultiplyAlpha};E(e)&&e.materialParamsMixin&&Object.assign(ye,e.materialParamsMixin),Z=new qy(ye),n.set(z,L,Z)}s.push(Z);const J=new Mo(Z,O,$);A+=$.position?$.position.length:0,r.push(J)}return{engineResources:[{name:l,stageResources:{textures:i,materials:s,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:A,lodThreshold:null}],referenceBoundingBox:Mxt(r)}}function Mxt(t){const e=Fs();return t.forEach(r=>{const i=r.boundingInfo;E(i)&&(Fg(e,i.bbMin),Fg(e,i.bbMax))}),e}async function Rxt(t,e){const r=[];for(const n in t){const o=t[n],a=o.images[0].data;if(!a){zA.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:pr.REPEAT,t:pr.REPEAT},preMultiplyAlpha:bDe(h)!==ms.Opaque},A=E(e)&&e.disableTextures?Promise.resolve(null):jy(l,e);r.push(A.then(_=>({refId:c,image:_,params:p,alphaChannelUsage:h})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function bDe(t){switch(t){case"mask":return ms.Mask;case"maskAndTransparency":return ms.MaskBlend;case"none":return ms.Opaque;default:return ms.Blend}}function Oxt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const Pxt=new _M(1,2,"wosr"),SS=2.1;async function wDe(t,e){const r=xDe(llt(t));if(r.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(r.url,e):_De(r.url,e)),{engineResources:A,referenceBoundingBox:_}=Cxt(p,e);return{lods:A,referenceBoundingBox:_,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):yDe(new gDe(e.streamDataRequester),r.url,e,e.usePBR)),s=pa(i.model.meta,"ESRI_proxyEllipsoid"),n=i.meta.isEsriSymbolResource&&E(s)&&i.meta.uri.includes("/RealisticTrees/");n&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,Nxt(i,s));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[0,1,.2]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},l={...e.materialParamsMixin,treeRendering:n},{engineResources:c,referenceBoundingBox:h}=TDe(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function xDe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function TDe(t,e,r,i){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=Fs();return s.lods.forEach((h,p)=>{const A=i.skipHighLods===!0&&(l>1&&p===0||l>3&&p===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&p!==i.singleLodIndex;if(A&&p!==0)return;const _=new xxt(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(w=>{const T=A?new qy({}):Ixt(s,w,_,e,r,o,a),{geometry:C,vertexCount:M}=$xt(w,E(T)?T:new qy({})),O=C.boundingInfo;E(O)&&p===0&&(Fg(c,O.bbMin),Fg(c,O.bbMax)),E(T)&&(_.stageResources.geometries.push(C),_.numberOfVertices+=M)}),A||n.push(_)}),{engineResources:n,referenceBoundingBox:c}}function Ixt(t,e,r,i,s,n,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=E(e.attributes.texCoord0),h=E(e.attributes.normal);if(N(l))return null;const p=Lxt(l.alphaMode);if(!n.has(a)){if(c){const L=(k,F=!1)=>{if(E(k)&&!o.has(k)){const G=t.textures.get(k);if(E(G)){const z=G.data;o.set(k,new IT(Tx(z)?z.data:z,{...G.parameters,preMultiplyAlpha:!Tx(z)&&F,encoding:Tx(z)&&E(z.encoding)?z.encoding:void 0}))}}};L(l.textureColor,p!==ms.Opaque),L(l.textureNormal),L(l.textureOcclusion),L(l.textureEmissive),L(l.textureMetallicRoughness)}const _=l.color[0]**(1/SS),w=l.color[1]**(1/SS),T=l.color[2]**(1/SS),C=l.emissiveFactor[0]**(1/SS),M=l.emissiveFactor[1]**(1/SS),O=l.emissiveFactor[2]**(1/SS),$=E(l.textureColor)&&c?o.get(l.textureColor):null;n.set(a,new qy({...i,transparent:p===ms.Blend,customDepthTest:eT.Lequal,textureAlphaMode:p,textureAlphaCutoff:l.alphaCutoff,diffuse:[_,w,T],ambient:[_,w,T],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?$s.None:$s.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:h?cs.Attribute:cs.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:E($)?$.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:E(l.textureNormal)&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:E($)&&!!$.params.preMultiplyAlpha,occlusionTextureId:E(l.textureOcclusion)&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:E(l.textureEmissive)&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:E(l.textureMetallicRoughness)&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[C,M,O],mrrFactors:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:cg(l.colorTextureTransform),normalTextureTransformMatrix:cg(l.normalTextureTransform),occlusionTextureTransformMatrix:cg(l.occlusionTextureTransform),emissiveTextureTransformMatrix:cg(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:cg(l.metallicRoughnessTextureTransform),...s}))}const A=n.get(a);if(r.stageResources.materials.push(A),c){const _=w=>{E(w)&&r.stageResources.textures.push(o.get(w))};_(l.textureColor),_(l.textureNormal),_(l.textureOcclusion),_(l.textureEmissive),_(l.textureMetallicRoughness)}return A}function $xt(t,e){const r=t.attributes.position.count,i=Dxt(t.indices||r,t.primitiveType),s=z2(ks,r);YL(s,t.attributes.position,t.transform);const n=[[B.POSITION,new Rt(s.typedBuffer,s.elementCount,!0)]],o=[[B.POSITION,i]];if(E(t.attributes.normal)){const a=z2(ks,r);aM(LN,t.transform),mb(a,t.attributes.normal,LN),n.push([B.NORMAL,new Rt(a.typedBuffer,a.elementCount,!0)]),o.push([B.NORMAL,i])}if(E(t.attributes.tangent)){const a=z2(Gh,r);aM(LN,t.transform),hDe(a,t.attributes.tangent,LN),n.push([B.TANGENT,new Rt(a.typedBuffer,a.elementCount,!0)]),o.push([B.TANGENT,i])}if(E(t.attributes.texCoord0)){const a=z2(o_,r);pDe(a,t.attributes.texCoord0),n.push([B.UV0,new Rt(a.typedBuffer,a.elementCount,!0)]),o.push([B.UV0,i])}if(E(t.attributes.color)){const a=z2(uc,r);if(t.attributes.color.elementCount===4)t.attributes.color instanceof Gh?gK(a,t.attributes.color,255):t.attributes.color instanceof uc?fDe(a,t.attributes.color):t.attributes.color instanceof BL&&gK(a,t.attributes.color,1/256);else{mDe(a,255,255,255,255);const l=new w4(a.buffer,0,4);t.attributes.color instanceof ks?tK(l,t.attributes.color,255):t.attributes.color instanceof w4?V7(l,t.attributes.color):t.attributes.color instanceof o7&&tK(l,t.attributes.color,1/256)}n.push([B.COLOR,new Rt(a.typedBuffer,a.elementCount,!0)]),o.push([B.COLOR,i])}return{geometry:new Mo(e,n,o),vertexCount:r}}const LN=mn();function Lxt(t){switch(t){case"BLEND":return ms.Blend;case"MASK":return ms.Mask;case"OPAQUE":case null:case void 0:return ms.Opaque}}function Dxt(t,e){switch(e){case Ar.TRIANGLES:return _xt(t);case Ar.TRIANGLE_STRIP:return vxt(t);case Ar.TRIANGLE_FAN:return bxt(t)}}function Nxt(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const s of i.parts){const n=s.attributes.normal;if(N(n))return;const o=s.attributes.position,a=o.count,l=V(),c=V(),h=V(),p=z2(uc,a),A=z2(ks,a),_=ul(ot(),s.transform);for(let w=0;w<a;w++){o.getVec(w,c),n.getVec(w,l),Mt(c,c,s.transform),Be(h,c,e.center),Sk(h,h,e.radius);const T=h[2],C=st(h),M=Math.min(.45+.55*C*C,1);Sk(h,h,e.radius),_!==null&&Mt(h,h,_),qe(h,h),r+1!==t.model.lods.length&&t.model.lods.length>1&&fo(h,h,l,T>-1?.2:Math.min(-4*T-3.8,1)),A.setVec(w,h),p.set(w,0,255*M),p.set(w,1,255*M),p.set(w,2,255*M),p.set(w,3,255)}s.attributes.normal=A,s.attributes.color=p}}}const sjt=Object.freeze(Object.defineProperty({__proto__:null,fetch:wDe,gltfToEngineResources:TDe,parseUrl:xDe},Symbol.toStringTag,{value:"Module"}));var Xs;function Fxt(t){let e=gn().mat4f64(B.LOCALTRANSFORM).mat4f64(B.GLOBALTRANSFORM).vec4f64(B.BOUNDINGSPHERE).vec3f64(B.MODELORIGIN).mat3f(B.MODEL).mat3f(B.MODELNORMAL).vec2f(B.MODELSCALEFACTORS);return t.includes("color")&&(e=e.vec4f(B.COLOR)),t.includes("featureAttribute")&&(e=e.vec4f(B.FEATUREATTRIBUTE)),e=e.u8(B.STATE).u8(B.LODLEVEL),t.includes(B.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(B.OBJECTANDLAYERIDCOLOR)),e.alignTo(8),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Xs||(Xs={}));let kxt=class{constructor(e){this.localTransform=e.getField(B.LOCALTRANSFORM,b4),this.globalTransform=e.getField(B.GLOBALTRANSFORM,b4),this.modelOrigin=e.getField(B.MODELORIGIN,cc),this.model=e.getField(B.MODEL,cb),this.modelNormal=e.getField(B.MODELNORMAL,cb),this.modelScaleFactors=e.getField(B.MODELSCALEFACTORS,o_),this.boundingSphere=e.getField(B.BOUNDINGSPHERE,i7),this.color=e.getField(B.COLOR,Gh),this.featureAttribute=e.getField(B.FEATUREATTRIBUTE,Gh),this.state=e.getField(B.STATE,lM),this.lodLevel=e.getField(B.LODLEVEL,lM),this.objectAndLayerIdColor=e.getField(B.OBJECTANDLAYERIDCOLOR,uc)}},VE=class extends Ke{constructor(e,r){super(e),this.events=new Nn,this._capacity=0,this._size=0,this._next=0,this._buffer=null,this._view=null,this._layout=Fxt(r)}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Xs.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;Zt(e>=0&&e<this._capacity&&(r.get(e)&Xs.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Xs.ACTIVE)?this._setStateFlags(e,Xs.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;Zt(e>=0&&e<this._capacity&&(r.get(e)&Xs.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=V_,s=Mf;r.localTransform.getMat(e,Cge),r.globalTransform.getMat(e,aH);const n=$n(aH,aH,Cge);$e(i,n[12],n[13],n[14]),r.modelOrigin.setVec(e,i),hf(s,n),r.model.setMat(e,s);const o=IWe(V_,n);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),RT(s,s),df(s,s),r.modelNormal.setMat(e,s),this._setStateFlags(e,Xs.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,Mf),i.modelOrigin.getVec(e,V_),r[0]=Mf[0],r[1]=Mf[1],r[2]=Mf[2],r[3]=0,r[4]=Mf[3],r[5]=Mf[4],r[6]=Mf[5],r[7]=0,r[8]=Mf[6],r[9]=Mf[7],r[10]=Mf[8],r[11]=0,r[12]=V_[0],r[13]=V_[1],r[14]=V_[2],r[15]=1}applyShaderTransformation(e,r){E(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),E(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){return this._view.localTransform.getMat(e,r),E(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);if(E(this.shaderTransformation)){const i=this.shaderTransformation.scaleFactor(V_,this,e);r*=Math.max(i[0],i[1],i[2])}return r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);if(E(this.shaderTransformation)){const i=this.shaderTransformation.scaleFactor(V_,this,e);r*=Bxt(i[0],i[1],i[2])}return r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}getColor(e,r){this._view.color.getVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,Xs.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Xs.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,Xs.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Xs.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){const e=Math.max(Uxt,Math.floor(this._capacity*Vxt)),r=this._layout.createBuffer(e);if(this._buffer){const i=new Uint8Array(this._buffer.buffer);new Uint8Array(r.buffer).set(i)}this._capacity=e,this._buffer=r,this._view=new kxt(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&Xs.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function Bxt(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}u([d({constructOnly:!0})],VE.prototype,"shaderTransformation",void 0),u([d()],VE.prototype,"_size",void 0),u([d({readOnly:!0})],VE.prototype,"size",null),VE=u([j("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],VE);const Uxt=1024,Vxt=2,V_=V(),Mf=mn(),Cge=ot(),aH=ot();let zxt=class extends S0{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=Io(),this._tmpMat4=ot(),this._instanceData=e,this._boundingSphere=r}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Mt(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*Wx(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},Gxt=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const s=i.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*r/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},jxt=class extends u7{constructor(e,r,i,s,n,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function loe(t){return J0(t)&&t.intersector===pn.LOD&&!!t.target}let Hxt=class{constructor(e,r){const i=e.renderContext.rctx,s=r.geometry;this._materialRepository=e.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=n.allocate(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new aLe(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Wi.createVertex(i,Li.STATIC_DRAW,l.buffer),this.vao=new Z0(i,Pi,{geometry:Wh(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,s,(h,p,A,_,w)=>{if(h>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,h))return;const T=new jxt(o.layerUid,o.graphicUid(n),c,A,a,l);if((e.results.min.drapedLayerOrder==null||w>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(pn.LOD,T,h,p,e.transform.transform,w),e.options.store!==dl.MIN&&(e.results.max.drapedLayerOrder==null||w>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(pn.LOD,T,h,p,e.transform.transform,w),e.options.store===dl.ALL){const C=Zse(e.results.min.ray);C.set(pn.LOD,T,h,p,e.transform.transform,w),e.results.all.push(C)}}})}},qxt=class SDe{static async create(e,r,i){const s=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new Hxt(e,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(E);if(da(i)||n.length!==s.length){n.forEach(o=>o.destroy()),di(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new SDe(r.minScreenSpaceRadius,n)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(e,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(N(this._boundingBox)){const e=Fs();this.components.forEach(r=>{E(r.boundingInfo)&&(Fg(e,r.boundingInfo.bbMin),Fg(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(N(this._boundingSphere)){const e=this.boundingBox,r=V();_0(e,r),this._boundingSphere={center:r,radius:.5*Sxe(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}},Wxt=class{constructor(e,r,i){this._elementSize=r,this._buffer=Wi.createVertex(e,Li.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,r,i,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,s)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},Yxt=class{constructor(e){this.modelOriginHi=e.getField(B.MODELORIGINHI,ks),this.modelOriginLo=e.getField(B.MODELORIGINLO,ks),this.model=e.getField(B.MODEL,cb),this.modelNormal=e.getField(B.MODELNORMAL,cb),this.color=e.getField(B.INSTANCECOLOR,Gh),this.featureAttribute=e.getField(B.INSTANCEFEATUREATTRIBUTE,Gh),this.objectAndLayerIdColor=e.getField(B.OBJECTANDLAYERIDCOLOR_INSTANCED,uc)}},Mge=class{constructor(e,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){Zt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Zt(this._updating,"not updating"),this.size<Xxt*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Zt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),Zt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){Zt(this._updating,"not updating"),Zt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(Rge,Math.floor(this._capacity*Qxt));this._resize(e)}_shrink(){const e=Math.max(Rge,Math.floor(this._capacity*Zxt));this._resize(e)}_resize(e){if(Zt(this._updating,"not updating"),e===this._capacity)return;const r=new Wxt(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);Zt(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new Yxt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const Rge=1024,Qxt=2,Xxt=.3,Zxt=.5,Jxt=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new Gxt(e,r)};let Tp=class extends Ke{constructor(e,r){super(e),this.type=pn.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new hr,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[et.OPAQUE_MATERIAL,et.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new VE({shaderTransformation:e.shaderTransformation},e.optionalFields),this._frameTask=r.registerTask(ir.LOD_RENDERER,this)}initialize(){this._instanceBufferLayout=eTt(this.optionalFields),this._glInstanceBufferLayout=Wh(this._instanceBufferLayout,1),this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))}destroy(){this._frameTask.remove()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(r=>{const i=r.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu}),this._highlightRenderInstanceData.forEach(r=>{const i=r.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu}),e}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,s)=>{const n=this._defaultRenderInstanceData[s],o=this._highlightRenderInstanceData[s],a=n.size+o.size,l=i.triangleCount;r.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:e,renderedInstances:r.reduce((i,s)=>i+s.renderedInstances,0),renderedTriangles:r.reduce((i,s)=>i+s.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new Mge(i,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new Mge(i,this._instanceBufferLayout)),qxt.create(e,o,r)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(E);if(da(r)||n.length!==s.length){n.forEach(o=>o.destroy()),di(r);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=Jxt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceData.forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(r=>r.material.requiresSlot(et.TRANSPARENT_MATERIAL,ee.Color)))}get needsHighlight(){return this._highlightRenderInstanceData.some(e=>e.size>0)}prepareRender(e){if(!Qi.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(jc),this._needFullCycle=!1)}}render(e){!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output)||(e.rctx.bindVAO(),e.output!==ee.Highlight&&e.output!==ee.ShadowHighlight&&this._renderComponents(e,this._defaultRenderInstanceData),e.output!==ee.ShadowExcludeHighlight&&this._renderComponents(e,this._highlightRenderInstanceData))}intersect(e,r,i,s){if(!this.baseMaterial.isVisible()||N(this._octree))return;const n=V();Be(n,s,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,Ige),e.transform.set(Ige),Mt($ge,i,e.transform.inverse),Mt(Lge,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;Zt((l&Xs.ACTIVE)!=0,"invalid instance state"),Zt(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,r,$ge,Lge,a,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,n,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(N(this._octreeCached)){const r=this._instanceData,i=(e=r.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new zxt(r,this.baseBoundingSphere);for(let s=0;s<r.capacity;++s)i.get(s)&Xs.ACTIVE&&this._octreeCached.addInstance(s)}return this._octreeCached}_invalidateOctree(){this._octreeCached=gt(this._octreeCached)}_queryDepthRangeOctree(e){if(N(this._octree))return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,S0.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(r,S0.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,Am),Be(Am,Am,n);const a=He(Am,r)-Am[3];o.boundingSphere.getVec(s,Am),Be(Am,Am,n);const l=He(Am,r)+Am[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(e=>e.startUpdateCycle()),this._highlightRenderInstanceData.forEach(e=>e.startUpdateCycle())}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:s}=this;this._defaultRenderInstanceData.forEach(h=>h.beginUpdate()),this._highlightRenderInstanceData.forEach(h=>h.beginUpdate());const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let A=0;if(!(p&Xs.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const _=o.lodLevel.get(c);if(p&Xs.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[_].freeTail(),p&Xs.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[_].freeTail(),p&Xs.REMOVE)n.freeInstance(c);else if(p&Xs.VISIBLE){let w=0;r&&(o.modelOrigin.getVec(c,Pge),w=s.selectLevel(Pge,n.getCombinedMedianScaleFactor(c),i)),A=p&~(Xs.ACTIVE|Xs.TRANSFORM_CHANGED),w>=0&&(p&Xs.HIGHLIGHT?(Oge(this._highlightRenderInstanceData[w],o,c),A|=Xs.HIGHLIGHT_ACTIVE):(Oge(this._defaultRenderInstanceData[w],o,c),A|=Xs.DEFAULT_ACTIVE)),o.state.set(c,A),o.lodLevel.set(c,w)}else A=p&~(Xs.ACTIVE|Xs.TRANSFORM_CHANGED),o.state.set(c,A);if(E(this._octreeCached)){const w=!!(p&Xs.ACTIVE),T=!!(A&Xs.ACTIVE);!w&&T?this._octreeCached.addInstance(c):w&&!T?this._octreeCached.removeInstance(c):w&&T&&p&Xs.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>h.endUpdate()),this._highlightRenderInstanceData.forEach(h=>h.endUpdate()),this._context.requestRender()}_renderComponents(e,r){this.levels.forEach((i,s)=>{const n=i.components.map(o=>this._beginComponent(e,r[s],o));i.components.forEach((o,a)=>this._renderComponent(e,n[a],r[s],o,s))})}_beginComponent(e,r,i){const{bindParameters:s,rctx:n,output:o}=e;if(r.size===0||!i.material.requiresSlot(s.slot,e.output))return null;const a=i.glMaterials.load(n,s.slot,o);return E(a)?a.beginSlot(s):null}_renderComponent(e,r,i,s,n){if(N(r))return;const{bindParameters:o,rctx:a}=e,l=a.bindTechnique(r,s.material.parameters,o);a.bindVAO(s.vao),r.ensureAttributeLocations(s.vao),l.bindDraw(tTt,o,s.material.parameters),Qi.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===ee.Color&&(l.setUniform4fv("externalColor",Dge[Math.min(n,Dge.length-1)]),l.setUniform1i("colorMixMode",g$e.replace));const c=a.capabilities.instancing,h=i.capacity,p=i.headIndex,A=i.tailIndex,_=i.firstIndex,w=this._glInstanceBufferLayout,T=(C,M)=>{fse(a,Pi,i.buffer,w,C),c.drawArraysInstanced(r.primitiveType,0,s.vertexCount,M-C),mse(a,Pi,i.buffer,w)};s.material.parameters.transparent&&_!=null?p>A?(Zt(_>=A&&_<=p,"invalid firstIndex"),T(_,p),T(A,_)):p<A&&(_<=p?(Zt(_>=0&&_<=p,"invalid firstIndex"),T(_,p),T(A,h),T(0,_)):(Zt(_>=A&&_<=h,"invalid firstIndex"),T(_,h),T(0,p),T(A,_))):p>A?T(A,p):p<A&&(T(0,p),T(A,h)),a.bindVAO(null)}};function Oge(t,e,r){const i=t.allocateHead();Kxt(e,r,t.view,i)}function Kxt(t,e,r,i){Idt(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function eTt(t){let e=gn().vec3f(B.MODELORIGINHI).vec3f(B.MODELORIGINLO).mat3f(B.MODEL).mat3f(B.MODELNORMAL);return E(t)&&t.includes("color")&&(e=e.vec4f(B.INSTANCECOLOR)),E(t)&&t.includes("featureAttribute")&&(e=e.vec4f(B.INSTANCEFEATUREATTRIBUTE)),E(t)&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(B.OBJECTANDLAYERIDCOLOR_INSTANCED)),e}u([d({constructOnly:!0})],Tp.prototype,"symbol",void 0),u([d({constructOnly:!0})],Tp.prototype,"optionalFields",void 0),u([d({constructOnly:!0})],Tp.prototype,"metadata",void 0),u([d({constructOnly:!0})],Tp.prototype,"shaderTransformation",void 0),u([d()],Tp.prototype,"_instanceData",void 0),u([d()],Tp.prototype,"_cycleStartIndex",void 0),u([d({readOnly:!0})],Tp.prototype,"_enableLevelSelection",null),u([d()],Tp.prototype,"_updateCyclesWithStaticCamera",void 0),u([d({readOnly:!0})],Tp.prototype,"running",null),Tp=u([j("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Tp);const Pge=V(),Am=Zr(),Ige=ot(),$ge=V(),Lge=V(),Dge=[Nr(1,0,1,1),Nr(0,0,1,1),Nr(0,1,0,1),Nr(1,1,0,1),Nr(1,0,0,1)],tTt=new Qbt;let Nge=class{constructor(e,r,i,s,n,o,a,l,c,h,p,A){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=p,this.pivotOffset=A}},rTt=class extends Jg{getCachedSize(){const[e,r,i]=E(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,s){super(e,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&R7(this.symbolLayer))throw new Error;const r=this.symbolLayer;if(this._isPrimitive){const i=r.resource?r.resource.primitive:Fxe;this._resources=await this._createResourcesForPrimitive(i,e)}else this._resources=await this._createResourcesForUrl(r.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return E(this._resources)?this._resources.extentPadding:0}get _isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return E(this._resources)?this._resources.lodRenderer:null}_setMaterialTransparencyParams(e,r=pa(this.symbolLayer,"material","color")){const i=this._getCombinedOpacity(r),s=i<1||this.needsDrivenTransparentPass;return e.transparent=s,e.opacity=i,e.cullFace=s?$s.None:$s.Back,e}async _createResourcesForPrimitive(e,r){if(!i1t(e))throw new Error(`Unknown object symbol primitive: ${e}`);const i=this.symbolLayer,s=Jo(nHe(e)),n=Iu(BD(s)),o=Iu(pz(n,i)),a=st(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:hg,diffuse:hg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=!!h.usePBR;this._setMaterialTransparencyParams(h);const A=this.symbol;if(A.type==="point-3d"&&A.verticalOffset){const{screenLength:O,minWorldLength:$,maxWorldLength:L}=A.verticalOffset;h.verticalOffset={screenLength:ll(O),minWorldLength:$||0,maxWorldLength:E(L)?L:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Gp;else{const O=E(i.material)?i.material.color:null,$=E(O)?Ot.toUnitRGBA(O):Gp;h.externalColor=$}this._fastUpdates=k4(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,Cw)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color")),Le("enable-feature:objectAndLayerId-rendering")&&(h.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const _=new qy(h),w=v4e(e,_);if(!w)throw new Error(`Unknown object symbol primitive: ${e}`);const T=dN(w).map(O=>({opacity:1,transparent:O.parameters.transparent})),C=await this._createStageResources(w,p,r),M=await this._createLodRenderer(w,r);return new Nge(w,M,C,T,n,l,c,s,o,a,p,Cw)}async _createResourcesForUrl(e,r){const i=["transformation"],s={materialParamsMixin:{instanced:i,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=k4(this._context.renderer,this._fastVisualVariableConvertOptions(Cw,Cw,Cw,Cw)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color")),Le("enable-feature:objectAndLayerId-rendering")&&(i.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:J,minWorldLength:te,maxWorldLength:re}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:ll(J),minWorldLength:te||0,maxWorldLength:E(re)?re:1/0},s.materialParamsMixin.castShadows=!1}s.signal=r,s.usePBR=this._context.physicalBasedRenderingEnabled,s.skipHighLods=this._context.skipHighSymbolLods;const o=s.usePBR,a=await wDe(e,s),l=a.isEsriSymbolResource,c=a.isWosr,h=G2t(a.lods);h.levels.sort((J,te)=>J.minScreenSpaceRadius-te.minScreenSpaceRadius);const p=this._context,A=this.symbolLayer.material,_=this._getExternalColorParameters(A),w=pa(this.symbolLayer,"material","color"),T=this._getCombinedOpacity(w,{hasIntrinsicColor:!0}),C=this.needsDrivenTransparentPass,M=dN(h),O=dN(h).map(J=>({opacity:J.parameters.opacity||1,transparent:J.parameters.transparent}));M.forEach(J=>{const te=J.parameters;J.setParameters(_);const re=te.opacity*T,Ae=re<1||C||te.transparent;J.setParameters({opacity:re,transparent:Ae}),p.screenSizePerspectiveEnabled&&J.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const $=a.referenceBoundingBox,L=Iu(BD($)),k=Iu(h.levels[0].pivotOffset),F=Iu(pz(L,this.symbolLayer)),G=st(F);B4(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions($,F,L,k))&&M.forEach(J=>J.setParameters(this._fastUpdates.materialParameters));const z=await this._createStageResources(h,o,r),Z=await this._createLodRenderer(h,r);return new Nge(h,Z,z,O,L,l,c,$,F,G,o,k)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const s=this._context.stage,n=dN(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=ome(e);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),await s.load(o,i),di(i);const a=ame(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,DN),ma(c,uK(this._fastUpdates.materialParameters,DN,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,DN),Lwt(a,this._fastUpdates.materialParameters,DN))}:null,o=new Tp({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:n},this._context.scheduler);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(o),o.destroy()}),await i.addRenderPlugin(o.slots,o,r),o}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=Gp:E(e)&&E(e.color)?r.externalColor=Ot.toUnitRGBA(e.color):(r.externalColor=Gp,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=$4(r.geometry);if(N(i))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r,new K0),n=e.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(N(this._resources))return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<i.length;n++){const o=i[n],a=pa(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:r})*l.opacity,h=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:h}),this._isPrimitive&&o.setParameters({cullFace:h?$s.None:$s.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,pb)}slicePlaneEnabledChanged(){if(N(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(N(this._resources))return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!1}applyRendererDiff(e,r){if(N(this._resources))return Qo.Recreate_Symbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!B4(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return Qo.Recreate_Symbol;for(const h of i)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return Qo.Fast_Update}computeComplexity(){if(N(this._resources))return super.computeComplexity();const e=this._resources.lodResources,r=_4e(e.levels[0]).reduce((n,o)=>n+o.indices.get(B.POSITION).length,0)/3,i=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>{var l;return o+(((l=a.data.buffer)==null?void 0:l.byteLength)??0)},0)+Array.from(n.indices.values()).reduce((o,a)=>o+(Array.isArray(a)?12*a.length:a.buffer.byteLength),0),s=ome(e).reduce((n,o)=>n+(o.params.encoding&&o.params.encoding==="image/ktx2"?o.estimatedTexMemRequired:o.estimatedTexMemRequired/4),0)+ame(e).reduce((n,o)=>n+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...x4e(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return E(this._resources)}_createAs3DShape(e,r,i,s,n,o){if(!this._hasLodRenderer()||N(this._resources))return null;const a=this.getFastUpdateAttrValues(e),l=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?t$(i.color,i.opacity):null,c=this._context.clippingExtent;if(Fl(r,ES,this._context.elevationProvider.spatialReference),E(c)&&!gre(c,ES))return null;const h=this._requiresTerrainElevation(s),p=this._computeGlobalTransform(r,s,lH,NN),A=this._computeLocalTransform(this._resources,this.symbolLayer,i,Fge),_=this._resources.lodRenderer.instanceData,w=_.addInstance();this._instanceIndexToGraphicUid.set(w,n),_.setLocalTransform(w,A,!1),_.setGlobalTransform(w,p),a&&_.setFeatureAttribute(w,a),l&&_.setColor(w,l),E(this._context.stage.renderView.objectAndLayerIdRenderHelper)&&_.setObjectAndLayerIdColor(w,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const T=new U2t(this,w,W_t,s);return h&&(T.alignedSampledElevation=NN.sampledElevation),T.needsElevationUpdates=pb(s.mode),I4(T,r,this._context.elevationProvider),T}_computeGlobalTransform(e,r,i,s){return iR(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),ES[0]=e.x,ES[1]=e.y,ES[2]=s.z,G0(e.spatialReference,ES,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,s){return cf(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(e,i,s),this._applyAnchor(e,r,s),s}_applyObjectScale(e,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:e.symbolSize,n=sme(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||dU(i,i,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(N(this._resources))return!0;const i=r&&$4(r);if(N(i))return!1;const s=this.getGeometryElevationMode(r);return e.elevationContext.mode===s&&(this._computeGlobalTransform(i,e.elevationContext,lH,NN),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=NN.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,lH,!0),I4(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||N(this._resources))return;const i=(w,T,C)=>gr(w!=null&&w.type==="complete"?w.newValue:T,C),s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),h=i(r.anchor,this.symbolLayer.anchor,void 0),p=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const A={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},_=this._resources;this.loadStatus===Sd.LOADED&&e.symbolLayerStatePatches.push(()=>{_.symbolSize=Iu(pz(_.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((w,T)=>{const C=this._computeLocalTransform(_,A,T,Fge),M=w.instanceIndex;_.lodRenderer.instanceData.setLocalTransform(M,C,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=E(s)?Ot.toUnitRGBA(s):Gp;delete i.color;const o=this._resources;N(o)||e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&r))return N_t(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const s=V();switch(i.anchor){case"center":Oe(s,_0(e)),nc(s,s);break;case"top":{const n=_0(e);$e(s,-n[0],-n[1],-e[5]);break}case"bottom":{const n=_0(e);$e(s,-n[0],-n[1],-e[2]);break}case"relative":{const n=_0(e),o=BD(e),a=i.anchorPosition,l=a?ct(a.x,a.y,a.z):sc;WB(s,o,l),ke(s,s,n),nc(s,s);break}default:E(r)?nc(s,r):Oe(s,sc)}return s}_applyAnchor(e,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);s&&ju(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,s){const n=E(e)?Iu(BD(e)):hg,o=E(e)?this._computeAnchor(e,s,this.symbolLayer):sc,a=this._context.renderCoordsHelper.unitInMeters,l=sme(E(r)?r:void 0,r,i,a),c=ct(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:E(r)?r:hg,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}};const ES=V(),Fge=ot(),lH=ot(),DN=Zr(),NN=new WL;function iTt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function sTt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function AK(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function nTt(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function oTt(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*n-s*i;return o?(o=1/o,t[0]=n*o,t[1]=-i*o,t[2]=-s*o,t[3]=r*o,t):null}function aTt(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function lTt(t){return t[0]*t[3]-t[2]*t[1]}function EDe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*a+n*l,t[1]=s*a+o*l,t[2]=i*c+n*h,t[3]=s*c+o*h,t}function cTt(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=s*l+o*a,t[2]=i*-a+n*l,t[3]=s*-a+o*l,t}function uTt(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function hTt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function dTt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function pTt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function fTt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function mTt(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function gTt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function CDe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function ATt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function yTt(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=dc();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}function _Tt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function vTt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const bTt=EDe,wTt=CDe;Object.freeze(Object.defineProperty({__proto__:null,LDU:mTt,add:gTt,adjoint:aTt,copy:iTt,determinant:lTt,equals:yTt,exactEquals:ATt,frob:fTt,fromRotation:hTt,fromScaling:dTt,identity:sTt,invert:oTt,mul:bTt,multiply:EDe,multiplyScalar:_Tt,multiplyScalarAndAdd:vTt,rotate:cTt,scale:uTt,set:AK,str:pTt,sub:wTt,subtract:CDe,transpose:nTt},Symbol.toStringTag,{value:"Module"}));let xTt=class extends Mo{constructor(e,r,i,s,n,o,a,l){super(e,r,i,null,Xn.Mesh,l),this.path=s,this.geometrySR=n,this.upVectorAlignment=o,this.stencilWidth=a}};var qv;function MDe(t){return"upVectorAlignment"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(qv||(qv={}));function RDe(){return[1,0,0,1]}function TTt(t){return[t[0],t[1],t[2],t[3]]}function STt(t,e,r,i){return[t,e,r,i]}function ETt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:TTt,create:RDe,createView:ETt,fromValues:STt},Symbol.toStringTag,{value:"Module"}));function ODe(){return{up:V(),right:V()}}function CTt(t,e,r){Mt(t.up,e.up,r),Mt(t.right,e.right,r)}function MTt(t,e,r){Kr(t,He(r,e.right),He(r,e.up))}let RTt=class{constructor(){this.pos=V(),this.posES=V(),this.vLeft=V(),this.vRight=V(),this.vMinSiblingLength=0,this.frame=ODe(),this.rotationFrameUp=V(),this.rotationRight=Dt(),this.rotationAngle=0,this.miterStretch=RDe(),this.maxStretchDistance=0}setFrameFromUpVector(e){Oe(this.frame.up,e),ke(zE,this.vLeft,this.vRight),qe(zE,zE),Me(yK,this.frame.up,He(zE,this.frame.up)),Be(kN,zE,yK),qe(kN,kN),Xt(this.frame.right,kN,this.frame.up)}},PDe=class{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[]}addVertex(e,r){return this.vertices.push(uP(e)),this.vertexNormals.push(uP(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:uP(e),normal:r?uP(r):null}),this.poles.length-1}addSegment(e,r=null){this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}};function OTt(t=20){const r=new PDe,i={v0:0,v1:0};r.addPole(ki(0,0));for(let n=0;n<t;++n){const o=2*n*Math.PI/t,a=Math.cos(o),l=Math.sin(o),c=ki(a*.5,l*.5),h=ki(a,l);r.addVertex(c,h)}for(let n=0;n<t-1;++n){const o={v0:n,v1:n+1};r.addSegment(o,i)}const s={v0:t-1,v1:0};return r.addSegment(s,i),r}function PTt(){const r=new PDe,i=ki(.5*-1,.5*-1),s=ki(.5*1,.5*-1),n=ki(.5*1,.5*1),o=ki(.5*-1,.5*1),a=ki(0,-1),l=ki(1,0),c=ki(0,1),h=ki(-1,0);return r.addPole(ki(0,.5*1),c),r.addPole(ki(0,.5*1)),r.addPole(ki(0,.5*-1)),r.addPole(ki(0,.5*-1),a),r.addVertex(i,a),r.addVertex(s,a),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(o,h),r.addVertex(i,h),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),r}let ITt=class{constructor(e){this.vertices=e,this.offset=V(),this.xform=ot();const r=Math.floor((e.length-1)/2);Oe(this.offset,this.vertices[r].pos);for(const i of this.vertices)Be(i.pos,i.pos,this.offset);ju(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];r.index=0,r.vLeft=V(),Be(r.vRight,this.vertices[1].pos,r.pos);let i=st(r.vRight);r.vMinSiblingLength=i,qe(r.vRight,r.vRight);let s=r;for(let n=1;n<e;++n){const o=this.vertices[n];if(o.index=n,o.vLeft=s.vRight,n<e-1){Be(o.vRight,this.vertices[n+1].pos,o.pos);const a=st(o.vRight);o.vMinSiblingLength=Math.min(i,a),i=a,qe(o.vRight,o.vRight)}else Oe(o.vRight,o.vLeft),o.vMinSiblingLength=i;s=o}}};function $Tt(t,e){let r=null;const i=t.vertices.length,s=.99619469809,n=V(),o=V(),a=V(),l=V(),c=V(),h=V(),p=Hi();let A=t.vertices[0];Oe(o,e),$e(n,0,1,0),w9(A.vRight,o,n,n,a,o,s),Oe(A.frame.up,o),Oe(A.frame.right,a),r=A;for(let _=1;_<i;++_){A=t.vertices[_],ke(c,A.vLeft,A.vRight);let w=st(c);w>0?(w=1/Math.sqrt(w),c[0]=c[0]*w,c[1]=c[1]*w,c[2]=c[2]*w):(c[0]=A.vRight[0],c[1]=A.vRight[1],c[2]=A.vRight[2]),ke(h,r.pos,r.frame.up),vL(A.pos,c,p),ST(p,qd(h,A.vLeft),l)?(Be(l,l,A.pos),qe(o,l),Xt(a,c,o),qe(a,a)):w9(c,r.frame.up,r.frame.right,n,a,o,s),Oe(A.frame.up,o),Oe(A.frame.right,a),r=A}}let LTt=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.index,e.frame,r.vertices[s],r.vertexNormals[s],!1)}},cH=class{constructor(e=.8*Math.PI,r=1){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const s=VTt;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){jd(Uge,.5*-e.rotationAngle+n*e.rotationAngle/this.numBendSubdivisions,e.rotationFrameUp),CTt(s,e.frame,Uge);for(let o=0;o<r.vertices.length;++o)Uo(r.vertices[o],e.rotationRight)*e.rotationAngle>=0?i(e.index,s,r.vertices[o],r.vertexNormals[o],!1):($Z(ox,r.vertices[o],e.miterStretch),i(e.index,e.frame,ox,r.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<r.vertices.length;++o){const a=Uo(r.vertices[o],e.rotationRight)*e.rotationAngle>=0;$Z(ox,r.vertices[o],e.miterStretch),i(e.index,e.frame,ox,r.vertexNormals[o],!a)}}},coe=class{rebuildConnectingProfileGeometry(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.index,e.frame,r.vertices[s],r.vertexNormals[s],0,0)}},kge=class extends coe{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}},FN=class extends coe{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.index,e.frame,r.vertices[s],r.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(e,r){const i=uoe;Kr(i,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)r(e.index,e.frame,this.profile.vertices[n],i,this.profilePlaneOffset,s)}buildTopology(e,r){const i=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?r(l,a,i):r(i,a,l)}}},Bge=class extends coe{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}getNumVertices(){let e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length,e}getNumIndices(){let e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(let r=0;r<this.profile.numSegments;++r){const i=this.profile.vertexIndices[2*r+0],s=this.profile.vertexIndices[2*r+1];this.profile.poleIndices[i]===this.profile.poleIndices[s]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=e.frame,s=.5*this.sign,n=ox,o=uoe;Kr(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?r(e.index,i,l.position,l.normal,s,0):r(e.index,i,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)r(e.index,i,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const A=this.profile.poles[this.profile.poleIndices[p]];ag(n,this.profile.vertices[p],A.position),Ch(n,n,c),A.normal?(l0(n,n,A.position),r(e.index,i,n,A.normal,s*h,0)):(g4(o,n),Ch(o,o,c),l0(n,n,A.position),r(e.index,i,n,o,s*h,this.sign*h))}}}buildTopology(e,r){const i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=i+o,p=i+a;for(let A=0;A<this.numSegments-1;++A){const _=s+A*this.profile.vertices.length+o,w=s+A*this.profile.vertices.length+a;this.flip?(r(_,p,h),r(p,_,w)):(r(h,p,_),r(w,_,p)),h=_,p=w}this.flip?(r(l,p,h),l!==c&&r(l,c,p)):(r(h,p,l),l!==c&&r(p,c,l))}}},DTt=class{constructor(e,r,i,s,n,o={}){this.options=o,this._extrusionVertexCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.profile=r,this.path=e,this.extruder=i,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=uo(1*this.numVerticesTotal),this.profileRightAxisData=uo(4*this.numVerticesTotal),this.profileUpAxisData=uo(4*this.numVerticesTotal),this.profileVertexAndNormalData=uo(4*this.numVerticesTotal),this.originData=uo(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,r,i,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const o=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}_rebuildGeometry(){const e=(i,s,n,o,a)=>this.emitVertex(i,s,n,o,a),r=(i,s,n,o,a,l)=>this.emitCapVertex(i,s,n,o,a,l);this._extrusionVertexCount=0;for(const i of this.path.vertices)this.originData[3*i.index+0]=i.pos[0],this.originData[3*i.index+1]=i.pos[1],this.originData[3*i.index+2]=i.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,r);for(let i=1;i<this.path.vertices.length-1;++i)this.extruder.extrude(this.path.vertices[i],this.profile,e);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,r),this.startCap.rebuildCapGeometry(this.path.vertices[0],r),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],r)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=3*(2*(r*i));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,h,p)=>{n.push(c),n.push(h),n.push(p),o.push(c),o.push(h),o.push(p),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[p])};for(let c=0;c<r;++c){const h=this.profile.vertexIndices[2*c],p=this.profile.vertexIndices[2*c+1];for(let A=0;A<i;++A){const _=A*e+h,w=(A+1)*e+p,T=A*e+p;l(_,(A+1)*e+h,w),l(_,w,T)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=i3(n),this.normalIndices=i3(o),this.pathVertexIndices=i3(a)}onPathChanged(){this._rebuildGeometry()}},IDe=class{constructor(e){this.builder=e}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}},$De=class extends IDe{constructor(e){super(e),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=uo(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=uo(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;for(let r=0;r<this.builder.numVerticesTotal;++r){let i=this.builder.pathVertexData[r];const s=i===0||i===this.builder.path.vertices.length-1;i*=3;const n=FTt;$e(n,this.builder.originData[i++],this.builder.originData[i++],this.builder.originData[i]);const o=4*r,a=yK,l=ox,c=zE,h=BTt,p=UTt;let A=0,_=0;if($e(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),$e(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),Kr(l,this.builder.profileVertexAndNormalData[o]*e[0],this.builder.profileVertexAndNormalData[o+1]*e[1]),s)Xt(c,p,h),A=this.builder.profileRightAxisData[o+3]*e[0],_=this.builder.profileUpAxisData[o+3];else{const T=uoe,C=kTt;Kr(T,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const M=lse(T);g4(T,T);const O=Uo(l,T);if(Math.abs(O)>M){Kr(C,-T[1],T[0]);const $=Uo(l,C);Ch(T,T,M*Math.sign(O)),Ch(C,C,$),l0(l,T,C)}$e(c,0,0,0)}$e(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*r+0]=n[0]+a[0]+c[0]*A,this.vertexAttributePosition[3*r+1]=n[1]+a[1]+c[1]*A,this.vertexAttributePosition[3*r+2]=n[2]+a[2]+c[2]*A;const w=ox;Kr(w,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*r+0]=h[0]*w[0]+p[0]*w[1]+c[0]*_,this.vertexAttributeNormal[3*r+1]=h[1]*w[0]+p[1]*w[1]+c[1]*_,this.vertexAttributeNormal[3*r+2]=h[2]*w[0]+p[2]*w[1]+c[2]*_}}createGeometryData(){const e=[[B.POSITION,this.builder.vertexIndices],[B.NORMAL,this.builder.normalIndices]],r=[[B.POSITION,new Rt(this.vertexAttributePosition,3,!0)],[B.NORMAL,new Rt(this.vertexAttributeNormal,3,!0)]];if(this.vertexAttributeColor){const i=this.builder.vertexIndices.length;e.push([B.COLOR,new Array(i).fill(0)]),r.push([B.COLOR,new Rt(this.vertexAttributeColor,4)])}return{vertexAttributes:r,indices:e}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(e,r,i){const s=this.builder.vertexIndices,n=new Rt(this.vertexAttributePosition,3),o=s.length/3;jL(e,r,0,o,s,n,void 0,void 0,i)}},NTt=class extends IDe{constructor(e,r,i,s){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new $De(e),this.vvData=uo(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[B.POSITION,new Rt(this.builder.originData,3,!0)],[B.PROFILERIGHT,new Rt(this.builder.profileRightAxisData,4,!0)],[B.PROFILEUP,new Rt(this.builder.profileUpAxisData,4,!0)],[B.PROFILEVERTEXANDNORMAL,new Rt(this.builder.profileVertexAndNormalData,4,!0)],[B.FEATUREVALUE,new Rt(this.vvData,4,!0)]],indices:[[B.POSITION,this.builder.pathVertexIndices],[B.PROFILERIGHT,this.builder.vertexIndices],[B.PROFILEUP,this.builder.vertexIndices],[B.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[B.FEATUREVALUE,this.builder.pathVertexIndices]]}}};const FTt=V(),ox=Dt(),uoe=Dt(),kTt=Dt(),yK=V(),zE=V(),BTt=V(),UTt=V(),kN=V(),VTt=ODe(),Uge=ot(),uH=8;function zTt(t,e){const r=B.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(I`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new Bi("size",s=>s.size)),e.vvSize?(i.uniforms.add(new Fr("vvSizeMinSize",s=>s.vvSizeMinSize)),i.uniforms.add(new Fr("vvSizeMaxSize",s=>s.vvSizeMaxSize)),i.uniforms.add(new Fr("vvSizeOffset",s=>s.vvSizeOffset)),i.uniforms.add(new Fr("vvSizeFactor",s=>s.vvSizeFactor)),i.code.add(I`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(I`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",uH),i.uniforms.add([new Kl("vvOpacityValues",s=>s.vvOpacityValues,uH),new Kl("vvOpacityOpacities",s=>s.vvOpacityOpacities,uH)]),i.code.add(I`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(I`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",D0),i.uniforms.add([new Kl("vvColorValues",s=>s.vvColorValues,D0),new T7("vvColorColors",s=>s.vvColorColors,D0)]),i.code.add(I`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(I`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(kL),t.attributes.add(B.PROFILERIGHT,"vec4"),t.attributes.add(B.PROFILEUP,"vec4"),t.attributes.add(B.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(I`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(I`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(I`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(I`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let GTt=class extends One{constructor(){super(...arguments),this.size=ki(1,1)}};function jTt(t){const e=new Di,{vertex:r,fragment:i}=e;switch(Uh(r,t),e.varyings.add("vpos","vec3"),e.include(zTt,t),t.output!==ee.Color&&t.output!==ee.Alpha||(e.include(Fu,t),e.include(uT,t),e.include(XM,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(I`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===ee.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Yd,t),t.output){case ee.Alpha:e.include(ho,t),i.uniforms.add(new nt("opacity",s=>s.opacity)),i.code.add(I`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `);break;case ee.Color:e.include(ho,t),e.include(hT,t),e.include(JL,t),e.include(uT,t),e.include(PLe,t),W0(i,t),KL(i),nR(i),i.uniforms.add([r.uniforms.get("localOrigin"),new Fr("ambient",s=>s.ambient),new Fr("diffuse",s=>s.diffuse),new Fr("specular",s=>s.specular),new nt("opacity",s=>s.opacity)]),i.include(Qg),Yg(i),i.code.add(I`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          gl_FragColor = vec4(shadedColor, combinedOpacity);
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
          ${t.transparencyPassType===lr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
        }
      `);break;case ee.Depth:case ee.Shadow:case ee.ShadowHighlight:case ee.ShadowExcludeHighlight:e.include(Fu,t),sT(e),e.varyings.add("depth","float"),r.code.add(I`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(ho,t),e.include(Hy,t),i.code.add(I`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case ee.Normal:e.include(Fu,t),e.include(N4,t),pM(r),e.varyings.add("vnormal","vec3"),r.code.add(I`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(ho,t),i.code.add(I`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case ee.Highlight:e.include(Fu,t),e.include(N4,t),e.varyings.add("vnormal","vec3"),r.code.add(I`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(ho,t),e.include(a_,t),i.code.add(I`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const HTt=Object.freeze(Object.defineProperty({__proto__:null,build:jTt},Symbol.toStringTag,{value:"Module"})),LDe=new Map([[B.POSITION,0],[B.PROFILERIGHT,1],[B.PROFILEUP,2],[B.PROFILEVERTEXANDNORMAL,3],[B.FEATUREVALUE,4]]);let qTt=class extends GTt{constructor(){super(...arguments),this.ambient=ct(.2,.2,.2),this.diffuse=ct(.8,.8,.8),this.specular=ct(0,0,0),this.opacity=1}},DDe=class NDe extends Vi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2,r.spherical=e.viewingMode===_t.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Fi(e.rctx,NDe.shader.get().build(this.configuration),LDe)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===lr.NONE,s=e===lr.FrontFace;return Rr({blending:r.output!==ee.Color&&r.output!==ee.Alpha||!r.transparent?null:i?zd:l_(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==Cn.None?tOe:null,depthTest:{func:Ib(e)},depthWrite:i||s?qu:null,colorWrite:zr,stencilWrite:r.hasOccludees?Vg:null,stencilTest:r.hasOccludees?$b:null,polygonOffset:i||s?null:C7})}};DDe.shader=new Ni(HTt,()=>be(()=>import("./Path.glsl-41065b26.js"),[]));let Sa=class extends $a{constructor(){super(...arguments),this.output=ee.Color,this.doubleSidedMode=Cn.None,this.transparencyPassType=lr.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};u([ie({count:ee.COUNT})],Sa.prototype,"output",void 0),u([ie({count:Cn.COUNT})],Sa.prototype,"doubleSidedMode",void 0),u([ie({count:lr.COUNT})],Sa.prototype,"transparencyPassType",void 0),u([ie()],Sa.prototype,"spherical",void 0),u([ie()],Sa.prototype,"receiveShadows",void 0),u([ie()],Sa.prototype,"receiveAmbientOcclusion",void 0),u([ie()],Sa.prototype,"vvSize",void 0),u([ie()],Sa.prototype,"vvColor",void 0),u([ie()],Sa.prototype,"vvOpacity",void 0),u([ie()],Sa.prototype,"hasSlicePlane",void 0),u([ie()],Sa.prototype,"transparent",void 0),u([ie()],Sa.prototype,"hasOccludees",void 0),u([ie()],Sa.prototype,"hasMultipassTerrain",void 0),u([ie()],Sa.prototype,"cullAboveGround",void 0),u([ie()],Sa.prototype,"doublePrecisionRequiresObfuscation",void 0),u([ie({constValue:Qt.Disabled})],Sa.prototype,"pbrMode",void 0),u([ie({constValue:!0})],Sa.prototype,"hasVvInstancing",void 0),u([ie({constValue:!1})],Sa.prototype,"useCustomDTRExponentForWater",void 0),u([ie({constValue:!1})],Sa.prototype,"useFillLights",void 0);let WTt=class FDe extends Pb{constructor(e){super(e,new QTt),this.supportsEdges=!0,this._vertexAttributeLocations=LDe,this._configuration=new Sa,this._vertexBufferLayout=FDe.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==ee.Color&&e!==ee.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Cn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Cn.WindingOrder:Cn.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==ee.Shadow&&e!==ee.ShadowExcludeHighlight&&e!==ee.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,s,n,o){const a=e;if(!MDe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const C=this.parameters.vvSizeOffset,M=this.parameters.vvSizeFactor,O=this.parameters.vvSizeMinSize,$=this.parameters.vvSizeMaxSize,L=l.sizeAttributeValue;c[0]*=ze(C[0]+L*M[0],O[0],$[0]),c[1]*=ze(C[2]+L*M[2],O[2],$[2])}const h=Math.max(c[0],c[1]),p=e.boundingInfo;if(N(p))return void this._intersectTriangles(l,c,s,n,o);const A=zx(p.bbMin[0]-h,p.bbMin[1]-h,p.bbMin[2]-h,p.bbMax[0]+h,p.bbMax[1]+h,p.bbMax[2]+h),_=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],w=Math.sqrt(_[0]*_[0]+_[1]*_[1]+_[2]*_[2]),T=[w/_[0],w/_[1],w/_[2]];wne(A,s,T,i.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(e,r,i,s,n){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,s,n)}createBufferWriter(){return new sR(this._vertexBufferLayout)}requiresSlot(e,r){switch(r){case ee.Shadow:case ee.ShadowHighlight:case ee.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case ee.Color:case ee.Alpha:case ee.Depth:case ee.Normal:case ee.Highlight:case ee.ObjectAndLayerIdColor:return e===(this.parameters.transparent?et.TRANSPARENT_MATERIAL:et.OPAQUE_MATERIAL)||e===et.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new YTt(e)}static getVertexBufferLayout(){return gn().vec3f(B.POSITION).vec4f(B.PROFILERIGHT).vec4f(B.PROFILEUP).vec4f(B.PROFILEVERTEXANDNORMAL).vec4f(B.FEATUREVALUE)}},YTt=class extends Ob{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){(N(this.technique)||e.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==ee.Color&&this._output!==ee.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(DDe,e)}},QTt=class extends qTt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const XTt=["polyline"];let ZTt=class extends Jg{constructor(e,r,i,s){super(e,r,i,s),this._intrinsicSize=ki(1,1),this._upVectorAlignment=qv.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=E(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,r=E(this.symbolLayer.height)?this.symbolLayer.height:e;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,r],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=k4(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?qv.World:qv.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=OTt(A4e);break;case"quad":this._profile=PTt()}let n=[0,0];switch(i!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[i],this._profile.translate(n[0],n[1])),this.symbolLayer.join){case"round":this._extruder=new cH(0,g4e);break;case"bevel":this._extruder=new cH(0,1);break;case"miter":this._extruder=new cH(.8*Math.PI,1);break;default:this._extruder=new LTt}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new kge,this._endCap=new kge;break;case"butt":default:this._startCap=new FN(this._profile,0),this._endCap=new FN(this._profile,0,!0);break;case"square":this._startCap=new FN(this._profile,-.5),this._endCap=new FN(this._profile,.5,!0);break;case"round":{const _=s==="quad";this._startCap=new Bge({profile:this._profile,flip:!1,breakNormals:_,subdivisions:KJ}),this._endCap=new Bge({profile:this._profile,flip:!0,breakNormals:_,subdivisions:KJ});break}}const a=pa(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=Iu(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,A={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?$s.None:$s.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Kr(this._intrinsicSize,e,r),!j9(this._intrinsicSize[0])||!j9(this._intrinsicSize[1])))throw new ce("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Ch(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const _={...A,...this._fastUpdates.materialParameters,size:JTe(this._intrinsicSize)};this._material=new WTt(_)}else A.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new qy(A);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,XTt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new K0),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){const e=pa(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,pb)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!B4(this._fastUpdates,r,this._vvConvertOptions))return Qo.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Qo.Fast_Update}_getVertexData(e){let r=0;const i=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const A of i)r+=A.length;const l=jh(3*r),c=jh(3*r);let h=0;for(const A of i){s.push({index:h,numVertices:A.length});for(const _ of A)l[h++]=_[0],l[h++]=_[1],l[h++]=e.hasZ?_[2]:0}let p=!0;return E(o)&&!n.equals(o)&&(p=Dn(l,n,0,l,o,0,r)),E(o)&&!o.equals(a)?Dn(l,o,0,c,a,0,r):this._copyVertices(l,0,c,0,r),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c,projectionSuccess:p,terrainElevation:0}}_copyVertices(e,r,i,s,n){r*=3,s*=3;for(let o=0;o<n;++o)i[s++]=e[r++],i[s++]=e[r++],i[s++]=e[r++]}_createAs3DShape(e,r,i,s){const n=e.geometry,o=new Array,a=n.spatialReference,l=Jo(),c=this._context.renderCoordsHelper;BDe.spatialReference=a;const h=this._getVertexData(n);if(!h.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(h.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(w=>w.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;for(const w of h.pathVertexDataInfos){const T=w.index,C=w.numVertices;if(C<2||E(this._context.clippingExtent)&&(Fs(l),Dd(l,h.vertexDataES,3*T,C),!v0(l,this._context.clippingExtent)))continue;const M=[];for(let Z=T;Z<T+3*C;){const J=Z++,te=Z++,re=Z++,Ae=new RTt;$e(Ae.posES,h.vertexDataES[J],h.vertexDataES[te],h.vertexDataES[re]);const ve=F_t(Ae.posES,this._context.elevationProvider,i,c);$e(Qs,h.vertexDataRS[J],h.vertexDataRS[te],h.vertexDataRS[re]),c.setAltitude(Qs,ve),Oe(Ae.pos,Qs),M.push(Ae)}const O=new ITt(M);kDe(O,this._upVectorAlignment,this._context.renderCoordsHelper);const $=new DTt(O,this._profile,this._extruder,this._startCap,this._endCap);let L=null;if(this._fastUpdates.enabled){const Z=this._fastUpdates.visualVariables,J=Z.size?xy(Z.size.field,e):0,te=Z.color?xy(Z.color.field,e):0,re=Z.opacity?xy(Z.opacity.field,e):0;L=new NTt($,J,te,re)}else{const Z=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const re=r.size;Z[0]*=Vge(re[0],re[2]==="symbol-value"?this.symbolLayer.height||0:re[2],this.symbolLayer.width||0),Z[1]*=Vge(re[2],re[0]==="symbol-value"?this.symbolLayer.width||0:re[0],this.symbolLayer.height||0)}let J;this._drivenProperties.color&&(J=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(J=J?[J[0],J[1],J[2],r.opacity]:[1,1,1,r.opacity]);const te=new $De($);te.bake(Z),J&&te.bakeVertexColors(J),L=te}const{vertexAttributes:k,indices:F}=L.createGeometryData(),G=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),z=new xTt(this._material,k,F,L,a,this._upVectorAlignment,this._stencilWidth,G);z.transformation=L.xform,o.push(z)}if(o.length===0)return null;const p={layerUid:this._context.layer.uid,graphicUid:s},A=new u_({geometries:o,metadata:p}),_=new Zg(this,A,o,null,null,KTt,i);return _.alignedSampledElevation=h.terrainElevation,_.needsElevationUpdates=pb(i.mode),_}};function kDe(t,e,r){switch(e){default:case qv.World:for(const i of t.vertices){ke(Qs,i.pos,t.offset),r.worldUpAtPosition(Qs,Qs),i.setFrameFromUpVector(Qs),i.rotationFrameUp=i.frame.up,Kr(i.rotationRight,1,0),Me(Qs,i.frame.up,He(i.frame.up,i.vLeft)),Be(Qs,i.vLeft,Qs),nc(Qs,Qs),qe(Qs,Qs),Me(z_,i.frame.up,He(i.frame.up,i.vRight)),Be(z_,i.vRight,z_),qe(z_,z_),Xt(zge,i.rotationFrameUp,i.vLeft);const s=Math.sign(He(zge,i.vRight));if(i.rotationAngle=s*(Math.PI-Zo(He(Qs,z_))),Math.abs(i.rotationAngle)>0){const o=nz(Math.cos(.5*i.rotationAngle));AK(i.miterStretch,o-1+1,0,0,1)}const n=Math.PI-i.rotationAngle;i.maxStretchDistance=Math.abs(i.vMinSiblingLength/Math.cos(.5*n))}break;case qv.Path:ke(Qs,t.vertices[0].pos,t.offset),r.worldUpAtPosition(Qs,Qs),$Tt(t,Qs);for(const i of t.vertices){const s=Math.sign(He(i.frame.right,i.vRight));Xt(i.rotationFrameUp,i.vRight,i.vLeft),Me(i.rotationFrameUp,i.rotationFrameUp,s),qe(i.rotationFrameUp,i.rotationFrameUp);const n=He(i.rotationFrameUp,i.frame.up),o=He(i.rotationFrameUp,i.frame.right);if(Me(Qs,i.frame.up,-o),Me(z_,i.frame.right,n),ke(Qs,Qs,z_),qe(Qs,Qs),MTt(i.rotationRight,i.frame,Qs),nc(Qs,i.vLeft),i.rotationAngle=-s*(Math.PI-Zo(He(Qs,i.vRight))),Math.abs(i.rotationAngle)>0){const l=nz(Math.cos(.5*i.rotationAngle));AK(i.miterStretch,1+(l-1)*i.rotationRight[0]*i.rotationRight[0],(l-1)*i.rotationRight[0]*i.rotationRight[1],(l-1)*i.rotationRight[0]*i.rotationRight[1],1+(l-1)*i.rotationRight[1]*i.rotationRight[1])}const a=Math.PI-i.rotationAngle;i.maxStretchDistance=Math.abs(i.vMinSiblingLength*nz(Math.cos(.5*a)))}}}function Vge(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function JTt(t,e,r,i){let s=0;for(const n of t.vertices)r(n.posES,hH),s+=hH.sampledElevation,ke(Qs,n.pos,t.offset),i.setAltitude(Qs,hH.z),Be(n.pos,Qs,t.offset);return t.updatePathVertexInformation(),s/t.vertices.length}function KTt(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;eSt.spatialReference=s.spatialReference;for(const l of o){if(!MDe(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;BDe.spatialReference=p,a+=JTt(h,e,i,s),l.upVectorAlignment!==qv.World&&kDe(h,l.upVectorAlignment,s),c.onPathChanged(),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return a/o.length}const eSt=c_(0,0,0,null),BDe=c_(0,0,0,null),Qs=V(),z_=V(),zge=V(),hH=new WL;function tSt(t,e,r,i,s=1){if(r.isGeographic&&i===_t.Global){const c=jh(e.length),h=e.length,p=es(r);for(let A=0;A<h;A+=3)Pre(e,A,c,A,p);e=c}Kr(zo,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)zo[0]=Math.min(zo[0],e[c]),zo[1]=Math.min(zo[1],e[c+1]);const n=zo[0]%s,o=zo[1]%s,a=zo[0]-n,l=zo[1]-o;for(let c=0;c<e.length;c+=3){const h=c/3*4;t[h]=(e[c]-a)/s,t[h+1]=(e[c+1]-l)/s,t[h+2]=a/s,t[h+3]=l/s}}function UDe(t,e,r,i,s=1){$e(mw,1,0,0),$e(gw,0,1,0),$e(MS,0,0,1),sSt(dH,r),rSt(r,Gge)&&iSt(Gge,mw,gw,MS,i,dH),Kr(zo,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Kr(Aw,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<r.length;h+=3){$e(CS,r[h],r[h+1],r[h+2]);const p=He(mw,CS),A=He(gw,CS);zo[0]=Math.min(zo[0],p),zo[1]=Math.min(zo[1],A),Aw[0]=Math.max(Aw[0],p),Aw[1]=Math.max(Aw[1],A)}const n=He(MS,dH);fH(G_,zo[0],zo[1],n,mw,gw,MS),fH(yw,Aw[0],zo[1],n,mw,gw,MS),fH(_w,zo[0],Aw[1],n,mw,gw,MS),Be(yw,yw,G_),Me(yw,yw,.5),Be(_w,_w,G_),Me(_w,_w,.5),ke(G_,G_,yw),ke(G_,G_,_w);const o=zo[0]%s,a=zo[1]%s,l=zo[0]-o,c=zo[1]-a;for(let h=0;h<r.length;h+=3){$e(CS,r[h],r[h+1],r[h+2]);const p=h/3,A=4*p;t[A]=(He(mw,CS)-l)/s,t[A+1]=(He(gw,CS)-c)/s,t[A+2]=l/s,t[A+3]=c/s;const _=9*p;for(let w=0;w<3;w++)e[_+w]=G_[w],e[_+w+3]=yw[w],e[_+w+6]=_w[w]}}const dH=V(),CS=V(),Gge=Hi(),mw=V(),gw=V(),MS=V(),zo=Dt(),Aw=Dt(),G_=V(),yw=V(),_w=V();function rSt(t,e){const r=t.length/3-1;return SSe(t,e,0,Math.floor(r/3),Math.floor(r*(2/3)))}function iSt(t,e,r,i,s,n){E(s)?(s.basisMatrixAtPosition(n,ym),$e(BN,ym[0],ym[1],ym[2]),$e(UN,ym[4],ym[5],ym[6]),$e(pH,ym[8],ym[9],ym[10])):($e(BN,1,0,0),$e(UN,0,1,0),$e(pH,0,0,1));const o=t;He(o,pH)<0&&Me(o,o,-1),Oe(i,o);const a=He(o,UN),l=He(o,BN);Math.abs(a)<Math.abs(l)?(Q2(e,BN,o,-l),qe(e,e),Xt(r,e,o),qe(r,r),Me(r,r,-1)):(Q2(r,UN,o,-a),qe(r,r),Xt(e,r,o),qe(e,e))}const ym=ot(),BN=V(),UN=V(),pH=V();function sSt(t,e){$e(fO,0,0,0);for(let r=0;r<e.length-3;r+=3)fO[0]+=e[r],fO[1]+=e[r+1],fO[2]+=e[r+2];Me(t,fO,1/(e.length/3-1))}const fO=V();function fH(t,e,r,i,s,n,o){$e(t,e*s[0]+r*n[0]+i*o[0],e*s[1]+r*n[1]+i*o[1],e*s[2]+r*n[2]+i*o[2])}function nSt(t){const e=new Di,{vertex:r,fragment:i}=e,s=t.output===ee.Depth,n=t.hasMultipassTerrain&&(t.output===ee.Color||t.output===ee.Alpha);return Uh(r,t),e.include(Fu,t),e.include($T,t),e.include(x7,t),e.attributes.add(B.POSITION,"vec3"),e.varyings.add("vpos","vec3"),n&&e.varyings.add("depth","float"),s&&(e.include(Hy,t),sT(e),lb(e)),r.code.add(I`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${n?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${s?I`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:I`transformPosition(proj, view, vpos);`}
    }
  `),e.include(ho,t),n&&e.include(Yd,t),i.include(Qg),i.uniforms.add(new hi("eColor",o=>o.color)),t.output===ee.Highlight&&e.include(a_,t),i.code.add(I`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${t.hasVertexColors?"vColor * eColor;":"eColor;"}

    ${t.output===ee.ObjectAndLayerIdColor?I`fColor.a = 1.0;`:""}

    if (fColor.a < ${I.float(Il)}) {
      discard;
    }

    ${t.output===ee.Alpha?I`gl_FragColor = vec4(fColor.a);`:""}

    ${t.output===ee.Color?I`gl_FragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===lr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${t.output===ee.Highlight?I`outputHighlight();`:""};
    ${t.output===ee.Depth?I`outputDepth(linearDepth);`:""};
    ${t.output===ee.ObjectAndLayerIdColor?I`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const oSt=Object.freeze(Object.defineProperty({__proto__:null,build:nSt},Symbol.toStringTag,{value:"Module"}));let VDe=class zDe extends Vi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2}initializeProgram(e){return new Fi(e.rctx,zDe.shader.get().build(this.configuration),Pi)}_createPipeline(e,r){const i=this.configuration,s=e===lr.NONE,n=e===lr.FrontFace;return Rr({blending:i.output!==ee.Color&&i.output!==ee.Alpha||!i.transparent?null:s?zd:l_(e),culling:KU(i.cullFace),depthTest:{func:Ib(e)},depthWrite:(s||n)&&i.writeDepth?qu:null,colorWrite:zr,stencilWrite:i.hasOccludees?Vg:null,stencilTest:i.hasOccludees?r?gb:$b:null,polygonOffset:s||n?i.polygonOffset?aSt:null:M7(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};VDe.shader=new Ni(oSt,()=>be(()=>import("./ColorMaterial.glsl-fb3a9692.js"),[]));const aSt={factor:1,units:1};let ch=class extends $a{constructor(){super(...arguments),this.output=ee.Color,this.cullFace=$s.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=lr.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1}};u([ie({count:ee.COUNT})],ch.prototype,"output",void 0),u([ie({count:$s.COUNT})],ch.prototype,"cullFace",void 0),u([ie()],ch.prototype,"hasSlicePlane",void 0),u([ie()],ch.prototype,"hasVertexColors",void 0),u([ie()],ch.prototype,"transparent",void 0),u([ie()],ch.prototype,"polygonOffset",void 0),u([ie()],ch.prototype,"enableOffset",void 0),u([ie()],ch.prototype,"writeDepth",void 0),u([ie()],ch.prototype,"hasOccludees",void 0),u([ie({count:lr.COUNT})],ch.prototype,"transparencyPassType",void 0),u([ie()],ch.prototype,"hasMultipassTerrain",void 0),u([ie()],ch.prototype,"cullAboveGround",void 0),u([ie()],ch.prototype,"objectAndLayerIdColorInstanced",void 0);let jge=class extends Xne{constructor(e){super(e,new cSt),this.supportsEdges=!0,this._configuration=new ch}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<E7,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,r){return r===ee.Color||r===ee.Alpha||r===ee.Highlight||r===ee.Depth&&this.parameters.writeLinearDepth||r===ee.ObjectAndLayerIdColor?e===et.DRAPED_MATERIAL?!0:r===ee.Highlight?e===et.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?et.TRANSPARENT_MATERIAL:et.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:et.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new lSt(e)}createBufferWriter(){return new sR(Le("enable-feature:objectAndLayerId-rendering")?Wvt:uLe)}},lSt=class extends Ob{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==ee.Color&&this._output!==ee.Alpha||this._updateOccludeeState(e),this.ensureTechnique(VDe,e)}},cSt=class extends rR{constructor(){super(...arguments),this.color=bg,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=$s.None,this.hasOccludees=!1}};var nl;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(nl||(nl={}));const _K=.70710678118,Hge=_K,uSt=.08715574274;function hSt(t){const e=new Di,r=t.hasMultipassTerrain&&(t.output===ee.Color||t.output===ee.Alpha);t.draped||e.extensions.add("GL_OES_standard_derivatives");const{vertex:i,fragment:s}=e;Uh(i,t),e.include(Fu,t),e.include($T,t),t.draped?i.uniforms.add(new nt("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):e.attributes.add(B.BOUNDINGRECT,"mat3"),e.attributes.add(B.POSITION,"vec3"),e.attributes.add(B.UVMAPSPACE,"vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r&&e.varyings.add("depth","float");const n=t.style===nl.ForwardDiagonal||t.style===nl.BackwardDiagonal||t.style===nl.DiagonalCross;n&&i.code.add(I`
      const mat2 rotate45 = mat2(${I.float(_K)}, ${I.float(-Hge)},
                                 ${I.float(Hge)}, ${I.float(_K)});
    `),t.draped||(W0(i,t),i.uniforms.add(new nt("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),i.code.add(I`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(I`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(I`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${I.float(uSt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(I`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${n?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${n?" * rotate45":""};

      ${t.draped?"":I`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${I.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const o=t.output===ee.Depth;return o&&(e.include(Hy,t),sT(e),lb(e)),i.code.add(I`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${o?I`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:I`transformPosition(proj, view, vpos);`}
    }
  `),e.include(ho,t),s.include(Qg),t.draped&&s.uniforms.add(new nt("texelSize",(a,l)=>1/l.camera.pixelRatio)),t.output===ee.Highlight&&e.include(a_,t),r&&e.include(Yd,t),t.output!==ee.Highlight&&(s.code.add(I`
      const float lineWidth = ${I.float(t.lineWidth)};
      const float spacing = ${I.float(t.patternSpacing)};
      const float spacingINV = ${I.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(I`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.uniforms.add(new hi("uColor",a=>a.color)),s.code.add(I`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${t.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${t.output!==ee.Highlight?I`color.a *= ${dSt(t)};`:""}

      ${t.output===ee.ObjectAndLayerIdColor?I`color.a = 1.0;`:""}

      if (color.a < ${I.float(Il)}) {
        discard;
      }

      ${t.output===ee.Alpha?I`gl_FragColor = vec4(color.a);`:""}

      ${t.output===ee.Color?I`gl_FragColor = color; ${t.transparencyPassType===lr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${t.output===ee.Highlight?I`outputHighlight();`:""}
      ${t.output===ee.Depth?I`outputDepth(linearDepth);`:""};
    }
  `),e}function dSt(t){function e(r){return t.draped?I`coverage(vuv.${r}, texelSize)`:I`sample(vuv.${r})`}switch(t.style){case nl.ForwardDiagonal:case nl.Horizontal:return e("y");case nl.BackwardDiagonal:case nl.Vertical:return e("x");case nl.DiagonalCross:case nl.Cross:return I`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const pSt=Object.freeze(Object.defineProperty({__proto__:null,build:hSt},Symbol.toStringTag,{value:"Module"}));let GDe=class jDe extends Vi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2}initializeProgram(e){return new Fi(e.rctx,jDe.shader.get().build(this.configuration),HDe)}_setPipelineState(e,r){const i=this.configuration,s=e===lr.NONE,n=e===lr.FrontFace;return Rr({blending:i.output===ee.Color||i.output===ee.Alpha?s?zd:l_(e):null,culling:KU(i.cullFace),depthTest:{func:Ib(e)},depthWrite:s?i.writeDepth?qu:null:S7(e),colorWrite:zr,stencilWrite:i.hasOccludees?Vg:null,stencilTest:i.hasOccludees?r?gb:$b:null,polygonOffset:s||n?i.polygonOffset?fSt:null:M7(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};GDe.shader=new Ni(pSt,()=>be(()=>import("./Pattern.glsl-99c1d78c.js"),[]));const fSt={factor:1,units:1};let Fc=class extends $a{constructor(){super(...arguments),this.output=ee.Color,this.cullFace=$s.None,this.transparencyPassType=lr.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([ie({count:ee.COUNT})],Fc.prototype,"output",void 0),u([ie({count:$s.COUNT})],Fc.prototype,"cullFace",void 0),u([ie({count:nl.COUNT})],Fc.prototype,"style",void 0),u([ie({count:lr.COUNT})],Fc.prototype,"transparencyPassType",void 0),u([ie()],Fc.prototype,"hasSlicePlane",void 0),u([ie()],Fc.prototype,"hasVertexColors",void 0),u([ie()],Fc.prototype,"polygonOffset",void 0),u([ie()],Fc.prototype,"writeDepth",void 0),u([ie()],Fc.prototype,"hasOccludees",void 0),u([ie()],Fc.prototype,"patternSpacing",void 0),u([ie()],Fc.prototype,"lineWidth",void 0),u([ie()],Fc.prototype,"enableOffset",void 0),u([ie()],Fc.prototype,"draped",void 0),u([ie()],Fc.prototype,"hasMultipassTerrain",void 0),u([ie()],Fc.prototype,"cullAboveGround",void 0);const HDe=new Map([[B.POSITION,0],[B.COLOR,3],[B.UVMAPSPACE,4],[B.BOUNDINGRECT,5]]);let hoe=class extends Xne{constructor(e){super(e,new ASt),this.supportsEdges=!0,this._vertexAttributeLocations=HDe,this._configuration=new Fc}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<E7,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,r){return r===ee.Color||r===ee.Alpha||r===ee.Highlight||r===ee.Depth&&this.parameters.writeLinearDepth?e===et.DRAPED_MATERIAL?!0:r===ee.Highlight?e===et.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?et.TRANSPARENT_MATERIAL:et.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new mSt(e)}createBufferWriter(){const e=gn().vec3f(B.POSITION).vec4u8(B.COLOR).vec4f(B.UVMAPSPACE);return this.parameters.draped||e.mat3f(B.BOUNDINGRECT),new gSt(e)}},mSt=class extends Ob{_updateParameters(e){return this.ensureTechnique(GDe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==ee.Color&&this._output!==ee.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},gSt=class extends sR{write(e,r,i,s,n){for(const o of this.vertexBufferLayout.fieldNames){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case B.POSITION:{Zt(a.size===3);const c=s.getField(o,ks);c&&w7(l,a.data,e,c,n);break}case B.COLOR:{Zt(a.size===3||a.size===4);const c=s.getField(o,uc);c&&Sne(l,a.data,a.size,c,n);break}case B.UVMAPSPACE:{Zt(a.size===4);const c=s.getField(o,Gh);c&&fM(l,a.data,c,n);break}case B.BOUNDINGRECT:{Zt(a.size===9);const c=s.getField(o,cb);c&&this.writeBoundingRect(l,a.data,e,c,n);break}}}}writeBoundingRect(e,r,i,s,n){const o=i,a=s.typedBuffer,l=s.typedBufferStride,c=e.length;n*=l;for(let h=0;h<c;++h){const p=9*e[h],A=r[p],_=r[p+1],w=r[p+2];a[n]=o[0]*A+o[4]*_+o[8]*w+o[12],a[n+1]=o[1]*A+o[5]*_+o[9]*w+o[13],a[n+2]=o[2]*A+o[6]*_+o[10]*w+o[14];for(let T=3;T<9;++T)a[n+T]=r[p+T];n+=l}}},ASt=class extends rR{constructor(){super(...arguments),this.color=Nr(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=$s.None,this.hasOccludees=!1,this.style=nl.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function ySt(t,e,r){return vSt(_St(t),e,r)}function _St(t){return t&&t.pattern||null}function vSt(t,e,r){return E(t)?t.style==="none"||t.style==="solid"?(t.style==="none"&&(e.color=Nr(0,0,0,0),e.transparent=!0),new jge(e)):(e.style=bSt(t.style),e.draped=r.isDraped,new hoe(e)):new jge(e)}function bSt(t){switch(t){case"horizontal":return nl.Horizontal;case"vertical":return nl.Vertical;case"cross":return nl.Cross;case"forward-diagonal":return nl.ForwardDiagonal;case"backward-diagonal":return nl.BackwardDiagonal;case"diagonal-cross":return nl.DiagonalCross;default:return}}function wSt(t){return t.material instanceof hoe&&!t.material.parameters.draped}function xSt(t,e){if(wSt(t)){const r=t.vertexAttributes.get(B.POSITION).data,i=t.getMutableAttribute(B.UVMAPSPACE).data,s=t.getMutableAttribute(B.BOUNDINGRECT).data;UDe(i,s,r,e)}}function TSt(t,e,r,i,s){const n=l4e(t,e,r,i,s),o=t.stageObject.geometries;for(const a of o)xSt(a,s);return n}const SSt=["polyline","polygon","extent"];let qDe=class WDe extends Jg{constructor(e,r,i,s){super(e,r,i,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(E(this._material))return;const e=pa(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(e);this._material=ySt(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof hoe,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(E(this._outlineMaterial)||!this._isValidOutline(e))return;this._hasOutline=!0;const r=i=>{const s=eDe(e.pattern);return new MC({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:dK(e.patternCap||"butt")})};this._outlineMaterial=r(ll(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return E(e)&&e.size!=null&&e.size>0&&E(e.color)&&(N(e.pattern)||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,SSt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new K0);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}layerOpacityChanged(){if(E(this._material)){const e=this._material.parameters.color,r=pa(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(r);this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(E(this._outlineMaterial)){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=qL(WDe.elevationModeChangeTypes,i,s);if(n!==Ln.UPDATE)return n;const o=ff(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){if(E(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),E(this._outlineMaterial)){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,r,i){var h;const s=L4(e.geometry);if(N(s))return null;const n=ioe(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new ESt(n,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=uo(4*a,!0),o.boundingRect=jh(9*a,!0),UDe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new u_({geometries:o.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),c=new Zg(this,l,o.outGeometries,null,null,TSt,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=ff(i.mode),c}_createAs3DShapeFill(e){const r=e.renderData.polygons;for(const{position:i,mapPositions:s,holeIndices:n,index:o,count:a}of r){if(E(this._context.clippingExtent)&&(Fs(op),Dd(op,s),!v0(op,this._context.clippingExtent)))continue;const l=fb(s,n,3);if(l.length===0)continue;const c=wme({material:this._material,indices:l,mapPositions:s,attributeData:{position:i,color:e.color,uvMapSpace:this._needsUV?Afe(e.uvMapSpace,4*o,4*a):null,boundingRect:this._needsUV?Xp(e.boundingRect,9*o,9*a):null,objectAndLayerIdColor:e.objectAndLayerIdColor}});e.outGeometries.push(c)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:s,position:n}=r[i];if(E(this._context.clippingExtent)&&(Fs(op),Dd(op,s),!v0(op,this._context.clippingExtent)))continue;const o=pK(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},e.objectAndLayerIdColor),a=o.vertexAttributes.get(B.POSITION);a.data===n&&(a.data=vdt(n)),e.outGeometries.push(o)}}_createAsOverlay(e,r){var a;const i=L4(e.geometry);if(N(i))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,E(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=CLe(i,this._context.overlaySR),n=new CSt(s,r,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=uo(4*o,!0),tSt(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=Fs(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,i.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new N7(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e){const r=e.renderData.polygons;for(const{position:i,holeIndices:s,index:n,count:o}of r){const a=Fs(op);if(Dd(a,i),!v0(a,this._context.clippingExtent))continue;const l=fb(i,s,3);if(l.length===0)continue;U3(e.outBoundingBox,a);const c=wme({material:this._material,indices:l,attributeData:{position:i,color:e.color,uvMapSpace:this._needsUV?Afe(e.uvMapSpace,4*n,4*o):null,objectAndLayerIdColor:e.objectAndLayerIdColor}}),h=new yM(c,e);ns(h.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(h)}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if(Fs(op),Dd(op,s),!v0(op,this._context.clippingExtent))continue;U3(e.outBoundingBox,op);const n=pK(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor),o=new yM(n,e),a=op;ns(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(o)}}_getOutlineOpacity(){const e=pa(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(E(e)?e.a:0)}_getOutlineColor(){const e=pa(this.symbolLayer,"outline","color"),r=this._getOutlineOpacity();return t$(E(e)?Ot.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};qDe.elevationModeChangeTypes={definedChanged:Ln.RECREATE,staysOnTheGround:Ln.NONE,onTheGroundChanged:Ln.RECREATE};const op=Jo();let ESt=class extends I7{constructor(e,r,i,s){super(e,i,s),this.color=r}},CSt=class extends I7{constructor(e,r,i,s){super(e,i,s),this.color=r}},YDe=class QDe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){const i=pa(e,"material","color"),s=Ed(i,bg,Ot.toUnitRGBA),n=Ed(e.size,12,ll),o=e.lineHeight,a=E(e.background)?Ot.toUnitRGBA(e.background.color):bg,l={family:Ed(e.font,"sans-serif",_=>_.family),decoration:Ed(e.font,"none",_=>_.decoration),weight:Ed(e.font,"normal",_=>_.weight),style:Ed(e.font,"normal",_=>_.style)},c=e.halo,h=E(c)&&E(c.color)&&c.size>0?{size:ll(c.size),color:Ot.toUnitRGBA(c.color)}:{size:0,color:bg},p=new QDe({color:s,size:n,background:{color:a,padding:E(e.background)?[.65*n,.5*n]:[0,0],borderRadius:E(e.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:r}),A=p.fontString(n);try{await document.fonts.load(A)}catch{we.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${A}'. Some text symbology may be rendered using the default browser font.`)}return p}},MSt=class{constructor(e,r,i){this._renderer=new jLe(e,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=cK(RSt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new IT(e,{wrap:{s:pr.CLAMP_TO_EDGE,t:pr.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:Vv.PAD})}};const RSt={canvas:null},OSt=[0,0,1];let PSt=class extends Jg{constructor(e,r,i,s){super(e,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=R7(this.symbolLayer.size);if(e)throw new ce("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await YDe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=$4(r.geometry);if(N(i))return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(N(s)||s==="")return null;const n=Tre(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(E(n)&&!Gxe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new n4e(n,this.symbolLayer.horizontalAlignment,Ewt(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,s,o)}createLabel(e,r,i,s){const n=e.graphic,o=$4(n.geometry);if(N(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,r,i,s)}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return qge(e,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),Ln.UPDATE}slicePlaneEnabledChanged(e,r){return qge(e,r,i=>{for(const s of i.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}skipHighSymbolLodsChanged(){return!0}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,E(r.metadata)?r.metadata.elevationOffset:0),r.needsElevationUpdates=ff(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return $St}_createAs3DShape(e,r,i,s,n,o){const a=this.setGraphicElevationContext(e,new K0,s.elevationOffset),l=pa(e.geometry,"type")==="polyline",c=e.uid;let h=null,p=null;if(N(o)){const z=qLe(s.horizontalPlacement);h=new MSt(i,z,this._textRenderParameters);let Z=null;if(E(this._context.sharedResources.textures)){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{E(Z)&&Z.release()});const J=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(N(J)||Zd(J))return p.release(),null;Z=J}}const A=ISt(h,s),_={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:A,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(E(o)?_.textureId=o.id:E(p)&&(_.textureId=p.texture.id),E(s.verticalOffset)){const{screenLength:z,minWorldLength:Z,maxWorldLength:J}=s.verticalOffset;_.verticalOffset={screenLength:ll(z),minWorldLength:Z||0,maxWorldLength:E(J)?J:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:z,screenSizePerspectiveSettingsLabels:Z}=this._context.sharedResources;_.screenSizePerspective=Z.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),_.screenSizePerspectiveAlignment=z}let w;if(l&&(_.shaderPolygonOffset=1e-4),_.hasSlicePlane=this._context.slicePlaneEnabled,E(n)){const z=JSON.stringify(_);w=n.get(z),N(w)&&(w=new mM(_),n.add(z,w))}else w=new mM(_);const T=s.translation,C=E(h)?ki(h.displayWidth,h.displayHeight):Hu,M=s.centerOffset,O=OJ(w,OSt,T,null,C,M,[0,0],null),$=Vne(this._context,r,O,a,c);if(N($))return null;const L=new Zg(this,$.object,[O],N(n)?[w]:null,p,P4,a);L.alignedSampledElevation=$.sampledElevation,L.needsElevationUpdates=ff(a.mode)||a.mode==="absolute-height";const{displayWidth:k,displayHeight:F}=E(h)?h:s;L.getScreenSize=(z=Dt())=>(z[0]=k,z[1]=F,z);const G=new m4e(s.elevationOffset,i);return L.metadata=G,I4(L,r,this._context.elevationProvider),L}};function qge(t,e,r){t&&t.forEach(i=>{const s=e(i);E(s)&&r(s,i.graphic)})}function ISt(t,e){if(e.verticalPlacement==="baseline"){const i=xwt[e.horizontalPlacement],s=E(t)?t.baselineAnchorY:0;return ki(i,s)}const r=Swt(e.horizontalPlacement,e.verticalPlacement);return h8[r]}const $St={mode:"relative-to-ground",offset:0},LSt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},DSt=["polyline","polygon","extent"];let vK=class y2 extends Jg{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,DSt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new K0);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(E(this._material))return;const e=new ALe,r=this.symbolLayer.color;E(r)&&(e.color=Ot.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=E(this.symbolLayer.waveDirection)?y2.headingVectorFromAngle(this.symbolLayer.waveDirection):ki(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=LSt[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new gLe(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(N(this._material))return;const e=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=qL(y2.elevationModeChangeTypes,i,s);if(n!==Ln.UPDATE)return n;const o=ff(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return E(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,r,i){const s=L4(e.geometry);if(N(s))return null;const n=ioe(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=n.position.length/3,a=jh(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new NSt(n,a);if(this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new u_({geometries:l.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),h=new Zg(this,c,l.outGeometries,null,null,l4e,r);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=ff(r.mode),h}_createUVCoordsFromVertices(e,r,i,s){const n=tu(s);lf(j_);for(let l=0;l<i;l++)Kr(Wge,r[3*l],r[3*l+1]),fre(j_,Wge);MM(j_,j_,n);const o=j_[0]%y2.unitSizeOfTexture,a=j_[1]%y2.unitSizeOfTexture;VN[0]=j_[0]-o,VN[1]=j_[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*n-VN[0])/y2.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*n-VN[1])/y2.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of r){if(E(this._context.clippingExtent)&&(Fs(H_),Dd(H_,a),!v0(H_,this._context.clippingExtent)))continue;const c=fb(a,l,3);if(c.length===0)continue;const h=Xp(i,2*n,2*s),p=xme({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:h}});e.outGeometries.push(p)}}_createAsOverlay(e){const r=L4(e.geometry);if(N(r))return null;this._material.renderPriority=this._renderPriority;const i=CLe(r,this._context.overlaySR),s=i.position.length/3,n=jh(2*s);this._createUVCoordsFromVertices(n,i.position,s,this._context.overlaySR);const o=new FSt(i,n,this._context.layer.uid,e.uid);return o.outBoundingBox=Fs(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new N7(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if(Fs(H_),Dd(H_,s),!v0(H_,this._context.clippingExtent))continue;U3(e.outBoundingBox,H_);const l=fb(s,n,3);if(l.length===0)continue;const c=Xp(r,2*o,2*a),h=xme({material:this._material,indices:l,attributeData:{position:s,uv0:c}}),p=new yM(h,e),A=H_;ns(p.boundingSphere,.5*(A[0]+A[3]),.5*(A[1]+A[4]),0,.5*Math.sqrt((A[3]-A[0])*(A[3]-A[0])+(A[4]-A[1])*(A[4]-A[1]))),e.outGeometries.push(p)}}static headingVectorFromAngle(e){const r=Dt(),i=qB(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};vK.unitSizeOfTexture=100,vK.elevationModeChangeTypes={definedChanged:Ln.RECREATE,staysOnTheGround:Ln.NONE,onTheGroundChanged:Ln.RECREATE};const VN=Dt(),j_=si(),Wge=Dt(),H_=Jo();let NSt=class extends I7{constructor(e,r){super(e,null,null),this.uvCoords=r}},FSt=class extends I7{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}};function kSt(t,e,r,i){const s=Yge[t.type]&&Yge[t.type][e.type]||BSt[e.type];return s?new s(t,e,r,i):(we.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const BSt={icon:hK,object:rTt,line:tDe,path:ZTt,fill:qDe,extrude:lwt,text:PSt,water:vK},Yge={"mesh-3d":{fill:k2t}};let USt=class extends kne{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const s=this.symbolLayers[i];E(s)&&(s.symbol=e,s.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.getItemAt(n);if(o.enabled===!1)continue;zN.renderPriority=1-(1+n)/i,zN.renderPriorityStep=1/i,zN.ignoreDrivers=o._ignoreDrivers;const a=kSt(this.symbol,o,this._context,zN),l=nte(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await GB(this.symbolLayers,async(n,o)=>{if(E(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),di(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return E(r)?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>E(e)&&e.queryForSnapping)}createGraphics3DGraphic(e,r){const i=e.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=E(a)?a.createGraphics3DGraphic(e):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new L1t(i,r||this,s,e.layer,n)}get complexity(){return Une(this.symbolLayers.map(e=>pa(e,"complexity")))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof Zg?l:null};if(E(n)&&!n.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==Sd.LOADED?Qo.Recreate_Symbol:this.symbolLayers.reduce((i,s)=>i!==Qo.Recreate_Symbol&&E(s)?Math.min(i,s.applyRendererDiff(e,r)):i,Qo.Fast_Update)}prepareSymbolPatch(e){if(this.loadStatus===Sd.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(N(s))return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];E(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(e,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(N(s))continue;const n=e.layers[i];if(N(n)||!s.updateGeometry(n,r))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(N(i))continue;const s=e.layers[r];E(s)&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(s=>{N(s)||(s.loadStatus===Sd.LOADING?e++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,s){const n=this.symbolLayers.filter(E).filter(a=>E(a.queryForSnapping)).map(a=>a.queryForSnapping(e,r,i,s)),o=await Promise.all(n);return di(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)E(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const zN={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};let VSt=class extends kne{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return E(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return E(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return E(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),E(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return E(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return E(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:Bne}globalPropertyChanged(e,r){return!!E(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return E(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(e,r):Qo.Recreate_Symbol}prepareSymbolPatch(e){E(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return!!E(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,r)}onRemoveGraphic(){}getFastUpdateStatus(){return E(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){E(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function doe(t){return t instanceof VSt?t.graphics3DSymbol:t instanceof USt?t:null}const U4=we.getLogger("esri.views.3d.layers.graphics.labelPlacement");function zSt(t){const e=ZSt(t);if(N(e))return null;const r=GSt(t,e);if(N(r))return null;const i=r.anchor,s=!!e.hasLabelVerticalOffset;return HSt({anchor:i,verticalOffset:e.verticalOffset,screenOffset:Dt(),centerOffset:Nr(0,0,0,-1),centerOffsetUnits:"world",translation:V(),elevationOffset:0,hasLabelVerticalOffset:s},r,t)}function GSt(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=E0[r],s=i||eB(t);return r&&!i&&U4.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),jSt(s,t)}function poe(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=doe(e);return E(r)?r.symbol.symbolLayers.getItemAt(0):null}function jSt(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(N(r))return null;if(E(e.disablePlacement))return e.labelClass.labelPlacement?(U4.warnOncePerTick(Qge(t.placement,e.disablePlacement.logEntityDescription)),eB(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return U4.warnOncePerTick(Qge(t.placement,`'${i}' geometries`)),eB(e);break;case"point":case"mesh":return t}return t}function Qge(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function eB(t){const e=t.graphics3DGraphic.graphic.geometry;if(N(e))return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=poe(t);return E(r)&&r.type==="extrude"?E0["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return E0["above-center"];default:return}}function HSt(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(N(i))return null;switch(i.type){case"point":WSt(t,e,r);break;case"polygon":qSt(t,e,r);break;case"mesh":foe(t,e,r.graphics3DGraphic.layers[0])}return t}function qSt(t,e,r){const i=poe(r);if(!N(i))switch(i.type){case"extrude":{const s=r.graphics3DGraphic.layers[0];E(s)?(s.getBoundingBoxObjectSpace(c$),_0(c$,t.translation),t.translation[2]=Sb(c$)/2):$e(t.translation,0,0,0),foe(t,e,s);break}}}function WSt(t,e,r){const i=poe(r);if(N(i))return;const s=r.graphics3DGraphic.layers[0];switch(E(s)?s.getCenterObjectSpace(t.translation):$e(t.translation,0,0,0),i.type){case"icon":case"text":YSt(t,e,r,s);break;case"object":foe(t,e,s)}}function YSt(t,e,r,i){const{graphics3DGraphic:s}=r,n=E(i)?i.getScreenSize():null;if(!s.isDraped&&E(n)){const o=QSt(r);mO[0]=n[0]/2*(e.normalizedOffset[0]-o[0]),mO[1]=n[1]/2*(e.normalizedOffset[1]-o[1]),t.screenOffset[0]=mO[0],t.hasLabelVerticalOffset?(t.centerOffset[1]=mO[1],t.centerOffsetUnits="screen"):t.screenOffset[1]=mO[1]}else t.hasLabelVerticalOffset||t.anchor==="center"||(E0[r.labelClass.labelPlacement]&&U4.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center")}function QSt(t,e=JSt){const{graphics3DGraphic:r}=t,i=r.layers[0],s=E(i)?i.stageObject.geometries[0].material:null;if(s&&s instanceof mM){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function foe(t,e,r){const i=E(r)?r.getBoundingBoxObjectSpace(c$):c$,s=ct(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=st(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function XSt(t){return t==="above-center"}function ZSt(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,s=doe(i.graphics3DSymbol),n=ka(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=E0[e]||eB(t);return E(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Xge(n.verticalOffset),anchor:null,normalizedOffset:null}:r&&r.hasVisibleVerticalOffset()&&(N(n)||!n.supportsCallout()||!n.verticalOffset||i.isDraped)?XSt(o.placement)?{placement:"above-center",verticalOffset:Xge(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(U4.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function Xge(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const E0={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Zge={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in Zge){const e=Zge[t],r=E0[t];e.forEach(i=>{E0[i]=r})}Object.freeze&&(Object.freeze(E0),Object.keys(E0).forEach(t=>{Object.freeze(E0[t]),Object.freeze(E0[t].normalizedOffset)}));const mO=[0,0],JSt=[0,0],c$=Jo();let Jge=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const mH=512,gH=4096,KSt=.85,eEt=.95;let tEt=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=Zr()}},rEt=class{constructor(e,r){this.textId=e,this.textRenderer=r,this.placement=new tEt,this.rendered=!1}},JP=class extends Ke{constructor(e){super(e),this.type=Xn.Texture,this.id=kh(),this.events=new Nn,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._stage=this.view._stage,this._canvas=this._create2DCanvas(),this._ctx=this._canvas.getContext("2d"),this._stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=Nt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this._atlas.size.width}get height(){return this._atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,flipped:!0,samplingMode:Bt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return E(this._glTexture)||(this._glTexture=new Wt(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(ir.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=sn(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Nt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",mH.toString()),e.setAttribute("height",mH.toString()),e}_update2DCanvasSize(){this._canvas.setAttribute("width",this._atlas.size.width.toString()),this._canvas.setAttribute("height",this._atlas.size.height.toString())}_createAtlasRegion(e=mH){this._atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,r){let i=Math.max(e,r);return i+=256,i=$3(i),i=Math.min(i,gH),i}_resizeAtlas(e,r){r=r||e;const i=this._atlas;i.size.width=e,i.size.height=r,E(this._glTexture)&&this._glTexture.resize(e,r),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this._atlas;e.cursor.x=gO,e.cursor.y=gO+Kge,e.lineHeight=0,this._needsClear=!0}_getAtlasUsage(){const e=this._atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this._elementsToRemove.size,r=this._elementsToAddOrUpdate.size,i=this._elements.size;return this._getAtlasUsage()/i*(i+r-e)}_addAtlasElement(e,r,i,s){const n=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,ns(e.placement.uvMinMax,e.placement.offset.x/n.size.width,1-(e.placement.offset.y+a)/n.size.height,(e.placement.offset.x+o)/n.size.width,1-e.placement.offset.y/n.size.height),n.cursor.x+=i,n.lineHeight=Math.max(n.lineHeight,s),this._elements.set(r,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const r=e.placement.offset;this._ctx.clearRect(r.x,r.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i&&i.delete(r)&&(r.geometries[0].vertexAttributes.get(B.SIZE).data=[0,0],r.geometryVertexAttrsUpdated(r.geometries[0]))}_processAddition(e,r){const i=this._atlas,s=e.textId,n=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=n+gO,l=o+gO+Kge;if(i.cursor.x+a<i.size.width&&i.cursor.y+l<i.size.height)this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s);else{if(!(i.cursor.y+l+i.lineHeight<i.size.height)){const c=this._getExpectedAtlasUsage(),h=c>KSt&&i.size.width<gH;return h&&this._resizeAtlas(2*i.size.width,2*i.size.height),!r||!h&&c>eEt&&i.size.width===gH?(this._processRemovals(),RC.OK):(this._repack(),RC.REPACK)}i.cursor.x=gO,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s)}return RC.OK}_processRemovals(){this._elementsToRemove.forEach((e,r)=>{const i=this._stageObjects.get(r);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this._stageObjects.delete(r)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,r)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(r,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const r=this._stageObjects.get(e.textId);r&&r.forEach(i=>{i.geometries[0].vertexAttributes.get(B.UV0).data=new Float32Array(e.placement.uvMinMax),i.geometries[0].vertexAttributes.get(B.SIZE).data=[e.textRenderer.displayWidth,e.textRenderer.displayHeight],i.geometryVertexAttrsUpdated(i.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,r=!0){if(N(this._glTexture))return Dl.YIELD;let i=!1;if(Ml(this._elementsToAddOrUpdate,(n,o)=>{const a=this._elements.get(o);if(a&&a.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const h=c.geometries[0].vertexAttributes,p=this._elements.get(o);h.get(B.UV0).data=p.placement.uvMinMax,h.get(B.SIZE).data=[p.textRenderer.displayWidth,p.textRenderer.displayHeight],c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),r)===RC.REPACK&&(i=!0,!0)}),i)return this.runTask(jc,!1),void e.madeProgress();let s=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),Ml(this._elementsToRender,(n,o)=>(this._processRenderingRequest(n),this._elementsToRender.delete(o),s=!0,e.madeProgress(),e.done)),s&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&tvt.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,r){const i=e.key;this._elementsToAddOrUpdate.has(i)||this._elementsToAddOrUpdate.set(i,new rEt(i,e)),this._addStageObject(i,r),this._elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,r){const i=e.key;this._elementsToRemove.set(i,this._elements.get(i)),this._removeStageObject(i,r)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((i,s)=>e.push({element:i,key:s}));let r=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){r=!1;break}if(!r||this._elementsToRemove.size){e.sort((i,s)=>i.key.localeCompare(s.key)),this._elements.clear();for(const{element:i,key:s}of e)this._elements.set(s,i);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:r,_elementsToRemove:i,_atlas:s}=this,n=this;return{elements:e,stageObjects:r,elementsToRemove:i,atlas:s,resizeAtlas:(o,a)=>n._resizeAtlas(o,a),run:(o,a)=>n.runTask(o,a)}}};u([d({constructOnly:!0})],JP.prototype,"view",void 0),u([d({type:Boolean})],JP.prototype,"updating",void 0),JP=u([j("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],JP);const gO=2,Kge=2;var RC;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(RC||(RC={}));let eAe=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},iEt=class{constructor(e,r,i,s,n){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},sEt=class{constructor(e,r,i,s,n,o,a){this.layer=e,this.graphics3DCore=r,this.scaleVisibility=i,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=n,this.disablePlacement=o,this.active=a,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new V4e({pickable:!0,disableOctree:!0},e.uid)}},_2=class extends Ke{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new ts,this._handles.add([xe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),xe(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(ir.LABELER,this)]),this._textTextureAtlas=new JP({view:this.view}),this._hudMaterialCollection=new Jge(this.view._stage),this._calloutMaterialCollection=new Jge(this.view._stage)}dispose(){this._handles=gt(this._handles),this._textTextureAtlas=Nt(this._textTextureAtlas),this._hudMaterialCollection=Nt(this._hudMaterialCollection),this._calloutMaterialCollection=Nt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const s=new eAe(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s),r.setVisibilityFlag(Mh.USER_SETTING,!0,sl.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(Mh.USER_SETTING,!1,sl.LABEL),this.setLabelGraphicVisibility(r,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];E(i)&&this._textTextureAtlas.addTextTexture(i,r.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];E(i)&&this._textTextureAtlas.removeTextTexture(i,r.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Dl.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active){if(!tAe(r)){if(nEt(r)){this._deactivateLabelingContext(r);continue}if(this._createLabelClassContext(r),AH(r)){this._dirty=!0;continue}if(!tAe(r))continue}Ml(r.labelsToInitialize,(i,s)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(s,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(r=>this._removeLabelTextureFromAtlas(r)),this._labelsToAdd.forEach(r=>this._addLabelTextureToAtlas(r)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const r=(o=e.labelClassAbortController)==null?void 0:o.signal;await((l=(a=e.layer).when)==null?void 0:l.call(a)),di(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,s=i.layer,n=s.labelingInfo&&s.labelingInfo.filter(c=>!!c.symbol);!n||n.length===0||(await GB(n,async(c,h)=>{const p=c.symbol,A=doe(i.getOrCreateGraphics3DSymbol(p));if(N(A))return void we.getLogger(this.declaredClass).error("Failed to create Graphics3DSymbol for label");await A.load(),di(r);let _=null;Tre(p)&&p.hasVisibleCallout()&&(_=P1t(p,i.symbolCreationContext),await _.load(),di(r));const w=await B0(i4e(c,e.layer.fieldsIndex,this.view.spatialReference));if(di(r),w.ok===!0){const T=await this._createTextRenderParameters(A.symbol);di(r),e.labelClassContexts[h]=new iEt(c,A,_,T,w.value)}else we.getLogger(this.declaredClass).error(`Label expression failed to evaluate: ${w.error}`)}),di(r))}async _createLabelClassContext(e){return N(e.labelClassPromise)&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(vo(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.getItemAt(0);return r&&r.type==="text"?YDe.fromSymbol(r,this.view.state.rasterPixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,tf(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,s,n){const o=new n4e(i.verticalOffset,pge(i.anchor),Twt(i.anchor),e.text,i.translation,i.elevationOffset,i.centerOffset,i.screenOffset,i.centerOffsetUnits,e.displayWidth,e.displayHeight);return q_.graphic=r,q_.renderingInfo=null,q_.layer=s,n.createLabel(q_,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,r,i,s,n){return q_.graphic=e,q_.layer=n,q_.renderingInfo=new R1t(null,r,s.translation,s.centerOffset,s.screenOffset,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(q_)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,s=i.labelClassContexts;if(!s||s.length===0||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let n=!1;const o=r.graphic,a=i.layer,l=GN(i.layer),c=this.view._stage;for(let h=0;h<s.length;h++){const p=e.textRenderers[h],A=e.textLabelPlacements[h];if(N(p)||N(A))continue;const _=s[h],w=_.graphics3DSymbol,T=w.symbol&&w.symbol.type==="label-3d"?w.symbol:null,C=w.symbolLayers[0];if(!C)continue;C.setElevationInfoOverride(i.elevationInfoOverride);const M=this._createTextSymbolGraphic(p,o,A,a,C);if(N(M))return!1;M._labelClass=_.labelClass,M._labelIndex=h,r.addLabelGraphic(M,c,i.stageLayer),r.setVisibilityFlag(Mh.USER_SETTING,l,sl.LABEL),r.clearVisibilityFlag(Mh.SCALE_RANGE,sl.LABEL),r.setVisibilityFlag(Mh.DECONFLICTION,!1,sl.LABEL),n=!0;const O=_.graphics3DCalloutSymbolLayer;if(O&&A.hasLabelVerticalOffset){O.setElevationInfoOverride(i.elevationInfoOverride);const $=this._createLineCalloutGraphic(o,T,O,A,a);E($)&&(_.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic($,c,i.stageLayer))}break}return i.scaleVisibility&&n&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const s=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];s!=null&&s.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const s=e.graphics3DGraphic.graphic;for(let o=0;o<i.length;o++){const a=i[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,!a.textRenderParameters)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const O=l.needsHydrationToEvaluate()?M_t(s,r.layer):s;c=l.evaluate(O)}catch{c=null}else c=l.evaluate(s);if(N(c)||c===""||/^\s+$/.test(c))continue;const h=a.graphics3DSymbol,p=((n=h.symbol)==null?void 0:n.type)==="label-3d"?h.symbol:null;if(!h.symbolLayers[0])continue;const A=e.graphics3DGraphic,_=a.labelClass,w=r.disablePlacement,T=zSt({graphics3DGraphic:A,labelSymbol:p,labelClass:_,disablePlacement:w});if(N(T))continue;const C=pge(T.anchor),M=qLe(C);e.textRenderers[o]=new jLe(c,M,a.textRenderParameters),e.textLabelPlacements[o]=T}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const s=new eAe(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,s=this._labels.get(i);e.graphics.delete(i),s&&(this._destroyGraphic(s,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.has(r)&&(this._labels.delete(r),this._labelsToAdd.delete(r),this._labelsToRemove.delete(r)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const s=e.graphics.get(i);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const s=new Map;r.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const r=GN(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const s=this._labels.get(i);s&&(this._destroyGraphic(s,i),s.visible=!1,s.rendered=!1,e.labelsToInitialize.set(i,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const s=i&&i.emptySymbolLabelSupported||!1,n=i&&i.elevationInfoOverride||null,o=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new sEt(a,e,r,s,n,o,GN(a));return this.view._stage.add(l.stageLayer),this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>GN(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(s=>this._removeGraphic(r,s)),this.view._stage.remove(r.stageLayer),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,s=this._labels.get(i);s&&s.visible!==r&&(r&&!s.rendered?(this._labelsToAdd.set(i,s),this._labelsToRemove.delete(i),s.textInitialized||s.labelingContext.labelsToInitialize.set(i,s)):!r&&s.rendered&&(this._labelsToRemove.set(i,s),this._labelsToAdd.delete(i)),s.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(r=>AH(r))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(AH(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function AH(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function tAe(t){return t.labelClassContexts&&t.labelClassContexts.length}function nEt(t){return t.labelClassContexts===null}function GN(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(r=>!!r.symbol))}u([d({constructOnly:!0})],_2.prototype,"view",void 0),u([d({constructOnly:!0})],_2.prototype,"deconflictor",void 0),u([d()],_2.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],_2.prototype,"updating",null),_2=u([j("esri.views.3d.layers.graphics.Labeler")],_2);const q_=new O1t(null,null,null);let KP=class GE{constructor(e,r,i,s=null){this.lij=[0,0,0],this.extent=si(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Yl.VISIBLE_ON_SURFACE,screenRect:si(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,r,i,s)}acquire(e,r,i,s){this.tilingScheme=s,this.id=GE.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,s.getExtent(e,r,i,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(r,i,s,this.tilingScheme),e[1].acquire(r,i+1,s,this.tilingScheme),e[2].acquire(r,i,s+1,this.tilingScheme),e[3].acquire(r,i+1,s+1,this.tilingScheme),e):[new GE(r,i,s,this.tilingScheme),new GE(r,i+1,s,this.tilingScheme),new GE(r,i,s+1,this.tilingScheme),new GE(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,Fy(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var Yl;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Yl||(Yl={}));const XDe=.5*Math.PI,oEt=XDe/Math.PI*180;let aEt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:V(),direction:V()};for(let r=0;r<4;r++)this._extent[r]={origin:V(),direction:V(),cap:{next:null,direction:V()}},this._planes[r]=Hi();this._planes[Ms.NEAR]=Hi(),this._planes[Ms.FAR]=Hi(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,r,i),ke(this._center.origin,n[0].origin,n[2].origin),Me(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||Me(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,Yy(a.cap.direction,a.origin,l.origin),i4(a.direction,a.cap.direction,a.origin,this._planes[o]),s||Me(a.direction,a.direction,-1)}i4(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[Ms.NEAR]),s?_Q(this._planes[Ms.NEAR],this._planes[Ms.FAR]):(wU(this._planes[Ms.FAR],this._planes[Ms.NEAR]),_Q(this._planes[Ms.NEAR],this._planes[Ms.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*es(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===_t.Global){const n=this._maxSpanSpatialReference.isGeographic?oEt:XDe*r;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(i||!e.intersectsRay(qd(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!i&&e.intersectsRay(qd(o.origin,o.direction))||e.intersectsLineSegment(gx(o.origin,o.cap.next,cEt),o.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(Rft(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){mre(e,Rf),Rf[2]=i,G0(r,Rf,yH,this._renderCoordsHelper.spatialReference),ul(rAe,yH),Fs(Ku);for(const{x0:n,x1:o,y0:a,y1:l}of lEt)for(let c=0;c<5;c++){const h=c/4;Rf[0]=Sr(e[n],e[o],h),Rf[1]=Sr(e[a],e[l],h),Rf[2]=i,Ba(Rf,r,Rf,this._renderCoordsHelper.spatialReference),Mt(Rf,Rf,rAe),Fg(Ku,Rf)}$e(this._extent[0].origin,Ku[0],Ku[1],Ku[2]),$e(this._extent[1].origin,Ku[3],Ku[1],Ku[2]),$e(this._extent[2].origin,Ku[3],Ku[4],Ku[2]),$e(this._extent[3].origin,Ku[0],Ku[4],Ku[2]);for(let n=0;n<4;++n)Mt(this._extent[n].origin,this._extent[n].origin,yH)}_toRenderBoundingExtentLocal(e,r,i){yU(e,r,fA,this._renderCoordsHelper.spatialReference),$e(this._extent[0].origin,fA[0],fA[1],i),$e(this._extent[1].origin,fA[2],fA[1],i),$e(this._extent[2].origin,fA[2],fA[3],i),$e(this._extent[3].origin,fA[0],fA[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case _t.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case _t.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Rs(e.planes[Ms.NEAR],this._center.origin)<0&&He(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(Rs(e.planes[Ms.NEAR],i.origin)<0&&He(i.direction,e.direction)<0)return!0}return!1}};const lEt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Rf=V(),yH=ot(),rAe=ot(),Ku=Jo(),fA=si(),cEt=Q0();let uEt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new sv(e),this._extendedFrustum=new sv(e),this._intersector=new aEt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return Yl.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===_t.Global&&e.lij[0]>=hEt&&e.lij[0]<dEt,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==Yl.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=sv.nearFarLineIndices,i=e.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];Be(rd,l,a),Me(rd,rd,fEt),ke(i[o],a,rd)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=Yl.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const s=oAe.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Yl.INVISIBLE&&(r=o,o===Yl.VISIBLE_ON_SURFACE))break}return oAe.release(s),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===_t.Global&&e.lij[0]<pEt?this._calculateSingleTileVisibilitySided(e,!1)===Yl.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,r){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=es(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?Yl.VISIBLE_ON_SURFACE:Yl.VISIBLE_WHEN_EXTENDED:Yl.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,rd);this._aboveGround||nc(r,r);const i=Zo(-He(r,e.viewForward));if(this._allTilesInvisible=i>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,rd),a){case zt.FAR_BOTTOM_LEFT:case zt.FAR_TOP_LEFT:case zt.NEAR_BOTTOM_LEFT:case zt.NEAR_TOP_LEFT:vQ(this._extendedFrustum.planes[Ms.LEFT],rd,rd);break;case zt.FAR_BOTTOM_RIGHT:case zt.FAR_TOP_RIGHT:case zt.NEAR_BOTTOM_RIGHT:case zt.NEAR_TOP_RIGHT:vQ(this._extendedFrustum.planes[Ms.RIGHT],rd,rd)}Me(rd,rd,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(qd(l,rd),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),Xl(n[zt.NEAR_BOTTOM_LEFT],n[zt.NEAR_BOTTOM_RIGHT],n[zt.NEAR_TOP_RIGHT],sAe),Xl(n[zt.NEAR_BOTTOM_RIGHT],n[zt.NEAR_TOP_RIGHT],n[zt.NEAR_TOP_LEFT],nAe),He(sAe,nAe)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[zt.NEAR_BOTTOM_LEFT],o[zt.NEAR_BOTTOM_RIGHT]]=[o[zt.NEAR_BOTTOM_RIGHT],o[zt.NEAR_BOTTOM_LEFT]]:[o[zt.NEAR_TOP_LEFT],o[zt.NEAR_TOP_RIGHT]]=[o[zt.NEAR_TOP_RIGHT],o[zt.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-iAe;return{zWithMargin:e,pointIndices:sv.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+iAe;return{zWithMargin:e,pointIndices:sv.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const hEt=2,dEt=6,pEt=12,fEt=.95,iAe=1,rd=V(),sAe=Hi(),nAe=Hi(),oAe=new al(Array,t=>{t.length!==4&&(t[0]=new KP,t[1]=new KP,t[2]=new KP,t[3]=new KP)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let mEt=class{constructor(e){this._camera=new hr,this._focusOnMap=[0,0],this._screenRect=si(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new uEt(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,pre(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=Wje(e.extent,this._focusOnMap),e.measures.visibility!==Yl.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=gEt,i=1<<r,s=e.measures.screenRect;lf(s);let n=0;const o=e.lij[0]+r,a=e.lij[1]<<r,l=e.lij[2]<<r,c=this._tileSizeWithBias(e),h=c*c;for(let p=0;p<i;p++)for(let A=0;A<i;A++)if(n+=this._computeScreenArea(e,o,a+p,l+A,s),n>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Yl.VISIBLE_WHEN_EXTENDED?this._tileSize*AEt:this._tileSize}_computeScreenArea(e,r,i,s,n){const o=e.measures.visibility===Yl.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,s,o,W_),lf(_H);for(let a=0;a<4;a++)fre(_H,W_[a]);return Fv(n,_H,n),vfe(W_[0],W_[1],W_[2])+vfe(W_[0],W_[2],W_[3])}_projectToScreen(e,r,i,s,n){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,r,i,AO),this._toRenderCoords(AO,0,3,Y_[0]),this._toRenderCoords(AO,2,3,Y_[1]),this._toRenderCoords(AO,2,1,Y_[2]),this._toRenderCoords(AO,0,1,Y_[3]),s&&(this._projectToPlane(Y_,this._camera.frustum[Ms.NEAR]),this._projectToPlane(Y_,this._camera.frustum[Ms.TOP]),this._projectToPlane(Y_,this._camera.frustum[Ms.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(Y_[o],aAe),this._camera.renderToScreen(aAe,n[o])}_projectToPlane(e,r){for(let s=0;s<4;s++)_O[s]=Rs(r,e[s]);const i=Math.max(_O[0],_O[1],_O[2],_O[3]);if(i>0){const s=Me(yO,r,-i);for(let n=0;n<4;n++)ke(e[n],e[n],s)}}_toRenderCoords(e,r,i,s){return yO[0]=e[r],yO[1]=e[i],yO[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(yO,this._tilingScheme.spatialReference,s),s}};const _H=si(),gEt=2,AEt=5,W_=[Sn(),Sn(),Sn(),Sn()],AO=si(),yO=V(),Y_=[V(),V(),V(),V()],_O=[0,0,0,0],aAe=Rl();function hHt(t,e,r){if(N(t)||N(r))return!1;let i=!0;return Vo[0]=t.xmin!=null?t.xmin:0,Vo[1]=t.ymin!=null?t.ymin:0,Vo[2]=t.zmin!=null?t.zmin:0,i=i&&Dn(Vo,t.spatialReference,0,e,r,0,1),Vo[0]=t.xmax!=null?t.xmax:0,Vo[1]=t.ymax!=null?t.ymax:0,Vo[2]=t.zmax!=null?t.zmax:0,i=i&&Dn(Vo,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function ZDe(t,e,r){if(N(t)||N(r))return!1;let i=!0;return Vo[0]=t.xmin!=null?t.xmin:0,Vo[1]=t.ymin!=null?t.ymin:0,Vo[2]=t.zmin!=null?t.zmin:0,i=i&&Dn(Vo,t.spatialReference,0,Vo,r,0,1),e[0]=Vo[0],e[1]=Vo[1],Vo[0]=t.xmax!=null?t.xmax:0,Vo[1]=t.ymax!=null?t.ymax:0,Vo[2]=t.zmax!=null?t.zmax:0,i=i&&Dn(Vo,t.spatialReference,0,Vo,r,0,1),e[2]=Vo[0],e[3]=Vo[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const Vo=V();let el=class extends Ke{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(E(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void we.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||E(r)&&e&&r.equals(e))return;const i=E(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(N(this.filterExtent))return null;const e=si();return ZDe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new or,this.tileSize=512,this._idToTile=new Map,this._handles=new ts,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Vr}initialize(){this._handles.add([xe(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),os),xe(()=>{var e,r,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(r=this.viewState)==null?void 0:r.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),ao)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(ir.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=sn(this._frameWorker),this._handles=gt(this._handles)}addClient(){const e=_Et();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(jc))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),E(this._frameWorker)&&(this._frameWorker.priority=ir.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&E(this._frameWorker)&&(this._frameWorker.priority=ir.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new mEt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new KP(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){e.sort((r,i)=>{const s=r.measures.screenRect,n=i.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),lf(jN);for(let r=0;r<e.length;r++)if(Fv(jN,e.data[r].measures.screenRect,jN),V0(jN)>vEt)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!iU(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==Yl.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const r=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),i=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===Yl.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};u([d({constructOnly:!0})],el.prototype,"scheduler",void 0),u([d({constructOnly:!0})],el.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],el.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],el.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],el.prototype,"focus",void 0),u([d({constructOnly:!0})],el.prototype,"viewState",void 0),u([d({constructOnly:!0})],el.prototype,"terrain",void 0),u([d()],el.prototype,"tiles",void 0),u([d()],el.prototype,"tileSize",void 0),u([d({readOnly:!0})],el.prototype,"tilingScheme",null),u([d()],el.prototype,"filterExtent",null),u([d({readOnly:!0})],el.prototype,"_filterExtentRect",null),u([d({readOnly:!0})],el.prototype,"_rootTileIds",null),u([d({value:!1})],el.prototype,"suspended",null),u([d({readOnly:!0})],el.prototype,"updating",null),el=u([j("esri.views.3d.layers.support.FeatureTileTree3D")],el);let yEt=0;function _Et(){return yEt++}const jN=si(),vEt=10;let ko=class extends Ke{constructor(){super(...arguments),this._propertiesPool=new Vy({camera:hr},this),this._lastSeenCameraProjectionValues=new hr,this.mode=Ei.ANIMATING,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Nn,this.viewingMode=_t.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new BA({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Vy({camera:hr},this)}createInitialCamera(){if(this.viewingMode===_t.Global){const e=es(this.spatialReference).radius;this.camera=new hr({eye:ct(4*e,0,0),center:ct(e,0,0),up:ct(0,0,1)})}else this.camera=new hr({eye:ct(0,0,100),center:ct(0,0,0),up:ct(0,1,0)})}get animation(){return this.cameraController instanceof S4&&E(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==ap&&ap.copyFrom(e),ap.computeUp(this.viewingMode),this.events.emit("before-camera-change",ap);const r=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,ap)&&(this._lastSeenCameraProjectionValues.copyFrom(ap),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),(!r||!r.equals(ap))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(ap)),this._cameraChanged=!r||!r.almostEquals(ap),this._cameraChanged)){const i=Fbe(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return gr(this._contentCamera,this.camera)}set contentCamera(e){this._contentCamera=E(e)?e.clone():null}get fixedContentCamera(){return E(this._contentCamera)}get isGlobal(){return this.viewingMode===_t.Global}get isLocal(){return this.viewingMode===_t.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.removeHandles(lAe),this.addHandles(Nl(()=>e.state===Tn.Finished||e.state===Tn.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),lAe),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Tn.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Tn.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();ap.copyFrom(this._get("camera")),e(ap),this.camera=ap,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[ii.TOP]!==r.padding[ii.TOP]||e.padding[ii.RIGHT]!==r.padding[ii.RIGHT]||e.padding[ii.BOTTOM]!==r.padding[ii.BOTTOM]||e.padding[ii.LEFT]!==r.padding[ii.LEFT]}};u([d()],ko.prototype,"mode",void 0),u([d({readOnly:!0,type:iM})],ko.prototype,"animation",null),u([d({type:hr})],ko.prototype,"camera",null),u([d({readOnly:!0})],ko.prototype,"pixelRatio",null),u([d()],ko.prototype,"rasterPixelRatio",void 0),u([d()],ko.prototype,"contentPixelRatio",void 0),u([d({})],ko.prototype,"_contentCamera",void 0),u([d({type:hr})],ko.prototype,"contentCamera",null),u([d({readOnly:!0})],ko.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],ko.prototype,"constraints",void 0),u([d({readOnly:!0})],ko.prototype,"events",void 0),u([d({readOnly:!0})],ko.prototype,"isGlobal",null),u([d({readOnly:!0})],ko.prototype,"isLocal",null),u([d({readOnly:!0})],ko.prototype,"viewingMode",void 0),u([d({readOnly:!0})],ko.prototype,"spatialReference",void 0),u([d()],ko.prototype,"navigating",null),u([d()],ko.prototype,"stationary",null),u([d()],ko.prototype,"_cameraChanged",void 0),u([d()],ko.prototype,"cameraController",null),ko=u([j("esri.views.3d.state.ViewState")],ko);const bEt=ko,ap=new hr,lAe="ViewStateHandles";let wEt=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Vr,this._tolerance=uM,this._tmpRay=Na(),this._tmpRegion=si(),this._validateHUDIntersector=pf(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),cAe(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,cAe(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,s){return r.options.selectionMode=!1,r.options.store=dl.MIN,this.computeIntersection(e,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,s=.5){return e.getRenderCenter(WN,i,s),WN[0]+=.0466,WN[1]-=.0123,ane(e,WN,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const s=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||J0(s)&&s.intersector!==pn.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=uM){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===pn.TERRAIN?1:i.type===pn.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===pn.TERRAIN?1:i.type===pn.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return ZPe(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==_t.Local||N(e)||ke(r,e.origin,qe(Tt.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,s)}_intersectElevation(e,r,i=0,s=null){if(N(e))return null;const n=E(r)?r.mode:"absolute-height",o=E(r)?gr(r.offset,0):0,a=n!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,qN)){const O=this._view.computeMapPointFromVec3d(qN);return O.z??(O.z=0),O.z-=o,O}return null}const c=this._view.state.camera,h=Tt.get();c.projectToRenderScreen(e.origin,h);const p=new uAe(null,this._forEachLayer),A=this._view.slicePlane,_=E(A)?e0e(A):null,w=pf(this.viewingMode);w.options.store=dl.MIN,w.options.verticalOffset=l;const T=e.origin,C=ke(Tt.get(),T,e.direction);w.reset(T,C,c),w.point=h;const M=E(s)?"type"in s&&s.type==="graphics"?O=>{var $;return(($=O.metadata)==null?void 0:$.layerUid)!==s.uid}:O=>{var $;return(($=O.metadata)==null?void 0:$.graphicUid)!==s.uid}:null;switch(n){case"relative-to-scene":{const O=$=>{var L;return(N(M)||M($))&&!!((L=$.metadata)!=null&&L.isElevationSource)};w.intersect(p.layers,h,this._tolerance,null,O),this._externalIntersectionHandlers.forAll($=>{if($.type===pn.I3S||$.type===pn.TERRAIN){const L=$.slicePlaneEnabled?_:null;$.intersect(w,L,w.rayBegin,w.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(O=>{if(O.isGround){const $=O.slicePlaneEnabled?_:null;O.intersect(w,$,w.rayBegin,w.rayEnd,h)}})}if(w.results.min.getIntersectionPoint(qN)){const O=this._view.computeMapPointFromVec3d(qN);return O.z=i,O}return null}computeIntersection(e,r,i){var w;if(N(e))return;const s=this._view.state.camera,n=Tt.get();s.projectToRenderScreen(e.origin,n);const o=new uAe(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=ke(Tt.get(),e.origin,e.direction);r.reset(a,l,s),r.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,h=E(c)?e0e(c):null;r.intersect(o.sliceableLayers,n,this._tolerance,h);const p=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(T=>{const C=T.layerUid,M=Array.isArray(C),O=M?C:[C];M&&(r.options.filteredLayerUids=[]);let $=!1;for(const L of O)o.filterLayerUid(L)?$=!0:M&&r.options.filteredLayerUids.push(L);if(r.options.isFiltered=!$,T.isGround&&p||!r.options.isFiltered){const L=T.slicePlaneEnabled?h:null;T.intersect(r,L,a,l,n)}});const A=Tt.get(),_=this._view.basemapTerrain;if(i&&i.enableDraped&&E(_.spatialReference)&&r.results.ground.getIntersectionPoint(A)){const T=_.overlayManager.renderer,C=this._view.renderCoordsHelper.spatialReference,M=Tt.get();this._view.renderCoordsHelper.fromRenderCoords(A,M,_.spatialReference),M[2]=gr((w=this._view.elevationProvider)==null?void 0:w.getElevation(A[0],A[1],A[2],C,"ground"),0),T.intersect(r,M,r.results.ground,O=>o.filterRenderGeometry(O))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;Fy(this._tmpRegion,MY);const i=this._view.state.camera,s=[],n=this._tmpRegion,o=M=>{const O=new TEt(M);i.projectToRenderScreen(M.target.center,O.screenPoint),O.screenPoint[0]=Math.floor(O.screenPoint[0]),O.screenPoint[1]=Math.floor(O.screenPoint[1]),s.push(O),fre(n,O.screenPoint)};e.sortResults(r.all),E(r.min.dist)&&o(r.min);for(const M of r.all)r.min.target.object!==M.target.object&&r.max.target.object!==M.target.object&&o(M);if(E(r.max.dist)&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-eI),h=Math.max(0,n[1]-eI),p=Math.min(Pd(n)+2*eI,a-c),A=Math.min(V0(n)+2*eI,l-h),_=new Uint8Array(p*A*4);this._view._stage.renderer.readHUDVisibility(c,h,p,A,_);let w=!0;const T=N(e.results.max.dist);let C=0;for(const M of s)for(const O of xEt)if(_[4*(Math.min(M.screenPoint[0]+O[0],a)-n[0]+(Math.min(M.screenPoint[1]+O[1],l)-n[1])*p)]){w&&(e.results.min.copy(M.result),w=!1),T&&e.results.max.copy(M.result),e.options.store===dl.ALL&&e.results.all.splice(C++,0,M.result);break}}};const eI=1,xEt=(()=>{const t=[],e=eI;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let TEt=class{constructor(e){this.result=e,this.screenPoint=Rl()}},HN;function cAe(t){return HN&&HN.viewingMode===t||(HN=pf(t)),HN}let uAe=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return N(e)?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function hAe(t){return typeof t=="object"&&"intersect"in t}const qN=V(),WN=Rl();let AHt=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,s,n){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,n,i,s)}},SEt=class{constructor(e,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(ir.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,r,i,s=0){return new Promise((n,o)=>{const a={x:e,y:r,minDemResolution:s,result:{resolve:n,reject:o},signal:i};this._queries.push(a),ic(i,()=>{Xee(this._queries,a),o(Yi())})})}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(h=>h.result.reject()),void e.madeProgress();const s=r.map(h=>[h.x,h.y]),n=r.reduce((h,p)=>Math.min(h,p.minDemResolution),1/0),o=new dL({points:s,spatialReference:this.spatialReference}),a=r.length>1&&r.some(h=>!!h.signal)?new AbortController:null,l=E(a)?a.signal:r[0].signal;if(E(a)){let h=0;r.forEach(p=>ic(p.signal,()=>{h++,p.result.reject(Yi()),h===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};i.queryElevation(o,c).then(h=>{r.forEach((p,A)=>{E(p.signal)&&p.signal.aborted?p.result.reject(Yi()):p.result.resolve(h.geometry.points[A][2])})}).catch(h=>{r.forEach(p=>p.result.reject(h))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(jc)}}},tI=class extends Nn.EventedMixin(Ke){get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:r.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=gt(this._elevationQueryCached)}get _elevationQuery(){return N(this._elevationQueryCached)&&(this._elevationQueryCached=new SEt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,r,i,s,n){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&Po(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=YN(o,this._im,e,r,i,s,n),N(o)&&(o=YN(o,this._ground,e,r,i,s,n)),n==="scene"&&(o=YN(o,this._scene,e,r,i,s,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:s,queryContext:n,result:o}),o}queryElevation(e,r,i,s,n,o=null,a=0){const l=Xv();return this._elevationQuery.queryElevation(e,r,o,a).then(c=>{n==="scene"&&(c=YN(c,this._scene,e,r,i,s,n)),l.resolve(c)}).catch(c=>{vo(c)?l.reject(c):l.resolve(this.getElevation(e,r,i,s,n))}),l.promise}register(e,r){this._handles.set(r,r.on("elevation-change",i=>this.emit("elevation-change",i))),this._providersFromContext(e).push(r)}unregister(e){var r;this._handles.has(e)&&((r=this._handles.get(e))==null||r.remove(),this._handles.delete(e));for(const i of[this._im,this._ground,this._scene]){const s=i.indexOf(e);s>-1&&i.splice(s,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function YN(t,e,r,i,s,n,o){for(const a of e){const l=a.getElevation(r,i,s,n,o);E(l)&&(t=E(t)?Math.max(l,t):l)}return t}u([d({constructOnly:!0})],tI.prototype,"view",void 0),u([d()],tI.prototype,"spatialReference",null),tI=u([j("esri.views.3d.support.CombinedElevationProvider")],tI);let rI=class bK{static isValidProfile(e){return e in bK.profiles}static getDefaultProfile(){return Le("esri-iPhone")?"low":"medium"}static apply(e,r){const i=bK.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const s=r.sceneService.object,n=i.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};function dAe(){const t=!!Le("esri-mobile"),e=!!Le("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!Le("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:t?600:750,additionalCacheMemory:t?0:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!Le("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:t?900:1500,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}rI.test={reset(){const t=dAe();for(const e in t)rI.profiles[e]=t[e]}},function(t){t.profiles=dAe()}(rI||(rI={}));const f8=rI;function JDe(){return new Float32Array(4)}function EEt(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Y0(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function CEt(t,e){return new Float32Array(t,e,4)}function KDe(){return JDe()}function e5e(){return Y0(1,1,1,1)}function t5e(){return Y0(1,0,0,0)}function r5e(){return Y0(0,1,0,0)}function i5e(){return Y0(0,0,1,0)}function s5e(){return Y0(0,0,0,1)}const MEt=KDe(),REt=e5e(),OEt=t5e(),PEt=r5e(),IEt=i5e(),$Et=s5e();Object.freeze(Object.defineProperty({__proto__:null,ONES:REt,UNIT_W:$Et,UNIT_X:OEt,UNIT_Y:PEt,UNIT_Z:IEt,ZEROS:MEt,clone:EEt,create:JDe,createView:CEt,fromValues:Y0,ones:e5e,unitW:s5e,unitX:t5e,unitY:r5e,unitZ:i5e,zeros:KDe},Symbol.toStringTag,{value:"Module"}));const pAe=new Ot([0,255,255]),fAe=new Ot([0,0,0]),mAe=1,gAe=.25,AAe=.4,yAe=.2;let zm=class extends Ke{constructor(){super(...arguments),this.color=pAe.clone(),this.haloColor=null,this.haloOpacity=mAe,this.fillOpacity=gAe,this.shadowOpacity=AAe,this.shadowColor=fAe.clone(),this.shadowDifference=yAe}static toEngineOptions(e){const r=Ot.toUnitRGBA(e.color??pAe),i=E(e.haloColor)?Ot.toUnitRGBA(e.haloColor):r,s=Ot.toUnitRGBA(e.shadowColor??fAe),n=e.haloOpacity??mAe,o=e.fillOpacity??gAe,a=e.shadowOpacity??AAe,l=e.shadowDifference??yAe;return{color:Y0(r[0],r[1],r[2],r[3]),haloColor:Y0(i[0],i[1],i[2],i[3]),haloOpacity:n,haloOpacityOccluded:.25*n,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:Nr(s[0],s[1],s[2],s[3]),occludedShadowOpacity:a*(1-l)}}};u([d({type:Ot})],zm.prototype,"color",void 0),u([d({type:Ot})],zm.prototype,"haloColor",void 0),u([d()],zm.prototype,"haloOpacity",void 0),u([d()],zm.prototype,"fillOpacity",void 0),u([d()],zm.prototype,"shadowOpacity",void 0),u([d({type:Ot})],zm.prototype,"shadowColor",void 0),u([d()],zm.prototype,"shadowDifference",void 0),zm=u([j("esri.views.3d.support.HighlightOptions")],zm);const wK=zm;let v2=class extends Qe{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),r=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:RM(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([d()],v2.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],v2.prototype,"outSpatialReference",void 0),u([d()],v2.prototype,"transformation",void 0),u([d()],v2.prototype,"transformForward",void 0),v2=u([j("esri.rest.support.ProjectParameters")],v2);const moe=v2,LEt=Oo(moe);async function n5e(t,e,r){e=LEt(e);const i=yie(t),s={...i.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=RM(e.geometries[0]),a=IKe(s,r);return Ys(i.path+"/project",a).then(({data:{geometries:l}})=>CCe(l,o,n))}async function goe(t=null,e){var s,n;if(ls.geometryServiceUrl)return ls.geometryServiceUrl;if(!t)throw new ce("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||zu.getDefault():t,await r.load({signal:e});const i=(n=(s=r.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!i)throw new ce("internal:geometry-service-url-not-configured");return i}async function DEt(t,e,r=null,i){const s=await goe(r,i),n=new moe;n.geometries=[t],n.outSpatialReference=e;const o=await n5e(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new ce("internal:geometry-service-projection-failed")}const NEt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:goe,projectGeometry:DEt},Symbol.toStringTag,{value:"Module"}));let FEt=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=tu(this.spatialReference,es(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=goe(e&&e.get("portalItem")).catch(()=>{throw new ce("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],s=!1);const n=i.map(l=>l instanceof Gt?l:new Gt(l,this.spatialReference)),o=new moe({geometries:n,outSpatialReference:xt.WGS84}),a=(await n5e(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}},e0=class extends Ke{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([d()],e0.prototype,"minTotalNumberOfFeatures",void 0),u([d()],e0.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],e0.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],e0.prototype,"snapshotAvailable",void 0),u([d()],e0.prototype,"polygonLodFactor",void 0),u([d()],e0.prototype,"polylineLodFactor",void 0),u([d()],e0.prototype,"skipHighSymbolLods",void 0),e0=u([j("esri.views.3d.support.QualitySettings.Graphics3DSettings")],e0);let Eg=class extends Ke{constructor(){super(...arguments),this.lodFactor=1}};u([d()],Eg.prototype,"lodFactor",void 0),Eg=u([j("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Eg);let tB=class extends Eg{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};tB=u([j("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],tB);let JA=class extends Ke{constructor(){super(...arguments),this.object=new tB,this.point=new Eg,this.integratedMesh=new Eg,this.pointCloud=new Eg,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:tB})],JA.prototype,"object",void 0),u([d({type:Eg})],JA.prototype,"point",void 0),u([d({type:Eg})],JA.prototype,"integratedMesh",void 0),u([d({type:Eg})],JA.prototype,"pointCloud",void 0),u([d()],JA.prototype,"uncompressedTextureDownsamplingEnabled",void 0),JA=u([j("esri.views.3d.support.QualitySettings.SceneServiceSettings")],JA);let Y1=class extends Ke{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([d()],Y1.prototype,"lodBias",void 0),u([d()],Y1.prototype,"angledSplitBias",void 0),u([d()],Y1.prototype,"reduceTileLevelDifferences",void 0),u([d()],Y1.prototype,"textureFadeDuration",void 0),Y1=u([j("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Y1);let OC=class extends Ke{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],OC.prototype,"pixelRatio",void 0),u([d()],OC.prototype,"maxTotalNumberOfFeatures",void 0),OC=u([j("esri.views.3d.support.QualitySettings.HeatmapSettings")],OC);let bu=class extends Ke{constructor(){super(...arguments),this.graphics3D=new e0,this.sceneService=new JA,this.tiledSurface=new Y1,this.heatmap=new OC,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.memoryLimit=void 0,this.additionalCacheMemory=void 0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([d({type:e0})],bu.prototype,"graphics3D",void 0),u([d({type:JA})],bu.prototype,"sceneService",void 0),u([d({type:Y1})],bu.prototype,"tiledSurface",void 0),u([d({type:OC})],bu.prototype,"heatmap",void 0),u([d()],bu.prototype,"fadeDuration",void 0),u([d()],bu.prototype,"antialiasingEnabled",void 0),u([d()],bu.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],bu.prototype,"highQualityTransparency",void 0),u([d()],bu.prototype,"memoryLimit",void 0),u([d()],bu.prototype,"additionalCacheMemory",void 0),u([d()],bu.prototype,"frameRate",void 0),u([d()],bu.prototype,"maximumPixelRatio",void 0),bu=u([j("esri.views.3d.support.QualitySettings.QualitySettings")],bu);const _Ae=bu;function kEt(t){return Kee(t)&&t.length>=3}function BEt(t){return(ete(t)||Array.isArray(t))&&t.length>=3}function UEt(t){return kEt(t)||BEt(t)}let VEt=class xK{constructor(e,r,i,s){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=s,this._tmpCoordinateSystem=oYe(s)}set extent(e){e&&aYe(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return mYe(this._coordinateSystem,e)}setAltitude(e,r,i=e){return USe(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){gYe(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return hYe(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return dYe(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,$h.X,Tt.get()),s=this.worldBasisAtPosition(e,$h.Y,Tt.get()),n=this.worldBasisAtPosition(e,$h.Z,Tt.get());return qg(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,Tt.get()),s=this.worldBasisAtPosition(e,$h.Y,Tt.get()),n=mSe(r,s,i);return Kc(n)}intersectManifoldClosestSilhouette(e,r,i){return Sz(this._coordinateSystem,r,this._tmpCoordinateSystem),fYe(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){Sz(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=Tt.get();return pYe(this._tmpCoordinateSystem,e,s)?Oe(i,s):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===_t.Global)return this.intersectManifold(e,r,i);Sz(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Tt.get();return ST(s.plane,e,n)?Oe(i,n):null}toRenderCoords(e,r,i){return $9(e)?Fl(e,r,this.spatialReference):Ba(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return $9(r)?(E(i)&&(r.spatialReference=i),OTe(e,this.spatialReference,r)):UEt(r)?Ba(e,this.spatialReference,r,i)?r:null:rb(e,this.spatialReference,r)}static create(e,r){switch(e){case _t.Local:return new xK(_t.Local,r,tu(r),uYe());case _t.Global:return new xK(_t.Global,r,1,cYe(r))}}static renderUnitScaleFactor(e,r){return vAe(e)/vAe(r)}};function vAe(t){if(L9(t,_t.Global))return 1;const e=VSe(!1,t);return tu(e)}var ug;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(ug||(ug={}));const zEt=(()=>{const t=new Array;return t[ug.ELEVATION]=10,t[ug.BASEMAP]=10,t[ug.I3S_INDEX]=10,t[ug.I3S_DATA]=10,t[ug.SYMBOLOGY]=5,t})(),GEt=30;function o5e(t){return typeof t.getUsedMemory=="function"}function jEt(t){return new wu({view:t})}const QN=1,vH=1,HEt=.75,qEt=.6,bAe=1.3;let wu=class extends Ke{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new gie,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(QN),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,r){return new KJe(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<qEt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(QN);else if(e)(this._memoryPredicted>1.1*vH||this._memoryUsed>vH)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/bAe),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>vH)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/bAe),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<HEt&&this._quality<QN){this._stableQuality=this._quality;const r=.05;e=this._updateQuality(this._quality+r)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),QN))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,r=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderer.edgeView;E(i)&&(e+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(o5e(a)){const l=a.ignoresMemoryFactor()?this._quality:1;e+=a.getUsedMemory()*l,r+=a.getUnloadedMemory()*l}});const s=N(this._warnMemoryUsage)||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&s){this._warnMemoryUsage=e;const a=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);we.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${a(n)} Current: ${a(e)} Projected: ${a(e+r)} Quality: ${l}%`)}this._memoryUsed=e/n,this._memoryPredicted=(e+r)/n;const o=n-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r}}}};u([d({constructOnly:!0})],wu.prototype,"view",void 0),u([d()],wu.prototype,"maxMemory",null),u([d()],wu.prototype,"additionalCacheMemory",null),u([d()],wu.prototype,"memoryFactor",null),u([d()],wu.prototype,"updating",null),u([d()],wu.prototype,"usedMemory",null),u([d()],wu.prototype,"_quality",void 0),u([d()],wu.prototype,"_memoryUsed",void 0),u([d()],wu.prototype,"_updating",void 0),u([d()],wu.prototype,"_stableQuality",void 0),u([d()],wu.prototype,"_maxMemory",void 0),u([d()],wu.prototype,"_additionalCacheMemory",void 0),wu=u([j("esri.views.3d.support.MemoryController")],wu);let WEt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},YEt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new QEt}},QEt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},XEt=class{constructor(e,r,i,s){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new YEt(n))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,s)=>this._taskCallback(i,s))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,Zt(r.numWorkers>=0),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},m8=class extends Ke{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new XEt((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,r),i&&(this._frameTask=i.registerTask(ir.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=sn(this._frameTask),this._tasks.forEach(e=>tf(e.abortController)),this._loadQueue=gt(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,s={}){const n=Xv();n.__signal=E(s)?s.signal:null;const o=this._createOrUpdateTask(e,r,i,s,n);return ic(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,r,i,s,n,o){const a=new KEt(e,r,i,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){var i;I$(e.resolvers,r),r.reject(Yi()),e.resolvers.length===0&&(e.status===Ep.DOWNLOADING&&(e.status=Ep.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=Ep.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,s,n){const o=eCt(E(s)&&s.uid||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,r,i,o,n)}_doneLoadingCB(e,r){this._loadQueue&&(Zt(e.status===Ep.DOWNLOADING),e.status=Ep.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();di(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==Ep.DOWNLOADED&&(r.err=r.err||Yi()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!vo(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(r)vo(r)?s.reject(r):s.reject(new ce("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const n=i<=0?e.result:Te(e.result);s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===Ep.CANCELLED)return!1;let i,s;switch(e.startTime=performance.now(),e.status=Ep.DOWNLOADING,e.docType){case"binary":s="array-buffer",i=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=Ys(e.url,{...e.options,responseType:s,timeout:i,signal:n});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===Ep.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const h=c.data,p=JEt(h);if(s="image",e.size=h.byteLength,p==="unknown")return e.request=Ys(e.url,{responseType:s,timeout:i,signal:n}),void e.request.then(w=>a(w.data),l);const A=new Blob([h],{type:p}),_=window.URL.createObjectURL(A);o=()=>window.URL.revokeObjectURL(_),e.request=Ys(_,{responseType:s,timeout:i,signal:n}),e.request.then(w=>a(new z7(w.data,p,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],m8.prototype,"updating",void 0),m8=u([j("esri.views.3d.support.StreamDataLoader")],m8);const ZEt={numRetries:0};function JEt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let z7=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}},KEt=class extends WEt{constructor(e,r,i,s,n){super(s),this.url=e,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=Ep.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=ZEt.numRetries}};function eCt(t,e,r){return`${t}:${e}:${r}`}var Ep;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Ep||(Ep={}));let g8=class extends Ke{constructor(){super(...arguments),this.updating=!1}};function tCt(t){return new Gm({view:t})}u([d({readOnly:!0})],g8.prototype,"updating",void 0),g8=u([j("esri.views.3d.support.ResourceControllerMain")],g8);let Gm=class extends g8{constructor(){super(...arguments),this._immediateTask=rM,this._normalTask=rM,this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=Klt(),this._memoryController=jEt(this.view),this._streamDataLoader=new m8,this._streamDataLoader.setup(GEt,zEt,this._scheduler),this.addHandles([xe(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},os),xe(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=C3({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(ir.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(ir.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=sn(this._frameTask),this._streamDataLoader=gt(this._streamDataLoader),this._memoryController=gt(this._memoryController),this._scheduler=gt(this._scheduler)}get updating(){var e,r,i;return!!((e=this._memoryController)!=null&&e.updating||(r=this._streamDataLoader)!=null&&r.updating||(i=this._immediateTask)!=null&&i.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,s,n)=>r.request(i,s,e,n),get busy(){return!r.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(ate(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([d({constructOnly:!0})],Gm.prototype,"view",void 0),u([d()],Gm.prototype,"_scheduler",void 0),u([d()],Gm.prototype,"_memoryController",void 0),u([d()],Gm.prototype,"_streamDataLoader",void 0),u([d()],Gm.prototype,"_immediateTask",void 0),u([d()],Gm.prototype,"_normalTask",void 0),u([d({readOnly:!0})],Gm.prototype,"updating",null),Gm=u([j("esri.views.3d.support.ResourceControllerImpl")],Gm);function rCt(t){return"performanceInfo"in t}const RS=V(),iCt=V(),mA=V(),gA=V();function sCt(t,e,r=0){const i=t.extent;if(N(i))return!1;if(r===0)return Txe(i,e);const s=Math.min(i[2]-i[0],i[3]-i[1]);return qje(i,e,r*s)}function XN(t,e,r,i){Oe(RS,r),RS[i]=e[i];const s=Be(RS,RS,e),n=Be(iCt,t,e),o=He(n,s),a=He(s,s);let l;l=o<=0?e:a<=o?r:ke(RS,e,Me(s,s,o/a));const c=Be(RS,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function nCt(t,e,r){const i=t.extent;if(N(i))return 0;mA[0]=i[0],mA[1]=i[1],mA[2]=r,gA[0]=i[2],gA[1]=i[3],gA[2]=r;let s=1/0,n=1/0;return e[0]<mA[0]?s=XN(e,mA,gA,0):e[0]>gA[0]&&(s=XN(e,gA,mA,0)),e[1]<mA[1]?n=XN(e,mA,gA,1):e[1]>gA[1]&&(n=XN(e,gA,mA,1)),Math.min(s,n)}function oCt(t,e,r){if(N(t))return ose();if(t.spatialReference.isGeographic&&!qx(t.spatialReference))return new ce("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=Eh.checkUnsupported(t);if(E(i))return i;if(N(r))return new ce("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=aCt(t,r);if(s)return s;const n=t.spatialReference;return E(e)&&!(n.equals(e)||e.isWGS84&&n.isWebMercator)?new ce("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function aCt(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,s=[i*t.size[0],i*t.size[1]],n=[t.origin.x,t.origin.y],o=wxe(e),a=si();Eh.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>_C){const c=r[0].scale*2**r[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new ce("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:_C})}return null}const lCt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:oCt,isInsideExtent:sCt,tiltToExtentEdge:nCt},Symbol.toStringTag,{value:"Module"}));function cCt(){return!0}function uCt(){return 0}function hCt(t,e){if(N(t))return ose();const r=t.lods.length-1,i=t.spatialReference,s=qx(i)||Gg(i)||jg(i);if(i.isWebMercator){if(!Eh.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new ce("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new ce("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Eh.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new ce("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new ce("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return E(e)&&!t.spatialReference.equals(e)?new ce("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const dCt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:hCt,isInsideExtent:cCt,tiltToExtentEdge:uCt},Symbol.toStringTag,{value:"Module"})),pCt={[_t.Global]:dCt,[_t.Local]:lCt};function ig(t,e){t||console.warn("Terrain: "+e)}let Xo=!1,rB=!1;function fCt(t){rB=t,Xo=Xo||t}function mCt(t){Xo=t}function it(t,e){var r;if(Xo&&!t){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(e||"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function TK(t){return G7(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function iB(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function G7(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function Aoe(t){return(t==null?void 0:t.type)==="tile-3d"}function V4(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function a5e(t){return(t==null?void 0:t.type)==="wmts-3d"}function SK(t){return(t==null?void 0:t.type)==="elevation-3d"}function vO(t){return(t==null?void 0:t.type)==="group"}function sB(t){return t&&(Aoe(t)||a5e(t)||G7(t)||V4(t))}function EK(t){return t&&(Aoe(t)||G7(t)||V4(t)||a5e(t))}function z4(t){return EK(t)||SK(t)}function gCt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return E(e)&&"type"in e&&e.type==="raster-tile"}function ACt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return E(e)&&"type"in e&&e.type==="vector-tile"}function yCt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return E(e)&&"type"in e&&e.type==="tile-texture"}function _Ct(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e instanceof HTMLImageElement||e instanceof z7||e instanceof HTMLCanvasElement||e instanceof ImageData}function d3(t){return E(t)&&"release"in t&&t.release(),null}function wAe(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function yoe(t,e,r,i){return pCt[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function j7(t,e,r){let i=null,s=null;if((t==null?void 0:t.type)==="wmts"){const n=vCt(t,e,r);i=n.tileInfo,s=n.fullExtent}else{s=iB(t)?t.getCompatibleFullExtent(e):t.fullExtent;const n=r===_t.Local;if(iB(t))i=t.getCompatibleTileInfo(e,s,n);else if((t==null?void 0:t.type)==="vector-tile"){const o=n&&!bCt(e)||wCt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return E(i)&&E(s)&&yoe(i,s,e,r)==null?{tileInfo:i,fullExtent:s}:null}function vCt(t,e,r){const i=eze(t);if(E(i)){if(!or.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>yoe(n.tileInfo,n.fullExtent,e,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function bCt(t){return t.isWGS84||t.isWebMercator||Ewe(t)||!F$(t)}const wCt={force512VTL:!1};function xAe(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function AA(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function Bp(t,e,r=SCt){return Math.abs(t-e)<r}function CK(t){return t===dr.NORTH_EAST?dr.SOUTH_WEST:t===dr.NORTH_WEST?dr.SOUTH_EAST:t===dr.SOUTH_WEST?dr.NORTH_EAST:dr.NORTH_WEST}function nB(t){return t===dr.NORTH?dr.SOUTH:t===dr.EAST?dr.WEST:t===dr.SOUTH?dr.NORTH:dr.EAST}function xCt(t){return t===dr.NORTH_WEST||t===dr.SOUTH_WEST}function TCt(t){return t===dr.NORTH_WEST||t===dr.NORTH_EAST}function TAe(t){return t===dr.NORTH_WEST||t===dr.WEST||t===dr.SOUTH_WEST}function SAe(t){return t===dr.NORTH_EAST||t===dr.EAST||t===dr.SOUTH_EAST}function EAe(t){return t===dr.SOUTH_EAST||t===dr.SOUTH||t===dr.SOUTH_WEST}function CAe(t){return t===dr.NORTH_EAST||t===dr.NORTH||t===dr.NORTH_WEST}const mg=[dr.NORTH,dr.EAST,dr.SOUTH,dr.WEST],oB=[dr.NORTH_EAST,dr.SOUTH_EAST,dr.SOUTH_WEST,dr.NORTH_WEST],SCt=1e-5;let ECt=class{constructor(e,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=z4(e)?r.basemapTerrain.getUsedMemoryForLayerView(e):e.getUsedMemory(),rCt(e)){const i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}},CCt=class{constructor(e){var i;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,E(e.resourceController)){const s=e.resourceController.memoryController;this.totalMemory=(s.maxMemory??0)*q3.MEGABYTES,this.usedMemory=Math.round(s.usedMemory*this.totalMemory),this.quality=s.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.getUsedMemory())??0;const r=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=E(r)?r.usedMemory:0,e.allLayerViews.items.forEach(s=>{(o5e(s)||z4(s))&&this.layerPerformanceInfos.push(new ECt(s,e))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}},MCt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const s=i?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return E(n)?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>yDe(new gDe(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,s=this._wosrMemCache.get(i);return E(s)?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,n=>_De(e,n),r)}async _loadOnce(e,r,i,s,n){di(n);const o=ic(n,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),di(n),l}finally{sn(o)}}_abortLoad(e,r){const i=e.get(r);E(i)&&--i.refCount>0||(e.delete(r),E(i)&&i.abortController.abort())}},RCt=class extends vC{constructor(e,r,i,s){super(r,s),this._streamDataRequester=e,this._parameters=i}async fromUrl(e,r,i){di(i);const s=E(i)?i.signal:null,n=this.makeUid(e,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a};const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async h=>{const p=this._createTexture(e,h,r);return c.texture=p,c.abortController=null,this._stage.add(p),await this._stage.load(p),{uid:n,texture:p,release:()=>this._release(n)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await ote(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,r,i){var n;const s={...this._parameters,powerOfTwoResizeMode:Vv.PAD};if(vwe(e)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return s.width=r.width,s.height=r.height,new IT(r,s)}},OCt=class{constructor(e){this.textures=null,this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(ug.SYMBOLOGY),this.objectResourceCache=new MCt((i,s)=>e.resourceController.memoryController.newCache(i,s)),this.textures=new RCt(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:pr.CLAMP_TO_EDGE,t:pr.CLAMP_TO_EDGE}},e.resourceController.scheduler);const r=es(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=ZIe(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=IAt(e.viewingMode,r)}destroy(){gt(this.textures),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return F0();this._graphicsOwners.push(e);const r=xe(()=>{var i;return(i=e.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),F0(()=>{r.remove(),I$(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new ts;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([xe(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,os),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=gt(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;ZN.distance=e.centerOnSurfaceInfrequent.distance,ZN.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(ZN),this.screenSizePerspectiveSettingsLabels.update(ZN),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const ZN={distance:0,fovY:0};let jE=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new fv({symbolLayers:[new pv({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new bT({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(e,r){if(N(r))return;this.hide();const i=new Gt({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new pl({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){E(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}},ov=class extends Ke{constructor(e){super(e),this.handles=new ts}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],ov.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],ov.prototype,"surface",void 0),u([d({constructOnly:!0})],ov.prototype,"state",void 0),ov=u([j("esri.views.3d.support.PointOfInterest")],ov);const PCt=Array;let Zf=class extends ov{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Vy({location:Gt,renderLocation:PCt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=V(),this._tmpPoint=new Gt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Co(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=gt(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,r=Is(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return aT(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),Dl.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const r=(this._tmpPoint.z??0)>ICt&&this.renderCoordsHelper.viewingMode===_t.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?$Ct:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{vo(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,Dl.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(bH,this._estimatedSurfaceAltitude,this._camera.eye),Hc(this._get("renderLocation"),bH)||(this._set("renderLocation",Oe(this._propertiesPool.get("renderLocation"),bH)),this.notifyChange("renderLocation"))}};u([d({constructOnly:!0})],Zf.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Zf.prototype,"cache",void 0),u([d({constructOnly:!0})],Zf.prototype,"task",void 0),u([d({readOnly:!0})],Zf.prototype,"location",null),u([d({constructOnly:!0})],Zf.prototype,"map",void 0),u([d({readOnly:!0})],Zf.prototype,"renderLocation",void 0),u([d({readOnly:!0})],Zf.prototype,"scale",null),u([d({readOnly:!0})],Zf.prototype,"updating",null),Zf=u([j("esri.views.3d.support.CameraOnSurface")],Zf);const bH=V(),ICt=1e5,$Ct=1e6,LCt=Array;let Cp=class extends ov{constructor(e){super(e),this._propertiesPool=new Vy({location:Gt,renderLocation:LCt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=V(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=sn(this._frameWorker),this._propertiesPool=gt(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Dl.YIELD}_updateRenderLocation(){const e=NCt;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=FCt;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(Oe(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=Is(this._camera.eye,e):(Me(e,this._camera.viewForward,this._get("distance")),ke(e,e,this._camera.eye)),Hc(this._get("renderLocation"),e)||this._set("renderLocation",Oe(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){var s,n;const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const o=es(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=Jl(i.eye),c=l<a*a,h=Is(i.eye,r);if(c&&h>o/4){const p=a-Math.sqrt(l);return Me(r,i.viewForward,p),ke(r,r,i.eye),!0}}else{const o=(s=this.surface)!=null&&s.ready?this.surface.extent:null;E(o)&&yU(o,(n=this.surface)==null?void 0:n.spatialReference,bO,this.renderCoordsHelper.spatialReference)&&(r[0]=ze(r[0],bO[0],bO[2]),r[1]=ze(r[1],bO[1],bO[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(Qi.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,s=Is(i,e),n=Is(i,r);if(Math.abs(n-s)/s>DCt)return!0}return!1}};u([d({constructOnly:!0})],Cp.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Cp.prototype,"task",void 0),u([d()],Cp.prototype,"distance",void 0),u([d({constructOnly:!0})],Cp.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],Cp.prototype,"location",null),u([d({readOnly:!0})],Cp.prototype,"renderLocation",void 0),u([d()],Cp.prototype,"updating",void 0),Cp=u([j("esri.views.3d.support.CenterOnSurface")],Cp);const DCt=.05,NCt=V(),FCt=V(),bO=si();let kCt=class{constructor(e){this._handles=new ts,this.events=new Nn,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=gt(this._handles)}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",BCt)}};const BCt={},UCt=Array;let jm=class extends ov{constructor(e){super(e),this._propertiesPool=new Vy({location:Gt,renderLocation:UCt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([xe(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),xe(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(ir.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=gt(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,MAe);const n=Math.max(0,(Math.acos(He(MAe,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!Zv(e,r)){const c=this._propertiesPool.get("renderLocation");Oe(c,r),this._set("renderLocation",c)}return Dl.YIELD}const o=1-ze(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(RAe);const l=this._propertiesPool.get("renderLocation");return fo(l,r,RAe,a),e&&Zv(e,l)||this._set("renderLocation",l),Dl.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(Rl());if(i[1]=r.aboveGround?r.padding[ii.BOTTOM]:r.fullHeight-r.padding[ii.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,wO)){Be(wO,wO,r.eye);const n=qe(wO,wO);if(this.renderCoordsHelper.intersectManifold(qd(r.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,r.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],jm.prototype,"_dirty",void 0),u([d({constructOnly:!0})],jm.prototype,"scheduler",void 0),u([d({constructOnly:!0})],jm.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],jm.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],jm.prototype,"updating",null),u([d({readOnly:!0})],jm.prototype,"location",null),u([d({readOnly:!0})],jm.prototype,"renderLocation",void 0),jm=u([j("esri.views.3d.support.pointsOfInterest.Focus")],jm);const MAe=V(),wO=V(),RAe=V();let GA=class extends Ke{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=V();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new ts}initialize(){this.view.state.isLocal&&(this._handles.add([xe(()=>{var e,r;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(r=this.surfaceView)==null?void 0:r.extent]},()=>this._update()),Co(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||N(this.surfaceView.extent)||N(this.surfaceView.spatialReference))return void this._set("location",null);const e=mre(this.surfaceView.extent),r=new Gt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{vo(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",r)}};u([d({constructOnly:!0})],GA.prototype,"view",void 0),u([d({constructOnly:!0})],GA.prototype,"cache",void 0),u([d()],GA.prototype,"surface",null),u([d()],GA.prototype,"surfaceView",null),u([d({readOnly:!0})],GA.prototype,"location",void 0),u([d({readOnly:!0})],GA.prototype,"renderLocation",null),GA=u([j("esri.views.3d.terrain.StableSurfaceCenter")],GA);let jA=class extends Ke{constructor(e){super(e),this._tileGeometryUpdateExtent=lf(),this._tileGeometryUpdateSpatialReference=null,this.events=new Nn,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(ir.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",VCt),lf(this._tileGeometryUpdateExtent),this._set("updating",!1)),Dl.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Fv(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,s=zCt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,vw,r),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,bw,r),vw[0]<bw[0]?(s[0]=vw[0],s[2]=bw[0]):(s[0]=bw[0],s[2]=vw[0]),vw[1]<bw[1]?(s[1]=vw[1],s[3]=bw[1]):(s[1]=bw[1],s[3]=vw[1]),iU(s,e)}};u([d({constructOnly:!0})],jA.prototype,"state",void 0),u([d({constructOnly:!0})],jA.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],jA.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],jA.prototype,"scheduler",void 0),u([d({constructOnly:!0})],jA.prototype,"surface",void 0),u([d({readOnly:!0})],jA.prototype,"updating",void 0),jA=u([j("esri.views.3d.support.SurfaceGeometryUpdates")],jA);const VCt={},vw=V(),bw=V(),zCt=lf();let Eu=class extends Ke{constructor(e){super(e),this._handles=new ts,this._tmpRay=Na(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Vy({renderPointOfView:GCt},this),this.renderPointOfView=V(),this._pois=new Array,this._debugCenters=new Map}initialize(){var h;const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:s}=this.view;this._surfaceIntersector=pf(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=dl.MIN,this._contentIntersector=pf(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(h=this.view.basemapTerrain)==null?void 0:h.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new Cp({...l,task:ir.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Cp({...l,task:ir.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new Cp({...l,task:ir.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Zf({...l,cache:a,task:ir.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new jA({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new kCt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new GA({cache:a,view:this.view})),this._set("focus",new jm({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceInfrequent,estimateSurfaceIntersectionAtRenderPoint:(p,A)=>this._estimateSurfaceIntersectionAtRenderPoint(p,this.view.state.contentCamera,A)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new jE(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new jE(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new jE(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new jE(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new jE(c,"green","Focus")),this._handles.add([xe(()=>e.contentCamera,p=>this._cameraChanged(p),os),xe(()=>r.extent,()=>this._updateCenterPointsOfInterest()),Nl(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),os),Co(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Co(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Nl(()=>Qi.SHOW_POI,p=>this._setDebug(p),Cr)]),this._cameraChanged(this.view.state.contentCamera);for(const p of this._pois)p.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(r=>r.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return N(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,OS,HCt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(OS):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(N(e))return this._surfaceAltitudeAtCenter;const r=e.origin,i=ke(OS,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(OS)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(OS)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const s=ane(r,e,jCt);if(N(s))return null;const n=s.origin,o=ke(OS,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;Hc(this.renderPointOfView,r)||this._set("renderPointOfView",Oe(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this._handles.remove("debug");for(const r of this._pois)this._handles.add(xe(()=>r.renderLocation,i=>{var s;return(s=this._debugCenters.get(r))==null?void 0:s.show(i,r.renderCoordsHelper.spatialReference)},Cr),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],Eu.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],Eu.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],Eu.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],Eu.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],Eu.prototype,"focus",void 0),u([d({readOnly:!0})],Eu.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],Eu.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],Eu.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],Eu.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],Eu.prototype,"view",void 0),u([d({readOnly:!0})],Eu.prototype,"updating",null),Eu=u([j("esri.views.3d.support.PointsOfInterest")],Eu);const GCt=Array,OS=V(),jCt=Na(),HCt={exclude:new Set([rv])};let qCt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},WCt=class{constructor(e,r,i,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=s)}get hasNoDataValues(){if(N(this._hasNoDataValues)){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(E(this._minValue))return;const{noDataValue:e,values:r}=this;let i=1/0,s=-1/0,n=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=s>-3e38?s:0)}},l5e=class{constructor(e,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=cTe(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>we.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),F0(()=>{i.removed=!0,Xee(this._listeners,i),this._thread&&E(i.threadHandle)&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const s=this._transferLists[e],n=s?s(r):[];return this._thread.invoke(e,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(di(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},OAe=class extends l5e{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(u$.forEach((e,r)=>{e===this&&u$.delete(r)}),this.destroy())}};const u$=new Map;function YCt(t=null){let e=u$.get(t);return e||(E(t)?(e=new OAe(r=>t.immediate.schedule(r)),u$.set(t,e)):(e=new OAe,u$.set(null,e))),++e.ref,e}var wh,PAe,IAe;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(wh||(wh={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(PAe||(PAe={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(IAe||(IAe={}));let QCt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},oqt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function lqt(t,e,r,i,s,n){const o=r-s;if(o>=0)return(e>>o)+(i-(n<<o))*(t>>o);const a=-o;return e-(n-(i<<a))*(t>>a)<<a}let cqt=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(e,r,i,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function XCt(t,e,r,i,s,n){const o=e[i++];for(let a=0;a<o;a++){const l=new QCt(n);l.xTile=e[i++],l.yTile=e[i++],l.hash=e[i++],l.priority=e[i++];const c=e[i++];for(let A=0;A<c;A++){const _=e[i++],w=e[i++],T=e[i++],C=e[i++],M=!!e[i++],O=e[i++],$=r[i++],L=r[i++],k=e[i++],F=e[i++];l.colliders.push({xTile:_,yTile:w,dxPixels:T,dyPixels:C,hard:M,partIndex:O,width:k,height:F,minLod:$,maxLod:L})}const h=t[i++];for(let A=0;A<h;A++)l.textVertexRanges.push([t[i++],t[i++]]);const p=t[i++];for(let A=0;A<p;A++)l.iconVertexRanges.push([t[i++],t[i++]]);s.push(l)}return i}function hqt(t,e,r){for(const[i,s]of t.symbols)ZCt(t,e,r,s,i)}function ZCt(t,e,r,i,s){const n=t.layerData.get(s);if(n.type===wh.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const A=r?Math.floor(127*h)|p<<7:p?255:0;l=A<<24|A<<16|A<<8|A}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const A=r?Math.floor(127*h)|p<<7:p?255:0;l=A<<24|A<<16|A<<8|A}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}let H7=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e,this.memoryUsed=e.byteLength;let i=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return N(this._data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){N(this._data)||(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},JCt=class extends H7{constructor(e,r){super(e,r),this.type=wh.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=i[s++],c=i[s++],h=i[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){E(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),E(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),E(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.lineVertexBuffer=Wi.createVertex(e,Li.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.lineIndexBuffer=Wi.createIndex(e,Li.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new uf(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}},KCt=class extends H7{constructor(e,r){super(e,r),this.type=wh.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=i[s++],c=i[s++],h=i[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){E(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),E(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),E(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,E(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),E(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),E(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.fillVertexBuffer=Wi.createVertex(e,Li.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.fillIndexBuffer=Wi.createIndex(e,Li.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=s[i++];this.outlineVertexBuffer=Wi.createVertex(e,Li.STATIC_DRAW,new Int32Array(n.buffer,4*i,l)),i+=l;const c=s[i++];this.outlineIndexBuffer=Wi.createIndex(e,Li.STATIC_DRAW,new Uint32Array(s.buffer,4*i,c)),i+=c;const h=this.layer,p=h.fillMaterial,A=h.outlineMaterial;this.fillVertexArrayObject=new uf(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new uf(e,A.getAttributeLocations(),A.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}},e3t=class extends H7{constructor(e,r,i){super(e,r),this.type=wh.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let A=0;A<l;A++){const _=s[a++],w=s[a++],T=s[a++];this.iconPerPageElementsMap.set(_,[w,T])}const c=s[a++];for(let A=0;A<c;A++){const _=s[a++],w=s[a++],T=s[a++];this.glyphPerPageElementsMap.set(_,[w,T])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=XCt(s,n,o,a,this.symbols,i),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){E(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),E(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),E(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),E(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,E(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),E(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),E(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),E(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconOpacityBuffer;e.length>0&&e.byteLength===r.size&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,s=this.textOpacityBuffer;i.length>0&&i.byteLength===s.size&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.iconVertexBuffer=Wi.createVertex(e,Li.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.iconIndexBuffer=Wi.createIndex(e,Li.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=s[i++];this.textVertexBuffer=Wi.createVertex(e,Li.STATIC_DRAW,new Int32Array(n.buffer,4*i,l)),i+=l;const c=s[i++];this.textIndexBuffer=Wi.createIndex(e,Li.STATIC_DRAW,new Uint32Array(s.buffer,4*i,c)),i+=c,this.iconOpacityBuffer=Wi.createVertex(e,Li.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=Wi.createVertex(e,Li.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,A=h.textMaterial;this.iconVertexArrayObject=new uf(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new uf(e,A.getAttributeLocations(),A.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}},t3t=class extends H7{constructor(e,r){super(e,r),this.type=wh.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){E(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),E(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),E(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.circleVertexBuffer=Wi.createVertex(e,Li.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.circleIndexBuffer=Wi.createIndex(e,Li.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new uf(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}};const Aqt=!0,yqt=32,$Ae=200,r3t=1/Le("mapview-transitions-duration");let i3t=class extends Nn{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var i;if(this._stage===e)return;const r=this._stage;this._stage=e,e?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return N(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Xv(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Xv(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,r;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=e*r3t;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},MK=class b2{static getId(e,r,i,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${s}`}constructor(e,r,i,s){this.set(e,r,i,s)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,s){this.set(e,r,i,s)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new b2(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new b2(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new b2(e,r,i,s),new b2(e,r,i+1,s),new b2(e,r+1,i,s),new b2(e,r+1,i+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};MK.pool=new al(MK,null,null,25,50);let s3t=class extends i3t{constructor(e,r,i,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new MK(e),this.resolution=r,this.x=i,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;wse(i,o,0,0,0,a,0,s,n,1),oM(this.transforms.dvs,e.displayViewMat3,i)}},wH=class c5e extends s3t{constructor(e,r,i,s,n,o,a,l=null){super(e,r,i,s,n,o,4096,4096),this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<$Ae}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<$Ae)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let r=!1;for(const i of e)if(this.layerData.has(i)){const s=this.layerData.get(i);this._memoryUsedByLayerData-=s.memoryUsed,s.type===wh.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),r=!0),s.destroy(),this.layerData.delete(i),this.layerCount--}E(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(u5e.delete(this),c5e._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(e){let r=!1;if(e){const{bucketsWithData:i,emptyBuckets:s}=e,n=this._createRenderBuckets(i);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===wh.SYMBOL&&(this.symbols.set(o,a.symbols),r=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;E(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[i,s]of this.layerData)s.type===wh.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,s=this.height/this.rangeY*r,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;xse(o),g9(o,o,n),Tse(o,o,Math.PI*e.rotation/180),Sse(o,o,[i,s,1])}_createTransforms(){return{dvs:Uu(),tileMat3:Uu(),tileUnitsToPixels:Uu()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;e.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const s of e){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case wh.FILL:i=new KCt(e,this.styleRepository);break;case wh.LINE:i=new JCt(e,this.styleRepository);break;case wh.SYMBOL:i=new e3t(e,this.styleRepository,this);break;case wh.CIRCLE:i=new t3t(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e),this.layerCount--}};const u5e=new Map;function n3t(){u5e.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}const bqt={value:.5,readOnly:!0},o3t={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let PC=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},a3t=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},l3t=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new a3t(i,r)}computeMinMaxValue(e,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,p=.5*p4;let A=(c-1)/o,_=(i-this.j*o)*A,w=(r-this.i*o)*A;if(A<1){const T=Math.floor(_),C=Math.floor(w),M=T+C*c,O=h[M],$=h[M+1],L=h[M+c],k=h[M+c+1];if(O+$+L+k<p){const F=_-T,G=w-C,z=QD(O,$,L,k,F,G),Z=QD(O,$,L,k,F+A,G),J=QD(O,$,L,k,F,G+A),te=QD(O,$,L,k,F+A,G+A);return s.min=Math.min(z,Z,J,te),s.max=Math.max(z,Z,J,te),s}_=T,w=C,A=1}else _=Math.floor(_),w=Math.floor(w),A=Math.ceil(A);for(let T=_;T<=_+A;T++)for(let C=w;C<=w+A;C++){const M=h[T+C*c];M<p?(a=Math.min(a,M),l=Math.max(l,M)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const c3t=.5*p4;function tn(t,e,r){if(N(r))return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=ze(i.dy*(i.y1-e),0,s),o=ze(i.dx*(t-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.data.width,h=a*c+l,p=i.data.values,A=p[h],_=p[h+1],w=h+c,T=p[w],C=p[w+1];if(A+T+_+C<c3t){n-=a,o-=l;const M=A+(_-A)*o;return M+(T+(C-T)*o-M)*n}}return null}let Sp=class extends Ke{constructor(e){super(e),this._handles=new ts}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles=gt(this._handles)}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const s=h5e(i.fullExtent,this.viewSpatialReference);E(s)&&e.push(wxe(s))}}),e}};function u3t(t,e){return t===_t.Global?new RK(e):new OK(e)}u([d({readOnly:!0})],Sp.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],Sp.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],Sp.prototype,"stencilEnabledExtents",null),u([d()],Sp.prototype,"viewSpatialReference",void 0),u([d()],Sp.prototype,"tilingScheme",void 0),u([d()],Sp.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],Sp.prototype,"layers",void 0),u([d({constructOnly:!0})],Sp.prototype,"layerViews",void 0),Sp=u([j("esri.views.3d.terrain.ExtentHelper")],Sp);let RK=class extends Sp{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?ERe:Blt}};RK=u([j("esri.views.3d.terrain.ExtentHelperGlobal")],RK);let OK=class extends Sp{_computeLayerViewsExtent(){const e=lf(),r=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=h5e("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,r);Fv(e,a,e)}});const i=SY(e)?e:null,s=this._get("layerViewsExtent");return dx(i,s)?s:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=lf();this.layers.forEach(o=>{if(o.loaded&&EI(o)){const a=j7(o,r,_t.Local);if(N(a))return;const{tileInfo:l,fullExtent:c}=a;E(l)&&E(c)&&(iB(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&Fv(i,c,i)}}),Fv(i,this.defaultTiledLayersExtent,i);const s=SY(i)?i:null,n=this._get("tiledLayersExtent");return dx(s,n)?n:s}};function h5e(t,e){return E(t)&&!t.spatialReference.equals(e)?CTe(t,t.spatialReference,e):t}OK=u([j("esri.views.3d.terrain.ExtentHelperLocal")],OK);var ui;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(ui||(ui={}));const w2=[ui.ELEVATION,ui.MAP];function d5e(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const r=Object.keys(t);for(const i of r)i.search(".glsl")!==-1&&delete t[i]}}const h3t=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Q_,xu=class extends Ke{get running(){return this._placementDirty&&(this._drapeSources.size>0||this._view.graphics.length>0||Qi.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this._view.state.isGlobal}get _worldToPCSRatio(){return E(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?es(this._spatialReference).metersPerDegree:1}get _view(){return this.surface.view}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new ts,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=Le("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){var r;const e=this._view;this.renderer=new Qf({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=pf(this._view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",i=>{var s;return(s=e._stage)==null?void 0:s.renderer.setParameters({hasOverlayWater:i})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),xe(()=>{var i,s,n;return[(i=e.pointsOfInterest)==null?void 0:i.renderPointOfView,(n=(s=e.pointsOfInterest)==null?void 0:s.centerOnSurfaceFrequent)==null?void 0:n.location]},()=>this.setPlacementDirty()),xe(()=>{var i,s;return[(i=e.state)==null?void 0:i.pixelRatio,(s=e.state)==null?void 0:s.contentPixelRatio]},()=>this.setPlacementDirty(),os),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(ir.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",i=>{this._updateOverlays(jc,i,Wn.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Wn.BACKGROUND,i.pixelRatio)})]),(r=e._stage)==null||r.renderer.setParameters({renderOverlay:i=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(i),this._drawOverlayTextures(this.renderer.overlays,Wn.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})}destroy(){this._handles=gt(this._handles),E(Q_)&&(Q_.hide(),Q_=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this._view.renderSpatialReference;E(e)&&E(r)?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Jv(-20037508342787e-6,20037508342787e-6):new Jv(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,pd)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&E(e.setDrapingExtent)&&E(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this._view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this._view.state.contentCamera,Wn.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return Dl.YIELD;const s=this._computeOverlayResolution(r);this._computeOverlayExtents(r,s,yA);const n=Pd(yA.inner)/Pd(yA.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(dn.INNER,yA.inner,s,1*yA.pixelRatioAdjustment,yA.mapUnitsPerPixel),a=this._updateOverlay(dn.OUTER,yA.outer,s,n*yA.pixelRatioAdjustment,yA.mapUnitsPerPixel);o!==eg.EXTENT&&a!==eg.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),o===eg.NONE&&a===eg.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this._view.state.contentPixelRatio,i=e.fullWidth/e.pixelRatio*r,s=e.fullHeight/e.pixelRatio*r;return Math.min($3(Math.max(i,s)+256),this._maxResolution)}_updateOverlay(e,r,i,s,n){if(this.renderer.overlays.length===0)return eg.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,d3t(r,o.extent)&&i===o.resolution)return a===n?eg.NONE:eg.RERENDER_ONLY;Fy(o.extent,r),o.resolution=i;const l=mre(o.extent);return o.renderLocalOrigin=s$(l[0],l[1],0,"OV_"+this._latestOriginId++),eg.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[dn.INNER],s=this.renderer.overlays[dn.OUTER],n=e.extent;this._rectInsideRect(i.extent,n)||this._rectanglesOverlap(n,i.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,dn.INNER,r),this._setTileOverlayData(n,dn.OUTER,r)):(this._clearTileOverlayData(dn.INNER,r),this._clearTileOverlayData(dn.OUTER,r))}else this._clearTileOverlayData(dn.INNER,r),this._clearTileOverlayData(dn.OUTER,r)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const r=this.renderer.overlays[dn.INNER],i=this.renderer.overlays[dn.OUTER],s=this._pointIsInExtent(e,r.extent)?r:i;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[r].extent,n=Pd(s),o=V0(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,Pd(e)/n,V0(e)/o),i.setOffset(r,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){d5e(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(jc)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||E(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,s=new A$e(this._view.state.camera,i,this._view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,s){const n=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,m3t,r,i);if(N(n))return!1;const o=n.origin,a=ke(JN,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this._view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const s=.55,n=this._view.renderCoordsHelper.getAltitude(e.eye),o=this._view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=ze(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this._view.viewingMode==="global"){const h=JN;BM(vU(bU,es(this._view.spatialReference).radius+l),qd(e.eye,e.viewForward),h),Be(h,h,e.eye);const p=Kv.normalize(mSe(e.viewForward,h,e.viewRight))/e.fovY+.5,A=p<=0||p>=1?.5:s;i=c?A*p:p+A*(1-p)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),p=Math.tan(h),A=Nr(0,p,1,0),_=Ld(A,A,e.projectionMatrix)[1],w=ze(.5+.5*_,0,1);i=w===1||w===0?.5:c?w*s:1-(1-w)*s}return!!this._intersectGroundFromView(e,.5,i,r)&&jte(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const s=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=V();this._findHorizonBasedPointOfInterest(e,n)||Oe(n,s);const o=Math.max(.1,Is(e.eye,n)),a=hb(this._view.renderCoordsHelper,s,e.eye),l=Math.PI/2-Math.abs(a-Math.PI/2);Qi.OVERLAY_SHOW_CENTER?(N(Q_)&&(Q_=new jE(this._view.graphics,"red")),Q_.show(n,this._renderSR)):E(Q_)&&Q_.hide(),this._overlaySREqualsRenderSR||Ba(n,this._renderSR,n,this._spatialReference);const c=this.surface.extent,h=!this._isSpherical&&E(this._spatialReference)&&this._spatialReference.isGeographic,p=h&&E(this._spatialReference)?1/es(this._spatialReference).metersPerDegree:1,A=this._view.state.contentPixelRatio,_=e.perScreenPixelRatio/A*o*p;i.mapUnitsPerPixel=_/this._worldToPCSRatio;let w=r*_/2,T=!1,C=h?90:1/0;this._isSpherical&&E(c)&&E(this._spatialReference)&&(this._spatialReference.isWebMercator?(w/=Math.cos(bk(n[1])),C=c[3]):(T=!0,w/=es(this._spatialReference).metersPerDegree,C=90),w>=C&&(w=C,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let M=1;T&&(M=1/Math.max(.2,Math.cos(Math.abs($r(n[1])))),w*M>180&&(M=180/w),i.mapUnitsPerPixel*=M);const O=Math.log(2)/12;w=Math.exp(Math.round(Math.log(w)/O)*O);const $=w*M,L=32,k=.5*r/(L*$),F=.5*r/(L*w);n[0]=Math.round(n[0]*k)/k,n[1]=Math.round(n[1]*F)/F;const G=i.inner;G[0]=n[0]-$,G[1]=n[1]-w,G[2]=n[0]+$,G[3]=n[1]+w,this._isSpherical&&this._shiftExtentToFitBounds(G,1/0,C);const z=i.outer;if(6*$>Pd(c))Fy(z,c);else if(l<=.25*Math.PI)z[0]=G[0]-$,z[1]=G[1]-w,z[2]=G[2]+$,z[3]=G[3]+w;else{Ba(e.eye,this._renderSR,JN,this._spatialReference),ag(ww,n,JN);let J=-Math.atan2(ww[1],ww[0])+.125*Math.PI;J<0&&(J+=2*Math.PI);const te=Math.floor(J/(.25*Math.PI));MM(ww,h3t[te],2*w),ww[0]*=M,ww[2]*=M,Hte(z,G,ww)}if(this._isSpherical)z[0]=this._longitudeCyclical.clamp(z[0]),z[2]=this._longitudeCyclical.clamp(z[2]),z[1]=Math.max(z[1],-C),z[3]=Math.min(z[3],C);else{const J=EY(G,c,p3t),te=EY(z,c,f3t);Uce(J,te)&&(z[2]=z[0],z[3]=z[1])}const Z=Math.abs(G[2]-G[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,Z),i.pixelRatioAdjustment=i.mapUnitsPerPixel/Z}_drawOverlayTextures(e,r,i=this._view.state.contentPixelRatio){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const s=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const n=this._drawOverlay(e[dn.INNER],i),o=this._drawOverlay(e[dn.OUTER],i);n!==nM.CHANGED&&o!==nM.CHANGED||this.surface.updateTileOverlayParams(Wn.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),s?(this.surface.requestRender(r),r===Wn.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Wn.BACKGROUND)}_drawOverlay(e,r){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,r)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,r){return!N(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):iU(e,r))}_rectInsideRect(e,r){return!N(r)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:Uce(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,s=e.y;return i>r[0]&&i<r[2]&&s>r[1]&&s<r[3]}_shiftExtentToFitBounds(e,r,i){let s=0,n=0;e[0]<-r?s=e[0]+r:e[2]>r&&(s=r-e[2]),e[1]<-i?n=e[1]+i:e[3]>i&&(n=i-e[3]),Ik(e,s,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask(jc)}}};function d3t(t,e){const i=Qi.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}u([d()],xu.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],xu.prototype,"running",null),u([d()],xu.prototype,"_placementDirty",void 0),u([d()],xu.prototype,"_contentUpdated",void 0),u([d()],xu.prototype,"_isSpherical",null),u([d()],xu.prototype,"_worldToPCSRatio",null),u([d({autoDestroy:!0})],xu.prototype,"renderer",void 0),u([d({constructOnly:!0})],xu.prototype,"surface",void 0),u([d()],xu.prototype,"suspended",null),u([d()],xu.prototype,"updating",null),u([d({type:Boolean})],xu.prototype,"hasHighlights",null),u([d({type:Boolean})],xu.prototype,"rendersOccluded",null),xu=u([j("esri.views.3d.terrain.OverlayManager")],xu);const ww=Zr(),JN=V(),yA={inner:si(),outer:si(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},p3t=si(),f3t=si(),m3t=Na();var eg;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(eg||(eg={}));let p5e=class PK{constructor(e,r){this._factoryCallback=e,this._lengthCallback=r,this._pool=new Map}acquire(e){if(!PK.test.disabled){const r=this._pool.get(e);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(e)}catch(r){const i=window.performance&&window.performance.memory;let s="";throw i&&(s=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+r+s),r}}release(e){if(PK.test.disabled)return;const r=this._lengthCallback(e);let i=this._pool.get(r);i||(i=new Vr({shrink:!0}),this._pool.set(r,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};p5e.test={disabled:!1};let g3t=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Fs(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},LAe=class{constructor(e,r,i,s,n){this.attributes=e,this.localOrigin=r,this.index0=i,this.stride=s,this.count=n}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return it(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,r){this.attributes.position.getVec(e,r)}_getNormalRaw(e,r){this.attributes.normalCompressed.getVec(e,r)}getVertexPos(e,r){this._getVertexRaw(this.getAttributeIndex(r),e),ke(e,e,this.localOrigin)}getNormal(e,r){const i=Dt();this._getNormalRaw(this.getAttributeIndex(r),i),v3t(e,i)}_setNormal(e,r,i,s){G4(this.attributes.normalCompressed,e,r,i,s)}_setUV(e,r,i){Vh(this.attributes.uv0,e,r,i)}setNormalFromValues(e,r,i,s){this._setNormal(this.getAttributeIndex(e),r,i,s)}setVertexFromValuesRawPositionUV(e,r,i,s,n,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,r,i,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(e,r,i,s,n,o,a,l,c){const h=this.getAttributeIndex(e);this.attributes.position.setValues(h,r,i,s),this._setUV(h,n,o),this._setNormal(h,a,l,c)}};const A3t=gn().vec3f(B.POSITION).vec2i16(B.UV0).vec2i16(B.NORMALCOMPRESSED,{glNormalized:!0}),_oe=new p5e(t=>A3t.createBuffer(t),t=>t.count);function y3t(){_oe.clear()}function f5e(t){return _oe.acquire(t)}function _3t(t){_oe.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}function G4(t,e,r,i,s){const n=1/(Math.abs(r)+Math.abs(i)+Math.abs(s)),o=r*n,a=i*n,l=s<=0?(o>=0?1:-1)*(1-Math.abs(a)):o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(o)):a;t.setValues(e,NAe(l),NAe(c))}function v3t(t,e){const r=FAe(e[0]),i=FAe(e[1]),s=1-Math.abs(r)-Math.abs(i);t[2]=s,s<0?(t[0]=(r>=0?1:-1)*(1-Math.abs(i)),t[1]=(i>=0?1:-1)*(1-Math.abs(r))):(t[0]=r,t[1]=i),qe(t,t)}const DAe=16384;function Vh(t,e,r,i){t.setValues(e,r*DAe,i*DAe)}function NAe(t){return ze(Math.round(32767*t),-32767,32767)}function FAe(t){return ze(t/32767,-1,1)}function Qc(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}let b3t=class{constructor(){this.sinLonLUT=new Array(PP+1),this.cosLonLUT=new Array(PP+1),this.sinLatLUT=new Array(PP+1),this.cosLatLUT=new Array(PP+1)}update(e,r,i){const s=r[0],n=r[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},KN=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},w3t=class{constructor(){this.cornerNeighborData=[new KN,new KN,new KN,new KN],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},x3t=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.shading=!1,this.samplerDataVersion=0,this.neighborData=new w3t}},m5e=class A8{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=gt(this._current),this._next=gt(this._next),this._waiting=gt(this._waiting),this._delayed=gt(this._delayed)}get current(){if(N(this._current))return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=A8.test.fadeMoment;if(E(this._delayed)&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Sy.Immediate),this._delayed=null)),E(this._next)){e=e||performance.now();const r=this._fadeDuration,i=E(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==Ho.FADING,n=e-this._fadeStart>=r;(i||s||n)&&(gt(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(N(this._next))return 1;const e=A8.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return E(this._next)||E(this._delayed)}push(e,r=Sy.Immediate){this._delayed=gt(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),N(this._current))return void(this._current=e);const i=A8.test.fadeMoment||performance.now();return r!==Sy.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):N(this._next)?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(N(e)||(gt(this._waiting),this._waiting=e))}get _fadeDuration(){return N(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Sy;m5e.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(Sy||(Sy={}));var vM;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(vM||(vM={}));let g5e=class{constructor(){this._queue=new Vr,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),E(e)&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const e=(r=this._last)==null?void 0:r.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},T3t=class{constructor(){this._q=new Vr}get done(){return this._q.length===0}reset(e){if(this._q.clear(),!N(e)){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function h$(t,e,r){if(N(e)||N(e.fullExtent))return!1;const i=e.fullExtent,s=t.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function Ey(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function A5e(t,e,r=null){N(r)||r.length===0?t===vM.BACK_TO_FRONT?e.sort(S3t):e.sort(E3t):e.sort((i,s)=>C3t(i,s,t,r))}function S3t(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function E3t(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function y5e(t,e,r){const i=t.screenDepth,s=e.screenDepth;return i<s?-r:i>s?r:Ey(t,e)}function C3t(t,e,r,i){return kAe(t,i)===kAe(e,i)?y5e(t,e,r):t?r:-r}function kAe(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function M3t(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function R3t(t,e){const r=t.length;for(let i=0;i<r;++i)t.getItemAt(i).updateDistanceToPOI(e);t.sort(M3t)}function O3t(t,e,r){let i=1,s=0,n=0;for(;t!==e;)if(i*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),!(1&t.lij[1])&&(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,s,n,i)}function P3t(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r)return!0}}return!1}function Fqt(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,s=r?e:t,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}let voe=class{get updating(){return!!this._tileRequested}init(e,r,i,s){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Ho.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return E(e)?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),s=TK(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?h$:()=>!0;let h=this.tile;const p=h.level;let A;const _=this._tileLayerInfo.upsampleInfo,w=E(_)?_.tile.level:-1,T=!!E(_)&&w-p>=a,C=pa(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const M=h.level,O=p-M,$=h.layerInfo[r][e];if($.data&&O>=a){(!T||M>w)&&this._setUpsampleTile(h),$.dataInvalidated&&(A=h);break}if((N(C)||C.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&M<=o&&!$.data&&!$.dataMissing&&((N(A)||h.level===n||M%SRe==0||p-A.level<a)&&(A=h),O>=l))break;h=h.parent}return E(A)&&p-A.level<a&&this._tileLayerInfo.upsampleInfo&&(A=null),A}_findAncestorWithData(){const e=this.tile.vlevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=r)return s;i=s}return i}_setUpsampleTile(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Ho.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},I3t=class extends voe{get _desiredMinLevelDelta(){throw BAe}get _progressiveLevelModulo(){throw BAe}dispose(){}};const BAe=new Error("Abstract method called on TileAgent"),eh=new I3t;let _5e=class extends voe{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return yZ(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},v5e=class extends voe{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return SRe}};var Sx,dT;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(Sx||(Sx={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(dT||(dT={}));function $3t(t,e){t.fragment.uniforms.add([new mr("u_colormap",r=>r.u_colormap),new nt("u_colormapOffset",r=>r.colormap.u_colormapOffset),new nt("u_colormapMaxIndex",r=>r.colormap.u_colormapMaxIndex),new nt("u_opacity",r=>r.common.u_opacity)]),t.fragment.code.add(I`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${Wc(e,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)}function L3t(t,e){t.fragment.uniforms.add($0("u_transformGrid",r=>r.u_transformGrid,e.hasWebGL2Context?is.None:is.InvSize)),t.fragment.uniforms.add(new Bi("u_transformSpacing",r=>r.common.u_transformSpacing)),t.fragment.uniforms.add(new Bi("u_targetImageSize",r=>r.common.u_targetImageSize)),t.fragment.code.add(I`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${Wc(e,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${Wc(e,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${Wc(e,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${Wc(e,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)}let b5e=class extends ys{constructor(){super(...arguments),this.scale=1,this.offset=Hu}};function w5e(t){t.attributes.add(B.POSITION,"vec2"),t.attributes.add(B.UV0,"vec2"),t.vertex.uniforms.add(new nt("scale",e=>e.scale)),t.vertex.uniforms.add(new Bi("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(I`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let D3t=class extends b5e{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function N3t(t,e){t.include(L3t,e),t.fragment.uniforms.add([new mr("u_image",r=>r.u_image),new by("u_flipY",r=>r.common.u_flipY),new by("u_applyTransform",r=>r.common.u_applyTransform)]),t.fragment.code.add(I`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}var pt;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(pt||(pt={}));const IK={normal:pt.Normal,average:pt.Average,lighten:pt.Lighten,lighter:pt.Lighter,screen:pt.Screen,plus:pt.Plus,"color-dodge":pt.ColorDodge,darken:pt.Darken,multiply:pt.Multiply,"color-burn":pt.ColorBurn,overlay:pt.Overlay,"soft-light":pt.SoftLight,"hard-light":pt.HardLight,"vivid-light":pt.VividLight,hue:pt.Hue,saturation:pt.Saturation,luminosity:pt.Luminosity,color:pt.Color,difference:pt.Difference,exclusion:pt.Exclusion,minus:pt.Minus,invert:pt.Invert,reflect:pt.Reflect,"destination-over":pt.DestinationOver,"destination-atop":pt.DestinationAtop,"destination-in":pt.DestinationIn,"destination-out":pt.DestinationOut,"source-atop":pt.SourceAtop,"source-in":pt.SourceIn,"source-out":pt.SourceOut,xor:pt.Xor};function F3t(t){return t===pt.DestinationOver||t===pt.DestinationAtop||t===pt.DestinationIn||t===pt.DestinationOut||t===pt.SourceAtop||t===pt.SourceIn||t===pt.SourceOut||t===pt.Xor}function boe(t){t.code.add(I`
    float lineFactorAtPosition(float value) {
      float pos = value * ${I.float(257)};
      if(pos < 0.5 || pos > ${I.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function k3t(t,e){const r=e.blendMode;r!==pt.Normal&&(r===pt.Reflect&&t.code.add(I`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==pt.ColorDodge&&r!==pt.VividLight||t.code.add(I`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==pt.ColorBurn&&r!==pt.VividLight||t.code.add(I`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===pt.Overlay&&t.code.add(I`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===pt.HardLight&&t.code.add(I`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===pt.SoftLight&&t.code.add(I`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===pt.VividLight&&t.code.add(I`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==pt.Hue&&r!==pt.Saturation&&r!==pt.Color&&r!==pt.Luminosity||(t.code.add(I`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==pt.Hue&&r!==pt.Saturation||t.code.add(I`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(I`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===pt.Multiply?I`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.Average?I`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.Lighten?I`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.Darken?I`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.Lighter?I`return vec4(cl * ol + cb * ob, ol + ob);`:r===pt.Plus?I`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===pt.Minus?I`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===pt.Screen?I`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.Difference?I`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.Invert?I`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===pt.DestinationOver?I`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===pt.DestinationAtop?I`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===pt.DestinationOut?I`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===pt.SourceAtop?I`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===pt.SourceOut?I`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===pt.Xor?I`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===pt.DestinationIn?I`return vec4(cb * ob * ol, ol * ob);`:r===pt.SourceIn?I`return vec4(cl * ol * ob, ol * ob);`:r===pt.Hue?I`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.Saturation?I`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.Color?I`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.Luminosity?I`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.Exclusion?I`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.Reflect?I`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.ColorDodge?I`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.ColorBurn?I`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.Overlay?I`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.SoftLight?I`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.HardLight?I`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===pt.VividLight?I`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:I``}
    }
  `))}var ca,C0,c0;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(ca||(ca={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(C0||(C0={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(c0||(c0={}));function x5e(t,e){const r=e.output===ca.GridComposite,i=e.output===ca.ColorComposite,s=e.output===ca.GroupBackgroundComposite,n=e.output===ca.Composite;r&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(boe)),i&&t.fragment.uniforms.add(new Fr("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===C0.Required;if(o&&t.fragment.uniforms.add(new nt("baseOpacity",c=>c.baseOpacity)),n){const c=e.hasWebGL2Context?is.None:is.InvSize;t.fragment.uniforms.add($0("fboColor",h=>h.fboTexture,c))}const a=e.blendMode!==pt.Normal,l=e.premultipliedSource===c0.On;t.fragment.include(k3t,e),t.fragment.code.add(I`
    vec4 getBackground(vec2 uv) {
      return ${o?I`baseOpacity *`:""} ${s?I`vec4(0.0, 0.0, 0.0, 0.0)`:i?I`vec4(backgroundColor, 1.0)`:r?I`vec4(gridColor(uv), 1.0)`:I`${Wc(e,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?I`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:I`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?I`colorLayer * opacity;`:I`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let q7=class extends D3t{constructor(e,r,i,s,n,o){super(e,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=sc,this.fboTexture=null,this.baseOpacity=1}},B3t=class extends q7{},U3t=class extends q7{};function V3t(t){const e=new Di;return e.include(w5e),e.include(N3t,t),e.include($3t,t),e.include(x5e,t),e.fragment.code.add(I`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===Sx.Stretch?G3t(e,t):t.colorizerType===Sx.Lut?z3t(e):t.colorizerType===Sx.Hillshade&&j3t(e,t),e}function z3t(t){t.fragment.code.add(I`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function G3t(t,e){t.fragment.uniforms.add([new ZL("u_bandCount",i=>i.symbolizer.u_bandCount),new Kl("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new Kl("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new Kl("u_factor",i=>i.symbolizer.u_factor,3),new nt("u_minOutput",i=>i.symbolizer.u_minOutput),new nt("u_maxOutput",i=>i.symbolizer.u_maxOutput),new by("u_useGamma",i=>i.symbolizer.u_useGamma),new Kl("u_gamma",i=>i.symbolizer.u_gamma,3),new Kl("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new nt("u_opacity",i=>i.common.u_opacity)]),t.fragment.code.add(I`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?I`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:I`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(I`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===dT.Noop?I`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:I`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function j3t(t,e){const r=t.fragment;r.uniforms.add([new mr("u_image",s=>s.u_image),new ZL("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Kl("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Kl("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Kl("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Kl("u_weights",s=>s.symbolizer.u_weights,6),new Bi("u_factor",s=>s.symbolizer.u_factor),new nt("u_minValue",s=>s.symbolizer.u_minValue),new nt("u_maxValue",s=>s.symbolizer.u_maxValue),new Bi("u_srcImageSize",s=>s.common.u_srcImageSize)]),r.include(Qg),r.code.add(I`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(I`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?I`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:I`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(I`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const H3t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:U3t,ColorizerStretchUniforms:B3t,ColorizerUniforms:q7,build:V3t},Symbol.toStringTag,{value:"Module"}));function q3t(t,e,r="nearest",i=!1){var c;const s=!(i&&e.pixelType==="u8"),n=s?yr.FLOAT:yr.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:s?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:e.width,height:e.height,target:nr.TEXTURE_2D,pixelFormat:At.RGBA,internalFormat:t.type===sr.WEBGL2&&s?cr.RGBA32F:At.RGBA,samplingMode:!a||r!=="bilinear"&&r!=="cubic"?Bt.NEAREST:Bt.LINEAR,dataType:n,wrapMode:pr.CLAMP_TO_EDGE,flipped:!1};return new Wt(t,l,o)}function W3t(t,e){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=e,a=r[0]>1,l={width:a?4*n:n,height:o,target:nr.TEXTURE_2D,pixelFormat:At.RGBA,internalFormat:t.type===sr.WEBGL2?cr.RGBA32F:At.RGBA,dataType:yr.FLOAT,samplingMode:Bt.NEAREST,wrapMode:pr.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*i.length);if(a&&s!=null)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const A=4*(h*n+p),_=2*(p*o+h);c[A]=i[_],c[A+1]=i[_+1],c[A+3]=i[_]===-1?0:1}return new Wt(t,l,c)}function UAe(t,e){const r={width:e.length/4,height:1,target:nr.TEXTURE_2D,pixelFormat:At.RGBA,internalFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.NEAREST,wrapMode:pr.CLAMP_TO_EDGE,flipped:!1};return new Wt(t,r,e)}function Y3t(t,e,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:Hu,u_transformGridSize:t?t.size:Hu,u_targetImageSize:e,u_srcImageSize:r}}function Q3t(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function X3t(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function Z3t(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const VAe={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let J3t=class{constructor(e,r,i=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=Nt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...VAe,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||VAe}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){E(e)&&e.length>0?this._bandIds&&e.every((r,i)=>{var s;return!!((s=this._bandIds)!=null&&s[i])&&r===this._bandIds[i]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,E(this._rasterTexture)){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?Bt.LINEAR:Bt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=Nt(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((N(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(e,this.bandIds),E(this._rasterTexture)&&(this._updateColormapTexture(e),this.transformGrid&&N(this._transformGridTexture)&&(this._transformGridTexture=W3t(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:s,opacity:n}=this,o=Y3t(r,[i,s],[this.source.width,this.source.height],n),a=Q3t(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?X3t(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Z3t(this.symbolizerParameters):null;return new q7(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(N(this._memoryUsed)){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>E(r)?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=Nt(this._rasterTexture),this._transformGridTexture=Nt(this._transformGridTexture),this._colormapTexture=Nt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=Nt(this._rasterTexture));const s=N(r)&&N(this.bandIds)||E(r)&&E(this.bandIds)&&r.join("")===this.bandIds.join("");if(E(this._rasterTexture)&&s)return;this._rasterTexture=Nt(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=q3t(e,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=Nt(this._colormapTexture),this._colormapTexture=UAe(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=UAe(e,i),void(this._colormap=i)):(this._colormapTexture=Nt(this._colormapTexture),void(this._colormap=null))}},y8=class{constructor(){this.waitingAgents=new Vr,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=xH.acquire();return r._init(e),r}release(){this.dispose(),_8.delete(this),xH.release(this)}dispose(){this.loadingAgent=Nt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=d3(this._data)}static prune(){xH.prune(0)}_init(e){this.waitingAgents.clear(),this._data=d3(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=tf(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){E(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e===r||N(r))this._unsetUpsampleInfo();else{if(N(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),O3t(e,r,this._upsampleInfo)}}get data(){return this._data}set data(e){d3(this._data),this._data=e}};const xH=new al(y8,null,()=>{}),_8=new Map;function K3t(){_8.size>0&&(console.log(`${_8.size} live TilePerLayerInfo allocations:`),_8.forEach(t=>console.log(t,`
`)))}let HE=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}};var ur;(function(t){t[t.NONE=0]="NONE",t[t.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",t[t.SPLIT=2]="SPLIT",t[t.VSPLITMERGE=4]="VSPLITMERGE",t[t.MERGE=8]="MERGE",t[t.RENDERDATA=16]="RENDERDATA",t[t.GEOMETRY=32]="GEOMETRY",t[t.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=128]="TEXTURE_FADING"})(ur||(ur={}));const TH=V(),PS=V(),za=V(),eMt=.1;let woe=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=si(),this._elevationBounds=Dt(),this.layerInfo=[[],[]],this.extentInRadians=si(),this.centerAtSeaLevel=V(),this._center=[V(),Io(),V()],this.up=zte(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=V()}static prune(){xoe.prune(0),Toe.prune(0),y8.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[yo.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){var i;this._dirty=!1;const e=((i=this.parent)==null?void 0:i.frustumVisibility)??Ql.INTERSECTS;this._frustumVisibility=e===Ql.INSIDE?Ql.INSIDE:e===Ql.OUTSIDE?Ql.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==Ql.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){const e=this._surface.snapLevel;if(E(e)){const r=this.level-e;if(r===0)return!0;if(r===1)return!1}return this.isLeaf}init(e,r,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=es(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[yo.MIDDLE][3]=0,this.vlevel=e?e[0]:0,r&&r.elevationBounds?ga(this._elevationBounds,r.elevationBounds):Kr(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of w2){const n=i.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=y8.acquire(this._surface.upsampleInfoPool),s===ui.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,PP)}release(){ig(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of w2){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[ui.MAP].reduce((e,r)=>e+(r instanceof wH?r.memoryUsage:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){if(E(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:i}of this.layerInfo[ui.MAP])i instanceof wH?e+=this._getTerrainDataMemory(i):this._mapTileMemoryInternal+=this._getTerrainDataMemory(i);const r=this._cpuImageMemorySize;for(const i of this.layerInfo[ui.ELEVATION])this._usedMemory+=i.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=rT(this.renderData.textureDescriptor)),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i!=null&&i.data?e===ui.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===ui.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof HE?rT(e.texture):e instanceof HTMLImageElement||e instanceof z7?this._cpuImageMemorySize:e instanceof wH||e instanceof J3t?e.memoryUsage:0}updateScreenDepth(e){const r=this._center[yo.MIDDLE],i=e,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||E(e.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Ql.OUTSIDE))return ur.NONE;const s=this.level;Be(TH,this._center[yo.MIDDLE],r);let n=Jl(TH),o=yo.MIDDLE;Be(PS,this._center[yo.TOP],r);const a=Jl(PS);a<n&&(n=a,o=yo.TOP),Be(PS,this._center[yo.BOTTOM],r);const l=Jl(PS);if(l<n&&(n=l,o=yo.BOTTOM),this._edgeLen2>n&&s<e.maxLod)return ur.SPLIT;const c=Math.sqrt(n),h=e.fovX*c*2,p=this._edgeLen/h,A=()=>{const C=s+Math.ceil(-Math.log2(e.relativeWidthLimit/p));return C!==this.vlevel?(this.vlevel=C,ur.VSPLITMERGE):ur.NONE_HIT_MAXLOD};if(E(i)&&i-s===1)return s>=e.maxLod?A():ur.SPLIT;const _=He(this.up,TH),w=this._elevationBounds[1]-this._elevationBounds[0],T=w/this.edgeLen;if(e.aboveGround&&_>0&&T<.001&&_/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-T>0)return ur.NONE;if(p<e.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,ur.VSPLITMERGE):ur.NONE;if(s>=e.maxLod)return A();if(s>6){Be(PS,this._center[o],r),Me(za,this.up,_),Be(za,za,PS);const C=Jl(za);if(C>this.radius*this.radius){Me(za,za,this.radius/Math.sqrt(C)),ke(za,za,this._center[o]),Be(za,r,za);const M=Math.min(1,(Math.abs(He(za,this.up))+.5*w+this._curvatureHeight)/st(za)),O=eMt/e.angledSplitBias,$=e.fovY*c*2;if(M*(this._edgeLen/$)<O*e.relativeHeightLimit)return ur.NONE}}return ur.SPLIT}setChildren(e,r,i,s){ig(!!(e&&r&&i&&s),"Null child passed"),this._children[0]=e,this._children[1]=r,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of w2)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of w2){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==eh&&(eF(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(ur.GEOMETRY),this.resetPendingUpdate(ur.TEXTURE_NOFADING),this.resetPendingUpdate(ur.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[ui.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==eh&&(eF(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(dx(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;E(e)?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(ur.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of w2){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==eh&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(ur.SPLIT)||e!==ui.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===ur.SPLIT||e===ur.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const s=this.layerInfo[r][e];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),i.dataArrived(this),!0;if(s.requestPromise)return!0;tf(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return Jl(Be(za,this._center[yo.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const s=this.layerInfo[r][e],n=s.waitingAgents,o=n.removeUnordered(i)!=null;ig(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const s=this.layerInfo[r][e];s.data=i,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${e} error ${i}`);const s=this.layerInfo[r][e];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r){switch(e){case ui.MAP:return this._updateTexture(r);case ui.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Ho.FADING?ur.TEXTURE_NOFADING:ur.TEXTURE_FADING),this.setPendingUpdate(e===Ho.FADING?ur.TEXTURE_FADING:ur.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(ur.GEOMETRY);for(const e of this.layerInfo[ui.ELEVATION])e.pendingUpdates|=ur.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBounds,r=e[0],i=e[1];Kr(e,1/0,-1/0);const s=this.layerInfo[ui.ELEVATION];let n=!0;for(const o of s)E(o.elevationBounds)&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),r===e[0]&&i===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,r=.5*(e[0]+e[1]),i=this._center;Me(za,this.up,r),ke(i[yo.MIDDLE],this.centerAtSeaLevel,za),Me(za,this.up,e[0]),ke(i[yo.TOP],this.centerAtSeaLevel,za),Me(za,this.up,e[1]),ke(i[yo.BOTTOM],this.centerAtSeaLevel,za)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[ui.ELEVATION][e],s=yZ(this.level),n=Math.max(this.vlevel-s,0),o=i.elevationBounds;if(E(o)&&o.level>=r&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,ui.ELEVATION),l=TK(a);if(!h$(this,l,!1))return;const c=rMt;let h=!1;const p=i.data;if(p&&p.level<=n){const A=i.data;c.min=A.samplerData.data.minValue,c.max=A.samplerData.data.maxValue,c.hasNoDataValues=A.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let A,_,w=0;for(let T=this._parent;T&&(!_||w<s)&&(w=this.vlevel-T.level,A=_||A,_=T.layerInfo[ui.ELEVATION][e].data,!(!_&&A&&T.level<=n));T=T.parent);_=_||A,_&&(_.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=_.level,h=!0))}h&&(N(i.elevationBounds)&&(i.elevationBounds=new PC),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==eh&&(eF(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:y8.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Ho.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===eh&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of w2){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==eh&&(i.loadingAgent.setSuspension(r),i.loadingAgent===eh&&this.updateRenderData(e,Ho.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==eh&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=eh,!i.data&&N(i.upsampleInfo)&&this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||I3(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){var s,n,o;for(let a=e;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(sB(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||I3((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const s=this._isSuspended(r);for(let n=e;n<i.length;++n){const o=i[n];let a=!1;const l=this._surface.layerViewByIndex(n,r),c=TK(l);if(o.loadingAgent?h$(this,c,!1)?(o.loadingAgent!==eh&&o.loadingAgent.setSuspension(s),o.loadingAgent!==eh&&(a=o.loadingAgent.update())):o.dispose():h$(this,c,!1)&&(o.loadingAgent=tMt(this,n,r,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===eh&&this.setPendingUpdate(ur.GEOMETRY):(eF(o.loadingAgent),o.loadingAgent=eh)),o.loadingAgent===eh&&this.updateRenderData(r,Ho.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.vlevel-this.level,i=Math.max(this.level-e,yZ(this.level)-r),s=ze(1+(this.maxTesselation>>i),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(E(i)){for(const s of i)if(iMt(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(e,r){const i=this.lij,s=this.getNeighborLIJ(i,e);return s?sMt(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(e,r){const i=e===dr.NORTH_EAST?1:e===dr.NORTH_WEST?0:e===dr.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!r||!r(s));)s=s.children[i];return s}findNeighborCornerTileExact(e,r){var i;return((i=this.findNeighborTile(e,s=>r(s)||s.level===this.level))==null?void 0:i.findCorner(CK(e),r))||null}forAllSubtreeOnSide(e,r){const i=e===dr.NORTH?[0,1]:e===dr.NORTH_EAST?[1]:e===dr.EAST?[1,3]:e===dr.SOUTH_EAST?[3]:e===dr.SOUTH?[2,3]:e===dr.SOUTH_WEST?[2]:e===dr.WEST?[0,2]:[0],s=n=>{const o=n.children;!r(n)&&o[0]&&i.forEach(a=>s(o[a]))};s(this)}forallNeighbors(e){oB.forEach(r=>this.findNeighborCornerTileExact(r,e)),mg.forEach(r=>{var i;return(i=this.findNeighborTile(r,s=>s.level===this.level||e(s)))==null?void 0:i.forAllSubtreeOnSide(nB(r),e)})}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(it(!Xo||i>=0),i===0)return 0;const s=2**i,n=(1&e)==1,o=n?0:1,a=r.lij[o+1]*s,l=this.lij[o+1],c=l-a,h=n?s-1-c:c;return Xo&&(it(a<=l&&l<a+s),it(0<=h&&h<s)),h}forEachLoadedNeighbor(e){const r=this.level,i=s=>s.level===r||s.isLoaded;mg.forEach(s=>{const n=this.findNeighborTile(s,i);n!=null&&n!==this&&n.forAllSubtreeOnSide(nB(s),o=>!!o.isLoaded&&(e(o,s),!0))}),oB.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,i))==null?void 0:o.findCorner(CK(s),a=>a.isLoaded);it(!n||$K(this,n,s)),n!=null&&n.isLoaded&&e(n,s)})}getNeighborLIJ(e,r){const i=CAe(r)?-1:EAe(r)?1:0,s=TAe(r)?-1:SAe(r)?1:0,n=[e[0],e[1]+i,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+dc()>=this.surface.extent[1]}checkGeometryWaterproofness(){var e;rB&&(it(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(CAe(e)&&r[3]+s>=i[3]||EAe(e)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&TAe(e)&&r[0]-s<=i[0])&&!(!n&&SAe(e)&&r[2]+s>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;Oe(this._lastPOI,e);const i=this._center[yo.MIDDLE],s=e[0]-i[0],n=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=s*s+n*n+o*o}};function tMt(t,e,r,i){const s=r===ui.ELEVATION?Toe.acquire():xoe.acquire();return s.init(t,e,r,i),s}function eF(t){t.dispose(),t instanceof _5e?Toe.release(t):t instanceof v5e&&xoe.release(t)}const xoe=new al(v5e),Toe=new al(_5e),rMt=new PC;var yo;function iMt(t,e){const r=t.level,i=e[0];if(r>i)return!1;const s=i-r,n=Math.floor(e[1]/2**s),o=Math.floor(e[2]/2**s);return n===t.lij[1]&&o===t.lij[2]}function sMt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function nMt(t,e,r){if(N(t)||N(e))return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===dr.EAST||t.isWestEnd&&e.isEastEnd&&r===dr.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case dr.NORTH:return Bp(t.extent[3],e.extent[1],i);case dr.SOUTH:return Bp(t.extent[1],e.extent[3],i);case dr.EAST:return Bp(t.extent[2],e.extent[0],i)||Bp(t.extent[2],-e.extent[0],i);case dr.WEST:return Bp(t.extent[0],e.extent[2],i)||Bp(t.extent[0],-e.extent[2],i)}}function $K(t,e,r){return!N(t)&&!N(e)&&e!==t&&(t.level>=e.level?zAe(t,e,r):zAe(e,t,CK(r)))}function zAe(t,e,r){it(t.level>=e.level);const i=xCt(r),s=TCt(r),n=t.extent,o=e.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=Bp(a[0],l[0],c)||t.surface.isGlobal&&Bp(a[0],-l[0],c),p=Bp(a[1],l[1],c);if(h&&p)return!0;if(t.level===e.level||!h&&!p)return it(!1),!1;const A=h?GAe(o[1],o[3],n[1],n[3],c):GAe(o[0],o[2],n[0],n[2],c);return it(A),A}function GAe(t,e,r,i,s=dc()){return t-s<=r&&r<=i&&i<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(yo||(yo={}));let oMt=class{constructor(){this._scales=Nr(-1,-1,-1,-1),this._offsets=Nr(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function aMt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(I`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(I`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(I`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let Soe=class extends lLe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=V(),this.origin=this.slicePlaneLocalOrigin}};var Rh;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(Rh||(Rh={}));let lMt=class extends Soe{constructor(){super(...arguments),this.identifier=Rh.Material,this.output=ee.Color,this.transparent=!1,this.integratedMesh=!1}},cMt=class extends Soe{constructor(){super(...arguments),this.identifier=Rh.ShadowMap}},uMt=class extends Soe{constructor(){super(...arguments),this.identifier=Rh.Highlight}},aB=class extends kn{constructor(e,r){super(e,"vec4",As.Draw,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}};var Cy;function hMt(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add([new aB("overlayTexOffset",(s,n)=>dMt(s,n)),new aB("overlayTexScale",(s,n)=>pMt(s,n))]),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new mr("ovColorTex",(s,n)=>LK(s,n))),T5e(t,e)}function T5e(t,e){t.extensions.add("GL_OES_standard_derivatives"),e.pbrMode!==Qt.Water&&e.pbrMode!==Qt.WaterOnIntegratedMesh&&e.pbrMode!==Qt.TerrainWithWater||t.include(pLe,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(I`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(I`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(I`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(I`
    vec4 getOverlayColorTexel(vec4 texCoords) {
          vec2 texDim =  ${Qp(e,"ovColorTex")};

          vec4 color0 = ${Wc(e,"ovColorTex","vec2(texCoords.x * 0.5, texCoords.y)*texDim")};
          vec4 color1 = ${Wc(e,"ovColorTex","vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim")};

          bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
          bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));

          return mix(color1 * float(isValid1), color0, float(isValid0));
    }
  `),e.pbrMode!==Qt.Water&&e.pbrMode!==Qt.WaterOnIntegratedMesh&&e.pbrMode!==Qt.TerrainWithWater||(Ky(i),Yg(i),i.code.add(I`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function LK(t,e){return e.overlays.length===0?null:t.identifier===Rh.Material&&t.output===ee.Color?e.overlays[dn.INNER].getColorTextureNoRasterImage():t.identifier===Rh.Material&&t.output===ee.ObjectAndLayerIdColor?e.overlays[dn.INNER].getColorTexture(Ou.ObjectAndLayerIdColor):t.identifier===Rh.Highlight?e.overlays[dn.INNER].getValidTexture(Pn.Highlight):null}function dMt(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;xxe(s)>0&&(p3[2*i]=t.toMapSpace[0]/Pd(s)-s[0]/Pd(s),p3[2*i+1]=t.toMapSpace[1]/V0(s)-s[1]/V0(s))}return p3}function pMt(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;xxe(s)>0&&(p3[2*i]=t.toMapSpace[2]/Pd(s),p3[2*i+1]=t.toMapSpace[3]/V0(s))}return p3}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Cy||(Cy={}));const p3=Zr();var gg;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(gg||(gg={}));let fMt=class extends ys{constructor(){super(...arguments),this.overlayOpacity=1}};function xO(t,e){t.vertex.uniforms.add([new lB("overlayTexOffset"),new lB("overlayTexScale")]),t.fragment.uniforms.add([new nt("overlayOpacity",r=>r.overlayOpacity),new mr("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[dn.INNER].getColorTexture(r.overlaySource))]),T5e(t,e)}function mMt(t,e){const{vertex:r,fragment:i,varyings:s}=t;s.add("vtc","vec2"),r.uniforms.add(new lB("texOffsetAndScale")),i.uniforms.add(new jAe("tex")),i.uniforms.add(new SH("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(r.uniforms.add(new lB("nextTexOffsetAndScale")),s.add("nvtc","vec2"),i.uniforms.add(new jAe("texNext")),i.uniforms.add(new SH("nextTexOpacities")),i.uniforms.add(new gMt("fadeFactor")));const o=e.tileBlendInput===gg.ColorComposite,a=e.tileBlendInput===gg.GridComposite;a&&i.include(boe),o&&i.uniforms.add(new SH("backgroundColor")),r.code.add(I`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?I`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:I``}
  }`),i.code.add(I`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?I`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?I`backgroundColor`:I`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:I`return color;`}
    }`),n?i.code.add(I`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(I`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}let gMt=class extends kn{constructor(e){super(e,"float")}},SH=class extends kn{constructor(e){super(e,"vec3")}},lB=class extends kn{constructor(e){super(e,"vec4")}},jAe=class extends kn{constructor(e){super(e,"sampler2D")}},S5e=class extends fMt{};function AMt(t){const e=new Di,{vertex:r,fragment:i,varyings:s}=e;e.include(kL),e.include(XL,t),e.include(Sg,t);const n=()=>{e.include(N4,t),r.code.add(I`
      vec3 decodeNormalTerrain(vec2 e) {
        float z = 1.0 - abs(e.x) - abs(e.y);
        vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
        return normalize(n);
      }

      vec3 getNormal() {
        return  ${t.shading?I`decodeNormalTerrain(normalCompressed)`:I`getLocalUp(position, localOrigin)`};
      }
  `)};Uh(r,t),e.include(Fu,t);const o=t.overlayMode!==Cy.Disabled;switch(t.output){case ee.Color:{e.include(mMt,t),e.include(hT,t),o&&e.include(xO,{...t,pbrMode:t.pbrMode===Qt.Terrain?Qt.TerrainWithWater:Qt.Water});const a=t.overlayMode===Cy.EnabledWithWater;a&&e.include(aMt,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),(t.atmosphere||t.screenSizePerspective)&&pM(r);const l=t.receiveShadows&&!t.renderOccluded;l&&e.include(XM,t),t.atmosphere&&s.add("wnormal","vec3"),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),r.code.add(I`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${a?I`forwardVertexTangent(vnormal);`:I``}

          ${t.atmosphere?I`wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?I`setOverlayVTC(uv);`:""}
          ${t.tileBorders?I`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?I`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${l?I`forwardLinearDepth();`:""}

        }
      `),e.extensions.add("GL_OES_standard_derivatives"),e.extensions.add("GL_EXT_shader_texture_lod"),e.include(ho,t),e.include(hT,t),e.include(JL,t),e.include(uT,t),W0(i,t),KL(i),nR(i),i.uniforms.add([r.uniforms.get("localOrigin"),new Fr("viewDirection",(c,h)=>qe(HAe,$e(HAe,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))]),a&&i.uniforms.add([new mr("ovWaterTex",(c,h)=>h.overlays.length===0?null:h.overlays[dn.INNER].getNormalTexture(c.overlaySource)),new n$e("view",(c,h)=>ju(yMt,h.camera.viewMatrix,c.origin))]),i.code.add(I`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),Ky(i),Yg(i),i.code.add(I`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical&&t.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?I`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?I`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }
          ${t.atmosphere?I`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${t.atmosphere?I`atm + tileColor.rgb;`:I`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===Qt.Terrain||t.pbrMode===Qt.TerrainWithWater?I`gl_FragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:I`gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${a?I`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?I`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?I`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:I`
                  vec3 tNormal = normalize(normal);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?I`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `)}break;case ee.Depth:o&&e.include(xO,t),e.include(Hy,t),lb(e),sT(e),r.code.add(I`
              void main(void) {
                ${o?I`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(I`
              void main() {
                ${o&&t.invisible?I`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case ee.Shadow:case ee.ShadowHighlight:case ee.ShadowExcludeHighlight:e.include(Hy,t),lb(e),sT(e),r.code.add(I`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(I`void main() {
outputDepth(linearDepth);
}`);break;case ee.Normal:o&&e.include(xO,t),s.add("vnormal","vec3"),pM(r),n(),r.code.add(I`
            void main(void) {
              ${o?I`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(I`
            void main() {
              ${o&&t.invisible?I`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case ee.Highlight:o&&e.include(xO,t),r.code.add(I`
          void main() {
            ${o?I`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(a_,t),i.code.add(I`
          void main() {
            ${o?I`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===ee.ObjectAndLayerIdColor&&(e.include(xO,{...t,pbrMode:Qt.Disabled}),r.code.add(I`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(I`void main() {
gl_FragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const yMt=ot(),HAe=V(),_Mt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:S5e,build:AMt},Symbol.toStringTag,{value:"Module"}));let E5e=class C5e extends Vi{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2,r.spherical=e.viewingMode===_t.Global}initializeProgram(e){return new Fi(e.rctx,C5e.shader.get().build(this.configuration),M5e)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Rr({blending:r.renderOccluded?X0(tt.ONE,tt.ONE_MINUS_SRC_ALPHA):null,culling:i?dse:null,depthTest:r.renderOccluded?null:{func:Bs.LESS},depthWrite:r.renderOccluded?null:qu,colorWrite:zr,stencilTest:e?wvt(Bu.IntegratedMeshMaskExcluded):null})}getPipelineState(e,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,r)}};E5e.shader=new Ni(_Mt,()=>be(()=>import("./Terrain.glsl-bd8df13a.js"),[]));const M5e=new Map([[B.POSITION,0],[B.UV0,1],[B.NORMALCOMPRESSED,2]]);let vMt=class{constructor(){this.geometryInfo=new g3t,this.intersectionData=null,this.geometryState=null,this._textureRef=new m5e(()=>this.tile.surface.textureFadeDuration),this.overlay=new oMt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const r=this.geometryInfo;r.indices=null,r.vertexAttributes=null,Fs(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new x3t,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Xo&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)it(this.geometryInfo.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){var l;const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(E(c)&&(e===0&&i.extent[3]>c[3]||e===1&&i.extent[2]>c[2]||e===2&&i.extent[1]<c[1]||e===3&&i.extent[0]<c[0]))return s}const n=i.level,o=mg[e];if(!r)return it(N((l=i.surface)==null?void 0:l.rootTiles)||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),s;if(r.isLoaded){const c=r,h=c.renderData.geometryState,p=n-c.level;if(it(p>=0),p===0){const w=h.numVerticesPerSide-1;return Math.max(w,s)}const A=2**p,_=h.neighborData.edgeResolutions[(e+2)%4]/A;return Math.max(1,_)}it(!r.isLeaf);let a=s;return r.forAllSubtreeOnSide(nB(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(it(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState.neighborData,i=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),s=r.edgePeerNeighbors,n=r.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(mg[l],i),h=G2(e,c),p=((a=h==null?void 0:h.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,A=s[l],_=h!==G2(e,A),w=n[l]!==p;s[l]=c,(_||w)&&(n[l]=p,this._markEdgeDirty(l));const T=r.edgeResolutions[l],C=this._calculateEdgeResolution(l,c);it(U0(C)),it(C>=1),r.edgeResolutions[l]=C,T!==C&&this._markEdgeResolutionDirty(l)}const o=r.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(oB[l],i);o[l]=c;const h=G2(e,s[l]),p=G2(e,s[(l+1)%4]),A=G2(e,c);Of[l]=A,Of[(l+1)%4]=p,Of[(l+2)%4]=e,Of[(l+3)%4]=h,it(Of.some(C=>(C==null?void 0:C.isLoaded)||C===e));const _=Of.reduce((C,M)=>Math.min(C,(M==null?void 0:M.level)??1/0),1/0);Of.forEach((C,M)=>{C&&(C==null?void 0:C.level)>_&&(Of[M]=null)}),it(Of.some(C=>(C==null?void 0:C.isLoaded)||C===e));const w=r.cornerNeighborData[l].cornerTiles,T=r.cornerNeighborData[l].cornerTileSamplerVersions;for(let C=0;C<4;++C){const M=Of[C],O=(M==null?void 0:M.renderData.geometryState.samplerDataVersion)??-1,$=w[C]!==M,L=!$&&T[C]!==O;($||L)&&(w[C]=M,T[C]=O,this._markCornerDirty(l))}it(w.some(C=>(C==null?void 0:C.isLoaded)||C===e))}Xo&&it(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)Of[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Xo&&it(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,s=this.geometryInfo.vertexAttributes,n=!i||!s||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(e)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,_3t(this.geometryInfo),!0)}ensureTexture(e,r){return E(this._texture)&&this._texture.descriptor.width!==e&&this.releaseTexture(),N(this._texture)&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){E(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const r=1<<e;this._dirtyCorners|=r}_markEdgeDirty(e){const r=1<<e;this._dirtyEdges|=r}_markEdgeResolutionDirty(e){const r=1<<e;this._dirtyEdgeResolutions|=r,this._dirtyEdges|=r}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),s=Math.max(i,5);let n=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),Iy(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=r.surface,c=l.wireframe;o.wireframe!==c&&(this._wireframeChanged=!0,o.wireframe=c,a=!0);const h=l.shading;return o.shading!==h&&(this._shadingChanged=h,o.shading=h,a=h),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometryInfo.vertexAttributes,i=this.geometryInfo.indices,s=e.gl;this._vao=new Z0(e,M5e,{geometry:Wh(r.layout)},{geometry:Wi.createVertex(e,s.STATIC_DRAW,r.buffer)},Wi.createIndex(e,s.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=Sy.Immediate){E(e)&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[ui.ELEVATION],i=r.length,s=new Array(i);let n=0,o=0,a=!1;for(let h=0;h<i;h++){const p=r[h];if(E(p.upsampleInfo)){const A=p.upsampleInfo.tile,_=A.layerInfo[ui.ELEVATION][h].data,w=_&&_.samplerData;e&&e[n]===w||(a=!0),s[n++]=w,o=Math.max(o,A.lij[0])}else if(p.data){const A=this.tile.surface.layerViewByIndex(h,ui.ELEVATION);if(h$(this.tile,A.layer,!1)){const _=p.data;e&&e[n]===_.samplerData||(a=!0),s[n++]=_.samplerData,o=this.tile.level}}}E(e)&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i;const e=Ed(this.intersectionData,0,s=>s.estimatedMemoryUsage);return(((r=this.geometryInfo.indices)==null?void 0:r.byteLength)??0)+(((i=this.geometryInfo.vertexAttributes)==null?void 0:i.byteLength)??0)+e}get textureDescriptor(){return E(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Xo)return;const e=this.tile;if(it(e==null?void 0:e.isLoaded),!e.isLoaded||!e.intersectsClippingArea)return;const r=e.renderData;if(e.level===0)return;const i=e.surface.extent;if(E(i)&&!e.intersectsExtent(i))return;const s=mg.map((l,c)=>!!E(i)&&(c<2?-1:1)*(e.extent[3-c]-i[3-c])<0),n=e.level;it(this._dirtyCorners===0),it(this._dirtyEdges===0),it(this._dirtyEdgeResolutions===0),it(!this._numVerticesPerSideChanged),it(!this._samplerDataChanged),it(!this._clippingAreaChanged),it(!this._wireframeChanged);const o=oB.map(l=>e.findNeighborCornerTileExact(l,c=>!c.intersectsClippingArea||c.isLoaded||c.level===e.level)??null).map(l=>l!=null&&l.intersectsClippingArea?l:null),a=this.geometryState.neighborData;for(let l=0;l<4;++l){const c=a.cornerPeerNeighbors[l],h=o[l];it(h===c,`Tile[${e.lij}].corner[${l}] out of date: cur=[${c==null?void 0:c.lij}] exp=[${h==null?void 0:h.lij}]`)}mg.forEach((l,c)=>{if(s[c])return;const h=e.findNeighborTile(l,q=>(q.level===n||(q==null?void 0:q.isLoaded))&&(q==null?void 0:q.intersectsClippingArea));if(!h){const q=!e.surface.updatingRootTiles&&E(e.surface.rootTiles)&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(l);return void it(!q)}it(h.isLoaded||h.level===e.level),it(h===this.geometryState.neighborData.edgePeerNeighbors[c]);const p=n-h.level;if(!h.isLoaded)return it(!h.isLeaf),void it(p===0);const A=h.renderData;it(nMt(e,h,l)),it(p>=0);const _=2**p;if(p<0)return void it(!1);const w=r.geometryInfo,T=w.outerEdges[c],C=w.numVerticesPerSide-1,M=A.geometryInfo;if(!M)return void it(!1);{const q=this.geometryState.neighborData.edgePeerNeighbors[c];if(q!=null&&q.isLoaded){const X=q.renderData;it(q==q),it(r.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===X.geometryState.samplerDataVersion),it(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===X.geometryState.samplerDataVersion)}}const O=(c+2)%4,$=M.outerEdges[O],L=T.count-1,k=$.count-1;it(L*_===k,`Tile[${e.lij}]:e${c},res=${L} edgeRes mismatch with Neighbor[${h.lij}]:e${O},res=${k} (expected:${L*_})`);const F=e.extent,G=l===dr.NORTH||l===dr.SOUTH,z=$.count-1,Z=z/2**p,J=T.count-1;if(Z<1)return void it(J===1);it(Z===J),it(U0(Z));const te=M.numVerticesPerSide-1;it(p>0||Z===Math.max(te,C));const re=e.getNeighborEdgeStartVertexIndex(c,h);it(0<=re&&re<_);const Ae=re*Z;it(0<=Ae&&Ae<=z-Z);let ve=0,ye=Ae;T.getVertexPos(_m,0),T.getVertexPos(vm,T.count-1);const le=Is(_m,vm),W=Math.max(bMt,1e-4*le);for(let q=0;q<=Z;++q){T.getVertexPos(_m,ve),$.getVertexPos(vm,ye);const X=q/Z,se=G?F[0]+X*(F[2]-F[0]):l===dr.WEST?F[0]:F[2],ae=G?l===dr.SOUTH?F[1]:F[3]:F[1]+X*(F[3]-F[1]),fe=e.surface.extent;if(N(fe)||rU(fe,se,ae)){const ue=hL(_m,vm),Re=gh(_m)-gi.radius,De=gh(vm)-gi.radius,Ue=ue<W;if(!Ue){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${c}[${ve}/${T.count}] and [${h.lij}].edge${O}[${ye}/${$.count}]`),E(fe)&&console.warn("  surface extent= ",fe," x,y=",se,",",ae);const Je=V();Be(Je,r.localOrigin,A.localOrigin),gh(Je)>0&&console.warn(`   localOrigins: ${r.localOrigin} vs ${A.localOrigin} d=${gh(Je)} [${Je}]`),(()=>{const vt=In(_m),lt=In(vm);e.updateEdgeElevations(),h.updateEdgeElevations(),T.getVertexPos(_m,ve),$.getVertexPos(vm,ye);const Ye=V();Da(Ye,_m,vt),gh(Ye)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${vt} vs ${_m} d=${gh(Ye)} [${Ye}]`),Da(Ye,vm,lt),gh(Ye)>0&&console.warn(`  XXX Neighbor[${h.lij}] edge out of date: ${lt} vs ${vm} d=${gh(Ye)} [${Ye}]`)})(),it(Ue,`Mismatch in tile [${e.lij}].edge[${c}][${ve}/${T.count}] vs neighbor [${h.lij}].edge[${O}][${ye}/${$.count}] ${AA(_m)} vs ${AA(vm)}  dist=${ue} h(t|n|d)=${Re}|${De}|${De-Re}`)}if(e.surface.shading){T.getNormal(IS,ve),$.getNormal($S,ye),qe(qAe,IS),qe(WAe,$S);const Je=He(qAe,WAe),vt=1-Je<.01||!1||e===h;if(!vt){const lt=V();Da(lt,IS,$S);const Ye=()=>`Mismatch in tile edge normal ${xAe(e.lij)} (${ve}/${T.count-1}) edge ${c} vs neighbor ${xAe(h.lij)}  (${ye}/${$.count-1}) nedge ${O} :${AA(IS)} vs ${AA($S)}  dot = ${Je} : ${AA(lt)}`;console.warn("Mismatch in tile edge normal: ",Ye());{e.updateEdgeElevations(),h.updateEdgeElevations();const ut=V(),ht=V();T.getNormal(ut,ve),$.getNormal(ht,ye),Zv(IS,ut)||console.warn("Missing update in tile normal: ",AA(IS)," => ",AA(ut)),Zv($S,ht)||console.warn("Missing update in neighbor normal: ",AA($S)," => ",AA(ht))}it(vt,Ye())}}}ve+=1,ye+=1}})}};const _m=V(),vm=V(),IS=V(),$S=V(),qAe=V(),WAe=V(),bMt=1,Of=[null,null,null,null];function G2(t,e){return e!=null&&e.isLoaded||e===t?e:null}const wMt=65536;function xMt(t,e){const r=t.tile,{extent:i,extentInRadians:s,surface:n}=r,o=t.localOrigin,a=t.geometryState,l=n.isWebMercator,c=n.shading||pT,h=a.numVerticesPerSide,p=h-1,A=(h-2)**2,_=l&&(e===kp.HAS_SOUTH_POLE||e===kp.HAS_BOTH_POLES),w=l&&(e===kp.HAS_NORTH_POLE||e===kp.HAS_BOTH_POLES),T=6,C=((_?1:0)+(w?1:0))*T*(p+1),M=a.neighborData,O=M.edgeResolutions.reduce((z,Z)=>z+Z+1,0),$=f5e(A+C+O),L=t.geometryInfo;L.numVerticesPerSide=a.numVerticesPerSide,L.vertexAttributes=$;const k=L.boundingBox;Fs(k);const F=Eoe(t);To.update(p,s,F),TMt(t),F5e(t,A),R5e(t);const G=[];if((()=>{let z=A+O;const Z=o[0],J=o[1],te=o[2],re=r.ellipsoid.radius,Ae=i[1],ve=i[3],ye=(le,W)=>{const q=W*h;Qc(-Z,-J,le*re-te,k),G.push({connectedRowOffset:q,connectedOuterEdgeOffset:le===1?0:2,rowOffset:z,latitudeResolution:T});const X=I5e(le===-1?Ae:ve,re),se=le*Math.PI/2-X,ae=.99*(le===1?1:-1),fe=re+0,ue=$.position,Re=$.uv0,De=$.normalCompressed;for(let Ue=1;Ue<=T;++Ue){const Je=X+se*(Ue/T),vt=Math.cos(Je),lt=Math.sin(Je);for(let Ye=0;Ye<=p;Ye++){const ut=Ye/p,ht=To.sinLonLUT[Ye],Jt=To.cosLonLUT[Ye]*vt,Pt=ht*vt,xr=lt,Ir=Jt*fe-Z,Tr=Pt*fe-J,Er=xr*fe-te;Qc(Ir,Tr,Er,k),ue.setValues(z,Ir,Tr,Er),Vh(Re,z,ut,ae),c&&G4(De,z,Jt,Pt,xr),++z}}};_&&ye(-1,0),w&&ye(1,p)})(),N5e(L,a.numVerticesPerSide,G,[0,h-1],[0,h-1],a.wireframe),t.intersectionData=null,Xo)for(let z=0;z<4;++z)it(L.outerEdges[z].count===M.edgeResolutions[z]+1)}function TMt(t){const e=t.tile;e.intersectsClippingArea&&(e.surface.shading||pT?EMt(t):SMt(t))}function SMt(t){const e=t.geometryState,r=e.numVerticesPerSide,i=r-2,s=r-1,n=t.geometryInfo,o=n.vertexAttributes,a=o.position,l=o.uv0,c=t.tile,h=c.extent,p=h[0],A=h[2],_=h[1],w=h[3],T=c.ellipsoid.radius,C=e.samplerData,M=t.localOrigin,O=M[0],$=M[1],L=M[2],k=n.boundingBox,F=a.typedBuffer,G=a.typedBufferStride;let z=0;for(let Z=1;Z<=i;Z++){const J=Z/s,te=_*(1-J)+w*J,re=To.sinLatLUT[Z],Ae=To.cosLatLUT[Z];for(let ve=1;ve<=i;ve++){const ye=ve/s,le=p*(1-ye)+A*ye,W=To.sinLonLUT[ve],q=To.cosLonLUT[ve],X=T+tn(le,te,C),se=q*Ae*X-O,ae=W*Ae*X-$,fe=re*X-L;Qc(se,ae,fe,k);const ue=z*G;F[ue]=se,F[ue+1]=ae,F[ue+2]=fe,Vh(l,z,ye,J),++z}}}function EMt(t){const e=t.geometryState,r=e.numVerticesPerSide,i=r-2,s=r-1,n=t.geometryInfo,o=n.vertexAttributes,a=o.position,l=o.uv0,c=o.normalCompressed,h=t.tile,p=h.extent,A=p[0],_=p[2],w=p[1],T=p[3],C=h.ellipsoid.radius,M=e.samplerData,O=t.localOrigin,$=O[0],L=O[1],k=O[2],F=a.typedBuffer,G=a.typedBufferStride,z=1/s,Z=n.boundingBox;let J=0;if(1<=i){const te=z,re=w*(1-te)+T*te,Ae=To.sinLatLUT[1],ve=To.cosLatLUT[1];for(let ye=1;ye<=i;ye++){const le=ye*z,W=A*(1-le)+_*le,q=To.sinLonLUT[ye],X=To.cosLonLUT[ye],se=C+tn(W,re,M),ae=se*X*ve-$,fe=se*q*ve-L,ue=se*Ae-k;Qc(ae,fe,ue,Z);const Re=(ye-1)*G;F[Re]=ae,F[Re+1]=fe,F[Re+2]=ue,Vh(l,ye-1,le,te)}}for(let te=1;te<=i;te++){const re=te*z,Ae=w*(1-re)+T*re,ve=To.sinLatLUT[te],ye=To.cosLatLUT[te],le=te+1,W=le*z,q=w*(1-W)+T*W,X=To.sinLatLUT[le],se=To.cosLatLUT[le],ae=To.sinLonLUT[0],fe=To.cosLonLUT[0],ue=C+tn(A,Ae,M);let Re=fe*ye*ue-$,De=ae*ye*ue-L,Ue=ve*ue-k;const Je=J*G;let vt=F[Je],lt=F[Je+1],Ye=F[Je+2];for(let ut=1;ut<=i;ut++){const ht=ut*z,Jt=A*(1-ht)+_*ht,Pt=To.sinLonLUT[ut],xr=To.cosLonLUT[ut];let Ir=xr*ye,Tr=Pt*ye,Er=ve,ei=0,zi=0,Lr=0;{let Ft=0,yt=0,kt=0;if(ut<i){const yi=(J+1)*G;Ft=F[yi],yt=F[yi+1],kt=F[yi+2]}else{const yi=To.sinLonLUT[s],bi=To.cosLonLUT[s],wi=C+tn(_,Ae,M);Ft=bi*ye*wi-$,yt=yi*ye*wi-L,kt=ve*wi-k}const jt=Re,tr=De,Or=Ue;Re=vt,De=lt,Ue=Ye,vt=Ft,lt=yt,Ye=kt,ei=Ft-jt,zi=yt-tr,Lr=kt-Or}{let Ft=0,yt=0,kt=0;if(te>1){const jt=(J-i)*G;Ft=F[jt],yt=F[jt+1],kt=F[jt+2]}else{const jt=To.sinLatLUT[0],tr=To.cosLatLUT[0],Or=C+tn(Jt,w,M);Ft=xr*tr*Or-$,yt=Pt*tr*Or-L,kt=jt*Or-k}{const jt=C+tn(Jt,q,M),tr=xr*se*jt-$,Or=Pt*se*jt-L,yi=X*jt-k;if(te<i){const _s=J+i,kr=_s*G;F[kr]=tr,F[kr+1]=Or,F[kr+2]=yi,Qc(tr,Or,yi,Z),Vh(l,_s,ht,W)}const bi=Ft-tr,wi=yt-Or,_i=kt-yi;Er*Er<.999&&(Ir=Lr*wi-zi*_i,Tr=ei*_i-Lr*bi,Er=zi*bi-ei*wi)}}const ti=1/Math.sqrt(Ir*Ir+Tr*Tr+Er*Er);G4(c,J,Ir*ti,Tr*ti,Er*ti),++J}}}function CMt(t){t.tile.intersectsClippingArea&&(R5e(t),W7(t))}function MMt(t){t.tile.intersectsClippingArea&&(P5e(t),O5e(t,!0),W7(t))}function R5e(t){t.tile.intersectsClippingArea&&(P5e(t),O5e(t))}function O5e(t,e=!1){const r=t.geometryState,i=t.geometryInfo,s=r.neighborData,n=t.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,h=c[0],p=c[2],A=c[1],_=c[3],w=r.samplerData,T=a[0],C=a[2],M=a[1],O=a[3],$=Eoe(t),L=i.boundingBox,k=t.localOrigin,F=k[0],G=k[1],z=k[2],Z=n.surface.shading||pT,J=i.vertexAttributes,te=J.position,re=te.typedBuffer,Ae=te.typedBufferStride,ve=J.uv0;for(let ye=0;ye<4;++ye){const le=ye===1||ye===3,W=s.edgeResolutions[ye];it(U0(W));const q=W+1,X=G2(n,s.edgePeerNeighbors[ye]);if(U5e(n,X,ye)){k5e(t,ye,X);continue}const se=E(X);it(!se||X.level===n.level),it(!se||Ey(n,X)<=0);const ae=X==null?void 0:X.renderData,fe=ae==null?void 0:ae.geometryState;if(Xo){const yt=n.surface;if(!X&&yt&&!yt.updatingRootTiles){const kt=mg[ye],jt=n.findNeighborTile(kt,tr=>tr.isLoaded||tr.isLeaf||tr.level===n.level);jt?jt.intersectsClippingArea&&(it(!jt.isLoaded),it(!jt.isLeaf),it(jt.level===o)):it(N(yt==null?void 0:yt.rootTiles)||!n.shouldHaveNeighbor(kt))}}const ue=ye===1?a[2]:a[0],Re=X==null?void 0:X.extent,De=Re&&le?ye===1?Re[0]:Re[2]:ue,Ue=ye===0?a[3]:a[1],Je=ye===1?1:0,vt=ye===0?1:0,lt=ye===1?p:h,Ye=ye===0?_:A,ut=Math.sin(lt),ht=Math.cos(lt),Jt=Math.sin(Ye),Pt=Math.cos(Ye),xr=fe==null?void 0:fe.samplerData,Ir=se?(yt,kt,jt)=>.5*(tn(yt,kt,w)+tn(jt,kt,xr)):(yt,kt,jt)=>tn(yt,kt,w),Tr=i.outerEdges[ye],Er=e&&q>3?q-3:1,ei=E(w)&&w.some(yt=>yt!=null),zi=E(xr)&&xr.some(yt=>yt!=null),Lr=ei||zi,ti=1/W,Ft=Tr.index0;Z?(it(!Re||Bp(Re[2]-Re[0],a[2]-a[0])),(()=>{const yt=ye===1?-1:ye===3?1:0,kt=ye===0?-1:ye===2?1:0,jt=(a[2]-a[0])*ti,tr=yt*jt,Or=kt*jt,yi=le?yt*((p-h)*ti):0,bi=le?0:kt*ti,wi=vt,_i=le?lt+yi:lt,_s=le?Math.sin(_i):ut,kr=le?Math.cos(_i):ht,ni=le?lt-yi:lt,qr=le?Math.sin(ni):ut,An=le?Math.cos(ni):ht,rs=le?Ye:$(wi+bi),Us=le?Jt:Math.sin(rs),ss=le?Pt:Math.cos(rs),Ls=le?Ye:$(wi-bi),on=le?Jt:Math.sin(Ls),Ze=le?Pt:Math.cos(Ls);let Ko=0,bo=0,yn=0;{const Xi=0*ti,ea=le?ue:T*(1-Xi)+C*Xi,ya=le?De:ea,Ie=le?M*(1-Xi)+O*Xi:Ue,Ii=le?lt:h*(1-Xi)+p*Xi,Pe=le?ut:Math.sin(Ii),Ge=le?ht:Math.cos(Ii),dt=le?$(Xi):Ye,Xe=le?Math.sin(dt):Jt,g=le?Math.cos(dt):Pt,K=l+Ir(ea,Ie,ya);Ko=Ge*g*K,bo=Pe*g*K,yn=Xe*K}let Vs=0,Ss=0,an=0;{const Xi=1*ti,ea=le?ue:T*(1-Xi)+C*Xi,ya=le?De:ea,Ie=le?M*(1-Xi)+O*Xi:Ue,Ii=le?lt:h*(1-Xi)+p*Xi,Pe=le?ut:Math.sin(Ii),Ge=le?ht:Math.cos(Ii),dt=le?$(Xi):Ye,Xe=le?Math.sin(dt):Jt,g=le?Math.cos(dt):Pt,K=l+Ir(ea,Ie,ya);Vs=Ge*g*K,Ss=Pe*g*K,an=Xe*K}for(let Xi=1;Xi<q-1;Xi+=Er){let ea=0,ya=0,Ie=0;{const _a=(Xi+1)*ti,Ac=le?ue:T*(1-_a)+C*_a,Kn=le?De:Ac,Mi=le?M*(1-_a)+O*_a:Ue,ra=le?lt:h*(1-_a)+p*_a,Qh=le?ut:Math.sin(ra),d_=le?ht:Math.cos(ra),ru=le?$(_a):Ye,Yr=le?Math.sin(ru):Jt,oe=le?Math.cos(ru):Pt,vr=l+Ir(Ac,Mi,Kn);ea=d_*oe*vr,ya=Qh*oe*vr,Ie=Yr*vr}const Ii=ea,Pe=ya,Ge=Ie,dt=Vs,Xe=Ss,g=an;Vs=Ii,Ss=Pe,an=Ge;{const _a=Ft+Xi,Ac=_a*Ae,Kn=dt-F,Mi=Xe-G,ra=g-z;re[Ac]=Kn,re[Ac+1]=Mi,re[Ac+2]=ra,Qc(Kn,Mi,ra,L);const Qh=Xi*ti;Vh(ve,_a,le?Je:Qh,le?Qh:vt)}const K=Ko,Ci=bo,vs=yn;Ko=dt,bo=Xe,yn=g;const bs=dt,Wr=Xe,vi=g,_r=1/Math.sqrt(bs*bs+Wr*Wr+vi*vi),hs=vi*_r;let Dr=0,ta=0,Yh=0;if(Lr&&hs*hs<.999){let _a=0,Ac=0,Kn=0;{const Mi=ye===0?-1:1;_a=Mi*(Ii-K),Ac=Mi*(Pe-Ci),Kn=Mi*(Ge-vs)}{const Mi=Xi*ti,ra=le?ue:T*(1-Mi)+C*Mi,Qh=le?De:ra,d_=le?M*(1-Mi)+O*Mi:Ue,ru=le?lt:h*(1-Mi)+p*Mi,Yr=le?ut:Math.sin(ru),oe=le?ht:Math.cos(ru),vr=le?$(Mi):Ye,ml=le?Math.sin(vr):Jt,LT=le?Math.cos(vr):Pt;let Db=bs,he=Wr,je=vi;if(se){const H=l+tn(Qh-tr,d_-Or,xr),Qr=le?LT:Ze;Db=(le?An:oe)*Qr*H,he=(le?qr:Yr)*Qr*H,je=(le?ml:on)*H}{const H=l+tn(ra+tr,d_+Or,w),Qr=le?LT:ss,Lo=(le?kr:oe)*Qr*H,_n=(le?_s:Yr)*Qr*H,kl=(le?ml:Us)*H;se||(Db=2*bs-Lo,he=2*Wr-_n,je=2*vi-kl);const em=ye===3?-1:1,rD=em*(Db-Lo),oR=em*(he-_n),aR=em*(je-kl);Dr=Kn*oR-Ac*aR,ta=_a*aR-Kn*rD,Yh=Ac*rD-_a*oR;const DT=1/Math.sqrt(Dr*Dr+ta*ta+Yh*Yh);Dr*=DT,ta*=DT,Yh*=DT}}}else Dr=bs*_r,ta=Wr*_r,Yh=vi*_r;Tr.setNormalFromValues(Xi,Dr,ta,Yh)}})()):(()=>{for(let yt=1;yt<q-1;yt+=Er){const kt=yt*ti,jt=le?Je:kt,tr=le?kt:vt,Or=le?ue:T*(1-kt)+C*kt,yi=le?M*(1-kt)+O*kt:Ue,bi=le?De:Or,wi=le?lt:h*(1-kt)+p*kt,_i=le?ut:Math.sin(wi),_s=le?ht:Math.cos(wi),kr=le?$(kt):Ye,ni=le?Math.sin(kr):Jt,qr=le?Math.cos(kr):Pt,An=Ir(Or,yi,bi),rs=l+An,Us=_s*qr*rs-F,ss=_i*qr*rs-G,Ls=ni*rs-z;Qc(Us,ss,Ls,L);const on=Ft+yt,Ze=on*Ae;re[Ze]=Us,re[Ze+1]=ss,re[Ze+2]=Ls,Vh(ve,on,jt,tr)}})()}}function P5e(t){B5e(t)}function I5e(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function RMt(t,e,r,i){return I5e(t*(1-i)+e*i,r)}function OMt(t,e,r){return t*(1-r)+e*r}function Eoe(t){const e=t.tile;if(e.surface.isWebMercator){const i=e.extent,s=e.ellipsoid.radius;return n=>RMt(i[1],i[3],s,n)}const r=e.extentInRadians;return i=>OMt(r[1],r[3],i)}function PMt(t,e){const r=t.tile.extent,i=t.geometryState,s=r[0],n=r[1],o=r[2]-s,a=r[3]-n,l=i.clippingArea,c=E(l)?Math.max(0,(l[0]-s)/o):0,h=E(l)?Math.max(0,(l[1]-n)/a):0,p=E(l)?Math.min(1,(l[2]-s)/o):1,A=E(l)?Math.min(1,(l[3]-n)/a):1,_=i.numVerticesPerSide,w=(_-2)**2,T=i.neighborData.edgeResolutions.reduce(($,L)=>$+L+1,0),C=f5e(w+T),M=t.geometryInfo,O=M.boundingBox;Fs(O),M.numVerticesPerSide=i.numVerticesPerSide,M.vertexAttributes=C,ns(M.uvRange,c,h,p,A),IMt(t),F5e(t,w),$5e(t),N5e(M,i.numVerticesPerSide,[],[0,_-1],[0,_-1],i.wireframe),t.intersectionData=null}function IMt(t){const e=t.tile;e.intersectsClippingArea&&(e.surface.shading?LMt(t):$Mt(t))}function $Mt(t){const e=t.geometryState,r=e.samplerData,i=t.tile,s=i.surface,n=t.localOrigin,o=s.isWebMercatorOnPlateeCarree,a=e.clippingArea,l=E(a)?a:Y7,c=i.extent,h=c[0],p=c[1],A=c[2],_=c[3],w=Math.max(h,l[0]),T=Math.min(A,l[2]),C=Math.max(p,l[1]),M=Math.min(_,l[3]),O=n[0],$=n[1],L=n[2],k=i.ellipsoid.radius,F=i.horizontalScale,G=Coe(o,k,F),z=e.numVerticesPerSide,Z=z-1,J=z-2,te=t.geometryInfo,re=te.uvRange,Ae=re[0],ve=re[1],ye=re[2],le=re[3],W=te.boundingBox,q=te.vertexAttributes,X=q.position,se=q.uv0;let ae=0;for(let fe=1;fe<=J;fe++){const ue=fe/Z,Re=ze(p*(1-ue)+_*ue,C,M),De=ze(ue,ve,le),Ue=G(Re)-$;for(let Je=1;Je<=J;Je++){const vt=Je/Z,lt=ze(h*(1-vt)+A*vt,w,T),Ye=ze(vt,Ae,ye),ut=lt*F-O,ht=tn(lt,Re,r)-L;Qc(ut,Ue,ht,W),X.setValues(ae,ut,Ue,ht),Vh(se,ae,Ye,De),++ae}}}function LMt(t){const e=t.tile,r=e.surface;if(!(r.shading||pT))return;const i=t.geometryState,s=i.samplerData,n=t.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=E(a)?a:Y7,c=e.extent,h=c[0],p=c[1],A=c[2],_=c[3],w=Math.max(h,l[0]),T=Math.min(A,l[2]),C=Math.max(p,l[1]),M=Math.min(_,l[3]),O=e.ellipsoid.radius,$=e.horizontalScale,L=i.numVerticesPerSide,k=L-1,F=L-2,G=t.geometryInfo,z=G.vertexAttributes,Z=z.position,J=z.uv0,te=z.normalCompressed,re=G.uvRange,Ae=re[0],ve=re[1],ye=re[2],le=re[3],W=G.boundingBox,q=n[0],X=n[1],se=n[2],ae=Z.typedBuffer,fe=Z.typedBufferStride;let ue=0;const Re=ze(p,C,M),De=o?(Math.PI/2-2*Math.atan(Math.exp(-Re/O)))*O:Re*$,Ue=1/k,Je=ze(p*(1-Ue)+_*Ue,C,M);let vt=De,lt=o?(Math.PI/2-2*Math.atan(Math.exp(-Je/O)))*O:Je*$;for(let Ye=1;Ye<=F;Ye++){const ut=Ye/k,ht=ze(p*(1-ut)+_*ut,C,M),Jt=ze(ut,ve,le),Pt=lt,xr=(Ye-1)/k,Ir=ze(p*(1-xr)+_*xr,C,M),Tr=vt,Er=(Ye+1)/k,ei=ze(p*(1-Er)+_*Er,C,M),zi=o?(Math.PI/2-2*Math.atan(Math.exp(-ei/O)))*O:ei*$,Lr=ze(Er,ve,le);vt=lt,lt=zi;const ti=ze(h,w,T);let Ft=ti*$,yt=tn(ti,ht,s);const kt=1/k,jt=ze(kt,Ae,ye),tr=ze(h*(1-jt)+A*jt,w,T);let Or=jt,yi=tr,bi=tr*$,wi=tn(tr,ht,s);if(Ye===1){const _i=bi-q,_s=vt-X,kr=wi-se,ni=0*fe;ae[ni]=_i,ae[ni+1]=_s,ae[ni+2]=kr,Qc(_i,_s,kr,W);const qr=ze(kt,Ae,ye);Vh(J,ue,qr,Jt)}for(let _i=1;_i<=F;_i++){const _s=bi,kr=wi,ni=(_i+1)/k,qr=ze(ni,Ae,ye),An=ze(h*(1-ni)+A*ni,w,T),rs=yi;yi=An;{const yn=ue+1,Vs=yn*fe;if(Ye===1||_i===F){const Ss=An*$,an=tn(An,ht,s);if(Ye===1&&_i<F){const Xi=Ss-q,ea=Pt-X,ya=an-se;ae[Vs]=Xi,ae[Vs+1]=ea,ae[Vs+2]=ya,Qc(Xi,ea,ya,W),Vh(J,yn,qr,Jt)}bi=Ss,wi=an}else bi=ae[Vs]+q,wi=ae[Vs+2]+se}const Us=bi,ss=wi,Ls=Ft,on=yt;Ft=_s,yt=kr;const Ze=(ue-F)*fe,Ko=Ye===1?tn(rs,Ir,s):ae[Ze+2]+se,bo=tn(rs,ei,s);if(Ye<F){const yn=ue+F,Vs=yn*fe,Ss=_s-q,an=zi-X,Xi=bo-se;ae[Vs]=Ss,ae[Vs+1]=an,ae[Vs+2]=Xi,Qc(Ss,an,Xi,W);const ea=Or;Or=qr,Vh(J,yn,ea,Lr)}{const yn=Us-Ls,Vs=Tr-zi,Ss=Vs*(ss-on),an=yn*(Ko-bo),Xi=-Vs*yn,ea=Ss*Ss+an*an+Xi*Xi;if(ea===0)G4(te,ue,0,0,1);else{const ya=1/Math.sqrt(ea);G4(te,ue,Ss*ya,an*ya,Xi*ya)}}++ue}}}function DMt(t,e){t.tile.intersectsClippingArea&&(D5e(t),L5e(t,!0),W7(t))}function NMt(t,e){t.tile.intersectsClippingArea&&($5e(t),W7(t))}function $5e(t,e){t.tile.intersectsClippingArea&&(D5e(t),L5e(t,!1))}function L5e(t,e){const r=t.geometryState,i=r.neighborData,s=t.tile,n=s.surface,o=n.shading||pT,a=s.extent,l=r.clippingArea,c=E(l)?l:Y7,h=a[0],p=a[2],A=a[1],_=a[3],w=[_>c[3],p>c[2],A<c[1],h<c[0]],T=t.geometryInfo,C=s.horizontalScale,M=Coe(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,C),O=T.boundingBox,$=T.uvRange[0],L=T.uvRange[1],k=T.uvRange[2],F=T.uvRange[3],G=Math.max(h,c[0]),z=Math.min(p,c[2]),Z=Math.max(A,c[1]),J=Math.min(_,c[3]),te=t.localOrigin,re=te[0],Ae=te[1],ve=te[2],ye=r.samplerData;for(let le=0;le<4;++le){const W=le===1||le===3,q=i.edgeResolutions[le];it(U0(q));const X=q+1,se=w[le],ae=G2(s,i.edgePeerNeighbors[le]);if(!se&&U5e(s,ae,le)){k5e(t,le,ae);continue}const fe=E(ae)&&!se,ue=ae==null?void 0:ae.renderData,Re=ue==null?void 0:ue.geometryState;if(Xo&&(it(!fe||ae.level===s.level),it(!fe||Ey(s,ae)<=0),s&&!ae&&!n.updatingRootTiles)){const Jt=mg[le],Pt=s.findNeighborTile(Jt,xr=>xr.isLoaded||xr.isLeaf||xr.level===s.level);n.updatingRootTiles||(Pt?Pt.intersectsClippingArea&&(it(!Pt.isLoaded),it(!Pt.isLeaf),it(Pt.level===s.level)):it(N(n==null?void 0:n.rootTiles)||!s.shouldHaveNeighbor(Jt)))}const De=ze(le===1?p:h,G,z),Ue=ze(le===0?_:A,Z,J),Je=Re==null?void 0:Re.samplerData,vt=T.outerEdges[le],lt=e&&X>3?X-3:1,Ye=ze(le===1?1:0,$,k),ut=ze(le===0?1:0,L,F),ht=fe?(Jt,Pt)=>.5*(tn(Jt,Pt,Je)+tn(Jt,Pt,ye)):(Jt,Pt)=>tn(Jt,Pt,ye);if(o){const Jt=(p-h)/q,Pt=W?le===1?Jt:-Jt:0,xr=W?0:le===0?Jt:-Jt,Ir=-Pt,Tr=-xr;let Er=0,ei=0,zi=0;{const yt=0/q,kt=W?De:ze(h*(1-yt)+p*yt,G,z),jt=W?ze(A*(1-yt)+_*yt,Z,J):Ue,tr=ht(kt,jt);Er=kt*C,ei=M(jt),zi=tr}let Lr=0,ti=0,Ft=0;{const yt=1/q,kt=W?De:ze(h*(1-yt)+p*yt,G,z),jt=W?ze(A*(1-yt)+_*yt,Z,J):Ue,tr=ht(kt,jt);Lr=kt*C,ti=M(jt),Ft=tr}for(let yt=1;yt<X-1;yt+=lt){const kt=yt/q,jt=Lr,tr=ti,Or=Ft;{const rs=W?Ye:ze(kt,$,k),Us=W?ze(kt,L,F):ut,ss=jt-re,Ls=tr-Ae,on=Or-ve;Qc(jt,Ls,on,O),vt.setVertexFromValuesRawPositionUV(yt,ss,Ls,on,rs,Us)}{const rs=(yt+1)/q,Us=W?De:ze(h*(1-rs)+p*rs,G,z),ss=W?ze(A*(1-rs)+_*rs,Z,J):Ue,Ls=ht(Us,ss);Lr=Us*C,ti=M(ss),Ft=Ls}const yi=Lr,bi=Ft,wi=Er,_i=ei,_s=zi;Er=jt,ei=tr,zi=Or;let kr=0,ni=0,qr=0;if(W){const rs=ti-tr,Us=bi-Or,ss=_i-tr,Ls=_s-Or,on=ze(A*(1-kt)+_*kt,Z,J),Ze=De+Ir,Ko=Ze*C-jt,bo=tn(Ze,on,ye)-Or,yn=le===3?-1:1;if(kr=yn*(-ss+rs)*bo,ni=yn*Ko*(-Ls+Us),qr=-yn*Ko*(-ss+rs),fe){const Vs=De+Pt,Ss=Vs*C-jt;kr=(-ss+rs)*(bo-(tn(Vs,on,Je)-Or)),ni=(Ko-Ss)*(-Ls+Us),qr=-(Ko-Ss)*(-ss+rs)}}else{const rs=yi-jt,Us=bi-Or,ss=wi-jt,Ls=_s-Or,on=ze(h*(1-kt)+p*kt,G,z),Ze=Ue+Tr,Ko=tn(on,Ze,ye)-Or,bo=M(Ze)-tr,yn=le===2?-1:1;if(kr=yn*bo*(-Ls+Us),ni=yn*(-ss+rs)*Ko,qr=-yn*bo*(-ss+rs),fe){const Vs=on,Ss=Ue+xr,an=M(Ss)-tr;kr=(-bo+an)*(-Ls+Us),ni=(-ss+rs)*(-Ko+(tn(Vs,Ss,Je)-Or)),qr=-(-bo+an)*(-ss+rs)}}const An=1/Math.sqrt(kr*kr+ni*ni+qr*qr);vt.setNormalFromValues(yt,kr*An,ni*An,qr*An)}}else for(let Jt=1;Jt<X-1;Jt+=lt){const Pt=Jt/q,xr=W?De:ze(h*(1-Pt)+p*Pt,G,z),Ir=W?ze(A*(1-Pt)+_*Pt,Z,J):Ue,Tr=W?Ye:ze(Pt,$,k),Er=W?ze(Pt,L,F):ut,ei=ht(xr,Ir),zi=xr*C-re,Lr=M(Ir)-Ae,ti=ei-ve;Qc(zi,Lr,ti,O),vt.setVertexFromValuesRawPositionUV(Jt,zi,Lr,ti,Tr,Er)}}}function D5e(t,e){B5e(t)}function FMt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function kMt(t,e){return t*e}function Coe(t,e,r){return t?i=>FMt(i,e):i=>kMt(i,r)}function N5e(t,e,r,i,s,n){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,i[1])-Math.max(1,i[0]))*(Math.min(e-2,s[1])-Math.max(1,s[0])),c=mg.map(($,L)=>L===0&&s[1]<e-2||L===1&&i[1]<e-2||L===2&&s[0]>1||L===3&&i[0]>1),h=t.outerEdges.reduce(($,L,k)=>$+(c[k]?0:o-2+L.count-1),0),p=r.reduce(($,L)=>$+o*(2*(L.latitudeResolution-1)+1),0),A=n?2:1,_=3*(l+h+p)*A,w=a>=wMt?new Uint32Array(_):new Uint16Array(_);let T=0;const C=e-2,M=o-2;it(M>=0);const O=($,L,k,F,G,z)=>{const Z=$*G,J=z[Z],te=z[Z+1],re=z[Z+2],Ae=L*G,ve=z[Ae],ye=z[Ae+1],le=z[Ae+2],W=k*G,q=z[W],X=z[W+1],se=z[W+2],ae=F*G,fe=z[ae],ue=z[ae+1],Re=z[ae+2];return(ve-fe)*(ve-fe)+(ye-ue)*(ye-ue)+(le-Re)*(le-Re)>(J-q)*(J-q)+(te-X)*(te-X)+(re-se)*(re-se)};if(n){const $=(k,F,G)=>{w[T++]=k,w[T++]=F,w[T++]=F,w[T++]=G,w[T++]=G,w[T++]=k,Xo&&(it(k<a),it(F<a),it(G<a),it(T<=_))};(()=>{for(let k=Math.max(s[0],1)-1;k<Math.min(s[1],e-2)-1;++k){const F=k*C;for(let G=Math.max(i[0],1)-1;G<Math.min(i[1],e-2)-1;++G){const z=k*C+G,Z=z+1,J=Z+C,te=J-1,re=F+G,Ae=re+1,ve=Ae+C,ye=ve-1,le=t.vertexAttributes.position.typedBuffer,W=t.vertexAttributes.position.typedBufferStride;O(re,Ae,ve,ye,W,le)?($(z,Z,J),$(J,te,z)):($(z,Z,te),$(te,J,Z))}}})(),it(T===3*l*A),(()=>{for(let k=0;k<4;++k){const F=T;if(c[k])continue;const G=t.outerEdges[k],z=t.innerEdges[k];let Z=0,J=0;const te=G.count,re=z.count;it(re===o-1);let Ae=0;const ve=k===1||k===2?(ye,le,W)=>$(ye,le,W):(ye,le,W)=>$(ye,W,le);for(;Z<te-1||J<re-1;){const ye=z.getVertexIndex(J),le=G.getVertexIndex(Z),W=Z<te-1,q=J<re-1;W&&(!q||(W?0+o*(Z+.5)/(te-1):0)<=(q?1+M*(J+.5)/(re-1):0))?(++Z,Xo&&it(Z<te),ve(ye,le,G.getVertexIndex(Z)),Ae++):(++J,Xo&&it(J<re),ve(ye,le,z.getVertexIndex(J)),Ae++)}Xo&&(it(Z===te-1),it(J===re-1),it(Ae===te+re-2),it(Ae===o-2+G.count-1),it(T===F+3*Ae*A))}})(),it(T===3*(l+h)*A);const L=k=>{const F=t.outerEdges[k.connectedOuterEdgeOffset];let G=F.getVertexIndex(0),z=F.stride;for(let Z=0;Z<k.latitudeResolution;++Z){const J=Z===0?k.rowOffset:G+e;for(let te=0;te<o;te++)$(G,G+1,J+te),Z<k.latitudeResolution-1&&$(G+1,J+te+1,J+te),G+=z;G=J,z=1}};r.forEach(L)}else{(()=>{const L=Math.max(s[0],1)-1,k=Math.min(s[1],e-2)-1,F=Math.max(i[0],1)-1,G=Math.min(i[1],e-2)-1;for(let z=L;z<k;++z){const Z=z*C;for(let J=F;J<G;++J){const te=Z+J,re=te+1,Ae=re+C,ve=Ae-1,ye=t.vertexAttributes.position.typedBuffer,le=t.vertexAttributes.position.typedBufferStride;O(te,re,Ae,ve,le,ye)?(w[T]=te,w[T+1]=re,w[T+2]=Ae,w[T+3]=Ae,w[T+4]=ve,w[T+5]=te):(w[T]=te,w[T+1]=re,w[T+2]=ve,w[T+3]=ve,w[T+4]=re,w[T+5]=Ae),T+=6}}})(),it(T===3*l*A),(()=>{for(let L=0;L<4;++L){if(c[L])continue;const k=t.outerEdges[L],F=t.innerEdges[L];let G=0,z=0;const Z=k.count,J=F.count;it(J===o-1);const te=L===1||L===2,re=te?1:2,Ae=te?2:1,ve=k.index0,ye=k.stride,le=F.index0,W=F.stride;for(;G<Z-1||z<J-1;){const q=le+z*W,X=ve+G*ye,se=G<Z-1,ae=z<J-1,fe=se&&(!ae||(se?0+o*(G+.5)/(Z-1):0)<=(ae?1+M*(z+.5)/(J-1):0));fe?++G:++z;const ue=fe?X+ye:q+W;w[T]=q,w[T+re]=X,w[T+Ae]=ue,T+=3}}})(),it(T===3*(l+h)*A);const $=L=>{const k=t.outerEdges[L.connectedOuterEdgeOffset];let F=k.getVertexIndex(0),G=k.stride;for(let z=0;z<L.latitudeResolution;++z){const Z=z===0?L.rowOffset:F+e;for(let J=0;J<o;J++){const te=Z+J;w[T]=F,w[T+1]=F+1,w[T+2]=te,z<L.latitudeResolution-1?(w[T+3]=F+1,w[T+4]=te+1,w[T+5]=te,T+=6):T+=3,F+=G}F=Z,G=1}};r.forEach($)}it(T===_),t.indices=w,t.indexCount=_}function F5e(t,e){const r=t.localOrigin,i=t.geometryInfo,s=t.geometryState.neighborData.edgeResolutions,n=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);i.innerEdges[l]=new LAe(o,r,h,p,n)}{const c=a,h=s[l]+1;i.outerEdges[l]=new LAe(o,r,c,1,h),a+=h}}}function k5e(t,e,r){const i=(e+2)%4,s=t.geometryState,n=t.tile,o=s.neighborData,a=n.level-r.level,l=e===1||e===3,c=o.edgeResolutions[e];it(U0(c));const h=c+1,p=t.geometryInfo,A=p.boundingBox,_=p.outerEdges[e],w=p.uvRange[0],T=p.uvRange[1],C=p.uvRange[2],M=p.uvRange[3],O=ze(e===1?1:0,w,C),$=ze(e===0?1:0,T,M),L=r.renderData,k=L.geometryState,F=L.geometryInfo.outerEdges[i],G=n.getNeighborEdgeStartVertexIndex(e,r)*c,z=c*2**a;it(k.neighborData.edgeResolutions[i]===z),it(F.count-1===z);const Z=L.localOrigin[0]-t.localOrigin[0],J=L.localOrigin[1]-t.localOrigin[1],te=L.localOrigin[2]-t.localOrigin[2],re=_.attributes,Ae=_.index0,ve=_.stride,ye=re.position.typedBuffer,le=re.position.typedBufferStride,W=re.normalCompressed.typedBuffer,q=re.normalCompressed.typedBufferStride,X=re.uv0,se=F.attributes,ae=F.index0,fe=F.stride,ue=se.position.typedBuffer,Re=se.position.typedBufferStride,De=se.normalCompressed.typedBuffer,Ue=se.normalCompressed.typedBufferStride;for(let Je=1;Je<h-1;++Je){const vt=Ae+ve*Je,lt=ae+fe*(G+Je),Ye=vt*le,ut=lt*Re,ht=ue[ut]+Z,Jt=ue[ut+1]+J,Pt=ue[ut+2]+te;ye[Ye]=ht,ye[Ye+1]=Jt,ye[Ye+2]=Pt,Qc(ht,Jt,Pt,A);const xr=vt*q,Ir=lt*Ue;W[xr]=De[Ir],W[xr+1]=De[Ir+1];const Tr=Je/c,Er=l?O:ze(Tr,w,C),ei=l?ze(Tr,T,M):$;Vh(X,vt,Er,ei)}}function B5e(t){var ut;const e=t.geometryState,r=e.neighborData,i=t.localOrigin,s=r.cornerNeighborData,n=t.geometryInfo,o=n.outerEdges,a=n.boundingBox,l=t.tile,c=((ut=t.tile.surface.view)==null?void 0:ut.viewingMode)==="local",h=l.ellipsoid.radius,p=l.extentInRadians,A=l.horizontalScale;let _=0,w=0,T=0;const C=(ht,Jt,Pt)=>{const xr=p[Jt===0?1:3],Ir=p[ht===0?0:2],Tr=Math.cos(xr),Er=Math.sin(xr),ei=Math.sin(Ir),zi=Math.cos(Ir),Lr=h+Pt;_=zi*Tr*Lr,w=ei*Tr*Lr,T=Er*Lr},M=c?(()=>{const ht=t.geometryState.clippingArea,Jt=l.extent,Pt=E(ht)&&(Jt[3]>ht[3]||Jt[2]>ht[2]||Jt[1]<ht[1]||Jt[0]<ht[0]),xr=Coe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,A);return(Ir,Tr,Er)=>{const ei=Ir===0?Ae[0]:Ae[2],zi=Tr===0?Ae[1]:Ae[3],Lr=Pt?ze(ei,ht[0],ht[2]):ei,ti=Pt?ze(zi,ht[1],ht[3]):zi,Ft=Er;_=Lr*A,w=xr(ti),T=Ft}})():C;let O=0,$=0,L=0,k=0,F=0,G=0,z=0,Z=0,J=0;const te=c&&t.tile.surface.isWebMercatorOnPlateeCarree,re=(ht,Jt,Pt,xr,Ir)=>{let Tr=0,Er=0,ei=0;if(c){const zi=Jt*A,Lr=te?(Math.PI/2-2*Math.atan(Math.exp(-Pt/h)))*h:Pt*A;Tr=zi-_,Er=Lr-w,ei=xr-T}else{const zi=Eoe(ht),Lr=ht.tile,ti=Lr.extent,Ft=Lr.extentInRadians,yt=(Jt-ti[0])/(ti[2]-ti[0]),kt=(Pt-ti[1])/(ti[3]-ti[1]),jt=Ft[0]*(1-yt)+Ft[2]*yt,tr=zi(kt),Or=Math.cos(tr),yi=Math.sin(tr),bi=Math.sin(jt),wi=Math.cos(jt),_i=h+xr;Tr=wi*Or*_i-_,Er=bi*Or*_i-w,ei=yi*_i-T}switch(Ir){case 0:z+=Tr,Z+=Er,J+=ei;break;case 1:k-=Tr,F-=Er,G-=ei;break;case 2:z-=Tr,Z-=Er,J-=ei;break;case 3:k+=Tr,F+=Er,G+=ei}},Ae=l.extent,ve=e.clippingArea,ye=E(ve)?ve:Y7,le=Ae[0],W=Ae[2],q=Ae[1],X=Ae[3],se=[X>ye[3],W>ye[2],q<ye[1],le<ye[0]],ae=Math.max(le,ye[0]),fe=Math.min(W,ye[2]),ue=Math.max(q,ye[1]),Re=Math.min(X,ye[3]),De=n.uvRange[0],Ue=n.uvRange[1],Je=n.uvRange[2],vt=n.uvRange[3],lt=l.surface.shading||pT,Ye=ht=>{var ti;const Jt=s[ht].cornerTiles;O=0,$=0,L=1;let Pt=1/0;for(let Ft=0;Ft<4;++Ft)Pt=Math.min(Pt,((ti=Jt[Ft])==null?void 0:ti.level)??1/0);for(let Ft=0;Ft<4;++Ft){const yt=Jt[Ft];TO[Ft]=(yt==null?void 0:yt.level)===Pt?yt:null}let xr=1,Ir=0;for(let Ft=0;Ft<4;++Ft){const yt=TO[Ft];yt&&(xr=Math.max(xr,yt==null?void 0:yt.renderData.geometryState.numVerticesPerSide),Ir=yt.extent[2]-yt.extent[0])}const Tr=Ir,Er=xr;it(Er>1);const ei=Tr/Er;for(let Ft=0;Ft<4;++Ft){const yt=TO[(Ft+3)%4],kt=TO[Ft%4];if(!yt&&!kt)continue;const jt=Ft===0?1:Ft===1?2:Ft===2?3:0,tr=Ft===0?2:Ft===1?3:Ft===2?0:1;if(yt&&kt){const Or=EH[Ft][0]*ei,yi=EH[Ft][1]*ei,bi=yt.extent,wi=bi[jt===0||jt===1?2:0]+Or,_i=bi[jt===0||jt===3?3:1]+yi,_s=kt.extent,kr=_s[tr===0||tr===1?2:0]+Or,ni=_s[tr===0||tr===3?3:1]+yi,qr=yt.renderData,An=kt.renderData,rs=tn(wi,_i,qr.geometryState.samplerData),Us=tn(kr,ni,An.geometryState.samplerData);re(qr,wi,_i,.5*(rs+Us),Ft)}else{const Or=yt??kt,yi=yt?jt:tr,bi=Or.extent,wi=EH[Ft],_i=bi[yi===0||yi===1?2:0]+wi[0]*ei,_s=bi[yi===0||yi===3?3:1]+wi[1]*ei,kr=Or.renderData,ni=tn(_i,_s,kr.geometryState.samplerData);re(kr,_i,_s,ni,Ft)}}if(!c){const Ft=Math.sqrt(_*_+w*w+T*T);O=_/Ft,$=w/Ft,L=T/Ft}const zi=Math.sqrt(k*k+F*F+G*G);k/=zi,F/=zi,G/=zi;const Lr=Math.sqrt(z*z+Z*Z+J*J);if(z/=Lr,Z/=Lr,J/=Lr,c||L*L<.999){O=G*Z-F*J,$=k*J-G*z,L=F*z-k*Z;const Ft=1/Math.sqrt(O*O+$*$+L*L);O*=Ft,$*=Ft,L*=Ft}};for(let ht=0;ht<4;++ht){const Jt=ht,Pt=(ht+1)%4,xr=ht===0||ht===1?1:0,Ir=ht===0||ht===3?1:0,Tr=ze(xr,De,Je),Er=ze(Ir,Ue,vt),ei=o[Jt],zi=ht===0||ht===3?ei.count-1:0,Lr=o[Pt],ti=ht===0||ht===1?Lr.count-1:0,Ft=s[ht].cornerTiles;let yt=-1;for(let tr=0;tr<4;++tr){const Or=Ft[tr];Or&&(yt===-1||Ey(Ft[yt],Or)>0)&&(yt=tr)}const kt=yt,jt=Ft[kt];if(O=0,$=0,L=1,jt!==l){const tr=l.level-jt.level,Or=2**tr,yi=[jt.lij[0]+tr,jt.lij[1]*Or,jt.lij[2]*Or],bi=[yi[1]+Or===l.lij[1],ht===0&&(kt===1||kt===0&&jt!==Ft[3])||ht===1&&(kt===0||kt===1&&jt!==Ft[2]),yi[1]===l.lij[1]+1,ht===2&&(kt===3||kt===2&&jt!==Ft[1])||ht===3&&(kt===2||kt===3&&jt!==Ft[0])],wi=bi.reduce((qr,An)=>qr+(An?1:0),0);it(wi===1||wi===2);let _i=-1,_s=-1;const kr=jt.renderData;if(wi===1){const qr=bi.findIndex(rs=>rs);it(0<=qr&&qr<=3),_i=(qr+2)%4;const An=t.geometryState.neighborData.edgeResolutions[qr];_s=l.getNeighborEdgeStartVertexIndex(qr,jt)*An+An*(qr===0&&ht===0||qr===1&&ht===0||qr===2&&ht===1||qr===3&&ht===3?1:0)}else{it(bi[1]||bi[3]),_i=bi[1]?3:1;const qr=kr.geometryState.neighborData.edgeResolutions[_i];_s=ht===0||ht===3?0:qr}const ni=kr.geometryInfo.outerEdges[_i];{const qr=ei.index0+zi*ei.stride,An=Lr.index0+ti*Lr.stride,rs=ni.index0+_s*ni.stride;{const Us=ni.attributes.position,ss=Us.typedBuffer,Ls=rs*Us.typedBufferStride,on=t.localOrigin,Ze=ni.localOrigin,Ko=ss[Ls]+Ze[0]-on[0],bo=ss[Ls+1]+Ze[1]-on[1],yn=ss[Ls+2]+Ze[2]-on[2];Qc(Ko,bo,yn,a);{const Vs=ei.attributes.position,Ss=Vs.typedBuffer,an=qr*Vs.typedBufferStride;Ss[an]=Ko,Ss[an+1]=bo,Ss[an+2]=yn}{const Vs=Lr.attributes.position,Ss=Vs.typedBuffer,an=An*Vs.typedBufferStride;Ss[an]=Ko,Ss[an+1]=bo,Ss[an+2]=yn}}Vh(ei.attributes.uv0,qr,Tr,Er),Vh(Lr.attributes.uv0,An,Tr,Er);{const Us=ni.attributes.normalCompressed.typedBuffer,ss=rs*ni.attributes.normalCompressed.typedBufferStride;{const Ls=ei.attributes.normalCompressed,on=Ls.typedBuffer,Ze=qr*Ls.typedBufferStride;on[Ze]=Us[ss],on[Ze+1]=Us[ss+1]}{const Ls=Lr.attributes.normalCompressed,on=Ls.typedBuffer,Ze=An*Ls.typedBufferStride;on[Ze]=Us[ss],on[Ze+1]=Us[ss+1]}}}}else{const tr=se[Jt],Or=se[Pt];let yi;if(tr||Or){const _s=ze(le*(1-xr)+W*xr,ae,fe),kr=ze(q*(1-Ir)+X*Ir,ue,Re),ni=e.samplerData;yi=tn(_s,kr,ni)}else yi=BMt(Ft);M(xr,Ir,yi),(lt||pT)&&Ye(ht);const bi=_-i[0],wi=w-i[1],_i=T-i[2];Qc(bi,wi,_i,a),ei.setVertexFromValuesRawPositionUVNormal(zi,bi,wi,_i,Tr,Er,O,$,L),Lr.setVertexFromValuesRawPositionUVNormal(ti,bi,wi,_i,Tr,Er,O,$,L)}}for(let ht=0;ht<4;++ht)TO[ht]=null}function BMt(t){var n,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);Xo&&(it(!t[0]||!t[2]||$K(t[0],t[2],dr.SOUTH_WEST)),it(!t[1]||!t[3]||$K(t[1],t[3],dr.NORTH_WEST)));let r=0,i=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,h=a===0||a===3,p=l.extent,A=p[c?0:2],_=p[h?1:3],w=(o=(n=l.renderData)==null?void 0:n.geometryState)==null?void 0:o.samplerData;i+=tn(A,_,w),r++}}const s=r?i/r:0;return it(s!=null),s}function W7(t){const e=t.vao,r=t.geometryInfo.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const EH=[[0,1],[1,0],[0,-1],[-1,0]],To=new b3t,Y7=pre(-1/0,-1/0,1/0,1/0),TO=[null,null,null,null];function U5e(t,e,r){if(!e)return!1;const i=Ey(t,e);return i>0||i===0&&r>=2}const pT=!0;let UMt=class extends woe{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=si(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=i.view.renderSpatialReference,n=i.spatialReference,o=E(s)&&Ete(s)&&E(n)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const h=ct(c[0],c[1],0);Ba(h,xt.WebMercator,h,xt.PlateCarree);const p=ct(c[2],c[3],0);Ba(p,xt.WebMercator,p,xt.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[yo.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],s=r[1],n=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let h=0;h<6;h++){const p=e[h],A=p[0],_=p[1],w=p[2],T=p[3];if(A*(A>0?i:o)+_*(_>0?s:a)+w*(w>0?n:l)+T>=0)return Ql.OUTSIDE;c=c&&A*(A<0?i:o)+_*(_<0?s:a)+w*(w<0?n:l)+T<=0}return c?Ql.INSIDE:Ql.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return eHe(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,r,i,s){return tF[0]=1/r[0],tF[1]=1/r[1],tF[2]=1/r[2],xne(this._aabb(),e,tF,i,s)}createGeometry(){PMt(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){DMt(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){NMt(this.renderData,this._horizontalScaleFactor)}};const tF=V();let VMt=class{constructor(){this.extent=Zr(),this.minLevel=0,this.maxLevel=0,this.callback=null}},v8=class extends Ke{constructor(){super(...arguments),this._queries=new Vr({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Vr({initialSize:30}),this._queryPool=new al(VMt)}queryVisibleLevelRange(e,r,i,s){const n=this._queryPool.acquire();A0(n.extent,e),n.minLevel=r??-Number.MAX_VALUE,n.maxLevel=i??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const s=this._queries.data[i],n=s.extent;r>=s.minLevel&&r<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};u([d()],v8.prototype,"updating",null),v8=u([j("esri.views.3d.terrain.ScaleRangeQueries")],v8);let zMt=class extends woe{get convexHull(){return this._convexHull}constructor(e,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=Io(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],h=Sr(o,l,.5),p=Sr(n,a,.5),A=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(A)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),eWe(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const _=Iu(this.centerAtSeaLevel);qe(_,_),this.up=_,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)$e(e[yo.MIDDLE],0,0,0),$e(e[yo.TOP],0,0,0),$e(e[yo.BOTTOM],0,0,0),e[yo.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=e[yo.MIDDLE],i=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,GMt(r,i,3*n));e[yo.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!xv(e,this._boundingSphere))return Ql.OUTSIDE;if(this.lij[0]<10)return Ql.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<ab.NUM;n++){const o=n===Ms.NEAR,a=e[n],l=a[0],c=a[1],h=a[2],p=a[3]-(o?i:0);let A=!1;for(let _=0;_<8;++_){const w=3*_;if(l*r[w+0]+c*r[w+1]+h*r[w+2]+p<0){if(A=!0,!s)break}else s=!1}if(!A)return Ql.OUTSIDE}return s?Ql.INSIDE:Ql.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){xMt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Xo&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBounds,s=this.ellipsoid.radius,n=i[1];if(this.level===0)$e(r,0,0,0),e[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];xw(XAe,a,l,s),xw(ZAe,a,c,s),ke(r,XAe,ZAe);const h=.5*(i[0]+i[1]);Me(r,r,(s+h)/gh(r));const p=this.convexHull;let A=0;const _=(T,C)=>{const M=T[0]-p[3*C+0],O=T[1]-p[3*C+1],$=T[2]-p[3*C+2];return Math.sqrt(M*M+O*O+$*$)};for(let T=0;T<8;++T){const C=_(r,T);A=Math.max(A,C)}const w=A;e[3]=w+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===kp.HAS_NORTH_POLE,a=n&&s===kp.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=e[0],p=e[2],A=a?-c:e[1],_=o?c:e[3],w=.5*(h+p),T=i[0],C=r+(l?Math.min(0,T-1):T),M=(le,W,q)=>xw(le,W,q,C),O=V(),$=V(),L=V(),k=V();M(O,h,A),M($,h,_),M(L,p,_),M(k,p,A);const F=(le,W)=>{for(let q=0;q<3;++q)this._convexHull[3*W+q]=le[q]};F(O,0),F($,1),F(L,2),F(k,3);const G=i[1],z=r+(l?Math.max(0,G+1):G),Z=V(),J=V(),te=V();xw(J,w,_,C),xw(te,w,A,C),ke(Z,J,te),qe(Z,Z);const re=V(),Ae=V(),ve=(le,W)=>{Da(Ae,le,W),qe(Ae,Ae);const q=-He(le,re)/He(Ae,re);it(q>=0),Me(Ae,Ae,q),ke(le,le,Ae)};if(2**this.lij[0]>2*this.lij[1]){const le=te,W=V();Xt(W,QAe,le),qe(W,W),Xt(re,le,W),qe(re,re),it(Bp(He(re,le)/gh(le),0)),ve(O,$),ve(k,L),F(O,0),F(k,3)}else if(2**this.lij[0]!==2*this.lij[1]){const le=J,W=V();Xt(W,QAe,le),qe(W,W),Xt(re,W,le),qe(re,re),ve($,O),ve(L,k),F($,1),F(L,2)}const ye=(le,W)=>{const q=z/He(W,Z);for(let X=0;X<3;++X)this._convexHull[3*le+X]=W[X]*q};ye(4,O),ye(5,$),ye(6,L),ye(7,k)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?kp.HAS_BOTH_POLES:kp.HAS_NORTH_POLE:i?kp.HAS_SOUTH_POLE:kp.REGULAR}intersectsRay(e,r,i,s){const n=this._boundingSphere,o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-e[0],c=n[1]-e[1],h=n[2]-e[2],p=(l*r[0]+c*r[1]+h*r[2])/a,A=r[0]*p-l,_=r[1]*p-c,w=r[2]*p-h;return A*A+_*_+w*w<o*o}getDefaultVerticesPerSide(){return this.level<YAe.length?YAe[this.level]+1:2}updateCornerElevations(){MMt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){CMt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var Re;if(!Xo||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,s=V(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,h=this._center[yo.MIDDLE][3],p=this.convexHull,A=(De,Ue)=>{for(let Je=0;Je<3;++Je)De[Je]=p[3*Ue+Je]};{const De=V(),Ue=V(),Je=V(),vt=V(),lt=V(),Ye=(ut,ht,Jt,Pt)=>{A(Ue,ut),A(Je,ht),A(vt,Jt),Da(Ue,Ue,Je),Da(vt,vt,Je),Xt(De,Ue,vt),qe(De,De);const xr=He(De,Je);A(lt,Pt);const Ir=He(De,lt),Tr=Math.abs(Ir-xr);it(Bp(Tr,0),`Non coplanar ${ut},${ht},${Jt},${Pt} diff = ${Tr}`)};Ye(0,1,2,3),Ye(4,5,6,7),Ye(0,1,4,5),Ye(1,2,5,6),Ye(2,3,6,7),Ye(3,0,7,4)}const _=jh(24),w=(De,Ue,Je)=>{const vt=4*De;for(let lt=0;lt<3;++lt)_[vt+lt]=Ue[lt];_[vt+3]=Je},T=V(),C=V(),M=V(),O=V(),$=(De,Ue,Je,vt)=>{A(T,Ue),A(C,Je),A(M,vt),Da(T,T,C),qe(T,T),Da(M,M,C),qe(M,M),Xt(O,T,M),qe(O,O);const lt=He(O,C);w(De,O,lt)};$(0,0,1,2),$(1,1,0,4),$(2,1,5,2),$(3,3,2,6),$(4,4,0,3),$(5,4,6,5);const L=1,k=(De,Ue,Je,vt)=>{const lt=4*De;return _[lt+0]*Ue+_[lt+1]*Je+_[lt+2]*vt-_[lt+3]},F=(De,Ue,Je,vt)=>k(De,Ue,Je,vt)>=-L,G=(De,Ue)=>F(De,Ue[0],Ue[1],Ue[2]),z=2**this.lij[0]>2*this.lij[1],Z=(De,Ue,Je)=>Math.sqrt(V5e(De,Ue,Je,i[0],i[1],i[2]))<r,J=De=>Z(De[0],De[1],De[2]),te=(De,Ue)=>Z(De[Ue+0],De[Ue+1],De[Ue+2]),re=this.extentInRadians,Ae=.5*(re[0]+re[2]),ve=re[1],ye=re[3],le=V(),W=V();xw(le,Ae,ye,a),xw(W,Ae,ve,a);const q=z?"Upper":"Lower";let X=!0;for(let De=0;De<6;++De){for(let Ue=0;Ue<8;++Ue){const Je=3*Ue,vt=F(De,p[Je+0],p[Je+1],p[Je+2]);X&&(X=vt),it(vt,`Tile[${this.lij}] Convex hull point ${Ue} outside of plane ${De}`)}it(G(De,W),`Tile[${this.lij}] (${q}) bottom mid outside of plane ${De}`),it(G(De,le),`Tile[${this.lij}] (${q}) top mid outside of plane ${De}`)}it(X,"Not all convex hull points are inside  convex hull polyhedron"),it(J(W),`Tile[${this.lij}] (${q}) bottom mid outside of bounding sphere`),it(J(le),`Tile[${this.lij}] (${q}) top mid outside of bounding sphere`);for(let De=0;De<8;++De){const Ue=te(p,3*De);it(Ue,`Tile[${this.lij}] Convex hull point ${De} outside of bounding sphere`)}for(let De=0;De<6;++De)for(let Ue=0;Ue<8;++Ue){const Je=3*Ue;F(De,p[Je+0],p[Je+1],p[Je+2])||console.error(`Tile[${this.lij}] Convex hull point ${Ue} outside of plane ${De}`)}const se=this.extentInRadians,ae=Math.max(se[2]-se[0],se[3]-se[1]),fe=Math.round(ae*n),ue=this.renderData;if(ue){const De=ue.geometryInfo,Ue=ue.localOrigin,Je=(Re=De.vertexAttributes)==null?void 0:Re.position;if(!Je)return;const vt=Je.count,lt=V(),Ye=De.numVerticesPerSide-2,ut=Ye*Ye,ht=ue.geometryState.neighborData,Jt=ht.edgeResolutions.reduce((Pt,xr)=>Pt+xr+1,0);for(let Pt=0;Pt<vt;++Pt){const xr=Pt<ut,Ir=!xr&&Pt<ut+Jt;let Tr=!1,Er=-1;if(Ir){let kr=ut;for(let ni=0;ni<4;++ni){const qr=ht.edgeResolutions[ni];if(Pt===kr||Pt===kr+qr-1){Tr=!0;break}if(kr+=qr,Pt<kr){Er=ni;break}}}const ei=Er,zi=Tr,Lr=Ir&&!zi,ti=Ir?ht.edgePeerNeighbors[ei]:null,Ft=Ir&&ti&&Ey(this,ti)>0,yt=xr?"internal":Lr?"edge":zi?"corner":"pole";Je.getVec(Pt,s),ke(lt,s,Ue);const kt=gh(lt)-n;let jt=0,tr=!1;const Or=o[0]-kt,yi=kt-o[1],bi=Or>l,wi=yi>l,_i=bi||wi,_s=`Tile[${this.lij}].vertex[${Pt}]:${yt}`+(bi?"(below)":wi?"(above)":"")+(Ft?"(Neighbor)":"");{const kr=hL(lt,i);if(kr>=r+c){const ni=kr-r;_i||(console.error(`${_s} is out of the bounding sphere by ${ni.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${kt.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(ni/r).toFixed(0)})`),tr=!0)}}for(let kr=0;kr<6;++kr)if(!F(kr,lt[0],lt[1],lt[2])){const ni=k(kr,lt[0],lt[1],lt[2]),qr=Pt%Ye,An=(Pt-qr)/Ye;kr===0&&Or||kr===5&&yi||(console.error(`${_s} (${qr},${An})|${Ye}] is out of the bounding trapezoid plane ${kr} h=${Math.round(kt)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(ni)} radii = ${Math.round(r)}/${Math.round(h)}} : maxL = ${fe}`),++jt)}if(tr||jt>0)break}}}};const YAe=[128,64,64,32,16,8,8,4];function GMt(t,e,r){return V5e(t[0],t[1],t[2],e[r+0],e[r+1],e[r+2])}function V5e(t,e,r,i,s,n){const o=i-t,a=s-e,l=n-r;return o*o+a*a+l*l}const xw=(t,e,r,i)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*s,t[1]=i*o*n,t[2]=i*a},QAe=[0,0,1],XAe=V(),ZAe=V();let jMt=class{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}},z5e=class extends fc{constructor(){super(...arguments),this.blendMode=pt.Normal}};u([ie({count:pt.COUNT})],z5e.prototype,"blendMode",void 0);let IC=class extends z5e{constructor(){super(...arguments),this.output=ca.Composite,this.baseOpacityMode=C0.NotRequired,this.premultipliedSource=c0.Off,this.hasWebGL2Context=!1}};u([ie({count:ca.COUNT})],IC.prototype,"output",void 0),u([ie({count:C0.COUNT})],IC.prototype,"baseOpacityMode",void 0),u([ie()],IC.prototype,"premultipliedSource",void 0),u([ie()],IC.prototype,"hasWebGL2Context",void 0);var fT;function HMt(t){const e=new Di;if(e.include(w5e),t.background===fT.Only){const r=t.output===ca.ColorComposite;return r?e.fragment.uniforms.add(new Fr("backgroundColor",i=>i.backgroundColor)):(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(boe)),e.fragment.code.add(I`
    void main() {
      gl_FragColor = vec4(${r?I`backgroundColor`:I`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(x5e,t),e.fragment.uniforms.add(new mr("tex",r=>r.texture)),e.fragment.uniforms.add(new nt("opacity",r=>r.opacity)),e.fragment.code.add(I`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(fT||(fT={}));const qMt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return fT},build:HMt},Symbol.toStringTag,{value:"Module"}));let WMt=class extends b5e{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=sc}},G5e=class j5e extends Vi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2}initializeProgram(e){return new Fi(e.rctx,j5e.shader.get().build(this.configuration),Pi)}initializePipeline(){return Rr({blending:X0(tt.ONE,tt.ONE_MINUS_SRC_ALPHA),colorWrite:zr})}};G5e.shader=new Ni(qMt,()=>be(()=>import("./BlendLayers.glsl-f5f20fcf.js"),[]));let H5e=class extends IC{constructor(){super(...arguments),this.background=fT.BelowLayer}};u([ie()],H5e.prototype,"background",void 0);let CH=class{constructor(e,r,i,s,n,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=Nr(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=ct(s,n,o)}destroy(){this.texture.release()}};function b8(){return[1,0,0,1,0,0]}function YMt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function QMt(t,e,r,i,s,n){return[t,e,r,i,s,n]}function XMt(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:YMt,create:b8,createView:XMt,fromValues:QMt},Symbol.toStringTag,{value:"Module"}));function ZMt(t){return t instanceof Float32Array&&t.length>=2}function JMt(t){return Array.isArray(t)&&t.length>=2}function MH(t){return ZMt(t)||JMt(t)}const KMt=96,eRt=39.37;function Moe(t,e){return e.type?Kr(t,e.x,e.y):ga(t,e)}function tRt(t){return tu(t)}function rRt(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const iRt=function(){const t=Dt();return function(e,r,i){const s=r.targetGeometry;Moe(t,s);const n=.5*Q7(r);return e.xmin=t[0]-n*i[0],e.ymin=t[1]-n*i[1],e.xmax=t[0]+n*i[0],e.ymax=t[1]+n*i[1],e.spatialReference=s.spatialReference,e}}();function Q7(t){return t.scale*sRt(t.targetGeometry)}function sRt(t){return E(t)&&tc(t.spatialReference)?1/(tRt(t.spatialReference)*eRt*KMt):1}function nRt(t){return qB(t.rotation)||0}const Roe=function(){const t=Dt(),e=Dt(),r=Dt();return function(i,s,n,o,a,l){return cse(t,s),Ch(e,n,.5*l),Kr(r,1/o*l,-1/o*l),ise(i,e),a&&tse(i,i,a),fRe(i,i,r),rse(i,i,t),i}}(),oRt=function(){const t=Dt();return function(e,r,i,s){const n=Q7(r),o=nRt(r);return Moe(t,r.targetGeometry),Roe(e,t,i,n,o,s)}}(),aRt=function(){const t=Dt();return function(e,r,i,s){const n=Q7(r);return Moe(t,r.targetGeometry),Roe(e,t,i,n,0,s)}}();function lRt(t){const e=Dv(t);return e?e.valid[1]-e.valid[0]:0}function cRt(t,e){return Math.round(lRt(t)/e)}var DK;const _A=[0,0];let L1=DK=class extends Qe{constructor(t){super(t),this._viewpoint2D={center:Dt(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Ki,this.id=0,this.inverseTransform=b8(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=b8(),this.transformNoRotation=b8(),this.displayMat3=Uu(),this.displayViewMat3=Uu(),this.viewMat3=Uu(),this.viewMat2d=uRe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=rRt(r,t.viewpoint),this._set("size",ga(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new DK({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return MH(e)?d2(t,e,this.inverseTransform):(_A[0]=e,_A[1]=r,d2(t,_A,this.inverseTransform))}toScreen(t,e,r){return MH(e)?d2(t,e,this.transform):(_A[0]=e,_A[1]=r,d2(t,_A,this.transform))}toScreenNoRotation(t,e,r){return MH(e)?d2(t,e,this.transformNoRotation):(_A[0]=e,_A[1]=r,d2(t,_A,this.transformNoRotation))}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return Roe(t,r,s,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new z0({targetGeometry:new Gt(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!e||!r)return;this.resolution=Q7(o),this.rotation=i,this.scale=r,this.spatialReference=e,ga(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;wse(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=xse(this.viewMat3),h=Fp(n[0]/2,n[1]/2),p=Fp(-n[0]/2,-n[1]/2),A=qB(i);g9(c,c,h),Tse(c,c,A),g9(c,c,p),oM(this.displayViewMat3,this.displayMat3,c);const _=ise(this.viewMat2d,h);return tse(_,_,A),rse(_,_,p),iRt(this.extent,o,n),oRt(this.transform,o,n,s),dRe(this.inverseTransform,this.transform),aRt(this.transformNoRotation,o,n,s),this.worldScreenWidth=cRt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],L1.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],L1.prototype,"pixelRatio",null),u([d({json:{write:!0}})],L1.prototype,"size",null),u([d()],L1.prototype,"spatialReference",void 0),u([d({type:z0,json:{write:!0}})],L1.prototype,"viewpoint",null),L1=DK=u([j("esri.views.2d.ViewState")],L1);const uRt=L1,hRt=.125;let dRt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new uRt({viewpoint:new z0({targetGeometry:new Gt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,r,i,s,n,o,a,l,c,h){const p=o.adjustLevel(r[0]),A=this._renderParams;A.context=e,A.painter=s,A.glyphMosaic=s.glyphMosaic,A.spriteMosaic=s.spriteMosaic,A.pixelRatio=h,A.displayLevel=p,A.requiredLevel=p;const _=o.getScale(r[0]),[w,T]=o.getShift(r,a*_),C=hRt*a*_/c,M=i.transforms.dvs;M[0]=C,M[4]=-C,M[6]=-1-w-l[0]*a*2,M[7]=1+T+(1-l[1])*a*2-2,A.state.size[0]=c,A.state.size[1]=c,i.stage||i.attachWithContext(e),i.triangleCount=0,s.drawTile(A,i,n)}},q5e=class W5e extends Vi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2}initializeProgram(e){return new Fi(e.rctx,W5e.shader.get().build(this.configuration),Pi)}initializePipeline(){return Rr({blending:X0(tt.ONE,tt.ONE_MINUS_SRC_ALPHA),colorWrite:zr})}};q5e.shader=new Ni(H3t,()=>be(()=>import("./RasterColorizer.glsl-48f7223b.js"),[]));let w8=class extends IC{constructor(){super(...arguments),this.colorizerType=Sx.Stretch,this.stretchType=dT.Noop,this.applyColormap=!0}};u([ie({count:Sx.COUNT})],w8.prototype,"colorizerType",void 0),u([ie({count:dT.COUNT})],w8.prototype,"stretchType",void 0),u([ie()],w8.prototype,"applyColormap",void 0);let JAe=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new Jn(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:$i.DEPTH_RENDER_BUFFER,width:e,height:e});return this._fbos.set(e,i),i}};const pRt=we.getLogger("esri.views.3d.terrain");let fRt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new dRt,this._bindParameters=new t7(null,null,null),this._blendLayersTechniqueConfig=new H5e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=mc(this._rctx,QM)}dispose(){this._fbos.forEach(Nt),this._fbos=null,this._vtFBO=Nt(this._vtFBO),this._vaoQuad=Nt(this._vaoQuad),this._vectorTileHelper=Nt(this._vectorTileHelper),this._backgroundTechnique=en(this._backgroundTechnique),this._applyOpacityTechnique=en(this._applyOpacityTechnique),this._blendLayersTechnique=en(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,s=c0.Off,n=fT.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(G5e,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(pt.Normal,r?ca.ColorComposite:ca.GridComposite,C0.NotRequired,c0.Off,fT.Only),s=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Ar.TRIANGLE_STRIP,0,Ol(this._vaoQuad,"geometry"))}drawGroup(e,r,i,s,n,o=c0.On){r===ca.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,r,i,s,n,o=c0.Off){if(N(e.texture))return;e.fboTexture=r===ca.GroupBackgroundComposite||s===pt.Normal&&n===C0.NotRequired&&o===c0.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,r,i,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,ui.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=s===pt.Normal&&n===C0.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,s,n);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(e,r,i,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return N(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new w8,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?dT.Noop:dT.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(q5e,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,s,n,o,a,l,c){const h=this._rctx,p=o.sourceLayerInfo.data,A=o.tile.surface.layerViewByIndex(o.layerIndex,ui.MAP),_=n===C0.Required||e.opacity<1||s!==pt.Normal||r!==ca.Composite,w=_?c0.On:c0.Off;this._getBlendLayersTechnique(s,r,n,w).bindPipelineState(h);let T=null,C=null;_?(C=this.currentFBO(i),N(this._vtFBO)&&(this._vtFBO=new JAe(this._rctx)),T=this._vtFBO.get(i),h.bindFramebuffer(T),this._clearCurrentFBO()):c&&h.clearSafe(qs.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,o.sourceLod,p,A.painter,A.layer.styleRepository,A.schemaHelper,Math.round(1/o.scale),o.offset,l,a)}catch(M){pRt.warnOnce("A render call containing vector tiles did not resolve correctly.",M)}return!E(T)||(h.bindFramebuffer(C),e.texture=T.colorTexture,e.offset=Hu,e.scale=1,this.drawRasterData(e,r,i,s,n,w),c)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Wt.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;r.gl.copyTexImage2D(nr.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),r.bindTexture(i,Wt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(qs.COLOR_BUFFER_BIT|qs.DEPTH_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let s=this._fbos.length;s<=r;s++)this._fbos.push(new JAe(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},mRt=class{constructor(e,r,i,s){this.start=e,this.end=r,this.blendMode=i,this.opacity=s}},gRt=class{constructor(e,r,i){this._rctx=e,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new WMt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new fRt(this._rctx,this._techniqueRepository),this._blackTex=new HE(Wut(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Nt(this._composition),this._backgroundTexture=en(this._backgroundTexture),this._blackTex=en(this._blackTex)}get backgroundIsGrid(){return N(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,s=i.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let h=!1;cB.clear(),LS.length=0;const p=e.layerInfo[ui.MAP];let A=p.length,_=0;for(;_<p.length;_++){const C=i.layerViewByIndex(_,ui.MAP),M=C.layer.opacity;KAe[_]=M;const O=C.fullOpacity;if(eye[_]=O,Kwe(C.layer)&&A>=p.length&&(A=_),sB(C)){tye[_]=C.layer.blendMode;let L=C.layer.blendMode!=="normal";if(I3(C.layer.parent)){const k=NK(C.layer.parent);E(k)&&k!==""&&(L=Y5e(C.layer.parent)||L)}L&&(h=L,l=!1)}if(M===0&&!h){p[_].pendingUpdates&=~(ur.TEXTURE_NOFADING&ur.TEXTURE_FADING);continue}++o;const $=RH(e,_);if($){if(p[_].pendingUpdates&=~(ur.TEXTURE_NOFADING&ur.TEXTURE_FADING),I3(C.layer.parent)){const L=NK(C.layer.parent);E(L)&&L!==""&&Q5e(C.layer.parent,_)}V4(C)?a=Math.max(a,this.tileSize*c):s===1&&O===1&&(C.isOpaque||this._dataToTexture($)&&$.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n}}this._rctx.type===sr.WEBGL1&&(a=ARt(a));const w=a/this.tileSize,T=_-1;this._ensureBackgroundTexture(this.tileSize),n!==0?n===1&&!h&&this._useLayerTexture(e,T,A,eye[T])||this._composeMapLayers(e,r,T,A,KAe,tye,a,w,!l||h,cB,h):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){N(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=Hu,this._passParameters.scale=1,this._passParameters.opacity=1,E(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,E(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,r){let i=Sy.Immediate;(e.surface.view.layerViewManager.updating||r>0)&&(i=Sy.Delayed);const s=e.renderData;this._backgroundTexture&&N(s.textureReference)&&(i=Sy.Immediate),s.setTextureReference(E(this._backgroundTexture)?new CH(this._backgroundTexture,Ho.FADING,rye,e.surface.baseOpacity,0,1):null,i)}_useLayerTexture(e,r,i,s){const n=r<i,o=n?1:e.surface.baseOpacity,a=n?e.surface.baseOpacity:1,l=RH(e,r);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new CH(l.sourceLayerInfo.data,Ho.FADING,l,o,a,s)),!0)}_composeMapLayers(e,r,i,s,n,o,a,l,c,h,p){this._composition.ensureBuffer(a);const A=e.surface.baseOpacity;let _=!1,w=Bt.LINEAR_MIPMAP_LINEAR,T=!1,C=0;for(let $=i;$>=0;$--){const L=RH(e,$);if(!L||n[$]===0&&!p)continue;const k=$<s&&A<1&&!_;this._passParameters.baseOpacity=k?A:1;const F=this._passParameters.baseOpacity<1?C0.Required:C0.NotRequired;k&&(_=!0);let G=!1;h.forEach(te=>{te.start===$&&(LS.push(te),this._composition.openGroup(a),G=!0)});const z=C===0,Z=G?ca.GroupBackgroundComposite:c&&z?this.backgroundIsGrid?ca.GridComposite:ca.ColorComposite:ca.Composite,J=IK[o[$]];for(ACt(L)?(this._passParameters.opacity=n[$],T=this._composition.drawVectorData(this._passParameters,Z,a,J,F,L,l,this.tileSize,T)):gCt(L)?(this._passParameters.opacity=n[$],this._composition.drawImageryTileData(this._passParameters,Z,a,J,F,L),this._hasNearestInterpolation(L)&&(w=Bt.NEAREST)):this._dataToTexture(L)&&(this._passParameters.texture=L.sourceLayerInfo.data.texture,this._passParameters.offset=L.offset,this._passParameters.scale=L.scale,this._passParameters.opacity=n[$],this._composition.drawRasterData(this._passParameters,Z,a,J,F));LS.length>0&&LS[LS.length-1].end===$;){const te=LS.pop();this._passParameters.opacity=te.opacity,this._passParameters.offset=Hu,this._passParameters.scale=1;const re=c&&z?this.backgroundIsGrid?ca.GridComposite:ca.ColorComposite:ca.Composite;this._composition.drawGroup(this._passParameters,re,a,IK[te.blendMode],F)}C++}const M=e.renderData,O=M.ensureTexture(a,()=>this._buildTexture(a,w));this._composition.copyFBOToTexture(O),this._composition.unbind(),M.setTextureReference(new CH(O,r,rye,_?1:A,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(_Ct(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data),e.tile.setMemoryDirty()}return yCt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r=Bt.LINEAR_MIPMAP_LINEAR){if(N(e))return null;const i={target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:r,maxAnisotropy:this._maxAnisotropy,preMultiplyAlpha:!0,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof e=="number")i.width=i.height=e,n=new HE(new Wt(s,i));else if(e instanceof z7)i.isOpaque=e.isOpaque,n=new HE(new Wt(s,i,e.image)),e.release();else try{i.width=e.width,i.height=e.height,n=new HE(new Wt(s,i,e))}catch{n=new HE(mOe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,Wt.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,Wt.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}};function ARt(t){const e=$3(t),r=e*e,i=t*t;if(r===i)return t;const s=e/2;return r-i<i-s*s?e:s}function RH(t,e){id.layerIndex=e;const r=t.layerInfo[ui.MAP][e];if(E(r.data))return Kr(id.offset,0,0),id.tile=t,id.scale=1,id.sourceLod=t.lij,id.sourceLayerInfo=r,id;const i=r.upsampleInfo;if(E(i)){const s=i.tile.layerInfo[ui.MAP][e];return id.tile=i.tile,ga(id.offset,i.offset),id.scale=i.scale,id.sourceLod=i.tile.lij,id.sourceLayerInfo=s,id}return null}function NK(t){return t.get("uid")}function Y5e(t){let e=t.blendMode!=="normal";return I3(t.parent)&&(e=Y5e(t.parent)||e),e}function Q5e(t,e){I3(t.parent)&&Q5e(t.parent,e);const r=NK(t);if(E(r)&&r!==""){const i=cB.get(r);i?i.start=e:cB.set(r,new mRt(e,e,t.blendMode,t.opacity))}}const KAe=new Array,eye=new Array,tye=new Array,cB=new Map,LS=new Array,id={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},rye={offset:[0,0],scale:1},X5e=200,OH=40,yRt=.8,_Rt=10,iI=1e-6;function vRt(t,e,r){const i=e,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(s[a]<=iI)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-iI){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(i[a]>l){if(s[a]>=-iI)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=iI){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let iye=class{constructor(e,r,i,s,n){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}},Ooe=class FK{constructor(e,r,i,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positionAttribute=s,this._rayDirection=V(),this.bspNodeTree=new Array;const n=i-r,o=n<=Z5e?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=SRt(e,r,i,s.data,s.stride),l=ze(Math.log2(n/OH),2,_Rt),c=(h,p,A)=>{const _=xRt(o,a,h,p),w=p-h;if(w<=OH){const L=new iye(_,void 0,0,h,p);return this.bspNodeTree.push(L),L}const{axis:T,midValue:C}=TRt(_),M=wRt(o,a,h,p,T,C),O=(L,k)=>{if(A>l)return;const F=k-L;return F<OH||F>=yRt*w?void 0:c(L,k,A+1)},$=new iye(_,T,C,M.next,M.mid);return this.bspNodeTree.push($),$.leftNode=O(h,M.next),$.rightNode=O(M.mid,p),$};c(0,n,0),this.triangleVertexIndices=ERt(o,e,r,i)}}intersectRayTriangleRange(e,r){{if(e>=r)return;const i=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,p=h[0],A=h[1],_=h[2];for(let w=e,T=3*e;w<r;++w){let C=i[T++]*n;const M=s[C++],O=s[C++],$=s[C];C=i[T++]*n;const L=s[C++],k=s[C++],F=s[C];C=i[T++]*n;const G=L-M,z=k-O,Z=F-$,J=s[C++]-M,te=s[C++]-O,re=s[C]-$,Ae=A*re-te*_,ve=_*J-re*p,ye=p*te-J*A,le=G*Ae+z*ve+Z*ye;if(Math.abs(le)<=Number.EPSILON)continue;const W=a-M,q=l-O,X=c-$,se=W*Ae+q*ve+X*ye;if(le>0){if(se<0||se>le)continue}else if(se>0||se<le)continue;const ae=q*Z-z*X,fe=X*G-Z*W,ue=W*z-G*q,Re=p*ae+A*fe+_*ue;if(le>0){if(Re<0||se+Re>le)continue}else if(Re>0||se+Re<le)continue;const De=(J*ae+te*fe+re*ue)/le;if(De>=0){const Ue=this.indices[w]+this.firstTriangleIndex,Je=bne(G,z,Z,J,te,re,bRt);this._callback(De,Je,Ue,!1)}}}FK.numFacesTested+=r-e}intersectRay(e,r){FK.numFacesTested=0;const i=ct(e.r0[0],e.r0[1],e.r0[2]),s=ct(e.r1[0],e.r1[1],e.r1[2]),n=s[0]-i[0],o=s[1]-i[1],a=s[2]-i[2];if(n*n+o*o+a*a<iI)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(e,r,i){const s=this._rayOrigin,n=this._rayDirection;if(!vRt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=r,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};Ooe.numFacesTested=0;const bRt=V(),DS=[1/0,1/0,1/0],NS=[-1/0,-1/0,-1/0];function wRt(t,e,r,i,s,n){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function xRt(t,e,r,i){if(i<=r)return zx(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[r];for(let n=0;n<3;++n)DS[n]=e[s+0+n],NS[n]=e[s+3+n]}for(let s=r+1;s<i;++s){const n=6*t[s];for(let o=0;o<3;++o)DS[o]=Math.min(DS[o],e[n+0+o]),NS[o]=Math.max(NS[o],e[n+3+o])}return zx(DS[0],DS[1],DS[2],NS[0],NS[1],NS[2])}function TRt(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],s=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function SRt(t,e,r,i,s){const n=r-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l+0]*s,h=t[l+1]*s,p=t[l+2]*s;for(let A=0;A<3;++A){const _=i[c+A],w=i[h+A],T=i[p+A];o[6*a+A]=Math.min(_,w,T),o[6*a+3+A]=Math.max(_,w,T)}}return o}function ERt(t,e,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(e[3*a+l],n);const o=n<=Z5e?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const h=e[l+c];o[3*a+c]=h}}return o}const Z5e=65535;let vn=class extends $a{constructor(){super(...arguments),this.output=ee.Color,this.overlayMode=Cy.Disabled,this.tileBlendInput=gg.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.shading=!Qi.TERRAIN_USE_LEGACY_SHADING,this.useLegacyTerrainShading=Qi.TERRAIN_USE_LEGACY_SHADING,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=Qt.Terrain}};u([ie({count:ee.COUNT})],vn.prototype,"output",void 0),u([ie({count:Cy.COUNT})],vn.prototype,"overlayMode",void 0),u([ie({count:gg.COUNT})],vn.prototype,"tileBlendInput",void 0),u([ie()],vn.prototype,"spherical",void 0),u([ie()],vn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([ie()],vn.prototype,"atmosphere",void 0),u([ie()],vn.prototype,"receiveShadows",void 0),u([ie()],vn.prototype,"hasSlicePlane",void 0),u([ie()],vn.prototype,"backfaceCullingEnabled",void 0),u([ie()],vn.prototype,"stencilEnabled",void 0),u([ie()],vn.prototype,"textureFadingEnabled",void 0),u([ie()],vn.prototype,"renderOccluded",void 0),u([ie()],vn.prototype,"hasScreenSpaceReflections",void 0),u([ie()],vn.prototype,"hasCloudsReflections",void 0),u([ie()],vn.prototype,"shading",void 0),u([ie()],vn.prototype,"useLegacyTerrainShading",void 0),u([ie()],vn.prototype,"invisible",void 0),u([ie()],vn.prototype,"tileBorders",void 0),u([ie()],vn.prototype,"visualizeNormals",void 0),u([ie()],vn.prototype,"screenSizePerspective",void 0),u([ie()],vn.prototype,"receiveAmbientOcclusion",void 0),u([ie({count:Qt.COUNT})],vn.prototype,"pbrMode",void 0),u([ie({constValue:cs.CompressedAttribute})],vn.prototype,"normalType",void 0),u([ie({constValue:co.Compressed})],vn.prototype,"textureCoordinateType",void 0),u([ie({constValue:!1})],vn.prototype,"highStepCount",void 0),u([ie({constValue:!1})],vn.prototype,"useCustomDTRExponentForWater",void 0),u([ie({constValue:!1})],vn.prototype,"useFillLights",void 0);const PH=7,CRt=10,IH=Jo();var oa;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(oa||(oa={}));let uh=class extends Ke{get _isGlobal(){return this._stage.viewingMode===_t.Global}get shading(){return this._techniqueConfiguration.shading}set shading(e){this._techniqueConfiguration.shading=e}constructor(e){super(e),this.type=pn.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new vn,this._passParameters=new S5e,this._rctx=null,this._renderDataPool=new al(vMt),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new g5e,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=oa.Opaque,this._velvetOverground=!0,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=xn.Occlude}initialize(){const e=[et.OPAQUE_TERRAIN,et.TRANSPARENT_TERRAIN,et.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),y3t()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===oa.TransparentWithDraped||e===oa.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return rv}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?X9:xn.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,E(this._tileRenderer)&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,ur.TEXTURE_FADING)}updateTileTexture(e,r){E(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(e,r===ur.TEXTURE_FADING?Ho.FADING:Ho.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[ui.ELEVATION])i.pendingUpdates&=~ur.GEOMETRY;e.resetPendingUpdate(ur.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=CRt-PH,i=Math.max(0,Math.floor((e.level-r)/PH)*PH);if(this._isGlobal&&i===0)return sc;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Wn.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Wn.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Wn.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new gRt(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=mOe(this._rctx)}uninitializeRenderContext(){this._emptyTex=Nt(this._emptyTex),this._tileRenderer=Nt(this._tileRenderer)}intersect(e,r,i,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==oa.Opaque)return;const n=MRt,o=RRt;Be(n,s,i),$e(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===dl.MIN,p=!!e.results.ground.target,A=n0t(e.verticalOffset),_=e.tolerance;let w,T=h&&E(a.dist)?a.dist:1/0;const C=O=>{const $=O.renderData;if(!($!=null&&$.vao))return;const L=$.geometryInfo;sU(IH,L.boundingBox);const k=$.localOrigin;E(A)&&(A.localOrigin=k,A.applyToAabb(IH));const F=IH;if(FS[0]=i[0]-k[0],FS[1]=i[1]-k[1],FS[2]=i[2]-k[2],!xne(F,FS,o,_,T))return;const G=(ye,le,W)=>{ye.set(this.type,O,le,W,Hd),T=h&&E(a.dist)?a.dist:1/0},z=(ye,le)=>{if(E(le)&&ye>=0&&(e.options.backfacesTerrain||He(le,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,s,ye))){if((c.dist==null||ye<c.dist)&&G(c,ye,le),e.options.isFiltered)return;e.options.store===dl.ALL&&(N(w)?(w=Zse(e.ray),G(w,ye,le),e.results.all.push(w)):ye<w.dist&&G(w,ye,le)),(a.dist==null||ye<a.dist)&&G(a,ye,le),e.options.store!==dl.MIN&&(l.dist==null||ye>l.dist)&&G(l,ye,le)}},Z=ORt;Be(Z,s,k);const J=L.indices,te=L.vertexAttributes,re=te.getField(B.POSITION,ks),Ae=new Rt(re.typedBuffer,3,!1,te.stride/4),ve=L.indexCount/3;if(N(A)&&ve>X5e){const ye=O.renderData;N(ye.intersectionData)&&(ye.intersectionData=new Ooe(J,0,ve,Ae)),ye.intersectionData.intersectRay({r0:FS,r1:Z},z)}else jL(FS,Z,0,ve,J,Ae,null,A,z)},M=this._rootTiles;E(M)&&(()=>{const O=this._tileIterator;O.reset(M);const $=e.options.invisibleTerrain;for(let L=O.next();L;L=O.next())!(L.visible||$&&L.intersectsClippingArea)||!E(A)&&!L.intersectsRay(i,n,_,T)||p&&this._useStencilForTile(L)?O.skipSubtree():C(L)})()}processScaleRangeQueries(e,r){var i;if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const s of this._patchGroups.values())for(const n of s)E((i=n.renderData)==null?void 0:i.textureReference)&&e.queriesForTile(n);e.process(),r.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===et.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&X9))return null}else{const r=this.transparency===oa.Opaque?et.OPAQUE_TERRAIN:et.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}switch(e.output){case ee.Color:return this.transparency===oa.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=E(e.bindParameters.cloudsFade.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?Cy.Disabled:this._overlayRenderer.hasWater?Cy.EnabledWithWater:Cy.Enabled,this._updateTechnique(ee.Color,e.bindParameters.slot===et.OCCLUDED_TERRAIN));case ee.Shadow:case ee.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(ee.Shadow,!1)):null;case ee.Depth:return this.transparency===oa.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(ee.Depth,!1));case ee.Normal:return this.transparency===oa.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(ee.Normal,!1));case ee.ObjectAndLayerIdColor:return this.transparency===oa.Empty?null:this._updateTechnique(ee.ObjectAndLayerIdColor,!1);case ee.Highlight:return this.transparency!==oa.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(ee.Highlight,!1)):null}return null}render(e,r){const i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case ee.Color:{const s=e.bindParameters.slot===et.OCCLUDED_TERRAIN?Ou.Occluded:Ou.ColorAndWater;this.transparency===oa.Opaque?this._renderMaterialPass(e,r,s):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,r,s),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case ee.Depth:case ee.Normal:this._renderAuxiliaryPass(e,r,Ou.None);break;case ee.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,r,Ou.Highlight);break;case ee.Shadow:case ee.ShadowExcludeHighlight:this._castShadows&&i&&this._renderAuxiliaryPass(e,r,Ou.None);break;case ee.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,Ou.ObjectAndLayerIdColor)}}_renderMaterialPass(e,r,i){const{rctx:s}=e;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,r,i)}_renderAuxiliaryPass(e,r,i){const s=e.rctx;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,r,i)}updateTileBackground(e=null){if(N(this._tileRenderer))return;const r=this._tileRenderer;let i=null;if(E(e)){const s=Ot.toUnitRGBA(e);i=ct(s[0]||0,s[1]||0,s[2]||0)}r.setBackground(i),this._allTiles.forAll(s=>r.updateTileTexture(s,Ho.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?gg.GridComposite:E(r.backgroundColor)?gg.ColorComposite:gg.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==vM.NONE){const e=Array.from(this._patchGroups.values()),r=this._stencilEnabledLayerExtents;for(const i of e)A5e(this.renderOrder,i,r);e.sort((i,s)=>y5e(i[0],s[0],this.renderOrder)),this._patchGroups=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var r;const e=this._rootTiles;if(!N(e)){(r=e[0])==null||r.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),s=i.renderData;if(!s){this._numTilesCulled++;continue}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}const n=s.localOrigin;let o=this._patchGroups.get(n);o||(o=new Array,this._patchGroups.set(n,o)),o.push(i),(!this._highestVisibleLODTile||i.vlevel>this._highestVisibleLODTile.vlevel)&&(this._highestVisibleLODTile=i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderPatchGroupsAuxiliary(e,r,i){const s=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(n=>{const o=n[0].renderData.localOrigin;r.program.bindDraw(new lK(o),e.bindParameters,this._passParameters);for(let a=0;a<n.length;a++)this._renderPatch(e,r,n[a],Ar.TRIANGLES,s,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,r,i){const s=e.bindParameters.camera,n=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const p=ZIe(this._stage.viewingMode,this._ellipsoidRadius),A=this.pointsOfInterest.centerOnSurfaceFrequent.distance;p.update({distance:A,fovY:s.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===Ou.Occluded;a&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",sc),n.setUniform4fv("texOffsetAndScale",bg));const l=E(this._tileRenderer)&&E(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:sc;this._techniqueConfiguration.tileBlendInput===gg.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?Ar.LINES:Ar.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const h=this._patchGroups;for(const p of h.values()){const A=p[0].renderData.localOrigin;r.program.bindDraw(new lK(A),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const _ of p){const w=_.renderData,T=w.textureReference;if(!N(T)){if(!a){n.setUniform4fv("texOffsetAndScale",T.offsetAndScale),n.bindTexture("tex",T.texture.texture);const C=w.textureFadeFactor,M=C<1?w.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&E(M)&&C<1?(n.setUniform1f("fadeFactor",C),n.setUniform4fv("nextTexOffsetAndScale",M.offsetAndScale),n.setUniform3fv("nextTexOpacities",M.opacities),n.bindTexture("texNext",M.texture.texture)):n.setUniform1f("fadeFactor",1),w.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",T.opacities)}this._renderPatch(e,r,_,c,o,i),_.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,s,n,o){const a=i.renderData,l=a.vao,c=l.indexBuffer;if(N(c))return void(Xo&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const h=r.program;o===Ou.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),n&&(r.useStencil=this._useStencilForTile(i),r.bindPipelineState(e.rctx,e.bindParameters.slot));const p=a.geometryInfo.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,p,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,e===ee.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=r,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(E5e,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([d({constructOnly:!0})],uh.prototype,"_overlayRenderer",void 0),u([d({constructOnly:!0})],uh.prototype,"_stage",void 0),u([d({readOnly:!0})],uh.prototype,"_isGlobal",null),u([d({constructOnly:!0})],uh.prototype,"_allTiles",void 0),u([d({constructOnly:!0})],uh.prototype,"_ellipsoidRadius",void 0),u([d({value:!1})],uh.prototype,"renderingDisabled",null),u([d()],uh.prototype,"renderPatchBorders",null),u([d()],uh.prototype,"visualizeNormals",null),u([d()],uh.prototype,"cullBackFaces",null),u([d({value:vM.FRONT_TO_BACK})],uh.prototype,"renderOrder",null),u([d()],uh.prototype,"wireframe",null),uh=u([j("esri.views.3d.terrain.TerrainRenderer")],uh);const MRt=V(),RRt=V(),FS=V(),ORt=V();let PRt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Hm=class extends Ke{constructor(e){super(e),this._handles=new ts}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(xe(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=gt(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!EI(r)||r.isRejected())&&!(r.isFulfilled()&&!IRt(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!((r==null?void 0:r.type)==="vector-tile"||iB(r)))),e)if(e.isResolved()){const r=j7(e,this.viewSpatialReference,this.viewingMode);if(E(r)){const i=new Eh(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===_t.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=Eh.makeWebMercatorAuxiliarySphere(r):qx(e.spatialReference)&&(e=Eh.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(xe(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===_t.Global){const e=this.extentHelper.viewSpatialReference,r=qx(e)||Gg(e)||jg(e);e.isWebMercator?this.tilingScheme=Eh.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=Eh.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;E(e)&&!dx(e,this.extent)&&(this.tilingScheme=Eh.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function IRt(t,e,r){return E(j7(t,e,r))}u([d()],Hm.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],Hm.prototype,"extent",void 0),u([d({value:!1})],Hm.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],Hm.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],Hm.prototype,"layers",void 0),u([d({constructOnly:!0})],Hm.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],Hm.prototype,"viewingMode",void 0),Hm=u([j("esri.views.3d.terrain.TilingSchemeLogic")],Hm);let $Rt=class{constructor(){this.offset=Dt(),this.scale=0,this.tile=null}init(e,r,i,s){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},Gr=class extends Nn.EventedMixin(Ke){constructor(e){var r,i;super(e),this._scaleRangeQueries=new v8,this._iteratorPool=new al(g5e,s=>s.remove=()=>this._iteratorPool.release(s)),this._postorderIterator=new T3t,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new PRt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=V(),this._eyePosSurfaceSR=V(),this._splitLimits=new jMt,this._frustum=v4(),this._viewProjectionMatrix=ot(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new ts,this._watchUpdatingTracking=new vg,this._frameTask=rM,this._allTiles=new Vr,this._upsampleInfoPool=new al($Rt),this._rootTilesExtent=si(),this.updatingProgress=0,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=xt.WebMercator,this.visibleElevationBounds=new PC(1/0,-1/0),this.rootTileElevationBounds=new PC(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this._shading=!0,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this._isGlobal=!((i=(r=e.view)==null?void 0:r.state)!=null&&i.isLocal)}initialize(){this._lercDecoder=YCt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new al(UMt):new al(zMt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",o=>o.unloadMapData()),this._elevationQueryCache=new qCt(e.newCache("elevation-query")),this._set("overlayManager",new xu({surface:this})),this._handles.add([xe(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),xe(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),xe(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new uh({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:es(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([xe(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Ho.UNFADED:Ho.IMMEDIATE)},ao),xe(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Ho.UNFADED:Ho.IMMEDIATE),ao),xe(()=>this.renderingDisabled,()=>{var o,a;return(a=(o=this.view)==null?void 0:o._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},os),xe(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},ao),xe(()=>this.snapLevel,()=>this._viewChanged=!0,os),xe(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),xe(()=>Qi.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?be(()=>import("./TerrainTileTree3DDebugger-9cae0922.js"),["assets/TerrainTileTree3DDebugger-9cae0922.js","assets/TileTreeDebugger-3b21cadf.js"]).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&Qi.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=gt(this._treeDebugger))},Cr)]);const{spatialReference:r}=this.view;this._extentHelper=u3t(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:r});const i=new V$({getCollections:()=>{var o,a,l;return(l=(a=(o=this.view)==null?void 0:o.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:l.map(({layers:c})=>c)},getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),s=new Hm({layers:i,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:r});this._set("tilingSchemeLogic",s),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(ug.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(ug.BASEMAP);const n=this.view.resourceController.scheduler;this._frameTask=n.registerTask(ir.TERRAIN_SURFACE,this),this._handles.add([xe(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),Cr),xe(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),os),xe(()=>this.extent,()=>this._updateRootTiles(),Cr),this.view.on("resize",()=>this._viewChangeUpdate()),xe(()=>{var l,c;const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,(c=(l=o.resourceController)==null?void 0:l.memoryController)==null?void 0:c.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),ao),xe(()=>{var o,a;return(a=(o=this.view.qualitySettings)==null?void 0:o.tiledSurface)==null?void 0:a.textureFadeDuration},o=>this._renderer.textureFadingEnabled=o>0,Cr),xe(()=>{var o;return(o=this.view.qualitySettings)==null?void 0:o.physicallyBasedRenderingEnabled},o=>this._renderer.pbrMode=o?Qt.Terrain:Qt.Disabled,Cr),xe(()=>this._userClippingExtent,()=>this._updateClippingExtent(),os)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._handles.add([xe(()=>{var o;return(o=this.view)==null?void 0:o.map.ground.shading},()=>{this._updateShadingIfChanged()})]),this._updateShading(),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=en(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=gt(this._upsampleMapCache),this._elevationQueryCache=gt(this._elevationQueryCache);const e=this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",gt(this.tilingSchemeLogic)),e.destroy(),this._basemapLayerViewHandles.forEach((r,i)=>this._unregisterTiledLayerView(i)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",gt(this.overlayManager)),this._tilePool=gt(this._tilePool),woe.prune(),this._treeDebugger=gt(this._treeDebugger),this._renderer=gt(this._renderer),this._iteratorPool=gt(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=gt(this._upsampleInfoPool),n3t(),K3t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,r;if(this.lodSnapping===i$.ON){const i=this.view,s=this.tilingScheme,n=(r=(e=i.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:r.scale;if(n&&s){const o=i.state.contentCamera;let a=y7(i,o.eye,o.viewForward,o.up).tilt;a>90&&(a=180-a);const l=2*(a/90)**2,c=s.levelAtScale(n)-l;return Math.round(c)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?i$.ON:i$.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:r}=this.view;if(N(r)||N(e))return null;const i=si(),s=ZDe(r,i,e)?i:null,n=this._get("extent");return dx(s,n)?n:s}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=EY(this.groundExtent,this._userClippingExtent,si()),r=this._get("extent");return dx(e,r)?r:e}get groundExtent(){return E(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view.map.ground.opacity}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return E(this._rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e;return((e=this.tilingScheme)==null?void 0:e.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e;return((e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)??!1}set velvetOverground(e){this._renderer.velvetOverground=e,this._set("velvetOverground",e)}get wireframe(){return this._renderer.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===oa.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,r,i,s){this._renderer.intersect(e,r,i,s)}getElevation(e,r,i,s){const n=this._rootTiles;if(N(n)||!n.length||n[0].layerInfo[ui.ELEVATION].length===0)return null;const o=pu;return o[0]=e,o[1]=r,o[2]=i,Ba(o,s,o,this._spatialReference)?nye(n,o[0],o[1]):(we.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,r,i){const s=this._rootTiles,n=s?s[0].layerInfo[ui.ELEVATION].length:0;if(!N(s)&&s.length&&n!==0)for(let o=0;o<r;++o){const a=3*o;i(o,nye(s,e[a+0],e[a+1]))}else for(let o=0;o<r;++o)i(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!Fl(e,pu,this.spatialReference))return we.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const r=this._rootTiles;if(E(r)){for(const i of r)if(i!=null&&i.containsPoint(pu)){let s=i;for(;s.children[0]&&!s.rendered;){const n=s.children[0].extent;let o=0;pu[0]>n[2]&&(o+=1),pu[1]<n[1]&&(o+=2),s=s.children[o]}return this._getLodBiasCorrectedScale(s.level)}}return 1/0}getSphereElevationBounds(e,r,i,s,n){var h;if(pu[0]=e,pu[1]=r,pu[2]=i,pu[3]=s,!Ba(pu,n,pu,(h=this.tilingScheme)==null?void 0:h.spatialReference))return we.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let o=1/0,a=-1/0;const l=p=>{if(p&&Bce(p.extent,pu))if(p.isLeaf||p.rendered)o=Math.min(o,p.elevationBounds[0]),a=Math.max(a,p.elevationBounds[1]);else for(const A of p.children)l(A)},c=this._rootTiles;if(E(c))for(const p of c)l(p);return{min:o,max:a}}getSphereScale(e,r){if(!this.tilingScheme)return null;if(!Fl(e,pu,this.spatialReference))return we.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;pu[3]=r;let i=null;const s=o=>{if(o&&Bce(o.extent,pu)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)s(l);else{const l=this._getLodBiasCorrectedScale(o.level);i=i==null?l:Math.min(i,l)}}},n=this._rootTiles;if(E(n))for(const o of n)s(o);return i}queryVisibleScaleRange(e,r,i,s){const n=r?this.tilingScheme.levelAtScale(r):0,o=i?this.tilingScheme.levelAtScale(i):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+a,o+a,s)}_evaluateTransparency(){var o,a;const e=this.baseOpacity,r=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,s=this._allSurfaceLayersTransparent()?r?oa.Empty:oa.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?oa.Opaque:oa.Semitransparent,n=i!==s;return n&&(this._renderer.transparency=s,(a=(o=this.view)==null?void 0:o._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){var i,s,n;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;ig(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((s=(i=this.view)==null?void 0:i.state)!=null&&s.isLocal),this.tilingScheme&&this._removeAllTiles();const r=(e==null?void 0:e.spatialReference)??xt.WebMercator;this._spatialReference=r,this._isWebMercator=!!(r!=null&&r.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&Ete((n=this.view)==null?void 0:n.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,r,i,s){const n=this._tilePool.acquire();return rF[0]=e,rF[1]=r,rF[2]=i,n.init(rF,s,this),n}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:r}=this;if(!r)return;const i=NRt;let s=r.rootTilesInExtent(e,i,5*_C);if(E(this._rootTiles)){if(s.length>_C)return void we.getLogger(this.declaredClass).warn(Ult);const n=this._rootTiles.map(a=>a.lij),o=z9e(n,s,sye);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>sye(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,s.length>_C&&(we.getLogger(this.declaredClass).warn(Vlt),s=r.rootTilesInExtent(e,i,_C)),this._setRootTiles(s.map(n=>this._newRootTile(n)));dx(i,this._rootTilesExtent)||(this._rootTilesExtent=si(i)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(r=>r.isLoaded&&r.intersectsClippingArea);e.forEach(r=>this._renderer.updateTileGeometryState(r)),e.forEach(r=>r.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(Ey);const r=this.renderer;e.forEach(i=>r.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===ur.SPLIT}_newRootTile(e){const r=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(r)&&r.setPendingUpdate(ur.SPLIT),this._loadTile(r),this._markTileToUpdate(r),this._updateRootTileElevationBounds(),r}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),E(e)){const r=this._iteratorPool.acquire();for(r.reset(e);!r.done;)this._allTiles.push(r.next());r.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(ur.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(N(e))return;const r=P3t(e),i=this.visibleElevationBounds;let s=r?i.min:1/0,n=r?i.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(ur.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(ur.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(s=Math.min(c.elevationBounds[0],s),n=Math.max(c.elevationBounds[1],n))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(s)&&isFinite(n)&&(i.min!==s||i.max!==n)&&(this.visibleElevationBounds=new PC(s,n))}_updateRootTileElevationBounds(){let e=1/0,r=-1/0;const i=this._rootTiles;E(i)&&i.forEach(({elevationBounds:n})=>{e=Math.min(e,n[0]),r=Math.max(r,n[1])});const s=this.rootTileElevationBounds;s.min===e&&s.max===r||(this.rootTileElevationBounds=new PC(e,r))}_updateViewDependentParameters(){const{camera:e,contentCamera:r}=this.view.state,i=Math.tan(.5*r.fovX),s=Math.tan(.5*r.fovY),n=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=s,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(N(this._splitLimits.frustum)&&(this._splitLimits.frustum=v4()),A9(this._splitLimits.frustum,r.frustum)):this._splitLimits.frustum=null,A9(this._frustum,e.frustum),$n(this._viewProjectionMatrix,r.projectionMatrix,r.viewMatrix),Oe(this._eyePosRenderSR,r.eye),Ba(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(J5e(e)?this._loadChildren(e):DRt(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const r=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}_updateTileTexture(e,r){const i=e.resetPendingUpdate(ur.TEXTURE_FADING)?ur.TEXTURE_FADING:!!e.resetPendingUpdate(ur.TEXTURE_NOFADING)&&ur.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,r.madeProgress())}_emitElevationUpdateEventForTiles(){const e=LH.extent;lf(e),this._pendingTilesForElevationUpdateEvent.forEach(r=>Fv(e,r.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),LH.spatialReference=this.spatialReference,this.emit("elevation-change",LH)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const r=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,r),this._updateElevation(e),this._updateTextures(e),r||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed?this.requestUpdate():this.getUsedMemory(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const r=this._iteratorPool.acquire();r.reset(this._rootTiles);const i=this.snapLevel,s=this._splitLimits,n=this._eyePosRenderSR;for(;!r.done;){const o=r.next(),a=o.shouldSplit(s,n,i);if(a!==ur.SPLIT){if(o.resetPendingUpdate(ur.SPLIT)&&o.updateAgentSuspension(),a===ur.VSPLITMERGE&&o.updateAgents(ui.ELEVATION),r.skipSubtree(),!o.isLeaf){o.setPendingUpdate(ur.MERGE),o.resetPendingUpdate(ur.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let h=l.next();!l.done;h=l.next())this._updateClippingStatus(h),h.updateVisibility(),h.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(ur.MERGE),o.isLeaf&&(o.setPendingUpdate(ur.SPLIT),r.skipSubtree()),o.rendered&&o.setPendingUpdate(ur.RENDERDATA)}r.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(R3t(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){it(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const r=Array.from(this._pendingTilesToUpdate.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea),i=(n,o)=>{!(o!=null&&o.isLoaded)||!o.intersectsClippingArea||o.level<n.level||e.has(o)||(e.add(o),r.push(o),o.renderData.updateNeighborData())};r.sort(Ey);const s=r.length;for(let n=0;n<s;++n){const o=r[n];it(o.isLoaded),it(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData;for(let h=0;h<4;++h)if(l&1<<h){const p=a.geometryState.neighborData.edgePeerNeighbors[h];p&&(p==null?void 0:p.level)>=o.level&&p.forAllSubtreeOnSide(nB(mg[h]),A=>!(!A.isLoaded||!A.intersectsClippingArea)&&(it(e.has(A)||Ey(o,A)<0),i(o,A),!0)),i(o,c.cornerPeerNeighbors[h]),i(o,c.cornerPeerNeighbors[(h+1)%4])}}e.clear(),this._updateTilesGeometries(r),Xo&&rB&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,r){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const s=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let o=!1;const a=!this._allTiles.some(l=>{var h;if(!i&&!s&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(ur.MERGE)){if(!r)return l.setPendingUpdate(ur.MERGE),e.done;for(;(h=c.parent)!=null&&h.resetPendingUpdate(ur.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(ur.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(ur.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!i){i=!0;continue}if(!o)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(r=>(r.resetPendingUpdate(ur.GEOMETRY)&&(this._updateTileGeometryState(r),this._updateTileTexture(r,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(r=>(this._updateTileTexture(r,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Wn.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*klt}_getLodBiasCorrectedScale(e){const r=this.tilingScheme.levels,i=ze(e-this._lodBias,0,r.length-1),s=i-Math.floor(i);return r[Math.floor(i)].scale*(1-s)+r[Math.ceil(i)].scale*s}_removeAllTiles(){E(this._rootTiles)&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let r=!1;for(let i=0;i<4;++i)r=this._purgeTile(e.children[i])||r;return e.unsetChildren(),r}_purgeTile(e){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),r}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){ig(e.isLeaf,"tile that is already split should not be split again!");const r=e.level+1,i=2*e.lij[1],s=2*e.lij[2];e.setChildren(this._createTile(r,i,s,e),this._createTile(r,i,s+1,e),this._createTile(r,i+1,s,e),this._createTile(r,i+1,s+1,e)),e.setPendingUpdate(ur.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,r=e.level){iF.spatialReference=this.spatialReference,iF.extent=e.extent,iF.scale=this._getLodBiasCorrectedScale(r),this.emit("scale-change",iF)}_createTile(e,r,i,s){ig(!!s,"_createTile sanity check");const n=this._acquireTile(e,r,i,s);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(ur.SPLIT),n}get shortBatches(){return this.view.state.mode!==Ei.IDLE}_mergeTile(e){ig(!e.hasPendingUpdate(ur.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(ig(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){ig(e.rendered,"parent should be rendered"),this._unloadTile(e);const r=e.children;r.forEach(i=>this._loadTile(i)),r.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const r=e.parent;this._unloadChildren(r),this._loadTile(r),this._markTileToUpdate(r),this._emitTileScaleChange(r,r.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const r=e.children;if(r[0])for(let i=0;i<4;++i){const s=r[i];this._unloadChildren(s),this._unloadTile(s)}}_loadTile(e){e.load(),e.setPendingUpdate(ur.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,r,i){const s=new l3t(e.lij,e.extent,i);e.dataArrived(r,ui.ELEVATION,s);const n=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(e=jc){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let r=!1;const i=new Set;let s=-1;for(const n of this.view.allLayerViews.items)if(i.add(n.uid),z4(n)||vO(n))if(this._basemapLayerViewHandles.has(n.uid)&&!vO(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);E(a)&&((a<s||N(s))&&(r=!0),s=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(r=!0);this._basemapLayerViewHandles.forEach((n,o)=>{i.has(o)||(this._unregisterTiledLayerView(o),r=!0)}),r&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var r,i;let e=((i=(r=this.view.map)==null?void 0:r.ground)==null?void 0:i.opacity)===0;for(const s of this.view.allLayerViews.items)if(EK(s)&&!Kwe(s.layer)&&s.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((sB(e)||vO(e))&&F3t(IK[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return SK(e)?ui.ELEVATION:ui.MAP}_registerTiledLayerView(e){const r=[];if((sB(e)||vO(e))&&r.push(xe(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Ho.UNFADED)})),vO(e))return;const i=this._layerClassFromLayerView(e);r.push(xe(()=>e.suspended,()=>this._updateTiledLayers())),r.push(xe(()=>e.fullOpacity,()=>this._updateTileTextures(Ho.UNFADED))),r.push(xe(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.on("data-changed",()=>{const s=this._getLayerIdxByUID(i,e.uid);E(s)&&this._invalidateLayerData(s,i)}),this._basemapLayerViewHandles.set(e.uid,r)}_unregisterTiledLayerView(e){const r=this._basemapLayerViewHandles.get(e);if(r){for(let i=0;i<r.length;i++)r[i].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,r=[[],[]];let i=null;e.forEach(s=>{if(!s.layer||s.suspended||!z4(s)||!s.fullExtent)return;const n=this._layerClassFromLayerView(s);if(n===ui.MAP){const o=s.displayLevelRange.maxLevel;o!==1/0&&(i===null||o>i)&&(i=o)}r[n].push(s)});for(const s of w2){const n=this._layerViews[s],o=r[s];o.reverse();const a=o.length;let l=n.length!==a;const c=new Array(a),h=new Array(n.length);this._layerIndexByUid[s].clear();for(let p=0;p<a;p++){const A=o[p].uid;this._layerIndexByUid[s].set(A,p);const _=n.indexOf(o[p]);c[p]=_,p!==_&&(l=!0),_>-1&&(h[_]=p)}if(l){const p=this._postorderIterator;for(p.reset(this._rootTiles);!p.done;)p.next().modifyLayers(h,c,s);this._layerViews[s]=o,this._restartAllAgents(s),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const r=this._postorderIterator;for(r.reset(this._rootTiles);!r.done;){const i=r.next();i.restartAgents(e),e===ui.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,r){return this._layerViews[r][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(r=>{r.updateAgents(ui.MAP),e===Ho.IMMEDIATE?this.renderer.updateTileTexture(r,ur.TEXTURE_NOFADING):r.updateRenderData(ui.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,r){this._allTiles.forAll(i=>i.removeLayerAgent(e,r)),this._allTiles.forAll(i=>i.invalidateLayerData(e,r))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Wn.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,r,i,s){const n=this.layerViewByIndex(r,i),o=n.layer;return!o.tilemapCache||V4(n)?this._requestTileData(e,i,n,s):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...s,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,di(s),vo(a)||this._dataMissing(e,i,n,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,n,s),s.signal)))}_requestTileData(e,r,i,s){return r===ui.ELEVATION?SK(i)?this._requestElevationTileData(e,i,s):Promise.reject():EK(i)?this._requestMapTileData(e,i,s):Promise.reject()}_requestElevationTileData(e,r,i){++this._asyncWorkItems;const s=a=>{if(da(i))return;const l=this._layerIndexByUid[ui.ELEVATION].get(r.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):we.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",ui.ELEVATION,e.lij.toString())},n=a=>{vo(a)||(this._dataMissing(e,ui.ELEVATION,r,a),this.requestUpdate())};if(wAe(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:p4,signal:i.signal}).then(a=>{if(!da(i))return this._frameTask.schedule(()=>s(a),i.signal,n);we.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const o=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:p4},i.signal)).then(a=>{a?s(new WCt(a)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,r,i){++this._asyncWorkItems;const s=(h,p)=>{--this._asyncWorkItems,d3(p),da(i)||(this._dataMissing(e,ui.MAP,r,h),this.requestUpdate())},n=h=>p=>s(p,h),o=h=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),da(i)?d3(h):this._mapTileDataArrived(e,r,h)},i.signal,n(h)).catch(n(h)),a=(h,p=null)=>this._frameTask.schedule(()=>s(h,p));if(V4(r)){const h=r.schemaHelper.getLevelRowColumn(e.lij);return r.fetchTile(h[0],h[1],h[2],i).then(o,a)}if(G7(r))return r.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(o,a);if(Aoe(r)&&wAe(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(h=>{if(da(i))return we.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(Yi());o(h)},a);let l=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);Hot(r.layer)&&r.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${r.layer.refreshTimestamp}`);const c=r.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,i).then(o,a)}_mapTileDataArrived(e,r,i){const s=this._getLayerIdxByUID(ui.MAP,r.uid);E(s)?e.dataArrived(s,ui.MAP,i):(d3(i),we.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,r){return this._layerIndexByUid[e].get(r)}_dataMissing(e,r,i,s){const n=this._getLayerIdxByUID(r,i.uid);E(n)?e.dataMissing(n,r,s):we.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(r=>{r.renderData&&this.overlayManager.setTileParameters(r)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(r=>{r.isLeaf&&e.numLeaves++;const i=r.level;r.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),r.visible&&(e.numVisible++,r.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(N(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),E(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,r)=>e+r.usedMemory,0):null}getUsedMemoryForLayerView(e){let r=0;const i=this._layerClassFromLayerView(e),s=this._getLayerIdxByUID(i,e.uid);return E(s)&&this._allTiles.forAll(n=>r+=n.getUsedMemoryForLayer(i,s)),r}getTile(e){if(N(e)||N(this._rootTiles))return null;const r=e.split("/").map(a=>+a);if(r[0]===0)return this._rootTiles.find(a=>a.lij[1]===r[1]&&a.lij[2]===r[2]);const i=2**r[0],s=Math.floor(r[1]/i),n=Math.floor(r[2]/i);let o;if(this._rootTiles.some(a=>a.lij[1]===s&&a.lij[2]===n&&(o=a,!0)),o){let a=1<<r[0]-1;for(;o.lij[0]<r[0];){let l=r[1]&a?2:0;if((r[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return ig(o.lij[0]===r[0]&&o.lij[1]===r[1]&&o.lij[2]===r[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{E(e._rootTiles)&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){$H.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&$H.push(i)});const r=$H.toArray();return A5e(e.renderOrder,r),r},lockTilingScheme(r,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(r)}}}checkAllTilesWaterproofness(){if(!rB)return;const e=this._rootTiles;if(N(e))return;const r=o=>{var a,l,c;return((c=(l=(a=o==null?void 0:o.renderData)==null?void 0:a.geometryInfo)==null?void 0:l.indices)==null?void 0:c.length)>0},i=(o,a)=>{r(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},s=o=>{var a,l;if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometryInfo&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!((a=o.renderData)!=null&&a.geometryInfo)||(((l=o.renderData.geometryInfo.indices)==null?void 0:l.length)??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometryInfo),r(o)){o.checkGeometryWaterproofness();for(const c of o.children)i(c,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const c of o.children)s(c)},n=o=>{var h;const a=((h=o.parent)==null?void 0:h.visible)??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const p of o.children)n(p)};for(const o of e)s(o),n(o)}get isGlobal(){return this._isGlobal}get shading(){return this._shading}_updateShadingIfChanged(){var r,i,s;((s=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.ground)==null?void 0:s.shading)!==this._shading&&this._updateShading()}_updateShading(){var r,i,s;const e=(s=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.ground)==null?void 0:s.shading;this._shading=e,this.renderer&&(this.renderer.shading=e,this.renderer.setNeedsRender()),this._updateAllTileGeometries()}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(E(this.spatialReference)&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const r=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<r)return e;if(!this.isGlobal)return null;const s=(i+(i<0?r:0))%r;return[e[0],e[1],s]}enableInternalChecks(e){mCt(e)}enableWaterproofnessChecks(e){fCt(e)}};u([d()],Gr.prototype,"_renderer",void 0),u([d({constructOnly:!0})],Gr.prototype,"_scaleRangeQueries",void 0),u([d()],Gr.prototype,"_hasPendingUpdates",void 0),u([d()],Gr.prototype,"_asyncWorkItems",void 0),u([d()],Gr.prototype,"_allTilesDirty",void 0),u([d()],Gr.prototype,"_allTilesSorted",void 0),u([d()],Gr.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],Gr.prototype,"_watchUpdatingTracking",void 0),u([d()],Gr.prototype,"_frameTask",void 0),u([d({readOnly:!0})],Gr.prototype,"snapLevel",null),u([d({readOnly:!0})],Gr.prototype,"lodSnapping",null),u([d({constructOnly:!0})],Gr.prototype,"view",void 0),u([d()],Gr.prototype,"_userClippingExtent",null),u([d()],Gr.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],Gr.prototype,"extent",null),u([d({readOnly:!0})],Gr.prototype,"groundExtent",null),u([d({readOnly:!0})],Gr.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],Gr.prototype,"updating",null),u([d({readOnly:!0})],Gr.prototype,"running",null),u([d(o3t)],Gr.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],Gr.prototype,"updatingProgressValue",null),u([d()],Gr.prototype,"_maxNumUpdating",void 0),u([d()],Gr.prototype,"baseOpacity",null),u([d()],Gr.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],Gr.prototype,"overlayManager",void 0),u([d({readOnly:!0})],Gr.prototype,"viewingMode",null),u([d()],Gr.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],Gr.prototype,"ready",null),u([d({value:vM.FRONT_TO_BACK})],Gr.prototype,"renderOrder",null),u([d({readOnly:!0})],Gr.prototype,"rootTiles",null),u([d()],Gr.prototype,"_rootTiles",void 0),u([d({readOnly:!0})],Gr.prototype,"spatialReference",null),u([d({type:Ot})],Gr.prototype,"backgroundColor",null),u([d({value:!1})],Gr.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],Gr.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],Gr.prototype,"tilingSchemeLocked",null),u([d({readOnly:!0})],Gr.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],Gr.prototype,"velvetOverground",null),u([d()],Gr.prototype,"wireframe",null),u([d({value:!1})],Gr.prototype,"suspended",null),u([d()],Gr.prototype,"textureFadeDuration",null),u([d()],Gr.prototype,"visibleElevationBounds",void 0),u([d()],Gr.prototype,"rootTileElevationBounds",void 0),u([d()],Gr.prototype,"_layerViewsDirty",void 0),u([d()],Gr.prototype,"renderPatchBorders",null),u([d()],Gr.prototype,"visualizeNormals",null),u([d()],Gr.prototype,"renderingDisabled",null),Gr=u([j("esri.views.3d.terrain.TerrainSurface")],Gr);const LRt=Gr;function sye(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function J5e(t){const e=t.children;if(!e[0])return!1;for(const r of e)if(r.shouldLoad)return!0;for(const r of e)if(J5e(r))return!0;return!1}function DRt(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const pu=Zr(),NRt=si(),rF=[0,0,0],$H=new Vr,LH={spatialReference:null,extent:si(),context:"ground"},iF={spatialReference:null,extent:null,scale:0};function nye(t,e,r){var i;for(const s of t){if(!s.containsPointXY(e,r))continue;let n=s;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(r<n.extentMidY?2:0);n=n.children[a]}const o=((i=n==null?void 0:n.renderData)==null?void 0:i.geometryState.samplerData)??null;return tn(e,r,o)}return null}let FRt=class{constructor(e,r,i){this.operation=e,this.geometry=r,this.states=i}},sI=class extends Ke{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},h)=>{let p=!1;if(l===wn.UPDATE){const A=o.get(h);if(A){if(c&la.TRANSFORMATION){const _=this.model.getObject(n);this.model.updateRenderGeometryTransformation(_,a,A)&&(p=!0)}p||r.updates.push({renderGeometry:A,updateType:c})}else Zt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===wn.REMOVE||p){const A=o.get(h);A?(r.removes.push(A),o.delete(h)):l===wn.REMOVE&&Zt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===wn.ADD||p){const A=this.model.getObject(n);if(E(A)){const _=this.model.getRenderGeometry(A,a);r.adds.push(_),o.set(h,_)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(s=>s.forEach(n=>r.push(n)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,wn.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(la.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(la.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(la.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,wn.UPDATE,la.GEOMETRY)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryAdded(r,s,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryRemoved(r,s,i)}shaderTransformationChanged(e){const r=this._residentGeomRecords.get(e.id);r&&r.forEach((i,s)=>{const n=this.model.getObject(s);n&&n.hasVolativeTransformation()&&i.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,r,wn.UPDATE,la.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,wn.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,wn.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,s,n=la.NONE){i=gr(i,this._getParentLayerId(e));const o=e.id,a=r.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){const h=c.operation;h===wn.REMOVE&&s===wn.ADD&&c.states!==la.NONE?c.operation=wn.UPDATE:h===wn.REMOVE&&s===wn.ADD||h===wn.ADD&&s===wn.REMOVE?l.delete(a):h!==wn.UPDATE||s!==wn.REMOVE&&s!==wn.UPDATE?(Zt((h===wn.REMOVE||h===wn.ADD)&&s===wn.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=s,c.states|=n)}else l.set(a,new FRt(s,r,n));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}get _hasDirtyGeometryRecords(){return Ml(this._dirtyGeomRecords,e=>Ml(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}_getParentLayerId(e){return E(e.parentLayer)?e.parentLayer.id:kBe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,s)=>{i.forEach((n,o)=>{r.length>0&&(r+=`
`),r+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,s)=>e.commitLayer(s,r))}}};u([d({constructOnly:!0})],sI.prototype,"model",void 0),u([d()],sI.prototype,"dirty",void 0),sI=u([j("esri.views.3d.webgl-engine.lib.ModelDirtySet")],sI);const kRt=sI;let x8=class extends Ke{constructor(){super(...arguments),this.dirtySet=new kRt({model:this}),this._content=new Map,this._originFactory=new Yne(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;Zt(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),q9(e)&&this.dirtySet.layerAdded(e)}remove(e){Zt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),q9(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const r of e)E(r)&&(Zt(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)Zt(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id),r.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const{shaderTransformer:i,localOrigin:s}=r,n=new yM(r,{boundingInfo:r.boundingInfo,shaderTransformer:i,castShadow:e.castShadow});return n.updateTransformation(o=>e.getCombinedStaticTransformation(r,o)),n.localOrigin=E(s)?s:this._originFactory.getOrigin(n.boundingSphere),n}updateRenderGeometryTransformation(e,r,i){if(N(e))return!1;i.updateTransformation(n=>e.getCombinedStaticTransformation(r,n));const s=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==s}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<Xn.COUNT;++i)e[i]=r.filter(s=>s.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],x8.prototype,"dirtySet",void 0),x8=u([j("esri.views.3d.webgl-engine.parts.Model")],x8);function BRt(){const t=new Float32Array(4);return t[3]=1,t}function K5e(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function URt(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function eNe(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:K5e,create:BRt,createView:eNe,fromValues:URt},Symbol.toStringTag,{value:"Module"}));const bM=1e-6,SO=[0,0,0],sF=[0,0,0];function VRt(t,e){const{data:r,size:i}=t,s=r.length/i;if(s<=0)return;const n=new XRt(t);T8(SO,n.minProj,n.maxProj),j2(SO,SO,.5),Up(sF,n.maxProj,n.minProj);const o=kK(sF),a=new ZRt;a.quality=o,s<14&&(t=new Rt(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],A=[0,0,0],_=[0,0,0],w=[0,0,0];switch(zRt(n,t,w,l,c,h,p,A,_,a)){case 1:return void cye(SO,sF,e);case 2:return void QRt(t,p,e)}GRt(t,w,l,c,h,p,A,_,a),tNe(t,a.b0,a.b1,a.b2,m3,g3);const T=[0,0,0];Up(T,g3,m3),a.quality=kK(T),a.quality<o?rNe(a.b0,a.b1,a.b2,m3,g3,T,e):cye(SO,sF,e)}function zRt(t,e,r,i,s,n,o,a,l,c){return jRt(t,i,s),BK(i,s)<bM?1:(Up(o,i,s),wl(o,o),HRt(e,i,o,n)<bM?2:(Up(a,s,n),wl(a,a),Up(l,n,i),wl(l,l),Vp(r,a,o),wl(r,r),x2(e,r,o,a,l,c),0))}const EO=[0,0,0],CO=[0,0,0],lp=[0,0,0],cp=[0,0,0],up=[0,0,0],X_=[0,0,0],Z_=[0,0,0],J_=[0,0,0];function GRt(t,e,r,i,s,n,o,a,l){qRt(t,e,r,EO,CO),EO[0]!==void 0&&(Up(lp,EO,r),wl(lp,lp),Up(cp,EO,i),wl(cp,cp),Up(up,EO,s),wl(up,up),Vp(X_,cp,n),wl(X_,X_),Vp(Z_,up,o),wl(Z_,Z_),Vp(J_,lp,a),wl(J_,J_),x2(t,X_,n,cp,lp,l),x2(t,Z_,o,up,cp,l),x2(t,J_,a,lp,up,l)),CO[0]!==void 0&&(Up(lp,CO,r),wl(lp,lp),Up(cp,CO,i),wl(cp,cp),Up(up,CO,s),wl(up,up),Vp(X_,cp,n),wl(X_,X_),Vp(Z_,up,o),wl(Z_,Z_),Vp(J_,lp,a),wl(J_,J_),x2(t,X_,n,cp,lp,l),x2(t,Z_,o,up,cp,l),x2(t,J_,a,lp,up,l))}function jRt(t,e,r){let i=BK(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=BK(t.maxVert[n],t.minVert[n]);o>i&&(i=o,s=n)}Lh(e,t.minVert[s]),Lh(r,t.maxVert[s])}const hp=[0,0,0];function HRt(t,e,r,i){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){hp[0]=s[l]-e[0],hp[1]=s[l+1]-e[1],hp[2]=s[l+2]-e[2];const c=r[0]*hp[0]+r[1]*hp[1]+r[2]*hp[2],h=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],p=hp[0]*hp[0]+hp[1]*hp[1]+hp[2]*hp[2]-c*c/h;p>o&&(o=p,a=l)}return Lh(i,s,a),o}const aa=[0,0];function qRt(t,e,r,i,s){YRt(t,e,aa,s,i);const n=sNe(r,e);aa[1]-bM<=n&&(i[0]=void 0),aa[0]+bM>=n&&(s[0]=void 0)}const oye=[0,0,0],aye=[0,0,0],lye=[0,0,0],kS=[0,0,0],BS=[0,0,0],nF=[0,0,0];function x2(t,e,r,i,s,n){if(iNe(e)<bM)return;Vp(oye,r,e),Vp(aye,i,e),Vp(lye,s,e),f3(t,e,aa),BS[1]=aa[0],kS[1]=aa[1],nF[1]=kS[1]-BS[1];const o=[r,i,s],a=[oye,aye,lye];for(let l=0;l<3;++l){f3(t,o[l],aa),BS[0]=aa[0],kS[0]=aa[1],f3(t,a[l],aa),BS[2]=aa[0],kS[2]=aa[1],nF[0]=kS[0]-BS[0],nF[2]=kS[2]-BS[2];const c=kK(nF);c<n.quality&&(Lh(n.b0,o[l]),Lh(n.b1,e),Lh(n.b2,a[l]),n.quality=c)}}const WRt=[0,0,0];function f3(t,e,r){const{data:i,size:s}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*e[0]+i[n+1]*e[1]+i[n+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function YRt(t,e,r,i,s){const{data:n,size:o}=t;Lh(i,n),Lh(s,i),r[0]=sNe(WRt,e),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<r[0]&&(r[0]=l,Lh(i,n,a)),l>r[1]&&(r[1]=l,Lh(s,n,a))}}function cye(t,e,r){Lh(r.center,t),j2(r.halfSize,e,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const vA=[0,0,0],US=[0,0,0],MO=[0,0,0],m3=[0,0,0],g3=[0,0,0],uye=[0,0,0];function QRt(t,e,r){Lh(vA,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?vA[0]=0:Math.abs(e[1])>Math.abs(e[2])?vA[1]=0:vA[2]=0,iNe(vA)<bM&&(vA[0]=vA[1]=vA[2]=1),Vp(US,e,vA),wl(US,US),Vp(MO,e,US),wl(MO,MO),tNe(t,e,US,MO,m3,g3),Up(uye,g3,m3),rNe(e,US,MO,m3,g3,uye,r)}function tNe(t,e,r,i,s,n){f3(t,e,aa),s[0]=aa[0],n[0]=aa[1],f3(t,r,aa),s[1]=aa[0],n[1]=aa[1],f3(t,i,aa),s[2]=aa[0],n[2]=aa[1]}const oF=[0,0,0],bm=[1,0,0,0,1,0,0,0,1],VS=[0,0,0];function rNe(t,e,r,i,s,n,o){bm[0]=t[0],bm[1]=t[1],bm[2]=t[2],bm[3]=e[0],bm[4]=e[1],bm[5]=e[2],bm[6]=r[0],bm[7]=r[1],bm[8]=r[2],JRt(o.quaternion,bm),T8(VS,i,s),j2(VS,VS,.5),j2(o.center,t,VS[0]),j2(oF,e,VS[1]),T8(o.center,o.center,oF),j2(oF,r,VS[2]),T8(o.center,o.center,oF),j2(o.halfSize,n,.5)}const sd=7;let XRt=class{constructor(e){this.minVert=new Array(sd),this.maxVert=new Array(sd);const r=64*sd;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,sd),i+=8*sd,this.maxProj=new Float64Array(this.buffer,i,sd),i+=8*sd;for(let l=0;l<sd;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<sd;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<sd;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(sd),n=new Array(sd),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<sd;++l){let c=s[l];Lh(this.minVert[l],o,c),c=n[l],Lh(this.maxVert[l],o,c)}}},ZRt=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function kK(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function T8(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function Up(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function j2(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function Lh(t,e,r=0){t[0]=e[r+0],t[1]=e[r+1],t[2]=e[r+2]}function Vp(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o}function wl(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function iNe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function BK(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function sNe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function JRt(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*n+n]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+i]+e[3*i+s])*o,t[n]=(e[3*n+i]+e[3*i+n])*o}}const d$=gf(),ax=V(),KRt=V(),eOt=mn();let kWt=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:Vte(this.buffer,56*a+0),halfSize:AOe(this.buffer,56*a+24),quaternion:eNe(this.buffer,56*a+36)}}};function nNe(t=[0,0,0],e=[-1,-1,-1],r=gf()){return{center:In(t),halfSize:m9(e),quaternion:K5e(r)}}function hye(t){return nNe(t.center,t.halfSize,t.quaternion)}function UWt(t,e){Oe(e.center,t.center),Oe(e.halfSize,t.halfSize),qse(e.quaternion,t.quaternion)}function VWt(t,e){return e=e||nNe(),VRt(t,e),e}function T2(t,e){const r=Rs(e,t.center),i=X7(t,e);return r>i?1:r<-i?-1:0}function zWt(t,e){e||(e=Jo());const r=Ese(eOt,t.quaternion),i=t.halfSize[0]*Math.abs(r[0])+t.halfSize[1]*Math.abs(r[3])+t.halfSize[2]*Math.abs(r[6]),s=t.halfSize[0]*Math.abs(r[1])+t.halfSize[1]*Math.abs(r[4])+t.halfSize[2]*Math.abs(r[7]),n=t.halfSize[0]*Math.abs(r[2])+t.halfSize[1]*Math.abs(r[5])+t.halfSize[2]*Math.abs(r[8]);return e[0]=t.center[0]-i,e[1]=t.center[1]-s,e[2]=t.center[2]-n,e[3]=t.center[0]+i,e[4]=t.center[1]+s,e[5]=t.center[2]+n,e}function GWt(t,e){return Rs(e,t.center)-X7(t,e)}function jWt(t,e){return Rs(e,t.center)+X7(t,e)}function HWt(t,e){return T2(t,e[0])<=0&&T2(t,e[1])<=0&&T2(t,e[2])<=0&&T2(t,e[3])<=0&&T2(t,e[4])<=0&&T2(t,e[5])<=0}function qWt(t,e,r,i=0){nT(d$,t.quaternion),Be(ax,e,t.center);const s=I0(ax,ax,d$),n=I0(KRt,r,d$);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(i+t.halfSize[l]-s[l])/n[l],h=(-i-t.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>t.halfSize[l]+i||s[l]<-t.halfSize[l]-i)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function X7(t,e){nT(d$,t.quaternion),I0(ax,e,d$);const r=t.halfSize;return Math.abs(ax[0]*r[0])+Math.abs(ax[1]*r[1])+Math.abs(ax[2]*r[2])}function WWt(t,e){for(let r=0;r<8;++r){const i=e[r];i[0]=1&r?-t.halfSize[0]:t.halfSize[0],i[1]=2&r?-t.halfSize[1]:t.halfSize[1],i[2]=4&r?-t.halfSize[2]:t.halfSize[2],I0(i,i,t.quaternion),ke(i,i,t.center)}}function tOt(t){return gh(t.halfSize)}function rOt(t,e,r,i,s){if(qse(s.quaternion,t.quaternion),i===_t.Global){nT(aF,t.quaternion),I0(K_,t.center,aF),DW(zS,K_),d2e(GS,zS,t.halfSize),Da(GS,zS,GS);const n=st(GS);ke(GS,zS,t.halfSize);const o=st(GS);if(n<r)Oe(s.center,t.center),$e(K_,r,r,r),ke(s.halfSize,t.halfSize,K_);else{const a=o>0?1+e/o:1,l=n>0?1+r/n:1,c=(l+a)/2,h=(l-a)/2;Me(s.halfSize,zS,h),Q2(s.halfSize,s.halfSize,t.halfSize,c),Me(s.center,zS,c),Q2(s.center,s.center,t.halfSize,h),h2e(K_,K_),WB(s.center,s.center,K_),I0(s.center,s.center,s.quaternion)}}else{const n=$e(K_,0,0,1);Q2(s.center,t.center,n,(r+e)/2),nT(aF,t.quaternion),I0(n,n,aF),DW(n,n),Q2(s.halfSize,t.halfSize,n,(r-e)/2)}return s}const K_=V(),zS=V(),GS=V(),aF=gf();let iOt=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];return r}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=sOt(e)}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!e(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=e[n],l=e[o];r[s]=a,r[s+1]=l-a}return r}};function sOt(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let s=1;s<t.length;s++){const n=t[s];r+i===n?i+=1:(e.push(r),e.push(i),r=n,i=1)}return e.push(r),e.push(i),e}let nOt=class{constructor(e,r){this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=r.slice();const i=this.count;this.visibility=new iOt(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return N(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return N(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return N(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((N(this.cachedHighlightRanges)||N(this.cachedDefaultRanges))&&E(this.highlightCounts)){const{highlightRanges:e,defaultRanges:r}=oOt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function oOt(t,e,r){const i=[],s=[];let n=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}let nI=class extends Ke{constructor(){super(...arguments),this.visible=A3.Hidden}};var A3;u([d({autoDestroy:!0})],nI.prototype,"renderable",void 0),u([d({autoDestroy:!0})],nI.prototype,"components",void 0),nI=u([j("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],nI),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(A3||(A3={}));function aOt(t,e,r,i){if(r>=e)return t;t==null&&(t=lOt());const s=t.isVisibleBit;let n=t.data;const o=aNe(n),a=r/o|0,l=r-o*a,c=(e-1)/o|0,h=n,p=i===s;if(!(r<h.length*o)&&p){const _=a+1,w=Math.ceil(h.length*1.5),T=c+1;let C=Math.max(_,w);C=Math.min(C,T),n=new Uint32Array(C),n.set(h)}return a<n.length&&(n[a]=uOt(n[a],l,p)),t.data=n,t}function oNe(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,s=aNe(i);return e<i.length*s?cOt(r,i,e,s):!t.isVisibleBit}function lOt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function cOt(t,e,r,i){const s=r/i|0,n=r-s*i;return hOt(e[s],n)===t}function aNe(t){return t.BYTES_PER_ELEMENT*8}function uOt(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function hOt(t,e){return(t&1<<e)!=0}let dOt=class{constructor(e,r){this._indices=E(e.indices)?e.indices:cM(e.positions.length/3),this._positions=new ks(e.positions),this._components=r,this._componentIntersectionData=new Array(r.count)}getComponentAabb(e,r){if(E(this._perComponentAabbs)){for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*e+i];return r}return this._computePerComponentAabbs(),this.getComponentAabb(e,r)}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions.typedBuffer,r.stride=this._positions.typedBufferStride,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,s,n,o,a){const l=new Rt(this._positions.typedBuffer,3,!1,this._positions.typedBufferStride),c=this._indices,h=this._components.offsets,p=p$e(e,r,pOt),A=e[2],_=r[2];this._components.visibility.forEachComponent(w=>{if(!oNe(this._components.pickability,w))return!0;const T=this.getComponentAabb(w,fOt);if(E(o)){const L=o[w];E(n)?n.componentOffset=L:(e[2]=A-L,r[2]=_-L)}if(E(n)&&n.applyToAabb(T),!wne(T,e,p,i))return!0;const C=h[w]/3,M=h[w+1]/3,O=M-C,$=(L,k,F)=>a(w,L,Ph(k,k,s),F);return N(n)&&O>X5e?(this._componentIntersectionData[w]==null&&(this._componentIntersectionData[w]=new Ooe(this._indices,C,M,l)),this._componentIntersectionData[w].intersectRay({r0:e,r1:r},$)):jL(e,r,C,M,c,l,void 0,n,$),!0})}_computePerComponentAabbs(){const e=this._components.count;this._perComponentAabbs=new Float32Array(6*e);const r=this._indices,i=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,A=1/0,_=-1/0,w=-1/0,T=-1/0;for(let C=l;C<c;C++){const M=r[C]*s,O=i[M],$=i[M+1],L=i[M+2];h=Math.min(h,O),p=Math.min(p,$),A=Math.min(A,L),_=Math.max(_,O),w=Math.max(w,$),T=Math.max(T,L)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=A,this._perComponentAabbs[o++]=_,this._perComponentAabbs[o++]=w,this._perComponentAabbs[o++]=T}}get positions(){return this._positions}get indices(){return this._indices}};const pOt=V(),fOt=Jo();let mOt=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},gOt=class{constructor(e,r,i,s){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=s}dispose(){this.vao.dispose()}},AOt=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function yOt(t,e){return{near:t,far:e}}function eD(t){return t?j4(t,1/0,-1/0):yOt(1/0,-1/0)}function j4(t,e,r){return t.near=e,t.far=r,t}function wM(t,e,r=t){return e!=null&&(r.near=Math.min(t.near,e.near),r.far=Math.max(t.far,e.far)),r}function lF(t,e){return t.near<=e&&e<=t.far}const UK={near:0,far:0};function _Ot(t,e){const r=eD(),{eye:i,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=E(o.offsetObb)?o.offsetObb:o.obb,l=He(Da(hd,a.center,i),n),c=X7(a,n);if(lF(r,l-c)&&lF(r,l+c))return;const h=TOt(a,s);if(h===-1)return;if(h===0)return bA.far=l+c,bA.near=l-c,void wM(r,bA);const p=cF.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<cF.length;o++){const a=cF.data[o];if(lF(r,a.near)&&lF(r,a.far))continue;bA.far=a.far,bA.near=1/0,xOt(E(a.object.offsetObb)?a.object.offsetObb:a.object.obb,i,vOt,c=>{let h=bOt;for(let p=0;p<lNe&&c.length>0;p++){if(!(a.mask&1<<p))continue;wOt(s[p],c,h);const A=c;c=h,h=A}for(let p=0;p<c.length;p+=3){$e(Cu,c.data[p+0],c.data[p+1],c.data[p+2]);const A=He(Da(Cu,Cu,i),n);bA.near=Math.min(bA.near,A)}})===0&&(bA.near=0),wM(r,bA)}return cF.length=0,r}const cF=new Vr({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=Px(t.object),t)}),bA=eD(),Cu=V(),Tw=V(),vOt=new Vr({deallocator:null}),bOt=new Vr({deallocator:null});function wOt(t,e,r){r.length=0;const i=e.length-3;DH(Cu,e,i);const s=Rs(t,Cu);s<=0&&(r.push(Cu[0]),r.push(Cu[1]),r.push(Cu[2]));let n=0,o=s;for(;n<i;n+=3){DH(Tw,e,n);const a=Rs(t,Tw);o*a<0&&(fo(Cu,Tw,Cu,a/(a-o)),Mu(r,Cu)),a<=0&&Mu(r,Tw),o=a,Oe(Cu,Tw)}o*s<0&&(DH(Tw,e,i),fo(Cu,Tw,Cu,s/(s-o)),Mu(r,Cu))}function DH(t,e,r){return $e(t,e.data[r+0],e.data[r+1],e.data[r+2])}function Mu(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function xOt(t,e,r,i){nT(pye,t.quaternion),Da(hd,e,t.center),I0(hd,hd,pye);const s=8*((hd[0]<-t.halfSize[0]?-1:hd[0]>t.halfSize[0]?1:0)+3*(hd[1]<-t.halfSize[1]?-1:hd[1]>t.halfSize[1]?1:0)+9*(hd[2]<-t.halfSize[2]?-1:hd[2]>t.halfSize[2]?1:0)+13),n=dye[s];if(n===0)return n;Ese(uF,t.quaternion),Sse(uF,uF,t.halfSize);const o=(a,l)=>{const c=dye[s+l+1];return $e(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Ph(a,a,uF),ke(a,t.center,a)};return r.length=0,Mu(r,o(NH,0)),Mu(r,o(fye,1)),Mu(r,o(hd,2)),Mu(r,o(mye,3)),i(r),n===1||(r.length=0,Mu(r,NH),Mu(r,mye),Mu(r,o(hd,4)),Mu(r,o(gye,5)),i(r),n===2||(r.length=0,Mu(r,NH),Mu(r,gye),Mu(r,o(hd,6)),Mu(r,fye),i(r))),n}const dye=(()=>{const t=new Int8Array(216);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),lNe=4;function TOt(t,e){let r=0;for(let i=0;i<lNe;i++){const s=T2(t,e[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const uF=mn(),pye=gf(),hd=V(),NH=V(),fye=V(),mye=V(),gye=V();let SOt=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?_Ot(e,this._objects.visibleObjects):null}};function EOt(t){const e=gn().vec3f(B.POSITION);return t.normals&&e.vec2i16(B.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===co.Default?e.vec2f(B.UV0):t.textureCoordinates===co.Atlas&&(e.vec2f(B.UV0),e.vec4u16(B.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(B.COLOR,{glNormalized:!0}),e.alignTo(4)}let COt=class{constructor(){this.externalColor=Zr(),this.externalColorMixMode=qo.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},MOt=class extends kn{constructor(e,r){super(e,"int",As.Draw,(i,s,n)=>i.setUniform1i(e,r(s,n)))}};var Cg;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Cg||(Cg={}));const Poe=429496.7296;function cNe(t,e){R4(t/Poe*.5+.5,e)}function ROt(t,e){switch(e.componentData){case Cg.Varying:return OOt(t,e);case Cg.Uniform:return POt(t);case Cg.COUNT:return;default:e.componentData}}function OOt(t,e){const{vertex:r,fragment:i}=t;r.include(qh),r.uniforms.add(zv("componentColorTex",n=>n.componentParameters.texture.texture,e.hasWebGL2Context?is.None:is.Size)),t.attributes.add(B.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===ee.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(DLe),r.constants.add("elevationScale","float",2*Poe),r.constants.add("stride","float",Le("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(I`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${Qp(e,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `),r.code.add(I`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${Wc(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${Wc(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?I`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${Wc(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:I`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(I`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?I`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function POt(t){const{vertex:e,fragment:r}=t;e.uniforms.add(new aB("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new MOt("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(I`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(I`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var jp;function IOt(t,e){const r=t.vertex;switch(r.code.add(I`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case jp.None:r.code.add(I`#define vertexDiscardByOpacity(_opacity_) {}`);break;case jp.Opaque:r.code.add(I`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case jp.Transparent:r.code.add(I`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(jp||(jp={}));var Mg;function sYt(t){return t&&Gg(t)?Mg.Mars:t&&jg(t)?Mg.Moon:Mg.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Mg||(Mg={}));var Md;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Md||(Md={}));let fi=class extends fc{constructor(){super(...arguments),this.output=ee.Color,this.textureCoordinateType=co.None,this.componentData=Cg.Uniform,this.cullFace=$s.Back,this.vertexDiscardMode=jp.None,this.doubleSidedMode=Cn.WindingOrder,this.alphaDiscardMode=ms.Opaque,this.integratedMeshMode=Md.None,this.transparencyPassType=lr.NONE,this.ellipsoidMode=Mg.Earth,this.pbrMode=Qt.Disabled,this.normalType=cs.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.useLegacyTerrainShading=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.hasWebGL2Context=!1}};u([ie({count:ee.COUNT})],fi.prototype,"output",void 0),u([ie({count:co.COUNT})],fi.prototype,"textureCoordinateType",void 0),u([ie({count:Cg.COUNT})],fi.prototype,"componentData",void 0),u([ie({count:$s.COUNT})],fi.prototype,"cullFace",void 0),u([ie({count:jp.COUNT})],fi.prototype,"vertexDiscardMode",void 0),u([ie({count:Cn.COUNT})],fi.prototype,"doubleSidedMode",void 0),u([ie({count:ms.COUNT})],fi.prototype,"alphaDiscardMode",void 0),u([ie({count:Md.COUNT})],fi.prototype,"integratedMeshMode",void 0),u([ie({count:lr.COUNT})],fi.prototype,"transparencyPassType",void 0),u([ie({count:Mg.COUNT})],fi.prototype,"ellipsoidMode",void 0),u([ie({count:Qt.COUNT})],fi.prototype,"pbrMode",void 0),u([ie({count:cs.COUNT})],fi.prototype,"normalType",void 0),u([ie()],fi.prototype,"spherical",void 0),u([ie()],fi.prototype,"doublePrecisionRequiresObfuscation",void 0),u([ie()],fi.prototype,"hasVertexColors",void 0),u([ie()],fi.prototype,"hasNormals",void 0),u([ie()],fi.prototype,"hasSlicePlane",void 0),u([ie()],fi.prototype,"hasBaseColorTexture",void 0),u([ie()],fi.prototype,"receiveAmbientOcclusion",void 0),u([ie()],fi.prototype,"receiveShadows",void 0),u([ie()],fi.prototype,"blendingEnabled",void 0),u([ie()],fi.prototype,"hasScreenSpaceReflections",void 0),u([ie()],fi.prototype,"hasPolygonOffset",void 0),u([ie()],fi.prototype,"hasMetallicRoughnessTexture",void 0),u([ie()],fi.prototype,"hasEmissionTexture",void 0),u([ie()],fi.prototype,"hasOcclusionTexture",void 0),u([ie()],fi.prototype,"hasNormalTexture",void 0),u([ie()],fi.prototype,"hasOccludees",void 0),u([ie()],fi.prototype,"hasMultipassTerrain",void 0),u([ie()],fi.prototype,"cullAboveGround",void 0),u([ie()],fi.prototype,"useLegacyTerrainShading",void 0),u([ie()],fi.prototype,"hasCloudsReflections",void 0),u([ie()],fi.prototype,"snowCover",void 0),u([ie()],fi.prototype,"objectAndLayerIdColor",void 0),u([ie()],fi.prototype,"hasWebGL2Context",void 0),u([ie({constValue:As.Draw})],fi.prototype,"pbrTextureBindType",void 0),u([ie({constValue:!0})],fi.prototype,"hasSliceHighlight",void 0),u([ie({constValue:!1})],fi.prototype,"hasSliceInVertexProgram",void 0),u([ie({constValue:!1})],fi.prototype,"useCustomDTRExponentForWater",void 0),u([ie({constValue:!1})],fi.prototype,"hasVertexTangents",void 0),u([ie({constValue:!0})],fi.prototype,"supportsTextureAtlas",void 0),u([ie({constValue:!1})],fi.prototype,"highStepCount",void 0),u([ie({constValue:!1})],fi.prototype,"instancedDoublePrecision",void 0),u([ie({constValue:!0})],fi.prototype,"useFillLights",void 0),u([ie({constValue:!1})],fi.prototype,"objectAndLayerIdColorInstanced",void 0);function Aye(t,e){t.include($T,e),t.fragment.include(F4);const r=t.fragment;r.uniforms.add(new aB("baseColor",i=>i.baseColor)),r.uniforms.add(new wx("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(I`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(I`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(I`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function yye(t,e){const r=t.fragment;switch(e.doubleSidedMode){case Cn.None:r.code.add(I`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Cn.View:t.include(r3,e),r.code.add(I`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Cn.WindingOrder:r.code.add(I`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Cn.COUNT:}switch(e.normalType){case cs.Attribute:case cs.CompressedAttribute:t.include($7,e),r.code.add(I`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case cs.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.include(r3,e),r.code.add(I`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case cs.Ground:e.spherical?(t.include(r3,e),r.code.add(I`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(I`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),t.extensions.add("GL_OES_standard_derivatives"),r.code.add(I`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case cs.COUNT:}}function $Ot(t,e){const r=t.fragment;if(e.hasBaseColorTexture&&(e.output===ee.Color||e.alphaDiscardMode!==ms.Opaque)){t.include(Ase,e);const i=e.textureCoordinateType===co.Atlas;r.uniforms.add(zv("baseColorTexture",s=>s.texture,i?e.hasWebGL2Context?is.None:is.Size:is.None)),i?(t.include(wOe),r.code.add(I`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${Qp(e,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):r.code.add(I`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else r.code.add(I`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function LOt(t){const e=new Di;e.include(r3,t),e.include($7,t),e.include($T,t),e.include(Sg,t),e.include(XM,t),e.include(ROt,t),e.include(Bbt,t),e.include($yt,t),e.include($Ot,t),e.include(IOt,t);const{vertex:r,fragment:i}=e;t.pbrMode!==Qt.Normal&&t.pbrMode!==Qt.Schematic||(e.include(_se,t),t.hasNormalTexture&&e.include(BLe,t));const s=t.output===ee.Shadow||t.output===ee.ShadowHighlight||t.output===ee.ShadowExcludeHighlight;s&&t.componentData===Cg.Varying?r.code.add(I`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(I`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===Md.ColorOverlay||t.integratedMeshMode===Md.ColorOverlayWithWater,o=n&&t.output===ee.Color&&t.pbrMode===Qt.WaterOnIntegratedMesh;return n&&(e.include(hT,t),e.include(hMt,t),t.spherical?r.code.add(I`
      const float invEllipsoidRadius = ${I.float(1/(t.ellipsoidMode===Mg.Earth?gi.radius:t.ellipsoidMode===Mg.Mars?_g.radius:Dy.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(I`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(I`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===ee.ObjectAndLayerIdColor?I`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${I.float(Il)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===ee.ObjectAndLayerIdColor?I`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?I`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:I`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?I`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===ee.Alpha&&(i.include(Wd),e.include(Yd,t),e.include(Aye,t),n&&i.uniforms.add(new mr("ovColorTex",(a,l)=>LK(a,l))),i.code.add(I`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?I`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?I`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),t.output===ee.Color&&(i.include(Wd),e.include(Yd,t),e.include(Aye,t),e.include(yye,t),e.include(hT,t),t.receiveShadows?(e.include(L7,t),i.code.add(I`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(I`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new mr("ovColorTex",(a,l)=>LK(a,l))),i.code.add(I`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?I`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?I`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===Qt.Normal||t.pbrMode===Qt.Schematic?(Yg(i),i.code.add(I`
        ${t.pbrMode===Qt.Normal?I`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(I`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(I`vec3 shadingNormal = normalVertex;`),i.code.add(I`${t.spherical?I`vec3 normalGround = normalize(positionWorld());`:I`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(I`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?I`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?I` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?i.code.add(I`float shadow = evaluateShadow();`):t.spherical?(nR(i),i.code.add(I`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(I`float shadow = 0.0;`),o&&i.uniforms.add(new mr("ovNormalTex",(a,l)=>Ioe(l))),t.snowCover&&(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(I`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),i.code.add(I`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?I` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?I`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(I`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===lr.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),(t.output===ee.Depth||s)&&(e.include(Hy,t),i.code.add(I`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===ee.Normal&&(e.include(yye,t),i.code.add(I`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===cs.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===ee.ObjectAndLayerIdColor&&e.fragment.code.add(I`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?I`gl_FragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===ee.Highlight&&(e.include(a_,t),i.code.add(I`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?I`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function Ioe(t){return t.overlays.length===0?null:t.overlays[dn.INNER].getValidTexture(Pn.Water)}const DOt=Object.freeze(Object.defineProperty({__proto__:null,build:LOt,getOverlayNormalTexture:Ioe},Symbol.toStringTag,{value:"Module"}));let uNe=class hNe extends Vi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2,r.spherical=e.viewingMode===_t.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Fi(e.rctx,hNe.shader.get().build(this.configuration),dNe)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==Md.None,s=e===lr.NONE,n=e===lr.FrontFace;return Rr({blending:r.output!==ee.Color&&r.output!==ee.Alpha||!r.blendingEnabled?null:s?zd:l_(e),culling:KU(r.cullFace),depthTest:{func:Ib(e)},depthWrite:s||n?qu:null,colorWrite:zr,stencilWrite:i||r.hasOccludees?Vg:null,stencilTest:i?xvt(Bu.IntegratedMeshMaskExcluded):r.hasOccludees?$b:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:C7})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};uNe.shader=new Ni(DOt,()=>be(()=>import("./ComponentShader.glsl-d76d4e90.js"),[]));const dNe=new Map([[B.POSITION,0],[B.NORMAL,1],[B.NORMALCOMPRESSED,1],[B.COLOR,2],[B.UV0,3],[B.UVREGION,4],[B.COMPONENTINDEX,5]]);let NOt=class extends ys{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},$oe=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Rn(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(n){const o=this[i];if(o==null)this[i]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(s){this[i]!==s&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=s,this._setDirty())}})}}function _ye(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let Z7=class{constructor(e){this._low=Ks(),this._high=Ks(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){const r=this._low,i=this._high;Oe(r,e),Da(i,e,r)}setElements(e,r,i){$e(vye,e,r,i),this.set(vye)}get(e){return ke(e,this._low,this._high)}getLowScaled(e){return Me(e,this._low,1)}};const vye=V();let Ea=class extends NOt{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=Y0(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Ji(1,1,.5),this.emissiveFactor=Ji(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new S8,this.componentParameters=new p$,this.textureAlphaCutoff=z9,this.alphaDiscardMode=ms.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Mg.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new fi;const i=new Z7(e.position),s=ULe(e.rotationScale);RT(s,s),this.transformNormalGlobalFromModel=df(s,s),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=en(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return E(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return E(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return E(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return E(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return E(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=E(this.metallicRoughnessTexture),n.hasEmissionTexture=E(this.emissionTexture),n.hasOcclusionTexture=E(this.occlusionTexture),n.hasNormalTexture=E(this.normalTexture),n.transparencyPassType=r.identifier===Rh.Material&&i.transparencyPassType!=null?i.transparencyPassType:lr.NONE,n.hasMultipassTerrain=r.identifier===Rh.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,n.cullAboveGround=r.identifier===Rh.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Cn.View:Cn.None,n.hasBaseColorTexture=E(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===kc.Transparent||o===kc.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?kOt(i)?Ioe(i)?Md.ColorOverlayWithWater:Md.ColorOverlay:Md.NoOverlay:Md.None,n.useLegacyTerrainShading=this.isIntegratedMesh&&Qi.TERRAIN_USE_LEGACY_SHADING,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&N(this.baseColorTexture);if(n.pbrMode=n.integratedMeshMode===Md.ColorOverlayWithWater?Qt.WaterOnIntegratedMesh:this.usePBR?a?Qt.Schematic:Qt.Normal:Qt.Disabled,n.normalType=n.integratedMeshMode===Md.None?n.hasNormals?cs.CompressedAttribute:cs.ScreenDerivative:cs.Ground,n.hasSlicePlane=E(i.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,r.identifier===Rh.ShadowMap)n.output=ee.Shadow,n.vertexDiscardMode=jp.None;else if(r.identifier===Rh.Highlight)n.output=ee.Highlight,n.vertexDiscardMode=jp.None;else{switch(this._computeWhichMaterialPass()===kc.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?jp.Opaque:jp.Transparent:n.vertexDiscardMode=jp.None,n.output=r.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,r.output){case ee.Color:n.receiveAmbientOcclusion=i.ssaoHelper.active,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.enabled,n.hasCloudsReflections=E(i.cloudsFade.data);break;case ee.Alpha:n.hasOccludees=i.hasOccludees;break;case ee.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(uNe,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return E(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case kc.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case kc.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case kc.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case kc.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),FOt(r)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==ua.None;h&&e.shadowMap.submitDraw(this,s,a,o),E(l)&&(e.highlight.submitDraw(this,s,l,o),h&&e.highlightShadowMap.submitDraw(this,s,l,o)),h&&E(c)&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?kc.IntegratedMesh:this.objectOpacity<1?kc.Transparent:this.componentParameters.opaqueOverride===ua.All?kc.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===ms.Blend||this.alphaDiscardMode===ms.MaskBlend?kc.Transparent:this.componentParameters.transparent===ua.None?kc.Opaque:this.componentParameters.transparent===ua.All?kc.Transparent:kc.OpaqueAndTransparent}};var kc,ua;u([Rn({vectorOps:v2e})],Ea.prototype,"baseColor",void 0),u([Rn()],Ea.prototype,"usePBR",void 0),u([Rn()],Ea.prototype,"hasParametersFromSource",void 0),u([Rn({vectorOps:Tce})],Ea.prototype,"mrrFactors",void 0),u([Rn({vectorOps:Tce})],Ea.prototype,"emissiveFactor",void 0),u([Rn({dispose:!0})],Ea.prototype,"baseColorTexture",void 0),u([Rn({dispose:!0})],Ea.prototype,"metallicRoughnessTexture",void 0),u([Rn({dispose:!0})],Ea.prototype,"emissionTexture",void 0),u([Rn({dispose:!0})],Ea.prototype,"occlusionTexture",void 0),u([Rn({dispose:!0})],Ea.prototype,"normalTexture",void 0),u([Rn()],Ea.prototype,"objectOpacity",void 0),u([_ye()],Ea.prototype,"commonMaterialParameters",void 0),u([_ye()],Ea.prototype,"componentParameters",void 0),u([Rn()],Ea.prototype,"textureAlphaCutoff",void 0),u([Rn()],Ea.prototype,"alphaDiscardMode",void 0),u([Rn()],Ea.prototype,"isIntegratedMesh",void 0),u([Rn()],Ea.prototype,"polygonOffsetEnabled",void 0),u([Rn()],Ea.prototype,"ellipsoidMode",void 0),u([Rn()],Ea.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(kc||(kc={}));let S8=class extends $oe{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=$s.Back,this.hasSlicePlane=!0}};u([Rn()],S8.prototype,"doubleSided",void 0),u([Rn()],S8.prototype,"cullFace",void 0),u([Rn()],S8.prototype,"hasSlicePlane",void 0);let p$=class extends $oe{constructor(){super(...arguments),this.externalColor=Nr(1,1,1,1),this.externalColorMixMode=qo.Multiply,this.castShadows=ua.All}get transparent(){return this.externalColor[3]<1?ua.All:ua.None}get opaqueOverride(){return this.externalColorMixMode===qo.Replace&&this.externalColor[3]===1?ua.All:ua.None}get visible(){return this.externalColor[3]>0?ua.All:ua.None}get type(){return Cg.Uniform}};u([Rn({vectorOps:v2e})],p$.prototype,"externalColor",void 0),u([Rn()],p$.prototype,"externalColorMixMode",void 0),u([Rn()],p$.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(ua||(ua={}));let oI=class extends $oe{constructor(){super(...arguments),this.texture=null,this.transparent=ua.None,this.opaqueOverride=ua.None,this.castShadows=ua.None}get type(){return Cg.Varying}};function FOt(t){return t.overlays.length!==0&&E(t.overlays[dn.INNER].getValidTexture(Pn.Highlight))}function kOt(t){return t.overlays.length!==0&&E(t.overlays[dn.INNER].getColorTextureNoRasterImage())}u([Rn()],oI.prototype,"texture",void 0),u([Rn()],oI.prototype,"transparent",void 0),u([Rn()],oI.prototype,"opaqueOverride",void 0),u([Rn()],oI.prototype,"castShadows",void 0);const uB=gn().vec3f(B.POSITION).u16(B.COMPONENTINDEX).u16(B.U16PADDING),pNe=gn().vec2u8(B.SIDENESS),BOt=Wh(pNe),fNe=gn().vec3f(B.POSITION0).vec3f(B.POSITION1).u16(B.COMPONENTINDEX).u8(B.VARIANTOFFSET,{glNormalized:!0}).u8(B.VARIANTSTROKE).u8(B.VARIANTEXTENSION,{glNormalized:!0}).u8(B.U8PADDING,{glPadding:!0}).u16(B.U16PADDING,{glPadding:!0}),VK=fNe.clone().vec3f(B.NORMAL),zK=fNe.clone().vec3f(B.NORMALA).vec3f(B.NORMALB),mNe=new Map([[B.POSITION0,0],[B.POSITION1,1],[B.COMPONENTINDEX,2],[B.VARIANTOFFSET,3],[B.VARIANTSTROKE,4],[B.VARIANTEXTENSION,5],[B.NORMAL,6],[B.NORMALA,6],[B.NORMALB,7],[B.SIDENESS,8]]);function bye(t,e,r){const i=e/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(M,O)=>{M<O?s[M+1]++:n[O+1]++};for(let M=0;M<i;M++){const O=t[3*M],$=t[3*M+1],L=t[3*M+2];o(O,$),o($,L),o(L,O)}let a=0,l=0;for(let M=0;M<r;M++){const O=s[M+1],$=n[M+1];s[M+1]=a,n[M+1]=l,a+=O,l+=$}const c=new Uint32Array(6*i),h=s[r],p=(M,O,$)=>{if(M<O){const L=s[M+1]++;c[2*L]=O,c[2*L+1]=$}else{const L=n[O+1]++;c[2*h+2*L]=M,c[2*h+2*L+1]=$}};for(let M=0;M<i;M++){const O=t[3*M],$=t[3*M+1],L=t[3*M+2];p(O,$,M),p($,L,M),p(L,O,M)}const A=(M,O)=>{const $=2*M,L=O-M;for(let k=1;k<L;k++){const F=c[$+2*k],G=c[$+2*k+1];let z=k-1;for(;z>=0&&c[$+2*z]>F;z--)c[$+2*z+2]=c[$+2*z],c[$+2*z+3]=c[$+2*z+1];c[$+2*z+2]=F,c[$+2*z+3]=G}};for(let M=0;M<r;M++)A(s[M],s[M+1]),A(h+n[M],h+n[M+1]);const _=new Int32Array(3*i),w=(M,O)=>M===t[3*O]?0:M===t[3*O+1]?1:M===t[3*O+2]?2:-1,T=(M,O)=>{const $=w(M,O);_[3*O+$]=-1},C=(M,O,$,L)=>{const k=w(M,O);_[3*O+k]=L;const F=w($,L);_[3*L+F]=O};for(let M=0;M<r;M++){let O=s[M];const $=s[M+1];let L=n[M];const k=n[M+1];for(;O<$&&L<k;){const F=c[2*O],G=c[2*h+2*L];F===G?(C(M,c[2*O+1],G,c[2*h+2*L+1]),O++,L++):F<G?(T(M,c[2*O+1]),O++):(T(G,c[2*h+2*L+1]),L++)}for(;O<$;)T(M,c[2*O+1]),O++;for(;L<k;)T(c[2*h+2*L],c[2*h+2*L+1]),L++}return _}let gNe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?VOt:UOt}write(e,r,i){const s=this._edgeHashFunction(i);dF.seed=s;const n=dF.getIntRange(0,255),o=dF.getIntRange(0,this.settings.variants-1),a=.7,l=dF.getFloat(),c=255*(.5*zOt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,n),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const Loe=new Float32Array(6),hB=new Uint32Array(Loe.buffer),Ev=new Uint32Array(1);function UOt(t){const e=Loe;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],Ev[0]=5381;for(let r=0;r<hB.length;r++)Ev[0]=31*Ev[0]+hB[r];return Ev[0]}function VOt(t){const e=Loe;e[0]=jS(t.position0[0]),e[1]=jS(t.position0[1]),e[2]=jS(t.position0[2]),e[3]=jS(t.position1[0]),e[4]=jS(t.position1[1]),e[5]=jS(t.position1[2]),Ev[0]=5381;for(let r=0;r<hB.length;r++)Ev[0]=31*Ev[0]+hB[r];return Ev[0]}const wye=1e4;function jS(t){return Math.round(t*wye)/wye}function zOt(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let dB=class{constructor(){this._commonWriter=new gNe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return VK.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),ke(hF,i.faceNormal0,i.faceNormal1),qe(hF,hF),e.normal.setVec(r,hF)}trim(e,r){return this._commonWriter.trim(e,r)}};dB.Layout=VK,dB.glLayout=Wh(VK,1);let pB=class{constructor(){this._commonWriter=new gNe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return zK.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),e.normalA.setVec(r,i.faceNormal0),e.normalB.setVec(r,i.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};pB.Layout=zK,pB.glLayout=Wh(zK,1);const hF=V(),dF=new _I,S2=-1;var fB;function GOt(t,e,r,i=QOt){const s=t.vertices.position,n=t.vertices.componentIndex,o=$r(i.anglePlanar),a=$r(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=GK.edge,p=h.position0,A=h.position1,_=h.faceNormal0,w=h.faceNormal1,T=YOt(t),C=WOt(t),M=C.length/4,O=e.allocate(M);let $=0;const L=M,k=r.allocate(L);let F=0,G=0,z=0;const Z=H9e(0,M),J=new Float32Array(M);J.forEach((ye,le,W)=>{s.getVec(C[4*le+0],p),s.getVec(C[4*le+1],A),W[le]=Is(p,A)}),Z.sort((ye,le)=>J[le]-J[ye]);const te=new Array,re=new Array;for(let ye=0;ye<M;ye++){const le=Z[ye],W=J[le],q=C[4*le+0],X=C[4*le+1],se=C[4*le+2],ae=C[4*le+3],fe=ae===S2;if(s.getVec(q,p),s.getVec(X,A),fe)$e(_,T[3*se+0],T[3*se+1],T[3*se+2]),Oe(w,_),h.componentIndex=n.get(q),h.cosAngle=He(_,w);else{if($e(_,T[3*se+0],T[3*se+1],T[3*se+2]),$e(w,T[3*ae+0],T[3*ae+1],T[3*ae+2]),h.componentIndex=n.get(q),h.cosAngle=He(_,w),HOt(h,c))continue;h.cosAngle<-.9999&&Oe(w,_)}G+=W,z++,fe||jOt(h,l)?(e.write(O,$++,h),te.push(W)):qOt(h,o)&&(r.write(k,F++,h),re.push(W))}const Ae=new Float32Array(te.reverse()),ve=new Float32Array(re.reverse());return{regular:{instancesData:e.trim(O,$),lodInfo:{lengths:Ae}},silhouette:{instancesData:r.trim(k,F),lodInfo:{lengths:ve}},averageEdgeLength:G/z}}function jOt(t,e){return t.cosAngle<e}function HOt(t,e){return t.cosAngle>e}function qOt(t,e){const r=Zo(t.cosAngle),i=GK.fwd,s=GK.ortho;return Yy(i,t.position1,t.position0),r*(He(Xt(s,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function WOt(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let s=0;for(let a=0;a<e;a++){const l=i[3*a+0],c=i[3*a+1],h=i[3*a+2],p=r[3*a+0],A=r[3*a+1],_=r[3*a+2];s+=l===S2||p<A?1:0,s+=c===S2||A<_?1:0,s+=h===S2||_<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<e;a++){const l=i[3*a+0],c=i[3*a+1],h=i[3*a+2],p=r[3*a+0],A=r[3*a+1],_=r[3*a+2];(l===S2||p<A)&&(n[o++]=p,n[o++]=A,n[o++]=a,n[o++]=l),(c===S2||A<_)&&(n[o++]=A,n[o++]=_,n[o++]=a,n[o++]=c),(h===S2||_<p)&&(n[o++]=_,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function YOt(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,s=FH.v0,n=FH.v1,o=FH.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l+0],h=i[3*l+1],p=i[3*l+2];r.getVec(c,s),r.getVec(h,n),r.getVec(p,o),Be(n,n,s),Be(o,o,s),Xt(s,n,o),qe(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(fB||(fB={}));const GK={edge:{position0:V(),position1:V(),faceNormal0:V(),faceNormal1:V(),componentIndex:0,cosAngle:0},ortho:V(),fwd:V()},FH={v0:V(),v1:V(),v2:V()},QOt={anglePlanar:4,angleSignificantEdge:35};function XOt(t){const e=ZOt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return xye.updateSettings(t.writerSettings),Tye.updateSettings(t.writerSettings),GOt(e,xye,Tye)}function ZOt(t,e,r,i){if(e){const o=bye(r,i,t.count);return new JOt(r,i,o,t)}const s=rK(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),n=bye(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:uB.createView(s.buffer)}}let JOt=class{constructor(e,r,i,s){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=s}};const xye=new dB,Tye=new pB,AYt=gn().vec3f(B.POSITION0).vec3f(B.POSITION1),KOt=gn().vec3f(B.POSITION0).vec3f(B.POSITION1).u16(B.COMPONENTINDEX).u16(B.U16PADDING,{glPadding:!0});let ePt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},tPt=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0,this._texture=new Wt(this._rctx,{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.NEAREST,wrapMode:pr.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this._data=new uc(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,s,n,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,r,i,s){const n=e*this._fieldCount+r;this._dirty=!0,this._data.set(n,i,s)}resizeToFit(e){const r=e*this._fieldCount;if(r>=this._data.count){const i=Math.ceil((r+1)/this.textureWidth)*this.textureWidth,s=new uc(new ArrayBuffer(4*i));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const ANe=65536;let rPt=class{constructor(e,r=1){this.textureBuffer=new tPt(e,r),this._indexManager=new ePt(ANe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},yNe=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>ANe)return null;const r=new rPt(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const Sye=we.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class iPt{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._objects=[new Vr,new Vr],this._renderSubmit=new SOt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=Le("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new yNe(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){Zt(this._objects[A3.Hidden].length===0&&this._objects[A3.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(e){const r=new nI;return r.toMapSpace=e.toMapSpace,r.transform=e.transform,r.obb=hye(e.obb),r.components=new nOt(this._componentBufferManager,e.geometry.componentOffsets),r.renderable=this._createRenderable(e,r.components),r.intersectionGeometry=new dOt(e.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(e){const r=e;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=cl(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new COt,c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let A=0,_=0,w=0,T=n.verticalOffsets,C=1/0,M=-1/0,O=!1,$=!1,L=0;for(let k=0;k<n.count;k++){r(k,l),A+=+(l.externalColor[3]<1),_+=+(l.externalColorMixMode===qo.Replace&&l.externalColor[3]===1),w+=+l.castShadows,LLe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[k],0,h[0],h[1],h[2],h[3]),O||(O=k>0&&L!==p[0]),L=p[0],$||($=l.elevationOffset!==0),$&&N(T)&&(T=new Array(k).fill(0)),E(T)&&(T[k]=l.elevationOffset),C=Math.min(C,l.elevationOffset),M=Math.max(M,l.elevationOffset),cNe(l.elevationOffset,h),c.setData(a[k],1,h[0],h[1],h[2],h[3]);const F=l.objectAndLayerIdColor;E(F)&&c.setData(a[k],2,F[0],F[1],F[2],F[3]),l.pickable!==oNe(n.pickability,k)&&(n.pickability=aOt(n.pickability,n.count,k,l.pickable))}n.verticalOffsets=$?T:null,i.offsetObb=$?rOt(i.obb,C,M,this._viewingMode,E(i.offsetObb)?i.offsetObb:hye(i.obb)):null,O||$||this._hasObjectAndLayerId?(s.componentParameters=new oI,s.componentParameters.castShadows=kH(w,n.count),s.componentParameters.transparent=kH(A,n.count),s.componentParameters.opaqueOverride=kH(_,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new p$,s.componentParameters.castShadows=l.castShadows?ua.All:ua.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,r,i,s=!1){e.intersectionGeometry.getComponentAabb(r,i);const n=e,o=n.components.verticalOffsets;if(s||N(o))return i;const a=o[r];if(this._viewingMode===_t.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=s0t(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}intersect(e,r,i,s,n,o){const a=e;E(n)&&(n.localOrigin=a.transform.position);const l=RT(Eye,a.transform.rotationScale);Da(pF,r,a.transform.position),Da(fF,i,a.transform.position),Ph(pF,pF,l),Ph(fF,fF,l);const c=df(Eye,l);return a.intersectionGeometry.intersect(pF,fF,s,c,n,a.components.verticalOffsets,o)}addEdges(e,r,i,s){const n=e,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(e,n.transform,{center:n.obb.center,radius:tOt(n.obb)},a,o,l,i,s)}async extractEdgeInformation(e,r,i){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:KOt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=uB.createBuffer(a.count);V7(c.position,a),mb(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:In(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,r,i,s){if(e&&r.allVisible())return e;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=Array.isArray(e)?new Array(n):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const h=i[l],p=i[c];for(let A=h;A<p;A++)o[a++]=e?e[A]:A;return!0}),o}addComponentHighlight(e,r){const i=e.components;N(i.highlightCounts)&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(N(i.highlightCounts))return void Sye.warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else Sye.warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;E(r.highlightCounts)&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[A3.Visible]}_createRenderable(e,r){const i=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=Wi.createVertex(i,Li.STATIC_DRAW,s.vertices.data),a=ka(s.indices,T=>Wi.createIndex(i,Li.STATIC_DRAW,T)),l=Wh(EOt(n)),c=new Uint16Array(s.vertices.count);for(let T=0;T<r.count;T++){const C=r.offsets[T],M=r.offsets[T+1],O=r.materialDataIndices[T];if(E(s.indices))for(let $=C;$<M;$++)c[s.indices[$]]=O;else for(let $=C;$<M;$++)c[$]=O}const h=Wi.createVertex(i,Li.STATIC_DRAW,c.buffer),p=new Ea(e.transform,e.toMapSpace),A=new uf(i,dNe,{data:l,componentIndices:sPt},{data:o,componentIndices:h},a),_=new gOt(A,Ar.TRIANGLES,n,E(a)),w={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(E(a)?a.byteSize:0)};return new mOt(p,_,w)}_notifyDirty(){this._renderManager.notifyDirty()}}const sPt=Wh(gn().u16(B.COMPONENTINDEX));function kH(t,e){return t===e?ua.All:t===0?ua.None:ua.Some}const Eye=Uu(),pF=V(),fF=V();let _Ne=class extends ys{constructor(){super(...arguments),this.opacity=1}};function nPt(t){const e=new Di;return e.include(Af),e.fragment.uniforms.add(new mr("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new nt("opacity",r=>r.opacity)),e.fragment.code.add(I`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const oPt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:_Ne,build:nPt},Symbol.toStringTag,{value:"Module"}));var ec;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(ec||(ec={}));let jK=class extends fc{constructor(){super(...arguments),this.alphaMode=ec.None,this.hasOpacityFactor=!1}};u([ie({count:ec.COUNT})],jK.prototype,"alphaMode",void 0),u([ie()],jK.prototype,"hasOpacityFactor",void 0);let vNe=class bNe extends Vi{initializeProgram(e){return new Fi(e.rctx,bNe.shader.get().build(this.configuration),Pi)}initializePipeline(){switch(this.configuration.alphaMode){case ec.None:return Rr({colorWrite:zr});case ec.Alpha:return Rr({blending:Aa(tt.SRC_ALPHA,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),colorWrite:zr});case ec.PremultipliedAlpha:case ec.COUNT:return Rr({blending:X0(tt.ONE,tt.ONE_MINUS_SRC_ALPHA),colorWrite:zr})}}};vNe.shader=new Ni(oPt,()=>be(()=>import("./Compositing.glsl-a72c8a12.js"),[]));let wNe=class extends ys{};function aPt(){const t=new Di;return t.include(Af),t.fragment.uniforms.add(new mr("tex",e=>e.texture)),t.fragment.code.add(I`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),t}const lPt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:wNe,build:aPt},Symbol.toStringTag,{value:"Module"}));let xNe=class TNe extends Vi{initializeProgram(e){return new Fi(e.rctx,TNe.shader.get().build(),Pi)}initializePipeline(){return Rr({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};xNe.shader=new Ni(lPt,()=>be(()=>import("./HUDCompositing.glsl-3d15159b.js"),[]));let SNe=class extends ys{};function cPt(){const t=new Di;return t.include(Af),t.fragment.uniforms.add([new mr("colorTexture",e=>e.colorTexture),new mr("alphaTexture",e=>e.alphaTexture),new mr("frontFaceTexture",e=>e.frontFaceTexture)]),t.fragment.code.add(I`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const uPt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:SNe,build:cPt},Symbol.toStringTag,{value:"Module"}));let ENe=class CNe extends Vi{initializeProgram(e){return new Fi(e.rctx,CNe.shader.get().build(),Pi)}initializePipeline(){return Rr({blending:Aa(tt.SRC_ALPHA,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),colorWrite:zr})}};ENe.shader=new Ni(uPt,()=>be(()=>import("./OITCompositing.glsl-cb1a304f.js"),[]));let MNe=class extends ys{constructor(){super(...arguments),this.overlayIndex=dn.INNER,this.opacity=1}};function hPt(){const t=new Di;return t.include(Af),t.fragment.uniforms.add(new mr("tex",e=>e.texture)),t.fragment.uniforms.add(new ZL("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new nt("opacity",e=>e.opacity)),t.fragment.code.add(I`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`),t}const dPt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:MNe,build:hPt},Symbol.toStringTag,{value:"Module"}));let RNe=class ONe extends Vi{initializeProgram(e){return new Fi(e.rctx,ONe.shader.get().build(),Pi)}initializePipeline(){return Rr({blending:X0(tt.ONE,tt.ONE_MINUS_SRC_ALPHA),colorWrite:zr})}};RNe.shader=new Ni(dPt,()=>be(()=>import("./OverlayCompositing.glsl-28224b6a.js"),[]));let pPt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new jK,this._passParameters=new _Ne,this._oitParameters=new SNe,this._hudParameters=new wNe,this._overlayParameters=new MNe}destroy(){this._vao=Nt(this._vao)}compositeOIT(e,r,i,s){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(ENe);n.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Ar.TRIANGLE_STRIP,0,Ol(a,"geometry")),o.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._rctx,s=this._techniqueRepository.acquire(xNe);i.bindTechnique(s,this._hudParameters,e);const n=this._ensureVAO();i.bindVAO(n),i.drawArrays(Ar.TRIANGLE_STRIP,0,Ol(n,"geometry")),s.release()}compositeOverlay(e,r,i,s){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(RNe);n.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Ar.TRIANGLE_STRIP,0,Ol(a,"geometry")),o.release()}composite(e,r,i=ec.None,s=1){const n=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=r,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(vNe,this._configuration);n.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Ar.TRIANGLE_STRIP,0,Ol(a,"geometry")),o.release()}_ensureVAO(){return N(this._vao)&&(this._vao=mc(this._rctx)),this._vao}};const fPt=1e4,HK=100,mPt=500,gPt=500,APt=.1;function yPt(t,e,r){return Ene(e,t)*(r[1]-r[0])+r[0]}function _Pt(t,e,r){let i=0;if(!e.some(n=>(i+=n.numGeometries,i>=fPt)))return CPt.compute(t,e);const s=eD();return r.forAll(n=>{n.visible&&wM(s,vPt(t,n))}),s}function vPt(t,e){if(!e.visible)return;const r=eD(),i=e.getSpatialQueryAccelerator();return E(i)?bPt(r,t,i):wPt(r,t,e.objects),r}function bPt(t,e,r){const i=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<mPt)j4(Op,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,s,S0.DepthOrder.FRONT_TO_BACK,Op,(l,c)=>{qK(t,e,l),Op.far=t.near,c.setRange(Op)},n,o),j4(Op,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,s,S0.DepthOrder.BACK_TO_FRONT,Op,(l,c)=>{qK(t,e,l),Op.near=t.far,c.setRange(Op)},n,o);else{const l=Math.max(Math.min(a,gPt),Math.ceil(a*APt)),c=r.findClosest(s,S0.DepthOrder.FRONT_TO_BACK,n,o,l),h=r.findClosest(s,S0.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(Cye(t,e,c.boundingVolumeWorldSpace.bounds),Cye(t,e,h.boundingVolumeWorldSpace.bounds))}}function wPt(t,e,r){HS.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&HS.add(i)}),HS.empty||(HS.sort(e),j4(Op,e.near,Math.min(t.near,e.far)),HS.forEachInDepthRange(Op,S0.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<t.near&&qK(t,e,i)}),j4(Op,Math.max(t.far,e.near),e.far),HS.forEachInDepthRange(Op,S0.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{t.far=Math.max(t.far,n)}))}function qK(t,e,r){if(!r.visible||!xv(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=EPt;r.geometries.forEach(n=>{$n(s,i,n.shaderTransformation);const o=Wx(s);PNe(t,e,n.boundingInfo,s,o)})}function PNe(t,e,r,i,s){if(N(r))return;Mt(xl,r.center,i);const{eye:n,viewForward:o}=e,a=o[0]*(xl[0]-n[0])+o[1]*(xl[1]-n[1])+o[2]*(xl[2]-n[2]);if(xl[3]=r.radius*s,!(a-xl[3]>t.near&&a+xl[3]<t.far)&&xv(e.frustum,xl))if(r.radius>HK&&r.getChildren())for(const l of r.getChildren())PNe(t,e,l,i,s);else WK.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function Cye(t,e,r){const i=e.eye,s=e.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];t.near=Math.min(t.near,n-r[3]),t.far=Math.max(t.far,n+r[3])}let xPt=class{constructor(){this._items=new Vr({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,r,i){if(r===S0.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}}},TPt=class{constructor(){this._view=ot(),this._viewProj=ot(),this._frustum=v4(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),ma(this._view,e.viewMatrix),$n(this._viewProj,e.projectionMatrix,this._view),A9(this._frustum,e.frustum);const i=this._view,s=i[2],n=i[6],o=i[10],a=i[14];r.forAll(A=>A.forEachGeometry(_=>{if(!_.visible||!_.castShadow)return;let w;_.hasShaderTransformation?(_.computeBoundingSphere(_.shaderTransformation,xl,1),w=xl):w=_.boundingSphere;const T=s*w[0]+n*w[1]+o*w[2]+a,C=T-w[3],M=T+w[3];this._geometries.push(_),this._near.push(-M),this._far.push(-C)}));const l=new AOt;if(this._geometries.length===0)return l;for(let A=0;A<this._geometries.length;++A)this._near[A]>l.far&&(l.far=this._near[A]),this._near[A]>2&&this._far[A]<l.near&&(l.near=this._far[A]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,p=0;for(let A=0;A<this._geometries.length;++A)this._near[A]<l.near&&(this._near[A]>=c.near?l.near=this._near[A]:this._nearCandidates[h++]=A),this._far[A]>l.far&&(this._far[A]<=c.far?l.far=this._far[A]:this._farCandidates[p++]=A);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((A,_)=>this._near[A]<this._near[_]?-1:this._near[A]>this._near[_]?1:0),this._farCandidates.sort((A,_)=>this._far[A]<this._far[_]?1:this._far[A]>this._far[_]?-1:0);for(let A=0;A<this._nearCandidates.length;++A){const _=this._nearCandidates[A];if(this._near[_]<l.near){const w=this._geometries[_],T=w.boundingInfo;this._includeNearBoundingInfoRec(T,w.shaderTransformation,l)}}for(let A=0;A<this._farCandidates.length;++A){const _=this._farCandidates[A];if(this._far[_]>l.far){const w=this._geometries[_],T=w.boundingInfo;this._includeFarBoundingInfoRec(T,w.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(N(e))return;const s=e.center;Mt(xl,s,r);const n=Wx(r),o=xl[0],a=xl[1],l=xl[2],c=e.radius*n,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const p=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],A=p+c;if(!(-(p-c)<2||-A>=i.near))if(-A>this._looseRange.near)i.near=-A;else{if(c>HK){const _=e.getChildren();if(_!==void 0){for(const w of _)this._includeNearBoundingInfoRec(w,r,i);return}}WK.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(N(e))return;let s=e.radius;const n=e.center;Mt(xl,n,r);const o=Wx(r),a=xl[0],l=xl[1],c=xl[2];s*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>s||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>s||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>s||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>s)return;const p=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-p<=i.far))if(-p<this._looseRange.far)i.far=-p;else{if(s>HK){const A=e.getChildren();if(A!==void 0){for(const _ of A)this._includeFarBoundingInfoRec(_,r,i);return}}WK.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},SPt=class{constructor(){this._modelViewProj=ot(),this._clipPosition=[Zr(),Zr(),Zr(),Zr(),Zr(),Zr(),Zr(),Zr()]}unionDepthRangeWithAABB(e,r,i,s,n){const o=this._modelViewProj;$n(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],A=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*A+o[12],c[1]=o[1]*h+o[5]*p+o[9]*A+o[13],c[2]=o[2]*h+o[6]*p+o[10]*A+o[14],c[3]=o[3]*h+o[7]*p+o[11]*A+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[BH[l][0]],h=this._clipPosition[BH[l][1]],p=this._clipPosition[BH[l][2]],A=this._clipTriangle(c,h,p);let _=!0;for(let w=0;w<A.length;++w)if(A[w][3]>=2){_=!1;break}if(!_){a=!0;for(let w=0;w<A.length;++w){const T=A[w][3];Number.isFinite(T)&&(e.near=Math.min(T,e.near),e.far=Math.max(T,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void Zt(!1)}_intersect(e,r,i){let s=0;return i===0?s=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?s=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?s=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(s=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),YB(Zr(),e,r,s)}_clipTriangle(e,r,i){let s=[e,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}};const BH=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],xl=Io(),EPt=ot(),Op=eD(),HS=new xPt,CPt=new TPt,WK=new SPt;let MPt=class{},RPt=class extends ys{constructor(){super(...arguments),this.textures=new MPt}};function OPt(){const t=new Di;return t.attributes.add(B.POSITION,"vec2"),t.vertex.uniforms.add(new hi("drawPosition",(e,r)=>PPt(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(I`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new mr("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new mr("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new mr("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new by("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new by("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(I`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function PPt(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,s=t.magnifier.offset.y*r;ng(t.magnifier.position,Mye);const n=e.camera.screenToRender(Mye,IPt),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return ns($Pt,(n[0]+i)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const Mye=Sn(),IPt=pxe(),$Pt=Zr();async function LPt(t){const e=be(()=>import("./mask-svg-023bbc42.js"),[]),r=be(()=>import("./overlay-svg-d62383f3.js"),[]),i=jy((await e).default,{signal:t}),s=jy((await r).default,{signal:t}),n={mask:await i,overlay:await s};return di(t),n}let qE=class extends Ke{constructor(){super(...arguments),this._handles=new ts,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new RPt,this.events=new Nn,this.attributeLocations=new Map([[B.POSITION,0]]),this._tmpScreenPoint=Sn(),this._tmpRenderPoint=pxe()}get updating(){return N(this._imageSources)&&E(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};E(this._magnifier)&&this._handles.add(xe(()=>ka(this._magnifier,i=>i.version),r)),r()}get enabled(){return E(this._validMagnifier)}get _validMagnifier(){return E(this._magnifier)&&this._magnifier.visible&&E(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get _factor(){return E(this._magnifier)&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),E(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(N(i))return;const s=r.camera.pixelRatio,n=Math.ceil(s*i.size);if(this._updateResources(e,n),N(this._resources))return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*n);o.input.resize(a,a),ng(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,h=r.camera.fullHeight,p=.5*a,A=.5*a;l[0]=ze(l[0],p,c-p-1),l[1]=ze(l[1],A,h-A-1);const _=Math.floor(l[0]-p),w=Math.floor(l[1]-A),T=this._resources.program;T.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,_,w,a,a,0),this._passParameters.magnifier=i,e.useProgram(T),T.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Ar.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(N(e))return;const r=e.maskUrl,i=e.overlayUrl;!E(this._imageLoadTask)||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),E(this._imageSources)||E(this._imageLoadTask)||(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:lL(async s=>{const n=N(r)||N(i)?LPt(s):null,o=E(r)?jy(r,{signal:s}):n.then(l=>l.mask),a=E(i)?jy(i,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(E(this._resources)){if(this._passParameters.textures.size!==r){const s=this._createTextureResources(e,r);if(N(s))return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const i=this._createTextureResources(e,r);N(i)||(this._resources={program:this._createProgram(e),vao:mc(e,pse,this.attributeLocations,0,1),pipelineState:Rr({blending:X0(tt.ONE,tt.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:zr})},this._passParameters.textures=i)}_disposeResources(){N(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(N(this._imageSources))return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new Wt(e,{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,internalFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:Bt.LINEAR,flipped:!0,preMultiplyAlpha:!vwe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result},this._imageSources.overlay),s=new Wt(e,{target:nr.TEXTURE_2D,pixelFormat:At.ALPHA,internalFormat:At.ALPHA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:Bt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new Wt(e,{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,internalFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:Bt.LINEAR,flipped:!1}),mask:s,overlay:i,size:r}}_createProgram(e){return new Fi(e,OPt(),this.attributeLocations)}};u([d()],qE.prototype,"_imageSources",void 0),u([d()],qE.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],qE.prototype,"updating",null),qE=u([j("esri/views/3d/webgl-engine/lib/MagnifierHelper")],qE);let DPt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new uc(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,s,n,o=null,a=null,l=null){if(!(e&&r&&i&&s)||(this._layerUidToId.set(s,i),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return Nr(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return we.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(e.layerUid);i||(i=new Map,this._uidToRenderColor.set(e.layerUid,i));let s=i.get(e.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");i.set(e.graphicUid,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new uc(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let n=null;s?(n=s.get(i.graphicUid),n||we.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):we.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||we.getLogger(this.declaredClass).warn("no layerId found for uid "+i.layerUid),n&&o&&e.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return e}};var H4;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(H4||(H4={}));let e1=class{constructor(e,r,i=H4.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new Vr({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,s){const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=e,n.depthSquaredHint=s,n.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}dispatch(e,r){const i=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,e,r,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===lr.NONE||(i.bindTechnique(l,e,r),s=l);const c=this._draws.data[a],h=c.geometry;i.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,A=p.length;if(c.indexType!==0){const _=E8.get(c.indexType);for(let w=0;w<A;w+=2){const T=p[w],C=p[w+1];i.drawElements(h.primitiveType,C,c.indexType,T*_)}}else for(let _=0;_<A;_+=2){const w=p[_],T=p[_+1];i.drawArrays(h.primitiveType,w,T)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===H4.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=e*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.size-i.geometry.vao.size})}get count(){return this._draws.length}};const E8=new Map;E8.set(qt.UNSIGNED_BYTE,1),E8.set(qt.UNSIGNED_SHORT,2),E8.set(qt.UNSIGNED_INT,4);let NPt=class{constructor(e,r){this.rctx=e,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new lMt,this._shadowPassParameters=new cMt,this._highlightPassParameters=new uMt,this._systems=new Set,this._passes={materialOpaque:new e1(e,r),materialTransparent:new e1(e,r,H4.BackToFront),materialIntegratedMesh:new e1(e,r),shadowMap:new e1(e,r),highlight:new e1(e,r),highlightIntegratedMesh:new e1(e,r),highlightShadowMap:new e1(e,r),defaultShadowMap:new e1(e,r)}}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(e){if(this._systems.size!==0)switch(this._configure(e),this._materialPassParameters.output=e.output,e.bindParameters.slot){case et.OPAQUE_MATERIAL:switch(e.output){case ee.Color:case ee.Depth:case ee.Normal:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters);case ee.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,e.bindParameters);case ee.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case ee.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case ee.ShadowExcludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case ee.ObjectAndLayerIdColor:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters)}return;case et.TRANSPARENT_MATERIAL:switch(e.output){case ee.Color:case ee.Alpha:case ee.Depth:case ee.Normal:case ee.ObjectAndLayerIdColor:return this._passes.materialTransparent.dispatch(this._materialPassParameters,e.bindParameters)}return;case et.INTEGRATED_MESH:switch(e.output){case ee.Color:case ee.Depth:case ee.Normal:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters);case ee.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,e.bindParameters);case ee.ObjectAndLayerIdColor:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[et.OPAQUE_MATERIAL,et.TRANSPARENT_MATERIAL,et.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const s=i.queryShadowCasterDepthRange(e);E(s)&&wM(r,s,r)}),r}_configure(e){const r=e.output===ee.Shadow||e.output===ee.ShadowHighlight||e.output===ee.ShadowExcludeHighlight?this._shadowPassParameters:e.output===ee.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,r)}_updateParameters(e,r){const i=e.bindParameters.camera,s=i.viewInverseTransposeMatrix;$e(UH,s[3],s[7],s[11]),VH.set(UH),Oe(r.transformWorldFromViewTH,VH.high),Oe(r.transformWorldFromViewTL,VH.low),Oe(r.slicePlaneLocalOrigin,UH),hf(r.transformViewFromCameraRelativeRS,i.viewMatrix),ma(r.transformProjFromView,i.projectionMatrix),r.identifier===Rh.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===et.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===et.INTEGRATED_MESH,df(Rye,r.transformViewFromCameraRelativeRS),RT(r.transformNormalViewFromGlobal,Rye))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const UH=V(),Rye=mn(),VH=new Z7;let FPt=class{constructor(){this._step=Iye,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,Le("enable-feature:high-quality-idle")){const s=r?performance.now()-this._firstIdleTime:0;if(s>=Oye+BPt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=Oye?UPt:1}else this._dilation=1;const i=ze(e/kPt,Iye,zPt);this._step===1/0?this._step=i:this._step=this._step*Pye+i*(1-Pye)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const kPt=.5,Oye=6e4,BPt=5e3,UPt=10,Pye=.9,VPt=30,Iye=1e3/1,zPt=1e3/VPt,GPt=8.6,jPt=.4;function HPt(){const t=new Di,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(B.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(B.UV0,"vec2"),e.uniforms.add(new mr("coverageTex",n=>n.coverageTexture)),i.add(I`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new mr("tex",n=>n.blurColorTexture)),r.uniforms.add(new mr("origin",n=>n.highlightColorTexture)),r.uniforms.add(new hi("uColor",n=>n.color)),r.uniforms.add(new hi("haloColor",n=>n.haloColor)),r.uniforms.add(new hi("opacities",n=>ns(qPt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("outlineSize","float",GPt),r.constants.add("blurSize","float",jPt),s.add(I`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const qPt=Zr(),WPt=Object.freeze(Object.defineProperty({__proto__:null,build:HPt},Symbol.toStringTag,{value:"Module"}));let INe=class $Ne extends Vi{initializeProgram(e){return new Fi(e.rctx,$Ne.shader.get().build(),Pi)}initializePipeline(){return Rr({blending:Aa(tt.SRC_ALPHA,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),colorWrite:zr})}};INe.shader=new Ni(WPt,()=>be(()=>import("./HighlightApply.glsl-e7a5bcce.js"),[]));let LNe=class extends ys{constructor(){super(...arguments),this.blurSize=Dt()}};function YPt(){const t=new Di,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(B.POSITION,"vec2"),t.attributes.add(B.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new mr("coverageTex",n=>n.coverageTexture)),r.uniforms.add(new y4("blurSize",n=>n.blurSize)),i.add(I`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new NL("tex",n=>n.blurInputTexture)),s.add(I`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),t}const QPt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:LNe,build:YPt},Symbol.toStringTag,{value:"Module"}));let DNe=class NNe extends Vi{initializeProgram(e){return new Fi(e.rctx,NNe.shader.get().build(),Pi)}initializePipeline(){return Rr({colorWrite:zr})}};DNe.shader=new Ni(QPt,()=>be(()=>import("./HighlightBlur.glsl-4eb93850.js"),[]));let FNe=class extends ys{constructor(){super(...arguments),this.invFramebufferDim=Dt()}};function XPt(){const t=new Di,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(B.POSITION,"vec2"),i.add(I`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new NL("tex",n=>n.inputTexture)),r.uniforms.add(new y4("invFramebufferDim",n=>n.invFramebufferDim)),s.add(I`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const ZPt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:FNe,build:XPt},Symbol.toStringTag,{value:"Module"}));let kNe=class BNe extends Vi{initializeProgram(e){return new Fi(e.rctx,BNe.shader.get().build(),Pi)}initializePipeline(){return Rr({colorWrite:zr})}};kNe.shader=new Ni(ZPt,()=>be(()=>import("./HighlightDownsample.glsl-1d735815.js"),[]));let $ye=class extends ys{constructor(){super(...arguments),this.color=Y0(1,0,1,1),this.haloColor=Y0(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Nr(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const JPt=32;let KPt=class{constructor(e,r){this._techniqueRep=e,this._rctx=r,this._viewportToRestore=Zr(),this._passParameters=new $ye,this._downsampleDrawParameters=new FNe,this._blurDrawParameters=new LNe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=mc(this._rctx);const e={colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE,width:0,height:0},r={target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.LINEAR,wrapMode:pr.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new Jn(this._rctx,e,r),this._blur1Fbo=new Jn(this._rctx,e,r),this._blurTechnique=this._techniqueRep.acquire(DNe),this._downsampleTechnique=this._techniqueRep.acquire(kNe),this._applyTechnique=this._techniqueRep.acquire(INe)}dispose(){if(this._blurTechnique=en(this._blurTechnique),this._downsampleTechnique=en(this._downsampleTechnique),this._applyTechnique=en(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._blur0Fbo=Nt(this._blur0Fbo),this._blur1Fbo=Nt(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new $ye,...e}}render(e,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const s=e.camera;A0(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let p=null;this._gridUpdateResources(r,JPt),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const A=h.bindTechnique(this._blurTechnique,this._passParameters,e);h.bindVAO(p),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(qs.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,Kr(this._blurDrawParameters.blurSize,1/l,0),A.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Ol(p,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(qs.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,Kr(this._blurDrawParameters.blurSize,0,1/c),A.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Ol(p,"geometry")),h.bindFramebuffer(i),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,e),h.drawArrays(this._applyTechnique.primitiveType,0,Ol(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(e,r){const i=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[e],n=!0),s.viewportWidth===e.width&&s.viewportHeight===e.height||(n=!0,s.viewportWidth=e.width,s.viewportHeight=e.height),s.coverageMipmap[0]=e,s.cellPixelSize!==r&&(s.cellPixelSize=r,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:nr.TEXTURE_2D,pixelFormat:At.RGB,dataType:yr.UNSIGNED_SHORT_5_6_5,samplingMode:Bt.LINEAR,wrapMode:pr.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new Jn(i,p,h)}}const o=Math.ceil(e.height/s.cellPixelSize),a=Math.ceil(e.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,A=6,_=4,w=new Float32Array(A*_*l*c);let T=0;for(let C=0;C<l;C++)for(let M=0;M<c;M++)w[T+0]=(M-.5)*p*2-1,w[T+1]=(C-.5)*h*2-1,w[T+2]=M*p,w[T+3]=C*h,w[T+4]=(M+.5)*p*2-1,w[T+5]=(C-.5)*h*2-1,w[T+6]=M*p,w[T+7]=C*h,w[T+8]=(M-.5)*p*2-1,w[T+9]=(C+.5)*h*2-1,w[T+10]=M*p,w[T+11]=C*h,w[T+12]=(M-.5)*p*2-1,w[T+13]=(C+.5)*h*2-1,w[T+14]=M*p,w[T+15]=C*h,w[T+16]=(M+.5)*p*2-1,w[T+17]=(C-.5)*h*2-1,w[T+18]=M*p,w[T+19]=C*h,w[T+20]=(M+.5)*p*2-1,w[T+21]=(C+.5)*h*2-1,w[T+22]=M*p,w[T+23]=C*h,T+=A*_;s.vao&&s.vao.dispose(!0),s.vao=new Z0(i,Pi,{geometry:QM},{geometry:Wi.createVertex(i,Li.STATIC_DRAW,w)})}}_gridComputeMipmap(e){const r=this._rctx,i=this._grid,s=r.bindTechnique(this._downsampleTechnique,this._passParameters,e);r.bindVAO(this._quadVAO);for(let n=0;n<i.mipmapLevels;n++){r.bindFramebuffer(i.coverageMipmap[n+1]);const o=i.coverageMipmap[n+1].width,a=i.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[n].colorTexture,Kr(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,e,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(Ar.TRIANGLE_STRIP,0,Ol(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(E(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(E(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)e+=r.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const eIt={dataType:yr.UNSIGNED_BYTE,internalFormat:At.RGBA},tIt={};let rIt=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=e.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(e=>e.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(e=>e.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(e){const r=e.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._depthBuffers,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(e,r){const i=e.get(r);i&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==i&&s.depthStencilAttachment!==i||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),i.dispose(),e.delete(r))}getDepthTexture(e,r){if(!this.depthTextureSupported)return null;let i=this._depthTextures.get(e.id);return!i||i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=Px()),i||(i=new Wt(this._rctx,{target:nr.TEXTURE_2D,pixelFormat:At.DEPTH_STENCIL,dataType:yr.UNSIGNED_INT_24_8,samplingMode:Bt.NEAREST,wrapMode:pr.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._depthTextures.set(e.id,i),this._activeTargets.add(e.id)),i}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getDepthBuffer(e,r){if(this.depthTextureSupported)return null;let i=this._depthBuffers.get(e.id);return i?i.descriptor.width===r.width&&i.descriptor.height===r.height||i.resize(r.width,r.height):(i=new NE(this._rctx,{internalFormat:Uc.DEPTH_STENCIL,...r}),this._depthBuffers.set(e.id,i),this._activeTargets.add(e.id)),i}getColorTexture(e,r){let i=this._colorTextures.get(e.id);return i&&(i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=Px())),i||(i=new Wt(this._rctx,{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,internalFormat:e.internalFormat,dataType:e.dataType,samplingMode:e.samplingMode!=null?e.samplingMode:Bt.LINEAR,wrapMode:pr.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._colorTextures.set(e.id,i),this._activeTargets.add(e.id)),i}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:kh(),...tIt,...e}}registerColorTarget(e={}){return{id:kh(),...eIt,...e}}getFramebuffer(e,r,i){const s=this._getKey(r,i);let n=this._framebuffers.get(s);const o=this.getColorTexture(r,e);if(this.depthTextureSupported){const l=i?this.getDepthTexture(i,e):void 0;return n?((n.width!==e.width||n.height!==e.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(e.width,e.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=E(i)?new Jn(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:$i.DEPTH_STENCIL_TEXTURE},o,l):new Jn(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE},o),this._framebuffers.set(s,n),n)}const a=i?this.getDepthBuffer(i,e):void 0;return n?((n.width!==e.width||n.height!==e.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(e.width,e.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new Jn(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:i?$i.DEPTH_STENCIL_RENDER_BUFFER:$i.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(e,r){return`${e.id}_${r?r.id:"X"}_${e.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let e=0;const r=new Set,i=s=>{r.has(s)||(r.add(s),e+=rT(s))};return this._depthTextures.forEach(i),this._colorTextures.forEach(i),this._depthBuffers.forEach(i),e}},iIt=class{constructor(e,r){this._rctx=e,this._compositingHelper=r,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._background={type:"color",color:[0,0,0,1]};const i=e.type===sr.WEBGL2;this._renderTargetHelper=new rIt(e);const s=this._renderTargetHelper;this._mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:yr.FLOAT,internalFormat:i?cr.RGBA32F:At.RGBA,samplingMode:Bt.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:Bt.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:i?cr.RGBA4:At.RGBA,dataType:yr.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:i?cr.RGBA4:At.RGBA,dataType:yr.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,r){return this._renderTargetHelper.getFramebuffer(this._dimensions,e,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1])),this._mainColorTarget=this._mainColorTarget===0&&e?1:0}initializeFrame(e){const r=this._rctx;this._dimensions.width=e.fullWidth,this._dimensions.height=e.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(qs.COLOR_BUFFER_BIT|qs.DEPTH_BUFFER_BIT|qs.STENCIL_BUFFER_BIT)}composite(e){E(this.colorTexture)&&this._compositingHelper.composite(e,this.colorTexture,ec.None)}renderTmpAndCompositeToMain(e,r,i,s=!1){this.renderToTargets(e,this.tmpColor,s?this.tmpDepth:this.mainDepth,sIt),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}renderHUDVisibility(e,r=!1){this.renderToTargets(e,this.hudVisibility,r?this.tmpDepth:this.mainDepth,nIt)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,r,i){let s,n;switch(r){case lr.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case lr.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case lr.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}i?this.renderToTargets(e,s,this.tmpDepth,n,!0,!0):this.renderToTargets(e,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),ec.PremultipliedAlpha)}compositeOccludedOntoMain(e,r){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),ec.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(e,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(qs.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,r,i=!1,s=!1){const n=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);n.setClearColor(r[0],r[1],r[2],l),o|=qs.COLOR_BUFFER_BIT}i&&(o|=qs.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=qs.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),e(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,r,i,s,n=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(e,s,n,o),a}bindTarget(e,r){const i=this._renderTargetHelper.getFramebuffer(this._dimensions,e,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this._dimensions)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const sIt=[0,0,0,0],nIt=[0,1,0,1];let oIt=class{constructor(e){this._context=e,this._renderPlugins=new Vr,this._slots=[];for(let r=0;r<et.MAX_SLOTS;++r)this._slots[r]=[]}add(e,r,i){const s=()=>{if(i!=null&&i.aborted)throw r.uninitializeRenderContext(),Yi();this._renderPlugins.push(r);for(const o of e)this._slots[o].push(r);this._context.requestRender()},n=r.initializeRenderContext(this._context,i);if(Zd(n))return n.then(s);s()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender()}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;e.filter(i=>{if(!i.canRender)return!1;if(aIt(i)){const s=i.prepareTechnique(this._context.renderContext);return!!s&&(r.push(s),!0)}return r.push(null),!0}).forEach((i,s)=>i.render(this._context.renderContext,r[s]))}queryDepthRange(e){const r=lIt;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const s=i.queryDepthRange(e);s&&wM(r,s,r)}}),r}get needsTransparentPass(){return this._renderPlugins.some(e=>!!e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>!!e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>!!e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[et.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,0)}};function aIt(t){return"prepareTechnique"in t}const lIt={near:0,far:0};let UNe=class extends hLe{};const J7=255,cIt=1/J7;function uIt(t){const e=new Di,r=e.fragment;return r.include(qh),r.include(Wd),e.include(D7),e.include(Af),e.include(L7,t),r.uniforms.add([new mr("depthMap",i=>i.linearDepthTexture),new nn("inverseViewMatrix",(i,s)=>ul(Lye,ju(Lye,s.camera.viewMatrix,s.camera.center))),new Bi("nearFar",(i,s)=>s.camera.nearFar)]),r.constants.add("sampleValue","float",cIt),r.code.add(I`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const Lye=ot(),hIt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:UNe,ShadowCastMaxSamples:J7,build:uIt},Symbol.toStringTag,{value:"Module"}));var mT;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(mT||(mT={}));let YK=class extends fc{constructor(){super(...arguments),this.visualization=mT.Gradient,this.bandsEnabled=!1}};u([ie({count:mT.COUNT})],YK.prototype,"visualization",void 0),u([ie()],YK.prototype,"bandsEnabled",void 0);let VNe=class extends ys{constructor(e){super(),this.shadowCastMap=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=_L(dIt),this.bandSize=.1,this.threshold=.5}};const dIt=Nr(.01,0,.25,1);function pIt(t){const e=new Di,r=e.fragment;r.include(qh),r.include(Wd),e.include(D7),e.include(Af);const{visualization:i,bandsEnabled:s}=t;r.constants.add("inverseSampleValue","float",J7),r.uniforms.add([new mr("shadowCastMap",a=>a.shadowCastMap),new nt("sampleScale",a=>a.sampleScale),new nt("opacityFromElevation",a=>a.opacityFromElevation),new hi("uColor",a=>a.color)]);const n=i===mT.Gradient,o=i===mT.Threshold;return n&&s?r.uniforms.add(new nt("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new nt("threshold",a=>a.threshold)),r.code.add(I`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?I`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?I`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?I`* strength`:""});
      }
    `),e}const fIt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:VNe,build:pIt},Symbol.toStringTag,{value:"Module"}));let zNe=class GNe extends Vi{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Fi(e.rctx,GNe.shader.get().build(this.configuration),Pi)}initializePipeline(){return Rr({blending:zd,colorWrite:zr,depthTest:null,depthWrite:null})}get primitiveType(){return Ar.TRIANGLE_STRIP}};zNe.shader=new Ni(fIt,()=>be(()=>import("./ShadowCastVisualize.glsl-cadd54c3.js"),[]));const mIt=4e4,gIt=5e4,jNe=1/512;let C8=class extends Ke{constructor(e,r,i,s){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=s,this._passParameters=new VNe(this._data.shadowCastTexture),this._techniqueConfig=new YK,this._enabled=!1,this._vao=mc(r),this._techniqueConfig.visualization=mT.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Nt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(zNe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,this._passParameters,e),this._rctx.drawArrays(r.primitiveType,0,Ol(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>jNe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;HC(e,r)||(A0(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],C8.prototype,"opacityFromElevation",null),C8=u([j("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],C8);let mB=class extends fc{constructor(){super(...arguments),this.receiveShadows=!0,this.hasWebGL2Context=!1}};u([ie()],mB.prototype,"receiveShadows",void 0),u([ie()],mB.prototype,"hasWebGL2Context",void 0);let HNe=class qNe extends Vi{constructor(e){super(e,new mB,()=>this.destroy())}initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2}initializeProgram(e){return new Fi(e.rctx,qNe.shader.get().build(this.configuration),Pi)}initializePipeline(){return Rr({blending:Aa(tt.ONE,tt.ONE,tt.ONE,tt.ONE),colorWrite:zr,depthTest:null,depthWrite:null})}get primitiveType(){return Ar.TRIANGLE_STRIP}};HNe.shader=new Ni(hIt,()=>be(()=>import("./ShadowCastAccumulate.glsl-7f888842.js"),[]));let Tu=class extends Ke{constructor(e,r,i,s,n,o){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new UNe,this._enabledInternal=!1,this._cachedLightDirections=[],this._depthRange=UK,this._previewing=!1,this._handles=new ts,this._cameraForcedForScreenshot=!1,this._bindParameters=new t7(new Qne(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=mc(e);const a={colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE,width:0,height:0},l={target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.LINEAR,wrapMode:pr.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Jn(e,a,l),this._accumulationRenderer=new C8(r,e,this,o);const c=this._stage.view.resourceController.scheduler;this._handles.add([c.registerTask(ir.SHADOW_ACCUMULATOR,this),xe(()=>i.renderView,h=>{this._handles.remove(Dye),E(h)&&this._handles.add(h.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Dye)},ao),xe(()=>this._previewing,()=>this._requestRenderIfEnabled(),os)])}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(N(this._accumulationTechniqueCached)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new HNe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabledInternal&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==UK&&this._opacityFromElevation>jNe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(Iy(r,e,Zv))return;const i=Math.min(J7,e.length);r.length=i,this._sampleCount=i;for(let s=0;s<i;++s)r[s]=Oe(r[s]??V(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,s){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=s,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(AIt,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=Nt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Nt(this._fbo),this._vao=Nt(this._vao),this._accumulationTechniqueCached=en(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this._enabled=e.enabled),e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||this._progress<1||e<0||e>this._fbo.width||r<0||r>this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,At.RGBA,yr.UNSIGNED_BYTE,Nye),Nye[0]/this._progress)}_start(){this._progress=0,this._enabledInternal=!0}_stop(){this._enabledInternal=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(qs.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Ol(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*yIt%this._lightDirections.length]}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-L3(mIt,gIt,e.relativeElevation))}set _enabled(e){e!==this._enabledInternal&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabledInternal&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([d()],Tu.prototype,"_progress",void 0),u([d()],Tu.prototype,"_sampleCount",void 0),u([d()],Tu.prototype,"_enabledInternal",void 0),u([d()],Tu.prototype,"_depthRange",void 0),u([d()],Tu.prototype,"_previewing",void 0),u([d()],Tu.prototype,"_accumulationRenderer",void 0),u([d()],Tu.prototype,"_isRefining",null),u([d()],Tu.prototype,"_isActive",null),u([d()],Tu.prototype,"canAccumulate",null),u([d()],Tu.prototype,"_isDoneAccumulating",null),u([d()],Tu.prototype,"_opacityFromElevation",null),u([d()],Tu.prototype,"running",null),Tu=u([j("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Tu);const AIt=6,Dye="renderView",yIt=104729,Nye=new Uint8Array(4),Fye={highlightedThreshold:.99999,selfShadowThreshold:.025};function _It(t){const e=new Di;e.include(uT,t);const r=e.fragment;return r.include(qh),r.include(Wd),e.include(D7),e.include(Af),r.uniforms.add([new mr("defaultDepthTex",(i,s)=>s.shadowMap.getSnapshot(AM.Default)),new mr("highlightDepthTex",(i,s)=>s.shadowMap.getSnapshot(AM.Highlight)),new mr("depthMap",(i,s)=>s.linearDepthTexture),new mr("highlightMap",(i,s)=>s.highlightColorTexture),new hi("uColor",i=>i.shadowColor),new Bi("nearFar",(i,s)=>s.camera.nearFar),new nt("opacity",i=>i.shadowOpacity),new nt("occludedOpacity",i=>i.occludedShadowOpacity),new nt("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Fr("lightingMainDirectionView",(i,s)=>qe(Bye,Mt(Bye,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new Bi("texelSize",(i,s)=>E(s.linearDepthTexture)?Kr(vIt,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):Hu),new nn("inverseViewMatrix",(i,s)=>ul(kye,ju(kye,s.camera.viewMatrix,s.camera.center)))]),r.constants.add("unoccludedHighlightFlag","vec4",F$e).add("highlightedThreshold","float",Fye.highlightedThreshold).add("selfShadowThreshold","float",Fye.selfShadowThreshold),r.code.add(I`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(I`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const kye=ot(),Bye=V(),vIt=Dt(),bIt=Object.freeze(Object.defineProperty({__proto__:null,build:_It},Symbol.toStringTag,{value:"Module"}));let wIt=class extends ys{constructor(){super(...arguments),this.shadowColor=Nr(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},WNe=class YNe extends Vi{constructor(e){super(e,new mB,()=>this.destroy())}initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2}initializeProgram(e){return new Fi(e.rctx,YNe.shader.get().build(this.configuration),Pi)}initializePipeline(){return Rr({blending:Aa(tt.SRC_ALPHA,tt.ONE,tt.ONE_MINUS_SRC_ALPHA,tt.ONE_MINUS_SRC_ALPHA),colorWrite:zr,depthTest:null,depthWrite:null})}get primitiveType(){return Ar.TRIANGLE_STRIP}};WNe.shader=new Ni(bIt,()=>be(()=>import("./ShadowHighlight.glsl-37f0ca0b.js"),[]));const xIt=.001953125,TIt=4e4,SIt=5e4;let EIt=class{constructor(e,r){this._rctx=e,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new wIt,this._drawParameters=new hLe,this._vao=mc(this._rctx)}get _technique(){return N(this._techniqueCached)&&(this._techniqueCached=new WNe({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,r){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,Ol(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.size)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,r){this._passParameters.opacityElevation=1-L3(TIt,SIt,e.relativeElevation);const i=this._viewingMode===_t.Global?qe(Uye,e.center):$e(Uye,0,0,1),s=He(i,r);this._passParameters.dayNightTerminator=L3(0,1,ze(30*s,0,1))}dispose(){this._vao=Nt(this._vao),this._techniqueCached=en(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=xIt}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const Uye=V(),Vye=Zy();let CIt=class{constructor(){this._plane=Zy()}get isEnabled(){return!LSe(this.plane,Vye)}get plane(){return this._plane}set plane(e){ET(e||Vye,this._plane)}},MIt=class extends ys{};function q4(t){t.uniforms.add(new hi("resolution",e=>{const{descriptor:r}=e.colorTexture,i=r.width,s=r.height;return ns(RIt,1/i,1/s,i,s)}))}const RIt=Zr(),qS={maxSearchSteps:8,maxDistanceAreaTex:16};function OIt(){const t=new Di,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(B.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),q4(i),i.code.add(I`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${I.int(qS.maxSearchSteps)} );
      }
    `),s.uniforms.add(new mr("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new mr("areaTexture",n=>n.areaTexture)),s.uniforms.add(new mr("searchTexture",n=>n.searchTexture)),q4(s),s.code.add(I`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign(x) * floor(abs(x) + 0.5);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${I.int(qS.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${I.int(qS.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${I.int(qS.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${I.int(qS.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${I.int(qS.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture2D( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        gl_FragColor = weights;
      }
    `),t}const PIt=Object.freeze(Object.defineProperty({__proto__:null,build:OIt},Symbol.toStringTag,{value:"Module"}));let QNe=class XNe extends Vi{initializeProgram(e){return new Fi(e.rctx,XNe.shader.get().build(),Pi)}initializePipeline(){return Rr({colorWrite:zr})}};QNe.shader=new Ni(PIt,()=>be(()=>import("./BlendWeights.glsl-4e765172.js"),[]));function IIt(){const t=new Di,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(B.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),q4(i),i.code.add(I`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new mr("blendWeightsTexture",n=>n.blend.colorTexture)),s.uniforms.add(new mr("colorTexture",n=>n.colorTexture)),q4(s),s.code.add(I`void main() {
vec4 a;
a.rb = texture2D(blendWeightsTexture, uv).rb;
a.g = texture2D(blendWeightsTexture, offsets[1].zw).g;
a.a = texture2D(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
gl_FragColor = texture2D( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTexture, uv, 0.0 );
vec4 Cop = texture2D( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
gl_FragColor = mix(C, Cop, s);
}
}`),t}const $It=Object.freeze(Object.defineProperty({__proto__:null,build:IIt},Symbol.toStringTag,{value:"Module"}));let ZNe=class JNe extends Vi{initializeProgram(e){return new Fi(e.rctx,JNe.shader.get().build(),Pi)}initializePipeline(){return Rr({colorWrite:zr})}};ZNe.shader=new Ni($It,()=>be(()=>import("./Blur.glsl-305bd7c5.js"),[]));const zye={threshold:.05,localConstrastAdaption:2};function LIt(){const t=new Di,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(B.POSITION,"vec2"),q4(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(I`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new mr("colorTexture",n=>n.colorTexture)),s.code.add(I`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D(colorTexture, uv).rgb;

      vec3 Cleft = texture2D(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture2D(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${I.float(zye.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture2D(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture2D(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${I.float(zye.localConstrastAdaption)}) * delta.xy);

      gl_FragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const DIt=Object.freeze(Object.defineProperty({__proto__:null,build:LIt},Symbol.toStringTag,{value:"Module"}));let KNe=class eFe extends Vi{initializeProgram(e){return new Fi(e.rctx,eFe.shader.get().build(),Pi)}initializePipeline(){return Rr({colorWrite:zr})}};KNe.shader=new Ni(DIt,()=>be(()=>import("./EdgeDetect.glsl-5408d6c2.js"),[]));let aI=class extends Ke{constructor(e,r){super({}),this._rctx=e,this._techniqueRep=r,this._passParameters=new MIt,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=tf(this._abortController),this.disable()}_loadResources(e){if(E(this._abortController))return!1;if(E(this._passParameters.searchTexture))return!0;this._abortController=new AbortController;const r=this._abortController.signal;return be(()=>import("./SmaaRenderPassData-660b7d34.js"),[]).then(i=>this._loadTextures(i,r)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,r){return di(r),Promise.all([this._loadTextureFromBase64(e.areaTexture,Bt.LINEAR,At.RGB),this._loadTextureFromBase64(e.searchTexure,Bt.NEAREST,At.LUMINANCE)]).then(([i,s])=>{da(r)?(i.dispose(),s.dispose(),di(r)):(this._passParameters.areaTexture=i,this._passParameters.searchTexture=s)})}get updating(){return E(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const r=new fc;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(KNe,r,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(QNe,r,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(ZNe,r,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=qut(this._rctx),this._passParameters.edges=new Jn(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE},{target:nr.TEXTURE_2D,pixelFormat:At.RGB,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.LINEAR,wrapMode:pr.CLAMP_TO_EDGE,width:4,height:4}),this._passParameters.blend=new Jn(this._rctx,{colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE},{target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.LINEAR,wrapMode:pr.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=Nt(this._vao),this._passParameters.areaTexture=Nt(this._passParameters.areaTexture),this._passParameters.searchTexture=Nt(this._passParameters.searchTexture),this._passParameters.blend=Nt(this._passParameters.blend),this._passParameters.edges=Nt(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const r=this._validPassParameters;if(N(r))return;r.colorTexture=e;const i=this._rctx,s=i.getBoundFramebufferObject(),n=e.descriptor.width,o=e.descriptor.height;i.bindVAO(this._vao),i.setViewport(0,0,n,o),r.edges.resize(n,o),i.bindFramebuffer(r.edges),i.setClearColor(0,0,0,1),i.clear(qs.COLOR_BUFFER_BIT),i.bindTechnique(this._edgeDetectTechnique,r,null),i.drawArrays(Ar.TRIANGLES,0,3),r.blend.resize(n,o),i.bindFramebuffer(r.blend),i.setClearColor(0,0,1,1),i.clear(qs.COLOR_BUFFER_BIT),i.bindTechnique(this._blendWeightsTechnique,r,null),i.drawArrays(Ar.TRIANGLES,0,3),i.bindFramebuffer(s),i.setClearColor(0,1,0,1),i.clear(qs.COLOR_BUFFER_BIT),i.bindTechnique(this._blurTechnique,r,null),i.drawArrays(Ar.TRIANGLES,0,3)}_loadTextureFromBase64(e,r,i){return jy(e).then(s=>new Wt(this._rctx,{pixelFormat:i,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.CLAMP_TO_EDGE,width:s.width,height:s.height,samplingMode:r},s))}};u([d()],aI.prototype,"_abortController",void 0),u([d({readOnly:!0})],aI.prototype,"updating",null),aI=u([j("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],aI);function NIt(t,e){const r=-t[0],i=-t[1],s=-t[2],n=e[3],o=e[7],a=e[11],l=e[15];e[0]+=n*r,e[1]+=n*i,e[2]+=n*s,e[4]+=o*r,e[5]+=o*i,e[6]+=o*s,e[8]+=a*r,e[9]+=a*i,e[10]+=a*s,e[12]+=l*r,e[13]+=l*i,e[14]+=l*s}function FIt(t,e){const r=t[0],i=t[1],s=t[2];e[12]+=r*e[0]+i*e[4]+s*e[8],e[13]+=r*e[1]+i*e[5]+s*e[9],e[14]+=r*e[2]+i*e[6]+s*e[10],e[14]+=r*e[3]+i*e[7]+s*e[11]}let kIt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new BIt(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{ma(r.viewMatrix,e),FIt(r.origin.vec3,r.viewMatrix)})}},BIt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=ot()}},UIt=class extends ZOe{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=mn()}},VIt=class extends JOe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=mn(),this.slicePlaneLocalOrigin=V(),this.transformNormalGlobalFromModel=mn()}};function zIt(t){const e=I`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const GIt=ki(.5,-4e-4);function jIt(t,e){const r=t.vertex;r.include(zIt),r.constants.add("depthBias","vec2",GIt),r.uniforms.add(new Bi("inverseViewport",(i,s)=>s.inverseViewport)),e.legacy?(r.uniforms.add(new nn("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(I`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new Xg("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),r.uniforms.add(new nn("transformProjFromView",i=>i.transformProjFromView)),r.code.add(I`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(I`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function HIt(t,e){const r=t.fragment;r.constants.add("coverageTestThreshold","float",.01),e.antialiasing?r.code.add(I`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(I`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function qIt(t,e){const r=t.vertex;e.silhouette?(r.code.add(I`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(I`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(I`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(I`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function WIt(t,e){const r=t.vertex;r.include(qh),r.uniforms.add(new nt("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(I`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(zv("componentDataTex",i=>i.componentDataTexture,e.hasWebGL2Context?is.None:is.InvSize)),t.attributes.add(B.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*Poe),r.code.add(I`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${Qp(e,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${Wc(e,"componentDataTex","colorIndex")};
      vec4 otherValue = ${Wc(e,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${Wc(e,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?r.code.add(I`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new _4("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(I`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(B.NORMALA,"vec3"),t.attributes.add(B.NORMALB,"vec3"),r.code.add(I`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(B.NORMAL,"vec3"),r.code.add(I`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?r.code.add(I`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(_9,e),r.include(_9,e),r.uniforms.add([new Xg("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new _4("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Vd("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new Vd("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Fr("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Fr("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)]),r.code.add(I`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?I`normalize(transformWorldFromModelTL + rotatedModelPosition);`:I`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new nn("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(I`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(I`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function YIt(t){return t.mode===Yo.SKETCH||t.mode===Yo.MIXED}var Yo,H2;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(Yo||(Yo={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(H2||(H2={}));function Doe(t,e){const r=t.vertex;switch(t.attributes.add(B.SIDENESS,"vec2"),e.mode===Yo.MIXED?r.code.add(I`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(I`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case Yo.MIXED:r.code.add(I`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Yo.SKETCH:r.code.add(I`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Yo.SOLID:r.code.add(I`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Yo.COUNT:break;default:e.mode}}function QIt(t,e){const r=t.vertex;switch(t.include(Doe,e),e.mode){case Yo.SOLID:r.code.add(I`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Yo.SKETCH:r.uniforms.add(new wx("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(I`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Yo.MIXED:r.uniforms.add(new wx("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(I`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function XIt(t,e){t.include(Doe,e);const{vertex:r,fragment:i}=t;switch(YIt(e)&&(r.uniforms.add(zv("strokesTexture",s=>s.strokesTexture.texture,e.hasWebGL2Context?is.None:is.InvSize)),r.uniforms.add([new wx("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new wx("strokeVariants",s=>s.strokesTexture.variants)]),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add([new NL("strokesTexture",s=>s.strokesTexture.texture),new wx("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)]),r.code.add(I`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${Qp(e,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),t.fragment.include(qh),i.code.add(I`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case Yo.SOLID:r.code.add(I`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(I`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Yo.SKETCH:r.code.add(I`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(I`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Yo.MIXED:t.varyings.add("vType","float"),r.code.add(I`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(I`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function ZIt(t){const e=new Di,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add([new Gye("model"),new Gye("localView")]),e.include(jIt,t),e.include(WIt,t),e.include(QIt,t),e.include(Doe,t),e.include(XIt,t),e.include(ho,t),e.include(qIt,t),e.include(HIt,t),e.include(Yd,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add([new Bi("pixelToNDC",(s,n)=>Kr(JIt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new hi("viewport",(s,n)=>n.camera.fullViewport),new nt("pixelRatio",(s,n)=>n.camera.pixelRatio)]),e.attributes.add(B.POSITION0,"vec3"),e.attributes.add(B.POSITION1,"vec3"),e.attributes.add(B.VARIANTOFFSET,"float"),e.attributes.add(B.VARIANTSTROKE,"float"),e.attributes.add(B.VARIANTEXTENSION,"float"),r.code.add(I`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?I`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:I`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===Yo.SKETCH?I`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===Yo.MIXED?I`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(I`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      gl_FragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const JIt=Dt();let Gye=class extends kn{constructor(e){super(e,"mat4")}};const KIt=Object.freeze(Object.defineProperty({__proto__:null,build:ZIt},Symbol.toStringTag,{value:"Module"}));let tFe=class rFe extends Vi{initializeConfiguration(e,r){r.hasWebGL2Context=e.rctx.type===sr.WEBGL2}initializeProgram(e){return new Fi(e.rctx,rFe.shader.get().build(this.configuration),mNe)}initializePipeline(e){return e.blendMinMax?Rr({blending:Aa(tt.ONE,tt.ONE,tt.ZERO,tt.ONE,kg.ADD,e.blendMinMax.MAX),depthTest:{func:Bs.LEQUAL},colorWrite:zr}):Rr({depthTest:{func:Bs.LEQUAL},depthWrite:qu,colorWrite:zr})}};tFe.shader=new Ni(KIt,()=>be(()=>import("./EdgeShader.glsl-7c935bba.js"),[]));let qm=class extends $a{constructor(){super(...arguments),this.mode=Yo.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};u([ie({count:Yo.COUNT})],qm.prototype,"mode",void 0),u([ie()],qm.prototype,"hasSlicePlane",void 0),u([ie()],qm.prototype,"silhouette",void 0),u([ie()],qm.prototype,"legacy",void 0),u([ie()],qm.prototype,"antialiasing",void 0),u([ie()],qm.prototype,"doublePrecisionRequiresObfuscation",void 0),u([ie()],qm.prototype,"hasMultipassTerrain",void 0),u([ie()],qm.prototype,"cullAboveGround",void 0),u([ie()],qm.prototype,"spherical",void 0);const e$t=8,zH=128,t$t={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},r$t={solid:Yo.SOLID,sketch:Yo.SKETCH,uber:Yo.MIXED};let GH=class iFe{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new qm,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[jr.TRANSPARENT]:{[jr.TRANSPARENT]:new Vr,[jr.OPAQUE]:new Vr},[jr.OPAQUE]:{[jr.TRANSPARENT]:new Vr,[jr.OPAQUE]:new Vr}},this._renderablesDirty=!1,this._drawParameters=new VIt,this._settings={...t$t,...i},this.key=iFe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:Qi.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=r$t[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=en(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){this._renderablesDirty&&this._sortRenderables(),this._sortedRenderables[r][jr.TRANSPARENT].forAll(e),this._sortedRenderables[r][jr.OPAQUE].forAll(e)}updateTechnique(e,r){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(tFe,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,i,s,n){this._render(e,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(e,r,i,s,n){this._render(e,r,r.silhouette.vao,i,s,n)}_render(e,r,i,s,n,o){o>0&&(this._bindDraw(e,r,s,n),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(Ar.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,s){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const n=new Z7(r.transform.position),o=df(jye,RT(jye,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;$e(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,s,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[jr.TRANSPARENT][jr.TRANSPARENT].clear(),this._sortedRenderables[jr.TRANSPARENT][jr.OPAQUE].clear(),this._sortedRenderables[jr.OPAQUE][jr.TRANSPARENT].clear(),this._sortedRenderables[jr.OPAQUE][jr.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==jr.INVISIBLE&&r.edgeTransparency!==jr.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[jr.TRANSPARENT][jr.TRANSPARENT].sort(e),this._sortedRenderables[jr.TRANSPARENT][jr.OPAQUE].sort(e),this._sortedRenderables[jr.OPAQUE][jr.TRANSPARENT].sort(e),this._sortedRenderables[jr.OPAQUE][jr.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const jye=Uu();function lQt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:i$t(t.layout)}}function mF(t){return s$t(t.layout).createView(t.buffer)}function i$t(t){const e=new Array;return t.fields.forEach((r,i)=>{const s={...r,constructor:sFe(r.constructor)};e.push([i,s])}),{stride:t.stride,fields:e,fieldNames:t.fieldNames}}function s$t(t){const e=gn();return e.stride=t.stride,e.fieldNames=t.fieldNames,t.fields.forEach(r=>e.fields.set(r[0],{...r[1],constructor:o$t(r[1].constructor)})),e}const n$t=[Dse,o_,ks,Gh,cb,Fse,kse,Bse,cc,i7,Nse,b4,lM,s7,w4,uc,n7,Use,o7,BL,a7,Vse,iPe,sPe,zse,l7,nPe,oPe,aPe,c7,lPe,cPe,uPe,hPe,dPe,pPe];function sFe(t){return`${t.ElementType}_${t.ElementCount}`}function o$t(t){return nFe.get(t)}const nFe=new Map;n$t.forEach(t=>nFe.set(sFe(t),t));let a$t=class extends l5e{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return XOt(e);const s=await this.invoke(new jH(e),r);return this._unpackOutput(s)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new jH(e),r);return mF(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new jH(e),r);return mF(i)}_unpackOutput(e){return{regular:{instancesData:mF(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:mF(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},jH=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Array.isArray(e.indices)?e.indices:e.indices.buffer,this.indicesType=Array.isArray(e.indices)?"Array":Jee(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function l$t(t){const r=RO.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=RO.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,h=RO.strokes.length;let p=(c-1)*h*l;for(const{distance:_,pressure:w}of RO.strokes){let T=_,C=w,M=p;for(let O=0;O<c;O++){O!==0&&(T=Hye(T,W4.DISTANCE),C=Hye(C,W4.PRESSURE));for(let $=0;$<RO.resolution;$++){const L=.5+(T?T[$%T.length]/a:0),k=C?C[$%C.length]:1;R4(L,s,M),R4(k,s,M+n),M+=4}M-=l*(h+1)}p+=l}const A=new Wt(t,{pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:Bt.LINEAR,width:r,height:r,wrapMode:pr.REPEAT},s);return new u$t(r,a,o,h,A)}function Hye(t,e){if(!t)return null;const r=t.length/2,i=c$t*r,s=new Array(r);let n=0;const o=e===W4.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*qye):Math.min(i,l*qye)}return s}var W4;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(W4||(W4={}));const c$t=.1,qye=.5;let u$t=class{constructor(e,r,i,s,n){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=Nt(this.texture)}};const RO={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Wye(t){let e=null;for(const r of t){const i=r.type;if(h$t(r)){if(N(e))e=i;else if(e!==i)return"uber"}}return E(e)?e:"uber"}function Yye(t){let e=jr.INVISIBLE;for(const{material:r}of t)if(oFe(r)){if(r.color[3]*r.opacity<1)return jr.TRANSPARENT;e=jr.OPAQUE}return e}function Qye(t){let e=jr.INVISIBLE;for(const{material:r}of t)if(oFe(r)){switch(r.objectTransparency){case jr.TRANSPARENT:case jr.INVISIBLE:return jr.TRANSPARENT;case jr.OPAQUE:if(r.opacity<1)return jr.TRANSPARENT}e=jr.OPAQUE}return e}function oFe(t){return t.size*t.color[3]*t.opacity>0}function h$t(t){return t.size*t.color[3]>0}function Xye(t,e,r,i){for(let s=0;s<t.length;s++){const n=t[s].index,o=e[s],a=e[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}let Jf=class extends Ke{constructor(t){super(t),this._updatingHandles=new vg,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=V(),this._localOrigins=new kIt(new Yne(t.renderSR))}initialize(){this._worker=new a$t(this.schedule),this._componentColorManager=new yNe(this.rctx,3);const t=pNe.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Wi.createVertex(this.rctx,Li.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=Nt(this._strokesTexture),this._componentColorManager=gt(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=Nt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,r,i,s,n,o,a){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let l;const c=new Jye(new Promise(p=>l=p),r.center,r.radius);this._perObjectData.set(t,c);const h=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,i,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(t,e,r,i){if(this.destroyed)return void we.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(t);let n;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const o=t.boundingVolumeWorldSpace.bounds,a=new Jye(new Promise(c=>n=c),o,Ay(o));this._perObjectData.set(t,a);const l=new Array;if(r.mergeGeometries&&t.geometries.length>1&&d$t(t))l.push(this._addObjectMergedGeometries(t,a,e,r,i));else for(let c=0;c<t.geometries.length;c++){const h=t.geometries[c];h.material.supportsEdges&&l.push(this._addGeometry(t,a,h,e[0],r,i))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(N(r))return;const i=e instanceof Array?s=>e[s]:()=>e;r.renderables.forEach(s=>{const n=s.components.meta.length;for(let o=0;o<n;o++){const a=i(o),l=s.components.meta[o],c=l.index;l.material.opacity=a,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return E(e)?e.renderables.reduce((r,i)=>r+i.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,r,i){const s=t instanceof u_,n=!!r.hasSlicePlane,o=Wye(e),a=GH.getKey(o,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));N(l)||(l.renderables.forEach(c=>{if(a!==c.rendererKey){const h=this._renderers.get(c.rendererKey),p=this._acquireRenderer(o,n,s);h.removeRenderable(c),--h.refCount,c.rendererKey=a,p.addRenderable(c)}for(let h=0;h<e.length;h++)c.components.meta[h].material=e[h];i&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));N(r)||(r.renderables.forEach(i=>{const s=i.components.meta;for(let n=0;n<s.length;n++)i.components.meta[n].verticalOffset=(e==null?void 0:e[n])??0;this._updateComponentBuffer(i.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));E(r)&&(r.renderables.forEach(i=>i.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(N(this._componentColorManager))return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const r=t.camera.viewInverseTransposeMatrix,i=V(),s=new Z7;let n=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,h=!0;l.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,c&&p.regular&&(l.updateTechnique(t,!1),c=!1),h&&p.silhouette&&(l.updateTechnique(t,!0),h=!1))},e)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new UIt(40*n/o,e);$e(i,r[3],r[7],r[11]),s.set(i),Oe(a.transformWorldFromViewTH,s.high),Oe(a.transformWorldFromViewTL,s.low),hf(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),df(r_e,a.transformViewFromCameraRelativeRS),RT(a.transformNormalViewFromGlobal,r_e),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=Yye(t.components.meta),r=Qye(t.components.meta);e===t.edgeTransparency&&r===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=r,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,r){t.getCombinedStaticTransformation(e,r);const i=E(e.localOrigin)?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire($e(this._tmpModelPosition,r[12],r[13],r[14]));return e.localOrigin=i.origin,NIt(i.origin.vec3,r),i}_updateComponentBuffer(t){const{meta:e,buffer:r}=t,i=new Uint8Array(4);for(let s=0;s<e.length;s++){const n=e[s].material,o=e[s].index,a=ze(Math.round(n.size*e$t),0,255),l=ze(n.extensionLength,-zH,255-zH)+zH,c=n.type==="solid"?fB.SOLID:fB.SKETCH,h=255*n.opacity,p=n.color,A=255*p[0],_=255*p[1],w=255*p[2],T=255*p[3];r.textureBuffer.setData(o,0,A,_,w,T),r.textureBuffer.setData(o,1,a,l,c,h),cNe(e[s].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(t){if(N(this._componentColorManager))return null;const e=new Array,r=this._componentColorManager.getBuffer(t.length);for(let s=0;s<t.length;s++){const n=t[s],o=r.acquireIndex();e.push({index:o,verticalOffset:0,material:n})}const i=new p$t(r,e);return this._updateComponentBuffer(i),i}_extractEdges(t,e,r,i,s,n=s.length){return this._worker.process({data:e,indices:s,indicesLength:n,writerSettings:t,skipDeduplicate:r},this._workerAbort.signal,i)}_createRenderable(t,e,r,i,s){const n=c=>E(this._verticesBufferObject)?new f$t(new Z0(this.rctx,mNe,{vertices:BOt,instances:c===H2.REGULAR?dB.glLayout:pB.glLayout},{vertices:this._verticesBufferObject,instances:Wi.createVertex(this.rctx,Li.STATIC_DRAW,c===H2.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===H2.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?n(H2.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?n(H2.SILHOUETTE):null,l=(E(o)?o.vao.size:0)+(E(a)?a.vao.size:0);return new g$t(o,a,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:t.averageEdgeLength},r,Yye(e.meta),Qye(e.meta),e,i)}async _addGeometry(t,e,r,i,s,n){const o=r.vertexAttributes.get(B.POSITION),a=r.indices.get(B.POSITION),l=ot(),c=this._computeModelTransformWithLocalOrigin(t,r,l),h=new t_e(o,a,l,c);return this._addPositionData(e,h,r.edgeIndicesLength,i,s,n)}async _addPositionData(t,e,r,i,s,n=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([i]);if(N(o)||r<=0)return;const a=this._acquireRenderer(i.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,h=e.indices,p=e.position,A=p.data.length/p.size,_=uB.createBuffer(A);for(let C=0;C<A;C++)_.position.set(C,0,p.data[C*p.size+0]),_.position.set(C,1,p.data[C*p.size+1]),_.position.set(C,2,p.data[C*p.size+2]);Xye(o.meta,[0,_.componentIndex.count],_.componentIndex);const w=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,_,!1,n,h,r));if(t.loaded==null)return;const T=this._createRenderable(w,o,new m$t(l,c),a.key,!1);t.renderables.push(T),a.addRenderable(T),this._gpuMemoryUsage+=T.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,r,i,s,n,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(n);if(N(a))return 0;const l=Wye(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=uB.createBuffer(r.count);V7(h.position,r),Xye(a.meta,s,h.componentIndex,i);const p=!0,A=c.writerSettings,_=await this._updatingHandles.addPromise(this._extractEdges(A,h,p,!1,i));if(e.loaded==null)return 0;const w=this._createRenderable(_,a,t,c.key,!0);return e.renderables.push(w),c.addRenderable(w),w.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,r,i,s){const n=new Map;let o=0,a=null,l=0;for(let M=0;M<t.geometries.length;M++){const O=t.geometries[M];if(!O.material.supportsEdges)continue;!a&&O.localOrigin&&(a=O);const $=O.vertexAttributes.get(B.POSITION);l+=$.data.length/$.size,o+=O.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let A=0;for(let M=0;M<t.geometries.length;M++){const O=t.geometries[M];if(!O.material.supportsEdges)continue;const $=O.vertexAttributes.get(B.POSITION),L=O.indices.get(B.POSITION);let k=n.get($.data);if(k==null){k=p.length/3;for(let F=0;F<$.data.length;F+=$.size)p.push($.data[F+0]),p.push($.data[F+1]),p.push($.data[F+2]);n.set($.data,k)}if(L)for(let F=0;F<O.edgeIndicesLength;F++)h[A++]=k+L[F]}const _=a||t.geometries[0],w=ot(),T=this._computeModelTransformWithLocalOrigin(t,_,w);for(let M=0;M<t.geometries.length;M++)t.geometries[M].localOrigin=T.origin;const C=new t_e({data:p,size:3},h,w,T);await this._updatingHandles.addPromise(this._addPositionData(e,C,h.length,r[0],i,s))}_acquireRenderer(t,e,r){const i=GH.getKey(t,e,r);let s=this._renderers.get(i);return N(this._strokesTexture)&&(this._strokesTexture=l$t(this.rctx)),s||(s=new GH(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===_t.Global}),this._renderers.set(i,s)),++s.refCount,s}_removeRenderable(t){Zye(t.regular),Zye(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const r of t.components.meta)t.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,r=t.camera.viewForward,i=V(),s=n=>{Da(i,n.center,e);const o=He(i,r),a=n.radius,l=o<-a?1/0:o<a?0:o-a;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(t,e,r){const i=t.bindRegularEdges(r,e),s=r.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!Kye(o)||!o.visible)return;const a=gF(o.regular.lod.lengths,o.distanceToCamera,n);t.renderRegularEdges(i,o,r,e,a)},s)}_renderSilhouetteEdges(t,e,r){const i=t.bindSilhouetteEdges(r,e),s=r.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!e_e(o)||!o.visible)return;const a=gF(o.silhouette.lod.lengths,o.distanceToCamera,n);t.renderSilhouetteEdges(i,o,r,e,a)},s)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const r=t.perScreenPixelRatio,i=(s,n)=>s.forEachRenderable(o=>{o.visible&&!e&&(Kye(o)&&(e=gF(o.regular.lod.lengths,o.distanceToCamera,r)>0),!e&&e_e(o)&&(e=gF(o.silhouette.lod.lengths,o.distanceToCamera,r)>0))},n);return this._renderers.forEach(s=>{e||(i(s,jr.OPAQUE),i(s,jr.TRANSPARENT))}),e}}}};function Zye(t){E(t)&&(t.vao.vertexBuffers.instances.dispose(),t.vao.dispose(!1),t.vao=null)}function d$t(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const s=t.geometries[i];if(s.material.supportsEdges){if(e){if(!Iy(e,s.transformation))return!1}else e=s.transformation;if(!r&&E(s.localOrigin))r=s;else if(r&&E(r.localOrigin)&&E(s.localOrigin)&&r.localOrigin.id!==s.localOrigin.id)return!1}}return!0}u([d({constructOnly:!0})],Jf.prototype,"rctx",void 0),u([d({constructOnly:!0})],Jf.prototype,"renderSR",void 0),u([d({constructOnly:!0})],Jf.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],Jf.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],Jf.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],Jf.prototype,"schedule",void 0),u([d({readOnly:!0})],Jf.prototype,"_updatingHandles",void 0),u([d({readOnly:!0})],Jf.prototype,"updating",null),Jf=u([j("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Jf);class Jye{constructor(e,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class p$t{constructor(e,r){this.buffer=e,this.meta=r}}let f$t=class{constructor(e,r){this.vao=e,this.lod=r}};class m$t{constructor(e,r){this.modelMatrix=e,this.origin=r}}class g$t{constructor(e,r,i,s,n,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function Kye(t){return E(t.regular)}function e_e(t){return E(t.silhouette)}function gF(t,e,r){const i=e*r,s=q9e(t,i,!0);return s===-1?i<t[0]?t.length:0:t.length-s}let t_e=class{constructor(e,r,i,s){this.position=e,this.indices=r,this.modelTransform=i,this.origin=s}};const r_e=mn();function Kg(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let i_e=class{constructor(e,r,i,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},HA=!1;function A$t(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&Kg(t)?new i_e(()=>t.createQuery(),i=>{t.deleteQuery(i),HA=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{HA||(HA=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),HA=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new i_e(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),HA=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{HA||(HA=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),HA=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function y$t(t,e){const r=t.capabilities.disjointTimerQuery;return N(r)?null:new _$t(r,e)}let _$t=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(i,null)})}start(){HA||(this._currentQuery=this._queryPool.pop(),N(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||N(this._currentQuery)||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(N(r))return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){E(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){E(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{N(e)||this._timer.deleteQuery(e)})}};var Ns;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Ns||(Ns={}));const s_e="Total";let v$t=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new uy(s_e),this._cpuTimeSamplers=new Map(Object.values(Ns).map(r=>[r,new uy(r)])),this._enableGPUTimer=0,this._totalGPUTime=new uy("GPU"),this._gpuTimeSamplers=new Map(Object.values(Ns).map(r=>[r,new uy(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return E(this._gpuTimerPool)}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(N(this._gpuTimerPool)){const e=[...Object.values(Ns),s_e];this._gpuTimerPool=y$t(this._rctx,e)}return N(this._gpuTimerPool)?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:rte(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Nt(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),E(this._gpuTimerPool)&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,E(this._gpuTimerPool)){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(E(this._gpuTimerPool)){const r=this._gpuTimerPool.stop(Ns.FINISH);this._gpuTimeSamplers.get(Ns.FINISH).record(r)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),E(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},dd=class extends Ke{get _bindParameters(){return this._renderContext.bindParameters}isFeatureEnabled(t,e=this._state){return gr(this._renderStateFeatures.get(e,t),!1)}setFeatureEnabled(t,e,r){this._renderStateFeatures.set(e,t,r),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(so.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(so.HighQualityTransparency)}get hasWaterReflection(){return this.hasWater&&(this._waterReflectionEnabled||this.isFeatureEnabled(so.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(t,e,r,i,s,n,o,a){super({}),this._stage=t,this._materialRepository=e,this._shaderTechniqueRepository=i,this._rctx=s,this._compositingHelper=n,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new Vr,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new CIt,this._state=Ei.IDLE,this._renderStateFeatures=Gfe(),this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=oa.Opaque,this._waterReflectionEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new FPt,this._handles=new ts,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new aI(this._rctx,i),a(),this._offscreen=new iIt(this._rctx,this._compositingHelper),this.performanceInfo=new v$t(this._rctx),this._shadowMap=new Qne(this._rctx,t.viewingMode),this._ssaoHelper=new SLe(t.view,i,this._rctx,a),this._highlight=new KPt(i,this._rctx),this._shadowHighlight=new EIt(this._rctx,t.viewingMode),this._shadowAccumulator=new Tu(this._rctx,i,t,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,h)=>{l.shadowMap.start(l.camera,c,h),this._renderShadowCascades(ee.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._renderContext=new $vt(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new oIt({renderContext:this._renderContext,techniqueRepository:i,textureRepository:r,materialRepository:this._materialRepository,requestRender:a,controller:t}),this.renderPassManager=new NPt(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([xe(()=>this._stage.view.state.camera,()=>a(),ao),xe(()=>Qi.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(jr.TRANSPARENT):()=>{},a()},Cr),xe(()=>this._ssaoEnabled||this.isFeatureEnabled(so.SSAO),l=>this._ssaoHelper.enabled=l,ao)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=sn(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=Nt(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),yPe.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||E(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return N(this._edgeView)&&(this._edgeView=new Jf({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:t=>this._stage.view.resourceController.immediate.schedule(t)}),this._handles.add(xe(()=>ka(this._edgeView,t=>t.updating),()=>this._requestRender(),os)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return Mre(this._bindParameters.ssr.reprojectionMatrix,Hd)}set _reprojectionMatrix(t){Qee(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var t;return!!((t=this._shadowMap)!=null&&t.enabled)}setParameters(t){const{_shadowMap:e,_bindParameters:r}=this;if(t.screenSpaceReflectionsEnabled!==void 0&&r.ssr.enabled!==t.screenSpaceReflectionsEnabled&&(r.ssr.enabled=t.screenSpaceReflectionsEnabled,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),E(t.environment)){E(t.environment.weather)&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible),t.environment.lighting.ambientOcclusionEnabled!==void 0&&this._ssaoEnabled!==t.environment.lighting.ambientOcclusionEnabled&&(this._ssaoEnabled=t.environment.lighting.ambientOcclusionEnabled,this._requestRender()),t.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==t.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=t.environment.lighting.waterReflectionEnabled,this._requestRender());const i=t.environment.lighting.type!=="virtual";r.enableFillLights!==i&&(r.enableFillLights=i,this._requestRender())}t.background&&this._offscreen.background!==t.background&&(this._offscreen.background=t.background,this._requestRender()),t.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==t.antialiasingEnabled&&(this._antialiasingEnabled=t.antialiasingEnabled,this._requestRender()),t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(t.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(t.defaultHighlightOptions),this._requestRender()),t.overlays!==void 0&&this._bindParameters.overlays!==t.overlays&&(this._bindParameters.overlays=t.overlays,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.renderOverlay!==void 0&&this._renderOverlay!==t.renderOverlay&&(this._renderOverlay=t.renderOverlay,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==t.terrainRenderingEnabled&&(this._terrainRenderingEnabled=t.terrainRenderingEnabled,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:i,updates:s}=t;if(r.length===0&&i.length===0&&s.length===0)return;const n=oLe(t);let o=!1;n.forEach((a,l)=>{if(e.done)return;let c=this._materialRenderers.find(h=>h.material===l);N(c)&&a.adds.length>0&&(c=new yLe(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(h=>t.removes.removeUnordered(h)),a.adds.forEach(h=>t.adds.removeUnordered(h)),a.updates.forEach(h=>t.updates.removeUnordered(h)),e.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(a=>a.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(a=>a.hasOccludees),this._hasWater=this._materialRenderers.some(a=>a.hasWater),this._hasHUDElements=this._materialRenderers.some(a=>a.requiresSlot(et.LINE_CALLOUTS_HUD_DEPTH,ee.Color)||a.requiresSlot(et.HUD_MATERIAL,ee.Color)||a.requiresSlot(et.LABEL_MATERIAL,ee.Color)),this._requestRender()}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(r=>this._hasAnimations=r.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?sn(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(t,e,r,i,s){this._isRendering=!0,this.performanceInfo.startFrame();const{camera:n,contentCamera:o,mode:a}=r;this._state=a,this._renderOverlay(s),this.performanceInfo.advance(Ns.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=lr.NONE;const l=this._offscreen;l.setupRenderTarget(this.hasWaterReflection);const c=Zy(this._sliceHelper.plane);i===tT.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(t),n.setGLViewport(this._rctx),this._prepare(n,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Ns.PREPARE);const h=this._computeDepthRange(n);this._renderShadowMap(t,n,this._bindParameters.lighting.mainLight.direction,h),this.performanceInfo.advance(Ns.SHADOW_MAP),l.initializeFrame(n),this._ensureBindParameters(n,o),this._renderLinearDepth(),this.performanceInfo.advance(Ns.LINEAR_DEPTH),this._accumulateShadows(h,n,o),this.performanceInfo.advance(Ns.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(Ns.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(Ns.SSAO),this._renderContext.output=ee.Color,l.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Ns.OPAQUE);const p=this._terrainRenderingEnabled&&(this._terrainTransparency===oa.Semitransparent||this._terrainTransparency===oa.TransparentWithDraped),A=this._highQualityTransparency&&p;this._renderTerrainLinearDepth(A),this._setMultipassEnabled(A),this._setTerrainCulling(A),this._renderEdges(jr.OPAQUE),this.performanceInfo.advance(Ns.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(et.VOXEL),this.performanceInfo.advance(Ns.VOXEL),this._renderHiddenTransparentEdges();const _=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;_&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Ns.TRANSPARENT),this._renderGeometryLinearDepth(A);const w=this._renderHUDVisibility(A);A||this._renderInternalSlot(et.LINE_CALLOUTS),this.performanceInfo.advance(Ns.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(Ns.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(jr.TRANSPARENT,A),this.performanceInfo.advance(Ns.TRANSPARENT_EDGES),this._renderTransparentTerrain(),p&&w&&(A?this._renderLineCallouts(Ad.Occluded):l.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Ad.Occluded,l.framebuffer),this.performanceInfo.advance(Ns.HUD_OCCLUDED)),this.performanceInfo.advance(Ns.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),p&&(l.compositeTransparentTerrainOntoMain(this._bindParameters),A&&(this._renderEdges(jr.OPAQUE),this.performanceInfo.advance(Ns.OPAQUE_EDGES),_&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Ns.TRANSPARENT),this._renderEdges(jr.TRANSPARENT),this.performanceInfo.advance(Ns.TRANSPARENT_EDGES))),A&&this._renderLineCallouts(Ad.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),l.renderToTargets(()=>{this._renderInternalSlot(et.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(et.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(et.LASERLINES)},l.currentColorTarget,l.mainDepth),this.performanceInfo.advance(Ns.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&l.renderTmpAndCompositeToMain(()=>this._renderSlot(et.LASERLINES_CONTRAST_CONTROL),this._bindParameters,ec.PremultipliedAlpha),this.performanceInfo.advance(Ns.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(Ns.OCCLUDED);const T=i===tT.ON&&this._magnifierHelper.enabled,C=T&&N(t)?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):t;this._rctx.bindFramebuffer(C);const M=this._offscreen.colorTexture;!this._renderAntiAliasing(M)&&E(M)&&this._compositingHelper.composite(this._bindParameters,M,ec.None),this.performanceInfo.advance(Ns.ANTIALIASING),this._renderHUD(Ad.NotOccluded,C),this.performanceInfo.advance(Ns.HUD),this._renderHighlights(C,this._bindParameters),this.performanceInfo.advance(Ns.HIGHLIGHTS),T&&this._magnifierHelper.render(this._rctx,this._bindParameters),C!==t&&(this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,ec.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=c,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_renderObjectAndLayerIdColor(t){if(E(t)&&Le("enable-feature:objectAndLayerId-rendering")){const e=this._renderContext.output;this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(ee.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=Ad.NotOccluded,this._renderInternalSlot(et.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,r=t===Wn.BACKGROUND;if(r||e){const i=r?this.performanceInfo.elapsedTime:0,s=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),n=Math.max(i,s);this._animationTimestep.frame(n,r)}}readDepthPixels(t,e,r){const i=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=qs.COLOR_BUFFER_BIT|qs.DEPTH_BUFFER_BIT|qs.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(ee.Depth)}i.readPixels(e[0],e[1],e[2],e[3],At.RGBA,yr.UNSIGNED_BYTE,r)}readHUDVisibility(t,e,r,i,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(t,e,r,i,At.RGBA,yr.UNSIGNED_BYTE,s)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassEnabled(t){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_renderSlot(t){this._bindParameters.slot=t,this._renderPlugins.render()}_renderEdges(t,e=!1){const r=this._edgeView;E(r)&&r.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>r.render(this._bindParameters,t),this._bindParameters,ec.Alpha,e)}_renderShadowMap(t,e,r,i){const s=this._shadowMap;s.enabled&&this.isFeatureEnabled(so.ShadowMapUpdate)&&(s.start(e,r,i),this._shadowHighlight.updateParameters(e,r),this._needsShadowHighlight?(this._renderShadowCascades(ee.ShadowHighlight,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,AM.Highlight)),s.clear(),this._renderShadowCascades(ee.ShadowExcludeHighlight,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,AM.Default),this._renderGeometryAndTransparentTerrainPass(ee.ShadowHighlight)})):this._renderShadowCascades(ee.Shadow),s.finish(t),e.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap,r=i=>{}){for(const i of e.cascades)i.camera.setGLViewport(this._rctx),this._prepare(i.camera,i.camera),this._renderGeometryAndTransparentTerrainPass(t),r(i)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasWaterReflection||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(ee.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=ee.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(t){if(t){const e=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(ee.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(ee.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return UK;const e=_Pt(t,this._materialRenderers,this._stage.layers);return wM(e,this.renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderGeometryAndTransparentTerrainPass(t){this._renderContext.output=t,this._renderGeometryPass(t),this._renderTransparentTerrain()}_renderGeometryPass(t){this._renderContext.output=t,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(t){this._ssaoHelper.render(this._bindParameters,t,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_renderOpaqueGeometry(){this._renderSlot(et.INTEGRATED_MESH),this._renderSlot(et.OPAQUE_TERRAIN),this._renderInternalSlot(et.OPAQUE_MATERIAL),this._renderSlot(et.OPAQUE_MATERIAL),this._renderSlot(et.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(et.TRANSPARENT_MATERIAL),this._renderSlot(et.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(et.TRANSPARENT_TERRAIN)}_renderHUDVisibility(t){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(et.OCCLUSION_PIXELS)},t),e}_renderLineCallouts(t){this._bindParameters.renderTransparentlyOccludedHUD=t,t===Ad.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(et.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(et.LINE_CALLOUTS)}_renderHUD(t,e){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(t),!0),this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,ec.PremultipliedAlpha)):t===Ad.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(Ad.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(t))}_renderHUDElements(t){this._bindParameters.renderTransparentlyOccludedHUD=t,this._renderInternalSlot(et.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(et.HUD_MATERIAL),this._renderInternalSlot(et.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(t,e){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const r=this._highlight,i=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(ee.Highlight),this._rctx.clearSafe(qs.DEPTH_BUFFER_BIT),this._renderHUDElements(Ad.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=i.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(e,t),r.render(this._bindParameters,i,t)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(t,e,r){this._needsShadowCast&&E(this._offscreen.linearDepthTexture)&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,t,e,r)}_renderOrderIndependentTransparency(t,e){const r=s=>{this._bindParameters.transparencyPassType=s,this._offscreen.renderOITPass(()=>t(),s,e)},i=this._renderContext.output;this._renderContext.output=ee.Alpha,r(lr.Alpha),this._renderContext.output=ee.Color,r(lr.Color),r(lr.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,e),this._bindParameters.transparencyPassType=lr.NONE,this._renderContext.output=i,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let t=0;Pf.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&n.material.renderOccluded===xn.OccludeAndTransparentStencil&&(t|=n.material.renderOccluded,Pf.push(n))});const e=this._offscreen,r=(n,o,a,l,c)=>{t&o&&(e.renderToTargets(a,e.tmpColor,e.mainDepth,[0,0,0,0],l,c),e.compositeOccludedOntoMain(this._bindParameters,n))};Pf.length!==0&&(this._renderInternalSlot(et.OCCLUDER_MATERIAL,Pf),r(.5,xn.OccludeAndTransparentStencil,()=>this._renderInternalSlot(et.TRANSPARENT_OCCLUDER_MATERIAL,Pf),!1,!1)),Pf.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&(n.material.renderOccluded===xn.OccludeAndTransparent||n.material.renderOccluded===xn.Transparent||n.material.renderOccluded===xn.Opaque)&&(t|=n.material.renderOccluded,Pf.push(n))});const i=this._renderPlugins.renderOccludedFlags;if(t|=i,!t)return;const s=n=>{this._renderContext.renderOccludedMask=n,i>xn.Occlude&&this._renderSlot(et.OCCLUDED_TERRAIN),this._renderInternalSlot(et.OPAQUE_MATERIAL,Pf),this._renderInternalSlot(et.TRANSPARENT_MATERIAL,Pf),this._renderInternalSlot(et.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Pf),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=ee.Color,r(.5,xn.OccludeAndTransparent,()=>s(xn.OccludeAndTransparent),!0,Bu.OutlineVisualElementMask),r(.5,xn.Transparent,()=>s(xn.Transparent),!0,Bu.OutlineVisualElementMask),r(1,xn.Opaque,()=>s(xn.Opaque),!0,Bu.OutlineVisualElementMask),Pf.clear()}_renderAntiAliasing(t){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&E(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(r=>r.requiresSlot(et.TRANSPARENT_MATERIAL,ee.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.mainColorTexture=r.mainColorTexture,this._bindParameters.highlightDepthTexture=r.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.enabled=this.hasWaterReflection,this._bindParameters.ssr.enabled){N(this._waterReflectionEnableTime)&&(this._waterReflectionEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Hd:(ul(o_e,this._bindParameters.camera.viewMatrix),ul(n_e,this._bindParameters.camera.projectionMatrix),$n(WS,o_e,n_e),$n(WS,this._renderContext.lastFrameCamera.viewMatrix,WS),$n(WS,this._renderContext.lastFrameCamera.projectionMatrix,WS),this._reprojectionMatrix=WS),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._waterReflectionEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._bindParameters.ssr.lastFrameColorTexture=null,this._waterReflectionEnableTime=null}_renderInternalSlot(t,e=this._materialRenderers){let r=!1;return this._bindParameters.slot=t,e.forAll(i=>{i.material.shouldRender(this._renderContext)&&i.render(this._renderContext.output,this._bindParameters)&&(r=!0)}),r}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=gOe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var t,e,r,i,s;return{offscreen:((t=this._offscreen)==null?void 0:t.gpuMemoryUsage)??0,highlights:(((e=this._highlight)==null?void 0:e.gpuMemoryUsage)??0)+(((r=this._shadowHighlight)==null?void 0:r.gpuMemoryUsage)??0),shadows:((i=this._shadowMap)==null?void 0:i.gpuMemoryUsage)??0,ssao:((s=this._ssaoHelper)==null?void 0:s.gpuMemoryUsage)??0}}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=Gfe()},getFramebufferTexture:e=>{switch(e){case Q1.Color:return t._offscreen.colorTexture;case Q1.LinearDepth:return t._offscreen.linearDepthTexture;case Q1.Normals:return t._offscreen.normalTexture;case Q1.ShadowMap:return t._shadowMap.depthTexture;case Q1.HudVisibility:return t._offscreen.hudVisibilityTexture;case Q1.Highlight:return t._offscreen.highlightTexture}}}}};var Q1;u([d()],dd.prototype,"_shadowAccumulator",void 0),u([d()],dd.prototype,"_state",void 0),u([d()],dd.prototype,"_renderStateFeatures",void 0),u([d()],dd.prototype,"_antialiasingEnabled",void 0),u([d({readOnly:!0})],dd.prototype,"_antialiasing",null),u([d()],dd.prototype,"_ssaoEnabled",void 0),u([d()],dd.prototype,"_smaaPass",void 0),u([d({autoDestroy:!0})],dd.prototype,"_edgeView",void 0),u([d()],dd.prototype,"updating",null),u([d()],dd.prototype,"isCameraFinal",null),dd=u([j("esri.views.3d.webgl-engine.lib.Renderer")],dd),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(Q1||(Q1={}));const Pf=new Vr,n_e=ot(),o_e=ot(),WS=ot();let a_e=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:tt.ONE,dstRGB:tt.ZERO,srcAlpha:tt.ONE,dstAlpha:tt.ZERO},this.blendEquation={mode:kg.ADD,modeAlpha:kg.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=T0.BACK,this.frontFace=sM.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Bs.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:T0.FRONT_AND_BACK,func:Bs.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:T0.FRONT_AND_BACK,fail:Zn.KEEP,zFail:Zn.KEEP,zPass:Zn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},b$t=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,s)=>{const n=s.split(`
`);n.shift(),n.shift(),e+=`${i}: ${n.shift()}
`,n.forEach(o=>e+=`   ${o}
`)})}return e}};const w$t={RECORD_ALLOCATIONS:!1};let x$t=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new b$t(w$t.RECORD_ALLOCATIONS);this._current.length<fa.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,r){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(r)}decrement(e,r){--this._current[e],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,r)=>e+r,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<fa.COUNT;++r){const i=this._current[r];i>0&&(e+=`${fa[r]}: ${i}
`)}}return e+=this._allocations.information,e}};const T$t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var l_e,QK={},S$t={get exports(){return QK},set exports(t){QK=t}};(l_e=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(S$t.exports=l_e);const E$t=QK;var c_e,XK={},C$t={get exports(){return XK},set exports(t){XK=t}};c_e=C$t,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(c_e.exports=e)}();const u_e=XK;var ZK={},M$t={get exports(){return ZK},set exports(t){ZK=t}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(M$t);const R$t=ZK;var If=999,h_e=9999,HH=0,qH=1,d_e=2,p_e=3,f_e=4,AF=5,O$t=6,P$t=7,I$t=8,m_e=9,$$t=10,g_e=11,L$t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function D$t(){var t,e,r,i=0,s=0,n=If,o=[],a=[],l=1,c=0,h=0,p=!1,A=!1,_="";return function(re){return a=[],re!==null?T(re.replace?re.replace(/\r\n/g,`
`):re):C()};function w(re){re.length&&a.push({type:L$t[n],data:re,position:h,line:l,column:c})}function T(re){var Ae;for(i=0,r=(_+=re).length;t=_[i],i<r;){switch(Ae=i,n){case HH:i=k();break;case qH:i=L();break;case d_e:i=$();break;case p_e:i=F();break;case f_e:i=Z();break;case g_e:i=z();break;case AF:i=J();break;case h_e:i=te();break;case m_e:i=O();break;case If:i=M()}Ae!==i&&(_[Ae]===`
`?(c=0,++l):++c)}return s+=i,_=_.slice(i),a}function C(re){return o.length&&w(o.join("")),n=$$t,w("(eof)"),a}function M(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=s+i-1,n=HH,e=t,i+1):e==="/"&&t==="/"?(h=s+i-1,n=qH,e=t,i+1):t==="#"?(n=d_e,h=s+i,i):/\s/.test(t)?(n=m_e,h=s+i,i):(p=/\d/.test(t),A=/[^\w_]/.test(t),h=s+i,n=p?f_e:A?p_e:h_e,i)}function O(){return/[^\s]/g.test(t)?(w(o.join("")),n=If,i):(o.push(t),e=t,i+1)}function $(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(w(o.join("")),n=If,i)}function L(){return $()}function k(){return t==="/"&&e==="*"?(o.push(t),w(o.join("")),n=If,i+1):(o.push(t),e=t,i+1)}function F(){if(e==="."&&/\d/.test(t))return n=AF,i;if(e==="/"&&t==="*")return n=HH,i;if(e==="/"&&t==="/")return n=qH,i;if(t==="."&&o.length){for(;G(o););return n=AF,i}if(t===";"||t===")"||t==="("){if(o.length)for(;G(o););return w(t),n=If,i+1}var re=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||re){for(;G(o););return n=If,i}return o.push(t),e=t,i+1}function G(re){for(var Ae,ve,ye=0;;){if(Ae=u_e.indexOf(re.slice(0,re.length+ye).join("")),ve=u_e[Ae],Ae===-1){if(ye--+re.length>0)continue;ve=re.slice(0,1).join("")}return w(ve),h+=ve.length,(o=o.slice(ve.length)).length}}function z(){return/[^a-fA-F0-9]/.test(t)?(w(o.join("")),n=If,i):(o.push(t),e=t,i+1)}function Z(){return t==="."||/[eE]/.test(t)?(o.push(t),n=AF,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(n=g_e,o.push(t),e=t,i+1):/[^\d]/.test(t)?(w(o.join("")),n=If,i):(o.push(t),e=t,i+1)}function J(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(w(o.join("")),n=If,i):(o.push(t),e=t,i+1)}function te(){if(/[^\d\w_]/.test(t)){var re=o.join("");return n=E$t.indexOf(re)>-1?I$t:R$t.indexOf(re)>-1?P$t:O$t,w(o.join("")),n=If,i}return o.push(t),e=t,i+1}}function N$t(t){var e=D$t(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function F$t(t){return N$t(t)}function k$t(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const WH=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function B$t(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===r)return o;if(o===e)return s.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function U$t(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function lI(t,e,r,i){i=i||r;for(const s of t)if(s.type==="ident"&&s.data===r)return i in e?e[i]++:e[i]=0,lI(t,e,i+"_"+e[i],i);return r}function aFe(t,e,r="afterVersion"){function i(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let A=0;A<l.length;A++){const _=l[A];if(_.type==="preprocessor"&&(_.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:_.data.match(/\#endif\s*.*/)&&--h),r!=="afterVersion"&&r!=="afterPrecision"||_.type==="preprocessor"&&/^#version/.test(_.data)&&(p=Math.max(p,A)),r==="afterPrecision"&&_.type==="keyword"&&_.data==="precision"){const w=i(l,A);if(w===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,w)}c<p&&h===0&&(c=A)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function V$t(t,e,r,i="lowp"){aFe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function z$t(t,e,r,i,s="lowp"){aFe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function G$t(t,e){let r,i,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),s}function A_e(t,e){const r=j$t();if(E(r))return r;const i=F$t(t);if(B$t(i,"100","300 es")==="300 es")return t;let s=null,n=null;const o={},a={};for(let l=0;l<i.length;++l){const c=i[l];switch(c.type){case"keyword":e===Cd.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=e===Cd.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),e===Cd.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=lI(i,o,"fragColor"),V$t(i,s,"vec4")),c.data=s),e===Cd.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=G$t(i,l+1),p=lI(i,o,"fragData");z$t(i,p,"vec4",h,"mediump"),c.data=p}else e===Cd.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=lI(i,o,"gl_FragDepth")),c.data=n);break;case"ident":if(T$t.includes(c.data)){if(e===Cd.VERTEX_SHADER&&U$t(i,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=lI(i,o,c.data)),c.data=a[c.data]}}}for(let l=i.length-1;l>=0;--l){const c=i[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&WH.includes(h[1].trim())){const _=i[l+1];i.splice(l,_&&_.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&WH.includes(p[1].trim())&&(c.data="#if 1");const A=c.data.match(/\#ifndef\s+(.*)/);A&&A[1]&&WH.includes(A[1].trim())&&(c.data="#if 0")}}return H$t(t,k$t(i))}function j$t(t){return null}function H$t(t,e){return e}const q$t=4294967295;let W$t=class{constructor(e,r,i,s,n=new Map){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===sr.WEBGL2&&(r=A_e(r,Cd.VERTEX_SHADER),i=A_e(i,Cd.FRAGMENT_SHADER)),this._vShader=y_e(this._context,Cd.VERTEX_SHADER,r),this._fShader=y_e(this._context,Cd.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(fa.Shader,this),kZ()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),kZ()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===sr.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const p=l.getUniformBlockIndex(a,c);p<q$t&&l.uniformBlockBinding(a,p,h)}}this._glName=a,this._context.instanceCounter.increment(fa.Program,this)}get glName(){return this._glName}get hasGLName(){return E(this._glName)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||N(this.glName)?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(fa.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(fa.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&E(this.glName)&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1iv(e,r){wm(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){wm(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){wm(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){wm(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1fv(e,r){wm(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),s[0]=r,s[1]=i)}setUniform2fv(e,r){wm(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),this._nameToUniform3[e]=[r,i,s]):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(e,r){wm(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(this._getUniformLocation(e),r)}setUniform4f(e,r,i,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),this._nameToUniform4.set(e,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(e,r){wm(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(this._getUniformLocation(e),r)}setUniformMatrix3fv(e,r,i=!1){wm(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,r)}setUniformMatrix4fv(e,r,i=!1){wm(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,r)}stop(){}};function y_e(t,e,r){const i=t.gl,s=i.createShader(e);return i.shaderSource(s,r),i.compileShader(s),kZ()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Cd.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(Y$t(r))),s}function Y$t(t){let e=2;return t.replace(/\n/g,()=>`
`+Q$t(e++)+":")}function Q$t(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function wm(t,e,r){const i=t.get(e);return i?Qee(i,r):(t.set(e,Array.from(r)),!0)}let X$t=class{constructor(e){this._rctx=e,this._store=new ZM}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,s){const n=this._store.get(e,r);if(E(n))return n.ref(),n;const o=new W$t(this._rctx,e,r,i,s);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLObjects:e}}},tD=class{constructor(){this._result=!1}dispose(){this._program=Nt(this._program)}get result(){return E(this._program)&&(this._result=this._test(this._program),this.dispose()),this._result}},Z$t=class extends tD{constructor(e){super(),this._rctx=e,this._dummyProgram=null,this._rctx.type===sr.WEBGL2&&Le("mac")&&Le("chrome")&&(this._program=this._prepareProgram(),this._dummyProgram=this._prepareDummyProgram())}dispose(){var e;super.dispose(),(e=this._dummyProgram)==null||e.dispose(),this._dummyProgram=null}_test(e){const r=this._rctx;r.resetState();const i=new Jn(r,{colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE},{target:nr.TEXTURE_2D,wrapMode:pr.CLAMP_TO_EDGE,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.NEAREST,width:1,height:1}),s=Wi.createIndex(this._rctx,Li.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.useProgram(this._dummyProgram),r.bindBuffer(s,fr.ELEMENT_ARRAY_BUFFER),r.drawElements(Ar.POINTS,1,qt.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(Ar.TRIANGLES,0,258);const n=new Uint8Array(4);return i.readPixels(0,0,1,1,At.RGBA,yr.UNSIGNED_BYTE,n),i.dispose(),s.dispose(),n[0]===255}_prepareProgram(){const r=`
    precision highp float;

    varying float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${I.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`
    precision highp float;

    varying float triangleId;

    void main(void) {
      gl_FragColor = triangleId == ${I.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareDummyProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,r=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,r,new Map([]))}},J$t=class extends tD{constructor(e){super(),this._rctx=e,this._program=__e(this._rctx,!1),this._obfuscated=__e(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Nt(this._obfuscated)}_test(e){if(Le("force-double-precision-obfuscation"))return!0;if(N(this._obfuscated))return!1;const r=this._runProgram(e),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new Jn(r,{colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE},{target:nr.TEXTURE_2D,wrapMode:pr.CLAMP_TO_EDGE,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.NEAREST,width:1,height:1}),s=Wi.createVertex(r,Li.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new uf(r,new Map([["position",0]]),{geometry:[new hl("position",2,qt.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=ct(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=ct(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=new Float32Array(6);CJ(o,l,3);const c=new Float32Array(6);CJ(a,c,3),r.useProgram(e),e.setUniform3f("u_highA",l[0],l[2],l[4]),e.setUniform3f("u_lowA",l[1],l[3],l[5]),e.setUniform3f("u_highB",c[0],c[2],c[4]),e.setUniform3f("u_lowB",c[1],c[3],c[5]),r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.bindVAO(n),r.drawArrays(Ar.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);i.readPixels(0,0,1,1,At.RGBA,yr.UNSIGNED_BYTE,h),n.dispose(!1),s.dispose(),i.dispose();const p=(o[2]-a[2])/25,A=Ene(h);return Math.abs(p-A)}};function __e(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(r,i,new Map([["position",0]]))}var v_e,b_e,JK={},K$t={get exports(){return JK},set exports(t){JK=t}};v_e=K$t,(b_e=function(){var t=function(T){window.console&&window.console.log&&window.console.log(T)},e=function(T){window.console&&window.console.error?window.console.error(T):t(T)},r={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},i=null,s=null;function n(T){if(i==null)for(var C in i={},s={},T)typeof T[C]=="number"&&(i[T[C]]=C,s[C]=T[C])}function o(){if(i==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(T){return o(),i[T]!==void 0}function l(T){o();var C=i[T];return C!==void 0?"gl."+C:"/*UNKNOWN WebGL ENUM*/ 0x"+T.toString(16)}function c(T,C,M,O){var $;if(($=r[T])!==void 0&&($=$[C])!==void 0&&$[M]){if(typeof $[M]=="object"&&$[M].enumBitwiseOr!==void 0){for(var L=$[M].enumBitwiseOr,k=0,F=[],G=0;G<L.length;++G){var z=s[L[G]];O&z&&(k|=z,F.push(l(z)))}return k===O?F.join(" | "):l(O)}return l(O)}return O===null?"null":O===void 0?"undefined":O.toString()}function h(T,C){for(var M="",O=C.length,$=0;$<O;++$)M+=($==0?"":", ")+c(T,O,$,C[$]);return M}function p(T,C,M){T.__defineGetter__(M,function(){return C[M]}),T.__defineSetter__(M,function(O){C[M]=O})}function A(T,C,M,O){O=O||T,n(T),C=C||function(z,Z,J){for(var te="",re=J.length,Ae=0;Ae<re;++Ae)te+=(Ae==0?"":", ")+c(Z,re,Ae,J[Ae]);e("WebGL error "+l(z)+" in "+Z+"("+te+")")};var $={};function L(z,Z){return function(){M&&M(Z,arguments);var J=z[Z].apply(z,arguments),te=O.getError();return te!=0&&($[te]=!0,C(te,Z,arguments)),J}}var k={};for(var F in T)if(typeof T[F]=="function")if(F!="getExtension")k[F]=L(T,F);else{var G=L(T,F);k[F]=function(){return A(G.apply(T,arguments),C,M,O)}}else p(k,T,F);return k.getError=function(){for(var z in $)if($.hasOwnProperty(z)&&$[z])return $[z]=!1,z;return T.NO_ERROR},k}function _(T){var C=T.getParameter(T.MAX_VERTEX_ATTRIBS),M=T.createBuffer();T.bindBuffer(T.ARRAY_BUFFER,M);for(var O=0;O<C;++O)T.disableVertexAttribArray(O),T.vertexAttribPointer(O,4,T.FLOAT,!1,0,0),T.vertexAttrib1f(O,0);T.deleteBuffer(M);var $=T.getParameter(T.MAX_TEXTURE_IMAGE_UNITS);for(O=0;O<$;++O)T.activeTexture(T.TEXTURE0+O),T.bindTexture(T.TEXTURE_CUBE_MAP,null),T.bindTexture(T.TEXTURE_2D,null);for(T.activeTexture(T.TEXTURE0),T.useProgram(null),T.bindBuffer(T.ARRAY_BUFFER,null),T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,null),T.bindFramebuffer(T.FRAMEBUFFER,null),T.bindRenderbuffer(T.RENDERBUFFER,null),T.disable(T.BLEND),T.disable(T.CULL_FACE),T.disable(T.DEPTH_TEST),T.disable(T.DITHER),T.disable(T.SCISSOR_TEST),T.blendColor(0,0,0,0),T.blendEquation(T.FUNC_ADD),T.blendFunc(T.ONE,T.ZERO),T.clearColor(0,0,0,0),T.clearDepth(1),T.clearStencil(-1),T.colorMask(!0,!0,!0,!0),T.cullFace(T.BACK),T.depthFunc(T.LESS),T.depthMask(!0),T.depthRange(0,1),T.frontFace(T.CCW),T.hint(T.GENERATE_MIPMAP_HINT,T.DONT_CARE),T.lineWidth(1),T.pixelStorei(T.PACK_ALIGNMENT,4),T.pixelStorei(T.UNPACK_ALIGNMENT,4),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,!1),T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),T.UNPACK_COLORSPACE_CONVERSION_WEBGL&&T.pixelStorei(T.UNPACK_COLORSPACE_CONVERSION_WEBGL,T.BROWSER_DEFAULT_WEBGL),T.polygonOffset(0,0),T.sampleCoverage(1,!1),T.scissor(0,0,T.canvas.width,T.canvas.height),T.stencilFunc(T.ALWAYS,0,4294967295),T.stencilMask(4294967295),T.stencilOp(T.KEEP,T.KEEP,T.KEEP),T.viewport(0,0,T.canvas.width,T.canvas.height),T.clear(T.COLOR_BUFFER_BIT|T.DEPTH_BUFFER_BIT|T.STENCIL_BUFFER_BIT);T.getError(););}function w(T){var C,M,O=[],$=[],L={},k=1,F=!1,G=[],z=0,Z=0,J=!1,te=0,re={};function Ae(ue){return typeof ue=="function"?ue:function(Re){ue.handleEvent(Re)}}T.getContext=(M=T.getContext,function(){var ue=M.apply(T,arguments);if(ue instanceof WebGLRenderingContext){if(ue!=C){if(C)throw"got different context";L=fe(C=ue)}return L}return ue});var ve=function(ue){O.push(Ae(ue))},ye=function(ue){$.push(Ae(ue))};function le(ue){var Re=ue.addEventListener;ue.addEventListener=function(De,Ue,Je){switch(De){case"webglcontextlost":ve(Ue);break;case"webglcontextrestored":ye(Ue);break;default:Re.apply(ue,arguments)}}}function W(){for(var ue=Object.keys(re),Re=0;Re<ue.length;++Re)delete re[ue]}function q(){++Z,F||z==Z&&T.loseContext()}function X(ue,Re){var De=ue[Re];return function(){if(q(),!F)return De.apply(ue,arguments)}}function se(){for(var ue=0;ue<G.length;++ue){var Re=G[ue];Re instanceof WebGLBuffer?C.deleteBuffer(Re):Re instanceof WebGLFramebuffer?C.deleteFramebuffer(Re):Re instanceof WebGLProgram?C.deleteProgram(Re):Re instanceof WebGLRenderbuffer?C.deleteRenderbuffer(Re):Re instanceof WebGLShader?C.deleteShader(Re):Re instanceof WebGLTexture&&C.deleteTexture(Re)}}function ae(ue){return{statusMessage:ue,preventDefault:function(){J=!0}}}return le(T),T.loseContext=function(){if(!F){for(F=!0,z=0,++k;C.getError(););W(),re[C.CONTEXT_LOST_WEBGL]=!0;var ue=ae("context lost"),Re=O.slice();setTimeout(function(){for(var De=0;De<Re.length;++De)Re[De](ue);te>=0&&setTimeout(function(){T.restoreContext()},te)},0)}},T.restoreContext=function(){F&&$.length&&setTimeout(function(){if(!J)throw"can not restore. webglcontestlost listener did not call event.preventDefault";se(),_(C),F=!1,Z=0,J=!1;for(var ue=$.slice(),Re=ae("context restored"),De=0;De<ue.length;++De)ue[De](Re)},0)},T.loseContextInNCalls=function(ue){if(F)throw"You can not ask a lost contet to be lost";z=Z+ue},T.getNumCalls=function(){return Z},T.setRestoreTimeout=function(ue){te=ue},T;function fe(ue){for(var Re in ue)typeof ue[Re]=="function"?L[Re]=X(ue,Re):p(L,ue,Re);L.getError=function(){if(q(),!F)for(;Ye=C.getError();)re[Ye]=!0;for(var Ye in re)if(re[Ye])return delete re[Ye],Ye;return L.NO_ERROR};for(var De=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],Ue=0;Ue<De.length;++Ue){var Je=De[Ue];L[Je]=function(Ye){return function(){if(q(),F)return null;var ut=Ye.apply(ue,arguments);return ut.__webglDebugContextLostId__=k,G.push(ut),ut}}(ue[Je])}var vt=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(Ue=0;Ue<vt.length;++Ue)Je=vt[Ue],L[Je]=function(Ye){return function(){return q(),F?null:Ye.apply(ue,arguments)}}(L[Je]);var lt=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(Ue=0;Ue<lt.length;++Ue)Je=lt[Ue],L[Je]=function(Ye){return function(){return q(),!F&&Ye.apply(ue,arguments)}}(L[Je]);return L.checkFramebufferStatus=function(Ye){return function(){return q(),F?L.FRAMEBUFFER_UNSUPPORTED:Ye.apply(ue,arguments)}}(L.checkFramebufferStatus),L.getAttribLocation=function(Ye){return function(){return q(),F?-1:Ye.apply(ue,arguments)}}(L.getAttribLocation),L.getVertexAttribOffset=function(Ye){return function(){return q(),F?0:Ye.apply(ue,arguments)}}(L.getVertexAttribOffset),L.isContextLost=function(){return F},L}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:A,makeLostContextSimulatingCanvas:w,resetToInitialState:_}}())!==void 0&&(v_e.exports=b_e);let e4t=class extends tD{constructor(e){var s,n,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===sr.WEBGL1)return void(this._result=!(!((s=e.capabilities.textureFloat)!=null&&s.textureFloat)||!((n=e.capabilities.colorBufferFloat)!=null&&n.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new Jn(r,{colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE},{target:nr.TEXTURE_2D,wrapMode:pr.CLAMP_TO_EDGE,pixelFormat:At.RGBA,dataType:yr.FLOAT,internalFormat:cr.RGBA32F,samplingMode:Bt.NEAREST,width:1,height:1}),s=Wi.createVertex(r,Li.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new uf(r,new Map([["a_pos",0]]),{geometry:[new hl("a_pos",2,qt.UNSIGNED_SHORT,0,4)]},{geometry:s});r.useProgram(e);const o=r.getBoundFramebufferObject(),{x:a,y:l,width:c,height:h}=r.getViewport();r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.bindVAO(n),r.drawArrays(Ar.TRIANGLE_STRIP,0,4);const p=Rr({blending:B$e});r.setPipelineState(p),r.drawArrays(Ar.TRIANGLE_STRIP,0,4),JK.init(r);const A=r.gl.getError();return r.setViewport(a,l,c,h),r.bindFramebuffer(o),n.dispose(!1),s.dispose(),i.dispose(),A!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},t4t=class extends tD{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new Jn(r,{colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE},{target:nr.TEXTURE_2D,wrapMode:pr.CLAMP_TO_EDGE,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.NEAREST,width:1,height:1}),s=new Uint8Array(4),n=Wi.createVertex(r,Li.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new uf(r,new Map([["a_position",0]]),{geometry:[new hl("a_position",2,qt.SHORT,0,4)]},{geometry:n});r.useProgram(e);const a=new Wt(r,{target:nr.TEXTURE_2D,wrapMode:pr.CLAMP_TO_EDGE,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(a,0);const l=r.getBoundFramebufferObject();r.bindFramebuffer(i),r.useProgram(e);const{x:c,y:h,width:p,height:A}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(Ar.TRIANGLE_STRIP,0,4),r.setViewport(c,h,p,A),i.readPixels(0,0,1,1,At.RGBA,yr.UNSIGNED_BYTE,s),o.dispose(!1),n.dispose(),i.dispose();const _=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return _&&we.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),r.bindFramebuffer(l),_}};new hl("a_pos",2,qt.BYTE,0,2);new hl("a_pos",2,qt.BYTE,0,4),new hl("a_tex",2,qt.BYTE,2,4);const r4t={geometry:[new hl("a_pos",2,qt.UNSIGNED_SHORT,0,4)]};let i4t=class extends tD{constructor(e){super(),this._rctx=e,this._image=new Image,this._image.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",this._image.width=5,this._image.height=5,this._image.decode();const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;
    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose(),this._image.src=""}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new Jn(r,{colorTarget:En.TEXTURE,depthStencilTarget:$i.NONE},{target:nr.TEXTURE_2D,wrapMode:pr.CLAMP_TO_EDGE,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,samplingMode:Bt.NEAREST,width:1,height:1}),s=Wi.createVertex(r,Li.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new uf(r,new Map([["a_pos",0]]),r4t,{geometry:s}),o=new Wt(r,{dataType:yr.UNSIGNED_BYTE,pixelFormat:At.RGBA,preMultiplyAlpha:!1,wrapMode:pr.CLAMP_TO_EDGE,samplingMode:Bt.LINEAR},this._image);r.useProgram(e),r.bindTexture(o,0),e.setUniform1i("u_texture",0);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=r.getViewport();r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(qs.COLOR_BUFFER_BIT),r.bindVAO(n),r.drawArrays(Ar.TRIANGLE_STRIP,0,4);const A=new Uint8Array(4);return i.readPixels(0,0,1,1,At.RGBA,yr.UNSIGNED_BYTE,A),n.dispose(!1),s.dispose(),i.dispose(),o.dispose(),r.setViewport(l,c,h,p),r.bindFramebuffer(a),A[0]!==255}},s4t=class{constructor(e){this.rctx=e,this.floatBufferBlend=new e4t(e),this.svgPremultipliesAlpha=new i4t(e),this.doublePrecisionRequiresObfuscation=new J$t(e),this.ignoresSamplerPrecision=new t4t(e),this.drawArraysRequiresIndicesTypeReset=new Z$t(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function n4t(t,e){if(e.disjointTimerQuery)return null;if(Kg(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const r=t.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function o4t(t){if(Kg(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function a4t(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function l4t(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function c4t(t,e){if(Kg(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const r=t.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function u4t(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function h4t(t,e){if(Kg(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const r=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function d4t(t,e){if(Kg(t)){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),i=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function OO(t,e,r,i,s){if(i&&Kg(t))return!0;if(e[r])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function p4t(t,e){if(!Kg(t)||e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function f4t(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function m4t(t,e){if(Kg(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const r=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}let g4t=class{constructor(e,r){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=n4t(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=o4t(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=m4t(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=a4t(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=l4t(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=u4t(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=A$t(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=h4t(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=d4t(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=c4t(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=OO(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=OO(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=OO(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=OO(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=f4t(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=p4t(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=OO(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},A4t=class{constructor(e,r){this.gl=e,this.instanceCounter=new x$t,this.programCache=new X$t(this),this._state=new a_e,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=Kg(e)?sr.WEBGL2:sr.WEBGL1,this._loadExtensions(),this.configure(r)}get gl2(){return this.type===sr.WEBGL1?null:this.gl}configure(e){this._capabilities=new g4t(this.gl,e),this._parameters=this._loadParameters(e);const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new a_e,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new Dut({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const s=i.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const s=i.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=i.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),Nt(this._driverTest),this._driverTest=new s4t(this)}dispose(){Nt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(fr.ARRAY_BUFFER),this.unbindBuffer(fr.ELEMENT_ARRAY_BUFFER),this.type===sr.WEBGL2&&(this.unbindBuffer(fr.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(fr.PIXEL_PACK_BUFFER),this.unbindBuffer(fr.PIXEL_UNPACK_BUFFER),this.unbindBuffer(fr.COPY_READ_BUFFER),this.unbindBuffer(fr.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,vd()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,s){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,r,i,s),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,r,i,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,s){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===s||(this.gl.colorMask(e,r,i,s),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,s){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===s||(this.gl.clearColor(e,r,i,s),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===s||(this.gl.scissor(e,r,i,s),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=T0.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,r,i,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===T0.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=T0.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,r,i,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(PG+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&qs.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&qs.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&qs.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}drawArrays(e,r,i){if(vd()&&(this._numOfDrawCalls++,this._numOfTriangles+=w_e(e,i)),this.gl.drawArrays(e,r,i),vd()){const s=tfe(this);s&&console.error("drawArrays:",s)}}drawElements(e,r,i,s){if(vd()&&(this._numOfDrawCalls++,this._numOfTriangles+=w_e(e,r)),this.gl.drawElements(e,r,i,s),vd()){const n=tfe(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:r,type:i,offset:s},p=ka(a,w=>w.size)??0,A=s+r,_=p<A?`. Buffer is too small. Attempted to draw index ${A} of ${p}`:"";console.error(`drawElements: ${n}${_}`,{args:h,vao:c})}}}logInfo(){vd()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){vd()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,s){i=Math.max(Math.round(i),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===r&&n.width===i&&n.height===s||(n.x=e,n.y=r,n.width=i,n.height=s,this.gl.viewport(e,r,i,s))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var r;this._state.program!==e&&((r=this._state.program)==null||r.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[r];return N(e)||e.glName==null?(E(s)&&(this.setActiveTexture(r,i),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[r]=null,s):i||s!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,s):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),s)}unbindTexture(e){if(!N(e))for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(N(e))return this.gl.bindFramebuffer(Ra.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(Ra.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const s=r===Ra.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==e)&&(N(e)?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),s?this._state.readFramebuffer=gr(e,null):this._state.drawFramebuffer=gr(e,null))}blitFramebuffer(e,r,i=0,s=0,n=e.width,o=e.height,a=0,l=0,c=r.width,h=r.height,p=qs.COLOR_BUFFER_BIT,A=Bt.NEAREST){this.bindFramebufferSeparate(e,Ra.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,Ra.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,s,n,o,a,l,c,h,p,A)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case fr.ARRAY_BUFFER:this._state.vertexBuffer=th(this.gl,e,r,this._state.vertexBuffer);break;case fr.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=th(this.gl,e,r,this._state.indexBuffer);break;case fr.UNIFORM_BUFFER:this._state.uniformBuffer=th(this.gl,e,r,this._state.uniformBuffer);break;case fr.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=th(this.gl,e,r,this._state.pixelPackBuffer);break;case fr.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=th(this.gl,e,r,this._state.pixelUnpackBuffer);break;case fr.COPY_READ_BUFFER:this._state.copyReadBuffer=th(this.gl,e,r,this._state.copyReadBuffer);break;case fr.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=th(this.gl,e,r,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let s=i[r];return N(s)&&(s={buffer:null,offset:0,size:0},i[r]=s),s}bindBufferBase(e,r,i){const s=this._getBufferBinding(e,r);N(s)||s.buffer===i&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),s.buffer=i,s.offset=0,s.size=0)}bindBufferRange(e,r,i,s,n){const o=this._getBufferBinding(e,r);if(!N(o)&&!(o.buffer===i&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,r,i.glName,s,n),o.buffer=i,o.offset=s,o.size=n}}bindUBO(e,r,i,s){N(r)?this.bindBufferBase(fr.UNIFORM_BUFFER,e,null):(vd()&&(s??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&s!==void 0?this.bindBufferRange(fr.UNIFORM_BUFFER,e,r.buffer,i,s):this.bindBufferBase(fr.UNIFORM_BUFFER,e,r.buffer))}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const s=this._state.uniformBufferBindingPoints[r];E(s)&&s.buffer===e.buffer&&this.bindBufferBase(fr.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case fr.ARRAY_BUFFER:this._state.vertexBuffer=th(this.gl,null,e,this._state.vertexBuffer);break;case fr.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=th(this.gl,null,e,this._state.indexBuffer);break;case fr.UNIFORM_BUFFER:this._state.uniformBuffer=th(this.gl,null,e,this._state.uniformBuffer);break;case fr.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=th(this.gl,null,e,this._state.pixelPackBuffer);break;case fr.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=th(this.gl,null,e,this._state.pixelUnpackBuffer);break;case fr.COPY_READ_BUFFER:this._state.copyReadBuffer=th(this.gl,null,e,this._state.copyReadBuffer);break;case fr.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=th(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){N(e)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e)}async clientWaitAsync(e=10){const r=this.gl,i=r.fenceSync(FZ.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(fa.Sync,i),r.flush();do await Ix(e),s=r.clientWaitSync(i,0,0);while(s===p9.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(fa.Sync,i),r.deleteSync(i),s===p9.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Ra.FRAMEBUFFER){return e===Ra.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(fr.ARRAY_BUFFER),this.unbindBuffer(fr.ELEMENT_ARRAY_BUFFER),this.type===sr.WEBGL2&&(this.unbindBuffer(fr.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(fr.PIXEL_PACK_BUFFER),this.unbindBuffer(fr.PIXEL_UNPACK_BUFFER),this.unbindBuffer(fr.COPY_READ_BUFFER),this.unbindBuffer(fr.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(tt.ONE,tt.ZERO),this.setBlendEquation(kg.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(T0.BACK),this.setFrontFace(sM.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Bs.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Bs.ALWAYS,0,0),this.setStencilOp(Zn.KEEP,Zn.KEEP,Zn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var n,o,a;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:r,gl2:i}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)r.disableVertexAttribArray(l);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(fr.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(fr.ELEMENT_ARRAY_BUFFER,null),E(i)){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(fr.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(E(c)){const{buffer:h,offset:p,size:A}=c;h!==null?p===0&&A===0?i.bindBufferBase(fr.UNIFORM_BUFFER,l,h.glName):i.bindBufferRange(fr.UNIFORM_BUFFER,l,h.glName,p,A):i.bindBufferBase(fr.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(fr.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(fr.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(fr.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(fr.COPY_WRITE_BUFFER,null),i.bindFramebuffer(Ra.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(Ra.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(gd.COLOR_ATTACHMENT0)),i.bindFramebuffer(Ra.DRAW_FRAMEBUFFER,((n=this._state.drawFramebuffer)==null?void 0:n.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(Ra.FRAMEBUFFER,((o=this._state.drawFramebuffer)==null?void 0:o.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}r.useProgram(((a=this._state.program)==null?void 0:a.glName)??null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){r.activeTexture(PG+l),r.bindTexture(nr.TEXTURE_2D,null),r.bindTexture(nr.TEXTURE_CUBE_MAP,null),this.type===sr.WEBGL2&&(r.bindTexture(nr.TEXTURE_3D,null),r.bindTexture(nr.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];E(c)&&r.bindTexture(c.descriptor.target,c.glName)}r.activeTexture(PG+this._state.activeTexture);const s=this._state.viewport;r.viewport(s.x,s.y,s.width,s.height),this.resetInfo()}_loadExtensions(){this.type===sr.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(e){const r=this.capabilities.textureFilterAnisotropic,i=e.maxAnisotropy??1/0,s=this.type===sr.WEBGL2,n=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:r?Math.min(this.gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY),i):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:s?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:s?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:s?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:s?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:s?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:s?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:s?n.getParameter(n.MAX_SAMPLES):1};return Wt.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}};function th(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function w_e(t,e){switch(t){case Ar.POINTS:return 2*e;case Ar.TRIANGLES:return e/3;case Ar.TRIANGLE_STRIP:case Ar.TRIANGLE_FAN:return e-2;default:return 0}}let y4t=class extends A4t{constructor(e,r,i){super(e,r),this.newCache=i,this._refCount=1}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}bindTechnique(e,r,i,s){return this.useProgram(e.program),e.bindPipelineState(this,i==null?void 0:i.slot,!!s),e.program.bindPass(r,i),e.program}get test(){return this.programCache.test}},WE=class extends Ke{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Nn,this._frameTask=e.view.resourceController.scheduler.registerTask(ir.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Xn.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return N(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(eoe,new toe)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),gr(r.loadingPromise,r)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(this._rctx,this.textureTechnique,r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",Wn.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(N(r))return Zt(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),s=new _4t(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&r.unload()})});return this._textures.set(e,s),s.ref(),E(r.glTexture)?(this._updateGLTexture(s,r.glTexture),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=r.load(this._rctx,()=>this.textureTechnique),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,vo(l)||we.getLogger(this.declaredClass).error(l),null);return Zd(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",Wn.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],WE.prototype,"_loadingCount",void 0),u([d()],WE.prototype,"_frameTask",void 0),u([d()],WE.prototype,"updating",null),WE=u([j("esri.views.3d.webgl-engine.lib.TextureRepository")],WE);let _4t=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(we.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}},cI=class extends Ke{constructor(){super(...arguments),this._passParameters=new v4t,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=Nt(this._passParameters.waveNormal),this._passParameters.wavePertubation=Nt(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return vy.LOADING;if(E(this._passParameters.waveNormal)&&E(this._passParameters.wavePertubation))return vy.LOADED;const r={target:nr.TEXTURE_2D,pixelFormat:At.RGBA,dataType:yr.UNSIGNED_BYTE,wrapMode:pr.REPEAT,samplingMode:Bt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};return++this._loading,jy(Zi("esri/images/materials/water/normals.jpg")).then(i=>this._passParameters.waveNormal=new Wt(e,{...r,width:i.width,height:i.height},i)).catch(i=>we.getLogger(this.declaredClass).error("Failed to load water material normal texture.",i)).finally(()=>--this._loading),++this._loading,jy(Zi("esri/images/materials/water/perturbation.jpg")).then(i=>this._passParameters.wavePertubation=new Wt(e,{...r,width:i.width,height:i.height},i)).catch(i=>we.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",i)).finally(()=>--this._loading),vy.LOADING}};u([d()],cI.prototype,"_loading",void 0),u([d({type:Boolean,readOnly:!0})],cI.prototype,"updating",null),cI=u([j("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],cI);let v4t=class extends ys{};const x_e=2048,b4t=1.5,w4t=8;function x4t(t,e){const{format:r,quality:i,rotation:s,disableDecorations:n}=t||{},o=Noe(t,e.padding),a=O4t(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=R4t(t,a),h=$4t(r),p=k4t[h];return{format:h,quality:ze(i??p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function T4t(t,e){const r=x4t(t,e),i=r.area,s=r.width/i.width,n=Noe(r,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),A=t&&t.layers?t.layers:[],_=r.ignoreBackground,w=r.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:A,disableDecorations:r.disableDecorations,ignoreBackground:_,ignorePadding:w,objectAndLayerIdColor:!1}}function YH(t,e,r){const{ctx:i,canvas:s}=lFe(t,r),n=i.getImageData(0,0,t.width,t.height),o=E4t(s,e);return cFe(s),{dataUrl:o,data:n}}function QH(t,e){const{ctx:r,canvas:i}=lFe(t,e),s=r.getImageData(0,0,t.width,t.height);return cFe(i),s}function lFe(t,e){const r=S4t();e.premultipliedAlpha&&D4t(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&L4t(i),{ctx:i,canvas:r}}function cFe(t){t.width=0,t.height=0}function S4t(){return N(XH)&&(XH=document.createElement("canvas")),XH}let XH=null;function E4t(t,e){const r=N4t[e.format],i=e.quality/100;return t.toDataURL(r,i)}function C4t(t,e,r,i=0,s=0,n=t.width-i,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:h,data:p}=e,A=n/c,_=o/h,w=Math.ceil(A/2),T=Math.ceil(_/2),C=t.width;for(let M=0;M<h;M++)for(let O=0;O<c;O++){const $=4*(O+(a?h-M-1:M)*c);let L=0,k=0,F=0,G=0,z=0,Z=0;const J=(M+.5)*_;for(let te=Math.floor(M*_);te<(M+1)*_;te++){const re=Math.abs(J-(te+.5))/T,Ae=(O+.5)*A,ve=re*re;for(let ye=Math.floor(O*A);ye<(O+1)*A;ye++){const le=Math.abs(Ae-(ye+.5))/w,W=Math.sqrt(ve+le*le);if(W>=1)continue;let q=2*W*W*W-3*W*W+1;const X=4*(i+ye+(s+te)*C);Z+=q*l[X+3],k+=q,!r&&l[X+3]<255&&(q=q*l[X+3]/255),F+=q*l[X],G+=q*l[X+1],z+=q*l[X+2],L+=q}}p[$]=F/L,p[$+1]=G/L,p[$+2]=z/L,p[$+3]=Z/k}return e}function M4t(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=t,a=Noe(t,r),l=a.left+a.right,c=a.top+a.bottom,h=i-l,p=s-c,A=Math.min(w4t,Math.min((x_e-l)/h,(x_e-c)/p));return A<b4t?t:{...t,framebufferWidth:Math.round(h*A)+l,framebufferHeight:Math.round(p*A)+c,pixelRatio:n*A,resample:{region:{x:Math.round((o.x-a.left)*A)+a.left,y:Math.round((o.y-a.top)*A)+a.top,width:Math.round(o.width*A),height:Math.round(o.height*A)},width:i,height:s}}}function R4t(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const s=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function O4t(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return P4t(I4t(r,t),e)}function P4t(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),s={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function I4t(t,e){if(!e||e.width==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const n=Math.floor(t.height*r);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/r);return t.y-=(s-t.height)/2,t.height=s,t}function Noe(t,e){return!e||t&&t.ignorePadding?B4t:e}function $4t(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return F4t}}function L4t(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function D4t(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const s=e[i+3];if(s!==255&&s>0){const n=255/s;e[i+0]=e[i+0]*n,e[i+1]=e[i+1]*n,e[i+2]=e[i+2]*n}}}const N4t={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},T_e=98,F4t="png",k4t={png:100,jpg:T_e,jpeg:T_e},B4t={top:0,right:0,bottom:0,left:0};let U4t=class{constructor(e,r){this.viewCamera=e,this.frameHasDecorations=r}},V4t=class{constructor(e,r,i,s){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Wn.BACKGROUND);const r=Xv();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const s={...i.settings,pixelRatio:i.settings.pixelRatio*e.viewCamera.pixelRatio},n=this._renderScreenshot(e,s,r);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const s=e.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderFunctions.renderOverlay(e,r),s.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=Zj(i,s,a);this._rctx.gl.readPixels(0,0,i,s,At.RGBA,qt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=Zj(n.width,n.height,a);return C4t(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=Zj(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,At.RGBA,qt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,r,i){let s=null,n=null;const o=e.viewCamera,{framebufferWidth:a,framebufferHeight:l}=r;let c=!1;const h=r.disableDecorations&&e.frameHasDecorations,p=a!==o.fullWidth||l!==o.fullHeight,A=r.ignorePadding&&o.pixelRatio!==r.pixelRatio,_=p||h||A||r.objectAndLayerIdColor;if(r.objectAndLayerIdColor&&(n=new Jn(this._rctx,{width:a,height:l,colorTarget:En.TEXTURE,depthStencilTarget:$i.DEPTH_STENCIL_RENDER_BUFFER})),_){const M=o.clone();if(r.ignorePadding){const L=_L(M.padding);for(let k=0;k<4;k++)L[k]=Math.round(L[k]/M.pixelRatio*r.pixelRatio);M.padding=L}M.fullWidth=a,M.fullHeight=l,M.pixelRatio=r.pixelRatio;const O=o.fovX-M.fovX,$=o.fovY-M.fovY;O<0&&O<$?M.fovX=o.fovX:$<0&&$<O&&(M.fovY=o.fovY),this._forceCameraHook(M),c=!0,s=new Jn(this._rctx,{width:M.fullWidth,height:M.fullHeight,colorTarget:En.TEXTURE,depthStencilTarget:$i.DEPTH_STENCIL_RENDER_BUFFER}),this._renderFunctions.renderScene(s,n,M,r.disableDecorations?tT.OFF:tT.ON,i),this._disposeOffscreenBuffers()}const w=()=>{this._rctx.bindFramebuffer(null),Nt(s)},T=this._readbackScreenshot(r,w);w();let C=null;if(r.objectAndLayerIdColor){const M=()=>{this._rctx.bindFramebuffer(null),Nt(n)};this._rctx.bindFramebuffer(n),C=this._readbackScreenshot(r,M),this._rctx.bindFramebuffer(null),M()}if(_&&!this._rctx.contextAttributes.alpha)for(let M=3;M<T.data.length;M+=4)T.data[M]=255;if(C&&!this._rctx.contextAttributes.alpha)for(let M=3;M<C.data.length;M+=4)C.data[M]=255;return c&&this._forceCameraHook(o),[T,C]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},Ka=class extends Ke{constructor(e){super({}),this.events=new Nn,this.waterTextureRepository=new cI,this._magnifierHelper=new qE,this.objectAndLayerIdRenderHelper=Le("enable-feature:objectAndLayerId-rendering")?new DPt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),xe(()=>{var i;return(i=this.waterTextureRepository)==null?void 0:i.updating},()=>this.requestRender(),Cr),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new G4e(this._rctx),this._shaderTechniqueRepository=new F4e({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new WE(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",i=>this.requestRender(i)),this._materialRepository=new k4e(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new pPt(this._rctx,this._shaderTechniqueRepository),this.renderer=new dd(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,i=>this.requestRender(i));const r={renderScene:(i,s,n,o,a)=>this.renderer.render(i,s,{camera:n,contentCamera:n,mode:Ei.IDLE},o,a),requestRenderScene:i=>this.requestRender(i),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(i,s)=>e.options.screenshot.renderOverlay(i,s)};this._screenshotManager=new V4t(this._rctx,r,i=>this.events.emit("force-camera-for-screenshot",i),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=sn(this._frameTask),this._shaderTechniqueRepository=gt(this._shaderTechniqueRepository)}get performanceInfo(){const e=this._rctx.gl;return{renderer:this.renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=Wn.UPDATE){this._needsRender=!0,e===Wn.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,s,n,o=n){const a=s.constrainWindowSize(r,i,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(s,a,l);let c=Number.MAX_VALUE;for(let h=0;h<a[2]*a[3];h++){const p=yPt(4*h,l,s.nearFar);c>p&&p!==s.nearFar[0]&&p!==s.nearFar[1]&&(c=p)}if(E(e)){const h=e.pickDepth(r*s.pixelRatio,i*s.pixelRatio,s);E(h)&&c>h&&h!==s.nearFar[0]&&h!==s.nearFar[1]&&(c=h)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(N(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){d5e(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,s=Wn.BACKGROUND,n=!1;const o={preRender:({time:a})=>{i=this.updating,s=this._needsUpdate?Wn.UPDATE:Wn.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||E(r.forcedAnimationTime)||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,h=new A$e(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(h)&&this.requestRender(Wn.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,r,tT.ON,a),n=!0,l&&this.renderer.hasWaterReflection&&(this.requestRender(Wn.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new U4t(r.camera,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{n&&(this.renderer.finish(r.mode===Ei.IDLE?s:Wn.UPDATE),n=!1)}};this._frameTask=C3(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil==null||r.stencil,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},s=kut("3d",this._canvas,i);if(N(s)){const n=Le("esri-force-webgl");we.getLogger(this.declaredClass).error(n)}else this._rctx=this._newRenderingContext(s,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&we.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&Le("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},s=(n,o)=>r.view.resourceController.memoryController.newCache(n,o);return new y4t(e,i,s)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return E(this.objectAndLayerIdRenderHelper)?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return N(this._componentObjectCollection)&&(this._componentObjectCollection=new iPt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],Ka.prototype,"updating",null),u([d({autoDestroy:!0})],Ka.prototype,"_rctx",void 0),u([d({autoDestroy:!0})],Ka.prototype,"_container",void 0),u([d({autoDestroy:!0})],Ka.prototype,"_canvas",void 0),u([d({autoDestroy:!0})],Ka.prototype,"_stippleTextureRepository",void 0),u([d({autoDestroy:!0})],Ka.prototype,"waterTextureRepository",void 0),u([d({autoDestroy:!0})],Ka.prototype,"_magnifierHelper",void 0),u([d({readOnly:!0})],Ka.prototype,"objectAndLayerIdRenderHelper",void 0),u([d({autoDestroy:!0})],Ka.prototype,"_textureRepository",void 0),u([d({autoDestroy:!0})],Ka.prototype,"_compositingHelper",void 0),u([d({autoDestroy:!0,readOnly:!0})],Ka.prototype,"renderer",void 0),u([d({autoDestroy:!0})],Ka.prototype,"_screenshotManager",void 0),u([d()],Ka.prototype,"componentObjectCollection",null),u([d({autoDestroy:!0})],Ka.prototype,"_componentObjectCollection",void 0),u([d()],Ka.prototype,"_needsUpdate",void 0),u([d()],Ka.prototype,"_needsWaterReflectionUpdate",void 0),Ka=u([j("esri.views.3d.webgl-engine.parts.RenderView")],Ka);let hh=class extends Ke{constructor(e){super(e),this._handles=new ts,this._model=new x8,this._layers=new Vr,this._asyncChangeSet=new aK,this._syncChangeSet=new aK,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Ka(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(ir.STAGE,this),this._handles.add(this._frameTask)}destroy(){this._handles.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),q9(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){N(e)||(this.renderView.requestRender(),this._model.remove(e),q9(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){E(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){E(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e,r){N(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(i=>N(i.glTexture)).map(i=>this.schedule(()=>this._model.has(i)?i.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null),r)))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const s=this._layerSyncSet.has(i.id)||i.updatePolicy===jv.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,n),this._layerSyncSet.delete(i.id),n.empty||(this.renderer.modify(n,s?jc:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,jc),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==jv.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{(this._layerSyncSet.has(r.id)||r.updatePolicy===jv.SYNC)&&(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id))});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,jc),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,jc),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,jc))}addRenderPlugin(e,r,i){const s=this.renderer.renderPlugins.add(e,r,i),n=()=>{hAe(r)&&this.view.sceneIntersectionHelper.addIntersectionHandler(r)};if(Zd(s))return s.then(n);n()}removeRenderPlugin(e){hAe(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};hh.DebugSettings={endFrameContentValidation:!1},u([d({constructOnly:!0})],hh.prototype,"view",void 0),u([d({constructOnly:!0})],hh.prototype,"options",void 0),u([d({readOnly:!0})],hh.prototype,"viewingMode",null),u([d({constructOnly:!0})],hh.prototype,"container",void 0),u([d({constructOnly:!0})],hh.prototype,"_handles",void 0),u([d({readOnly:!0})],hh.prototype,"updating",null),u([d({constructOnly:!0})],hh.prototype,"_model",void 0),u([d({autoDestroy:!0})],hh.prototype,"renderView",void 0),u([d({readOnly:!0})],hh.prototype,"renderer",null),u([d({readOnly:!0})],hh.prototype,"running",null),hh=u([j("esri.views.3d.webgl-engine.Stage")],hh);let UQt=class extends u7{constructor(e,r,i,s){super(r,i),this.point=e,this.createGraphic=s}};function uFe(t){return J0(t)&&t.intersector===pn.PCL&&!!t.target}let zQt=class extends BPe{constructor(e,r,i,s,n){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=s,this.triangleNr=n}},jQt=class extends u7{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}};function K7(t){return J0(t)&&t.intersector===pn.I3S&&!!t.target}function hFe(t){return J0(t)&&t.intersector===pn.VOXEL&&!!t.target}function S_e(t,e){var r,i;return h7(t)||d7(t)?Y4((r=t.target)==null?void 0:r.object.metadata,e):Bvt(t)?(i=e.map)==null?void 0:i.ground:uFe(t)||K7(t)||nLe(t)||hFe(t)?Y4(t.target,e):null}function qQt(t,e){const r=KK(t,e);return E(r)&&r.type==="graphic"?r.graphic:null}function KK(t,e){var r;if(N(t))return null;if(h7(t)||d7(t))return E_e((r=t.target)==null?void 0:r.object.metadata,e);if(uFe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(hFe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return nLe(t)||loe(t)?E_e(t.target,e):K7(t)?z4t(t.target,e):null}function E_e(t,e){if(N(t)||N(t.graphicUid))return null;const r=Y4(t,e);if(N(r))return null;if(r===e.graphics)return N(e.graphicsView)||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||N(t.graphicUid)?null:"getHit"in i?i.getHit(t.graphicUid):null}function z4t(t,e){const r=Y4(t,e);if(N(r))return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?j4t(i.getGraphicFromIntersectorTarget(t)):null}function G4t(t,e){const r=Y4(t,e);if(N(r))return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function j4t(t){return E(t)?{type:"graphic",graphic:t,layer:t.layer}:null}function Y4(t,e){return!t||N(t.layerUid)?null:E(e.graphicsView)&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid)}function WQt(t,e){if(h7(t)||d7(t))return Ay(t.target.object.boundingVolumeWorldSpace.bounds);if(loe(t)){mTe(yF,t.transformation);const r=Math.max(yF[0],yF[1],yF[2]);return t.target.baseBoundingSphere.radius*r}return K7(t)?ka(G4t(t.target,e),r=>.5*Sxe(r)):null}function YQt(t){return!h7(t)&&!d7(t)&&(loe(t)?t.target.numLodLevels>1:!!K7(t))}const yF=V();async function H4t(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=r.results[0],s=(i.distance??0)*(1+q4t),n=r.results.findIndex(o=>(o.distance??0)>s);return n!==-1&&(r.results=r.results.slice(0,n)),r}const q4t=.05;let ZH,JH;function W4t(t){const e=pOe(t);for(;e.length>1;){const r=C_e(e.shift());if(r.available)return r}return C_e(e.shift())}function C_e(t){switch(t){case sr.WEBGL1:return Y4t();case sr.WEBGL2:return Q4t()}}function Y4t(){return ZH||(ZH=J4t()),ZH}function Q4t(){return JH||(JH=K4t()),JH}let dFe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},X4t=class extends dFe{constructor(){super(...arguments),this.type=sr.WEBGL1}},Z4t=class extends dFe{constructor(){super(...arguments),this.type=sr.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function pFe(t,e){var n;if(t===sr.WEBGL1&&typeof WebGLRenderingContext>"u"||t===sr.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=f9(r,t,{failIfMajorPerformanceCaveat:!0});if(N(i)&&(i=f9(r,t),E(i)&&(e.majorPerformanceCaveat=!0)),N(i))return i;if(t===sr.WEBGL1){const o=(n=i.getParameter(i.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(e.supportsHighPrecisionFragment=s.precision>0),i}function J4t(){const t=new X4t,e=pFe(sr.WEBGL1,t);return N(e)||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function K4t(){const t=new Z4t,e=pFe(sr.WEBGL2,t);return N(e)||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function eLt(t){const e=W4t(t);if(!e.available)return new ce("webgl:required","WebGL is required but not supported.");if(t==="3d"&&e.majorPerformanceCaveat)return new ce("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new ce("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new ce("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===sr.WEBGL1){if(!e.supportsElementIndexUint)return new ce("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new ce("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new ce("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function tLt(t){return t&&"nodeType"in t}function rLt(t){return t&&typeof t.render=="function"}const M_e={component:"esri-component"};let E2=class extends Ke{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(M_e.component),r&&r.classList.remove(M_e.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||tLt(e)?(this._set("widget",null),hU(e)):(rLt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],E2.prototype,"id",null),u([d()],E2.prototype,"node",null),u([Hr("node")],E2.prototype,"castNode",null),u([d({readOnly:!0})],E2.prototype,"widget",void 0),E2=u([j("esri.views.ui.Component")],E2);const M8=E2,iLt={left:0,top:0,bottom:0,right:0},fFe={bottom:30,top:15,right:15,left:15},KH="manual",wA="esri-ui",fu={ui:wA,corner:`${wA}-corner`,innerContainer:`${wA}-inner-container`,manualContainer:`${wA}-manual-container`,cornerContainer:`${wA}-corner-container`,topLeft:`${wA}-top-left`,topRight:`${wA}-top-right`,bottomLeft:`${wA}-bottom-left`,bottomRight:`${wA}-bottom-right`};function sLt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function eq(t){const e=t,r=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(r===null||r===Object.prototype)&&("component"in e||"index"in e||"position"in e)?t:null}function tq(t,{top:e,bottom:r,left:i,right:s}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=s}let Wm=class extends Nn.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._locale=Yc(),this.view=null,this._applyViewPadding=()=>{const r=this.container;r&&tq(r,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const r=this._innerContainer;r&&tq(r,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([xe(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Cr),xe(()=>this.padding,this._applyUIPadding,Cr),xe(()=>[this.container,this._locale],([e,r])=>{e&&e.setAttribute("lang",r)},Cr),Dte(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentToKey.clear()}set container(e){const r=this._get("container");e!==r&&(e&&(e.classList.add(fu.ui),lJe(e),this._attachContainers(e)),r&&(r.classList.remove(fu.ui),tq(r,{top:"",bottom:"",left:"",right:""}),iTe(r)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const r=this._getViewPadding(),i=r.top+r.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...fFe,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const r=this._getViewPadding(),i=r.left+r.right;return Math.max(e-i,0)}add(e,r){let i,s;if(Array.isArray(e))return void e.forEach(o=>this.add(o,r));const n=eq(e);n&&({index:i,position:r,component:e,key:s}=n),r&&typeof r=="object"&&({index:i,key:s,position:r}=r),!e||r&&!this._isValidPosition(r)||this._add(e,r,i,s)}remove(e,r){if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,r));const i=this._find(e);if(i){const s=this._componentToKey;if(s.has(e)&&s.get(e)!==r)return;const n=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(n,1)[0]}}empty(e){return Array.isArray(e)?e.map(r=>this.empty(r)).reduce((r,i)=>r.concat(i)):(e=e||KH)===KH?Array.prototype.slice.call(this._manualContainer.children).filter(r=>!r.classList.contains(fu.corner)).map(r=>this.remove(r)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,r){if(Array.isArray(e)&&e.forEach(o=>this.move(o,r)),!e)return;let i;const s=eq(e)||eq(r);if(s&&(i=s.index,r=s.position,e=s.component||e),r&&!this._isValidPosition(r))return;const n=this.remove(e);n&&this.add(n,{position:r,index:i})}find(e){if(!e)return null;const r=this._findById(e);return r&&(r.widget||r.node)}getPosition(e){for(const r in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[r].contains(e))return r;return null}_add(e,r,i,s){e instanceof M8||(e=new M8({node:e})),this._place({component:e,position:r,index:i}),this._components.push(e),s&&this._componentToKey.set(e,s)}_find(e){return e?e instanceof M8?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||iLt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(fu.innerContainer),e.classList.add(fu.cornerContainer);const r=document.createElement("div");r.classList.add(fu.innerContainer),r.classList.add(fu.manualContainer);const i=document.createElement("div");i.classList.add(fu.topLeft),i.classList.add(fu.corner),e.appendChild(i);const s=document.createElement("div");s.classList.add(fu.topRight),s.classList.add(fu.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(fu.bottomLeft),n.classList.add(fu.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(fu.bottomRight),o.classList.add(fu.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=r;const a=w0();this._cornerNameToContainerLookup={"top-left":i,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:i,"top-trailing":a?i:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:r,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const r=e.component,i=e.position||KH,s=e.index,n=this._positionNameToContainerLookup[i],o=s!=null&&s>-1;if(sLt(r.widget)&&r.widget.startup(),!o)return void n.appendChild(r.node);const a=Array.prototype.slice.call(n.children);if(s===0)return void(n.firstChild?Hce(r.node,n.firstChild):n.appendChild(r.node));s>=a.length?n.appendChild(r.node):Hce(r.node,a[s])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let r,i=null;return this._components.some(s=>(r=s===e,r&&(i=s),r)),i}_findById(e){let r,i=null;return this._components.some(s=>(r=s.id===e,r&&(i=s),r)),i}_findByNode(e){let r,i=null;return this._components.some(s=>(r=s.node===e,r&&(i=s),r)),i}};u([d()],Wm.prototype,"_locale",void 0),u([d()],Wm.prototype,"container",null),u([d()],Wm.prototype,"height",null),u([d({value:fFe})],Wm.prototype,"padding",null),u([Hr("padding")],Wm.prototype,"castPadding",null),u([d()],Wm.prototype,"view",void 0),u([d()],Wm.prototype,"width",null),Wm=u([j("esri.views.ui.UI")],Wm);const nLt=Wm;function R_e(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function oLt(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function _F(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function aLt(t){return t.type==="bing-maps"}const t1=[];let YE=class extends J${constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new or,this.view=null,this._allLayerViewsChange=r=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(s=>xe(()=>{var n;return[s.suspended,(n=s.layer)==null?void 0:n.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),r&&r.removed&&r.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.handles.add([Co(()=>{var r;return(r=this.view)==null?void 0:r.allLayerViews},"change",r=>this._allLayerViewsChange(r),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Nl(()=>{var r;return((r=this.view)==null?void 0:r.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,r=e==null?void 0:e.allLayerViews;t1.length=0,e&&r?(r.forEach(i=>{var o;if(i.suspended||!((o=i.layer)!=null&&o.attributionVisible))return;const s=i.layer;if(R_e(s,"user"))return void _F(t1,i,s.copyright);if(s.hasAttributionData){if(this._fetchedAttributionData.has(i)){const a=this._fetchedAttributionData.get(i);return void(a?_F(t1,i,this._getDynamicAttribution(a,e,s)):R_e(s)&&_F(t1,i,s.copyright))}return void this._fetchAttributionData(i)}const n=s.get("portalItem.accessInformation");_F(t1,i,n||s.copyright)}),oLt(this.items,t1)&&(this.items.removeAll(),this.items.addMany(t1)),t1.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const r=await B0(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=r.ok?this._createContributionIndex(r.value,aLt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,r){const i=e.contributors,s={};if(!i)return s;for(let n=0;n<i.length;n++){const o=i[n],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,h=l.zoomMin-(r&&l.zoomMin?1:0),p=l.zoomMax-(r&&l.zoomMax?1:0),A={xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:xt.WGS84},_={extent:gy(A),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:n};for(let w=h;w<=p;w++)s[w]=s[w]||[],s[w].push(_)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,r,i){var h;const{extent:s,scale:n}=r;let o=((h=i.tileInfo)==null?void 0:h.scaleToZoom(n))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!s||o==null||o<=-1)return"";const a=e[o],l=xb(s.center.clone().normalize(),r.spatialReference),c={};return a?a.filter(p=>{const A=p.id,_=!c[A]&&l&&p.extent&&Lte(p.extent,l);return _&&(c[A]=!0),_}).sort((p,A)=>A.score-p.score||p.objectId-A.objectId).map(p=>p.attribution).join(", "):""}};u([d({readOnly:!0,type:or})],YE.prototype,"items",void 0),u([d({readOnly:!0})],YE.prototype,"state",null),u([d()],YE.prototype,"view",void 0),YE=u([j("esri.widgets.Attribution.AttributionViewModel")],YE);const mFe=YE,YS="esri-attribution",r1={base:`${YS} esri-widget`,poweredBy:`${YS}__powered-by`,sources:`${YS}__sources`,open:`${YS}--open`,sourcesOpen:`${YS}__sources--open`,link:`${YS}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Su=class extends pc{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=r1.widgetIcon,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new mFe}initialize(){this.addHandles(Co(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[r1.open]:this._isOpen};return pe("div",{bind:this,class:this.classes(r1.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return pe("div",{class:r1.poweredBy},"Powered by"," ",pe("a",{class:r1.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?"0":"",{attributionText:s}=this,n={[r1.sourcesOpen]:e,[r1.interactive]:r};return pe("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(r1.sources,n),innerHTML:s,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],Su.prototype,"_isOpen",void 0),u([d()],Su.prototype,"_isInteractive",null),u([d()],Su.prototype,"_attributionTextOverflowed",void 0),u([d()],Su.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Su.prototype,"attributionText",null),u([d()],Su.prototype,"iconClass",void 0),u([d()],Su.prototype,"itemDelimiter",void 0),u([d()],Su.prototype,"label",null),u([d(),Ll("esri/widgets/Attribution/t9n/Attribution")],Su.prototype,"messages",void 0),u([d()],Su.prototype,"view",null),u([d({type:mFe})],Su.prototype,"viewModel",void 0),u([rl()],Su.prototype,"_toggleState",null),Su=u([j("esri.widgets.Attribution")],Su);const lLt=Su,cLt="esri.widgets.CompassViewModel";let C2=class extends sse(Ke){constructor(e){super(e),this._handles=new ts,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(xe(()=>this.view,this._updateRotationWatcher,Cr))}destroy(){sn(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var r;if(!this.get("view.ready"))return;const e={};((r=this.view)==null?void 0:r.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?xe(()=>e==null?void 0:e.rotation,this._updateForRotation,Cr):xe(()=>e==null?void 0:e.camera,this._updateForCamera,Cr))}};u([d({readOnly:!0})],C2.prototype,"canShowNorth",null),u([d()],C2.prototype,"orientation",void 0),u([d({readOnly:!0})],C2.prototype,"state",null),u([d()],C2.prototype,"view",void 0),C2=u([j(cLt)],C2);const gFe=C2,i1={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Ym=class extends pc{constructor(e,r){super(e,r),this.iconClass=i1.widgetIcon,this.messages=null,this.viewModel=new gFe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="disabled",s=(r==="rotation"?"rotation":"compass")=="compass",n=i?-1:0,o={[i1.disabled]:i,[i1.interactive]:!i},a={[i1.northIcon]:s,[i1.rotationIcon]:!s},{messages:l}=this;return pe("div",{bind:this,class:this.classes(i1.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":l.reset,title:l.reset},pe("span",{"aria-hidden":"true",class:this.classes(i1.icon,a),styles:this._toRotationTransform(e)}),pe("span",{class:i1.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([d()],Ym.prototype,"goToOverride",null),u([d()],Ym.prototype,"iconClass",void 0),u([d()],Ym.prototype,"label",null),u([d(),Ll("esri/widgets/Compass/t9n/Compass")],Ym.prototype,"messages",void 0),u([d()],Ym.prototype,"view",null),u([d({type:gFe})],Ym.prototype,"viewModel",void 0),u([rl()],Ym.prototype,"_reset",null),Ym=u([j("esri.widgets.Compass")],Ym);const uLt=Ym,QS="esri-navigation-toggle",dp={base:`${QS} esri-widget`,button:`${QS}__button esri-widget--button`,activeButton:`${QS}__button--active`,panButton:`${QS}__button--pan`,rotateButton:`${QS}__button--rotate`,isLayoutHorizontal:`${QS}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let QE=class extends Ke{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(Nl(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e;return this.get("view.ready")&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],QE.prototype,"state",null),u([d()],QE.prototype,"navigationMode",void 0),u([d()],QE.prototype,"view",void 0),QE=u([j("esri.widgets.NavigationToggleViewModel")],QE);const AFe=QE;let Qm=class extends pc{constructor(e,r){super(e,r),this.iconClass=dp.widgetIcon,this.messages=null,this.viewModel=new AFe}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",r=this.get("viewModel.navigationMode")==="pan",i={[dp.disabled]:e,[dp.isLayoutHorizontal]:this.layout==="horizontal"},s={[dp.activeButton]:r},n={[dp.activeButton]:!r},o=e?-1:0,a=this.messages.toggle;return pe("div",{bind:this,class:this.classes(dp.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},pe("div",{class:this.classes(dp.button,dp.panButton,s)},pe("span",{class:dp.panIcon})),pe("div",{class:this.classes(dp.button,dp.rotateButton,n)},pe("span",{class:dp.rotationIcon})))}_toggle(){this.toggle()}};u([d()],Qm.prototype,"iconClass",void 0),u([d()],Qm.prototype,"label",null),u([d({value:"vertical"})],Qm.prototype,"layout",null),u([d(),Ll("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Qm.prototype,"messages",void 0),u([d()],Qm.prototype,"view",null),u([d({type:AFe})],Qm.prototype,"viewModel",void 0),u([rl()],Qm.prototype,"_toggle",null),Qm=u([j("esri.widgets.NavigationToggle")],Qm);const hLt=Qm,PO={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let D1=class extends pc{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,r={[PO.disabled]:!this.enabled,[PO.interactive]:this.enabled},i={[this.iconClass]:!!this.iconClass};return pe("div",{bind:this,class:this.classes(PO.button,r),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},pe("span",{"aria-hidden":"true",role:"presentation",class:this.classes(PO.icon,i)}),pe("span",{class:PO.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],D1.prototype,"action",void 0),u([d()],D1.prototype,"enabled",void 0),u([d()],D1.prototype,"iconClass",void 0),u([d()],D1.prototype,"title",void 0),u([rl()],D1.prototype,"_triggerAction",null),D1=u([j("esri.widgets.IconButton")],D1);const O_e=D1;let XE=class extends Ke{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMaxScale");return r===0||e>r}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMinScale");return r===0||e<r}};u([d({readOnly:!0})],XE.prototype,"canZoomIn",null),u([d({readOnly:!0})],XE.prototype,"canZoomOut",null),u([d()],XE.prototype,"view",void 0),XE=u([j("esri.widgets.Zoom.ZoomConditions2D")],XE);const dLt=XE;let ZE=class extends Ke{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([d({readOnly:!0})],ZE.prototype,"canZoomIn",null),u([d({readOnly:!0})],ZE.prototype,"canZoomOut",null),u([d()],ZE.prototype,"view",void 0),ZE=u([j("esri.widgets.Zoom.ZoomConditions3D")],ZE);const pLt=ZE;let N1=class extends Ke{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return E(this._zoomConditions)&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return E(this._zoomConditions)&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new dLt({view:e}):e.type==="3d"&&(this._zoomConditions=new pLt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():UC(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():UC(e.goTo({zoomFactor:.5}))}};u([d()],N1.prototype,"_zoomConditions",void 0),u([d()],N1.prototype,"canZoomIn",null),u([d()],N1.prototype,"canZoomOut",null),u([d({readOnly:!0})],N1.prototype,"state",null),u([d()],N1.prototype,"view",null),N1=u([j("esri.widgets.Zoom.ZoomViewModel")],N1);const yFe=N1,IO={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let qA=class extends pc{constructor(e,r){super(e,r),this.iconClass=IO.widgetIcon,this.messages=null,this.viewModel=new yFe}initialize(){this._zoomInButton=new O_e({action:this.zoomIn.bind(this),iconClass:IO.zoomInIcon}),this._zoomOutButton=new O_e({action:this.zoomOut.bind(this),iconClass:IO.zoomOutIcon})}destroy(){this._zoomInButton=gt(this._zoomInButton),this._zoomOutButton=gt(this._zoomOutButton)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,r={[IO.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:s}=e;this._zoomInButton.enabled=i,this._zoomOutButton.enabled=s;const{zoomIn:n,zoomOut:o}=this.messages;return this._zoomInButton.title=n,this._zoomOutButton.title=o,pe("div",{class:this.classes(IO.base,r)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],qA.prototype,"iconClass",void 0),u([d()],qA.prototype,"label",null),u([d({value:"vertical"})],qA.prototype,"layout",null),u([d(),Ll("esri/widgets/Zoom/t9n/Zoom")],qA.prototype,"messages",void 0),u([d()],qA.prototype,"view",null),u([d({type:yFe})],qA.prototype,"viewModel",void 0),qA=u([j("esri.widgets.Zoom")],qA);const fLt=qA;function mLt(t){return t&&t.view!==void 0}let R8=class extends nLt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this.addHandles([xe(()=>this.components,this._componentsWatcher.bind(this),Cr),xe(()=>this.view,this._updateViewAwareWidgets.bind(this),Cr)])}_add(e,r,i,s){let n=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;n=this._createComponent(e)}super._add(n,r,i,s)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(r=>{const i=this._find(r),s=i&&i.widget;mLt(s)&&(s.view=e)})}_componentsWatcher(e,r){this._removeComponents(r),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);if(r)return new M8({id:e,node:r})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new lLt({view:this.view})}_createCompass(){return new uLt({view:this.view})}_createNavigationToggle(){return new hLt({view:this.view})}_createZoom(){return new fLt({view:this.view})}};u([d()],R8.prototype,"components",void 0),R8=u([j("esri.views.ui.DefaultUI")],R8);const gLt=R8;let O8=class extends gLt{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],O8.prototype,"components",void 0),O8=u([j("esri.views.ui.3d.DefaultUI3D")],O8);const _Fe=O8;let Ht=class extends vYe(Olt(qlt(yct))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._lostWebGLContextHandle=null,this._resolveWhenReady=[],this._propertiesPool=new Vy({slicePlane:CSe},this),this._resourceController=tCt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new JJ({view:this}),this.labeler=new _2({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new Y3,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new B2,this.environmentManager=new Wf,this.floors=new or,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new vct({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new bEt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new _Fe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new wK,this.voxelWasm=null,this.voxelWasmPromise=null,aqe(),t&&t.environment||(this._defaults.environment=new $E,this.environment=this._defaults.environment);const e=(r=null)=>{E(r)&&r.type===xs.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.handles.add([Co(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),xe(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new CAt({view:this}),this.stateManager=new Fo({view:this})}initialize(){this.groundView=new Hlt({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.handles.add(Co(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Cr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Cr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>$Be(e>0?1e3/Math.ceil(e):0),Cr),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,ao),this.updatingHandles.add(()=>{var e,r;return(r=(e=this.map)==null?void 0:e.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),ao),this.handles.add(xe(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),os))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=gt(this.sharedSymbolResources),this._set("labeler",gt(this.labeler)),this._set("deconflictor",gt(this.deconflictor)),this._resourceController=gt(this._resourceController),this._set("stateManager",gt(this.stateManager)),this._set("inputManager",gt(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",gt(this.environmentManager)),this.groundView=gt(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!(this._userClippingArea||this.get("map.clippingEnabled"))||N(t)?(this._clippingArea=null,null):t instanceof Ki?this.spatialReference&&(t=vF(t,this.spatialReference),N(t))?(we.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),N(t.intersection(this._groundAndLayersExtent))&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(we.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&E(t)?we.getLogger(this.declaredClass).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===_t.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return N(e)||N(t)||e.spatialReference.equals(t)?e:vF(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||xt.WGS84,r=vF(this.clippingArea,e);E(r)&&(t=E(t)?t.intersection(r):r);const i=this._get("dataExtent");return E(t)&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||xt.WGS84;let e;const r=n=>{const o=vF(n,t);N(o)||(E(e)?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const n=i.groundExtent;r(new Ki({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const n=o=>{!E(o.fullExtent)||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(N(e))return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof $E?t:t instanceof jRe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):$E.fromWebsceneEnvironment(t):Oo($E,t):new $E}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||E(this.activeTool)&&this.activeTool.visible}get stationary(){return!this.animation&&!this.resizing&&(N(this.state)||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){f8.isValidProfile(t)&&(f8.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||f8.getDefaultProfile()}set slicePlane(t){if(E(this._stage)&&this._stage.renderer.setParameters({slicePlane:t}),N(t))return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");ET(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?AYe(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?NM.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var s,n,o;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(e=!0,a.suspended||z4(a))return;++r,t+=a.updatingProgress}}else++r});for(const a of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])E(a)&&a.updating&&(r+=.1,t+=.5*.1);for(const a of[this.deconflictor,this.labeler,this.basemapTerrain])E(a)&&a.updating&&(++r,t+=a.updatingProgress);const i=this.stateManager.test.updatingIgnoreRenderState?Ei.IDLE:this.state.mode;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i!==Ei.IDLE||this._createGraphicsViewController||(s=this.inputManager)!=null&&s.hasPendingInputs||(o=(n=this.map)==null?void 0:n.allLayers)!=null&&o.some(a=>!a.isFulfilled())),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const a=performance.now();if(t<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-l)+t*l}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?a:0}return e}get viewingMode(){var r;const t=this._predeterminedViewingMode;if(E(t))return SG(t);const e=this.spatialReference;return e?E((r=this.defaultsFromMap)==null?void 0:r.viewingMode)&&e.equals(this.defaultsFromMap.spatialReference)?SG(this.defaultsFromMap.viewingMode):L9(e,_t.Global)?"global":"local":"global"}set viewingMode(t){this.ready?we.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new CCt(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return we.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,i=E(r.graphics)&&(E(r.graphics.include)||E(r.graphics.exclude)),s=Lpe(t)?$pe(this,t):t,n=ng(s);r.enableDraped=r.include&&!r.include.has(rv)||r.exclude&&r.exclude.has(rv);const o=this.sceneIntersectionHelper,a=pf(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?dl.ALL:dl.MIN,o.intersectIntersectorScreen(n,a,r),i){for(const l of a.results.all){const c=KK(l,this);if(N(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return we.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=gr(t.z==null?pg(this.elevationProvider,t):null,0);return Fl(t,XS,this.renderSpatialReference,e),this.state.camera.projectToScreen(XS,rq),af(rq[0],rq[1])}pixelSizeAt(t){return this.ready?t?(Fl(t,XS,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(XS)):0:(we.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return we.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=Lpe(t)?$pe(this,t):t,i=Sn(r.x,r.y),s=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=pf(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=dl.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=S_e(a,this),c=E(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:J0(a)?a.distanceInRenderSpace:0,layer:c}};return Qi.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(t){const{results:e,ground:r}=await H4t(this,t);let i=null;return!(e.length===0||Math.abs(gr(e[0].distance,0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:e,screenPoint:t,mapPoint:i}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(N(t.parent))throw new ce("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return YH(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return QH(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[QH(r[0],this._pixelFormat()),QH(r[1],this._pixelFormat())]}_completeSettings(t){const e=T4t(t,this);return e.pixelRatio/=this.state.pixelRatio,M4t(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!Le("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=YH(r[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[i,YH(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(N(this._stage.renderView.objectAndLayerIdRenderHelper))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return zpe.importLayerView(t)}hasLayerViewModule(t){return zpe.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,r,i;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=eLt(this.type);const e=Le("safari");if(e&&e<9&&(t=new ce("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),E(t))throw we.getLogger(this.declaredClass).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return E(t)?Bpe(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(E(r))return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,_t.Local),s=this._validateSpatialReferenceForViewingMode(t,e,_t.Global);return i||s?i&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,_t.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,_t.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!L9(t,r)&&(!!N(e)||!!wce(e)||(!EI(e)||!N(j7(e,t,r)))&&(!bce(e)||r!==_t.Global))}_makeSpatialReferenceConstraints(t,e,r){if(N(e))return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,s=t.isWGS84;return wce(e)&&(i||s)?!s||r===_t.Local||yoe(e.tileInfo,e.fullExtent,t,_t.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:xt.WebMercator,viewingMode:r}]:[{spatialReference:i?xt.WGS84:xt.WebMercator,viewingMode:r}]:EI(e)||bce(e)||!i&&!s?EI(e)&&i&&r!==_t.Global?[{spatialReference:t,viewingMode:r},{spatialReference:xt.WGS84,viewingMode:_t.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?xt.WGS84:xt.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=E(this.getSpatialReferenceSupport({spatialReference:t})),r=this._predeterminedViewingMode;return e||(E(r)?we.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${SG(r)} viewing mode.`):t.isGeographic&&we.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let r=this.spatialReference||xt.WGS84;return Ba(t,this.renderSpatialReference,t,r)||(r=xt.WGS84,Ba(t,this.renderSpatialReference,t,r)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=r):e=new Gt(t,r),e}trackGraphicState(t){if(!t.graphic)return we.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const s=n=>{var o;!i&&E(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(r=n.processor.graphicsCore.trackGraphicState(t))};return E(e)?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,E(r)&&(r.remove(),r=null)}}}highlight(t){if(Array.isArray(t))return S3(t.map(r=>this.highlight(r)));if(or.isCollection(t))return S3(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):F0()}maskOccludee(t){if(!t)return we.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const s=n=>{!i&&E(n)&&wlt(n)&&(r=n.maskOccludee(t))};return E(e)?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,E(r)&&(r.remove(),r=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){E(this.graphicsView)&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await Q$(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new ce("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,f$.INCLUDE),r=this._externalToInternalRenderItems(t.exclude,f$.EXCLUDE);return{include:e.layerUids,exclude:r.layerUids,graphics:{include:e.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(XS)?(e=this.computeMapPointFromVec3d(XS,e),t.intersector===pn.TERRAIN&&this.basemapTerrain&&(e.z=gr(pg(this.basemapTerrain,e),0)),e):null}_intersectResultsToHits(t,e){const r=new Array;let i=null;for(let s=0;s<t.length;s++){const n=t[s],o=S_e(n,this);if(E(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=KK(n,this);if(N(a))continue;if(a.type==="graphic"){if(N(i)&&s!==t.length-1&&(i=new Set),E(i)){const h=this._getGraphicFilterUid(a.graphic);if(i.has(h))continue;i.add(h)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(t){var s;const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const n=i.objectIdField??zSe,o=(s=t.attributes)==null?void 0:s[n];if(o)return`o-${i.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const r=this._getGraphicFilterUid(e);return N(t)||(N(t.include)||t.include.has(r))&&(N(t.exclude)||!t.exclude.has(r))}_externalToInternalRenderItems(t,e,r={layerUids:void 0,graphicUids:void 0}){if(!t)return r;if(t instanceof pl)ALt(r,this._getGraphicFilterUid(t)),e===f$.INCLUDE&&(E(this.graphicsView)&&t.layer===this?$O(r,this.graphicsView.processor.layer.id):t.layer&&$O(r,t.layer.uid));else if(eW(t))for(const i of t)i===this.graphics&&E(this.graphicsView)?$O(r,this.graphicsView.processor.layer.id):i===this.map.ground?$O(r,rv):this._externalToInternalRenderItems(i,e,r);else"uid"in t&&$O(r,t.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new LRt({view:this})),this._set("elevationProvider",new tI({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Eu({view:this})),this._set("featureTiles",new el({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var r;const e=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=E(this.basemapTerrain.extent)&&E(this.basemapTerrain.spatialReference)?TT(tU(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;E(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Qi.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(be(()=>import("./FeatureTileTree3DDebugger-88088837.js"),["assets/FeatureTileTree3DDebugger-88088837.js","assets/TileTreeDebugger-3b21cadf.js"])).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&Qi.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||Qi.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},ao),this.updatingHandles.add(()=>this.clippingArea,t,ao),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,ao)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new FEt(this.map,t));const e=this.state.isGlobal,r=VSe(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",VEt.create(this.state.viewingMode,r)),e||this.handles.add(xe(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const s=this.renderCoordsHelper.spatialReference;E(i)&&(i[0]!==0||i[1]!==0||i[2]!==0||i[3]!==0)&&yU(i,this.basemapTerrain.spatialReference,P_e,s)&&(this.renderCoordsHelper.extent=P_e)},os),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(uM/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){E(t)&&t.type===xs.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.handles.add(xe(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),os),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const r=t.getContext("2d");return r.putImageData(e,0,0),this.overlay.renderCanvas(t),r.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},e=new wEt(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",e);const r=hU(this.surface);this._stage=new hh({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=nL(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new ce("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Cr),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),Cr),xe(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,ao),this.on("pointer-move",()=>{var s;return(s=this._stage)==null?void 0:s.renderer.resetAnimation()})],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:wK.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(uM/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=gt(this._stage),this._lostWebGLContextHandle=sn(this._lostWebGLContextHandle),this.handles.remove("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new OCt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await be(()=>import("./GraphicsView3D-fb6efb31.js"),["assets/GraphicsView3D-fb6efb31.js","assets/GraphicsProcessor-80e900f2.js","assets/Graphics3DObjectStates-c1359da3.js","assets/optimizedFeatureQueryEngineAdapter-8953d0c8.js","assets/centroid-7ed31885.js","assets/PooledRBush-f1f7a72b.js","assets/quickselect-56c5966e.js"])).default;di(t),await Q$(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),E(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=Bpe(this.viewingMode);if(t===_t.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.handles.add(Co(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(rv);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(rv);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return N(this.voxelWasm)?(N(this.voxelWasmPromise)&&(this.voxelWasmPromise=be(()=>import("./VoxelWasmPerSceneView-cd825e0e.js"),[]).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){E(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function $O(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function ALt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function vF(t,e){return E(t)&&jx(t.spatialReference,e)?TT(t,e):null}var f$;Ht.type="3d",u([d()],Ht.prototype,"_userClippingArea",void 0),u([d()],Ht.prototype,"_resourceController",void 0),u([d()],Ht.prototype,"_stage",void 0),u([d({readOnly:!0})],Ht.prototype,"deconflictor",void 0),u([d({readOnly:!0})],Ht.prototype,"labeler",void 0),u([d($k(Y3,"analyses"))],Ht.prototype,"analyses",void 0),u([d({type:iM,readOnly:!0})],Ht.prototype,"animation",null),u([d({readOnly:!0})],Ht.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],Ht.prototype,"elevationProvider",void 0),u([d()],Ht.prototype,"camera",null),u([d({type:nf})],Ht.prototype,"contentCamera",null),u([d({readOnly:!0})],Ht.prototype,"canvas",void 0),u([d({type:Gt})],Ht.prototype,"center",null),u([d({type:Ki})],Ht.prototype,"clippingArea",null),u([d({type:B2})],Ht.prototype,"constraints",void 0),u([d({type:Ki,readOnly:!0})],Ht.prototype,"renderDataExtent",null),u([d({type:Ki,readOnly:!0})],Ht.prototype,"dataExtent",null),u([d({type:Ki,readOnly:!0})],Ht.prototype,"_groundAndLayersExtent",null),u([d({value:null,type:$E})],Ht.prototype,"environment",null),u([Hr("environment")],Ht.prototype,"castEnvironment",null),u([d({readOnly:!0})],Ht.prototype,"environmentManager",void 0),u([d({type:Ki})],Ht.prototype,"extent",null),u([d()],Ht.prototype,"floors",void 0),u([d()],Ht.prototype,"screenCenter",null),u([d()],Ht.prototype,"frustum",null),u([d({type:Number,readOnly:!0})],Ht.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],Ht.prototype,"graphicsView",void 0),u([d({readOnly:!0})],Ht.prototype,"analysisViewManager",void 0),u([d()],Ht.prototype,"groundView",void 0),u([d({type:Boolean})],Ht.prototype,"initialExtentRequired",null),u([d()],Ht.prototype,"_defaultsFromMapSettings",null),u([d()],Ht.prototype,"interacting",null),u([d()],Ht.prototype,"stationary",null),u([d()],Ht.prototype,"navigating",null),u([d()],Ht.prototype,"map",void 0),u([d({readOnly:!0})],Ht.prototype,"mapCoordsHelper",void 0),u([d()],Ht.prototype,"padding",null),u([d({type:Eu,readOnly:!0})],Ht.prototype,"pointsOfInterest",void 0),u([d({type:el,readOnly:!0})],Ht.prototype,"featureTiles",void 0),u([d()],Ht.prototype,"_featureTreeDebugger",void 0),u([d({type:Boolean})],Ht.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],Ht.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],Ht.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],Ht.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],Ht.prototype,"state",void 0),u([d({readOnly:!0})],Ht.prototype,"inputManager",void 0),u([d({readOnly:!0})],Ht.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],Ht.prototype,"qualityProfile",null),u([d({type:_Ae,get(){let t=this._get("qualitySettings");return t||(t=new _Ae,f8.apply(this.qualityProfile,t)),t}})],Ht.prototype,"qualitySettings",void 0),u([d()],Ht.prototype,"slicePlane",null),u([d({readOnly:!0})],Ht.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],Ht.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],Ht.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Ht.prototype,"resolution",null),u([d({type:Number})],Ht.prototype,"scale",null),u([d()],Ht.prototype,"heightModelInfo",null),u([d()],Ht.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],Ht.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],Ht.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],Ht.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],Ht.prototype,"type",void 0),u([d({type:_Fe})],Ht.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating","state.mode"]})],Ht.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],Ht.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],Ht.prototype,"viewingMode",null),u([d({type:z0})],Ht.prototype,"viewpoint",null),u([d({type:Number})],Ht.prototype,"zoom",null),u([d({type:wK})],Ht.prototype,"highlightOptions",void 0),Ht=u([j("esri.views.SceneView")],Ht),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(f$||(f$={}));const XS=V(),rq=Sn(),P_e=si(),yLt=Ht;let WA=class extends R3e(QMe(z$)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new _x,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,r){return super.on(e,r)}graphicChanged(e){this.emit("graphic-update",e)}};u([d({type:I3e})],WA.prototype,"elevationInfo",void 0),u([d($k(_x,"graphics"))],WA.prototype,"graphics",void 0),u([d({type:["show","hide"]})],WA.prototype,"listMode",void 0),u([d()],WA.prototype,"screenSizePerspectiveEnabled",void 0),u([d({readOnly:!0})],WA.prototype,"type",void 0),u([d({constructOnly:!0})],WA.prototype,"internal",void 0),WA=u([j("esri.layers.GraphicsLayer")],WA);const _Lt=WA;let JE=class extends Ke{constructor(t){super(t),this.format=null,this.position={coordinate:null,location:null}}get displayCoordinate(){const t=this.get("format");return t&&t.getDisplayCoordinate(this.get("position.coordinate"))}};u([d({readOnly:!0})],JE.prototype,"displayCoordinate",null),u([d()],JE.prototype,"format",void 0),u([d()],JE.prototype,"position",void 0),JE=u([j("esri.widgets.CoordinateConversion.support.Conversion")],JE);const $C=JE;function vLt(t,e){const r=vFe(e);return[t[0].toFixed(r),t[1].toFixed(r)]}function vFe(t){return t>=500?6:t<500&&t>=50?7:t<50&&t>=5?8:9}function bLt(t,e){const r=t.includes(",")?",":" ",[i,s,n]=t.split(r).map(a=>{const l=a.trim();return l?Number(l):null});if(!gB(i)||!gB(s))return null;const o=new Gt({x:i,y:s,spatialReference:e||xt.WGS84});return n&&(o.z=n,o.hasZ=!0),o}function gB(t){return typeof t=="number"&&isFinite(t)}function eee(t){return t&&gB(t.x)&&gB(t.y)}function I_e(t,e){if(t.spatialReference.isGeographic&&e){const[r,i]=vLt([t.x,t.y],e);return`${r}, ${i}`}return`${t.x.toFixed(3)}, ${t.y.toFixed(3)}`}function wLt(t){return t==="dd"||t==="dms"||t==="ddm"||t==="mgrs"||t==="usng"||t==="utm"}const iq={ar:[".",","],bg:[",",""],bs:[",","."],ca:[",","."],cs:[",",""],da:[",","."],de:[",","."],"de-ch":[".",""],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",",""],fi:[",",""],fr:[",",""],"fr-ch":[",",""],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",",""],id:[",","."],it:[",","."],"it-ch":[".",""],ja:[".",","],ko:[".",","],lt:[",",""],lv:[",",""],mk:[",","."],nb:[",",""],nl:[",","."],pl:[",",""],pt:[",","."],"pt-pt":[",",""],ro:[",","."],ru:[",",""],sk:[",",""],sl:[",","."],sr:[",","."],sv:[",",""],th:[".",","],tr:[",","."],uk:[",",""],vi:[",","."],zh:[".",","]};function eV(t=Yc()){let e=(t=t.toLowerCase())in iq;if(!e){const n=t.split("-");n.length>1&&n[0]in iq&&(t=n[0],e=!0),e||(t="en")}const[r,i,s="#,##0.###"]=iq[t];return{decimal:r,group:i,pattern:s}}function xLt(t,e){const r=eV((e={...e}).locale);e.customs=r;const i=e.pattern||r.pattern;return isNaN(t)||Math.abs(t)===1/0?null:TLt(t,i,e)}const bFe=/[#0,]*[#0](?:\.0*#*)?/;function TLt(t,e,r){const i=(r=r||{}).customs.group,s=r.customs.decimal,n=e.split(";"),o=n[0];if((e=n[t<0?1:0]||"-"+o).includes("%"))t*=100;else if(e.includes(""))t*=1e3;else{if(e.includes(""))throw new Error("currency notation not supported");if(e.includes("E"))throw new Error("exponential notation not supported")}const a=bFe,l=o.match(a);if(!l)throw new Error("unable to find a number expression in pattern: "+e);return r.fractional===!1&&(r.places=0),e.replace(a,SLt(t,l[0],{decimal:s,group:i,places:r.places,round:r.round}))}function SLt(t,e,r){(r=r||{}).places===!0&&(r.places=0),r.places===1/0&&(r.places=6);const i=e.split("."),s=typeof r.places=="string"&&r.places.indexOf(",");let n=r.places;s?n=r.places.substring(s+1):n>=0||(n=(i[1]||[]).length),r.round<0||(t=Number(t.toFixed(Number(n))));const o=String(Math.abs(t)).split("."),a=o[1]||"";if(i[1]||r.places){s&&(r.places=r.places.substring(0,s));const w=r.places!==void 0?r.places:i[1]&&i[1].lastIndexOf("0")+1;w>a.length&&(o[1]=a.padEnd(Number(w),"0")),n<a.length&&(o[1]=a.substr(0,Number(n)))}else o[1]&&o.pop();const l=i[0].replace(",","");let c=l.indexOf("0");c!==-1&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].substr(o[0].length-c)));let h,p,A=i[0].lastIndexOf(",");if(A!==-1){h=i[0].length-A-1;const w=i[0].substr(0,A);A=w.lastIndexOf(","),A!==-1&&(p=w.length-A-1)}const _=[];for(let w=o[0];w;){const T=w.length-h;_.push(T>0?w.substr(T):w),w=T>0?w.slice(0,T):"",p&&(h=p,p=void 0)}return o[0]=_.reverse().join(r.group||","),o.join(r.decimal||".")}function ELt(t){const e=eV((t=t||{}).locale),r=t.pattern||e.pattern,i=e.group,s=e.decimal;let n=1;if(r.includes("%"))n/=100;else if(r.includes(""))n/=1e3;else if(r.includes(""))throw new Error("currency notation not supported");const o=r.split(";");return o.length===1&&o.push("-"+o[0]),{regexp:Q4(o,l=>(l="(?:"+mbe(l,".")+")").replace(bFe,c=>{const h={signed:!1,separator:t.strict?i:[i,""],fractional:t.fractional,decimal:s,exponent:!1},p=c.split(".");let A=t.places;p.length===1&&n!==1&&(p[1]="###"),p.length===1||A===0?h.fractional=!1:(A===void 0&&(A=t.pattern?p[1].lastIndexOf("0")+1:1/0),A&&t.fractional==null&&(h.fractional=!0),!t.places&&A<p[1].length&&(A+=","+p[1].length),h.places=A);const _=p[0].split(",");return _.length>1&&(h.groupSize=_.pop().length,_.length>1&&(h.groupSize2=_.pop().length)),"("+MLt(h)+")"}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:i,decimal:s,factor:n}}function CLt(t,e){const r=ELt(e),i=new RegExp("^"+r.regexp+"$").exec(t);if(!i)return NaN;let s=i[1];if(!i[1]){if(!i[2])return NaN;s=i[2],r.factor*=-1}return s=s.replace(new RegExp("["+r.group+"\\s\\xa0]","g"),"").replace(r.decimal,"."),Number(s)*r.factor}function MLt(t){"places"in(t=t||{})||(t.places=1/0),typeof t.decimal!="string"&&(t.decimal="."),"fractional"in t&&!/^0/.test(String(t.places))||(t.fractional=[!0,!1]),"exponent"in t||(t.exponent=[!0,!1]),"eSigned"in t||(t.eSigned=[!0,!1]);const e=$_e(t),r=Q4(t.fractional,s=>{let n="";return s&&t.places!==0&&(n="\\"+t.decimal,t.places===1/0?n="(?:"+n+"\\d+)?":n+="\\d{"+t.places+"}"),n},!0);let i=e+r;return r&&(i="(?:(?:"+i+")|(?:"+r+"))"),i+Q4(t.exponent,s=>s?"([eE]"+$_e({signed:t.eSigned})+")":"")}function $_e(t){return"signed"in(t=t||{})||(t.signed=[!0,!1]),"separator"in t?"groupSize"in t||(t.groupSize=3):t.separator="",Q4(t.signed,e=>e?"[-+]":"",!0)+Q4(t.separator,e=>{if(!e)return"(?:\\d+)";(e=mbe(e))===" "?e="\\s":e===""&&(e="\\s\\xa0");const r=t.groupSize,i=t.groupSize2;if(i){const s="(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+e+"]\\d{"+i+"})*["+e+"]\\d{"+r+"})";return r-i>0?"(?:"+s+"|(?:0|[1-9]\\d{0,"+(r-1)+"}))":s}return"(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+e+"]\\d{"+r+"})*)"},!0)}const Q4=(t,e,r)=>{if(!(t instanceof Array))return e(t);const i=[];for(let s=0;s<t.length;s++)i.push(e(t[s]));return RLt(i.join("|"),!!r)},RLt=(t,e)=>"("+(e?"?:":"")+t+")";function OLt(t,e){const r=[];t=(t=(t=t.replace(/[\u00B0\u00BA]/g,"^")).replace(/\u2032/g,"'")).replace(/\u2033/g,'"');const i=Lb(e);return fx.dmsToGeog(i,1,[t],r)?new Gt(r[0][0],r[0][1],e||xt.WGS84):null}function PLt(t,e,r){const i=[],s=wFe(r);if(s===-1)return console.warn(`invalid conversionMode: ${r}`),null;const n=Lb(e);return _h.mgrsToGeogExtended(n,1,[t],s,i)?new Gt(i[0][0],i[0][1],e||xt.WGS84):null}function ILt(t,e){const r=[];!e&&/\(.+27/.test(t)&&(e=xt.GCS_NAD_1927);const i=Lb(e);return e4.usngToGeog(i,1,[t],r)?new Gt(r[0][0],r[0][1],e||xt.WGS84):null}function $Lt(t,e,r){const i=[],s=xFe(r);if(s===-1)return console.warn(`invalid conversionMode: ${r}`),null;const n=Lb(e);return ky.utmToGeog(n,1,[t],s,i)?new Gt(i[0][0],i[0][1],e||xt.WGS84):null}function LLt(t,e,r=0){const i=[[t.x,t.y]],s=[],n=Lb(t.spatialReference);let o=0;switch(e){case"dd":o=fx.geogToDd(n,1,i,r,s);break;case"ddm":o=fx.geogToDdm(n,1,i,r,s);break;case"dms":o=fx.geogToDms(n,1,i,r,s);break;default:return console.warn(`invalid format: ${e}`),null}return o?s[0]:null}function DLt(t,e,r=0,i=!1){const s=[[t.x,t.y]],n=[],o=Lb(t.spatialReference);let a=wFe(e);return a===-1?(console.warn(`invalid conversionMode: ${e}`),null):(i&&(a|=_h.PE_MGRS_ADD_SPACES),_h.geogToMgrsExtended(o,1,s,r,!1,a,n)?n[0]:null)}function NLt(t,e=0,r=!1){const i=[[t.x,t.y]],s=[],n=Lb(t.spatialReference);return e4.geogToUsng(n,1,i,e,!1,r,s)?s[0]:null}function FLt(t,e,r=!1){const i=[[t.x,t.y]],s=[],n=Lb(t.spatialReference);let o=xFe(e);return o===-1?(console.warn(`invalid conversionMode: ${e}`),null):(r&&(o|=ky.PE_UTM_OPTS_ADD_SPACES),ky.geogToUtm(n,1,i,o,s)?s[0]:null)}function Lb(t){let e=null;if(t||(t=xt.WGS84),t.wkid){if(e=K$.geogcs(t.wkid),!e)throw new ce("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!t.wkt)throw new ce("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(e=K$.fromString(qn.PE_TYPE_GEOGCS,t.wkt),!e)throw new ce("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return e}function wFe(t){let e=-1;switch(t){case"automatic":e=_h.PE_MGRS_STYLE_AUTO;break;case"new-180-in-zone-01":e=_h.PE_MGRS_STYLE_NEW|_h.PE_MGRS_180_ZONE_1_PLUS;break;case"new-180-in-zone-60":e=_h.PE_MGRS_STYLE_NEW;break;case"old-180-in-zone-01":e=_h.PE_MGRS_STYLE_OLD|_h.PE_MGRS_180_ZONE_1_PLUS;break;case"old-180-in-zone-60":e=_h.PE_MGRS_STYLE_OLD}return e}function xFe(t){let e=-1;switch(t){case"latitude-band-indicators":e=ky.PE_UTM_OPTS_NONE;break;case"north-south-indicators":e=ky.PE_UTM_OPTS_NS}return e}let dh=class extends Ke{constructor(t){super(t),this.conversionInfo=null,this.coordinateSegments=null,this.defaultPattern=null,this.name=null,this.viewModel=null}get currentPattern(){return this._get("currentPattern")||this._get("defaultPattern")}set currentPattern(t){this._set("currentPattern",t)}get label(){return this.name??""}set label(t){this._overrideIfSome("label",t)}get hasDisplayProperties(){return!(!this.defaultPattern||!this.coordinateSegments)}get spatialReference(){var t;return this.name==="basemap"?this._viewSpatialReference:((t=this.conversionInfo)==null?void 0:t.spatialReference)??xt.WGS84}set spatialReference(t){this._overrideIfSome("spatialReference",t)}get _viewSpatialReference(){return this.get("viewModel.view.spatialReference")||xt.WGS84}get _additionalCharactersPattern(){const t=this.get("coordinateSegments");if(!t)return null;const e=t.map(i=>i.alias),r=this.currentPattern.replace(new RegExp(`["nsew${e.join()}]`,"gi"),"").replace(/\ /g,"");return new RegExp(`[${r}]`,"g")}get test(){return{additionalCharactersPattern:this._additionalCharactersPattern}}convert(t){if(!eee(t))return Promise.reject(new ce("format:invalid-point","Could not convert invalid point.",{point:t}));const e=this.get("conversionInfo.convert");return e?Promise.resolve().then(()=>e(t)):this._project(t,this.spatialReference).then(r=>this._getCoordinate(r).then(i=>({location:r,coordinate:i})))}getConversionStrategy(){const t=this._viewSpatialReference;return this.get("conversionInfo.convert")||this.get("viewModel.formatterAvailable")||this.name==="xy"&&(t.isWebMercator||t.isWGS84)||this.name==="basemap"?"client":"server"}getDisplayCoordinate(t){if(!t)return null;if(!this.coordinateSegments||!this.currentPattern)return t;let e=this.currentPattern;const r=this._getSegmentMatches(t,!1);for(let i=this.coordinateSegments.length-1;i>=0;i--){const s=this.coordinateSegments[i];e=e.replace(s.alias,r[i])}return e}parseUserInput(t){let e=this.defaultPattern.replace(this._additionalCharactersPattern,"");t=t.replace(this._additionalCharactersPattern,"");const r=this._getSegmentMatches(t,!0);for(let i=this.coordinateSegments.length-1;i>=0;i--){const s=this.coordinateSegments[i];e=e.replace(s.alias,r[i])}return e}_getSegmentMatches(t,e){const r=[];for(let i=0;i<this.coordinateSegments.length;i++){const s=this.coordinateSegments[i],n=t.match(s.searchPattern);if(!n){r.push("");continue}let o=n[0];if(t=t.replace(o,"").trim(),s.substitution){const a=e?s.substitution.input(o):s.substitution.output(o);a&&(o=`${a}`)}r.push(o)}return r}reverseConvert(t){const e=this.parseUserInput(t),r=this.get("conversionInfo.reverseConvert");let i;if(r)i=r(e);else if(this.name==="xy"||this.name==="basemap")i=bLt(e,this.spatialReference);else if(this.viewModel.formatterAvailable)switch(this.name){case"dd":case"ddm":case"dms":i=OLt(e,this.spatialReference);break;case"mgrs":{const s="automatic";i=PLt(e,this.spatialReference,s);break}case"utm":{const s="latitude-band-indicators";i=$Lt(e,this.spatialReference,s);break}case"usng":i=ILt(e,this.spatialReference);break;default:i=null}return i?this._project(i,this._viewSpatialReference):Promise.reject(new ce("format:invalid-input","Could not parse input into point.",{userInput:t}))}_getCoordinate(t){const e=this.get("viewModel.view.scale");if(!eee(t))return Promise.reject(new ce("format:invalid-point","Could not transform invalid point into coordinate.",{point:t}));if(this.get("viewModel.formatterAvailable")||this.name==="basemap"||this.name==="xy")switch(this.name){case"dd":case"ddm":case"dms":{const r=vFe(e);return Promise.resolve(LLt(t,this.name,r))}case"mgrs":{const s="automatic";return Promise.resolve(DLt(t,s,5,!1))}case"usng":return Promise.resolve(NLt(t,5,!1));case"utm":{const i="latitude-band-indicators";return Promise.resolve(FLt(t,i,!0))}default:return Promise.resolve(I_e(t,e))}return Promise.resolve(I_e(t,e))}_project(t,e){var r,i;if(Po(t.spatialReference,e)||!e)return Promise.resolve(t);if((r=this.viewModel)!=null&&r.formatterAvailable&&AU())return Promise.resolve(TT(t,e));if(!((i=this.viewModel)!=null&&i.formatterAvailable)){const s=xb(t,e);if(E(s))return Promise.resolve(s)}return null}};u([d()],dh.prototype,"conversionInfo",void 0),u([d()],dh.prototype,"coordinateSegments",void 0),u([d()],dh.prototype,"currentPattern",null),u([d()],dh.prototype,"label",null),u([d()],dh.prototype,"defaultPattern",void 0),u([d({readOnly:!0})],dh.prototype,"hasDisplayProperties",null),u([d()],dh.prototype,"name",void 0),u([d({type:xt})],dh.prototype,"spatialReference",null),u([d()],dh.prototype,"viewModel",void 0),u([d({readOnly:!0})],dh.prototype,"_viewSpatialReference",null),u([d({readOnly:!0})],dh.prototype,"_additionalCharactersPattern",null),dh=u([j("esri.widgets.CoordinateConversion.support.Format")],dh);const s1=dh,M2=eV().decimal,ZS={N:"north",S:"south",E:"east",W:"west"},Ao="",bF=new RegExp(`-?\\d+[\\.|\\${M2}]?\\d*`),kLt=/^[\\0]+(?=\d)/;function L_e(t,e){const r=Yc()==="ar",i=t.abbreviatedDirections.north,s=t.abbreviatedDirections.south,n=t.abbreviatedDirections.east,o=t.abbreviatedDirections.west,a=eV().decimal,l={};l[i]="N",l[s]="S",l[n]="E",l[o]="W";const c=new RegExp(`-?\\d+[\\.|\\${a}]?\\d*`),h=new RegExp(`N|S|${i}|${s}`,"i"),p=new RegExp(`E|W|${n}|${o}`,"i"),A={ddm:`Y${Ao} A'${t.abbreviatedDirections.north}, X${Ao} B'${t.abbreviatedDirections.east}`,dms:`Y${Ao} A' B"${t.abbreviatedDirections.north}, X${Ao} C' D"${t.abbreviatedDirections.east}`,dd:`Y${Ao}${t.abbreviatedDirections.north}, X${Ao}${t.abbreviatedDirections.east}`,xy:`X${Ao}, Y${Ao}`,basemap:"X, Y"},_={ddm:`${t.abbreviatedDirections.north}${Ao}Y 'A ,${t.abbreviatedDirections.east}${Ao}X 'B`,dms:`${t.abbreviatedDirections.north}${Ao}Y 'A "B ,${t.abbreviatedDirections.east}${Ao}X 'C "D`,dd:`${t.abbreviatedDirections.north}${Ao}Y ,${t.abbreviatedDirections.east}${Ao}X`,xy:`X${Ao} ,Y${Ao}`,basemap:"X ,Y"},w=new RegExp(`\\d{1,2}[\\.|\\${a}]?\\d*`,"i"),T=new RegExp(`\\d{1,3}[\\.|\\${a}]?\\d*`,"i");e.forEach(C=>{const{name:M}=C;if(M==="dd"?C.coordinateSegments=[{alias:"Y",description:"degrees latitude",searchPattern:w,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:t.abbreviatedDirections.north,description:"north/south indicator",searchPattern:h,substitution:{input:O=>l[O],output:O=>t.abbreviatedDirections[ZS[O]]}},{alias:"X",description:"degrees longitude",searchPattern:T,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:t.abbreviatedDirections.east,description:"east/west indicator",searchPattern:p,substitution:{input:O=>l[O],output:O=>t.abbreviatedDirections[ZS[O]]}}]:M==="ddm"?C.coordinateSegments=[{alias:"Y",description:"degrees latitude",searchPattern:w,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:"A",description:"minutes latitude",searchPattern:w,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:t.abbreviatedDirections.north,description:"north/south indicator",searchPattern:h,substitution:{input:O=>l[O],output:O=>t.abbreviatedDirections[ZS[O]]}},{alias:"X",description:"degrees longitude",searchPattern:T,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:"B",description:"minutes longitude",searchPattern:w,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:t.abbreviatedDirections.east,description:"east/west indicator",searchPattern:p,substitution:{input:O=>l[O],output:O=>t.abbreviatedDirections[ZS[O]]}}]:M==="dms"?C.coordinateSegments=[{alias:"Y",description:"degrees latitude",searchPattern:w,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:"A",description:"minutes latitude",searchPattern:w,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:"B",description:"seconds latitude",searchPattern:w,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:t.abbreviatedDirections.north,description:"north/south indicator",searchPattern:h,substitution:{input:O=>l[O],output:O=>t.abbreviatedDirections[ZS[O]]}},{alias:"X",description:"degrees longitude",searchPattern:T,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:"C",description:"minutes longitude",searchPattern:w,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:"D",description:"seconds longitude",searchPattern:w,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:t.abbreviatedDirections.east,description:"east/west indicator",searchPattern:p,substitution:{input:O=>l[O],output:O=>t.abbreviatedDirections[ZS[O]]}}]:(C.name==="xy"||C.name==="basemap")&&(C.coordinateSegments=[{alias:"X",description:"easting",searchPattern:c,substitution:{input:O=>Js(O),output:O=>Zs(O)}},{alias:"Y",description:"northing",searchPattern:c,substitution:{input:O=>Js(O),output:O=>Zs(O)}}]),A[M]){const O=r?_[M]:A[M];C.defaultPattern=O,C.currentPattern=O}})}function BLt(){const t=new RegExp("N|S","i"),e=new RegExp("E|W","i");return[new s1({name:"basemap",coordinateSegments:[{alias:"X",description:"easting",searchPattern:bF,substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"Y",description:"northing",searchPattern:bF,substitution:{input:r=>Js(r),output:r=>Zs(r)}}],defaultPattern:"X, Y",viewModel:null}),new s1({name:"dd",coordinateSegments:[{alias:"Y",description:"degrees latitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\${M2}]?\\d*(?=\\D*?[N|S])`,"i"),substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"N",description:"north/south indicator",searchPattern:t},{alias:"X",description:"degrees longitude",searchPattern:new RegExp(`\\d{1,3}[\\.|\\${M2}]?\\d*(?=\\D*?[E|W|])`,"i"),substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"E",description:"east/west indicator",searchPattern:e}],defaultPattern:`Y${Ao}N, X${Ao}E`,viewModel:null}),new s1({name:"ddm",coordinateSegments:[{alias:"Y",description:"degrees latitude",searchPattern:new RegExp("\\d{1,2}(?=.*?\\s+.*?[N|S])","i"),substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"A",description:"minutes latitude",searchPattern:new RegExp(`\\d{1,2}[\\.\\${M2}]?\\d*(?=.*?[N|S])`,"i"),substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"N",description:"north/south indicator",searchPattern:t},{alias:"X",description:"degrees longitude",searchPattern:new RegExp("\\d{1,3}(?=\\D*?\\s+.*?[E|W])","i"),substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"B",description:"minutes longitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\|${M2}]?\\d*(?=.*?[E|W])`,"i"),substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"E",description:"east/west indicator",searchPattern:e}],defaultPattern:`Y${Ao} A'N, X${Ao} B'E`,viewModel:null}),new s1({name:"dms",coordinateSegments:[{alias:"Y",description:"degrees latitude",searchPattern:new RegExp("\\d{1,2}(?=.*?\\s+.*?[N|S])","i"),substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"A",description:"minutes latitude",searchPattern:new RegExp("\\d{1,2}(?=.*?[N|S])","i"),substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"B",description:"seconds latitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\${M2}]?\\d*(?=.*?[N|S])`,"i"),substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"N",description:"north/south indicator",searchPattern:t},{alias:"X",description:"degrees longitude",searchPattern:new RegExp("\\d{1,3}(?=.*?\\s+.*?[E|W])","i"),substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"C",description:"minutes longitude",searchPattern:new RegExp("\\d{1,2}(?=.*?[E|W])","i"),substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"D",description:"seconds longitude",searchPattern:new RegExp(`\\d{1,2}[\\.|\\${M2}]?\\d*(?=.*?[E|W])`,"i"),substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"E",description:"east/west indicator",searchPattern:e}],defaultPattern:`Y${Ao} A' B"N, X${Ao} C' D"E`,viewModel:null}),new s1({name:"xy",coordinateSegments:[{alias:"X",description:"longitude",searchPattern:bF,substitution:{input:r=>Js(r),output:r=>Zs(r)}},{alias:"Y",description:"latitude",searchPattern:bF,substitution:{input:r=>Js(r),output:r=>Zs(r)}}],defaultPattern:`X${Ao}, Y${Ao}`,viewModel:null}),new s1({name:"mgrs",coordinateSegments:[{alias:"Z",description:"grid zone",searchPattern:/\d{1,2}\w|[abyz]/i},{alias:"S",description:"grid square",searchPattern:/\w{2}/},{alias:"X",description:"easting",searchPattern:/^\d{5}(?=.?\d{5}$)|^\d{4}(?=.?\d{4}$)|^\d{3}(?=.?\d{3}$)|^\d{2}(?=.?\d{2}$)|^\d(?=.?\d$)/},{alias:"Y",description:"northing",searchPattern:/^\d{1,5}/}],defaultPattern:"Z S X Y",viewModel:null}),new s1({name:"usng",coordinateSegments:[{alias:"Z",description:"grid zone",searchPattern:/\d{1,2}\w|[abyz]/i},{alias:"S",description:"grid square",searchPattern:/\w{2}/},{alias:"X",description:"easting",searchPattern:/^\d{5}(?=.?\d{5}$)|^\d{4}(?=.?\d{4}$)|^\d{3}(?=.?\d{3}$)|^\d{2}(?=.?\d{2}$)|^\d(?=.?\d$)/},{alias:"Y",description:"northing",searchPattern:/^\d{1,5}/}],defaultPattern:"Z S X Y",viewModel:null}),new s1({name:"utm",coordinateSegments:[{alias:"Z",description:"zone number",searchPattern:/\d{1,2}|[abyz]/i},{alias:"B",description:"latitude band",searchPattern:/^\D/},{alias:"X",description:"easting",searchPattern:/\d{1,7}(?=\s*\d{7}$)/},{alias:"Y",description:"northing",searchPattern:/\d{1,7}/}],defaultPattern:"ZB X Y",viewModel:null})]}function Zs(t){const e=t.match(kLt),r=e?e[0]:"",i=t.includes(".")?t.split(".")[1].length:0;return r+xLt(Number(t),{pattern:"###0.###",places:i,round:-1})}function Js(t){return CLt(t)}const wF={default:"default",crosshair:"crosshair"},ULt=new Gt([0,0,500]),VLt="xy",zLt=["mgrs","utm","usng","dd","dms","ddm"],D_e="esri__coordinateConversionWidgetState",xm={conversions:"conversions",formats:"formats",view:"view",viewChange:"view-change"},GLt="esri/images/search/search-symbol-32.png";let Hl=class extends sse(Nn.EventedAccessor){constructor(t){super(t),this._conversionPromise=null,this._handles=new ts,this._locationGraphic=null,this._pointerCount=0,this.conversions=new or,this.formats=new or,this.formatterAvailable=!1,this.messages=null,this.filteredFormats=new or,this.locationSymbol=new AL({url:Zi(GLt),width:24,height:24}),this.storageEnabled=!0,this.storageType="session",this.view=null,this._saveWidgetState=this._saveWidgetState.bind(this),this._handleFormatChange=this._handleFormatChange.bind(this),this._handleConversionChange=this._handleConversionChange.bind(this),this._handleViewChange=this._handleViewChange.bind(this),this._onClick=this._onClick.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerUp=this._onPointerUp.bind(this)}initialize(){const t=async()=>this.messages=await kte("esri/widgets/CoordinateConversion/t9n/CoordinateConversion");this.formats.addMany(BLt()),t().then(()=>{if(!this.destroyed&&(L_e(this.messages,this.formats),this.storageEnabled&&this._loadWidgetState(),this.formats.forEach(e=>{e.viewModel=this,this._handles.add(xe(()=>e.currentPattern,this._saveWidgetState),e.name)}),this._handles.add(this.conversions.on("change",this._handleConversionChange),xm.conversions),this._handles.add(this.formats.on("change",this._handleFormatChange),xm.formats),this._handles.add(Dte(()=>{t().then(()=>{L_e(this.messages,this.formats)})})),r4().then(()=>{this.formatterAvailable=!0}).catch(e=>{we.getLogger(this.declaredClass).error(new ce("coordinate-conversion:projection-load-failed","Failed to load the projection module.",{error:e})),this.formatterAvailable=!1,this._filterFormatsAndConversions()}).then(()=>this._handles.add(xe(()=>this.view,this._handleViewChange,Cr),xm.viewChange)),this.conversions.length===0)){const e=this.formats.find(r=>r.name===VLt)||this.formats.getItemAt(0);this.conversions.add(new $C({format:e}))}})}destroy(){this._handles.removeAll(),this._cleanUpView(this.view),this.view=null}castConversions(t){return this._castToConversions(t)}set currentLocation(t){this._set("currentLocation",t),this._updateConversions()}get currentLocation(){return this._get("currentLocation")||null}set mode(t){switch(t){case"capture":this.currentLocation=null,this._startCaptureMode(),this._set("mode",t);break;case"live":this._startLiveMode(),this._set("mode",t)}}get mode(){return this._get("mode")||"live"}get state(){const{messages:t,view:e}=this,r=e==null?void 0:e.ready;return t?r?"ready":e?"loading":"disabled":"disabled"}get storage(){const{storageType:t}=this;return t==="session"?sessionStorage:localStorage}get waitingForConversions(){return this._conversionPromise!=null}setLocation(t){if(this.view.graphics.remove(this._locationGraphic),t){const e=t.clone();e.hasZ&&(e.z=void 0),this._locationGraphic=new pl({geometry:e,symbol:this.get("locationSymbol")}),this.view.graphics.add(this._locationGraphic)}}convert(t,e){return eee(e)?Promise.resolve().then(()=>t.convert(e)):Promise.reject(new ce("coordinate-conversion:invalid-point","Invalid point cannot be converted.",{point:e}))}goToLocation(t){var s,n,o;const e=this.view,r=e.type==="3d"?e.clippingArea:null,i=(n=(s=e.map)==null?void 0:s.basemap)==null?void 0:n.baseLayers;if(r||(i==null?void 0:i.length)>0){const a=r??((o=i.getItemAt(0))==null?void 0:o.fullExtent);if(E(a)&&!a.contains(t))return Promise.reject(new ce("coordinate-conversion:go-to-failed","Point outside basemap extent.",{point:t}))}return this.callGoTo({target:t})}pause(){this.currentLocation=null,this._handles.remove(xm.view),this.view&&(this.view.cursor=wF.default,this.view.graphics.remove(this._locationGraphic))}previewConversion(t,e=this.currentLocation||ULt){return this._convertMany([t],e).then(()=>t.displayCoordinate)}resume(){this.mode==="capture"?this._startCaptureMode():this._startLiveMode()}reverseConvert(t,e){return e.reverseConvert(t)}async updateConversions(t,e){if(!e||!e.type||e.type!=="point")throw this._clearConversions(this.conversions),new ce("coordinate-conversion:invalid-input-point","Point is invalid, conversions cannot be updated.",{point:e});return this._convertMany(t,e)}_castToConversions(t){const e=new or;return t.forEach(r=>{let i;if(r instanceof $C)i=r;else if(typeof r=="string"){const s=this.formats.find(n=>n.name===r);s&&(i=new $C({format:s}))}i&&e.add(i)}),e}_cleanUpView(t){t&&(t.graphics.remove(this._locationGraphic),this._handles.remove(xm.view),t.cursor=wF.default)}_clearConversions(t){t.forEach(e=>{e.position={location:null,coordinate:null}})}_convertMany(t,e){return Promise.all(t.map(r=>r.format.convert(e).then(i=>(r.position=i,r)).catch(()=>{r.position=null}))).then(()=>t)}_handleConversionChange(t){t.added.forEach(e=>{const r=e.format;r.viewModel=this,this.currentLocation&&(this._set("waitingForConversions",!0),this.convert(r,this.currentLocation).then(i=>{e.position=i,this._set("waitingForConversions",!1)}))}),this._saveWidgetState()}_handleFormatChange(t){t.added.forEach(e=>{this._handles.add(xe(()=>e.currentPattern,this._saveWidgetState),e.name),e.viewModel=this}),t.removed.forEach(e=>{e.viewModel=null;const r=this.conversions.filter(i=>i.format===e);this.conversions.removeMany(r),this._handles.remove(e.name)})}_loadWidgetState(){try{const t=JSON.parse(this.storage.getItem(D_e));t&&this._setWidgetState(t)}catch(t){we.getLogger(this.declaredClass).error(new ce("coordinate-conversion:invalid-session-storage-json","Could not read from storage.",{error:t}))}}_startCaptureMode(){this._handles.remove(xm.view),this.view&&(this.view.cursor=wF.crosshair,this.currentLocation&&this.setLocation(this.currentLocation),this._handles.add(this.view.on("click",this._onClick),xm.view))}_startLiveMode(){this._pointerCount=0,this._handles.remove(xm.view),this.view&&(this.view.cursor=wF.default,this.view.graphics.remove(this._locationGraphic),this._handles.add([this.view.on("pointer-down",this._onPointerDown),this.view.on("pointer-up",this._onPointerUp),this.view.on("pointer-move",this._onPointerMove)],xm.view))}_handleViewChange(t,e){e&&e!==t&&this._cleanUpView(e),t&&(this.mode==="capture"?this._startCaptureMode():this._startLiveMode(),e&&this._filterFormatsAndConversions())}_onClick(t){if(t.button===0){const e=this.view.toMap(t),r=e&&e.normalize();this.setLocation(r),this.currentLocation=r}}_onPointerDown(t){const{pointerType:e}=t;if(this._pointerCount++,(e==="touch"||e==="pen")&&this._pointerCount===1){const r=this.view.toMap(t);this.currentLocation=r&&r.normalize()}}_onPointerMove(t){const{pointerType:e}=t;if(e==="mouse"||this._pointerCount===1){const r=this.view.toMap(t);this.currentLocation=r&&r.normalize()}}_onPointerUp(){this._pointerCount--}_setWidgetState(t){try{t.formats.forEach(e=>{const r=this.formats.find(i=>i.name===e.name);r&&t.locale===Yc()&&e.currentPattern&&(r.currentPattern=e.currentPattern),r&&e.index>=0&&this.conversions.add(new $C({format:r}))})}catch(e){we.getLogger(this.declaredClass).warn(new ce("coordinate-conversion:session-storage-read-error","Could not get widget state from stored JSON.",{error:e}))}}_saveWidgetState(){if(!this.storageEnabled)return;const t=this._toJSON();try{this.storage.setItem(D_e,JSON.stringify({formats:t,locale:Yc()}))}catch(e){we.getLogger(this.declaredClass).error(new ce("coordinate-conversion:local-storage-write-error","Could not write to localStorage.",{error:e}))}}async _updateConversions(){try{await this.updateConversions(this.conversions.toArray(),this.currentLocation)}catch{}}_toJSON(){return this.formats.filter(t=>{const e=t.name;return e==="xy"||e==="basemap"||wLt(e)}).map(t=>({name:t.name,currentPattern:t.currentPattern,defaultPattern:t.defaultPattern,index:this.conversions.findIndex(e=>e.format===t)})).sort((t,e)=>t.index-e.index).toArray()}_filterFormatsAndConversions(){const{formatterAvailable:t,conversions:e,formats:r}=this;t||this._handles.add(Nl(()=>this.view.spatialReference,i=>{const s=i.isWebMercator||i.isWGS84,n=r.filter(l=>{const{name:c}=l;return!!zLt.includes(c)||c==="xy"&&!s}),o=this.filteredFormats.filter(l=>l.name==="xy"&&s&&!this.formats.includes(l)),a=e.filter(l=>n.includes(l.format));r.removeMany(n),e.removeMany(a),this.filteredFormats.addMany(n.filter(l=>!this.filteredFormats.includes(l))),r.addMany(o)},{once:!0,initial:!0}),xm.view)}};u([d()],Hl.prototype,"conversions",void 0),u([Hr("conversions")],Hl.prototype,"castConversions",null),u([d({type:Gt})],Hl.prototype,"currentLocation",null),u([d()],Hl.prototype,"formats",void 0),u([d()],Hl.prototype,"messages",void 0),u([d()],Hl.prototype,"mode",null),u([d()],Hl.prototype,"filteredFormats",void 0),u([d({readOnly:!0})],Hl.prototype,"state",null),u([d()],Hl.prototype,"locationSymbol",void 0),u([d({readOnly:!0,dependsOn:["storageType"]})],Hl.prototype,"storage",null),u([d()],Hl.prototype,"storageEnabled",void 0),u([d()],Hl.prototype,"storageType",void 0),u([d({readOnly:!0})],Hl.prototype,"waitingForConversions",null),u([d()],Hl.prototype,"view",void 0),Hl=u([j("esri.widgets.CoordinateConversion.CoordinateConversionViewModel")],Hl);const TFe=Hl,It={base:"esri-coordinate-conversion esri-widget",captureMode:"esri-coordinate-conversion--capture-mode",noBasemap:"esri-coordinate-conversion--no-basemap",popup:"esri-coordinate-conversion__popup",clipboardPopup:"esri-coordinate-conversion__clipboard-popup",conversionList:"esri-coordinate-conversion__conversion-list",conversionRow:"esri-coordinate-conversion__row",coordDisplay:"esri-coordinate-conversion__display",expanded:"esri-coordinate-conversion__conversions-view--expanded",expandDown:"esri-coordinate-conversion__conversions-view--expand-down",expandUp:"esri-coordinate-conversion__conversions-view--expand-up",conversionsView:"esri-coordinate-conversion__conversions-view",primarySelect:"esri-coordinate-conversion__select-primary",rowSelect:"esri-coordinate-conversion__select-row",toolDisplay:"esri-coordinate-conversion__tools",modeToggle:"esri-coordinate-conversion__mode-toggle",rowButton:"esri-coordinate-conversion__row-button",backButton:"esri-coordinate-conversion__back-button",convertButton:"esri-coordinate-conversion__button",convertButtonSpan:"esri-coordinate-conversion__convert-button-span",coordinateInput:"esri-coordinate-conversion__input-coordinate",inputForm:"esri-coordinate-conversion__input-form",inputFormGroup:"esri-coordinate-conversion__input-group",rejectInput:"esri-coordinate-conversion__input-coordinate--rejected",sectionHeading:"esri-coordinate-conversion__heading",patternInput:"esri-coordinate-conversion__pattern-input",settings:"esri-coordinate__settings",settingsFormGroup:"esri-coordinate-conversion__settings-group",settingsFormGroupHorizontal:"esri-coordinate-conversion__settings-group-horizontal",previewCoordinate:"esri-coordinate-conversion__preview-coordinate",disabled:"esri-disabled",input:"esri-input",button:"esri-button",header:"esri-widget__heading",widgetButton:"esri-widget--button",leftArrow:"esri-icon-left-arrow",rightArrow:"esri-icon-right-arrow",captureButton:"esri-icon-map-pin",collapseButton:"esri-icon-up",copyButton:"esri-icon-duplicate",editButton:"esri-icon-edit",esriSelect:"esri-select",expandButton:"esri-icon-down",goToButton:"esri-icon-locate",refresh:"esri-icon-refresh",removeConversion:"esri-icon-close",settingsButton:"esri-icon-settings2"},N_e={settingsButton:!0,inputButton:!0,captureButton:!0,expandButton:!0},jLt=750,HLt=2500;let bn=class extends pc{constructor(t,e){super(t,e),this._popupMessage=null,this._popupTimeoutId=null,this._clipboardPopupTimeoutId=null,this._coordinateInput=null,this._badInput=!1,this._goToEnabled=!1,this._conversionFormat=null,this._settingsFormat=null,this._previewConversion=null,this._expanded=!1,this._clipboardPopupVisible=!1,this._popupVisible=!1,this._settingsVisible=!1,this._inputVisible=!1,this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.orientation="auto",this.viewModel=new TFe,this.visibleElements={...N_e}}get conversions(){return this.viewModel.conversions}set conversions(t){this.viewModel.conversions=t}get currentLocation(){return this.viewModel.currentLocation}set currentLocation(t){this.viewModel.currentLocation=t}get formats(){return this.viewModel.formats}set formats(t){this.viewModel.formats=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get mode(){return this.viewModel.mode}set mode(t){this.viewModel.mode=t}set multipleConversions(t){t===!1&&(this._expanded=!1,this.conversions.splice(1,this.conversions.length-1)),this._set("multipleConversions",t)}get multipleConversions(){const t=this._get("multipleConversions");return typeof t!="boolean"||t}get locationSymbol(){return this.viewModel.locationSymbol}set locationSymbol(t){this.viewModel.locationSymbol=t}get storageEnabled(){return this.viewModel.storageEnabled}set storageEnabled(t){this.viewModel.storageEnabled=t}get storageType(){return this.viewModel.storageType}set storageType(t){this.viewModel.storageType=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}castVisibleElements(t){return{...N_e,...t}}reverseConvert(t,e){return this.viewModel.reverseConvert(t,e)}render(){const t=this.get("viewModel.state"),e=t==="disabled"?pe("div",{key:"esri-coordinate__no-basemap"},this.messages.noBasemap):null,r=!e&&this._inputVisible?this._renderInputForm():null,i=!e&&this._settingsVisible?this._renderSettings():null,s=e||r||i?null:this._renderConversionsView(),n=this._popupVisible?this._renderPopup():null,o={[It.captureMode]:this.mode==="capture",[It.disabled]:t==="loading",[It.noBasemap]:t==="disabled"};return pe("div",{class:this.classes(It.base,o)},n,e,s,i,r)}_addConversion(t){const e=t.target,r=e.options[e.options.selectedIndex]["data-format"],i=e["data-index"],s=new $C({format:r});e.options.selectedIndex=0,i>=0&&this.conversions.removeAt(i),this.conversions.add(s,i)}_findSettingsFormat(){return this._settingsFormat||this.conversions.reduceRight((t,e)=>{const r=e.format;return r.get("hasDisplayProperties")?r:t},null)||this.formats.find(t=>t.hasDisplayProperties)}_hidePopup(){this._popupTimeoutId&&(clearTimeout(this._popupTimeoutId),this._popupTimeoutId=null),this._popupVisible=!1,this._popupMessage=null,this.scheduleRender()}_hideClipboardPopup(){this._clipboardPopupTimeoutId&&(clearTimeout(this._clipboardPopupTimeoutId),this._clipboardPopupTimeoutId=null),this._clipboardPopupVisible=!1,this.scheduleRender()}_onConvertComplete(){this._inputVisible=!1,this._coordinateInput.value=""}_onCopy(t){const e=t.currentTarget["data-conversion"].displayCoordinate;t.clipboardData.setData("text/plain",e),this._showClipboardPopup(),t.preventDefault()}_processUserInput(t){const e=J1(t),r=this.viewModel;if(e!=="Enter"&&e)this._badInput&&(this._badInput=!1);else{const i=this._coordinateInput["data-format"],s=this._coordinateInput.value;this._reverseConvert(s,i).then(n=>{this.mode==="capture"?r.resume():this.mode="capture",this.currentLocation=n,r.setLocation(n),this._onConvertComplete()}).catch(n=>{we.getLogger(this.declaredClass).error(n),this._showPopup(this.messages.invalidCoordinate),this._badInput=!0})}}_reverseConvert(t,e){const r=this.viewModel;return e.reverseConvert(t).then(i=>(this._goToEnabled&&r.goToLocation(i).catch(s=>{we.getLogger(this.declaredClass).warn(s),this._showPopup(this.messages.locationOffBasemap)}),i))}_setInputFormat(t){const e=t.target,r=e[e.options.selectedIndex]["data-format"];this._conversionFormat=r}_setPreviewConversion(){const t=this._findSettingsFormat(),e=this.viewModel;if(t){const r=this.conversions.find(i=>i.format===t);this._previewConversion=new $C({format:t,position:{location:this.currentLocation,coordinate:r&&r.position.coordinate}}),this._previewConversion.position.coordinate||e.previewConversion(this._previewConversion)}}_setSettingsFormat(t){const e=t.target,r=e[e.options.selectedIndex]["data-format"];this._settingsFormat=r,this._setPreviewConversion()}_showClipboardPopup(){this._clipboardPopupVisible?clearTimeout(this._clipboardPopupTimeoutId):this._clipboardPopupVisible=!0,this.scheduleRender(),this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=null,this._hideClipboardPopup()},jLt)}_showPopup(t,e=HLt){this._popupMessage=t,this._popupVisible?clearTimeout(this._popupTimeoutId):this._popupVisible=!0,this.scheduleRender(),this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=null,this._hidePopup()},e)}_toggleGoTo(){this._goToEnabled=!this._goToEnabled}_updateCurrentPattern(t){t.stopPropagation();const e=t.target,r=this._findSettingsFormat();r&&(r.currentPattern=e.value)}_renderConversion(t,e){const{messages:r}=this,i=`${this.id}__list-item-${e}`,s=`${t.format.label} ${r.conversionOutputSuffix}`,n=e===0,o=n||this._expanded,a=n?this._renderFirstConversion(t):this._renderTools(e,t,i),l=n&&!t.displayCoordinate?r.noLocation:t.displayCoordinate,c=pe("div",{"aria-label":l,class:It.coordDisplay,"data-conversion":t,role:"listitem",tabindex:"0",title:l},l),h=this._renderOptions(this.formats.filter(p=>p!==t.format));return o?pe("li",{"aria-label":s,class:It.conversionRow,id:i,key:t,role:"group",title:s,tabindex:"0"},pe("select",{"aria-controls":i,"aria-label":r.selectFormat,class:this.classes(It.esriSelect,It.rowSelect),bind:this,"data-index":e,onchange:this._addConversion,title:r.selectFormat},pe("option",{"aria-label":t.format.label,selected:!0,title:t.format.label},t.format.label.toUpperCase()),h),c,a):null}_renderCopyButton(t){const e=this._clipboardPopupVisible&&this._renderClipboardPopup();return pe("li",{"aria-label":this.messagesCommon.copy,bind:this,class:this.classes(It.widgetButton,It.rowButton),"data-conversion":t,onclick:this._copyCoordinateOutput,onkeydown:this._copyCoordinateOutput,oncopy:this._onCopy,role:"button",tabindex:"0",title:this.messagesCommon.copy},e,pe("span",{"aria-hidden":"true",class:It.copyButton}))}_renderFirstConversion(t){const e=this.id,r={[It.expandButton]:!this._expanded,[It.collapseButton]:this._expanded},{messages:i,messagesCommon:s,multipleConversions:n,visibleElements:o}=this,a=this.mode==="live"?i.captureMode:i.liveMode,l=this._expanded?s.collapse:s.expand,c=t.displayCoordinate&&this.mode==="capture"?this._renderCopyButton(t):null,h=n&&o.expandButton&&pe("li",{"aria-controls":`${e}__${It.conversionList}`,"aria-label":l,bind:this,class:It.widgetButton,key:"esri-coordinate-conversion__expand-button",onclick:this._toggleExpand,onkeydown:this._toggleExpand,role:"button",tabindex:"0",title:l},pe("span",{"aria-hidden":"true",class:this.classes(r)})),p=!n&&o.captureButton&&pe("li",{"aria-label":a,bind:this,class:this.classes(It.widgetButton,It.modeToggle),key:"esri-coordinate-conversion__mode-toggle",onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",tabindex:"0",title:a},pe("span",{"aria-hidden":"true",class:It.captureButton}));return pe("ul",{class:It.toolDisplay},c,h,p)}_renderInputForm(){const t=this._conversionFormat||this.conversions.getItemAt(0).format,e=this.formats.findIndex(h=>h.name===t.name),r=this.id,i=`${r}__${It.coordinateInput}`,s=`${r}__${It.coordinateInput}__header`,n=this._renderOptions(this.formats,!0,e),o={[It.rejectInput]:this._badInput},{messages:a,messagesCommon:l,headingLevel:c}=this;return pe("div",{"aria-labelledby":s,class:It.inputForm,key:"esri-coordinate-conversion__input-form",role:"search"},pe("div",{class:It.sectionHeading},pe("div",{"aria-label":l.back,bind:this,class:this.classes(It.widgetButton,It.backButton),onclick:this._toggleInputVisibility,onkeydown:this._toggleInputVisibility,role:"button",tabindex:"0",title:l.back},this._renderBackIcon()),pe(c4,{level:c,class:It.header,id:s},a.inputCoordTitle)),pe("div",{class:It.inputFormGroup},pe("select",{"aria-controls":i,"aria-label":a.selectFormat,bind:this,class:this.classes(It.esriSelect,It.rowSelect),onchange:this._setInputFormat,title:a.selectFormat},n),pe("input",{afterCreate:n4,"aria-labelledby":s,"aria-required":"true",bind:this,class:this.classes(It.coordinateInput,It.input,o),"data-format":t,"data-node-ref":"_coordinateInput",id:i,onkeydown:this._processUserInput,placeholder:a.inputCoordTitle,role:"textbox",spellcheck:!1,title:a.inputCoordTitle,type:"text"})),pe("div",{class:It.inputFormGroup},pe("label",{"aria-label":a.goTo},pe("input",{bind:this,checked:this._goToEnabled,onclick:this._toggleGoTo,title:a.goTo,type:"checkbox"}),a.goTo),pe("button",{"aria-label":a.convert,bind:this,class:this.classes(It.convertButton,It.button),onclick:this._processUserInput,title:a.convert,type:"button"},pe("span",{class:It.convertButtonSpan},a.convert))))}_renderConversionsView(){const t=`${this.id}__${It.conversionList}`,e=this._renderPrimaryTools(),r=this._renderOptions(this.formats),i=this.conversions.map((a,l)=>this._renderConversion(a,l)).toArray(),{messages:s}=this,n=this._expanded?pe("div",{class:It.conversionRow},pe("select",{"aria-controls":t,"aria-label":s.addConversion,bind:this,class:this.classes(It.esriSelect,It.primarySelect),onchange:this._addConversion,title:s.addConversion},pe("option",{disabled:!0,selected:!0,value:""},s.addConversion),r),e):null,o={[It.expanded]:this._expanded,[It.expandUp]:this.orientation==="expand-up",[It.expandDown]:this.orientation==="expand-down"};return pe("div",{class:this.classes(It.conversionsView,o),key:"esri-coordinate-conversion__main-view"},pe("ul",{"aria-expanded":this._expanded?"true":"false",class:It.conversionList,id:t},i),n)}_renderOptions(t,e,r){const i=this.conversions.getItemAt(0);return t.map((s,n)=>{const o=!(e||!i)&&(i.format.name===s.name||this.conversions.map(a=>a.format.name).includes(s.name));return pe("option",{"aria-label":s.label,"data-format":s,disabled:o,key:s.name,selected:n===r,value:s.label},s.label.toUpperCase())}).toArray()}_renderPopup(){return pe("div",{class:It.popup,role:"alert"},this._popupMessage)}_renderClipboardPopup(){return pe("div",{class:this.classes(It.popup,It.clipboardPopup),role:"alert"},this.messages.copySuccessMessage)}_renderPrimaryTools(){const{messages:t,visibleElements:e}=this,r=this.mode==="live"?t.captureMode:t.liveMode,i=e.inputButton&&pe("li",{bind:this,class:It.widgetButton,onclick:this._toggleInputVisibility,onkeydown:this._toggleInputVisibility,role:"button",tabindex:"0",title:t.inputCoordTitle},pe("span",{"aria-hidden":"true",class:It.editButton})),s=e.captureButton&&pe("li",{bind:this,class:this.classes(It.widgetButton,It.modeToggle),onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",tabindex:"0",title:r},pe("span",{"aria-hidden":"true",class:It.captureButton})),n=e.settingsButton&&pe("li",{bind:this,class:It.widgetButton,onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,role:"button",tabindex:"0",title:t.settingsTitle},pe("span",{"aria-hidden":"true",class:It.settingsButton}));return pe("ul",{class:It.toolDisplay},i,s,n)}_renderSettings(){const t=this.id,e=`${t}__${It.patternInput}`,r=`${t}__${It.patternInput}__header`,i=`${t}__${It.previewCoordinate}`,s=this.formats.filter(A=>A.hasDisplayProperties),n=this._findSettingsFormat(),o=s.indexOf(n),a=this._renderOptions(s,!0,o),l=n.get("currentPattern"),{messages:c,messagesCommon:h,headingLevel:p}=this;return pe("div",{"aria-labelledby":r,class:It.settings,key:"esri-coordinate-conversion__settings"},pe("div",{class:It.sectionHeading},pe("div",{bind:this,class:this.classes(It.widgetButton,It.backButton),onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,role:"button",tabindex:"0",title:h.back},this._renderBackIcon()),pe(c4,{level:p,class:It.header,id:r},c.settingsTitle)),pe("div",{class:It.settingsFormGroup},pe("label",{for:e},c.changeCoordinateDisplay),pe("select",{"aria-label":c.selectFormat,class:It.esriSelect,bind:this,onchange:this._setSettingsFormat,title:c.selectFormat},a),pe("div",{class:It.settingsFormGroupHorizontal},pe("input",{"aria-controls":i,bind:this,class:this.classes(It.patternInput,It.input),id:e,oninput:this._updateCurrentPattern,spellcheck:!1,title:c.changeCoordinateDisplay,type:"text",value:l}),pe("div",{"aria-controls":e,bind:this,class:It.widgetButton,onclick:this._setDefaultPattern,onkeydown:this._setDefaultPattern,role:"button",tabindex:"0",title:c.defaultPattern},pe("span",{"aria-hidden":"true",class:It.refresh})))),pe("div",{class:It.settingsFormGroup},pe("label",null,h.preview,pe("div",{class:It.previewCoordinate,id:i,tabindex:"0"},this._previewConversion.displayCoordinate))))}_renderBackIcon(){return pe("span",{"aria-hidden":"true",class:w0(this.container)?It.rightArrow:It.leftArrow})}_renderTools(t,e,r){const i=e.displayCoordinate&&this.mode==="capture"?this._renderCopyButton(e):null,{messages:s}=this;return pe("ul",{class:It.toolDisplay,role:"listitem"},i,pe("li",{"aria-controls":r,"aria-label":s.removeConversion,bind:this,class:this.classes(It.widgetButton,It.rowButton),"data-index":t,key:`${r}__${It.widgetButton}`,onclick:this._removeConversion,onkeydown:this._removeConversion,tabindex:"0",role:"button",title:s.removeConversion},pe("span",{"aria-hidden":"true",class:It.removeConversion})))}_copyCoordinateOutput(t){const e=t.target;if(!("createTextRange"in document.body)){const r=window.getSelection(),i=document.createRange();i.selectNodeContents(e),r.removeAllRanges(),r.addRange(i)}document.execCommand("copy")}_removeConversion(t){const e=t.currentTarget["data-index"];this.conversions.removeAt(e)}_setDefaultPattern(t){t.stopPropagation();const e=this._findSettingsFormat();e&&(e.currentPattern=e.get("defaultPattern"))}_toggleExpand(){this._expanded=!this._expanded}_toggleInputVisibility(){this._inputVisible=!this._inputVisible,this._popupVisible&&this._hidePopup(),this._inputVisible?this.viewModel.pause():this.viewModel.resume()}_toggleMode(){this.mode=this.mode==="live"?"capture":"live"}_toggleSettingsVisibility(){this._settingsVisible=!this._settingsVisible,this._popupVisible&&this._hidePopup(),this._settingsVisible?(this._setPreviewConversion(),this.viewModel.pause()):this.viewModel.resume()}};u([d()],bn.prototype,"conversions",null),u([d()],bn.prototype,"currentLocation",null),u([d()],bn.prototype,"formats",null),u([d()],bn.prototype,"goToOverride",null),u([d()],bn.prototype,"headingLevel",void 0),u([d()],bn.prototype,"label",null),u([d(),Ll("esri/widgets/CoordinateConversion/t9n/CoordinateConversion")],bn.prototype,"messages",void 0),u([d(),Ll("esri/t9n/common")],bn.prototype,"messagesCommon",void 0),u([d()],bn.prototype,"mode",null),u([d()],bn.prototype,"orientation",void 0),u([d()],bn.prototype,"multipleConversions",null),u([d()],bn.prototype,"locationSymbol",null),u([d()],bn.prototype,"storageEnabled",null),u([d()],bn.prototype,"storageType",null),u([d()],bn.prototype,"view",null),u([d({type:TFe})],bn.prototype,"viewModel",void 0),u([d()],bn.prototype,"visibleElements",void 0),u([Hr("visibleElements")],bn.prototype,"castVisibleElements",null),u([rl()],bn.prototype,"_copyCoordinateOutput",null),u([rl()],bn.prototype,"_removeConversion",null),u([rl()],bn.prototype,"_setDefaultPattern",null),u([rl()],bn.prototype,"_toggleExpand",null),u([rl()],bn.prototype,"_toggleInputVisibility",null),u([rl()],bn.prototype,"_toggleMode",null),u([rl()],bn.prototype,"_toggleSettingsVisibility",null),bn=u([j("esri.widgets.CoordinateConversion")],bn);const qLt=bn;var Ab=function(t){t=t||{};var e=typeof t<"u"?t:{},r={},i;for(i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);var s="";function n(Pe){return e.locateFile?e.locateFile(Pe,s):s+Pe}var o;typeof document<"u"&&document.currentScript&&(s=document.currentScript.src),s.indexOf("blob:")!==0?s=s.substr(0,s.lastIndexOf("/")+1):s="",o=function(Ge,dt,Xe){var g=new XMLHttpRequest;g.open("GET",Ge,!0),g.responseType="arraybuffer",g.onload=function(){if(g.status==200||g.status==0&&g.response){dt(g.response);return}var Ci=ss(Ge);if(Ci){dt(Ci.buffer);return}Xe()},g.onerror=Xe,g.send(null)};var a=e.print||console.log.bind(console),l=e.printErr||console.warn.bind(console);for(i in r)r.hasOwnProperty(i)&&(e[i]=r[i]);r=null,e.arguments&&e.arguments;var c=0,h=function(Pe){c=Pe},p=function(){return c},A=8;function _(Pe,Ge,dt,Xe){switch(dt=dt||"i8",dt.charAt(dt.length-1)==="*"&&(dt="i32"),dt){case"i1":re[Pe>>0]=Ge;break;case"i8":re[Pe>>0]=Ge;break;case"i16":ve[Pe>>1]=Ge;break;case"i32":ye[Pe>>2]=Ge;break;case"i64":kt=[Ge>>>0,(yt=Ge,+Jt(yt)>=1?yt>0?(Ir(+xr(yt/4294967296),4294967295)|0)>>>0:~~+Pt((yt-+(~~yt>>>0))/4294967296)>>>0:0)],ye[Pe>>2]=kt[0],ye[Pe+4>>2]=kt[1];break;case"float":le[Pe>>2]=Ge;break;case"double":W[Pe>>3]=Ge;break;default:Ii("invalid type for setValue: "+dt)}}function w(Pe,Ge,dt){switch(Ge=Ge||"i8",Ge.charAt(Ge.length-1)==="*"&&(Ge="i32"),Ge){case"i1":return re[Pe>>0];case"i8":return re[Pe>>0];case"i16":return ve[Pe>>1];case"i32":return ye[Pe>>2];case"i64":return ye[Pe>>2];case"float":return le[Pe>>2];case"double":return W[Pe>>3];default:Ii("invalid type for getValue: "+Ge)}return null}var T=!1;function C(Pe,Ge){Pe||Ii("Assertion failed: "+Ge)}function M(Pe){var Ge=e["_"+Pe];return C(Ge,"Cannot call unknown function "+Pe+", make sure it is exported"),Ge}function O(Pe,Ge,dt,Xe,g){var K={string:function(Dr){var ta=0;if(Dr!=null&&Dr!==0){var Yh=(Dr.length<<2)+1;ta=bo(Yh),z(Dr,ta,Yh)}return ta},array:function(Dr){var ta=bo(Dr.length);return Z(Dr,ta),ta}};function Ci(Dr){return Ge==="string"?F(Dr):Ge==="boolean"?!!Dr:Dr}var vs=M(Pe),bs=[],Wr=0;if(Xe)for(var vi=0;vi<Xe.length;vi++){var _r=K[dt[vi]];_r?(Wr===0&&(Wr=Vs()),bs[vi]=_r(Xe[vi])):bs[vi]=Xe[vi]}var hs=vs.apply(null,bs);return hs=Ci(hs),Wr!==0&&yn(Wr),hs}function $(Pe,Ge,dt,Xe){dt=dt||[];var g=dt.every(function(Ci){return Ci==="number"}),K=Ge!=="string";return K&&g&&!Xe?M(Pe):function(){return O(Pe,Ge,dt,arguments)}}var L=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function k(Pe,Ge,dt){for(var Xe=Ge+dt,g=Ge;Pe[g]&&!(g>=Xe);)++g;if(g-Ge>16&&Pe.subarray&&L)return L.decode(Pe.subarray(Ge,g));for(var K="";Ge<g;){var Ci=Pe[Ge++];if(!(Ci&128)){K+=String.fromCharCode(Ci);continue}var vs=Pe[Ge++]&63;if((Ci&224)==192){K+=String.fromCharCode((Ci&31)<<6|vs);continue}var bs=Pe[Ge++]&63;if((Ci&240)==224?Ci=(Ci&15)<<12|vs<<6|bs:Ci=(Ci&7)<<18|vs<<12|bs<<6|Pe[Ge++]&63,Ci<65536)K+=String.fromCharCode(Ci);else{var Wr=Ci-65536;K+=String.fromCharCode(55296|Wr>>10,56320|Wr&1023)}}return K}function F(Pe,Ge){return Pe?k(Ae,Pe,Ge):""}function G(Pe,Ge,dt,Xe){if(!(Xe>0))return 0;for(var g=dt,K=dt+Xe-1,Ci=0;Ci<Pe.length;++Ci){var vs=Pe.charCodeAt(Ci);if(vs>=55296&&vs<=57343){var bs=Pe.charCodeAt(++Ci);vs=65536+((vs&1023)<<10)|bs&1023}if(vs<=127){if(dt>=K)break;Ge[dt++]=vs}else if(vs<=2047){if(dt+1>=K)break;Ge[dt++]=192|vs>>6,Ge[dt++]=128|vs&63}else if(vs<=65535){if(dt+2>=K)break;Ge[dt++]=224|vs>>12,Ge[dt++]=128|vs>>6&63,Ge[dt++]=128|vs&63}else{if(dt+3>=K)break;Ge[dt++]=240|vs>>18,Ge[dt++]=128|vs>>12&63,Ge[dt++]=128|vs>>6&63,Ge[dt++]=128|vs&63}}return Ge[dt]=0,dt-g}function z(Pe,Ge,dt){return G(Pe,Ae,Ge,dt)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function Z(Pe,Ge){re.set(Pe,Ge)}function J(Pe,Ge){return Pe%Ge>0&&(Pe+=Ge-Pe%Ge),Pe}var te,re,Ae,ve,ye,le,W;function q(Pe){te=Pe,e.HEAP8=re=new Int8Array(Pe),e.HEAP16=ve=new Int16Array(Pe),e.HEAP32=ye=new Int32Array(Pe),e.HEAPU8=Ae=new Uint8Array(Pe),e.HEAPU16=new Uint16Array(Pe),e.HEAPU32=new Uint32Array(Pe),e.HEAPF32=le=new Float32Array(Pe),e.HEAPF64=W=new Float64Array(Pe)}var X=5267040,se=24128,ae=e.TOTAL_MEMORY||33554432;e.buffer?te=e.buffer:te=new ArrayBuffer(ae),ae=te.byteLength,q(te),ye[se>>2]=X;function fe(Pe){for(;Pe.length>0;){var Ge=Pe.shift();if(typeof Ge=="function"){Ge();continue}var dt=Ge.func;typeof dt=="number"?Ge.arg===void 0?e.dynCall_v(dt):e.dynCall_vi(dt,Ge.arg):dt(Ge.arg===void 0?null:Ge.arg)}}var ue=[],Re=[],De=[],Ue=[];function Je(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)ut(e.preRun.shift());fe(ue)}function vt(){fe(Re)}function lt(){fe(De)}function Ye(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)ht(e.postRun.shift());fe(Ue)}function ut(Pe){ue.unshift(Pe)}function ht(Pe){Ue.unshift(Pe)}var Jt=Math.abs,Pt=Math.ceil,xr=Math.floor,Ir=Math.min,Tr=0,Er=null;function ei(Pe){Tr++,e.monitorRunDependencies&&e.monitorRunDependencies(Tr)}function zi(Pe){if(Tr--,e.monitorRunDependencies&&e.monitorRunDependencies(Tr),Tr==0&&Er){var Ge=Er;Er=null,Ge()}}e.preloadedImages={},e.preloadedAudios={};var Lr=null,ti="data:application/octet-stream;base64,";function Ft(Pe){return String.prototype.startsWith?Pe.startsWith(ti):Pe.indexOf(ti)===0}var yt,kt;Lr="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var jt=24144;function tr(Pe){return Pe}function Or(Pe){var Ge=/\b__Z[\w\d_]+/g;return Pe.replace(Ge,function(dt){var Xe=dt;return dt===Xe?dt:Xe+" ["+dt+"]"})}function yi(){var Pe=new Error;if(!Pe.stack){try{throw new Error(0)}catch(Ge){Pe=Ge}if(!Pe.stack)return"(no stack trace available)"}return Pe.stack.toString()}function bi(){var Pe=yi();return e.extraStackTrace&&(Pe+=`
`+e.extraStackTrace()),Or(Pe)}function wi(Pe,Ge,dt,Xe){Ii("Assertion failed: "+F(Pe)+", at: "+[Ge?F(Ge):"unknown filename",dt,Xe?F(Xe):"unknown function"])}function _i(){return re.length}function _s(Pe,Ge,dt){Ae.set(Ae.subarray(Ge,Ge+dt),Pe)}function kr(Pe){return e.___errno_location&&(ye[e.___errno_location()>>2]=Pe),Pe}function ni(Pe){Ii("OOM")}function qr(Pe){try{var Ge=new ArrayBuffer(Pe);return Ge.byteLength!=Pe?void 0:(new Int8Array(Ge).set(re),Ko(Ge),q(Ge),1)}catch{}}function An(Pe){var Ge=_i(),dt=16777216,Xe=2147483648-dt;if(Pe>Xe)return!1;for(var g=16777216,K=Math.max(Ge,g);K<Pe;)K<=536870912?K=J(2*K,dt):K=Math.min(J((3*K+2147483648)/4,dt),Xe);var Ci=qr(K);return!!Ci}var rs=typeof atob=="function"?atob:function(Pe){var Ge="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",dt="",Xe,g,K,Ci,vs,bs,Wr,vi=0;Pe=Pe.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Ci=Ge.indexOf(Pe.charAt(vi++)),vs=Ge.indexOf(Pe.charAt(vi++)),bs=Ge.indexOf(Pe.charAt(vi++)),Wr=Ge.indexOf(Pe.charAt(vi++)),Xe=Ci<<2|vs>>4,g=(vs&15)<<4|bs>>2,K=(bs&3)<<6|Wr,dt=dt+String.fromCharCode(Xe),bs!==64&&(dt=dt+String.fromCharCode(g)),Wr!==64&&(dt=dt+String.fromCharCode(K));while(vi<Pe.length);return dt};function Us(Pe){try{for(var Ge=rs(Pe),dt=new Uint8Array(Ge.length),Xe=0;Xe<Ge.length;++Xe)dt[Xe]=Ge.charCodeAt(Xe);return dt}catch{throw new Error("Converting base64 string to bytes failed.")}}function ss(Pe){if(Ft(Pe))return Us(Pe.slice(ti.length))}var Ls={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},on={a:Ii,b:h,c:p,d:wi,e:kr,f:_i,g:_s,h:An,i:ni,j:tr,k:Or,l:qr,m:yi,n:bi,o:jt,p:se},Ze=function(Pe,Ge,dt){var Xe=new Pe.Int8Array(dt),g=new Pe.Int32Array(dt);new Pe.Uint8Array(dt),new Pe.Float32Array(dt);var K=new Pe.Float64Array(dt),Ci=Ge.o|0,vs=Ge.p|0,bs=Pe.Math.floor,Wr=Pe.Math.abs,vi=Pe.Math.sqrt,_r=Pe.Math.pow,hs=Pe.Math.cos,Dr=Pe.Math.sin,ta=Pe.Math.tan,Yh=Pe.Math.acos,_a=Pe.Math.asin,Ac=Pe.Math.atan,Kn=Pe.Math.atan2,Mi=Pe.Math.ceil,ra=Pe.Math.imul,Qh=Pe.Math.min,d_=Pe.Math.max,ru=Pe.Math.clz32,Yr=Ge.b,oe=Ge.c,vr=Ge.d,ml=Ge.e,LT=Ge.f,Db=Ge.g,he=Ge.h,je=Ge.i,H=24160;function Qr(m){return Xe=new Int8Array(m),g=new Int32Array(m),K=new Float64Array(m),dt=m,!0}function Lo(m){m=m|0;var f=0;return f=H,H=H+m|0,H=H+15&-16,f|0}function _n(){return H|0}function kl(m){m=m|0,H=m}function em(m,f){m=m|0,H=m}function rD(m,f){m=m|0,f=f|0;var y=0,v=0,x=0;return(m|0)<0?(f=2,f|0):(m|0)>13780509?(f=mV(15,f)|0,f|0):(y=((m|0)<0)<<31>>31,x=vc(m|0,y|0,3,0)|0,v=oe()|0,y=Gi(m|0,y|0,1,0)|0,y=vc(x|0,v|0,y|0,oe()|0)|0,y=Gi(y|0,oe()|0,1,0)|0,m=oe()|0,g[f>>2]=y,g[f+4>>2]=m,f=0,f|0)}function oR(m,f,y,v){return m=m|0,f=f|0,y=y|0,v=v|0,aR(m,f,y,v,0)|0}function aR(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0,U=0;if(D=H,H=H+16|0,R=D,!(DT(m,f,y,v,x)|0))return v=0,H=D,v|0;do if((y|0)>=0){if((y|0)>13780509){if(S=mV(15,R)|0,S|0)break;P=R,R=g[P>>2]|0,P=g[P+4>>2]|0}else S=((y|0)<0)<<31>>31,U=vc(y|0,S|0,3,0)|0,P=oe()|0,S=Gi(y|0,S|0,1,0)|0,S=vc(U|0,P|0,S|0,oe()|0)|0,S=Gi(S|0,oe()|0,1,0)|0,P=oe()|0,g[R>>2]=S,g[R+4>>2]=P,R=S;if(Vb(v|0,0,R<<3|0)|0,x|0){Vb(x|0,0,R<<2|0)|0,S=eA(m,f,y,v,x,R,P,0)|0;break}S=rm(R,4)|0,S?(U=eA(m,f,y,v,S,R,P,0)|0,oi(S),S=U):S=13}else S=2;while(0);return U=S,H=D,U|0}function DT(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0;if(Ce=H,H=H+16|0,_e=Ce,de=Ce+8|0,ge=_e,g[ge>>2]=m,g[ge+4>>2]=f,(y|0)<0)return de=2,H=Ce,de|0;if(S=v,g[S>>2]=m,g[S+4>>2]=f,S=(x|0)!=0,S&&(g[x>>2]=0),Un(m,f)|0)return de=9,H=Ce,de|0;g[de>>2]=0;e:do if((y|0)>=1)if(S)for(Y=1,U=0,ne=0,ge=1,S=m;;){if(!(U|ne)){if(S=gl(S,f,4,de,_e)|0,S|0)break e;if(f=_e,S=g[f>>2]|0,f=g[f+4>>2]|0,Un(S,f)|0){S=9;break e}}if(S=gl(S,f,g[22384+(ne<<2)>>2]|0,de,_e)|0,S|0)break e;if(f=_e,S=g[f>>2]|0,f=g[f+4>>2]|0,m=v+(Y<<3)|0,g[m>>2]=S,g[m+4>>2]=f,g[x+(Y<<2)>>2]=ge,m=U+1|0,R=(m|0)==(ge|0),P=ne+1|0,D=(P|0)==6,Un(S,f)|0){S=9;break e}if(ge=ge+(D&R&1)|0,(ge|0)>(y|0)){S=0;break}else Y=Y+1|0,U=R?0:m,ne=R?D?0:P:ne}else for(Y=1,U=0,ne=0,ge=1,S=m;;){if(!(U|ne)){if(S=gl(S,f,4,de,_e)|0,S|0)break e;if(f=_e,S=g[f>>2]|0,f=g[f+4>>2]|0,Un(S,f)|0){S=9;break e}}if(S=gl(S,f,g[22384+(ne<<2)>>2]|0,de,_e)|0,S|0)break e;if(f=_e,S=g[f>>2]|0,f=g[f+4>>2]|0,m=v+(Y<<3)|0,g[m>>2]=S,g[m+4>>2]=f,m=U+1|0,R=(m|0)==(ge|0),P=ne+1|0,D=(P|0)==6,Un(S,f)|0){S=9;break e}if(ge=ge+(D&R&1)|0,(ge|0)>(y|0)){S=0;break}else Y=Y+1|0,U=R?0:m,ne=R?D?0:P:ne}else S=0;while(0);return de=S,H=Ce,de|0}function eA(m,f,y,v,x,S,R,P){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0,S=S|0,R=R|0,P=P|0;var D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0;if(Ce=H,H=H+16|0,_e=Ce+8|0,de=Ce,D=BT(m|0,f|0,S|0,R|0)|0,Y=oe()|0,ne=v+(D<<3)|0,We=ne,Ve=g[We>>2]|0,We=g[We+4>>2]|0,U=(Ve|0)==(m|0)&(We|0)==(f|0),!((Ve|0)==0&(We|0)==0|U))do D=Gi(D|0,Y|0,1,0)|0,D=lD(D|0,oe()|0,S|0,R|0)|0,Y=oe()|0,ne=v+(D<<3)|0,Ve=ne,We=g[Ve>>2]|0,Ve=g[Ve+4>>2]|0,U=(We|0)==(m|0)&(Ve|0)==(f|0);while(!((We|0)==0&(Ve|0)==0|U));if(D=x+(D<<2)|0,U&&(g[D>>2]|0)<=(P|0)||(Ve=ne,g[Ve>>2]=m,g[Ve+4>>2]=f,g[D>>2]=P,(P|0)>=(y|0)))return Ve=0,H=Ce,Ve|0;switch(U=P+1|0,g[_e>>2]=0,D=gl(m,f,2,_e,de)|0,D|0){case 9:{ge=9;break}case 0:{D=de,D=eA(g[D>>2]|0,g[D+4>>2]|0,y,v,x,S,R,U)|0,D||(ge=9);break}}e:do if((ge|0)==9){switch(g[_e>>2]=0,D=gl(m,f,3,_e,de)|0,D|0){case 9:break;case 0:{if(D=de,D=eA(g[D>>2]|0,g[D+4>>2]|0,y,v,x,S,R,U)|0,D|0)break e;break}default:break e}switch(g[_e>>2]=0,D=gl(m,f,1,_e,de)|0,D|0){case 9:break;case 0:{if(D=de,D=eA(g[D>>2]|0,g[D+4>>2]|0,y,v,x,S,R,U)|0,D|0)break e;break}default:break e}switch(g[_e>>2]=0,D=gl(m,f,5,_e,de)|0,D|0){case 9:break;case 0:{if(D=de,D=eA(g[D>>2]|0,g[D+4>>2]|0,y,v,x,S,R,U)|0,D|0)break e;break}default:break e}switch(g[_e>>2]=0,D=gl(m,f,4,_e,de)|0,D|0){case 9:break;case 0:{if(D=de,D=eA(g[D>>2]|0,g[D+4>>2]|0,y,v,x,S,R,U)|0,D|0)break e;break}default:break e}switch(g[_e>>2]=0,D=gl(m,f,6,_e,de)|0,D|0){case 9:break;case 0:{if(D=de,D=eA(g[D>>2]|0,g[D+4>>2]|0,y,v,x,S,R,U)|0,D|0)break e;break}default:break e}return Ve=0,H=Ce,Ve|0}while(0);return Ve=D,H=Ce,Ve|0}function gl(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0;if(y>>>0>6)return x=1,x|0;if(ne=(g[v>>2]|0)%6|0,g[v>>2]=ne,(ne|0)>0){S=0;do y=kb(y)|0,S=S+1|0;while((S|0)<(g[v>>2]|0))}if(ne=at(m|0,f|0,45)|0,oe()|0,Y=ne&127,Y>>>0>121)return x=5,x|0;D=Qu(m,f)|0,S=at(m|0,f|0,52)|0,oe()|0,S=S&15;e:do if(!S)U=8;else{for(;;){if(R=(15-S|0)*3|0,P=at(m|0,f|0,R|0)|0,oe()|0,P=P&7,(P|0)==7){f=5;break}if(de=(Jd(S)|0)==0,S=S+-1|0,ge=Et(7,0,R|0)|0,f=f&~(oe()|0),_e=Et(g[(de?432:16)+(P*28|0)+(y<<2)>>2]|0,0,R|0)|0,R=oe()|0,y=g[(de?640:224)+(P*28|0)+(y<<2)>>2]|0,m=_e|m&~ge,f=R|f,!y){y=0;break e}if(!S){U=8;break e}}return f|0}while(0);(U|0)==8&&(de=g[848+(Y*28|0)+(y<<2)>>2]|0,_e=Et(de|0,0,45)|0,m=_e|m,f=oe()|0|f&-1040385,y=g[4272+(Y*28|0)+(y<<2)>>2]|0,(de&127|0)==127&&(de=Et(g[848+(Y*28|0)+20>>2]|0,0,45)|0,f=oe()|0|f&-1040385,y=g[4272+(Y*28|0)+20>>2]|0,m=Bb(de|m,f)|0,f=oe()|0,g[v>>2]=(g[v>>2]|0)+1)),P=at(m|0,f|0,45)|0,oe()|0,P=P&127;e:do if(Bn(P)|0){t:do if((Qu(m,f)|0)==1){if((Y|0)!=(P|0))if(Boe(P,g[7696+(Y*28|0)>>2]|0)|0){m=dV(m,f)|0,R=1,f=oe()|0;break}else vr(23313,22416,436,22424);switch(D|0){case 3:{m=Bb(m,f)|0,f=oe()|0,g[v>>2]=(g[v>>2]|0)+1,R=0;break t}case 5:{m=dV(m,f)|0,f=oe()|0,g[v>>2]=(g[v>>2]|0)+5,R=0;break t}case 0:return de=9,de|0;default:return de=1,de|0}}else R=0;while(0);if((y|0)>0){S=0;do m=hV(m,f)|0,f=oe()|0,S=S+1|0;while((S|0)!=(y|0))}if((Y|0)!=(P|0)){if(!(rV(P)|0)){if((R|0)!=0|(Qu(m,f)|0)!=5)break;g[v>>2]=(g[v>>2]|0)+1;break}switch(ne&127){case 8:case 118:break e}(Qu(m,f)|0)!=3&&(g[v>>2]=(g[v>>2]|0)+1)}}else if((y|0)>0){S=0;do m=Bb(m,f)|0,f=oe()|0,S=S+1|0;while((S|0)!=(y|0))}while(0);return g[v>>2]=((g[v>>2]|0)+y|0)%6|0,de=x,g[de>>2]=m,g[de+4>>2]=f,de=0,de|0}function tV(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0,U=0;for(P=H,H=H+16|0,S=P,R=P+8|0,x=(Un(m,f)|0)==0,x=x?1:2;;){if(g[R>>2]=0,U=(gl(m,f,x,R,S)|0)==0,D=S,U&((g[D>>2]|0)==(y|0)?(g[D+4>>2]|0)==(v|0):0)){m=4;break}if(x=x+1|0,x>>>0>=7){x=7,m=4;break}}return(m|0)==4?(H=P,x|0):0}function SFe(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0;if(de=H,H=H+16|0,ge=de,_e=de+8|0,ne=ge,g[ne>>2]=m,g[ne+4>>2]=f,!y)return _e=v,g[_e>>2]=m,g[_e+4>>2]=f,_e=0,H=de,_e|0;g[_e>>2]=0;e:do if(Un(m,f)|0)m=9;else{if(S=(y|0)>0,S){x=0,ne=m;do{if(m=gl(ne,f,4,_e,ge)|0,m|0)break e;if(f=ge,ne=g[f>>2]|0,f=g[f+4>>2]|0,x=x+1|0,Un(ne,f)|0){m=9;break e}}while((x|0)<(y|0));if(Y=v,g[Y>>2]=ne,g[Y+4>>2]=f,Y=y+-1|0,S){U=0,m=1;do{if(x=22384+(U<<2)|0,(U|0)==5)for(R=g[x>>2]|0,S=0,x=m;;){if(m=ge,m=gl(g[m>>2]|0,g[m+4>>2]|0,R,_e,ge)|0,m|0)break e;if((S|0)!=(Y|0))if(D=ge,P=g[D>>2]|0,D=g[D+4>>2]|0,m=v+(x<<3)|0,g[m>>2]=P,g[m+4>>2]=D,!(Un(P,D)|0))m=x+1|0;else{m=9;break e}else m=x;if(S=S+1|0,(S|0)>=(y|0))break;x=m}else for(R=ge,D=g[x>>2]|0,P=0,x=m,S=g[R>>2]|0,R=g[R+4>>2]|0;;){if(m=gl(S,R,D,_e,ge)|0,m|0)break e;if(R=ge,S=g[R>>2]|0,R=g[R+4>>2]|0,m=v+(x<<3)|0,g[m>>2]=S,g[m+4>>2]=R,m=x+1|0,Un(S,R)|0){m=9;break e}if(P=P+1|0,(P|0)>=(y|0))break;x=m}U=U+1|0}while(U>>>0<6);m=ge,R=ne,x=g[m>>2]|0,S=f,m=g[m+4>>2]|0}else R=ne,x=ne,S=f,m=f}else R=v,g[R>>2]=m,g[R+4>>2]=f,R=m,x=m,S=f,m=f;m=(R|0)==(x|0)&(S|0)==(m|0)?0:9}while(0);return _e=m,H=de,_e|0}function EFe(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0,U=0;if(P=H,H=H+48|0,x=P+16|0,S=P+8|0,R=P,y|0)return R=15,H=P,R|0;if(U=m,D=g[U+4>>2]|0,y=S,g[y>>2]=g[U>>2],g[y+4>>2]=D,lae(S,x),f=zoe(x,f,R)|0,!f){if(y=g[S>>2]|0,S=g[m+8>>2]|0,(S|0)>0){x=g[m+12>>2]|0,f=0;do y=(g[x+(f<<3)>>2]|0)+y|0,f=f+1|0;while((f|0)<(S|0))}f=R,x=g[f>>2]|0,f=g[f+4>>2]|0,S=((y|0)<0)<<31>>31,(f|0)<(S|0)|(f|0)==(S|0)&x>>>0<y>>>0?(f=R,g[f>>2]=y,g[f+4>>2]=S,f=S):y=x,D=Gi(y|0,f|0,12,0)|0,U=oe()|0,f=R,g[f>>2]=D,g[f+4>>2]=U,f=v,g[f>>2]=D,g[f+4>>2]=U,f=0}return U=f,H=P,U|0}function Foe(m,f,y,v,x,S,R){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0,S=S|0,R=R|0;var P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0,Fe=0,Ee=0,$t=0,Yt=0,wt=0,Lt=0,zs=0,ds=0,ws=0,xi=0,Ai=0,Ti=0,ln=0,ai=0,Mn=0,su=0,_ae=0;if(ln=H,H=H+64|0,ws=ln+48|0,xi=ln+32|0,Ai=ln+24|0,$t=ln+8|0,Yt=ln,D=g[m>>2]|0,(D|0)<=0)return Ti=0,H=ln,Ti|0;for(wt=m+4|0,Lt=ws+8|0,zs=xi+8|0,ds=$t+8|0,P=0,Fe=0;;){U=g[wt>>2]|0,Ne=U+(Fe<<4)|0,g[ws>>2]=g[Ne>>2],g[ws+4>>2]=g[Ne+4>>2],g[ws+8>>2]=g[Ne+8>>2],g[ws+12>>2]=g[Ne+12>>2],(Fe|0)==(D+-1|0)?(g[xi>>2]=g[U>>2],g[xi+4>>2]=g[U+4>>2],g[xi+8>>2]=g[U+8>>2],g[xi+12>>2]=g[U+12>>2]):(Ne=U+(Fe+1<<4)|0,g[xi>>2]=g[Ne>>2],g[xi+4>>2]=g[Ne+4>>2],g[xi+8>>2]=g[Ne+8>>2],g[xi+12>>2]=g[Ne+12>>2]),D=DFe(ws,xi,v,Ai)|0;e:do if(D)U=0,P=D;else if(U=Ai,D=g[U>>2]|0,U=g[U+4>>2]|0,(U|0)>0|(U|0)==0&D>>>0>0){Ve=0,Ne=0;t:for(;;){if(_ae=+K[ws>>3],We=_c(D|0,U|0,Ve|0,Ne|0)|0,su=+(We>>>0)+4294967296*+(oe()|0),ai=+(D>>>0)+4294967296*+(U|0),Mn=+(Ve>>>0)+4294967296*+(Ne|0),K[$t>>3]=_ae*su/ai+ +K[xi>>3]*Mn/ai,K[ds>>3]=+K[Lt>>3]*su/ai+ +K[zs>>3]*Mn/ai,D=Koe($t,v,Yt)|0,D|0){P=D;break}We=Yt,Ce=g[We>>2]|0,We=g[We+4>>2]|0,ge=BT(Ce|0,We|0,f|0,y|0)|0,Y=oe()|0,D=R+(ge<<3)|0,ne=D,U=g[ne>>2]|0,ne=g[ne+4>>2]|0;r:do if((U|0)==0&(ne|0)==0)Ee=D,Ti=16;else for(_e=0,de=0;;){if((_e|0)>(y|0)|(_e|0)==(y|0)&de>>>0>f>>>0){P=1;break t}if((U|0)==(Ce|0)&(ne|0)==(We|0))break r;if(D=Gi(ge|0,Y|0,1,0)|0,ge=lD(D|0,oe()|0,f|0,y|0)|0,Y=oe()|0,de=Gi(de|0,_e|0,1,0)|0,_e=oe()|0,D=R+(ge<<3)|0,ne=D,U=g[ne>>2]|0,ne=g[ne+4>>2]|0,(U|0)==0&(ne|0)==0){Ee=D,Ti=16;break}}while(0);if((Ti|0)==16&&(Ti=0,!((Ce|0)==0&(We|0)==0))&&(de=Ee,g[de>>2]=Ce,g[de+4>>2]=We,de=S+(g[x>>2]<<3)|0,g[de>>2]=Ce,g[de+4>>2]=We,de=x,de=Gi(g[de>>2]|0,g[de+4>>2]|0,1,0)|0,Ce=oe()|0,We=x,g[We>>2]=de,g[We+4>>2]=Ce),Ve=Gi(Ve|0,Ne|0,1,0)|0,Ne=oe()|0,U=Ai,D=g[U>>2]|0,U=g[U+4>>2]|0,!((U|0)>(Ne|0)|(U|0)==(Ne|0)&D>>>0>Ve>>>0)){U=1;break e}}U=0}else U=1;while(0);if(Fe=Fe+1|0,!U){Ti=21;break}if(D=g[m>>2]|0,(Fe|0)>=(D|0)){P=0,Ti=21;break}}return(Ti|0)==21?(H=ln,P|0):0}function CFe(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0,Fe=0,Ee=0,$t=0,Yt=0,wt=0,Lt=0,zs=0,ds=0,ws=0,xi=0,Ai=0,Ti=0,ln=0,ai=0,Mn=0,su=0;if(su=H,H=H+112|0,Ti=su+80|0,D=su+72|0,ln=su,ai=su+56|0,y|0)return Mn=15,H=su,Mn|0;if(U=m+8|0,Mn=tm((g[U>>2]<<5)+32|0)|0,!Mn)return Mn=13,H=su,Mn|0;if(F6e(m,Mn),xi=m,Ai=g[xi+4>>2]|0,y=D,g[y>>2]=g[xi>>2],g[y+4>>2]=Ai,lae(D,Ti),y=zoe(Ti,f,ln)|0,y)xi=0,Ai=0;else{if(y=g[D>>2]|0,S=g[U>>2]|0,(S|0)>0){R=g[m+12>>2]|0,x=0;do y=(g[R+(x<<3)>>2]|0)+y|0,x=x+1|0;while((x|0)!=(S|0));x=y}else x=y;y=ln,S=g[y>>2]|0,y=g[y+4>>2]|0,R=((x|0)<0)<<31>>31,(y|0)<(R|0)|(y|0)==(R|0)&S>>>0<x>>>0?(y=ln,g[y>>2]=x,g[y+4>>2]=R,y=R):x=S,xi=Gi(x|0,y|0,12,0)|0,Ai=oe()|0,y=ln,g[y>>2]=xi,g[y+4>>2]=Ai,y=0}if(y|0)return oi(Mn),Mn=y,H=su,Mn|0;if(x=rm(xi,8)|0,!x)return oi(Mn),Mn=13,H=su,Mn|0;if(P=rm(xi,8)|0,!P)return oi(Mn),oi(x),Mn=13,H=su,Mn|0;ds=Ti,g[ds>>2]=0,g[ds+4>>2]=0,ds=m,ws=g[ds+4>>2]|0,y=D,g[y>>2]=g[ds>>2],g[y+4>>2]=ws,y=Foe(D,xi,Ai,f,Ti,x,P)|0;e:do if(y)oi(x),oi(P),oi(Mn);else{t:do if((g[U>>2]|0)>0){for(R=m+12|0,S=0;y=Foe((g[R>>2]|0)+(S<<3)|0,xi,Ai,f,Ti,x,P)|0,S=S+1|0,!(y|0);)if((S|0)>=(g[U>>2]|0))break t;oi(x),oi(P),oi(Mn);break e}while(0);(Ai|0)>0|(Ai|0)==0&xi>>>0>0&&Vb(P|0,0,xi<<3|0)|0,ws=Ti,ds=g[ws+4>>2]|0;t:do if((ds|0)>0|(ds|0)==0&(g[ws>>2]|0)>>>0>0){wt=x,Lt=P,zs=x,ds=P,ws=x,y=x,Ee=x,$t=P,Yt=P,x=P;r:for(;;){for(We=0,Ve=0,Ne=0,Fe=0,S=0,R=0;;){P=ln,D=P+56|0;do g[P>>2]=0,P=P+4|0;while((P|0)<(D|0));if(f=wt+(We<<3)|0,U=g[f>>2]|0,f=g[f+4>>2]|0,DT(U,f,1,ln,0)|0){P=ln,D=P+56|0;do g[P>>2]=0,P=P+4|0;while((P|0)<(D|0));P=rm(7,4)|0,P|0&&(eA(U,f,1,ln,P,7,0,0)|0,oi(P))}for(Ce=0;;){de=ln+(Ce<<3)|0,_e=g[de>>2]|0,de=g[de+4>>2]|0;i:do if((_e|0)==0&(de|0)==0)P=S,D=R;else{if(Y=BT(_e|0,de|0,xi|0,Ai|0)|0,U=oe()|0,P=v+(Y<<3)|0,f=P,D=g[f>>2]|0,f=g[f+4>>2]|0,!((D|0)==0&(f|0)==0)){ne=0,ge=0;do{if((ne|0)>(Ai|0)|(ne|0)==(Ai|0)&ge>>>0>xi>>>0)break r;if((D|0)==(_e|0)&(f|0)==(de|0)){P=S,D=R;break i}P=Gi(Y|0,U|0,1,0)|0,Y=lD(P|0,oe()|0,xi|0,Ai|0)|0,U=oe()|0,ge=Gi(ge|0,ne|0,1,0)|0,ne=oe()|0,P=v+(Y<<3)|0,f=P,D=g[f>>2]|0,f=g[f+4>>2]|0}while(!((D|0)==0&(f|0)==0))}(_e|0)==0&(de|0)==0?(P=S,D=R):(cR(_e,de,ai)|0,k6e(m,Mn,ai)|0&&(ge=Gi(S|0,R|0,1,0)|0,R=oe()|0,ne=P,g[ne>>2]=_e,g[ne+4>>2]=de,S=Lt+(S<<3)|0,g[S>>2]=_e,g[S+4>>2]=de,S=ge),P=S,D=R)}while(0);if(Ce=Ce+1|0,Ce>>>0>=7)break;S=P,R=D}if(We=Gi(We|0,Ve|0,1,0)|0,Ve=oe()|0,Ne=Gi(Ne|0,Fe|0,1,0)|0,Fe=oe()|0,R=Ti,S=g[R>>2]|0,R=g[R+4>>2]|0,(Fe|0)<(R|0)|(Fe|0)==(R|0)&Ne>>>0<S>>>0)S=P,R=D;else break}if((R|0)>0|(R|0)==0&S>>>0>0){S=0,R=0;do Fe=wt+(S<<3)|0,g[Fe>>2]=0,g[Fe+4>>2]=0,S=Gi(S|0,R|0,1,0)|0,R=oe()|0,Fe=Ti,Ne=g[Fe+4>>2]|0;while((R|0)<(Ne|0)|((R|0)==(Ne|0)?S>>>0<(g[Fe>>2]|0)>>>0:0))}if(Fe=Ti,g[Fe>>2]=P,g[Fe+4>>2]=D,(D|0)>0|(D|0)==0&P>>>0>0)Ce=x,We=Yt,Ve=ws,Ne=$t,Fe=Lt,x=Ee,Yt=y,$t=zs,Ee=Ce,y=We,ws=ds,ds=Ve,zs=Ne,Lt=wt,wt=Fe;else break t}oi(zs),oi(ds),oi(Mn),y=1;break e}else y=P;while(0);oi(Mn),oi(x),oi(y),y=0}while(0);return Mn=y,H=su,Mn|0}function MFe(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0;if(Y=H,H=H+176|0,D=Y,(f|0)<1)return hae(y,0,0),U=0,H=Y,U|0;for(P=m,P=at(g[P>>2]|0,g[P+4>>2]|0,52)|0,oe()|0,hae(y,(f|0)>6?f:6,P&15),P=0;v=m+(P<<3)|0,v=uR(g[v>>2]|0,g[v+4>>2]|0,D)|0,!(v|0);){if(v=g[D>>2]|0,(v|0)>0){R=0;do S=D+8+(R<<4)|0,R=R+1|0,v=D+8+(((R|0)%(v|0)|0)<<4)|0,x=e8e(y,v,S)|0,x?fae(y,x)|0:K6e(y,S,v)|0,v=g[D>>2]|0;while((R|0)<(v|0))}if(P=P+1|0,(P|0)>=(f|0)){v=0,U=13;break}}return(U|0)==13?(H=Y,v|0):(dae(y),U=v,H=Y,U|0)}function RFe(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0;if(S=H,H=H+32|0,v=S,x=S+16|0,m=MFe(m,f,x)|0,m|0)return y=m,H=S,y|0;if(g[y>>2]=0,g[y+4>>2]=0,g[y+8>>2]=0,m=pae(x)|0,m|0)do{f=R6e(y)|0;do O6e(f,m)|0,R=m+16|0,g[v>>2]=g[R>>2],g[v+4>>2]=g[R+4>>2],g[v+8>>2]=g[R+8>>2],g[v+12>>2]=g[R+12>>2],fae(x,m)|0,m=t8e(x,v)|0;while(m|0);m=pae(x)|0}while(m|0);return dae(x),m=P6e(y)|0,m?(sae(y),R=m,H=S,R|0):(R=0,H=S,R|0)}function Bn(m){return m=m|0,m>>>0>121?(m=0,m|0):(m=g[7696+(m*28|0)+16>>2]|0,m|0)}function rV(m){return m=m|0,(m|0)==4|(m|0)==117|0}function koe(m){return m=m|0,g[11120+((g[m>>2]|0)*216|0)+((g[m+4>>2]|0)*72|0)+((g[m+8>>2]|0)*24|0)+(g[m+12>>2]<<3)>>2]|0}function OFe(m){return m=m|0,g[11120+((g[m>>2]|0)*216|0)+((g[m+4>>2]|0)*72|0)+((g[m+8>>2]|0)*24|0)+(g[m+12>>2]<<3)+4>>2]|0}function PFe(m,f){m=m|0,f=f|0,m=7696+(m*28|0)|0,g[f>>2]=g[m>>2],g[f+4>>2]=g[m+4>>2],g[f+8>>2]=g[m+8>>2],g[f+12>>2]=g[m+12>>2]}function IFe(m,f){m=m|0,f=f|0;var y=0,v=0;if(f>>>0>20)return f=-1,f|0;do if((g[11120+(f*216|0)>>2]|0)!=(m|0))if((g[11120+(f*216|0)+8>>2]|0)!=(m|0))if((g[11120+(f*216|0)+16>>2]|0)!=(m|0))if((g[11120+(f*216|0)+24>>2]|0)!=(m|0))if((g[11120+(f*216|0)+32>>2]|0)!=(m|0))if((g[11120+(f*216|0)+40>>2]|0)!=(m|0))if((g[11120+(f*216|0)+48>>2]|0)!=(m|0))if((g[11120+(f*216|0)+56>>2]|0)!=(m|0))if((g[11120+(f*216|0)+64>>2]|0)!=(m|0))if((g[11120+(f*216|0)+72>>2]|0)!=(m|0))if((g[11120+(f*216|0)+80>>2]|0)!=(m|0))if((g[11120+(f*216|0)+88>>2]|0)!=(m|0))if((g[11120+(f*216|0)+96>>2]|0)!=(m|0))if((g[11120+(f*216|0)+104>>2]|0)!=(m|0))if((g[11120+(f*216|0)+112>>2]|0)!=(m|0))if((g[11120+(f*216|0)+120>>2]|0)!=(m|0))if((g[11120+(f*216|0)+128>>2]|0)!=(m|0))if((g[11120+(f*216|0)+136>>2]|0)==(m|0))m=2,y=1,v=2;else{if((g[11120+(f*216|0)+144>>2]|0)==(m|0)){m=0,y=2,v=0;break}if((g[11120+(f*216|0)+152>>2]|0)==(m|0)){m=0,y=2,v=1;break}if((g[11120+(f*216|0)+160>>2]|0)==(m|0)){m=0,y=2,v=2;break}if((g[11120+(f*216|0)+168>>2]|0)==(m|0)){m=1,y=2,v=0;break}if((g[11120+(f*216|0)+176>>2]|0)==(m|0)){m=1,y=2,v=1;break}if((g[11120+(f*216|0)+184>>2]|0)==(m|0)){m=1,y=2,v=2;break}if((g[11120+(f*216|0)+192>>2]|0)==(m|0)){m=2,y=2,v=0;break}if((g[11120+(f*216|0)+200>>2]|0)==(m|0)){m=2,y=2,v=1;break}if((g[11120+(f*216|0)+208>>2]|0)==(m|0)){m=2,y=2,v=2;break}else m=-1;return m|0}else m=2,y=1,v=1;else m=2,y=1,v=0;else m=1,y=1,v=2;else m=1,y=1,v=1;else m=1,y=1,v=0;else m=0,y=1,v=2;else m=0,y=1,v=1;else m=0,y=1,v=0;else m=2,y=0,v=2;else m=2,y=0,v=1;else m=2,y=0,v=0;else m=1,y=0,v=2;else m=1,y=0,v=1;else m=1,y=0,v=0;else m=0,y=0,v=2;else m=0,y=0,v=1;else m=0,y=0,v=0;while(0);return f=g[11120+(f*216|0)+(y*72|0)+(m*24|0)+(v<<3)+4>>2]|0,f|0}function Boe(m,f){return m=m|0,f=f|0,(g[7696+(m*28|0)+20>>2]|0)==(f|0)?(f=1,f|0):(f=(g[7696+(m*28|0)+24>>2]|0)==(f|0),f|0)}function iV(m,f){return m=m|0,f=f|0,g[848+(m*28|0)+(f<<2)>>2]|0}function sV(m,f){return m=m|0,f=f|0,(g[848+(m*28|0)>>2]|0)==(f|0)?(f=0,f|0):(g[848+(m*28|0)+4>>2]|0)==(f|0)?(f=1,f|0):(g[848+(m*28|0)+8>>2]|0)==(f|0)?(f=2,f|0):(g[848+(m*28|0)+12>>2]|0)==(f|0)?(f=3,f|0):(g[848+(m*28|0)+16>>2]|0)==(f|0)?(f=4,f|0):(g[848+(m*28|0)+20>>2]|0)==(f|0)?(f=5,f|0):((g[848+(m*28|0)+24>>2]|0)==(f|0)?6:7)|0}function $Fe(){return 122}function LFe(m){m=m|0;var f=0,y=0,v=0;f=0;do Et(f|0,0,45)|0,v=oe()|0|134225919,y=m+(f<<3)|0,g[y>>2]=-1,g[y+4>>2]=v,f=f+1|0;while((f|0)!=122);return 0}function Uoe(m){return m=m|0,+K[m+16>>3]<+K[m+24>>3]|0}function Voe(m,f){m=m|0,f=f|0;var y=0,v=0,x=0;return y=+K[f>>3],!(y>=+K[m+8>>3])||!(y<=+K[m>>3])?(f=0,f|0):(v=+K[m+16>>3],y=+K[m+24>>3],x=+K[f+8>>3],f=x>=y,m=x<=v&1,v<y?f&&(m=1):f||(m=0),f=(m|0)!=0,f|0)}function zoe(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0;de=H,H=H+288|0,Y=de+264|0,ne=de+96|0,U=de,P=U,D=P+96|0;do g[P>>2]=0,P=P+4|0;while((P|0)<(D|0));return f=fV(f,U)|0,f|0?(_e=f,H=de,_e|0):(D=U,U=g[D>>2]|0,D=g[D+4>>2]|0,cR(U,D,Y)|0,uR(U,D,ne)|0,R=+dR(Y,ne+8|0),K[Y>>3]=+K[m>>3],D=Y+8|0,K[D>>3]=+K[m+16>>3],K[ne>>3]=+K[m+8>>3],U=ne+8|0,K[U>>3]=+K[m+24>>3],x=+dR(Y,ne),We=+K[D>>3]-+K[U>>3],S=+Wr(+We),Ce=+K[Y>>3]-+K[ne>>3],v=+Wr(+Ce),!(We==0|Ce==0)&&(We=+Aae(+S,+v),We=+Mi(+(x*x/+yV(+(We/+yV(+S,+v)),3)/(R*(R*2.59807621135)*.8))),K[Ci>>3]=We,ge=~~We>>>0,_e=+Wr(We)>=1?We>0?~~+Qh(+bs(We/4294967296),4294967295)>>>0:~~+Mi((We-+(~~We>>>0))/4294967296)>>>0:0,(g[Ci+4>>2]&2146435072|0)!=2146435072)?(ne=(ge|0)==0&(_e|0)==0,f=y,g[f>>2]=ne?1:ge,g[f+4>>2]=ne?0:_e,f=0):f=1,_e=f,H=de,_e|0)}function DFe(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0,U=0,Y=0;U=H,H=H+288|0,R=U+264|0,P=U+96|0,D=U,x=D,S=x+96|0;do g[x>>2]=0,x=x+4|0;while((x|0)<(S|0));return y=fV(y,D)|0,y|0?(v=y,H=U,v|0):(y=D,x=g[y>>2]|0,y=g[y+4>>2]|0,cR(x,y,R)|0,uR(x,y,P)|0,Y=+dR(R,P+8|0),Y=+Mi(+(+dR(m,f)/(Y*2))),K[Ci>>3]=Y,y=~~Y>>>0,x=+Wr(Y)>=1?Y>0?~~+Qh(+bs(Y/4294967296),4294967295)>>>0:~~+Mi((Y-+(~~Y>>>0))/4294967296)>>>0:0,(g[Ci+4>>2]&2146435072|0)==2146435072?(v=1,H=U,v|0):(D=(y|0)==0&(x|0)==0,g[v>>2]=D?1:y,g[v+4>>2]=D?0:x,v=0,H=U,v|0))}function NFe(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0,g[m>>2]=f,g[m+4>>2]=y,g[m+8>>2]=v}function FFe(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0;ne=f+8|0,g[ne>>2]=0,D=+K[m>>3],R=+Wr(+D),U=+K[m+8>>3],P=+Wr(+U)/.8660254037844386,R=R+P*.5,y=~~R,m=~~P,R=R-+(y|0),P=P-+(m|0);do if(R<.5)if(R<.3333333333333333)if(g[f>>2]=y,P<(R+1)*.5){g[f+4>>2]=m;break}else{m=m+1|0,g[f+4>>2]=m;break}else if(ge=1-R,m=(!(P<ge)&1)+m|0,g[f+4>>2]=m,ge<=P&P<R*2){y=y+1|0,g[f>>2]=y;break}else{g[f>>2]=y;break}else{if(!(R<.6666666666666666))if(y=y+1|0,g[f>>2]=y,P<R*.5){g[f+4>>2]=m;break}else{m=m+1|0,g[f+4>>2]=m;break}if(P<1-R){if(g[f+4>>2]=m,R*2+-1<P){g[f>>2]=y;break}}else m=m+1|0,g[f+4>>2]=m;y=y+1|0,g[f>>2]=y}while(0);do if(D<0)if(m&1){Y=(m+1|0)/2|0,Y=_c(y|0,((y|0)<0)<<31>>31|0,Y|0,((Y|0)<0)<<31>>31|0)|0,y=~~(+(y|0)-((+(Y>>>0)+4294967296*+(oe()|0))*2+1)),g[f>>2]=y;break}else{Y=(m|0)/2|0,Y=_c(y|0,((y|0)<0)<<31>>31|0,Y|0,((Y|0)<0)<<31>>31|0)|0,y=~~(+(y|0)-(+(Y>>>0)+4294967296*+(oe()|0))*2),g[f>>2]=y;break}while(0);Y=f+4|0,U<0&&(y=y-((m<<1|1|0)/2|0)|0,g[f>>2]=y,m=0-m|0,g[Y>>2]=m),v=m-y|0,(y|0)<0?(x=0-y|0,g[Y>>2]=v,g[ne>>2]=x,g[f>>2]=0,m=v,y=0):x=0,(m|0)<0&&(y=y-m|0,g[f>>2]=y,x=x-m|0,g[ne>>2]=x,g[Y>>2]=0,m=0),S=y-x|0,v=m-x|0,(x|0)<0&&(g[f>>2]=S,g[Y>>2]=v,g[ne>>2]=0,m=v,y=S,x=0),v=(m|0)<(y|0)?m:y,v=(x|0)<(v|0)?x:v,!((v|0)<=0)&&(g[f>>2]=y-v,g[Y>>2]=m-v,g[ne>>2]=x-v)}function yc(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0;f=g[m>>2]|0,R=m+4|0,y=g[R>>2]|0,(f|0)<0&&(y=y-f|0,g[R>>2]=y,S=m+8|0,g[S>>2]=(g[S>>2]|0)-f,g[m>>2]=0,f=0),(y|0)<0?(f=f-y|0,g[m>>2]=f,S=m+8|0,x=(g[S>>2]|0)-y|0,g[S>>2]=x,g[R>>2]=0,y=0):(x=m+8|0,S=x,x=g[x>>2]|0),(x|0)<0&&(f=f-x|0,g[m>>2]=f,y=y-x|0,g[R>>2]=y,g[S>>2]=0,x=0),v=(y|0)<(f|0)?y:f,v=(x|0)<(v|0)?x:v,!((v|0)<=0)&&(g[m>>2]=f-v,g[R>>2]=y-v,g[S>>2]=x-v)}function Nb(m,f){m=m|0,f=f|0;var y=0,v=0;v=g[m+8>>2]|0,y=+((g[m+4>>2]|0)-v|0),K[f>>3]=+((g[m>>2]|0)-v|0)-y*.5,K[f+8>>3]=y*.8660254037844386}function iu(m,f,y){m=m|0,f=f|0,y=y|0,g[y>>2]=(g[f>>2]|0)+(g[m>>2]|0),g[y+4>>2]=(g[f+4>>2]|0)+(g[m+4>>2]|0),g[y+8>>2]=(g[f+8>>2]|0)+(g[m+8>>2]|0)}function nV(m,f,y){m=m|0,f=f|0,y=y|0,g[y>>2]=(g[m>>2]|0)-(g[f>>2]|0),g[y+4>>2]=(g[m+4>>2]|0)-(g[f+4>>2]|0),g[y+8>>2]=(g[m+8>>2]|0)-(g[f+8>>2]|0)}function Goe(m,f){m=m|0,f=f|0;var y=0,v=0;y=ra(g[m>>2]|0,f)|0,g[m>>2]=y,y=m+4|0,v=ra(g[y>>2]|0,f)|0,g[y>>2]=v,m=m+8|0,f=ra(g[m>>2]|0,f)|0,g[m>>2]=f}function iD(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;R=g[m>>2]|0,P=(R|0)<0,v=(g[m+4>>2]|0)-(P?R:0)|0,S=(v|0)<0,x=(S?0-v|0:0)+((g[m+8>>2]|0)-(P?R:0))|0,y=(x|0)<0,m=y?0:x,f=(S?0:v)-(y?x:0)|0,x=(P?0:R)-(S?v:0)-(y?x:0)|0,y=(f|0)<(x|0)?f:x,y=(m|0)<(y|0)?m:y,v=(y|0)>0,m=m-(v?y:0)|0,f=f-(v?y:0)|0;e:do switch(x-(v?y:0)|0){case 0:switch(f|0){case 0:return P=m|0?(m|0)==1?1:7:0,P|0;case 1:return P=m|0?(m|0)==1?3:7:2,P|0;default:break e}case 1:switch(f|0){case 0:return P=m|0?(m|0)==1?5:7:4,P|0;case 1:{if(!m)m=6;else break e;return m|0}default:break e}}while(0);return P=7,P|0}function kFe(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;R=m+8|0,x=g[R>>2]|0,S=(g[m>>2]|0)-x|0,P=m+4|0,x=(g[P>>2]|0)-x|0;do if(S>>>0>715827881|x>>>0>715827881){if(y=(S|0)>0,y){if((2147483647-S|0)<(S|0)||(2147483647-(S<<1)|0)<(S|0))return P=1,P|0}else if((-2147483648-S|0)>(S|0)||(-2147483648-(S<<1)|0)>(S|0))return P=1,P|0;if(f=S*3|0,(x|0)>0){if((2147483647-x|0)<(x|0))return P=1,P|0}else if((-2147483648-x|0)>(x|0))return P=1,P|0;if(v=x<<1,(S|0)>-1){if((f|-2147483648|0)>=(x|0))return P=1,P|0}else if((f^-2147483648|0)<(x|0))return P=1,P|0;if(y){if((2147483647-S|0)<(v|0))f=1;else{y=v;break}return f|0}else{if((-2147483648-S|0)>(v|0))f=1;else{y=v;break}return f|0}}else y=x<<1,f=S*3|0;while(0);v=m_(+(f-x|0)/7)|0,g[m>>2]=v,x=m_(+(y+S|0)/7)|0,g[P>>2]=x,g[R>>2]=0,y=(x|0)<(v|0),f=y?v:x,y=y?x:v;do if((y|0)<0){if((f|0)>0){if((f|-2147483648|0)<(y|0)&((y|0)!=-2147483648&(2147483647-f|0)>=(y|0)))break;vr(23313,22444,355,22455)}if((y|0)==-2147483648|(-2147483648-f|0)>(y|0)&&vr(23313,22444,355,22455),(f|0)>-1){if((f|-2147483648|0)<(y|0))break;vr(23313,22444,355,22455)}else{if((f^-2147483648|0)>=(y|0))break;vr(23313,22444,355,22455)}}while(0);return f=x-v|0,(v|0)<0?(y=0-v|0,g[P>>2]=f,g[R>>2]=y,g[m>>2]=0,v=0):(f=x,y=0),(f|0)<0&&(v=v-f|0,g[m>>2]=v,y=y-f|0,g[R>>2]=y,g[P>>2]=0,f=0),S=v-y|0,x=f-y|0,(y|0)<0?(g[m>>2]=S,g[P>>2]=x,g[R>>2]=0,f=x,x=S,y=0):x=v,v=(f|0)<(x|0)?f:x,v=(y|0)<(v|0)?y:v,(v|0)<=0?(P=0,P|0):(g[m>>2]=x-v,g[P>>2]=f-v,g[R>>2]=y-v,P=0,P|0)}function BFe(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;R=m+8|0,x=g[R>>2]|0,S=(g[m>>2]|0)-x|0,P=m+4|0,x=(g[P>>2]|0)-x|0;do if(S>>>0>715827881|x>>>0>715827881){if(y=(S|0)>0,y){if((2147483647-S|0)<(S|0))return P=1,P|0}else if((-2147483648-S|0)>(S|0))return P=1,P|0;if(f=S<<1,(x|0)>0){if((2147483647-x|0)<(x|0)||(2147483647-(x<<1)|0)<(x|0))return P=1,P|0}else if((-2147483648-x|0)>(x|0)||(-2147483648-(x<<1)|0)>(x|0))return P=1,P|0;if(v=x*3|0,y){if((2147483647-f|0)<(x|0))return P=1,P|0}else if((-2147483648-f|0)>(x|0))return P=1,P|0;if((x|0)>-1){if((v|-2147483648|0)<(S|0)){y=v;break}else f=1;return f|0}else{if((v^-2147483648|0)<(S|0))f=1;else{y=v;break}return f|0}}else y=x*3|0,f=S<<1;while(0);v=m_(+(f+x|0)/7)|0,g[m>>2]=v,x=m_(+(y-S|0)/7)|0,g[P>>2]=x,g[R>>2]=0,y=(x|0)<(v|0),f=y?v:x,y=y?x:v;do if((y|0)<0){if((f|0)>0){if((f|-2147483648|0)<(y|0)&((y|0)!=-2147483648&(2147483647-f|0)>=(y|0)))break;vr(23313,22444,404,22469)}if((y|0)==-2147483648|(-2147483648-f|0)>(y|0)&&vr(23313,22444,404,22469),(f|0)>-1){if((f|-2147483648|0)<(y|0))break;vr(23313,22444,404,22469)}else{if((f^-2147483648|0)>=(y|0))break;vr(23313,22444,404,22469)}}while(0);return f=x-v|0,(v|0)<0?(y=0-v|0,g[P>>2]=f,g[R>>2]=y,g[m>>2]=0,v=0):(f=x,y=0),(f|0)<0&&(v=v-f|0,g[m>>2]=v,y=y-f|0,g[R>>2]=y,g[P>>2]=0,f=0),S=v-y|0,x=f-y|0,(y|0)<0?(g[m>>2]=S,g[P>>2]=x,g[R>>2]=0,f=x,x=S,y=0):x=v,v=(f|0)<(x|0)?f:x,v=(y|0)<(v|0)?y:v,(v|0)<=0?(P=0,P|0):(g[m>>2]=x-v,g[P>>2]=f-v,g[R>>2]=y-v,P=0,P|0)}function UFe(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;R=m+8|0,y=g[R>>2]|0,f=(g[m>>2]|0)-y|0,P=m+4|0,y=(g[P>>2]|0)-y|0,v=m_(+((f*3|0)-y|0)/7)|0,g[m>>2]=v,f=m_(+((y<<1)+f|0)/7)|0,g[P>>2]=f,g[R>>2]=0,y=f-v|0,(v|0)<0?(S=0-v|0,g[P>>2]=y,g[R>>2]=S,g[m>>2]=0,f=y,v=0,y=S):y=0,(f|0)<0&&(v=v-f|0,g[m>>2]=v,y=y-f|0,g[R>>2]=y,g[P>>2]=0,f=0),S=v-y|0,x=f-y|0,(y|0)<0?(g[m>>2]=S,g[P>>2]=x,g[R>>2]=0,f=x,x=S,y=0):x=v,v=(f|0)<(x|0)?f:x,v=(y|0)<(v|0)?y:v,!((v|0)<=0)&&(g[m>>2]=x-v,g[P>>2]=f-v,g[R>>2]=y-v)}function joe(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;R=m+8|0,y=g[R>>2]|0,f=(g[m>>2]|0)-y|0,P=m+4|0,y=(g[P>>2]|0)-y|0,v=m_(+((f<<1)+y|0)/7)|0,g[m>>2]=v,f=m_(+((y*3|0)-f|0)/7)|0,g[P>>2]=f,g[R>>2]=0,y=f-v|0,(v|0)<0?(S=0-v|0,g[P>>2]=y,g[R>>2]=S,g[m>>2]=0,f=y,v=0,y=S):y=0,(f|0)<0&&(v=v-f|0,g[m>>2]=v,y=y-f|0,g[R>>2]=y,g[P>>2]=0,f=0),S=v-y|0,x=f-y|0,(y|0)<0?(g[m>>2]=S,g[P>>2]=x,g[R>>2]=0,f=x,x=S,y=0):x=v,v=(f|0)<(x|0)?f:x,v=(y|0)<(v|0)?y:v,!((v|0)<=0)&&(g[m>>2]=x-v,g[P>>2]=f-v,g[R>>2]=y-v)}function sD(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;f=g[m>>2]|0,R=m+4|0,y=g[R>>2]|0,P=m+8|0,v=g[P>>2]|0,x=y+(f*3|0)|0,g[m>>2]=x,y=v+(y*3|0)|0,g[R>>2]=y,f=(v*3|0)+f|0,g[P>>2]=f,v=y-x|0,(x|0)<0?(f=f-x|0,g[R>>2]=v,g[P>>2]=f,g[m>>2]=0,y=v,v=0):v=x,(y|0)<0&&(v=v-y|0,g[m>>2]=v,f=f-y|0,g[P>>2]=f,g[R>>2]=0,y=0),S=v-f|0,x=y-f|0,(f|0)<0?(g[m>>2]=S,g[R>>2]=x,g[P>>2]=0,v=S,f=0):x=y,y=(x|0)<(v|0)?x:v,y=(f|0)<(y|0)?f:y,!((y|0)<=0)&&(g[m>>2]=v-y,g[R>>2]=x-y,g[P>>2]=f-y)}function Fb(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;x=g[m>>2]|0,R=m+4|0,f=g[R>>2]|0,P=m+8|0,y=g[P>>2]|0,v=(f*3|0)+x|0,x=y+(x*3|0)|0,g[m>>2]=x,g[R>>2]=v,f=(y*3|0)+f|0,g[P>>2]=f,y=v-x|0,(x|0)<0?(f=f-x|0,g[R>>2]=y,g[P>>2]=f,g[m>>2]=0,x=0):y=v,(y|0)<0&&(x=x-y|0,g[m>>2]=x,f=f-y|0,g[P>>2]=f,g[R>>2]=0,y=0),S=x-f|0,v=y-f|0,(f|0)<0?(g[m>>2]=S,g[R>>2]=v,g[P>>2]=0,x=S,f=0):v=y,y=(v|0)<(x|0)?v:x,y=(f|0)<(y|0)?f:y,!((y|0)<=0)&&(g[m>>2]=x-y,g[R>>2]=v-y,g[P>>2]=f-y)}function Hoe(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0,P=0;(f+-1|0)>>>0>=6||(x=(g[15440+(f*12|0)>>2]|0)+(g[m>>2]|0)|0,g[m>>2]=x,P=m+4|0,v=(g[15440+(f*12|0)+4>>2]|0)+(g[P>>2]|0)|0,g[P>>2]=v,R=m+8|0,f=(g[15440+(f*12|0)+8>>2]|0)+(g[R>>2]|0)|0,g[R>>2]=f,y=v-x|0,(x|0)<0?(f=f-x|0,g[P>>2]=y,g[R>>2]=f,g[m>>2]=0,v=0):(y=v,v=x),(y|0)<0&&(v=v-y|0,g[m>>2]=v,f=f-y|0,g[R>>2]=f,g[P>>2]=0,y=0),S=v-f|0,x=y-f|0,(f|0)<0?(g[m>>2]=S,g[P>>2]=x,g[R>>2]=0,v=S,f=0):x=y,y=(x|0)<(v|0)?x:v,y=(f|0)<(y|0)?f:y,!((y|0)<=0)&&(g[m>>2]=v-y,g[P>>2]=x-y,g[R>>2]=f-y))}function qoe(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;x=g[m>>2]|0,R=m+4|0,f=g[R>>2]|0,P=m+8|0,y=g[P>>2]|0,v=f+x|0,x=y+x|0,g[m>>2]=x,g[R>>2]=v,f=y+f|0,g[P>>2]=f,y=v-x|0,(x|0)<0?(f=f-x|0,g[R>>2]=y,g[P>>2]=f,g[m>>2]=0,v=0):(y=v,v=x),(y|0)<0&&(v=v-y|0,g[m>>2]=v,f=f-y|0,g[P>>2]=f,g[R>>2]=0,y=0),S=v-f|0,x=y-f|0,(f|0)<0?(g[m>>2]=S,g[R>>2]=x,g[P>>2]=0,v=S,f=0):x=y,y=(x|0)<(v|0)?x:v,y=(f|0)<(y|0)?f:y,!((y|0)<=0)&&(g[m>>2]=v-y,g[R>>2]=x-y,g[P>>2]=f-y)}function nD(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;f=g[m>>2]|0,R=m+4|0,v=g[R>>2]|0,P=m+8|0,y=g[P>>2]|0,x=v+f|0,g[m>>2]=x,v=y+v|0,g[R>>2]=v,f=y+f|0,g[P>>2]=f,y=v-x|0,(x|0)<0?(f=f-x|0,g[R>>2]=y,g[P>>2]=f,g[m>>2]=0,v=0):(y=v,v=x),(y|0)<0&&(v=v-y|0,g[m>>2]=v,f=f-y|0,g[P>>2]=f,g[R>>2]=0,y=0),S=v-f|0,x=y-f|0,(f|0)<0?(g[m>>2]=S,g[R>>2]=x,g[P>>2]=0,v=S,f=0):x=y,y=(x|0)<(v|0)?x:v,y=(f|0)<(y|0)?f:y,!((y|0)<=0)&&(g[m>>2]=v-y,g[R>>2]=x-y,g[P>>2]=f-y)}function kb(m){switch(m=m|0,m|0){case 1:{m=5;break}case 5:{m=4;break}case 4:{m=6;break}case 6:{m=2;break}case 2:{m=3;break}case 3:{m=1;break}}return m|0}function p_(m){switch(m=m|0,m|0){case 1:{m=3;break}case 3:{m=2;break}case 2:{m=6;break}case 6:{m=4;break}case 4:{m=5;break}case 5:{m=1;break}}return m|0}function Woe(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;f=g[m>>2]|0,R=m+4|0,y=g[R>>2]|0,P=m+8|0,v=g[P>>2]|0,x=y+(f<<1)|0,g[m>>2]=x,y=v+(y<<1)|0,g[R>>2]=y,f=(v<<1)+f|0,g[P>>2]=f,v=y-x|0,(x|0)<0?(f=f-x|0,g[R>>2]=v,g[P>>2]=f,g[m>>2]=0,y=v,v=0):v=x,(y|0)<0&&(v=v-y|0,g[m>>2]=v,f=f-y|0,g[P>>2]=f,g[R>>2]=0,y=0),S=v-f|0,x=y-f|0,(f|0)<0?(g[m>>2]=S,g[R>>2]=x,g[P>>2]=0,v=S,f=0):x=y,y=(x|0)<(v|0)?x:v,y=(f|0)<(y|0)?f:y,!((y|0)<=0)&&(g[m>>2]=v-y,g[R>>2]=x-y,g[P>>2]=f-y)}function Yoe(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;x=g[m>>2]|0,R=m+4|0,f=g[R>>2]|0,P=m+8|0,y=g[P>>2]|0,v=(f<<1)+x|0,x=y+(x<<1)|0,g[m>>2]=x,g[R>>2]=v,f=(y<<1)+f|0,g[P>>2]=f,y=v-x|0,(x|0)<0?(f=f-x|0,g[R>>2]=y,g[P>>2]=f,g[m>>2]=0,x=0):y=v,(y|0)<0&&(x=x-y|0,g[m>>2]=x,f=f-y|0,g[P>>2]=f,g[R>>2]=0,y=0),S=x-f|0,v=y-f|0,(f|0)<0?(g[m>>2]=S,g[R>>2]=v,g[P>>2]=0,x=S,f=0):v=y,y=(v|0)<(x|0)?v:x,y=(f|0)<(y|0)?f:y,!((y|0)<=0)&&(g[m>>2]=x-y,g[R>>2]=v-y,g[P>>2]=f-y)}function oV(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0,P=0;return R=(g[m>>2]|0)-(g[f>>2]|0)|0,P=(R|0)<0,v=(g[m+4>>2]|0)-(g[f+4>>2]|0)-(P?R:0)|0,S=(v|0)<0,x=(P?0-R|0:0)+(g[m+8>>2]|0)-(g[f+8>>2]|0)+(S?0-v|0:0)|0,m=(x|0)<0,f=m?0:x,y=(S?0:v)-(m?x:0)|0,x=(P?0:R)-(S?v:0)-(m?x:0)|0,m=(y|0)<(x|0)?y:x,m=(f|0)<(m|0)?f:m,v=(m|0)>0,f=f-(v?m:0)|0,y=y-(v?m:0)|0,m=x-(v?m:0)|0,m=(m|0)>-1?m:0-m|0,y=(y|0)>-1?y:0-y|0,f=(f|0)>-1?f:0-f|0,f=(y|0)>(f|0)?y:f,((m|0)>(f|0)?m:f)|0}function VFe(m,f){m=m|0,f=f|0;var y=0;y=g[m+8>>2]|0,g[f>>2]=(g[m>>2]|0)-y,g[f+4>>2]=(g[m+4>>2]|0)-y}function zFe(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0,P=0;v=g[m>>2]|0,g[f>>2]=v,x=g[m+4>>2]|0,R=f+4|0,g[R>>2]=x,P=f+8|0,g[P>>2]=0,y=(x|0)<(v|0),m=y?v:x,y=y?x:v;do if((y|0)<0){if((m|0)>0){if((m|-2147483648|0)<(y|0)&((y|0)!=-2147483648&(2147483647-m|0)>=(y|0)))break;return m=1,m|0}if((y|0)==-2147483648|(-2147483648-m|0)>(y|0))return f=1,f|0;if((m|0)>-1){if((m|-2147483648|0)<(y|0))break;return m=1,m|0}else{if((m^-2147483648|0)<(y|0))m=1;else break;return m|0}}while(0);return m=x-v|0,(v|0)<0?(y=0-v|0,g[R>>2]=m,g[P>>2]=y,g[f>>2]=0,v=0):(m=x,y=0),(m|0)<0&&(v=v-m|0,g[f>>2]=v,y=y-m|0,g[P>>2]=y,g[R>>2]=0,m=0),S=v-y|0,x=m-y|0,(y|0)<0?(g[f>>2]=S,g[R>>2]=x,g[P>>2]=0,m=x,x=S,y=0):x=v,v=(m|0)<(x|0)?m:x,v=(y|0)<(v|0)?y:v,(v|0)<=0?(f=0,f|0):(g[f>>2]=x-v,g[R>>2]=m-v,g[P>>2]=y-v,f=0,f|0)}function Qoe(m){m=m|0;var f=0,y=0,v=0,x=0;f=m+8|0,x=g[f>>2]|0,y=x-(g[m>>2]|0)|0,g[m>>2]=y,v=m+4|0,m=(g[v>>2]|0)-x|0,g[v>>2]=m,g[f>>2]=0-(m+y)}function GFe(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;y=g[m>>2]|0,f=0-y|0,g[m>>2]=f,R=m+8|0,g[R>>2]=0,P=m+4|0,v=g[P>>2]|0,x=v+y|0,(y|0)>0?(g[P>>2]=x,g[R>>2]=y,g[m>>2]=0,f=0,v=x):y=0,(v|0)<0?(S=f-v|0,g[m>>2]=S,y=y-v|0,g[R>>2]=y,g[P>>2]=0,x=S-y|0,f=0-y|0,(y|0)<0?(g[m>>2]=x,g[P>>2]=f,g[R>>2]=0,v=f,y=0):(v=0,x=S)):x=f,f=(v|0)<(x|0)?v:x,f=(y|0)<(f|0)?y:f,!((f|0)<=0)&&(g[m>>2]=x-f,g[P>>2]=v-f,g[R>>2]=y-f)}function jFe(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0,U=0,Y=0,ne=0;if(ne=H,H=H+64|0,Y=ne,P=ne+56|0,!(!0&(f&2013265920|0)==134217728&(!0&(v&2013265920|0)==134217728)))return x=5,H=ne,x|0;if((m|0)==(y|0)&(f|0)==(v|0))return g[x>>2]=0,x=0,H=ne,x|0;if(R=at(m|0,f|0,52)|0,oe()|0,R=R&15,U=at(y|0,v|0,52)|0,oe()|0,(R|0)!=(U&15|0))return x=12,H=ne,x|0;if(S=R+-1|0,R>>>0>1){uV(m,f,S,Y)|0,uV(y,v,S,P)|0,U=Y,D=g[U>>2]|0,U=g[U+4>>2]|0;e:do if((D|0)==(g[P>>2]|0)&&(U|0)==(g[P+4>>2]|0)){R=(R^15)*3|0,S=at(m|0,f|0,R|0)|0,oe()|0,S=S&7,R=at(y|0,v|0,R|0)|0,oe()|0,R=R&7;do if((S|0)==0|(R|0)==0)g[x>>2]=1,S=0;else if((S|0)==7)S=5;else{if((S|0)==1|(R|0)==1&&Un(D,U)|0){S=5;break}if((g[15536+(S<<2)>>2]|0)!=(R|0)&&(g[15568+(S<<2)>>2]|0)!=(R|0))break e;g[x>>2]=1,S=0}while(0);return x=S,H=ne,x|0}while(0)}S=Y,R=S+56|0;do g[S>>2]=0,S=S+4|0;while((S|0)<(R|0));return oR(m,f,1,Y)|0,f=Y,!((g[f>>2]|0)==(y|0)&&(g[f+4>>2]|0)==(v|0))&&(f=Y+8|0,!((g[f>>2]|0)==(y|0)&&(g[f+4>>2]|0)==(v|0)))&&(f=Y+16|0,!((g[f>>2]|0)==(y|0)&&(g[f+4>>2]|0)==(v|0)))&&(f=Y+24|0,!((g[f>>2]|0)==(y|0)&&(g[f+4>>2]|0)==(v|0)))&&(f=Y+32|0,!((g[f>>2]|0)==(y|0)&&(g[f+4>>2]|0)==(v|0)))&&(f=Y+40|0,!((g[f>>2]|0)==(y|0)&&(g[f+4>>2]|0)==(v|0)))?(S=Y+48|0,S=((g[S>>2]|0)==(y|0)?(g[S+4>>2]|0)==(v|0):0)&1):S=1,g[x>>2]=S,x=0,H=ne,x|0}function HFe(m,f,y,v,x){return m=m|0,f=f|0,y=y|0,v=v|0,x=x|0,y=tV(m,f,y,v)|0,(y|0)==7?(x=11,x|0):(v=Et(y|0,0,56)|0,f=f&-2130706433|(oe()|0)|268435456,g[x>>2]=m|v,g[x+4>>2]=f,x=0,x|0)}function qFe(m,f,y){return m=m|0,f=f|0,y=y|0,!0&(f&2013265920|0)==268435456?(g[y>>2]=m,g[y+4>>2]=f&-2130706433|134217728,y=0,y|0):(y=6,y|0)}function WFe(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0;return x=H,H=H+16|0,v=x,g[v>>2]=0,!0&(f&2013265920|0)==268435456?(S=at(m|0,f|0,56)|0,oe()|0,v=gl(m,f&-2130706433|134217728,S&7,v,y)|0,H=x,v|0):(v=6,H=x,v|0)}function YFe(m,f){m=m|0,f=f|0;var y=0;switch(y=at(m|0,f|0,56)|0,oe()|0,y&7){case 0:case 7:return y=0,y|0}return y=f&-2130706433|134217728,!(!0&(f&2013265920|0)==268435456)||!0&(f&117440512|0)==16777216&(Un(m,y)|0)!=0?(y=0,y|0):(y=cV(m,y)|0,y|0)}function QFe(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0;return x=H,H=H+16|0,v=x,!0&(f&2013265920|0)==268435456?(S=f&-2130706433|134217728,R=y,g[R>>2]=m,g[R+4>>2]=S,g[v>>2]=0,f=at(m|0,f|0,56)|0,oe()|0,v=gl(m,S,f&7,v,y+8|0)|0,H=x,v|0):(v=6,H=x,v|0)}function XFe(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0;return x=(Un(m,f)|0)==0,f=f&-2130706433,v=y,g[v>>2]=x?m:0,g[v+4>>2]=x?f|285212672:0,v=y+8|0,g[v>>2]=m,g[v+4>>2]=f|301989888,v=y+16|0,g[v>>2]=m,g[v+4>>2]=f|318767104,v=y+24|0,g[v>>2]=m,g[v+4>>2]=f|335544320,v=y+32|0,g[v>>2]=m,g[v+4>>2]=f|352321536,y=y+40|0,g[y>>2]=m,g[y+4>>2]=f|369098752,0}function oD(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0;return R=H,H=H+16|0,x=R,S=f&-2130706433|134217728,!0&(f&2013265920|0)==268435456?(v=at(m|0,f|0,56)|0,oe()|0,v=Q6e(m,S,v&7)|0,(v|0)==-1?(g[y>>2]=0,S=6,H=R,S|0):(FT(m,S,x)|0&&vr(23313,22484,282,22499),f=at(m|0,f|0,52)|0,oe()|0,f=f&15,Un(m,S)|0?aV(x,f,v,2,y):lV(x,f,v,2,y),S=0,H=R,S|0)):(S=6,H=R,S|0)}function ZFe(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0;v=H,H=H+16|0,x=v,JFe(m,f,y,x),FFe(x,y+4|0),H=v}function JFe(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0;if(P=H,H=H+16|0,D=P,KFe(m,y,D),S=+Yh(+(1-+K[D>>3]*.5)),S<1e-16){g[v>>2]=0,g[v+4>>2]=0,g[v+8>>2]=0,g[v+12>>2]=0,H=P;return}if(D=g[y>>2]|0,x=+K[15920+(D*24|0)>>3],x=+hR(x-+hR(+y6e(15600+(D<<4)|0,m))),Jd(f)|0?R=+hR(x+-.3334731722518321):R=x,x=+ta(+S)/.381966011250105,(f|0)>0){m=0;do x=x*2.6457513110645907,m=m+1|0;while((m|0)!=(f|0))}S=+hs(+R)*x,K[v>>3]=S,R=+Dr(+R)*x,K[v+8>>3]=R,H=P}function KFe(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0;if(S=H,H=H+32|0,x=S,Y6e(m,x),g[f>>2]=0,K[y>>3]=5,v=+va(16400,x),v<+K[y>>3]&&(g[f>>2]=0,K[y>>3]=v),v=+va(16424,x),v<+K[y>>3]&&(g[f>>2]=1,K[y>>3]=v),v=+va(16448,x),v<+K[y>>3]&&(g[f>>2]=2,K[y>>3]=v),v=+va(16472,x),v<+K[y>>3]&&(g[f>>2]=3,K[y>>3]=v),v=+va(16496,x),v<+K[y>>3]&&(g[f>>2]=4,K[y>>3]=v),v=+va(16520,x),v<+K[y>>3]&&(g[f>>2]=5,K[y>>3]=v),v=+va(16544,x),v<+K[y>>3]&&(g[f>>2]=6,K[y>>3]=v),v=+va(16568,x),v<+K[y>>3]&&(g[f>>2]=7,K[y>>3]=v),v=+va(16592,x),v<+K[y>>3]&&(g[f>>2]=8,K[y>>3]=v),v=+va(16616,x),v<+K[y>>3]&&(g[f>>2]=9,K[y>>3]=v),v=+va(16640,x),v<+K[y>>3]&&(g[f>>2]=10,K[y>>3]=v),v=+va(16664,x),v<+K[y>>3]&&(g[f>>2]=11,K[y>>3]=v),v=+va(16688,x),v<+K[y>>3]&&(g[f>>2]=12,K[y>>3]=v),v=+va(16712,x),v<+K[y>>3]&&(g[f>>2]=13,K[y>>3]=v),v=+va(16736,x),v<+K[y>>3]&&(g[f>>2]=14,K[y>>3]=v),v=+va(16760,x),v<+K[y>>3]&&(g[f>>2]=15,K[y>>3]=v),v=+va(16784,x),v<+K[y>>3]&&(g[f>>2]=16,K[y>>3]=v),v=+va(16808,x),v<+K[y>>3]&&(g[f>>2]=17,K[y>>3]=v),v=+va(16832,x),v<+K[y>>3]&&(g[f>>2]=18,K[y>>3]=v),v=+va(16856,x),!(v<+K[y>>3])){H=S;return}g[f>>2]=19,K[y>>3]=v,H=S}function lR(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0;if(S=+W6e(m),S<1e-16){f=15600+(f<<4)|0,g[x>>2]=g[f>>2],g[x+4>>2]=g[f+4>>2],g[x+8>>2]=g[f+8>>2],g[x+12>>2]=g[f+12>>2];return}if(R=+Kn(+ +K[m+8>>3],+ +K[m>>3]),(y|0)>0){m=0;do S=S/2.6457513110645907,m=m+1|0;while((m|0)!=(y|0))}v?(S=S/3,y=(Jd(y)|0)==0,S=+Ac(+((y?S:S/2.6457513110645907)*.381966011250105))):(S=+Ac(+(S*.381966011250105)),Jd(y)|0&&(R=+hR(R+.3334731722518321))),_6e(15600+(f<<4)|0,+hR(+K[15920+(f*24|0)>>3]-R),S,x)}function e6e(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0;v=H,H=H+16|0,x=v,Nb(m+4|0,x),lR(x,g[m>>2]|0,f,0,y),H=v}function aV(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0,Fe=0,Ee=0,$t=0,Yt=0,wt=0,Lt=0,zs=0,ds=0,ws=0,xi=0,Ai=0,Ti=0,ln=0,ai=0;if(Ti=H,H=H+272|0,S=Ti+256|0,Ne=Ti+240|0,ws=Ti,xi=Ti+224|0,Ai=Ti+208|0,Fe=Ti+176|0,Ee=Ti+160|0,$t=Ti+192|0,Yt=Ti+144|0,wt=Ti+128|0,Lt=Ti+112|0,zs=Ti+96|0,ds=Ti+80|0,g[S>>2]=f,g[Ne>>2]=g[m>>2],g[Ne+4>>2]=g[m+4>>2],g[Ne+8>>2]=g[m+8>>2],g[Ne+12>>2]=g[m+12>>2],Xoe(Ne,S,ws),g[x>>2]=0,Ne=v+y+((v|0)==5&1)|0,(Ne|0)<=(y|0)){H=Ti;return}D=g[S>>2]|0,U=xi+4|0,Y=Fe+4|0,ne=y+5|0,ge=16880+(D<<2)|0,_e=16960+(D<<2)|0,de=wt+8|0,Ce=Lt+8|0,We=zs+8|0,Ve=Ai+4|0,P=y;e:for(;;){R=ws+(((P|0)%5|0)<<4)|0,g[Ai>>2]=g[R>>2],g[Ai+4>>2]=g[R+4>>2],g[Ai+8>>2]=g[R+8>>2],g[Ai+12>>2]=g[R+12>>2];do;while((NT(Ai,D,0,1)|0)==2);if((P|0)>(y|0)&(Jd(f)|0)!=0){if(g[Fe>>2]=g[Ai>>2],g[Fe+4>>2]=g[Ai+4>>2],g[Fe+8>>2]=g[Ai+8>>2],g[Fe+12>>2]=g[Ai+12>>2],Nb(U,Ee),v=g[Fe>>2]|0,S=g[17040+(v*80|0)+(g[xi>>2]<<2)>>2]|0,g[Fe>>2]=g[18640+(v*80|0)+(S*20|0)>>2],R=g[18640+(v*80|0)+(S*20|0)+16>>2]|0,(R|0)>0){m=0;do qoe(Y),m=m+1|0;while((m|0)<(R|0))}switch(R=18640+(v*80|0)+(S*20|0)+4|0,g[$t>>2]=g[R>>2],g[$t+4>>2]=g[R+4>>2],g[$t+8>>2]=g[R+8>>2],Goe($t,(g[ge>>2]|0)*3|0),iu(Y,$t,Y),yc(Y),Nb(Y,Yt),ln=+(g[_e>>2]|0),K[wt>>3]=ln*3,K[de>>3]=0,ai=ln*-1.5,K[Lt>>3]=ai,K[Ce>>3]=ln*2.598076211353316,K[zs>>3]=ai,K[We>>3]=ln*-2.598076211353316,g[17040+((g[Fe>>2]|0)*80|0)+(g[Ai>>2]<<2)>>2]|0){case 1:{m=Lt,v=wt;break}case 3:{m=zs,v=Lt;break}case 2:{m=wt,v=zs;break}default:{m=12;break e}}cae(Ee,Yt,v,m,ds),lR(ds,g[Fe>>2]|0,D,1,x+8+(g[x>>2]<<4)|0),g[x>>2]=(g[x>>2]|0)+1}if((P|0)<(ne|0)&&(Nb(Ve,Fe),lR(Fe,g[Ai>>2]|0,D,1,x+8+(g[x>>2]<<4)|0),g[x>>2]=(g[x>>2]|0)+1),g[xi>>2]=g[Ai>>2],g[xi+4>>2]=g[Ai+4>>2],g[xi+8>>2]=g[Ai+8>>2],g[xi+12>>2]=g[Ai+12>>2],P=P+1|0,(P|0)>=(Ne|0)){m=3;break}}if((m|0)==3){H=Ti;return}else(m|0)==12&&vr(22522,22569,571,22579)}function Xoe(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0;D=H,H=H+128|0,v=D+64|0,x=D,S=v,R=20240,P=S+60|0;do g[S>>2]=g[R>>2],S=S+4|0,R=R+4|0;while((S|0)<(P|0));S=x,R=20304,P=S+60|0;do g[S>>2]=g[R>>2],S=S+4|0,R=R+4|0;while((S|0)<(P|0));P=(Jd(g[f>>2]|0)|0)==0,v=P?v:x,x=m+4|0,Woe(x),Yoe(x),Jd(g[f>>2]|0)|0&&(Fb(x),g[f>>2]=(g[f>>2]|0)+1),g[y>>2]=g[m>>2],f=y+4|0,iu(x,v,f),yc(f),g[y+16>>2]=g[m>>2],f=y+20|0,iu(x,v+12|0,f),yc(f),g[y+32>>2]=g[m>>2],f=y+36|0,iu(x,v+24|0,f),yc(f),g[y+48>>2]=g[m>>2],f=y+52|0,iu(x,v+36|0,f),yc(f),g[y+64>>2]=g[m>>2],y=y+68|0,iu(x,v+48|0,y),yc(y),H=D}function NT(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0;if(de=H,H=H+32|0,ge=de+12|0,P=de,_e=m+4|0,ne=g[16960+(f<<2)>>2]|0,Y=(v|0)!=0,ne=Y?ne*3|0:ne,x=g[_e>>2]|0,U=m+8|0,R=g[U>>2]|0,Y){if(S=m+12|0,v=g[S>>2]|0,x=R+x+v|0,(x|0)==(ne|0))return _e=1,H=de,_e|0;D=S}else D=m+12|0,v=g[D>>2]|0,x=R+x+v|0;if((x|0)<=(ne|0))return _e=0,H=de,_e|0;do if((v|0)>0){if(v=g[m>>2]|0,(R|0)>0){S=18640+(v*80|0)+60|0,v=m;break}v=18640+(v*80|0)+40|0,y?(NFe(ge,ne,0,0),nV(_e,ge,P),nD(P),iu(P,ge,_e),S=v,v=m):(S=v,v=m)}else S=18640+((g[m>>2]|0)*80|0)+20|0,v=m;while(0);if(g[v>>2]=g[S>>2],x=S+16|0,(g[x>>2]|0)>0){v=0;do qoe(_e),v=v+1|0;while((v|0)<(g[x>>2]|0))}return m=S+4|0,g[ge>>2]=g[m>>2],g[ge+4>>2]=g[m+4>>2],g[ge+8>>2]=g[m+8>>2],f=g[16880+(f<<2)>>2]|0,Goe(ge,Y?f*3|0:f),iu(_e,ge,_e),yc(_e),Y?v=((g[U>>2]|0)+(g[_e>>2]|0)+(g[D>>2]|0)|0)==(ne|0)?1:2:v=2,_e=v,H=de,_e|0}function t6e(m,f){m=m|0,f=f|0;var y=0;do y=NT(m,f,0,1)|0;while((y|0)==2);return y|0}function lV(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0,Fe=0,Ee=0,$t=0,Yt=0,wt=0,Lt=0,zs=0,ds=0,ws=0;if(zs=H,H=H+240|0,S=zs+224|0,$t=zs+208|0,Yt=zs,wt=zs+192|0,Lt=zs+176|0,We=zs+160|0,Ve=zs+144|0,Ne=zs+128|0,Fe=zs+112|0,Ee=zs+96|0,g[S>>2]=f,g[$t>>2]=g[m>>2],g[$t+4>>2]=g[m+4>>2],g[$t+8>>2]=g[m+8>>2],g[$t+12>>2]=g[m+12>>2],Zoe($t,S,Yt),g[x>>2]=0,Ce=v+y+((v|0)==6&1)|0,(Ce|0)<=(y|0)){H=zs;return}D=g[S>>2]|0,U=y+6|0,Y=16960+(D<<2)|0,ne=Ve+8|0,ge=Ne+8|0,_e=Fe+8|0,de=wt+4|0,R=0,P=y,v=-1;e:for(;;){if(S=(P|0)%6|0,m=Yt+(S<<4)|0,g[wt>>2]=g[m>>2],g[wt+4>>2]=g[m+4>>2],g[wt+8>>2]=g[m+8>>2],g[wt+12>>2]=g[m+12>>2],m=R,R=NT(wt,D,0,1)|0,(P|0)>(y|0)&(Jd(f)|0)!=0&&(m|0)!=1&&(g[wt>>2]|0)!=(v|0)){switch(Nb(Yt+(((S+5|0)%6|0)<<4)+4|0,Lt),Nb(Yt+(S<<4)+4|0,We),ds=+(g[Y>>2]|0),K[Ve>>3]=ds*3,K[ne>>3]=0,ws=ds*-1.5,K[Ne>>3]=ws,K[ge>>3]=ds*2.598076211353316,K[Fe>>3]=ws,K[_e>>3]=ds*-2.598076211353316,S=g[$t>>2]|0,g[17040+(S*80|0)+(((v|0)==(S|0)?g[wt>>2]|0:v)<<2)>>2]|0){case 1:{m=Ne,v=Ve;break}case 3:{m=Fe,v=Ne;break}case 2:{m=Ve,v=Fe;break}default:{m=8;break e}}cae(Lt,We,v,m,Ee),!(uae(Lt,Ee)|0)&&!(uae(We,Ee)|0)&&(lR(Ee,g[$t>>2]|0,D,1,x+8+(g[x>>2]<<4)|0),g[x>>2]=(g[x>>2]|0)+1)}if((P|0)<(U|0)&&(Nb(de,Lt),lR(Lt,g[wt>>2]|0,D,1,x+8+(g[x>>2]<<4)|0),g[x>>2]=(g[x>>2]|0)+1),P=P+1|0,(P|0)>=(Ce|0)){m=3;break}else v=g[wt>>2]|0}if((m|0)==3){H=zs;return}else(m|0)==8&&vr(22606,22569,736,22651)}function Zoe(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0;D=H,H=H+160|0,v=D+80|0,x=D,S=v,R=20368,P=S+72|0;do g[S>>2]=g[R>>2],S=S+4|0,R=R+4|0;while((S|0)<(P|0));S=x,R=20448,P=S+72|0;do g[S>>2]=g[R>>2],S=S+4|0,R=R+4|0;while((S|0)<(P|0));P=(Jd(g[f>>2]|0)|0)==0,v=P?v:x,x=m+4|0,Woe(x),Yoe(x),Jd(g[f>>2]|0)|0&&(Fb(x),g[f>>2]=(g[f>>2]|0)+1),g[y>>2]=g[m>>2],f=y+4|0,iu(x,v,f),yc(f),g[y+16>>2]=g[m>>2],f=y+20|0,iu(x,v+12|0,f),yc(f),g[y+32>>2]=g[m>>2],f=y+36|0,iu(x,v+24|0,f),yc(f),g[y+48>>2]=g[m>>2],f=y+52|0,iu(x,v+36|0,f),yc(f),g[y+64>>2]=g[m>>2],f=y+68|0,iu(x,v+48|0,f),yc(f),g[y+80>>2]=g[m>>2],y=y+84|0,iu(x,v+60|0,y),yc(y),H=D}function r6e(m,f){return m=m|0,f=f|0,f=at(m|0,f|0,52)|0,oe()|0,f&15|0}function Joe(m,f){return m=m|0,f=f|0,f=at(m|0,f|0,45)|0,oe()|0,f&127|0}function cV(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0,P=0;if(!(!0&(f&-16777216|0)==134217728)||(R=at(m|0,f|0,45)|0,oe()|0,R=R&127,R>>>0>121))return f=0,f|0;y=at(m|0,f|0,52)|0,oe()|0,y=y&15;do if(y|0){for(x=1,v=0;;){if(S=at(m|0,f|0,(15-x|0)*3|0)|0,oe()|0,S=S&7,(S|0)!=0&(v^1))if((S|0)==1&(Bn(R)|0)!=0){P=0,v=13;break}else v=1;if((S|0)==7){P=0,v=13;break}if(x>>>0<y>>>0)x=x+1|0;else{v=9;break}}if((v|0)==9){if((y|0)==15)P=1;else break;return P|0}else if((v|0)==13)return P|0}while(0);for(;;){if(P=at(m|0,f|0,(14-y|0)*3|0)|0,oe()|0,!((P&7|0)==7&!0)){P=0,v=13;break}if(y>>>0<14)y=y+1|0;else{P=1,v=13;break}}return(v|0)==13?P|0:0}function uV(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0;if(S=at(m|0,f|0,52)|0,oe()|0,S=S&15,y>>>0>15)return v=4,v|0;if((S|0)<(y|0))return v=12,v|0;if((S|0)==(y|0))return g[v>>2]=m,g[v+4>>2]=f,v=0,v|0;if(x=Et(y|0,0,52)|0,x=x|m,m=oe()|0|f&-15728641,(S|0)>(y|0))do f=Et(7,0,(14-y|0)*3|0)|0,y=y+1|0,x=f|x,m=oe()|0|m;while((y|0)<(S|0));return g[v>>2]=x,g[v+4>>2]=m,v=0,v|0}function aD(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0;if(S=at(m|0,f|0,52)|0,oe()|0,S=S&15,!((y|0)<16&(S|0)<=(y|0)))return v=4,v|0;x=y-S|0,y=at(m|0,f|0,45)|0,oe()|0;e:do if(!(Bn(y&127)|0))y=f_(7,0,x,((x|0)<0)<<31>>31)|0,x=oe()|0;else{t:do if(S|0){for(y=1;R=Et(7,0,(15-y|0)*3|0)|0,!!((R&m|0)==0&((oe()|0)&f|0)==0);)if(y>>>0<S>>>0)y=y+1|0;else break t;y=f_(7,0,x,((x|0)<0)<<31>>31)|0,x=oe()|0;break e}while(0);y=f_(7,0,x,((x|0)<0)<<31>>31)|0,y=vc(y|0,oe()|0,5,0)|0,y=Gi(y|0,oe()|0,-5,-1)|0,y=Ub(y|0,oe()|0,6,0)|0,y=Gi(y|0,oe()|0,1,0)|0,x=oe()|0}while(0);return R=v,g[R>>2]=y,g[R+4>>2]=x,R=0,R|0}function Un(m,f){m=m|0,f=f|0;var y=0,v=0,x=0;if(x=at(m|0,f|0,45)|0,oe()|0,!(Bn(x&127)|0))return x=0,x|0;x=at(m|0,f|0,52)|0,oe()|0,x=x&15;e:do if(!x)y=0;else for(v=1;;){if(y=at(m|0,f|0,(15-v|0)*3|0)|0,oe()|0,y=y&7,y|0)break e;if(v>>>0<x>>>0)v=v+1|0;else{y=0;break}}while(0);return x=(y|0)==0&1,x|0}function i6e(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0;if(R=H,H=H+16|0,S=R,tae(S,m,f,y),f=S,m=g[f>>2]|0,f=g[f+4>>2]|0,(m|0)==0&(f|0)==0)return H=R,0;x=0,y=0;do P=v+(x<<3)|0,g[P>>2]=m,g[P+4>>2]=f,x=Gi(x|0,y|0,1,0)|0,y=oe()|0,rae(S),P=S,m=g[P>>2]|0,f=g[P+4>>2]|0;while(!((m|0)==0&(f|0)==0));return H=R,0}function s6e(m,f,y,v){return m=m|0,f=f|0,y=y|0,v=v|0,(v|0)<(y|0)?(y=f,v=m,Yr(y|0),v|0):(y=Et(-1,-1,((v-y|0)*3|0)+3|0)|0,v=Et(~y|0,~(oe()|0)|0,(15-v|0)*3|0)|0,y=~(oe()|0)&f,v=~v&m,Yr(y|0),v|0)}function n6e(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0;return x=at(m|0,f|0,52)|0,oe()|0,x=x&15,(y|0)<16&(x|0)<=(y|0)?((x|0)<(y|0)&&(x=Et(-1,-1,((y+-1-x|0)*3|0)+3|0)|0,x=Et(~x|0,~(oe()|0)|0,(15-y|0)*3|0)|0,f=~(oe()|0)&f,m=~x&m),x=Et(y|0,0,52)|0,y=f&-15728641|(oe()|0),g[v>>2]=m|x,g[v+4>>2]=y,v=0,v|0):(v=4,v|0)}function o6e(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0,Fe=0,Ee=0,$t=0,Yt=0,wt=0,Lt=0;if((y|0)==0&(v|0)==0)return wt=0,wt|0;if(x=m,S=g[x>>2]|0,x=g[x+4>>2]|0,!0&(x&15728640|0)==0){if(!((v|0)>0|(v|0)==0&y>>>0>0)||(wt=f,g[wt>>2]=S,g[wt+4>>2]=x,(y|0)==1&(v|0)==0))return wt=0,wt|0;x=1;do $t=m+(x<<3)|0,Yt=g[$t+4>>2]|0,wt=f+(x<<3)|0,g[wt>>2]=g[$t>>2],g[wt+4>>2]=Yt,x=x+1|0;while(0<(v|0)|(v|0)==0&x>>>0<y>>>0);return x=0,x|0}if(Ee=y<<3,Yt=tm(Ee)|0,!Yt)return wt=13,wt|0;if(uD(Yt|0,m|0,Ee|0)|0,$t=rm(y,8)|0,!$t)return oi(Yt),wt=13,wt|0;e:do if(y|0){t:for(;;){x=Yt,Ve=g[x>>2]|0,x=g[x+4>>2]|0,Ne=at(Ve|0,x|0,52)|0,oe()|0,Ne=Ne&15,Fe=Ne+-1|0,We=(y|0)>0;r:do if((Ne|0)!=0&We){if(_e=((y|0)<0)<<31>>31,de=Et(Fe|0,0,52)|0,Ce=oe()|0,Fe>>>0>15){if(!((Ve|0)==0&(x|0)==0)){wt=17;break t}for(S=0;;){if(S=S+1|0,(S|0)>=(y|0))break r;if(v=Yt+(S<<3)|0,Ce=g[v>>2]|0,v=g[v+4>>2]|0,!((Ce|0)==0&(v|0)==0)){x=v,wt=17;break t}}}for(S=0,m=Ve,v=x;;){if(!((m|0)==0&(v|0)==0)){if(!(!0&(v&117440512|0)==0)){wt=22;break t}if(P=at(m|0,v|0,52)|0,oe()|0,P=P&15,(P|0)<(Fe|0)){x=12,wt=28;break t}if((P|0)!=(Fe|0)&&(m=m|de,v=v&-15728641|Ce,P>>>0>=Ne>>>0)){R=Fe;do ge=Et(7,0,(14-R|0)*3|0)|0,R=R+1|0,m=ge|m,v=oe()|0|v;while(R>>>0<P>>>0)}if(R=BT(m|0,v|0,y|0,_e|0)|0,oe()|0,U=$t+(R<<3)|0,P=U,D=g[P>>2]|0,P=g[P+4>>2]|0,(D|0)==0&(P|0)==0)R=U;else for(ge=0;;){if((ge|0)>(y|0)){wt=32;break t}if((D|0)==(m|0)&(P&-117440513|0)==(v|0)){Y=at(D|0,P|0,56)|0,oe()|0,Y=Y&7,ne=Y+1|0,Lt=at(D|0,P|0,45)|0,oe()|0;i:do if(!(Bn(Lt&127)|0))P=7;else{if(D=at(D|0,P|0,52)|0,oe()|0,D=D&15,!D){P=6;break}for(P=1;;){if(Lt=Et(7,0,(15-P|0)*3|0)|0,!((Lt&m|0)==0&((oe()|0)&v|0)==0)){P=7;break i}if(P>>>0<D>>>0)P=P+1|0;else{P=6;break}}}while(0);if((Y+2|0)>>>0>P>>>0){wt=42;break t}Lt=Et(ne|0,0,56)|0,v=oe()|0|v&-117440513,ne=U,g[ne>>2]=0,g[ne+4>>2]=0,m=Lt|m}else R=(R+1|0)%(y|0)|0;if(U=$t+(R<<3)|0,P=U,D=g[P>>2]|0,P=g[P+4>>2]|0,(D|0)==0&(P|0)==0){R=U;break}else ge=ge+1|0}Lt=R,g[Lt>>2]=m,g[Lt+4>>2]=v}if(S=S+1|0,(S|0)>=(y|0))break r;v=Yt+(S<<3)|0,m=g[v>>2]|0,v=g[v+4>>2]|0}}while(0);if((y+5|0)>>>0<11){wt=85;break}if(Ce=rm((y|0)/6|0,8)|0,!Ce){wt=49;break}r:do if(We){ge=0,ne=0;do{if(P=$t+(ge<<3)|0,v=P,S=g[v>>2]|0,v=g[v+4>>2]|0,!((S|0)==0&(v|0)==0)){D=at(S|0,v|0,56)|0,oe()|0,D=D&7,m=D+1|0,U=v&-117440513,Lt=at(S|0,v|0,45)|0,oe()|0;i:do if(Bn(Lt&127)|0){if(Y=at(S|0,v|0,52)|0,oe()|0,Y=Y&15,Y|0)for(R=1;;){if(Lt=Et(7,0,(15-R|0)*3|0)|0,!((S&Lt|0)==0&(U&(oe()|0)|0)==0))break i;if(R>>>0<Y>>>0)R=R+1|0;else break}v=Et(m|0,0,56)|0,S=v|S,v=oe()|0|U,m=P,g[m>>2]=S,g[m+4>>2]=v,m=D+2|0}while(0);(m|0)==7&&(Lt=Ce+(ne<<3)|0,g[Lt>>2]=S,g[Lt+4>>2]=v&-117440513,ne=ne+1|0)}ge=ge+1|0}while((ge|0)!=(y|0));if(We){if(ge=((y|0)<0)<<31>>31,_e=Et(Fe|0,0,52)|0,de=oe()|0,Fe>>>0>15){if(!((Ve|0)==0&(x|0)==0)){x=4,wt=84;break t}for(x=0;;){if(x=x+1|0,(x|0)>=(y|0)){S=0,x=ne;break r}if(Lt=Yt+(x<<3)|0,!((g[Lt>>2]|0)==0&(g[Lt+4>>2]|0)==0)){x=4,wt=84;break t}}}for(Y=0,S=0,U=Ve;;){do if(!((U|0)==0&(x|0)==0)){if(P=at(U|0,x|0,52)|0,oe()|0,P=P&15,(P|0)<(Fe|0)){x=12,wt=84;break t}do if((P|0)==(Fe|0))v=U,P=x;else{if(v=U|_e,m=x&-15728641|de,P>>>0<Ne>>>0){P=m;break}R=Fe;do Lt=Et(7,0,(14-R|0)*3|0)|0,R=R+1|0,v=Lt|v,m=oe()|0|m;while(R>>>0<P>>>0);P=m}while(0);for(R=BT(v|0,P|0,y|0,ge|0)|0,oe()|0,m=0;;){if((m|0)>(y|0)){wt=77;break t}if(Lt=$t+(R<<3)|0,D=g[Lt+4>>2]|0,(D&-117440513|0)==(P|0)&&(g[Lt>>2]|0)==(v|0)){wt=79;break}if(R=(R+1|0)%(y|0)|0,Lt=$t+(R<<3)|0,(g[Lt>>2]|0)==(v|0)&&(g[Lt+4>>2]|0)==(P|0))break;m=m+1|0}if((wt|0)==79&&(wt=0,!0&(D&117440512|0)==100663296))break;Lt=f+(S<<3)|0,g[Lt>>2]=U,g[Lt+4>>2]=x,S=S+1|0}while(0);if(x=Y+1|0,(x|0)>=(y|0)){x=ne;break r}Lt=Yt+(x<<3)|0,Y=x,U=g[Lt>>2]|0,x=g[Lt+4>>2]|0}}else S=0,x=ne}else S=0,x=0;while(0);if(Vb($t|0,0,Ee|0)|0,uD(Yt|0,Ce|0,x<<3|0)|0,oi(Ce),x)f=f+(S<<3)|0,y=x;else break e}if((wt|0)==17)!0&(x&117440512|0)==0?(x=4,wt=28):wt=22;else if((wt|0)==32)vr(23313,22674,362,22684);else{if((wt|0)==42)return oi(Yt),oi($t),Lt=10,Lt|0;if((wt|0)==49)return oi(Yt),oi($t),Lt=13,Lt|0;if((wt|0)==77)vr(23313,22674,462,22684);else{if((wt|0)==84)return oi(Ce),oi(Yt),oi($t),Lt=x,Lt|0;if((wt|0)==85){uD(f|0,Yt|0,y<<3|0)|0;break}}}if((wt|0)==22)return oi(Yt),oi($t),Lt=5,Lt|0;if((wt|0)==28)return oi(Yt),oi($t),Lt=x,Lt|0}while(0);return oi(Yt),oi($t),Lt=0,Lt|0}function a6e(m,f,y,v,x,S,R){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0,S=S|0,R=R|0;var P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0;if(Ce=H,H=H+16|0,de=Ce,!((y|0)>0|(y|0)==0&f>>>0>0))return de=0,H=Ce,de|0;if((R|0)>=16)return de=12,H=Ce,de|0;ge=0,_e=0,ne=0,P=0;e:for(;;){if(U=m+(ge<<3)|0,D=g[U>>2]|0,U=g[U+4>>2]|0,Y=at(D|0,U|0,52)|0,oe()|0,(Y&15|0)>(R|0)){P=12,D=11;break}if(tae(de,D,U,R),Y=de,U=g[Y>>2]|0,Y=g[Y+4>>2]|0,(U|0)==0&(Y|0)==0)D=ne;else{D=ne;do{if(!((P|0)<(S|0)|(P|0)==(S|0)&D>>>0<x>>>0)){D=10;break e}ne=v+(D<<3)|0,g[ne>>2]=U,g[ne+4>>2]=Y,D=Gi(D|0,P|0,1,0)|0,P=oe()|0,rae(de),ne=de,U=g[ne>>2]|0,Y=g[ne+4>>2]|0}while(!((U|0)==0&(Y|0)==0))}if(ge=Gi(ge|0,_e|0,1,0)|0,_e=oe()|0,(_e|0)<(y|0)|(_e|0)==(y|0)&ge>>>0<f>>>0)ne=D;else{P=0,D=11;break}}return(D|0)==10?(de=14,H=Ce,de|0):(D|0)==11?(H=Ce,P|0):0}function l6e(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0;ge=H,H=H+16|0,ne=ge;e:do if((y|0)>0|(y|0)==0&f>>>0>0){for(U=0,R=0,S=0,Y=0;;){if(D=m+(U<<3)|0,P=g[D>>2]|0,D=g[D+4>>2]|0,!((P|0)==0&(D|0)==0)&&(D=(aD(P,D,v,ne)|0)==0,P=ne,R=Gi(g[P>>2]|0,g[P+4>>2]|0,R|0,S|0)|0,S=oe()|0,!D)){S=12;break}if(U=Gi(U|0,Y|0,1,0)|0,Y=oe()|0,!((Y|0)<(y|0)|(Y|0)==(y|0)&U>>>0<f>>>0))break e}return H=ge,S|0}else R=0,S=0;while(0);return g[x>>2]=R,g[x+4>>2]=S,x=0,H=ge,x|0}function c6e(m,f){return m=m|0,f=f|0,f=at(m|0,f|0,52)|0,oe()|0,f&1|0}function Qu(m,f){m=m|0,f=f|0;var y=0,v=0,x=0;if(x=at(m|0,f|0,52)|0,oe()|0,x=x&15,!x)return x=0,x|0;for(v=1;;){if(y=at(m|0,f|0,(15-v|0)*3|0)|0,oe()|0,y=y&7,y|0){v=5;break}if(v>>>0<x>>>0)v=v+1|0;else{y=0,v=5;break}}return(v|0)==5?y|0:0}function hV(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0,P=0,D=0;if(D=at(m|0,f|0,52)|0,oe()|0,D=D&15,!D)return P=f,D=m,Yr(P|0),D|0;for(P=1,y=0;;){S=(15-P|0)*3|0,v=Et(7,0,S|0)|0,x=oe()|0,R=at(m|0,f|0,S|0)|0,oe()|0,S=Et(kb(R&7)|0,0,S|0)|0,R=oe()|0,m=S|m&~v,f=R|f&~x;e:do if(!y)if((S&v|0)==0&(R&x|0)==0)y=0;else if(v=at(m|0,f|0,52)|0,oe()|0,v=v&15,!v)y=1;else{y=1;t:for(;;){switch(R=at(m|0,f|0,(15-y|0)*3|0)|0,oe()|0,R&7){case 1:break t;case 0:break;default:{y=1;break e}}if(y>>>0<v>>>0)y=y+1|0;else{y=1;break e}}for(y=1;;)if(R=(15-y|0)*3|0,x=at(m|0,f|0,R|0)|0,oe()|0,S=Et(7,0,R|0)|0,f=f&~(oe()|0),R=Et(kb(x&7)|0,0,R|0)|0,m=m&~S|R,f=f|(oe()|0),y>>>0<v>>>0)y=y+1|0;else{y=1;break}}while(0);if(P>>>0<D>>>0)P=P+1|0;else break}return Yr(f|0),m|0}function Bb(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0;if(v=at(m|0,f|0,52)|0,oe()|0,v=v&15,!v)return y=f,v=m,Yr(y|0),v|0;for(y=1;S=(15-y|0)*3|0,R=at(m|0,f|0,S|0)|0,oe()|0,x=Et(7,0,S|0)|0,f=f&~(oe()|0),S=Et(kb(R&7)|0,0,S|0)|0,m=S|m&~x,f=oe()|0|f,y>>>0<v>>>0;)y=y+1|0;return Yr(f|0),m|0}function u6e(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0,P=0,D=0;if(D=at(m|0,f|0,52)|0,oe()|0,D=D&15,!D)return P=f,D=m,Yr(P|0),D|0;for(P=1,y=0;;){S=(15-P|0)*3|0,v=Et(7,0,S|0)|0,x=oe()|0,R=at(m|0,f|0,S|0)|0,oe()|0,S=Et(p_(R&7)|0,0,S|0)|0,R=oe()|0,m=S|m&~v,f=R|f&~x;e:do if(!y)if((S&v|0)==0&(R&x|0)==0)y=0;else if(v=at(m|0,f|0,52)|0,oe()|0,v=v&15,!v)y=1;else{y=1;t:for(;;){switch(R=at(m|0,f|0,(15-y|0)*3|0)|0,oe()|0,R&7){case 1:break t;case 0:break;default:{y=1;break e}}if(y>>>0<v>>>0)y=y+1|0;else{y=1;break e}}for(y=1;;)if(x=(15-y|0)*3|0,S=Et(7,0,x|0)|0,R=f&~(oe()|0),f=at(m|0,f|0,x|0)|0,oe()|0,f=Et(p_(f&7)|0,0,x|0)|0,m=m&~S|f,f=R|(oe()|0),y>>>0<v>>>0)y=y+1|0;else{y=1;break}}while(0);if(P>>>0<D>>>0)P=P+1|0;else break}return Yr(f|0),m|0}function dV(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0;if(v=at(m|0,f|0,52)|0,oe()|0,v=v&15,!v)return y=f,v=m,Yr(y|0),v|0;for(y=1;R=(15-y|0)*3|0,S=Et(7,0,R|0)|0,x=f&~(oe()|0),f=at(m|0,f|0,R|0)|0,oe()|0,f=Et(p_(f&7)|0,0,R|0)|0,m=f|m&~S,f=oe()|0|x,y>>>0<v>>>0;)y=y+1|0;return Yr(f|0),m|0}function h6e(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0;if(D=H,H=H+64|0,P=D+40|0,v=D+24|0,x=D+12|0,S=D,Et(f|0,0,52)|0,y=oe()|0|134225919,!f)return(g[m+4>>2]|0)>2||(g[m+8>>2]|0)>2||(g[m+12>>2]|0)>2?(R=0,P=0,Yr(R|0),H=D,P|0):(Et(koe(m)|0,0,45)|0,R=oe()|0|y,P=-1,Yr(R|0),H=D,P|0);if(g[P>>2]=g[m>>2],g[P+4>>2]=g[m+4>>2],g[P+8>>2]=g[m+8>>2],g[P+12>>2]=g[m+12>>2],R=P+4|0,(f|0)>0)for(m=-1;g[v>>2]=g[R>>2],g[v+4>>2]=g[R+4>>2],g[v+8>>2]=g[R+8>>2],f&1?(UFe(R),g[x>>2]=g[R>>2],g[x+4>>2]=g[R+4>>2],g[x+8>>2]=g[R+8>>2],sD(x)):(joe(R),g[x>>2]=g[R>>2],g[x+4>>2]=g[R+4>>2],g[x+8>>2]=g[R+8>>2],Fb(x)),nV(v,x,S),yc(S),Y=(15-f|0)*3|0,U=Et(7,0,Y|0)|0,y=y&~(oe()|0),Y=Et(iD(S)|0,0,Y|0)|0,m=Y|m&~U,y=oe()|0|y,(f|0)>1;)f=f+-1|0;else m=-1;e:do if((g[R>>2]|0)<=2&&(g[P+8>>2]|0)<=2&&(g[P+12>>2]|0)<=2){if(v=koe(P)|0,f=Et(v|0,0,45)|0,f=f|m,m=oe()|0|y&-1040385,S=OFe(P)|0,!(Bn(v)|0)){if((S|0)<=0)break;for(x=0;;){if(v=at(f|0,m|0,52)|0,oe()|0,v=v&15,v)for(y=1;Y=(15-y|0)*3|0,P=at(f|0,m|0,Y|0)|0,oe()|0,U=Et(7,0,Y|0)|0,m=m&~(oe()|0),Y=Et(kb(P&7)|0,0,Y|0)|0,f=f&~U|Y,m=m|(oe()|0),y>>>0<v>>>0;)y=y+1|0;if(x=x+1|0,(x|0)==(S|0))break e}}x=at(f|0,m|0,52)|0,oe()|0,x=x&15;t:do if(x){y=1;r:for(;;){switch(Y=at(f|0,m|0,(15-y|0)*3|0)|0,oe()|0,Y&7){case 1:break r;case 0:break;default:break t}if(y>>>0<x>>>0)y=y+1|0;else break t}if(Boe(v,g[P>>2]|0)|0)for(y=1;P=(15-y|0)*3|0,U=Et(7,0,P|0)|0,Y=m&~(oe()|0),m=at(f|0,m|0,P|0)|0,oe()|0,m=Et(p_(m&7)|0,0,P|0)|0,f=f&~U|m,m=Y|(oe()|0),y>>>0<x>>>0;)y=y+1|0;else for(y=1;Y=(15-y|0)*3|0,P=at(f|0,m|0,Y|0)|0,oe()|0,U=Et(7,0,Y|0)|0,m=m&~(oe()|0),Y=Et(kb(P&7)|0,0,Y|0)|0,f=f&~U|Y,m=m|(oe()|0),y>>>0<x>>>0;)y=y+1|0}while(0);if((S|0)>0){y=0;do f=hV(f,m)|0,m=oe()|0,y=y+1|0;while((y|0)!=(S|0))}}else f=0,m=0;while(0);return U=m,Y=f,Yr(U|0),H=D,Y|0}function Jd(m){return m=m|0,(m|0)%2|0|0}function Koe(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0;return x=H,H=H+16|0,v=x,f>>>0>15?(v=4,H=x,v|0):(g[m+4>>2]&2146435072|0)==2146435072||(g[m+8+4>>2]&2146435072|0)==2146435072?(v=3,H=x,v|0):(ZFe(m,f,v),f=h6e(v,f)|0,v=oe()|0,g[y>>2]=f,g[y+4>>2]=v,(f|0)==0&(v|0)==0&&vr(23313,22674,786,22697),v=0,H=x,v|0)}function pV(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0;if(x=y+4|0,S=at(m|0,f|0,52)|0,oe()|0,S=S&15,R=at(m|0,f|0,45)|0,oe()|0,v=(S|0)==0,Bn(R&127)|0){if(v)return R=1,R|0;v=1}else{if(v)return R=0,R|0;!(g[x>>2]|0)&&!(g[y+8>>2]|0)?v=(g[y+12>>2]|0)!=0&1:v=1}for(y=1;y&1?sD(x):Fb(x),R=at(m|0,f|0,(15-y|0)*3|0)|0,oe()|0,Hoe(x,R&7),y>>>0<S>>>0;)y=y+1|0;return v|0}function FT(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0;if(Y=H,H=H+16|0,D=Y,U=at(m|0,f|0,45)|0,oe()|0,U=U&127,U>>>0>121)return g[y>>2]=0,g[y+4>>2]=0,g[y+8>>2]=0,g[y+12>>2]=0,U=5,H=Y,U|0;e:do if(Bn(U)|0&&(S=at(m|0,f|0,52)|0,oe()|0,S=S&15,(S|0)!=0)){v=1;t:for(;;){switch(P=at(m|0,f|0,(15-v|0)*3|0)|0,oe()|0,P&7){case 5:break t;case 0:break;default:{v=f;break e}}if(v>>>0<S>>>0)v=v+1|0;else{v=f;break e}}for(x=1,v=f;f=(15-x|0)*3|0,R=Et(7,0,f|0)|0,P=v&~(oe()|0),v=at(m|0,v|0,f|0)|0,oe()|0,v=Et(p_(v&7)|0,0,f|0)|0,m=m&~R|v,v=P|(oe()|0),x>>>0<S>>>0;)x=x+1|0}else v=f;while(0);if(P=7696+(U*28|0)|0,g[y>>2]=g[P>>2],g[y+4>>2]=g[P+4>>2],g[y+8>>2]=g[P+8>>2],g[y+12>>2]=g[P+12>>2],!(pV(m,v,y)|0))return U=0,H=Y,U|0;if(R=y+4|0,g[D>>2]=g[R>>2],g[D+4>>2]=g[R+4>>2],g[D+8>>2]=g[R+8>>2],S=at(m|0,v|0,52)|0,oe()|0,P=S&15,S&1?(Fb(R),S=P+1|0):S=P,!(Bn(U)|0))v=0;else{e:do if(!P)v=0;else for(f=1;;){if(x=at(m|0,v|0,(15-f|0)*3|0)|0,oe()|0,x=x&7,x|0){v=x;break e}if(f>>>0<P>>>0)f=f+1|0;else{v=0;break}}while(0);v=(v|0)==4&1}if(!(NT(y,S,v,0)|0))(S|0)!=(P|0)&&(g[R>>2]=g[D>>2],g[R+4>>2]=g[D+4>>2],g[R+8>>2]=g[D+8>>2]);else{if(Bn(U)|0)do;while(NT(y,S,0,0)|0);(S|0)!=(P|0)&&joe(R)}return U=0,H=Y,U|0}function cR(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0;return S=H,H=H+16|0,v=S,x=FT(m,f,v)|0,x|0?(H=S,x|0):(x=at(m|0,f|0,52)|0,oe()|0,e6e(v,x&15,y),x=0,H=S,x|0)}function uR(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0;if(R=H,H=H+16|0,S=R,v=FT(m,f,S)|0,v|0)return S=v,H=R,S|0;v=at(m|0,f|0,45)|0,oe()|0,v=(Bn(v&127)|0)==0,x=at(m|0,f|0,52)|0,oe()|0,x=x&15;e:do if(!v){if(x|0)for(v=1;;){if(P=Et(7,0,(15-v|0)*3|0)|0,!((P&m|0)==0&((oe()|0)&f|0)==0))break e;if(v>>>0<x>>>0)v=v+1|0;else break}return aV(S,x,0,5,y),P=0,H=R,P|0}while(0);return lV(S,x,0,6,y),P=0,H=R,P|0}function d6e(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0;if(x=at(m|0,f|0,45)|0,oe()|0,!(Bn(x&127)|0))return x=2,g[y>>2]=x,0;if(x=at(m|0,f|0,52)|0,oe()|0,x=x&15,!x)return x=5,g[y>>2]=x,0;for(v=1;;){if(S=Et(7,0,(15-v|0)*3|0)|0,!((S&m|0)==0&((oe()|0)&f|0)==0)){v=2,m=6;break}if(v>>>0<x>>>0)v=v+1|0;else{v=5,m=6;break}}return(m|0)==6&&(g[y>>2]=v),0}function eae(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0;ne=H,H=H+128|0,U=ne+112|0,S=ne+96|0,Y=ne,x=at(m|0,f|0,52)|0,oe()|0,P=x&15,g[U>>2]=P,R=at(m|0,f|0,45)|0,oe()|0,R=R&127;e:do if(Bn(R)|0){if(P|0)for(v=1;;){if(D=Et(7,0,(15-v|0)*3|0)|0,!((D&m|0)==0&((oe()|0)&f|0)==0)){x=0;break e}if(v>>>0<P>>>0)v=v+1|0;else break}if(x&1)x=1;else return D=Et(P+1|0,0,52)|0,Y=oe()|0|f&-15728641,U=Et(7,0,(14-P|0)*3|0)|0,Y=eae((D|m)&~U,Y&~(oe()|0),y)|0,H=ne,Y|0}else x=0;while(0);if(v=FT(m,f,S)|0,!v){x?(Xoe(S,U,Y),D=5):(Zoe(S,U,Y),D=6);e:do if(Bn(R)|0)if(!P)m=5;else for(v=1;;){if(R=Et(7,0,(15-v|0)*3|0)|0,!((R&m|0)==0&((oe()|0)&f|0)==0)){m=2;break e}if(v>>>0<P>>>0)v=v+1|0;else{m=5;break}}else m=2;while(0);Vb(y|0,-1,m<<2|0)|0;e:do if(x)for(S=0;;){if(R=Y+(S<<4)|0,t6e(R,g[U>>2]|0)|0,R=g[R>>2]|0,P=g[y>>2]|0,(P|0)==-1|(P|0)==(R|0))v=y;else{x=0;do{if(x=x+1|0,x>>>0>=m>>>0){v=1;break e}v=y+(x<<2)|0,P=g[v>>2]|0}while(!((P|0)==-1|(P|0)==(R|0)))}if(g[v>>2]=R,S=S+1|0,S>>>0>=D>>>0){v=0;break}}else for(S=0;;){if(R=Y+(S<<4)|0,NT(R,g[U>>2]|0,0,1)|0,R=g[R>>2]|0,P=g[y>>2]|0,(P|0)==-1|(P|0)==(R|0))v=y;else{x=0;do{if(x=x+1|0,x>>>0>=m>>>0){v=1;break e}v=y+(x<<2)|0,P=g[v>>2]|0}while(!((P|0)==-1|(P|0)==(R|0)))}if(g[v>>2]=R,S=S+1|0,S>>>0>=D>>>0){v=0;break}}while(0)}return Y=v,H=ne,Y|0}function p6e(){return 12}function fV(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0,P=0,D=0;if(m>>>0>15)return P=4,P|0;if(Et(m|0,0,52)|0,P=oe()|0|134225919,!m){y=0,v=0;do Bn(v)|0&&(Et(v|0,0,45)|0,R=P|(oe()|0),m=f+(y<<3)|0,g[m>>2]=-1,g[m+4>>2]=R,y=y+1|0),v=v+1|0;while((v|0)!=122);return y=0,y|0}y=0,R=0;do{if(Bn(R)|0){for(Et(R|0,0,45)|0,v=1,x=-1,S=P|(oe()|0);D=Et(7,0,(15-v|0)*3|0)|0,x=x&~D,S=S&~(oe()|0),(v|0)!=(m|0);)v=v+1|0;D=f+(y<<3)|0,g[D>>2]=x,g[D+4>>2]=S,y=y+1|0}R=R+1|0}while((R|0)!=122);return y=0,y|0}function f6e(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0;if(Ne=H,H=H+16|0,We=Ne,Ve=at(m|0,f|0,52)|0,oe()|0,Ve=Ve&15,y>>>0>15)return Ve=4,H=Ne,Ve|0;if((Ve|0)<(y|0))return Ve=12,H=Ne,Ve|0;if((Ve|0)!=(y|0))if(S=Et(y|0,0,52)|0,S=S|m,P=oe()|0|f&-15728641,(Ve|0)>(y|0)){D=y;do Ce=Et(7,0,(14-D|0)*3|0)|0,D=D+1|0,S=Ce|S,P=oe()|0|P;while((D|0)<(Ve|0));Ce=S}else Ce=S;else Ce=m,P=f;de=at(Ce|0,P|0,45)|0,oe()|0;e:do if(Bn(de&127)|0){if(D=at(Ce|0,P|0,52)|0,oe()|0,D=D&15,D|0)for(S=1;;){if(de=Et(7,0,(15-S|0)*3|0)|0,!((de&Ce|0)==0&((oe()|0)&P|0)==0)){U=33;break e}if(S>>>0<D>>>0)S=S+1|0;else break}if(de=v,g[de>>2]=0,g[de+4>>2]=0,(Ve|0)>(y|0)){for(de=f&-15728641,_e=Ve;;){if(ge=_e,_e=_e+-1|0,_e>>>0>15|(Ve|0)<(_e|0)){U=19;break}if((Ve|0)!=(_e|0))if(S=Et(_e|0,0,52)|0,S=S|m,D=oe()|0|de,(Ve|0)<(ge|0))ne=S;else{U=_e;do ne=Et(7,0,(14-U|0)*3|0)|0,U=U+1|0,S=ne|S,D=oe()|0|D;while((U|0)<(Ve|0));ne=S}else ne=m,D=f;if(Y=at(ne|0,D|0,45)|0,oe()|0,!(Bn(Y&127)|0))S=0;else{Y=at(ne|0,D|0,52)|0,oe()|0,Y=Y&15;t:do if(!Y)S=0;else for(U=1;;){if(S=at(ne|0,D|0,(15-U|0)*3|0)|0,oe()|0,S=S&7,S|0)break t;if(U>>>0<Y>>>0)U=U+1|0;else{S=0;break}}while(0);S=(S|0)==0&1}if(D=at(m|0,f|0,(15-ge|0)*3|0)|0,oe()|0,D=D&7,(D|0)==7){x=5,U=42;break}if(S=(S|0)!=0,(D|0)==1&S){x=5,U=42;break}if(ne=D+(((D|0)!=0&S)<<31>>31)|0,ne|0&&(U=Ve-ge|0,U=f_(7,0,U,((U|0)<0)<<31>>31)|0,Y=oe()|0,S?(S=vc(U|0,Y|0,5,0)|0,S=Gi(S|0,oe()|0,-5,-1)|0,S=Ub(S|0,oe()|0,6,0)|0,S=Gi(S|0,oe()|0,1,0)|0,D=oe()|0):(S=U,D=Y),ge=ne+-1|0,ge=vc(U|0,Y|0,ge|0,((ge|0)<0)<<31>>31|0)|0,ge=Gi(S|0,D|0,ge|0,oe()|0)|0,ne=oe()|0,Y=v,Y=Gi(ge|0,ne|0,g[Y>>2]|0,g[Y+4>>2]|0)|0,ne=oe()|0,ge=v,g[ge>>2]=Y,g[ge+4>>2]=ne),(_e|0)<=(y|0)){U=37;break}}if((U|0)==19)vr(23313,22674,1099,22710);else if((U|0)==37){R=v,x=g[R+4>>2]|0,R=g[R>>2]|0;break}else if((U|0)==42)return H=Ne,x|0}else x=0,R=0}else U=33;while(0);e:do if((U|0)==33)if(de=v,g[de>>2]=0,g[de+4>>2]=0,(Ve|0)>(y|0)){for(S=Ve;;){if(x=at(m|0,f|0,(15-S|0)*3|0)|0,oe()|0,x=x&7,(x|0)==7){x=5;break}if(R=Ve-S|0,R=f_(7,0,R,((R|0)<0)<<31>>31)|0,x=vc(R|0,oe()|0,x|0,0)|0,R=oe()|0,de=v,R=Gi(g[de>>2]|0,g[de+4>>2]|0,x|0,R|0)|0,x=oe()|0,de=v,g[de>>2]=R,g[de+4>>2]=x,S=S+-1|0,(S|0)<=(y|0))break e}return H=Ne,x|0}else x=0,R=0;while(0);return aD(Ce,P,Ve,We)|0&&vr(23313,22674,1063,22725),Ve=We,We=g[Ve+4>>2]|0,((x|0)>-1|(x|0)==-1&R>>>0>4294967295)&((We|0)>(x|0)|((We|0)==(x|0)?(g[Ve>>2]|0)>>>0>R>>>0:0))?(Ve=0,H=Ne,Ve|0):(vr(23313,22674,1139,22710),0)}function m6e(m,f,y,v,x,S){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0,S=S|0;var R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0;if(ne=H,H=H+16|0,R=ne,x>>>0>15)return S=4,H=ne,S|0;if(P=at(y|0,v|0,52)|0,oe()|0,P=P&15,(P|0)>(x|0))return S=12,H=ne,S|0;if(aD(y,v,x,R)|0&&vr(23313,22674,1063,22725),Y=R,U=g[Y+4>>2]|0,!(((f|0)>-1|(f|0)==-1&m>>>0>4294967295)&((U|0)>(f|0)|((U|0)==(f|0)?(g[Y>>2]|0)>>>0>m>>>0:0))))return S=2,H=ne,S|0;Y=x-P|0,x=Et(x|0,0,52)|0,D=oe()|0|v&-15728641,U=S,g[U>>2]=x|y,g[U+4>>2]=D,U=at(y|0,v|0,45)|0,oe()|0;e:do if(Bn(U&127)|0){if(P|0)for(R=1;;){if(U=Et(7,0,(15-R|0)*3|0)|0,!((U&y|0)==0&((oe()|0)&v|0)==0))break e;if(R>>>0<P>>>0)R=R+1|0;else break}if((Y|0)<1)return S=0,H=ne,S|0;for(U=P^15,v=-1,D=1,R=1;;){P=Y-D|0,P=f_(7,0,P,((P|0)<0)<<31>>31)|0,y=oe()|0;do if(R)if(R=vc(P|0,y|0,5,0)|0,R=Gi(R|0,oe()|0,-5,-1)|0,R=Ub(R|0,oe()|0,6,0)|0,x=oe()|0,(f|0)>(x|0)|(f|0)==(x|0)&m>>>0>R>>>0){f=Gi(m|0,f|0,-1,-1)|0,f=_c(f|0,oe()|0,R|0,x|0)|0,R=oe()|0,ge=S,de=g[ge>>2]|0,ge=g[ge+4>>2]|0,Ce=(U+v|0)*3|0,_e=Et(7,0,Ce|0)|0,ge=ge&~(oe()|0),v=Ub(f|0,R|0,P|0,y|0)|0,m=oe()|0,x=Gi(v|0,m|0,2,0)|0,Ce=Et(x|0,oe()|0,Ce|0)|0,ge=oe()|0|ge,x=S,g[x>>2]=Ce|de&~_e,g[x+4>>2]=ge,m=vc(v|0,m|0,P|0,y|0)|0,m=_c(f|0,R|0,m|0,oe()|0)|0,R=0,f=oe()|0;break}else{Ce=S,_e=g[Ce>>2]|0,Ce=g[Ce+4>>2]|0,de=Et(7,0,(U+v|0)*3|0)|0,Ce=Ce&~(oe()|0),R=S,g[R>>2]=_e&~de,g[R+4>>2]=Ce,R=1;break}else _e=S,x=g[_e>>2]|0,_e=g[_e+4>>2]|0,v=(U+v|0)*3|0,ge=Et(7,0,v|0)|0,_e=_e&~(oe()|0),Ce=Ub(m|0,f|0,P|0,y|0)|0,R=oe()|0,v=Et(Ce|0,R|0,v|0)|0,_e=oe()|0|_e,de=S,g[de>>2]=v|x&~ge,g[de+4>>2]=_e,R=vc(Ce|0,R|0,P|0,y|0)|0,m=_c(m|0,f|0,R|0,oe()|0)|0,R=0,f=oe()|0;while(0);if((Y|0)>(D|0))v=~D,D=D+1|0;else{f=0;break}}return H=ne,f|0}while(0);if((Y|0)<1)return Ce=0,H=ne,Ce|0;for(x=P^15,R=1;;)if(de=Y-R|0,de=f_(7,0,de,((de|0)<0)<<31>>31)|0,Ce=oe()|0,D=S,y=g[D>>2]|0,D=g[D+4>>2]|0,P=(x-R|0)*3|0,v=Et(7,0,P|0)|0,D=D&~(oe()|0),ge=Ub(m|0,f|0,de|0,Ce|0)|0,_e=oe()|0,P=Et(ge|0,_e|0,P|0)|0,D=oe()|0|D,U=S,g[U>>2]=P|y&~v,g[U+4>>2]=D,Ce=vc(ge|0,_e|0,de|0,Ce|0)|0,m=_c(m|0,f|0,Ce|0,oe()|0)|0,f=oe()|0,(Y|0)<=(R|0)){f=0;break}else R=R+1|0;return H=ne,f|0}function tae(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0;x=at(f|0,y|0,52)|0,oe()|0,x=x&15,(f|0)==0&(y|0)==0|((v|0)>15|(x|0)>(v|0))?(v=-1,x=-1,f=0,y=0):(S=s6e(f,y,x+1|0,v)|0,y=(oe()|0)&-15728641,f=Et(v|0,0,52)|0,f=S|f,y=y|(oe()|0),S=(Un(f,y)|0)==0,v=S?-1:v),S=m,g[S>>2]=f,g[S+4>>2]=y,g[m+8>>2]=x,g[m+12>>2]=v}function rae(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0,D=0,U=0;if(y=m,f=g[y>>2]|0,y=g[y+4>>2]|0,!((f|0)==0&(y|0)==0)&&(v=at(f|0,y|0,52)|0,oe()|0,v=v&15,P=Et(1,0,(v^15)*3|0)|0,f=Gi(P|0,oe()|0,f|0,y|0)|0,y=oe()|0,P=m,g[P>>2]=f,g[P+4>>2]=y,P=m+8|0,R=g[P>>2]|0,!((v|0)<(R|0)))){for(D=m+12|0,S=v;;){if((S|0)==(R|0)){v=5;break}if(U=(S|0)==(g[D>>2]|0),x=(15-S|0)*3|0,v=at(f|0,y|0,x|0)|0,oe()|0,v=v&7,U&((v|0)==1&!0)){v=7;break}if(!((v|0)==7&!0)){v=10;break}if(U=Et(1,0,x|0)|0,f=Gi(f|0,y|0,U|0,oe()|0)|0,y=oe()|0,U=m,g[U>>2]=f,g[U+4>>2]=y,(S|0)>(R|0))S=S+-1|0;else{v=10;break}}if((v|0)==5){U=m,g[U>>2]=0,g[U+4>>2]=0,g[P>>2]=-1,g[D>>2]=-1;return}else if((v|0)==7){R=Et(1,0,x|0)|0,R=Gi(f|0,y|0,R|0,oe()|0)|0,P=oe()|0,U=m,g[U>>2]=R,g[U+4>>2]=P,g[D>>2]=S+-1;return}else if((v|0)==10)return}}function hR(m){m=+m;var f=0;return f=m<0?m+6.283185307179586:m,+(m>=6.283185307179586?f+-6.283185307179586:f)}function kT(m,f){return m=m|0,f=f|0,+Wr(+(+K[m>>3]-+K[f>>3]))<17453292519943298e-27?(f=+Wr(+(+K[m+8>>3]-+K[f+8>>3]))<17453292519943298e-27,f|0):(f=0,f|0)}function g6e(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0;return x=+K[f>>3],v=+K[m>>3],S=+Dr(+((x-v)*.5)),y=+Dr(+((+K[f+8>>3]-+K[m+8>>3])*.5)),y=S*S+y*(+hs(+x)*+hs(+v)*y),+(+Kn(+ +vi(+y),+ +vi(+(1-y)))*2)}function dR(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0;return x=+K[f>>3],v=+K[m>>3],S=+Dr(+((x-v)*.5)),y=+Dr(+((+K[f+8>>3]-+K[m+8>>3])*.5)),y=S*S+y*(+hs(+x)*+hs(+v)*y),+(+Kn(+ +vi(+y),+ +vi(+(1-y)))*2*6371.007180918475)}function A6e(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0;return x=+K[f>>3],v=+K[m>>3],S=+Dr(+((x-v)*.5)),y=+Dr(+((+K[f+8>>3]-+K[m+8>>3])*.5)),y=S*S+y*(+hs(+x)*+hs(+v)*y),+(+Kn(+ +vi(+y),+ +vi(+(1-y)))*2*6371.007180918475*1e3)}function y6e(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0;return S=+K[f>>3],v=+hs(+S),x=+K[f+8>>3]-+K[m+8>>3],R=v*+Dr(+x),y=+K[m>>3],+ +Kn(+R,+(+Dr(+S)*+hs(+y)-+hs(+x)*(v*+Dr(+y))))}function _6e(m,f,y,v){m=m|0,f=+f,y=+y,v=v|0;var x=0,S=0,R=0,P=0;if(y<1e-16){g[v>>2]=g[m>>2],g[v+4>>2]=g[m+4>>2],g[v+8>>2]=g[m+8>>2],g[v+12>>2]=g[m+12>>2];return}S=f<0?f+6.283185307179586:f,S=f>=6.283185307179586?S+-6.283185307179586:S;do if(S<1e-16)f=+K[m>>3]+y,K[v>>3]=f,x=v;else{if(x=+Wr(+(S+-3.141592653589793))<1e-16,f=+K[m>>3],x){f=f-y,K[v>>3]=f,x=v;break}if(R=+hs(+y),y=+Dr(+y),f=R*+Dr(+f)+ +hs(+S)*(y*+hs(+f)),f=f>1?1:f,f=+_a(+(f<-1?-1:f)),K[v>>3]=f,+Wr(+(f+-1.5707963267948966))<1e-16){K[v>>3]=1.5707963267948966,K[v+8>>3]=0;return}if(+Wr(+(f+1.5707963267948966))<1e-16){K[v>>3]=-1.5707963267948966,K[v+8>>3]=0;return}if(P=+hs(+f),S=y*+Dr(+S)/P,y=+K[m>>3],f=(R-+Dr(+f)*+Dr(+y))/+hs(+y)/P,R=S>1?1:S,f=f>1?1:f,f=+K[m+8>>3]+ +Kn(+(R<-1?-1:R),+(f<-1?-1:f)),f>3.141592653589793)do f=f+-6.283185307179586;while(f>3.141592653589793);if(f<-3.141592653589793)do f=f+6.283185307179586;while(f<-3.141592653589793);K[v+8>>3]=f;return}while(0);if(+Wr(+(f+-1.5707963267948966))<1e-16){K[x>>3]=1.5707963267948966,K[v+8>>3]=0;return}if(+Wr(+(f+1.5707963267948966))<1e-16){K[x>>3]=-1.5707963267948966,K[v+8>>3]=0;return}if(f=+K[m+8>>3],f>3.141592653589793)do f=f+-6.283185307179586;while(f>3.141592653589793);if(f<-3.141592653589793)do f=f+6.283185307179586;while(f<-3.141592653589793);K[v+8>>3]=f}function v6e(m,f){return m=m|0,f=f|0,m>>>0>15?(f=4,f|0):(K[f>>3]=+K[20528+(m<<3)>>3],f=0,f|0)}function b6e(m,f){return m=m|0,f=f|0,m>>>0>15?(f=4,f|0):(K[f>>3]=+K[20656+(m<<3)>>3],f=0,f|0)}function w6e(m,f){return m=m|0,f=f|0,m>>>0>15?(f=4,f|0):(K[f>>3]=+K[20784+(m<<3)>>3],f=0,f|0)}function x6e(m,f){return m=m|0,f=f|0,m>>>0>15?(f=4,f|0):(K[f>>3]=+K[20912+(m<<3)>>3],f=0,f|0)}function mV(m,f){m=m|0,f=f|0;var y=0;return m>>>0>15?(f=4,f|0):(y=f_(7,0,m,((m|0)<0)<<31>>31)|0,y=vc(y|0,oe()|0,120,0)|0,m=oe()|0,g[f>>2]=y|2,g[f+4>>2]=m,f=0,f|0)}function iae(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0;return ge=+K[f>>3],Y=+K[m>>3],D=+Dr(+((ge-Y)*.5)),S=+K[f+8>>3],U=+K[m+8>>3],R=+Dr(+((S-U)*.5)),P=+hs(+Y),ne=+hs(+ge),R=D*D+R*(ne*P*R),R=+Kn(+ +vi(+R),+ +vi(+(1-R)))*2,D=+K[y>>3],ge=+Dr(+((D-ge)*.5)),v=+K[y+8>>3],S=+Dr(+((v-S)*.5)),x=+hs(+D),S=ge*ge+S*(ne*x*S),S=+Kn(+ +vi(+S),+ +vi(+(1-S)))*2,D=+Dr(+((Y-D)*.5)),v=+Dr(+((U-v)*.5)),v=D*D+v*(P*x*v),v=+Kn(+ +vi(+v),+ +vi(+(1-v)))*2,x=(R+S+v)*.5,+(+Ac(+ +vi(+(+ta(+(x*.5))*+ta(+((x-R)*.5))*+ta(+((x-S)*.5))*+ta(+((x-v)*.5)))))*4)}function gV(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0;if(P=H,H=H+192|0,S=P+168|0,R=P,x=cR(m,f,S)|0,x|0)return y=x,H=P,y|0;if(uR(m,f,R)|0&&vr(23313,22742,386,22751),f=g[R>>2]|0,(f|0)>0){if(v=+iae(R+8|0,R+8+(((f|0)!=1&1)<<4)|0,S)+0,(f|0)!=1){m=1;do x=m,m=m+1|0,v=v+ +iae(R+8+(x<<4)|0,R+8+(((m|0)%(f|0)|0)<<4)|0,S);while((m|0)<(f|0))}}else v=0;return K[y>>3]=v,y=0,H=P,y|0}function T6e(m,f,y){return m=m|0,f=f|0,y=y|0,m=gV(m,f,y)|0,m|0||(K[y>>3]=+K[y>>3]*6371.007180918475*6371.007180918475),m|0}function S6e(m,f,y){return m=m|0,f=f|0,y=y|0,m=gV(m,f,y)|0,m|0||(K[y>>3]=+K[y>>3]*6371.007180918475*6371.007180918475*1e3*1e3),m|0}function E6e(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0;if(P=H,H=H+176|0,R=P,m=oD(m,f,R)|0,m|0)return R=m,H=P,R|0;if(K[y>>3]=0,m=g[R>>2]|0,(m|0)<=1)return R=0,H=P,R|0;f=m+-1|0,m=0,v=+K[R+8>>3],x=+K[R+16>>3],S=0;do m=m+1|0,U=v,v=+K[R+8+(m<<4)>>3],Y=+Dr(+((v-U)*.5)),D=x,x=+K[R+8+(m<<4)+8>>3],D=+Dr(+((x-D)*.5)),D=Y*Y+D*(+hs(+v)*+hs(+U)*D),S=S+ +Kn(+ +vi(+D),+ +vi(+(1-D)))*2;while((m|0)<(f|0));return K[y>>3]=S,R=0,H=P,R|0}function C6e(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0;if(P=H,H=H+176|0,R=P,m=oD(m,f,R)|0,m|0)return R=m,S=+K[y>>3],S=S*6371.007180918475,K[y>>3]=S,H=P,R|0;if(K[y>>3]=0,m=g[R>>2]|0,(m|0)<=1)return R=0,S=0,S=S*6371.007180918475,K[y>>3]=S,H=P,R|0;f=m+-1|0,m=0,v=+K[R+8>>3],x=+K[R+16>>3],S=0;do m=m+1|0,U=v,v=+K[R+8+(m<<4)>>3],Y=+Dr(+((v-U)*.5)),D=x,x=+K[R+8+(m<<4)+8>>3],D=+Dr(+((x-D)*.5)),D=Y*Y+D*(+hs(+U)*+hs(+v)*D),S=S+ +Kn(+ +vi(+D),+ +vi(+(1-D)))*2;while((m|0)!=(f|0));return K[y>>3]=S,R=0,Y=S,Y=Y*6371.007180918475,K[y>>3]=Y,H=P,R|0}function M6e(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0;if(P=H,H=H+176|0,R=P,m=oD(m,f,R)|0,m|0)return R=m,S=+K[y>>3],S=S*6371.007180918475,S=S*1e3,K[y>>3]=S,H=P,R|0;if(K[y>>3]=0,m=g[R>>2]|0,(m|0)<=1)return R=0,S=0,S=S*6371.007180918475,S=S*1e3,K[y>>3]=S,H=P,R|0;f=m+-1|0,m=0,v=+K[R+8>>3],x=+K[R+16>>3],S=0;do m=m+1|0,U=v,v=+K[R+8+(m<<4)>>3],Y=+Dr(+((v-U)*.5)),D=x,x=+K[R+8+(m<<4)+8>>3],D=+Dr(+((x-D)*.5)),D=Y*Y+D*(+hs(+U)*+hs(+v)*D),S=S+ +Kn(+ +vi(+D),+ +vi(+(1-D)))*2;while((m|0)!=(f|0));return K[y>>3]=S,R=0,Y=S,Y=Y*6371.007180918475,Y=Y*1e3,K[y>>3]=Y,H=P,R|0}function R6e(m){m=m|0;var f=0,y=0,v=0;return f=rm(1,12)|0,f||vr(22832,22787,49,22845),y=m+4|0,v=g[y>>2]|0,v|0?(v=v+8|0,g[v>>2]=f,g[y>>2]=f,f|0):(g[m>>2]|0&&vr(22862,22787,61,22885),v=m,g[v>>2]=f,g[y>>2]=f,f|0)}function O6e(m,f){m=m|0,f=f|0;var y=0,v=0;return v=tm(24)|0,v||vr(22899,22787,78,22913),g[v>>2]=g[f>>2],g[v+4>>2]=g[f+4>>2],g[v+8>>2]=g[f+8>>2],g[v+12>>2]=g[f+12>>2],g[v+16>>2]=0,f=m+4|0,y=g[f>>2]|0,y|0?(g[y+16>>2]=v,g[f>>2]=v,v|0):(g[m>>2]|0&&vr(22928,22787,82,22913),g[m>>2]=v,g[f>>2]=v,v|0)}function sae(m){m=m|0;var f=0,y=0,v=0,x=0;if(m)for(v=1;;){if(f=g[m>>2]|0,f|0)do{if(y=g[f>>2]|0,y|0)do x=y,y=g[y+16>>2]|0,oi(x);while(y|0);x=f,f=g[f+8>>2]|0,oi(x)}while(f|0);if(f=m,m=g[m+8>>2]|0,v||oi(f),m)v=0;else break}}function P6e(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0,Fe=0,Ee=0,$t=0,Yt=0,wt=0,Lt=0,zs=0,ds=0,ws=0,xi=0,Ai=0,Ti=0,ln=0,ai=0;if(x=m+8|0,g[x>>2]|0)return ai=1,ai|0;if(v=g[m>>2]|0,!v)return ai=0,ai|0;f=v,y=0;do y=y+1|0,f=g[f+8>>2]|0;while(f|0);if(y>>>0<2)return ai=0,ai|0;Ti=tm(y<<2)|0,Ti||vr(22948,22787,317,22967),Ai=tm(y<<5)|0,Ai||vr(22989,22787,321,22967),g[m>>2]=0,Yt=m+4|0,g[Yt>>2]=0,g[x>>2]=0,y=0,xi=0,$t=0,ne=0;e:for(;;){if(Y=g[v>>2]|0,Y){S=0,R=Y;do{if(D=+K[R+8>>3],f=R,R=g[R+16>>2]|0,U=(R|0)==0,x=U?Y:R,P=+K[x+8>>3],+Wr(+(D-P))>3.141592653589793){ai=14;break}S=S+(P-D)*(+K[f>>3]+ +K[x>>3])}while(!U);if((ai|0)==14){ai=0,S=0,f=Y;do Ee=+K[f+8>>3],ws=f+16|0,ds=g[ws>>2]|0,ds=ds|0?ds:Y,Fe=+K[ds+8>>3],S=S+(+K[f>>3]+ +K[ds>>3])*((Fe<0?Fe+6.283185307179586:Fe)-(Ee<0?Ee+6.283185307179586:Ee)),f=g[(f|0?ws:v)>>2]|0;while(f|0)}S>0?(g[Ti+(xi<<2)>>2]=v,xi=xi+1|0,x=$t,f=ne):ai=19}else ai=19;if((ai|0)==19){ai=0;do if(y){if(f=y+8|0,g[f>>2]|0){ai=21;break e}if(y=rm(1,12)|0,!y){ai=23;break e}g[f>>2]=y,x=y+4|0,R=y,f=ne}else if(ne){x=Yt,R=ne+8|0,f=v,y=m;break}else if(g[m>>2]|0){ai=27;break e}else{x=Yt,R=m,f=v,y=m;break}while(0);if(g[R>>2]=v,g[x>>2]=v,R=Ai+($t<<5)|0,U=g[v>>2]|0,U){for(Y=Ai+($t<<5)+8|0,K[Y>>3]=17976931348623157e292,ne=Ai+($t<<5)+24|0,K[ne>>3]=17976931348623157e292,K[R>>3]=-17976931348623157e292,ge=Ai+($t<<5)+16|0,K[ge>>3]=-17976931348623157e292,Ve=17976931348623157e292,Ne=-17976931348623157e292,x=0,_e=U,D=17976931348623157e292,Ce=17976931348623157e292,We=-17976931348623157e292,P=-17976931348623157e292;S=+K[_e>>3],Ee=+K[_e+8>>3],_e=g[_e+16>>2]|0,de=(_e|0)==0,Fe=+K[(de?U:_e)+8>>3],S<D&&(K[Y>>3]=S,D=S),Ee<Ce&&(K[ne>>3]=Ee,Ce=Ee),S>We?K[R>>3]=S:S=We,Ee>P&&(K[ge>>3]=Ee,P=Ee),Ve=Ee>0&Ee<Ve?Ee:Ve,Ne=Ee<0&Ee>Ne?Ee:Ne,x=x|+Wr(+(Ee-Fe))>3.141592653589793,!de;)We=S;x&&(K[ge>>3]=Ne,K[ne>>3]=Ve)}else g[R>>2]=0,g[R+4>>2]=0,g[R+8>>2]=0,g[R+12>>2]=0,g[R+16>>2]=0,g[R+20>>2]=0,g[R+24>>2]=0,g[R+28>>2]=0;x=$t+1|0}if(ws=v+8|0,v=g[ws>>2]|0,g[ws>>2]=0,v)$t=x,ne=f;else{ai=45;break}}if((ai|0)==21)vr(22765,22787,35,22799);else if((ai|0)==23)vr(22819,22787,37,22799);else if((ai|0)==27)vr(22862,22787,61,22885);else if((ai|0)==45){e:do if((xi|0)>0){for(ws=(x|0)==0,zs=x<<2,ds=(m|0)==0,Lt=0,f=0;;){if(wt=g[Ti+(Lt<<2)>>2]|0,ws)ai=73;else{if($t=tm(zs)|0,!$t){ai=50;break}if(Yt=tm(zs)|0,!Yt){ai=52;break}t:do if(ds)y=0;else{for(x=0,y=0,R=m;v=Ai+(x<<5)|0,nae(g[R>>2]|0,v,g[wt>>2]|0)|0?(g[$t+(y<<2)>>2]=R,g[Yt+(y<<2)>>2]=v,de=y+1|0):de=y,R=g[R+8>>2]|0,R;)x=x+1|0,y=de;if((de|0)>0)if(v=g[$t>>2]|0,(de|0)==1)y=v;else for(ge=0,_e=-1,y=v,ne=v;;){for(U=g[ne>>2]|0,v=0,R=0;x=g[g[$t+(R<<2)>>2]>>2]|0,(x|0)==(U|0)?Y=v:Y=v+((nae(x,g[Yt+(R<<2)>>2]|0,g[U>>2]|0)|0)&1)|0,R=R+1|0,(R|0)!=(de|0);)v=Y;if(x=(Y|0)>(_e|0),y=x?ne:y,v=ge+1|0,(v|0)==(de|0))break t;ge=v,_e=x?Y:_e,ne=g[$t+(v<<2)>>2]|0}else y=0}while(0);if(oi($t),oi(Yt),y){if(x=y+4|0,v=g[x>>2]|0,v)y=v+8|0;else if(g[y>>2]|0){ai=70;break}g[y>>2]=wt,g[x>>2]=wt}else ai=73}if((ai|0)==73){if(ai=0,f=g[wt>>2]|0,f|0)do Yt=f,f=g[f+16>>2]|0,oi(Yt);while(f|0);oi(wt),f=1}if(Lt=Lt+1|0,(Lt|0)>=(xi|0)){ln=f;break e}}(ai|0)==50?vr(23004,22787,249,23023):(ai|0)==52?vr(23042,22787,252,23023):(ai|0)==70&&vr(22862,22787,61,22885)}else ln=0;while(0);return oi(Ti),oi(Ai),ai=ln,ai|0}return 0}function nae(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0;if(!(Voe(f,y)|0)||(f=Uoe(f)|0,v=+K[y>>3],x=+K[y+8>>3],x=f&x<0?x+6.283185307179586:x,m=g[m>>2]|0,!m))return m=0,m|0;if(f){f=0,U=x,y=m;e:for(;;){for(;R=+K[y>>3],x=+K[y+8>>3],y=y+16|0,Y=g[y>>2]|0,Y=Y|0?Y:m,S=+K[Y>>3],P=+K[Y+8>>3],R>S?(D=R,R=P):(D=S,S=R,R=x,x=P),v=v==S|v==D?v+2220446049250313e-31:v,!!(v<S|v>D);)if(y=g[y>>2]|0,!y){y=22;break e}if(P=R<0?R+6.283185307179586:R,R=x<0?x+6.283185307179586:x,U=P==U|R==U?U+-2220446049250313e-31:U,D=P+(R-P)*((v-S)/(D-S)),(D<0?D+6.283185307179586:D)>U&&(f=f^1),y=g[y>>2]|0,!y){y=22;break}}if((y|0)==22)return f|0}else{f=0,U=x,y=m;e:for(;;){for(;R=+K[y>>3],x=+K[y+8>>3],y=y+16|0,Y=g[y>>2]|0,Y=Y|0?Y:m,S=+K[Y>>3],P=+K[Y+8>>3],R>S?(D=R,R=P):(D=S,S=R,R=x,x=P),v=v==S|v==D?v+2220446049250313e-31:v,!!(v<S|v>D);)if(y=g[y>>2]|0,!y){y=22;break e}if(U=R==U|x==U?U+-2220446049250313e-31:U,R+(x-R)*((v-S)/(D-S))>U&&(f=f^1),y=g[y>>2]|0,!y){y=22;break}}if((y|0)==22)return f|0}return 0}function tA(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0;if(Ne=H,H=H+32|0,Ve=Ne+16|0,We=Ne,S=at(m|0,f|0,52)|0,oe()|0,S=S&15,_e=at(y|0,v|0,52)|0,oe()|0,(S|0)!=(_e&15|0))return Ve=12,H=Ne,Ve|0;if(U=at(m|0,f|0,45)|0,oe()|0,U=U&127,Y=at(y|0,v|0,45)|0,oe()|0,Y=Y&127,U>>>0>121|Y>>>0>121)return Ve=5,H=Ne,Ve|0;if(_e=(U|0)!=(Y|0),_e){if(P=sV(U,Y)|0,(P|0)==7)return Ve=1,H=Ne,Ve|0;D=sV(Y,U)|0,(D|0)==7?vr(23066,23090,161,23100):(de=P,R=D)}else de=0,R=0;ne=Bn(U)|0,ge=Bn(Y)|0,g[Ve>>2]=0,g[Ve+4>>2]=0,g[Ve+8>>2]=0,g[Ve+12>>2]=0;do if(de){if(Y=g[4272+(U*28|0)+(de<<2)>>2]|0,P=(Y|0)>0,ge)if(P){U=0,D=y,P=v;do D=u6e(D,P)|0,P=oe()|0,R=p_(R)|0,(R|0)==1&&(R=p_(1)|0),U=U+1|0;while((U|0)!=(Y|0));Y=R,U=D,D=P}else Y=R,U=y,D=v;else if(P){U=0,D=y,P=v;do D=dV(D,P)|0,P=oe()|0,R=p_(R)|0,U=U+1|0;while((U|0)!=(Y|0));Y=R,U=D,D=P}else Y=R,U=y,D=v;if(pV(U,D,Ve)|0,_e||vr(23115,23090,191,23100),P=(ne|0)!=0,R=(ge|0)!=0,P&R&&vr(23142,23090,192,23100),P){if(R=Qu(m,f)|0,(R|0)==7){S=5;break}if(Xe[21872+(R*7|0)+de>>0]|0){S=1;break}D=g[21040+(R*28|0)+(de<<2)>>2]|0,U=D}else if(R){if(R=Qu(U,D)|0,(R|0)==7){S=5;break}if(Xe[21872+(R*7|0)+Y>>0]|0){S=1;break}U=0,D=g[21040+(Y*28|0)+(R<<2)>>2]|0}else U=0,D=0;if((U|D|0)<0)S=5;else{if((D|0)>0){P=Ve+4|0,R=0;do nD(P),R=R+1|0;while((R|0)!=(D|0))}if(g[We>>2]=0,g[We+4>>2]=0,g[We+8>>2]=0,Hoe(We,de),S|0)for(;Jd(S)|0?sD(We):Fb(We),(S|0)>1;)S=S+-1|0;if((U|0)>0){S=0;do nD(We),S=S+1|0;while((S|0)!=(U|0))}Ce=Ve+4|0,iu(Ce,We,Ce),yc(Ce),Ce=51}}else if(pV(y,v,Ve)|0,(ne|0)!=0&(ge|0)!=0)if((Y|0)!=(U|0)&&vr(23173,23090,261,23100),R=Qu(m,f)|0,S=Qu(y,v)|0,(R|0)==7|(S|0)==7)S=5;else if(Xe[21872+(R*7|0)+S>>0]|0)S=1;else if(R=g[21040+(R*28|0)+(S<<2)>>2]|0,(R|0)>0){P=Ve+4|0,S=0;do nD(P),S=S+1|0;while((S|0)!=(R|0));Ce=51}else Ce=51;else Ce=51;while(0);return(Ce|0)==51&&(S=Ve+4|0,g[x>>2]=g[S>>2],g[x+4>>2]=g[S+4>>2],g[x+8>>2]=g[S+8>>2],S=0),Ve=S,H=Ne,Ve|0}function oae(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0,Fe=0;if(Ce=H,H=H+48|0,U=Ce+36|0,R=Ce+24|0,P=Ce+12|0,D=Ce,x=at(m|0,f|0,52)|0,oe()|0,x=x&15,ge=at(m|0,f|0,45)|0,oe()|0,ge=ge&127,ge>>>0>121)return v=5,H=Ce,v|0;if(Y=Bn(ge)|0,Et(x|0,0,52)|0,We=oe()|0|134225919,S=v,g[S>>2]=-1,g[S+4>>2]=We,!x)return x=iD(y)|0,(x|0)==7||(x=iV(ge,x)|0,(x|0)==127)?(We=1,H=Ce,We|0):(_e=Et(x|0,0,45)|0,de=oe()|0,ge=v,de=g[ge+4>>2]&-1040385|de,We=v,g[We>>2]=g[ge>>2]|_e,g[We+4>>2]=de,We=0,H=Ce,We|0);for(g[U>>2]=g[y>>2],g[U+4>>2]=g[y+4>>2],g[U+8>>2]=g[y+8>>2],y=x;;){if(S=y,y=y+-1|0,g[R>>2]=g[U>>2],g[R+4>>2]=g[U+4>>2],g[R+8>>2]=g[U+8>>2],Jd(S)|0){if(x=kFe(U)|0,x|0){y=13;break}g[P>>2]=g[U>>2],g[P+4>>2]=g[U+4>>2],g[P+8>>2]=g[U+8>>2],sD(P)}else{if(x=BFe(U)|0,x|0){y=13;break}g[P>>2]=g[U>>2],g[P+4>>2]=g[U+4>>2],g[P+8>>2]=g[U+8>>2],Fb(P)}if(nV(R,P,D),yc(D),x=v,Ne=g[x>>2]|0,x=g[x+4>>2]|0,Fe=(15-S|0)*3|0,Ve=Et(7,0,Fe|0)|0,x=x&~(oe()|0),Fe=Et(iD(D)|0,0,Fe|0)|0,x=oe()|0|x,We=v,g[We>>2]=Fe|Ne&~Ve,g[We+4>>2]=x,(S|0)<=1){y=14;break}}e:do if((y|0)!=13&&(y|0)==14)if((g[U>>2]|0)<=1&&(g[U+4>>2]|0)<=1&&(g[U+8>>2]|0)<=1){y=iD(U)|0,x=iV(ge,y)|0,(x|0)==127?D=0:D=Bn(x)|0;t:do if(y){if(Y){if(x=Qu(m,f)|0,(x|0)==7){x=5;break e}if(S=g[21248+(x*28|0)+(y<<2)>>2]|0,(S|0)>0){x=y,y=0;do x=kb(x)|0,y=y+1|0;while((y|0)!=(S|0))}else x=y;if((x|0)==1){x=9;break e}y=iV(ge,x)|0,(y|0)==127&&vr(23200,23090,411,23230),Bn(y)|0?vr(23245,23090,412,23230):(de=y,_e=S,ne=x)}else de=x,_e=0,ne=y;if(P=g[4272+(ge*28|0)+(ne<<2)>>2]|0,(P|0)<=-1&&vr(23276,23090,419,23230),!D){if((_e|0)<0){x=5;break e}if(_e|0){S=v,x=0,y=g[S>>2]|0,S=g[S+4>>2]|0;do y=Bb(y,S)|0,S=oe()|0,Fe=v,g[Fe>>2]=y,g[Fe+4>>2]=S,x=x+1|0;while((x|0)<(_e|0))}if((P|0)<=0){x=de,y=58;break}for(S=v,x=0,y=g[S>>2]|0,S=g[S+4>>2]|0;;)if(y=Bb(y,S)|0,S=oe()|0,Fe=v,g[Fe>>2]=y,g[Fe+4>>2]=S,x=x+1|0,(x|0)==(P|0)){x=de,y=58;break t}}if(R=sV(de,ge)|0,(R|0)==7&&vr(23066,23090,428,23230),x=v,y=g[x>>2]|0,x=g[x+4>>2]|0,(P|0)>0){S=0;do y=Bb(y,x)|0,x=oe()|0,Fe=v,g[Fe>>2]=y,g[Fe+4>>2]=x,S=S+1|0;while((S|0)!=(P|0))}if(x=Qu(y,x)|0,(x|0)==7&&vr(23313,23090,440,23230),y=rV(de)|0,y=g[(y?21664:21456)+(R*28|0)+(x<<2)>>2]|0,(y|0)<0&&vr(23313,23090,454,23230),!y)x=de,y=58;else{R=v,x=0,S=g[R>>2]|0,R=g[R+4>>2]|0;do S=hV(S,R)|0,R=oe()|0,Fe=v,g[Fe>>2]=S,g[Fe+4>>2]=R,x=x+1|0;while((x|0)<(y|0));x=de,y=58}}else if((Y|0)!=0&(D|0)!=0){if(y=Qu(m,f)|0,S=v,S=Qu(g[S>>2]|0,g[S+4>>2]|0)|0,(y|0)==7|(S|0)==7){x=5;break e}if(S=g[21248+(y*28|0)+(S<<2)>>2]|0,(S|0)<0){x=5;break e}if(!S)y=59;else{P=v,y=0,R=g[P>>2]|0,P=g[P+4>>2]|0;do R=Bb(R,P)|0,P=oe()|0,Fe=v,g[Fe>>2]=R,g[Fe+4>>2]=P,y=y+1|0;while((y|0)<(S|0));y=58}}else y=58;while(0);if((y|0)==58&&D&&(y=59),(y|0)==59&&(Fe=v,(Qu(g[Fe>>2]|0,g[Fe+4>>2]|0)|0)==1)){x=9;break}Fe=v,Ve=g[Fe>>2]|0,Fe=g[Fe+4>>2]&-1040385,Ne=Et(x|0,0,45)|0,Fe=Fe|(oe()|0),x=v,g[x>>2]=Ve|Ne,g[x+4>>2]=Fe,x=0}else x=1;while(0);return Fe=x,H=Ce,Fe|0}function I6e(m,f,y,v,x,S){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0,S=S|0;var R=0,P=0;return P=H,H=H+16|0,R=P,x?m=15:(m=tA(m,f,y,v,R)|0,m||(VFe(R,S),m=0)),H=P,m|0}function $6e(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0;return R=H,H=H+16|0,S=R,v?y=15:(y=zFe(y,S)|0,y||(y=oae(m,f,S,x)|0)),H=R,y|0}function L6e(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0;return D=H,H=H+32|0,R=D+12|0,P=D,S=tA(m,f,m,f,R)|0,S|0?(P=S,H=D,P|0):(m=tA(m,f,y,v,P)|0,m|0?(P=m,H=D,P|0):(R=oV(R,P)|0,P=x,g[P>>2]=R,g[P+4>>2]=((R|0)<0)<<31>>31,P=0,H=D,P|0))}function D6e(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0;return D=H,H=H+32|0,R=D+12|0,P=D,S=tA(m,f,m,f,R)|0,!S&&(S=tA(m,f,y,v,P)|0,!S)?(v=oV(R,P)|0,v=Gi(v|0,((v|0)<0)<<31>>31|0,1,0)|0,R=oe()|0,P=x,g[P>>2]=v,g[P+4>>2]=R,P=0,H=D,P|0):(P=S,H=D,P|0)}function N6e(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0,Fe=0,Ee=0,$t=0,Yt=0,wt=0,Lt=0;if(wt=H,H=H+48|0,R=wt+24|0,P=wt+12|0,Yt=wt,S=tA(m,f,m,f,R)|0,!S&&(S=tA(m,f,y,v,P)|0,!S)){Ee=oV(R,P)|0,$t=((Ee|0)<0)<<31>>31,g[R>>2]=0,g[R+4>>2]=0,g[R+8>>2]=0,g[P>>2]=0,g[P+4>>2]=0,g[P+8>>2]=0,tA(m,f,m,f,R)|0&&vr(23313,23090,691,23299),tA(m,f,y,v,P)|0&&vr(23313,23090,696,23299),Qoe(R),Qoe(P),Ee?(ne=g[R>>2]|0,de=+(Ee|0),Ve=R+4|0,ge=g[Ve>>2]|0,Ne=R+8|0,_e=g[Ne>>2]|0,Fe=R,v=ne,S=ge,y=_e,Ce=+((g[P>>2]|0)-ne|0)/de,We=+((g[P+4>>2]|0)-ge|0)/de,de=+((g[P+8>>2]|0)-_e|0)/de):(S=R+4|0,y=R+8|0,Ve=S,Ne=y,Fe=R,v=g[R>>2]|0,S=g[S>>2]|0,y=g[y>>2]|0,Ce=0,We=0,de=0),g[Yt>>2]=v,_e=Yt+4|0,g[_e>>2]=S,ge=Yt+8|0,g[ge>>2]=y;e:do if((Ee|0)<0)S=0;else for(Y=0,ne=0,S=v;;){U=+(ne>>>0)+4294967296*+(Y|0),Lt=Ce*U+ +(S|0),D=We*U+ +(g[Ve>>2]|0),U=de*U+ +(g[Ne>>2]|0),y=~~+cD(+Lt),R=~~+cD(+D),S=~~+cD(+U),Lt=+Wr(+(+(y|0)-Lt)),D=+Wr(+(+(R|0)-D)),U=+Wr(+(+(S|0)-U));do if(Lt>D&Lt>U)y=0-(R+S)|0,v=R;else if(P=0-y|0,D>U){v=P-S|0;break}else{v=R,S=P-R|0;break}while(0);if(g[Yt>>2]=y,g[_e>>2]=v,g[ge>>2]=S,GFe(Yt),S=oae(m,f,Yt,x+(ne<<3)|0)|0,S|0)break e;if(!((Y|0)<($t|0)|(Y|0)==($t|0)&ne>>>0<Ee>>>0)){S=0;break e}S=Gi(ne|0,Y|0,1,0)|0,P=oe()|0,Y=P,ne=S,S=g[Fe>>2]|0}while(0);return Yt=S,H=wt,Yt|0}return Yt=S,H=wt,Yt|0}function f_(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0;if((y|0)==0&(v|0)==0)return x=0,S=1,Yr(x|0),S|0;S=m,x=f,m=1,f=0;do R=(y&1|0)==0&!0,m=vc((R?1:S)|0,(R?0:x)|0,m|0,f|0)|0,f=oe()|0,y=gae(y|0,v|0,1)|0,v=oe()|0,S=vc(S|0,x|0,S|0,x|0)|0,x=oe()|0;while(!((y|0)==0&(v|0)==0));return Yr(f|0),m|0}function aae(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0;if(!(Voe(f,y)|0)||(f=Uoe(f)|0,v=+K[y>>3],x=+K[y+8>>3],x=f&x<0?x+6.283185307179586:x,ge=g[m>>2]|0,(ge|0)<=0))return ge=0,ge|0;if(ne=g[m+4>>2]|0,f){f=0,Y=x,y=-1,m=0;e:for(;;){for(U=m;R=+K[ne+(U<<4)>>3],x=+K[ne+(U<<4)+8>>3],m=(y+2|0)%(ge|0)|0,S=+K[ne+(m<<4)>>3],P=+K[ne+(m<<4)+8>>3],R>S?(D=R,R=P):(D=S,S=R,R=x,x=P),v=v==S|v==D?v+2220446049250313e-31:v,!!(v<S|v>D);)if(y=U+1|0,(y|0)>=(ge|0)){y=22;break e}else m=U,U=y,y=m;if(P=R<0?R+6.283185307179586:R,R=x<0?x+6.283185307179586:x,Y=P==Y|R==Y?Y+-2220446049250313e-31:Y,D=P+(R-P)*((v-S)/(D-S)),(D<0?D+6.283185307179586:D)>Y&&(f=f^1),m=U+1|0,(m|0)>=(ge|0)){y=22;break}else y=U}if((y|0)==22)return f|0}else{f=0,Y=x,y=-1,m=0;e:for(;;){for(U=m;R=+K[ne+(U<<4)>>3],x=+K[ne+(U<<4)+8>>3],m=(y+2|0)%(ge|0)|0,S=+K[ne+(m<<4)>>3],P=+K[ne+(m<<4)+8>>3],R>S?(D=R,R=P):(D=S,S=R,R=x,x=P),v=v==S|v==D?v+2220446049250313e-31:v,!!(v<S|v>D);)if(y=U+1|0,(y|0)>=(ge|0)){y=22;break e}else m=U,U=y,y=m;if(Y=R==Y|x==Y?Y+-2220446049250313e-31:Y,R+(x-R)*((v-S)/(D-S))>Y&&(f=f^1),m=U+1|0,(m|0)>=(ge|0)){y=22;break}else y=U}if((y|0)==22)return f|0}return 0}function lae(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0;if(de=g[m>>2]|0,!de){g[f>>2]=0,g[f+4>>2]=0,g[f+8>>2]=0,g[f+12>>2]=0,g[f+16>>2]=0,g[f+20>>2]=0,g[f+24>>2]=0,g[f+28>>2]=0;return}if(Ce=f+8|0,K[Ce>>3]=17976931348623157e292,We=f+24|0,K[We>>3]=17976931348623157e292,K[f>>3]=-17976931348623157e292,Ve=f+16|0,K[Ve>>3]=-17976931348623157e292,!((de|0)<=0)){for(ge=g[m+4>>2]|0,U=17976931348623157e292,Y=-17976931348623157e292,ne=0,m=-1,S=17976931348623157e292,R=17976931348623157e292,D=-17976931348623157e292,v=-17976931348623157e292,_e=0;y=+K[ge+(_e<<4)>>3],P=+K[ge+(_e<<4)+8>>3],m=m+2|0,x=+K[ge+(((m|0)==(de|0)?0:m)<<4)+8>>3],y<S&&(K[Ce>>3]=y,S=y),P<R&&(K[We>>3]=P,R=P),y>D?K[f>>3]=y:y=D,P>v&&(K[Ve>>3]=P,v=P),U=P>0&P<U?P:U,Y=P<0&P>Y?P:Y,ne=ne|+Wr(+(P-x))>3.141592653589793,m=_e+1|0,(m|0)!=(de|0);)Ne=_e,D=y,_e=m,m=Ne;ne&&(K[Ve>>3]=Y,K[We>>3]=U)}}function F6e(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0,Fe=0,Ee=0,$t=0,Yt=0,wt=0;if(de=g[m>>2]|0,de){if(Ce=f+8|0,K[Ce>>3]=17976931348623157e292,We=f+24|0,K[We>>3]=17976931348623157e292,K[f>>3]=-17976931348623157e292,Ve=f+16|0,K[Ve>>3]=-17976931348623157e292,(de|0)>0){for(x=g[m+4>>2]|0,ge=17976931348623157e292,_e=-17976931348623157e292,v=0,y=-1,D=17976931348623157e292,U=17976931348623157e292,ne=-17976931348623157e292,R=-17976931348623157e292,Ne=0;S=+K[x+(Ne<<4)>>3],Y=+K[x+(Ne<<4)+8>>3],Yt=y+2|0,P=+K[x+(((Yt|0)==(de|0)?0:Yt)<<4)+8>>3],S<D&&(K[Ce>>3]=S,D=S),Y<U&&(K[We>>3]=Y,U=Y),S>ne?K[f>>3]=S:S=ne,Y>R&&(K[Ve>>3]=Y,R=Y),ge=Y>0&Y<ge?Y:ge,_e=Y<0&Y>_e?Y:_e,v=v|+Wr(+(Y-P))>3.141592653589793,y=Ne+1|0,(y|0)!=(de|0);)Yt=Ne,ne=S,Ne=y,y=Yt;v&&(K[Ve>>3]=_e,K[We>>3]=ge)}}else g[f>>2]=0,g[f+4>>2]=0,g[f+8>>2]=0,g[f+12>>2]=0,g[f+16>>2]=0,g[f+20>>2]=0,g[f+24>>2]=0,g[f+28>>2]=0;if(Yt=m+8|0,y=g[Yt>>2]|0,!((y|0)<=0)){$t=m+12|0,Ee=0;do if(x=g[$t>>2]|0,v=Ee,Ee=Ee+1|0,We=f+(Ee<<5)|0,Ve=g[x+(v<<3)>>2]|0,Ve){if(Ne=f+(Ee<<5)+8|0,K[Ne>>3]=17976931348623157e292,m=f+(Ee<<5)+24|0,K[m>>3]=17976931348623157e292,K[We>>3]=-17976931348623157e292,Fe=f+(Ee<<5)+16|0,K[Fe>>3]=-17976931348623157e292,(Ve|0)>0){for(de=g[x+(v<<3)+4>>2]|0,ge=17976931348623157e292,_e=-17976931348623157e292,x=0,v=-1,Ce=0,D=17976931348623157e292,U=17976931348623157e292,Y=-17976931348623157e292,R=-17976931348623157e292;S=+K[de+(Ce<<4)>>3],ne=+K[de+(Ce<<4)+8>>3],v=v+2|0,P=+K[de+(((v|0)==(Ve|0)?0:v)<<4)+8>>3],S<D&&(K[Ne>>3]=S,D=S),ne<U&&(K[m>>3]=ne,U=ne),S>Y?K[We>>3]=S:S=Y,ne>R&&(K[Fe>>3]=ne,R=ne),ge=ne>0&ne<ge?ne:ge,_e=ne<0&ne>_e?ne:_e,x=x|+Wr(+(ne-P))>3.141592653589793,v=Ce+1|0,(v|0)!=(Ve|0);)wt=Ce,Ce=v,Y=S,v=wt;x&&(K[Fe>>3]=_e,K[m>>3]=ge)}}else g[We>>2]=0,g[We+4>>2]=0,g[We+8>>2]=0,g[We+12>>2]=0,g[We+16>>2]=0,g[We+20>>2]=0,g[We+24>>2]=0,g[We+28>>2]=0,y=g[Yt>>2]|0;while((Ee|0)<(y|0))}}function k6e(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0;if(!(aae(m,f,y)|0))return x=0,x|0;if(x=m+8|0,(g[x>>2]|0)<=0)return x=1,x|0;for(v=m+12|0,m=0;;){if(S=m,m=m+1|0,aae((g[v>>2]|0)+(S<<3)|0,f+(m<<5)|0,y)|0){m=0,v=6;break}if((m|0)>=(g[x>>2]|0)){m=1,v=6;break}}return(v|0)==6?m|0:0}function B6e(){return 8}function U6e(){return 16}function V6e(){return 168}function z6e(){return 8}function G6e(){return 16}function j6e(){return 12}function H6e(){return 8}function q6e(m){return m=m|0,+(+((g[m>>2]|0)>>>0)+4294967296*+(g[m+4>>2]|0))}function W6e(m){m=m|0;var f=0,y=0;return y=+K[m>>3],f=+K[m+8>>3],+ +vi(+(y*y+f*f))}function cae(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0;U=+K[m>>3],D=+K[f>>3]-U,P=+K[m+8>>3],R=+K[f+8>>3]-P,ne=+K[y>>3],S=+K[v>>3]-ne,ge=+K[y+8>>3],Y=+K[v+8>>3]-ge,S=(S*(P-ge)-(U-ne)*Y)/(D*Y-R*S),K[x>>3]=U+D*S,K[x+8>>3]=P+R*S}function uae(m,f){return m=m|0,f=f|0,+Wr(+(+K[m>>3]-+K[f>>3]))<11920928955078125e-23?(f=+Wr(+(+K[m+8>>3]-+K[f+8>>3]))<11920928955078125e-23,f|0):(f=0,f|0)}function va(m,f){m=m|0,f=f|0;var y=0,v=0,x=0;return x=+K[m>>3]-+K[f>>3],v=+K[m+8>>3]-+K[f+8>>3],y=+K[m+16>>3]-+K[f+16>>3],+(x*x+v*v+y*y)}function Y6e(m,f){m=m|0,f=f|0;var y=0,v=0,x=0;y=+K[m>>3],v=+hs(+y),y=+Dr(+y),K[f+16>>3]=y,y=+K[m+8>>3],x=v*+hs(+y),K[f>>3]=x,y=v*+Dr(+y),K[f+8>>3]=y}function Q6e(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0;if(S=H,H=H+16|0,x=S,v=Un(m,f)|0,(y+-1|0)>>>0>5||(v=(v|0)!=0,(y|0)==1&v))return x=-1,H=S,x|0;do if(pR(m,f,x)|0)v=-1;else if(v){v=((g[21936+(y<<2)>>2]|0)+5-(g[x>>2]|0)|0)%5|0;break}else{v=((g[21968+(y<<2)>>2]|0)+6-(g[x>>2]|0)|0)%6|0;break}while(0);return x=v,H=S,x|0}function pR(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0,U=0;if(U=H,H=H+32|0,R=U+16|0,P=U,v=FT(m,f,R)|0,v|0)return y=v,H=U,y|0;S=Joe(m,f)|0,D=Qu(m,f)|0,PFe(S,P),v=IFe(S,g[R>>2]|0)|0;e:do if(Bn(S)|0){do switch(S|0){case 4:{m=0;break}case 14:{m=1;break}case 24:{m=2;break}case 38:{m=3;break}case 49:{m=4;break}case 58:{m=5;break}case 63:{m=6;break}case 72:{m=7;break}case 83:{m=8;break}case 97:{m=9;break}case 107:{m=10;break}case 117:{m=11;break}default:{v=1;break e}}while(0);if(x=g[22e3+(m*24|0)+8>>2]|0,f=g[22e3+(m*24|0)+16>>2]|0,m=g[R>>2]|0,(m|0)!=(g[P>>2]|0)&&(P=rV(S)|0,m=g[R>>2]|0,P|(m|0)==(f|0)&&(v=(v+1|0)%6|0)),(D|0)==3&(m|0)==(f|0)){v=(v+5|0)%6|0,x=22;break}(D|0)==5&(m|0)==(x|0)&&(v=(v+1|0)%6|0),x=22}else x=22;while(0);return(x|0)==22&&(g[y>>2]=v,v=0),y=v,H=U,y|0}function Kd(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0,Fe=0;if(Fe=H,H=H+32|0,Ne=Fe+24|0,We=Fe+20|0,de=Fe+8|0,_e=Fe+16|0,ge=Fe,D=(Un(m,f)|0)==0,D=D?6:5,Y=at(m|0,f|0,52)|0,oe()|0,Y=Y&15,D>>>0<=y>>>0)return v=2,H=Fe,v|0;ne=(Y|0)==0,!ne&&(Ce=Et(7,0,(Y^15)*3|0)|0,(Ce&m|0)==0&((oe()|0)&f|0)==0)?x=y:S=4;e:do if((S|0)==4){if(x=(Un(m,f)|0)!=0,((x?4:5)|0)<(y|0)||pR(m,f,Ne)|0||(S=(g[Ne>>2]|0)+y|0,x?x=22288+(((S|0)%5|0)<<2)|0:x=22320+(((S|0)%6|0)<<2)|0,Ce=g[x>>2]|0,(Ce|0)==7))return v=1,H=Fe,v|0;g[We>>2]=0,x=gl(m,f,Ce,We,de)|0;do if(!x){if(P=de,U=g[P>>2]|0,P=g[P+4>>2]|0,R=P>>>0<f>>>0|(P|0)==(f|0)&U>>>0<m>>>0,S=R?U:m,R=R?P:f,!ne&&(ne=Et(7,0,(Y^15)*3|0)|0,(U&ne|0)==0&(P&(oe()|0)|0)==0))x=y;else{if(P=(y+-1+D|0)%(D|0)|0,x=Un(m,f)|0,(P|0)<0&&vr(23313,23315,245,23324),D=(x|0)!=0,((D?4:5)|0)<(P|0)&&vr(23313,23315,245,23324),pR(m,f,Ne)|0&&vr(23313,23315,245,23324),x=(g[Ne>>2]|0)+P|0,D?x=22288+(((x|0)%5|0)<<2)|0:x=22320+(((x|0)%6|0)<<2)|0,P=g[x>>2]|0,(P|0)==7&&vr(23313,23315,245,23324),g[_e>>2]=0,x=gl(m,f,P,_e,ge)|0,x|0)break;U=ge,D=g[U>>2]|0,U=g[U+4>>2]|0;do if(U>>>0<R>>>0|(U|0)==(R|0)&D>>>0<S>>>0){if(Un(D,U)|0?S=tV(D,U,m,f)|0:S=g[22384+((((g[_e>>2]|0)+(g[22352+(P<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,x=Un(D,U)|0,(S+-1|0)>>>0>5){x=-1,S=D,R=U;break}if(x=(x|0)!=0,(S|0)==1&x){x=-1,S=D,R=U;break}do if(pR(D,U,Ne)|0)x=-1;else if(x){x=((g[21936+(S<<2)>>2]|0)+5-(g[Ne>>2]|0)|0)%5|0;break}else{x=((g[21968+(S<<2)>>2]|0)+6-(g[Ne>>2]|0)|0)%6|0;break}while(0);S=D,R=U}else x=y;while(0);P=de,U=g[P>>2]|0,P=g[P+4>>2]|0}if((S|0)==(U|0)&(R|0)==(P|0)){if(D=(Un(U,P)|0)!=0,D?m=tV(U,P,m,f)|0:m=g[22384+((((g[We>>2]|0)+(g[22352+(Ce<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,x=Un(U,P)|0,(m+-1|0)>>>0<=5&&(Ve=(x|0)!=0,!((m|0)==1&Ve)))do if(pR(U,P,Ne)|0)x=-1;else if(Ve){x=((g[21936+(m<<2)>>2]|0)+5-(g[Ne>>2]|0)|0)%5|0;break}else{x=((g[21968+(m<<2)>>2]|0)+6-(g[Ne>>2]|0)|0)%6|0;break}while(0);else x=-1;x=x+1|0,x=(x|0)==6|D&(x|0)==5?0:x}f=R,m=S;break e}while(0);return v=x,H=Fe,v|0}while(0);return Ve=Et(x|0,0,56)|0,Ne=oe()|0|f&-2130706433|536870912,g[v>>2]=Ve|m,g[v+4>>2]=Ne,v=0,H=Fe,v|0}function X6e(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0;return S=(Un(m,f)|0)==0,v=Kd(m,f,0,y)|0,x=(v|0)==0,S?!x||(v=Kd(m,f,1,y+8|0)|0,v|0)||(v=Kd(m,f,2,y+16|0)|0,v|0)||(v=Kd(m,f,3,y+24|0)|0,v|0)||(v=Kd(m,f,4,y+32|0)|0,v)?(S=v,S|0):Kd(m,f,5,y+40|0)|0:!x||(v=Kd(m,f,1,y+8|0)|0,v|0)||(v=Kd(m,f,2,y+16|0)|0,v|0)||(v=Kd(m,f,3,y+24|0)|0,v|0)||(v=Kd(m,f,4,y+32|0)|0,v|0)?(S=v,S|0):(S=y+40|0,g[S>>2]=0,g[S+4>>2]=0,S=0,S|0)}function Z6e(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0,P=0,D=0;return D=H,H=H+192|0,x=D,S=D+168|0,R=at(m|0,f|0,56)|0,oe()|0,R=R&7,P=f&-2130706433|134217728,v=FT(m,P,S)|0,v|0?(P=v,H=D,P|0):(f=at(m|0,f|0,52)|0,oe()|0,f=f&15,Un(m,P)|0?aV(S,f,R,1,x):lV(S,f,R,1,x),P=x+8|0,g[y>>2]=g[P>>2],g[y+4>>2]=g[P+4>>2],g[y+8>>2]=g[P+8>>2],g[y+12>>2]=g[P+12>>2],P=0,H=D,P|0)}function J6e(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0;return x=H,H=H+16|0,y=x,!(!0&(f&2013265920|0)==536870912)||(v=f&-2130706433|134217728,!(cV(m,v)|0))?(v=0,H=x,v|0):(S=at(m|0,f|0,56)|0,oe()|0,S=(Kd(m,v,S&7,y)|0)==0,v=y,v=S&((g[v>>2]|0)==(m|0)?(g[v+4>>2]|0)==(f|0):0)&1,H=x,v|0)}function hae(m,f,y){m=m|0,f=f|0,y=y|0;var v=0;(f|0)>0?(v=rm(f,4)|0,g[m>>2]=v,v||vr(23337,23360,40,23374)):g[m>>2]=0,g[m+4>>2]=f,g[m+8>>2]=0,g[m+12>>2]=y}function dae(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0;x=m+4|0,S=m+12|0,R=m+8|0;e:for(;;){for(y=g[x>>2]|0,f=0;;){if((f|0)>=(y|0))break e;if(v=g[m>>2]|0,P=g[v+(f<<2)>>2]|0,!P)f=f+1|0;else break}f=v+(~~(+Wr(+(+_r(10,+ +(15-(g[S>>2]|0)|0))*(+K[P>>3]+ +K[P+8>>3])))%+(y|0))>>>0<<2)|0,y=g[f>>2]|0;t:do if(y|0){if(v=P+32|0,(y|0)==(P|0))g[f>>2]=g[v>>2];else{if(y=y+32|0,f=g[y>>2]|0,!f)break;for(;(f|0)!=(P|0);)if(y=f+32|0,f=g[y>>2]|0,!f)break t;g[y>>2]=g[v>>2]}oi(P),g[R>>2]=(g[R>>2]|0)+-1}while(0)}oi(g[m>>2]|0)}function pae(m){m=m|0;var f=0,y=0,v=0;for(v=g[m+4>>2]|0,y=0;;){if((y|0)>=(v|0)){f=0,y=4;break}if(f=g[(g[m>>2]|0)+(y<<2)>>2]|0,!f)y=y+1|0;else{y=4;break}}return(y|0)==4?f|0:0}function fae(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0;if(y=~~(+Wr(+(+_r(10,+ +(15-(g[m+12>>2]|0)|0))*(+K[f>>3]+ +K[f+8>>3])))%+(g[m+4>>2]|0))>>>0,y=(g[m>>2]|0)+(y<<2)|0,v=g[y>>2]|0,!v)return S=1,S|0;S=f+32|0;do if((v|0)!=(f|0)){if(y=g[v+32>>2]|0,!y)return S=1,S|0;for(x=y;;){if((x|0)==(f|0)){x=8;break}if(y=g[x+32>>2]|0,y)v=x,x=y;else{y=1,x=10;break}}if((x|0)==8){g[v+32>>2]=g[S>>2];break}else if((x|0)==10)return y|0}else g[y>>2]=g[S>>2];while(0);return oi(f),S=m+8|0,g[S>>2]=(g[S>>2]|0)+-1,S=0,S|0}function K6e(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0;S=tm(40)|0,S||vr(23390,23360,98,23403),g[S>>2]=g[f>>2],g[S+4>>2]=g[f+4>>2],g[S+8>>2]=g[f+8>>2],g[S+12>>2]=g[f+12>>2],x=S+16|0,g[x>>2]=g[y>>2],g[x+4>>2]=g[y+4>>2],g[x+8>>2]=g[y+8>>2],g[x+12>>2]=g[y+12>>2],g[S+32>>2]=0,x=~~(+Wr(+(+_r(10,+ +(15-(g[m+12>>2]|0)|0))*(+K[f>>3]+ +K[f+8>>3])))%+(g[m+4>>2]|0))>>>0,x=(g[m>>2]|0)+(x<<2)|0,v=g[x>>2]|0;do if(!v)g[x>>2]=S;else{for(;!(kT(v,f)|0&&kT(v+16|0,y)|0);)if(x=g[v+32>>2]|0,v=x|0?x:v,!(g[v+32>>2]|0)){R=10;break}if((R|0)==10){g[v+32>>2]=S;break}return oi(S),R=v,R|0}while(0);return R=m+8|0,g[R>>2]=(g[R>>2]|0)+1,R=S,R|0}function e8e(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0;if(x=~~(+Wr(+(+_r(10,+ +(15-(g[m+12>>2]|0)|0))*(+K[f>>3]+ +K[f+8>>3])))%+(g[m+4>>2]|0))>>>0,x=g[(g[m>>2]|0)+(x<<2)>>2]|0,!x)return y=0,y|0;if(!y){for(m=x;;){if(kT(m,f)|0){v=10;break}if(m=g[m+32>>2]|0,!m){m=0,v=10;break}}if((v|0)==10)return m|0}for(m=x;;){if(kT(m,f)|0&&kT(m+16|0,y)|0){v=10;break}if(m=g[m+32>>2]|0,!m){m=0,v=10;break}}return(v|0)==10?m|0:0}function t8e(m,f){m=m|0,f=f|0;var y=0;if(y=~~(+Wr(+(+_r(10,+ +(15-(g[m+12>>2]|0)|0))*(+K[f>>3]+ +K[f+8>>3])))%+(g[m+4>>2]|0))>>>0,m=g[(g[m>>2]|0)+(y<<2)>>2]|0,!m)return y=0,y|0;for(;;){if(kT(m,f)|0){f=5;break}if(m=g[m+32>>2]|0,!m){m=0,f=5;break}}return(f|0)==5?m|0:0}function r8e(){return 23424}function i8e(m){return m=+m,+ +yae(+m)}function m_(m){return m=+m,~~+i8e(m)|0}function tm(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0,Ce=0,We=0,Ve=0,Ne=0,Fe=0,Ee=0,$t=0;$t=H,H=H+16|0,ge=$t;do if(m>>>0<245){if(U=m>>>0<11?16:m+11&-8,m=U>>>3,ne=g[5857]|0,y=ne>>>m,y&3|0)return f=(y&1^1)+m|0,m=23468+(f<<1<<2)|0,y=m+8|0,v=g[y>>2]|0,x=v+8|0,S=g[x>>2]|0,(S|0)==(m|0)?g[5857]=ne&~(1<<f):(g[S+12>>2]=m,g[y>>2]=S),Ee=f<<3,g[v+4>>2]=Ee|3,Ee=v+Ee+4|0,g[Ee>>2]=g[Ee>>2]|1,Ee=x,H=$t,Ee|0;if(Y=g[5859]|0,U>>>0>Y>>>0){if(y|0)return f=2<<m,f=y<<m&(f|0-f),f=(f&0-f)+-1|0,P=f>>>12&16,f=f>>>P,y=f>>>5&8,f=f>>>y,S=f>>>2&4,f=f>>>S,m=f>>>1&2,f=f>>>m,v=f>>>1&1,v=(y|P|S|m|v)+(f>>>v)|0,f=23468+(v<<1<<2)|0,m=f+8|0,S=g[m>>2]|0,P=S+8|0,y=g[P>>2]|0,(y|0)==(f|0)?(m=ne&~(1<<v),g[5857]=m):(g[y+12>>2]=f,g[m>>2]=y,m=ne),Ee=v<<3,R=Ee-U|0,g[S+4>>2]=U|3,x=S+U|0,g[x+4>>2]=R|1,g[S+Ee>>2]=R,Y|0&&(v=g[5862]|0,f=Y>>>3,y=23468+(f<<1<<2)|0,f=1<<f,m&f?(m=y+8|0,f=g[m>>2]|0):(g[5857]=m|f,f=y,m=y+8|0),g[m>>2]=v,g[f+12>>2]=v,g[v+8>>2]=f,g[v+12>>2]=y),g[5859]=R,g[5862]=x,Ee=P,H=$t,Ee|0;if(S=g[5858]|0,S){for(y=(S&0-S)+-1|0,x=y>>>12&16,y=y>>>x,v=y>>>5&8,y=y>>>v,R=y>>>2&4,y=y>>>R,P=y>>>1&2,y=y>>>P,D=y>>>1&1,D=g[23732+((v|x|R|P|D)+(y>>>D)<<2)>>2]|0,y=D,P=D,D=(g[D+4>>2]&-8)-U|0;m=g[y+16>>2]|0,!(!m&&(m=g[y+20>>2]|0,!m));)R=(g[m+4>>2]&-8)-U|0,x=R>>>0<D>>>0,y=m,P=x?m:P,D=x?R:D;if(R=P+U|0,R>>>0>P>>>0){x=g[P+24>>2]|0,f=g[P+12>>2]|0;do if((f|0)==(P|0)){if(m=P+20|0,f=g[m>>2]|0,!f&&(m=P+16|0,f=g[m>>2]|0,!f)){y=0;break}for(;;)if(v=f+20|0,y=g[v>>2]|0,y)f=y,m=v;else if(v=f+16|0,y=g[v>>2]|0,y)f=y,m=v;else break;g[m>>2]=0,y=f}else y=g[P+8>>2]|0,g[y+12>>2]=f,g[f+8>>2]=y,y=f;while(0);do if(x|0){if(f=g[P+28>>2]|0,m=23732+(f<<2)|0,(P|0)==(g[m>>2]|0)){if(g[m>>2]=y,!y){g[5858]=S&~(1<<f);break}}else if(Ee=x+16|0,g[((g[Ee>>2]|0)==(P|0)?Ee:x+20|0)>>2]=y,!y)break;g[y+24>>2]=x,f=g[P+16>>2]|0,f|0&&(g[y+16>>2]=f,g[f+24>>2]=y),f=g[P+20>>2]|0,f|0&&(g[y+20>>2]=f,g[f+24>>2]=y)}while(0);return D>>>0<16?(Ee=D+U|0,g[P+4>>2]=Ee|3,Ee=P+Ee+4|0,g[Ee>>2]=g[Ee>>2]|1):(g[P+4>>2]=U|3,g[R+4>>2]=D|1,g[R+D>>2]=D,Y|0&&(v=g[5862]|0,f=Y>>>3,y=23468+(f<<1<<2)|0,f=1<<f,f&ne?(m=y+8|0,f=g[m>>2]|0):(g[5857]=f|ne,f=y,m=y+8|0),g[m>>2]=v,g[f+12>>2]=v,g[v+8>>2]=f,g[v+12>>2]=y),g[5859]=D,g[5862]=R),Ee=P+8|0,H=$t,Ee|0}else ne=U}else ne=U}else ne=U}else if(m>>>0<=4294967231)if(m=m+11|0,U=m&-8,v=g[5858]|0,v){x=0-U|0,m=m>>>8,m?U>>>0>16777215?D=31:(ne=(m+1048320|0)>>>16&8,Ce=m<<ne,P=(Ce+520192|0)>>>16&4,Ce=Ce<<P,D=(Ce+245760|0)>>>16&2,D=14-(P|ne|D)+(Ce<<D>>>15)|0,D=U>>>(D+7|0)&1|D<<1):D=0,y=g[23732+(D<<2)>>2]|0;e:do if(!y)y=0,m=0,Ce=61;else for(m=0,P=U<<((D|0)==31?0:25-(D>>>1)|0),S=0;;){if(R=(g[y+4>>2]&-8)-U|0,R>>>0<x>>>0)if(R)m=y,x=R;else{m=y,x=0,Ce=65;break e}if(Ce=g[y+20>>2]|0,y=g[y+16+(P>>>31<<2)>>2]|0,S=(Ce|0)==0|(Ce|0)==(y|0)?S:Ce,y)P=P<<1;else{y=S,Ce=61;break}}while(0);if((Ce|0)==61){if((y|0)==0&(m|0)==0){if(m=2<<D,m=(m|0-m)&v,!m){ne=U;break}ne=(m&0-m)+-1|0,R=ne>>>12&16,ne=ne>>>R,S=ne>>>5&8,ne=ne>>>S,P=ne>>>2&4,ne=ne>>>P,D=ne>>>1&2,ne=ne>>>D,y=ne>>>1&1,m=0,y=g[23732+((S|R|P|D|y)+(ne>>>y)<<2)>>2]|0}y?Ce=65:(P=m,R=x)}if((Ce|0)==65)for(S=y;;)if(ne=(g[S+4>>2]&-8)-U|0,y=ne>>>0<x>>>0,x=y?ne:x,m=y?S:m,y=g[S+16>>2]|0,y||(y=g[S+20>>2]|0),y)S=y;else{P=m,R=x;break}if(P|0&&R>>>0<((g[5859]|0)-U|0)>>>0&&(Y=P+U|0,Y>>>0>P>>>0)){S=g[P+24>>2]|0,f=g[P+12>>2]|0;do if((f|0)==(P|0)){if(m=P+20|0,f=g[m>>2]|0,!f&&(m=P+16|0,f=g[m>>2]|0,!f)){f=0;break}for(;;)if(x=f+20|0,y=g[x>>2]|0,y)f=y,m=x;else if(x=f+16|0,y=g[x>>2]|0,y)f=y,m=x;else break;g[m>>2]=0}else Ee=g[P+8>>2]|0,g[Ee+12>>2]=f,g[f+8>>2]=Ee;while(0);do if(S){if(m=g[P+28>>2]|0,y=23732+(m<<2)|0,(P|0)==(g[y>>2]|0)){if(g[y>>2]=f,!f){v=v&~(1<<m),g[5858]=v;break}}else if(Ee=S+16|0,g[((g[Ee>>2]|0)==(P|0)?Ee:S+20|0)>>2]=f,!f)break;g[f+24>>2]=S,m=g[P+16>>2]|0,m|0&&(g[f+16>>2]=m,g[m+24>>2]=f),m=g[P+20>>2]|0,m&&(g[f+20>>2]=m,g[m+24>>2]=f)}while(0);e:do if(R>>>0<16)Ee=R+U|0,g[P+4>>2]=Ee|3,Ee=P+Ee+4|0,g[Ee>>2]=g[Ee>>2]|1;else{if(g[P+4>>2]=U|3,g[Y+4>>2]=R|1,g[Y+R>>2]=R,f=R>>>3,R>>>0<256){y=23468+(f<<1<<2)|0,m=g[5857]|0,f=1<<f,m&f?(m=y+8|0,f=g[m>>2]|0):(g[5857]=m|f,f=y,m=y+8|0),g[m>>2]=Y,g[f+12>>2]=Y,g[Y+8>>2]=f,g[Y+12>>2]=y;break}if(f=R>>>8,f?R>>>0>16777215?y=31:(Fe=(f+1048320|0)>>>16&8,Ee=f<<Fe,Ne=(Ee+520192|0)>>>16&4,Ee=Ee<<Ne,y=(Ee+245760|0)>>>16&2,y=14-(Ne|Fe|y)+(Ee<<y>>>15)|0,y=R>>>(y+7|0)&1|y<<1):y=0,f=23732+(y<<2)|0,g[Y+28>>2]=y,m=Y+16|0,g[m+4>>2]=0,g[m>>2]=0,m=1<<y,!(v&m)){g[5858]=v|m,g[f>>2]=Y,g[Y+24>>2]=f,g[Y+12>>2]=Y,g[Y+8>>2]=Y;break}f=g[f>>2]|0;t:do if((g[f+4>>2]&-8|0)!=(R|0)){for(v=R<<((y|0)==31?0:25-(y>>>1)|0);y=f+16+(v>>>31<<2)|0,m=g[y>>2]|0,!!m;)if((g[m+4>>2]&-8|0)==(R|0)){f=m;break t}else v=v<<1,f=m;g[y>>2]=Y,g[Y+24>>2]=f,g[Y+12>>2]=Y,g[Y+8>>2]=Y;break e}while(0);Fe=f+8|0,Ee=g[Fe>>2]|0,g[Ee+12>>2]=Y,g[Fe>>2]=Y,g[Y+8>>2]=Ee,g[Y+12>>2]=f,g[Y+24>>2]=0}while(0);return Ee=P+8|0,H=$t,Ee|0}else ne=U}else ne=U;else ne=-1;while(0);if(y=g[5859]|0,y>>>0>=ne>>>0)return f=y-ne|0,m=g[5862]|0,f>>>0>15?(Ee=m+ne|0,g[5862]=Ee,g[5859]=f,g[Ee+4>>2]=f|1,g[m+y>>2]=f,g[m+4>>2]=ne|3):(g[5859]=0,g[5862]=0,g[m+4>>2]=y|3,Ee=m+y+4|0,g[Ee>>2]=g[Ee>>2]|1),Ee=m+8|0,H=$t,Ee|0;if(R=g[5860]|0,R>>>0>ne>>>0)return Ne=R-ne|0,g[5860]=Ne,Ee=g[5863]|0,Fe=Ee+ne|0,g[5863]=Fe,g[Fe+4>>2]=Ne|1,g[Ee+4>>2]=ne|3,Ee=Ee+8|0,H=$t,Ee|0;if(g[5975]|0?m=g[5977]|0:(g[5977]=4096,g[5976]=4096,g[5978]=-1,g[5979]=-1,g[5980]=0,g[5968]=0,g[5975]=ge&-16^1431655768,m=4096),P=ne+48|0,D=ne+47|0,S=m+D|0,x=0-m|0,U=S&x,U>>>0<=ne>>>0||(m=g[5967]|0,m|0&&(Y=g[5965]|0,ge=Y+U|0,ge>>>0<=Y>>>0|ge>>>0>m>>>0)))return Ee=0,H=$t,Ee|0;e:do if(g[5968]&4)f=0,Ce=143;else{y=g[5863]|0;t:do if(y){for(v=23876;ge=g[v>>2]|0,!(ge>>>0<=y>>>0&&(ge+(g[v+4>>2]|0)|0)>>>0>y>>>0);)if(m=g[v+8>>2]|0,m)v=m;else{Ce=128;break t}if(f=S-R&x,f>>>0<2147483647)if(m=g_(f|0)|0,(m|0)==((g[v>>2]|0)+(g[v+4>>2]|0)|0)){if((m|0)!=-1){R=f,S=m,Ce=145;break e}}else v=m,Ce=136;else f=0}else Ce=128;while(0);do if((Ce|0)==128)if(y=g_(0)|0,(y|0)!=-1&&(f=y,_e=g[5976]|0,de=_e+-1|0,f=(de&f|0?(de+f&0-_e)-f|0:0)+U|0,_e=g[5965]|0,de=f+_e|0,f>>>0>ne>>>0&f>>>0<2147483647)){if(ge=g[5967]|0,ge|0&&de>>>0<=_e>>>0|de>>>0>ge>>>0){f=0;break}if(m=g_(f|0)|0,(m|0)==(y|0)){R=f,S=y,Ce=145;break e}else v=m,Ce=136}else f=0;while(0);do if((Ce|0)==136){if(y=0-f|0,!(P>>>0>f>>>0&(f>>>0<2147483647&(v|0)!=-1)))if((v|0)==-1){f=0;break}else{R=f,S=v,Ce=145;break e}if(m=g[5977]|0,m=D-f+m&0-m,m>>>0>=2147483647){R=f,S=v,Ce=145;break e}if((g_(m|0)|0)==-1){g_(y|0)|0,f=0;break}else{R=m+f|0,S=v,Ce=145;break e}}while(0);g[5968]=g[5968]|4,Ce=143}while(0);if((Ce|0)==143&&U>>>0<2147483647&&(Ne=g_(U|0)|0,de=g_(0)|0,We=de-Ne|0,Ve=We>>>0>(ne+40|0)>>>0,!((Ne|0)==-1|Ve^1|Ne>>>0<de>>>0&((Ne|0)!=-1&(de|0)!=-1)^1))&&(R=Ve?We:f,S=Ne,Ce=145),(Ce|0)==145){f=(g[5965]|0)+R|0,g[5965]=f,f>>>0>(g[5966]|0)>>>0&&(g[5966]=f),D=g[5863]|0;e:do if(D){for(f=23876;;){if(m=g[f>>2]|0,y=g[f+4>>2]|0,(S|0)==(m+y|0)){Ce=154;break}if(v=g[f+8>>2]|0,v)f=v;else break}if((Ce|0)==154&&(Fe=f+4|0,(g[f+12>>2]&8|0)==0)&&S>>>0>D>>>0&m>>>0<=D>>>0){g[Fe>>2]=y+R,Ee=(g[5860]|0)+R|0,Ne=D+8|0,Ne=Ne&7|0?0-Ne&7:0,Fe=D+Ne|0,Ne=Ee-Ne|0,g[5863]=Fe,g[5860]=Ne,g[Fe+4>>2]=Ne|1,g[D+Ee+4>>2]=40,g[5864]=g[5979];break}for(S>>>0<(g[5861]|0)>>>0&&(g[5861]=S),y=S+R|0,f=23876;;){if((g[f>>2]|0)==(y|0)){Ce=162;break}if(m=g[f+8>>2]|0,m)f=m;else break}if((Ce|0)==162&&!(g[f+12>>2]&8|0)){g[f>>2]=S,Y=f+4|0,g[Y>>2]=(g[Y>>2]|0)+R,Y=S+8|0,Y=S+(Y&7|0?0-Y&7:0)|0,f=y+8|0,f=y+(f&7|0?0-f&7:0)|0,U=Y+ne|0,P=f-Y-ne|0,g[Y+4>>2]=ne|3;t:do if((D|0)==(f|0))Ee=(g[5860]|0)+P|0,g[5860]=Ee,g[5863]=U,g[U+4>>2]=Ee|1;else{if((g[5862]|0)==(f|0)){Ee=(g[5859]|0)+P|0,g[5859]=Ee,g[5862]=U,g[U+4>>2]=Ee|1,g[U+Ee>>2]=Ee;break}if(m=g[f+4>>2]|0,(m&3|0)==1){R=m&-8,v=m>>>3;r:do if(m>>>0<256)if(m=g[f+8>>2]|0,y=g[f+12>>2]|0,(y|0)==(m|0)){g[5857]=g[5857]&~(1<<v);break}else{g[m+12>>2]=y,g[y+8>>2]=m;break}else{S=g[f+24>>2]|0,m=g[f+12>>2]|0;do if((m|0)==(f|0)){if(y=f+16|0,v=y+4|0,m=g[v>>2]|0,m)y=v;else if(m=g[y>>2]|0,!m){m=0;break}for(;;)if(x=m+20|0,v=g[x>>2]|0,v)m=v,y=x;else if(x=m+16|0,v=g[x>>2]|0,v)m=v,y=x;else break;g[y>>2]=0}else Ee=g[f+8>>2]|0,g[Ee+12>>2]=m,g[m+8>>2]=Ee;while(0);if(!S)break;y=g[f+28>>2]|0,v=23732+(y<<2)|0;do if((g[v>>2]|0)!=(f|0)){if(Ee=S+16|0,g[((g[Ee>>2]|0)==(f|0)?Ee:S+20|0)>>2]=m,!m)break r}else{if(g[v>>2]=m,m|0)break;g[5858]=g[5858]&~(1<<y);break r}while(0);if(g[m+24>>2]=S,y=f+16|0,v=g[y>>2]|0,v|0&&(g[m+16>>2]=v,g[v+24>>2]=m),y=g[y+4>>2]|0,!y)break;g[m+20>>2]=y,g[y+24>>2]=m}while(0);f=f+R|0,x=R+P|0}else x=P;if(f=f+4|0,g[f>>2]=g[f>>2]&-2,g[U+4>>2]=x|1,g[U+x>>2]=x,f=x>>>3,x>>>0<256){y=23468+(f<<1<<2)|0,m=g[5857]|0,f=1<<f,m&f?(m=y+8|0,f=g[m>>2]|0):(g[5857]=m|f,f=y,m=y+8|0),g[m>>2]=U,g[f+12>>2]=U,g[U+8>>2]=f,g[U+12>>2]=y;break}f=x>>>8;do if(!f)v=0;else{if(x>>>0>16777215){v=31;break}Fe=(f+1048320|0)>>>16&8,Ee=f<<Fe,Ne=(Ee+520192|0)>>>16&4,Ee=Ee<<Ne,v=(Ee+245760|0)>>>16&2,v=14-(Ne|Fe|v)+(Ee<<v>>>15)|0,v=x>>>(v+7|0)&1|v<<1}while(0);if(f=23732+(v<<2)|0,g[U+28>>2]=v,m=U+16|0,g[m+4>>2]=0,g[m>>2]=0,m=g[5858]|0,y=1<<v,!(m&y)){g[5858]=m|y,g[f>>2]=U,g[U+24>>2]=f,g[U+12>>2]=U,g[U+8>>2]=U;break}f=g[f>>2]|0;r:do if((g[f+4>>2]&-8|0)!=(x|0)){for(v=x<<((v|0)==31?0:25-(v>>>1)|0);y=f+16+(v>>>31<<2)|0,m=g[y>>2]|0,!!m;)if((g[m+4>>2]&-8|0)==(x|0)){f=m;break r}else v=v<<1,f=m;g[y>>2]=U,g[U+24>>2]=f,g[U+12>>2]=U,g[U+8>>2]=U;break t}while(0);Fe=f+8|0,Ee=g[Fe>>2]|0,g[Ee+12>>2]=U,g[Fe>>2]=U,g[U+8>>2]=Ee,g[U+12>>2]=f,g[U+24>>2]=0}while(0);return Ee=Y+8|0,H=$t,Ee|0}for(f=23876;m=g[f>>2]|0,!(m>>>0<=D>>>0&&(Ee=m+(g[f+4>>2]|0)|0,Ee>>>0>D>>>0));)f=g[f+8>>2]|0;x=Ee+-47|0,m=x+8|0,m=x+(m&7|0?0-m&7:0)|0,x=D+16|0,m=m>>>0<x>>>0?D:m,f=m+8|0,y=R+-40|0,Ne=S+8|0,Ne=Ne&7|0?0-Ne&7:0,Fe=S+Ne|0,Ne=y-Ne|0,g[5863]=Fe,g[5860]=Ne,g[Fe+4>>2]=Ne|1,g[S+y+4>>2]=40,g[5864]=g[5979],y=m+4|0,g[y>>2]=27,g[f>>2]=g[5969],g[f+4>>2]=g[5970],g[f+8>>2]=g[5971],g[f+12>>2]=g[5972],g[5969]=S,g[5970]=R,g[5972]=0,g[5971]=f,f=m+24|0;do Fe=f,f=f+4|0,g[f>>2]=7;while((Fe+8|0)>>>0<Ee>>>0);if((m|0)!=(D|0)){if(S=m-D|0,g[y>>2]=g[y>>2]&-2,g[D+4>>2]=S|1,g[m>>2]=S,f=S>>>3,S>>>0<256){y=23468+(f<<1<<2)|0,m=g[5857]|0,f=1<<f,m&f?(m=y+8|0,f=g[m>>2]|0):(g[5857]=m|f,f=y,m=y+8|0),g[m>>2]=D,g[f+12>>2]=D,g[D+8>>2]=f,g[D+12>>2]=y;break}if(f=S>>>8,f?S>>>0>16777215?v=31:(Fe=(f+1048320|0)>>>16&8,Ee=f<<Fe,Ne=(Ee+520192|0)>>>16&4,Ee=Ee<<Ne,v=(Ee+245760|0)>>>16&2,v=14-(Ne|Fe|v)+(Ee<<v>>>15)|0,v=S>>>(v+7|0)&1|v<<1):v=0,y=23732+(v<<2)|0,g[D+28>>2]=v,g[D+20>>2]=0,g[x>>2]=0,f=g[5858]|0,m=1<<v,!(f&m)){g[5858]=f|m,g[y>>2]=D,g[D+24>>2]=y,g[D+12>>2]=D,g[D+8>>2]=D;break}f=g[y>>2]|0;t:do if((g[f+4>>2]&-8|0)!=(S|0)){for(v=S<<((v|0)==31?0:25-(v>>>1)|0);y=f+16+(v>>>31<<2)|0,m=g[y>>2]|0,!!m;)if((g[m+4>>2]&-8|0)==(S|0)){f=m;break t}else v=v<<1,f=m;g[y>>2]=D,g[D+24>>2]=f,g[D+12>>2]=D,g[D+8>>2]=D;break e}while(0);Fe=f+8|0,Ee=g[Fe>>2]|0,g[Ee+12>>2]=D,g[Fe>>2]=D,g[D+8>>2]=Ee,g[D+12>>2]=f,g[D+24>>2]=0}}else Ee=g[5861]|0,(Ee|0)==0|S>>>0<Ee>>>0&&(g[5861]=S),g[5969]=S,g[5970]=R,g[5972]=0,g[5866]=g[5975],g[5865]=-1,g[5870]=23468,g[5869]=23468,g[5872]=23476,g[5871]=23476,g[5874]=23484,g[5873]=23484,g[5876]=23492,g[5875]=23492,g[5878]=23500,g[5877]=23500,g[5880]=23508,g[5879]=23508,g[5882]=23516,g[5881]=23516,g[5884]=23524,g[5883]=23524,g[5886]=23532,g[5885]=23532,g[5888]=23540,g[5887]=23540,g[5890]=23548,g[5889]=23548,g[5892]=23556,g[5891]=23556,g[5894]=23564,g[5893]=23564,g[5896]=23572,g[5895]=23572,g[5898]=23580,g[5897]=23580,g[5900]=23588,g[5899]=23588,g[5902]=23596,g[5901]=23596,g[5904]=23604,g[5903]=23604,g[5906]=23612,g[5905]=23612,g[5908]=23620,g[5907]=23620,g[5910]=23628,g[5909]=23628,g[5912]=23636,g[5911]=23636,g[5914]=23644,g[5913]=23644,g[5916]=23652,g[5915]=23652,g[5918]=23660,g[5917]=23660,g[5920]=23668,g[5919]=23668,g[5922]=23676,g[5921]=23676,g[5924]=23684,g[5923]=23684,g[5926]=23692,g[5925]=23692,g[5928]=23700,g[5927]=23700,g[5930]=23708,g[5929]=23708,g[5932]=23716,g[5931]=23716,Ee=R+-40|0,Ne=S+8|0,Ne=Ne&7|0?0-Ne&7:0,Fe=S+Ne|0,Ne=Ee-Ne|0,g[5863]=Fe,g[5860]=Ne,g[Fe+4>>2]=Ne|1,g[S+Ee+4>>2]=40,g[5864]=g[5979];while(0);if(f=g[5860]|0,f>>>0>ne>>>0)return Ne=f-ne|0,g[5860]=Ne,Ee=g[5863]|0,Fe=Ee+ne|0,g[5863]=Fe,g[Fe+4>>2]=Ne|1,g[Ee+4>>2]=ne|3,Ee=Ee+8|0,H=$t,Ee|0}return Ee=r8e()|0,g[Ee>>2]=12,Ee=0,H=$t,Ee|0}function oi(m){m=m|0;var f=0,y=0,v=0,x=0,S=0,R=0,P=0,D=0;if(m){y=m+-8|0,x=g[5861]|0,m=g[m+-4>>2]|0,f=m&-8,D=y+f|0;do if(m&1)P=y,R=y;else{if(v=g[y>>2]|0,!(m&3)||(R=y+(0-v)|0,S=v+f|0,R>>>0<x>>>0))return;if((g[5862]|0)==(R|0)){if(m=D+4|0,f=g[m>>2]|0,(f&3|0)!=3){P=R,f=S;break}g[5859]=S,g[m>>2]=f&-2,g[R+4>>2]=S|1,g[R+S>>2]=S;return}if(y=v>>>3,v>>>0<256)if(m=g[R+8>>2]|0,f=g[R+12>>2]|0,(f|0)==(m|0)){g[5857]=g[5857]&~(1<<y),P=R,f=S;break}else{g[m+12>>2]=f,g[f+8>>2]=m,P=R,f=S;break}x=g[R+24>>2]|0,m=g[R+12>>2]|0;do if((m|0)==(R|0)){if(f=R+16|0,y=f+4|0,m=g[y>>2]|0,m)f=y;else if(m=g[f>>2]|0,!m){m=0;break}for(;;)if(v=m+20|0,y=g[v>>2]|0,y)m=y,f=v;else if(v=m+16|0,y=g[v>>2]|0,y)m=y,f=v;else break;g[f>>2]=0}else P=g[R+8>>2]|0,g[P+12>>2]=m,g[m+8>>2]=P;while(0);if(x){if(f=g[R+28>>2]|0,y=23732+(f<<2)|0,(g[y>>2]|0)==(R|0)){if(g[y>>2]=m,!m){g[5858]=g[5858]&~(1<<f),P=R,f=S;break}}else if(P=x+16|0,g[((g[P>>2]|0)==(R|0)?P:x+20|0)>>2]=m,!m){P=R,f=S;break}g[m+24>>2]=x,f=R+16|0,y=g[f>>2]|0,y|0&&(g[m+16>>2]=y,g[y+24>>2]=m),f=g[f+4>>2]|0,f?(g[m+20>>2]=f,g[f+24>>2]=m,P=R,f=S):(P=R,f=S)}else P=R,f=S}while(0);if(!(R>>>0>=D>>>0)&&(m=D+4|0,v=g[m>>2]|0,!!(v&1))){if(v&2)g[m>>2]=v&-2,g[P+4>>2]=f|1,g[R+f>>2]=f,x=f;else{if((g[5863]|0)==(D|0)){if(D=(g[5860]|0)+f|0,g[5860]=D,g[5863]=P,g[P+4>>2]=D|1,(P|0)!=(g[5862]|0))return;g[5862]=0,g[5859]=0;return}if((g[5862]|0)==(D|0)){D=(g[5859]|0)+f|0,g[5859]=D,g[5862]=R,g[P+4>>2]=D|1,g[R+D>>2]=D;return}x=(v&-8)+f|0,y=v>>>3;do if(v>>>0<256)if(f=g[D+8>>2]|0,m=g[D+12>>2]|0,(m|0)==(f|0)){g[5857]=g[5857]&~(1<<y);break}else{g[f+12>>2]=m,g[m+8>>2]=f;break}else{S=g[D+24>>2]|0,m=g[D+12>>2]|0;do if((m|0)==(D|0)){if(f=D+16|0,y=f+4|0,m=g[y>>2]|0,m)f=y;else if(m=g[f>>2]|0,!m){y=0;break}for(;;)if(v=m+20|0,y=g[v>>2]|0,y)m=y,f=v;else if(v=m+16|0,y=g[v>>2]|0,y)m=y,f=v;else break;g[f>>2]=0,y=m}else y=g[D+8>>2]|0,g[y+12>>2]=m,g[m+8>>2]=y,y=m;while(0);if(S|0){if(m=g[D+28>>2]|0,f=23732+(m<<2)|0,(g[f>>2]|0)==(D|0)){if(g[f>>2]=y,!y){g[5858]=g[5858]&~(1<<m);break}}else if(v=S+16|0,g[((g[v>>2]|0)==(D|0)?v:S+20|0)>>2]=y,!y)break;g[y+24>>2]=S,m=D+16|0,f=g[m>>2]|0,f|0&&(g[y+16>>2]=f,g[f+24>>2]=y),m=g[m+4>>2]|0,m|0&&(g[y+20>>2]=m,g[m+24>>2]=y)}}while(0);if(g[P+4>>2]=x|1,g[R+x>>2]=x,(P|0)==(g[5862]|0)){g[5859]=x;return}}if(m=x>>>3,x>>>0<256){y=23468+(m<<1<<2)|0,f=g[5857]|0,m=1<<m,f&m?(f=y+8|0,m=g[f>>2]|0):(g[5857]=f|m,m=y,f=y+8|0),g[f>>2]=P,g[m+12>>2]=P,g[P+8>>2]=m,g[P+12>>2]=y;return}m=x>>>8,m?x>>>0>16777215?v=31:(R=(m+1048320|0)>>>16&8,D=m<<R,S=(D+520192|0)>>>16&4,D=D<<S,v=(D+245760|0)>>>16&2,v=14-(S|R|v)+(D<<v>>>15)|0,v=x>>>(v+7|0)&1|v<<1):v=0,m=23732+(v<<2)|0,g[P+28>>2]=v,g[P+20>>2]=0,g[P+16>>2]=0,f=g[5858]|0,y=1<<v;e:do if(!(f&y))g[5858]=f|y,g[m>>2]=P,g[P+24>>2]=m,g[P+12>>2]=P,g[P+8>>2]=P;else{m=g[m>>2]|0;t:do if((g[m+4>>2]&-8|0)!=(x|0)){for(v=x<<((v|0)==31?0:25-(v>>>1)|0);y=m+16+(v>>>31<<2)|0,f=g[y>>2]|0,!!f;)if((g[f+4>>2]&-8|0)==(x|0)){m=f;break t}else v=v<<1,m=f;g[y>>2]=P,g[P+24>>2]=m,g[P+12>>2]=P,g[P+8>>2]=P;break e}while(0);R=m+8|0,D=g[R>>2]|0,g[D+12>>2]=P,g[R>>2]=P,g[P+8>>2]=D,g[P+12>>2]=m,g[P+24>>2]=0}while(0);if(D=(g[5865]|0)+-1|0,g[5865]=D,!(D|0)){for(m=23884;m=g[m>>2]|0,m;)m=m+8|0;g[5865]=-1}}}}function rm(m,f){m=m|0,f=f|0;var y=0;return m?(y=ra(f,m)|0,(f|m)>>>0>65535&&(y=((y>>>0)/(m>>>0)|0|0)==(f|0)?y:-1)):y=0,m=tm(y)|0,!m||!(g[m+-4>>2]&3)||Vb(m|0,0,y|0)|0,m|0}function Gi(m,f,y,v){return m=m|0,f=f|0,y=y|0,v=v|0,y=m+y>>>0,Yr(f+v+(y>>>0<m>>>0|0)>>>0|0),y|0|0}function _c(m,f,y,v){return m=m|0,f=f|0,y=y|0,v=v|0,v=f-v-(y>>>0>m>>>0|0)>>>0,Yr(v|0),m-y>>>0|0|0}function mae(m){return m=m|0,(m?31-(ru(m^m-1)|0)|0:32)|0}function AV(m,f,y,v,x){m=m|0,f=f|0,y=y|0,v=v|0,x=x|0;var S=0,R=0,P=0,D=0,U=0,Y=0,ne=0,ge=0,_e=0,de=0;if(Y=m,D=f,U=D,R=y,ge=v,P=ge,!U)return S=(x|0)!=0,P?S?(g[x>>2]=m|0,g[x+4>>2]=f&0,ge=0,x=0,Yr(ge|0),x|0):(ge=0,x=0,Yr(ge|0),x|0):(S&&(g[x>>2]=(Y>>>0)%(R>>>0),g[x+4>>2]=0),ge=0,x=(Y>>>0)/(R>>>0)>>>0,Yr(ge|0),x|0);S=(P|0)==0;do if(R){if(!S){if(S=(ru(P|0)|0)-(ru(U|0)|0)|0,S>>>0<=31){ne=S+1|0,P=31-S|0,f=S-31>>31,R=ne,m=Y>>>(ne>>>0)&f|U<<P,f=U>>>(ne>>>0)&f,S=0,P=Y<<P;break}return x?(g[x>>2]=m|0,g[x+4>>2]=D|f&0,ge=0,x=0,Yr(ge|0),x|0):(ge=0,x=0,Yr(ge|0),x|0)}if(S=R-1|0,S&R|0){P=(ru(R|0)|0)+33-(ru(U|0)|0)|0,de=64-P|0,ne=32-P|0,D=ne>>31,_e=P-32|0,f=_e>>31,R=P,m=ne-1>>31&U>>>(_e>>>0)|(U<<ne|Y>>>(P>>>0))&f,f=f&U>>>(P>>>0),S=Y<<de&D,P=(U<<de|Y>>>(_e>>>0))&D|Y<<ne&P-33>>31;break}return x|0&&(g[x>>2]=S&Y,g[x+4>>2]=0),(R|0)==1?(_e=D|f&0,de=m|0|0,Yr(_e|0),de|0):(de=mae(R|0)|0,_e=U>>>(de>>>0)|0,de=U<<32-de|Y>>>(de>>>0)|0,Yr(_e|0),de|0)}else{if(S)return x|0&&(g[x>>2]=(U>>>0)%(R>>>0),g[x+4>>2]=0),_e=0,de=(U>>>0)/(R>>>0)>>>0,Yr(_e|0),de|0;if(!Y)return x|0&&(g[x>>2]=0,g[x+4>>2]=(U>>>0)%(P>>>0)),_e=0,de=(U>>>0)/(P>>>0)>>>0,Yr(_e|0),de|0;if(S=P-1|0,!(S&P))return x|0&&(g[x>>2]=m|0,g[x+4>>2]=S&U|f&0),_e=0,de=U>>>((mae(P|0)|0)>>>0),Yr(_e|0),de|0;if(S=(ru(P|0)|0)-(ru(U|0)|0)|0,S>>>0<=30){f=S+1|0,P=31-S|0,R=f,m=U<<P|Y>>>(f>>>0),f=U>>>(f>>>0),S=0,P=Y<<P;break}return x?(g[x>>2]=m|0,g[x+4>>2]=D|f&0,_e=0,de=0,Yr(_e|0),de|0):(_e=0,de=0,Yr(_e|0),de|0)}while(0);if(!R)U=P,D=0,P=0;else{ne=y|0|0,Y=ge|v&0,U=Gi(ne|0,Y|0,-1,-1)|0,y=oe()|0,D=P,P=0;do v=D,D=S>>>31|D<<1,S=P|S<<1,v=m<<1|v>>>31|0,ge=m>>>31|f<<1|0,_c(U|0,y|0,v|0,ge|0)|0,de=oe()|0,_e=de>>31|((de|0)<0?-1:0)<<1,P=_e&1,m=_c(v|0,ge|0,_e&ne|0,(((de|0)<0?-1:0)>>31|((de|0)<0?-1:0)<<1)&Y|0)|0,f=oe()|0,R=R-1|0;while(R|0);U=D,D=0}return R=0,x|0&&(g[x>>2]=m,g[x+4>>2]=f),_e=(S|0)>>>31|(U|R)<<1|(R<<1|S>>>31)&0|D,de=(S<<1|0>>>31)&-2|P,Yr(_e|0),de|0}function Ub(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0,U=0;return U=f>>31|((f|0)<0?-1:0)<<1,D=((f|0)<0?-1:0)>>31|((f|0)<0?-1:0)<<1,S=v>>31|((v|0)<0?-1:0)<<1,x=((v|0)<0?-1:0)>>31|((v|0)<0?-1:0)<<1,P=_c(U^m|0,D^f|0,U|0,D|0)|0,R=oe()|0,m=S^U,f=x^D,_c((AV(P,R,_c(S^y|0,x^v|0,S|0,x|0)|0,oe()|0,0)|0)^m|0,(oe()|0)^f|0,m|0,f|0)|0}function s8e(m,f){m=m|0,f=f|0;var y=0,v=0,x=0,S=0;return S=m&65535,x=f&65535,y=ra(x,S)|0,v=m>>>16,m=(y>>>16)+(ra(x,v)|0)|0,x=f>>>16,f=ra(x,S)|0,Yr((m>>>16)+(ra(x,v)|0)+(((m&65535)+f|0)>>>16)|0),m+f<<16|y&65535|0|0}function vc(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0;return x=m,S=y,y=s8e(x,S)|0,m=oe()|0,Yr((ra(f,S)|0)+(ra(v,x)|0)+m|m&0|0),y|0|0|0}function lD(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0,R=0,P=0,D=0,U=0;return x=H,H=H+16|0,P=x|0,R=f>>31|((f|0)<0?-1:0)<<1,S=((f|0)<0?-1:0)>>31|((f|0)<0?-1:0)<<1,U=v>>31|((v|0)<0?-1:0)<<1,D=((v|0)<0?-1:0)>>31|((v|0)<0?-1:0)<<1,m=_c(R^m|0,S^f|0,R|0,S|0)|0,f=oe()|0,AV(m,f,_c(U^y|0,D^v|0,U|0,D|0)|0,oe()|0,P)|0,v=_c(g[P>>2]^R|0,g[P+4>>2]^S|0,R|0,S|0)|0,y=oe()|0,H=x,Yr(y|0),v|0}function BT(m,f,y,v){m=m|0,f=f|0,y=y|0,v=v|0;var x=0,S=0;return S=H,H=H+16|0,x=S|0,AV(m,f,y,v,x)|0,H=S,Yr(g[x+4>>2]|0),g[x>>2]|0|0}function gae(m,f,y){return m=m|0,f=f|0,y=y|0,(y|0)<32?(Yr(f>>y|0),m>>>y|(f&(1<<y)-1)<<32-y):(Yr(((f|0)<0?-1:0)|0),f>>y-32|0)}function at(m,f,y){return m=m|0,f=f|0,y=y|0,(y|0)<32?(Yr(f>>>y|0),m>>>y|(f&(1<<y)-1)<<32-y):(Yr(0),f>>>y-32|0)}function Et(m,f,y){return m=m|0,f=f|0,y=y|0,(y|0)<32?(Yr(f<<y|(m&(1<<y)-1<<32-y)>>>32-y|0),m<<y):(Yr(m<<y-32|0),0)}function Aae(m,f){return m=+m,f=+f,m!=m?+f:f!=f?+m:+d_(+m,+f)}function yV(m,f){return m=+m,f=+f,m!=m?+f:f!=f?+m:+Qh(+m,+f)}function cD(m){return m=+m,m>=0?+bs(m+.5):+Mi(m-.5)}function uD(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0;if((y|0)>=8192)return Db(m|0,f|0,y|0)|0,m|0;if(S=m|0,x=m+y|0,(m&3)==(f&3)){for(;m&3;){if(!y)return S|0;Xe[m>>0]=Xe[f>>0]|0,m=m+1|0,f=f+1|0,y=y-1|0}for(y=x&-4|0,v=y-64|0;(m|0)<=(v|0);)g[m>>2]=g[f>>2],g[m+4>>2]=g[f+4>>2],g[m+8>>2]=g[f+8>>2],g[m+12>>2]=g[f+12>>2],g[m+16>>2]=g[f+16>>2],g[m+20>>2]=g[f+20>>2],g[m+24>>2]=g[f+24>>2],g[m+28>>2]=g[f+28>>2],g[m+32>>2]=g[f+32>>2],g[m+36>>2]=g[f+36>>2],g[m+40>>2]=g[f+40>>2],g[m+44>>2]=g[f+44>>2],g[m+48>>2]=g[f+48>>2],g[m+52>>2]=g[f+52>>2],g[m+56>>2]=g[f+56>>2],g[m+60>>2]=g[f+60>>2],m=m+64|0,f=f+64|0;for(;(m|0)<(y|0);)g[m>>2]=g[f>>2],m=m+4|0,f=f+4|0}else for(y=x-4|0;(m|0)<(y|0);)Xe[m>>0]=Xe[f>>0]|0,Xe[m+1>>0]=Xe[f+1>>0]|0,Xe[m+2>>0]=Xe[f+2>>0]|0,Xe[m+3>>0]=Xe[f+3>>0]|0,m=m+4|0,f=f+4|0;for(;(m|0)<(x|0);)Xe[m>>0]=Xe[f>>0]|0,m=m+1|0,f=f+1|0;return S|0}function Vb(m,f,y){m=m|0,f=f|0,y=y|0;var v=0,x=0,S=0,R=0;if(S=m+y|0,f=f&255,(y|0)>=67){for(;m&3;)Xe[m>>0]=f,m=m+1|0;for(v=S&-4|0,R=f|f<<8|f<<16|f<<24,x=v-64|0;(m|0)<=(x|0);)g[m>>2]=R,g[m+4>>2]=R,g[m+8>>2]=R,g[m+12>>2]=R,g[m+16>>2]=R,g[m+20>>2]=R,g[m+24>>2]=R,g[m+28>>2]=R,g[m+32>>2]=R,g[m+36>>2]=R,g[m+40>>2]=R,g[m+44>>2]=R,g[m+48>>2]=R,g[m+52>>2]=R,g[m+56>>2]=R,g[m+60>>2]=R,m=m+64|0;for(;(m|0)<(v|0);)g[m>>2]=R,m=m+4|0}for(;(m|0)<(S|0);)Xe[m>>0]=f,m=m+1|0;return S-y|0}function yae(m){return m=+m,m>=0?+bs(m+.5):+Mi(m-.5)}function g_(m){m=m|0;var f=0,y=0,v=0;return v=LT()|0,y=g[vs>>2]|0,f=y+m|0,(m|0)>0&(f|0)<(y|0)|(f|0)<0?(je(f|0)|0,ml(12),-1):(f|0)>(v|0)&&!(he(f|0)|0)?(ml(12),-1):(g[vs>>2]=f,y|0)}return{___divdi3:Ub,___muldi3:vc,___remdi3:lD,___uremdi3:BT,_areNeighborCells:jFe,_bitshift64Ashr:gae,_bitshift64Lshr:at,_bitshift64Shl:Et,_calloc:rm,_cellAreaKm2:T6e,_cellAreaM2:S6e,_cellAreaRads2:gV,_cellToBoundary:uR,_cellToCenterChild:n6e,_cellToChildPos:f6e,_cellToChildren:i6e,_cellToChildrenSize:aD,_cellToLatLng:cR,_cellToLocalIj:I6e,_cellToParent:uV,_cellToVertex:Kd,_cellToVertexes:X6e,_cellsToDirectedEdge:HFe,_cellsToLinkedMultiPolygon:RFe,_childPosToCell:m6e,_compactCells:o6e,_destroyLinkedMultiPolygon:sae,_directedEdgeToBoundary:oD,_directedEdgeToCells:QFe,_edgeLengthKm:C6e,_edgeLengthM:M6e,_edgeLengthRads:E6e,_emscripten_replace_memory:Qr,_free:oi,_getBaseCellNumber:Joe,_getDirectedEdgeDestination:WFe,_getDirectedEdgeOrigin:qFe,_getHexagonAreaAvgKm2:v6e,_getHexagonAreaAvgM2:b6e,_getHexagonEdgeLengthAvgKm:w6e,_getHexagonEdgeLengthAvgM:x6e,_getIcosahedronFaces:eae,_getNumCells:mV,_getPentagons:fV,_getRes0Cells:LFe,_getResolution:r6e,_greatCircleDistanceKm:dR,_greatCircleDistanceM:A6e,_greatCircleDistanceRads:g6e,_gridDisk:oR,_gridDiskDistances:aR,_gridDistance:L6e,_gridPathCells:N6e,_gridPathCellsSize:D6e,_gridRingUnsafe:SFe,_i64Add:Gi,_i64Subtract:_c,_isPentagon:Un,_isResClassIII:c6e,_isValidCell:cV,_isValidDirectedEdge:YFe,_isValidVertex:J6e,_latLngToCell:Koe,_llvm_maxnum_f64:Aae,_llvm_minnum_f64:yV,_llvm_round_f64:cD,_localIjToCell:$6e,_malloc:tm,_maxFaceCount:d6e,_maxGridDiskSize:rD,_maxPolygonToCellsSize:EFe,_memcpy:uD,_memset:Vb,_originToDirectedEdges:XFe,_pentagonCount:p6e,_polygonToCells:CFe,_readInt64AsDoubleFromPointer:q6e,_res0CellCount:$Fe,_round:yae,_sbrk:g_,_sizeOfCellBoundary:V6e,_sizeOfCoordIJ:H6e,_sizeOfGeoLoop:z6e,_sizeOfGeoPolygon:G6e,_sizeOfH3Index:B6e,_sizeOfLatLng:U6e,_sizeOfLinkedGeoPolygon:j6e,_uncompactCells:a6e,_uncompactCellsSize:l6e,_vertexToLatLng:Z6e,establishStackSpace:em,stackAlloc:Lo,stackRestore:kl,stackSave:_n}}(Ls,on,te);e.___divdi3=Ze.___divdi3,e.___muldi3=Ze.___muldi3,e.___remdi3=Ze.___remdi3,e.___uremdi3=Ze.___uremdi3,e._areNeighborCells=Ze._areNeighborCells,e._bitshift64Ashr=Ze._bitshift64Ashr,e._bitshift64Lshr=Ze._bitshift64Lshr,e._bitshift64Shl=Ze._bitshift64Shl,e._calloc=Ze._calloc,e._cellAreaKm2=Ze._cellAreaKm2,e._cellAreaM2=Ze._cellAreaM2,e._cellAreaRads2=Ze._cellAreaRads2,e._cellToBoundary=Ze._cellToBoundary,e._cellToCenterChild=Ze._cellToCenterChild,e._cellToChildPos=Ze._cellToChildPos,e._cellToChildren=Ze._cellToChildren,e._cellToChildrenSize=Ze._cellToChildrenSize,e._cellToLatLng=Ze._cellToLatLng,e._cellToLocalIj=Ze._cellToLocalIj,e._cellToParent=Ze._cellToParent,e._cellToVertex=Ze._cellToVertex,e._cellToVertexes=Ze._cellToVertexes,e._cellsToDirectedEdge=Ze._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=Ze._cellsToLinkedMultiPolygon,e._childPosToCell=Ze._childPosToCell,e._compactCells=Ze._compactCells,e._destroyLinkedMultiPolygon=Ze._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=Ze._directedEdgeToBoundary,e._directedEdgeToCells=Ze._directedEdgeToCells,e._edgeLengthKm=Ze._edgeLengthKm,e._edgeLengthM=Ze._edgeLengthM,e._edgeLengthRads=Ze._edgeLengthRads;var Ko=e._emscripten_replace_memory=Ze._emscripten_replace_memory;e._free=Ze._free,e._getBaseCellNumber=Ze._getBaseCellNumber,e._getDirectedEdgeDestination=Ze._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=Ze._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=Ze._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=Ze._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=Ze._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=Ze._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=Ze._getIcosahedronFaces,e._getNumCells=Ze._getNumCells,e._getPentagons=Ze._getPentagons,e._getRes0Cells=Ze._getRes0Cells,e._getResolution=Ze._getResolution,e._greatCircleDistanceKm=Ze._greatCircleDistanceKm,e._greatCircleDistanceM=Ze._greatCircleDistanceM,e._greatCircleDistanceRads=Ze._greatCircleDistanceRads,e._gridDisk=Ze._gridDisk,e._gridDiskDistances=Ze._gridDiskDistances,e._gridDistance=Ze._gridDistance,e._gridPathCells=Ze._gridPathCells,e._gridPathCellsSize=Ze._gridPathCellsSize,e._gridRingUnsafe=Ze._gridRingUnsafe,e._i64Add=Ze._i64Add,e._i64Subtract=Ze._i64Subtract,e._isPentagon=Ze._isPentagon,e._isResClassIII=Ze._isResClassIII,e._isValidCell=Ze._isValidCell,e._isValidDirectedEdge=Ze._isValidDirectedEdge,e._isValidVertex=Ze._isValidVertex,e._latLngToCell=Ze._latLngToCell,e._llvm_maxnum_f64=Ze._llvm_maxnum_f64,e._llvm_minnum_f64=Ze._llvm_minnum_f64,e._llvm_round_f64=Ze._llvm_round_f64,e._localIjToCell=Ze._localIjToCell,e._malloc=Ze._malloc,e._maxFaceCount=Ze._maxFaceCount,e._maxGridDiskSize=Ze._maxGridDiskSize,e._maxPolygonToCellsSize=Ze._maxPolygonToCellsSize,e._memcpy=Ze._memcpy,e._memset=Ze._memset,e._originToDirectedEdges=Ze._originToDirectedEdges,e._pentagonCount=Ze._pentagonCount,e._polygonToCells=Ze._polygonToCells,e._readInt64AsDoubleFromPointer=Ze._readInt64AsDoubleFromPointer,e._res0CellCount=Ze._res0CellCount,e._round=Ze._round,e._sbrk=Ze._sbrk,e._sizeOfCellBoundary=Ze._sizeOfCellBoundary,e._sizeOfCoordIJ=Ze._sizeOfCoordIJ,e._sizeOfGeoLoop=Ze._sizeOfGeoLoop,e._sizeOfGeoPolygon=Ze._sizeOfGeoPolygon,e._sizeOfH3Index=Ze._sizeOfH3Index,e._sizeOfLatLng=Ze._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=Ze._sizeOfLinkedGeoPolygon,e._uncompactCells=Ze._uncompactCells,e._uncompactCellsSize=Ze._uncompactCellsSize,e._vertexToLatLng=Ze._vertexToLatLng,e.establishStackSpace=Ze.establishStackSpace;var bo=e.stackAlloc=Ze.stackAlloc,yn=e.stackRestore=Ze.stackRestore,Vs=e.stackSave=Ze.stackSave;if(e.asm=Ze,e.cwrap=$,e.setValue=_,e.getValue=w,Lr){Ft(Lr)||(Lr=n(Lr));{ei();var Ss=function(Pe){Pe.byteLength&&(Pe=new Uint8Array(Pe)),Ae.set(Pe,A),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,zi()},an=function(){o(Lr,Ss,function(){throw"could not load memory initializer "+Lr})},Xi=ss(Lr);if(Xi)Ss(Xi.buffer);else if(e.memoryInitializerRequest){var ea=function(){var Pe=e.memoryInitializerRequest,Ge=Pe.response;if(Pe.status!==200&&Pe.status!==0){var dt=ss(e.memoryInitializerRequestURL);if(dt)Ge=dt.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+Pe.status+", retrying "+Lr),an();return}}Ss(Ge)};e.memoryInitializerRequest.response?setTimeout(ea,0):e.memoryInitializerRequest.addEventListener("load",ea)}else an()}}var ya;Er=function Pe(){ya||Ie(),ya||(Er=Pe)};function Ie(Pe){if(Tr>0||(Je(),Tr>0))return;function Ge(){ya||(ya=!0,!T&&(vt(),lt(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),Ye()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),Ge()},1)):Ge()}e.run=Ie;function Ii(Pe){throw e.onAbort&&e.onAbort(Pe),Pe+="",a(Pe),l(Pe),T=!0,"abort("+Pe+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=Ii,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return Ie(),t}(typeof Ab=="object"?Ab:{}),Si="number",Xr=Si,LO=Si,li=Si,ci=Si,Rc=Si,ar=Si,WLt=[["sizeOfH3Index",Si],["sizeOfLatLng",Si],["sizeOfCellBoundary",Si],["sizeOfGeoLoop",Si],["sizeOfGeoPolygon",Si],["sizeOfLinkedGeoPolygon",Si],["sizeOfCoordIJ",Si],["readInt64AsDoubleFromPointer",Si],["isValidCell",LO,[li,ci]],["latLngToCell",Xr,[Si,Si,Rc,ar]],["cellToLatLng",Xr,[li,ci,ar]],["cellToBoundary",Xr,[li,ci,ar]],["maxGridDiskSize",Xr,[Si,ar]],["gridDisk",Xr,[li,ci,Si,ar]],["gridDiskDistances",Xr,[li,ci,Si,ar,ar]],["gridRingUnsafe",Xr,[li,ci,Si,ar]],["maxPolygonToCellsSize",Xr,[ar,Rc,Si,ar]],["polygonToCells",Xr,[ar,Rc,Si,ar]],["cellsToLinkedMultiPolygon",Xr,[ar,Si,ar]],["destroyLinkedMultiPolygon",null,[ar]],["compactCells",Xr,[ar,ar,Si,Si]],["uncompactCells",Xr,[ar,Si,Si,ar,Si,Rc]],["uncompactCellsSize",Xr,[ar,Si,Si,Rc,ar]],["isPentagon",LO,[li,ci]],["isResClassIII",LO,[li,ci]],["getBaseCellNumber",Si,[li,ci]],["getResolution",Si,[li,ci]],["maxFaceCount",Xr,[li,ci,ar]],["getIcosahedronFaces",Xr,[li,ci,ar]],["cellToParent",Xr,[li,ci,Rc,ar]],["cellToChildren",Xr,[li,ci,Rc,ar]],["cellToCenterChild",Xr,[li,ci,Rc,ar]],["cellToChildrenSize",Xr,[li,ci,Rc,ar]],["cellToChildPos",Xr,[li,ci,Rc,ar]],["childPosToCell",Xr,[Si,Si,li,ci,Rc,ar]],["areNeighborCells",Xr,[li,ci,li,ci,ar]],["cellsToDirectedEdge",Xr,[li,ci,li,ci,ar]],["getDirectedEdgeOrigin",Xr,[li,ci,ar]],["getDirectedEdgeDestination",Xr,[li,ci,ar]],["isValidDirectedEdge",LO,[li,ci]],["directedEdgeToCells",Xr,[li,ci,ar]],["originToDirectedEdges",Xr,[li,ci,ar]],["directedEdgeToBoundary",Xr,[li,ci,ar]],["gridDistance",Xr,[li,ci,li,ci,ar]],["gridPathCells",Xr,[li,ci,li,ci,ar]],["gridPathCellsSize",Xr,[li,ci,li,ci,ar]],["cellToLocalIj",Xr,[li,ci,li,ci,Si,ar]],["localIjToCell",Xr,[li,ci,ar,Si,ar]],["getHexagonAreaAvgM2",Xr,[Rc,ar]],["getHexagonAreaAvgKm2",Xr,[Rc,ar]],["getHexagonEdgeLengthAvgM",Xr,[Rc,ar]],["getHexagonEdgeLengthAvgKm",Xr,[Rc,ar]],["greatCircleDistanceM",Si,[ar,ar]],["greatCircleDistanceKm",Si,[ar,ar]],["greatCircleDistanceRads",Si,[ar,ar]],["cellAreaM2",Xr,[li,ci,ar]],["cellAreaKm2",Xr,[li,ci,ar]],["cellAreaRads2",Xr,[li,ci,ar]],["edgeLengthM",Xr,[li,ci,ar]],["edgeLengthKm",Xr,[li,ci,ar]],["edgeLengthRads",Xr,[li,ci,ar]],["getNumCells",Xr,[Rc,ar]],["getRes0Cells",Xr,[ar]],["res0CellCount",Si],["getPentagons",Xr,[Si,ar]],["pentagonCount",Si],["cellToVertex",Xr,[li,ci,Si,ar]],["cellToVertexes",Xr,[li,ci,ar]],["vertexToLatLng",Xr,[li,ci,ar]],["isValidVertex",LO,[li,ci]]],YLt=0,QLt=1,XLt=2,ZLt=3,JLt=4,KLt=5,eDt=6,tDt=7,rDt=8,iDt=9,sDt=10,nDt=11,oDt=12,aDt=13,lDt=14,cDt=15,gc={};gc[YLt]="Success";gc[QLt]="The operation failed but a more specific error is not available";gc[XLt]="Argument was outside of acceptable range";gc[ZLt]="Latitude or longitude arguments were outside of acceptable range";gc[JLt]="Resolution argument was outside of acceptable range";gc[KLt]="Cell argument was not valid";gc[eDt]="Directed edge argument was not valid";gc[tDt]="Undirected edge argument was not valid";gc[rDt]="Vertex argument was not valid";gc[iDt]="Pentagon distortion was encountered";gc[sDt]="Duplicate input";gc[nDt]="Cell arguments were not neighbors";gc[oDt]="Cell arguments had incompatible resolutions";gc[aDt]="Memory allocation failed";gc[lDt]="Bounds of provided memory were insufficient";gc[cDt]="Mode or flags argument was not valid";var uDt="Unknown error";function hDt(t,e,r){var i=r&&"value"in r,s=new Error((t[e]||uDt)+" (code: "+e+(i?", value: "+r.value:"")+")");return s.code=e,s}function dDt(t,e){var r=arguments.length===2?{value:e}:{};return hDt(gc,t,r)}function pDt(t){if(t!==0)throw dDt(t)}var h_={};WLt.forEach(function(e){h_[e[0]]=Ab.cwrap.apply(Ab,e)});var F_e=16,AB=8;h_.sizeOfH3Index();h_.sizeOfLatLng();var fDt=h_.sizeOfCellBoundary();h_.sizeOfGeoPolygon();h_.sizeOfGeoLoop();h_.sizeOfLinkedGeoPolygon();h_.sizeOfCoordIJ();var mDt=/[^0-9a-fA-F]/;function gDt(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||mDt.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),F_e),r=parseInt(t.substring(t.length-8),F_e);return[r,e]}function yB(t){return bDt(Ab.getValue(t,"double"))}function ADt(t){return[yB(t),yB(t+AB)]}function yDt(t){return[yB(t+AB),yB(t)]}function _Dt(t,e,r){for(var i=Ab.getValue(t,"i32"),s=t+AB,n=[],o=e?yDt:ADt,a=0;a<i*2;a+=2)n.push(o(s+AB*a));return r&&n.push(n[0]),n}function vDt(t,e){var r=Ab._malloc(fDt),i=gDt(t),s=i[0],n=i[1];try{return pDt(h_.cellToBoundary(s,n,r)),_Dt(r,e,e)}finally{Ab._free(r)}}function bDt(t){return t*180/Math.PI}function wDt(t,e){const r=e.map(n=>n.count);r.reduce((n,o)=>Math.min(n,o)),r.reduce((n,o)=>Math.max(n,o));const i=new PM({title:"{h3}",content:TDt}),s=[];e.forEach(n=>{const o=new pl({geometry:new sf({rings:[vDt(n.h3,!0)]}),attributes:n,symbol:xDt(n.count),popupTemplate:i});o.geometry.extent.width>50&&SDt(o),s.push(o)}),console.log(`adding ${s.length} hexbins...`),t.removeAll(),t.graphics.addMany(s)}function xDt(t){let r=[255,0,0,.5];return t>1e6?r=[0,128,0,.5]:t>5e5?r=[54,205,50,.5]:t>5e4?r=[255,255,0,.5]:t>1e3&&(r=[255,69,0,.5]),{type:"simple-fill",color:r,outline:{color:"whitesmoke",width:0}}}function TDt(t){return`${parseInt(t.graphic.attributes.count).toLocaleString()} soundings within this hexbin`}function SDt(t){const e=[],r=t.geometry;if(r.rings.length>1){console.warn("function only supports simple geometries");return}r.rings[0].forEach(i=>{i[0]<0?e.push([i[0]+360,i[1]]):e.push(i)}),r.rings=[e]}function EDt({hexbins:t}){const e="MapPanel",r=Rd.useRef(null),i=Rd.useRef(),s=Rd.useRef(),n=[-98.5833,39.8333],o=4;return Rd.useEffect(()=>{if(!r.current){console.warn("mapDiv not yet available");return}const a=new G2e({basemap:"oceans"}),l=new yLt({map:a,container:r.current,zoom:o,center:n});s.current=new _Lt,a.add(s.current);let c=new qLt({view:l});l.when(function(){i.current=l,l.ui.add(c,"bottom-left")})},[r.current]),Rd.useEffect(()=>{t&&s.current&&wDt(s.current,t)},[t]),Cl("div",{className:e,ref:r})}function CDt(){const[t,e]=Rd.useState(!1),[r,i]=Rd.useState(null);return Rd.useEffect(()=>{const s=new AbortController;return e(!0),Promise.all([fetch("https://order-pickup.s3.amazonaws.com/csb_statistics.json",{signal:s.signal}).then(n=>n.json()),fetch("https://order-pickup.s3.amazonaws.com/csb_counts_by_h3.json",{signal:s.signal}).then(n=>n.json())]).then(n=>{i(Object.assign(n[0],n[1]))}).finally(()=>{e(!1)}),()=>{s.abort()}},[]),O8e("div",{className:"App",children:[Cl(MDt,{}),Cl(RDt,{}),Cl(EDt,{hexbins:r?r.counts_by_h3:[]}),Cl(ODt,{}),Cl(PDt,{})]})}function MDt(){return Cl("div",{className:"HeaderPanel",children:Cl("header",{children:Cl("h2",{children:"HEADER"})})})}function RDt(){return Cl("div",{className:"SidePanel",children:Cl("h2",{children:"SIDEPANEL"})})}function ODt(){return Cl("div",{className:"LineGraphPanel",children:Cl("h2",{children:"LINEGRAPHPANEL"})})}function PDt(){return Cl("div",{className:"FooterPanel",children:Cl("footer",{children:Cl("h2",{children:"FOOTER"})})})}sq.createRoot(document.getElementById("root")).render(Cl(x8e.StrictMode,{children:Cl(CDt,{})}));export{tu as $,so as A,sn as B,N as C,Is as D,et as E,VSe as F,dl as G,Zse as H,Bs as I,pl as J,V as K,jQt as L,Vu as M,T0 as N,Zn as O,iat as P,SI as Q,or as R,a3t as S,ce as T,Ys as U,Uqe as V,TT as W,Vkt as X,wxe as Y,DB as Z,be as _,gt as a,r$ as a$,ote as a0,Sh as a1,Nlt as a2,si as a3,B0 as a4,dL as a5,y0 as a6,Gt as a7,Uce as a8,jx as a9,Lx as aA,z8t as aB,Cbe as aC,iK as aD,RM as aE,YFt as aF,Art as aG,gr as aH,yT as aI,Ny as aJ,Ki as aK,xt as aL,Wg as aM,Qe as aN,M3 as aO,ft as aP,St as aQ,Ice as aR,yie as aS,RCe as aT,$Ke as aU,IKe as aV,Co as aW,Cb as aX,lte as aY,AYe as aZ,$g as a_,zB as aa,xT as ab,Nn as ac,l1t as ad,qo as ae,_L as af,q2e as ag,TNt as ah,fje as ai,Tg as aj,ir as ak,qrt as al,tf as am,ao as an,WDt as ao,aW as ap,Xv as aq,S3 as ar,o3t as as,Yi as at,lL as au,da as av,Nl as aw,jv as ax,iwe as ay,os as az,j as b,st as b$,F0 as b0,tU as b1,wn as b2,zDt as b3,Zd as b4,Mo as b5,B as b6,Rt as b7,yM as b8,la as b9,Bi as bA,Vd as bB,$e as bC,FW as bD,sT as bE,r7 as bF,I as bG,qh as bH,a_ as bI,ot as bJ,Dt as bK,Ni as bL,Vi as bM,Fi as bN,Pi as bO,Rr as bP,qu as bQ,zr as bR,Vg as bS,$b as bT,ie as bU,$a as bV,hl as bW,qt as bX,Vr as bY,Hi as bZ,Be as b_,roe as ba,IT as bb,pr as bc,Vv as bd,l5e as be,He as bf,UWt as bg,Jo as bh,zWt as bi,tFt as bj,Jje as bk,T2 as bl,kWt as bm,b9 as bn,zy as bo,ys as bp,nFt as bq,sVt as br,Di as bs,ho as bt,n$e as bu,$n as bv,fU as bw,nn as bx,y4 as by,Kr as bz,vg as c,hz as c$,Me as c0,nc as c1,ns as c2,Exe as c3,GWt as c4,jWt as c5,qWt as c6,gre as c7,Jl as c8,yWe as c9,wR as cA,ll as cB,GB as cC,Lkt as cD,Po as cE,Fs as cF,Ba as cG,Fg as cH,Xt as cI,qe as cJ,V$ as cK,J$ as cL,rrt as cM,rzt as cN,izt as cO,z$ as cP,M_t as cQ,PVt as cR,RGt as cS,M8t as cT,Q$ as cU,vdt as cV,RFt as cW,HB as cX,xb as cY,r4 as cZ,pre as c_,Ar as ca,sU as cb,sFt as cc,Nt as cd,Z0 as ce,Wi as cf,Li as cg,UQt as ch,Zlt as ci,hHt as cj,Fx as ck,Jrt as cl,c_ as cm,ug as cn,Dkt as co,yU as cp,Txe as cq,wCe as cr,fP as cs,TSe as ct,Nkt as cu,di as cv,NDt as cw,Oe as cx,m9 as cy,MD as cz,LDt as d,TVt as d$,Fv as d0,tW as d1,k$ as d2,Nx as d3,ze as d4,gi as d5,tbe as d6,Ph as d7,ke as d8,_ie as d9,Qi as dA,GN as dB,ka as dC,w$e as dD,Wh as dE,EOt as dF,aWe as dG,EFt as dH,hye as dI,A3 as dJ,H3 as dK,mqe as dL,hf as dM,Uu as dN,OFt as dO,Nr as dP,co as dQ,ZDe as dR,LM as dS,jr as dT,e3e as dU,t3e as dV,IVt as dW,EM as dX,STe as dY,VWt as dZ,wVe as d_,zSe as da,j0 as db,iU as dc,Are as dd,Zr as de,jh as df,Dn as dg,Vce as dh,Dd as di,Rxe as dj,Ml as dk,fv as dl,Pu as dm,I$ as dn,C3 as dp,lf as dq,pf as dr,_qe as ds,Mt as dt,s0t as du,zQt as dv,q3 as dw,ic as dx,nNe as dy,Ot as dz,u as e,hqt as e$,q9e as e0,Te as e1,UB as e2,$y as e3,ONt as e4,CNt as e5,AU as e6,kre as e7,ny as e8,iBt as e9,GEt as eA,jc as eB,C8t as eC,Xee as eD,GDt as eE,T5t as eF,Dg as eG,GTe as eH,jTe as eI,pa as eJ,t2e as eK,U2e as eL,J3t as eM,W4t as eN,Wt as eO,At as eP,yr as eQ,ZQ as eR,JV as eS,cTe as eT,oW as eU,MK as eV,cqt as eW,yqt as eX,ULe as eY,$Ae as eZ,lqt as e_,$s as ea,z9 as eb,U0 as ec,ms as ed,sYt as ee,S5t as ef,Od as eg,nte as eh,n5t as ei,v4 as ej,Ete as ek,es as el,K0 as em,LVt as en,NVt as eo,kOe as ep,A0 as eq,F_t as er,rOt as es,HWt as et,xv as eu,wWe as ev,cl as ew,EU as ex,Bpe as ey,Bce as ez,Ke as f,Qo as f$,oqt as f0,j6 as f1,wH as f2,y6 as f3,u8 as f4,Y0 as f5,Bt as f6,rNt as f7,uf as f8,zne as f9,R1t as fA,iFt as fB,jVt as fC,GVt as fD,Vy as fE,rM as fF,Mh as fG,sl as fH,AHt as fI,Yne as fJ,DVt as fK,V4e as fL,Dl as fM,f5t as fN,Qv as fO,_0 as fP,Sd as fQ,d5 as fR,EVt as fS,oue as fT,vVt as fU,e1t as fV,oU as fW,wT as fX,VSt as fY,$ne as fZ,OL as f_,Fp as fa,PAe as fb,tt as fc,bCt as fd,wCt as fe,Eb as ff,bT as fg,DM as fh,Sr as fi,ktt as fj,kR as fk,J8t as fl,aU as fm,K8t as fn,yL as fo,ekt as fp,lU as fq,mL as fr,kMe as fs,Nje as ft,Z8t as fu,CVt as fv,Vqe as fw,sb as fx,USt as fy,P1t as fz,Zi as g,V8t as g$,Fy as g0,xxe as g1,aEt as g2,UDt as g3,Fot as g4,eNt as g5,zu as g6,k8t as g7,eu as g8,mct as g9,gb as gA,M7 as gB,Xne as gC,E7 as gD,sR as gE,qvt as gF,yse as gG,rR as gH,Pg as gI,QUe as gJ,G0 as gK,c1t as gL,BRt as gM,J9e as gN,K9e as gO,qse as gP,Ese as gQ,WWt as gR,Hse as gS,nT as gT,Da as gU,I0 as gV,Dbt as gW,mn as gX,ul as gY,fre as gZ,rn as g_,d9t as ga,bqt as gb,yoe as gc,RNt as gd,qi as ge,Pd as gf,V0 as gg,rUt as gh,uo as gi,dx as gj,dn as gk,EY as gl,DEt as gm,Uh as gn,Fu as go,sSe as gp,Yd as gq,mr as gr,nt as gs,Qg as gt,lr as gu,X0 as gv,l_ as gw,KU as gx,Ib as gy,S7 as gz,Cr as h,Lte as h$,Jhe as h0,Ly as h1,Xot as h2,tRe as h3,oat as h4,I3e as h5,drt as h6,Nie as h7,PM as h8,er as h9,nr as hA,Jn as hB,mc as hC,en as hD,qs as hE,Ol as hF,kg as hG,gn as hH,Pb as hI,h9 as hJ,Ob as hK,w7 as hL,rVt as hM,cr as hN,HTe as hO,IFt as hP,A8t as hQ,XB as hR,W6t as hS,Fl as hT,Xn as hU,D6t as hV,CVe as hW,LVe as hX,hx as hY,GCe as hZ,V2e as h_,Ui as ha,Zot as hb,mbe as hc,Oi as hd,CFt as he,ySe as hf,S_t as hg,KNt as hh,qDt as hi,Fqt as hj,XNt as hk,yet as hl,SVt as hm,Eh as hn,DCe as ho,M3e as hp,s5t as hq,Att as hr,oNt as hs,Nv as ht,Af as hu,kbt as hv,zd as hw,pd as hx,En as hy,$i as hz,we as i,SFt as i$,Y5t as i0,tc as i1,gie as i2,KJe as i3,U3 as i4,ket as i5,fNt as i6,Gbe as i7,NB as i8,vre as i9,kCe as iA,eKe as iB,bme as iC,k1t as iD,PNt as iE,gVt as iF,k2e as iG,mGe as iH,dNt as iI,NU as iJ,Rg as iK,CL as iL,het as iM,xVt as iN,Wrt as iO,SNt as iP,ENt as iQ,MNt as iR,G$ as iS,kd as iT,pje as iU,e4e as iV,xs as iW,BF as iX,iR as iY,WL as iZ,t8t as i_,Gx as ia,Y$ as ib,uv as ic,Fd as id,pHe as ie,O3 as ig,fHe as ih,DQe as ii,Dx as ij,L5t as ik,oFt as il,hC as im,wI as io,nue as ip,e8t as iq,xhe as ir,r8t as is,gNt as it,rre as iu,Swe as iv,P7e as iw,q6t as ix,UCe as iy,zCe as iz,ee as j,u_ as j$,Dv as j0,s5 as j1,tre as j2,ere as j3,ECe as j4,hNt as j5,tx as j6,hc as j7,ZC as j8,gJe as j9,pg as jA,nYe as jB,WFt as jC,Bqe as jD,hi as jE,Aa as jF,ki as jG,xn as jH,ga as jI,HC as jJ,UGt as jK,Dte as jL,iNt as jM,Go as jN,V5t as jO,U5t as jP,$we as jQ,Pwe as jR,kte as jS,wFt as jT,TFt as jU,xFt as jV,ag as jW,g4 as jX,Rl as jY,ls as jZ,ma as j_,Fn as ja,px as jb,Ix as jc,K$ as jd,qn as je,nQ as jf,aQ as jg,Nk as jh,kqe as ji,al as jj,R4 as jk,eze as jl,GFt as jm,Hqe as jn,qqe as jo,fb as jp,qx as jq,$h as jr,MFt as js,UFt as jt,VFt as ju,Kx as jv,RW as jw,i3 as jx,vfe as jy,$r as jz,pn as k,Q0 as k$,MC as k0,sc as k1,DGt as k2,pK as k3,G5t as k4,EW as k5,PU as k6,_6t as k7,v6t as k8,b6t as k9,zre as kA,vL as kB,Rs as kC,LI as kD,wU as kE,ESe as kF,HFt as kG,jFt as kH,Hct as kI,Yct as kJ,z5t as kK,B5t as kL,k5t as kM,jd as kN,Q2 as kO,P_t as kP,jte as kQ,Ipe as kR,sUt as kS,Ppe as kT,sre as kU,Hc as kV,cf as kW,dU as kX,Avt as kY,Kc as kZ,e7 as k_,w6t as ka,af as kb,Sn as kc,l0 as kd,Ch as ke,cse as kf,lse as kg,pxe as kh,fo as ki,Tt as kj,In as kk,zFt as kl,$We as km,LE as kn,JTe as ko,QRe as kp,ct as kq,Iu as kr,Zv as ks,YB as kt,Yte as ku,Iy as kv,Bct as kw,Uo as kx,WRe as ky,Yy as kz,xe as l,ju as l$,Na as l0,EEt as l1,DDt as l2,gx as l3,Fht as l4,xBt as l5,bBt as l6,wBt as l7,FFt as l8,jNt as l9,kFt as lA,JNt as lB,qg as lC,$re as lD,ITe as lE,W0 as lF,pM as lG,Fr as lH,Il as lI,C7 as lJ,u$e as lK,b$e as lL,Zt as lM,ks as lN,rFt as lO,Ure as lP,_ge as lQ,jge as lR,f4 as lS,aL as lT,Hr as lU,Dp as lV,Lce as lW,$Ft as lX,rv as lY,Wd as lZ,D7 as l_,Uv as la,H9 as lb,a4e as lc,tUt as ld,Xct as le,uP as lf,qC as lg,NW as lh,dc as li,E3 as lj,UC as lk,tte as ll,s9t as lm,FB as ln,n2t as lo,_vt as lp,cT as lq,bg as lr,hr as ls,rte as lt,MVt as lu,ng as lv,ZPe as lw,ST as lx,Vre as ly,zNt as lz,vo as m,_8t as m$,fc as m0,Ld as m1,Io as m2,m$e as m3,DFt as m4,HAt as m5,qd as m6,gWe as m7,C$e as m8,mM as m9,Zy as mA,KWe as mB,By as mC,TU as mD,jpt as mE,LFt as mF,wfe as mG,iUt as mH,ET as mI,hqe as mJ,jM as mK,Frt as mL,$5t as mM,zrt as mN,Iot as mO,kot as mP,y3e as mQ,YCt as mR,WCt as mS,N$ as mT,NM as mU,rit as mV,jDt as mW,Utt as mX,u5t as mY,O7e as mZ,AVt as m_,$3 as ma,OJ as mb,Rne as mc,sNt as md,V9e as me,BFt as mf,K7 as mg,kk as mh,Bvt as mi,qQt as mj,YQt as mk,WQt as ml,hL as mm,ZNt as mn,Cw as mo,Ope as mp,Bm as mq,i4 as mr,jre as ms,G3 as mt,GNt as mu,bmt as mv,Hre as mw,pTe as mx,z3 as my,mSe as mz,zt as n,tet as n$,Qtt as n0,ELt as n1,qGe as n2,tje as n3,iot as n4,sot as n5,not as n6,XOt as n7,ZOt as n8,GOt as n9,S2t as nA,j6t as nB,V6t as nC,B6t as nD,J6t as nE,Z6t as nF,G6t as nG,ite as nH,MKe as nI,Bet as nJ,jCe as nK,Q6t as nL,Y6t as nM,$Nt as nN,LNt as nO,INt as nP,rGe as nQ,bVt as nR,The as nS,yVt as nT,kh as nU,aet as nV,trt as nW,BGe as nX,Kje as nY,jKe as nZ,i8t as n_,lQt as na,uB as nb,AYt as nc,KOt as nd,VL as ne,x9 as nf,Bfe as ng,yUt as nh,Aqe as ni,cc as nj,YL as nk,Mre as nl,Hd as nm,V7 as nn,vTe as no,gf as np,aM as nq,GGt as nr,mb as ns,VGt as nt,jGt as nu,zGt as nv,w2t as nw,E2t as nx,x2t as ny,T2t as nz,$ce as o,o6t as o$,phe as o0,det as o1,K6t as o2,zHe as o3,x8t as o4,iQ as o5,_I as o6,Vz as o7,zz as o8,FDt as o9,wh as oA,IAe as oB,Ll as oC,pc as oD,pe as oE,Zm as oF,n4 as oG,nCe as oH,Os as oI,ibe as oJ,GC as oK,fwe as oL,O5t as oM,nL as oN,KUe as oO,O0 as oP,jB as oQ,sL as oR,H5t as oS,e6t as oT,r6t as oU,gEe as oV,h6t as oW,HXe as oX,GXe as oY,s6t as oZ,n6t as o_,kDt as oa,Ed as ob,F6t as oc,BDt as od,Th as oe,Uy as of,PL as og,qc as oh,lnt as oi,X6t as oj,ICe as ok,Ji as ol,Ks as om,uQ as on,dtt as oo,ptt as op,xWe as oq,S0 as or,NFt as os,OWe as ot,$Dt as ou,A7e as ov,R3 as ow,Tte as ox,U9e as oy,Aqt as oz,Ms as p,nPt as p$,JFt as p0,m6t as p1,KFt as p2,d6t as p3,c6t as p4,qQe as p5,A6t as p6,t6t as p7,a6t as p8,u6t as p9,AMt as pA,l6t as pB,i6t as pC,g6t as pD,WI as pE,dut as pF,rht as pG,OOe as pH,ROe as pI,Cht as pJ,Rse as pK,adt as pL,KOe as pM,Ise as pN,ddt as pO,Kdt as pP,ypt as pQ,kyt as pR,G9 as pS,b1t as pT,Cne as pU,eyt as pV,fT as pW,HMt as pX,LOt as pY,Ioe as pZ,_Ne as p_,qXe as pa,ZFt as pb,art as pc,$M as pd,O8t as pe,wkt as pf,llt as pg,w7e as ph,lrt as pi,R8t as pj,d8t as pk,V3 as pl,OI as pm,HY as pn,P8t as po,f6t as pp,p6t as pq,xLt as pr,Yc as ps,wb as pt,CLt as pu,S2e as pv,Vwe as pw,gwe as px,bv as py,S5e as pz,_t as q,ZIt as q$,wNe as q0,aPt as q1,SNe as q2,cPt as q3,MNe as q4,hPt as q5,BD as q6,pz as q7,nHe as q8,$Oe as q9,HPt as qA,LNe as qB,YPt as qC,FNe as qD,XPt as qE,UNe as qF,J7 as qG,uIt as qH,_It as qI,OIt as qJ,IIt as qK,LIt as qL,Ort as qM,Jc as qN,a0 as qO,bet as qP,z6t as qQ,Bte as qR,tkt as qS,z9e as qT,ikt as qU,rkt as qV,skt as qW,tNt as qX,rbt as qY,VNe as qZ,pIt as q_,Oht as qa,o5t as qb,fC as qc,E2e as qd,Zte as qe,gGe as qf,cNt as qg,Xte as qh,uNt as qi,pNt as qj,of as qk,mwt as ql,nre as qm,zg as qn,cL as qo,qbt as qp,Zbt as qq,ybt as qr,wbt as qs,Kne as qt,U3t as qu,B3t as qv,q7 as qw,V3t as qx,W9 as qy,vvt as qz,sr as r,l3e as r$,U8t as r0,jrt as r1,ize as r2,i2t as r3,O2t as r4,jTt as r5,hSt as r6,nSt as r7,R3e as r8,QMe as r9,JX as rA,UU as rB,tit as rC,Xie as rD,JMe as rE,Hh as rF,mf as rG,AL as rH,LGe as rI,$Ge as rJ,cGe as rK,xce as rL,Zc as rM,BU as rN,X7e as rO,Q7e as rP,j5t as rQ,Uz as rR,aUe as rS,rat as rT,VM as rU,Mie as rV,ZCe as rW,fKe as rX,Ptt as rY,mKe as rZ,r3e as r_,qot as ra,d0 as rb,fxe as rc,Lrt as rd,hwe as re,G8t as rf,sit as rg,oit as rh,krt as ri,Die as rj,Urt as rk,Vrt as rl,eb as rm,gs as rn,Fqe as ro,Dot as rp,Grt as rq,Oot as rr,Yrt as rs,Yot as rt,Dce as ru,H2e as rv,Fie as rw,qU as rx,epe as ry,iit as rz,pL as s,wnt as s$,e9 as s0,g5t as s1,WCe as s2,VI as s3,Brt as s4,mNt as s5,Oo as s6,YDt as s7,zx as s8,eFt as s9,t9 as sA,Hrt as sB,Bv as sC,Hde as sD,U$ as sE,J3 as sF,lit as sG,ait as sH,bb as sI,uU as sJ,Aie as sK,Tnt as sL,Rrt as sM,Jy as sN,Gnt as sO,Cnt as sP,Mnt as sQ,dnt as sR,pnt as sS,fnt as sT,mnt as sU,gnt as sV,Ant as sW,ynt as sX,_nt as sY,vnt as sZ,bnt as s_,tM as sa,_M as sb,NMe as sc,cte as sd,fE as se,PQ as sf,hkt as sg,Ont as sh,sk as si,MY as sj,_Lt as sk,df as sl,oM as sm,aht as sn,wse as so,nWe as sp,RT as sq,qB as sr,ANt as ss,P5t as st,OVe as su,Ig as sv,Og as sw,uxe as sx,_we as sy,Ole as sz,ts as t,Gne as t$,xnt as t0,ZMe as t1,Z9e as t2,P0 as t3,M5t as t4,tce as t5,Dxe as t6,_ze as t7,Sk as t8,WB as t9,jMe as tA,QT as tB,X3 as tC,bte as tD,b2t as tE,sp as tF,AUt as tG,gUt as tH,nzt as tI,OCe as tJ,q5t as tK,gZe as tL,n5 as tM,JQ as tN,zpt as tO,lWe as tP,oWe as tQ,hg as tR,sDe as tS,Tx as tT,Ipt as tU,I5t as tV,gDe as tW,yDe as tX,z2 as tY,a$ as tZ,nNt as t_,nit as ta,B8t as tb,R5t as tc,UUe as td,jle as te,Q as tf,F5t as tg,RSe as th,QWe as ti,Yl as tj,Jlt as tk,c9 as tl,a$t as tm,y8t as tn,uRe as to,Zat as tp,pRe as tq,qat as tr,d2 as ts,rse as tt,tse as tu,s8t as tv,ise as tw,aot as tx,lot as ty,cot as tz,sv as u,Z2t as u0,hDe as u1,H2t as u2,mDe as u3,pDe as u4,X2t as u5,Gh as u6,gK as u7,uc as u8,fDe as u9,BL as ua,q2t as ub,w4 as uc,tK as ud,o7 as ue,F1t as uf,bxt as ug,vxt as uh,_xt as ui,o_ as uj,KBt as uk,SS as ul,pVe as um,n8t as un,Pie as uo,m8t as up,pkt as uq,RVt as ur,sjt as us,sf as v,E as w,VEt as x,d as y,Le as z};
